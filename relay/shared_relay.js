/******/ (() => { // webpackBootstrap
/******/ 	"use strict";
/******/ 	var __webpack_modules__ = ({

/***/ 616:
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "$p": () => (/* binding */ parseCssFromFile),
/* harmony export */   "SU": () => (/* binding */ handleApiRequest),
/* harmony export */   "ar": () => (/* binding */ generateHTML),
/* harmony export */   "jU": () => (/* binding */ parsePageFromFile),
/* harmony export */   "mn": () => (/* binding */ getPagePath)
/* harmony export */ });
/* unused harmony export parsePageFromJson */
/* harmony import */ var kolmafia__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(530);
/* harmony import */ var kolmafia__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(kolmafia__WEBPACK_IMPORTED_MODULE_0__);
function _toConsumableArray(arr) {return _arrayWithoutHoles(arr) || _iterableToArray(arr) || _unsupportedIterableToArray(arr) || _nonIterableSpread();}function _nonIterableSpread() {throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");}function _iterableToArray(iter) {if (typeof Symbol !== "undefined" && iter[Symbol.iterator] != null || iter["@@iterator"] != null) return Array.from(iter);}function _arrayWithoutHoles(arr) {if (Array.isArray(arr)) return _arrayLikeToArray(arr);}function _slicedToArray(arr, i) {return _arrayWithHoles(arr) || _iterableToArrayLimit(arr, i) || _unsupportedIterableToArray(arr, i) || _nonIterableRest();}function _nonIterableRest() {throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");}function _iterableToArrayLimit(arr, i) {var _i = null == arr ? null : "undefined" != typeof Symbol && arr[Symbol.iterator] || arr["@@iterator"];if (null != _i) {var _s,_e,_x,_r,_arr = [],_n = !0,_d = !1;try {if (_x = (_i = _i.call(arr)).next, 0 === i) {if (Object(_i) !== _i) return;_n = !1;} else for (; !(_n = (_s = _x.call(_i)).done) && (_arr.push(_s.value), _arr.length !== i); _n = !0);} catch (err) {_d = !0, _e = err;} finally {try {if (!_n && null != _i.return && (_r = _i.return(), Object(_r) !== _r)) return;} finally {if (_d) throw _e;}}return _arr;}}function _arrayWithHoles(arr) {if (Array.isArray(arr)) return arr;}function _createForOfIteratorHelper(o, allowArrayLike) {var it = typeof Symbol !== "undefined" && o[Symbol.iterator] || o["@@iterator"];if (!it) {if (Array.isArray(o) || (it = _unsupportedIterableToArray(o)) || allowArrayLike && o && typeof o.length === "number") {if (it) o = it;var i = 0;var F = function F() {};return { s: F, n: function n() {if (i >= o.length) return { done: true };return { done: false, value: o[i++] };}, e: function e(_e2) {throw _e2;}, f: F };}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");}var normalCompletion = true,didErr = false,err;return { s: function s() {it = it.call(o);}, n: function n() {var step = it.next();normalCompletion = step.done;return step;}, e: function e(_e3) {didErr = true;err = _e3;}, f: function f() {try {if (!normalCompletion && it.return != null) it.return();} finally {if (didErr) throw err;}} };}function _unsupportedIterableToArray(o, minLen) {if (!o) return;if (typeof o === "string") return _arrayLikeToArray(o, minLen);var n = Object.prototype.toString.call(o).slice(8, -1);if (n === "Object" && o.constructor) n = o.constructor.name;if (n === "Map" || n === "Set") return Array.from(o);if (n === "Arguments" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen);}function _arrayLikeToArray(arr, len) {if (len == null || len > arr.length) len = arr.length;for (var i = 0, arr2 = new Array(len); i < len; i++) arr2[i] = arr[i];return arr2;}








function handleApiRequest() {
  if (handleJavascript()) {
    return true;
  }

  if (handleProperties()) {
    return true;
  }

  return false;
}

function handleProperties() {
  var toSet = (0,kolmafia__WEBPACK_IMPORTED_MODULE_0__.formFields)()["setProperties"];

  if (toSet == null) {
    return false;
  }

  var props = JSON.parse(toSet);
  var notifications = [];var _iterator = _createForOfIteratorHelper(

    props),_step;try {for (_iterator.s(); !(_step = _iterator.n()).done;) {var _step$value = _slicedToArray(_step.value, 2),key = _step$value[0],value = _step$value[1];
      var prevValue = (0,kolmafia__WEBPACK_IMPORTED_MODULE_0__.getProperty)(key);

      if (prevValue === value) {
        continue;
      }

      (0,kolmafia__WEBPACK_IMPORTED_MODULE_0__.setProperty)(key, value);
      notifications.push("".concat(key, " changed from `").concat(prevValue, "` to `").concat(value, "`"));
    }} catch (err) {_iterator.e(err);} finally {_iterator.f();}

  if (notifications.length == 0) {
    notifications.push("No settings were modified.");
  }

  // We include the ' ' because otherwise the browser doesn't like an empty page
  (0,kolmafia__WEBPACK_IMPORTED_MODULE_0__.write)(JSON.stringify(notifications));
  return true;
}

function handleJavascript() {
  var js = (0,kolmafia__WEBPACK_IMPORTED_MODULE_0__.formFields)()["javascript"];

  if (js == null) {
    return false;
  }

  var returns = eval(js) || "";
  // We include the ' ' because otherwise the browser doesn't like an empty page
  (0,kolmafia__WEBPACK_IMPORTED_MODULE_0__.write)(returns + (returns ? "" : " "));
  return true;
}

function validateComponents(components) {var _iterator2 = _createForOfIteratorHelper(
    components),_step2;try {for (_iterator2.s(); !(_step2 = _iterator2.n()).done;) {var _button$name;var component = _step2.value;
      var button = component;

      if (button.preference == null) {
        continue;
      }

      button.name = (_button$name = button.name) !== null && _button$name !== void 0 ? _button$name : button.preference;

      if (button.validate != null) {
        try {
          eval(button.validate);
        } catch (e) {
          (0,kolmafia__WEBPACK_IMPORTED_MODULE_0__.print)("Unable to load ".concat(button.name, "'s validator '").concat(button.validate, "'"));
          button.validate = null;
        }
      }

      if (button.default != undefined && typeof button.default != "string") {
        button.default = button.default + "";
      }

      if (button.default == null && (0,kolmafia__WEBPACK_IMPORTED_MODULE_0__.propertyHasDefault)(button.preference)) {
        button.default = (0,kolmafia__WEBPACK_IMPORTED_MODULE_0__.propertyDefaultValue)(button.preference);
      }

      if (button.value != undefined && typeof button.value != "string") {
        button.value = button.value + "";
      }

      if (button.default == null && button.type == "boolean") {
        button.default = "true";
      }

      if (button.value != null) {
        continue;
      }

      var val = void 0;

      if ((0,kolmafia__WEBPACK_IMPORTED_MODULE_0__.propertyExists)(button.preference)) {
        val = (0,kolmafia__WEBPACK_IMPORTED_MODULE_0__.getProperty)(button.preference);
      } else if (button.default != null) {
        val = button.default;
      } else {
        if (button.type == "dropdown") {
          val = button.dropdown[0].value;
        } else if (button.type == "boolean") {
          val = "true";
        } else {
          val = "";
        }
      }

      button.value = val;
    }} catch (err) {_iterator2.e(err);} finally {_iterator2.f();}
}

function generateHTML(
pages,
extraHtml)
{
  pages = pages.filter((p) => p != null);var _iterator3 = _createForOfIteratorHelper(

    pages),_step3;try {for (_iterator3.s(); !(_step3 = _iterator3.n()).done;) {var _page$file;var page = _step3.value;
      page.file = (_page$file = page.file) !== null && _page$file !== void 0 ? _page$file : page.page;

      validateComponents(page.components);
    }} catch (err) {_iterator3.e(err);} finally {_iterator3.f();}

  var buffer = [];

  var cssFiles = [];

  if (extraHtml && extraHtml.cssFiles) {
    cssFiles.push.apply(cssFiles, _toConsumableArray(extraHtml.cssFiles));
  }

  buffer.push("<head>");

  cssFiles.forEach((s) => {
    buffer.push("<link rel=\"stylesheet\" src=\"".concat(s, "\">"));
  });

  buffer.push("<style>");
  buffer.push("".concat(__webpack_require__(171)));

  if (extraHtml && extraHtml.css) {
    buffer.push(extraHtml.css);
  }

  buffer.push("</style>");

  buffer.push("</head>");

  buffer.push('<div id="root"></div>');

  buffer.push("<script>");

  // add script that react calls when loaded to get kol data
  buffer.push("let getData = function(callback) {callback(".concat(
  JSON.stringify(pages), ")}"));


  // close notifications when they are clicked on
  buffer.push("document.onclick = (e) => {\n    if(e.target.classList.contains('notification')) e.target.remove();\n  }");



  buffer.push("</script>");

  // include react script
  buffer.push("<script src=\"".concat(
  __webpack_require__(832), "\"></script>"));


  return buffer.join("\n");
}

function getPagePath(file) {
  var fileName = file.includes("/") ?
  file :
  "relay/shared_relay/pages/" + file + ".json";

  if (!fileName.endsWith(".json") && (0,kolmafia__WEBPACK_IMPORTED_MODULE_0__.fileToBuffer)(fileName).length == 0) {
    fileName += ".json";
  }

  return fileName;
}

/**
 * Parses from relay/shared_relay/pages/ if no slashes are in the name, otherwise expects a valid json file
 */
function parsePageFromFile(file) {
  var data = (0,kolmafia__WEBPACK_IMPORTED_MODULE_0__.fileToBuffer)(getPagePath(file));

  return parsePageFromJson(file, data);
}

function parseCssFromFile(file) {
  var fileName = file.includes("/") ?
  file :
  "relay/shared_relay/pages/" + file + ".css";

  if (!fileName.endsWith(".css")) {
    fileName += ".css";
  }

  var data = (0,kolmafia__WEBPACK_IMPORTED_MODULE_0__.fileToBuffer)(fileName);

  if (data.length == 0) {
    return null;
  }

  return data;
}

function parsePageFromJson(id, jsonData) {
  if (jsonData.length == 0) {
    return null;
  }

  var subpage = JSON.parse(jsonData);

  subpage.file = id;

  for (var _i2 = 0, _arr2 = subpage.components; _i2 < _arr2.length; _i2++) {var _button$dropdown;var button = _arr2[_i2];
    if (button.type != "dropdown") {
      continue;
    }

    if (button.dropdown == null) {
      button.dropdown = [];
    } else if (typeof button.dropdown[0] == "string") {
      button.dropdown = button.dropdown.map((s) => {
        return {
          display: s,
          value: s
        };
      });
    }

    if (button.dropdownFiller == null) {
      continue;
    }

    var data =
    eval(button.dropdownFiller).
    map((_ref) => {var _ref2 = _slicedToArray(_ref, 2),display = _ref2[0],value = _ref2[1];
      return {
        display: display,
        value: value
      };
    });

    (_button$dropdown = button.dropdown).push.apply(_button$dropdown, _toConsumableArray(data));
  }

  return subpage;
}

/***/ }),

/***/ 832:
/***/ ((module) => {

module.exports = "data:application/javascript;base64,ZnVuY3Rpb24gX3JlZ2VuZXJhdG9yUnVudGltZTIoKSB7InVzZSBzdHJpY3QiOwovKiEgcmVnZW5lcmF0b3ItcnVudGltZSAtLSBDb3B5cmlnaHQgKGMpIDIwMTQtcHJlc2VudCwgRmFjZWJvb2ssIEluYy4gLS0gbGljZW5zZSAoTUlUKTogaHR0cHM6Ly9naXRodWIuY29tL2ZhY2Vib29rL3JlZ2VuZXJhdG9yL2Jsb2IvbWFpbi9MSUNFTlNFICovX3JlZ2VuZXJhdG9yUnVudGltZTIgPSBmdW5jdGlvbiBfcmVnZW5lcmF0b3JSdW50aW1lMigpIHtyZXR1cm4gZXhwb3J0czt9O3ZhciBleHBvcnRzID0ge30sT3AgPSBPYmplY3QucHJvdG90eXBlLGhhc093biA9IE9wLmhhc093blByb3BlcnR5LGRlZmluZVByb3BlcnR5ID0gT2JqZWN0LmRlZmluZVByb3BlcnR5IHx8IGZ1bmN0aW9uIChvYmosIGtleSwgZGVzYykge29ialtrZXldID0gZGVzYy52YWx1ZTt9LCRTeW1ib2wgPSAiZnVuY3Rpb24iID09IHR5cGVvZiBTeW1ib2wgPyBTeW1ib2wgOiB7fSxpdGVyYXRvclN5bWJvbCA9ICRTeW1ib2wuaXRlcmF0b3IgfHwgIkBAaXRlcmF0b3IiLGFzeW5jSXRlcmF0b3JTeW1ib2wgPSAkU3ltYm9sLmFzeW5jSXRlcmF0b3IgfHwgIkBAYXN5bmNJdGVyYXRvciIsdG9TdHJpbmdUYWdTeW1ib2wgPSAkU3ltYm9sLnRvU3RyaW5nVGFnIHx8ICJAQHRvU3RyaW5nVGFnIjtmdW5jdGlvbiBkZWZpbmUob2JqLCBrZXksIHZhbHVlKSB7cmV0dXJuIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvYmosIGtleSwgeyB2YWx1ZTogdmFsdWUsIGVudW1lcmFibGU6ICEwLCBjb25maWd1cmFibGU6ICEwLCB3cml0YWJsZTogITAgfSksIG9ialtrZXldO310cnkge2RlZmluZSh7fSwgIiIpO30gY2F0Y2ggKGVycikge2RlZmluZSA9IGZ1bmN0aW9uIGRlZmluZShvYmosIGtleSwgdmFsdWUpIHtyZXR1cm4gb2JqW2tleV0gPSB2YWx1ZTt9O31mdW5jdGlvbiB3cmFwKGlubmVyRm4sIG91dGVyRm4sIHNlbGYsIHRyeUxvY3NMaXN0KSB7dmFyIHByb3RvR2VuZXJhdG9yID0gb3V0ZXJGbiAmJiBvdXRlckZuLnByb3RvdHlwZSBpbnN0YW5jZW9mIEdlbmVyYXRvciA/IG91dGVyRm4gOiBHZW5lcmF0b3IsZ2VuZXJhdG9yID0gT2JqZWN0LmNyZWF0ZShwcm90b0dlbmVyYXRvci5wcm90b3R5cGUpLGNvbnRleHQgPSBuZXcgQ29udGV4dCh0cnlMb2NzTGlzdCB8fCBbXSk7cmV0dXJuIGRlZmluZVByb3BlcnR5KGdlbmVyYXRvciwgIl9pbnZva2UiLCB7IHZhbHVlOiBtYWtlSW52b2tlTWV0aG9kKGlubmVyRm4sIHNlbGYsIGNvbnRleHQpIH0pLCBnZW5lcmF0b3I7fWZ1bmN0aW9uIHRyeUNhdGNoKGZuLCBvYmosIGFyZykge3RyeSB7cmV0dXJuIHsgdHlwZTogIm5vcm1hbCIsIGFyZzogZm4uY2FsbChvYmosIGFyZykgfTt9IGNhdGNoIChlcnIpIHtyZXR1cm4geyB0eXBlOiAidGhyb3ciLCBhcmc6IGVyciB9O319ZXhwb3J0cy53cmFwID0gd3JhcDt2YXIgQ29udGludWVTZW50aW5lbCA9IHt9O2Z1bmN0aW9uIEdlbmVyYXRvcigpIHt9ZnVuY3Rpb24gR2VuZXJhdG9yRnVuY3Rpb24oKSB7fWZ1bmN0aW9uIEdlbmVyYXRvckZ1bmN0aW9uUHJvdG90eXBlKCkge312YXIgSXRlcmF0b3JQcm90b3R5cGUgPSB7fTtkZWZpbmUoSXRlcmF0b3JQcm90b3R5cGUsIGl0ZXJhdG9yU3ltYm9sLCBmdW5jdGlvbiAoKSB7cmV0dXJuIHRoaXM7fSk7dmFyIGdldFByb3RvID0gT2JqZWN0LmdldFByb3RvdHlwZU9mLE5hdGl2ZUl0ZXJhdG9yUHJvdG90eXBlID0gZ2V0UHJvdG8gJiYgZ2V0UHJvdG8oZ2V0UHJvdG8odmFsdWVzKFtdKSkpO05hdGl2ZUl0ZXJhdG9yUHJvdG90eXBlICYmIE5hdGl2ZUl0ZXJhdG9yUHJvdG90eXBlICE9PSBPcCAmJiBoYXNPd24uY2FsbChOYXRpdmVJdGVyYXRvclByb3RvdHlwZSwgaXRlcmF0b3JTeW1ib2wpICYmIChJdGVyYXRvclByb3RvdHlwZSA9IE5hdGl2ZUl0ZXJhdG9yUHJvdG90eXBlKTt2YXIgR3AgPSBHZW5lcmF0b3JGdW5jdGlvblByb3RvdHlwZS5wcm90b3R5cGUgPSBHZW5lcmF0b3IucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZShJdGVyYXRvclByb3RvdHlwZSk7ZnVuY3Rpb24gZGVmaW5lSXRlcmF0b3JNZXRob2RzKHByb3RvdHlwZSkge1sibmV4dCIsICJ0aHJvdyIsICJyZXR1cm4iXS5mb3JFYWNoKGZ1bmN0aW9uIChtZXRob2QpIHtkZWZpbmUocHJvdG90eXBlLCBtZXRob2QsIGZ1bmN0aW9uIChhcmcpIHtyZXR1cm4gdGhpcy5faW52b2tlKG1ldGhvZCwgYXJnKTt9KTt9KTt9ZnVuY3Rpb24gQXN5bmNJdGVyYXRvcihnZW5lcmF0b3IsIFByb21pc2VJbXBsKSB7ZnVuY3Rpb24gaW52b2tlKG1ldGhvZCwgYXJnLCByZXNvbHZlLCByZWplY3QpIHt2YXIgcmVjb3JkID0gdHJ5Q2F0Y2goZ2VuZXJhdG9yW21ldGhvZF0sIGdlbmVyYXRvciwgYXJnKTtpZiAoInRocm93IiAhPT0gcmVjb3JkLnR5cGUpIHt2YXIgcmVzdWx0ID0gcmVjb3JkLmFyZyx2YWx1ZSA9IHJlc3VsdC52YWx1ZTtyZXR1cm4gdmFsdWUgJiYgIm9iamVjdCIgPT0gdHlwZW9mIHZhbHVlICYmIGhhc093bi5jYWxsKHZhbHVlLCAiX19hd2FpdCIpID8gUHJvbWlzZUltcGwucmVzb2x2ZSh2YWx1ZS5fX2F3YWl0KS50aGVuKGZ1bmN0aW9uICh2YWx1ZSkge2ludm9rZSgibmV4dCIsIHZhbHVlLCByZXNvbHZlLCByZWplY3QpO30sIGZ1bmN0aW9uIChlcnIpIHtpbnZva2UoInRocm93IiwgZXJyLCByZXNvbHZlLCByZWplY3QpO30pIDogUHJvbWlzZUltcGwucmVzb2x2ZSh2YWx1ZSkudGhlbihmdW5jdGlvbiAodW53cmFwcGVkKSB7cmVzdWx0LnZhbHVlID0gdW53cmFwcGVkLCByZXNvbHZlKHJlc3VsdCk7fSwgZnVuY3Rpb24gKGVycm9yKSB7cmV0dXJuIGludm9rZSgidGhyb3ciLCBlcnJvciwgcmVzb2x2ZSwgcmVqZWN0KTt9KTt9cmVqZWN0KHJlY29yZC5hcmcpO312YXIgcHJldmlvdXNQcm9taXNlO2RlZmluZVByb3BlcnR5KHRoaXMsICJfaW52b2tlIiwgeyB2YWx1ZTogZnVuY3Rpb24gdmFsdWUobWV0aG9kLCBhcmcpIHtmdW5jdGlvbiBjYWxsSW52b2tlV2l0aE1ldGhvZEFuZEFyZygpIHtyZXR1cm4gbmV3IFByb21pc2VJbXBsKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtpbnZva2UobWV0aG9kLCBhcmcsIHJlc29sdmUsIHJlamVjdCk7fSk7fXJldHVybiBwcmV2aW91c1Byb21pc2UgPSBwcmV2aW91c1Byb21pc2UgPyBwcmV2aW91c1Byb21pc2UudGhlbihjYWxsSW52b2tlV2l0aE1ldGhvZEFuZEFyZywgY2FsbEludm9rZVdpdGhNZXRob2RBbmRBcmcpIDogY2FsbEludm9rZVdpdGhNZXRob2RBbmRBcmcoKTt9IH0pO31mdW5jdGlvbiBtYWtlSW52b2tlTWV0aG9kKGlubmVyRm4sIHNlbGYsIGNvbnRleHQpIHt2YXIgc3RhdGUgPSAic3VzcGVuZGVkU3RhcnQiO3JldHVybiBmdW5jdGlvbiAobWV0aG9kLCBhcmcpIHtpZiAoImV4ZWN1dGluZyIgPT09IHN0YXRlKSB0aHJvdyBuZXcgRXJyb3IoIkdlbmVyYXRvciBpcyBhbHJlYWR5IHJ1bm5pbmciKTtpZiAoImNvbXBsZXRlZCIgPT09IHN0YXRlKSB7aWYgKCJ0aHJvdyIgPT09IG1ldGhvZCkgdGhyb3cgYXJnO3JldHVybiBkb25lUmVzdWx0KCk7fWZvciAoY29udGV4dC5tZXRob2QgPSBtZXRob2QsIGNvbnRleHQuYXJnID0gYXJnOzspIHt2YXIgZGVsZWdhdGUgPSBjb250ZXh0LmRlbGVnYXRlO2lmIChkZWxlZ2F0ZSkge3ZhciBkZWxlZ2F0ZVJlc3VsdCA9IG1heWJlSW52b2tlRGVsZWdhdGUoZGVsZWdhdGUsIGNvbnRleHQpO2lmIChkZWxlZ2F0ZVJlc3VsdCkge2lmIChkZWxlZ2F0ZVJlc3VsdCA9PT0gQ29udGludWVTZW50aW5lbCkgY29udGludWU7cmV0dXJuIGRlbGVnYXRlUmVzdWx0O319aWYgKCJuZXh0IiA9PT0gY29udGV4dC5tZXRob2QpIGNvbnRleHQuc2VudCA9IGNvbnRleHQuX3NlbnQgPSBjb250ZXh0LmFyZztlbHNlIGlmICgidGhyb3ciID09PSBjb250ZXh0Lm1ldGhvZCkge2lmICgic3VzcGVuZGVkU3RhcnQiID09PSBzdGF0ZSkgdGhyb3cgc3RhdGUgPSAiY29tcGxldGVkIiwgY29udGV4dC5hcmc7Y29udGV4dC5kaXNwYXRjaEV4Y2VwdGlvbihjb250ZXh0LmFyZyk7fSBlbHNlICJyZXR1cm4iID09PSBjb250ZXh0Lm1ldGhvZCAmJiBjb250ZXh0LmFicnVwdCgicmV0dXJuIiwgY29udGV4dC5hcmcpO3N0YXRlID0gImV4ZWN1dGluZyI7dmFyIHJlY29yZCA9IHRyeUNhdGNoKGlubmVyRm4sIHNlbGYsIGNvbnRleHQpO2lmICgibm9ybWFsIiA9PT0gcmVjb3JkLnR5cGUpIHtpZiAoc3RhdGUgPSBjb250ZXh0LmRvbmUgPyAiY29tcGxldGVkIiA6ICJzdXNwZW5kZWRZaWVsZCIsIHJlY29yZC5hcmcgPT09IENvbnRpbnVlU2VudGluZWwpIGNvbnRpbnVlO3JldHVybiB7IHZhbHVlOiByZWNvcmQuYXJnLCBkb25lOiBjb250ZXh0LmRvbmUgfTt9InRocm93IiA9PT0gcmVjb3JkLnR5cGUgJiYgKHN0YXRlID0gImNvbXBsZXRlZCIsIGNvbnRleHQubWV0aG9kID0gInRocm93IiwgY29udGV4dC5hcmcgPSByZWNvcmQuYXJnKTt9fTt9ZnVuY3Rpb24gbWF5YmVJbnZva2VEZWxlZ2F0ZShkZWxlZ2F0ZSwgY29udGV4dCkge3ZhciBtZXRob2ROYW1lID0gY29udGV4dC5tZXRob2QsbWV0aG9kID0gZGVsZWdhdGUuaXRlcmF0b3JbbWV0aG9kTmFtZV07aWYgKHVuZGVmaW5lZCA9PT0gbWV0aG9kKSByZXR1cm4gY29udGV4dC5kZWxlZ2F0ZSA9IG51bGwsICJ0aHJvdyIgPT09IG1ldGhvZE5hbWUgJiYgZGVsZWdhdGUuaXRlcmF0b3IucmV0dXJuICYmIChjb250ZXh0Lm1ldGhvZCA9ICJyZXR1cm4iLCBjb250ZXh0LmFyZyA9IHVuZGVmaW5lZCwgbWF5YmVJbnZva2VEZWxlZ2F0ZShkZWxlZ2F0ZSwgY29udGV4dCksICJ0aHJvdyIgPT09IGNvbnRleHQubWV0aG9kKSB8fCAicmV0dXJuIiAhPT0gbWV0aG9kTmFtZSAmJiAoY29udGV4dC5tZXRob2QgPSAidGhyb3ciLCBjb250ZXh0LmFyZyA9IG5ldyBUeXBlRXJyb3IoIlRoZSBpdGVyYXRvciBkb2VzIG5vdCBwcm92aWRlIGEgJyIgKyBtZXRob2ROYW1lICsgIicgbWV0aG9kIikpLCBDb250aW51ZVNlbnRpbmVsO3ZhciByZWNvcmQgPSB0cnlDYXRjaChtZXRob2QsIGRlbGVnYXRlLml0ZXJhdG9yLCBjb250ZXh0LmFyZyk7aWYgKCJ0aHJvdyIgPT09IHJlY29yZC50eXBlKSByZXR1cm4gY29udGV4dC5tZXRob2QgPSAidGhyb3ciLCBjb250ZXh0LmFyZyA9IHJlY29yZC5hcmcsIGNvbnRleHQuZGVsZWdhdGUgPSBudWxsLCBDb250aW51ZVNlbnRpbmVsO3ZhciBpbmZvID0gcmVjb3JkLmFyZztyZXR1cm4gaW5mbyA/IGluZm8uZG9uZSA/IChjb250ZXh0W2RlbGVnYXRlLnJlc3VsdE5hbWVdID0gaW5mby52YWx1ZSwgY29udGV4dC5uZXh0ID0gZGVsZWdhdGUubmV4dExvYywgInJldHVybiIgIT09IGNvbnRleHQubWV0aG9kICYmIChjb250ZXh0Lm1ldGhvZCA9ICJuZXh0IiwgY29udGV4dC5hcmcgPSB1bmRlZmluZWQpLCBjb250ZXh0LmRlbGVnYXRlID0gbnVsbCwgQ29udGludWVTZW50aW5lbCkgOiBpbmZvIDogKGNvbnRleHQubWV0aG9kID0gInRocm93IiwgY29udGV4dC5hcmcgPSBuZXcgVHlwZUVycm9yKCJpdGVyYXRvciByZXN1bHQgaXMgbm90IGFuIG9iamVjdCIpLCBjb250ZXh0LmRlbGVnYXRlID0gbnVsbCwgQ29udGludWVTZW50aW5lbCk7fWZ1bmN0aW9uIHB1c2hUcnlFbnRyeShsb2NzKSB7dmFyIGVudHJ5ID0geyB0cnlMb2M6IGxvY3NbMF0gfTsxIGluIGxvY3MgJiYgKGVudHJ5LmNhdGNoTG9jID0gbG9jc1sxXSksIDIgaW4gbG9jcyAmJiAoZW50cnkuZmluYWxseUxvYyA9IGxvY3NbMl0sIGVudHJ5LmFmdGVyTG9jID0gbG9jc1szXSksIHRoaXMudHJ5RW50cmllcy5wdXNoKGVudHJ5KTt9ZnVuY3Rpb24gcmVzZXRUcnlFbnRyeShlbnRyeSkge3ZhciByZWNvcmQgPSBlbnRyeS5jb21wbGV0aW9uIHx8IHt9O3JlY29yZC50eXBlID0gIm5vcm1hbCIsIGRlbGV0ZSByZWNvcmQuYXJnLCBlbnRyeS5jb21wbGV0aW9uID0gcmVjb3JkO31mdW5jdGlvbiBDb250ZXh0KHRyeUxvY3NMaXN0KSB7dGhpcy50cnlFbnRyaWVzID0gW3sgdHJ5TG9jOiAicm9vdCIgfV0sIHRyeUxvY3NMaXN0LmZvckVhY2gocHVzaFRyeUVudHJ5LCB0aGlzKSwgdGhpcy5yZXNldCghMCk7fWZ1bmN0aW9uIHZhbHVlcyhpdGVyYWJsZSkge2lmIChpdGVyYWJsZSkge3ZhciBpdGVyYXRvck1ldGhvZCA9IGl0ZXJhYmxlW2l0ZXJhdG9yU3ltYm9sXTtpZiAoaXRlcmF0b3JNZXRob2QpIHJldHVybiBpdGVyYXRvck1ldGhvZC5jYWxsKGl0ZXJhYmxlKTtpZiAoImZ1bmN0aW9uIiA9PSB0eXBlb2YgaXRlcmFibGUubmV4dCkgcmV0dXJuIGl0ZXJhYmxlO2lmICghaXNOYU4oaXRlcmFibGUubGVuZ3RoKSkge3ZhciBpID0gLTEsbmV4dCA9IGZ1bmN0aW9uIG5leHQoKSB7Zm9yICg7ICsraSA8IGl0ZXJhYmxlLmxlbmd0aDspIGlmIChoYXNPd24uY2FsbChpdGVyYWJsZSwgaSkpIHJldHVybiBuZXh0LnZhbHVlID0gaXRlcmFibGVbaV0sIG5leHQuZG9uZSA9ICExLCBuZXh0O3JldHVybiBuZXh0LnZhbHVlID0gdW5kZWZpbmVkLCBuZXh0LmRvbmUgPSAhMCwgbmV4dDt9O3JldHVybiBuZXh0Lm5leHQgPSBuZXh0O319cmV0dXJuIHsgbmV4dDogZG9uZVJlc3VsdCB9O31mdW5jdGlvbiBkb25lUmVzdWx0KCkge3JldHVybiB7IHZhbHVlOiB1bmRlZmluZWQsIGRvbmU6ICEwIH07fXJldHVybiBHZW5lcmF0b3JGdW5jdGlvbi5wcm90b3R5cGUgPSBHZW5lcmF0b3JGdW5jdGlvblByb3RvdHlwZSwgZGVmaW5lUHJvcGVydHkoR3AsICJjb25zdHJ1Y3RvciIsIHsgdmFsdWU6IEdlbmVyYXRvckZ1bmN0aW9uUHJvdG90eXBlLCBjb25maWd1cmFibGU6ICEwIH0pLCBkZWZpbmVQcm9wZXJ0eShHZW5lcmF0b3JGdW5jdGlvblByb3RvdHlwZSwgImNvbnN0cnVjdG9yIiwgeyB2YWx1ZTogR2VuZXJhdG9yRnVuY3Rpb24sIGNvbmZpZ3VyYWJsZTogITAgfSksIEdlbmVyYXRvckZ1bmN0aW9uLmRpc3BsYXlOYW1lID0gZGVmaW5lKEdlbmVyYXRvckZ1bmN0aW9uUHJvdG90eXBlLCB0b1N0cmluZ1RhZ1N5bWJvbCwgIkdlbmVyYXRvckZ1bmN0aW9uIiksIGV4cG9ydHMuaXNHZW5lcmF0b3JGdW5jdGlvbiA9IGZ1bmN0aW9uIChnZW5GdW4pIHt2YXIgY3RvciA9ICJmdW5jdGlvbiIgPT0gdHlwZW9mIGdlbkZ1biAmJiBnZW5GdW4uY29uc3RydWN0b3I7cmV0dXJuICEhY3RvciAmJiAoY3RvciA9PT0gR2VuZXJhdG9yRnVuY3Rpb24gfHwgIkdlbmVyYXRvckZ1bmN0aW9uIiA9PT0gKGN0b3IuZGlzcGxheU5hbWUgfHwgY3Rvci5uYW1lKSk7fSwgZXhwb3J0cy5tYXJrID0gZnVuY3Rpb24gKGdlbkZ1bikge3JldHVybiBPYmplY3Quc2V0UHJvdG90eXBlT2YgPyBPYmplY3Quc2V0UHJvdG90eXBlT2YoZ2VuRnVuLCBHZW5lcmF0b3JGdW5jdGlvblByb3RvdHlwZSkgOiAoZ2VuRnVuLl9fcHJvdG9fXyA9IEdlbmVyYXRvckZ1bmN0aW9uUHJvdG90eXBlLCBkZWZpbmUoZ2VuRnVuLCB0b1N0cmluZ1RhZ1N5bWJvbCwgIkdlbmVyYXRvckZ1bmN0aW9uIikpLCBnZW5GdW4ucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZShHcCksIGdlbkZ1bjt9LCBleHBvcnRzLmF3cmFwID0gZnVuY3Rpb24gKGFyZykge3JldHVybiB7IF9fYXdhaXQ6IGFyZyB9O30sIGRlZmluZUl0ZXJhdG9yTWV0aG9kcyhBc3luY0l0ZXJhdG9yLnByb3RvdHlwZSksIGRlZmluZShBc3luY0l0ZXJhdG9yLnByb3RvdHlwZSwgYXN5bmNJdGVyYXRvclN5bWJvbCwgZnVuY3Rpb24gKCkge3JldHVybiB0aGlzO30pLCBleHBvcnRzLkFzeW5jSXRlcmF0b3IgPSBBc3luY0l0ZXJhdG9yLCBleHBvcnRzLmFzeW5jID0gZnVuY3Rpb24gKGlubmVyRm4sIG91dGVyRm4sIHNlbGYsIHRyeUxvY3NMaXN0LCBQcm9taXNlSW1wbCkge3ZvaWQgMCA9PT0gUHJvbWlzZUltcGwgJiYgKFByb21pc2VJbXBsID0gUHJvbWlzZSk7dmFyIGl0ZXIgPSBuZXcgQXN5bmNJdGVyYXRvcih3cmFwKGlubmVyRm4sIG91dGVyRm4sIHNlbGYsIHRyeUxvY3NMaXN0KSwgUHJvbWlzZUltcGwpO3JldHVybiBleHBvcnRzLmlzR2VuZXJhdG9yRnVuY3Rpb24ob3V0ZXJGbikgPyBpdGVyIDogaXRlci5uZXh0KCkudGhlbihmdW5jdGlvbiAocmVzdWx0KSB7cmV0dXJuIHJlc3VsdC5kb25lID8gcmVzdWx0LnZhbHVlIDogaXRlci5uZXh0KCk7fSk7fSwgZGVmaW5lSXRlcmF0b3JNZXRob2RzKEdwKSwgZGVmaW5lKEdwLCB0b1N0cmluZ1RhZ1N5bWJvbCwgIkdlbmVyYXRvciIpLCBkZWZpbmUoR3AsIGl0ZXJhdG9yU3ltYm9sLCBmdW5jdGlvbiAoKSB7cmV0dXJuIHRoaXM7fSksIGRlZmluZShHcCwgInRvU3RyaW5nIiwgZnVuY3Rpb24gKCkge3JldHVybiAiW29iamVjdCBHZW5lcmF0b3JdIjt9KSwgZXhwb3J0cy5rZXlzID0gZnVuY3Rpb24gKHZhbCkge3ZhciBvYmplY3QgPSBPYmplY3QodmFsKSxrZXlzID0gW107Zm9yICh2YXIga2V5IGluIG9iamVjdCkga2V5cy5wdXNoKGtleSk7cmV0dXJuIGtleXMucmV2ZXJzZSgpLCBmdW5jdGlvbiBuZXh0KCkge2ZvciAoOyBrZXlzLmxlbmd0aDspIHt2YXIga2V5ID0ga2V5cy5wb3AoKTtpZiAoa2V5IGluIG9iamVjdCkgcmV0dXJuIG5leHQudmFsdWUgPSBrZXksIG5leHQuZG9uZSA9ICExLCBuZXh0O31yZXR1cm4gbmV4dC5kb25lID0gITAsIG5leHQ7fTt9LCBleHBvcnRzLnZhbHVlcyA9IHZhbHVlcywgQ29udGV4dC5wcm90b3R5cGUgPSB7IGNvbnN0cnVjdG9yOiBDb250ZXh0LCByZXNldDogZnVuY3Rpb24gcmVzZXQoc2tpcFRlbXBSZXNldCkge2lmICh0aGlzLnByZXYgPSAwLCB0aGlzLm5leHQgPSAwLCB0aGlzLnNlbnQgPSB0aGlzLl9zZW50ID0gdW5kZWZpbmVkLCB0aGlzLmRvbmUgPSAhMSwgdGhpcy5kZWxlZ2F0ZSA9IG51bGwsIHRoaXMubWV0aG9kID0gIm5leHQiLCB0aGlzLmFyZyA9IHVuZGVmaW5lZCwgdGhpcy50cnlFbnRyaWVzLmZvckVhY2gocmVzZXRUcnlFbnRyeSksICFza2lwVGVtcFJlc2V0KSBmb3IgKHZhciBuYW1lIGluIHRoaXMpICJ0IiA9PT0gbmFtZS5jaGFyQXQoMCkgJiYgaGFzT3duLmNhbGwodGhpcywgbmFtZSkgJiYgIWlzTmFOKCtuYW1lLnNsaWNlKDEpKSAmJiAodGhpc1tuYW1lXSA9IHVuZGVmaW5lZCk7fSwgc3RvcDogZnVuY3Rpb24gc3RvcCgpIHt0aGlzLmRvbmUgPSAhMDt2YXIgcm9vdFJlY29yZCA9IHRoaXMudHJ5RW50cmllc1swXS5jb21wbGV0aW9uO2lmICgidGhyb3ciID09PSByb290UmVjb3JkLnR5cGUpIHRocm93IHJvb3RSZWNvcmQuYXJnO3JldHVybiB0aGlzLnJ2YWw7fSwgZGlzcGF0Y2hFeGNlcHRpb246IGZ1bmN0aW9uIGRpc3BhdGNoRXhjZXB0aW9uKGV4Y2VwdGlvbikge2lmICh0aGlzLmRvbmUpIHRocm93IGV4Y2VwdGlvbjt2YXIgY29udGV4dCA9IHRoaXM7ZnVuY3Rpb24gaGFuZGxlKGxvYywgY2F1Z2h0KSB7cmV0dXJuIHJlY29yZC50eXBlID0gInRocm93IiwgcmVjb3JkLmFyZyA9IGV4Y2VwdGlvbiwgY29udGV4dC5uZXh0ID0gbG9jLCBjYXVnaHQgJiYgKGNvbnRleHQubWV0aG9kID0gIm5leHQiLCBjb250ZXh0LmFyZyA9IHVuZGVmaW5lZCksICEhY2F1Z2h0O31mb3IgKHZhciBpID0gdGhpcy50cnlFbnRyaWVzLmxlbmd0aCAtIDE7IGkgPj0gMDsgLS1pKSB7dmFyIGVudHJ5ID0gdGhpcy50cnlFbnRyaWVzW2ldLHJlY29yZCA9IGVudHJ5LmNvbXBsZXRpb247aWYgKCJyb290IiA9PT0gZW50cnkudHJ5TG9jKSByZXR1cm4gaGFuZGxlKCJlbmQiKTtpZiAoZW50cnkudHJ5TG9jIDw9IHRoaXMucHJldikge3ZhciBoYXNDYXRjaCA9IGhhc093bi5jYWxsKGVudHJ5LCAiY2F0Y2hMb2MiKSxoYXNGaW5hbGx5ID0gaGFzT3duLmNhbGwoZW50cnksICJmaW5hbGx5TG9jIik7aWYgKGhhc0NhdGNoICYmIGhhc0ZpbmFsbHkpIHtpZiAodGhpcy5wcmV2IDwgZW50cnkuY2F0Y2hMb2MpIHJldHVybiBoYW5kbGUoZW50cnkuY2F0Y2hMb2MsICEwKTtpZiAodGhpcy5wcmV2IDwgZW50cnkuZmluYWxseUxvYykgcmV0dXJuIGhhbmRsZShlbnRyeS5maW5hbGx5TG9jKTt9IGVsc2UgaWYgKGhhc0NhdGNoKSB7aWYgKHRoaXMucHJldiA8IGVudHJ5LmNhdGNoTG9jKSByZXR1cm4gaGFuZGxlKGVudHJ5LmNhdGNoTG9jLCAhMCk7fSBlbHNlIHtpZiAoIWhhc0ZpbmFsbHkpIHRocm93IG5ldyBFcnJvcigidHJ5IHN0YXRlbWVudCB3aXRob3V0IGNhdGNoIG9yIGZpbmFsbHkiKTtpZiAodGhpcy5wcmV2IDwgZW50cnkuZmluYWxseUxvYykgcmV0dXJuIGhhbmRsZShlbnRyeS5maW5hbGx5TG9jKTt9fX19LCBhYnJ1cHQ6IGZ1bmN0aW9uIGFicnVwdCh0eXBlLCBhcmcpIHtmb3IgKHZhciBpID0gdGhpcy50cnlFbnRyaWVzLmxlbmd0aCAtIDE7IGkgPj0gMDsgLS1pKSB7dmFyIGVudHJ5ID0gdGhpcy50cnlFbnRyaWVzW2ldO2lmIChlbnRyeS50cnlMb2MgPD0gdGhpcy5wcmV2ICYmIGhhc093bi5jYWxsKGVudHJ5LCAiZmluYWxseUxvYyIpICYmIHRoaXMucHJldiA8IGVudHJ5LmZpbmFsbHlMb2MpIHt2YXIgZmluYWxseUVudHJ5ID0gZW50cnk7YnJlYWs7fX1maW5hbGx5RW50cnkgJiYgKCJicmVhayIgPT09IHR5cGUgfHwgImNvbnRpbnVlIiA9PT0gdHlwZSkgJiYgZmluYWxseUVudHJ5LnRyeUxvYyA8PSBhcmcgJiYgYXJnIDw9IGZpbmFsbHlFbnRyeS5maW5hbGx5TG9jICYmIChmaW5hbGx5RW50cnkgPSBudWxsKTt2YXIgcmVjb3JkID0gZmluYWxseUVudHJ5ID8gZmluYWxseUVudHJ5LmNvbXBsZXRpb24gOiB7fTtyZXR1cm4gcmVjb3JkLnR5cGUgPSB0eXBlLCByZWNvcmQuYXJnID0gYXJnLCBmaW5hbGx5RW50cnkgPyAodGhpcy5tZXRob2QgPSAibmV4dCIsIHRoaXMubmV4dCA9IGZpbmFsbHlFbnRyeS5maW5hbGx5TG9jLCBDb250aW51ZVNlbnRpbmVsKSA6IHRoaXMuY29tcGxldGUocmVjb3JkKTt9LCBjb21wbGV0ZTogZnVuY3Rpb24gY29tcGxldGUocmVjb3JkLCBhZnRlckxvYykge2lmICgidGhyb3ciID09PSByZWNvcmQudHlwZSkgdGhyb3cgcmVjb3JkLmFyZztyZXR1cm4gImJyZWFrIiA9PT0gcmVjb3JkLnR5cGUgfHwgImNvbnRpbnVlIiA9PT0gcmVjb3JkLnR5cGUgPyB0aGlzLm5leHQgPSByZWNvcmQuYXJnIDogInJldHVybiIgPT09IHJlY29yZC50eXBlID8gKHRoaXMucnZhbCA9IHRoaXMuYXJnID0gcmVjb3JkLmFyZywgdGhpcy5tZXRob2QgPSAicmV0dXJuIiwgdGhpcy5uZXh0ID0gImVuZCIpIDogIm5vcm1hbCIgPT09IHJlY29yZC50eXBlICYmIGFmdGVyTG9jICYmICh0aGlzLm5leHQgPSBhZnRlckxvYyksIENvbnRpbnVlU2VudGluZWw7fSwgZmluaXNoOiBmdW5jdGlvbiBmaW5pc2goZmluYWxseUxvYykge2ZvciAodmFyIGkgPSB0aGlzLnRyeUVudHJpZXMubGVuZ3RoIC0gMTsgaSA+PSAwOyAtLWkpIHt2YXIgZW50cnkgPSB0aGlzLnRyeUVudHJpZXNbaV07aWYgKGVudHJ5LmZpbmFsbHlMb2MgPT09IGZpbmFsbHlMb2MpIHJldHVybiB0aGlzLmNvbXBsZXRlKGVudHJ5LmNvbXBsZXRpb24sIGVudHJ5LmFmdGVyTG9jKSwgcmVzZXRUcnlFbnRyeShlbnRyeSksIENvbnRpbnVlU2VudGluZWw7fX0sIGNhdGNoOiBmdW5jdGlvbiBfY2F0Y2godHJ5TG9jKSB7Zm9yICh2YXIgaSA9IHRoaXMudHJ5RW50cmllcy5sZW5ndGggLSAxOyBpID49IDA7IC0taSkge3ZhciBlbnRyeSA9IHRoaXMudHJ5RW50cmllc1tpXTtpZiAoZW50cnkudHJ5TG9jID09PSB0cnlMb2MpIHt2YXIgcmVjb3JkID0gZW50cnkuY29tcGxldGlvbjtpZiAoInRocm93IiA9PT0gcmVjb3JkLnR5cGUpIHt2YXIgdGhyb3duID0gcmVjb3JkLmFyZztyZXNldFRyeUVudHJ5KGVudHJ5KTt9cmV0dXJuIHRocm93bjt9fXRocm93IG5ldyBFcnJvcigiaWxsZWdhbCBjYXRjaCBhdHRlbXB0Iik7fSwgZGVsZWdhdGVZaWVsZDogZnVuY3Rpb24gZGVsZWdhdGVZaWVsZChpdGVyYWJsZSwgcmVzdWx0TmFtZSwgbmV4dExvYykge3JldHVybiB0aGlzLmRlbGVnYXRlID0geyBpdGVyYXRvcjogdmFsdWVzKGl0ZXJhYmxlKSwgcmVzdWx0TmFtZTogcmVzdWx0TmFtZSwgbmV4dExvYzogbmV4dExvYyB9LCAibmV4dCIgPT09IHRoaXMubWV0aG9kICYmICh0aGlzLmFyZyA9IHVuZGVmaW5lZCksIENvbnRpbnVlU2VudGluZWw7fSB9LCBleHBvcnRzO31mdW5jdGlvbiBhc3luY0dlbmVyYXRvclN0ZXAoZ2VuLCByZXNvbHZlLCByZWplY3QsIF9uZXh0LCBfdGhyb3csIGtleSwgYXJnKSB7dHJ5IHt2YXIgaW5mbyA9IGdlbltrZXldKGFyZyk7dmFyIHZhbHVlID0gaW5mby52YWx1ZTt9IGNhdGNoIChlcnJvcikge3JlamVjdChlcnJvcik7cmV0dXJuO31pZiAoaW5mby5kb25lKSB7cmVzb2x2ZSh2YWx1ZSk7fSBlbHNlIHtQcm9taXNlLnJlc29sdmUodmFsdWUpLnRoZW4oX25leHQsIF90aHJvdyk7fX1mdW5jdGlvbiBfYXN5bmNUb0dlbmVyYXRvcjIoZm4pIHtyZXR1cm4gZnVuY3Rpb24gKCkge3ZhciBzZWxmID0gdGhpcyxhcmdzID0gYXJndW1lbnRzO3JldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7dmFyIGdlbiA9IGZuLmFwcGx5KHNlbGYsIGFyZ3MpO2Z1bmN0aW9uIF9uZXh0KHZhbHVlKSB7YXN5bmNHZW5lcmF0b3JTdGVwKGdlbiwgcmVzb2x2ZSwgcmVqZWN0LCBfbmV4dCwgX3Rocm93LCAibmV4dCIsIHZhbHVlKTt9ZnVuY3Rpb24gX3Rocm93KGVycikge2FzeW5jR2VuZXJhdG9yU3RlcChnZW4sIHJlc29sdmUsIHJlamVjdCwgX25leHQsIF90aHJvdywgInRocm93IiwgZXJyKTt9X25leHQodW5kZWZpbmVkKTt9KTt9O31mdW5jdGlvbiBfZGVmaW5lUHJvcGVydHkyKG9iaiwga2V5LCB2YWx1ZSkge2tleSA9IF90b1Byb3BlcnR5S2V5MihrZXkpO2lmIChrZXkgaW4gb2JqKSB7T2JqZWN0LmRlZmluZVByb3BlcnR5KG9iaiwga2V5LCB7IHZhbHVlOiB2YWx1ZSwgZW51bWVyYWJsZTogdHJ1ZSwgY29uZmlndXJhYmxlOiB0cnVlLCB3cml0YWJsZTogdHJ1ZSB9KTt9IGVsc2Uge29ialtrZXldID0gdmFsdWU7fXJldHVybiBvYmo7fWZ1bmN0aW9uIF9kZWZpbmVQcm9wZXJ0aWVzKHRhcmdldCwgcHJvcHMpIHtmb3IgKHZhciBpID0gMDsgaSA8IHByb3BzLmxlbmd0aDsgaSsrKSB7dmFyIGRlc2NyaXB0b3IgPSBwcm9wc1tpXTtkZXNjcmlwdG9yLmVudW1lcmFibGUgPSBkZXNjcmlwdG9yLmVudW1lcmFibGUgfHwgZmFsc2U7ZGVzY3JpcHRvci5jb25maWd1cmFibGUgPSB0cnVlO2lmICgidmFsdWUiIGluIGRlc2NyaXB0b3IpIGRlc2NyaXB0b3Iud3JpdGFibGUgPSB0cnVlO09iamVjdC5kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIF90b1Byb3BlcnR5S2V5MihkZXNjcmlwdG9yLmtleSksIGRlc2NyaXB0b3IpO319ZnVuY3Rpb24gX2NyZWF0ZUNsYXNzMihDb25zdHJ1Y3RvciwgcHJvdG9Qcm9wcywgc3RhdGljUHJvcHMpIHtpZiAocHJvdG9Qcm9wcykgX2RlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IucHJvdG90eXBlLCBwcm90b1Byb3BzKTtpZiAoc3RhdGljUHJvcHMpIF9kZWZpbmVQcm9wZXJ0aWVzKENvbnN0cnVjdG9yLCBzdGF0aWNQcm9wcyk7T2JqZWN0LmRlZmluZVByb3BlcnR5KENvbnN0cnVjdG9yLCAicHJvdG90eXBlIiwgeyB3cml0YWJsZTogZmFsc2UgfSk7cmV0dXJuIENvbnN0cnVjdG9yO31mdW5jdGlvbiBfdG9Qcm9wZXJ0eUtleTIoYXJnKSB7dmFyIGtleSA9IF90b1ByaW1pdGl2ZTIoYXJnLCAic3RyaW5nIik7cmV0dXJuIHR5cGVvZiBrZXkgPT09ICJzeW1ib2wiID8ga2V5IDogU3RyaW5nKGtleSk7fWZ1bmN0aW9uIF90b1ByaW1pdGl2ZTIoaW5wdXQsIGhpbnQpIHtpZiAodHlwZW9mIGlucHV0ICE9PSAib2JqZWN0IiB8fCBpbnB1dCA9PT0gbnVsbCkgcmV0dXJuIGlucHV0O3ZhciBwcmltID0gaW5wdXRbU3ltYm9sLnRvUHJpbWl0aXZlXTtpZiAocHJpbSAhPT0gdW5kZWZpbmVkKSB7dmFyIHJlcyA9IHByaW0uY2FsbChpbnB1dCwgaGludCB8fCAiZGVmYXVsdCIpO2lmICh0eXBlb2YgcmVzICE9PSAib2JqZWN0IikgcmV0dXJuIHJlczt0aHJvdyBuZXcgVHlwZUVycm9yKCJAQHRvUHJpbWl0aXZlIG11c3QgcmV0dXJuIGEgcHJpbWl0aXZlIHZhbHVlLiIpO31yZXR1cm4gKGhpbnQgPT09ICJzdHJpbmciID8gU3RyaW5nIDogTnVtYmVyKShpbnB1dCk7fWZ1bmN0aW9uIF9jbGFzc0NhbGxDaGVjazIoaW5zdGFuY2UsIENvbnN0cnVjdG9yKSB7aWYgKCEoaW5zdGFuY2UgaW5zdGFuY2VvZiBDb25zdHJ1Y3RvcikpIHt0aHJvdyBuZXcgVHlwZUVycm9yKCJDYW5ub3QgY2FsbCBhIGNsYXNzIGFzIGEgZnVuY3Rpb24iKTt9fWZ1bmN0aW9uIF9pbmhlcml0cyhzdWJDbGFzcywgc3VwZXJDbGFzcykge2lmICh0eXBlb2Ygc3VwZXJDbGFzcyAhPT0gImZ1bmN0aW9uIiAmJiBzdXBlckNsYXNzICE9PSBudWxsKSB7dGhyb3cgbmV3IFR5cGVFcnJvcigiU3VwZXIgZXhwcmVzc2lvbiBtdXN0IGVpdGhlciBiZSBudWxsIG9yIGEgZnVuY3Rpb24iKTt9c3ViQ2xhc3MucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZShzdXBlckNsYXNzICYmIHN1cGVyQ2xhc3MucHJvdG90eXBlLCB7IGNvbnN0cnVjdG9yOiB7IHZhbHVlOiBzdWJDbGFzcywgd3JpdGFibGU6IHRydWUsIGNvbmZpZ3VyYWJsZTogdHJ1ZSB9IH0pO09iamVjdC5kZWZpbmVQcm9wZXJ0eShzdWJDbGFzcywgInByb3RvdHlwZSIsIHsgd3JpdGFibGU6IGZhbHNlIH0pO2lmIChzdXBlckNsYXNzKSBfc2V0UHJvdG90eXBlT2Yoc3ViQ2xhc3MsIHN1cGVyQ2xhc3MpO31mdW5jdGlvbiBfY3JlYXRlU3VwZXIoRGVyaXZlZCkge3ZhciBoYXNOYXRpdmVSZWZsZWN0Q29uc3RydWN0ID0gX2lzTmF0aXZlUmVmbGVjdENvbnN0cnVjdCgpO3JldHVybiBmdW5jdGlvbiBfY3JlYXRlU3VwZXJJbnRlcm5hbCgpIHt2YXIgU3VwZXIgPSBfZ2V0UHJvdG90eXBlT2YoRGVyaXZlZCkscmVzdWx0O2lmIChoYXNOYXRpdmVSZWZsZWN0Q29uc3RydWN0KSB7dmFyIE5ld1RhcmdldCA9IF9nZXRQcm90b3R5cGVPZih0aGlzKS5jb25zdHJ1Y3RvcjtyZXN1bHQgPSBSZWZsZWN0LmNvbnN0cnVjdChTdXBlciwgYXJndW1lbnRzLCBOZXdUYXJnZXQpO30gZWxzZSB7cmVzdWx0ID0gU3VwZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKTt9cmV0dXJuIF9wb3NzaWJsZUNvbnN0cnVjdG9yUmV0dXJuKHRoaXMsIHJlc3VsdCk7fTt9ZnVuY3Rpb24gX3Bvc3NpYmxlQ29uc3RydWN0b3JSZXR1cm4oc2VsZiwgY2FsbCkge2lmIChjYWxsICYmICh0eXBlb2YgY2FsbCA9PT0gIm9iamVjdCIgfHwgdHlwZW9mIGNhbGwgPT09ICJmdW5jdGlvbiIpKSB7cmV0dXJuIGNhbGw7fSBlbHNlIGlmIChjYWxsICE9PSB2b2lkIDApIHt0aHJvdyBuZXcgVHlwZUVycm9yKCJEZXJpdmVkIGNvbnN0cnVjdG9ycyBtYXkgb25seSByZXR1cm4gb2JqZWN0IG9yIHVuZGVmaW5lZCIpO31yZXR1cm4gX2Fzc2VydFRoaXNJbml0aWFsaXplZChzZWxmKTt9ZnVuY3Rpb24gX2Fzc2VydFRoaXNJbml0aWFsaXplZChzZWxmKSB7aWYgKHNlbGYgPT09IHZvaWQgMCkge3Rocm93IG5ldyBSZWZlcmVuY2VFcnJvcigidGhpcyBoYXNuJ3QgYmVlbiBpbml0aWFsaXNlZCAtIHN1cGVyKCkgaGFzbid0IGJlZW4gY2FsbGVkIik7fXJldHVybiBzZWxmO31mdW5jdGlvbiBfd3JhcE5hdGl2ZVN1cGVyKENsYXNzKSB7dmFyIF9jYWNoZSA9IHR5cGVvZiBNYXAgPT09ICJmdW5jdGlvbiIgPyBuZXcgTWFwKCkgOiB1bmRlZmluZWQ7X3dyYXBOYXRpdmVTdXBlciA9IGZ1bmN0aW9uIF93cmFwTmF0aXZlU3VwZXIoQ2xhc3MpIHtpZiAoQ2xhc3MgPT09IG51bGwgfHwgIV9pc05hdGl2ZUZ1bmN0aW9uKENsYXNzKSkgcmV0dXJuIENsYXNzO2lmICh0eXBlb2YgQ2xhc3MgIT09ICJmdW5jdGlvbiIpIHt0aHJvdyBuZXcgVHlwZUVycm9yKCJTdXBlciBleHByZXNzaW9uIG11c3QgZWl0aGVyIGJlIG51bGwgb3IgYSBmdW5jdGlvbiIpO31pZiAodHlwZW9mIF9jYWNoZSAhPT0gInVuZGVmaW5lZCIpIHtpZiAoX2NhY2hlLmhhcyhDbGFzcykpIHJldHVybiBfY2FjaGUuZ2V0KENsYXNzKTtfY2FjaGUuc2V0KENsYXNzLCBXcmFwcGVyKTt9ZnVuY3Rpb24gV3JhcHBlcigpIHtyZXR1cm4gX2NvbnN0cnVjdChDbGFzcywgYXJndW1lbnRzLCBfZ2V0UHJvdG90eXBlT2YodGhpcykuY29uc3RydWN0b3IpO31XcmFwcGVyLnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoQ2xhc3MucHJvdG90eXBlLCB7IGNvbnN0cnVjdG9yOiB7IHZhbHVlOiBXcmFwcGVyLCBlbnVtZXJhYmxlOiBmYWxzZSwgd3JpdGFibGU6IHRydWUsIGNvbmZpZ3VyYWJsZTogdHJ1ZSB9IH0pO3JldHVybiBfc2V0UHJvdG90eXBlT2YoV3JhcHBlciwgQ2xhc3MpO307cmV0dXJuIF93cmFwTmF0aXZlU3VwZXIoQ2xhc3MpO31mdW5jdGlvbiBfY29uc3RydWN0KFBhcmVudCwgYXJncywgQ2xhc3MpIHtpZiAoX2lzTmF0aXZlUmVmbGVjdENvbnN0cnVjdCgpKSB7X2NvbnN0cnVjdCA9IFJlZmxlY3QuY29uc3RydWN0LmJpbmQoKTt9IGVsc2Uge19jb25zdHJ1Y3QgPSBmdW5jdGlvbiBfY29uc3RydWN0KFBhcmVudCwgYXJncywgQ2xhc3MpIHt2YXIgYSA9IFtudWxsXTthLnB1c2guYXBwbHkoYSwgYXJncyk7dmFyIENvbnN0cnVjdG9yID0gRnVuY3Rpb24uYmluZC5hcHBseShQYXJlbnQsIGEpO3ZhciBpbnN0YW5jZSA9IG5ldyBDb25zdHJ1Y3RvcigpO2lmIChDbGFzcykgX3NldFByb3RvdHlwZU9mKGluc3RhbmNlLCBDbGFzcy5wcm90b3R5cGUpO3JldHVybiBpbnN0YW5jZTt9O31yZXR1cm4gX2NvbnN0cnVjdC5hcHBseShudWxsLCBhcmd1bWVudHMpO31mdW5jdGlvbiBfaXNOYXRpdmVSZWZsZWN0Q29uc3RydWN0KCkge2lmICh0eXBlb2YgUmVmbGVjdCA9PT0gInVuZGVmaW5lZCIgfHwgIVJlZmxlY3QuY29uc3RydWN0KSByZXR1cm4gZmFsc2U7aWYgKFJlZmxlY3QuY29uc3RydWN0LnNoYW0pIHJldHVybiBmYWxzZTtpZiAodHlwZW9mIFByb3h5ID09PSAiZnVuY3Rpb24iKSByZXR1cm4gdHJ1ZTt0cnkge0Jvb2xlYW4ucHJvdG90eXBlLnZhbHVlT2YuY2FsbChSZWZsZWN0LmNvbnN0cnVjdChCb29sZWFuLCBbXSwgZnVuY3Rpb24gKCkge30pKTtyZXR1cm4gdHJ1ZTt9IGNhdGNoIChlKSB7cmV0dXJuIGZhbHNlO319ZnVuY3Rpb24gX2lzTmF0aXZlRnVuY3Rpb24oZm4pIHtyZXR1cm4gRnVuY3Rpb24udG9TdHJpbmcuY2FsbChmbikuaW5kZXhPZigiW25hdGl2ZSBjb2RlXSIpICE9PSAtMTt9ZnVuY3Rpb24gX3NldFByb3RvdHlwZU9mKG8sIHApIHtfc2V0UHJvdG90eXBlT2YgPSBPYmplY3Quc2V0UHJvdG90eXBlT2YgPyBPYmplY3Quc2V0UHJvdG90eXBlT2YuYmluZCgpIDogZnVuY3Rpb24gX3NldFByb3RvdHlwZU9mKG8sIHApIHtvLl9fcHJvdG9fXyA9IHA7cmV0dXJuIG87fTtyZXR1cm4gX3NldFByb3RvdHlwZU9mKG8sIHApO31mdW5jdGlvbiBfZ2V0UHJvdG90eXBlT2Yobykge19nZXRQcm90b3R5cGVPZiA9IE9iamVjdC5zZXRQcm90b3R5cGVPZiA/IE9iamVjdC5nZXRQcm90b3R5cGVPZi5iaW5kKCkgOiBmdW5jdGlvbiBfZ2V0UHJvdG90eXBlT2Yobykge3JldHVybiBvLl9fcHJvdG9fXyB8fCBPYmplY3QuZ2V0UHJvdG90eXBlT2Yobyk7fTtyZXR1cm4gX2dldFByb3RvdHlwZU9mKG8pO31mdW5jdGlvbiBfc2xpY2VkVG9BcnJheTIoYXJyLCBpKSB7cmV0dXJuIF9hcnJheVdpdGhIb2xlczIoYXJyKSB8fCBfaXRlcmFibGVUb0FycmF5TGltaXQyKGFyciwgaSkgfHwgX3Vuc3VwcG9ydGVkSXRlcmFibGVUb0FycmF5MihhcnIsIGkpIHx8IF9ub25JdGVyYWJsZVJlc3QyKCk7fWZ1bmN0aW9uIF9pdGVyYWJsZVRvQXJyYXlMaW1pdDIoYXJyLCBpKSB7dmFyIF9pID0gbnVsbCA9PSBhcnIgPyBudWxsIDogInVuZGVmaW5lZCIgIT0gdHlwZW9mIFN5bWJvbCAmJiBhcnJbU3ltYm9sLml0ZXJhdG9yXSB8fCBhcnJbIkBAaXRlcmF0b3IiXTtpZiAobnVsbCAhPSBfaSkge3ZhciBfcyxfZSxfeCxfcixfYXJyID0gW10sX24gPSAhMCxfZCA9ICExO3RyeSB7aWYgKF94ID0gKF9pID0gX2kuY2FsbChhcnIpKS5uZXh0LCAwID09PSBpKSB7aWYgKE9iamVjdChfaSkgIT09IF9pKSByZXR1cm47X24gPSAhMTt9IGVsc2UgZm9yICg7ICEoX24gPSAoX3MgPSBfeC5jYWxsKF9pKSkuZG9uZSkgJiYgKF9hcnIucHVzaChfcy52YWx1ZSksIF9hcnIubGVuZ3RoICE9PSBpKTsgX24gPSAhMCk7fSBjYXRjaCAoZXJyKSB7X2QgPSAhMCwgX2UgPSBlcnI7fSBmaW5hbGx5IHt0cnkge2lmICghX24gJiYgbnVsbCAhPSBfaS5yZXR1cm4gJiYgKF9yID0gX2kucmV0dXJuKCksIE9iamVjdChfcikgIT09IF9yKSkgcmV0dXJuO30gZmluYWxseSB7aWYgKF9kKSB0aHJvdyBfZTt9fXJldHVybiBfYXJyO319ZnVuY3Rpb24gX3RvQXJyYXkoYXJyKSB7cmV0dXJuIF9hcnJheVdpdGhIb2xlczIoYXJyKSB8fCBfaXRlcmFibGVUb0FycmF5KGFycikgfHwgX3Vuc3VwcG9ydGVkSXRlcmFibGVUb0FycmF5MihhcnIpIHx8IF9ub25JdGVyYWJsZVJlc3QyKCk7fWZ1bmN0aW9uIF9ub25JdGVyYWJsZVJlc3QyKCkge3Rocm93IG5ldyBUeXBlRXJyb3IoIkludmFsaWQgYXR0ZW1wdCB0byBkZXN0cnVjdHVyZSBub24taXRlcmFibGUgaW5zdGFuY2UuXG5JbiBvcmRlciB0byBiZSBpdGVyYWJsZSwgbm9uLWFycmF5IG9iamVjdHMgbXVzdCBoYXZlIGEgW1N5bWJvbC5pdGVyYXRvcl0oKSBtZXRob2QuIik7fWZ1bmN0aW9uIF9hcnJheVdpdGhIb2xlczIoYXJyKSB7aWYgKEFycmF5LmlzQXJyYXkoYXJyKSkgcmV0dXJuIGFycjt9ZnVuY3Rpb24gX2NyZWF0ZUZvck9mSXRlcmF0b3JIZWxwZXIyKG8sIGFsbG93QXJyYXlMaWtlKSB7dmFyIGl0ID0gdHlwZW9mIFN5bWJvbCAhPT0gInVuZGVmaW5lZCIgJiYgb1tTeW1ib2wuaXRlcmF0b3JdIHx8IG9bIkBAaXRlcmF0b3IiXTtpZiAoIWl0KSB7aWYgKEFycmF5LmlzQXJyYXkobykgfHwgKGl0ID0gX3Vuc3VwcG9ydGVkSXRlcmFibGVUb0FycmF5MihvKSkgfHwgYWxsb3dBcnJheUxpa2UgJiYgbyAmJiB0eXBlb2Ygby5sZW5ndGggPT09ICJudW1iZXIiKSB7aWYgKGl0KSBvID0gaXQ7dmFyIGkgPSAwO3ZhciBGID0gZnVuY3Rpb24gRigpIHt9O3JldHVybiB7IHM6IEYsIG46IGZ1bmN0aW9uIG4oKSB7aWYgKGkgPj0gby5sZW5ndGgpIHJldHVybiB7IGRvbmU6IHRydWUgfTtyZXR1cm4geyBkb25lOiBmYWxzZSwgdmFsdWU6IG9baSsrXSB9O30sIGU6IGZ1bmN0aW9uIGUoX2U0KSB7dGhyb3cgX2U0O30sIGY6IEYgfTt9dGhyb3cgbmV3IFR5cGVFcnJvcigiSW52YWxpZCBhdHRlbXB0IHRvIGl0ZXJhdGUgbm9uLWl0ZXJhYmxlIGluc3RhbmNlLlxuSW4gb3JkZXIgdG8gYmUgaXRlcmFibGUsIG5vbi1hcnJheSBvYmplY3RzIG11c3QgaGF2ZSBhIFtTeW1ib2wuaXRlcmF0b3JdKCkgbWV0aG9kLiIpO312YXIgbm9ybWFsQ29tcGxldGlvbiA9IHRydWUsZGlkRXJyID0gZmFsc2UsZXJyO3JldHVybiB7IHM6IGZ1bmN0aW9uIHMoKSB7aXQgPSBpdC5jYWxsKG8pO30sIG46IGZ1bmN0aW9uIG4oKSB7dmFyIHN0ZXAgPSBpdC5uZXh0KCk7bm9ybWFsQ29tcGxldGlvbiA9IHN0ZXAuZG9uZTtyZXR1cm4gc3RlcDt9LCBlOiBmdW5jdGlvbiBlKF9lNSkge2RpZEVyciA9IHRydWU7ZXJyID0gX2U1O30sIGY6IGZ1bmN0aW9uIGYoKSB7dHJ5IHtpZiAoIW5vcm1hbENvbXBsZXRpb24gJiYgaXQucmV0dXJuICE9IG51bGwpIGl0LnJldHVybigpO30gZmluYWxseSB7aWYgKGRpZEVycikgdGhyb3cgZXJyO319IH07fWZ1bmN0aW9uIF90b0NvbnN1bWFibGVBcnJheShhcnIpIHtyZXR1cm4gX2FycmF5V2l0aG91dEhvbGVzKGFycikgfHwgX2l0ZXJhYmxlVG9BcnJheShhcnIpIHx8IF91bnN1cHBvcnRlZEl0ZXJhYmxlVG9BcnJheTIoYXJyKSB8fCBfbm9uSXRlcmFibGVTcHJlYWQoKTt9ZnVuY3Rpb24gX25vbkl0ZXJhYmxlU3ByZWFkKCkge3Rocm93IG5ldyBUeXBlRXJyb3IoIkludmFsaWQgYXR0ZW1wdCB0byBzcHJlYWQgbm9uLWl0ZXJhYmxlIGluc3RhbmNlLlxuSW4gb3JkZXIgdG8gYmUgaXRlcmFibGUsIG5vbi1hcnJheSBvYmplY3RzIG11c3QgaGF2ZSBhIFtTeW1ib2wuaXRlcmF0b3JdKCkgbWV0aG9kLiIpO31mdW5jdGlvbiBfdW5zdXBwb3J0ZWRJdGVyYWJsZVRvQXJyYXkyKG8sIG1pbkxlbikge2lmICghbykgcmV0dXJuO2lmICh0eXBlb2YgbyA9PT0gInN0cmluZyIpIHJldHVybiBfYXJyYXlMaWtlVG9BcnJheTIobywgbWluTGVuKTt2YXIgbiA9IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChvKS5zbGljZSg4LCAtMSk7aWYgKG4gPT09ICJPYmplY3QiICYmIG8uY29uc3RydWN0b3IpIG4gPSBvLmNvbnN0cnVjdG9yLm5hbWU7aWYgKG4gPT09ICJNYXAiIHx8IG4gPT09ICJTZXQiKSByZXR1cm4gQXJyYXkuZnJvbShvKTtpZiAobiA9PT0gIkFyZ3VtZW50cyIgfHwgL14oPzpVaXxJKW50KD86OHwxNnwzMikoPzpDbGFtcGVkKT9BcnJheSQvLnRlc3QobikpIHJldHVybiBfYXJyYXlMaWtlVG9BcnJheTIobywgbWluTGVuKTt9ZnVuY3Rpb24gX2l0ZXJhYmxlVG9BcnJheShpdGVyKSB7aWYgKHR5cGVvZiBTeW1ib2wgIT09ICJ1bmRlZmluZWQiICYmIGl0ZXJbU3ltYm9sLml0ZXJhdG9yXSAhPSBudWxsIHx8IGl0ZXJbIkBAaXRlcmF0b3IiXSAhPSBudWxsKSByZXR1cm4gQXJyYXkuZnJvbShpdGVyKTt9ZnVuY3Rpb24gX2FycmF5V2l0aG91dEhvbGVzKGFycikge2lmIChBcnJheS5pc0FycmF5KGFycikpIHJldHVybiBfYXJyYXlMaWtlVG9BcnJheTIoYXJyKTt9ZnVuY3Rpb24gX2FycmF5TGlrZVRvQXJyYXkyKGFyciwgbGVuKSB7aWYgKGxlbiA9PSBudWxsIHx8IGxlbiA+IGFyci5sZW5ndGgpIGxlbiA9IGFyci5sZW5ndGg7Zm9yICh2YXIgaSA9IDAsIGFycjIgPSBuZXcgQXJyYXkobGVuKTsgaSA8IGxlbjsgaSsrKSBhcnIyW2ldID0gYXJyW2ldO3JldHVybiBhcnIyO30oZnVuY3Rpb24gd2VicGFja1VuaXZlcnNhbE1vZHVsZURlZmluaXRpb24ocm9vdCwgZmFjdG9yeSkge2lmICh0eXBlb2YgZXhwb3J0cyA9PT0gJ29iamVjdCcgJiYgdHlwZW9mIG1vZHVsZSA9PT0gJ29iamVjdCcpCiAgbW9kdWxlLmV4cG9ydHMgPSBmYWN0b3J5KCk7ZWxzZQogIGlmICh0eXBlb2YgZGVmaW5lID09PSAnZnVuY3Rpb24nICYmIGRlZmluZS5hbWQpCiAgZGVmaW5lKFtdLCBmYWN0b3J5KTtlbHNlCiAgewogICAgdmFyIGEgPSBmYWN0b3J5KCk7CiAgICBmb3IgKHZhciBpIGluIGEpICh0eXBlb2YgZXhwb3J0cyA9PT0gJ29iamVjdCcgPyBleHBvcnRzIDogcm9vdClbaV0gPSBhW2ldOwogIH0KfSkoc2VsZiwgKCkgPT4gewogIHJldHVybiAoLyoqKioqKi8oKCkgPT4gey8vIHdlYnBhY2tCb290c3RyYXAKICAgICAgLyoqKioqKi8idXNlIHN0cmljdCI7CiAgICAgIC8qKioqKiovdmFyIF9fd2VicGFja19tb2R1bGVzX18gPSB7CgogICAgICAgIC8qKiovMjQyOgogICAgICAgIC8qKiovKF9fdW51c2VkX3dlYnBhY2tfbW9kdWxlLCBfX3dlYnBhY2tfZXhwb3J0c19fLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSA9PiB7CgoKICAgICAgICAgIC8vIEVYUE9SVFMKICAgICAgICAgIF9fd2VicGFja19yZXF1aXJlX18uZChfX3dlYnBhY2tfZXhwb3J0c19fLCB7CiAgICAgICAgICAgICJaIjogKCkgPT4gLyogYmluZGluZyAqL3JlbGF5X0FwcAogICAgICAgICAgfSk7CgogICAgICAgICAgOyAvLyBDT05DQVRFTkFURUQgTU9EVUxFOiAuL25vZGVfbW9kdWxlcy9AcmVtaXgtcnVuL3JvdXRlci9kaXN0L3JvdXRlci5qcwogICAgICAgICAgLyoqCiAgICAgICAgICAgKiBAcmVtaXgtcnVuL3JvdXRlciB2MS4zLjAKICAgICAgICAgICAqCiAgICAgICAgICAgKiBDb3B5cmlnaHQgKGMpIFJlbWl4IFNvZnR3YXJlIEluYy4KICAgICAgICAgICAqCiAgICAgICAgICAgKiBUaGlzIHNvdXJjZSBjb2RlIGlzIGxpY2Vuc2VkIHVuZGVyIHRoZSBNSVQgbGljZW5zZSBmb3VuZCBpbiB0aGUKICAgICAgICAgICAqIExJQ0VOU0UubWQgZmlsZSBpbiB0aGUgcm9vdCBkaXJlY3Rvcnkgb2YgdGhpcyBzb3VyY2UgdHJlZS4KICAgICAgICAgICAqCiAgICAgICAgICAgKiBAbGljZW5zZSBNSVQKICAgICAgICAgICAqLwogICAgICAgICAgZnVuY3Rpb24gX2V4dGVuZHMoKSB7CiAgICAgICAgICAgIF9leHRlbmRzID0gT2JqZWN0LmFzc2lnbiA/IE9iamVjdC5hc3NpZ24uYmluZCgpIDogZnVuY3Rpb24gKHRhcmdldCkgewogICAgICAgICAgICAgIGZvciAodmFyIGkgPSAxOyBpIDwgYXJndW1lbnRzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAgICB2YXIgc291cmNlID0gYXJndW1lbnRzW2ldOwoKICAgICAgICAgICAgICAgIGZvciAodmFyIGtleSBpbiBzb3VyY2UpIHsKICAgICAgICAgICAgICAgICAgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChzb3VyY2UsIGtleSkpIHsKICAgICAgICAgICAgICAgICAgICB0YXJnZXRba2V5XSA9IHNvdXJjZVtrZXldOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICByZXR1cm4gdGFyZ2V0OwogICAgICAgICAgICB9OwogICAgICAgICAgICByZXR1cm4gX2V4dGVuZHMuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgICAgIH0KCiAgICAgICAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwogICAgICAgICAgLy8jcmVnaW9uIFR5cGVzIGFuZCBDb25zdGFudHMKICAgICAgICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCgogICAgICAgICAgLyoqCiAgICAgICAgICAgKiBBY3Rpb25zIHJlcHJlc2VudCB0aGUgdHlwZSBvZiBjaGFuZ2UgdG8gYSBsb2NhdGlvbiB2YWx1ZS4KICAgICAgICAgICAqLwogICAgICAgICAgdmFyIEFjdGlvbjsKCiAgICAgICAgICAoZnVuY3Rpb24gKEFjdGlvbikgewogICAgICAgICAgICAvKioKICAgICAgICAgICAgICogQSBQT1AgaW5kaWNhdGVzIGEgY2hhbmdlIHRvIGFuIGFyYml0cmFyeSBpbmRleCBpbiB0aGUgaGlzdG9yeSBzdGFjaywgc3VjaAogICAgICAgICAgICAgKiBhcyBhIGJhY2sgb3IgZm9yd2FyZCBuYXZpZ2F0aW9uLiBJdCBkb2VzIG5vdCBkZXNjcmliZSB0aGUgZGlyZWN0aW9uIG9mIHRoZQogICAgICAgICAgICAgKiBuYXZpZ2F0aW9uLCBvbmx5IHRoYXQgdGhlIGN1cnJlbnQgaW5kZXggY2hhbmdlZC4KICAgICAgICAgICAgICoKICAgICAgICAgICAgICogTm90ZTogVGhpcyBpcyB0aGUgZGVmYXVsdCBhY3Rpb24gZm9yIG5ld2x5IGNyZWF0ZWQgaGlzdG9yeSBvYmplY3RzLgogICAgICAgICAgICAgKi8KICAgICAgICAgICAgQWN0aW9uWyJQb3AiXSA9ICJQT1AiOwogICAgICAgICAgICAvKioKICAgICAgICAgICAgICogQSBQVVNIIGluZGljYXRlcyBhIG5ldyBlbnRyeSBiZWluZyBhZGRlZCB0byB0aGUgaGlzdG9yeSBzdGFjaywgc3VjaCBhcyB3aGVuCiAgICAgICAgICAgICAqIGEgbGluayBpcyBjbGlja2VkIGFuZCBhIG5ldyBwYWdlIGxvYWRzLiBXaGVuIHRoaXMgaGFwcGVucywgYWxsIHN1YnNlcXVlbnQKICAgICAgICAgICAgICogZW50cmllcyBpbiB0aGUgc3RhY2sgYXJlIGxvc3QuCiAgICAgICAgICAgICAqLwoKICAgICAgICAgICAgQWN0aW9uWyJQdXNoIl0gPSAiUFVTSCI7CiAgICAgICAgICAgIC8qKgogICAgICAgICAgICAgKiBBIFJFUExBQ0UgaW5kaWNhdGVzIHRoZSBlbnRyeSBhdCB0aGUgY3VycmVudCBpbmRleCBpbiB0aGUgaGlzdG9yeSBzdGFjawogICAgICAgICAgICAgKiBiZWluZyByZXBsYWNlZCBieSBhIG5ldyBvbmUuCiAgICAgICAgICAgICAqLwoKICAgICAgICAgICAgQWN0aW9uWyJSZXBsYWNlIl0gPSAiUkVQTEFDRSI7CiAgICAgICAgICB9KShBY3Rpb24gfHwgKEFjdGlvbiA9IHt9KSk7CgogICAgICAgICAgdmFyIFBvcFN0YXRlRXZlbnRUeXBlID0gInBvcHN0YXRlIjsKICAgICAgICAgIC8qKgogICAgICAgICAgICogTWVtb3J5IGhpc3Rvcnkgc3RvcmVzIHRoZSBjdXJyZW50IGxvY2F0aW9uIGluIG1lbW9yeS4gSXQgaXMgZGVzaWduZWQgZm9yIHVzZQogICAgICAgICAgICogaW4gc3RhdGVmdWwgbm9uLWJyb3dzZXIgZW52aXJvbm1lbnRzIGxpa2UgdGVzdHMgYW5kIFJlYWN0IE5hdGl2ZS4KICAgICAgICAgICAqLwoKICAgICAgICAgIGZ1bmN0aW9uIHJvdXRlcl9jcmVhdGVNZW1vcnlIaXN0b3J5KG9wdGlvbnMpIHsKICAgICAgICAgICAgaWYgKG9wdGlvbnMgPT09IHZvaWQgMCkgewogICAgICAgICAgICAgIG9wdGlvbnMgPSB7fTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdmFyIF9vcHRpb25zID0KCgoKICAgICAgICAgICAgICBvcHRpb25zLF9vcHRpb25zJGluaXRpYWxFbnRyaSA9IF9vcHRpb25zLmluaXRpYWxFbnRyaWVzLGluaXRpYWxFbnRyaWVzID0gX29wdGlvbnMkaW5pdGlhbEVudHJpID09PSB2b2lkIDAgPyBbIi8iXSA6IF9vcHRpb25zJGluaXRpYWxFbnRyaSxpbml0aWFsSW5kZXggPSBfb3B0aW9ucy5pbml0aWFsSW5kZXgsX29wdGlvbnMkdjVDb21wYXQgPSBfb3B0aW9ucy52NUNvbXBhdCx2NUNvbXBhdCA9IF9vcHRpb25zJHY1Q29tcGF0ID09PSB2b2lkIDAgPyBmYWxzZSA6IF9vcHRpb25zJHY1Q29tcGF0OwogICAgICAgICAgICB2YXIgZW50cmllczsgLy8gRGVjbGFyZSBzbyB3ZSBjYW4gYWNjZXNzIGZyb20gY3JlYXRlTWVtb3J5TG9jYXRpb24KCiAgICAgICAgICAgIGVudHJpZXMgPSBpbml0aWFsRW50cmllcy5tYXAoKGVudHJ5LCBpbmRleCkgPT4gY3JlYXRlTWVtb3J5TG9jYXRpb24oZW50cnksIHR5cGVvZiBlbnRyeSA9PT0gInN0cmluZyIgPyBudWxsIDogZW50cnkuc3RhdGUsIGluZGV4ID09PSAwID8gImRlZmF1bHQiIDogdW5kZWZpbmVkKSk7CiAgICAgICAgICAgIHZhciBpbmRleCA9IGNsYW1wSW5kZXgoaW5pdGlhbEluZGV4ID09IG51bGwgPyBlbnRyaWVzLmxlbmd0aCAtIDEgOiBpbml0aWFsSW5kZXgpOwogICAgICAgICAgICB2YXIgYWN0aW9uID0gQWN0aW9uLlBvcDsKICAgICAgICAgICAgdmFyIGxpc3RlbmVyID0gbnVsbDsKCiAgICAgICAgICAgIGZ1bmN0aW9uIGNsYW1wSW5kZXgobikgewogICAgICAgICAgICAgIHJldHVybiBNYXRoLm1pbihNYXRoLm1heChuLCAwKSwgZW50cmllcy5sZW5ndGggLSAxKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgZnVuY3Rpb24gZ2V0Q3VycmVudExvY2F0aW9uKCkgewogICAgICAgICAgICAgIHJldHVybiBlbnRyaWVzW2luZGV4XTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgZnVuY3Rpb24gY3JlYXRlTWVtb3J5TG9jYXRpb24odG8sIHN0YXRlLCBrZXkpIHsKICAgICAgICAgICAgICBpZiAoc3RhdGUgPT09IHZvaWQgMCkgewogICAgICAgICAgICAgICAgc3RhdGUgPSBudWxsOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgdmFyIGxvY2F0aW9uID0gY3JlYXRlTG9jYXRpb24oZW50cmllcyA/IGdldEN1cnJlbnRMb2NhdGlvbigpLnBhdGhuYW1lIDogIi8iLCB0bywgc3RhdGUsIGtleSk7CiAgICAgICAgICAgICAgd2FybmluZyQxKGxvY2F0aW9uLnBhdGhuYW1lLmNoYXJBdCgwKSA9PT0gIi8iLCAicmVsYXRpdmUgcGF0aG5hbWVzIGFyZSBub3Qgc3VwcG9ydGVkIGluIG1lbW9yeSBoaXN0b3J5OiAiICsgSlNPTi5zdHJpbmdpZnkodG8pKTsKICAgICAgICAgICAgICByZXR1cm4gbG9jYXRpb247CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGZ1bmN0aW9uIGNyZWF0ZUhyZWYodG8pIHsKICAgICAgICAgICAgICByZXR1cm4gdHlwZW9mIHRvID09PSAic3RyaW5nIiA/IHRvIDogcm91dGVyX2NyZWF0ZVBhdGgodG8pOwogICAgICAgICAgICB9CgogICAgICAgICAgICB2YXIgaGlzdG9yeSA9IHsKICAgICAgICAgICAgICBnZXQgaW5kZXgoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gaW5kZXg7CiAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgZ2V0IGFjdGlvbigpIHsKICAgICAgICAgICAgICAgIHJldHVybiBhY3Rpb247CiAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgZ2V0IGxvY2F0aW9uKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIGdldEN1cnJlbnRMb2NhdGlvbigpOwogICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgIGNyZWF0ZUhyZWY6IGNyZWF0ZUhyZWYsCgogICAgICAgICAgICAgIGNyZWF0ZVVSTDogZnVuY3Rpb24gY3JlYXRlVVJMKHRvKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IFVSTChjcmVhdGVIcmVmKHRvKSwgImh0dHA6Ly9sb2NhbGhvc3QiKTsKICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICBlbmNvZGVMb2NhdGlvbjogZnVuY3Rpb24gZW5jb2RlTG9jYXRpb24odG8pIHsKICAgICAgICAgICAgICAgIHZhciBwYXRoID0gdHlwZW9mIHRvID09PSAic3RyaW5nIiA/IHBhcnNlUGF0aCh0bykgOiB0bzsKICAgICAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICAgIHBhdGhuYW1lOiBwYXRoLnBhdGhuYW1lIHx8ICIiLAogICAgICAgICAgICAgICAgICBzZWFyY2g6IHBhdGguc2VhcmNoIHx8ICIiLAogICAgICAgICAgICAgICAgICBoYXNoOiBwYXRoLmhhc2ggfHwgIiIKICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgcHVzaDogZnVuY3Rpb24gcHVzaCh0bywgc3RhdGUpIHsKICAgICAgICAgICAgICAgIGFjdGlvbiA9IEFjdGlvbi5QdXNoOwogICAgICAgICAgICAgICAgdmFyIG5leHRMb2NhdGlvbiA9IGNyZWF0ZU1lbW9yeUxvY2F0aW9uKHRvLCBzdGF0ZSk7CiAgICAgICAgICAgICAgICBpbmRleCArPSAxOwogICAgICAgICAgICAgICAgZW50cmllcy5zcGxpY2UoaW5kZXgsIGVudHJpZXMubGVuZ3RoLCBuZXh0TG9jYXRpb24pOwoKICAgICAgICAgICAgICAgIGlmICh2NUNvbXBhdCAmJiBsaXN0ZW5lcikgewogICAgICAgICAgICAgICAgICBsaXN0ZW5lcih7CiAgICAgICAgICAgICAgICAgICAgYWN0aW9uOiBhY3Rpb24sCiAgICAgICAgICAgICAgICAgICAgbG9jYXRpb246IG5leHRMb2NhdGlvbiwKICAgICAgICAgICAgICAgICAgICBkZWx0YTogMQogICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICByZXBsYWNlOiBmdW5jdGlvbiByZXBsYWNlKHRvLCBzdGF0ZSkgewogICAgICAgICAgICAgICAgYWN0aW9uID0gQWN0aW9uLlJlcGxhY2U7CiAgICAgICAgICAgICAgICB2YXIgbmV4dExvY2F0aW9uID0gY3JlYXRlTWVtb3J5TG9jYXRpb24odG8sIHN0YXRlKTsKICAgICAgICAgICAgICAgIGVudHJpZXNbaW5kZXhdID0gbmV4dExvY2F0aW9uOwoKICAgICAgICAgICAgICAgIGlmICh2NUNvbXBhdCAmJiBsaXN0ZW5lcikgewogICAgICAgICAgICAgICAgICBsaXN0ZW5lcih7CiAgICAgICAgICAgICAgICAgICAgYWN0aW9uOiBhY3Rpb24sCiAgICAgICAgICAgICAgICAgICAgbG9jYXRpb246IG5leHRMb2NhdGlvbiwKICAgICAgICAgICAgICAgICAgICBkZWx0YTogMAogICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICBnbzogZnVuY3Rpb24gZ28oZGVsdGEpIHsKICAgICAgICAgICAgICAgIGFjdGlvbiA9IEFjdGlvbi5Qb3A7CiAgICAgICAgICAgICAgICB2YXIgbmV4dEluZGV4ID0gY2xhbXBJbmRleChpbmRleCArIGRlbHRhKTsKICAgICAgICAgICAgICAgIHZhciBuZXh0TG9jYXRpb24gPSBlbnRyaWVzW25leHRJbmRleF07CiAgICAgICAgICAgICAgICBpbmRleCA9IG5leHRJbmRleDsKCiAgICAgICAgICAgICAgICBpZiAobGlzdGVuZXIpIHsKICAgICAgICAgICAgICAgICAgbGlzdGVuZXIoewogICAgICAgICAgICAgICAgICAgIGFjdGlvbjogYWN0aW9uLAogICAgICAgICAgICAgICAgICAgIGxvY2F0aW9uOiBuZXh0TG9jYXRpb24sCiAgICAgICAgICAgICAgICAgICAgZGVsdGE6IGRlbHRhCiAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgIGxpc3RlbjogZnVuY3Rpb24gbGlzdGVuKGZuKSB7CiAgICAgICAgICAgICAgICBsaXN0ZW5lciA9IGZuOwogICAgICAgICAgICAgICAgcmV0dXJuICgpID0+IHsKICAgICAgICAgICAgICAgICAgbGlzdGVuZXIgPSBudWxsOwogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICB9OwogICAgICAgICAgICByZXR1cm4gaGlzdG9yeTsKICAgICAgICAgIH0KICAgICAgICAgIC8qKgogICAgICAgICAgICogQnJvd3NlciBoaXN0b3J5IHN0b3JlcyB0aGUgbG9jYXRpb24gaW4gcmVndWxhciBVUkxzLiBUaGlzIGlzIHRoZSBzdGFuZGFyZCBmb3IKICAgICAgICAgICAqIG1vc3Qgd2ViIGFwcHMsIGJ1dCBpdCByZXF1aXJlcyBzb21lIGNvbmZpZ3VyYXRpb24gb24gdGhlIHNlcnZlciB0byBlbnN1cmUgeW91CiAgICAgICAgICAgKiBzZXJ2ZSB0aGUgc2FtZSBhcHAgYXQgbXVsdGlwbGUgVVJMcy4KICAgICAgICAgICAqCiAgICAgICAgICAgKiBAc2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9yZW1peC1ydW4vaGlzdG9yeS90cmVlL21haW4vZG9jcy9hcGktcmVmZXJlbmNlLm1kI2NyZWF0ZWJyb3dzZXJoaXN0b3J5CiAgICAgICAgICAgKi8KCiAgICAgICAgICBmdW5jdGlvbiByb3V0ZXJfY3JlYXRlQnJvd3Nlckhpc3Rvcnkob3B0aW9ucykgewogICAgICAgICAgICBpZiAob3B0aW9ucyA9PT0gdm9pZCAwKSB7CiAgICAgICAgICAgICAgb3B0aW9ucyA9IHt9OwogICAgICAgICAgICB9CgogICAgICAgICAgICBmdW5jdGlvbiBjcmVhdGVCcm93c2VyTG9jYXRpb24od2luZG93LCBnbG9iYWxIaXN0b3J5KSB7CiAgICAgICAgICAgICAgdmFyIF93aW5kb3ckbG9jYXRpb24gPQoKCgogICAgICAgICAgICAgICAgd2luZG93LmxvY2F0aW9uLHBhdGhuYW1lID0gX3dpbmRvdyRsb2NhdGlvbi5wYXRobmFtZSxzZWFyY2ggPSBfd2luZG93JGxvY2F0aW9uLnNlYXJjaCxoYXNoID0gX3dpbmRvdyRsb2NhdGlvbi5oYXNoOwogICAgICAgICAgICAgIHJldHVybiBjcmVhdGVMb2NhdGlvbigiIiwgewogICAgICAgICAgICAgICAgcGF0aG5hbWU6IHBhdGhuYW1lLAogICAgICAgICAgICAgICAgc2VhcmNoOiBzZWFyY2gsCiAgICAgICAgICAgICAgICBoYXNoOiBoYXNoCiAgICAgICAgICAgICAgfSwgLy8gc3RhdGUgZGVmYXVsdHMgdG8gYG51bGxgIGJlY2F1c2UgYHdpbmRvdy5oaXN0b3J5LnN0YXRlYCBkb2VzCiAgICAgICAgICAgICAgZ2xvYmFsSGlzdG9yeS5zdGF0ZSAmJiBnbG9iYWxIaXN0b3J5LnN0YXRlLnVzciB8fCBudWxsLCBnbG9iYWxIaXN0b3J5LnN0YXRlICYmIGdsb2JhbEhpc3Rvcnkuc3RhdGUua2V5IHx8ICJkZWZhdWx0Iik7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGZ1bmN0aW9uIGNyZWF0ZUJyb3dzZXJIcmVmKHdpbmRvdywgdG8pIHsKICAgICAgICAgICAgICByZXR1cm4gdHlwZW9mIHRvID09PSAic3RyaW5nIiA/IHRvIDogcm91dGVyX2NyZWF0ZVBhdGgodG8pOwogICAgICAgICAgICB9CgogICAgICAgICAgICByZXR1cm4gZ2V0VXJsQmFzZWRIaXN0b3J5KGNyZWF0ZUJyb3dzZXJMb2NhdGlvbiwgY3JlYXRlQnJvd3NlckhyZWYsIG51bGwsIG9wdGlvbnMpOwogICAgICAgICAgfQogICAgICAgICAgLyoqCiAgICAgICAgICAgKiBIYXNoIGhpc3Rvcnkgc3RvcmVzIHRoZSBsb2NhdGlvbiBpbiB3aW5kb3cubG9jYXRpb24uaGFzaC4gVGhpcyBtYWtlcyBpdCBpZGVhbAogICAgICAgICAgICogZm9yIHNpdHVhdGlvbnMgd2hlcmUgeW91IGRvbid0IHdhbnQgdG8gc2VuZCB0aGUgbG9jYXRpb24gdG8gdGhlIHNlcnZlciBmb3IKICAgICAgICAgICAqIHNvbWUgcmVhc29uLCBlaXRoZXIgYmVjYXVzZSB5b3UgZG8gY2Fubm90IGNvbmZpZ3VyZSBpdCBvciB0aGUgVVJMIHNwYWNlIGlzCiAgICAgICAgICAgKiByZXNlcnZlZCBmb3Igc29tZXRoaW5nIGVsc2UuCiAgICAgICAgICAgKgogICAgICAgICAgICogQHNlZSBodHRwczovL2dpdGh1Yi5jb20vcmVtaXgtcnVuL2hpc3RvcnkvdHJlZS9tYWluL2RvY3MvYXBpLXJlZmVyZW5jZS5tZCNjcmVhdGVoYXNoaGlzdG9yeQogICAgICAgICAgICovCgogICAgICAgICAgZnVuY3Rpb24gcm91dGVyX2NyZWF0ZUhhc2hIaXN0b3J5KG9wdGlvbnMpIHsKICAgICAgICAgICAgaWYgKG9wdGlvbnMgPT09IHZvaWQgMCkgewogICAgICAgICAgICAgIG9wdGlvbnMgPSB7fTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgZnVuY3Rpb24gY3JlYXRlSGFzaExvY2F0aW9uKHdpbmRvdywgZ2xvYmFsSGlzdG9yeSkgewogICAgICAgICAgICAgIHZhciBfcGFyc2VQYXRoID0KCgoKICAgICAgICAgICAgICAgIHBhcnNlUGF0aCh3aW5kb3cubG9jYXRpb24uaGFzaC5zdWJzdHIoMSkpLF9wYXJzZVBhdGgkcGF0aG5hbWUgPSBfcGFyc2VQYXRoLnBhdGhuYW1lLHBhdGhuYW1lID0gX3BhcnNlUGF0aCRwYXRobmFtZSA9PT0gdm9pZCAwID8gIi8iIDogX3BhcnNlUGF0aCRwYXRobmFtZSxfcGFyc2VQYXRoJHNlYXJjaCA9IF9wYXJzZVBhdGguc2VhcmNoLHNlYXJjaCA9IF9wYXJzZVBhdGgkc2VhcmNoID09PSB2b2lkIDAgPyAiIiA6IF9wYXJzZVBhdGgkc2VhcmNoLF9wYXJzZVBhdGgkaGFzaCA9IF9wYXJzZVBhdGguaGFzaCxoYXNoID0gX3BhcnNlUGF0aCRoYXNoID09PSB2b2lkIDAgPyAiIiA6IF9wYXJzZVBhdGgkaGFzaDsKICAgICAgICAgICAgICByZXR1cm4gY3JlYXRlTG9jYXRpb24oIiIsIHsKICAgICAgICAgICAgICAgIHBhdGhuYW1lOiBwYXRobmFtZSwKICAgICAgICAgICAgICAgIHNlYXJjaDogc2VhcmNoLAogICAgICAgICAgICAgICAgaGFzaDogaGFzaAogICAgICAgICAgICAgIH0sIC8vIHN0YXRlIGRlZmF1bHRzIHRvIGBudWxsYCBiZWNhdXNlIGB3aW5kb3cuaGlzdG9yeS5zdGF0ZWAgZG9lcwogICAgICAgICAgICAgIGdsb2JhbEhpc3Rvcnkuc3RhdGUgJiYgZ2xvYmFsSGlzdG9yeS5zdGF0ZS51c3IgfHwgbnVsbCwgZ2xvYmFsSGlzdG9yeS5zdGF0ZSAmJiBnbG9iYWxIaXN0b3J5LnN0YXRlLmtleSB8fCAiZGVmYXVsdCIpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBmdW5jdGlvbiBjcmVhdGVIYXNoSHJlZih3aW5kb3csIHRvKSB7CiAgICAgICAgICAgICAgdmFyIGJhc2UgPSB3aW5kb3cuZG9jdW1lbnQucXVlcnlTZWxlY3RvcigiYmFzZSIpOwogICAgICAgICAgICAgIHZhciBocmVmID0gIiI7CgogICAgICAgICAgICAgIGlmIChiYXNlICYmIGJhc2UuZ2V0QXR0cmlidXRlKCJocmVmIikpIHsKICAgICAgICAgICAgICAgIHZhciB1cmwgPSB3aW5kb3cubG9jYXRpb24uaHJlZjsKICAgICAgICAgICAgICAgIHZhciBoYXNoSW5kZXggPSB1cmwuaW5kZXhPZigiIyIpOwogICAgICAgICAgICAgICAgaHJlZiA9IGhhc2hJbmRleCA9PT0gLTEgPyB1cmwgOiB1cmwuc2xpY2UoMCwgaGFzaEluZGV4KTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIHJldHVybiBocmVmICsgIiMiICsgKHR5cGVvZiB0byA9PT0gInN0cmluZyIgPyB0byA6IHJvdXRlcl9jcmVhdGVQYXRoKHRvKSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGZ1bmN0aW9uIHZhbGlkYXRlSGFzaExvY2F0aW9uKGxvY2F0aW9uLCB0bykgewogICAgICAgICAgICAgIHdhcm5pbmckMShsb2NhdGlvbi5wYXRobmFtZS5jaGFyQXQoMCkgPT09ICIvIiwgInJlbGF0aXZlIHBhdGhuYW1lcyBhcmUgbm90IHN1cHBvcnRlZCBpbiBoYXNoIGhpc3RvcnkucHVzaCgiICsgSlNPTi5zdHJpbmdpZnkodG8pICsgIikiKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuIGdldFVybEJhc2VkSGlzdG9yeShjcmVhdGVIYXNoTG9jYXRpb24sIGNyZWF0ZUhhc2hIcmVmLCB2YWxpZGF0ZUhhc2hMb2NhdGlvbiwgb3B0aW9ucyk7CiAgICAgICAgICB9CiAgICAgICAgICBmdW5jdGlvbiByb3V0ZXJfaW52YXJpYW50KHZhbHVlLCBtZXNzYWdlKSB7CiAgICAgICAgICAgIGlmICh2YWx1ZSA9PT0gZmFsc2UgfHwgdmFsdWUgPT09IG51bGwgfHwgdHlwZW9mIHZhbHVlID09PSAidW5kZWZpbmVkIikgewogICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihtZXNzYWdlKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQoKICAgICAgICAgIGZ1bmN0aW9uIHdhcm5pbmckMShjb25kLCBtZXNzYWdlKSB7CiAgICAgICAgICAgIGlmICghY29uZCkgewogICAgICAgICAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBuby1jb25zb2xlCiAgICAgICAgICAgICAgaWYgKHR5cGVvZiBjb25zb2xlICE9PSAidW5kZWZpbmVkIikgY29uc29sZS53YXJuKG1lc3NhZ2UpOwoKICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgLy8gV2VsY29tZSB0byBkZWJ1Z2dpbmcgaGlzdG9yeSEKICAgICAgICAgICAgICAgIC8vCiAgICAgICAgICAgICAgICAvLyBUaGlzIGVycm9yIGlzIHRocm93biBhcyBhIGNvbnZlbmllbmNlIHNvIHlvdSBjYW4gbW9yZSBlYXNpbHkKICAgICAgICAgICAgICAgIC8vIGZpbmQgdGhlIHNvdXJjZSBmb3IgYSB3YXJuaW5nIHRoYXQgYXBwZWFycyBpbiB0aGUgY29uc29sZSBieQogICAgICAgICAgICAgICAgLy8gZW5hYmxpbmcgInBhdXNlIG9uIGV4Y2VwdGlvbnMiIGluIHlvdXIgSmF2YVNjcmlwdCBkZWJ1Z2dlci4KICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihtZXNzYWdlKTsgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG5vLWVtcHR5CiAgICAgICAgICAgICAgfSBjYXRjaCAoZSkge30KICAgICAgICAgICAgfQogICAgICAgICAgfQoKICAgICAgICAgIGZ1bmN0aW9uIGNyZWF0ZUtleSgpIHsKICAgICAgICAgICAgcmV0dXJuIE1hdGgucmFuZG9tKCkudG9TdHJpbmcoMzYpLnN1YnN0cigyLCA4KTsKICAgICAgICAgIH0KICAgICAgICAgIC8qKgogICAgICAgICAgICogRm9yIGJyb3dzZXItYmFzZWQgaGlzdG9yaWVzLCB3ZSBjb21iaW5lIHRoZSBzdGF0ZSBhbmQga2V5IGludG8gYW4gb2JqZWN0CiAgICAgICAgICAgKi8KCgogICAgICAgICAgZnVuY3Rpb24gZ2V0SGlzdG9yeVN0YXRlKGxvY2F0aW9uLCBpbmRleCkgewogICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgIHVzcjogbG9jYXRpb24uc3RhdGUsCiAgICAgICAgICAgICAga2V5OiBsb2NhdGlvbi5rZXksCiAgICAgICAgICAgICAgaWR4OiBpbmRleAogICAgICAgICAgICB9OwogICAgICAgICAgfQogICAgICAgICAgLyoqCiAgICAgICAgICAgKiBDcmVhdGVzIGEgTG9jYXRpb24gb2JqZWN0IHdpdGggYSB1bmlxdWUga2V5IGZyb20gdGhlIGdpdmVuIFBhdGgKICAgICAgICAgICAqLwoKCiAgICAgICAgICBmdW5jdGlvbiBjcmVhdGVMb2NhdGlvbihjdXJyZW50LCB0bywgc3RhdGUsIGtleSkgewogICAgICAgICAgICBpZiAoc3RhdGUgPT09IHZvaWQgMCkgewogICAgICAgICAgICAgIHN0YXRlID0gbnVsbDsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdmFyIGxvY2F0aW9uID0gX2V4dGVuZHMoewogICAgICAgICAgICAgIHBhdGhuYW1lOiB0eXBlb2YgY3VycmVudCA9PT0gInN0cmluZyIgPyBjdXJyZW50IDogY3VycmVudC5wYXRobmFtZSwKICAgICAgICAgICAgICBzZWFyY2g6ICIiLAogICAgICAgICAgICAgIGhhc2g6ICIiCiAgICAgICAgICAgIH0sIHR5cGVvZiB0byA9PT0gInN0cmluZyIgPyBwYXJzZVBhdGgodG8pIDogdG8sIHsKICAgICAgICAgICAgICBzdGF0ZTogc3RhdGUsCiAgICAgICAgICAgICAgLy8gVE9ETzogVGhpcyBjb3VsZCBiZSBjbGVhbmVkIHVwLiAgcHVzaC9yZXBsYWNlIHNob3VsZCBwcm9iYWJseSBqdXN0IHRha2UKICAgICAgICAgICAgICAvLyBmdWxsIExvY2F0aW9ucyBub3cgYW5kIGF2b2lkIHRoZSBuZWVkIHRvIHJ1biB0aHJvdWdoIHRoaXMgZmxvdyBhdCBhbGwKICAgICAgICAgICAgICAvLyBCdXQgdGhhdCdzIGEgcHJldHR5IGJpZyByZWZhY3RvciB0byB0aGUgY3VycmVudCB0ZXN0IHN1aXRlIHNvIGdvaW5nIHRvCiAgICAgICAgICAgICAgLy8ga2VlcCBhcyBpcyBmb3IgdGhlIHRpbWUgYmVpbmcgYW5kIGp1c3QgbGV0IGFueSBpbmNvbWluZyBrZXlzIHRha2UgcHJlY2VkZW5jZQogICAgICAgICAgICAgIGtleTogdG8gJiYgdG8ua2V5IHx8IGtleSB8fCBjcmVhdGVLZXkoKQogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIHJldHVybiBsb2NhdGlvbjsKICAgICAgICAgIH0KICAgICAgICAgIC8qKgogICAgICAgICAgICogQ3JlYXRlcyBhIHN0cmluZyBVUkwgcGF0aCBmcm9tIHRoZSBnaXZlbiBwYXRobmFtZSwgc2VhcmNoLCBhbmQgaGFzaCBjb21wb25lbnRzLgogICAgICAgICAgICovCgogICAgICAgICAgZnVuY3Rpb24gcm91dGVyX2NyZWF0ZVBhdGgoX3JlZikgewogICAgICAgICAgICB2YXIgX3JlZiRwYXRobmFtZSA9CgoKCiAgICAgICAgICAgICAgX3JlZi5wYXRobmFtZSxwYXRobmFtZSA9IF9yZWYkcGF0aG5hbWUgPT09IHZvaWQgMCA/ICIvIiA6IF9yZWYkcGF0aG5hbWUsX3JlZiRzZWFyY2ggPSBfcmVmLnNlYXJjaCxzZWFyY2ggPSBfcmVmJHNlYXJjaCA9PT0gdm9pZCAwID8gIiIgOiBfcmVmJHNlYXJjaCxfcmVmJGhhc2ggPSBfcmVmLmhhc2gsaGFzaCA9IF9yZWYkaGFzaCA9PT0gdm9pZCAwID8gIiIgOiBfcmVmJGhhc2g7CiAgICAgICAgICAgIGlmIChzZWFyY2ggJiYgc2VhcmNoICE9PSAiPyIpIHBhdGhuYW1lICs9IHNlYXJjaC5jaGFyQXQoMCkgPT09ICI/IiA/IHNlYXJjaCA6ICI/IiArIHNlYXJjaDsKICAgICAgICAgICAgaWYgKGhhc2ggJiYgaGFzaCAhPT0gIiMiKSBwYXRobmFtZSArPSBoYXNoLmNoYXJBdCgwKSA9PT0gIiMiID8gaGFzaCA6ICIjIiArIGhhc2g7CiAgICAgICAgICAgIHJldHVybiBwYXRobmFtZTsKICAgICAgICAgIH0KICAgICAgICAgIC8qKgogICAgICAgICAgICogUGFyc2VzIGEgc3RyaW5nIFVSTCBwYXRoIGludG8gaXRzIHNlcGFyYXRlIHBhdGhuYW1lLCBzZWFyY2gsIGFuZCBoYXNoIGNvbXBvbmVudHMuCiAgICAgICAgICAgKi8KCiAgICAgICAgICBmdW5jdGlvbiBwYXJzZVBhdGgocGF0aCkgewogICAgICAgICAgICB2YXIgcGFyc2VkUGF0aCA9IHt9OwoKICAgICAgICAgICAgaWYgKHBhdGgpIHsKICAgICAgICAgICAgICB2YXIgaGFzaEluZGV4ID0gcGF0aC5pbmRleE9mKCIjIik7CgogICAgICAgICAgICAgIGlmIChoYXNoSW5kZXggPj0gMCkgewogICAgICAgICAgICAgICAgcGFyc2VkUGF0aC5oYXNoID0gcGF0aC5zdWJzdHIoaGFzaEluZGV4KTsKICAgICAgICAgICAgICAgIHBhdGggPSBwYXRoLnN1YnN0cigwLCBoYXNoSW5kZXgpOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgdmFyIHNlYXJjaEluZGV4ID0gcGF0aC5pbmRleE9mKCI/Iik7CgogICAgICAgICAgICAgIGlmIChzZWFyY2hJbmRleCA+PSAwKSB7CiAgICAgICAgICAgICAgICBwYXJzZWRQYXRoLnNlYXJjaCA9IHBhdGguc3Vic3RyKHNlYXJjaEluZGV4KTsKICAgICAgICAgICAgICAgIHBhdGggPSBwYXRoLnN1YnN0cigwLCBzZWFyY2hJbmRleCk7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBpZiAocGF0aCkgewogICAgICAgICAgICAgICAgcGFyc2VkUGF0aC5wYXRobmFtZSA9IHBhdGg7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICByZXR1cm4gcGFyc2VkUGF0aDsKICAgICAgICAgIH0KCiAgICAgICAgICBmdW5jdGlvbiBnZXRVcmxCYXNlZEhpc3RvcnkoZ2V0TG9jYXRpb24sIF9jcmVhdGVIcmVmLCB2YWxpZGF0ZUxvY2F0aW9uLCBvcHRpb25zKSB7CiAgICAgICAgICAgIGlmIChvcHRpb25zID09PSB2b2lkIDApIHsKICAgICAgICAgICAgICBvcHRpb25zID0ge307CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHZhciBfb3B0aW9uczIgPQoKCiAgICAgICAgICAgICAgb3B0aW9ucyxfb3B0aW9uczIkd2luZG93ID0gX29wdGlvbnMyLndpbmRvdyx3aW5kb3cgPSBfb3B0aW9uczIkd2luZG93ID09PSB2b2lkIDAgPyBkb2N1bWVudC5kZWZhdWx0VmlldyA6IF9vcHRpb25zMiR3aW5kb3csX29wdGlvbnMyJHY1Q29tcGF0ID0gX29wdGlvbnMyLnY1Q29tcGF0LHY1Q29tcGF0ID0gX29wdGlvbnMyJHY1Q29tcGF0ID09PSB2b2lkIDAgPyBmYWxzZSA6IF9vcHRpb25zMiR2NUNvbXBhdDsKICAgICAgICAgICAgdmFyIGdsb2JhbEhpc3RvcnkgPSB3aW5kb3cuaGlzdG9yeTsKICAgICAgICAgICAgdmFyIGFjdGlvbiA9IEFjdGlvbi5Qb3A7CiAgICAgICAgICAgIHZhciBsaXN0ZW5lciA9IG51bGw7CiAgICAgICAgICAgIHZhciBpbmRleCA9IGdldEluZGV4KCk7IC8vIEluZGV4IHNob3VsZCBvbmx5IGJlIG51bGwgd2hlbiB3ZSBpbml0aWFsaXplLiBJZiBub3QsIGl0J3MgYmVjYXVzZSB0aGUKICAgICAgICAgICAgLy8gdXNlciBjYWxsZWQgaGlzdG9yeS5wdXNoU3RhdGUgb3IgaGlzdG9yeS5yZXBsYWNlU3RhdGUgZGlyZWN0bHksIGluIHdoaWNoCiAgICAgICAgICAgIC8vIGNhc2Ugd2Ugc2hvdWxkIGxvZyBhIHdhcm5pbmcgYXMgaXQgd2lsbCByZXN1bHQgaW4gYnVncy4KCiAgICAgICAgICAgIGlmIChpbmRleCA9PSBudWxsKSB7CiAgICAgICAgICAgICAgaW5kZXggPSAwOwogICAgICAgICAgICAgIGdsb2JhbEhpc3RvcnkucmVwbGFjZVN0YXRlKF9leHRlbmRzKHt9LCBnbG9iYWxIaXN0b3J5LnN0YXRlLCB7CiAgICAgICAgICAgICAgICBpZHg6IGluZGV4CiAgICAgICAgICAgICAgfSksICIiKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgZnVuY3Rpb24gZ2V0SW5kZXgoKSB7CiAgICAgICAgICAgICAgdmFyIHN0YXRlID0gZ2xvYmFsSGlzdG9yeS5zdGF0ZSB8fCB7CiAgICAgICAgICAgICAgICBpZHg6IG51bGwKICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgIHJldHVybiBzdGF0ZS5pZHg7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGZ1bmN0aW9uIGhhbmRsZVBvcCgpIHsKICAgICAgICAgICAgICB2YXIgbmV4dEFjdGlvbiA9IEFjdGlvbi5Qb3A7CiAgICAgICAgICAgICAgdmFyIG5leHRJbmRleCA9IGdldEluZGV4KCk7CgogICAgICAgICAgICAgIGlmIChuZXh0SW5kZXggIT0gbnVsbCkgewogICAgICAgICAgICAgICAgdmFyIGRlbHRhID0gbmV4dEluZGV4IC0gaW5kZXg7CiAgICAgICAgICAgICAgICBhY3Rpb24gPSBuZXh0QWN0aW9uOwogICAgICAgICAgICAgICAgaW5kZXggPSBuZXh0SW5kZXg7CgogICAgICAgICAgICAgICAgaWYgKGxpc3RlbmVyKSB7CiAgICAgICAgICAgICAgICAgIGxpc3RlbmVyKHsKICAgICAgICAgICAgICAgICAgICBhY3Rpb246IGFjdGlvbiwKICAgICAgICAgICAgICAgICAgICBsb2NhdGlvbjogaGlzdG9yeS5sb2NhdGlvbiwKICAgICAgICAgICAgICAgICAgICBkZWx0YTogZGVsdGEKICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHdhcm5pbmckMShmYWxzZSwgLy8gVE9ETzogV3JpdGUgdXAgYSBkb2MgdGhhdCBleHBsYWlucyBvdXIgYmxvY2tpbmcgc3RyYXRlZ3kgaW4gZGV0YWlsCiAgICAgICAgICAgICAgICAvLyBhbmQgbGluayB0byBpdCBoZXJlIHNvIHBlb3BsZSBjYW4gdW5kZXJzdGFuZCBiZXR0ZXIgd2hhdCBpcyBnb2luZyBvbgogICAgICAgICAgICAgICAgLy8gYW5kIGhvdyB0byBhdm9pZCBpdC4KICAgICAgICAgICAgICAgICJZb3UgYXJlIHRyeWluZyB0byBibG9jayBhIFBPUCBuYXZpZ2F0aW9uIHRvIGEgbG9jYXRpb24gdGhhdCB3YXMgbm90ICIgKyAiY3JlYXRlZCBieSBAcmVtaXgtcnVuL3JvdXRlci4gVGhlIGJsb2NrIHdpbGwgZmFpbCBzaWxlbnRseSBpbiAiICsgInByb2R1Y3Rpb24sIGJ1dCBpbiBnZW5lcmFsIHlvdSBzaG91bGQgZG8gYWxsIG5hdmlnYXRpb24gd2l0aCB0aGUgIiArICJyb3V0ZXIgKGluc3RlYWQgb2YgdXNpbmcgd2luZG93Lmhpc3RvcnkucHVzaFN0YXRlIGRpcmVjdGx5KSAiICsgInRvIGF2b2lkIHRoaXMgc2l0dWF0aW9uLiIpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgZnVuY3Rpb24gcHVzaCh0bywgc3RhdGUpIHsKICAgICAgICAgICAgICBhY3Rpb24gPSBBY3Rpb24uUHVzaDsKICAgICAgICAgICAgICB2YXIgbG9jYXRpb24gPSBjcmVhdGVMb2NhdGlvbihoaXN0b3J5LmxvY2F0aW9uLCB0bywgc3RhdGUpOwogICAgICAgICAgICAgIGlmICh2YWxpZGF0ZUxvY2F0aW9uKSB2YWxpZGF0ZUxvY2F0aW9uKGxvY2F0aW9uLCB0byk7CiAgICAgICAgICAgICAgaW5kZXggPSBnZXRJbmRleCgpICsgMTsKICAgICAgICAgICAgICB2YXIgaGlzdG9yeVN0YXRlID0gZ2V0SGlzdG9yeVN0YXRlKGxvY2F0aW9uLCBpbmRleCk7CiAgICAgICAgICAgICAgdmFyIHVybCA9IGhpc3RvcnkuY3JlYXRlSHJlZihsb2NhdGlvbik7IC8vIHRyeS4uLmNhdGNoIGJlY2F1c2UgaU9TIGxpbWl0cyB1cyB0byAxMDAgcHVzaFN0YXRlIGNhbGxzIDovCgogICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICBnbG9iYWxIaXN0b3J5LnB1c2hTdGF0ZShoaXN0b3J5U3RhdGUsICIiLCB1cmwpOwogICAgICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgICAgICAgICAvLyBUaGV5IGFyZSBnb2luZyB0byBsb3NlIHN0YXRlIGhlcmUsIGJ1dCB0aGVyZSBpcyBubyByZWFsCiAgICAgICAgICAgICAgICAvLyB3YXkgdG8gd2FybiB0aGVtIGFib3V0IGl0IHNpbmNlIHRoZSBwYWdlIHdpbGwgcmVmcmVzaC4uLgogICAgICAgICAgICAgICAgd2luZG93LmxvY2F0aW9uLmFzc2lnbih1cmwpOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgaWYgKHY1Q29tcGF0ICYmIGxpc3RlbmVyKSB7CiAgICAgICAgICAgICAgICBsaXN0ZW5lcih7CiAgICAgICAgICAgICAgICAgIGFjdGlvbjogYWN0aW9uLAogICAgICAgICAgICAgICAgICBsb2NhdGlvbjogaGlzdG9yeS5sb2NhdGlvbiwKICAgICAgICAgICAgICAgICAgZGVsdGE6IDEKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgZnVuY3Rpb24gcmVwbGFjZSh0bywgc3RhdGUpIHsKICAgICAgICAgICAgICBhY3Rpb24gPSBBY3Rpb24uUmVwbGFjZTsKICAgICAgICAgICAgICB2YXIgbG9jYXRpb24gPSBjcmVhdGVMb2NhdGlvbihoaXN0b3J5LmxvY2F0aW9uLCB0bywgc3RhdGUpOwogICAgICAgICAgICAgIGlmICh2YWxpZGF0ZUxvY2F0aW9uKSB2YWxpZGF0ZUxvY2F0aW9uKGxvY2F0aW9uLCB0byk7CiAgICAgICAgICAgICAgaW5kZXggPSBnZXRJbmRleCgpOwogICAgICAgICAgICAgIHZhciBoaXN0b3J5U3RhdGUgPSBnZXRIaXN0b3J5U3RhdGUobG9jYXRpb24sIGluZGV4KTsKICAgICAgICAgICAgICB2YXIgdXJsID0gaGlzdG9yeS5jcmVhdGVIcmVmKGxvY2F0aW9uKTsKICAgICAgICAgICAgICBnbG9iYWxIaXN0b3J5LnJlcGxhY2VTdGF0ZShoaXN0b3J5U3RhdGUsICIiLCB1cmwpOwoKICAgICAgICAgICAgICBpZiAodjVDb21wYXQgJiYgbGlzdGVuZXIpIHsKICAgICAgICAgICAgICAgIGxpc3RlbmVyKHsKICAgICAgICAgICAgICAgICAgYWN0aW9uOiBhY3Rpb24sCiAgICAgICAgICAgICAgICAgIGxvY2F0aW9uOiBoaXN0b3J5LmxvY2F0aW9uLAogICAgICAgICAgICAgICAgICBkZWx0YTogMAogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICBmdW5jdGlvbiBjcmVhdGVVUkwodG8pIHsKICAgICAgICAgICAgICAvLyB3aW5kb3cubG9jYXRpb24ub3JpZ2luIGlzICJudWxsIiAodGhlIGxpdGVyYWwgc3RyaW5nIHZhbHVlKSBpbiBGaXJlZm94CiAgICAgICAgICAgICAgLy8gdW5kZXIgY2VydGFpbiBjb25kaXRpb25zLCBub3RhYmx5IHdoZW4gc2VydmluZyBmcm9tIGEgbG9jYWwgSFRNTCBmaWxlCiAgICAgICAgICAgICAgLy8gU2VlIGh0dHBzOi8vYnVnemlsbGEubW96aWxsYS5vcmcvc2hvd19idWcuY2dpP2lkPTg3ODI5NwogICAgICAgICAgICAgIHZhciBiYXNlID0gd2luZG93LmxvY2F0aW9uLm9yaWdpbiAhPT0gIm51bGwiID8gd2luZG93LmxvY2F0aW9uLm9yaWdpbiA6IHdpbmRvdy5sb2NhdGlvbi5ocmVmOwogICAgICAgICAgICAgIHZhciBocmVmID0gdHlwZW9mIHRvID09PSAic3RyaW5nIiA/IHRvIDogcm91dGVyX2NyZWF0ZVBhdGgodG8pOwogICAgICAgICAgICAgIHJvdXRlcl9pbnZhcmlhbnQoYmFzZSwgIk5vIHdpbmRvdy5sb2NhdGlvbi4ob3JpZ2lufGhyZWYpIGF2YWlsYWJsZSB0byBjcmVhdGUgVVJMIGZvciBocmVmOiAiICsgaHJlZik7CiAgICAgICAgICAgICAgcmV0dXJuIG5ldyBVUkwoaHJlZiwgYmFzZSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHZhciBoaXN0b3J5ID0gewogICAgICAgICAgICAgIGdldCBhY3Rpb24oKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gYWN0aW9uOwogICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgIGdldCBsb2NhdGlvbigpIHsKICAgICAgICAgICAgICAgIHJldHVybiBnZXRMb2NhdGlvbih3aW5kb3csIGdsb2JhbEhpc3RvcnkpOwogICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgIGxpc3RlbjogZnVuY3Rpb24gbGlzdGVuKGZuKSB7CiAgICAgICAgICAgICAgICBpZiAobGlzdGVuZXIpIHsKICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJBIGhpc3Rvcnkgb25seSBhY2NlcHRzIG9uZSBhY3RpdmUgbGlzdGVuZXIiKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcihQb3BTdGF0ZUV2ZW50VHlwZSwgaGFuZGxlUG9wKTsKICAgICAgICAgICAgICAgIGxpc3RlbmVyID0gZm47CiAgICAgICAgICAgICAgICByZXR1cm4gKCkgPT4gewogICAgICAgICAgICAgICAgICB3aW5kb3cucmVtb3ZlRXZlbnRMaXN0ZW5lcihQb3BTdGF0ZUV2ZW50VHlwZSwgaGFuZGxlUG9wKTsKICAgICAgICAgICAgICAgICAgbGlzdGVuZXIgPSBudWxsOwogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICBjcmVhdGVIcmVmOiBmdW5jdGlvbiBjcmVhdGVIcmVmKHRvKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gX2NyZWF0ZUhyZWYod2luZG93LCB0byk7CiAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgY3JlYXRlVVJMOiBjcmVhdGVVUkwsCgogICAgICAgICAgICAgIGVuY29kZUxvY2F0aW9uOiBmdW5jdGlvbiBlbmNvZGVMb2NhdGlvbih0bykgewogICAgICAgICAgICAgICAgLy8gRW5jb2RlIGEgTG9jYXRpb24gdGhlIHNhbWUgd2F5IHdpbmRvdy5sb2NhdGlvbiB3b3VsZAogICAgICAgICAgICAgICAgdmFyIHVybCA9IGNyZWF0ZVVSTCh0byk7CiAgICAgICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgICBwYXRobmFtZTogdXJsLnBhdGhuYW1lLAogICAgICAgICAgICAgICAgICBzZWFyY2g6IHVybC5zZWFyY2gsCiAgICAgICAgICAgICAgICAgIGhhc2g6IHVybC5oYXNoCiAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgIHB1c2g6IHB1c2gsCiAgICAgICAgICAgICAgcmVwbGFjZTogcmVwbGFjZSwKCiAgICAgICAgICAgICAgZ286IGZ1bmN0aW9uIGdvKG4pIHsKICAgICAgICAgICAgICAgIHJldHVybiBnbG9iYWxIaXN0b3J5LmdvKG4pOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgIH07CiAgICAgICAgICAgIHJldHVybiBoaXN0b3J5OwogICAgICAgICAgfSAvLyNlbmRyZWdpb24KCiAgICAgICAgICB2YXIgUmVzdWx0VHlwZTsKCiAgICAgICAgICAoZnVuY3Rpb24gKFJlc3VsdFR5cGUpIHsKICAgICAgICAgICAgUmVzdWx0VHlwZVsiZGF0YSJdID0gImRhdGEiOwogICAgICAgICAgICBSZXN1bHRUeXBlWyJkZWZlcnJlZCJdID0gImRlZmVycmVkIjsKICAgICAgICAgICAgUmVzdWx0VHlwZVsicmVkaXJlY3QiXSA9ICJyZWRpcmVjdCI7CiAgICAgICAgICAgIFJlc3VsdFR5cGVbImVycm9yIl0gPSAiZXJyb3IiOwogICAgICAgICAgfSkoUmVzdWx0VHlwZSB8fCAoUmVzdWx0VHlwZSA9IHt9KSk7CgogICAgICAgICAgZnVuY3Rpb24gaXNJbmRleFJvdXRlKHJvdXRlKSB7CiAgICAgICAgICAgIHJldHVybiByb3V0ZS5pbmRleCA9PT0gdHJ1ZTsKICAgICAgICAgIH0gLy8gV2FsayB0aGUgcm91dGUgdHJlZSBnZW5lcmF0aW5nIHVuaXF1ZSBJRHMgd2hlcmUgbmVjZXNzYXJ5IHNvIHdlIGFyZSB3b3JraW5nCiAgICAgICAgICAvLyBzb2xlbHkgd2l0aCBBZ25vc3RpY0RhdGFSb3V0ZU9iamVjdCdzIHdpdGhpbiB0aGUgUm91dGVyCgoKICAgICAgICAgIGZ1bmN0aW9uIGNvbnZlcnRSb3V0ZXNUb0RhdGFSb3V0ZXMocm91dGVzLCBwYXJlbnRQYXRoLCBhbGxJZHMpIHsKICAgICAgICAgICAgaWYgKHBhcmVudFBhdGggPT09IHZvaWQgMCkgewogICAgICAgICAgICAgIHBhcmVudFBhdGggPSBbXTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKGFsbElkcyA9PT0gdm9pZCAwKSB7CiAgICAgICAgICAgICAgYWxsSWRzID0gbmV3IFNldCgpOwogICAgICAgICAgICB9CgogICAgICAgICAgICByZXR1cm4gcm91dGVzLm1hcCgocm91dGUsIGluZGV4KSA9PiB7CiAgICAgICAgICAgICAgdmFyIHRyZWVQYXRoID0gW10uY29uY2F0KF90b0NvbnN1bWFibGVBcnJheShwYXJlbnRQYXRoKSwgW2luZGV4XSk7CiAgICAgICAgICAgICAgdmFyIGlkID0gdHlwZW9mIHJvdXRlLmlkID09PSAic3RyaW5nIiA/IHJvdXRlLmlkIDogdHJlZVBhdGguam9pbigiLSIpOwogICAgICAgICAgICAgIHJvdXRlcl9pbnZhcmlhbnQocm91dGUuaW5kZXggIT09IHRydWUgfHwgIXJvdXRlLmNoaWxkcmVuLCAiQ2Fubm90IHNwZWNpZnkgY2hpbGRyZW4gb24gYW4gaW5kZXggcm91dGUiKTsKICAgICAgICAgICAgICByb3V0ZXJfaW52YXJpYW50KCFhbGxJZHMuaGFzKGlkKSwgIkZvdW5kIGEgcm91dGUgaWQgY29sbGlzaW9uIG9uIGlkIFwiIiArIGlkICsgIlwiLiAgUm91dGUgIiArICJpZCdzIG11c3QgYmUgZ2xvYmFsbHkgdW5pcXVlIHdpdGhpbiBEYXRhIFJvdXRlciB1c2FnZXMiKTsKICAgICAgICAgICAgICBhbGxJZHMuYWRkKGlkKTsKCiAgICAgICAgICAgICAgaWYgKGlzSW5kZXhSb3V0ZShyb3V0ZSkpIHsKICAgICAgICAgICAgICAgIHZhciBpbmRleFJvdXRlID0gX2V4dGVuZHMoe30sIHJvdXRlLCB7CiAgICAgICAgICAgICAgICAgIGlkOiBpZAogICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgICAgcmV0dXJuIGluZGV4Um91dGU7CiAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHZhciBwYXRoT3JMYXlvdXRSb3V0ZSA9IF9leHRlbmRzKHt9LCByb3V0ZSwgewogICAgICAgICAgICAgICAgICBpZDogaWQsCiAgICAgICAgICAgICAgICAgIGNoaWxkcmVuOiByb3V0ZS5jaGlsZHJlbiA/IGNvbnZlcnRSb3V0ZXNUb0RhdGFSb3V0ZXMocm91dGUuY2hpbGRyZW4sIHRyZWVQYXRoLCBhbGxJZHMpIDogdW5kZWZpbmVkCiAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgICByZXR1cm4gcGF0aE9yTGF5b3V0Um91dGU7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICAgIH0KICAgICAgICAgIC8qKgogICAgICAgICAgICogTWF0Y2hlcyB0aGUgZ2l2ZW4gcm91dGVzIHRvIGEgbG9jYXRpb24gYW5kIHJldHVybnMgdGhlIG1hdGNoIGRhdGEuCiAgICAgICAgICAgKgogICAgICAgICAgICogQHNlZSBodHRwczovL3JlYWN0cm91dGVyLmNvbS91dGlscy9tYXRjaC1yb3V0ZXMKICAgICAgICAgICAqLwoKICAgICAgICAgIGZ1bmN0aW9uIG1hdGNoUm91dGVzKHJvdXRlcywgbG9jYXRpb25BcmcsIGJhc2VuYW1lKSB7CiAgICAgICAgICAgIGlmIChiYXNlbmFtZSA9PT0gdm9pZCAwKSB7CiAgICAgICAgICAgICAgYmFzZW5hbWUgPSAiLyI7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHZhciBsb2NhdGlvbiA9IHR5cGVvZiBsb2NhdGlvbkFyZyA9PT0gInN0cmluZyIgPyBwYXJzZVBhdGgobG9jYXRpb25BcmcpIDogbG9jYXRpb25Bcmc7CiAgICAgICAgICAgIHZhciBwYXRobmFtZSA9IHN0cmlwQmFzZW5hbWUobG9jYXRpb24ucGF0aG5hbWUgfHwgIi8iLCBiYXNlbmFtZSk7CgogICAgICAgICAgICBpZiAocGF0aG5hbWUgPT0gbnVsbCkgewogICAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgICAgICB9CgogICAgICAgICAgICB2YXIgYnJhbmNoZXMgPSBmbGF0dGVuUm91dGVzKHJvdXRlcyk7CiAgICAgICAgICAgIHJhbmtSb3V0ZUJyYW5jaGVzKGJyYW5jaGVzKTsKICAgICAgICAgICAgdmFyIG1hdGNoZXMgPSBudWxsOwoKICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IG1hdGNoZXMgPT0gbnVsbCAmJiBpIDwgYnJhbmNoZXMubGVuZ3RoOyArK2kpIHsKICAgICAgICAgICAgICBtYXRjaGVzID0gbWF0Y2hSb3V0ZUJyYW5jaChicmFuY2hlc1tpXSwgLy8gSW5jb21pbmcgcGF0aG5hbWVzIGFyZSBnZW5lcmFsbHkgZW5jb2RlZCBmcm9tIGVpdGhlciB3aW5kb3cubG9jYXRpb24KICAgICAgICAgICAgICAvLyBvciBmcm9tIHJvdXRlci5uYXZpZ2F0ZSwgYnV0IHdlIHdhbnQgdG8gbWF0Y2ggYWdhaW5zdCB0aGUgdW5lbmNvZGVkCiAgICAgICAgICAgICAgLy8gcGF0aHMgaW4gdGhlIHJvdXRlIGRlZmluaXRpb25zLiAgTWVtb3J5IHJvdXRlciBsb2NhdGlvbnMgd29uJ3QgYmUKICAgICAgICAgICAgICAvLyBlbmNvZGVkIGhlcmUgYnV0IHRoZXJlIGFsc28gc2hvdWxkbid0IGJlIGFueXRoaW5nIHRvIGRlY29kZSBzbyB0aGlzCiAgICAgICAgICAgICAgLy8gc2hvdWxkIGJlIGEgc2FmZSBvcGVyYXRpb24uICBUaGlzIGF2b2lkcyBuZWVkaW5nIG1hdGNoUm91dGVzIHRvIGJlCiAgICAgICAgICAgICAgLy8gaGlzdG9yeS1hd2FyZS4KICAgICAgICAgICAgICBzYWZlbHlEZWNvZGVVUkkocGF0aG5hbWUpKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuIG1hdGNoZXM7CiAgICAgICAgICB9CgogICAgICAgICAgZnVuY3Rpb24gZmxhdHRlblJvdXRlcyhyb3V0ZXMsIGJyYW5jaGVzLCBwYXJlbnRzTWV0YSwgcGFyZW50UGF0aCkgewogICAgICAgICAgICBpZiAoYnJhbmNoZXMgPT09IHZvaWQgMCkgewogICAgICAgICAgICAgIGJyYW5jaGVzID0gW107CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChwYXJlbnRzTWV0YSA9PT0gdm9pZCAwKSB7CiAgICAgICAgICAgICAgcGFyZW50c01ldGEgPSBbXTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKHBhcmVudFBhdGggPT09IHZvaWQgMCkgewogICAgICAgICAgICAgIHBhcmVudFBhdGggPSAiIjsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdmFyIGZsYXR0ZW5Sb3V0ZSA9IChyb3V0ZSwgaW5kZXgsIHJlbGF0aXZlUGF0aCkgPT4gewogICAgICAgICAgICAgIHZhciBtZXRhID0gewogICAgICAgICAgICAgICAgcmVsYXRpdmVQYXRoOiByZWxhdGl2ZVBhdGggPT09IHVuZGVmaW5lZCA/IHJvdXRlLnBhdGggfHwgIiIgOiByZWxhdGl2ZVBhdGgsCiAgICAgICAgICAgICAgICBjYXNlU2Vuc2l0aXZlOiByb3V0ZS5jYXNlU2Vuc2l0aXZlID09PSB0cnVlLAogICAgICAgICAgICAgICAgY2hpbGRyZW5JbmRleDogaW5kZXgsCiAgICAgICAgICAgICAgICByb3V0ZTogcm91dGUKICAgICAgICAgICAgICB9OwoKICAgICAgICAgICAgICBpZiAobWV0YS5yZWxhdGl2ZVBhdGguc3RhcnRzV2l0aCgiLyIpKSB7CiAgICAgICAgICAgICAgICByb3V0ZXJfaW52YXJpYW50KG1ldGEucmVsYXRpdmVQYXRoLnN0YXJ0c1dpdGgocGFyZW50UGF0aCksICJBYnNvbHV0ZSByb3V0ZSBwYXRoIFwiIiArIG1ldGEucmVsYXRpdmVQYXRoICsgIlwiIG5lc3RlZCB1bmRlciBwYXRoICIgKyAoIlwiIiArIHBhcmVudFBhdGggKyAiXCIgaXMgbm90IHZhbGlkLiBBbiBhYnNvbHV0ZSBjaGlsZCByb3V0ZSBwYXRoICIpICsgIm11c3Qgc3RhcnQgd2l0aCB0aGUgY29tYmluZWQgcGF0aCBvZiBhbGwgaXRzIHBhcmVudCByb3V0ZXMuIik7CiAgICAgICAgICAgICAgICBtZXRhLnJlbGF0aXZlUGF0aCA9IG1ldGEucmVsYXRpdmVQYXRoLnNsaWNlKHBhcmVudFBhdGgubGVuZ3RoKTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIHZhciBwYXRoID0gcm91dGVyX2pvaW5QYXRocyhbcGFyZW50UGF0aCwgbWV0YS5yZWxhdGl2ZVBhdGhdKTsKICAgICAgICAgICAgICB2YXIgcm91dGVzTWV0YSA9IHBhcmVudHNNZXRhLmNvbmNhdChtZXRhKTsgLy8gQWRkIHRoZSBjaGlsZHJlbiBiZWZvcmUgYWRkaW5nIHRoaXMgcm91dGUgdG8gdGhlIGFycmF5IHNvIHdlIHRyYXZlcnNlIHRoZQogICAgICAgICAgICAgIC8vIHJvdXRlIHRyZWUgZGVwdGgtZmlyc3QgYW5kIGNoaWxkIHJvdXRlcyBhcHBlYXIgYmVmb3JlIHRoZWlyIHBhcmVudHMgaW4KICAgICAgICAgICAgICAvLyB0aGUgImZsYXR0ZW5lZCIgdmVyc2lvbi4KCiAgICAgICAgICAgICAgaWYgKHJvdXRlLmNoaWxkcmVuICYmIHJvdXRlLmNoaWxkcmVuLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgICAgIHJvdXRlcl9pbnZhcmlhbnQoIC8vIE91ciB0eXBlcyBrbm93IGJldHRlciwgYnV0IHJ1bnRpbWUgSlMgbWF5IG5vdCEKICAgICAgICAgICAgICAgIC8vIEB0cy1leHBlY3QtZXJyb3IKICAgICAgICAgICAgICAgIHJvdXRlLmluZGV4ICE9PSB0cnVlLCAiSW5kZXggcm91dGVzIG11c3Qgbm90IGhhdmUgY2hpbGQgcm91dGVzLiBQbGVhc2UgcmVtb3ZlICIgKyAoImFsbCBjaGlsZCByb3V0ZXMgZnJvbSByb3V0ZSBwYXRoIFwiIiArIHBhdGggKyAiXCIuIikpOwogICAgICAgICAgICAgICAgZmxhdHRlblJvdXRlcyhyb3V0ZS5jaGlsZHJlbiwgYnJhbmNoZXMsIHJvdXRlc01ldGEsIHBhdGgpOwogICAgICAgICAgICAgIH0gLy8gUm91dGVzIHdpdGhvdXQgYSBwYXRoIHNob3VsZG4ndCBldmVyIG1hdGNoIGJ5IHRoZW1zZWx2ZXMgdW5sZXNzIHRoZXkgYXJlCiAgICAgICAgICAgICAgLy8gaW5kZXggcm91dGVzLCBzbyBkb24ndCBhZGQgdGhlbSB0byB0aGUgbGlzdCBvZiBwb3NzaWJsZSBicmFuY2hlcy4KCgogICAgICAgICAgICAgIGlmIChyb3V0ZS5wYXRoID09IG51bGwgJiYgIXJvdXRlLmluZGV4KSB7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBicmFuY2hlcy5wdXNoKHsKICAgICAgICAgICAgICAgIHBhdGg6IHBhdGgsCiAgICAgICAgICAgICAgICBzY29yZTogY29tcHV0ZVNjb3JlKHBhdGgsIHJvdXRlLmluZGV4KSwKICAgICAgICAgICAgICAgIHJvdXRlc01ldGE6IHJvdXRlc01ldGEKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfTsKCiAgICAgICAgICAgIHJvdXRlcy5mb3JFYWNoKChyb3V0ZSwgaW5kZXgpID0+IHsKICAgICAgICAgICAgICB2YXIgX3JvdXRlJHBhdGg7CgogICAgICAgICAgICAgIC8vIGNvYXJzZS1ncmFpbiBjaGVjayBmb3Igb3B0aW9uYWwgcGFyYW1zCiAgICAgICAgICAgICAgaWYgKHJvdXRlLnBhdGggPT09ICIiIHx8ICEoKF9yb3V0ZSRwYXRoID0gcm91dGUucGF0aCkgIT0gbnVsbCAmJiBfcm91dGUkcGF0aC5pbmNsdWRlcygiPyIpKSkgewogICAgICAgICAgICAgICAgZmxhdHRlblJvdXRlKHJvdXRlLCBpbmRleCk7CiAgICAgICAgICAgICAgfSBlbHNlIHt2YXIgX2l0ZXJhdG9yMyA9IF9jcmVhdGVGb3JPZkl0ZXJhdG9ySGVscGVyMigKICAgICAgICAgICAgICAgICAgZXhwbG9kZU9wdGlvbmFsU2VnbWVudHMocm91dGUucGF0aCkpLF9zdGVwMzt0cnkge2ZvciAoX2l0ZXJhdG9yMy5zKCk7ICEoX3N0ZXAzID0gX2l0ZXJhdG9yMy5uKCkpLmRvbmU7KSB7dmFyIGV4cGxvZGVkID0gX3N0ZXAzLnZhbHVlOwogICAgICAgICAgICAgICAgICAgIGZsYXR0ZW5Sb3V0ZShyb3V0ZSwgaW5kZXgsIGV4cGxvZGVkKTsKICAgICAgICAgICAgICAgICAgfX0gY2F0Y2ggKGVycikge19pdGVyYXRvcjMuZShlcnIpO30gZmluYWxseSB7X2l0ZXJhdG9yMy5mKCk7fQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIHJldHVybiBicmFuY2hlczsKICAgICAgICAgIH0KICAgICAgICAgIC8qKgogICAgICAgICAgICogQ29tcHV0ZXMgYWxsIGNvbWJpbmF0aW9ucyBvZiBvcHRpb25hbCBwYXRoIHNlZ21lbnRzIGZvciBhIGdpdmVuIHBhdGgsCiAgICAgICAgICAgKiBleGNsdWRpbmcgY29tYmluYXRpb25zIHRoYXQgYXJlIGFtYmlndW91cyBhbmQgb2YgbG93ZXIgcHJpb3JpdHkuCiAgICAgICAgICAgKgogICAgICAgICAgICogRm9yIGV4YW1wbGUsIGAvb25lLzp0d28/L3RocmVlLzpmb3VyPy86Zml2ZT9gIGV4cGxvZGVzIHRvOgogICAgICAgICAgICogLSBgL29uZS90aHJlZWAKICAgICAgICAgICAqIC0gYC9vbmUvOnR3by90aHJlZWAKICAgICAgICAgICAqIC0gYC9vbmUvdGhyZWUvOmZvdXJgCiAgICAgICAgICAgKiAtIGAvb25lL3RocmVlLzpmaXZlYAogICAgICAgICAgICogLSBgL29uZS86dHdvL3RocmVlLzpmb3VyYAogICAgICAgICAgICogLSBgL29uZS86dHdvL3RocmVlLzpmaXZlYAogICAgICAgICAgICogLSBgL29uZS90aHJlZS86Zm91ci86Zml2ZWAKICAgICAgICAgICAqIC0gYC9vbmUvOnR3by90aHJlZS86Zm91ci86Zml2ZWAKICAgICAgICAgICAqLwoKCiAgICAgICAgICBmdW5jdGlvbiBleHBsb2RlT3B0aW9uYWxTZWdtZW50cyhwYXRoKSB7CiAgICAgICAgICAgIHZhciBzZWdtZW50cyA9IHBhdGguc3BsaXQoIi8iKTsKICAgICAgICAgICAgaWYgKHNlZ21lbnRzLmxlbmd0aCA9PT0gMCkgcmV0dXJuIFtdOwogICAgICAgICAgICB2YXIgX3NlZ21lbnRzID0gX3RvQXJyYXkoc2VnbWVudHMpLGZpcnN0ID0gX3NlZ21lbnRzWzBdLHJlc3QgPSBfc2VnbWVudHMuc2xpY2UoMSk7IC8vIE9wdGlvbmFsIHBhdGggc2VnbWVudHMgYXJlIGRlbm90ZWQgYnkgYSB0cmFpbGluZyBgP2AKCiAgICAgICAgICAgIHZhciBpc09wdGlvbmFsID0gZmlyc3QuZW5kc1dpdGgoIj8iKTsgLy8gQ29tcHV0ZSB0aGUgY29ycmVzcG9uZGluZyByZXF1aXJlZCBzZWdtZW50OiBgZm9vP2AgLT4gYGZvb2AKCiAgICAgICAgICAgIHZhciByZXF1aXJlZCA9IGZpcnN0LnJlcGxhY2UoL1w/JC8sICIiKTsKCiAgICAgICAgICAgIGlmIChyZXN0Lmxlbmd0aCA9PT0gMCkgewogICAgICAgICAgICAgIC8vIEludGVwcmV0IGVtcHR5IHN0cmluZyBhcyBvbWl0dGluZyBhbiBvcHRpb25hbCBzZWdtZW50CiAgICAgICAgICAgICAgLy8gYFsib25lIiwgIiIsICJ0aHJlZSJdYCBjb3JyZXNwb25kcyB0byBvbWl0dGluZyBgOnR3b2AgZnJvbSBgL29uZS86dHdvPy90aHJlZWAgLT4gYC9vbmUvdGhyZWVgCiAgICAgICAgICAgICAgcmV0dXJuIGlzT3B0aW9uYWwgPyBbcmVxdWlyZWQsICIiXSA6IFtyZXF1aXJlZF07CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHZhciByZXN0RXhwbG9kZWQgPSBleHBsb2RlT3B0aW9uYWxTZWdtZW50cyhyZXN0LmpvaW4oIi8iKSk7CiAgICAgICAgICAgIHZhciByZXN1bHQgPSBbXTsgLy8gQWxsIGNoaWxkIHBhdGhzIHdpdGggdGhlIHByZWZpeC4gIERvIHRoaXMgZm9yIGFsbCBjaGlsZHJlbiBiZWZvcmUgdGhlCiAgICAgICAgICAgIC8vIG9wdGlvbmFsIHZlcnNpb24gZm9yIGFsbCBjaGlsZHJlbiBzbyB3ZSBnZXQgY29uc2lzdGVudCBvcmRlcmluZyB3aGVyZSB0aGUKICAgICAgICAgICAgLy8gcGFyZW50IG9wdGlvbmFsIGFzcGVjdCBpcyBwcmVmZXJyZWQgYXMgcmVxdWlyZWQuICBPdGhlcndpc2UsIHdlIGNhbiBnZXQKICAgICAgICAgICAgLy8gY2hpbGQgc2VjdGlvbnMgaW50ZXJzcGVyc2VkIHdoZXJlIGRlZXBlciBvcHRpb25hbCBzZWdtZW50cyBhcmUgaGlnaGVyIHRoYW4KICAgICAgICAgICAgLy8gcGFyZW50IG9wdGlvbmFsIHNlZ21lbnRzLCB3aGVyZSBmb3IgZXhhbXBsZSwgLzp0d28gd291bGQgZXhwbG9kZXMgX2VhcmxpZXJfCiAgICAgICAgICAgIC8vIHRoZW4gLzpvbmUuICBCeSBhbHdheXMgaW5jbHVkaW5nIHRoZSBwYXJlbnQgYXMgcmVxdWlyZWQgX2ZvciBhbGwgY2hpbGRyZW5fCiAgICAgICAgICAgIC8vIGZpcnN0LCB3ZSBhdm9pZCB0aGlzIGlzc3VlCgogICAgICAgICAgICByZXN1bHQucHVzaC5hcHBseShyZXN1bHQsIF90b0NvbnN1bWFibGVBcnJheShyZXN0RXhwbG9kZWQubWFwKChzdWJwYXRoKSA9PiBzdWJwYXRoID09PSAiIiA/IHJlcXVpcmVkIDogW3JlcXVpcmVkLCBzdWJwYXRoXS5qb2luKCIvIikpKSk7IC8vIFRoZW4gaWYgdGhpcyBpcyBhbiBvcHRpb25hbCB2YWx1ZSwgYWRkIGFsbCBjaGlsZCB2ZXJzaW9ucyB3aXRob3V0CgogICAgICAgICAgICBpZiAoaXNPcHRpb25hbCkgewogICAgICAgICAgICAgIHJlc3VsdC5wdXNoLmFwcGx5KHJlc3VsdCwgX3RvQ29uc3VtYWJsZUFycmF5KHJlc3RFeHBsb2RlZCkpOwogICAgICAgICAgICB9IC8vIGZvciBhYnNvbHV0ZSBwYXRocywgZW5zdXJlIGAvYCBpbnN0ZWFkIG9mIGVtcHR5IHNlZ21lbnQKCgogICAgICAgICAgICByZXR1cm4gcmVzdWx0Lm1hcCgoZXhwbG9kZWQpID0+IHBhdGguc3RhcnRzV2l0aCgiLyIpICYmIGV4cGxvZGVkID09PSAiIiA/ICIvIiA6IGV4cGxvZGVkKTsKICAgICAgICAgIH0KCiAgICAgICAgICBmdW5jdGlvbiByYW5rUm91dGVCcmFuY2hlcyhicmFuY2hlcykgewogICAgICAgICAgICBicmFuY2hlcy5zb3J0KChhLCBiKSA9PiBhLnNjb3JlICE9PSBiLnNjb3JlID8gYi5zY29yZSAtIGEuc2NvcmUgLy8gSGlnaGVyIHNjb3JlIGZpcnN0CiAgICAgICAgICAgIDogY29tcGFyZUluZGV4ZXMoYS5yb3V0ZXNNZXRhLm1hcCgobWV0YSkgPT4gbWV0YS5jaGlsZHJlbkluZGV4KSwgYi5yb3V0ZXNNZXRhLm1hcCgobWV0YSkgPT4gbWV0YS5jaGlsZHJlbkluZGV4KSkpOwogICAgICAgICAgfQoKICAgICAgICAgIHZhciBwYXJhbVJlID0gL146XHcrJC87CiAgICAgICAgICB2YXIgZHluYW1pY1NlZ21lbnRWYWx1ZSA9IDM7CiAgICAgICAgICB2YXIgaW5kZXhSb3V0ZVZhbHVlID0gMjsKICAgICAgICAgIHZhciBlbXB0eVNlZ21lbnRWYWx1ZSA9IDE7CiAgICAgICAgICB2YXIgc3RhdGljU2VnbWVudFZhbHVlID0gMTA7CiAgICAgICAgICB2YXIgc3BsYXRQZW5hbHR5ID0gLTI7CgogICAgICAgICAgdmFyIGlzU3BsYXQgPSAocykgPT4gcyA9PT0gIioiOwoKICAgICAgICAgIGZ1bmN0aW9uIGNvbXB1dGVTY29yZShwYXRoLCBpbmRleCkgewogICAgICAgICAgICB2YXIgc2VnbWVudHMgPSBwYXRoLnNwbGl0KCIvIik7CiAgICAgICAgICAgIHZhciBpbml0aWFsU2NvcmUgPSBzZWdtZW50cy5sZW5ndGg7CgogICAgICAgICAgICBpZiAoc2VnbWVudHMuc29tZShpc1NwbGF0KSkgewogICAgICAgICAgICAgIGluaXRpYWxTY29yZSArPSBzcGxhdFBlbmFsdHk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChpbmRleCkgewogICAgICAgICAgICAgIGluaXRpYWxTY29yZSArPSBpbmRleFJvdXRlVmFsdWU7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybiBzZWdtZW50cy5maWx0ZXIoKHMpID0+ICFpc1NwbGF0KHMpKS5yZWR1Y2UoKHNjb3JlLCBzZWdtZW50KSA9PiBzY29yZSArIChwYXJhbVJlLnRlc3Qoc2VnbWVudCkgPyBkeW5hbWljU2VnbWVudFZhbHVlIDogc2VnbWVudCA9PT0gIiIgPyBlbXB0eVNlZ21lbnRWYWx1ZSA6IHN0YXRpY1NlZ21lbnRWYWx1ZSksIGluaXRpYWxTY29yZSk7CiAgICAgICAgICB9CgogICAgICAgICAgZnVuY3Rpb24gY29tcGFyZUluZGV4ZXMoYSwgYikgewogICAgICAgICAgICB2YXIgc2libGluZ3MgPSBhLmxlbmd0aCA9PT0gYi5sZW5ndGggJiYgYS5zbGljZSgwLCAtMSkuZXZlcnkoKG4sIGkpID0+IG4gPT09IGJbaV0pOwogICAgICAgICAgICByZXR1cm4gc2libGluZ3MgPyAvLyBJZiB0d28gcm91dGVzIGFyZSBzaWJsaW5ncywgd2Ugc2hvdWxkIHRyeSB0byBtYXRjaCB0aGUgZWFybGllciBzaWJsaW5nCiAgICAgICAgICAgIC8vIGZpcnN0LiBUaGlzIGFsbG93cyBwZW9wbGUgdG8gaGF2ZSBmaW5lLWdyYWluZWQgY29udHJvbCBvdmVyIHRoZSBtYXRjaGluZwogICAgICAgICAgICAvLyBiZWhhdmlvciBieSBzaW1wbHkgcHV0dGluZyByb3V0ZXMgd2l0aCBpZGVudGljYWwgcGF0aHMgaW4gdGhlIG9yZGVyIHRoZXkKICAgICAgICAgICAgLy8gd2FudCB0aGVtIHRyaWVkLgogICAgICAgICAgICBhW2EubGVuZ3RoIC0gMV0gLSBiW2IubGVuZ3RoIC0gMV0gOiAvLyBPdGhlcndpc2UsIGl0IGRvZXNuJ3QgcmVhbGx5IG1ha2Ugc2Vuc2UgdG8gcmFuayBub24tc2libGluZ3MgYnkgaW5kZXgsCiAgICAgICAgICAgIC8vIHNvIHRoZXkgc29ydCBlcXVhbGx5LgogICAgICAgICAgICAwOwogICAgICAgICAgfQoKICAgICAgICAgIGZ1bmN0aW9uIG1hdGNoUm91dGVCcmFuY2goYnJhbmNoLCBwYXRobmFtZSkgewogICAgICAgICAgICB2YXIKICAgICAgICAgICAgcm91dGVzTWV0YSA9CiAgICAgICAgICAgIGJyYW5jaC5yb3V0ZXNNZXRhOwogICAgICAgICAgICB2YXIgbWF0Y2hlZFBhcmFtcyA9IHt9OwogICAgICAgICAgICB2YXIgbWF0Y2hlZFBhdGhuYW1lID0gIi8iOwogICAgICAgICAgICB2YXIgbWF0Y2hlcyA9IFtdOwoKICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCByb3V0ZXNNZXRhLmxlbmd0aDsgKytpKSB7CiAgICAgICAgICAgICAgdmFyIG1ldGEgPSByb3V0ZXNNZXRhW2ldOwogICAgICAgICAgICAgIHZhciBlbmQgPSBpID09PSByb3V0ZXNNZXRhLmxlbmd0aCAtIDE7CiAgICAgICAgICAgICAgdmFyIHJlbWFpbmluZ1BhdGhuYW1lID0gbWF0Y2hlZFBhdGhuYW1lID09PSAiLyIgPyBwYXRobmFtZSA6IHBhdGhuYW1lLnNsaWNlKG1hdGNoZWRQYXRobmFtZS5sZW5ndGgpIHx8ICIvIjsKICAgICAgICAgICAgICB2YXIgbWF0Y2ggPSByb3V0ZXJfbWF0Y2hQYXRoKHsKICAgICAgICAgICAgICAgIHBhdGg6IG1ldGEucmVsYXRpdmVQYXRoLAogICAgICAgICAgICAgICAgY2FzZVNlbnNpdGl2ZTogbWV0YS5jYXNlU2Vuc2l0aXZlLAogICAgICAgICAgICAgICAgZW5kOiBlbmQKICAgICAgICAgICAgICB9LCByZW1haW5pbmdQYXRobmFtZSk7CiAgICAgICAgICAgICAgaWYgKCFtYXRjaCkgcmV0dXJuIG51bGw7CiAgICAgICAgICAgICAgT2JqZWN0LmFzc2lnbihtYXRjaGVkUGFyYW1zLCBtYXRjaC5wYXJhbXMpOwogICAgICAgICAgICAgIHZhciByb3V0ZSA9IG1ldGEucm91dGU7CiAgICAgICAgICAgICAgbWF0Y2hlcy5wdXNoKHsKICAgICAgICAgICAgICAgIC8vIFRPRE86IENhbiB0aGlzIGFzIGJlIGF2b2lkZWQ/CiAgICAgICAgICAgICAgICBwYXJhbXM6IG1hdGNoZWRQYXJhbXMsCiAgICAgICAgICAgICAgICBwYXRobmFtZTogcm91dGVyX2pvaW5QYXRocyhbbWF0Y2hlZFBhdGhuYW1lLCBtYXRjaC5wYXRobmFtZV0pLAogICAgICAgICAgICAgICAgcGF0aG5hbWVCYXNlOiBub3JtYWxpemVQYXRobmFtZShyb3V0ZXJfam9pblBhdGhzKFttYXRjaGVkUGF0aG5hbWUsIG1hdGNoLnBhdGhuYW1lQmFzZV0pKSwKICAgICAgICAgICAgICAgIHJvdXRlOiByb3V0ZQogICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICBpZiAobWF0Y2gucGF0aG5hbWVCYXNlICE9PSAiLyIpIHsKICAgICAgICAgICAgICAgIG1hdGNoZWRQYXRobmFtZSA9IHJvdXRlcl9qb2luUGF0aHMoW21hdGNoZWRQYXRobmFtZSwgbWF0Y2gucGF0aG5hbWVCYXNlXSk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICByZXR1cm4gbWF0Y2hlczsKICAgICAgICAgIH0KICAgICAgICAgIC8qKgogICAgICAgICAgICogUmV0dXJucyBhIHBhdGggd2l0aCBwYXJhbXMgaW50ZXJwb2xhdGVkLgogICAgICAgICAgICoKICAgICAgICAgICAqIEBzZWUgaHR0cHM6Ly9yZWFjdHJvdXRlci5jb20vdXRpbHMvZ2VuZXJhdGUtcGF0aAogICAgICAgICAgICovCgoKICAgICAgICAgIGZ1bmN0aW9uIGdlbmVyYXRlUGF0aChvcmlnaW5hbFBhdGgsIHBhcmFtcykgewogICAgICAgICAgICBpZiAocGFyYW1zID09PSB2b2lkIDApIHsKICAgICAgICAgICAgICBwYXJhbXMgPSB7fTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdmFyIHBhdGggPSBvcmlnaW5hbFBhdGg7CgogICAgICAgICAgICBpZiAocGF0aC5lbmRzV2l0aCgiKiIpICYmIHBhdGggIT09ICIqIiAmJiAhcGF0aC5lbmRzV2l0aCgiLyoiKSkgewogICAgICAgICAgICAgIHdhcm5pbmcoZmFsc2UsICJSb3V0ZSBwYXRoIFwiIiArIHBhdGggKyAiXCIgd2lsbCBiZSB0cmVhdGVkIGFzIGlmIGl0IHdlcmUgIiArICgiXCIiICsgcGF0aC5yZXBsYWNlKC9cKiQvLCAiLyoiKSArICJcIiBiZWNhdXNlIHRoZSBgKmAgY2hhcmFjdGVyIG11c3QgIikgKyAiYWx3YXlzIGZvbGxvdyBhIGAvYCBpbiB0aGUgcGF0dGVybi4gVG8gZ2V0IHJpZCBvZiB0aGlzIHdhcm5pbmcsICIgKyAoInBsZWFzZSBjaGFuZ2UgdGhlIHJvdXRlIHBhdGggdG8gXCIiICsgcGF0aC5yZXBsYWNlKC9cKiQvLCAiLyoiKSArICJcIi4iKSk7CiAgICAgICAgICAgICAgcGF0aCA9IHBhdGgucmVwbGFjZSgvXCokLywgIi8qIik7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybiBwYXRoLnJlcGxhY2UoL146KFx3KykoXD8/KS9nLCAoXywga2V5LCBvcHRpb25hbCkgPT4gewogICAgICAgICAgICAgIHZhciBwYXJhbSA9IHBhcmFtc1trZXldOwoKICAgICAgICAgICAgICBpZiAob3B0aW9uYWwgPT09ICI/IikgewogICAgICAgICAgICAgICAgcmV0dXJuIHBhcmFtID09IG51bGwgPyAiIiA6IHBhcmFtOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgaWYgKHBhcmFtID09IG51bGwpIHsKICAgICAgICAgICAgICAgIHJvdXRlcl9pbnZhcmlhbnQoZmFsc2UsICJNaXNzaW5nIFwiOiIgKyBrZXkgKyAiXCIgcGFyYW0iKTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIHJldHVybiBwYXJhbTsKICAgICAgICAgICAgfSkucmVwbGFjZSgvXC86KFx3KykoXD8/KS9nLCAoXywga2V5LCBvcHRpb25hbCkgPT4gewogICAgICAgICAgICAgIHZhciBwYXJhbSA9IHBhcmFtc1trZXldOwoKICAgICAgICAgICAgICBpZiAob3B0aW9uYWwgPT09ICI/IikgewogICAgICAgICAgICAgICAgcmV0dXJuIHBhcmFtID09IG51bGwgPyAiIiA6ICIvIiArIHBhcmFtOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgaWYgKHBhcmFtID09IG51bGwpIHsKICAgICAgICAgICAgICAgIHJvdXRlcl9pbnZhcmlhbnQoZmFsc2UsICJNaXNzaW5nIFwiOiIgKyBrZXkgKyAiXCIgcGFyYW0iKTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIHJldHVybiAiLyIgKyBwYXJhbTsKICAgICAgICAgICAgfSkgLy8gUmVtb3ZlIGFueSBvcHRpb25hbCBtYXJrZXJzIGZyb20gb3B0aW9uYWwgc3RhdGljIHNlZ21lbnRzCiAgICAgICAgICAgIC5yZXBsYWNlKC9cPy9nLCAiIikucmVwbGFjZSgvKFwvPylcKi8sIChfLCBwcmVmaXgsIF9fLCBzdHIpID0+IHsKICAgICAgICAgICAgICB2YXIgc3RhciA9ICIqIjsKCiAgICAgICAgICAgICAgaWYgKHBhcmFtc1tzdGFyXSA9PSBudWxsKSB7CiAgICAgICAgICAgICAgICAvLyBJZiBubyBzcGxhdCB3YXMgcHJvdmlkZWQsIHRyaW0gdGhlIHRyYWlsaW5nIHNsYXNoIF91bmxlc3NfIGl0J3MKICAgICAgICAgICAgICAgIC8vIHRoZSBlbnRpcmUgcGF0aAogICAgICAgICAgICAgICAgcmV0dXJuIHN0ciA9PT0gIi8qIiA/ICIvIiA6ICIiOwogICAgICAgICAgICAgIH0gLy8gQXBwbHkgdGhlIHNwbGF0CgoKICAgICAgICAgICAgICByZXR1cm4gIiIgKyBwcmVmaXggKyBwYXJhbXNbc3Rhcl07CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfQogICAgICAgICAgLyoqCiAgICAgICAgICAgKiBQZXJmb3JtcyBwYXR0ZXJuIG1hdGNoaW5nIG9uIGEgVVJMIHBhdGhuYW1lIGFuZCByZXR1cm5zIGluZm9ybWF0aW9uIGFib3V0CiAgICAgICAgICAgKiB0aGUgbWF0Y2guCiAgICAgICAgICAgKgogICAgICAgICAgICogQHNlZSBodHRwczovL3JlYWN0cm91dGVyLmNvbS91dGlscy9tYXRjaC1wYXRoCiAgICAgICAgICAgKi8KCiAgICAgICAgICBmdW5jdGlvbiByb3V0ZXJfbWF0Y2hQYXRoKHBhdHRlcm4sIHBhdGhuYW1lKSB7CiAgICAgICAgICAgIGlmICh0eXBlb2YgcGF0dGVybiA9PT0gInN0cmluZyIpIHsKICAgICAgICAgICAgICBwYXR0ZXJuID0gewogICAgICAgICAgICAgICAgcGF0aDogcGF0dGVybiwKICAgICAgICAgICAgICAgIGNhc2VTZW5zaXRpdmU6IGZhbHNlLAogICAgICAgICAgICAgICAgZW5kOiB0cnVlCiAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdmFyIF9jb21waWxlUGF0aCA9IGNvbXBpbGVQYXRoKHBhdHRlcm4ucGF0aCwgcGF0dGVybi5jYXNlU2Vuc2l0aXZlLCBwYXR0ZXJuLmVuZCksX2NvbXBpbGVQYXRoMiA9IF9zbGljZWRUb0FycmF5MihfY29tcGlsZVBhdGgsIDIpLG1hdGNoZXIgPSBfY29tcGlsZVBhdGgyWzBdLHBhcmFtTmFtZXMgPSBfY29tcGlsZVBhdGgyWzFdOwogICAgICAgICAgICB2YXIgbWF0Y2ggPSBwYXRobmFtZS5tYXRjaChtYXRjaGVyKTsKICAgICAgICAgICAgaWYgKCFtYXRjaCkgcmV0dXJuIG51bGw7CiAgICAgICAgICAgIHZhciBtYXRjaGVkUGF0aG5hbWUgPSBtYXRjaFswXTsKICAgICAgICAgICAgdmFyIHBhdGhuYW1lQmFzZSA9IG1hdGNoZWRQYXRobmFtZS5yZXBsYWNlKC8oLilcLyskLywgIiQxIik7CiAgICAgICAgICAgIHZhciBjYXB0dXJlR3JvdXBzID0gbWF0Y2guc2xpY2UoMSk7CiAgICAgICAgICAgIHZhciBwYXJhbXMgPSBwYXJhbU5hbWVzLnJlZHVjZSgobWVtbywgcGFyYW1OYW1lLCBpbmRleCkgPT4gewogICAgICAgICAgICAgIC8vIFdlIG5lZWQgdG8gY29tcHV0ZSB0aGUgcGF0aG5hbWVCYXNlIGhlcmUgdXNpbmcgdGhlIHJhdyBzcGxhdCB2YWx1ZQogICAgICAgICAgICAgIC8vIGluc3RlYWQgb2YgdXNpbmcgcGFyYW1zWyIqIl0gbGF0ZXIgYmVjYXVzZSBpdCB3aWxsIGJlIGRlY29kZWQgdGhlbgogICAgICAgICAgICAgIGlmIChwYXJhbU5hbWUgPT09ICIqIikgewogICAgICAgICAgICAgICAgdmFyIHNwbGF0VmFsdWUgPSBjYXB0dXJlR3JvdXBzW2luZGV4XSB8fCAiIjsKICAgICAgICAgICAgICAgIHBhdGhuYW1lQmFzZSA9IG1hdGNoZWRQYXRobmFtZS5zbGljZSgwLCBtYXRjaGVkUGF0aG5hbWUubGVuZ3RoIC0gc3BsYXRWYWx1ZS5sZW5ndGgpLnJlcGxhY2UoLyguKVwvKyQvLCAiJDEiKTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIG1lbW9bcGFyYW1OYW1lXSA9IHNhZmVseURlY29kZVVSSUNvbXBvbmVudChjYXB0dXJlR3JvdXBzW2luZGV4XSB8fCAiIiwgcGFyYW1OYW1lKTsKICAgICAgICAgICAgICByZXR1cm4gbWVtbzsKICAgICAgICAgICAgfSwge30pOwogICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgIHBhcmFtczogcGFyYW1zLAogICAgICAgICAgICAgIHBhdGhuYW1lOiBtYXRjaGVkUGF0aG5hbWUsCiAgICAgICAgICAgICAgcGF0aG5hbWVCYXNlOiBwYXRobmFtZUJhc2UsCiAgICAgICAgICAgICAgcGF0dGVybjogcGF0dGVybgogICAgICAgICAgICB9OwogICAgICAgICAgfQoKICAgICAgICAgIGZ1bmN0aW9uIGNvbXBpbGVQYXRoKHBhdGgsIGNhc2VTZW5zaXRpdmUsIGVuZCkgewogICAgICAgICAgICBpZiAoY2FzZVNlbnNpdGl2ZSA9PT0gdm9pZCAwKSB7CiAgICAgICAgICAgICAgY2FzZVNlbnNpdGl2ZSA9IGZhbHNlOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoZW5kID09PSB2b2lkIDApIHsKICAgICAgICAgICAgICBlbmQgPSB0cnVlOwogICAgICAgICAgICB9CgogICAgICAgICAgICB3YXJuaW5nKHBhdGggPT09ICIqIiB8fCAhcGF0aC5lbmRzV2l0aCgiKiIpIHx8IHBhdGguZW5kc1dpdGgoIi8qIiksICJSb3V0ZSBwYXRoIFwiIiArIHBhdGggKyAiXCIgd2lsbCBiZSB0cmVhdGVkIGFzIGlmIGl0IHdlcmUgIiArICgiXCIiICsgcGF0aC5yZXBsYWNlKC9cKiQvLCAiLyoiKSArICJcIiBiZWNhdXNlIHRoZSBgKmAgY2hhcmFjdGVyIG11c3QgIikgKyAiYWx3YXlzIGZvbGxvdyBhIGAvYCBpbiB0aGUgcGF0dGVybi4gVG8gZ2V0IHJpZCBvZiB0aGlzIHdhcm5pbmcsICIgKyAoInBsZWFzZSBjaGFuZ2UgdGhlIHJvdXRlIHBhdGggdG8gXCIiICsgcGF0aC5yZXBsYWNlKC9cKiQvLCAiLyoiKSArICJcIi4iKSk7CiAgICAgICAgICAgIHZhciBwYXJhbU5hbWVzID0gW107CiAgICAgICAgICAgIHZhciByZWdleHBTb3VyY2UgPSAiXiIgKyBwYXRoLnJlcGxhY2UoL1wvKlwqPyQvLCAiIikgLy8gSWdub3JlIHRyYWlsaW5nIC8gYW5kIC8qLCB3ZSdsbCBoYW5kbGUgaXQgYmVsb3cKICAgICAgICAgICAgLnJlcGxhY2UoL15cLyovLCAiLyIpIC8vIE1ha2Ugc3VyZSBpdCBoYXMgYSBsZWFkaW5nIC8KICAgICAgICAgICAgLnJlcGxhY2UoL1tcXC4qK14kP3t9fCgpW1xdXS9nLCAiXFwkJiIpIC8vIEVzY2FwZSBzcGVjaWFsIHJlZ2V4IGNoYXJzCiAgICAgICAgICAgIC5yZXBsYWNlKC9cLzooXHcrKS9nLCAoXywgcGFyYW1OYW1lKSA9PiB7CiAgICAgICAgICAgICAgcGFyYW1OYW1lcy5wdXNoKHBhcmFtTmFtZSk7CiAgICAgICAgICAgICAgcmV0dXJuICIvKFteXFwvXSspIjsKICAgICAgICAgICAgfSk7CgogICAgICAgICAgICBpZiAocGF0aC5lbmRzV2l0aCgiKiIpKSB7CiAgICAgICAgICAgICAgcGFyYW1OYW1lcy5wdXNoKCIqIik7CiAgICAgICAgICAgICAgcmVnZXhwU291cmNlICs9IHBhdGggPT09ICIqIiB8fCBwYXRoID09PSAiLyoiID8gIiguKikkIiAvLyBBbHJlYWR5IG1hdGNoZWQgdGhlIGluaXRpYWwgLywganVzdCBtYXRjaCB0aGUgcmVzdAogICAgICAgICAgICAgIDogIig/OlxcLyguKyl8XFwvKikkIjsgLy8gRG9uJ3QgaW5jbHVkZSB0aGUgLyBpbiBwYXJhbXNbIioiXQogICAgICAgICAgICB9IGVsc2UgaWYgKGVuZCkgewogICAgICAgICAgICAgIC8vIFdoZW4gbWF0Y2hpbmcgdG8gdGhlIGVuZCwgaWdub3JlIHRyYWlsaW5nIHNsYXNoZXMKICAgICAgICAgICAgICByZWdleHBTb3VyY2UgKz0gIlxcLyokIjsKICAgICAgICAgICAgfSBlbHNlIGlmIChwYXRoICE9PSAiIiAmJiBwYXRoICE9PSAiLyIpIHsKICAgICAgICAgICAgICAvLyBJZiBvdXIgcGF0aCBpcyBub24tZW1wdHkgYW5kIGNvbnRhaW5zIGFueXRoaW5nIGJleW9uZCBhbiBpbml0aWFsIHNsYXNoLAogICAgICAgICAgICAgIC8vIHRoZW4gd2UgaGF2ZSBfc29tZV8gZm9ybSBvZiBwYXRoIGluIG91ciByZWdleCBzbyB3ZSBzaG91bGQgZXhwZWN0IHRvCiAgICAgICAgICAgICAgLy8gbWF0Y2ggb25seSBpZiB3ZSBmaW5kIHRoZSBlbmQgb2YgdGhpcyBwYXRoIHNlZ21lbnQuICBMb29rIGZvciBhbiBvcHRpb25hbAogICAgICAgICAgICAgIC8vIG5vbi1jYXB0dXJlZCB0cmFpbGluZyBzbGFzaCAodG8gbWF0Y2ggYSBwb3J0aW9uIG9mIHRoZSBVUkwpIG9yIHRoZSBlbmQKICAgICAgICAgICAgICAvLyBvZiB0aGUgcGF0aCAoaWYgd2UndmUgbWF0Y2hlZCB0byB0aGUgZW5kKS4gIFdlIHVzZWQgdG8gZG8gdGhpcyB3aXRoIGEKICAgICAgICAgICAgICAvLyB3b3JkIGJvdW5kYXJ5IGJ1dCB0aGF0IGdpdmVzIGZhbHNlIHBvc2l0aXZlcyBvbiByb3V0ZXMgbGlrZQogICAgICAgICAgICAgIC8vIC91c2VyLXByZWZlcmVuY2VzIHNpbmNlIGAtYCBjb3VudHMgYXMgYSB3b3JkIGJvdW5kYXJ5LgogICAgICAgICAgICAgIHJlZ2V4cFNvdXJjZSArPSAiKD86KD89XFwvfCQpKSI7CiAgICAgICAgICAgIH0gZWxzZSA7CgogICAgICAgICAgICB2YXIgbWF0Y2hlciA9IG5ldyBSZWdFeHAocmVnZXhwU291cmNlLCBjYXNlU2Vuc2l0aXZlID8gdW5kZWZpbmVkIDogImkiKTsKICAgICAgICAgICAgcmV0dXJuIFttYXRjaGVyLCBwYXJhbU5hbWVzXTsKICAgICAgICAgIH0KCiAgICAgICAgICBmdW5jdGlvbiBzYWZlbHlEZWNvZGVVUkkodmFsdWUpIHsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICByZXR1cm4gZGVjb2RlVVJJKHZhbHVlKTsKICAgICAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICAgICAgICB3YXJuaW5nKGZhbHNlLCAiVGhlIFVSTCBwYXRoIFwiIiArIHZhbHVlICsgIlwiIGNvdWxkIG5vdCBiZSBkZWNvZGVkIGJlY2F1c2UgaXQgaXMgaXMgYSAiICsgIm1hbGZvcm1lZCBVUkwgc2VnbWVudC4gVGhpcyBpcyBwcm9iYWJseSBkdWUgdG8gYSBiYWQgcGVyY2VudCAiICsgKCJlbmNvZGluZyAoIiArIGVycm9yICsgIikuIikpOwogICAgICAgICAgICAgIHJldHVybiB2YWx1ZTsKICAgICAgICAgICAgfQogICAgICAgICAgfQoKICAgICAgICAgIGZ1bmN0aW9uIHNhZmVseURlY29kZVVSSUNvbXBvbmVudCh2YWx1ZSwgcGFyYW1OYW1lKSB7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgcmV0dXJuIGRlY29kZVVSSUNvbXBvbmVudCh2YWx1ZSk7CiAgICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgICAgICAgd2FybmluZyhmYWxzZSwgIlRoZSB2YWx1ZSBmb3IgdGhlIFVSTCBwYXJhbSBcIiIgKyBwYXJhbU5hbWUgKyAiXCIgd2lsbCBub3QgYmUgZGVjb2RlZCBiZWNhdXNlIiArICgiIHRoZSBzdHJpbmcgXCIiICsgdmFsdWUgKyAiXCIgaXMgYSBtYWxmb3JtZWQgVVJMIHNlZ21lbnQuIFRoaXMgaXMgcHJvYmFibHkiKSArICgiIGR1ZSB0byBhIGJhZCBwZXJjZW50IGVuY29kaW5nICgiICsgZXJyb3IgKyAiKS4iKSk7CiAgICAgICAgICAgICAgcmV0dXJuIHZhbHVlOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICAvKioKICAgICAgICAgICAqIEBwcml2YXRlCiAgICAgICAgICAgKi8KCgogICAgICAgICAgZnVuY3Rpb24gc3RyaXBCYXNlbmFtZShwYXRobmFtZSwgYmFzZW5hbWUpIHsKICAgICAgICAgICAgaWYgKGJhc2VuYW1lID09PSAiLyIpIHJldHVybiBwYXRobmFtZTsKCiAgICAgICAgICAgIGlmICghcGF0aG5hbWUudG9Mb3dlckNhc2UoKS5zdGFydHNXaXRoKGJhc2VuYW1lLnRvTG93ZXJDYXNlKCkpKSB7CiAgICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgICAgIH0gLy8gV2Ugd2FudCB0byBsZWF2ZSB0cmFpbGluZyBzbGFzaCBiZWhhdmlvciBpbiB0aGUgdXNlcidzIGNvbnRyb2wsIHNvIGlmIHRoZXkKICAgICAgICAgICAgLy8gc3BlY2lmeSBhIGJhc2VuYW1lIHdpdGggYSB0cmFpbGluZyBzbGFzaCwgd2Ugc2hvdWxkIHN1cHBvcnQgaXQKCgogICAgICAgICAgICB2YXIgc3RhcnRJbmRleCA9IGJhc2VuYW1lLmVuZHNXaXRoKCIvIikgPyBiYXNlbmFtZS5sZW5ndGggLSAxIDogYmFzZW5hbWUubGVuZ3RoOwogICAgICAgICAgICB2YXIgbmV4dENoYXIgPSBwYXRobmFtZS5jaGFyQXQoc3RhcnRJbmRleCk7CgogICAgICAgICAgICBpZiAobmV4dENoYXIgJiYgbmV4dENoYXIgIT09ICIvIikgewogICAgICAgICAgICAgIC8vIHBhdGhuYW1lIGRvZXMgbm90IHN0YXJ0IHdpdGggYmFzZW5hbWUvCiAgICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybiBwYXRobmFtZS5zbGljZShzdGFydEluZGV4KSB8fCAiLyI7CiAgICAgICAgICB9CiAgICAgICAgICAvKioKICAgICAgICAgICAqIEBwcml2YXRlCiAgICAgICAgICAgKi8KCiAgICAgICAgICBmdW5jdGlvbiB3YXJuaW5nKGNvbmQsIG1lc3NhZ2UpIHsKICAgICAgICAgICAgaWYgKCFjb25kKSB7CiAgICAgICAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG5vLWNvbnNvbGUKICAgICAgICAgICAgICBpZiAodHlwZW9mIGNvbnNvbGUgIT09ICJ1bmRlZmluZWQiKSBjb25zb2xlLndhcm4obWVzc2FnZSk7CgogICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAvLyBXZWxjb21lIHRvIGRlYnVnZ2luZyBAcmVtaXgtcnVuL3JvdXRlciEKICAgICAgICAgICAgICAgIC8vCiAgICAgICAgICAgICAgICAvLyBUaGlzIGVycm9yIGlzIHRocm93biBhcyBhIGNvbnZlbmllbmNlIHNvIHlvdSBjYW4gbW9yZSBlYXNpbHkKICAgICAgICAgICAgICAgIC8vIGZpbmQgdGhlIHNvdXJjZSBmb3IgYSB3YXJuaW5nIHRoYXQgYXBwZWFycyBpbiB0aGUgY29uc29sZSBieQogICAgICAgICAgICAgICAgLy8gZW5hYmxpbmcgInBhdXNlIG9uIGV4Y2VwdGlvbnMiIGluIHlvdXIgSmF2YVNjcmlwdCBkZWJ1Z2dlci4KICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihtZXNzYWdlKTsgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG5vLWVtcHR5CiAgICAgICAgICAgICAgfSBjYXRjaCAoZSkge30KICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgLyoqCiAgICAgICAgICAgKiBSZXR1cm5zIGEgcmVzb2x2ZWQgcGF0aCBvYmplY3QgcmVsYXRpdmUgdG8gdGhlIGdpdmVuIHBhdGhuYW1lLgogICAgICAgICAgICoKICAgICAgICAgICAqIEBzZWUgaHR0cHM6Ly9yZWFjdHJvdXRlci5jb20vdXRpbHMvcmVzb2x2ZS1wYXRoCiAgICAgICAgICAgKi8KCiAgICAgICAgICBmdW5jdGlvbiByZXNvbHZlUGF0aCh0bywgZnJvbVBhdGhuYW1lKSB7CiAgICAgICAgICAgIGlmIChmcm9tUGF0aG5hbWUgPT09IHZvaWQgMCkgewogICAgICAgICAgICAgIGZyb21QYXRobmFtZSA9ICIvIjsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdmFyIF9yZWYxMiA9CgoKCiAgICAgICAgICAgICAgdHlwZW9mIHRvID09PSAic3RyaW5nIiA/IHBhcnNlUGF0aCh0bykgOiB0byx0b1BhdGhuYW1lID0gX3JlZjEyLnBhdGhuYW1lLF9yZWYxMiRzZWFyY2ggPSBfcmVmMTIuc2VhcmNoLHNlYXJjaCA9IF9yZWYxMiRzZWFyY2ggPT09IHZvaWQgMCA/ICIiIDogX3JlZjEyJHNlYXJjaCxfcmVmMTIkaGFzaCA9IF9yZWYxMi5oYXNoLGhhc2ggPSBfcmVmMTIkaGFzaCA9PT0gdm9pZCAwID8gIiIgOiBfcmVmMTIkaGFzaDsKICAgICAgICAgICAgdmFyIHBhdGhuYW1lID0gdG9QYXRobmFtZSA/IHRvUGF0aG5hbWUuc3RhcnRzV2l0aCgiLyIpID8gdG9QYXRobmFtZSA6IHJlc29sdmVQYXRobmFtZSh0b1BhdGhuYW1lLCBmcm9tUGF0aG5hbWUpIDogZnJvbVBhdGhuYW1lOwogICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgIHBhdGhuYW1lOiBwYXRobmFtZSwKICAgICAgICAgICAgICBzZWFyY2g6IG5vcm1hbGl6ZVNlYXJjaChzZWFyY2gpLAogICAgICAgICAgICAgIGhhc2g6IG5vcm1hbGl6ZUhhc2goaGFzaCkKICAgICAgICAgICAgfTsKICAgICAgICAgIH0KCiAgICAgICAgICBmdW5jdGlvbiByZXNvbHZlUGF0aG5hbWUocmVsYXRpdmVQYXRoLCBmcm9tUGF0aG5hbWUpIHsKICAgICAgICAgICAgdmFyIHNlZ21lbnRzID0gZnJvbVBhdGhuYW1lLnJlcGxhY2UoL1wvKyQvLCAiIikuc3BsaXQoIi8iKTsKICAgICAgICAgICAgdmFyIHJlbGF0aXZlU2VnbWVudHMgPSByZWxhdGl2ZVBhdGguc3BsaXQoIi8iKTsKICAgICAgICAgICAgcmVsYXRpdmVTZWdtZW50cy5mb3JFYWNoKChzZWdtZW50KSA9PiB7CiAgICAgICAgICAgICAgaWYgKHNlZ21lbnQgPT09ICIuLiIpIHsKICAgICAgICAgICAgICAgIC8vIEtlZXAgdGhlIHJvb3QgIiIgc2VnbWVudCBzbyB0aGUgcGF0aG5hbWUgc3RhcnRzIGF0IC8KICAgICAgICAgICAgICAgIGlmIChzZWdtZW50cy5sZW5ndGggPiAxKSBzZWdtZW50cy5wb3AoKTsKICAgICAgICAgICAgICB9IGVsc2UgaWYgKHNlZ21lbnQgIT09ICIuIikgewogICAgICAgICAgICAgICAgc2VnbWVudHMucHVzaChzZWdtZW50KTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICByZXR1cm4gc2VnbWVudHMubGVuZ3RoID4gMSA/IHNlZ21lbnRzLmpvaW4oIi8iKSA6ICIvIjsKICAgICAgICAgIH0KCiAgICAgICAgICBmdW5jdGlvbiBnZXRJbnZhbGlkUGF0aEVycm9yKGNoYXIsIGZpZWxkLCBkZXN0LCBwYXRoKSB7CiAgICAgICAgICAgIHJldHVybiAiQ2Fubm90IGluY2x1ZGUgYSAnIiArIGNoYXIgKyAiJyBjaGFyYWN0ZXIgaW4gYSBtYW51YWxseSBzcGVjaWZpZWQgIiArICgiYHRvLiIgKyBmaWVsZCArICJgIGZpZWxkIFsiICsgSlNPTi5zdHJpbmdpZnkocGF0aCkgKyAiXS4gIFBsZWFzZSBzZXBhcmF0ZSBpdCBvdXQgdG8gdGhlICIpICsgKCJgdG8uIiArIGRlc3QgKyAiYCBmaWVsZC4gQWx0ZXJuYXRpdmVseSB5b3UgbWF5IHByb3ZpZGUgdGhlIGZ1bGwgcGF0aCBhcyAiKSArICJhIHN0cmluZyBpbiA8TGluayB0bz1cIi4uLlwiPiBhbmQgdGhlIHJvdXRlciB3aWxsIHBhcnNlIGl0IGZvciB5b3UuIjsKICAgICAgICAgIH0KICAgICAgICAgIC8qKgogICAgICAgICAgICogQHByaXZhdGUKICAgICAgICAgICAqCiAgICAgICAgICAgKiBXaGVuIHByb2Nlc3NpbmcgcmVsYXRpdmUgbmF2aWdhdGlvbiB3ZSB3YW50IHRvIGlnbm9yZSBhbmNlc3RvciByb3V0ZXMgdGhhdAogICAgICAgICAgICogZG8gbm90IGNvbnRyaWJ1dGUgdG8gdGhlIHBhdGgsIHN1Y2ggdGhhdCBpbmRleC9wYXRobGVzcyBsYXlvdXQgcm91dGVzIGRvbid0CiAgICAgICAgICAgKiBpbnRlcmZlcmUuCiAgICAgICAgICAgKgogICAgICAgICAgICogRm9yIGV4YW1wbGUsIHdoZW4gbW92aW5nIGEgcm91dGUgZWxlbWVudCBpbnRvIGFuIGluZGV4IHJvdXRlIGFuZC9vciBhCiAgICAgICAgICAgKiBwYXRobGVzcyBsYXlvdXQgcm91dGUsIHJlbGF0aXZlIGxpbmsgYmVoYXZpb3IgY29udGFpbmVkIHdpdGhpbiBzaG91bGQgc3RheQogICAgICAgICAgICogdGhlIHNhbWUuICBCb3RoIG9mIHRoZSBmb2xsb3dpbmcgZXhhbXBsZXMgc2hvdWxkIGxpbmsgYmFjayB0byB0aGUgcm9vdDoKICAgICAgICAgICAqCiAgICAgICAgICAgKiAgIDxSb3V0ZSBwYXRoPSIvIj4KICAgICAgICAgICAqICAgICA8Um91dGUgcGF0aD0iYWNjb3VudHMiIGVsZW1lbnQ9ezxMaW5rIHRvPSIuLiJ9PgogICAgICAgICAgICogICA8L1JvdXRlPgogICAgICAgICAgICoKICAgICAgICAgICAqICAgPFJvdXRlIHBhdGg9Ii8iPgogICAgICAgICAgICogICAgIDxSb3V0ZSBwYXRoPSJhY2NvdW50cyI+CiAgICAgICAgICAgKiAgICAgICA8Um91dGUgZWxlbWVudD17PEFjY291bnRzTGF5b3V0IC8+fT4gICAgICAgLy8gPC0tIERvZXMgbm90IGNvbnRyaWJ1dGUKICAgICAgICAgICAqICAgICAgICAgPFJvdXRlIGluZGV4IGVsZW1lbnQ9ezxMaW5rIHRvPSIuLiJ9IC8+ICAvLyA8LS0gRG9lcyBub3QgY29udHJpYnV0ZQogICAgICAgICAgICogICAgICAgPC9Sb3V0ZQogICAgICAgICAgICogICAgIDwvUm91dGU+CiAgICAgICAgICAgKiAgIDwvUm91dGU+CiAgICAgICAgICAgKi8KCgogICAgICAgICAgZnVuY3Rpb24gZ2V0UGF0aENvbnRyaWJ1dGluZ01hdGNoZXMobWF0Y2hlcykgewogICAgICAgICAgICByZXR1cm4gbWF0Y2hlcy5maWx0ZXIoKG1hdGNoLCBpbmRleCkgPT4gaW5kZXggPT09IDAgfHwgbWF0Y2gucm91dGUucGF0aCAmJiBtYXRjaC5yb3V0ZS5wYXRoLmxlbmd0aCA+IDApOwogICAgICAgICAgfQogICAgICAgICAgLyoqCiAgICAgICAgICAgKiBAcHJpdmF0ZQogICAgICAgICAgICovCgogICAgICAgICAgZnVuY3Rpb24gcmVzb2x2ZVRvKHRvQXJnLCByb3V0ZVBhdGhuYW1lcywgbG9jYXRpb25QYXRobmFtZSwgaXNQYXRoUmVsYXRpdmUpIHsKICAgICAgICAgICAgaWYgKGlzUGF0aFJlbGF0aXZlID09PSB2b2lkIDApIHsKICAgICAgICAgICAgICBpc1BhdGhSZWxhdGl2ZSA9IGZhbHNlOwogICAgICAgICAgICB9CgogICAgICAgICAgICB2YXIgdG87CgogICAgICAgICAgICBpZiAodHlwZW9mIHRvQXJnID09PSAic3RyaW5nIikgewogICAgICAgICAgICAgIHRvID0gcGFyc2VQYXRoKHRvQXJnKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICB0byA9IF9leHRlbmRzKHt9LCB0b0FyZyk7CiAgICAgICAgICAgICAgcm91dGVyX2ludmFyaWFudCghdG8ucGF0aG5hbWUgfHwgIXRvLnBhdGhuYW1lLmluY2x1ZGVzKCI/IiksIGdldEludmFsaWRQYXRoRXJyb3IoIj8iLCAicGF0aG5hbWUiLCAic2VhcmNoIiwgdG8pKTsKICAgICAgICAgICAgICByb3V0ZXJfaW52YXJpYW50KCF0by5wYXRobmFtZSB8fCAhdG8ucGF0aG5hbWUuaW5jbHVkZXMoIiMiKSwgZ2V0SW52YWxpZFBhdGhFcnJvcigiIyIsICJwYXRobmFtZSIsICJoYXNoIiwgdG8pKTsKICAgICAgICAgICAgICByb3V0ZXJfaW52YXJpYW50KCF0by5zZWFyY2ggfHwgIXRvLnNlYXJjaC5pbmNsdWRlcygiIyIpLCBnZXRJbnZhbGlkUGF0aEVycm9yKCIjIiwgInNlYXJjaCIsICJoYXNoIiwgdG8pKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdmFyIGlzRW1wdHlQYXRoID0gdG9BcmcgPT09ICIiIHx8IHRvLnBhdGhuYW1lID09PSAiIjsKICAgICAgICAgICAgdmFyIHRvUGF0aG5hbWUgPSBpc0VtcHR5UGF0aCA/ICIvIiA6IHRvLnBhdGhuYW1lOwogICAgICAgICAgICB2YXIgZnJvbTsgLy8gUm91dGluZyBpcyByZWxhdGl2ZSB0byB0aGUgY3VycmVudCBwYXRobmFtZSBpZiBleHBsaWNpdGx5IHJlcXVlc3RlZC4KICAgICAgICAgICAgLy8KICAgICAgICAgICAgLy8gSWYgYSBwYXRobmFtZSBpcyBleHBsaWNpdGx5IHByb3ZpZGVkIGluIGB0b2AsIGl0IHNob3VsZCBiZSByZWxhdGl2ZSB0byB0aGUKICAgICAgICAgICAgLy8gcm91dGUgY29udGV4dC4gVGhpcyBpcyBleHBsYWluZWQgaW4gYE5vdGUgb24gYDxMaW5rIHRvPmAgdmFsdWVzYCBpbiBvdXIKICAgICAgICAgICAgLy8gbWlncmF0aW9uIGd1aWRlIGZyb20gdjUgYXMgYSBtZWFucyBvZiBkaXNhbWJpZ3VhdGlvbiBiZXR3ZWVuIGB0b2AgdmFsdWVzCiAgICAgICAgICAgIC8vIHRoYXQgYmVnaW4gd2l0aCBgL2AgYW5kIHRob3NlIHRoYXQgZG8gbm90LiBIb3dldmVyLCB0aGlzIGlzIHByb2JsZW1hdGljIGZvcgogICAgICAgICAgICAvLyBgdG9gIHZhbHVlcyB0aGF0IGRvIG5vdCBwcm92aWRlIGEgcGF0aG5hbWUuIGB0b2AgY2FuIHNpbXBseSBiZSBhIHNlYXJjaCBvcgogICAgICAgICAgICAvLyBoYXNoIHN0cmluZywgaW4gd2hpY2ggY2FzZSB3ZSBzaG91bGQgYXNzdW1lIHRoYXQgdGhlIG5hdmlnYXRpb24gaXMgcmVsYXRpdmUKICAgICAgICAgICAgLy8gdG8gdGhlIGN1cnJlbnQgbG9jYXRpb24ncyBwYXRobmFtZSBhbmQgKm5vdCogdGhlIHJvdXRlIHBhdGhuYW1lLgoKICAgICAgICAgICAgaWYgKGlzUGF0aFJlbGF0aXZlIHx8IHRvUGF0aG5hbWUgPT0gbnVsbCkgewogICAgICAgICAgICAgIGZyb20gPSBsb2NhdGlvblBhdGhuYW1lOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIHZhciByb3V0ZVBhdGhuYW1lSW5kZXggPSByb3V0ZVBhdGhuYW1lcy5sZW5ndGggLSAxOwoKICAgICAgICAgICAgICBpZiAodG9QYXRobmFtZS5zdGFydHNXaXRoKCIuLiIpKSB7CiAgICAgICAgICAgICAgICB2YXIgdG9TZWdtZW50cyA9IHRvUGF0aG5hbWUuc3BsaXQoIi8iKTsgLy8gRWFjaCBsZWFkaW5nIC4uIHNlZ21lbnQgbWVhbnMgImdvIHVwIG9uZSByb3V0ZSIgaW5zdGVhZCBvZiAiZ28gdXAgb25lCiAgICAgICAgICAgICAgICAvLyBVUkwgc2VnbWVudCIuICBUaGlzIGlzIGEga2V5IGRpZmZlcmVuY2UgZnJvbSBob3cgPGEgaHJlZj4gd29ya3MgYW5kIGEKICAgICAgICAgICAgICAgIC8vIG1ham9yIHJlYXNvbiB3ZSBjYWxsIHRoaXMgYSAidG8iIHZhbHVlIGluc3RlYWQgb2YgYSAiaHJlZiIuCgogICAgICAgICAgICAgICAgd2hpbGUgKHRvU2VnbWVudHNbMF0gPT09ICIuLiIpIHsKICAgICAgICAgICAgICAgICAgdG9TZWdtZW50cy5zaGlmdCgpOwogICAgICAgICAgICAgICAgICByb3V0ZVBhdGhuYW1lSW5kZXggLT0gMTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICB0by5wYXRobmFtZSA9IHRvU2VnbWVudHMuam9pbigiLyIpOwogICAgICAgICAgICAgIH0gLy8gSWYgdGhlcmUgYXJlIG1vcmUgIi4uIiBzZWdtZW50cyB0aGFuIHBhcmVudCByb3V0ZXMsIHJlc29sdmUgcmVsYXRpdmUgdG8KICAgICAgICAgICAgICAvLyB0aGUgcm9vdCAvIFVSTC4KCgogICAgICAgICAgICAgIGZyb20gPSByb3V0ZVBhdGhuYW1lSW5kZXggPj0gMCA/IHJvdXRlUGF0aG5hbWVzW3JvdXRlUGF0aG5hbWVJbmRleF0gOiAiLyI7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHZhciBwYXRoID0gcmVzb2x2ZVBhdGgodG8sIGZyb20pOyAvLyBFbnN1cmUgdGhlIHBhdGhuYW1lIGhhcyBhIHRyYWlsaW5nIHNsYXNoIGlmIHRoZSBvcmlnaW5hbCAidG8iIGhhZCBvbmUKCiAgICAgICAgICAgIHZhciBoYXNFeHBsaWNpdFRyYWlsaW5nU2xhc2ggPSB0b1BhdGhuYW1lICYmIHRvUGF0aG5hbWUgIT09ICIvIiAmJiB0b1BhdGhuYW1lLmVuZHNXaXRoKCIvIik7IC8vIE9yIGlmIHRoaXMgd2FzIGEgbGluayB0byB0aGUgY3VycmVudCBwYXRoIHdoaWNoIGhhcyBhIHRyYWlsaW5nIHNsYXNoCgogICAgICAgICAgICB2YXIgaGFzQ3VycmVudFRyYWlsaW5nU2xhc2ggPSAoaXNFbXB0eVBhdGggfHwgdG9QYXRobmFtZSA9PT0gIi4iKSAmJiBsb2NhdGlvblBhdGhuYW1lLmVuZHNXaXRoKCIvIik7CgogICAgICAgICAgICBpZiAoIXBhdGgucGF0aG5hbWUuZW5kc1dpdGgoIi8iKSAmJiAoaGFzRXhwbGljaXRUcmFpbGluZ1NsYXNoIHx8IGhhc0N1cnJlbnRUcmFpbGluZ1NsYXNoKSkgewogICAgICAgICAgICAgIHBhdGgucGF0aG5hbWUgKz0gIi8iOwogICAgICAgICAgICB9CgogICAgICAgICAgICByZXR1cm4gcGF0aDsKICAgICAgICAgIH0KICAgICAgICAgIC8qKgogICAgICAgICAgICogQHByaXZhdGUKICAgICAgICAgICAqLwoKICAgICAgICAgIGZ1bmN0aW9uIGdldFRvUGF0aG5hbWUodG8pIHsKICAgICAgICAgICAgLy8gRW1wdHkgc3RyaW5ncyBzaG91bGQgYmUgdHJlYXRlZCB0aGUgc2FtZSBhcyAvIHBhdGhzCiAgICAgICAgICAgIHJldHVybiB0byA9PT0gIiIgfHwgdG8ucGF0aG5hbWUgPT09ICIiID8gIi8iIDogdHlwZW9mIHRvID09PSAic3RyaW5nIiA/IHBhcnNlUGF0aCh0bykucGF0aG5hbWUgOiB0by5wYXRobmFtZTsKICAgICAgICAgIH0KICAgICAgICAgIC8qKgogICAgICAgICAgICogQHByaXZhdGUKICAgICAgICAgICAqLwoKICAgICAgICAgIHZhciByb3V0ZXJfam9pblBhdGhzID0gKHBhdGhzKSA9PiBwYXRocy5qb2luKCIvIikucmVwbGFjZSgvXC9cLysvZywgIi8iKTsKICAgICAgICAgIC8qKgogICAgICAgICAgICogQHByaXZhdGUKICAgICAgICAgICAqLwoKICAgICAgICAgIHZhciBub3JtYWxpemVQYXRobmFtZSA9IChwYXRobmFtZSkgPT4gcGF0aG5hbWUucmVwbGFjZSgvXC8rJC8sICIiKS5yZXBsYWNlKC9eXC8qLywgIi8iKTsKICAgICAgICAgIC8qKgogICAgICAgICAgICogQHByaXZhdGUKICAgICAgICAgICAqLwoKICAgICAgICAgIHZhciBub3JtYWxpemVTZWFyY2ggPSAoc2VhcmNoKSA9PiAhc2VhcmNoIHx8IHNlYXJjaCA9PT0gIj8iID8gIiIgOiBzZWFyY2guc3RhcnRzV2l0aCgiPyIpID8gc2VhcmNoIDogIj8iICsgc2VhcmNoOwogICAgICAgICAgLyoqCiAgICAgICAgICAgKiBAcHJpdmF0ZQogICAgICAgICAgICovCgogICAgICAgICAgdmFyIG5vcm1hbGl6ZUhhc2ggPSAoaGFzaCkgPT4gIWhhc2ggfHwgaGFzaCA9PT0gIiMiID8gIiIgOiBoYXNoLnN0YXJ0c1dpdGgoIiMiKSA/IGhhc2ggOiAiIyIgKyBoYXNoOwogICAgICAgICAgLyoqCiAgICAgICAgICAgKiBUaGlzIGlzIGEgc2hvcnRjdXQgZm9yIGNyZWF0aW5nIGBhcHBsaWNhdGlvbi9qc29uYCByZXNwb25zZXMuIENvbnZlcnRzIGBkYXRhYAogICAgICAgICAgICogdG8gSlNPTiBhbmQgc2V0cyB0aGUgYENvbnRlbnQtVHlwZWAgaGVhZGVyLgogICAgICAgICAgICovCgogICAgICAgICAgdmFyIGpzb24gPSBmdW5jdGlvbiBqc29uKGRhdGEsIGluaXQpIHsKICAgICAgICAgICAgaWYgKGluaXQgPT09IHZvaWQgMCkgewogICAgICAgICAgICAgIGluaXQgPSB7fTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdmFyIHJlc3BvbnNlSW5pdCA9IHR5cGVvZiBpbml0ID09PSAibnVtYmVyIiA/IHsKICAgICAgICAgICAgICBzdGF0dXM6IGluaXQKICAgICAgICAgICAgfSA6IGluaXQ7CiAgICAgICAgICAgIHZhciBoZWFkZXJzID0gbmV3IEhlYWRlcnMocmVzcG9uc2VJbml0LmhlYWRlcnMpOwoKICAgICAgICAgICAgaWYgKCFoZWFkZXJzLmhhcygiQ29udGVudC1UeXBlIikpIHsKICAgICAgICAgICAgICBoZWFkZXJzLnNldCgiQ29udGVudC1UeXBlIiwgImFwcGxpY2F0aW9uL2pzb247IGNoYXJzZXQ9dXRmLTgiKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuIG5ldyBSZXNwb25zZShKU09OLnN0cmluZ2lmeShkYXRhKSwgX2V4dGVuZHMoe30sIHJlc3BvbnNlSW5pdCwgewogICAgICAgICAgICAgIGhlYWRlcnM6IGhlYWRlcnMKICAgICAgICAgICAgfSkpOwogICAgICAgICAgfTt2YXIKICAgICAgICAgIHJvdXRlcl9BYm9ydGVkRGVmZXJyZWRFcnJvciA9IC8qI19fUFVSRV9fKi9mdW5jdGlvbiAoX0Vycm9yKSB7X2luaGVyaXRzKHJvdXRlcl9BYm9ydGVkRGVmZXJyZWRFcnJvciwgX0Vycm9yKTt2YXIgX3N1cGVyID0gX2NyZWF0ZVN1cGVyKHJvdXRlcl9BYm9ydGVkRGVmZXJyZWRFcnJvcik7ZnVuY3Rpb24gcm91dGVyX0Fib3J0ZWREZWZlcnJlZEVycm9yKCkge19jbGFzc0NhbGxDaGVjazIodGhpcywgcm91dGVyX0Fib3J0ZWREZWZlcnJlZEVycm9yKTtyZXR1cm4gX3N1cGVyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7fXJldHVybiBfY3JlYXRlQ2xhc3MyKHJvdXRlcl9BYm9ydGVkRGVmZXJyZWRFcnJvcik7fSggLyojX19QVVJFX18qL193cmFwTmF0aXZlU3VwZXIoRXJyb3IpKTt2YXIKICAgICAgICAgIERlZmVycmVkRGF0YSA9IC8qI19fUFVSRV9fKi9mdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIGZ1bmN0aW9uIERlZmVycmVkRGF0YShkYXRhLCByZXNwb25zZUluaXQpIHtfY2xhc3NDYWxsQ2hlY2syKHRoaXMsIERlZmVycmVkRGF0YSk7CiAgICAgICAgICAgICAgdGhpcy5wZW5kaW5nS2V5c1NldCA9IG5ldyBTZXQoKTsKICAgICAgICAgICAgICB0aGlzLnN1YnNjcmliZXJzID0gbmV3IFNldCgpOwogICAgICAgICAgICAgIHRoaXMuZGVmZXJyZWRLZXlzID0gW107CiAgICAgICAgICAgICAgcm91dGVyX2ludmFyaWFudChkYXRhICYmIHR5cGVvZiBkYXRhID09PSAib2JqZWN0IiAmJiAhQXJyYXkuaXNBcnJheShkYXRhKSwgImRlZmVyKCkgb25seSBhY2NlcHRzIHBsYWluIG9iamVjdHMiKTsgLy8gU2V0IHVwIGFuIEFib3J0Q29udHJvbGxlciArIFByb21pc2Ugd2UgY2FuIHJhY2UgYWdhaW5zdCB0byBleGl0IGVhcmx5CiAgICAgICAgICAgICAgLy8gY2FuY2VsbGF0aW9uCgogICAgICAgICAgICAgIHZhciByZWplY3Q7CiAgICAgICAgICAgICAgdGhpcy5hYm9ydFByb21pc2UgPSBuZXcgUHJvbWlzZSgoXywgcikgPT4gcmVqZWN0ID0gcik7CiAgICAgICAgICAgICAgdGhpcy5jb250cm9sbGVyID0gbmV3IEFib3J0Q29udHJvbGxlcigpOwoKICAgICAgICAgICAgICB2YXIgb25BYm9ydCA9ICgpID0+IHJlamVjdChuZXcgcm91dGVyX0Fib3J0ZWREZWZlcnJlZEVycm9yKCJEZWZlcnJlZCBkYXRhIGFib3J0ZWQiKSk7CgogICAgICAgICAgICAgIHRoaXMudW5saXN0ZW5BYm9ydFNpZ25hbCA9ICgpID0+IHRoaXMuY29udHJvbGxlci5zaWduYWwucmVtb3ZlRXZlbnRMaXN0ZW5lcigiYWJvcnQiLCBvbkFib3J0KTsKCiAgICAgICAgICAgICAgdGhpcy5jb250cm9sbGVyLnNpZ25hbC5hZGRFdmVudExpc3RlbmVyKCJhYm9ydCIsIG9uQWJvcnQpOwogICAgICAgICAgICAgIHRoaXMuZGF0YSA9IE9iamVjdC5lbnRyaWVzKGRhdGEpLnJlZHVjZSgoYWNjLCBfcmVmKSA9PiB7CiAgICAgICAgICAgICAgICB2YXIgX3JlZjEzID0gX3NsaWNlZFRvQXJyYXkyKF9yZWYsIDIpLGtleSA9IF9yZWYxM1swXSx2YWx1ZSA9IF9yZWYxM1sxXTsKICAgICAgICAgICAgICAgIHJldHVybiBPYmplY3QuYXNzaWduKGFjYywgX2RlZmluZVByb3BlcnR5Mih7fSwKICAgICAgICAgICAgICAgIGtleSwgdGhpcy50cmFja1Byb21pc2Uoa2V5LCB2YWx1ZSkpKTsKCiAgICAgICAgICAgICAgfSwge30pOwogICAgICAgICAgICAgIHRoaXMuaW5pdCA9IHJlc3BvbnNlSW5pdDsKICAgICAgICAgICAgfV9jcmVhdGVDbGFzczIoRGVmZXJyZWREYXRhLCBbeyBrZXk6ICJ0cmFja1Byb21pc2UiLCB2YWx1ZToKCiAgICAgICAgICAgICAgZnVuY3Rpb24gdHJhY2tQcm9taXNlKGtleSwgdmFsdWUpIHsKICAgICAgICAgICAgICAgIGlmICghKHZhbHVlIGluc3RhbmNlb2YgUHJvbWlzZSkpIHsKICAgICAgICAgICAgICAgICAgcmV0dXJuIHZhbHVlOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHRoaXMuZGVmZXJyZWRLZXlzLnB1c2goa2V5KTsKICAgICAgICAgICAgICAgIHRoaXMucGVuZGluZ0tleXNTZXQuYWRkKGtleSk7IC8vIFdlIHN0b3JlIGEgbGl0dGxlIHdyYXBwZXIgcHJvbWlzZSB0aGF0IHdpbGwgYmUgZXh0ZW5kZWQgd2l0aAogICAgICAgICAgICAgICAgLy8gX2RhdGEvX2Vycm9yIHByb3BzIHVwb24gcmVzb2x2ZS9yZWplY3QKCiAgICAgICAgICAgICAgICB2YXIgcHJvbWlzZSA9IFByb21pc2UucmFjZShbdmFsdWUsIHRoaXMuYWJvcnRQcm9taXNlXSkudGhlbigoZGF0YSkgPT4gdGhpcy5vblNldHRsZShwcm9taXNlLCBrZXksIG51bGwsIGRhdGEpLCAoZXJyb3IpID0+IHRoaXMub25TZXR0bGUocHJvbWlzZSwga2V5LCBlcnJvcikpOyAvLyBSZWdpc3RlciByZWplY3Rpb24gbGlzdGVuZXJzIHRvIGF2b2lkIHVuY2F1Z2h0IHByb21pc2UgcmVqZWN0aW9ucyBvbgogICAgICAgICAgICAgICAgLy8gZXJyb3JzIG9yIGFib3J0ZWQgZGVmZXJyZWQgdmFsdWVzCgogICAgICAgICAgICAgICAgcHJvbWlzZS5jYXRjaCgoKSA9PiB7fSk7CiAgICAgICAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkocHJvbWlzZSwgIl90cmFja2VkIiwgewogICAgICAgICAgICAgICAgICBnZXQ6ICgpID0+IHRydWUKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgcmV0dXJuIHByb21pc2U7CiAgICAgICAgICAgICAgfSB9LCB7IGtleTogIm9uU2V0dGxlIiwgdmFsdWU6CgogICAgICAgICAgICAgIGZ1bmN0aW9uIG9uU2V0dGxlKHByb21pc2UsIGtleSwgZXJyb3IsIGRhdGEpIHsKICAgICAgICAgICAgICAgIGlmICh0aGlzLmNvbnRyb2xsZXIuc2lnbmFsLmFib3J0ZWQgJiYgZXJyb3IgaW5zdGFuY2VvZiByb3V0ZXJfQWJvcnRlZERlZmVycmVkRXJyb3IpIHsKICAgICAgICAgICAgICAgICAgdGhpcy51bmxpc3RlbkFib3J0U2lnbmFsKCk7CiAgICAgICAgICAgICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShwcm9taXNlLCAiX2Vycm9yIiwgewogICAgICAgICAgICAgICAgICAgIGdldDogKCkgPT4gZXJyb3IKICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgIHJldHVybiBQcm9taXNlLnJlamVjdChlcnJvcik7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgdGhpcy5wZW5kaW5nS2V5c1NldC5kZWxldGUoa2V5KTsKCiAgICAgICAgICAgICAgICBpZiAodGhpcy5kb25lKSB7CiAgICAgICAgICAgICAgICAgIC8vIE5vdGhpbmcgbGVmdCB0byBhYm9ydCEKICAgICAgICAgICAgICAgICAgdGhpcy51bmxpc3RlbkFib3J0U2lnbmFsKCk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgaWYgKGVycm9yKSB7CiAgICAgICAgICAgICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShwcm9taXNlLCAiX2Vycm9yIiwgewogICAgICAgICAgICAgICAgICAgIGdldDogKCkgPT4gZXJyb3IKICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgIHRoaXMuZW1pdChmYWxzZSwga2V5KTsKICAgICAgICAgICAgICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KGVycm9yKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkocHJvbWlzZSwgIl9kYXRhIiwgewogICAgICAgICAgICAgICAgICBnZXQ6ICgpID0+IGRhdGEKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgdGhpcy5lbWl0KGZhbHNlLCBrZXkpOwogICAgICAgICAgICAgICAgcmV0dXJuIGRhdGE7CiAgICAgICAgICAgICAgfSB9LCB7IGtleTogImVtaXQiLCB2YWx1ZToKCiAgICAgICAgICAgICAgZnVuY3Rpb24gZW1pdChhYm9ydGVkLCBzZXR0bGVkS2V5KSB7CiAgICAgICAgICAgICAgICB0aGlzLnN1YnNjcmliZXJzLmZvckVhY2goKHN1YnNjcmliZXIpID0+IHN1YnNjcmliZXIoYWJvcnRlZCwgc2V0dGxlZEtleSkpOwogICAgICAgICAgICAgIH0gfSwgeyBrZXk6ICJzdWJzY3JpYmUiLCB2YWx1ZToKCiAgICAgICAgICAgICAgZnVuY3Rpb24gc3Vic2NyaWJlKGZuKSB7CiAgICAgICAgICAgICAgICB0aGlzLnN1YnNjcmliZXJzLmFkZChmbik7CiAgICAgICAgICAgICAgICByZXR1cm4gKCkgPT4gdGhpcy5zdWJzY3JpYmVycy5kZWxldGUoZm4pOwogICAgICAgICAgICAgIH0gfSwgeyBrZXk6ICJjYW5jZWwiLCB2YWx1ZToKCiAgICAgICAgICAgICAgZnVuY3Rpb24gY2FuY2VsKCkgewogICAgICAgICAgICAgICAgdGhpcy5jb250cm9sbGVyLmFib3J0KCk7CiAgICAgICAgICAgICAgICB0aGlzLnBlbmRpbmdLZXlzU2V0LmZvckVhY2goKHYsIGspID0+IHRoaXMucGVuZGluZ0tleXNTZXQuZGVsZXRlKGspKTsKICAgICAgICAgICAgICAgIHRoaXMuZW1pdCh0cnVlKTsKICAgICAgICAgICAgICB9IH0sIHsga2V5OiAicmVzb2x2ZURhdGEiLCB2YWx1ZTogZnVuY3Rpb24gKCkge3ZhciBfcmVzb2x2ZURhdGEgPSBfYXN5bmNUb0dlbmVyYXRvcjIoIC8qI19fUFVSRV9fKi9fcmVnZW5lcmF0b3JSdW50aW1lMigpLm1hcmsoCgogICAgICAgICAgICAgICAgZnVuY3Rpb24gX2NhbGxlZTIoc2lnbmFsKSB7dmFyIGFib3J0ZWQsIG9uQWJvcnQ7cmV0dXJuIF9yZWdlbmVyYXRvclJ1bnRpbWUyKCkud3JhcChmdW5jdGlvbiBfY2FsbGVlMiQoX2NvbnRleHQyKSB7d2hpbGUgKDEpIHN3aXRjaCAoX2NvbnRleHQyLnByZXYgPSBfY29udGV4dDIubmV4dCkge2Nhc2UgMDoKICAgICAgICAgICAgICAgICAgICAgICAgYWJvcnRlZCA9IGZhbHNlO2lmICgKCiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZG9uZSkge19jb250ZXh0Mi5uZXh0ID0gNzticmVhazt9CiAgICAgICAgICAgICAgICAgICAgICAgIG9uQWJvcnQgPSAoKSA9PiB0aGlzLmNhbmNlbCgpOwoKICAgICAgICAgICAgICAgICAgICAgICAgc2lnbmFsLmFkZEV2ZW50TGlzdGVuZXIoImFib3J0Iiwgb25BYm9ydCk7X2NvbnRleHQyLm5leHQgPSA2O3JldHVybiAoCiAgICAgICAgICAgICAgICAgICAgICAgICAgbmV3IFByb21pc2UoKHJlc29sdmUpID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc3Vic2NyaWJlKChhYm9ydGVkKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNpZ25hbC5yZW1vdmVFdmVudExpc3RlbmVyKCJhYm9ydCIsIG9uQWJvcnQpOwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGFib3J0ZWQgfHwgdGhpcy5kb25lKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShhYm9ydGVkKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgfSkpO2Nhc2UgNjphYm9ydGVkID0gX2NvbnRleHQyLnNlbnQ7Y2FzZSA3OnJldHVybiBfY29udGV4dDIuYWJydXB0KCJyZXR1cm4iLAoKCiAgICAgICAgICAgICAgICAgICAgICAgIGFib3J0ZWQpO2Nhc2UgODpjYXNlICJlbmQiOnJldHVybiBfY29udGV4dDIuc3RvcCgpO319LCBfY2FsbGVlMiwgdGhpcyk7fSkpO2Z1bmN0aW9uIHJlc29sdmVEYXRhKF94Mykge3JldHVybiBfcmVzb2x2ZURhdGEuYXBwbHkodGhpcywgYXJndW1lbnRzKTt9cmV0dXJuIHJlc29sdmVEYXRhO30oKSB9LCB7IGtleTogImRvbmUiLCBnZXQ6CgoKICAgICAgICAgICAgICBmdW5jdGlvbiBnZXQoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5wZW5kaW5nS2V5c1NldC5zaXplID09PSAwOwogICAgICAgICAgICAgIH0gfSwgeyBrZXk6ICJ1bndyYXBwZWREYXRhIiwgZ2V0OgoKICAgICAgICAgICAgICBmdW5jdGlvbiBnZXQoKSB7CiAgICAgICAgICAgICAgICByb3V0ZXJfaW52YXJpYW50KHRoaXMuZGF0YSAhPT0gbnVsbCAmJiB0aGlzLmRvbmUsICJDYW4gb25seSB1bndyYXAgZGF0YSBvbiBpbml0aWFsaXplZCBhbmQgc2V0dGxlZCBkZWZlcnJlZHMiKTsKICAgICAgICAgICAgICAgIHJldHVybiBPYmplY3QuZW50cmllcyh0aGlzLmRhdGEpLnJlZHVjZSgoYWNjLCBfcmVmMikgPT4gewogICAgICAgICAgICAgICAgICB2YXIgX3JlZjE0ID0gX3NsaWNlZFRvQXJyYXkyKF9yZWYyLCAyKSxrZXkgPSBfcmVmMTRbMF0sdmFsdWUgPSBfcmVmMTRbMV07CiAgICAgICAgICAgICAgICAgIHJldHVybiBPYmplY3QuYXNzaWduKGFjYywgX2RlZmluZVByb3BlcnR5Mih7fSwKICAgICAgICAgICAgICAgICAga2V5LCB1bndyYXBUcmFja2VkUHJvbWlzZSh2YWx1ZSkpKTsKCiAgICAgICAgICAgICAgICB9LCB7fSk7CiAgICAgICAgICAgICAgfSB9LCB7IGtleTogInBlbmRpbmdLZXlzIiwgZ2V0OgoKICAgICAgICAgICAgICBmdW5jdGlvbiBnZXQoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gQXJyYXkuZnJvbSh0aGlzLnBlbmRpbmdLZXlzU2V0KTsKICAgICAgICAgICAgICB9IH1dKTtyZXR1cm4gRGVmZXJyZWREYXRhO30oKTsKCgoKICAgICAgICAgIGZ1bmN0aW9uIGlzVHJhY2tlZFByb21pc2UodmFsdWUpIHsKICAgICAgICAgICAgcmV0dXJuIHZhbHVlIGluc3RhbmNlb2YgUHJvbWlzZSAmJiB2YWx1ZS5fdHJhY2tlZCA9PT0gdHJ1ZTsKICAgICAgICAgIH0KCiAgICAgICAgICBmdW5jdGlvbiB1bndyYXBUcmFja2VkUHJvbWlzZSh2YWx1ZSkgewogICAgICAgICAgICBpZiAoIWlzVHJhY2tlZFByb21pc2UodmFsdWUpKSB7CiAgICAgICAgICAgICAgcmV0dXJuIHZhbHVlOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAodmFsdWUuX2Vycm9yKSB7CiAgICAgICAgICAgICAgdGhyb3cgdmFsdWUuX2Vycm9yOwogICAgICAgICAgICB9CgogICAgICAgICAgICByZXR1cm4gdmFsdWUuX2RhdGE7CiAgICAgICAgICB9CgogICAgICAgICAgdmFyIGRlZmVyID0gZnVuY3Rpb24gZGVmZXIoZGF0YSwgaW5pdCkgewogICAgICAgICAgICBpZiAoaW5pdCA9PT0gdm9pZCAwKSB7CiAgICAgICAgICAgICAgaW5pdCA9IHt9OwogICAgICAgICAgICB9CgogICAgICAgICAgICB2YXIgcmVzcG9uc2VJbml0ID0gdHlwZW9mIGluaXQgPT09ICJudW1iZXIiID8gewogICAgICAgICAgICAgIHN0YXR1czogaW5pdAogICAgICAgICAgICB9IDogaW5pdDsKICAgICAgICAgICAgcmV0dXJuIG5ldyBEZWZlcnJlZERhdGEoZGF0YSwgcmVzcG9uc2VJbml0KTsKICAgICAgICAgIH07CiAgICAgICAgICAvKioKICAgICAgICAgICAqIEEgcmVkaXJlY3QgcmVzcG9uc2UuIFNldHMgdGhlIHN0YXR1cyBjb2RlIGFuZCB0aGUgYExvY2F0aW9uYCBoZWFkZXIuCiAgICAgICAgICAgKiBEZWZhdWx0cyB0byAiMzAyIEZvdW5kIi4KICAgICAgICAgICAqLwoKICAgICAgICAgIHZhciByZWRpcmVjdCA9IGZ1bmN0aW9uIHJlZGlyZWN0KHVybCwgaW5pdCkgewogICAgICAgICAgICBpZiAoaW5pdCA9PT0gdm9pZCAwKSB7CiAgICAgICAgICAgICAgaW5pdCA9IDMwMjsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdmFyIHJlc3BvbnNlSW5pdCA9IGluaXQ7CgogICAgICAgICAgICBpZiAodHlwZW9mIHJlc3BvbnNlSW5pdCA9PT0gIm51bWJlciIpIHsKICAgICAgICAgICAgICByZXNwb25zZUluaXQgPSB7CiAgICAgICAgICAgICAgICBzdGF0dXM6IHJlc3BvbnNlSW5pdAogICAgICAgICAgICAgIH07CiAgICAgICAgICAgIH0gZWxzZSBpZiAodHlwZW9mIHJlc3BvbnNlSW5pdC5zdGF0dXMgPT09ICJ1bmRlZmluZWQiKSB7CiAgICAgICAgICAgICAgcmVzcG9uc2VJbml0LnN0YXR1cyA9IDMwMjsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdmFyIGhlYWRlcnMgPSBuZXcgSGVhZGVycyhyZXNwb25zZUluaXQuaGVhZGVycyk7CiAgICAgICAgICAgIGhlYWRlcnMuc2V0KCJMb2NhdGlvbiIsIHVybCk7CiAgICAgICAgICAgIHJldHVybiBuZXcgUmVzcG9uc2UobnVsbCwgX2V4dGVuZHMoe30sIHJlc3BvbnNlSW5pdCwgewogICAgICAgICAgICAgIGhlYWRlcnM6IGhlYWRlcnMKICAgICAgICAgICAgfSkpOwogICAgICAgICAgfTsKICAgICAgICAgIC8qKgogICAgICAgICAgICogQHByaXZhdGUKICAgICAgICAgICAqIFV0aWxpdHkgY2xhc3Mgd2UgdXNlIHRvIGhvbGQgYXV0by11bndyYXBwZWQgNHh4LzV4eCBSZXNwb25zZSBib2RpZXMKICAgICAgICAgICAqL3ZhcgoKICAgICAgICAgIHJvdXRlcl9FcnJvclJlc3BvbnNlID0gLyojX19QVVJFX18qL19jcmVhdGVDbGFzczIoCiAgICAgICAgICBmdW5jdGlvbiByb3V0ZXJfRXJyb3JSZXNwb25zZShzdGF0dXMsIHN0YXR1c1RleHQsIGRhdGEsIGludGVybmFsKSB7X2NsYXNzQ2FsbENoZWNrMih0aGlzLCByb3V0ZXJfRXJyb3JSZXNwb25zZSk7CiAgICAgICAgICAgIGlmIChpbnRlcm5hbCA9PT0gdm9pZCAwKSB7CiAgICAgICAgICAgICAgaW50ZXJuYWwgPSBmYWxzZTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdGhpcy5zdGF0dXMgPSBzdGF0dXM7CiAgICAgICAgICAgIHRoaXMuc3RhdHVzVGV4dCA9IHN0YXR1c1RleHQgfHwgIiI7CiAgICAgICAgICAgIHRoaXMuaW50ZXJuYWwgPSBpbnRlcm5hbDsKCiAgICAgICAgICAgIGlmIChkYXRhIGluc3RhbmNlb2YgRXJyb3IpIHsKICAgICAgICAgICAgICB0aGlzLmRhdGEgPSBkYXRhLnRvU3RyaW5nKCk7CiAgICAgICAgICAgICAgdGhpcy5lcnJvciA9IGRhdGE7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgdGhpcy5kYXRhID0gZGF0YTsKICAgICAgICAgICAgfQogICAgICAgICAgfSk7CgoKICAgICAgICAgIC8qKgogICAgICAgICAgICogQ2hlY2sgaWYgdGhlIGdpdmVuIGVycm9yIGlzIGFuIEVycm9yUmVzcG9uc2UgZ2VuZXJhdGVkIGZyb20gYSA0eHgvNXh4CiAgICAgICAgICAgKiBSZXNwb25zZSB0aHJvdyBmcm9tIGFuIGFjdGlvbi9sb2FkZXIKICAgICAgICAgICAqLwoKICAgICAgICAgIGZ1bmN0aW9uIGlzUm91dGVFcnJvclJlc3BvbnNlKGUpIHsKICAgICAgICAgICAgcmV0dXJuIGUgaW5zdGFuY2VvZiByb3V0ZXJfRXJyb3JSZXNwb25zZTsKICAgICAgICAgIH0KCiAgICAgICAgICB2YXIgdmFsaWRNdXRhdGlvbk1ldGhvZHNBcnIgPSBbInBvc3QiLCAicHV0IiwgInBhdGNoIiwgImRlbGV0ZSJdOwogICAgICAgICAgdmFyIHZhbGlkTXV0YXRpb25NZXRob2RzID0gbmV3IFNldCh2YWxpZE11dGF0aW9uTWV0aG9kc0Fycik7CiAgICAgICAgICB2YXIgdmFsaWRSZXF1ZXN0TWV0aG9kc0FyciA9IFsiZ2V0Il0uY29uY2F0KHZhbGlkTXV0YXRpb25NZXRob2RzQXJyKTsKICAgICAgICAgIHZhciB2YWxpZFJlcXVlc3RNZXRob2RzID0gbmV3IFNldCh2YWxpZFJlcXVlc3RNZXRob2RzQXJyKTsKICAgICAgICAgIHZhciByZWRpcmVjdFN0YXR1c0NvZGVzID0gbmV3IFNldChbMzAxLCAzMDIsIDMwMywgMzA3LCAzMDhdKTsKICAgICAgICAgIHZhciByZWRpcmVjdFByZXNlcnZlTWV0aG9kU3RhdHVzQ29kZXMgPSBuZXcgU2V0KFszMDcsIDMwOF0pOwogICAgICAgICAgdmFyIElETEVfTkFWSUdBVElPTiA9IHsKICAgICAgICAgICAgc3RhdGU6ICJpZGxlIiwKICAgICAgICAgICAgbG9jYXRpb246IHVuZGVmaW5lZCwKICAgICAgICAgICAgZm9ybU1ldGhvZDogdW5kZWZpbmVkLAogICAgICAgICAgICBmb3JtQWN0aW9uOiB1bmRlZmluZWQsCiAgICAgICAgICAgIGZvcm1FbmNUeXBlOiB1bmRlZmluZWQsCiAgICAgICAgICAgIGZvcm1EYXRhOiB1bmRlZmluZWQKICAgICAgICAgIH07CiAgICAgICAgICB2YXIgSURMRV9GRVRDSEVSID0gewogICAgICAgICAgICBzdGF0ZTogImlkbGUiLAogICAgICAgICAgICBkYXRhOiB1bmRlZmluZWQsCiAgICAgICAgICAgIGZvcm1NZXRob2Q6IHVuZGVmaW5lZCwKICAgICAgICAgICAgZm9ybUFjdGlvbjogdW5kZWZpbmVkLAogICAgICAgICAgICBmb3JtRW5jVHlwZTogdW5kZWZpbmVkLAogICAgICAgICAgICBmb3JtRGF0YTogdW5kZWZpbmVkCiAgICAgICAgICB9OwogICAgICAgICAgdmFyIElETEVfQkxPQ0tFUiA9IHsKICAgICAgICAgICAgc3RhdGU6ICJ1bmJsb2NrZWQiLAogICAgICAgICAgICBwcm9jZWVkOiB1bmRlZmluZWQsCiAgICAgICAgICAgIHJlc2V0OiB1bmRlZmluZWQsCiAgICAgICAgICAgIGxvY2F0aW9uOiB1bmRlZmluZWQKICAgICAgICAgIH07CiAgICAgICAgICB2YXIgaXNCcm93c2VyID0gdHlwZW9mIHdpbmRvdyAhPT0gInVuZGVmaW5lZCIgJiYgdHlwZW9mIHdpbmRvdy5kb2N1bWVudCAhPT0gInVuZGVmaW5lZCIgJiYgdHlwZW9mIHdpbmRvdy5kb2N1bWVudC5jcmVhdGVFbGVtZW50ICE9PSAidW5kZWZpbmVkIjsKICAgICAgICAgIHZhciBpc1NlcnZlciA9ICFpc0Jyb3dzZXI7IC8vI2VuZHJlZ2lvbgogICAgICAgICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KICAgICAgICAgIC8vI3JlZ2lvbiBjcmVhdGVSb3V0ZXIKICAgICAgICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCgogICAgICAgICAgLyoqCiAgICAgICAgICAgKiBDcmVhdGUgYSByb3V0ZXIgYW5kIGxpc3RlbiB0byBoaXN0b3J5IFBPUCBuYXZpZ2F0aW9ucwogICAgICAgICAgICovCgogICAgICAgICAgZnVuY3Rpb24gcm91dGVyX2NyZWF0ZVJvdXRlcihpbml0KSB7CiAgICAgICAgICAgIHJvdXRlcl9pbnZhcmlhbnQoaW5pdC5yb3V0ZXMubGVuZ3RoID4gMCwgIllvdSBtdXN0IHByb3ZpZGUgYSBub24tZW1wdHkgcm91dGVzIGFycmF5IHRvIGNyZWF0ZVJvdXRlciIpOwogICAgICAgICAgICB2YXIgZGF0YVJvdXRlcyA9IGNvbnZlcnRSb3V0ZXNUb0RhdGFSb3V0ZXMoaW5pdC5yb3V0ZXMpOyAvLyBDbGVhbnVwIGZ1bmN0aW9uIGZvciBoaXN0b3J5CgogICAgICAgICAgICB2YXIgdW5saXN0ZW5IaXN0b3J5ID0gbnVsbDsgLy8gRXh0ZXJuYWxseS1wcm92aWRlZCBmdW5jdGlvbnMgdG8gY2FsbCBvbiBhbGwgc3RhdGUgY2hhbmdlcwoKICAgICAgICAgICAgdmFyIHN1YnNjcmliZXJzID0gbmV3IFNldCgpOyAvLyBFeHRlcm5hbGx5LXByb3ZpZGVkIG9iamVjdCB0byBob2xkIHNjcm9sbCByZXN0b3JhdGlvbiBsb2NhdGlvbnMgZHVyaW5nIHJvdXRpbmcKCiAgICAgICAgICAgIHZhciBzYXZlZFNjcm9sbFBvc2l0aW9ucyA9IG51bGw7IC8vIEV4dGVybmFsbHktcHJvdmlkZWQgZnVuY3Rpb24gdG8gZ2V0IHNjcm9sbCByZXN0b3JhdGlvbiBrZXlzCgogICAgICAgICAgICB2YXIgZ2V0U2Nyb2xsUmVzdG9yYXRpb25LZXkgPSBudWxsOyAvLyBFeHRlcm5hbGx5LXByb3ZpZGVkIGZ1bmN0aW9uIHRvIGdldCBjdXJyZW50IHNjcm9sbCBwb3NpdGlvbgoKICAgICAgICAgICAgdmFyIGdldFNjcm9sbFBvc2l0aW9uID0gbnVsbDsgLy8gT25lLXRpbWUgZmxhZyB0byBjb250cm9sIHRoZSBpbml0aWFsIGh5ZHJhdGlvbiBzY3JvbGwgcmVzdG9yYXRpb24uICBCZWNhdXNlCiAgICAgICAgICAgIC8vIHdlIGRvbid0IGdldCB0aGUgc2F2ZWQgcG9zaXRpb25zIGZyb20gPFNjcm9sbFJlc3RvcmF0aW9uIC8+IHVudGlsIF9hZnRlcl8KICAgICAgICAgICAgLy8gdGhlIGluaXRpYWwgcmVuZGVyLCB3ZSBuZWVkIHRvIG1hbnVhbGx5IHRyaWdnZXIgYSBzZXBhcmF0ZSB1cGRhdGVTdGF0ZSB0bwogICAgICAgICAgICAvLyBzZW5kIGFsb25nIHRoZSByZXN0b3JlU2Nyb2xsUG9zaXRpb24KICAgICAgICAgICAgLy8gU2V0IHRvIHRydWUgaWYgd2UgaGF2ZSBgaHlkcmF0aW9uRGF0YWAgc2luY2Ugd2UgYXNzdW1lIHdlIHdlcmUgU1NSJ2QgYW5kIHRoYXQKICAgICAgICAgICAgLy8gU1NSIGRpZCB0aGUgaW5pdGlhbCBzY3JvbGwgcmVzdG9yYXRpb24uCgogICAgICAgICAgICB2YXIgaW5pdGlhbFNjcm9sbFJlc3RvcmVkID0gaW5pdC5oeWRyYXRpb25EYXRhICE9IG51bGw7CiAgICAgICAgICAgIHZhciBpbml0aWFsTWF0Y2hlcyA9IG1hdGNoUm91dGVzKGRhdGFSb3V0ZXMsIGluaXQuaGlzdG9yeS5sb2NhdGlvbiwgaW5pdC5iYXNlbmFtZSk7CiAgICAgICAgICAgIHZhciBpbml0aWFsRXJyb3JzID0gbnVsbDsKCiAgICAgICAgICAgIGlmIChpbml0aWFsTWF0Y2hlcyA9PSBudWxsKSB7CiAgICAgICAgICAgICAgLy8gSWYgd2UgZG8gbm90IG1hdGNoIGEgdXNlci1wcm92aWRlZC1yb3V0ZSwgZmFsbCBiYWNrIHRvIHRoZSByb290CiAgICAgICAgICAgICAgLy8gdG8gYWxsb3cgdGhlIGVycm9yIGJvdW5kYXJ5IHRvIHRha2Ugb3ZlcgogICAgICAgICAgICAgIHZhciBlcnJvciA9IGdldEludGVybmFsUm91dGVyRXJyb3IoNDA0LCB7CiAgICAgICAgICAgICAgICBwYXRobmFtZTogaW5pdC5oaXN0b3J5LmxvY2F0aW9uLnBhdGhuYW1lCiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgdmFyIF9nZXRTaG9ydENpcmN1aXRNYXRjaCA9CgoKICAgICAgICAgICAgICAgIGdldFNob3J0Q2lyY3VpdE1hdGNoZXMoZGF0YVJvdXRlcyksbWF0Y2hlcyA9IF9nZXRTaG9ydENpcmN1aXRNYXRjaC5tYXRjaGVzLHJvdXRlID0gX2dldFNob3J0Q2lyY3VpdE1hdGNoLnJvdXRlOwogICAgICAgICAgICAgIGluaXRpYWxNYXRjaGVzID0gbWF0Y2hlczsKICAgICAgICAgICAgICBpbml0aWFsRXJyb3JzID0gX2RlZmluZVByb3BlcnR5Mih7fSwKICAgICAgICAgICAgICByb3V0ZS5pZCwgZXJyb3IpOwoKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdmFyIGluaXRpYWxpemVkID0gIWluaXRpYWxNYXRjaGVzLnNvbWUoKG0pID0+IG0ucm91dGUubG9hZGVyKSB8fCBpbml0Lmh5ZHJhdGlvbkRhdGEgIT0gbnVsbDsKICAgICAgICAgICAgdmFyIHJvdXRlcjsKICAgICAgICAgICAgdmFyIHN0YXRlID0gewogICAgICAgICAgICAgIGhpc3RvcnlBY3Rpb246IGluaXQuaGlzdG9yeS5hY3Rpb24sCiAgICAgICAgICAgICAgbG9jYXRpb246IGluaXQuaGlzdG9yeS5sb2NhdGlvbiwKICAgICAgICAgICAgICBtYXRjaGVzOiBpbml0aWFsTWF0Y2hlcywKICAgICAgICAgICAgICBpbml0aWFsaXplZDogaW5pdGlhbGl6ZWQsCiAgICAgICAgICAgICAgbmF2aWdhdGlvbjogSURMRV9OQVZJR0FUSU9OLAogICAgICAgICAgICAgIC8vIERvbid0IHJlc3RvcmUgb24gaW5pdGlhbCB1cGRhdGVTdGF0ZSgpIGlmIHdlIHdlcmUgU1NSJ2QKICAgICAgICAgICAgICByZXN0b3JlU2Nyb2xsUG9zaXRpb246IGluaXQuaHlkcmF0aW9uRGF0YSAhPSBudWxsID8gZmFsc2UgOiBudWxsLAogICAgICAgICAgICAgIHByZXZlbnRTY3JvbGxSZXNldDogZmFsc2UsCiAgICAgICAgICAgICAgcmV2YWxpZGF0aW9uOiAiaWRsZSIsCiAgICAgICAgICAgICAgbG9hZGVyRGF0YTogaW5pdC5oeWRyYXRpb25EYXRhICYmIGluaXQuaHlkcmF0aW9uRGF0YS5sb2FkZXJEYXRhIHx8IHt9LAogICAgICAgICAgICAgIGFjdGlvbkRhdGE6IGluaXQuaHlkcmF0aW9uRGF0YSAmJiBpbml0Lmh5ZHJhdGlvbkRhdGEuYWN0aW9uRGF0YSB8fCBudWxsLAogICAgICAgICAgICAgIGVycm9yczogaW5pdC5oeWRyYXRpb25EYXRhICYmIGluaXQuaHlkcmF0aW9uRGF0YS5lcnJvcnMgfHwgaW5pdGlhbEVycm9ycywKICAgICAgICAgICAgICBmZXRjaGVyczogbmV3IE1hcCgpLAogICAgICAgICAgICAgIGJsb2NrZXJzOiBuZXcgTWFwKCkKICAgICAgICAgICAgfTsgLy8gLS0gU3RhdGVmdWwgaW50ZXJuYWwgdmFyaWFibGVzIHRvIG1hbmFnZSBuYXZpZ2F0aW9ucyAtLQogICAgICAgICAgICAvLyBDdXJyZW50IG5hdmlnYXRpb24gaW4gcHJvZ3Jlc3MgKHRvIGJlIGNvbW1pdHRlZCBpbiBjb21wbGV0ZU5hdmlnYXRpb24pCgogICAgICAgICAgICB2YXIgcGVuZGluZ0FjdGlvbiA9IEFjdGlvbi5Qb3A7IC8vIFNob3VsZCB0aGUgY3VycmVudCBuYXZpZ2F0aW9uIHByZXZlbnQgdGhlIHNjcm9sbCByZXNldCBpZiBzY3JvbGwgY2Fubm90CiAgICAgICAgICAgIC8vIGJlIHJlc3RvcmVkPwoKICAgICAgICAgICAgdmFyIHBlbmRpbmdQcmV2ZW50U2Nyb2xsUmVzZXQgPSBmYWxzZTsgLy8gQWJvcnRDb250cm9sbGVyIGZvciB0aGUgYWN0aXZlIG5hdmlnYXRpb24KCiAgICAgICAgICAgIHZhciBwZW5kaW5nTmF2aWdhdGlvbkNvbnRyb2xsZXI7IC8vIFdlIHVzZSB0aGlzIHRvIGF2b2lkIHRvdWNoaW5nIGhpc3RvcnkgaW4gY29tcGxldGVOYXZpZ2F0aW9uIGlmIGEKICAgICAgICAgICAgLy8gcmV2YWxpZGF0aW9uIGlzIGVudGlyZWx5IHVuaW50ZXJydXB0ZWQKCiAgICAgICAgICAgIHZhciBpc1VuaW50ZXJydXB0ZWRSZXZhbGlkYXRpb24gPSBmYWxzZTsgLy8gVXNlIHRoaXMgaW50ZXJuYWwgZmxhZyB0byBmb3JjZSByZXZhbGlkYXRpb24gb2YgYWxsIGxvYWRlcnM6CiAgICAgICAgICAgIC8vICAtIHN1Ym1pc3Npb25zIChjb21wbGV0ZWQgb3IgaW50ZXJydXB0ZWQpCiAgICAgICAgICAgIC8vICAtIHVzZVJldmFsaWRhdGUoKQogICAgICAgICAgICAvLyAgLSBYLVJlbWl4LVJldmFsaWRhdGUgKGZyb20gcmVkaXJlY3QpCgogICAgICAgICAgICB2YXIgaXNSZXZhbGlkYXRpb25SZXF1aXJlZCA9IGZhbHNlOyAvLyBVc2UgdGhpcyBpbnRlcm5hbCBhcnJheSB0byBjYXB0dXJlIHJvdXRlcyB0aGF0IHJlcXVpcmUgcmV2YWxpZGF0aW9uIGR1ZQogICAgICAgICAgICAvLyB0byBhIGNhbmNlbGxlZCBkZWZlcnJlZCBvbiBhY3Rpb24gc3VibWlzc2lvbgoKICAgICAgICAgICAgdmFyIGNhbmNlbGxlZERlZmVycmVkUm91dGVzID0gW107IC8vIFVzZSB0aGlzIGludGVybmFsIGFycmF5IHRvIGNhcHR1cmUgZmV0Y2hlciBsb2FkcyB0aGF0IHdlcmUgY2FuY2VsbGVkIGJ5IGFuCiAgICAgICAgICAgIC8vIGFjdGlvbiBuYXZpZ2F0aW9uIGFuZCByZXF1aXJlIHJldmFsaWRhdGlvbgoKICAgICAgICAgICAgdmFyIGNhbmNlbGxlZEZldGNoZXJMb2FkcyA9IFtdOyAvLyBBYm9ydENvbnRyb2xsZXJzIGZvciBhbnkgaW4tZmxpZ2h0IGZldGNoZXJzCgogICAgICAgICAgICB2YXIgZmV0Y2hDb250cm9sbGVycyA9IG5ldyBNYXAoKTsgLy8gVHJhY2sgbG9hZHMgYmFzZWQgb24gdGhlIG9yZGVyIGluIHdoaWNoIHRoZXkgc3RhcnRlZAoKICAgICAgICAgICAgdmFyIGluY3JlbWVudGluZ0xvYWRJZCA9IDA7IC8vIFRyYWNrIHRoZSBvdXRzdGFuZGluZyBwZW5kaW5nIG5hdmlnYXRpb24gZGF0YSBsb2FkIHRvIGJlIGNvbXBhcmVkIGFnYWluc3QKICAgICAgICAgICAgLy8gdGhlIGdsb2JhbGx5IGluY3JlbWVudGluZyBsb2FkIHdoZW4gYSBmZXRjaGVyIGxvYWQgbGFuZHMgYWZ0ZXIgYSBjb21wbGV0ZWQKICAgICAgICAgICAgLy8gbmF2aWdhdGlvbgoKICAgICAgICAgICAgdmFyIHBlbmRpbmdOYXZpZ2F0aW9uTG9hZElkID0gLTE7IC8vIEZldGNoZXJzIHRoYXQgdHJpZ2dlcmVkIGRhdGEgcmVsb2FkcyBhcyBhIHJlc3VsdCBvZiB0aGVpciBhY3Rpb25zCgogICAgICAgICAgICB2YXIgZmV0Y2hSZWxvYWRJZHMgPSBuZXcgTWFwKCk7IC8vIEZldGNoZXJzIHRoYXQgdHJpZ2dlcmVkIHJlZGlyZWN0IG5hdmlnYXRpb25zIGZyb20gdGhlaXIgYWN0aW9ucwoKICAgICAgICAgICAgdmFyIGZldGNoUmVkaXJlY3RJZHMgPSBuZXcgU2V0KCk7IC8vIE1vc3QgcmVjZW50IGhyZWYvbWF0Y2ggZm9yIGZldGNoZXIubG9hZCBjYWxscyBmb3IgZmV0Y2hlcnMKCiAgICAgICAgICAgIHZhciBmZXRjaExvYWRNYXRjaGVzID0gbmV3IE1hcCgpOyAvLyBTdG9yZSBEZWZlcnJlZERhdGEgaW5zdGFuY2VzIGZvciBhY3RpdmUgcm91dGUgbWF0Y2hlcy4gIFdoZW4gYQogICAgICAgICAgICAvLyByb3V0ZSBsb2FkZXIgcmV0dXJucyBkZWZlcigpIHdlIHN0aWNrIG9uZSBpbiBoZXJlLiAgVGhlbiwgd2hlbiBhIG5lc3RlZAogICAgICAgICAgICAvLyBwcm9taXNlIHJlc29sdmVzIHdlIHVwZGF0ZSBsb2FkZXJEYXRhLiAgSWYgYSBuZXcgbmF2aWdhdGlvbiBzdGFydHMgd2UKICAgICAgICAgICAgLy8gY2FuY2VsIGFjdGl2ZSBkZWZlcnJlZHMgZm9yIGVsaW1pbmF0ZWQgcm91dGVzLgoKICAgICAgICAgICAgdmFyIGFjdGl2ZURlZmVycmVkcyA9IG5ldyBNYXAoKTsgLy8gV2Ugb255IHN1cHBvcnQgYSBzaW5nbGUgYWN0aXZlIGJsb2NrZXIgYXQgdGhlIG1vbWVudCBzaW5jZSB3ZSBkb24ndCBoYXZlCiAgICAgICAgICAgIC8vIGFueSBjb21wZWxsaW5nIHVzZSBjYXNlcyBmb3IgbXVsdGktYmxvY2tlciB5ZXQKCiAgICAgICAgICAgIHZhciBhY3RpdmVCbG9ja2VyID0gbnVsbDsgLy8gU3RvcmUgYmxvY2tlciBmdW5jdGlvbnMgaW4gYSBzZXBhcmF0ZSBNYXAgb3V0c2lkZSBvZiByb3V0ZXIgc3RhdGUgc2luY2UKICAgICAgICAgICAgLy8gd2UgZG9uJ3QgbmVlZCB0byB1cGRhdGUgVUkgc3RhdGUgaWYgdGhleSBjaGFuZ2UKCiAgICAgICAgICAgIHZhciBibG9ja2VyRnVuY3Rpb25zID0gbmV3IE1hcCgpOyAvLyBGbGFnIHRvIGlnbm9yZSB0aGUgbmV4dCBoaXN0b3J5IHVwZGF0ZSwgc28gd2UgY2FuIHJldmVydCB0aGUgVVJMIGNoYW5nZSBvbgogICAgICAgICAgICAvLyBhIFBPUCBuYXZpZ2F0aW9uIHRoYXQgd2FzIGJsb2NrZWQgYnkgdGhlIHVzZXIgd2l0aG91dCB0b3VjaGluZyByb3V0ZXIgc3RhdGUKCiAgICAgICAgICAgIHZhciBpZ25vcmVOZXh0SGlzdG9yeVVwZGF0ZSA9IGZhbHNlOyAvLyBJbml0aWFsaXplIHRoZSByb3V0ZXIsIGFsbCBzaWRlIGVmZmVjdHMgc2hvdWxkIGJlIGtpY2tlZCBvZmYgZnJvbSBoZXJlLgogICAgICAgICAgICAvLyBJbXBsZW1lbnRlZCBhcyBhIEZsdWVudCBBUEkgZm9yIGVhc2Ugb2Y6CiAgICAgICAgICAgIC8vICAgbGV0IHJvdXRlciA9IGNyZWF0ZVJvdXRlcihpbml0KS5pbml0aWFsaXplKCk7CgogICAgICAgICAgICBmdW5jdGlvbiBpbml0aWFsaXplKCkgewogICAgICAgICAgICAgIC8vIElmIGhpc3RvcnkgaW5mb3JtcyB1cyBvZiBhIFBPUCBuYXZpZ2F0aW9uLCBzdGFydCB0aGUgbmF2aWdhdGlvbiBidXQgZG8gbm90IHVwZGF0ZQogICAgICAgICAgICAgIC8vIHN0YXRlLiAgV2UnbGwgdXBkYXRlIG91ciBvd24gc3RhdGUgb25jZSB0aGUgbmF2aWdhdGlvbiBjb21wbGV0ZXMKICAgICAgICAgICAgICB1bmxpc3Rlbkhpc3RvcnkgPSBpbml0Lmhpc3RvcnkubGlzdGVuKChfcmVmKSA9PiB7CiAgICAgICAgICAgICAgICB2YXIKICAgICAgICAgICAgICAgICAgaGlzdG9yeUFjdGlvbiA9CgoKICAgICAgICAgICAgICAgICAgX3JlZi5hY3Rpb24sbG9jYXRpb24gPSBfcmVmLmxvY2F0aW9uLGRlbHRhID0gX3JlZi5kZWx0YTsKCiAgICAgICAgICAgICAgICAvLyBJZ25vcmUgdGhpcyBldmVudCBpZiBpdCB3YXMganVzdCB1cyByZXNldHRpbmcgdGhlIFVSTCBmcm9tIGEKICAgICAgICAgICAgICAgIC8vIGJsb2NrZWQgUE9QIG5hdmlnYXRpb24KICAgICAgICAgICAgICAgIGlmIChpZ25vcmVOZXh0SGlzdG9yeVVwZGF0ZSkgewogICAgICAgICAgICAgICAgICBpZ25vcmVOZXh0SGlzdG9yeVVwZGF0ZSA9IGZhbHNlOwogICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgdmFyIGJsb2NrZXJLZXkgPSBzaG91bGRCbG9ja05hdmlnYXRpb24oewogICAgICAgICAgICAgICAgICBjdXJyZW50TG9jYXRpb246IHN0YXRlLmxvY2F0aW9uLAogICAgICAgICAgICAgICAgICBuZXh0TG9jYXRpb246IGxvY2F0aW9uLAogICAgICAgICAgICAgICAgICBoaXN0b3J5QWN0aW9uOiBoaXN0b3J5QWN0aW9uCiAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgICBpZiAoYmxvY2tlcktleSkgewogICAgICAgICAgICAgICAgICAvLyBSZXN0b3JlIHRoZSBVUkwgdG8gbWF0Y2ggdGhlIGN1cnJlbnQgVUksIGJ1dCBkb24ndCB1cGRhdGUgcm91dGVyIHN0YXRlCiAgICAgICAgICAgICAgICAgIGlnbm9yZU5leHRIaXN0b3J5VXBkYXRlID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgaW5pdC5oaXN0b3J5LmdvKGRlbHRhICogLTEpOyAvLyBQdXQgdGhlIGJsb2NrZXIgaW50byBhIGJsb2NrZWQgc3RhdGUKCiAgICAgICAgICAgICAgICAgIHVwZGF0ZUJsb2NrZXIoYmxvY2tlcktleSwgewogICAgICAgICAgICAgICAgICAgIHN0YXRlOiAiYmxvY2tlZCIsCiAgICAgICAgICAgICAgICAgICAgbG9jYXRpb246IGxvY2F0aW9uLAoKICAgICAgICAgICAgICAgICAgICBwcm9jZWVkOiBmdW5jdGlvbiBwcm9jZWVkKCkgewogICAgICAgICAgICAgICAgICAgICAgdXBkYXRlQmxvY2tlcihibG9ja2VyS2V5LCB7CiAgICAgICAgICAgICAgICAgICAgICAgIHN0YXRlOiAicHJvY2VlZGluZyIsCiAgICAgICAgICAgICAgICAgICAgICAgIHByb2NlZWQ6IHVuZGVmaW5lZCwKICAgICAgICAgICAgICAgICAgICAgICAgcmVzZXQ6IHVuZGVmaW5lZCwKICAgICAgICAgICAgICAgICAgICAgICAgbG9jYXRpb246IGxvY2F0aW9uCiAgICAgICAgICAgICAgICAgICAgICB9KTsgLy8gUmUtZG8gdGhlIHNhbWUgUE9QIG5hdmlnYXRpb24gd2UganVzdCBibG9ja2VkCgogICAgICAgICAgICAgICAgICAgICAgaW5pdC5oaXN0b3J5LmdvKGRlbHRhKTsKICAgICAgICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICAgICAgICByZXNldDogZnVuY3Rpb24gcmVzZXQoKSB7CiAgICAgICAgICAgICAgICAgICAgICBkZWxldGVCbG9ja2VyKGJsb2NrZXJLZXkpOwogICAgICAgICAgICAgICAgICAgICAgdXBkYXRlU3RhdGUoewogICAgICAgICAgICAgICAgICAgICAgICBibG9ja2VyczogbmV3IE1hcChyb3V0ZXIuc3RhdGUuYmxvY2tlcnMpCiAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHJldHVybiBzdGFydE5hdmlnYXRpb24oaGlzdG9yeUFjdGlvbiwgbG9jYXRpb24pOwogICAgICAgICAgICAgIH0pOyAvLyBLaWNrIG9mZiBpbml0aWFsIGRhdGEgbG9hZCBpZiBuZWVkZWQuICBVc2UgUG9wIHRvIGF2b2lkIG1vZGlmeWluZyBoaXN0b3J5CgogICAgICAgICAgICAgIGlmICghc3RhdGUuaW5pdGlhbGl6ZWQpIHsKICAgICAgICAgICAgICAgIHN0YXJ0TmF2aWdhdGlvbihBY3Rpb24uUG9wLCBzdGF0ZS5sb2NhdGlvbik7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICByZXR1cm4gcm91dGVyOwogICAgICAgICAgICB9IC8vIENsZWFuIHVwIGEgcm91dGVyIGFuZCBpdCdzIHNpZGUgZWZmZWN0cwoKCiAgICAgICAgICAgIGZ1bmN0aW9uIGRpc3Bvc2UoKSB7CiAgICAgICAgICAgICAgaWYgKHVubGlzdGVuSGlzdG9yeSkgewogICAgICAgICAgICAgICAgdW5saXN0ZW5IaXN0b3J5KCk7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBzdWJzY3JpYmVycy5jbGVhcigpOwogICAgICAgICAgICAgIHBlbmRpbmdOYXZpZ2F0aW9uQ29udHJvbGxlciAmJiBwZW5kaW5nTmF2aWdhdGlvbkNvbnRyb2xsZXIuYWJvcnQoKTsKICAgICAgICAgICAgICBzdGF0ZS5mZXRjaGVycy5mb3JFYWNoKChfLCBrZXkpID0+IGRlbGV0ZUZldGNoZXIoa2V5KSk7CiAgICAgICAgICAgICAgc3RhdGUuYmxvY2tlcnMuZm9yRWFjaCgoXywga2V5KSA9PiBkZWxldGVCbG9ja2VyKGtleSkpOwogICAgICAgICAgICB9IC8vIFN1YnNjcmliZSB0byBzdGF0ZSB1cGRhdGVzIGZvciB0aGUgcm91dGVyCgoKICAgICAgICAgICAgZnVuY3Rpb24gc3Vic2NyaWJlKGZuKSB7CiAgICAgICAgICAgICAgc3Vic2NyaWJlcnMuYWRkKGZuKTsKICAgICAgICAgICAgICByZXR1cm4gKCkgPT4gc3Vic2NyaWJlcnMuZGVsZXRlKGZuKTsKICAgICAgICAgICAgfSAvLyBVcGRhdGUgb3VyIHN0YXRlIGFuZCBub3RpZnkgdGhlIGNhbGxpbmcgY29udGV4dCBvZiB0aGUgY2hhbmdlCgoKICAgICAgICAgICAgZnVuY3Rpb24gdXBkYXRlU3RhdGUobmV3U3RhdGUpIHsKICAgICAgICAgICAgICBzdGF0ZSA9IF9leHRlbmRzKHt9LCBzdGF0ZSwgbmV3U3RhdGUpOwogICAgICAgICAgICAgIHN1YnNjcmliZXJzLmZvckVhY2goKHN1YnNjcmliZXIpID0+IHN1YnNjcmliZXIoc3RhdGUpKTsKICAgICAgICAgICAgfSAvLyBDb21wbGV0ZSBhIG5hdmlnYXRpb24gcmV0dXJuaW5nIHRoZSBzdGF0ZS5uYXZpZ2F0aW9uIGJhY2sgdG8gdGhlIElETEVfTkFWSUdBVElPTgogICAgICAgICAgICAvLyBhbmQgc2V0dGluZyBzdGF0ZS5baGlzdG9yeUFjdGlvbi9sb2NhdGlvbi9tYXRjaGVzXSB0byB0aGUgbmV3IHJvdXRlLgogICAgICAgICAgICAvLyAtIExvY2F0aW9uIGlzIGEgcmVxdWlyZWQgcGFyYW0KICAgICAgICAgICAgLy8gLSBOYXZpZ2F0aW9uIHdpbGwgYWx3YXlzIGJlIHNldCB0byBJRExFX05BVklHQVRJT04KICAgICAgICAgICAgLy8gLSBDYW4gcGFzcyBhbnkgb3RoZXIgc3RhdGUgaW4gbmV3U3RhdGUKCgogICAgICAgICAgICBmdW5jdGlvbiBjb21wbGV0ZU5hdmlnYXRpb24obG9jYXRpb24sIG5ld1N0YXRlKSB7CiAgICAgICAgICAgICAgdmFyIF9sb2NhdGlvbiRzdGF0ZSwgX2xvY2F0aW9uJHN0YXRlMjsKCiAgICAgICAgICAgICAgLy8gRGVkdWNlIGlmIHdlJ3JlIGluIGEgbG9hZGluZy9hY3Rpb25SZWxvYWQgc3RhdGU6CiAgICAgICAgICAgICAgLy8gLSBXZSBoYXZlIGNvbW1pdHRlZCBhY3Rpb25EYXRhIGluIHRoZSBzdG9yZQogICAgICAgICAgICAgIC8vIC0gVGhlIGN1cnJlbnQgbmF2aWdhdGlvbiB3YXMgYSBtdXRhdGlvbiBzdWJtaXNzaW9uCiAgICAgICAgICAgICAgLy8gLSBXZSdyZSBwYXN0IHRoZSBzdWJtaXR0aW5nIHN0YXRlIGFuZCBpbnRvIHRoZSBsb2FkaW5nIHN0YXRlCiAgICAgICAgICAgICAgLy8gLSBUaGUgbG9jYXRpb24gYmVpbmcgbG9hZGVkIGlzIG5vdCB0aGUgcmVzdWx0IG9mIGEgcmVkaXJlY3QKICAgICAgICAgICAgICB2YXIgaXNBY3Rpb25SZWxvYWQgPSBzdGF0ZS5hY3Rpb25EYXRhICE9IG51bGwgJiYgc3RhdGUubmF2aWdhdGlvbi5mb3JtTWV0aG9kICE9IG51bGwgJiYgaXNNdXRhdGlvbk1ldGhvZChzdGF0ZS5uYXZpZ2F0aW9uLmZvcm1NZXRob2QpICYmIHN0YXRlLm5hdmlnYXRpb24uc3RhdGUgPT09ICJsb2FkaW5nIiAmJiAoKF9sb2NhdGlvbiRzdGF0ZSA9IGxvY2F0aW9uLnN0YXRlKSA9PSBudWxsID8gdm9pZCAwIDogX2xvY2F0aW9uJHN0YXRlLl9pc1JlZGlyZWN0KSAhPT0gdHJ1ZTsKICAgICAgICAgICAgICB2YXIgYWN0aW9uRGF0YTsKCiAgICAgICAgICAgICAgaWYgKG5ld1N0YXRlLmFjdGlvbkRhdGEpIHsKICAgICAgICAgICAgICAgIGlmIChPYmplY3Qua2V5cyhuZXdTdGF0ZS5hY3Rpb25EYXRhKS5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgICAgICAgIGFjdGlvbkRhdGEgPSBuZXdTdGF0ZS5hY3Rpb25EYXRhOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgLy8gRW1wdHkgYWN0aW9uRGF0YSAtPiBjbGVhciBwcmlvciBhY3Rpb25EYXRhIGR1ZSB0byBhbiBhY3Rpb24gZXJyb3IKICAgICAgICAgICAgICAgICAgYWN0aW9uRGF0YSA9IG51bGw7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfSBlbHNlIGlmIChpc0FjdGlvblJlbG9hZCkgewogICAgICAgICAgICAgICAgLy8gS2VlcCB0aGUgY3VycmVudCBkYXRhIGlmIHdlJ3JlIHdyYXBwaW5nIHVwIHRoZSBhY3Rpb24gcmVsb2FkCiAgICAgICAgICAgICAgICBhY3Rpb25EYXRhID0gc3RhdGUuYWN0aW9uRGF0YTsKICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgLy8gQ2xlYXIgYWN0aW9uRGF0YSBvbiBhbnkgb3RoZXIgY29tcGxldGVkIG5hdmlnYXRpb25zCiAgICAgICAgICAgICAgICBhY3Rpb25EYXRhID0gbnVsbDsKICAgICAgICAgICAgICB9IC8vIEFsd2F5cyBwcmVzZXJ2ZSBhbnkgZXhpc3RpbmcgbG9hZGVyRGF0YSBmcm9tIHJlLXVzZWQgcm91dGVzCgoKICAgICAgICAgICAgICB2YXIgbG9hZGVyRGF0YSA9IG5ld1N0YXRlLmxvYWRlckRhdGEgPyBtZXJnZUxvYWRlckRhdGEoc3RhdGUubG9hZGVyRGF0YSwgbmV3U3RhdGUubG9hZGVyRGF0YSwgbmV3U3RhdGUubWF0Y2hlcyB8fCBbXSwgbmV3U3RhdGUuZXJyb3JzKSA6IHN0YXRlLmxvYWRlckRhdGE7IC8vIE9uIGEgc3VjY2Vzc2Z1bCBuYXZpZ2F0aW9uIHdlIGNhbiBhc3N1bWUgd2UgZ290IHRocm91Z2ggYWxsIGJsb2NrZXJzCiAgICAgICAgICAgICAgLy8gc28gd2UgY2FuIHN0YXJ0IGZyZXNoCiAgICAgICAgICAgICAgdmFyIF9pdGVyYXRvcjQgPSBfY3JlYXRlRm9yT2ZJdGVyYXRvckhlbHBlcjIoCiAgICAgICAgICAgICAgICBibG9ja2VyRnVuY3Rpb25zKSxfc3RlcDQ7dHJ5IHtmb3IgKF9pdGVyYXRvcjQucygpOyAhKF9zdGVwNCA9IF9pdGVyYXRvcjQubigpKS5kb25lOykge3ZhciBfc3RlcDQkdmFsdWUgPSBfc2xpY2VkVG9BcnJheTIoX3N0ZXA0LnZhbHVlLCAxKSxrZXkgPSBfc3RlcDQkdmFsdWVbMF07CiAgICAgICAgICAgICAgICAgIGRlbGV0ZUJsb2NrZXIoa2V5KTsKICAgICAgICAgICAgICAgIH0gLy8gQWx3YXlzIHJlc3BlY3QgdGhlIHVzZXIgZmxhZy4gIE90aGVyd2lzZSBkb24ndCByZXNldCBvbiBtdXRhdGlvbgogICAgICAgICAgICAgICAgLy8gc3VibWlzc2lvbiBuYXZpZ2F0aW9ucyB1bmxlc3MgdGhleSByZWRpcmVjdAogICAgICAgICAgICAgIH0gY2F0Y2ggKGVycikge19pdGVyYXRvcjQuZShlcnIpO30gZmluYWxseSB7X2l0ZXJhdG9yNC5mKCk7fQoKICAgICAgICAgICAgICB2YXIgcHJldmVudFNjcm9sbFJlc2V0ID0gcGVuZGluZ1ByZXZlbnRTY3JvbGxSZXNldCA9PT0gdHJ1ZSB8fCBzdGF0ZS5uYXZpZ2F0aW9uLmZvcm1NZXRob2QgIT0gbnVsbCAmJiBpc011dGF0aW9uTWV0aG9kKHN0YXRlLm5hdmlnYXRpb24uZm9ybU1ldGhvZCkgJiYgKChfbG9jYXRpb24kc3RhdGUyID0gbG9jYXRpb24uc3RhdGUpID09IG51bGwgPyB2b2lkIDAgOiBfbG9jYXRpb24kc3RhdGUyLl9pc1JlZGlyZWN0KSAhPT0gdHJ1ZTsKICAgICAgICAgICAgICB1cGRhdGVTdGF0ZShfZXh0ZW5kcyh7fSwgbmV3U3RhdGUsIHsKICAgICAgICAgICAgICAgIGFjdGlvbkRhdGE6IGFjdGlvbkRhdGEsCiAgICAgICAgICAgICAgICBsb2FkZXJEYXRhOiBsb2FkZXJEYXRhLAogICAgICAgICAgICAgICAgaGlzdG9yeUFjdGlvbjogcGVuZGluZ0FjdGlvbiwKICAgICAgICAgICAgICAgIGxvY2F0aW9uOiBsb2NhdGlvbiwKICAgICAgICAgICAgICAgIGluaXRpYWxpemVkOiB0cnVlLAogICAgICAgICAgICAgICAgbmF2aWdhdGlvbjogSURMRV9OQVZJR0FUSU9OLAogICAgICAgICAgICAgICAgcmV2YWxpZGF0aW9uOiAiaWRsZSIsCiAgICAgICAgICAgICAgICByZXN0b3JlU2Nyb2xsUG9zaXRpb246IGdldFNhdmVkU2Nyb2xsUG9zaXRpb24obG9jYXRpb24sIG5ld1N0YXRlLm1hdGNoZXMgfHwgc3RhdGUubWF0Y2hlcyksCiAgICAgICAgICAgICAgICBwcmV2ZW50U2Nyb2xsUmVzZXQ6IHByZXZlbnRTY3JvbGxSZXNldCwKICAgICAgICAgICAgICAgIGJsb2NrZXJzOiBuZXcgTWFwKHN0YXRlLmJsb2NrZXJzKQogICAgICAgICAgICAgIH0pKTsKCiAgICAgICAgICAgICAgaWYgKGlzVW5pbnRlcnJ1cHRlZFJldmFsaWRhdGlvbikgO2Vsc2UgaWYgKHBlbmRpbmdBY3Rpb24gPT09IEFjdGlvbi5Qb3ApIDtlbHNlIGlmIChwZW5kaW5nQWN0aW9uID09PSBBY3Rpb24uUHVzaCkgewogICAgICAgICAgICAgICAgaW5pdC5oaXN0b3J5LnB1c2gobG9jYXRpb24sIGxvY2F0aW9uLnN0YXRlKTsKICAgICAgICAgICAgICB9IGVsc2UgaWYgKHBlbmRpbmdBY3Rpb24gPT09IEFjdGlvbi5SZXBsYWNlKSB7CiAgICAgICAgICAgICAgICBpbml0Lmhpc3RvcnkucmVwbGFjZShsb2NhdGlvbiwgbG9jYXRpb24uc3RhdGUpOwogICAgICAgICAgICAgIH0gLy8gUmVzZXQgc3RhdGVmdWwgbmF2aWdhdGlvbiB2YXJzCgoKICAgICAgICAgICAgICBwZW5kaW5nQWN0aW9uID0gQWN0aW9uLlBvcDsKICAgICAgICAgICAgICBwZW5kaW5nUHJldmVudFNjcm9sbFJlc2V0ID0gZmFsc2U7CiAgICAgICAgICAgICAgaXNVbmludGVycnVwdGVkUmV2YWxpZGF0aW9uID0gZmFsc2U7CiAgICAgICAgICAgICAgaXNSZXZhbGlkYXRpb25SZXF1aXJlZCA9IGZhbHNlOwogICAgICAgICAgICAgIGNhbmNlbGxlZERlZmVycmVkUm91dGVzID0gW107CiAgICAgICAgICAgICAgY2FuY2VsbGVkRmV0Y2hlckxvYWRzID0gW107CiAgICAgICAgICAgIH0gLy8gVHJpZ2dlciBhIG5hdmlnYXRpb24gZXZlbnQsIHdoaWNoIGNhbiBlaXRoZXIgYmUgYSBudW1lcmljYWwgUE9QIG9yIGEgUFVTSAogICAgICAgICAgICAvLyByZXBsYWNlIHdpdGggYW4gb3B0aW9uYWwgc3VibWlzc2lvbgogICAgICAgICAgICBmdW5jdGlvbgoKICAgICAgICAgICAgbmF2aWdhdGUoX3g0LCBfeDUpIHtyZXR1cm4gX25hdmlnYXRlLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7fQoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCiAgICAgICAgICAgIC8vIFJldmFsaWRhdGUgYWxsIGN1cnJlbnQgbG9hZGVycy4gIElmIGEgbmF2aWdhdGlvbiBpcyBpbiBwcm9ncmVzcyBvciBpZiB0aGlzCiAgICAgICAgICAgIC8vIGlzIGludGVycnVwdGVkIGJ5IGEgbmF2aWdhdGlvbiwgYWxsb3cgdGhpcyB0byAic3VjY2VlZCIgYnkgY2FsbGluZyBhbGwKICAgICAgICAgICAgLy8gbG9hZGVycyBkdXJpbmcgdGhlIG5leHQgbG9hZGVyIHJvdW5kCiAgICAgICAgICAgIGZ1bmN0aW9uIF9uYXZpZ2F0ZSgpIHtfbmF2aWdhdGUgPSBfYXN5bmNUb0dlbmVyYXRvcjIoIC8qI19fUFVSRV9fKi9fcmVnZW5lcmF0b3JSdW50aW1lMigpLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTModG8sIG9wdHMpIHt2YXIgX25vcm1hbGl6ZU5hdmlnYXRlT3B0MiwgcGF0aCwgc3VibWlzc2lvbiwgZXJyb3IsIGN1cnJlbnRMb2NhdGlvbiwgbmV4dExvY2F0aW9uLCB1c2VyUmVwbGFjZSwgaGlzdG9yeUFjdGlvbiwgcHJldmVudFNjcm9sbFJlc2V0LCBibG9ja2VyS2V5O3JldHVybiBfcmVnZW5lcmF0b3JSdW50aW1lMigpLndyYXAoZnVuY3Rpb24gX2NhbGxlZTMkKF9jb250ZXh0Mykge3doaWxlICgxKSBzd2l0Y2ggKF9jb250ZXh0My5wcmV2ID0gX2NvbnRleHQzLm5leHQpIHtjYXNlIDA6aWYgKCEodHlwZW9mIHRvID09PSAibnVtYmVyIikpIHtfY29udGV4dDMubmV4dCA9IDM7YnJlYWs7fWluaXQuaGlzdG9yeS5nbyh0byk7cmV0dXJuIF9jb250ZXh0My5hYnJ1cHQoInJldHVybiIpO2Nhc2UgMzpfbm9ybWFsaXplTmF2aWdhdGVPcHQyID0gbm9ybWFsaXplTmF2aWdhdGVPcHRpb25zKHRvLCBvcHRzKSwgcGF0aCA9IF9ub3JtYWxpemVOYXZpZ2F0ZU9wdDIucGF0aCwgc3VibWlzc2lvbiA9IF9ub3JtYWxpemVOYXZpZ2F0ZU9wdDIuc3VibWlzc2lvbiwgZXJyb3IgPSBfbm9ybWFsaXplTmF2aWdhdGVPcHQyLmVycm9yO2N1cnJlbnRMb2NhdGlvbiA9IHN0YXRlLmxvY2F0aW9uO25leHRMb2NhdGlvbiA9IGNyZWF0ZUxvY2F0aW9uKHN0YXRlLmxvY2F0aW9uLCBwYXRoLCBvcHRzICYmIG9wdHMuc3RhdGUpOyAvLyBXaGVuIHVzaW5nIG5hdmlnYXRlIGFzIGEgUFVTSC9SRVBMQUNFIHdlIGFyZW4ndCByZWFkaW5nIGFuIGFscmVhZHktZW5jb2RlZAogICAgICAgICAgICAgICAgICAgICAgLy8gVVJMIGZyb20gd2luZG93LmxvY2F0aW9uLCBzbyB3ZSBuZWVkIHRvIGVuY29kZSBpdCBoZXJlIHNvIHRoZSBiZWhhdmlvcgogICAgICAgICAgICAgICAgICAgICAgLy8gcmVtYWlucyB0aGUgc2FtZSBhcyBQT1AgYW5kIG5vbi1kYXRhLXJvdXRlciB1c2FnZXMuICBuZXcgVVJMKCkgZG9lcyBhbGwKICAgICAgICAgICAgICAgICAgICAgIC8vIHRoZSBzYW1lIGVuY29kaW5nIHdlJ2QgZ2V0IGZyb20gYSBoaXN0b3J5LnB1c2hTdGF0ZS93aW5kb3cubG9jYXRpb24gcmVhZAogICAgICAgICAgICAgICAgICAgICAgLy8gd2l0aG91dCBoYXZpbmcgdG8gdG91Y2ggaGlzdG9yeQogICAgICAgICAgICAgICAgICAgICAgbmV4dExvY2F0aW9uID0gX2V4dGVuZHMoe30sIG5leHRMb2NhdGlvbiwgaW5pdC5oaXN0b3J5LmVuY29kZUxvY2F0aW9uKG5leHRMb2NhdGlvbikpO3VzZXJSZXBsYWNlID0gb3B0cyAmJiBvcHRzLnJlcGxhY2UgIT0gbnVsbCA/IG9wdHMucmVwbGFjZSA6IHVuZGVmaW5lZDtoaXN0b3J5QWN0aW9uID0gQWN0aW9uLlB1c2g7aWYgKHVzZXJSZXBsYWNlID09PSB0cnVlKSB7aGlzdG9yeUFjdGlvbiA9IEFjdGlvbi5SZXBsYWNlO30gZWxzZSBpZiAodXNlclJlcGxhY2UgPT09IGZhbHNlKSA7ZWxzZSBpZiAoc3VibWlzc2lvbiAhPSBudWxsICYmIGlzTXV0YXRpb25NZXRob2Qoc3VibWlzc2lvbi5mb3JtTWV0aG9kKSAmJiBzdWJtaXNzaW9uLmZvcm1BY3Rpb24gPT09IHN0YXRlLmxvY2F0aW9uLnBhdGhuYW1lICsgc3RhdGUubG9jYXRpb24uc2VhcmNoKSB7Ly8gQnkgZGVmYXVsdCBvbiBzdWJtaXNzaW9ucyB0byB0aGUgY3VycmVudCBsb2NhdGlvbiB3ZSBSRVBMQUNFIHNvIHRoYXQKICAgICAgICAgICAgICAgICAgICAgICAgLy8gdXNlcnMgZG9uJ3QgaGF2ZSB0byBkb3VibGUtY2xpY2sgdGhlIGJhY2sgYnV0dG9uIHRvIGdldCB0byB0aGUgcHJpb3IKICAgICAgICAgICAgICAgICAgICAgICAgLy8gbG9jYXRpb24uICBJZiB0aGUgdXNlciByZWRpcmVjdHMgdG8gYSBkaWZmZXJlbnQgbG9jYXRpb24gZnJvbSB0aGUKICAgICAgICAgICAgICAgICAgICAgICAgLy8gYWN0aW9uL2xvYWRlciB0aGlzIHdpbGwgYmUgaWdub3JlZCBhbmQgdGhlIHJlZGlyZWN0IHdpbGwgYmUgYSBQVVNICiAgICAgICAgICAgICAgICAgICAgICAgIGhpc3RvcnlBY3Rpb24gPSBBY3Rpb24uUmVwbGFjZTt9cHJldmVudFNjcm9sbFJlc2V0ID0gb3B0cyAmJiAicHJldmVudFNjcm9sbFJlc2V0IiBpbiBvcHRzID8gb3B0cy5wcmV2ZW50U2Nyb2xsUmVzZXQgPT09IHRydWUgOiB1bmRlZmluZWQ7YmxvY2tlcktleSA9IHNob3VsZEJsb2NrTmF2aWdhdGlvbih7IGN1cnJlbnRMb2NhdGlvbjogY3VycmVudExvY2F0aW9uLCBuZXh0TG9jYXRpb246IG5leHRMb2NhdGlvbiwgaGlzdG9yeUFjdGlvbjogaGlzdG9yeUFjdGlvbiB9KTtpZiAoIWJsb2NrZXJLZXkpIHtfY29udGV4dDMubmV4dCA9IDE1O2JyZWFrO30gLy8gUHV0IHRoZSBibG9ja2VyIGludG8gYSBibG9ja2VkIHN0YXRlCiAgICAgICAgICAgICAgICAgICAgICB1cGRhdGVCbG9ja2VyKGJsb2NrZXJLZXksIHsgc3RhdGU6ICJibG9ja2VkIiwgbG9jYXRpb246IG5leHRMb2NhdGlvbiwgcHJvY2VlZDogZnVuY3Rpb24gcHJvY2VlZCgpIHt1cGRhdGVCbG9ja2VyKGJsb2NrZXJLZXksIHsgc3RhdGU6ICJwcm9jZWVkaW5nIiwgcHJvY2VlZDogdW5kZWZpbmVkLCByZXNldDogdW5kZWZpbmVkLCBsb2NhdGlvbjogbmV4dExvY2F0aW9uIH0pOyAvLyBTZW5kIHRoZSBzYW1lIG5hdmlnYXRpb24gdGhyb3VnaAogICAgICAgICAgICAgICAgICAgICAgICAgIG5hdmlnYXRlKHRvLCBvcHRzKTt9LCByZXNldDogZnVuY3Rpb24gcmVzZXQoKSB7ZGVsZXRlQmxvY2tlcihibG9ja2VyS2V5KTt1cGRhdGVTdGF0ZSh7IGJsb2NrZXJzOiBuZXcgTWFwKHN0YXRlLmJsb2NrZXJzKSB9KTt9IH0pO3JldHVybiBfY29udGV4dDMuYWJydXB0KCJyZXR1cm4iKTtjYXNlIDE1Ol9jb250ZXh0My5uZXh0ID0gMTc7cmV0dXJuIHN0YXJ0TmF2aWdhdGlvbihoaXN0b3J5QWN0aW9uLCBuZXh0TG9jYXRpb24sIHsgc3VibWlzc2lvbjogc3VibWlzc2lvbiwgLy8gU2VuZCB0aHJvdWdoIHRoZSBmb3JtRGF0YSBzZXJpYWxpemF0aW9uIGVycm9yIGlmIHdlIGhhdmUgb25lIHNvIHdlIGNhbgogICAgICAgICAgICAgICAgICAgICAgICAvLyByZW5kZXIgYXQgdGhlIHJpZ2h0IGVycm9yIGJvdW5kYXJ5IGFmdGVyIHdlIG1hdGNoIHJvdXRlcwogICAgICAgICAgICAgICAgICAgICAgICBwZW5kaW5nRXJyb3I6IGVycm9yLCBwcmV2ZW50U2Nyb2xsUmVzZXQ6IHByZXZlbnRTY3JvbGxSZXNldCwgcmVwbGFjZTogb3B0cyAmJiBvcHRzLnJlcGxhY2UgfSk7Y2FzZSAxNzpyZXR1cm4gX2NvbnRleHQzLmFicnVwdCgicmV0dXJuIiwgX2NvbnRleHQzLnNlbnQpO2Nhc2UgMTg6Y2FzZSAiZW5kIjpyZXR1cm4gX2NvbnRleHQzLnN0b3AoKTt9fSwgX2NhbGxlZTMpO30pKTtyZXR1cm4gX25hdmlnYXRlLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7fWZ1bmN0aW9uIHJldmFsaWRhdGUoKSB7aW50ZXJydXB0QWN0aXZlTG9hZHMoKTt1cGRhdGVTdGF0ZSh7IHJldmFsaWRhdGlvbjogImxvYWRpbmciIH0pOyAvLyBJZiB3ZSdyZSBjdXJyZW50bHkgc3VibWl0dGluZyBhbiBhY3Rpb24sIHdlIGRvbid0IG5lZWQgdG8gc3RhcnQgYSBuZXcKICAgICAgICAgICAgICAvLyBuYXZpZ2F0aW9uLCB3ZSdsbCBqdXN0IGxldCB0aGUgZm9sbG93IHVwIGxvYWRlciBleGVjdXRpb24gY2FsbCBhbGwgbG9hZGVycwogICAgICAgICAgICAgIGlmIChzdGF0ZS5uYXZpZ2F0aW9uLnN0YXRlID09PSAic3VibWl0dGluZyIpIHtyZXR1cm47fSAvLyBJZiB3ZSdyZSBjdXJyZW50bHkgaW4gYW4gaWRsZSBzdGF0ZSwgc3RhcnQgYSBuZXcgbmF2aWdhdGlvbiBmb3IgdGhlIGN1cnJlbnQKICAgICAgICAgICAgICAvLyBhY3Rpb24vbG9jYXRpb24gYW5kIG1hcmsgaXQgYXMgdW5pbnRlcnJ1cHRlZCwgd2hpY2ggd2lsbCBza2lwIHRoZSBoaXN0b3J5CiAgICAgICAgICAgICAgLy8gdXBkYXRlIGluIGNvbXBsZXRlTmF2aWdhdGlvbgogICAgICAgICAgICAgIGlmIChzdGF0ZS5uYXZpZ2F0aW9uLnN0YXRlID09PSAiaWRsZSIpIHtzdGFydE5hdmlnYXRpb24oc3RhdGUuaGlzdG9yeUFjdGlvbiwgc3RhdGUubG9jYXRpb24sIHsgc3RhcnRVbmludGVycnVwdGVkUmV2YWxpZGF0aW9uOiB0cnVlCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICB9IC8vIE90aGVyd2lzZSwgaWYgd2UncmUgY3VycmVudGx5IGluIGEgbG9hZGluZyBzdGF0ZSwganVzdCBzdGFydCBhIG5ldwogICAgICAgICAgICAgIC8vIG5hdmlnYXRpb24gdG8gdGhlIG5hdmlnYXRpb24ubG9jYXRpb24gYnV0IGRvIG5vdCB0cmlnZ2VyIGFuIHVuaW50ZXJydXB0ZWQKICAgICAgICAgICAgICAvLyByZXZhbGlkYXRpb24gc28gdGhhdCBoaXN0b3J5IGNvcnJlY3RseSB1cGRhdGVzIG9uY2UgdGhlIG5hdmlnYXRpb24gY29tcGxldGVzCgoKICAgICAgICAgICAgICBzdGFydE5hdmlnYXRpb24ocGVuZGluZ0FjdGlvbiB8fCBzdGF0ZS5oaXN0b3J5QWN0aW9uLCBzdGF0ZS5uYXZpZ2F0aW9uLmxvY2F0aW9uLCB7CiAgICAgICAgICAgICAgICBvdmVycmlkZU5hdmlnYXRpb246IHN0YXRlLm5hdmlnYXRpb24KICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSAvLyBTdGFydCBhIG5hdmlnYXRpb24gdG8gdGhlIGdpdmVuIGFjdGlvbi9sb2NhdGlvbi4gIENhbiBvcHRpb25hbGx5IHByb3ZpZGUgYQogICAgICAgICAgICAvLyBvdmVycmlkZU5hdmlnYXRpb24gd2hpY2ggd2lsbCBvdmVycmlkZSB0aGUgbm9ybWFsTG9hZCBpbiB0aGUgY2FzZSBvZiBhIHJlZGlyZWN0CiAgICAgICAgICAgIC8vIG5hdmlnYXRpb24KICAgICAgICAgICAgZnVuY3Rpb24KCiAgICAgICAgICAgIHN0YXJ0TmF2aWdhdGlvbihfeDYsIF94NywgX3g4KSB7cmV0dXJuIF9zdGFydE5hdmlnYXRpb24uYXBwbHkodGhpcywgYXJndW1lbnRzKTt9CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKICAgICAgICAgICAgLy8gQ2FsbCB0aGUgYWN0aW9uIG1hdGNoZWQgYnkgdGhlIGxlYWYgcm91dGUgZm9yIHRoaXMgbmF2aWdhdGlvbiBhbmQgaGFuZGxlCiAgICAgICAgICAgIC8vIHJlZGlyZWN0cy9lcnJvcnMKICAgICAgICAgICAgZnVuY3Rpb24gX3N0YXJ0TmF2aWdhdGlvbigpIHtfc3RhcnROYXZpZ2F0aW9uID0gX2FzeW5jVG9HZW5lcmF0b3IyKCAvKiNfX1BVUkVfXyovX3JlZ2VuZXJhdG9yUnVudGltZTIoKS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWU0KGhpc3RvcnlBY3Rpb24sIGxvY2F0aW9uLCBvcHRzKSB7dmFyIGxvYWRpbmdOYXZpZ2F0aW9uLCBtYXRjaGVzLCBfZXJyb3IsIF9nZXRTaG9ydENpcmN1aXRNYXRjaDIsIG5vdEZvdW5kTWF0Y2hlcywgX3JvdXRlLCByZXF1ZXN0LCBwZW5kaW5nQWN0aW9uRGF0YSwgcGVuZGluZ0Vycm9yLCBhY3Rpb25PdXRwdXQsIG5hdmlnYXRpb24sIF95aWVsZCRoYW5kbGVMb2FkZXJzLCBzaG9ydENpcmN1aXRlZCwgbG9hZGVyRGF0YSwgZXJyb3JzO3JldHVybiBfcmVnZW5lcmF0b3JSdW50aW1lMigpLndyYXAoZnVuY3Rpb24gX2NhbGxlZTQkKF9jb250ZXh0NCkge3doaWxlICgxKSBzd2l0Y2ggKF9jb250ZXh0NC5wcmV2ID0gX2NvbnRleHQ0Lm5leHQpIHtjYXNlIDA6IC8vIEFib3J0IGFueSBpbi1wcm9ncmVzcyBuYXZpZ2F0aW9ucyBhbmQgc3RhcnQgYSBuZXcgb25lLiBVbnNldCBhbnkgb25nb2luZwogICAgICAgICAgICAgICAgICAgICAgLy8gdW5pbnRlcnJ1cHRlZCByZXZhbGlkYXRpb25zIHVubGVzcyB0b2xkIG90aGVyd2lzZSwgc2luY2Ugd2Ugd2FudCB0aGlzCiAgICAgICAgICAgICAgICAgICAgICAvLyBuZXcgbmF2aWdhdGlvbiB0byB1cGRhdGUgaGlzdG9yeSBub3JtYWxseQogICAgICAgICAgICAgICAgICAgICAgcGVuZGluZ05hdmlnYXRpb25Db250cm9sbGVyICYmIHBlbmRpbmdOYXZpZ2F0aW9uQ29udHJvbGxlci5hYm9ydCgpO3BlbmRpbmdOYXZpZ2F0aW9uQ29udHJvbGxlciA9IG51bGw7cGVuZGluZ0FjdGlvbiA9IGhpc3RvcnlBY3Rpb247aXNVbmludGVycnVwdGVkUmV2YWxpZGF0aW9uID0gKG9wdHMgJiYgb3B0cy5zdGFydFVuaW50ZXJydXB0ZWRSZXZhbGlkYXRpb24pID09PSB0cnVlOyAvLyBTYXZlIHRoZSBjdXJyZW50IHNjcm9sbCBwb3NpdGlvbiBldmVyeSB0aW1lIHdlIHN0YXJ0IGEgbmV3IG5hdmlnYXRpb24sCiAgICAgICAgICAgICAgICAgICAgICAvLyBhbmQgdHJhY2sgd2hldGhlciB3ZSBzaG91bGQgcmVzZXQgc2Nyb2xsIG9uIGNvbXBsZXRpb24KICAgICAgICAgICAgICAgICAgICAgIHNhdmVTY3JvbGxQb3NpdGlvbihzdGF0ZS5sb2NhdGlvbiwgc3RhdGUubWF0Y2hlcyk7cGVuZGluZ1ByZXZlbnRTY3JvbGxSZXNldCA9IChvcHRzICYmIG9wdHMucHJldmVudFNjcm9sbFJlc2V0KSA9PT0gdHJ1ZTtsb2FkaW5nTmF2aWdhdGlvbiA9IG9wdHMgJiYgb3B0cy5vdmVycmlkZU5hdmlnYXRpb247bWF0Y2hlcyA9IG1hdGNoUm91dGVzKGRhdGFSb3V0ZXMsIGxvY2F0aW9uLCBpbml0LmJhc2VuYW1lKTsgLy8gU2hvcnQgY2lyY3VpdCB3aXRoIGEgNDA0IG9uIHRoZSByb290IGVycm9yIGJvdW5kYXJ5IGlmIHdlIG1hdGNoIG5vdGhpbmcKICAgICAgICAgICAgICAgICAgICAgIGlmIChtYXRjaGVzKSB7X2NvbnRleHQ0Lm5leHQgPSAxNDticmVhazt9X2Vycm9yID0gZ2V0SW50ZXJuYWxSb3V0ZXJFcnJvcig0MDQsIHsgcGF0aG5hbWU6IGxvY2F0aW9uLnBhdGhuYW1lIH0pO19nZXRTaG9ydENpcmN1aXRNYXRjaDIgPSBnZXRTaG9ydENpcmN1aXRNYXRjaGVzKGRhdGFSb3V0ZXMpLCBub3RGb3VuZE1hdGNoZXMgPSBfZ2V0U2hvcnRDaXJjdWl0TWF0Y2gyLm1hdGNoZXMsIF9yb3V0ZSA9IF9nZXRTaG9ydENpcmN1aXRNYXRjaDIucm91dGU7IC8vIENhbmNlbCBhbGwgcGVuZGluZyBkZWZlcnJlZCBvbiA0MDRzIHNpbmNlIHdlIGRvbid0IGtlZXAgYW55IHJvdXRlcwogICAgICAgICAgICAgICAgICAgICAgY2FuY2VsQWN0aXZlRGVmZXJyZWRzKCk7Y29tcGxldGVOYXZpZ2F0aW9uKGxvY2F0aW9uLCB7IG1hdGNoZXM6IG5vdEZvdW5kTWF0Y2hlcywgbG9hZGVyRGF0YToge30sIGVycm9yczogX2RlZmluZVByb3BlcnR5Mih7fSwgX3JvdXRlLmlkLCBfZXJyb3IpIH0pO3JldHVybiBfY29udGV4dDQuYWJydXB0KCJyZXR1cm4iKTtjYXNlIDE0OmlmICghaXNIYXNoQ2hhbmdlT25seShzdGF0ZS5sb2NhdGlvbiwgbG9jYXRpb24pKSB7X2NvbnRleHQ0Lm5leHQgPSAxNzticmVhazt9Y29tcGxldGVOYXZpZ2F0aW9uKGxvY2F0aW9uLCB7IG1hdGNoZXM6IG1hdGNoZXMgfSk7cmV0dXJuIF9jb250ZXh0NC5hYnJ1cHQoInJldHVybiIpO2Nhc2UgMTc6IC8vIENyZWF0ZSBhIGNvbnRyb2xsZXIvUmVxdWVzdCBmb3IgdGhpcyBuYXZpZ2F0aW9uCiAgICAgICAgICAgICAgICAgICAgICBwZW5kaW5nTmF2aWdhdGlvbkNvbnRyb2xsZXIgPSBuZXcgQWJvcnRDb250cm9sbGVyKCk7cmVxdWVzdCA9IGNyZWF0ZUNsaWVudFNpZGVSZXF1ZXN0KGluaXQuaGlzdG9yeSwgbG9jYXRpb24sIHBlbmRpbmdOYXZpZ2F0aW9uQ29udHJvbGxlci5zaWduYWwsIG9wdHMgJiYgb3B0cy5zdWJtaXNzaW9uKTtpZiAoIShvcHRzICYmIG9wdHMucGVuZGluZ0Vycm9yKSkge19jb250ZXh0NC5uZXh0ID0gMjM7YnJlYWs7fSAvLyBJZiB3ZSBoYXZlIGEgcGVuZGluZ0Vycm9yLCBpdCBtZWFucyB0aGUgdXNlciBhdHRlbXB0ZWQgYSBHRVQgc3VibWlzc2lvbgogICAgICAgICAgICAgICAgICAgICAgLy8gd2l0aCBiaW5hcnkgRm9ybURhdGEgc28gYXNzaWduIGhlcmUgYW5kIHNraXAgdG8gaGFuZGxlTG9hZGVycy4gIFRoYXQKICAgICAgICAgICAgICAgICAgICAgIC8vIHdheSB3ZSBoYW5kbGUgY2FsbGluZyBsb2FkZXJzIGFib3ZlIHRoZSBib3VuZGFyeSBldGMuICBJdCdzIG5vdCByZWFsbHkKICAgICAgICAgICAgICAgICAgICAgIC8vIGRpZmZlcmVudCBmcm9tIGFuIGFjdGlvbkVycm9yIGluIHRoYXQgc2Vuc2UuCiAgICAgICAgICAgICAgICAgICAgICBwZW5kaW5nRXJyb3IgPSBfZGVmaW5lUHJvcGVydHkyKHt9LCBmaW5kTmVhcmVzdEJvdW5kYXJ5KG1hdGNoZXMpLnJvdXRlLmlkLCBvcHRzLnBlbmRpbmdFcnJvcik7X2NvbnRleHQ0Lm5leHQgPSAzNDticmVhaztjYXNlIDIzOmlmICghKG9wdHMgJiYgb3B0cy5zdWJtaXNzaW9uICYmIGlzTXV0YXRpb25NZXRob2Qob3B0cy5zdWJtaXNzaW9uLmZvcm1NZXRob2QpKSkge19jb250ZXh0NC5uZXh0ID0gMzQ7YnJlYWs7fV9jb250ZXh0NC5uZXh0ID0gMjY7cmV0dXJuIGhhbmRsZUFjdGlvbihyZXF1ZXN0LCBsb2NhdGlvbiwgb3B0cy5zdWJtaXNzaW9uLCBtYXRjaGVzLCB7IHJlcGxhY2U6IG9wdHMucmVwbGFjZSB9KTtjYXNlIDI2OmFjdGlvbk91dHB1dCA9IF9jb250ZXh0NC5zZW50O2lmICghYWN0aW9uT3V0cHV0LnNob3J0Q2lyY3VpdGVkKSB7X2NvbnRleHQ0Lm5leHQgPSAyOTticmVhazt9cmV0dXJuIF9jb250ZXh0NC5hYnJ1cHQoInJldHVybiIpO2Nhc2UgMjk6cGVuZGluZ0FjdGlvbkRhdGEgPSBhY3Rpb25PdXRwdXQucGVuZGluZ0FjdGlvbkRhdGE7cGVuZGluZ0Vycm9yID0gYWN0aW9uT3V0cHV0LnBlbmRpbmdBY3Rpb25FcnJvcjtuYXZpZ2F0aW9uID0gX2V4dGVuZHMoeyBzdGF0ZTogImxvYWRpbmciLCBsb2NhdGlvbjogbG9jYXRpb24gfSwgb3B0cy5zdWJtaXNzaW9uKTtsb2FkaW5nTmF2aWdhdGlvbiA9IG5hdmlnYXRpb247IC8vIENyZWF0ZSBhIEdFVCByZXF1ZXN0IGZvciB0aGUgbG9hZGVycwogICAgICAgICAgICAgICAgICAgICAgcmVxdWVzdCA9IG5ldyBSZXF1ZXN0KHJlcXVlc3QudXJsLCB7IHNpZ25hbDogcmVxdWVzdC5zaWduYWwgfSk7Y2FzZSAzNDpfY29udGV4dDQubmV4dCA9IDM2O3JldHVybiBoYW5kbGVMb2FkZXJzKHJlcXVlc3QsIGxvY2F0aW9uLCBtYXRjaGVzLCBsb2FkaW5nTmF2aWdhdGlvbiwgb3B0cyAmJiBvcHRzLnN1Ym1pc3Npb24sIG9wdHMgJiYgb3B0cy5yZXBsYWNlLCBwZW5kaW5nQWN0aW9uRGF0YSwgcGVuZGluZ0Vycm9yKTtjYXNlIDM2Ol95aWVsZCRoYW5kbGVMb2FkZXJzID0gX2NvbnRleHQ0LnNlbnQ7c2hvcnRDaXJjdWl0ZWQgPSBfeWllbGQkaGFuZGxlTG9hZGVycy5zaG9ydENpcmN1aXRlZDtsb2FkZXJEYXRhID0gX3lpZWxkJGhhbmRsZUxvYWRlcnMubG9hZGVyRGF0YTtlcnJvcnMgPSBfeWllbGQkaGFuZGxlTG9hZGVycy5lcnJvcnM7aWYgKCFzaG9ydENpcmN1aXRlZCkge19jb250ZXh0NC5uZXh0ID0gNDI7YnJlYWs7fXJldHVybiBfY29udGV4dDQuYWJydXB0KCJyZXR1cm4iKTtjYXNlIDQyOiAvLyBDbGVhbiB1cCBub3cgdGhhdCB0aGUgYWN0aW9uL2xvYWRlcnMgaGF2ZSBjb21wbGV0ZWQuICBEb24ndCBjbGVhbiB1cCBpZgogICAgICAgICAgICAgICAgICAgICAgLy8gd2Ugc2hvcnQgY2lyY3VpdGVkIGJlY2F1c2UgcGVuZGluZ05hdmlnYXRpb25Db250cm9sbGVyIHdpbGwgaGF2ZSBhbHJlYWR5CiAgICAgICAgICAgICAgICAgICAgICAvLyBiZWVuIGFzc2lnbmVkIHRvIGEgbmV3IGNvbnRyb2xsZXIgZm9yIHRoZSBuZXh0IG5hdmlnYXRpb24KICAgICAgICAgICAgICAgICAgICAgIHBlbmRpbmdOYXZpZ2F0aW9uQ29udHJvbGxlciA9IG51bGw7Y29tcGxldGVOYXZpZ2F0aW9uKGxvY2F0aW9uLCBfZXh0ZW5kcyh7IG1hdGNoZXM6IG1hdGNoZXMgfSwgcGVuZGluZ0FjdGlvbkRhdGEgPyB7IGFjdGlvbkRhdGE6IHBlbmRpbmdBY3Rpb25EYXRhIH0gOiB7fSwgeyBsb2FkZXJEYXRhOiBsb2FkZXJEYXRhLCBlcnJvcnM6IGVycm9ycyB9KSk7Y2FzZSA0NDpjYXNlICJlbmQiOnJldHVybiBfY29udGV4dDQuc3RvcCgpO319LCBfY2FsbGVlNCk7fSkpO3JldHVybiBfc3RhcnROYXZpZ2F0aW9uLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7fWZ1bmN0aW9uIGhhbmRsZUFjdGlvbihfeDksIF94MTAsIF94MTEsIF94MTIsIF94MTMpIHtyZXR1cm4gX2hhbmRsZUFjdGlvbi5hcHBseSh0aGlzLCBhcmd1bWVudHMpO30KCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKICAgICAgICAgICAgLy8gQ2FsbCBhbGwgYXBwbGljYWJsZSBsb2FkZXJzIGZvciB0aGUgZ2l2ZW4gbWF0Y2hlcywgaGFuZGxpbmcgcmVkaXJlY3RzLAogICAgICAgICAgICAvLyBlcnJvcnMsIGV0Yy4KICAgICAgICAgICAgZnVuY3Rpb24gX2hhbmRsZUFjdGlvbigpIHtfaGFuZGxlQWN0aW9uID0gX2FzeW5jVG9HZW5lcmF0b3IyKCAvKiNfX1BVUkVfXyovX3JlZ2VuZXJhdG9yUnVudGltZTIoKS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWU1KHJlcXVlc3QsIGxvY2F0aW9uLCBzdWJtaXNzaW9uLCBtYXRjaGVzLCBvcHRzKSB7dmFyIG5hdmlnYXRpb24sIHJlc3VsdCwgYWN0aW9uTWF0Y2gsIHJlcGxhY2UsIGJvdW5kYXJ5TWF0Y2g7cmV0dXJuIF9yZWdlbmVyYXRvclJ1bnRpbWUyKCkud3JhcChmdW5jdGlvbiBfY2FsbGVlNSQoX2NvbnRleHQ1KSB7d2hpbGUgKDEpIHN3aXRjaCAoX2NvbnRleHQ1LnByZXYgPSBfY29udGV4dDUubmV4dCkge2Nhc2UgMDppbnRlcnJ1cHRBY3RpdmVMb2FkcygpOyAvLyBQdXQgdXMgaW4gYSBzdWJtaXR0aW5nIHN0YXRlCiAgICAgICAgICAgICAgICAgICAgICBuYXZpZ2F0aW9uID0gX2V4dGVuZHMoeyBzdGF0ZTogInN1Ym1pdHRpbmciLCBsb2NhdGlvbjogbG9jYXRpb24gfSwgc3VibWlzc2lvbik7dXBkYXRlU3RhdGUoeyBuYXZpZ2F0aW9uOiBuYXZpZ2F0aW9uIH0pOyAvLyBDYWxsIG91ciBhY3Rpb24gYW5kIGdldCB0aGUgcmVzdWx0CiAgICAgICAgICAgICAgICAgICAgICBhY3Rpb25NYXRjaCA9IGdldFRhcmdldE1hdGNoKG1hdGNoZXMsIGxvY2F0aW9uKTtpZiAoYWN0aW9uTWF0Y2gucm91dGUuYWN0aW9uKSB7X2NvbnRleHQ1Lm5leHQgPSA4O2JyZWFrO31yZXN1bHQgPSB7IHR5cGU6IFJlc3VsdFR5cGUuZXJyb3IsIGVycm9yOiBnZXRJbnRlcm5hbFJvdXRlckVycm9yKDQwNSwgeyBtZXRob2Q6IHJlcXVlc3QubWV0aG9kLCBwYXRobmFtZTogbG9jYXRpb24ucGF0aG5hbWUsIHJvdXRlSWQ6IGFjdGlvbk1hdGNoLnJvdXRlLmlkIH0pIH07X2NvbnRleHQ1Lm5leHQgPSAxMzticmVhaztjYXNlIDg6X2NvbnRleHQ1Lm5leHQgPSAxMDtyZXR1cm4gY2FsbExvYWRlck9yQWN0aW9uKCJhY3Rpb24iLCByZXF1ZXN0LCBhY3Rpb25NYXRjaCwgbWF0Y2hlcywgcm91dGVyLmJhc2VuYW1lKTtjYXNlIDEwOnJlc3VsdCA9IF9jb250ZXh0NS5zZW50O2lmICghcmVxdWVzdC5zaWduYWwuYWJvcnRlZCkge19jb250ZXh0NS5uZXh0ID0gMTM7YnJlYWs7fXJldHVybiBfY29udGV4dDUuYWJydXB0KCJyZXR1cm4iLCB7IHNob3J0Q2lyY3VpdGVkOiB0cnVlIH0pO2Nhc2UgMTM6aWYgKCFpc1JlZGlyZWN0UmVzdWx0KHJlc3VsdCkpIHtfY29udGV4dDUubmV4dCA9IDE4O2JyZWFrO31pZiAob3B0cyAmJiBvcHRzLnJlcGxhY2UgIT0gbnVsbCkge3JlcGxhY2UgPSBvcHRzLnJlcGxhY2U7fSBlbHNlIHsvLyBJZiB0aGUgdXNlciBkaWRuJ3QgZXhwbGljaXR5IGluZGljYXRlIHJlcGxhY2UgYmVoYXZpb3IsIHJlcGxhY2UgaWYKICAgICAgICAgICAgICAgICAgICAgICAgLy8gd2UgcmVkaXJlY3RlZCB0byB0aGUgZXhhY3Qgc2FtZSBsb2NhdGlvbiB3ZSdyZSBjdXJyZW50bHkgYXQgdG8gYXZvaWQKICAgICAgICAgICAgICAgICAgICAgICAgLy8gZG91YmxlIGJhY2stYnV0dG9ucwogICAgICAgICAgICAgICAgICAgICAgICByZXBsYWNlID0gcmVzdWx0LmxvY2F0aW9uID09PSBzdGF0ZS5sb2NhdGlvbi5wYXRobmFtZSArIHN0YXRlLmxvY2F0aW9uLnNlYXJjaDt9X2NvbnRleHQ1Lm5leHQgPSAxNztyZXR1cm4gc3RhcnRSZWRpcmVjdE5hdmlnYXRpb24oc3RhdGUsIHJlc3VsdCwgeyBzdWJtaXNzaW9uOiBzdWJtaXNzaW9uLCByZXBsYWNlOiByZXBsYWNlIH0pO2Nhc2UgMTc6cmV0dXJuIF9jb250ZXh0NS5hYnJ1cHQoInJldHVybiIsIHsgc2hvcnRDaXJjdWl0ZWQ6IHRydWUgfSk7Y2FzZSAxODppZiAoIWlzRXJyb3JSZXN1bHQocmVzdWx0KSkge19jb250ZXh0NS5uZXh0ID0gMjI7YnJlYWs7fSAvLyBTdG9yZSBvZmYgdGhlIHBlbmRpbmcgZXJyb3IgLSB3ZSB1c2UgaXQgdG8gZGV0ZXJtaW5lIHdoaWNoIGxvYWRlcnMKICAgICAgICAgICAgICAgICAgICAgIC8vIHRvIGNhbGwgYW5kIHdpbGwgY29tbWl0IGl0IHdoZW4gd2UgY29tcGxldGUgdGhlIG5hdmlnYXRpb24KICAgICAgICAgICAgICAgICAgICAgIGJvdW5kYXJ5TWF0Y2ggPSBmaW5kTmVhcmVzdEJvdW5kYXJ5KG1hdGNoZXMsIGFjdGlvbk1hdGNoLnJvdXRlLmlkKTsgLy8gQnkgZGVmYXVsdCwgYWxsIHN1Ym1pc3Npb25zIGFyZSBSRVBMQUNFIG5hdmlnYXRpb25zLCBidXQgaWYgdGhlCiAgICAgICAgICAgICAgICAgICAgICAvLyBhY3Rpb24gdGhyZXcgYW4gZXJyb3IgdGhhdCdsbCBiZSByZW5kZXJlZCBpbiBhbiBlcnJvckVsZW1lbnQsIHdlIGZhbGwKICAgICAgICAgICAgICAgICAgICAgIC8vIGJhY2sgdG8gUFVTSCBzbyB0aGF0IHRoZSB1c2VyIGNhbiB1c2UgdGhlIGJhY2sgYnV0dG9uIHRvIGdldCBiYWNrIHRvCiAgICAgICAgICAgICAgICAgICAgICAvLyB0aGUgcHJlLXN1Ym1pc3Npb24gZm9ybSBsb2NhdGlvbiB0byB0cnkgYWdhaW4KICAgICAgICAgICAgICAgICAgICAgIGlmICgob3B0cyAmJiBvcHRzLnJlcGxhY2UpICE9PSB0cnVlKSB7cGVuZGluZ0FjdGlvbiA9IEFjdGlvbi5QdXNoO31yZXR1cm4gX2NvbnRleHQ1LmFicnVwdCgicmV0dXJuIiwgeyAvLyBTZW5kIGJhY2sgYW4gZW1wdHkgb2JqZWN0IHdlIGNhbiB1c2UgdG8gY2xlYXIgb3V0IGFueSBwcmlvciBhY3Rpb25EYXRhCiAgICAgICAgICAgICAgICAgICAgICAgIHBlbmRpbmdBY3Rpb25EYXRhOiB7fSwgcGVuZGluZ0FjdGlvbkVycm9yOiBfZGVmaW5lUHJvcGVydHkyKHt9LCBib3VuZGFyeU1hdGNoLnJvdXRlLmlkLCByZXN1bHQuZXJyb3IpIH0pO2Nhc2UgMjI6aWYgKCFpc0RlZmVycmVkUmVzdWx0KHJlc3VsdCkpIHtfY29udGV4dDUubmV4dCA9IDI0O2JyZWFrO310aHJvdyBnZXRJbnRlcm5hbFJvdXRlckVycm9yKDQwMCwgeyB0eXBlOiAiZGVmZXItYWN0aW9uIiB9KTtjYXNlIDI0OnJldHVybiBfY29udGV4dDUuYWJydXB0KCJyZXR1cm4iLCB7IHBlbmRpbmdBY3Rpb25EYXRhOiBfZGVmaW5lUHJvcGVydHkyKHt9LCBhY3Rpb25NYXRjaC5yb3V0ZS5pZCwgcmVzdWx0LmRhdGEpIH0pO2Nhc2UgMjU6Y2FzZSAiZW5kIjpyZXR1cm4gX2NvbnRleHQ1LnN0b3AoKTt9fSwgX2NhbGxlZTUpO30pKTtyZXR1cm4gX2hhbmRsZUFjdGlvbi5hcHBseSh0aGlzLCBhcmd1bWVudHMpO31mdW5jdGlvbiBoYW5kbGVMb2FkZXJzKF94MTQsIF94MTUsIF94MTYsIF94MTcsIF94MTgsIF94MTksIF94MjAsIF94MjEpIHtyZXR1cm4gX2hhbmRsZUxvYWRlcnMuYXBwbHkodGhpcywgYXJndW1lbnRzKTt9ZnVuY3Rpb24gX2hhbmRsZUxvYWRlcnMoKSB7X2hhbmRsZUxvYWRlcnMgPSBfYXN5bmNUb0dlbmVyYXRvcjIoIC8qI19fUFVSRV9fKi9fcmVnZW5lcmF0b3JSdW50aW1lMigpLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTYocmVxdWVzdCwgbG9jYXRpb24sIG1hdGNoZXMsIG92ZXJyaWRlTmF2aWdhdGlvbiwgc3VibWlzc2lvbiwgcmVwbGFjZSwgcGVuZGluZ0FjdGlvbkRhdGEsIHBlbmRpbmdFcnJvcikge3ZhciBsb2FkaW5nTmF2aWdhdGlvbiwgbmF2aWdhdGlvbiwgYWN0aXZlU3VibWlzc2lvbiwgX2dldE1hdGNoZXNUb0xvYWQsIF9nZXRNYXRjaGVzVG9Mb2FkMiwgbWF0Y2hlc1RvTG9hZCwgcmV2YWxpZGF0aW5nRmV0Y2hlcnMsIGFjdGlvbkRhdGEsIF95aWVsZCRjYWxsTG9hZGVyc0FuZCwgcmVzdWx0cywgbG9hZGVyUmVzdWx0cywgZmV0Y2hlclJlc3VsdHMsIHJlZGlyZWN0LCBfcHJvY2Vzc0xvYWRlckRhdGEsIGxvYWRlckRhdGEsIGVycm9ycywgZGlkQWJvcnRGZXRjaExvYWRzO3JldHVybiBfcmVnZW5lcmF0b3JSdW50aW1lMigpLndyYXAoZnVuY3Rpb24gX2NhbGxlZTYkKF9jb250ZXh0Nikge3doaWxlICgxKSBzd2l0Y2ggKF9jb250ZXh0Ni5wcmV2ID0gX2NvbnRleHQ2Lm5leHQpIHtjYXNlIDA6IC8vIEZpZ3VyZSBvdXQgdGhlIHJpZ2h0IG5hdmlnYXRpb24gd2Ugd2FudCB0byB1c2UgZm9yIGRhdGEgbG9hZGluZwogICAgICAgICAgICAgICAgICAgICAgbG9hZGluZ05hdmlnYXRpb24gPSBvdmVycmlkZU5hdmlnYXRpb247aWYgKCFsb2FkaW5nTmF2aWdhdGlvbikge25hdmlnYXRpb24gPSBfZXh0ZW5kcyh7IHN0YXRlOiAibG9hZGluZyIsIGxvY2F0aW9uOiBsb2NhdGlvbiwgZm9ybU1ldGhvZDogdW5kZWZpbmVkLCBmb3JtQWN0aW9uOiB1bmRlZmluZWQsIGZvcm1FbmNUeXBlOiB1bmRlZmluZWQsIGZvcm1EYXRhOiB1bmRlZmluZWQKICAgICAgICAgICAgICAgICAgICAgICAgfSwgc3VibWlzc2lvbik7CgogICAgICAgICAgICAgICAgICAgICAgICBsb2FkaW5nTmF2aWdhdGlvbiA9IG5hdmlnYXRpb247CiAgICAgICAgICAgICAgICAgICAgICB9IC8vIElmIHRoaXMgd2FzIGEgcmVkaXJlY3QgZnJvbSBhbiBhY3Rpb24gd2UgZG9uJ3QgaGF2ZSBhICJzdWJtaXNzaW9uIiBidXQKICAgICAgICAgICAgICAgICAgICAgIC8vIHdlIGhhdmUgaXQgb24gdGhlIGxvYWRpbmcgbmF2aWdhdGlvbiBzbyB1c2UgdGhhdCBpZiBhdmFpbGFibGUKCgogICAgICAgICAgICAgICAgICAgICAgYWN0aXZlU3VibWlzc2lvbiA9IHN1Ym1pc3Npb24gPyBzdWJtaXNzaW9uIDogbG9hZGluZ05hdmlnYXRpb24uZm9ybU1ldGhvZCAmJiBsb2FkaW5nTmF2aWdhdGlvbi5mb3JtQWN0aW9uICYmIGxvYWRpbmdOYXZpZ2F0aW9uLmZvcm1EYXRhICYmIGxvYWRpbmdOYXZpZ2F0aW9uLmZvcm1FbmNUeXBlID8gewogICAgICAgICAgICAgICAgICAgICAgICBmb3JtTWV0aG9kOiBsb2FkaW5nTmF2aWdhdGlvbi5mb3JtTWV0aG9kLAogICAgICAgICAgICAgICAgICAgICAgICBmb3JtQWN0aW9uOiBsb2FkaW5nTmF2aWdhdGlvbi5mb3JtQWN0aW9uLAogICAgICAgICAgICAgICAgICAgICAgICBmb3JtRGF0YTogbG9hZGluZ05hdmlnYXRpb24uZm9ybURhdGEsCiAgICAgICAgICAgICAgICAgICAgICAgIGZvcm1FbmNUeXBlOiBsb2FkaW5nTmF2aWdhdGlvbi5mb3JtRW5jVHlwZQogICAgICAgICAgICAgICAgICAgICAgfSA6IHVuZGVmaW5lZDtfZ2V0TWF0Y2hlc1RvTG9hZCA9CiAgICAgICAgICAgICAgICAgICAgICBnZXRNYXRjaGVzVG9Mb2FkKGluaXQuaGlzdG9yeSwgc3RhdGUsIG1hdGNoZXMsIGFjdGl2ZVN1Ym1pc3Npb24sIGxvY2F0aW9uLCBpc1JldmFsaWRhdGlvblJlcXVpcmVkLCBjYW5jZWxsZWREZWZlcnJlZFJvdXRlcywgY2FuY2VsbGVkRmV0Y2hlckxvYWRzLCBwZW5kaW5nQWN0aW9uRGF0YSwgcGVuZGluZ0Vycm9yLCBmZXRjaExvYWRNYXRjaGVzKSwgX2dldE1hdGNoZXNUb0xvYWQyID0gX3NsaWNlZFRvQXJyYXkyKF9nZXRNYXRjaGVzVG9Mb2FkLCAyKSwgbWF0Y2hlc1RvTG9hZCA9IF9nZXRNYXRjaGVzVG9Mb2FkMlswXSwgcmV2YWxpZGF0aW5nRmV0Y2hlcnMgPSBfZ2V0TWF0Y2hlc1RvTG9hZDJbMV07IC8vIENhbmNlbCBwZW5kaW5nIGRlZmVycmVkcyBmb3Igbm8tbG9uZ2VyLW1hdGNoZWQgcm91dGVzIG9yIHJvdXRlcyB3ZSdyZQogICAgICAgICAgICAgICAgICAgICAgLy8gYWJvdXQgdG8gcmVsb2FkLiAgTm90ZSB0aGF0IGlmIHRoaXMgaXMgYW4gYWN0aW9uIHJlbG9hZCB3ZSB3b3VsZCBoYXZlCiAgICAgICAgICAgICAgICAgICAgICAvLyBhbHJlYWR5IGNhbmNlbGxlZCBhbGwgcGVuZGluZyBkZWZlcnJlZHMgc28gdGhpcyB3b3VsZCBiZSBhIG5vLW9wCgogICAgICAgICAgICAgICAgICAgICAgY2FuY2VsQWN0aXZlRGVmZXJyZWRzKChyb3V0ZUlkKSA9PiAhKG1hdGNoZXMgJiYgbWF0Y2hlcy5zb21lKChtKSA9PiBtLnJvdXRlLmlkID09PSByb3V0ZUlkKSkgfHwgbWF0Y2hlc1RvTG9hZCAmJiBtYXRjaGVzVG9Mb2FkLnNvbWUoKG0pID0+IG0ucm91dGUuaWQgPT09IHJvdXRlSWQpKTsgLy8gU2hvcnQgY2lyY3VpdCBpZiB3ZSBoYXZlIG5vIGxvYWRlcnMgdG8gcnVuCiAgICAgICAgICAgICAgICAgICAgICBpZiAoISgKICAgICAgICAgICAgICAgICAgICAgIG1hdGNoZXNUb0xvYWQubGVuZ3RoID09PSAwICYmIHJldmFsaWRhdGluZ0ZldGNoZXJzLmxlbmd0aCA9PT0gMCkpIHtfY29udGV4dDYubmV4dCA9IDg7YnJlYWs7fQogICAgICAgICAgICAgICAgICAgICAgY29tcGxldGVOYXZpZ2F0aW9uKGxvY2F0aW9uLCBfZXh0ZW5kcyh7CiAgICAgICAgICAgICAgICAgICAgICAgIG1hdGNoZXM6IG1hdGNoZXMsCiAgICAgICAgICAgICAgICAgICAgICAgIGxvYWRlckRhdGE6IHt9LAogICAgICAgICAgICAgICAgICAgICAgICAvLyBDb21taXQgcGVuZGluZyBlcnJvciBpZiB3ZSdyZSBzaG9ydCBjaXJjdWl0aW5nCiAgICAgICAgICAgICAgICAgICAgICAgIGVycm9yczogcGVuZGluZ0Vycm9yIHx8IG51bGwKICAgICAgICAgICAgICAgICAgICAgIH0sIHBlbmRpbmdBY3Rpb25EYXRhID8gewogICAgICAgICAgICAgICAgICAgICAgICBhY3Rpb25EYXRhOiBwZW5kaW5nQWN0aW9uRGF0YQogICAgICAgICAgICAgICAgICAgICAgfSA6IHt9KSk7cmV0dXJuIF9jb250ZXh0Ni5hYnJ1cHQoInJldHVybiIsCiAgICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgIHNob3J0Q2lyY3VpdGVkOiB0cnVlCiAgICAgICAgICAgICAgICAgICAgICB9KTtjYXNlIDg6CiAgICAgICAgICAgICAgICAgICAgICAvLyBJZiB0aGlzIGlzIGFuIHVuaW50ZXJydXB0ZWQgcmV2YWxpZGF0aW9uLCB3ZSByZW1haW4gaW4gb3VyIGN1cnJlbnQgaWRsZQogICAgICAgICAgICAgICAgICAgICAgLy8gc3RhdGUuICBJZiBub3QsIHdlIG5lZWQgdG8gc3dpdGNoIHRvIG91ciBsb2FkaW5nIHN0YXRlIGFuZCBsb2FkIGRhdGEsCiAgICAgICAgICAgICAgICAgICAgICAvLyBwcmVzZXJ2aW5nIGFueSBuZXcgYWN0aW9uIGRhdGEgb3IgZXhpc3RpbmcgYWN0aW9uIGRhdGEgKGluIHRoZSBjYXNlIG9mCiAgICAgICAgICAgICAgICAgICAgICAvLyBhIHJldmFsaWRhdGlvbiBpbnRlcnJ1cHRpbmcgYW4gYWN0aW9uUmVsb2FkKQoKCiAgICAgICAgICAgICAgICAgICAgICBpZiAoIWlzVW5pbnRlcnJ1cHRlZFJldmFsaWRhdGlvbikgewogICAgICAgICAgICAgICAgICAgICAgICByZXZhbGlkYXRpbmdGZXRjaGVycy5mb3JFYWNoKChfcmVmMikgPT4gewogICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBfcmVmMTUgPSBfc2xpY2VkVG9BcnJheTIoX3JlZjIsIDEpLGtleSA9IF9yZWYxNVswXTsKICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgZmV0Y2hlciA9IHN0YXRlLmZldGNoZXJzLmdldChrZXkpOwogICAgICAgICAgICAgICAgICAgICAgICAgIHZhciByZXZhbGlkYXRpbmdGZXRjaGVyID0gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhdGU6ICJsb2FkaW5nIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGE6IGZldGNoZXIgJiYgZmV0Y2hlci5kYXRhLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9ybU1ldGhvZDogdW5kZWZpbmVkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9ybUFjdGlvbjogdW5kZWZpbmVkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9ybUVuY1R5cGU6IHVuZGVmaW5lZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvcm1EYXRhOiB1bmRlZmluZWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAiIF9oYXNGZXRjaGVyRG9uZUFueXRoaW5nICI6IHRydWUKICAgICAgICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgICAgICAgICAgIHN0YXRlLmZldGNoZXJzLnNldChrZXksIHJldmFsaWRhdGluZ0ZldGNoZXIpOwogICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgYWN0aW9uRGF0YSA9IHBlbmRpbmdBY3Rpb25EYXRhIHx8IHN0YXRlLmFjdGlvbkRhdGE7CiAgICAgICAgICAgICAgICAgICAgICAgIHVwZGF0ZVN0YXRlKF9leHRlbmRzKHsKICAgICAgICAgICAgICAgICAgICAgICAgICBuYXZpZ2F0aW9uOiBsb2FkaW5nTmF2aWdhdGlvbgogICAgICAgICAgICAgICAgICAgICAgICB9LCBhY3Rpb25EYXRhID8gT2JqZWN0LmtleXMoYWN0aW9uRGF0YSkubGVuZ3RoID09PSAwID8gewogICAgICAgICAgICAgICAgICAgICAgICAgIGFjdGlvbkRhdGE6IG51bGwKICAgICAgICAgICAgICAgICAgICAgICAgfSA6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICBhY3Rpb25EYXRhOiBhY3Rpb25EYXRhCiAgICAgICAgICAgICAgICAgICAgICAgIH0gOiB7fSwgcmV2YWxpZGF0aW5nRmV0Y2hlcnMubGVuZ3RoID4gMCA/IHsKICAgICAgICAgICAgICAgICAgICAgICAgICBmZXRjaGVyczogbmV3IE1hcChzdGF0ZS5mZXRjaGVycykKICAgICAgICAgICAgICAgICAgICAgICAgfSA6IHt9KSk7CiAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgcGVuZGluZ05hdmlnYXRpb25Mb2FkSWQgPSArK2luY3JlbWVudGluZ0xvYWRJZDsKICAgICAgICAgICAgICAgICAgICAgIHJldmFsaWRhdGluZ0ZldGNoZXJzLmZvckVhY2goKF9yZWYzKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBfcmVmMTYgPSBfc2xpY2VkVG9BcnJheTIoX3JlZjMsIDEpLGtleSA9IF9yZWYxNlswXTsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZldGNoQ29udHJvbGxlcnMuc2V0KGtleSwgcGVuZGluZ05hdmlnYXRpb25Db250cm9sbGVyKTsKICAgICAgICAgICAgICAgICAgICAgIH0pO19jb250ZXh0Ni5uZXh0ID0gMTM7cmV0dXJuICgKCgoKCiAgICAgICAgICAgICAgICAgICAgICAgIGNhbGxMb2FkZXJzQW5kTWF5YmVSZXNvbHZlRGF0YShzdGF0ZS5tYXRjaGVzLCBtYXRjaGVzLCBtYXRjaGVzVG9Mb2FkLCByZXZhbGlkYXRpbmdGZXRjaGVycywgcmVxdWVzdCkpO2Nhc2UgMTM6X3lpZWxkJGNhbGxMb2FkZXJzQW5kID0gX2NvbnRleHQ2LnNlbnQ7cmVzdWx0cyA9IF95aWVsZCRjYWxsTG9hZGVyc0FuZC5yZXN1bHRzO2xvYWRlclJlc3VsdHMgPSBfeWllbGQkY2FsbExvYWRlcnNBbmQubG9hZGVyUmVzdWx0cztmZXRjaGVyUmVzdWx0cyA9IF95aWVsZCRjYWxsTG9hZGVyc0FuZC5mZXRjaGVyUmVzdWx0cztpZiAoIQoKICAgICAgICAgICAgICAgICAgICAgIHJlcXVlc3Quc2lnbmFsLmFib3J0ZWQpIHtfY29udGV4dDYubmV4dCA9IDE5O2JyZWFrO31yZXR1cm4gX2NvbnRleHQ2LmFicnVwdCgicmV0dXJuIiwKICAgICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgc2hvcnRDaXJjdWl0ZWQ6IHRydWUKICAgICAgICAgICAgICAgICAgICAgIH0pO2Nhc2UgMTk6CiAgICAgICAgICAgICAgICAgICAgICAvLyBDbGVhbiB1cCBfYWZ0ZXJfIGxvYWRlcnMgaGF2ZSBjb21wbGV0ZWQuICBEb24ndCBjbGVhbiB1cCBpZiB3ZSBzaG9ydAogICAgICAgICAgICAgICAgICAgICAgLy8gY2lyY3VpdGVkIGJlY2F1c2UgZmV0Y2hDb250cm9sbGVycyB3b3VsZCBoYXZlIGJlZW4gYWJvcnRlZCBhbmQKICAgICAgICAgICAgICAgICAgICAgIC8vIHJlYXNzaWduZWQgdG8gbmV3IGNvbnRyb2xsZXJzIGZvciB0aGUgbmV4dCBuYXZpZ2F0aW9uCgoKICAgICAgICAgICAgICAgICAgICAgIHJldmFsaWRhdGluZ0ZldGNoZXJzLmZvckVhY2goKF9yZWY0KSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBfcmVmMTcgPSBfc2xpY2VkVG9BcnJheTIoX3JlZjQsIDEpLGtleSA9IF9yZWYxN1swXTsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZldGNoQ29udHJvbGxlcnMuZGVsZXRlKGtleSk7CiAgICAgICAgICAgICAgICAgICAgICB9KTsgLy8gSWYgYW55IGxvYWRlcnMgcmV0dXJuZWQgYSByZWRpcmVjdCBSZXNwb25zZSwgc3RhcnQgYSBuZXcgUkVQTEFDRSBuYXZpZ2F0aW9uCgogICAgICAgICAgICAgICAgICAgICAgcmVkaXJlY3QgPSBmaW5kUmVkaXJlY3QocmVzdWx0cyk7aWYgKCEKCiAgICAgICAgICAgICAgICAgICAgICByZWRpcmVjdCkge19jb250ZXh0Ni5uZXh0ID0gMjU7YnJlYWs7fV9jb250ZXh0Ni5uZXh0ID0gMjQ7cmV0dXJuICgKICAgICAgICAgICAgICAgICAgICAgICAgc3RhcnRSZWRpcmVjdE5hdmlnYXRpb24oc3RhdGUsIHJlZGlyZWN0LCB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgcmVwbGFjZTogcmVwbGFjZQogICAgICAgICAgICAgICAgICAgICAgICB9KSk7Y2FzZSAyNDpyZXR1cm4gX2NvbnRleHQ2LmFicnVwdCgicmV0dXJuIiwKICAgICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgc2hvcnRDaXJjdWl0ZWQ6IHRydWUKICAgICAgICAgICAgICAgICAgICAgIH0pO2Nhc2UgMjU6CiAgICAgICAgICAgICAgICAgICAgICAvLyBQcm9jZXNzIGFuZCBjb21taXQgb3V0cHV0IGZyb20gbG9hZGVycwogICAgICAgICAgICAgICAgICAgICAgX3Byb2Nlc3NMb2FkZXJEYXRhID0KCgoKCiAgICAgICAgICAgICAgICAgICAgICBwcm9jZXNzTG9hZGVyRGF0YShzdGF0ZSwgbWF0Y2hlcywgbWF0Y2hlc1RvTG9hZCwgbG9hZGVyUmVzdWx0cywgcGVuZGluZ0Vycm9yLCByZXZhbGlkYXRpbmdGZXRjaGVycywgZmV0Y2hlclJlc3VsdHMsIGFjdGl2ZURlZmVycmVkcyksIGxvYWRlckRhdGEgPSBfcHJvY2Vzc0xvYWRlckRhdGEubG9hZGVyRGF0YSwgZXJyb3JzID0gX3Byb2Nlc3NMb2FkZXJEYXRhLmVycm9yczsgLy8gV2lyZSB1cCBzdWJzY3JpYmVycyB0byB1cGRhdGUgbG9hZGVyRGF0YSBhcyBwcm9taXNlcyBzZXR0bGUKCiAgICAgICAgICAgICAgICAgICAgICBhY3RpdmVEZWZlcnJlZHMuZm9yRWFjaCgoZGVmZXJyZWREYXRhLCByb3V0ZUlkKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgIGRlZmVycmVkRGF0YS5zdWJzY3JpYmUoKGFib3J0ZWQpID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBOb3RlOiBObyBuZWVkIHRvIHVwZGF0ZVN0YXRlIGhlcmUgc2luY2UgdGhlIFRyYWNrZWRQcm9taXNlIG9uCiAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gbG9hZGVyRGF0YSBpcyBzdGFibGUgYWNyb3NzIHJlc29sdmUvcmVqZWN0CiAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gUmVtb3ZlIHRoaXMgaW5zdGFuY2UgaWYgd2Ugd2VyZSBhYm9ydGVkIG9yIGlmIHByb21pc2VzIGhhdmUgc2V0dGxlZAogICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChhYm9ydGVkIHx8IGRlZmVycmVkRGF0YS5kb25lKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhY3RpdmVEZWZlcnJlZHMuZGVsZXRlKHJvdXRlSWQpOwogICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgIG1hcmtGZXRjaFJlZGlyZWN0c0RvbmUoKTsKICAgICAgICAgICAgICAgICAgICAgIGRpZEFib3J0RmV0Y2hMb2FkcyA9IGFib3J0U3RhbGVGZXRjaExvYWRzKHBlbmRpbmdOYXZpZ2F0aW9uTG9hZElkKTtyZXR1cm4gX2NvbnRleHQ2LmFicnVwdCgicmV0dXJuIiwKICAgICAgICAgICAgICAgICAgICAgIF9leHRlbmRzKHsKICAgICAgICAgICAgICAgICAgICAgICAgbG9hZGVyRGF0YTogbG9hZGVyRGF0YSwKICAgICAgICAgICAgICAgICAgICAgICAgZXJyb3JzOiBlcnJvcnMKICAgICAgICAgICAgICAgICAgICAgIH0sIGRpZEFib3J0RmV0Y2hMb2FkcyB8fCByZXZhbGlkYXRpbmdGZXRjaGVycy5sZW5ndGggPiAwID8gewogICAgICAgICAgICAgICAgICAgICAgICBmZXRjaGVyczogbmV3IE1hcChzdGF0ZS5mZXRjaGVycykKICAgICAgICAgICAgICAgICAgICAgIH0gOiB7fSkpO2Nhc2UgMzA6Y2FzZSAiZW5kIjpyZXR1cm4gX2NvbnRleHQ2LnN0b3AoKTt9fSwgX2NhbGxlZTYpO30pKTtyZXR1cm4gX2hhbmRsZUxvYWRlcnMuYXBwbHkodGhpcywgYXJndW1lbnRzKTt9CgoKICAgICAgICAgICAgZnVuY3Rpb24gZ2V0RmV0Y2hlcihrZXkpIHsKICAgICAgICAgICAgICByZXR1cm4gc3RhdGUuZmV0Y2hlcnMuZ2V0KGtleSkgfHwgSURMRV9GRVRDSEVSOwogICAgICAgICAgICB9IC8vIFRyaWdnZXIgYSBmZXRjaGVyIGxvYWQvc3VibWl0IGZvciB0aGUgZ2l2ZW4gZmV0Y2hlciBrZXkKCgogICAgICAgICAgICBmdW5jdGlvbiBmZXRjaChrZXksIHJvdXRlSWQsIGhyZWYsIG9wdHMpIHsKICAgICAgICAgICAgICBpZiAoaXNTZXJ2ZXIpIHsKICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigicm91dGVyLmZldGNoKCkgd2FzIGNhbGxlZCBkdXJpbmcgdGhlIHNlcnZlciByZW5kZXIsIGJ1dCBpdCBzaG91bGRuJ3QgYmUuICIgKyAiWW91IGFyZSBsaWtlbHkgY2FsbGluZyBhIHVzZUZldGNoZXIoKSBtZXRob2QgaW4gdGhlIGJvZHkgb2YgeW91ciBjb21wb25lbnQuICIgKyAiVHJ5IG1vdmluZyBpdCB0byBhIHVzZUVmZmVjdCBvciBhIGNhbGxiYWNrLiIpOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgaWYgKGZldGNoQ29udHJvbGxlcnMuaGFzKGtleSkpIGFib3J0RmV0Y2hlcihrZXkpOwogICAgICAgICAgICAgIHZhciBtYXRjaGVzID0gbWF0Y2hSb3V0ZXMoZGF0YVJvdXRlcywgaHJlZiwgaW5pdC5iYXNlbmFtZSk7CgogICAgICAgICAgICAgIGlmICghbWF0Y2hlcykgewogICAgICAgICAgICAgICAgc2V0RmV0Y2hlckVycm9yKGtleSwgcm91dGVJZCwgZ2V0SW50ZXJuYWxSb3V0ZXJFcnJvcig0MDQsIHsKICAgICAgICAgICAgICAgICAgcGF0aG5hbWU6IGhyZWYKICAgICAgICAgICAgICAgIH0pKTsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIHZhciBfbm9ybWFsaXplTmF2aWdhdGVPcHQgPQoKCiAgICAgICAgICAgICAgICBub3JtYWxpemVOYXZpZ2F0ZU9wdGlvbnMoaHJlZiwgb3B0cywgdHJ1ZSkscGF0aCA9IF9ub3JtYWxpemVOYXZpZ2F0ZU9wdC5wYXRoLHN1Ym1pc3Npb24gPSBfbm9ybWFsaXplTmF2aWdhdGVPcHQuc3VibWlzc2lvbjsKICAgICAgICAgICAgICB2YXIgbWF0Y2ggPSBnZXRUYXJnZXRNYXRjaChtYXRjaGVzLCBwYXRoKTsKCiAgICAgICAgICAgICAgaWYgKHN1Ym1pc3Npb24gJiYgaXNNdXRhdGlvbk1ldGhvZChzdWJtaXNzaW9uLmZvcm1NZXRob2QpKSB7CiAgICAgICAgICAgICAgICBoYW5kbGVGZXRjaGVyQWN0aW9uKGtleSwgcm91dGVJZCwgcGF0aCwgbWF0Y2gsIG1hdGNoZXMsIHN1Ym1pc3Npb24pOwogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgIH0gLy8gU3RvcmUgb2ZmIHRoZSBtYXRjaCBzbyB3ZSBjYW4gY2FsbCBpdCdzIHNob3VsZFJldmFsaWRhdGUgb24gc3Vic2VxdWVudAogICAgICAgICAgICAgIC8vIHJldmFsaWRhdGlvbnMKCgogICAgICAgICAgICAgIGZldGNoTG9hZE1hdGNoZXMuc2V0KGtleSwgW3BhdGgsIG1hdGNoLCBtYXRjaGVzXSk7CiAgICAgICAgICAgICAgaGFuZGxlRmV0Y2hlckxvYWRlcihrZXksIHJvdXRlSWQsIHBhdGgsIG1hdGNoLCBtYXRjaGVzLCBzdWJtaXNzaW9uKTsKICAgICAgICAgICAgfSAvLyBDYWxsIHRoZSBhY3Rpb24gZm9yIHRoZSBtYXRjaGVkIGZldGNoZXIuc3VibWl0KCksIGFuZCB0aGVuIGhhbmRsZSByZWRpcmVjdHMsCiAgICAgICAgICAgIC8vIGVycm9ycywgYW5kIHJldmFsaWRhdGlvbgogICAgICAgICAgICBmdW5jdGlvbgoKICAgICAgICAgICAgaGFuZGxlRmV0Y2hlckFjdGlvbihfeDIyLCBfeDIzLCBfeDI0LCBfeDI1LCBfeDI2LCBfeDI3KSB7cmV0dXJuIF9oYW5kbGVGZXRjaGVyQWN0aW9uLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7fQoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCiAgICAgICAgICAgIC8vIENhbGwgdGhlIG1hdGNoZWQgbG9hZGVyIGZvciBmZXRjaGVyLmxvYWQoKSwgaGFuZGxpbmcgcmVkaXJlY3RzLCBlcnJvcnMsIGV0Yy4KICAgICAgICAgICAgZnVuY3Rpb24gX2hhbmRsZUZldGNoZXJBY3Rpb24oKSB7X2hhbmRsZUZldGNoZXJBY3Rpb24gPSBfYXN5bmNUb0dlbmVyYXRvcjIoIC8qI19fUFVSRV9fKi9fcmVnZW5lcmF0b3JSdW50aW1lMigpLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTcoa2V5LCByb3V0ZUlkLCBwYXRoLCBtYXRjaCwgcmVxdWVzdE1hdGNoZXMsIHN1Ym1pc3Npb24pIHt2YXIgX2Vycm9yMiwgZXhpc3RpbmdGZXRjaGVyLCBmZXRjaGVyLCBhYm9ydENvbnRyb2xsZXIsIGZldGNoUmVxdWVzdCwgYWN0aW9uUmVzdWx0LCBsb2FkaW5nRmV0Y2hlciwgbmV4dExvY2F0aW9uLCByZXZhbGlkYXRpb25SZXF1ZXN0LCBtYXRjaGVzLCBsb2FkSWQsIGxvYWRGZXRjaGVyLCBfZ2V0TWF0Y2hlc1RvTG9hZDMsIF9nZXRNYXRjaGVzVG9Mb2FkNCwgbWF0Y2hlc1RvTG9hZCwgcmV2YWxpZGF0aW5nRmV0Y2hlcnMsIF95aWVsZCRjYWxsTG9hZGVyc0FuZDIsIHJlc3VsdHMsIGxvYWRlclJlc3VsdHMsIGZldGNoZXJSZXN1bHRzLCByZWRpcmVjdCwgX3Byb2Nlc3NMb2FkZXJEYXRhMiwgbG9hZGVyRGF0YSwgZXJyb3JzLCBkb25lRmV0Y2hlciwgZGlkQWJvcnRGZXRjaExvYWRzO3JldHVybiBfcmVnZW5lcmF0b3JSdW50aW1lMigpLndyYXAoZnVuY3Rpb24gX2NhbGxlZTckKF9jb250ZXh0Nykge3doaWxlICgxKSBzd2l0Y2ggKF9jb250ZXh0Ny5wcmV2ID0gX2NvbnRleHQ3Lm5leHQpIHtjYXNlIDA6aW50ZXJydXB0QWN0aXZlTG9hZHMoKTtmZXRjaExvYWRNYXRjaGVzLmRlbGV0ZShrZXkpO2lmIChtYXRjaC5yb3V0ZS5hY3Rpb24pIHtfY29udGV4dDcubmV4dCA9IDY7YnJlYWs7fV9lcnJvcjIgPSBnZXRJbnRlcm5hbFJvdXRlckVycm9yKDQwNSwgeyBtZXRob2Q6IHN1Ym1pc3Npb24uZm9ybU1ldGhvZCwgcGF0aG5hbWU6IHBhdGgsIHJvdXRlSWQ6IHJvdXRlSWQgfSk7c2V0RmV0Y2hlckVycm9yKGtleSwgcm91dGVJZCwgX2Vycm9yMik7cmV0dXJuIF9jb250ZXh0Ny5hYnJ1cHQoInJldHVybiIpO2Nhc2UgNjogLy8gUHV0IHRoaXMgZmV0Y2hlciBpbnRvIGl0J3Mgc3VibWl0dGluZyBzdGF0ZQogICAgICAgICAgICAgICAgICAgICAgZXhpc3RpbmdGZXRjaGVyID0gc3RhdGUuZmV0Y2hlcnMuZ2V0KGtleSk7ZmV0Y2hlciA9IF9leHRlbmRzKHsgc3RhdGU6ICJzdWJtaXR0aW5nIiB9LCBzdWJtaXNzaW9uLCB7IGRhdGE6IGV4aXN0aW5nRmV0Y2hlciAmJiBleGlzdGluZ0ZldGNoZXIuZGF0YSwgIiBfaGFzRmV0Y2hlckRvbmVBbnl0aGluZyAiOiB0cnVlIH0pO3N0YXRlLmZldGNoZXJzLnNldChrZXksIGZldGNoZXIpO3VwZGF0ZVN0YXRlKHsgZmV0Y2hlcnM6IG5ldyBNYXAoc3RhdGUuZmV0Y2hlcnMpIH0pOyAvLyBDYWxsIHRoZSBhY3Rpb24gZm9yIHRoZSBmZXRjaGVyCiAgICAgICAgICAgICAgICAgICAgICBhYm9ydENvbnRyb2xsZXIgPSBuZXcgQWJvcnRDb250cm9sbGVyKCk7ZmV0Y2hSZXF1ZXN0ID0gY3JlYXRlQ2xpZW50U2lkZVJlcXVlc3QoaW5pdC5oaXN0b3J5LCBwYXRoLCBhYm9ydENvbnRyb2xsZXIuc2lnbmFsLCBzdWJtaXNzaW9uKTtmZXRjaENvbnRyb2xsZXJzLnNldChrZXksIGFib3J0Q29udHJvbGxlcik7X2NvbnRleHQ3Lm5leHQgPSAxNTtyZXR1cm4gY2FsbExvYWRlck9yQWN0aW9uKCJhY3Rpb24iLCBmZXRjaFJlcXVlc3QsIG1hdGNoLCByZXF1ZXN0TWF0Y2hlcywgcm91dGVyLmJhc2VuYW1lKTtjYXNlIDE1OmFjdGlvblJlc3VsdCA9IF9jb250ZXh0Ny5zZW50O2lmICghZmV0Y2hSZXF1ZXN0LnNpZ25hbC5hYm9ydGVkKSB7X2NvbnRleHQ3Lm5leHQgPSAxOTticmVhazt9IC8vIFdlIGNhbiBkZWxldGUgdGhpcyBzbyBsb25nIGFzIHdlIHdlcmVuJ3QgYWJvcnRlZCBieSBvdSBvdXIgb3duIGZldGNoZXIKICAgICAgICAgICAgICAgICAgICAgIC8vIHJlLXN1Ym1pdCB3aGljaCB3b3VsZCBoYXZlIHB1dCBfbmV3XyBjb250cm9sbGVyIGlzIGluIGZldGNoQ29udHJvbGxlcnMKICAgICAgICAgICAgICAgICAgICAgIGlmIChmZXRjaENvbnRyb2xsZXJzLmdldChrZXkpID09PSBhYm9ydENvbnRyb2xsZXIpIHtmZXRjaENvbnRyb2xsZXJzLmRlbGV0ZShrZXkpO31yZXR1cm4gX2NvbnRleHQ3LmFicnVwdCgicmV0dXJuIik7Y2FzZSAxOTppZiAoIWlzUmVkaXJlY3RSZXN1bHQoYWN0aW9uUmVzdWx0KSkge19jb250ZXh0Ny5uZXh0ID0gMjY7YnJlYWs7fWZldGNoQ29udHJvbGxlcnMuZGVsZXRlKGtleSk7ZmV0Y2hSZWRpcmVjdElkcy5hZGQoa2V5KTtsb2FkaW5nRmV0Y2hlciA9IF9leHRlbmRzKHsgc3RhdGU6ICJsb2FkaW5nIiB9LCBzdWJtaXNzaW9uLCB7IGRhdGE6IHVuZGVmaW5lZCwgIiBfaGFzRmV0Y2hlckRvbmVBbnl0aGluZyAiOiB0cnVlIH0pO3N0YXRlLmZldGNoZXJzLnNldChrZXksIGxvYWRpbmdGZXRjaGVyKTt1cGRhdGVTdGF0ZSh7IGZldGNoZXJzOiBuZXcgTWFwKHN0YXRlLmZldGNoZXJzKSB9KTtyZXR1cm4gX2NvbnRleHQ3LmFicnVwdCgicmV0dXJuIiwgc3RhcnRSZWRpcmVjdE5hdmlnYXRpb24oc3RhdGUsIGFjdGlvblJlc3VsdCwgeyBpc0ZldGNoQWN0aW9uUmVkaXJlY3Q6IHRydWUgfSkpO2Nhc2UgMjY6aWYgKCFpc0Vycm9yUmVzdWx0KGFjdGlvblJlc3VsdCkpIHtfY29udGV4dDcubmV4dCA9IDI5O2JyZWFrO31zZXRGZXRjaGVyRXJyb3Ioa2V5LCByb3V0ZUlkLCBhY3Rpb25SZXN1bHQuZXJyb3IpO3JldHVybiBfY29udGV4dDcuYWJydXB0KCJyZXR1cm4iKTtjYXNlIDI5OmlmICghaXNEZWZlcnJlZFJlc3VsdChhY3Rpb25SZXN1bHQpKSB7X2NvbnRleHQ3Lm5leHQgPSAzMTticmVhazt9dGhyb3cgZ2V0SW50ZXJuYWxSb3V0ZXJFcnJvcig0MDAsIHsgdHlwZTogImRlZmVyLWFjdGlvbiIgfSk7Y2FzZSAzMTogLy8gU3RhcnQgdGhlIGRhdGEgbG9hZCBmb3IgY3VycmVudCBtYXRjaGVzLCBvciB0aGUgbmV4dCBsb2NhdGlvbiBpZiB3ZSdyZQogICAgICAgICAgICAgICAgICAgICAgLy8gaW4gdGhlIG1pZGRsZSBvZiBhIG5hdmlnYXRpb24KICAgICAgICAgICAgICAgICAgICAgIG5leHRMb2NhdGlvbiA9IHN0YXRlLm5hdmlnYXRpb24ubG9jYXRpb24gfHwgc3RhdGUubG9jYXRpb247cmV2YWxpZGF0aW9uUmVxdWVzdCA9IGNyZWF0ZUNsaWVudFNpZGVSZXF1ZXN0KGluaXQuaGlzdG9yeSwgbmV4dExvY2F0aW9uLCBhYm9ydENvbnRyb2xsZXIuc2lnbmFsKTttYXRjaGVzID0gc3RhdGUubmF2aWdhdGlvbi5zdGF0ZSAhPT0gImlkbGUiID8gbWF0Y2hSb3V0ZXMoZGF0YVJvdXRlcywgc3RhdGUubmF2aWdhdGlvbi5sb2NhdGlvbiwgaW5pdC5iYXNlbmFtZSkgOiBzdGF0ZS5tYXRjaGVzO3JvdXRlcl9pbnZhcmlhbnQobWF0Y2hlcywgIkRpZG4ndCBmaW5kIGFueSBtYXRjaGVzIGFmdGVyIGZldGNoZXIgYWN0aW9uIik7bG9hZElkID0gKytpbmNyZW1lbnRpbmdMb2FkSWQ7ZmV0Y2hSZWxvYWRJZHMuc2V0KGtleSwgbG9hZElkKTtsb2FkRmV0Y2hlciA9IF9leHRlbmRzKHsgc3RhdGU6ICJsb2FkaW5nIiwgZGF0YTogYWN0aW9uUmVzdWx0LmRhdGEgfSwgc3VibWlzc2lvbiwgeyAiIF9oYXNGZXRjaGVyRG9uZUFueXRoaW5nICI6IHRydWUgfSk7c3RhdGUuZmV0Y2hlcnMuc2V0KGtleSwgbG9hZEZldGNoZXIpO19nZXRNYXRjaGVzVG9Mb2FkMyA9IGdldE1hdGNoZXNUb0xvYWQoaW5pdC5oaXN0b3J5LCBzdGF0ZSwgbWF0Y2hlcywgc3VibWlzc2lvbiwgbmV4dExvY2F0aW9uLCBpc1JldmFsaWRhdGlvblJlcXVpcmVkLCBjYW5jZWxsZWREZWZlcnJlZFJvdXRlcywgY2FuY2VsbGVkRmV0Y2hlckxvYWRzLCBfZGVmaW5lUHJvcGVydHkyKHt9LCBtYXRjaC5yb3V0ZS5pZCwgYWN0aW9uUmVzdWx0LmRhdGEpLCB1bmRlZmluZWQsIC8vIE5vIG5lZWQgdG8gc2VuZCB0aHJvdWdoIGVycm9ycyBzaW5jZSB3ZSBzaG9ydCBjaXJjdWl0IGFib3ZlCiAgICAgICAgICAgICAgICAgICAgICBmZXRjaExvYWRNYXRjaGVzKSwgX2dldE1hdGNoZXNUb0xvYWQ0ID0gX3NsaWNlZFRvQXJyYXkyKF9nZXRNYXRjaGVzVG9Mb2FkMywgMiksIG1hdGNoZXNUb0xvYWQgPSBfZ2V0TWF0Y2hlc1RvTG9hZDRbMF0sIHJldmFsaWRhdGluZ0ZldGNoZXJzID0gX2dldE1hdGNoZXNUb0xvYWQ0WzFdOyAvLyBQdXQgYWxsIHJldmFsaWRhdGluZyBmZXRjaGVycyBpbnRvIHRoZSBsb2FkaW5nIHN0YXRlLCBleGNlcHQgZm9yIHRoZQogICAgICAgICAgICAgICAgICAgICAgLy8gY3VycmVudCBmZXRjaGVyIHdoaWNoIHdlIHdhbnQgdG8ga2VlcCBpbiBpdCdzIGN1cnJlbnQgbG9hZGluZyBzdGF0ZSB3aGljaAogICAgICAgICAgICAgICAgICAgICAgLy8gY29udGFpbnMgaXQncyBhY3Rpb24gc3VibWlzc2lvbiBpbmZvICsgYWN0aW9uIGRhdGEKICAgICAgICAgICAgICAgICAgICAgIHJldmFsaWRhdGluZ0ZldGNoZXJzLmZpbHRlcigoX3JlZjUpID0+IHt2YXIgX3JlZjE4ID0gX3NsaWNlZFRvQXJyYXkyKF9yZWY1LCAxKSxzdGFsZUtleSA9IF9yZWYxOFswXTtyZXR1cm4gc3RhbGVLZXkgIT09IGtleTt9KS5mb3JFYWNoKChfcmVmNikgPT4ge3ZhciBfcmVmMTkgPSBfc2xpY2VkVG9BcnJheTIoX3JlZjYsIDEpLHN0YWxlS2V5ID0gX3JlZjE5WzBdO3ZhciBleGlzdGluZ0ZldGNoZXIgPSBzdGF0ZS5mZXRjaGVycy5nZXQoc3RhbGVLZXkpO3ZhciByZXZhbGlkYXRpbmdGZXRjaGVyID0geyBzdGF0ZTogImxvYWRpbmciLCBkYXRhOiBleGlzdGluZ0ZldGNoZXIgJiYgZXhpc3RpbmdGZXRjaGVyLmRhdGEsIGZvcm1NZXRob2Q6IHVuZGVmaW5lZCwgZm9ybUFjdGlvbjogdW5kZWZpbmVkLCBmb3JtRW5jVHlwZTogdW5kZWZpbmVkLCBmb3JtRGF0YTogdW5kZWZpbmVkLCAiIF9oYXNGZXRjaGVyRG9uZUFueXRoaW5nICI6IHRydWUgfTtzdGF0ZS5mZXRjaGVycy5zZXQoc3RhbGVLZXksIHJldmFsaWRhdGluZ0ZldGNoZXIpO2ZldGNoQ29udHJvbGxlcnMuc2V0KHN0YWxlS2V5LCBhYm9ydENvbnRyb2xsZXIpO30pO3VwZGF0ZVN0YXRlKHsgZmV0Y2hlcnM6IG5ldyBNYXAoc3RhdGUuZmV0Y2hlcnMpIH0pO19jb250ZXh0Ny5uZXh0ID0gNDQ7cmV0dXJuIGNhbGxMb2FkZXJzQW5kTWF5YmVSZXNvbHZlRGF0YShzdGF0ZS5tYXRjaGVzLCBtYXRjaGVzLCBtYXRjaGVzVG9Mb2FkLCByZXZhbGlkYXRpbmdGZXRjaGVycywgcmV2YWxpZGF0aW9uUmVxdWVzdCk7Y2FzZSA0NDpfeWllbGQkY2FsbExvYWRlcnNBbmQyID0gX2NvbnRleHQ3LnNlbnQ7cmVzdWx0cyA9IF95aWVsZCRjYWxsTG9hZGVyc0FuZDIucmVzdWx0cztsb2FkZXJSZXN1bHRzID0gX3lpZWxkJGNhbGxMb2FkZXJzQW5kMi5sb2FkZXJSZXN1bHRzO2ZldGNoZXJSZXN1bHRzID0gX3lpZWxkJGNhbGxMb2FkZXJzQW5kMi5mZXRjaGVyUmVzdWx0cztpZiAoIWFib3J0Q29udHJvbGxlci5zaWduYWwuYWJvcnRlZCkge19jb250ZXh0Ny5uZXh0ID0gNTA7YnJlYWs7fXJldHVybiBfY29udGV4dDcuYWJydXB0KCJyZXR1cm4iKTtjYXNlIDUwOmZldGNoUmVsb2FkSWRzLmRlbGV0ZShrZXkpO2ZldGNoQ29udHJvbGxlcnMuZGVsZXRlKGtleSk7cmV2YWxpZGF0aW5nRmV0Y2hlcnMuZm9yRWFjaCgoX3JlZjcpID0+IHt2YXIgX3JlZjIwID0gX3NsaWNlZFRvQXJyYXkyKF9yZWY3LCAxKSxzdGFsZUtleSA9IF9yZWYyMFswXTtyZXR1cm4gZmV0Y2hDb250cm9sbGVycy5kZWxldGUoc3RhbGVLZXkpO30pO3JlZGlyZWN0ID0gZmluZFJlZGlyZWN0KHJlc3VsdHMpO2lmICghcmVkaXJlY3QpIHtfY29udGV4dDcubmV4dCA9IDU2O2JyZWFrO31yZXR1cm4gX2NvbnRleHQ3LmFicnVwdCgicmV0dXJuIiwgc3RhcnRSZWRpcmVjdE5hdmlnYXRpb24oc3RhdGUsIHJlZGlyZWN0KSk7Y2FzZSA1NjogLy8gUHJvY2VzcyBhbmQgY29tbWl0IG91dHB1dCBmcm9tIGxvYWRlcnMKICAgICAgICAgICAgICAgICAgICAgIF9wcm9jZXNzTG9hZGVyRGF0YTIgPSBwcm9jZXNzTG9hZGVyRGF0YShzdGF0ZSwgc3RhdGUubWF0Y2hlcywgbWF0Y2hlc1RvTG9hZCwgbG9hZGVyUmVzdWx0cywgdW5kZWZpbmVkLCByZXZhbGlkYXRpbmdGZXRjaGVycywgZmV0Y2hlclJlc3VsdHMsIGFjdGl2ZURlZmVycmVkcyksIGxvYWRlckRhdGEgPSBfcHJvY2Vzc0xvYWRlckRhdGEyLmxvYWRlckRhdGEsIGVycm9ycyA9IF9wcm9jZXNzTG9hZGVyRGF0YTIuZXJyb3JzO2RvbmVGZXRjaGVyID0geyBzdGF0ZTogImlkbGUiLCBkYXRhOiBhY3Rpb25SZXN1bHQuZGF0YSwgZm9ybU1ldGhvZDogdW5kZWZpbmVkLCBmb3JtQWN0aW9uOiB1bmRlZmluZWQsIGZvcm1FbmNUeXBlOiB1bmRlZmluZWQsIGZvcm1EYXRhOiB1bmRlZmluZWQsICIgX2hhc0ZldGNoZXJEb25lQW55dGhpbmcgIjogdHJ1ZSB9O3N0YXRlLmZldGNoZXJzLnNldChrZXksIGRvbmVGZXRjaGVyKTtkaWRBYm9ydEZldGNoTG9hZHMgPSBhYm9ydFN0YWxlRmV0Y2hMb2Fkcyhsb2FkSWQpOyAvLyBJZiB3ZSBhcmUgY3VycmVudGx5IGluIGEgbmF2aWdhdGlvbiBsb2FkaW5nIHN0YXRlIGFuZCB0aGlzIGZldGNoZXIgaXMKICAgICAgICAgICAgICAgICAgICAgIC8vIG1vcmUgcmVjZW50IHRoYW4gdGhlIG5hdmlnYXRpb24sIHdlIHdhbnQgdGhlIG5ld2VyIGRhdGEgc28gYWJvcnQgdGhlCiAgICAgICAgICAgICAgICAgICAgICAvLyBuYXZpZ2F0aW9uIGFuZCBjb21wbGV0ZSBpdCB3aXRoIHRoZSBmZXRjaGVyIGRhdGEKICAgICAgICAgICAgICAgICAgICAgIGlmIChzdGF0ZS5uYXZpZ2F0aW9uLnN0YXRlID09PSAibG9hZGluZyIgJiYgbG9hZElkID4gcGVuZGluZ05hdmlnYXRpb25Mb2FkSWQpIHtyb3V0ZXJfaW52YXJpYW50KHBlbmRpbmdBY3Rpb24sICJFeHBlY3RlZCBwZW5kaW5nIGFjdGlvbiIpO3BlbmRpbmdOYXZpZ2F0aW9uQ29udHJvbGxlciAmJiBwZW5kaW5nTmF2aWdhdGlvbkNvbnRyb2xsZXIuYWJvcnQoKTtjb21wbGV0ZU5hdmlnYXRpb24oc3RhdGUubmF2aWdhdGlvbi5sb2NhdGlvbiwgeyBtYXRjaGVzOiBtYXRjaGVzLCBsb2FkZXJEYXRhOiBsb2FkZXJEYXRhLCBlcnJvcnM6IGVycm9ycywgZmV0Y2hlcnM6IG5ldyBNYXAoc3RhdGUuZmV0Y2hlcnMpIH0pO30gZWxzZSB7Ly8gb3RoZXJ3aXNlIGp1c3QgdXBkYXRlIHdpdGggdGhlIGZldGNoZXIgZGF0YSwgcHJlc2VydmluZyBhbnkgZXhpc3RpbmcKICAgICAgICAgICAgICAgICAgICAgICAgLy8gbG9hZGVyRGF0YSBmb3IgbG9hZGVycyB0aGF0IGRpZCBub3QgbmVlZCB0byByZWxvYWQuICBXZSBoYXZlIHRvCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIG1hbnVhbGx5IG1lcmdlIGhlcmUgc2luY2Ugd2UgYXJlbid0IGdvaW5nIHRocm91Z2ggY29tcGxldGVOYXZpZ2F0aW9uCiAgICAgICAgICAgICAgICAgICAgICAgIHVwZGF0ZVN0YXRlKF9leHRlbmRzKHsgZXJyb3JzOiBlcnJvcnMsIGxvYWRlckRhdGE6IG1lcmdlTG9hZGVyRGF0YShzdGF0ZS5sb2FkZXJEYXRhLCBsb2FkZXJEYXRhLCBtYXRjaGVzLCBlcnJvcnMpIH0sIGRpZEFib3J0RmV0Y2hMb2FkcyA/IHsgZmV0Y2hlcnM6IG5ldyBNYXAoc3RhdGUuZmV0Y2hlcnMpIH0gOiB7fSkpO2lzUmV2YWxpZGF0aW9uUmVxdWlyZWQgPSBmYWxzZTt9Y2FzZSA2MTpjYXNlICJlbmQiOnJldHVybiBfY29udGV4dDcuc3RvcCgpO319LCBfY2FsbGVlNyk7fSkpO3JldHVybiBfaGFuZGxlRmV0Y2hlckFjdGlvbi5hcHBseSh0aGlzLCBhcmd1bWVudHMpO31mdW5jdGlvbiBoYW5kbGVGZXRjaGVyTG9hZGVyKF94MjgsIF94MjksIF94MzAsIF94MzEsIF94MzIsIF94MzMpIHtyZXR1cm4gX2hhbmRsZUZldGNoZXJMb2FkZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKTt9CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCiAgICAgICAgICAgIC8qKgogICAgICAgICAgICAgKiBVdGlsaXR5IGZ1bmN0aW9uIHRvIGhhbmRsZSByZWRpcmVjdHMgcmV0dXJuZWQgZnJvbSBhbiBhY3Rpb24gb3IgbG9hZGVyLgogICAgICAgICAgICAgKiBOb3JtYWxseSwgYSByZWRpcmVjdCAicmVwbGFjZXMiIHRoZSBuYXZpZ2F0aW9uIHRoYXQgdHJpZ2dlcmVkIGl0LiAgU28sIGZvcgogICAgICAgICAgICAgKiBleGFtcGxlOgogICAgICAgICAgICAgKgogICAgICAgICAgICAgKiAgLSB1c2VyIGlzIG9uIC9hCiAgICAgICAgICAgICAqICAtIHVzZXIgY2xpY2tzIGEgbGluayB0byAvYgogICAgICAgICAgICAgKiAgLSBsb2FkZXIgZm9yIC9iIHJlZGlyZWN0cyB0byAvYwogICAgICAgICAgICAgKgogICAgICAgICAgICAgKiBJbiBhIG5vbi1KUyBhcHAgdGhlIGJyb3dzZXIgd291bGQgdHJhY2sgdGhlIGluLWZsaWdodCBuYXZpZ2F0aW9uIHRvIC9iIGFuZAogICAgICAgICAgICAgKiB0aGVuIHJlcGxhY2UgaXQgd2l0aCAvYyB3aGVuIGl0IGVuY291bnRlcmVkIHRoZSByZWRpcmVjdCByZXNwb25zZS4gIEluCiAgICAgICAgICAgICAqIHRoZSBlbmQgaXQgd291bGQgb25seSBldmVyIHVwZGF0ZSB0aGUgVVJMIGJhciB3aXRoIC9jLgogICAgICAgICAgICAgKgogICAgICAgICAgICAgKiBJbiBjbGllbnQtc2lkZSByb3V0aW5nIHVzaW5nIHB1c2hTdGF0ZS9yZXBsYWNlU3RhdGUsIHdlIGFpbSB0byBlbXVsYXRlCiAgICAgICAgICAgICAqIHRoaXMgYmVoYXZpb3IgYW5kIHdlIGFsc28gZG8gbm90IHVwZGF0ZSBoaXN0b3J5IHVudGlsIHRoZSBlbmQgb2YgdGhlCiAgICAgICAgICAgICAqIG5hdmlnYXRpb24gKGluY2x1ZGluZyBwcm9jZXNzZWQgcmVkaXJlY3RzKS4gIFRoaXMgbWVhbnMgdGhhdCB3ZSBuZXZlcgogICAgICAgICAgICAgKiBhY3R1YWxseSB0b3VjaCBoaXN0b3J5IHVudGlsIHdlJ3ZlIHByb2Nlc3NlZCByZWRpcmVjdHMsIHNvIHdlIGp1c3QgdXNlCiAgICAgICAgICAgICAqIHRoZSBoaXN0b3J5IGFjdGlvbiBmcm9tIHRoZSBvcmlnaW5hbCBuYXZpZ2F0aW9uIChQVVNIIG9yIFJFUExBQ0UpLgogICAgICAgICAgICAgKi9mdW5jdGlvbiBfaGFuZGxlRmV0Y2hlckxvYWRlcigpIHtfaGFuZGxlRmV0Y2hlckxvYWRlciA9IF9hc3luY1RvR2VuZXJhdG9yMiggLyojX19QVVJFX18qL19yZWdlbmVyYXRvclJ1bnRpbWUyKCkubWFyayhmdW5jdGlvbiBfY2FsbGVlOChrZXksIHJvdXRlSWQsIHBhdGgsIG1hdGNoLCBtYXRjaGVzLCBzdWJtaXNzaW9uKSB7dmFyIGV4aXN0aW5nRmV0Y2hlciwgbG9hZGluZ0ZldGNoZXIsIGFib3J0Q29udHJvbGxlciwgZmV0Y2hSZXF1ZXN0LCByZXN1bHQsIGJvdW5kYXJ5TWF0Y2gsIGRvbmVGZXRjaGVyO3JldHVybiBfcmVnZW5lcmF0b3JSdW50aW1lMigpLndyYXAoZnVuY3Rpb24gX2NhbGxlZTgkKF9jb250ZXh0OCkge3doaWxlICgxKSBzd2l0Y2ggKF9jb250ZXh0OC5wcmV2ID0gX2NvbnRleHQ4Lm5leHQpIHtjYXNlIDA6ZXhpc3RpbmdGZXRjaGVyID0gc3RhdGUuZmV0Y2hlcnMuZ2V0KGtleSk7IC8vIFB1dCB0aGlzIGZldGNoZXIgaW50byBpdCdzIGxvYWRpbmcgc3RhdGUKICAgICAgICAgICAgICAgICAgICAgIGxvYWRpbmdGZXRjaGVyID0gX2V4dGVuZHMoeyBzdGF0ZTogImxvYWRpbmciLCBmb3JtTWV0aG9kOiB1bmRlZmluZWQsIGZvcm1BY3Rpb246IHVuZGVmaW5lZCwgZm9ybUVuY1R5cGU6IHVuZGVmaW5lZCwgZm9ybURhdGE6IHVuZGVmaW5lZCB9LCBzdWJtaXNzaW9uLCB7IGRhdGE6IGV4aXN0aW5nRmV0Y2hlciAmJiBleGlzdGluZ0ZldGNoZXIuZGF0YSwgIiBfaGFzRmV0Y2hlckRvbmVBbnl0aGluZyAiOiB0cnVlIH0pO3N0YXRlLmZldGNoZXJzLnNldChrZXksIGxvYWRpbmdGZXRjaGVyKTt1cGRhdGVTdGF0ZSh7IGZldGNoZXJzOiBuZXcgTWFwKHN0YXRlLmZldGNoZXJzKSB9KTsgLy8gQ2FsbCB0aGUgbG9hZGVyIGZvciB0aGlzIGZldGNoZXIgcm91dGUgbWF0Y2gKICAgICAgICAgICAgICAgICAgICAgIGFib3J0Q29udHJvbGxlciA9IG5ldyBBYm9ydENvbnRyb2xsZXIoKTtmZXRjaFJlcXVlc3QgPSBjcmVhdGVDbGllbnRTaWRlUmVxdWVzdChpbml0Lmhpc3RvcnksIHBhdGgsIGFib3J0Q29udHJvbGxlci5zaWduYWwpO2ZldGNoQ29udHJvbGxlcnMuc2V0KGtleSwgYWJvcnRDb250cm9sbGVyKTtfY29udGV4dDgubmV4dCA9IDk7cmV0dXJuIGNhbGxMb2FkZXJPckFjdGlvbigibG9hZGVyIiwgZmV0Y2hSZXF1ZXN0LCBtYXRjaCwgbWF0Y2hlcywgcm91dGVyLmJhc2VuYW1lKTtjYXNlIDk6cmVzdWx0ID0gX2NvbnRleHQ4LnNlbnQ7aWYgKCFpc0RlZmVycmVkUmVzdWx0KHJlc3VsdCkpIHtfY29udGV4dDgubmV4dCA9IDE3O2JyZWFrO31fY29udGV4dDgubmV4dCA9IDEzO3JldHVybiByZXNvbHZlRGVmZXJyZWREYXRhKHJlc3VsdCwgZmV0Y2hSZXF1ZXN0LnNpZ25hbCwgdHJ1ZSk7Y2FzZSAxMzpfY29udGV4dDgudDAgPSBfY29udGV4dDguc2VudDtpZiAoX2NvbnRleHQ4LnQwKSB7X2NvbnRleHQ4Lm5leHQgPSAxNjticmVhazt9X2NvbnRleHQ4LnQwID0gcmVzdWx0O2Nhc2UgMTY6cmVzdWx0ID0gX2NvbnRleHQ4LnQwO2Nhc2UgMTc6IC8vIFdlIGNhbiBkZWxldGUgdGhpcyBzbyBsb25nIGFzIHdlIHdlcmVuJ3QgYWJvcnRlZCBieSBvdSBvdXIgb3duIGZldGNoZXIKICAgICAgICAgICAgICAgICAgICAgIC8vIHJlLWxvYWQgd2hpY2ggd291bGQgaGF2ZSBwdXQgX25ld18gY29udHJvbGxlciBpcyBpbiBmZXRjaENvbnRyb2xsZXJzCiAgICAgICAgICAgICAgICAgICAgICBpZiAoZmV0Y2hDb250cm9sbGVycy5nZXQoa2V5KSA9PT0gYWJvcnRDb250cm9sbGVyKSB7ZmV0Y2hDb250cm9sbGVycy5kZWxldGUoa2V5KTt9aWYgKCFmZXRjaFJlcXVlc3Quc2lnbmFsLmFib3J0ZWQpIHtfY29udGV4dDgubmV4dCA9IDIwO2JyZWFrO31yZXR1cm4gX2NvbnRleHQ4LmFicnVwdCgicmV0dXJuIik7Y2FzZSAyMDppZiAoIWlzUmVkaXJlY3RSZXN1bHQocmVzdWx0KSkge19jb250ZXh0OC5uZXh0ID0gMjQ7YnJlYWs7fV9jb250ZXh0OC5uZXh0ID0gMjM7cmV0dXJuIHN0YXJ0UmVkaXJlY3ROYXZpZ2F0aW9uKHN0YXRlLCByZXN1bHQpO2Nhc2UgMjM6cmV0dXJuIF9jb250ZXh0OC5hYnJ1cHQoInJldHVybiIpO2Nhc2UgMjQ6aWYgKCFpc0Vycm9yUmVzdWx0KHJlc3VsdCkpIHtfY29udGV4dDgubmV4dCA9IDI5O2JyZWFrO31ib3VuZGFyeU1hdGNoID0gZmluZE5lYXJlc3RCb3VuZGFyeShzdGF0ZS5tYXRjaGVzLCByb3V0ZUlkKTtzdGF0ZS5mZXRjaGVycy5kZWxldGUoa2V5KTsgLy8gVE9ETzogSW4gcmVtaXgsIHRoaXMgd291bGQgcmVzZXQgdG8gSURMRV9OQVZJR0FUSU9OIGlmIGl0IHdhcyBhIGNhdGNoIC0KICAgICAgICAgICAgICAgICAgICAgIC8vIGRvIHdlIG5lZWQgdG8gYmVoYXZlIGFueSBkaWZmZXJlbnRseSB3aXRoIG91ciBub24tcmVkaXJlY3QgZXJyb3JzPwogICAgICAgICAgICAgICAgICAgICAgLy8gV2hhdCBpZiBpdCB3YXMgYSBub24tcmVkaXJlY3QgUmVzcG9uc2U/CiAgICAgICAgICAgICAgICAgICAgICB1cGRhdGVTdGF0ZSh7IGZldGNoZXJzOiBuZXcgTWFwKHN0YXRlLmZldGNoZXJzKSwgZXJyb3JzOiBfZGVmaW5lUHJvcGVydHkyKHt9LCBib3VuZGFyeU1hdGNoLnJvdXRlLmlkLCByZXN1bHQuZXJyb3IpIH0pO3JldHVybiBfY29udGV4dDguYWJydXB0KCJyZXR1cm4iKTtjYXNlIDI5OnJvdXRlcl9pbnZhcmlhbnQoIWlzRGVmZXJyZWRSZXN1bHQocmVzdWx0KSwgIlVuaGFuZGxlZCBmZXRjaGVyIGRlZmVycmVkIGRhdGEiKTsgLy8gUHV0IHRoZSBmZXRjaGVyIGJhY2sgaW50byBhbiBpZGxlIHN0YXRlCiAgICAgICAgICAgICAgICAgICAgICBkb25lRmV0Y2hlciA9IHsgc3RhdGU6ICJpZGxlIiwgZGF0YTogcmVzdWx0LmRhdGEsIGZvcm1NZXRob2Q6IHVuZGVmaW5lZCwgZm9ybUFjdGlvbjogdW5kZWZpbmVkLCBmb3JtRW5jVHlwZTogdW5kZWZpbmVkLCBmb3JtRGF0YTogdW5kZWZpbmVkLCAiIF9oYXNGZXRjaGVyRG9uZUFueXRoaW5nICI6IHRydWUgfTtzdGF0ZS5mZXRjaGVycy5zZXQoa2V5LCBkb25lRmV0Y2hlcik7dXBkYXRlU3RhdGUoeyBmZXRjaGVyczogbmV3IE1hcChzdGF0ZS5mZXRjaGVycykgfSk7Y2FzZSAzMzpjYXNlICJlbmQiOnJldHVybiBfY29udGV4dDguc3RvcCgpO319LCBfY2FsbGVlOCk7fSkpO3JldHVybiBfaGFuZGxlRmV0Y2hlckxvYWRlci5hcHBseSh0aGlzLCBhcmd1bWVudHMpO31mdW5jdGlvbiBzdGFydFJlZGlyZWN0TmF2aWdhdGlvbihfeDM0LCBfeDM1LCBfeDM2KSB7cmV0dXJuIF9zdGFydFJlZGlyZWN0TmF2aWdhdGlvbi5hcHBseSh0aGlzLCBhcmd1bWVudHMpO31mdW5jdGlvbiBfc3RhcnRSZWRpcmVjdE5hdmlnYXRpb24oKSB7X3N0YXJ0UmVkaXJlY3ROYXZpZ2F0aW9uID0gX2FzeW5jVG9HZW5lcmF0b3IyKCAvKiNfX1BVUkVfXyovX3JlZ2VuZXJhdG9yUnVudGltZTIoKS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWU5KHN0YXRlLCByZWRpcmVjdCwgX3RlbXApIHt2YXIgX3dpbmRvdywgX3JlZjIxLCBzdWJtaXNzaW9uLCByZXBsYWNlLCBpc0ZldGNoQWN0aW9uUmVkaXJlY3QsIHJlZGlyZWN0TG9jYXRpb24sIG5ld09yaWdpbiwgcmVkaXJlY3RIaXN0b3J5QWN0aW9uLCBfc3RhdGUkbmF2aWdhdGlvbiwgZm9ybU1ldGhvZCwgZm9ybUFjdGlvbiwgZm9ybUVuY1R5cGUsIGZvcm1EYXRhO3JldHVybiBfcmVnZW5lcmF0b3JSdW50aW1lMigpLndyYXAoZnVuY3Rpb24gX2NhbGxlZTkkKF9jb250ZXh0OSkge3doaWxlICgxKSBzd2l0Y2ggKF9jb250ZXh0OS5wcmV2ID0gX2NvbnRleHQ5Lm5leHQpIHtjYXNlIDA6X3JlZjIxID0KCiAgICAgICAgICAgICAgICAgICAgICBfdGVtcCA9PT0gdm9pZCAwID8ge30gOiBfdGVtcCwgc3VibWlzc2lvbiA9IF9yZWYyMS5zdWJtaXNzaW9uLCByZXBsYWNlID0gX3JlZjIxLnJlcGxhY2UsIGlzRmV0Y2hBY3Rpb25SZWRpcmVjdCA9IF9yZWYyMS5pc0ZldGNoQWN0aW9uUmVkaXJlY3Q7CgogICAgICAgICAgICAgICAgICAgICAgaWYgKHJlZGlyZWN0LnJldmFsaWRhdGUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaXNSZXZhbGlkYXRpb25SZXF1aXJlZCA9IHRydWU7CiAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgcmVkaXJlY3RMb2NhdGlvbiA9IGNyZWF0ZUxvY2F0aW9uKHN0YXRlLmxvY2F0aW9uLCByZWRpcmVjdC5sb2NhdGlvbiwgLy8gVE9ETzogVGhpcyBjYW4gYmUgcmVtb3ZlZCBvbmNlIHdlIGdldCByaWQgb2YgdXNlVHJhbnNpdGlvbiBpbiBSZW1peCB2MgogICAgICAgICAgICAgICAgICAgICAgX2V4dGVuZHMoewogICAgICAgICAgICAgICAgICAgICAgICBfaXNSZWRpcmVjdDogdHJ1ZQogICAgICAgICAgICAgICAgICAgICAgfSwgaXNGZXRjaEFjdGlvblJlZGlyZWN0ID8gewogICAgICAgICAgICAgICAgICAgICAgICBfaXNGZXRjaEFjdGlvblJlZGlyZWN0OiB0cnVlCiAgICAgICAgICAgICAgICAgICAgICB9IDoge30pKTsKICAgICAgICAgICAgICAgICAgICAgIHJvdXRlcl9pbnZhcmlhbnQocmVkaXJlY3RMb2NhdGlvbiwgIkV4cGVjdGVkIGEgbG9jYXRpb24gb24gdGhlIHJlZGlyZWN0IG5hdmlnYXRpb24iKTsgLy8gQ2hlY2sgaWYgdGhpcyBhbiBleHRlcm5hbCByZWRpcmVjdCB0aGF0IGdvZXMgdG8gYSBuZXcgb3JpZ2luCiAgICAgICAgICAgICAgICAgICAgICBpZiAoISgKICAgICAgICAgICAgICAgICAgICAgIGlzQnJvd3NlciAmJiB0eXBlb2YgKChfd2luZG93ID0gd2luZG93KSA9PSBudWxsID8gdm9pZCAwIDogX3dpbmRvdy5sb2NhdGlvbikgIT09ICJ1bmRlZmluZWQiKSkge19jb250ZXh0OS5uZXh0ID0gOTticmVhazt9CiAgICAgICAgICAgICAgICAgICAgICBuZXdPcmlnaW4gPSBpbml0Lmhpc3RvcnkuY3JlYXRlVVJMKHJlZGlyZWN0LmxvY2F0aW9uKS5vcmlnaW47aWYgKCEoCgogICAgICAgICAgICAgICAgICAgICAgd2luZG93LmxvY2F0aW9uLm9yaWdpbiAhPT0gbmV3T3JpZ2luKSkge19jb250ZXh0OS5uZXh0ID0gOTticmVhazt9CiAgICAgICAgICAgICAgICAgICAgICBpZiAocmVwbGFjZSkgewogICAgICAgICAgICAgICAgICAgICAgICB3aW5kb3cubG9jYXRpb24ucmVwbGFjZShyZWRpcmVjdC5sb2NhdGlvbik7CiAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICB3aW5kb3cubG9jYXRpb24uYXNzaWduKHJlZGlyZWN0LmxvY2F0aW9uKTsKICAgICAgICAgICAgICAgICAgICAgIH1yZXR1cm4gX2NvbnRleHQ5LmFicnVwdCgicmV0dXJuIik7Y2FzZSA5OgoKCgogICAgICAgICAgICAgICAgICAgICAgLy8gVGhlcmUncyBubyBuZWVkIHRvIGFib3J0IG9uIHJlZGlyZWN0cywgc2luY2Ugd2UgZG9uJ3QgZGV0ZWN0IHRoZQogICAgICAgICAgICAgICAgICAgICAgLy8gcmVkaXJlY3QgdW50aWwgdGhlIGFjdGlvbi9sb2FkZXJzIGhhdmUgc2V0dGxlZAoKCiAgICAgICAgICAgICAgICAgICAgICBwZW5kaW5nTmF2aWdhdGlvbkNvbnRyb2xsZXIgPSBudWxsOwogICAgICAgICAgICAgICAgICAgICAgcmVkaXJlY3RIaXN0b3J5QWN0aW9uID0gcmVwbGFjZSA9PT0gdHJ1ZSA/IEFjdGlvbi5SZXBsYWNlIDogQWN0aW9uLlB1c2g7IC8vIFVzZSB0aGUgaW5jb21pbmcgc3VibWlzc2lvbiBpZiBwcm92aWRlZCwgZmFsbGJhY2sgb24gdGhlIGFjdGl2ZSBvbmUgaW4KICAgICAgICAgICAgICAgICAgICAgIC8vIHN0YXRlLm5hdmlnYXRpb24KICAgICAgICAgICAgICAgICAgICAgIF9zdGF0ZSRuYXZpZ2F0aW9uID0KCgoKCgogICAgICAgICAgICAgICAgICAgICAgc3RhdGUubmF2aWdhdGlvbiwgZm9ybU1ldGhvZCA9IF9zdGF0ZSRuYXZpZ2F0aW9uLmZvcm1NZXRob2QsIGZvcm1BY3Rpb24gPSBfc3RhdGUkbmF2aWdhdGlvbi5mb3JtQWN0aW9uLCBmb3JtRW5jVHlwZSA9IF9zdGF0ZSRuYXZpZ2F0aW9uLmZvcm1FbmNUeXBlLCBmb3JtRGF0YSA9IF9zdGF0ZSRuYXZpZ2F0aW9uLmZvcm1EYXRhOwoKICAgICAgICAgICAgICAgICAgICAgIGlmICghc3VibWlzc2lvbiAmJiBmb3JtTWV0aG9kICYmIGZvcm1BY3Rpb24gJiYgZm9ybURhdGEgJiYgZm9ybUVuY1R5cGUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgc3VibWlzc2lvbiA9IHsKICAgICAgICAgICAgICAgICAgICAgICAgICBmb3JtTWV0aG9kOiBmb3JtTWV0aG9kLAogICAgICAgICAgICAgICAgICAgICAgICAgIGZvcm1BY3Rpb246IGZvcm1BY3Rpb24sCiAgICAgICAgICAgICAgICAgICAgICAgICAgZm9ybUVuY1R5cGU6IGZvcm1FbmNUeXBlLAogICAgICAgICAgICAgICAgICAgICAgICAgIGZvcm1EYXRhOiBmb3JtRGF0YQogICAgICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgICAgICAgfSAvLyBJZiB0aGlzIHdhcyBhIDMwNy8zMDggc3VibWlzc2lvbiB3ZSB3YW50IHRvIHByZXNlcnZlIHRoZSBIVFRQIG1ldGhvZCBhbmQKICAgICAgICAgICAgICAgICAgICAgIC8vIHJlLXN1Ym1pdCB0aGUgR0VUL1BPU1QvUFVUL1BBVENIL0RFTEVURSBhcyBhIHN1Ym1pc3Npb24gbmF2aWdhdGlvbiB0byB0aGUKICAgICAgICAgICAgICAgICAgICAgIC8vIHJlZGlyZWN0ZWQgbG9jYXRpb24KICAgICAgICAgICAgICAgICAgICAgIGlmICghKAoKICAgICAgICAgICAgICAgICAgICAgIHJlZGlyZWN0UHJlc2VydmVNZXRob2RTdGF0dXNDb2Rlcy5oYXMocmVkaXJlY3Quc3RhdHVzKSAmJiBzdWJtaXNzaW9uICYmIGlzTXV0YXRpb25NZXRob2Qoc3VibWlzc2lvbi5mb3JtTWV0aG9kKSkpIHtfY29udGV4dDkubmV4dCA9IDE4O2JyZWFrO31fY29udGV4dDkubmV4dCA9IDE2O3JldHVybiAoCiAgICAgICAgICAgICAgICAgICAgICAgIHN0YXJ0TmF2aWdhdGlvbihyZWRpcmVjdEhpc3RvcnlBY3Rpb24sIHJlZGlyZWN0TG9jYXRpb24sIHsKICAgICAgICAgICAgICAgICAgICAgICAgICBzdWJtaXNzaW9uOiBfZXh0ZW5kcyh7fSwgc3VibWlzc2lvbiwgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9ybUFjdGlvbjogcmVkaXJlY3QubG9jYXRpb24KICAgICAgICAgICAgICAgICAgICAgICAgICB9KSwKICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBQcmVzZXJ2ZSB0aGlzIGZsYWcgYWNyb3NzIHJlZGlyZWN0cwogICAgICAgICAgICAgICAgICAgICAgICAgIHByZXZlbnRTY3JvbGxSZXNldDogcGVuZGluZ1ByZXZlbnRTY3JvbGxSZXNldAogICAgICAgICAgICAgICAgICAgICAgICB9KSk7Y2FzZSAxNjpfY29udGV4dDkubmV4dCA9IDIwO2JyZWFrO2Nhc2UgMTg6X2NvbnRleHQ5Lm5leHQgPSAyMDtyZXR1cm4gKAoKCgogICAgICAgICAgICAgICAgICAgICAgICBzdGFydE5hdmlnYXRpb24ocmVkaXJlY3RIaXN0b3J5QWN0aW9uLCByZWRpcmVjdExvY2F0aW9uLCB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgb3ZlcnJpZGVOYXZpZ2F0aW9uOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGF0ZTogImxvYWRpbmciLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9jYXRpb246IHJlZGlyZWN0TG9jYXRpb24sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3JtTWV0aG9kOiBzdWJtaXNzaW9uID8gc3VibWlzc2lvbi5mb3JtTWV0aG9kIDogdW5kZWZpbmVkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9ybUFjdGlvbjogc3VibWlzc2lvbiA/IHN1Ym1pc3Npb24uZm9ybUFjdGlvbiA6IHVuZGVmaW5lZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvcm1FbmNUeXBlOiBzdWJtaXNzaW9uID8gc3VibWlzc2lvbi5mb3JtRW5jVHlwZSA6IHVuZGVmaW5lZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvcm1EYXRhOiBzdWJtaXNzaW9uID8gc3VibWlzc2lvbi5mb3JtRGF0YSA6IHVuZGVmaW5lZAogICAgICAgICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gUHJlc2VydmUgdGhpcyBmbGFnIGFjcm9zcyByZWRpcmVjdHMKICAgICAgICAgICAgICAgICAgICAgICAgICBwcmV2ZW50U2Nyb2xsUmVzZXQ6IHBlbmRpbmdQcmV2ZW50U2Nyb2xsUmVzZXQKICAgICAgICAgICAgICAgICAgICAgICAgfSkpO2Nhc2UgMjA6Y2FzZSAiZW5kIjpyZXR1cm4gX2NvbnRleHQ5LnN0b3AoKTt9fSwgX2NhbGxlZTkpO30pKTtyZXR1cm4gX3N0YXJ0UmVkaXJlY3ROYXZpZ2F0aW9uLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7fWZ1bmN0aW9uCgoKCiAgICAgICAgICAgIGNhbGxMb2FkZXJzQW5kTWF5YmVSZXNvbHZlRGF0YShfeDM3LCBfeDM4LCBfeDM5LCBfeDQwLCBfeDQxKSB7cmV0dXJuIF9jYWxsTG9hZGVyc0FuZE1heWJlUmVzb2x2ZURhdGEuYXBwbHkodGhpcywgYXJndW1lbnRzKTt9ZnVuY3Rpb24gX2NhbGxMb2FkZXJzQW5kTWF5YmVSZXNvbHZlRGF0YSgpIHtfY2FsbExvYWRlcnNBbmRNYXliZVJlc29sdmVEYXRhID0gX2FzeW5jVG9HZW5lcmF0b3IyKCAvKiNfX1BVUkVfXyovX3JlZ2VuZXJhdG9yUnVudGltZTIoKS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUxMChjdXJyZW50TWF0Y2hlcywgbWF0Y2hlcywgbWF0Y2hlc1RvTG9hZCwgZmV0Y2hlcnNUb0xvYWQsIHJlcXVlc3QpIHt2YXIgcmVzdWx0cywgbG9hZGVyUmVzdWx0cywgZmV0Y2hlclJlc3VsdHM7cmV0dXJuIF9yZWdlbmVyYXRvclJ1bnRpbWUyKCkud3JhcChmdW5jdGlvbiBfY2FsbGVlMTAkKF9jb250ZXh0MTApIHt3aGlsZSAoMSkgc3dpdGNoIChfY29udGV4dDEwLnByZXYgPSBfY29udGV4dDEwLm5leHQpIHtjYXNlIDA6X2NvbnRleHQxMC5uZXh0ID0gMjtyZXR1cm4gKAoKCgogICAgICAgICAgICAgICAgICAgICAgICBQcm9taXNlLmFsbChbXS5jb25jYXQoX3RvQ29uc3VtYWJsZUFycmF5KG1hdGNoZXNUb0xvYWQubWFwKChtYXRjaCkgPT4gY2FsbExvYWRlck9yQWN0aW9uKCJsb2FkZXIiLCByZXF1ZXN0LCBtYXRjaCwgbWF0Y2hlcywgcm91dGVyLmJhc2VuYW1lKSkpLCBfdG9Db25zdW1hYmxlQXJyYXkoZmV0Y2hlcnNUb0xvYWQubWFwKChfcmVmOCkgPT4gewogICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBfcmVmMjIgPSBfc2xpY2VkVG9BcnJheTIoX3JlZjgsIDQpLGhyZWYgPSBfcmVmMjJbMV0sbWF0Y2ggPSBfcmVmMjJbMl0sZmV0Y2hNYXRjaGVzID0gX3JlZjIyWzNdOwogICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBjYWxsTG9hZGVyT3JBY3Rpb24oImxvYWRlciIsIGNyZWF0ZUNsaWVudFNpZGVSZXF1ZXN0KGluaXQuaGlzdG9yeSwgaHJlZiwgcmVxdWVzdC5zaWduYWwpLCBtYXRjaCwgZmV0Y2hNYXRjaGVzLCByb3V0ZXIuYmFzZW5hbWUpOwogICAgICAgICAgICAgICAgICAgICAgICB9KSkpKSk7Y2FzZSAyOnJlc3VsdHMgPSBfY29udGV4dDEwLnNlbnQ7CiAgICAgICAgICAgICAgICAgICAgICBsb2FkZXJSZXN1bHRzID0gcmVzdWx0cy5zbGljZSgwLCBtYXRjaGVzVG9Mb2FkLmxlbmd0aCk7CiAgICAgICAgICAgICAgICAgICAgICBmZXRjaGVyUmVzdWx0cyA9IHJlc3VsdHMuc2xpY2UobWF0Y2hlc1RvTG9hZC5sZW5ndGgpO19jb250ZXh0MTAubmV4dCA9IDc7cmV0dXJuICgKICAgICAgICAgICAgICAgICAgICAgICAgUHJvbWlzZS5hbGwoW3Jlc29sdmVEZWZlcnJlZFJlc3VsdHMoY3VycmVudE1hdGNoZXMsIG1hdGNoZXNUb0xvYWQsIGxvYWRlclJlc3VsdHMsIHJlcXVlc3Quc2lnbmFsLCBmYWxzZSwgc3RhdGUubG9hZGVyRGF0YSksIHJlc29sdmVEZWZlcnJlZFJlc3VsdHMoY3VycmVudE1hdGNoZXMsIGZldGNoZXJzVG9Mb2FkLm1hcCgoX3JlZjkpID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgX3JlZjIzID0gX3NsaWNlZFRvQXJyYXkyKF9yZWY5LCAzKSxtYXRjaCA9IF9yZWYyM1syXTsKICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gbWF0Y2g7CiAgICAgICAgICAgICAgICAgICAgICAgIH0pLCBmZXRjaGVyUmVzdWx0cywgcmVxdWVzdC5zaWduYWwsIHRydWUpXSkpO2Nhc2UgNzpyZXR1cm4gX2NvbnRleHQxMC5hYnJ1cHQoInJldHVybiIsCiAgICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdHM6IHJlc3VsdHMsCiAgICAgICAgICAgICAgICAgICAgICAgIGxvYWRlclJlc3VsdHM6IGxvYWRlclJlc3VsdHMsCiAgICAgICAgICAgICAgICAgICAgICAgIGZldGNoZXJSZXN1bHRzOiBmZXRjaGVyUmVzdWx0cwogICAgICAgICAgICAgICAgICAgICAgfSk7Y2FzZSA4OmNhc2UgImVuZCI6cmV0dXJuIF9jb250ZXh0MTAuc3RvcCgpO319LCBfY2FsbGVlMTApO30pKTtyZXR1cm4gX2NhbGxMb2FkZXJzQW5kTWF5YmVSZXNvbHZlRGF0YS5hcHBseSh0aGlzLCBhcmd1bWVudHMpO30KCgogICAgICAgICAgICBmdW5jdGlvbiBpbnRlcnJ1cHRBY3RpdmVMb2FkcygpIHt2YXIgX2NhbmNlbGxlZERlZmVycmVkUm91OwogICAgICAgICAgICAgIC8vIEV2ZXJ5IGludGVycnVwdGlvbiB0cmlnZ2VycyBhIHJldmFsaWRhdGlvbgogICAgICAgICAgICAgIGlzUmV2YWxpZGF0aW9uUmVxdWlyZWQgPSB0cnVlOyAvLyBDYW5jZWwgcGVuZGluZyByb3V0ZS1sZXZlbCBkZWZlcnJlZHMgYW5kIG1hcmsgY2FuY2VsbGVkIHJvdXRlcyBmb3IKICAgICAgICAgICAgICAvLyByZXZhbGlkYXRpb24KCiAgICAgICAgICAgICAgKF9jYW5jZWxsZWREZWZlcnJlZFJvdSA9IGNhbmNlbGxlZERlZmVycmVkUm91dGVzKS5wdXNoLmFwcGx5KF9jYW5jZWxsZWREZWZlcnJlZFJvdSwgX3RvQ29uc3VtYWJsZUFycmF5KGNhbmNlbEFjdGl2ZURlZmVycmVkcygpKSk7IC8vIEFib3J0IGluLWZsaWdodCBmZXRjaGVyIGxvYWRzCgogICAgICAgICAgICAgIGZldGNoTG9hZE1hdGNoZXMuZm9yRWFjaCgoXywga2V5KSA9PiB7CiAgICAgICAgICAgICAgICBpZiAoZmV0Y2hDb250cm9sbGVycy5oYXMoa2V5KSkgewogICAgICAgICAgICAgICAgICBjYW5jZWxsZWRGZXRjaGVyTG9hZHMucHVzaChrZXkpOwogICAgICAgICAgICAgICAgICBhYm9ydEZldGNoZXIoa2V5KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgZnVuY3Rpb24gc2V0RmV0Y2hlckVycm9yKGtleSwgcm91dGVJZCwgZXJyb3IpIHsKICAgICAgICAgICAgICB2YXIgYm91bmRhcnlNYXRjaCA9IGZpbmROZWFyZXN0Qm91bmRhcnkoc3RhdGUubWF0Y2hlcywgcm91dGVJZCk7CiAgICAgICAgICAgICAgZGVsZXRlRmV0Y2hlcihrZXkpOwogICAgICAgICAgICAgIHVwZGF0ZVN0YXRlKHsKICAgICAgICAgICAgICAgIGVycm9yczogX2RlZmluZVByb3BlcnR5Mih7fSwKICAgICAgICAgICAgICAgIGJvdW5kYXJ5TWF0Y2gucm91dGUuaWQsIGVycm9yKSwKCiAgICAgICAgICAgICAgICBmZXRjaGVyczogbmV3IE1hcChzdGF0ZS5mZXRjaGVycykKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgZnVuY3Rpb24gZGVsZXRlRmV0Y2hlcihrZXkpIHsKICAgICAgICAgICAgICBpZiAoZmV0Y2hDb250cm9sbGVycy5oYXMoa2V5KSkgYWJvcnRGZXRjaGVyKGtleSk7CiAgICAgICAgICAgICAgZmV0Y2hMb2FkTWF0Y2hlcy5kZWxldGUoa2V5KTsKICAgICAgICAgICAgICBmZXRjaFJlbG9hZElkcy5kZWxldGUoa2V5KTsKICAgICAgICAgICAgICBmZXRjaFJlZGlyZWN0SWRzLmRlbGV0ZShrZXkpOwogICAgICAgICAgICAgIHN0YXRlLmZldGNoZXJzLmRlbGV0ZShrZXkpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBmdW5jdGlvbiBhYm9ydEZldGNoZXIoa2V5KSB7CiAgICAgICAgICAgICAgdmFyIGNvbnRyb2xsZXIgPSBmZXRjaENvbnRyb2xsZXJzLmdldChrZXkpOwogICAgICAgICAgICAgIHJvdXRlcl9pbnZhcmlhbnQoY29udHJvbGxlciwgIkV4cGVjdGVkIGZldGNoIGNvbnRyb2xsZXI6ICIgKyBrZXkpOwogICAgICAgICAgICAgIGNvbnRyb2xsZXIuYWJvcnQoKTsKICAgICAgICAgICAgICBmZXRjaENvbnRyb2xsZXJzLmRlbGV0ZShrZXkpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBmdW5jdGlvbiBtYXJrRmV0Y2hlcnNEb25lKGtleXMpIHt2YXIgX2l0ZXJhdG9yNSA9IF9jcmVhdGVGb3JPZkl0ZXJhdG9ySGVscGVyMigKICAgICAgICAgICAgICAgIGtleXMpLF9zdGVwNTt0cnkge2ZvciAoX2l0ZXJhdG9yNS5zKCk7ICEoX3N0ZXA1ID0gX2l0ZXJhdG9yNS5uKCkpLmRvbmU7KSB7dmFyIGtleSA9IF9zdGVwNS52YWx1ZTsKICAgICAgICAgICAgICAgICAgdmFyIGZldGNoZXIgPSBnZXRGZXRjaGVyKGtleSk7CiAgICAgICAgICAgICAgICAgIHZhciBkb25lRmV0Y2hlciA9IHsKICAgICAgICAgICAgICAgICAgICBzdGF0ZTogImlkbGUiLAogICAgICAgICAgICAgICAgICAgIGRhdGE6IGZldGNoZXIuZGF0YSwKICAgICAgICAgICAgICAgICAgICBmb3JtTWV0aG9kOiB1bmRlZmluZWQsCiAgICAgICAgICAgICAgICAgICAgZm9ybUFjdGlvbjogdW5kZWZpbmVkLAogICAgICAgICAgICAgICAgICAgIGZvcm1FbmNUeXBlOiB1bmRlZmluZWQsCiAgICAgICAgICAgICAgICAgICAgZm9ybURhdGE6IHVuZGVmaW5lZCwKICAgICAgICAgICAgICAgICAgICAiIF9oYXNGZXRjaGVyRG9uZUFueXRoaW5nICI6IHRydWUKICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgICAgc3RhdGUuZmV0Y2hlcnMuc2V0KGtleSwgZG9uZUZldGNoZXIpOwogICAgICAgICAgICAgICAgfX0gY2F0Y2ggKGVycikge19pdGVyYXRvcjUuZShlcnIpO30gZmluYWxseSB7X2l0ZXJhdG9yNS5mKCk7fQogICAgICAgICAgICB9CgogICAgICAgICAgICBmdW5jdGlvbiBtYXJrRmV0Y2hSZWRpcmVjdHNEb25lKCkgewogICAgICAgICAgICAgIHZhciBkb25lS2V5cyA9IFtdO3ZhciBfaXRlcmF0b3I2ID0gX2NyZWF0ZUZvck9mSXRlcmF0b3JIZWxwZXIyKAoKICAgICAgICAgICAgICAgIGZldGNoUmVkaXJlY3RJZHMpLF9zdGVwNjt0cnkge2ZvciAoX2l0ZXJhdG9yNi5zKCk7ICEoX3N0ZXA2ID0gX2l0ZXJhdG9yNi5uKCkpLmRvbmU7KSB7dmFyIGtleSA9IF9zdGVwNi52YWx1ZTsKICAgICAgICAgICAgICAgICAgdmFyIGZldGNoZXIgPSBzdGF0ZS5mZXRjaGVycy5nZXQoa2V5KTsKICAgICAgICAgICAgICAgICAgcm91dGVyX2ludmFyaWFudChmZXRjaGVyLCAiRXhwZWN0ZWQgZmV0Y2hlcjogIiArIGtleSk7CgogICAgICAgICAgICAgICAgICBpZiAoZmV0Y2hlci5zdGF0ZSA9PT0gImxvYWRpbmciKSB7CiAgICAgICAgICAgICAgICAgICAgZmV0Y2hSZWRpcmVjdElkcy5kZWxldGUoa2V5KTsKICAgICAgICAgICAgICAgICAgICBkb25lS2V5cy5wdXNoKGtleSk7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH19IGNhdGNoIChlcnIpIHtfaXRlcmF0b3I2LmUoZXJyKTt9IGZpbmFsbHkge19pdGVyYXRvcjYuZigpO30KCiAgICAgICAgICAgICAgbWFya0ZldGNoZXJzRG9uZShkb25lS2V5cyk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGZ1bmN0aW9uIGFib3J0U3RhbGVGZXRjaExvYWRzKGxhbmRlZElkKSB7CiAgICAgICAgICAgICAgdmFyIHllZXRlZEtleXMgPSBbXTt2YXIgX2l0ZXJhdG9yNyA9IF9jcmVhdGVGb3JPZkl0ZXJhdG9ySGVscGVyMigKCiAgICAgICAgICAgICAgICBmZXRjaFJlbG9hZElkcyksX3N0ZXA3O3RyeSB7Zm9yIChfaXRlcmF0b3I3LnMoKTsgIShfc3RlcDcgPSBfaXRlcmF0b3I3Lm4oKSkuZG9uZTspIHt2YXIgX3N0ZXA3JHZhbHVlID0gX3NsaWNlZFRvQXJyYXkyKF9zdGVwNy52YWx1ZSwgMiksa2V5ID0gX3N0ZXA3JHZhbHVlWzBdLGlkID0gX3N0ZXA3JHZhbHVlWzFdOwogICAgICAgICAgICAgICAgICBpZiAoaWQgPCBsYW5kZWRJZCkgewogICAgICAgICAgICAgICAgICAgIHZhciBmZXRjaGVyID0gc3RhdGUuZmV0Y2hlcnMuZ2V0KGtleSk7CiAgICAgICAgICAgICAgICAgICAgcm91dGVyX2ludmFyaWFudChmZXRjaGVyLCAiRXhwZWN0ZWQgZmV0Y2hlcjogIiArIGtleSk7CgogICAgICAgICAgICAgICAgICAgIGlmIChmZXRjaGVyLnN0YXRlID09PSAibG9hZGluZyIpIHsKICAgICAgICAgICAgICAgICAgICAgIGFib3J0RmV0Y2hlcihrZXkpOwogICAgICAgICAgICAgICAgICAgICAgZmV0Y2hSZWxvYWRJZHMuZGVsZXRlKGtleSk7CiAgICAgICAgICAgICAgICAgICAgICB5ZWV0ZWRLZXlzLnB1c2goa2V5KTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH19IGNhdGNoIChlcnIpIHtfaXRlcmF0b3I3LmUoZXJyKTt9IGZpbmFsbHkge19pdGVyYXRvcjcuZigpO30KCiAgICAgICAgICAgICAgbWFya0ZldGNoZXJzRG9uZSh5ZWV0ZWRLZXlzKTsKICAgICAgICAgICAgICByZXR1cm4geWVldGVkS2V5cy5sZW5ndGggPiAwOwogICAgICAgICAgICB9CgogICAgICAgICAgICBmdW5jdGlvbiBnZXRCbG9ja2VyKGtleSwgZm4pIHsKICAgICAgICAgICAgICB2YXIgYmxvY2tlciA9IHN0YXRlLmJsb2NrZXJzLmdldChrZXkpIHx8IElETEVfQkxPQ0tFUjsKCiAgICAgICAgICAgICAgaWYgKGJsb2NrZXJGdW5jdGlvbnMuZ2V0KGtleSkgIT09IGZuKSB7CiAgICAgICAgICAgICAgICBibG9ja2VyRnVuY3Rpb25zLnNldChrZXksIGZuKTsKCiAgICAgICAgICAgICAgICBpZiAoYWN0aXZlQmxvY2tlciA9PSBudWxsKSB7CiAgICAgICAgICAgICAgICAgIC8vIFRoaXMgaXMgbm93IHRoZSBhY3RpdmUgYmxvY2tlcgogICAgICAgICAgICAgICAgICBhY3RpdmVCbG9ja2VyID0ga2V5OwogICAgICAgICAgICAgICAgfSBlbHNlIGlmIChrZXkgIT09IGFjdGl2ZUJsb2NrZXIpIHsKICAgICAgICAgICAgICAgICAgd2FybmluZyhmYWxzZSwgIkEgcm91dGVyIG9ubHkgc3VwcG9ydHMgb25lIGJsb2NrZXIgYXQgYSB0aW1lIik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICByZXR1cm4gYmxvY2tlcjsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgZnVuY3Rpb24gZGVsZXRlQmxvY2tlcihrZXkpIHsKICAgICAgICAgICAgICBzdGF0ZS5ibG9ja2Vycy5kZWxldGUoa2V5KTsKICAgICAgICAgICAgICBibG9ja2VyRnVuY3Rpb25zLmRlbGV0ZShrZXkpOwoKICAgICAgICAgICAgICBpZiAoYWN0aXZlQmxvY2tlciA9PT0ga2V5KSB7CiAgICAgICAgICAgICAgICBhY3RpdmVCbG9ja2VyID0gbnVsbDsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gLy8gVXRpbGl0eSBmdW5jdGlvbiB0byB1cGRhdGUgYmxvY2tlcnMsIGVuc3VyaW5nIHZhbGlkIHN0YXRlIHRyYW5zaXRpb25zCgoKICAgICAgICAgICAgZnVuY3Rpb24gdXBkYXRlQmxvY2tlcihrZXksIG5ld0Jsb2NrZXIpIHsKICAgICAgICAgICAgICB2YXIgYmxvY2tlciA9IHN0YXRlLmJsb2NrZXJzLmdldChrZXkpIHx8IElETEVfQkxPQ0tFUjsgLy8gUG9vciBtYW5zIHN0YXRlIG1hY2hpbmUgOikKICAgICAgICAgICAgICAvLyBodHRwczovL21lcm1haWQubGl2ZS9lZGl0I3Bha286ZU5xVmtjOU93ekFNeGw4bDhubmpBWXJFdERJT0hFQklnd3ZLSlRSZUd5M19sRHBJcU8yN2s2YXdNRzBYY3JMbG56ODdud2RvbkVTb2dLWFhCdUU3OXJxNzVYWk8zLXlIZHMwUkpWdXY3MFlyUGxVckNFZTJIZnJPUlMzcnVicVpmdWh0cGc1Qzl3azV0WjRWS2NSVXE4OHE5WjhSUzAtNDhjRTFpSEprTDB1Z2JIdUZMdXM5TDZzcFp5OG5YOU1QMkNOZG9tVmFwb3NxdTNmR2F5VDhUOC1qSlF3aGVwb19VdHBnQlFhREVVb20wNGRaaEFOMWFKQkRsVUtKQnhFMWNlQjJTbWowTWxuLUlCVzVBRlUyZHdVaWt0dF8yUWFxMmRCZmFLZEV1cDg1VVY3WWQtZEtqbG5rYWJsMlB2cjBEVGtUcmVNCgogICAgICAgICAgICAgIHJvdXRlcl9pbnZhcmlhbnQoYmxvY2tlci5zdGF0ZSA9PT0gInVuYmxvY2tlZCIgJiYgbmV3QmxvY2tlci5zdGF0ZSA9PT0gImJsb2NrZWQiIHx8IGJsb2NrZXIuc3RhdGUgPT09ICJibG9ja2VkIiAmJiBuZXdCbG9ja2VyLnN0YXRlID09PSAiYmxvY2tlZCIgfHwgYmxvY2tlci5zdGF0ZSA9PT0gImJsb2NrZWQiICYmIG5ld0Jsb2NrZXIuc3RhdGUgPT09ICJwcm9jZWVkaW5nIiB8fCBibG9ja2VyLnN0YXRlID09PSAiYmxvY2tlZCIgJiYgbmV3QmxvY2tlci5zdGF0ZSA9PT0gInVuYmxvY2tlZCIgfHwgYmxvY2tlci5zdGF0ZSA9PT0gInByb2NlZWRpbmciICYmIG5ld0Jsb2NrZXIuc3RhdGUgPT09ICJ1bmJsb2NrZWQiLCAiSW52YWxpZCBibG9ja2VyIHN0YXRlIHRyYW5zaXRpb246ICIgKyBibG9ja2VyLnN0YXRlICsgIiAtPiAiICsgbmV3QmxvY2tlci5zdGF0ZSk7CiAgICAgICAgICAgICAgc3RhdGUuYmxvY2tlcnMuc2V0KGtleSwgbmV3QmxvY2tlcik7CiAgICAgICAgICAgICAgdXBkYXRlU3RhdGUoewogICAgICAgICAgICAgICAgYmxvY2tlcnM6IG5ldyBNYXAoc3RhdGUuYmxvY2tlcnMpCiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGZ1bmN0aW9uIHNob3VsZEJsb2NrTmF2aWdhdGlvbihfcmVmMTApIHsKICAgICAgICAgICAgICB2YXIKICAgICAgICAgICAgICAgIGN1cnJlbnRMb2NhdGlvbiA9CgoKICAgICAgICAgICAgICAgIF9yZWYxMC5jdXJyZW50TG9jYXRpb24sbmV4dExvY2F0aW9uID0gX3JlZjEwLm5leHRMb2NhdGlvbixoaXN0b3J5QWN0aW9uID0gX3JlZjEwLmhpc3RvcnlBY3Rpb247CgogICAgICAgICAgICAgIGlmIChhY3RpdmVCbG9ja2VyID09IG51bGwpIHsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICB9IC8vIFdlIG9ubHkgYWxsb3cgYSBzaW5nbGUgYmxvY2tlciBhdCB0aGUgbW9tZW50LiAgVGhpcyB3aWxsIG5lZWQgdG8gYmUKICAgICAgICAgICAgICAvLyB1cGRhdGVkIGlmIHdlIGVuaGFuY2UgdG8gc3VwcG9ydCBtdWx0aXBsZSBibG9ja2VycyBpbiB0aGUgZnV0dXJlCgoKICAgICAgICAgICAgICB2YXIgYmxvY2tlckZ1bmN0aW9uID0gYmxvY2tlckZ1bmN0aW9ucy5nZXQoYWN0aXZlQmxvY2tlcik7CiAgICAgICAgICAgICAgcm91dGVyX2ludmFyaWFudChibG9ja2VyRnVuY3Rpb24sICJDb3VsZCBub3QgZmluZCBhIGZ1bmN0aW9uIGZvciB0aGUgYWN0aXZlIGJsb2NrZXIiKTsKICAgICAgICAgICAgICB2YXIgYmxvY2tlciA9IHN0YXRlLmJsb2NrZXJzLmdldChhY3RpdmVCbG9ja2VyKTsKCiAgICAgICAgICAgICAgaWYgKGJsb2NrZXIgJiYgYmxvY2tlci5zdGF0ZSA9PT0gInByb2NlZWRpbmciKSB7CiAgICAgICAgICAgICAgICAvLyBJZiB0aGUgYmxvY2tlciBpcyBjdXJyZW50bHkgcHJvY2VlZGluZywgd2UgZG9uJ3QgbmVlZCB0byByZS1jaGVjawogICAgICAgICAgICAgICAgLy8gaXQgYW5kIGNhbiBsZXQgdGhpcyBuYXZpZ2F0aW9uIGNvbnRpbnVlCiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgfSAvLyBBdCB0aGlzIHBvaW50LCB3ZSBrbm93IHdlJ3JlIHVuYmxvY2tlZC9ibG9ja2VkIHNvIHdlIG5lZWQgdG8gY2hlY2sgdGhlCiAgICAgICAgICAgICAgLy8gdXNlci1wcm92aWRlZCBibG9ja2VyIGZ1bmN0aW9uCgoKICAgICAgICAgICAgICBpZiAoYmxvY2tlckZ1bmN0aW9uKHsKICAgICAgICAgICAgICAgIGN1cnJlbnRMb2NhdGlvbjogY3VycmVudExvY2F0aW9uLAogICAgICAgICAgICAgICAgbmV4dExvY2F0aW9uOiBuZXh0TG9jYXRpb24sCiAgICAgICAgICAgICAgICBoaXN0b3J5QWN0aW9uOiBoaXN0b3J5QWN0aW9uCiAgICAgICAgICAgICAgfSkpIHsKICAgICAgICAgICAgICAgIHJldHVybiBhY3RpdmVCbG9ja2VyOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgZnVuY3Rpb24gY2FuY2VsQWN0aXZlRGVmZXJyZWRzKHByZWRpY2F0ZSkgewogICAgICAgICAgICAgIHZhciBjYW5jZWxsZWRSb3V0ZUlkcyA9IFtdOwogICAgICAgICAgICAgIGFjdGl2ZURlZmVycmVkcy5mb3JFYWNoKChkZmQsIHJvdXRlSWQpID0+IHsKICAgICAgICAgICAgICAgIGlmICghcHJlZGljYXRlIHx8IHByZWRpY2F0ZShyb3V0ZUlkKSkgewogICAgICAgICAgICAgICAgICAvLyBDYW5jZWwgdGhlIGRlZmVycmVkIC0gYnV0IGRvIG5vdCByZW1vdmUgZnJvbSBhY3RpdmVEZWZlcnJlZHMgaGVyZSAtCiAgICAgICAgICAgICAgICAgIC8vIHdlIHJlbHkgb24gdGhlIHN1YnNjcmliZXJzIHRvIGRvIHRoYXQgc28gb3VyIHRlc3RzIGNhbiBhc3NlcnQgcHJvcGVyCiAgICAgICAgICAgICAgICAgIC8vIGNsZWFudXAgdmlhIF9pbnRlcm5hbEFjdGl2ZURlZmVycmVkcwogICAgICAgICAgICAgICAgICBkZmQuY2FuY2VsKCk7CiAgICAgICAgICAgICAgICAgIGNhbmNlbGxlZFJvdXRlSWRzLnB1c2gocm91dGVJZCk7CiAgICAgICAgICAgICAgICAgIGFjdGl2ZURlZmVycmVkcy5kZWxldGUocm91dGVJZCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgcmV0dXJuIGNhbmNlbGxlZFJvdXRlSWRzOwogICAgICAgICAgICB9IC8vIE9wdCBpbiB0byBjYXB0dXJpbmcgYW5kIHJlcG9ydGluZyBzY3JvbGwgcG9zaXRpb25zIGR1cmluZyBuYXZpZ2F0aW9ucywKICAgICAgICAgICAgLy8gdXNlZCBieSB0aGUgPFNjcm9sbFJlc3RvcmF0aW9uPiBjb21wb25lbnQKCgogICAgICAgICAgICBmdW5jdGlvbiBlbmFibGVTY3JvbGxSZXN0b3JhdGlvbihwb3NpdGlvbnMsIGdldFBvc2l0aW9uLCBnZXRLZXkpIHsKICAgICAgICAgICAgICBzYXZlZFNjcm9sbFBvc2l0aW9ucyA9IHBvc2l0aW9uczsKICAgICAgICAgICAgICBnZXRTY3JvbGxQb3NpdGlvbiA9IGdldFBvc2l0aW9uOwoKICAgICAgICAgICAgICBnZXRTY3JvbGxSZXN0b3JhdGlvbktleSA9IGdldEtleSB8fCAoKGxvY2F0aW9uKSA9PiBsb2NhdGlvbi5rZXkpOyAvLyBQZXJmb3JtIGluaXRpYWwgaHlkcmF0aW9uIHNjcm9sbCByZXN0b3JhdGlvbiwgc2luY2Ugd2UgbWlzcyB0aGUgYm9hdCBvbgogICAgICAgICAgICAgIC8vIHRoZSBpbml0aWFsIHVwZGF0ZVN0YXRlKCkgYmVjYXVzZSB3ZSd2ZSBub3QgeWV0IHJlbmRlcmVkIDxTY3JvbGxSZXN0b3JhdGlvbi8+CiAgICAgICAgICAgICAgLy8gYW5kIHRoZXJlZm9yZSBoYXZlIG5vIHNhdmVkU2Nyb2xsUG9zaXRpb25zIGF2YWlsYWJsZQoKCiAgICAgICAgICAgICAgaWYgKCFpbml0aWFsU2Nyb2xsUmVzdG9yZWQgJiYgc3RhdGUubmF2aWdhdGlvbiA9PT0gSURMRV9OQVZJR0FUSU9OKSB7CiAgICAgICAgICAgICAgICBpbml0aWFsU2Nyb2xsUmVzdG9yZWQgPSB0cnVlOwogICAgICAgICAgICAgICAgdmFyIHkgPSBnZXRTYXZlZFNjcm9sbFBvc2l0aW9uKHN0YXRlLmxvY2F0aW9uLCBzdGF0ZS5tYXRjaGVzKTsKCiAgICAgICAgICAgICAgICBpZiAoeSAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICAgIHVwZGF0ZVN0YXRlKHsKICAgICAgICAgICAgICAgICAgICByZXN0b3JlU2Nyb2xsUG9zaXRpb246IHkKICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICByZXR1cm4gKCkgPT4gewogICAgICAgICAgICAgICAgc2F2ZWRTY3JvbGxQb3NpdGlvbnMgPSBudWxsOwogICAgICAgICAgICAgICAgZ2V0U2Nyb2xsUG9zaXRpb24gPSBudWxsOwogICAgICAgICAgICAgICAgZ2V0U2Nyb2xsUmVzdG9yYXRpb25LZXkgPSBudWxsOwogICAgICAgICAgICAgIH07CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGZ1bmN0aW9uIHNhdmVTY3JvbGxQb3NpdGlvbihsb2NhdGlvbiwgbWF0Y2hlcykgewogICAgICAgICAgICAgIGlmIChzYXZlZFNjcm9sbFBvc2l0aW9ucyAmJiBnZXRTY3JvbGxSZXN0b3JhdGlvbktleSAmJiBnZXRTY3JvbGxQb3NpdGlvbikgewogICAgICAgICAgICAgICAgdmFyIHVzZXJNYXRjaGVzID0gbWF0Y2hlcy5tYXAoKG0pID0+IGNyZWF0ZVVzZU1hdGNoZXNNYXRjaChtLCBzdGF0ZS5sb2FkZXJEYXRhKSk7CiAgICAgICAgICAgICAgICB2YXIga2V5ID0gZ2V0U2Nyb2xsUmVzdG9yYXRpb25LZXkobG9jYXRpb24sIHVzZXJNYXRjaGVzKSB8fCBsb2NhdGlvbi5rZXk7CiAgICAgICAgICAgICAgICBzYXZlZFNjcm9sbFBvc2l0aW9uc1trZXldID0gZ2V0U2Nyb2xsUG9zaXRpb24oKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGZ1bmN0aW9uIGdldFNhdmVkU2Nyb2xsUG9zaXRpb24obG9jYXRpb24sIG1hdGNoZXMpIHsKICAgICAgICAgICAgICBpZiAoc2F2ZWRTY3JvbGxQb3NpdGlvbnMgJiYgZ2V0U2Nyb2xsUmVzdG9yYXRpb25LZXkgJiYgZ2V0U2Nyb2xsUG9zaXRpb24pIHsKICAgICAgICAgICAgICAgIHZhciB1c2VyTWF0Y2hlcyA9IG1hdGNoZXMubWFwKChtKSA9PiBjcmVhdGVVc2VNYXRjaGVzTWF0Y2gobSwgc3RhdGUubG9hZGVyRGF0YSkpOwogICAgICAgICAgICAgICAgdmFyIGtleSA9IGdldFNjcm9sbFJlc3RvcmF0aW9uS2V5KGxvY2F0aW9uLCB1c2VyTWF0Y2hlcykgfHwgbG9jYXRpb24ua2V5OwogICAgICAgICAgICAgICAgdmFyIHkgPSBzYXZlZFNjcm9sbFBvc2l0aW9uc1trZXldOwoKICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgeSA9PT0gIm51bWJlciIpIHsKICAgICAgICAgICAgICAgICAgcmV0dXJuIHk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcm91dGVyID0gewogICAgICAgICAgICAgIGdldCBiYXNlbmFtZSgpIHsKICAgICAgICAgICAgICAgIHJldHVybiBpbml0LmJhc2VuYW1lOwogICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgIGdldCBzdGF0ZSgpIHsKICAgICAgICAgICAgICAgIHJldHVybiBzdGF0ZTsKICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICBnZXQgcm91dGVzKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIGRhdGFSb3V0ZXM7CiAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgaW5pdGlhbGl6ZTogaW5pdGlhbGl6ZSwKICAgICAgICAgICAgICBzdWJzY3JpYmU6IHN1YnNjcmliZSwKICAgICAgICAgICAgICBlbmFibGVTY3JvbGxSZXN0b3JhdGlvbjogZW5hYmxlU2Nyb2xsUmVzdG9yYXRpb24sCiAgICAgICAgICAgICAgbmF2aWdhdGU6IG5hdmlnYXRlLAogICAgICAgICAgICAgIGZldGNoOiBmZXRjaCwKICAgICAgICAgICAgICByZXZhbGlkYXRlOiByZXZhbGlkYXRlLAogICAgICAgICAgICAgIC8vIFBhc3N0aHJvdWdoIHRvIGhpc3RvcnktYXdhcmUgY3JlYXRlSHJlZiB1c2VkIGJ5IHVzZUhyZWYgc28gd2UgZ2V0IHByb3BlcgogICAgICAgICAgICAgIC8vIGhhc2gtYXdhcmUgVVJMcyBpbiBET00gcGF0aHMKICAgICAgICAgICAgICBjcmVhdGVIcmVmOiAodG8pID0+IGluaXQuaGlzdG9yeS5jcmVhdGVIcmVmKHRvKSwKICAgICAgICAgICAgICBlbmNvZGVMb2NhdGlvbjogKHRvKSA9PiBpbml0Lmhpc3RvcnkuZW5jb2RlTG9jYXRpb24odG8pLAogICAgICAgICAgICAgIGdldEZldGNoZXI6IGdldEZldGNoZXIsCiAgICAgICAgICAgICAgZGVsZXRlRmV0Y2hlcjogZGVsZXRlRmV0Y2hlciwKICAgICAgICAgICAgICBkaXNwb3NlOiBkaXNwb3NlLAogICAgICAgICAgICAgIGdldEJsb2NrZXI6IGdldEJsb2NrZXIsCiAgICAgICAgICAgICAgZGVsZXRlQmxvY2tlcjogZGVsZXRlQmxvY2tlciwKICAgICAgICAgICAgICBfaW50ZXJuYWxGZXRjaENvbnRyb2xsZXJzOiBmZXRjaENvbnRyb2xsZXJzLAogICAgICAgICAgICAgIF9pbnRlcm5hbEFjdGl2ZURlZmVycmVkczogYWN0aXZlRGVmZXJyZWRzCiAgICAgICAgICAgIH07CiAgICAgICAgICAgIHJldHVybiByb3V0ZXI7CiAgICAgICAgICB9IC8vI2VuZHJlZ2lvbgogICAgICAgICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KICAgICAgICAgIC8vI3JlZ2lvbiBjcmVhdGVTdGF0aWNIYW5kbGVyCiAgICAgICAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwoKICAgICAgICAgIHZhciBVTlNBRkVfREVGRVJSRURfU1lNQk9MID0gU3ltYm9sKCJkZWZlcnJlZCIpOwogICAgICAgICAgZnVuY3Rpb24gY3JlYXRlU3RhdGljSGFuZGxlcihyb3V0ZXMsIG9wdHMpIHsKICAgICAgICAgICAgcm91dGVyX2ludmFyaWFudChyb3V0ZXMubGVuZ3RoID4gMCwgIllvdSBtdXN0IHByb3ZpZGUgYSBub24tZW1wdHkgcm91dGVzIGFycmF5IHRvIGNyZWF0ZVN0YXRpY0hhbmRsZXIiKTsKICAgICAgICAgICAgdmFyIGRhdGFSb3V0ZXMgPSBjb252ZXJ0Um91dGVzVG9EYXRhUm91dGVzKHJvdXRlcyk7CiAgICAgICAgICAgIHZhciBiYXNlbmFtZSA9IChvcHRzID8gb3B0cy5iYXNlbmFtZSA6IG51bGwpIHx8ICIvIjsKICAgICAgICAgICAgLyoqCiAgICAgICAgICAgICAqIFRoZSBxdWVyeSgpIG1ldGhvZCBpcyBpbnRlbmRlZCBmb3IgZG9jdW1lbnQgcmVxdWVzdHMsIGluIHdoaWNoIHdlIHdhbnQgdG8KICAgICAgICAgICAgICogY2FsbCBhbiBvcHRpb25hbCBhY3Rpb24gYW5kIHBvdGVudGlhbGx5IG11bHRpcGxlIGxvYWRlcnMgZm9yIGFsbCBuZXN0ZWQKICAgICAgICAgICAgICogcm91dGVzLiAgSXQgcmV0dXJucyBhIFN0YXRpY0hhbmRsZXJDb250ZXh0IG9iamVjdCwgd2hpY2ggaXMgdmVyeSBzaW1pbGFyCiAgICAgICAgICAgICAqIHRvIHRoZSByb3V0ZXIgc3RhdGUgKGxvY2F0aW9uLCBsb2FkZXJEYXRhLCBhY3Rpb25EYXRhLCBlcnJvcnMsIGV0Yy4pIGFuZAogICAgICAgICAgICAgKiBhbHNvIGFkZHMgU1NSLXNwZWNpZmljIGluZm9ybWF0aW9uIHN1Y2ggYXMgdGhlIHN0YXR1c0NvZGUgYW5kIGhlYWRlcnMKICAgICAgICAgICAgICogZnJvbSBhY3Rpb24vbG9hZGVycyBSZXNwb25zZXMuCiAgICAgICAgICAgICAqCiAgICAgICAgICAgICAqIEl0IF9zaG91bGRfIG5ldmVyIHRocm93IGFuZCBzaG91bGQgcmVwb3J0IGFsbCBlcnJvcnMgdGhyb3VnaCB0aGUKICAgICAgICAgICAgICogcmV0dXJuZWQgY29udGV4dC5lcnJvcnMgb2JqZWN0LCBwcm9wZXJseSBhc3NvY2lhdGluZyBlcnJvcnMgdG8gdGhlaXIgZXJyb3IKICAgICAgICAgICAgICogYm91bmRhcnkuICBBZGRpdGlvbmFsbHksIGl0IHRyYWNrcyBfZGVlcGVzdFJlbmRlcmVkQm91bmRhcnlJZCB3aGljaCBjYW4gYmUKICAgICAgICAgICAgICogdXNlZCB0byBlbXVsYXRlIFJlYWN0IGVycm9yIGJvdW5kYXJpZXMgZHVyaW5nIFNTciBieSBwZXJmb3JtaW5nIGEgc2Vjb25kCiAgICAgICAgICAgICAqIHBhc3Mgb25seSBkb3duIHRvIHRoZSBib3VuZGFyeUlkLgogICAgICAgICAgICAgKgogICAgICAgICAgICAgKiBUaGUgb25lIGV4Y2VwdGlvbiB3aGVyZSB3ZSBkbyBub3QgcmV0dXJuIGEgU3RhdGljSGFuZGxlckNvbnRleHQgaXMgd2hlbiBhCiAgICAgICAgICAgICAqIHJlZGlyZWN0IHJlc3BvbnNlIGlzIHJldHVybmVkIG9yIHRocm93biBmcm9tIGFueSBhY3Rpb24vbG9hZGVyLiAgV2UKICAgICAgICAgICAgICogcHJvcGFnYXRlIHRoYXQgb3V0IGFuZCByZXR1cm4gdGhlIHJhdyBSZXNwb25zZSBzbyB0aGUgSFRUUCBzZXJ2ZXIgY2FuCiAgICAgICAgICAgICAqIHJldHVybiBpdCBkaXJlY3RseS4KICAgICAgICAgICAgICovZnVuY3Rpb24KCiAgICAgICAgICAgIHF1ZXJ5KF94NDIsIF94NDMpIHtyZXR1cm4gX3F1ZXJ5LmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7fQoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCiAgICAgICAgICAgIC8qKgogICAgICAgICAgICAgKiBUaGUgcXVlcnlSb3V0ZSgpIG1ldGhvZCBpcyBpbnRlbmRlZCBmb3IgdGFyZ2V0ZWQgcm91dGUgcmVxdWVzdHMsIGVpdGhlcgogICAgICAgICAgICAgKiBmb3IgZmV0Y2ggP19kYXRhIHJlcXVlc3RzIG9yIHJlc291cmNlIHJvdXRlIHJlcXVlc3RzLiAgSW4gdGhpcyBjYXNlLCB3ZQogICAgICAgICAgICAgKiBhcmUgb25seSBldmVyIGNhbGxpbmcgYSBzaW5nbGUgYWN0aW9uIG9yIGxvYWRlciwgYW5kIHdlIGFyZSByZXR1cm5pbmcgdGhlCiAgICAgICAgICAgICAqIHJldHVybmVkIHZhbHVlIGRpcmVjdGx5LiAgSW4gbW9zdCBjYXNlcywgdGhpcyB3aWxsIGJlIGEgUmVzcG9uc2UgcmV0dXJuZWQKICAgICAgICAgICAgICogZnJvbSB0aGUgYWN0aW9uL2xvYWRlciwgYnV0IGl0IG1heSBiZSBhIHByaW1pdGl2ZSBvciBvdGhlciB2YWx1ZSBhcyB3ZWxsIC0KICAgICAgICAgICAgICogYW5kIGluIHN1Y2ggY2FzZXMgdGhlIGNhbGxpbmcgY29udGV4dCBzaG91bGQgaGFuZGxlIHRoYXQgYWNjb3JkaW5nbHkuCiAgICAgICAgICAgICAqCiAgICAgICAgICAgICAqIFdlIGRvIHJlc3BlY3QgdGhlIHRocm93L3JldHVybiBkaWZmZXJlbnRpYXRpb24sIHNvIGlmIGFuIGFjdGlvbi9sb2FkZXIKICAgICAgICAgICAgICogdGhyb3dzLCB0aGVuIHRoaXMgbWV0aG9kIHdpbGwgdGhyb3cgdGhlIHZhbHVlLiAgVGhpcyBpcyBpbXBvcnRhbnQgc28gd2UKICAgICAgICAgICAgICogY2FuIGRvIHByb3BlciBib3VuZGFyeSBpZGVudGlmaWNhdGlvbiBpbiBSZW1peCB3aGVyZSBhIHRocm93biBSZXNwb25zZQogICAgICAgICAgICAgKiBtdXN0IGdvIHRvIHRoZSBDYXRjaCBCb3VuZGFyeSBidXQgYSByZXR1cm5lZCBSZXNwb25zZSBpcyBoYXBweS1wYXRoLgogICAgICAgICAgICAgKgogICAgICAgICAgICAgKiBPbmUgdGhpbmcgdG8gbm90ZSBpcyB0aGF0IGFueSBSb3V0ZXItaW5pdGlhdGVkIEVycm9ycyB0aGF0IG1ha2Ugc2Vuc2UKICAgICAgICAgICAgICogdG8gYXNzb2NpYXRlIHdpdGggYSBzdGF0dXMgY29kZSB3aWxsIGJlIHRocm93biBhcyBhbiBFcnJvclJlc3BvbnNlCiAgICAgICAgICAgICAqIGluc3RhbmNlIHdoaWNoIGluY2x1ZGUgdGhlIHJhdyBFcnJvciwgc3VjaCB0aGF0IHRoZSBjYWxsaW5nIGNvbnRleHQgY2FuCiAgICAgICAgICAgICAqIHNlcmlhbGl6ZSB0aGUgZXJyb3IgYXMgdGhleSBzZWUgZml0IHdoaWxlIGluY2x1ZGluZyB0aGUgcHJvcGVyIHJlc3BvbnNlCiAgICAgICAgICAgICAqIGNvZGUuICBFeGFtcGxlcyBoZXJlIGFyZSA0MDQgYW5kIDQwNSBlcnJvcnMgdGhhdCBvY2N1ciBwcmlvciB0byByZWFjaGluZwogICAgICAgICAgICAgKiBhbnkgdXNlci1kZWZpbmVkIGxvYWRlcnMuCiAgICAgICAgICAgICAqL2Z1bmN0aW9uIF9xdWVyeSgpIHtfcXVlcnkgPSBfYXN5bmNUb0dlbmVyYXRvcjIoIC8qI19fUFVSRV9fKi9fcmVnZW5lcmF0b3JSdW50aW1lMigpLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTExKHJlcXVlc3QsIF90ZW1wMikge3ZhciBfcmVmMjQsIHJlcXVlc3RDb250ZXh0LCB1cmwsIG1ldGhvZCwgbG9jYXRpb24sIG1hdGNoZXMsIGVycm9yLCBfZ2V0U2hvcnRDaXJjdWl0TWF0Y2gzLCBtZXRob2ROb3RBbGxvd2VkTWF0Y2hlcywgcm91dGUsIF9lcnJvcjMsIF9nZXRTaG9ydENpcmN1aXRNYXRjaDQsIG5vdEZvdW5kTWF0Y2hlcywgX3JvdXRlMiwgcmVzdWx0O3JldHVybiBfcmVnZW5lcmF0b3JSdW50aW1lMigpLndyYXAoZnVuY3Rpb24gX2NhbGxlZTExJChfY29udGV4dDExKSB7d2hpbGUgKDEpIHN3aXRjaCAoX2NvbnRleHQxMS5wcmV2ID0gX2NvbnRleHQxMS5uZXh0KSB7Y2FzZSAwOl9yZWYyNCA9IF90ZW1wMiA9PT0gdm9pZCAwID8ge30gOiBfdGVtcDIsIHJlcXVlc3RDb250ZXh0ID0gX3JlZjI0LnJlcXVlc3RDb250ZXh0O3VybCA9IG5ldyBVUkwocmVxdWVzdC51cmwpO21ldGhvZCA9IHJlcXVlc3QubWV0aG9kLnRvTG93ZXJDYXNlKCk7bG9jYXRpb24gPSBjcmVhdGVMb2NhdGlvbigiIiwgcm91dGVyX2NyZWF0ZVBhdGgodXJsKSwgbnVsbCwgImRlZmF1bHQiKTttYXRjaGVzID0gbWF0Y2hSb3V0ZXMoZGF0YVJvdXRlcywgbG9jYXRpb24sIGJhc2VuYW1lKTsgLy8gU1NSIHN1cHBvcnRzIEhFQUQgcmVxdWVzdHMgd2hpbGUgU1BBIGRvZXNuJ3QKICAgICAgICAgICAgICAgICAgICAgIGlmICghKCFpc1ZhbGlkTWV0aG9kKG1ldGhvZCkgJiYgbWV0aG9kICE9PSAiaGVhZCIpKSB7X2NvbnRleHQxMS5uZXh0ID0gMTE7YnJlYWs7fWVycm9yID0gZ2V0SW50ZXJuYWxSb3V0ZXJFcnJvcig0MDUsIHsgbWV0aG9kOiBtZXRob2QgfSk7X2dldFNob3J0Q2lyY3VpdE1hdGNoMyA9IGdldFNob3J0Q2lyY3VpdE1hdGNoZXMoZGF0YVJvdXRlcyksIG1ldGhvZE5vdEFsbG93ZWRNYXRjaGVzID0gX2dldFNob3J0Q2lyY3VpdE1hdGNoMy5tYXRjaGVzLCByb3V0ZSA9IF9nZXRTaG9ydENpcmN1aXRNYXRjaDMucm91dGU7cmV0dXJuIF9jb250ZXh0MTEuYWJydXB0KCJyZXR1cm4iLCB7IGJhc2VuYW1lOiBiYXNlbmFtZSwgbG9jYXRpb246IGxvY2F0aW9uLCBtYXRjaGVzOiBtZXRob2ROb3RBbGxvd2VkTWF0Y2hlcywgbG9hZGVyRGF0YToge30sIGFjdGlvbkRhdGE6IG51bGwsIGVycm9yczogX2RlZmluZVByb3BlcnR5Mih7fSwgcm91dGUuaWQsIGVycm9yKSwgc3RhdHVzQ29kZTogZXJyb3Iuc3RhdHVzLCBsb2FkZXJIZWFkZXJzOiB7fSwgYWN0aW9uSGVhZGVyczoge30sIGFjdGl2ZURlZmVycmVkczogbnVsbCB9KTtjYXNlIDExOmlmIChtYXRjaGVzKSB7X2NvbnRleHQxMS5uZXh0ID0gMTU7YnJlYWs7fV9lcnJvcjMgPSBnZXRJbnRlcm5hbFJvdXRlckVycm9yKDQwNCwgeyBwYXRobmFtZTogbG9jYXRpb24ucGF0aG5hbWUgfSk7X2dldFNob3J0Q2lyY3VpdE1hdGNoNCA9IGdldFNob3J0Q2lyY3VpdE1hdGNoZXMoZGF0YVJvdXRlcyksIG5vdEZvdW5kTWF0Y2hlcyA9IF9nZXRTaG9ydENpcmN1aXRNYXRjaDQubWF0Y2hlcywgX3JvdXRlMiA9IF9nZXRTaG9ydENpcmN1aXRNYXRjaDQucm91dGU7cmV0dXJuIF9jb250ZXh0MTEuYWJydXB0KCJyZXR1cm4iLCB7IGJhc2VuYW1lOiBiYXNlbmFtZSwgbG9jYXRpb246IGxvY2F0aW9uLCBtYXRjaGVzOiBub3RGb3VuZE1hdGNoZXMsIGxvYWRlckRhdGE6IHt9LCBhY3Rpb25EYXRhOiBudWxsLCBlcnJvcnM6IF9kZWZpbmVQcm9wZXJ0eTIoe30sIF9yb3V0ZTIuaWQsIF9lcnJvcjMpLCBzdGF0dXNDb2RlOiBfZXJyb3IzLnN0YXR1cywgbG9hZGVySGVhZGVyczoge30sIGFjdGlvbkhlYWRlcnM6IHt9LCBhY3RpdmVEZWZlcnJlZHM6IG51bGwgfSk7Y2FzZSAxNTpfY29udGV4dDExLm5leHQgPSAxNztyZXR1cm4gcXVlcnlJbXBsKHJlcXVlc3QsIGxvY2F0aW9uLCBtYXRjaGVzLCByZXF1ZXN0Q29udGV4dCk7Y2FzZSAxNzpyZXN1bHQgPSBfY29udGV4dDExLnNlbnQ7aWYgKCFpc1Jlc3BvbnNlKHJlc3VsdCkpIHtfY29udGV4dDExLm5leHQgPSAyMDticmVhazt9cmV0dXJuIF9jb250ZXh0MTEuYWJydXB0KCJyZXR1cm4iLCByZXN1bHQpO2Nhc2UgMjA6cmV0dXJuIF9jb250ZXh0MTEuYWJydXB0KCJyZXR1cm4iLCBfZXh0ZW5kcyh7IGxvY2F0aW9uOiBsb2NhdGlvbiwgYmFzZW5hbWU6IGJhc2VuYW1lIH0sIHJlc3VsdCkpO2Nhc2UgMjE6Y2FzZSAiZW5kIjpyZXR1cm4gX2NvbnRleHQxMS5zdG9wKCk7fX0sIF9jYWxsZWUxMSk7fSkpO3JldHVybiBfcXVlcnkuYXBwbHkodGhpcywgYXJndW1lbnRzKTt9ZnVuY3Rpb24KCiAgICAgICAgICAgIHF1ZXJ5Um91dGUoX3g0NCwgX3g0NSkge3JldHVybiBfcXVlcnlSb3V0ZS5hcHBseSh0aGlzLCBhcmd1bWVudHMpO31mdW5jdGlvbiBfcXVlcnlSb3V0ZSgpIHtfcXVlcnlSb3V0ZSA9IF9hc3luY1RvR2VuZXJhdG9yMiggLyojX19QVVJFX18qL19yZWdlbmVyYXRvclJ1bnRpbWUyKCkubWFyayhmdW5jdGlvbiBfY2FsbGVlMTIocmVxdWVzdCwgX3RlbXAzKSB7dmFyIF9yZWYyNSwgcm91dGVJZCwgcmVxdWVzdENvbnRleHQsIHVybCwgbWV0aG9kLCBsb2NhdGlvbiwgbWF0Y2hlcywgbWF0Y2gsIHJlc3VsdCwgZXJyb3IsIF9yZXN1bHQkYWN0aXZlRGVmZXJyZSwgZGF0YTtyZXR1cm4gX3JlZ2VuZXJhdG9yUnVudGltZTIoKS53cmFwKGZ1bmN0aW9uIF9jYWxsZWUxMiQoX2NvbnRleHQxMikge3doaWxlICgxKSBzd2l0Y2ggKF9jb250ZXh0MTIucHJldiA9IF9jb250ZXh0MTIubmV4dCkge2Nhc2UgMDpfcmVmMjUgPQoKCgogICAgICAgICAgICAgICAgICAgICAgX3RlbXAzID09PSB2b2lkIDAgPyB7fSA6IF90ZW1wMywgcm91dGVJZCA9IF9yZWYyNS5yb3V0ZUlkLCByZXF1ZXN0Q29udGV4dCA9IF9yZWYyNS5yZXF1ZXN0Q29udGV4dDsKICAgICAgICAgICAgICAgICAgICAgIHVybCA9IG5ldyBVUkwocmVxdWVzdC51cmwpOwogICAgICAgICAgICAgICAgICAgICAgbWV0aG9kID0gcmVxdWVzdC5tZXRob2QudG9Mb3dlckNhc2UoKTsKICAgICAgICAgICAgICAgICAgICAgIGxvY2F0aW9uID0gY3JlYXRlTG9jYXRpb24oIiIsIHJvdXRlcl9jcmVhdGVQYXRoKHVybCksIG51bGwsICJkZWZhdWx0Iik7CiAgICAgICAgICAgICAgICAgICAgICBtYXRjaGVzID0gbWF0Y2hSb3V0ZXMoZGF0YVJvdXRlcywgbG9jYXRpb24sIGJhc2VuYW1lKTsgLy8gU1NSIHN1cHBvcnRzIEhFQUQgcmVxdWVzdHMgd2hpbGUgU1BBIGRvZXNuJ3QKICAgICAgICAgICAgICAgICAgICAgIGlmICghKAogICAgICAgICAgICAgICAgICAgICAgIWlzVmFsaWRNZXRob2QobWV0aG9kKSAmJiBtZXRob2QgIT09ICJoZWFkIiAmJiBtZXRob2QgIT09ICJvcHRpb25zIikpIHtfY29udGV4dDEyLm5leHQgPSA5O2JyZWFrO310aHJvdyAoCiAgICAgICAgICAgICAgICAgICAgICAgIGdldEludGVybmFsUm91dGVyRXJyb3IoNDA1LCB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgbWV0aG9kOiBtZXRob2QKICAgICAgICAgICAgICAgICAgICAgICAgfSkpO2Nhc2UgOTppZiAoCiAgICAgICAgICAgICAgICAgICAgICBtYXRjaGVzKSB7X2NvbnRleHQxMi5uZXh0ID0gMTE7YnJlYWs7fXRocm93ICgKICAgICAgICAgICAgICAgICAgICAgICAgZ2V0SW50ZXJuYWxSb3V0ZXJFcnJvcig0MDQsIHsKICAgICAgICAgICAgICAgICAgICAgICAgICBwYXRobmFtZTogbG9jYXRpb24ucGF0aG5hbWUKICAgICAgICAgICAgICAgICAgICAgICAgfSkpO2Nhc2UgMTE6CgoKICAgICAgICAgICAgICAgICAgICAgIG1hdGNoID0gcm91dGVJZCA/IG1hdGNoZXMuZmluZCgobSkgPT4gbS5yb3V0ZS5pZCA9PT0gcm91dGVJZCkgOiBnZXRUYXJnZXRNYXRjaChtYXRjaGVzLCBsb2NhdGlvbik7aWYgKCEoCgogICAgICAgICAgICAgICAgICAgICAgcm91dGVJZCAmJiAhbWF0Y2gpKSB7X2NvbnRleHQxMi5uZXh0ID0gMTY7YnJlYWs7fXRocm93ICgKICAgICAgICAgICAgICAgICAgICAgICAgZ2V0SW50ZXJuYWxSb3V0ZXJFcnJvcig0MDMsIHsKICAgICAgICAgICAgICAgICAgICAgICAgICBwYXRobmFtZTogbG9jYXRpb24ucGF0aG5hbWUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgcm91dGVJZDogcm91dGVJZAogICAgICAgICAgICAgICAgICAgICAgICB9KSk7Y2FzZSAxNjppZiAoCiAgICAgICAgICAgICAgICAgICAgICBtYXRjaCkge19jb250ZXh0MTIubmV4dCA9IDE4O2JyZWFrO310aHJvdyAoCgogICAgICAgICAgICAgICAgICAgICAgICBnZXRJbnRlcm5hbFJvdXRlckVycm9yKDQwNCwgewogICAgICAgICAgICAgICAgICAgICAgICAgIHBhdGhuYW1lOiBsb2NhdGlvbi5wYXRobmFtZQogICAgICAgICAgICAgICAgICAgICAgICB9KSk7Y2FzZSAxODpfY29udGV4dDEyLm5leHQgPSAyMDtyZXR1cm4gKAoKCiAgICAgICAgICAgICAgICAgICAgICAgIHF1ZXJ5SW1wbChyZXF1ZXN0LCBsb2NhdGlvbiwgbWF0Y2hlcywgcmVxdWVzdENvbnRleHQsIG1hdGNoKSk7Y2FzZSAyMDpyZXN1bHQgPSBfY29udGV4dDEyLnNlbnQ7aWYgKCEKCiAgICAgICAgICAgICAgICAgICAgICBpc1Jlc3BvbnNlKHJlc3VsdCkpIHtfY29udGV4dDEyLm5leHQgPSAyMzticmVhazt9cmV0dXJuIF9jb250ZXh0MTIuYWJydXB0KCJyZXR1cm4iLAogICAgICAgICAgICAgICAgICAgICAgcmVzdWx0KTtjYXNlIDIzOgoKCiAgICAgICAgICAgICAgICAgICAgICBlcnJvciA9IHJlc3VsdC5lcnJvcnMgPyBPYmplY3QudmFsdWVzKHJlc3VsdC5lcnJvcnMpWzBdIDogdW5kZWZpbmVkO2lmICghKAoKICAgICAgICAgICAgICAgICAgICAgIGVycm9yICE9PSB1bmRlZmluZWQpKSB7X2NvbnRleHQxMi5uZXh0ID0gMjY7YnJlYWs7fXRocm93ICgKCgoKCiAgICAgICAgICAgICAgICAgICAgICAgIGVycm9yKTtjYXNlIDI2OmlmICghCgoKCiAgICAgICAgICAgICAgICAgICAgICByZXN1bHQuYWN0aW9uRGF0YSkge19jb250ZXh0MTIubmV4dCA9IDI4O2JyZWFrO31yZXR1cm4gX2NvbnRleHQxMi5hYnJ1cHQoInJldHVybiIsCiAgICAgICAgICAgICAgICAgICAgICBPYmplY3QudmFsdWVzKHJlc3VsdC5hY3Rpb25EYXRhKVswXSk7Y2FzZSAyODppZiAoIQoKCiAgICAgICAgICAgICAgICAgICAgICByZXN1bHQubG9hZGVyRGF0YSkge19jb250ZXh0MTIubmV4dCA9IDMyO2JyZWFrO30KCgogICAgICAgICAgICAgICAgICAgICAgZGF0YSA9IE9iamVjdC52YWx1ZXMocmVzdWx0LmxvYWRlckRhdGEpWzBdOwoKICAgICAgICAgICAgICAgICAgICAgIGlmICgoX3Jlc3VsdCRhY3RpdmVEZWZlcnJlID0gcmVzdWx0LmFjdGl2ZURlZmVycmVkcykgIT0gbnVsbCAmJiBfcmVzdWx0JGFjdGl2ZURlZmVycmVbbWF0Y2gucm91dGUuaWRdKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGFbVU5TQUZFX0RFRkVSUkVEX1NZTUJPTF0gPSByZXN1bHQuYWN0aXZlRGVmZXJyZWRzW21hdGNoLnJvdXRlLmlkXTsKICAgICAgICAgICAgICAgICAgICAgIH1yZXR1cm4gX2NvbnRleHQxMi5hYnJ1cHQoInJldHVybiIsCgogICAgICAgICAgICAgICAgICAgICAgZGF0YSk7Y2FzZSAzMjpyZXR1cm4gX2NvbnRleHQxMi5hYnJ1cHQoInJldHVybiIsCgoKICAgICAgICAgICAgICAgICAgICAgIHVuZGVmaW5lZCk7Y2FzZSAzMzpjYXNlICJlbmQiOnJldHVybiBfY29udGV4dDEyLnN0b3AoKTt9fSwgX2NhbGxlZTEyKTt9KSk7cmV0dXJuIF9xdWVyeVJvdXRlLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7fWZ1bmN0aW9uCgoKICAgICAgICAgICAgcXVlcnlJbXBsKF94NDYsIF94NDcsIF94NDgsIF94NDksIF94NTApIHtyZXR1cm4gX3F1ZXJ5SW1wbC5hcHBseSh0aGlzLCBhcmd1bWVudHMpO31mdW5jdGlvbiBfcXVlcnlJbXBsKCkge19xdWVyeUltcGwgPSBfYXN5bmNUb0dlbmVyYXRvcjIoIC8qI19fUFVSRV9fKi9fcmVnZW5lcmF0b3JSdW50aW1lMigpLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTEzKHJlcXVlc3QsIGxvY2F0aW9uLCBtYXRjaGVzLCByZXF1ZXN0Q29udGV4dCwgcm91dGVNYXRjaCkge3ZhciBfcmVzdWx0LCByZXN1bHQ7cmV0dXJuIF9yZWdlbmVyYXRvclJ1bnRpbWUyKCkud3JhcChmdW5jdGlvbiBfY2FsbGVlMTMkKF9jb250ZXh0MTMpIHt3aGlsZSAoMSkgc3dpdGNoIChfY29udGV4dDEzLnByZXYgPSBfY29udGV4dDEzLm5leHQpIHtjYXNlIDA6CiAgICAgICAgICAgICAgICAgICAgICByb3V0ZXJfaW52YXJpYW50KHJlcXVlc3Quc2lnbmFsLCAicXVlcnkoKS9xdWVyeVJvdXRlKCkgcmVxdWVzdHMgbXVzdCBjb250YWluIGFuIEFib3J0Q29udHJvbGxlciBzaWduYWwiKTtfY29udGV4dDEzLnByZXYgPSAxO2lmICghCgoKICAgICAgICAgICAgICAgICAgICAgIGlzTXV0YXRpb25NZXRob2QocmVxdWVzdC5tZXRob2QudG9Mb3dlckNhc2UoKSkpIHtfY29udGV4dDEzLm5leHQgPSA3O2JyZWFrO31fY29udGV4dDEzLm5leHQgPSA1O3JldHVybiAoCiAgICAgICAgICAgICAgICAgICAgICAgIHN1Ym1pdChyZXF1ZXN0LCBtYXRjaGVzLCByb3V0ZU1hdGNoIHx8IGdldFRhcmdldE1hdGNoKG1hdGNoZXMsIGxvY2F0aW9uKSwgcmVxdWVzdENvbnRleHQsIHJvdXRlTWF0Y2ggIT0gbnVsbCkpO2Nhc2UgNTpfcmVzdWx0ID0gX2NvbnRleHQxMy5zZW50O3JldHVybiBfY29udGV4dDEzLmFicnVwdCgicmV0dXJuIiwKICAgICAgICAgICAgICAgICAgICAgIF9yZXN1bHQpO2Nhc2UgNzpfY29udGV4dDEzLm5leHQgPSA5O3JldHVybiAoCgoKICAgICAgICAgICAgICAgICAgICAgICAgbG9hZFJvdXRlRGF0YShyZXF1ZXN0LCBtYXRjaGVzLCByZXF1ZXN0Q29udGV4dCwgcm91dGVNYXRjaCkpO2Nhc2UgOTpyZXN1bHQgPSBfY29udGV4dDEzLnNlbnQ7cmV0dXJuIF9jb250ZXh0MTMuYWJydXB0KCJyZXR1cm4iLAogICAgICAgICAgICAgICAgICAgICAgaXNSZXNwb25zZShyZXN1bHQpID8gcmVzdWx0IDogX2V4dGVuZHMoe30sIHJlc3VsdCwgewogICAgICAgICAgICAgICAgICAgICAgICBhY3Rpb25EYXRhOiBudWxsLAogICAgICAgICAgICAgICAgICAgICAgICBhY3Rpb25IZWFkZXJzOiB7fQogICAgICAgICAgICAgICAgICAgICAgfSkpO2Nhc2UgMTM6X2NvbnRleHQxMy5wcmV2ID0gMTM7X2NvbnRleHQxMy50MCA9IF9jb250ZXh0MTNbImNhdGNoIl0oMSk7aWYgKCEKCgoKCiAgICAgICAgICAgICAgICAgICAgICBpc1F1ZXJ5Um91dGVSZXNwb25zZShfY29udGV4dDEzLnQwKSkge19jb250ZXh0MTMubmV4dCA9IDE5O2JyZWFrO31pZiAoISgKICAgICAgICAgICAgICAgICAgICAgIF9jb250ZXh0MTMudDAudHlwZSA9PT0gUmVzdWx0VHlwZS5lcnJvciAmJiAhaXNSZWRpcmVjdFJlc3BvbnNlKF9jb250ZXh0MTMudDAucmVzcG9uc2UpKSkge19jb250ZXh0MTMubmV4dCA9IDE4O2JyZWFrO310aHJvdyAoCiAgICAgICAgICAgICAgICAgICAgICAgIF9jb250ZXh0MTMudDAucmVzcG9uc2UpO2Nhc2UgMTg6cmV0dXJuIF9jb250ZXh0MTMuYWJydXB0KCJyZXR1cm4iLAoKCiAgICAgICAgICAgICAgICAgICAgICBfY29udGV4dDEzLnQwLnJlc3BvbnNlKTtjYXNlIDE5OmlmICghCgoKCgogICAgICAgICAgICAgICAgICAgICAgaXNSZWRpcmVjdFJlc3BvbnNlKF9jb250ZXh0MTMudDApKSB7X2NvbnRleHQxMy5uZXh0ID0gMjE7YnJlYWs7fXJldHVybiBfY29udGV4dDEzLmFicnVwdCgicmV0dXJuIiwgX2NvbnRleHQxMy50MCk7Y2FzZSAyMTp0aHJvdyBfY29udGV4dDEzLnQwO2Nhc2UgMjI6Y2FzZSAiZW5kIjpyZXR1cm4gX2NvbnRleHQxMy5zdG9wKCk7fX0sIF9jYWxsZWUxMywgbnVsbCwgW1sxLCAxM11dKTt9KSk7cmV0dXJuIF9xdWVyeUltcGwuYXBwbHkodGhpcywgYXJndW1lbnRzKTt9ZnVuY3Rpb24KCgoKCgoKCiAgICAgICAgICAgIHN1Ym1pdChfeDUxLCBfeDUyLCBfeDUzLCBfeDU0LCBfeDU1KSB7cmV0dXJuIF9zdWJtaXQuYXBwbHkodGhpcywgYXJndW1lbnRzKTt9ZnVuY3Rpb24gX3N1Ym1pdCgpIHtfc3VibWl0ID0gX2FzeW5jVG9HZW5lcmF0b3IyKCAvKiNfX1BVUkVfXyovX3JlZ2VuZXJhdG9yUnVudGltZTIoKS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUxNChyZXF1ZXN0LCBtYXRjaGVzLCBhY3Rpb25NYXRjaCwgcmVxdWVzdENvbnRleHQsIGlzUm91dGVSZXF1ZXN0KSB7dmFyIHJlc3VsdCwgZXJyb3IsIG1ldGhvZCwgX2Vycm9yNCwgYm91bmRhcnlNYXRjaCwgX2NvbnRleHQxNCwgbG9hZGVyUmVxdWVzdCwgY29udGV4dDtyZXR1cm4gX3JlZ2VuZXJhdG9yUnVudGltZTIoKS53cmFwKGZ1bmN0aW9uIF9jYWxsZWUxNCQoX2NvbnRleHQxNSkge3doaWxlICgxKSBzd2l0Y2ggKF9jb250ZXh0MTUucHJldiA9IF9jb250ZXh0MTUubmV4dCkge2Nhc2UgMDppZiAoCgoKICAgICAgICAgICAgICAgICAgICAgIGFjdGlvbk1hdGNoLnJvdXRlLmFjdGlvbikge19jb250ZXh0MTUubmV4dCA9IDc7YnJlYWs7fQogICAgICAgICAgICAgICAgICAgICAgZXJyb3IgPSBnZXRJbnRlcm5hbFJvdXRlckVycm9yKDQwNSwgewogICAgICAgICAgICAgICAgICAgICAgICBtZXRob2Q6IHJlcXVlc3QubWV0aG9kLAogICAgICAgICAgICAgICAgICAgICAgICBwYXRobmFtZTogbmV3IFVSTChyZXF1ZXN0LnVybCkucGF0aG5hbWUsCiAgICAgICAgICAgICAgICAgICAgICAgIHJvdXRlSWQ6IGFjdGlvbk1hdGNoLnJvdXRlLmlkCiAgICAgICAgICAgICAgICAgICAgICB9KTtpZiAoIQoKICAgICAgICAgICAgICAgICAgICAgIGlzUm91dGVSZXF1ZXN0KSB7X2NvbnRleHQxNS5uZXh0ID0gNDticmVhazt9dGhyb3cgKAogICAgICAgICAgICAgICAgICAgICAgICBlcnJvcik7Y2FzZSA0OgoKCiAgICAgICAgICAgICAgICAgICAgICByZXN1bHQgPSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6IFJlc3VsdFR5cGUuZXJyb3IsCiAgICAgICAgICAgICAgICAgICAgICAgIGVycm9yOiBlcnJvcgogICAgICAgICAgICAgICAgICAgICAgfTtfY29udGV4dDE1Lm5leHQgPSAxMzticmVhaztjYXNlIDc6X2NvbnRleHQxNS5uZXh0ID0gOTtyZXR1cm4gKAoKICAgICAgICAgICAgICAgICAgICAgICAgY2FsbExvYWRlck9yQWN0aW9uKCJhY3Rpb24iLCByZXF1ZXN0LCBhY3Rpb25NYXRjaCwgbWF0Y2hlcywgYmFzZW5hbWUsIHRydWUsIGlzUm91dGVSZXF1ZXN0LCByZXF1ZXN0Q29udGV4dCkpO2Nhc2UgOTpyZXN1bHQgPSBfY29udGV4dDE1LnNlbnQ7aWYgKCEKCiAgICAgICAgICAgICAgICAgICAgICByZXF1ZXN0LnNpZ25hbC5hYm9ydGVkKSB7X2NvbnRleHQxNS5uZXh0ID0gMTM7YnJlYWs7fQogICAgICAgICAgICAgICAgICAgICAgbWV0aG9kID0gaXNSb3V0ZVJlcXVlc3QgPyAicXVlcnlSb3V0ZSIgOiAicXVlcnkiO3Rocm93ICgKICAgICAgICAgICAgICAgICAgICAgICAgbmV3IEVycm9yKG1ldGhvZCArICIoKSBjYWxsIGFib3J0ZWQiKSk7Y2FzZSAxMzppZiAoIQoKCgogICAgICAgICAgICAgICAgICAgICAgaXNSZWRpcmVjdFJlc3VsdChyZXN1bHQpKSB7X2NvbnRleHQxNS5uZXh0ID0gMTU7YnJlYWs7fXRocm93ICgKCgoKCiAgICAgICAgICAgICAgICAgICAgICAgIG5ldyBSZXNwb25zZShudWxsLCB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhdHVzOiByZXN1bHQuc3RhdHVzLAogICAgICAgICAgICAgICAgICAgICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIExvY2F0aW9uOiByZXN1bHQubG9jYXRpb24KICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0pKTtjYXNlIDE1OmlmICghCgoKICAgICAgICAgICAgICAgICAgICAgIGlzRGVmZXJyZWRSZXN1bHQocmVzdWx0KSkge19jb250ZXh0MTUubmV4dCA9IDIwO2JyZWFrO30KICAgICAgICAgICAgICAgICAgICAgIF9lcnJvcjQgPSBnZXRJbnRlcm5hbFJvdXRlckVycm9yKDQwMCwgewogICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiAiZGVmZXItYWN0aW9uIgogICAgICAgICAgICAgICAgICAgICAgfSk7aWYgKCEKCiAgICAgICAgICAgICAgICAgICAgICBpc1JvdXRlUmVxdWVzdCkge19jb250ZXh0MTUubmV4dCA9IDE5O2JyZWFrO310aHJvdyAoCiAgICAgICAgICAgICAgICAgICAgICAgIF9lcnJvcjQpO2Nhc2UgMTk6CgoKICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdCA9IHsKICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogUmVzdWx0VHlwZS5lcnJvciwKICAgICAgICAgICAgICAgICAgICAgICAgZXJyb3I6IF9lcnJvcjQKICAgICAgICAgICAgICAgICAgICAgIH07Y2FzZSAyMDppZiAoIQoKCiAgICAgICAgICAgICAgICAgICAgICBpc1JvdXRlUmVxdWVzdCkge19jb250ZXh0MTUubmV4dCA9IDI0O2JyZWFrO31pZiAoIQoKCiAgICAgICAgICAgICAgICAgICAgICBpc0Vycm9yUmVzdWx0KHJlc3VsdCkpIHtfY29udGV4dDE1Lm5leHQgPSAyMzticmVhazt9dGhyb3cgKAogICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQuZXJyb3IpO2Nhc2UgMjM6cmV0dXJuIF9jb250ZXh0MTUuYWJydXB0KCJyZXR1cm4iLAoKCiAgICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgIG1hdGNoZXM6IFthY3Rpb25NYXRjaF0sCiAgICAgICAgICAgICAgICAgICAgICAgIGxvYWRlckRhdGE6IHt9LAogICAgICAgICAgICAgICAgICAgICAgICBhY3Rpb25EYXRhOiBfZGVmaW5lUHJvcGVydHkyKHt9LAogICAgICAgICAgICAgICAgICAgICAgICBhY3Rpb25NYXRjaC5yb3V0ZS5pZCwgcmVzdWx0LmRhdGEpLAoKICAgICAgICAgICAgICAgICAgICAgICAgZXJyb3JzOiBudWxsLAogICAgICAgICAgICAgICAgICAgICAgICAvLyBOb3RlOiBzdGF0dXNDb2RlICsgaGVhZGVycyBhcmUgdW51c2VkIGhlcmUgc2luY2UgcXVlcnlSb3V0ZSB3aWxsCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIHJldHVybiB0aGUgcmF3IFJlc3BvbnNlIG9yIHZhbHVlCiAgICAgICAgICAgICAgICAgICAgICAgIHN0YXR1c0NvZGU6IDIwMCwKICAgICAgICAgICAgICAgICAgICAgICAgbG9hZGVySGVhZGVyczoge30sCiAgICAgICAgICAgICAgICAgICAgICAgIGFjdGlvbkhlYWRlcnM6IHt9LAogICAgICAgICAgICAgICAgICAgICAgICBhY3RpdmVEZWZlcnJlZHM6IG51bGwKICAgICAgICAgICAgICAgICAgICAgIH0pO2Nhc2UgMjQ6aWYgKCEKCgogICAgICAgICAgICAgICAgICAgICAgaXNFcnJvclJlc3VsdChyZXN1bHQpKSB7X2NvbnRleHQxNS5uZXh0ID0gMzA7YnJlYWs7fQogICAgICAgICAgICAgICAgICAgICAgLy8gU3RvcmUgb2ZmIHRoZSBwZW5kaW5nIGVycm9yIC0gd2UgdXNlIGl0IHRvIGRldGVybWluZSB3aGljaCBsb2FkZXJzCiAgICAgICAgICAgICAgICAgICAgICAvLyB0byBjYWxsIGFuZCB3aWxsIGNvbW1pdCBpdCB3aGVuIHdlIGNvbXBsZXRlIHRoZSBuYXZpZ2F0aW9uCiAgICAgICAgICAgICAgICAgICAgICBib3VuZGFyeU1hdGNoID0gZmluZE5lYXJlc3RCb3VuZGFyeShtYXRjaGVzLCBhY3Rpb25NYXRjaC5yb3V0ZS5pZCk7X2NvbnRleHQxNS5uZXh0ID0gMjg7cmV0dXJuICgKICAgICAgICAgICAgICAgICAgICAgICAgbG9hZFJvdXRlRGF0YShyZXF1ZXN0LCBtYXRjaGVzLCByZXF1ZXN0Q29udGV4dCwgdW5kZWZpbmVkLCBfZGVmaW5lUHJvcGVydHkyKHt9LAogICAgICAgICAgICAgICAgICAgICAgICBib3VuZGFyeU1hdGNoLnJvdXRlLmlkLCByZXN1bHQuZXJyb3IpKSk7Y2FzZSAyODpfY29udGV4dDE0ID0gX2NvbnRleHQxNS5zZW50O3JldHVybiBfY29udGV4dDE1LmFicnVwdCgicmV0dXJuIiwKCgogICAgICAgICAgICAgICAgICAgICAgX2V4dGVuZHMoe30sIF9jb250ZXh0MTQsIHsKICAgICAgICAgICAgICAgICAgICAgICAgc3RhdHVzQ29kZTogaXNSb3V0ZUVycm9yUmVzcG9uc2UocmVzdWx0LmVycm9yKSA/IHJlc3VsdC5lcnJvci5zdGF0dXMgOiA1MDAsCiAgICAgICAgICAgICAgICAgICAgICAgIGFjdGlvbkRhdGE6IG51bGwsCiAgICAgICAgICAgICAgICAgICAgICAgIGFjdGlvbkhlYWRlcnM6IF9leHRlbmRzKHt9LCByZXN1bHQuaGVhZGVycyA/IF9kZWZpbmVQcm9wZXJ0eTIoe30sCiAgICAgICAgICAgICAgICAgICAgICAgIGFjdGlvbk1hdGNoLnJvdXRlLmlkLCByZXN1bHQuaGVhZGVycykgOgogICAgICAgICAgICAgICAgICAgICAgICB7fSkKICAgICAgICAgICAgICAgICAgICAgIH0pKTtjYXNlIDMwOgogICAgICAgICAgICAgICAgICAgICAgLy8gQ3JlYXRlIGEgR0VUIHJlcXVlc3QgZm9yIHRoZSBsb2FkZXJzCgoKICAgICAgICAgICAgICAgICAgICAgIGxvYWRlclJlcXVlc3QgPSBuZXcgUmVxdWVzdChyZXF1ZXN0LnVybCwgewogICAgICAgICAgICAgICAgICAgICAgICBoZWFkZXJzOiByZXF1ZXN0LmhlYWRlcnMsCiAgICAgICAgICAgICAgICAgICAgICAgIHJlZGlyZWN0OiByZXF1ZXN0LnJlZGlyZWN0LAogICAgICAgICAgICAgICAgICAgICAgICBzaWduYWw6IHJlcXVlc3Quc2lnbmFsCiAgICAgICAgICAgICAgICAgICAgICB9KTtfY29udGV4dDE1Lm5leHQgPSAzMztyZXR1cm4gKAogICAgICAgICAgICAgICAgICAgICAgICBsb2FkUm91dGVEYXRhKGxvYWRlclJlcXVlc3QsIG1hdGNoZXMsIHJlcXVlc3RDb250ZXh0KSk7Y2FzZSAzMzpjb250ZXh0ID0gX2NvbnRleHQxNS5zZW50O3JldHVybiBfY29udGV4dDE1LmFicnVwdCgicmV0dXJuIiwKICAgICAgICAgICAgICAgICAgICAgIF9leHRlbmRzKHt9LCBjb250ZXh0LCByZXN1bHQuc3RhdHVzQ29kZSA/IHsKICAgICAgICAgICAgICAgICAgICAgICAgc3RhdHVzQ29kZTogcmVzdWx0LnN0YXR1c0NvZGUKICAgICAgICAgICAgICAgICAgICAgIH0gOiB7fSwgewogICAgICAgICAgICAgICAgICAgICAgICBhY3Rpb25EYXRhOiBfZGVmaW5lUHJvcGVydHkyKHt9LAogICAgICAgICAgICAgICAgICAgICAgICBhY3Rpb25NYXRjaC5yb3V0ZS5pZCwgcmVzdWx0LmRhdGEpLAoKICAgICAgICAgICAgICAgICAgICAgICAgYWN0aW9uSGVhZGVyczogX2V4dGVuZHMoe30sIHJlc3VsdC5oZWFkZXJzID8gX2RlZmluZVByb3BlcnR5Mih7fSwKICAgICAgICAgICAgICAgICAgICAgICAgYWN0aW9uTWF0Y2gucm91dGUuaWQsIHJlc3VsdC5oZWFkZXJzKSA6CiAgICAgICAgICAgICAgICAgICAgICAgIHt9KQogICAgICAgICAgICAgICAgICAgICAgfSkpO2Nhc2UgMzU6Y2FzZSAiZW5kIjpyZXR1cm4gX2NvbnRleHQxNS5zdG9wKCk7fX0sIF9jYWxsZWUxNCk7fSkpO3JldHVybiBfc3VibWl0LmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7fWZ1bmN0aW9uCgoKICAgICAgICAgICAgbG9hZFJvdXRlRGF0YShfeDU2LCBfeDU3LCBfeDU4LCBfeDU5LCBfeDYwKSB7cmV0dXJuIF9sb2FkUm91dGVEYXRhLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7fWZ1bmN0aW9uIF9sb2FkUm91dGVEYXRhKCkge19sb2FkUm91dGVEYXRhID0gX2FzeW5jVG9HZW5lcmF0b3IyKCAvKiNfX1BVUkVfXyovX3JlZ2VuZXJhdG9yUnVudGltZTIoKS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUxNShyZXF1ZXN0LCBtYXRjaGVzLCByZXF1ZXN0Q29udGV4dCwgcm91dGVNYXRjaCwgcGVuZGluZ0FjdGlvbkVycm9yKSB7dmFyIGlzUm91dGVSZXF1ZXN0LCByZXF1ZXN0TWF0Y2hlcywgbWF0Y2hlc1RvTG9hZCwgcmVzdWx0cywgbWV0aG9kLCBhY3RpdmVEZWZlcnJlZHMsIGNvbnRleHQsIGV4ZWN1dGVkTG9hZGVycztyZXR1cm4gX3JlZ2VuZXJhdG9yUnVudGltZTIoKS53cmFwKGZ1bmN0aW9uIF9jYWxsZWUxNSQoX2NvbnRleHQxNikge3doaWxlICgxKSBzd2l0Y2ggKF9jb250ZXh0MTYucHJldiA9IF9jb250ZXh0MTYubmV4dCkge2Nhc2UgMDoKICAgICAgICAgICAgICAgICAgICAgIGlzUm91dGVSZXF1ZXN0ID0gcm91dGVNYXRjaCAhPSBudWxsOyAvLyBTaG9ydCBjaXJjdWl0IGlmIHdlIGhhdmUgbm8gbG9hZGVycyB0byBydW4gKHF1ZXJ5Um91dGUoKSkKICAgICAgICAgICAgICAgICAgICAgIGlmICghKAogICAgICAgICAgICAgICAgICAgICAgaXNSb3V0ZVJlcXVlc3QgJiYgIShyb3V0ZU1hdGNoICE9IG51bGwgJiYgcm91dGVNYXRjaC5yb3V0ZS5sb2FkZXIpKSkge19jb250ZXh0MTYubmV4dCA9IDM7YnJlYWs7fXRocm93ICgKICAgICAgICAgICAgICAgICAgICAgICAgZ2V0SW50ZXJuYWxSb3V0ZXJFcnJvcig0MDAsIHsKICAgICAgICAgICAgICAgICAgICAgICAgICBtZXRob2Q6IHJlcXVlc3QubWV0aG9kLAogICAgICAgICAgICAgICAgICAgICAgICAgIHBhdGhuYW1lOiBuZXcgVVJMKHJlcXVlc3QudXJsKS5wYXRobmFtZSwKICAgICAgICAgICAgICAgICAgICAgICAgICByb3V0ZUlkOiByb3V0ZU1hdGNoID09IG51bGwgPyB2b2lkIDAgOiByb3V0ZU1hdGNoLnJvdXRlLmlkCiAgICAgICAgICAgICAgICAgICAgICAgIH0pKTtjYXNlIDM6CgoKICAgICAgICAgICAgICAgICAgICAgIHJlcXVlc3RNYXRjaGVzID0gcm91dGVNYXRjaCA/IFtyb3V0ZU1hdGNoXSA6IGdldExvYWRlck1hdGNoZXNVbnRpbEJvdW5kYXJ5KG1hdGNoZXMsIE9iamVjdC5rZXlzKHBlbmRpbmdBY3Rpb25FcnJvciB8fCB7fSlbMF0pOwogICAgICAgICAgICAgICAgICAgICAgbWF0Y2hlc1RvTG9hZCA9IHJlcXVlc3RNYXRjaGVzLmZpbHRlcigobSkgPT4gbS5yb3V0ZS5sb2FkZXIpOyAvLyBTaG9ydCBjaXJjdWl0IGlmIHdlIGhhdmUgbm8gbG9hZGVycyB0byBydW4gKHF1ZXJ5KCkpCiAgICAgICAgICAgICAgICAgICAgICBpZiAoISgKICAgICAgICAgICAgICAgICAgICAgIG1hdGNoZXNUb0xvYWQubGVuZ3RoID09PSAwKSkge19jb250ZXh0MTYubmV4dCA9IDc7YnJlYWs7fXJldHVybiBfY29udGV4dDE2LmFicnVwdCgicmV0dXJuIiwKICAgICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgbWF0Y2hlczogbWF0Y2hlcywKICAgICAgICAgICAgICAgICAgICAgICAgLy8gQWRkIGEgbnVsbCBmb3IgYWxsIG1hdGNoZWQgcm91dGVzIGZvciBwcm9wZXIgcmV2YWxpZGF0aW9uIG9uIHRoZSBjbGllbnQKICAgICAgICAgICAgICAgICAgICAgICAgbG9hZGVyRGF0YTogbWF0Y2hlcy5yZWR1Y2UoKGFjYywgbSkgPT4gT2JqZWN0LmFzc2lnbihhY2MsIF9kZWZpbmVQcm9wZXJ0eTIoe30sCiAgICAgICAgICAgICAgICAgICAgICAgIG0ucm91dGUuaWQsIG51bGwpKSwKICAgICAgICAgICAgICAgICAgICAgICAge30pLAogICAgICAgICAgICAgICAgICAgICAgICBlcnJvcnM6IHBlbmRpbmdBY3Rpb25FcnJvciB8fCBudWxsLAogICAgICAgICAgICAgICAgICAgICAgICBzdGF0dXNDb2RlOiAyMDAsCiAgICAgICAgICAgICAgICAgICAgICAgIGxvYWRlckhlYWRlcnM6IHt9LAogICAgICAgICAgICAgICAgICAgICAgICBhY3RpdmVEZWZlcnJlZHM6IG51bGwKICAgICAgICAgICAgICAgICAgICAgIH0pO2Nhc2UgNzpfY29udGV4dDE2Lm5leHQgPSA5O3JldHVybiAoCgoKICAgICAgICAgICAgICAgICAgICAgICAgUHJvbWlzZS5hbGwoX3RvQ29uc3VtYWJsZUFycmF5KG1hdGNoZXNUb0xvYWQubWFwKChtYXRjaCkgPT4gY2FsbExvYWRlck9yQWN0aW9uKCJsb2FkZXIiLCByZXF1ZXN0LCBtYXRjaCwgbWF0Y2hlcywgYmFzZW5hbWUsIHRydWUsIGlzUm91dGVSZXF1ZXN0LCByZXF1ZXN0Q29udGV4dCkpKSkpO2Nhc2UgOTpyZXN1bHRzID0gX2NvbnRleHQxNi5zZW50O2lmICghCgogICAgICAgICAgICAgICAgICAgICAgcmVxdWVzdC5zaWduYWwuYWJvcnRlZCkge19jb250ZXh0MTYubmV4dCA9IDEzO2JyZWFrO30KICAgICAgICAgICAgICAgICAgICAgIG1ldGhvZCA9IGlzUm91dGVSZXF1ZXN0ID8gInF1ZXJ5Um91dGUiIDogInF1ZXJ5Ijt0aHJvdyAoCiAgICAgICAgICAgICAgICAgICAgICAgIG5ldyBFcnJvcihtZXRob2QgKyAiKCkgY2FsbCBhYm9ydGVkIikpO2Nhc2UgMTM6CiAgICAgICAgICAgICAgICAgICAgICAvLyBQcm9jZXNzIGFuZCBjb21taXQgb3V0cHV0IGZyb20gbG9hZGVycwoKCiAgICAgICAgICAgICAgICAgICAgICBhY3RpdmVEZWZlcnJlZHMgPSBuZXcgTWFwKCk7CiAgICAgICAgICAgICAgICAgICAgICBjb250ZXh0ID0gcHJvY2Vzc1JvdXRlTG9hZGVyRGF0YShtYXRjaGVzLCBtYXRjaGVzVG9Mb2FkLCByZXN1bHRzLCBwZW5kaW5nQWN0aW9uRXJyb3IsIGFjdGl2ZURlZmVycmVkcyk7IC8vIEFkZCBhIG51bGwgZm9yIGFueSBub24tbG9hZGVyIG1hdGNoZXMgZm9yIHByb3BlciByZXZhbGlkYXRpb24gb24gdGhlIGNsaWVudAoKICAgICAgICAgICAgICAgICAgICAgIGV4ZWN1dGVkTG9hZGVycyA9IG5ldyBTZXQobWF0Y2hlc1RvTG9hZC5tYXAoKG1hdGNoKSA9PiBtYXRjaC5yb3V0ZS5pZCkpOwogICAgICAgICAgICAgICAgICAgICAgbWF0Y2hlcy5mb3JFYWNoKChtYXRjaCkgPT4gewogICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWV4ZWN1dGVkTG9hZGVycy5oYXMobWF0Y2gucm91dGUuaWQpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgY29udGV4dC5sb2FkZXJEYXRhW21hdGNoLnJvdXRlLmlkXSA9IG51bGw7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgIH0pO3JldHVybiBfY29udGV4dDE2LmFicnVwdCgicmV0dXJuIiwKICAgICAgICAgICAgICAgICAgICAgIF9leHRlbmRzKHt9LCBjb250ZXh0LCB7CiAgICAgICAgICAgICAgICAgICAgICAgIG1hdGNoZXM6IG1hdGNoZXMsCiAgICAgICAgICAgICAgICAgICAgICAgIGFjdGl2ZURlZmVycmVkczogYWN0aXZlRGVmZXJyZWRzLnNpemUgPiAwID8gT2JqZWN0LmZyb21FbnRyaWVzKGFjdGl2ZURlZmVycmVkcy5lbnRyaWVzKCkpIDogbnVsbAogICAgICAgICAgICAgICAgICAgICAgfSkpO2Nhc2UgMTg6Y2FzZSAiZW5kIjpyZXR1cm4gX2NvbnRleHQxNi5zdG9wKCk7fX0sIF9jYWxsZWUxNSk7fSkpO3JldHVybiBfbG9hZFJvdXRlRGF0YS5hcHBseSh0aGlzLCBhcmd1bWVudHMpO30KCgogICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgIGRhdGFSb3V0ZXM6IGRhdGFSb3V0ZXMsCiAgICAgICAgICAgICAgcXVlcnk6IHF1ZXJ5LAogICAgICAgICAgICAgIHF1ZXJ5Um91dGU6IHF1ZXJ5Um91dGUKICAgICAgICAgICAgfTsKICAgICAgICAgIH0gLy8jZW5kcmVnaW9uCiAgICAgICAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwogICAgICAgICAgLy8jcmVnaW9uIEhlbHBlcnMKICAgICAgICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCgogICAgICAgICAgLyoqCiAgICAgICAgICAgKiBHaXZlbiBhbiBleGlzdGluZyBTdGF0aWNIYW5kbGVyQ29udGV4dCBhbmQgYW4gZXJyb3IgdGhyb3duIGF0IHJlbmRlciB0aW1lLAogICAgICAgICAgICogcHJvdmlkZSBhbiB1cGRhdGVkIFN0YXRpY0hhbmRsZXJDb250ZXh0IHN1aXRhYmxlIGZvciBhIHNlY29uZCBTU1IgcmVuZGVyCiAgICAgICAgICAgKi8KCiAgICAgICAgICBmdW5jdGlvbiBnZXRTdGF0aWNDb250ZXh0RnJvbUVycm9yKHJvdXRlcywgY29udGV4dCwgZXJyb3IpIHsKICAgICAgICAgICAgdmFyIG5ld0NvbnRleHQgPSBfZXh0ZW5kcyh7fSwgY29udGV4dCwgewogICAgICAgICAgICAgIHN0YXR1c0NvZGU6IDUwMCwKICAgICAgICAgICAgICBlcnJvcnM6IF9kZWZpbmVQcm9wZXJ0eTIoe30sCiAgICAgICAgICAgICAgY29udGV4dC5fZGVlcGVzdFJlbmRlcmVkQm91bmRhcnlJZCB8fCByb3V0ZXNbMF0uaWQsIGVycm9yKQoKICAgICAgICAgICAgfSk7CgogICAgICAgICAgICByZXR1cm4gbmV3Q29udGV4dDsKICAgICAgICAgIH0KCiAgICAgICAgICBmdW5jdGlvbiBpc1N1Ym1pc3Npb25OYXZpZ2F0aW9uKG9wdHMpIHsKICAgICAgICAgICAgcmV0dXJuIG9wdHMgIT0gbnVsbCAmJiAiZm9ybURhdGEiIGluIG9wdHM7CiAgICAgICAgICB9IC8vIE5vcm1hbGl6ZSBuYXZpZ2F0aW9uIG9wdGlvbnMgYnkgY29udmVydGluZyBmb3JtTWV0aG9kPUdFVCBmb3JtRGF0YSBvYmplY3RzIHRvCiAgICAgICAgICAvLyBVUkxTZWFyY2hQYXJhbXMgc28gdGhleSBiZWhhdmUgaWRlbnRpY2FsbHkgdG8gbGlua3Mgd2l0aCBxdWVyeSBwYXJhbXMKCgogICAgICAgICAgZnVuY3Rpb24gbm9ybWFsaXplTmF2aWdhdGVPcHRpb25zKHRvLCBvcHRzLCBpc0ZldGNoZXIpIHsKICAgICAgICAgICAgaWYgKGlzRmV0Y2hlciA9PT0gdm9pZCAwKSB7CiAgICAgICAgICAgICAgaXNGZXRjaGVyID0gZmFsc2U7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHZhciBwYXRoID0gdHlwZW9mIHRvID09PSAic3RyaW5nIiA/IHRvIDogcm91dGVyX2NyZWF0ZVBhdGgodG8pOyAvLyBSZXR1cm4gbG9jYXRpb24gdmVyYmF0aW0gb24gbm9uLXN1Ym1pc3Npb24gbmF2aWdhdGlvbnMKCiAgICAgICAgICAgIGlmICghb3B0cyB8fCAhaXNTdWJtaXNzaW9uTmF2aWdhdGlvbihvcHRzKSkgewogICAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICBwYXRoOiBwYXRoCiAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKG9wdHMuZm9ybU1ldGhvZCAmJiAhaXNWYWxpZE1ldGhvZChvcHRzLmZvcm1NZXRob2QpKSB7CiAgICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgIHBhdGg6IHBhdGgsCiAgICAgICAgICAgICAgICBlcnJvcjogZ2V0SW50ZXJuYWxSb3V0ZXJFcnJvcig0MDUsIHsKICAgICAgICAgICAgICAgICAgbWV0aG9kOiBvcHRzLmZvcm1NZXRob2QKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgfSAvLyBDcmVhdGUgYSBTdWJtaXNzaW9uIG9uIG5vbi1HRVQgbmF2aWdhdGlvbnMKCgogICAgICAgICAgICB2YXIgc3VibWlzc2lvbjsKCiAgICAgICAgICAgIGlmIChvcHRzLmZvcm1EYXRhKSB7CiAgICAgICAgICAgICAgc3VibWlzc2lvbiA9IHsKICAgICAgICAgICAgICAgIGZvcm1NZXRob2Q6IG9wdHMuZm9ybU1ldGhvZCB8fCAiZ2V0IiwKICAgICAgICAgICAgICAgIGZvcm1BY3Rpb246IHN0cmlwSGFzaEZyb21QYXRoKHBhdGgpLAogICAgICAgICAgICAgICAgZm9ybUVuY1R5cGU6IG9wdHMgJiYgb3B0cy5mb3JtRW5jVHlwZSB8fCAiYXBwbGljYXRpb24veC13d3ctZm9ybS11cmxlbmNvZGVkIiwKICAgICAgICAgICAgICAgIGZvcm1EYXRhOiBvcHRzLmZvcm1EYXRhCiAgICAgICAgICAgICAgfTsKCiAgICAgICAgICAgICAgaWYgKGlzTXV0YXRpb25NZXRob2Qoc3VibWlzc2lvbi5mb3JtTWV0aG9kKSkgewogICAgICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgICAgcGF0aDogcGF0aCwKICAgICAgICAgICAgICAgICAgc3VibWlzc2lvbjogc3VibWlzc2lvbgogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gLy8gRmxhdHRlbiBzdWJtaXNzaW9uIG9udG8gVVJMU2VhcmNoUGFyYW1zIGZvciBHRVQgc3VibWlzc2lvbnMKCgogICAgICAgICAgICB2YXIgcGFyc2VkUGF0aCA9IHBhcnNlUGF0aChwYXRoKTsKCiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgdmFyIHNlYXJjaFBhcmFtcyA9IGNvbnZlcnRGb3JtRGF0YVRvU2VhcmNoUGFyYW1zKG9wdHMuZm9ybURhdGEpOyAvLyBTaW5jZSBmZXRjaGVyIEdFVCBzdWJtaXNzaW9ucyBvbmx5IHJ1biBhIHNpbmdsZSBsb2FkZXIgKGFzIG9wcG9zZWQgdG8KICAgICAgICAgICAgICAvLyBuYXZpZ2F0aW9uIEdFVCBzdWJtaXNzaW9ucyB3aGljaCBydW4gYWxsIGxvYWRlcnMpLCB3ZSBuZWVkIHRvIHByZXNlcnZlCiAgICAgICAgICAgICAgLy8gYW55IGluY29taW5nID9pbmRleCBwYXJhbXMKCiAgICAgICAgICAgICAgaWYgKGlzRmV0Y2hlciAmJiBwYXJzZWRQYXRoLnNlYXJjaCAmJiBoYXNOYWtlZEluZGV4UXVlcnkocGFyc2VkUGF0aC5zZWFyY2gpKSB7CiAgICAgICAgICAgICAgICBzZWFyY2hQYXJhbXMuYXBwZW5kKCJpbmRleCIsICIiKTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIHBhcnNlZFBhdGguc2VhcmNoID0gIj8iICsgc2VhcmNoUGFyYW1zOwogICAgICAgICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgIHBhdGg6IHBhdGgsCiAgICAgICAgICAgICAgICBlcnJvcjogZ2V0SW50ZXJuYWxSb3V0ZXJFcnJvcig0MDApCiAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICBwYXRoOiByb3V0ZXJfY3JlYXRlUGF0aChwYXJzZWRQYXRoKSwKICAgICAgICAgICAgICBzdWJtaXNzaW9uOiBzdWJtaXNzaW9uCiAgICAgICAgICAgIH07CiAgICAgICAgICB9IC8vIEZpbHRlciBvdXQgYWxsIHJvdXRlcyBiZWxvdyBhbnkgY2F1Z2h0IGVycm9yIGFzIHRoZXkgYXJlbid0IGdvaW5nIHRvCiAgICAgICAgICAvLyByZW5kZXIgc28gd2UgZG9uJ3QgbmVlZCB0byBsb2FkIHRoZW0KCgogICAgICAgICAgZnVuY3Rpb24gZ2V0TG9hZGVyTWF0Y2hlc1VudGlsQm91bmRhcnkobWF0Y2hlcywgYm91bmRhcnlJZCkgewogICAgICAgICAgICB2YXIgYm91bmRhcnlNYXRjaGVzID0gbWF0Y2hlczsKCiAgICAgICAgICAgIGlmIChib3VuZGFyeUlkKSB7CiAgICAgICAgICAgICAgdmFyIGluZGV4ID0gbWF0Y2hlcy5maW5kSW5kZXgoKG0pID0+IG0ucm91dGUuaWQgPT09IGJvdW5kYXJ5SWQpOwoKICAgICAgICAgICAgICBpZiAoaW5kZXggPj0gMCkgewogICAgICAgICAgICAgICAgYm91bmRhcnlNYXRjaGVzID0gbWF0Y2hlcy5zbGljZSgwLCBpbmRleCk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICByZXR1cm4gYm91bmRhcnlNYXRjaGVzOwogICAgICAgICAgfQoKICAgICAgICAgIGZ1bmN0aW9uIGdldE1hdGNoZXNUb0xvYWQoaGlzdG9yeSwgc3RhdGUsIG1hdGNoZXMsIHN1Ym1pc3Npb24sIGxvY2F0aW9uLCBpc1JldmFsaWRhdGlvblJlcXVpcmVkLCBjYW5jZWxsZWREZWZlcnJlZFJvdXRlcywgY2FuY2VsbGVkRmV0Y2hlckxvYWRzLCBwZW5kaW5nQWN0aW9uRGF0YSwgcGVuZGluZ0Vycm9yLCBmZXRjaExvYWRNYXRjaGVzKSB7CiAgICAgICAgICAgIHZhciBhY3Rpb25SZXN1bHQgPSBwZW5kaW5nRXJyb3IgPyBPYmplY3QudmFsdWVzKHBlbmRpbmdFcnJvcilbMF0gOiBwZW5kaW5nQWN0aW9uRGF0YSA/IE9iamVjdC52YWx1ZXMocGVuZGluZ0FjdGlvbkRhdGEpWzBdIDogdW5kZWZpbmVkOyAvLyBQaWNrIG5hdmlnYXRpb24gbWF0Y2hlcyB0aGF0IGFyZSBuZXQtbmV3IG9yIHF1YWxpZnkgZm9yIHJldmFsaWRhdGlvbgoKICAgICAgICAgICAgdmFyIGJvdW5kYXJ5SWQgPSBwZW5kaW5nRXJyb3IgPyBPYmplY3Qua2V5cyhwZW5kaW5nRXJyb3IpWzBdIDogdW5kZWZpbmVkOwogICAgICAgICAgICB2YXIgYm91bmRhcnlNYXRjaGVzID0gZ2V0TG9hZGVyTWF0Y2hlc1VudGlsQm91bmRhcnkobWF0Y2hlcywgYm91bmRhcnlJZCk7CiAgICAgICAgICAgIHZhciBuYXZpZ2F0aW9uTWF0Y2hlcyA9IGJvdW5kYXJ5TWF0Y2hlcy5maWx0ZXIoKG1hdGNoLCBpbmRleCkgPT4gbWF0Y2gucm91dGUubG9hZGVyICE9IG51bGwgJiYgKGlzTmV3TG9hZGVyKHN0YXRlLmxvYWRlckRhdGEsIHN0YXRlLm1hdGNoZXNbaW5kZXhdLCBtYXRjaCkgfHwgLy8gSWYgdGhpcyByb3V0ZSBoYWQgYSBwZW5kaW5nIGRlZmVycmVkIGNhbmNlbGxlZCBpdCBtdXN0IGJlIHJldmFsaWRhdGVkCiAgICAgICAgICAgIGNhbmNlbGxlZERlZmVycmVkUm91dGVzLnNvbWUoKGlkKSA9PiBpZCA9PT0gbWF0Y2gucm91dGUuaWQpIHx8IHNob3VsZFJldmFsaWRhdGVMb2FkZXIoaGlzdG9yeSwgc3RhdGUubG9jYXRpb24sIHN0YXRlLm1hdGNoZXNbaW5kZXhdLCBzdWJtaXNzaW9uLCBsb2NhdGlvbiwgbWF0Y2gsIGlzUmV2YWxpZGF0aW9uUmVxdWlyZWQsIGFjdGlvblJlc3VsdCkpKTsgLy8gUGljayBmZXRjaGVyLmxvYWRzIHRoYXQgbmVlZCB0byBiZSByZXZhbGlkYXRlZAoKICAgICAgICAgICAgdmFyIHJldmFsaWRhdGluZ0ZldGNoZXJzID0gW107CiAgICAgICAgICAgIGZldGNoTG9hZE1hdGNoZXMgJiYgZmV0Y2hMb2FkTWF0Y2hlcy5mb3JFYWNoKChfcmVmMTEsIGtleSkgPT4gewogICAgICAgICAgICAgIHZhciBfcmVmMjggPSBfc2xpY2VkVG9BcnJheTIoX3JlZjExLCAzKSxocmVmID0gX3JlZjI4WzBdLG1hdGNoID0gX3JlZjI4WzFdLGZldGNoTWF0Y2hlcyA9IF9yZWYyOFsyXTsKCiAgICAgICAgICAgICAgLy8gVGhpcyBmZXRjaGVyIHdhcyBjYW5jZWxsZWQgZnJvbSBhIHByaW9yIGFjdGlvbiBzdWJtaXNzaW9uIC0gZm9yY2UgcmVsb2FkCiAgICAgICAgICAgICAgaWYgKGNhbmNlbGxlZEZldGNoZXJMb2Fkcy5pbmNsdWRlcyhrZXkpKSB7CiAgICAgICAgICAgICAgICByZXZhbGlkYXRpbmdGZXRjaGVycy5wdXNoKFtrZXksIGhyZWYsIG1hdGNoLCBmZXRjaE1hdGNoZXNdKTsKICAgICAgICAgICAgICB9IGVsc2UgaWYgKGlzUmV2YWxpZGF0aW9uUmVxdWlyZWQpIHsKICAgICAgICAgICAgICAgIHZhciBzaG91bGRSZXZhbGlkYXRlID0gc2hvdWxkUmV2YWxpZGF0ZUxvYWRlcihoaXN0b3J5LCBocmVmLCBtYXRjaCwgc3VibWlzc2lvbiwgaHJlZiwgbWF0Y2gsIGlzUmV2YWxpZGF0aW9uUmVxdWlyZWQsIGFjdGlvblJlc3VsdCk7CgogICAgICAgICAgICAgICAgaWYgKHNob3VsZFJldmFsaWRhdGUpIHsKICAgICAgICAgICAgICAgICAgcmV2YWxpZGF0aW5nRmV0Y2hlcnMucHVzaChba2V5LCBocmVmLCBtYXRjaCwgZmV0Y2hNYXRjaGVzXSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICAgICAgcmV0dXJuIFtuYXZpZ2F0aW9uTWF0Y2hlcywgcmV2YWxpZGF0aW5nRmV0Y2hlcnNdOwogICAgICAgICAgfQoKICAgICAgICAgIGZ1bmN0aW9uIGlzTmV3TG9hZGVyKGN1cnJlbnRMb2FkZXJEYXRhLCBjdXJyZW50TWF0Y2gsIG1hdGNoKSB7CiAgICAgICAgICAgIHZhciBpc05ldyA9IC8vIFthXSAtPiBbYSwgYl0KICAgICAgICAgICAgIWN1cnJlbnRNYXRjaCB8fCAvLyBbYSwgYl0gLT4gW2EsIGNdCiAgICAgICAgICAgIG1hdGNoLnJvdXRlLmlkICE9PSBjdXJyZW50TWF0Y2gucm91dGUuaWQ7IC8vIEhhbmRsZSB0aGUgY2FzZSB0aGF0IHdlIGRvbid0IGhhdmUgZGF0YSBmb3IgYSByZS11c2VkIHJvdXRlLCBwb3RlbnRpYWxseQogICAgICAgICAgICAvLyBmcm9tIGEgcHJpb3IgZXJyb3Igb3IgZnJvbSBhIGNhbmNlbGxlZCBwZW5kaW5nIGRlZmVycmVkCgogICAgICAgICAgICB2YXIgaXNNaXNzaW5nRGF0YSA9IGN1cnJlbnRMb2FkZXJEYXRhW21hdGNoLnJvdXRlLmlkXSA9PT0gdW5kZWZpbmVkOyAvLyBBbHdheXMgbG9hZCBpZiB0aGlzIGlzIGEgbmV0LW5ldyByb3V0ZSBvciB3ZSBkb24ndCB5ZXQgaGF2ZSBkYXRhCgogICAgICAgICAgICByZXR1cm4gaXNOZXcgfHwgaXNNaXNzaW5nRGF0YTsKICAgICAgICAgIH0KCiAgICAgICAgICBmdW5jdGlvbiBpc05ld1JvdXRlSW5zdGFuY2UoY3VycmVudE1hdGNoLCBtYXRjaCkgewogICAgICAgICAgICB2YXIgY3VycmVudFBhdGggPSBjdXJyZW50TWF0Y2gucm91dGUucGF0aDsKICAgICAgICAgICAgcmV0dXJuICgvLyBwYXJhbSBjaGFuZ2UgZm9yIHRoaXMgbWF0Y2gsIC91c2Vycy8xMjMgLT4gL3VzZXJzLzQ1NgogICAgICAgICAgICAgIGN1cnJlbnRNYXRjaC5wYXRobmFtZSAhPT0gbWF0Y2gucGF0aG5hbWUgfHwgLy8gc3BsYXQgcGFyYW0gY2hhbmdlZCwgd2hpY2ggaXMgbm90IHByZXNlbnQgaW4gbWF0Y2gucGF0aAogICAgICAgICAgICAgIC8vIGUuZy4gL2ZpbGVzL2ltYWdlcy9hdmF0YXIuanBnIC0+IGZpbGVzL2ZpbmFuY2VzLnhscwogICAgICAgICAgICAgIGN1cnJlbnRQYXRoICYmIGN1cnJlbnRQYXRoLmVuZHNXaXRoKCIqIikgJiYgY3VycmVudE1hdGNoLnBhcmFtc1siKiJdICE9PSBtYXRjaC5wYXJhbXNbIioiXSk7CgogICAgICAgICAgfQoKICAgICAgICAgIGZ1bmN0aW9uIHNob3VsZFJldmFsaWRhdGVMb2FkZXIoaGlzdG9yeSwgY3VycmVudExvY2F0aW9uLCBjdXJyZW50TWF0Y2gsIHN1Ym1pc3Npb24sIGxvY2F0aW9uLCBtYXRjaCwgaXNSZXZhbGlkYXRpb25SZXF1aXJlZCwgYWN0aW9uUmVzdWx0KSB7CiAgICAgICAgICAgIHZhciBjdXJyZW50VXJsID0gaGlzdG9yeS5jcmVhdGVVUkwoY3VycmVudExvY2F0aW9uKTsKICAgICAgICAgICAgdmFyIGN1cnJlbnRQYXJhbXMgPSBjdXJyZW50TWF0Y2gucGFyYW1zOwogICAgICAgICAgICB2YXIgbmV4dFVybCA9IGhpc3RvcnkuY3JlYXRlVVJMKGxvY2F0aW9uKTsKICAgICAgICAgICAgdmFyIG5leHRQYXJhbXMgPSBtYXRjaC5wYXJhbXM7IC8vIFRoaXMgaXMgdGhlIGRlZmF1bHQgaW1wbGVtZW50YXRpb24gYXMgdG8gd2hlbiB3ZSByZXZhbGlkYXRlLiAgSWYgdGhlIHJvdXRlCiAgICAgICAgICAgIC8vIHByb3ZpZGVzIGl0J3Mgb3duIGltcGxlbWVudGF0aW9uLCB0aGVuIHdlIGdpdmUgdGhlbSBmdWxsIGNvbnRyb2wgYnV0CiAgICAgICAgICAgIC8vIHByb3ZpZGUgdGhpcyB2YWx1ZSBzbyB0aGV5IGNhbiBsZXZlcmFnZSBpdCBpZiBuZWVkZWQgYWZ0ZXIgdGhleSBjaGVjawogICAgICAgICAgICAvLyB0aGVpciBvd24gc3BlY2lmaWMgdXNlIGNhc2VzCiAgICAgICAgICAgIC8vIE5vdGUgdGhhdCBmZXRjaGVycyBhbHdheXMgcHJvdmlkZSB0aGUgc2FtZSBjdXJyZW50L25leHQgbG9jYXRpb25zIHNvIHRoZQogICAgICAgICAgICAvLyBVUkwtYmFzZWQgY2hlY2tzIGhlcmUgZG9uJ3QgYXBwbHkgdG8gZmV0Y2hlciBzaG91bGRSZXZhbGlkYXRlIGNhbGxzCgogICAgICAgICAgICB2YXIgZGVmYXVsdFNob3VsZFJldmFsaWRhdGUgPSBpc05ld1JvdXRlSW5zdGFuY2UoY3VycmVudE1hdGNoLCBtYXRjaCkgfHwgLy8gQ2xpY2tlZCB0aGUgc2FtZSBsaW5rLCByZXN1Ym1pdHRlZCBhIEdFVCBmb3JtCiAgICAgICAgICAgIGN1cnJlbnRVcmwudG9TdHJpbmcoKSA9PT0gbmV4dFVybC50b1N0cmluZygpIHx8IC8vIFNlYXJjaCBwYXJhbXMgYWZmZWN0IGFsbCBsb2FkZXJzCiAgICAgICAgICAgIGN1cnJlbnRVcmwuc2VhcmNoICE9PSBuZXh0VXJsLnNlYXJjaCB8fCAvLyBGb3JjZWQgcmV2YWxpZGF0aW9uIGR1ZSB0byBzdWJtaXNzaW9uLCB1c2VSZXZhbGlkYXRlLCBvciBYLVJlbWl4LVJldmFsaWRhdGUKICAgICAgICAgICAgaXNSZXZhbGlkYXRpb25SZXF1aXJlZDsKCiAgICAgICAgICAgIGlmIChtYXRjaC5yb3V0ZS5zaG91bGRSZXZhbGlkYXRlKSB7CiAgICAgICAgICAgICAgdmFyIHJvdXRlQ2hvaWNlID0gbWF0Y2gucm91dGUuc2hvdWxkUmV2YWxpZGF0ZShfZXh0ZW5kcyh7CiAgICAgICAgICAgICAgICBjdXJyZW50VXJsOiBjdXJyZW50VXJsLAogICAgICAgICAgICAgICAgY3VycmVudFBhcmFtczogY3VycmVudFBhcmFtcywKICAgICAgICAgICAgICAgIG5leHRVcmw6IG5leHRVcmwsCiAgICAgICAgICAgICAgICBuZXh0UGFyYW1zOiBuZXh0UGFyYW1zCiAgICAgICAgICAgICAgfSwgc3VibWlzc2lvbiwgewogICAgICAgICAgICAgICAgYWN0aW9uUmVzdWx0OiBhY3Rpb25SZXN1bHQsCiAgICAgICAgICAgICAgICBkZWZhdWx0U2hvdWxkUmV2YWxpZGF0ZTogZGVmYXVsdFNob3VsZFJldmFsaWRhdGUKICAgICAgICAgICAgICB9KSk7CgogICAgICAgICAgICAgIGlmICh0eXBlb2Ygcm91dGVDaG9pY2UgPT09ICJib29sZWFuIikgewogICAgICAgICAgICAgICAgcmV0dXJuIHJvdXRlQ2hvaWNlOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuIGRlZmF1bHRTaG91bGRSZXZhbGlkYXRlOwogICAgICAgICAgfWZ1bmN0aW9uCgogICAgICAgICAgY2FsbExvYWRlck9yQWN0aW9uKF94NjEsIF94NjIsIF94NjMsIF94NjQsIF94NjUsIF94NjYsIF94NjcsIF94NjgpIHtyZXR1cm4gX2NhbGxMb2FkZXJPckFjdGlvbi5hcHBseSh0aGlzLCBhcmd1bWVudHMpO30KCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCiAgICAgICAgICAvLyBVdGlsaXR5IG1ldGhvZCBmb3IgY3JlYXRpbmcgdGhlIFJlcXVlc3QgaW5zdGFuY2VzIGZvciBsb2FkZXJzL2FjdGlvbnMgZHVyaW5nCiAgICAgICAgICAvLyBjbGllbnQtc2lkZSBuYXZpZ2F0aW9ucyBhbmQgZmV0Y2hlcy4gIER1cmluZyBTU1Igd2Ugd2lsbCBhbHdheXMgaGF2ZSBhCiAgICAgICAgICAvLyBSZXF1ZXN0IGluc3RhbmNlIGZyb20gdGhlIHN0YXRpYyBoYW5kbGVyIChxdWVyeS9xdWVyeVJvdXRlKQogICAgICAgICAgZnVuY3Rpb24gX2NhbGxMb2FkZXJPckFjdGlvbigpIHtfY2FsbExvYWRlck9yQWN0aW9uID0gX2FzeW5jVG9HZW5lcmF0b3IyKCAvKiNfX1BVUkVfXyovX3JlZ2VuZXJhdG9yUnVudGltZTIoKS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUxNih0eXBlLCByZXF1ZXN0LCBtYXRjaCwgbWF0Y2hlcywgYmFzZW5hbWUsIGlzU3RhdGljUmVxdWVzdCwgaXNSb3V0ZVJlcXVlc3QsIHJlcXVlc3RDb250ZXh0KSB7dmFyIHJlc3VsdFR5cGUsIHJlc3VsdCwgcmVqZWN0LCBhYm9ydFByb21pc2UsIG9uUmVqZWN0LCBoYW5kbGVyLCBzdGF0dXMsIGxvY2F0aW9uLCBpc0Fic29sdXRlLCBhY3RpdmVNYXRjaGVzLCByb3V0ZVBhdGhuYW1lcywgcmVzb2x2ZWRMb2NhdGlvbiwgcGF0aCwgY3VycmVudFVybCwgdXJsLCBkYXRhLCBjb250ZW50VHlwZTtyZXR1cm4gX3JlZ2VuZXJhdG9yUnVudGltZTIoKS53cmFwKGZ1bmN0aW9uIF9jYWxsZWUxNiQoX2NvbnRleHQxNykge3doaWxlICgxKSBzd2l0Y2ggKF9jb250ZXh0MTcucHJldiA9IF9jb250ZXh0MTcubmV4dCkge2Nhc2UgMDppZiAoYmFzZW5hbWUgPT09IHZvaWQgMCkge2Jhc2VuYW1lID0gIi8iO31pZiAoaXNTdGF0aWNSZXF1ZXN0ID09PSB2b2lkIDApIHtpc1N0YXRpY1JlcXVlc3QgPSBmYWxzZTt9aWYgKGlzUm91dGVSZXF1ZXN0ID09PSB2b2lkIDApIHtpc1JvdXRlUmVxdWVzdCA9IGZhbHNlO31hYm9ydFByb21pc2UgPSBuZXcgUHJvbWlzZSgoXywgcikgPT4gcmVqZWN0ID0gcik7b25SZWplY3QgPSAoKSA9PiByZWplY3QoKTtyZXF1ZXN0LnNpZ25hbC5hZGRFdmVudExpc3RlbmVyKCJhYm9ydCIsIG9uUmVqZWN0KTtfY29udGV4dDE3LnByZXYgPSA2O2hhbmRsZXIgPSBtYXRjaC5yb3V0ZVt0eXBlXTtyb3V0ZXJfaW52YXJpYW50KGhhbmRsZXIsICJDb3VsZCBub3QgZmluZCB0aGUgIiArIHR5cGUgKyAiIHRvIHJ1biBvbiB0aGUgXCIiICsgbWF0Y2gucm91dGUuaWQgKyAiXCIgcm91dGUiKTtfY29udGV4dDE3Lm5leHQgPSAxMTtyZXR1cm4gUHJvbWlzZS5yYWNlKFtoYW5kbGVyKHsgcmVxdWVzdDogcmVxdWVzdCwgcGFyYW1zOiBtYXRjaC5wYXJhbXMsIGNvbnRleHQ6IHJlcXVlc3RDb250ZXh0IH0pLCBhYm9ydFByb21pc2VdKTtjYXNlIDExOnJlc3VsdCA9IF9jb250ZXh0MTcuc2VudDtyb3V0ZXJfaW52YXJpYW50KHJlc3VsdCAhPT0gdW5kZWZpbmVkLCAiWW91IGRlZmluZWQgIiArICh0eXBlID09PSAiYWN0aW9uIiA/ICJhbiBhY3Rpb24iIDogImEgbG9hZGVyIikgKyAiIGZvciByb3V0ZSAiICsgKCJcIiIgKyBtYXRjaC5yb3V0ZS5pZCArICJcIiBidXQgZGlkbid0IHJldHVybiBhbnl0aGluZyBmcm9tIHlvdXIgYCIgKyB0eXBlICsgImAgIikgKyAiZnVuY3Rpb24uIFBsZWFzZSByZXR1cm4gYSB2YWx1ZSBvciBgbnVsbGAuIik7X2NvbnRleHQxNy5uZXh0ID0gMTk7YnJlYWs7Y2FzZSAxNTpfY29udGV4dDE3LnByZXYgPSAxNTtfY29udGV4dDE3LnQwID0gX2NvbnRleHQxN1siY2F0Y2giXSg2KTtyZXN1bHRUeXBlID0gUmVzdWx0VHlwZS5lcnJvcjtyZXN1bHQgPSBfY29udGV4dDE3LnQwO2Nhc2UgMTk6X2NvbnRleHQxNy5wcmV2ID0gMTk7cmVxdWVzdC5zaWduYWwucmVtb3ZlRXZlbnRMaXN0ZW5lcigiYWJvcnQiLCBvblJlamVjdCk7cmV0dXJuIF9jb250ZXh0MTcuZmluaXNoKDE5KTtjYXNlIDIyOmlmICghaXNSZXNwb25zZShyZXN1bHQpKSB7X2NvbnRleHQxNy5uZXh0ID0gNDg7YnJlYWs7fXN0YXR1cyA9IHJlc3VsdC5zdGF0dXM7IC8vIFByb2Nlc3MgcmVkaXJlY3RzCiAgICAgICAgICAgICAgICAgICAgaWYgKCFyZWRpcmVjdFN0YXR1c0NvZGVzLmhhcyhzdGF0dXMpKSB7X2NvbnRleHQxNy5uZXh0ID0gMzM7YnJlYWs7fWxvY2F0aW9uID0gcmVzdWx0LmhlYWRlcnMuZ2V0KCJMb2NhdGlvbiIpO3JvdXRlcl9pbnZhcmlhbnQobG9jYXRpb24sICJSZWRpcmVjdHMgcmV0dXJuZWQvdGhyb3duIGZyb20gbG9hZGVycy9hY3Rpb25zIG11c3QgaGF2ZSBhIExvY2F0aW9uIGhlYWRlciIpO2lzQWJzb2x1dGUgPSAvXig/OlthLXpdW2EtejAtOSsuLV0qOnxcL1wvKS9pLnRlc3QobG9jYXRpb24pOyAvLyBTdXBwb3J0IHJlbGF0aXZlIHJvdXRpbmcgaW4gaW50ZXJuYWwgcmVkaXJlY3RzCiAgICAgICAgICAgICAgICAgICAgaWYgKCFpc0Fic29sdXRlKSB7YWN0aXZlTWF0Y2hlcyA9IG1hdGNoZXMuc2xpY2UoMCwgbWF0Y2hlcy5pbmRleE9mKG1hdGNoKSArIDEpO3JvdXRlUGF0aG5hbWVzID0gZ2V0UGF0aENvbnRyaWJ1dGluZ01hdGNoZXMoYWN0aXZlTWF0Y2hlcykubWFwKChtYXRjaCkgPT4gbWF0Y2gucGF0aG5hbWVCYXNlKTtyZXNvbHZlZExvY2F0aW9uID0gcmVzb2x2ZVRvKGxvY2F0aW9uLCByb3V0ZVBhdGhuYW1lcywgbmV3IFVSTChyZXF1ZXN0LnVybCkucGF0aG5hbWUpO3JvdXRlcl9pbnZhcmlhbnQocm91dGVyX2NyZWF0ZVBhdGgocmVzb2x2ZWRMb2NhdGlvbiksICJVbmFibGUgdG8gcmVzb2x2ZSByZWRpcmVjdCBsb2NhdGlvbjogIiArIGxvY2F0aW9uKTsgLy8gUHJlcGVuZCB0aGUgYmFzZW5hbWUgdG8gdGhlIHJlZGlyZWN0IGxvY2F0aW9uIGlmIHdlIGhhdmUgb25lCiAgICAgICAgICAgICAgICAgICAgICBpZiAoYmFzZW5hbWUpIHtwYXRoID0gcmVzb2x2ZWRMb2NhdGlvbi5wYXRobmFtZTtyZXNvbHZlZExvY2F0aW9uLnBhdGhuYW1lID0gcGF0aCA9PT0gIi8iID8gYmFzZW5hbWUgOiByb3V0ZXJfam9pblBhdGhzKFtiYXNlbmFtZSwgcGF0aF0pO31sb2NhdGlvbiA9IHJvdXRlcl9jcmVhdGVQYXRoKHJlc29sdmVkTG9jYXRpb24pO30gZWxzZSBpZiAoIWlzU3RhdGljUmVxdWVzdCkgey8vIFN0cmlwIG9mZiB0aGUgcHJvdG9jb2wrb3JpZ2luIGZvciBzYW1lLW9yaWdpbiBhYnNvbHV0ZSByZWRpcmVjdHMuCiAgICAgICAgICAgICAgICAgICAgICAvLyBJZiB0aGlzIGlzIGEgc3RhdGljIHJlcXVlcywgd2UgY2FuIGxldCBpdCBnbyBiYWNrIHRvIHRoZSBicm93c2VyCiAgICAgICAgICAgICAgICAgICAgICAvLyBhcy1pcwogICAgICAgICAgICAgICAgICAgICAgY3VycmVudFVybCA9IG5ldyBVUkwocmVxdWVzdC51cmwpO3VybCA9IGxvY2F0aW9uLnN0YXJ0c1dpdGgoIi8vIikgPyBuZXcgVVJMKGN1cnJlbnRVcmwucHJvdG9jb2wgKyBsb2NhdGlvbikgOiBuZXcgVVJMKGxvY2F0aW9uKTtpZiAodXJsLm9yaWdpbiA9PT0gY3VycmVudFVybC5vcmlnaW4pIHtsb2NhdGlvbiA9IHVybC5wYXRobmFtZSArIHVybC5zZWFyY2ggKyB1cmwuaGFzaDt9fSAvLyBEb24ndCBwcm9jZXNzIHJlZGlyZWN0cyBpbiB0aGUgcm91dGVyIGR1cmluZyBzdGF0aWMgcmVxdWVzdHMgcmVxdWVzdHMuCiAgICAgICAgICAgICAgICAgICAgLy8gSW5zdGVhZCwgdGhyb3cgdGhlIFJlc3BvbnNlIGFuZCBsZXQgdGhlIHNlcnZlciBoYW5kbGUgaXQgd2l0aCBhbiBIVFRQCiAgICAgICAgICAgICAgICAgICAgLy8gcmVkaXJlY3QuICBXZSBhbHNvIHVwZGF0ZSB0aGUgTG9jYXRpb24gaGVhZGVyIGluIHBsYWNlIGluIHRoaXMgZmxvdyBzbwogICAgICAgICAgICAgICAgICAgIC8vIGJhc2VuYW1lIGFuZCByZWxhdGl2ZSByb3V0aW5nIGlzIHRha2VuIGludG8gYWNjb3VudAogICAgICAgICAgICAgICAgICAgIGlmICghaXNTdGF0aWNSZXF1ZXN0KSB7X2NvbnRleHQxNy5uZXh0ID0gMzI7YnJlYWs7fXJlc3VsdC5oZWFkZXJzLnNldCgiTG9jYXRpb24iLCBsb2NhdGlvbik7dGhyb3cgcmVzdWx0O2Nhc2UgMzI6cmV0dXJuIF9jb250ZXh0MTcuYWJydXB0KCJyZXR1cm4iLCB7IHR5cGU6IFJlc3VsdFR5cGUucmVkaXJlY3QsIHN0YXR1czogc3RhdHVzLCBsb2NhdGlvbjogbG9jYXRpb24sIHJldmFsaWRhdGU6IHJlc3VsdC5oZWFkZXJzLmdldCgiWC1SZW1peC1SZXZhbGlkYXRlIikgIT09IG51bGwgfSk7Y2FzZSAzMzppZiAoIWlzUm91dGVSZXF1ZXN0KSB7X2NvbnRleHQxNy5uZXh0ID0gMzU7YnJlYWs7fXRocm93IHsgdHlwZTogcmVzdWx0VHlwZSB8fCBSZXN1bHRUeXBlLmRhdGEsIHJlc3BvbnNlOiByZXN1bHQgfTtjYXNlIDM1OmNvbnRlbnRUeXBlID0gcmVzdWx0LmhlYWRlcnMuZ2V0KCJDb250ZW50LVR5cGUiKTsgLy8gQ2hlY2sgYmV0d2VlbiB3b3JkIGJvdW5kYXJpZXMgaW5zdGVhZCBvZiBzdGFydHNXaXRoKCkgZHVlIHRvIHRoZSBsYXN0CiAgICAgICAgICAgICAgICAgICAgLy8gcGFyYWdyYXBoIG9mIGh0dHBzOi8vaHR0cHdnLm9yZy9zcGVjcy9yZmM5MTEwLmh0bWwjZmllbGQuY29udGVudC10eXBlCiAgICAgICAgICAgICAgICAgICAgaWYgKCEoY29udGVudFR5cGUgJiYgL1xiYXBwbGljYXRpb25cL2pzb25cYi8udGVzdChjb250ZW50VHlwZSkpKSB7X2NvbnRleHQxNy5uZXh0ID0gNDI7YnJlYWs7fV9jb250ZXh0MTcubmV4dCA9IDM5O3JldHVybiByZXN1bHQuanNvbigpO2Nhc2UgMzk6ZGF0YSA9IF9jb250ZXh0MTcuc2VudDtfY29udGV4dDE3Lm5leHQgPSA0NTticmVhaztjYXNlIDQyOl9jb250ZXh0MTcubmV4dCA9IDQ0O3JldHVybiByZXN1bHQudGV4dCgpO2Nhc2UgNDQ6ZGF0YSA9IF9jb250ZXh0MTcuc2VudDtjYXNlIDQ1OmlmICghKHJlc3VsdFR5cGUgPT09IFJlc3VsdFR5cGUuZXJyb3IpKSB7X2NvbnRleHQxNy5uZXh0ID0gNDc7YnJlYWs7fXJldHVybiBfY29udGV4dDE3LmFicnVwdCgicmV0dXJuIiwgeyB0eXBlOiByZXN1bHRUeXBlLCBlcnJvcjogbmV3IHJvdXRlcl9FcnJvclJlc3BvbnNlKHN0YXR1cywgcmVzdWx0LnN0YXR1c1RleHQsIGRhdGEpLCBoZWFkZXJzOiByZXN1bHQuaGVhZGVycyB9KTtjYXNlIDQ3OnJldHVybiBfY29udGV4dDE3LmFicnVwdCgicmV0dXJuIiwgeyB0eXBlOiBSZXN1bHRUeXBlLmRhdGEsIGRhdGE6IGRhdGEsIHN0YXR1c0NvZGU6IHJlc3VsdC5zdGF0dXMsIGhlYWRlcnM6IHJlc3VsdC5oZWFkZXJzIH0pO2Nhc2UgNDg6aWYgKCEocmVzdWx0VHlwZSA9PT0gUmVzdWx0VHlwZS5lcnJvcikpIHtfY29udGV4dDE3Lm5leHQgPSA1MDticmVhazt9cmV0dXJuIF9jb250ZXh0MTcuYWJydXB0KCJyZXR1cm4iLCB7IHR5cGU6IHJlc3VsdFR5cGUsIGVycm9yOiByZXN1bHQgfSk7Y2FzZSA1MDppZiAoIShyZXN1bHQgaW5zdGFuY2VvZiBEZWZlcnJlZERhdGEpKSB7X2NvbnRleHQxNy5uZXh0ID0gNTI7YnJlYWs7fXJldHVybiBfY29udGV4dDE3LmFicnVwdCgicmV0dXJuIiwgeyB0eXBlOiBSZXN1bHRUeXBlLmRlZmVycmVkLCBkZWZlcnJlZERhdGE6IHJlc3VsdCB9KTtjYXNlIDUyOnJldHVybiBfY29udGV4dDE3LmFicnVwdCgicmV0dXJuIiwgeyB0eXBlOiBSZXN1bHRUeXBlLmRhdGEsIGRhdGE6IHJlc3VsdCB9KTtjYXNlIDUzOmNhc2UgImVuZCI6cmV0dXJuIF9jb250ZXh0MTcuc3RvcCgpO319LCBfY2FsbGVlMTYsIG51bGwsIFtbNiwgMTUsIDE5LCAyMl1dKTt9KSk7cmV0dXJuIF9jYWxsTG9hZGVyT3JBY3Rpb24uYXBwbHkodGhpcywgYXJndW1lbnRzKTt9ZnVuY3Rpb24gY3JlYXRlQ2xpZW50U2lkZVJlcXVlc3QoaGlzdG9yeSwgbG9jYXRpb24sIHNpZ25hbCwgc3VibWlzc2lvbikge3ZhciB1cmwgPSBoaXN0b3J5LmNyZWF0ZVVSTChzdHJpcEhhc2hGcm9tUGF0aChsb2NhdGlvbikpLnRvU3RyaW5nKCk7dmFyIGluaXQgPSB7IHNpZ25hbDogc2lnbmFsIH07aWYgKHN1Ym1pc3Npb24gJiYgaXNNdXRhdGlvbk1ldGhvZChzdWJtaXNzaW9uLmZvcm1NZXRob2QpKSB7dmFyIGZvcm1NZXRob2QgPQogICAgICAgICAgICAgICAgc3VibWlzc2lvbi5mb3JtTWV0aG9kLGZvcm1FbmNUeXBlID0gc3VibWlzc2lvbi5mb3JtRW5jVHlwZSxmb3JtRGF0YSA9IHN1Ym1pc3Npb24uZm9ybURhdGE7CiAgICAgICAgICAgICAgaW5pdC5tZXRob2QgPSBmb3JtTWV0aG9kLnRvVXBwZXJDYXNlKCk7CiAgICAgICAgICAgICAgaW5pdC5ib2R5ID0gZm9ybUVuY1R5cGUgPT09ICJhcHBsaWNhdGlvbi94LXd3dy1mb3JtLXVybGVuY29kZWQiID8gY29udmVydEZvcm1EYXRhVG9TZWFyY2hQYXJhbXMoZm9ybURhdGEpIDogZm9ybURhdGE7CiAgICAgICAgICAgIH0gLy8gQ29udGVudC1UeXBlIGlzIGluZmVycmVkIChodHRwczovL2ZldGNoLnNwZWMud2hhdHdnLm9yZy8jZG9tLXJlcXVlc3QpCgoKICAgICAgICAgICAgcmV0dXJuIG5ldyBSZXF1ZXN0KHVybCwgaW5pdCk7CiAgICAgICAgICB9CgogICAgICAgICAgZnVuY3Rpb24gY29udmVydEZvcm1EYXRhVG9TZWFyY2hQYXJhbXMoZm9ybURhdGEpIHsKICAgICAgICAgICAgdmFyIHNlYXJjaFBhcmFtcyA9IG5ldyBVUkxTZWFyY2hQYXJhbXMoKTt2YXIgX2l0ZXJhdG9yOCA9IF9jcmVhdGVGb3JPZkl0ZXJhdG9ySGVscGVyMigKCiAgICAgICAgICAgICAgZm9ybURhdGEuZW50cmllcygpKSxfc3RlcDg7dHJ5IHtmb3IgKF9pdGVyYXRvcjgucygpOyAhKF9zdGVwOCA9IF9pdGVyYXRvcjgubigpKS5kb25lOykge3ZhciBfc3RlcDgkdmFsdWUgPSBfc2xpY2VkVG9BcnJheTIoX3N0ZXA4LnZhbHVlLCAyKSxrZXkgPSBfc3RlcDgkdmFsdWVbMF0sdmFsdWUgPSBfc3RlcDgkdmFsdWVbMV07CiAgICAgICAgICAgICAgICByb3V0ZXJfaW52YXJpYW50KHR5cGVvZiB2YWx1ZSA9PT0gInN0cmluZyIsICdGaWxlIGlucHV0cyBhcmUgbm90IHN1cHBvcnRlZCB3aXRoIGVuY1R5cGUgImFwcGxpY2F0aW9uL3gtd3d3LWZvcm0tdXJsZW5jb2RlZCIsICcgKyAncGxlYXNlIHVzZSAibXVsdGlwYXJ0L2Zvcm0tZGF0YSIgaW5zdGVhZC4nKTsKICAgICAgICAgICAgICAgIHNlYXJjaFBhcmFtcy5hcHBlbmQoa2V5LCB2YWx1ZSk7CiAgICAgICAgICAgICAgfX0gY2F0Y2ggKGVycikge19pdGVyYXRvcjguZShlcnIpO30gZmluYWxseSB7X2l0ZXJhdG9yOC5mKCk7fQoKICAgICAgICAgICAgcmV0dXJuIHNlYXJjaFBhcmFtczsKICAgICAgICAgIH0KCiAgICAgICAgICBmdW5jdGlvbiBwcm9jZXNzUm91dGVMb2FkZXJEYXRhKG1hdGNoZXMsIG1hdGNoZXNUb0xvYWQsIHJlc3VsdHMsIHBlbmRpbmdFcnJvciwgYWN0aXZlRGVmZXJyZWRzKSB7CiAgICAgICAgICAgIC8vIEZpbGwgaW4gbG9hZGVyRGF0YS9lcnJvcnMgZnJvbSBvdXIgbG9hZGVycwogICAgICAgICAgICB2YXIgbG9hZGVyRGF0YSA9IHt9OwogICAgICAgICAgICB2YXIgZXJyb3JzID0gbnVsbDsKICAgICAgICAgICAgdmFyIHN0YXR1c0NvZGU7CiAgICAgICAgICAgIHZhciBmb3VuZEVycm9yID0gZmFsc2U7CiAgICAgICAgICAgIHZhciBsb2FkZXJIZWFkZXJzID0ge307IC8vIFByb2Nlc3MgbG9hZGVyIHJlc3VsdHMgaW50byBzdGF0ZS5sb2FkZXJEYXRhL3N0YXRlLmVycm9ycwoKICAgICAgICAgICAgcmVzdWx0cy5mb3JFYWNoKChyZXN1bHQsIGluZGV4KSA9PiB7CiAgICAgICAgICAgICAgdmFyIGlkID0gbWF0Y2hlc1RvTG9hZFtpbmRleF0ucm91dGUuaWQ7CiAgICAgICAgICAgICAgcm91dGVyX2ludmFyaWFudCghaXNSZWRpcmVjdFJlc3VsdChyZXN1bHQpLCAiQ2Fubm90IGhhbmRsZSByZWRpcmVjdCByZXN1bHRzIGluIHByb2Nlc3NMb2FkZXJEYXRhIik7CgogICAgICAgICAgICAgIGlmIChpc0Vycm9yUmVzdWx0KHJlc3VsdCkpIHsKICAgICAgICAgICAgICAgIC8vIExvb2sgdXB3YXJkcyBmcm9tIHRoZSBtYXRjaGVkIHJvdXRlIGZvciB0aGUgY2xvc2VzdCBhbmNlc3RvcgogICAgICAgICAgICAgICAgLy8gZXJyb3IgYm91bmRhcnksIGRlZmF1bHRpbmcgdG8gdGhlIHJvb3QgbWF0Y2gKICAgICAgICAgICAgICAgIHZhciBib3VuZGFyeU1hdGNoID0gZmluZE5lYXJlc3RCb3VuZGFyeShtYXRjaGVzLCBpZCk7CiAgICAgICAgICAgICAgICB2YXIgZXJyb3IgPSByZXN1bHQuZXJyb3I7IC8vIElmIHdlIGhhdmUgYSBwZW5kaW5nIGFjdGlvbiBlcnJvciwgd2UgcmVwb3J0IGl0IGF0IHRoZSBoaWdoZXN0LXJvdXRlCiAgICAgICAgICAgICAgICAvLyB0aGF0IHRocm93cyBhIGxvYWRlciBlcnJvciwgYW5kIHRoZW4gY2xlYXIgaXQgb3V0IHRvIGluZGljYXRlIHRoYXQKICAgICAgICAgICAgICAgIC8vIGl0IHdhcyBjb25zdW1lZAoKICAgICAgICAgICAgICAgIGlmIChwZW5kaW5nRXJyb3IpIHsKICAgICAgICAgICAgICAgICAgZXJyb3IgPSBPYmplY3QudmFsdWVzKHBlbmRpbmdFcnJvcilbMF07CiAgICAgICAgICAgICAgICAgIHBlbmRpbmdFcnJvciA9IHVuZGVmaW5lZDsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBlcnJvcnMgPSBlcnJvcnMgfHwge307IC8vIFByZWZlciBoaWdoZXIgZXJyb3IgdmFsdWVzIGlmIGxvd2VyIGVycm9ycyBidWJibGUgdG8gdGhlIHNhbWUgYm91bmRhcnkKCiAgICAgICAgICAgICAgICBpZiAoZXJyb3JzW2JvdW5kYXJ5TWF0Y2gucm91dGUuaWRdID09IG51bGwpIHsKICAgICAgICAgICAgICAgICAgZXJyb3JzW2JvdW5kYXJ5TWF0Y2gucm91dGUuaWRdID0gZXJyb3I7CiAgICAgICAgICAgICAgICB9IC8vIENsZWFyIG91ciBhbnkgcHJpb3IgbG9hZGVyRGF0YSBmb3IgdGhlIHRocm93aW5nIHJvdXRlCgoKICAgICAgICAgICAgICAgIGxvYWRlckRhdGFbaWRdID0gdW5kZWZpbmVkOyAvLyBPbmNlIHdlIGZpbmQgb3VyIGZpcnN0IChoaWdoZXN0KSBlcnJvciwgd2Ugc2V0IHRoZSBzdGF0dXMgY29kZSBhbmQKICAgICAgICAgICAgICAgIC8vIHByZXZlbnQgZGVlcGVyIHN0YXR1cyBjb2RlcyBmcm9tIG92ZXJyaWRpbmcKCiAgICAgICAgICAgICAgICBpZiAoIWZvdW5kRXJyb3IpIHsKICAgICAgICAgICAgICAgICAgZm91bmRFcnJvciA9IHRydWU7CiAgICAgICAgICAgICAgICAgIHN0YXR1c0NvZGUgPSBpc1JvdXRlRXJyb3JSZXNwb25zZShyZXN1bHQuZXJyb3IpID8gcmVzdWx0LmVycm9yLnN0YXR1cyA6IDUwMDsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBpZiAocmVzdWx0LmhlYWRlcnMpIHsKICAgICAgICAgICAgICAgICAgbG9hZGVySGVhZGVyc1tpZF0gPSByZXN1bHQuaGVhZGVyczsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgaWYgKGlzRGVmZXJyZWRSZXN1bHQocmVzdWx0KSkgewogICAgICAgICAgICAgICAgICBhY3RpdmVEZWZlcnJlZHMuc2V0KGlkLCByZXN1bHQuZGVmZXJyZWREYXRhKTsKICAgICAgICAgICAgICAgICAgbG9hZGVyRGF0YVtpZF0gPSByZXN1bHQuZGVmZXJyZWREYXRhLmRhdGE7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICBsb2FkZXJEYXRhW2lkXSA9IHJlc3VsdC5kYXRhOwogICAgICAgICAgICAgICAgfSAvLyBFcnJvciBzdGF0dXMgY29kZXMgYWx3YXlzIG92ZXJyaWRlIHN1Y2Nlc3Mgc3RhdHVzIGNvZGVzLCBidXQgaWYgYWxsCiAgICAgICAgICAgICAgICAvLyBsb2FkZXJzIGFyZSBzdWNjZXNzZnVsIHdlIHRha2UgdGhlIGRlZXBlc3Qgc3RhdHVzIGNvZGUuCgoKICAgICAgICAgICAgICAgIGlmIChyZXN1bHQuc3RhdHVzQ29kZSAhPSBudWxsICYmIHJlc3VsdC5zdGF0dXNDb2RlICE9PSAyMDAgJiYgIWZvdW5kRXJyb3IpIHsKICAgICAgICAgICAgICAgICAgc3RhdHVzQ29kZSA9IHJlc3VsdC5zdGF0dXNDb2RlOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGlmIChyZXN1bHQuaGVhZGVycykgewogICAgICAgICAgICAgICAgICBsb2FkZXJIZWFkZXJzW2lkXSA9IHJlc3VsdC5oZWFkZXJzOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7IC8vIElmIHdlIGRpZG4ndCBjb25zdW1lIHRoZSBwZW5kaW5nIGFjdGlvbiBlcnJvciAoaS5lLiwgYWxsIGxvYWRlcnMKICAgICAgICAgICAgLy8gcmVzb2x2ZWQpLCB0aGVuIGNvbnN1bWUgaXQgaGVyZS4gIEFsc28gY2xlYXIgb3V0IGFueSBsb2FkZXJEYXRhIGZvciB0aGUKICAgICAgICAgICAgLy8gdGhyb3dpbmcgcm91dGUKCiAgICAgICAgICAgIGlmIChwZW5kaW5nRXJyb3IpIHsKICAgICAgICAgICAgICBlcnJvcnMgPSBwZW5kaW5nRXJyb3I7CiAgICAgICAgICAgICAgbG9hZGVyRGF0YVtPYmplY3Qua2V5cyhwZW5kaW5nRXJyb3IpWzBdXSA9IHVuZGVmaW5lZDsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICBsb2FkZXJEYXRhOiBsb2FkZXJEYXRhLAogICAgICAgICAgICAgIGVycm9yczogZXJyb3JzLAogICAgICAgICAgICAgIHN0YXR1c0NvZGU6IHN0YXR1c0NvZGUgfHwgMjAwLAogICAgICAgICAgICAgIGxvYWRlckhlYWRlcnM6IGxvYWRlckhlYWRlcnMKICAgICAgICAgICAgfTsKICAgICAgICAgIH0KCiAgICAgICAgICBmdW5jdGlvbiBwcm9jZXNzTG9hZGVyRGF0YShzdGF0ZSwgbWF0Y2hlcywgbWF0Y2hlc1RvTG9hZCwgcmVzdWx0cywgcGVuZGluZ0Vycm9yLCByZXZhbGlkYXRpbmdGZXRjaGVycywgZmV0Y2hlclJlc3VsdHMsIGFjdGl2ZURlZmVycmVkcykgewogICAgICAgICAgICB2YXIgX3Byb2Nlc3NSb3V0ZUxvYWRlckRhID0KCgogICAgICAgICAgICAgIHByb2Nlc3NSb3V0ZUxvYWRlckRhdGEobWF0Y2hlcywgbWF0Y2hlc1RvTG9hZCwgcmVzdWx0cywgcGVuZGluZ0Vycm9yLCBhY3RpdmVEZWZlcnJlZHMpLGxvYWRlckRhdGEgPSBfcHJvY2Vzc1JvdXRlTG9hZGVyRGEubG9hZGVyRGF0YSxlcnJvcnMgPSBfcHJvY2Vzc1JvdXRlTG9hZGVyRGEuZXJyb3JzOyAvLyBQcm9jZXNzIHJlc3VsdHMgZnJvbSBvdXIgcmV2YWxpZGF0aW5nIGZldGNoZXJzCgogICAgICAgICAgICBmb3IgKHZhciBpbmRleCA9IDA7IGluZGV4IDwgcmV2YWxpZGF0aW5nRmV0Y2hlcnMubGVuZ3RoOyBpbmRleCsrKSB7CiAgICAgICAgICAgICAgdmFyIF9yZXZhbGlkYXRpbmdGZXRjaGVycyA9IF9zbGljZWRUb0FycmF5MihyZXZhbGlkYXRpbmdGZXRjaGVyc1tpbmRleF0sIDMpLGtleSA9IF9yZXZhbGlkYXRpbmdGZXRjaGVyc1swXSxtYXRjaCA9IF9yZXZhbGlkYXRpbmdGZXRjaGVyc1syXTsKICAgICAgICAgICAgICByb3V0ZXJfaW52YXJpYW50KGZldGNoZXJSZXN1bHRzICE9PSB1bmRlZmluZWQgJiYgZmV0Y2hlclJlc3VsdHNbaW5kZXhdICE9PSB1bmRlZmluZWQsICJEaWQgbm90IGZpbmQgY29ycmVzcG9uZGluZyBmZXRjaGVyIHJlc3VsdCIpOwogICAgICAgICAgICAgIHZhciByZXN1bHQgPSBmZXRjaGVyUmVzdWx0c1tpbmRleF07IC8vIFByb2Nlc3MgZmV0Y2hlciBub24tcmVkaXJlY3QgZXJyb3JzCgogICAgICAgICAgICAgIGlmIChpc0Vycm9yUmVzdWx0KHJlc3VsdCkpIHsKICAgICAgICAgICAgICAgIHZhciBib3VuZGFyeU1hdGNoID0gZmluZE5lYXJlc3RCb3VuZGFyeShzdGF0ZS5tYXRjaGVzLCBtYXRjaC5yb3V0ZS5pZCk7CgogICAgICAgICAgICAgICAgaWYgKCEoZXJyb3JzICYmIGVycm9yc1tib3VuZGFyeU1hdGNoLnJvdXRlLmlkXSkpIHsKICAgICAgICAgICAgICAgICAgZXJyb3JzID0gX2V4dGVuZHMoe30sIGVycm9ycywgX2RlZmluZVByb3BlcnR5Mih7fSwKICAgICAgICAgICAgICAgICAgYm91bmRhcnlNYXRjaC5yb3V0ZS5pZCwgcmVzdWx0LmVycm9yKSk7CgogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHN0YXRlLmZldGNoZXJzLmRlbGV0ZShrZXkpOwogICAgICAgICAgICAgIH0gZWxzZSBpZiAoaXNSZWRpcmVjdFJlc3VsdChyZXN1bHQpKSB7CiAgICAgICAgICAgICAgICAvLyBTaG91bGQgbmV2ZXIgZ2V0IGhlcmUsIHJlZGlyZWN0cyBzaG91bGQgZ2V0IHByb2Nlc3NlZCBhYm92ZSwgYnV0IHdlCiAgICAgICAgICAgICAgICAvLyBrZWVwIHRoaXMgdG8gdHlwZSBuYXJyb3cgdG8gYSBzdWNjZXNzIHJlc3VsdCBpbiB0aGUgZWxzZQogICAgICAgICAgICAgICAgcm91dGVyX2ludmFyaWFudChmYWxzZSwgIlVuaGFuZGxlZCBmZXRjaGVyIHJldmFsaWRhdGlvbiByZWRpcmVjdCIpOwogICAgICAgICAgICAgIH0gZWxzZSBpZiAoaXNEZWZlcnJlZFJlc3VsdChyZXN1bHQpKSB7CiAgICAgICAgICAgICAgICAvLyBTaG91bGQgbmV2ZXIgZ2V0IGhlcmUsIGRlZmVycmVkIGRhdGEgc2hvdWxkIGJlIGF3YWl0ZWQgZm9yIGZldGNoZXJzCiAgICAgICAgICAgICAgICAvLyBpbiByZXNvbHZlRGVmZXJyZWRSZXN1bHRzCiAgICAgICAgICAgICAgICByb3V0ZXJfaW52YXJpYW50KGZhbHNlLCAiVW5oYW5kbGVkIGZldGNoZXIgZGVmZXJyZWQgZGF0YSIpOwogICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICB2YXIgZG9uZUZldGNoZXIgPSB7CiAgICAgICAgICAgICAgICAgIHN0YXRlOiAiaWRsZSIsCiAgICAgICAgICAgICAgICAgIGRhdGE6IHJlc3VsdC5kYXRhLAogICAgICAgICAgICAgICAgICBmb3JtTWV0aG9kOiB1bmRlZmluZWQsCiAgICAgICAgICAgICAgICAgIGZvcm1BY3Rpb246IHVuZGVmaW5lZCwKICAgICAgICAgICAgICAgICAgZm9ybUVuY1R5cGU6IHVuZGVmaW5lZCwKICAgICAgICAgICAgICAgICAgZm9ybURhdGE6IHVuZGVmaW5lZCwKICAgICAgICAgICAgICAgICAgIiBfaGFzRmV0Y2hlckRvbmVBbnl0aGluZyAiOiB0cnVlCiAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgc3RhdGUuZmV0Y2hlcnMuc2V0KGtleSwgZG9uZUZldGNoZXIpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICBsb2FkZXJEYXRhOiBsb2FkZXJEYXRhLAogICAgICAgICAgICAgIGVycm9yczogZXJyb3JzCiAgICAgICAgICAgIH07CiAgICAgICAgICB9CgogICAgICAgICAgZnVuY3Rpb24gbWVyZ2VMb2FkZXJEYXRhKGxvYWRlckRhdGEsIG5ld0xvYWRlckRhdGEsIG1hdGNoZXMsIGVycm9ycykgewogICAgICAgICAgICB2YXIgbWVyZ2VkTG9hZGVyRGF0YSA9IF9leHRlbmRzKHt9LCBuZXdMb2FkZXJEYXRhKTt2YXIgX2l0ZXJhdG9yOSA9IF9jcmVhdGVGb3JPZkl0ZXJhdG9ySGVscGVyMigKCiAgICAgICAgICAgICAgbWF0Y2hlcyksX3N0ZXA5O3RyeSB7Zm9yIChfaXRlcmF0b3I5LnMoKTsgIShfc3RlcDkgPSBfaXRlcmF0b3I5Lm4oKSkuZG9uZTspIHt2YXIgbWF0Y2ggPSBfc3RlcDkudmFsdWU7CiAgICAgICAgICAgICAgICB2YXIgaWQgPSBtYXRjaC5yb3V0ZS5pZDsKCiAgICAgICAgICAgICAgICBpZiAobmV3TG9hZGVyRGF0YS5oYXNPd25Qcm9wZXJ0eShpZCkpIHsKICAgICAgICAgICAgICAgICAgaWYgKG5ld0xvYWRlckRhdGFbaWRdICE9PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgICAgICAgICBtZXJnZWRMb2FkZXJEYXRhW2lkXSA9IG5ld0xvYWRlckRhdGFbaWRdOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGxvYWRlckRhdGFbaWRdICE9PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgICAgICAgbWVyZ2VkTG9hZGVyRGF0YVtpZF0gPSBsb2FkZXJEYXRhW2lkXTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBpZiAoZXJyb3JzICYmIGVycm9ycy5oYXNPd25Qcm9wZXJ0eShpZCkpIHsKICAgICAgICAgICAgICAgICAgLy8gRG9uJ3Qga2VlcCBhbnkgbG9hZGVyIGRhdGEgYmVsb3cgdGhlIGJvdW5kYXJ5CiAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH19IGNhdGNoIChlcnIpIHtfaXRlcmF0b3I5LmUoZXJyKTt9IGZpbmFsbHkge19pdGVyYXRvcjkuZigpO30KCiAgICAgICAgICAgIHJldHVybiBtZXJnZWRMb2FkZXJEYXRhOwogICAgICAgICAgfSAvLyBGaW5kIHRoZSBuZWFyZXN0IGVycm9yIGJvdW5kYXJ5LCBsb29raW5nIHVwd2FyZHMgZnJvbSB0aGUgbGVhZiByb3V0ZSAob3IgdGhlCiAgICAgICAgICAvLyByb3V0ZSBzcGVjaWZpZWQgYnkgcm91dGVJZCkgZm9yIHRoZSBjbG9zZXN0IGFuY2VzdG9yIGVycm9yIGJvdW5kYXJ5LAogICAgICAgICAgLy8gZGVmYXVsdGluZyB0byB0aGUgcm9vdCBtYXRjaAoKCiAgICAgICAgICBmdW5jdGlvbiBmaW5kTmVhcmVzdEJvdW5kYXJ5KG1hdGNoZXMsIHJvdXRlSWQpIHsKICAgICAgICAgICAgdmFyIGVsaWdpYmxlTWF0Y2hlcyA9IHJvdXRlSWQgPyBtYXRjaGVzLnNsaWNlKDAsIG1hdGNoZXMuZmluZEluZGV4KChtKSA9PiBtLnJvdXRlLmlkID09PSByb3V0ZUlkKSArIDEpIDogX3RvQ29uc3VtYWJsZUFycmF5KG1hdGNoZXMpOwogICAgICAgICAgICByZXR1cm4gZWxpZ2libGVNYXRjaGVzLnJldmVyc2UoKS5maW5kKChtKSA9PiBtLnJvdXRlLmhhc0Vycm9yQm91bmRhcnkgPT09IHRydWUpIHx8IG1hdGNoZXNbMF07CiAgICAgICAgICB9CgogICAgICAgICAgZnVuY3Rpb24gZ2V0U2hvcnRDaXJjdWl0TWF0Y2hlcyhyb3V0ZXMpIHsKICAgICAgICAgICAgLy8gUHJlZmVyIGEgcm9vdCBsYXlvdXQgcm91dGUgaWYgcHJlc2VudCwgb3RoZXJ3aXNlIHNoaW0gaW4gYSByb3V0ZSBvYmplY3QKICAgICAgICAgICAgdmFyIHJvdXRlID0gcm91dGVzLmZpbmQoKHIpID0+IHIuaW5kZXggfHwgIXIucGF0aCB8fCByLnBhdGggPT09ICIvIikgfHwgewogICAgICAgICAgICAgIGlkOiAiX19zaGltLWVycm9yLXJvdXRlX18iCiAgICAgICAgICAgIH07CiAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgbWF0Y2hlczogW3sKICAgICAgICAgICAgICAgIHBhcmFtczoge30sCiAgICAgICAgICAgICAgICBwYXRobmFtZTogIiIsCiAgICAgICAgICAgICAgICBwYXRobmFtZUJhc2U6ICIiLAogICAgICAgICAgICAgICAgcm91dGU6IHJvdXRlCiAgICAgICAgICAgICAgfV0sCiAgICAgICAgICAgICAgcm91dGU6IHJvdXRlCiAgICAgICAgICAgIH07CiAgICAgICAgICB9CgogICAgICAgICAgZnVuY3Rpb24gZ2V0SW50ZXJuYWxSb3V0ZXJFcnJvcihzdGF0dXMsIF90ZW1wNCkgewogICAgICAgICAgICB2YXIgX3JlZjI5ID0KCgoKCiAgICAgICAgICAgICAgX3RlbXA0ID09PSB2b2lkIDAgPyB7fSA6IF90ZW1wNCxwYXRobmFtZSA9IF9yZWYyOS5wYXRobmFtZSxyb3V0ZUlkID0gX3JlZjI5LnJvdXRlSWQsbWV0aG9kID0gX3JlZjI5Lm1ldGhvZCx0eXBlID0gX3JlZjI5LnR5cGU7CiAgICAgICAgICAgIHZhciBzdGF0dXNUZXh0ID0gIlVua25vd24gU2VydmVyIEVycm9yIjsKICAgICAgICAgICAgdmFyIGVycm9yTWVzc2FnZSA9ICJVbmtub3duIEByZW1peC1ydW4vcm91dGVyIGVycm9yIjsKCiAgICAgICAgICAgIGlmIChzdGF0dXMgPT09IDQwMCkgewogICAgICAgICAgICAgIHN0YXR1c1RleHQgPSAiQmFkIFJlcXVlc3QiOwoKICAgICAgICAgICAgICBpZiAobWV0aG9kICYmIHBhdGhuYW1lICYmIHJvdXRlSWQpIHsKICAgICAgICAgICAgICAgIGVycm9yTWVzc2FnZSA9ICJZb3UgbWFkZSBhICIgKyBtZXRob2QgKyAiIHJlcXVlc3QgdG8gXCIiICsgcGF0aG5hbWUgKyAiXCIgYnV0ICIgKyAoImRpZCBub3QgcHJvdmlkZSBhIGBsb2FkZXJgIGZvciByb3V0ZSBcIiIgKyByb3V0ZUlkICsgIlwiLCAiKSArICJzbyB0aGVyZSBpcyBubyB3YXkgdG8gaGFuZGxlIHRoZSByZXF1ZXN0LiI7CiAgICAgICAgICAgICAgfSBlbHNlIGlmICh0eXBlID09PSAiZGVmZXItYWN0aW9uIikgewogICAgICAgICAgICAgICAgZXJyb3JNZXNzYWdlID0gImRlZmVyKCkgaXMgbm90IHN1cHBvcnRlZCBpbiBhY3Rpb25zIjsKICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgZXJyb3JNZXNzYWdlID0gIkNhbm5vdCBzdWJtaXQgYmluYXJ5IGZvcm0gZGF0YSB1c2luZyBHRVQiOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBlbHNlIGlmIChzdGF0dXMgPT09IDQwMykgewogICAgICAgICAgICAgIHN0YXR1c1RleHQgPSAiRm9yYmlkZGVuIjsKICAgICAgICAgICAgICBlcnJvck1lc3NhZ2UgPSAiUm91dGUgXCIiICsgcm91dGVJZCArICJcIiBkb2VzIG5vdCBtYXRjaCBVUkwgXCIiICsgcGF0aG5hbWUgKyAiXCIiOwogICAgICAgICAgICB9IGVsc2UgaWYgKHN0YXR1cyA9PT0gNDA0KSB7CiAgICAgICAgICAgICAgc3RhdHVzVGV4dCA9ICJOb3QgRm91bmQiOwogICAgICAgICAgICAgIGVycm9yTWVzc2FnZSA9ICJObyByb3V0ZSBtYXRjaGVzIFVSTCBcIiIgKyBwYXRobmFtZSArICJcIiI7CiAgICAgICAgICAgIH0gZWxzZSBpZiAoc3RhdHVzID09PSA0MDUpIHsKICAgICAgICAgICAgICBzdGF0dXNUZXh0ID0gIk1ldGhvZCBOb3QgQWxsb3dlZCI7CgogICAgICAgICAgICAgIGlmIChtZXRob2QgJiYgcGF0aG5hbWUgJiYgcm91dGVJZCkgewogICAgICAgICAgICAgICAgZXJyb3JNZXNzYWdlID0gIllvdSBtYWRlIGEgIiArIG1ldGhvZC50b1VwcGVyQ2FzZSgpICsgIiByZXF1ZXN0IHRvIFwiIiArIHBhdGhuYW1lICsgIlwiIGJ1dCAiICsgKCJkaWQgbm90IHByb3ZpZGUgYW4gYGFjdGlvbmAgZm9yIHJvdXRlIFwiIiArIHJvdXRlSWQgKyAiXCIsICIpICsgInNvIHRoZXJlIGlzIG5vIHdheSB0byBoYW5kbGUgdGhlIHJlcXVlc3QuIjsKICAgICAgICAgICAgICB9IGVsc2UgaWYgKG1ldGhvZCkgewogICAgICAgICAgICAgICAgZXJyb3JNZXNzYWdlID0gIkludmFsaWQgcmVxdWVzdCBtZXRob2QgXCIiICsgbWV0aG9kLnRvVXBwZXJDYXNlKCkgKyAiXCIiOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuIG5ldyByb3V0ZXJfRXJyb3JSZXNwb25zZShzdGF0dXMgfHwgNTAwLCBzdGF0dXNUZXh0LCBuZXcgRXJyb3IoZXJyb3JNZXNzYWdlKSwgdHJ1ZSk7CiAgICAgICAgICB9IC8vIEZpbmQgYW55IHJldHVybmVkIHJlZGlyZWN0IGVycm9ycywgc3RhcnRpbmcgZnJvbSB0aGUgbG93ZXN0IG1hdGNoCgoKICAgICAgICAgIGZ1bmN0aW9uIGZpbmRSZWRpcmVjdChyZXN1bHRzKSB7CiAgICAgICAgICAgIGZvciAodmFyIGkgPSByZXN1bHRzLmxlbmd0aCAtIDE7IGkgPj0gMDsgaS0tKSB7CiAgICAgICAgICAgICAgdmFyIHJlc3VsdCA9IHJlc3VsdHNbaV07CgogICAgICAgICAgICAgIGlmIChpc1JlZGlyZWN0UmVzdWx0KHJlc3VsdCkpIHsKICAgICAgICAgICAgICAgIHJldHVybiByZXN1bHQ7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9CgogICAgICAgICAgZnVuY3Rpb24gc3RyaXBIYXNoRnJvbVBhdGgocGF0aCkgewogICAgICAgICAgICB2YXIgcGFyc2VkUGF0aCA9IHR5cGVvZiBwYXRoID09PSAic3RyaW5nIiA/IHBhcnNlUGF0aChwYXRoKSA6IHBhdGg7CiAgICAgICAgICAgIHJldHVybiByb3V0ZXJfY3JlYXRlUGF0aChfZXh0ZW5kcyh7fSwgcGFyc2VkUGF0aCwgewogICAgICAgICAgICAgIGhhc2g6ICIiCiAgICAgICAgICAgIH0pKTsKICAgICAgICAgIH0KCiAgICAgICAgICBmdW5jdGlvbiBpc0hhc2hDaGFuZ2VPbmx5KGEsIGIpIHsKICAgICAgICAgICAgcmV0dXJuIGEucGF0aG5hbWUgPT09IGIucGF0aG5hbWUgJiYgYS5zZWFyY2ggPT09IGIuc2VhcmNoICYmIGEuaGFzaCAhPT0gYi5oYXNoOwogICAgICAgICAgfQoKICAgICAgICAgIGZ1bmN0aW9uIGlzRGVmZXJyZWRSZXN1bHQocmVzdWx0KSB7CiAgICAgICAgICAgIHJldHVybiByZXN1bHQudHlwZSA9PT0gUmVzdWx0VHlwZS5kZWZlcnJlZDsKICAgICAgICAgIH0KCiAgICAgICAgICBmdW5jdGlvbiBpc0Vycm9yUmVzdWx0KHJlc3VsdCkgewogICAgICAgICAgICByZXR1cm4gcmVzdWx0LnR5cGUgPT09IFJlc3VsdFR5cGUuZXJyb3I7CiAgICAgICAgICB9CgogICAgICAgICAgZnVuY3Rpb24gaXNSZWRpcmVjdFJlc3VsdChyZXN1bHQpIHsKICAgICAgICAgICAgcmV0dXJuIChyZXN1bHQgJiYgcmVzdWx0LnR5cGUpID09PSBSZXN1bHRUeXBlLnJlZGlyZWN0OwogICAgICAgICAgfQoKICAgICAgICAgIGZ1bmN0aW9uIGlzUmVzcG9uc2UodmFsdWUpIHsKICAgICAgICAgICAgcmV0dXJuIHZhbHVlICE9IG51bGwgJiYgdHlwZW9mIHZhbHVlLnN0YXR1cyA9PT0gIm51bWJlciIgJiYgdHlwZW9mIHZhbHVlLnN0YXR1c1RleHQgPT09ICJzdHJpbmciICYmIHR5cGVvZiB2YWx1ZS5oZWFkZXJzID09PSAib2JqZWN0IiAmJiB0eXBlb2YgdmFsdWUuYm9keSAhPT0gInVuZGVmaW5lZCI7CiAgICAgICAgICB9CgogICAgICAgICAgZnVuY3Rpb24gaXNSZWRpcmVjdFJlc3BvbnNlKHJlc3VsdCkgewogICAgICAgICAgICBpZiAoIWlzUmVzcG9uc2UocmVzdWx0KSkgewogICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdmFyIHN0YXR1cyA9IHJlc3VsdC5zdGF0dXM7CiAgICAgICAgICAgIHZhciBsb2NhdGlvbiA9IHJlc3VsdC5oZWFkZXJzLmdldCgiTG9jYXRpb24iKTsKICAgICAgICAgICAgcmV0dXJuIHN0YXR1cyA+PSAzMDAgJiYgc3RhdHVzIDw9IDM5OSAmJiBsb2NhdGlvbiAhPSBudWxsOwogICAgICAgICAgfQoKICAgICAgICAgIGZ1bmN0aW9uIGlzUXVlcnlSb3V0ZVJlc3BvbnNlKG9iaikgewogICAgICAgICAgICByZXR1cm4gb2JqICYmIGlzUmVzcG9uc2Uob2JqLnJlc3BvbnNlKSAmJiAob2JqLnR5cGUgPT09IFJlc3VsdFR5cGUuZGF0YSB8fCBSZXN1bHRUeXBlLmVycm9yKTsKICAgICAgICAgIH0KCiAgICAgICAgICBmdW5jdGlvbiBpc1ZhbGlkTWV0aG9kKG1ldGhvZCkgewogICAgICAgICAgICByZXR1cm4gdmFsaWRSZXF1ZXN0TWV0aG9kcy5oYXMobWV0aG9kKTsKICAgICAgICAgIH0KCiAgICAgICAgICBmdW5jdGlvbiBpc011dGF0aW9uTWV0aG9kKG1ldGhvZCkgewogICAgICAgICAgICByZXR1cm4gdmFsaWRNdXRhdGlvbk1ldGhvZHMuaGFzKG1ldGhvZCk7CiAgICAgICAgICB9ZnVuY3Rpb24KCiAgICAgICAgICByZXNvbHZlRGVmZXJyZWRSZXN1bHRzKF94NjksIF94NzAsIF94NzEsIF94NzIsIF94NzMsIF94NzQpIHtyZXR1cm4gX3Jlc29sdmVEZWZlcnJlZFJlc3VsdHMuYXBwbHkodGhpcywgYXJndW1lbnRzKTt9ZnVuY3Rpb24gX3Jlc29sdmVEZWZlcnJlZFJlc3VsdHMoKSB7X3Jlc29sdmVEZWZlcnJlZFJlc3VsdHMgPSBfYXN5bmNUb0dlbmVyYXRvcjIoIC8qI19fUFVSRV9fKi9fcmVnZW5lcmF0b3JSdW50aW1lMigpLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTE3KGN1cnJlbnRNYXRjaGVzLCBtYXRjaGVzVG9Mb2FkLCByZXN1bHRzLCBzaWduYWwsIGlzRmV0Y2hlciwgY3VycmVudExvYWRlckRhdGEpIHt2YXIgX2xvb3AyLCBpbmRleDtyZXR1cm4gX3JlZ2VuZXJhdG9yUnVudGltZTIoKS53cmFwKGZ1bmN0aW9uIF9jYWxsZWUxNyQoX2NvbnRleHQxOSkge3doaWxlICgxKSBzd2l0Y2ggKF9jb250ZXh0MTkucHJldiA9IF9jb250ZXh0MTkubmV4dCkge2Nhc2UgMDpfbG9vcDIgPSAvKiNfX1BVUkVfXyovX3JlZ2VuZXJhdG9yUnVudGltZTIoKS5tYXJrKGZ1bmN0aW9uIF9sb29wMihpbmRleCkge3ZhciByZXN1bHQsIG1hdGNoLCBjdXJyZW50TWF0Y2gsIGlzUmV2YWxpZGF0aW5nTG9hZGVyO3JldHVybiBfcmVnZW5lcmF0b3JSdW50aW1lMigpLndyYXAoZnVuY3Rpb24gX2xvb3AyJChfY29udGV4dDE4KSB7d2hpbGUgKDEpIHN3aXRjaCAoX2NvbnRleHQxOC5wcmV2ID0gX2NvbnRleHQxOC5uZXh0KSB7Y2FzZSAwOgoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdCA9IHJlc3VsdHNbaW5kZXhdOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgbWF0Y2ggPSBtYXRjaGVzVG9Mb2FkW2luZGV4XTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbnRNYXRjaCA9IGN1cnJlbnRNYXRjaGVzLmZpbmQoKG0pID0+IG0ucm91dGUuaWQgPT09IG1hdGNoLnJvdXRlLmlkKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlzUmV2YWxpZGF0aW5nTG9hZGVyID0gY3VycmVudE1hdGNoICE9IG51bGwgJiYgIWlzTmV3Um91dGVJbnN0YW5jZShjdXJyZW50TWF0Y2gsIG1hdGNoKSAmJiAoY3VycmVudExvYWRlckRhdGEgJiYgY3VycmVudExvYWRlckRhdGFbbWF0Y2gucm91dGUuaWRdKSAhPT0gdW5kZWZpbmVkO2lmICghKAoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlzRGVmZXJyZWRSZXN1bHQocmVzdWx0KSAmJiAoaXNGZXRjaGVyIHx8IGlzUmV2YWxpZGF0aW5nTG9hZGVyKSkpIHtfY29udGV4dDE4Lm5leHQgPSA3O2JyZWFrO31fY29udGV4dDE4Lm5leHQgPSA3O3JldHVybiAoCgoKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmVEZWZlcnJlZERhdGEocmVzdWx0LCBzaWduYWwsIGlzRmV0Y2hlcikudGhlbigocmVzdWx0KSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3VsdCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0c1tpbmRleF0gPSByZXN1bHQgfHwgcmVzdWx0c1tpbmRleF07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KSk7Y2FzZSA3OmNhc2UgImVuZCI6cmV0dXJuIF9jb250ZXh0MTguc3RvcCgpO319LCBfbG9vcDIpO30pO2luZGV4ID0gMDtjYXNlIDI6aWYgKCEoaW5kZXggPCByZXN1bHRzLmxlbmd0aCkpIHtfY29udGV4dDE5Lm5leHQgPSA3O2JyZWFrO31yZXR1cm4gX2NvbnRleHQxOS5kZWxlZ2F0ZVlpZWxkKF9sb29wMihpbmRleCksICJ0MCIsIDQpO2Nhc2UgNDppbmRleCsrO19jb250ZXh0MTkubmV4dCA9IDI7YnJlYWs7Y2FzZSA3OmNhc2UgImVuZCI6cmV0dXJuIF9jb250ZXh0MTkuc3RvcCgpO319LCBfY2FsbGVlMTcpO30pKTtyZXR1cm4gX3Jlc29sdmVEZWZlcnJlZFJlc3VsdHMuYXBwbHkodGhpcywgYXJndW1lbnRzKTt9ZnVuY3Rpb24KCgoKCiAgICAgICAgICByZXNvbHZlRGVmZXJyZWREYXRhKF94NzUsIF94NzYsIF94NzcpIHtyZXR1cm4gX3Jlc29sdmVEZWZlcnJlZERhdGEuYXBwbHkodGhpcywgYXJndW1lbnRzKTt9ZnVuY3Rpb24gX3Jlc29sdmVEZWZlcnJlZERhdGEoKSB7X3Jlc29sdmVEZWZlcnJlZERhdGEgPSBfYXN5bmNUb0dlbmVyYXRvcjIoIC8qI19fUFVSRV9fKi9fcmVnZW5lcmF0b3JSdW50aW1lMigpLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTE4KHJlc3VsdCwgc2lnbmFsLCB1bndyYXApIHt2YXIgYWJvcnRlZDtyZXR1cm4gX3JlZ2VuZXJhdG9yUnVudGltZTIoKS53cmFwKGZ1bmN0aW9uIF9jYWxsZWUxOCQoX2NvbnRleHQyMCkge3doaWxlICgxKSBzd2l0Y2ggKF9jb250ZXh0MjAucHJldiA9IF9jb250ZXh0MjAubmV4dCkge2Nhc2UgMDoKICAgICAgICAgICAgICAgICAgICBpZiAodW53cmFwID09PSB2b2lkIDApIHsKICAgICAgICAgICAgICAgICAgICAgIHVud3JhcCA9IGZhbHNlOwogICAgICAgICAgICAgICAgICAgIH1fY29udGV4dDIwLm5leHQgPSAzO3JldHVybiAoCgogICAgICAgICAgICAgICAgICAgICAgcmVzdWx0LmRlZmVycmVkRGF0YS5yZXNvbHZlRGF0YShzaWduYWwpKTtjYXNlIDM6YWJvcnRlZCA9IF9jb250ZXh0MjAuc2VudDtpZiAoIQoKICAgICAgICAgICAgICAgICAgICBhYm9ydGVkKSB7X2NvbnRleHQyMC5uZXh0ID0gNjticmVhazt9cmV0dXJuIF9jb250ZXh0MjAuYWJydXB0KCJyZXR1cm4iKTtjYXNlIDY6aWYgKCEKCgoKICAgICAgICAgICAgICAgICAgICB1bndyYXApIHtfY29udGV4dDIwLm5leHQgPSAxNDticmVhazt9X2NvbnRleHQyMC5wcmV2ID0gNztyZXR1cm4gX2NvbnRleHQyMC5hYnJ1cHQoInJldHVybiIsCgogICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgIHR5cGU6IFJlc3VsdFR5cGUuZGF0YSwKICAgICAgICAgICAgICAgICAgICAgIGRhdGE6IHJlc3VsdC5kZWZlcnJlZERhdGEudW53cmFwcGVkRGF0YQogICAgICAgICAgICAgICAgICAgIH0pO2Nhc2UgMTE6X2NvbnRleHQyMC5wcmV2ID0gMTE7X2NvbnRleHQyMC50MCA9IF9jb250ZXh0MjBbImNhdGNoIl0oNyk7cmV0dXJuIF9jb250ZXh0MjAuYWJydXB0KCJyZXR1cm4iLAoKCiAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgdHlwZTogUmVzdWx0VHlwZS5lcnJvciwKICAgICAgICAgICAgICAgICAgICAgIGVycm9yOiBfY29udGV4dDIwLnQwCiAgICAgICAgICAgICAgICAgICAgfSk7Y2FzZSAxNDpyZXR1cm4gX2NvbnRleHQyMC5hYnJ1cHQoInJldHVybiIsCgoKCiAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgdHlwZTogUmVzdWx0VHlwZS5kYXRhLAogICAgICAgICAgICAgICAgICAgICAgZGF0YTogcmVzdWx0LmRlZmVycmVkRGF0YS5kYXRhCiAgICAgICAgICAgICAgICAgICAgfSk7Y2FzZSAxNTpjYXNlICJlbmQiOnJldHVybiBfY29udGV4dDIwLnN0b3AoKTt9fSwgX2NhbGxlZTE4LCBudWxsLCBbWzcsIDExXV0pO30pKTtyZXR1cm4gX3Jlc29sdmVEZWZlcnJlZERhdGEuYXBwbHkodGhpcywgYXJndW1lbnRzKTt9CgoKICAgICAgICAgIGZ1bmN0aW9uIGhhc05ha2VkSW5kZXhRdWVyeShzZWFyY2gpIHsKICAgICAgICAgICAgcmV0dXJuIG5ldyBVUkxTZWFyY2hQYXJhbXMoc2VhcmNoKS5nZXRBbGwoImluZGV4Iikuc29tZSgodikgPT4gdiA9PT0gIiIpOwogICAgICAgICAgfSAvLyBOb3RlOiBUaGlzIHNob3VsZCBtYXRjaCB0aGUgZm9ybWF0IGV4cG9ydGVkIGJ5IHVzZU1hdGNoZXMsIHNvIGlmIHlvdSBjaGFuZ2UKICAgICAgICAgIC8vIHRoaXMgcGxlYXNlIGFsc28gY2hhbmdlIHRoYXQgOikgIEV2ZW50dWFsbHkgd2UnbGwgRFJZIHRoaXMgdXAKCgogICAgICAgICAgZnVuY3Rpb24gY3JlYXRlVXNlTWF0Y2hlc01hdGNoKG1hdGNoLCBsb2FkZXJEYXRhKSB7CiAgICAgICAgICAgIHZhcgogICAgICAgICAgICAgIHJvdXRlID0KCgogICAgICAgICAgICAgIG1hdGNoLnJvdXRlLHBhdGhuYW1lID0gbWF0Y2gucGF0aG5hbWUscGFyYW1zID0gbWF0Y2gucGFyYW1zOwogICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgIGlkOiByb3V0ZS5pZCwKICAgICAgICAgICAgICBwYXRobmFtZTogcGF0aG5hbWUsCiAgICAgICAgICAgICAgcGFyYW1zOiBwYXJhbXMsCiAgICAgICAgICAgICAgZGF0YTogbG9hZGVyRGF0YVtyb3V0ZS5pZF0sCiAgICAgICAgICAgICAgaGFuZGxlOiByb3V0ZS5oYW5kbGUKICAgICAgICAgICAgfTsKICAgICAgICAgIH0KCiAgICAgICAgICBmdW5jdGlvbiBnZXRUYXJnZXRNYXRjaChtYXRjaGVzLCBsb2NhdGlvbikgewogICAgICAgICAgICB2YXIgc2VhcmNoID0gdHlwZW9mIGxvY2F0aW9uID09PSAic3RyaW5nIiA/IHBhcnNlUGF0aChsb2NhdGlvbikuc2VhcmNoIDogbG9jYXRpb24uc2VhcmNoOwoKICAgICAgICAgICAgaWYgKG1hdGNoZXNbbWF0Y2hlcy5sZW5ndGggLSAxXS5yb3V0ZS5pbmRleCAmJiBoYXNOYWtlZEluZGV4UXVlcnkoc2VhcmNoIHx8ICIiKSkgewogICAgICAgICAgICAgIC8vIFJldHVybiB0aGUgbGVhZiBpbmRleCByb3V0ZSB3aGVuIGluZGV4IGlzIHByZXNlbnQKICAgICAgICAgICAgICByZXR1cm4gbWF0Y2hlc1ttYXRjaGVzLmxlbmd0aCAtIDFdOwogICAgICAgICAgICB9IC8vIE90aGVyd2lzZSBncmFiIHRoZSBkZWVwZXN0ICJwYXRoIGNvbnRyaWJ1dGluZyIgbWF0Y2ggKGlnbm9yaW5nIGluZGV4IGFuZAogICAgICAgICAgICAvLyBwYXRobGVzcyBsYXlvdXQgcm91dGVzKQoKCiAgICAgICAgICAgIHZhciBwYXRoTWF0Y2hlcyA9IGdldFBhdGhDb250cmlidXRpbmdNYXRjaGVzKG1hdGNoZXMpOwogICAgICAgICAgICByZXR1cm4gcGF0aE1hdGNoZXNbcGF0aE1hdGNoZXMubGVuZ3RoIC0gMV07CiAgICAgICAgICB9IC8vI2VuZHJlZ2lvbgoKCgoKICAgICAgICAgIC8vIEVYVEVSTkFMIE1PRFVMRTogLi9ub2RlX21vZHVsZXMvcmVhY3QvaW5kZXguanMKICAgICAgICAgIHZhciByZWFjdCA9IF9fd2VicGFja19yZXF1aXJlX18oMjk0KTsKICAgICAgICAgIHZhciByZWFjdF9uYW1lc3BhY2VPYmplY3QgPSAvKiNfX1BVUkVfXyovX193ZWJwYWNrX3JlcXVpcmVfXy50KHJlYWN0LCAyKTsKICAgICAgICAgIDsgLy8gQ09OQ0FURU5BVEVEIE1PRFVMRTogLi9ub2RlX21vZHVsZXMvcmVhY3Qtcm91dGVyL2Rpc3QvaW5kZXguanMKICAgICAgICAgIC8qKgogICAgICAgICAgICogUmVhY3QgUm91dGVyIHY2LjcuMAogICAgICAgICAgICoKICAgICAgICAgICAqIENvcHlyaWdodCAoYykgUmVtaXggU29mdHdhcmUgSW5jLgogICAgICAgICAgICoKICAgICAgICAgICAqIFRoaXMgc291cmNlIGNvZGUgaXMgbGljZW5zZWQgdW5kZXIgdGhlIE1JVCBsaWNlbnNlIGZvdW5kIGluIHRoZQogICAgICAgICAgICogTElDRU5TRS5tZCBmaWxlIGluIHRoZSByb290IGRpcmVjdG9yeSBvZiB0aGlzIHNvdXJjZSB0cmVlLgogICAgICAgICAgICoKICAgICAgICAgICAqIEBsaWNlbnNlIE1JVAogICAgICAgICAgICovCgoKCgogICAgICAgICAgZnVuY3Rpb24gZGlzdF9leHRlbmRzKCkgewogICAgICAgICAgICBkaXN0X2V4dGVuZHMgPSBPYmplY3QuYXNzaWduID8gT2JqZWN0LmFzc2lnbi5iaW5kKCkgOiBmdW5jdGlvbiAodGFyZ2V0KSB7CiAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDE7IGkgPCBhcmd1bWVudHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICAgIHZhciBzb3VyY2UgPSBhcmd1bWVudHNbaV07CgogICAgICAgICAgICAgICAgZm9yICh2YXIga2V5IGluIHNvdXJjZSkgewogICAgICAgICAgICAgICAgICBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKHNvdXJjZSwga2V5KSkgewogICAgICAgICAgICAgICAgICAgIHRhcmdldFtrZXldID0gc291cmNlW2tleV07CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIHJldHVybiB0YXJnZXQ7CiAgICAgICAgICAgIH07CiAgICAgICAgICAgIHJldHVybiBkaXN0X2V4dGVuZHMuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgICAgIH0KCiAgICAgICAgICAvKioKICAgICAgICAgICAqIENvcHlyaWdodCAoYykgRmFjZWJvb2ssIEluYy4gYW5kIGl0cyBhZmZpbGlhdGVzLgogICAgICAgICAgICoKICAgICAgICAgICAqIFRoaXMgc291cmNlIGNvZGUgaXMgbGljZW5zZWQgdW5kZXIgdGhlIE1JVCBsaWNlbnNlIGZvdW5kIGluIHRoZQogICAgICAgICAgICogTElDRU5TRSBmaWxlIGluIHRoZSByb290IGRpcmVjdG9yeSBvZiB0aGlzIHNvdXJjZSB0cmVlLgogICAgICAgICAgICovCiAgICAgICAgICAvKioKICAgICAgICAgICAqIGlubGluZWQgT2JqZWN0LmlzIHBvbHlmaWxsIHRvIGF2b2lkIHJlcXVpcmluZyBjb25zdW1lcnMgc2hpcCB0aGVpciBvd24KICAgICAgICAgICAqIGh0dHBzOi8vZGV2ZWxvcGVyLm1vemlsbGEub3JnL2VuLVVTL2RvY3MvV2ViL0phdmFTY3JpcHQvUmVmZXJlbmNlL0dsb2JhbF9PYmplY3RzL09iamVjdC9pcwogICAgICAgICAgICovCgogICAgICAgICAgZnVuY3Rpb24gaXNQb2x5ZmlsbCh4LCB5KSB7CiAgICAgICAgICAgIHJldHVybiB4ID09PSB5ICYmICh4ICE9PSAwIHx8IDEgLyB4ID09PSAxIC8geSkgfHwgeCAhPT0geCAmJiB5ICE9PSB5IC8vIGVzbGludC1kaXNhYmxlLWxpbmUgbm8tc2VsZi1jb21wYXJlCiAgICAgICAgICAgIDsKICAgICAgICAgIH0KCiAgICAgICAgICB2YXIgaXMgPSB0eXBlb2YgT2JqZWN0LmlzID09PSAiZnVuY3Rpb24iID8gT2JqZWN0LmlzIDogaXNQb2x5ZmlsbDsgLy8gSW50ZW50aW9uYWxseSBub3QgdXNpbmcgbmFtZWQgaW1wb3J0cyBiZWNhdXNlIFJvbGx1cCB1c2VzIGR5bmFtaWMKICAgICAgICAgIC8vIGRpc3BhdGNoIGZvciBDb21tb25KUyBpbnRlcm9wIG5hbWVkIGltcG9ydHMuCgogICAgICAgICAgdmFyCiAgICAgICAgICAgIHVzZVN0YXRlID0KCgoKICAgICAgICAgICAgcmVhY3RfbmFtZXNwYWNlT2JqZWN0LnVzZVN0YXRlLHVzZUVmZmVjdCA9IHJlYWN0X25hbWVzcGFjZU9iamVjdC51c2VFZmZlY3QsdXNlTGF5b3V0RWZmZWN0ID0gcmVhY3RfbmFtZXNwYWNlT2JqZWN0LnVzZUxheW91dEVmZmVjdCx1c2VEZWJ1Z1ZhbHVlID0gcmVhY3RfbmFtZXNwYWNlT2JqZWN0LnVzZURlYnVnVmFsdWU7CiAgICAgICAgICB2YXIgZGlkV2Fybk9sZDE4QWxwaGEgPSBmYWxzZTsKICAgICAgICAgIHZhciBkaWRXYXJuVW5jYWNoZWRHZXRTbmFwc2hvdCA9IGZhbHNlOyAvLyBEaXNjbGFpbWVyOiBUaGlzIHNoaW0gYnJlYWtzIG1hbnkgb2YgdGhlIHJ1bGVzIG9mIFJlYWN0LCBhbmQgb25seSB3b3JrcwogICAgICAgICAgLy8gYmVjYXVzZSBvZiBhIHZlcnkgcGFydGljdWxhciBzZXQgb2YgaW1wbGVtZW50YXRpb24gZGV0YWlscyBhbmQgYXNzdW1wdGlvbnMKICAgICAgICAgIC8vIC0tIGNoYW5nZSBhbnkgb25lIG9mIHRoZW0gYW5kIGl0IHdpbGwgYnJlYWsuIFRoZSBtb3N0IGltcG9ydGFudCBhc3N1bXB0aW9uCiAgICAgICAgICAvLyBpcyB0aGF0IHVwZGF0ZXMgYXJlIGFsd2F5cyBzeW5jaHJvbm91cywgYmVjYXVzZSBjb25jdXJyZW50IHJlbmRlcmluZyBpcwogICAgICAgICAgLy8gb25seSBhdmFpbGFibGUgaW4gdmVyc2lvbnMgb2YgUmVhY3QgdGhhdCBhbHNvIGhhdmUgYSBidWlsdC1pbgogICAgICAgICAgLy8gdXNlU3luY0V4dGVybmFsU3RvcmUgQVBJLiBBbmQgd2Ugb25seSB1c2UgdGhpcyBzaGltIHdoZW4gdGhlIGJ1aWx0LWluIEFQSQogICAgICAgICAgLy8gZG9lcyBub3QgZXhpc3QuCiAgICAgICAgICAvLwogICAgICAgICAgLy8gRG8gbm90IGFzc3VtZSB0aGF0IHRoZSBjbGV2ZXIgaGFja3MgdXNlZCBieSB0aGlzIGhvb2sgYWxzbyB3b3JrIGluIGdlbmVyYWwuCiAgICAgICAgICAvLyBUaGUgcG9pbnQgb2YgdGhpcyBzaGltIGlzIHRvIHJlcGxhY2UgdGhlIG5lZWQgZm9yIGhhY2tzIGJ5IG90aGVyIGxpYnJhcmllcy4KCiAgICAgICAgICBmdW5jdGlvbiB1c2VTeW5jRXh0ZXJuYWxTdG9yZSQyKHN1YnNjcmliZSwgZ2V0U25hcHNob3QsIC8vIE5vdGU6IFRoZSBzaGltIGRvZXMgbm90IHVzZSBnZXRTZXJ2ZXJTbmFwc2hvdCwgYmVjYXVzZSBwcmUtMTggdmVyc2lvbnMgb2YKICAgICAgICAgIC8vIFJlYWN0IGRvIG5vdCBleHBvc2UgYSB3YXkgdG8gY2hlY2sgaWYgd2UncmUgaHlkcmF0aW5nLiBTbyB1c2VycyBvZiB0aGUgc2hpbQogICAgICAgICAgLy8gd2lsbCBuZWVkIHRvIHRyYWNrIHRoYXQgdGhlbXNlbHZlcyBhbmQgcmV0dXJuIHRoZSBjb3JyZWN0IHZhbHVlCiAgICAgICAgICAvLyBmcm9tIGBnZXRTbmFwc2hvdGAuCiAgICAgICAgICBnZXRTZXJ2ZXJTbmFwc2hvdCkgewogICAgICAgICAgICBpZiAoZmFsc2UpIHt9IC8vIFJlYWQgdGhlIGN1cnJlbnQgc25hcHNob3QgZnJvbSB0aGUgc3RvcmUgb24gZXZlcnkgcmVuZGVyLiBBZ2FpbiwgdGhpcwogICAgICAgICAgICAvLyBicmVha3MgdGhlIHJ1bGVzIG9mIFJlYWN0LCBhbmQgb25seSB3b3JrcyBoZXJlIGJlY2F1c2Ugb2Ygc3BlY2lmaWMKICAgICAgICAgICAgLy8gaW1wbGVtZW50YXRpb24gZGV0YWlscywgbW9zdCBpbXBvcnRhbnRseSB0aGF0IHVwZGF0ZXMgYXJlCiAgICAgICAgICAgIC8vIGFsd2F5cyBzeW5jaHJvbm91cy4KCgogICAgICAgICAgICB2YXIgdmFsdWUgPSBnZXRTbmFwc2hvdCgpOwoKICAgICAgICAgICAgaWYgKGZhbHNlKSB7fSAvLyBCZWNhdXNlIHVwZGF0ZXMgYXJlIHN5bmNocm9ub3VzLCB3ZSBkb24ndCBxdWV1ZSB0aGVtLiBJbnN0ZWFkIHdlIGZvcmNlIGEKICAgICAgICAgICAgLy8gcmUtcmVuZGVyIHdoZW5ldmVyIHRoZSBzdWJzY3JpYmVkIHN0YXRlIGNoYW5nZXMgYnkgdXBkYXRpbmcgYW4gc29tZQogICAgICAgICAgICAvLyBhcmJpdHJhcnkgdXNlU3RhdGUgaG9vay4gVGhlbiwgZHVyaW5nIHJlbmRlciwgd2UgY2FsbCBnZXRTbmFwc2hvdCB0byByZWFkCiAgICAgICAgICAgIC8vIHRoZSBjdXJyZW50IHZhbHVlLgogICAgICAgICAgICAvLwogICAgICAgICAgICAvLyBCZWNhdXNlIHdlIGRvbid0IGFjdHVhbGx5IHVzZSB0aGUgc3RhdGUgcmV0dXJuZWQgYnkgdGhlIHVzZVN0YXRlIGhvb2ssIHdlCiAgICAgICAgICAgIC8vIGNhbiBzYXZlIGEgYml0IG9mIG1lbW9yeSBieSBzdG9yaW5nIG90aGVyIHN0dWZmIGluIHRoYXQgc2xvdC4KICAgICAgICAgICAgLy8KICAgICAgICAgICAgLy8gVG8gaW1wbGVtZW50IHRoZSBlYXJseSBiYWlsb3V0LCB3ZSBuZWVkIHRvIHRyYWNrIHNvbWUgdGhpbmdzIG9uIGEgbXV0YWJsZQogICAgICAgICAgICAvLyBvYmplY3QuIFVzdWFsbHksIHdlIHdvdWxkIHB1dCB0aGF0IGluIGEgdXNlUmVmIGhvb2ssIGJ1dCB3ZSBjYW4gc3Rhc2ggaXQgaW4KICAgICAgICAgICAgLy8gb3VyIHVzZVN0YXRlIGhvb2sgaW5zdGVhZC4KICAgICAgICAgICAgLy8KICAgICAgICAgICAgLy8gVG8gZm9yY2UgYSByZS1yZW5kZXIsIHdlIGNhbGwgZm9yY2VVcGRhdGUoe2luc3R9KS4gVGhhdCB3b3JrcyBiZWNhdXNlIHRoZQogICAgICAgICAgICAvLyBuZXcgb2JqZWN0IGFsd2F5cyBmYWlscyBhbiBlcXVhbGl0eSBjaGVjay4KCgogICAgICAgICAgICB2YXIgX3VzZVN0YXRlMyA9CgogICAgICAgICAgICAgIHVzZVN0YXRlKHsKICAgICAgICAgICAgICAgIGluc3Q6IHsKICAgICAgICAgICAgICAgICAgdmFsdWU6IHZhbHVlLAogICAgICAgICAgICAgICAgICBnZXRTbmFwc2hvdDogZ2V0U25hcHNob3QKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9KSxfdXNlU3RhdGU0ID0gX3NsaWNlZFRvQXJyYXkyKF91c2VTdGF0ZTMsIDIpLGluc3QgPSBfdXNlU3RhdGU0WzBdLmluc3QsZm9yY2VVcGRhdGUgPSBfdXNlU3RhdGU0WzFdOyAvLyBUcmFjayB0aGUgbGF0ZXN0IGdldFNuYXBzaG90IGZ1bmN0aW9uIHdpdGggYSByZWYuIFRoaXMgbmVlZHMgdG8gYmUgdXBkYXRlZAogICAgICAgICAgICAvLyBpbiB0aGUgbGF5b3V0IHBoYXNlIHNvIHdlIGNhbiBhY2Nlc3MgaXQgZHVyaW5nIHRoZSB0ZWFyaW5nIGNoZWNrIHRoYXQKICAgICAgICAgICAgLy8gaGFwcGVucyBvbiBzdWJzY3JpYmUuCgogICAgICAgICAgICB1c2VMYXlvdXRFZmZlY3QoKCkgPT4gewogICAgICAgICAgICAgIGluc3QudmFsdWUgPSB2YWx1ZTsKICAgICAgICAgICAgICBpbnN0LmdldFNuYXBzaG90ID0gZ2V0U25hcHNob3Q7IC8vIFdoZW5ldmVyIGdldFNuYXBzaG90IG9yIHN1YnNjcmliZSBjaGFuZ2VzLCB3ZSBuZWVkIHRvIGNoZWNrIGluIHRoZQogICAgICAgICAgICAgIC8vIGNvbW1pdCBwaGFzZSBpZiB0aGVyZSB3YXMgYW4gaW50ZXJsZWF2ZWQgbXV0YXRpb24uIEluIGNvbmN1cnJlbnQgbW9kZQogICAgICAgICAgICAgIC8vIHRoaXMgY2FuIGhhcHBlbiBhbGwgdGhlIHRpbWUsIGJ1dCBldmVuIGluIHN5bmNocm9ub3VzIG1vZGUsIGFuIGVhcmxpZXIKICAgICAgICAgICAgICAvLyBlZmZlY3QgbWF5IGhhdmUgbXV0YXRlZCB0aGUgc3RvcmUuCgogICAgICAgICAgICAgIGlmIChjaGVja0lmU25hcHNob3RDaGFuZ2VkKGluc3QpKSB7CiAgICAgICAgICAgICAgICAvLyBGb3JjZSBhIHJlLXJlbmRlci4KICAgICAgICAgICAgICAgIGZvcmNlVXBkYXRlKHsKICAgICAgICAgICAgICAgICAgaW5zdDogaW5zdAogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgfSAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgcmVhY3QtaG9va3MvZXhoYXVzdGl2ZS1kZXBzCgogICAgICAgICAgICB9LCBbc3Vic2NyaWJlLCB2YWx1ZSwgZ2V0U25hcHNob3RdKTsKICAgICAgICAgICAgdXNlRWZmZWN0KCgpID0+IHsKICAgICAgICAgICAgICAvLyBDaGVjayBmb3IgY2hhbmdlcyByaWdodCBiZWZvcmUgc3Vic2NyaWJpbmcuIFN1YnNlcXVlbnQgY2hhbmdlcyB3aWxsIGJlCiAgICAgICAgICAgICAgLy8gZGV0ZWN0ZWQgaW4gdGhlIHN1YnNjcmlwdGlvbiBoYW5kbGVyLgogICAgICAgICAgICAgIGlmIChjaGVja0lmU25hcHNob3RDaGFuZ2VkKGluc3QpKSB7CiAgICAgICAgICAgICAgICAvLyBGb3JjZSBhIHJlLXJlbmRlci4KICAgICAgICAgICAgICAgIGZvcmNlVXBkYXRlKHsKICAgICAgICAgICAgICAgICAgaW5zdDogaW5zdAogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICB2YXIgaGFuZGxlU3RvcmVDaGFuZ2UgPSAoKSA9PiB7CiAgICAgICAgICAgICAgICAvLyBUT0RPOiBCZWNhdXNlIHRoZXJlIGlzIG5vIGNyb3NzLXJlbmRlcmVyIEFQSSBmb3IgYmF0Y2hpbmcgdXBkYXRlcywgaXQncwogICAgICAgICAgICAgICAgLy8gdXAgdG8gdGhlIGNvbnN1bWVyIG9mIHRoaXMgbGlicmFyeSB0byB3cmFwIHRoZWlyIHN1YnNjcmlwdGlvbiBldmVudAogICAgICAgICAgICAgICAgLy8gd2l0aCB1bnN0YWJsZV9iYXRjaGVkVXBkYXRlcy4gU2hvdWxkIHdlIHRyeSB0byBkZXRlY3Qgd2hlbiB0aGlzIGlzbid0CiAgICAgICAgICAgICAgICAvLyB0aGUgY2FzZSBhbmQgcHJpbnQgYSB3YXJuaW5nIGluIGRldmVsb3BtZW50PwogICAgICAgICAgICAgICAgLy8gVGhlIHN0b3JlIGNoYW5nZWQuIENoZWNrIGlmIHRoZSBzbmFwc2hvdCBjaGFuZ2VkIHNpbmNlIHRoZSBsYXN0IHRpbWUgd2UKICAgICAgICAgICAgICAgIC8vIHJlYWQgZnJvbSB0aGUgc3RvcmUuCiAgICAgICAgICAgICAgICBpZiAoY2hlY2tJZlNuYXBzaG90Q2hhbmdlZChpbnN0KSkgewogICAgICAgICAgICAgICAgICAvLyBGb3JjZSBhIHJlLXJlbmRlci4KICAgICAgICAgICAgICAgICAgZm9yY2VVcGRhdGUoewogICAgICAgICAgICAgICAgICAgIGluc3Q6IGluc3QKICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfTsgLy8gU3Vic2NyaWJlIHRvIHRoZSBzdG9yZSBhbmQgcmV0dXJuIGEgY2xlYW4tdXAgZnVuY3Rpb24uCgoKICAgICAgICAgICAgICByZXR1cm4gc3Vic2NyaWJlKGhhbmRsZVN0b3JlQ2hhbmdlKTsgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIHJlYWN0LWhvb2tzL2V4aGF1c3RpdmUtZGVwcwogICAgICAgICAgICB9LCBbc3Vic2NyaWJlXSk7CiAgICAgICAgICAgIHVzZURlYnVnVmFsdWUodmFsdWUpOwogICAgICAgICAgICByZXR1cm4gdmFsdWU7CiAgICAgICAgICB9CgogICAgICAgICAgZnVuY3Rpb24gY2hlY2tJZlNuYXBzaG90Q2hhbmdlZChpbnN0KSB7CiAgICAgICAgICAgIHZhciBsYXRlc3RHZXRTbmFwc2hvdCA9IGluc3QuZ2V0U25hcHNob3Q7CiAgICAgICAgICAgIHZhciBwcmV2VmFsdWUgPSBpbnN0LnZhbHVlOwoKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICB2YXIgbmV4dFZhbHVlID0gbGF0ZXN0R2V0U25hcHNob3QoKTsKICAgICAgICAgICAgICByZXR1cm4gIWlzKHByZXZWYWx1ZSwgbmV4dFZhbHVlKTsKICAgICAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgfQogICAgICAgICAgfQoKICAgICAgICAgIC8qKgogICAgICAgICAgICogQ29weXJpZ2h0IChjKSBGYWNlYm9vaywgSW5jLiBhbmQgaXRzIGFmZmlsaWF0ZXMuCiAgICAgICAgICAgKgogICAgICAgICAgICogVGhpcyBzb3VyY2UgY29kZSBpcyBsaWNlbnNlZCB1bmRlciB0aGUgTUlUIGxpY2Vuc2UgZm91bmQgaW4gdGhlCiAgICAgICAgICAgKiBMSUNFTlNFIGZpbGUgaW4gdGhlIHJvb3QgZGlyZWN0b3J5IG9mIHRoaXMgc291cmNlIHRyZWUuCiAgICAgICAgICAgKgogICAgICAgICAgICogQGZsb3cKICAgICAgICAgICAqLwogICAgICAgICAgZnVuY3Rpb24gdXNlU3luY0V4dGVybmFsU3RvcmUkMShzdWJzY3JpYmUsIGdldFNuYXBzaG90LCBnZXRTZXJ2ZXJTbmFwc2hvdCkgewogICAgICAgICAgICAvLyBOb3RlOiBUaGUgc2hpbSBkb2VzIG5vdCB1c2UgZ2V0U2VydmVyU25hcHNob3QsIGJlY2F1c2UgcHJlLTE4IHZlcnNpb25zIG9mCiAgICAgICAgICAgIC8vIFJlYWN0IGRvIG5vdCBleHBvc2UgYSB3YXkgdG8gY2hlY2sgaWYgd2UncmUgaHlkcmF0aW5nLiBTbyB1c2VycyBvZiB0aGUgc2hpbQogICAgICAgICAgICAvLyB3aWxsIG5lZWQgdG8gdHJhY2sgdGhhdCB0aGVtc2VsdmVzIGFuZCByZXR1cm4gdGhlIGNvcnJlY3QgdmFsdWUKICAgICAgICAgICAgLy8gZnJvbSBgZ2V0U25hcHNob3RgLgogICAgICAgICAgICByZXR1cm4gZ2V0U25hcHNob3QoKTsKICAgICAgICAgIH0KCiAgICAgICAgICAvKioKICAgICAgICAgICAqIElubGluZWQgaW50byB0aGUgcmVhY3Qtcm91dGVyIHJlcG8gc2luY2UgdXNlLXN5bmMtZXh0ZXJuYWwtc3RvcmUgZG9lcyBub3QKICAgICAgICAgICAqIHByb3ZpZGUgYSBVTUQtY29tcGF0aWJsZSBwYWNrYWdlLCBzbyB3ZSBuZWVkIHRoaXMgdG8gYmUgYWJsZSB0byBkaXN0cmlidXRlCiAgICAgICAgICAgKiBVTUQgcmVhY3Qtcm91dGVyIGJ1bmRsZXMKICAgICAgICAgICAqLwogICAgICAgICAgdmFyIGNhblVzZURPTSA9ICEhKHR5cGVvZiB3aW5kb3cgIT09ICJ1bmRlZmluZWQiICYmIHR5cGVvZiB3aW5kb3cuZG9jdW1lbnQgIT09ICJ1bmRlZmluZWQiICYmIHR5cGVvZiB3aW5kb3cuZG9jdW1lbnQuY3JlYXRlRWxlbWVudCAhPT0gInVuZGVmaW5lZCIpOwogICAgICAgICAgdmFyIGlzU2VydmVyRW52aXJvbm1lbnQgPSAhY2FuVXNlRE9NOwogICAgICAgICAgdmFyIHNoaW0gPSBpc1NlcnZlckVudmlyb25tZW50ID8gdXNlU3luY0V4dGVybmFsU3RvcmUkMSA6IHVzZVN5bmNFeHRlcm5hbFN0b3JlJDI7CiAgICAgICAgICB2YXIgdXNlU3luY0V4dGVybmFsU3RvcmUgPSB0cnVlID8gKChtb2R1bGUpID0+IG1vZHVsZS51c2VTeW5jRXh0ZXJuYWxTdG9yZSkocmVhY3RfbmFtZXNwYWNlT2JqZWN0KSA6IHNoaW07CgogICAgICAgICAgdmFyIERhdGFSb3V0ZXJDb250ZXh0ID0gLyojX19QVVJFX18qL3JlYWN0LmNyZWF0ZUNvbnRleHQobnVsbCk7CgogICAgICAgICAgaWYgKGZhbHNlKSB7fQoKICAgICAgICAgIHZhciBEYXRhUm91dGVyU3RhdGVDb250ZXh0ID0gLyojX19QVVJFX18qL3JlYWN0LmNyZWF0ZUNvbnRleHQobnVsbCk7CgogICAgICAgICAgaWYgKGZhbHNlKSB7fQoKICAgICAgICAgIHZhciBBd2FpdENvbnRleHQgPSAvKiNfX1BVUkVfXyovIC8qIHVudXNlZCBwdXJlIGV4cHJlc3Npb24gb3Igc3VwZXIgKi9udWxsICYmIFJlYWN0LmNyZWF0ZUNvbnRleHQobnVsbCk7CgogICAgICAgICAgaWYgKGZhbHNlKSB7fQoKICAgICAgICAgIHZhciBOYXZpZ2F0aW9uQ29udGV4dCA9IC8qI19fUFVSRV9fKi9yZWFjdC5jcmVhdGVDb250ZXh0KG51bGwpOwoKICAgICAgICAgIGlmIChmYWxzZSkge30KCiAgICAgICAgICB2YXIgTG9jYXRpb25Db250ZXh0ID0gLyojX19QVVJFX18qL3JlYWN0LmNyZWF0ZUNvbnRleHQobnVsbCk7CgogICAgICAgICAgaWYgKGZhbHNlKSB7fQoKICAgICAgICAgIHZhciBSb3V0ZUNvbnRleHQgPSAvKiNfX1BVUkVfXyovcmVhY3QuY3JlYXRlQ29udGV4dCh7CiAgICAgICAgICAgIG91dGxldDogbnVsbCwKICAgICAgICAgICAgbWF0Y2hlczogW10KICAgICAgICAgIH0pOwoKICAgICAgICAgIGlmIChmYWxzZSkge30KCiAgICAgICAgICB2YXIgUm91dGVFcnJvckNvbnRleHQgPSAvKiNfX1BVUkVfXyovcmVhY3QuY3JlYXRlQ29udGV4dChudWxsKTsKCiAgICAgICAgICBpZiAoZmFsc2UpIHt9CgogICAgICAgICAgLyoqCiAgICAgICAgICAgKiBSZXR1cm5zIHRoZSBmdWxsIGhyZWYgZm9yIHRoZSBnaXZlbiAidG8iIHZhbHVlLiBUaGlzIGlzIHVzZWZ1bCBmb3IgYnVpbGRpbmcKICAgICAgICAgICAqIGN1c3RvbSBsaW5rcyB0aGF0IGFyZSBhbHNvIGFjY2Vzc2libGUgYW5kIHByZXNlcnZlIHJpZ2h0LWNsaWNrIGJlaGF2aW9yLgogICAgICAgICAgICoKICAgICAgICAgICAqIEBzZWUgaHR0cHM6Ly9yZWFjdHJvdXRlci5jb20vaG9va3MvdXNlLWhyZWYKICAgICAgICAgICAqLwoKICAgICAgICAgIGZ1bmN0aW9uIHVzZUhyZWYodG8sIF90ZW1wKSB7CiAgICAgICAgICAgIHZhciBfcmVmMzAgPQoKICAgICAgICAgICAgICBfdGVtcCA9PT0gdm9pZCAwID8ge30gOiBfdGVtcCxyZWxhdGl2ZSA9IF9yZWYzMC5yZWxhdGl2ZTsKICAgICAgICAgICAgIXVzZUluUm91dGVyQ29udGV4dCgpID8gZmFsc2UgPyAwIDogcm91dGVyX2ludmFyaWFudChmYWxzZSkgOiB2b2lkIDA7CiAgICAgICAgICAgIHZhciBfcmVhY3QkdXNlQ29udGV4dCA9CgoKICAgICAgICAgICAgICByZWFjdC51c2VDb250ZXh0KE5hdmlnYXRpb25Db250ZXh0KSxiYXNlbmFtZSA9IF9yZWFjdCR1c2VDb250ZXh0LmJhc2VuYW1lLG5hdmlnYXRvciA9IF9yZWFjdCR1c2VDb250ZXh0Lm5hdmlnYXRvcjsKICAgICAgICAgICAgdmFyIF9kaXN0X3VzZVJlc29sdmVkUGF0aCA9CgoKCiAgICAgICAgICAgICAgZGlzdF91c2VSZXNvbHZlZFBhdGgodG8sIHsKICAgICAgICAgICAgICAgIHJlbGF0aXZlOiByZWxhdGl2ZQogICAgICAgICAgICAgIH0pLGhhc2ggPSBfZGlzdF91c2VSZXNvbHZlZFBhdGguaGFzaCxwYXRobmFtZSA9IF9kaXN0X3VzZVJlc29sdmVkUGF0aC5wYXRobmFtZSxzZWFyY2ggPSBfZGlzdF91c2VSZXNvbHZlZFBhdGguc2VhcmNoOwogICAgICAgICAgICB2YXIgam9pbmVkUGF0aG5hbWUgPSBwYXRobmFtZTsgLy8gSWYgd2UncmUgb3BlcmF0aW5nIHdpdGhpbiBhIGJhc2VuYW1lLCBwcmVwZW5kIGl0IHRvIHRoZSBwYXRobmFtZSBwcmlvcgogICAgICAgICAgICAvLyB0byBjcmVhdGluZyB0aGUgaHJlZi4gIElmIHRoaXMgaXMgYSByb290IG5hdmlnYXRpb24sIHRoZW4ganVzdCB1c2UgdGhlIHJhdwogICAgICAgICAgICAvLyBiYXNlbmFtZSB3aGljaCBhbGxvd3MgdGhlIGJhc2VuYW1lIHRvIGhhdmUgZnVsbCBjb250cm9sIG92ZXIgdGhlIHByZXNlbmNlCiAgICAgICAgICAgIC8vIG9mIGEgdHJhaWxpbmcgc2xhc2ggb24gcm9vdCBsaW5rcwoKICAgICAgICAgICAgaWYgKGJhc2VuYW1lICE9PSAiLyIpIHsKICAgICAgICAgICAgICBqb2luZWRQYXRobmFtZSA9IHBhdGhuYW1lID09PSAiLyIgPyBiYXNlbmFtZSA6IHJvdXRlcl9qb2luUGF0aHMoW2Jhc2VuYW1lLCBwYXRobmFtZV0pOwogICAgICAgICAgICB9CgogICAgICAgICAgICByZXR1cm4gbmF2aWdhdG9yLmNyZWF0ZUhyZWYoewogICAgICAgICAgICAgIHBhdGhuYW1lOiBqb2luZWRQYXRobmFtZSwKICAgICAgICAgICAgICBzZWFyY2g6IHNlYXJjaCwKICAgICAgICAgICAgICBoYXNoOiBoYXNoCiAgICAgICAgICAgIH0pOwogICAgICAgICAgfQogICAgICAgICAgLyoqCiAgICAgICAgICAgKiBSZXR1cm5zIHRydWUgaWYgdGhpcyBjb21wb25lbnQgaXMgYSBkZXNjZW5kYW50IG9mIGEgPFJvdXRlcj4uCiAgICAgICAgICAgKgogICAgICAgICAgICogQHNlZSBodHRwczovL3JlYWN0cm91dGVyLmNvbS9ob29rcy91c2UtaW4tcm91dGVyLWNvbnRleHQKICAgICAgICAgICAqLwoKICAgICAgICAgIGZ1bmN0aW9uIHVzZUluUm91dGVyQ29udGV4dCgpIHsKICAgICAgICAgICAgcmV0dXJuIHJlYWN0LnVzZUNvbnRleHQoTG9jYXRpb25Db250ZXh0KSAhPSBudWxsOwogICAgICAgICAgfQogICAgICAgICAgLyoqCiAgICAgICAgICAgKiBSZXR1cm5zIHRoZSBjdXJyZW50IGxvY2F0aW9uIG9iamVjdCwgd2hpY2ggcmVwcmVzZW50cyB0aGUgY3VycmVudCBVUkwgaW4gd2ViCiAgICAgICAgICAgKiBicm93c2Vycy4KICAgICAgICAgICAqCiAgICAgICAgICAgKiBOb3RlOiBJZiB5b3UncmUgdXNpbmcgdGhpcyBpdCBtYXkgbWVhbiB5b3UncmUgZG9pbmcgc29tZSBvZiB5b3VyIG93bgogICAgICAgICAgICogInJvdXRpbmciIGluIHlvdXIgYXBwLCBhbmQgd2UnZCBsaWtlIHRvIGtub3cgd2hhdCB5b3VyIHVzZSBjYXNlIGlzLiBXZSBtYXkKICAgICAgICAgICAqIGJlIGFibGUgdG8gcHJvdmlkZSBzb21ldGhpbmcgaGlnaGVyLWxldmVsIHRvIGJldHRlciBzdWl0IHlvdXIgbmVlZHMuCiAgICAgICAgICAgKgogICAgICAgICAgICogQHNlZSBodHRwczovL3JlYWN0cm91dGVyLmNvbS9ob29rcy91c2UtbG9jYXRpb24KICAgICAgICAgICAqLwoKICAgICAgICAgIGZ1bmN0aW9uIGRpc3RfdXNlTG9jYXRpb24oKSB7CiAgICAgICAgICAgICF1c2VJblJvdXRlckNvbnRleHQoKSA/IGZhbHNlID8gMCA6IHJvdXRlcl9pbnZhcmlhbnQoZmFsc2UpIDogdm9pZCAwOwogICAgICAgICAgICByZXR1cm4gcmVhY3QudXNlQ29udGV4dChMb2NhdGlvbkNvbnRleHQpLmxvY2F0aW9uOwogICAgICAgICAgfQogICAgICAgICAgLyoqCiAgICAgICAgICAgKiBSZXR1cm5zIHRoZSBjdXJyZW50IG5hdmlnYXRpb24gYWN0aW9uIHdoaWNoIGRlc2NyaWJlcyBob3cgdGhlIHJvdXRlciBjYW1lIHRvCiAgICAgICAgICAgKiB0aGUgY3VycmVudCBsb2NhdGlvbiwgZWl0aGVyIGJ5IGEgcG9wLCBwdXNoLCBvciByZXBsYWNlIG9uIHRoZSBoaXN0b3J5IHN0YWNrLgogICAgICAgICAgICoKICAgICAgICAgICAqIEBzZWUgaHR0cHM6Ly9yZWFjdHJvdXRlci5jb20vaG9va3MvdXNlLW5hdmlnYXRpb24tdHlwZQogICAgICAgICAgICovCgogICAgICAgICAgZnVuY3Rpb24gdXNlTmF2aWdhdGlvblR5cGUoKSB7CiAgICAgICAgICAgIHJldHVybiBSZWFjdC51c2VDb250ZXh0KExvY2F0aW9uQ29udGV4dCkubmF2aWdhdGlvblR5cGU7CiAgICAgICAgICB9CiAgICAgICAgICAvKioKICAgICAgICAgICAqIFJldHVybnMgYSBQYXRoTWF0Y2ggb2JqZWN0IGlmIHRoZSBnaXZlbiBwYXR0ZXJuIG1hdGNoZXMgdGhlIGN1cnJlbnQgVVJMLgogICAgICAgICAgICogVGhpcyBpcyB1c2VmdWwgZm9yIGNvbXBvbmVudHMgdGhhdCBuZWVkIHRvIGtub3cgImFjdGl2ZSIgc3RhdGUsIGUuZy4KICAgICAgICAgICAqIDxOYXZMaW5rPi4KICAgICAgICAgICAqCiAgICAgICAgICAgKiBAc2VlIGh0dHBzOi8vcmVhY3Ryb3V0ZXIuY29tL2hvb2tzL3VzZS1tYXRjaAogICAgICAgICAgICovCgogICAgICAgICAgZnVuY3Rpb24gdXNlTWF0Y2gocGF0dGVybikgewogICAgICAgICAgICAhdXNlSW5Sb3V0ZXJDb250ZXh0KCkgPyBmYWxzZSA/IDAgOiBpbnZhcmlhbnQoZmFsc2UpIDogdm9pZCAwOwogICAgICAgICAgICB2YXIgX2Rpc3RfdXNlTG9jYXRpb24gPQoKICAgICAgICAgICAgICBkaXN0X3VzZUxvY2F0aW9uKCkscGF0aG5hbWUgPSBfZGlzdF91c2VMb2NhdGlvbi5wYXRobmFtZTsKICAgICAgICAgICAgcmV0dXJuIFJlYWN0LnVzZU1lbW8oKCkgPT4gbWF0Y2hQYXRoKHBhdHRlcm4sIHBhdGhuYW1lKSwgW3BhdGhuYW1lLCBwYXR0ZXJuXSk7CiAgICAgICAgICB9CiAgICAgICAgICAvKioKICAgICAgICAgICAqIFRoZSBpbnRlcmZhY2UgZm9yIHRoZSBuYXZpZ2F0ZSgpIGZ1bmN0aW9uIHJldHVybmVkIGZyb20gdXNlTmF2aWdhdGUoKS4KICAgICAgICAgICAqLwoKICAgICAgICAgIC8qKgogICAgICAgICAgICogUmV0dXJucyBhbiBpbXBlcmF0aXZlIG1ldGhvZCBmb3IgY2hhbmdpbmcgdGhlIGxvY2F0aW9uLiBVc2VkIGJ5IDxMaW5rPnMsIGJ1dAogICAgICAgICAgICogbWF5IGFsc28gYmUgdXNlZCBieSBvdGhlciBlbGVtZW50cyB0byBjaGFuZ2UgdGhlIGxvY2F0aW9uLgogICAgICAgICAgICoKICAgICAgICAgICAqIEBzZWUgaHR0cHM6Ly9yZWFjdHJvdXRlci5jb20vaG9va3MvdXNlLW5hdmlnYXRlCiAgICAgICAgICAgKi8KICAgICAgICAgIGZ1bmN0aW9uIGRpc3RfdXNlTmF2aWdhdGUoKSB7CiAgICAgICAgICAgICF1c2VJblJvdXRlckNvbnRleHQoKSA/IGZhbHNlID8gMCA6IHJvdXRlcl9pbnZhcmlhbnQoZmFsc2UpIDogdm9pZCAwOwogICAgICAgICAgICB2YXIgX3JlYWN0JHVzZUNvbnRleHQyID0KCgogICAgICAgICAgICAgIHJlYWN0LnVzZUNvbnRleHQoTmF2aWdhdGlvbkNvbnRleHQpLGJhc2VuYW1lID0gX3JlYWN0JHVzZUNvbnRleHQyLmJhc2VuYW1lLG5hdmlnYXRvciA9IF9yZWFjdCR1c2VDb250ZXh0Mi5uYXZpZ2F0b3I7CiAgICAgICAgICAgIHZhciBfcmVhY3QkdXNlQ29udGV4dDMgPQoKICAgICAgICAgICAgICByZWFjdC51c2VDb250ZXh0KFJvdXRlQ29udGV4dCksbWF0Y2hlcyA9IF9yZWFjdCR1c2VDb250ZXh0My5tYXRjaGVzOwogICAgICAgICAgICB2YXIgX2Rpc3RfdXNlTG9jYXRpb24yID0KCiAgICAgICAgICAgICAgZGlzdF91c2VMb2NhdGlvbigpLGxvY2F0aW9uUGF0aG5hbWUgPSBfZGlzdF91c2VMb2NhdGlvbjIucGF0aG5hbWU7CiAgICAgICAgICAgIHZhciByb3V0ZVBhdGhuYW1lc0pzb24gPSBKU09OLnN0cmluZ2lmeShnZXRQYXRoQ29udHJpYnV0aW5nTWF0Y2hlcyhtYXRjaGVzKS5tYXAoKG1hdGNoKSA9PiBtYXRjaC5wYXRobmFtZUJhc2UpKTsKICAgICAgICAgICAgdmFyIGFjdGl2ZVJlZiA9IHJlYWN0LnVzZVJlZihmYWxzZSk7CiAgICAgICAgICAgIHJlYWN0LnVzZUVmZmVjdCgoKSA9PiB7CiAgICAgICAgICAgICAgYWN0aXZlUmVmLmN1cnJlbnQgPSB0cnVlOwogICAgICAgICAgICB9KTsKICAgICAgICAgICAgdmFyIG5hdmlnYXRlID0gcmVhY3QudXNlQ2FsbGJhY2soZnVuY3Rpb24gKHRvLCBvcHRpb25zKSB7CiAgICAgICAgICAgICAgaWYgKG9wdGlvbnMgPT09IHZvaWQgMCkgewogICAgICAgICAgICAgICAgb3B0aW9ucyA9IHt9OwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgZmFsc2UgPyAwIDogdm9pZCAwOwogICAgICAgICAgICAgIGlmICghYWN0aXZlUmVmLmN1cnJlbnQpIHJldHVybjsKCiAgICAgICAgICAgICAgaWYgKHR5cGVvZiB0byA9PT0gIm51bWJlciIpIHsKICAgICAgICAgICAgICAgIG5hdmlnYXRvci5nbyh0byk7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICB2YXIgcGF0aCA9IHJlc29sdmVUbyh0bywgSlNPTi5wYXJzZShyb3V0ZVBhdGhuYW1lc0pzb24pLCBsb2NhdGlvblBhdGhuYW1lLCBvcHRpb25zLnJlbGF0aXZlID09PSAicGF0aCIpOyAvLyBJZiB3ZSdyZSBvcGVyYXRpbmcgd2l0aGluIGEgYmFzZW5hbWUsIHByZXBlbmQgaXQgdG8gdGhlIHBhdGhuYW1lIHByaW9yCiAgICAgICAgICAgICAgLy8gdG8gaGFuZGluZyBvZmYgdG8gaGlzdG9yeS4gIElmIHRoaXMgaXMgYSByb290IG5hdmlnYXRpb24sIHRoZW4gd2UKICAgICAgICAgICAgICAvLyBuYXZpZ2F0ZSB0byB0aGUgcmF3IGJhc2VuYW1lIHdoaWNoIGFsbG93cyB0aGUgYmFzZW5hbWUgdG8gaGF2ZSBmdWxsCiAgICAgICAgICAgICAgLy8gY29udHJvbCBvdmVyIHRoZSBwcmVzZW5jZSBvZiBhIHRyYWlsaW5nIHNsYXNoIG9uIHJvb3QgbGlua3MKCiAgICAgICAgICAgICAgaWYgKGJhc2VuYW1lICE9PSAiLyIpIHsKICAgICAgICAgICAgICAgIHBhdGgucGF0aG5hbWUgPSBwYXRoLnBhdGhuYW1lID09PSAiLyIgPyBiYXNlbmFtZSA6IHJvdXRlcl9qb2luUGF0aHMoW2Jhc2VuYW1lLCBwYXRoLnBhdGhuYW1lXSk7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAoISFvcHRpb25zLnJlcGxhY2UgPyBuYXZpZ2F0b3IucmVwbGFjZSA6IG5hdmlnYXRvci5wdXNoKShwYXRoLCBvcHRpb25zLnN0YXRlLCBvcHRpb25zKTsKICAgICAgICAgICAgfSwgW2Jhc2VuYW1lLCBuYXZpZ2F0b3IsIHJvdXRlUGF0aG5hbWVzSnNvbiwgbG9jYXRpb25QYXRobmFtZV0pOwogICAgICAgICAgICByZXR1cm4gbmF2aWdhdGU7CiAgICAgICAgICB9CiAgICAgICAgICB2YXIgT3V0bGV0Q29udGV4dCA9IC8qI19fUFVSRV9fKi9yZWFjdC5jcmVhdGVDb250ZXh0KG51bGwpOwogICAgICAgICAgLyoqCiAgICAgICAgICAgKiBSZXR1cm5zIHRoZSBjb250ZXh0IChpZiBwcm92aWRlZCkgZm9yIHRoZSBjaGlsZCByb3V0ZSBhdCB0aGlzIGxldmVsIG9mIHRoZSByb3V0ZQogICAgICAgICAgICogaGllcmFyY2h5LgogICAgICAgICAgICogQHNlZSBodHRwczovL3JlYWN0cm91dGVyLmNvbS9ob29rcy91c2Utb3V0bGV0LWNvbnRleHQKICAgICAgICAgICAqLwoKICAgICAgICAgIGZ1bmN0aW9uIHVzZU91dGxldENvbnRleHQoKSB7CiAgICAgICAgICAgIHJldHVybiBSZWFjdC51c2VDb250ZXh0KE91dGxldENvbnRleHQpOwogICAgICAgICAgfQogICAgICAgICAgLyoqCiAgICAgICAgICAgKiBSZXR1cm5zIHRoZSBlbGVtZW50IGZvciB0aGUgY2hpbGQgcm91dGUgYXQgdGhpcyBsZXZlbCBvZiB0aGUgcm91dGUKICAgICAgICAgICAqIGhpZXJhcmNoeS4gVXNlZCBpbnRlcm5hbGx5IGJ5IDxPdXRsZXQ+IHRvIHJlbmRlciBjaGlsZCByb3V0ZXMuCiAgICAgICAgICAgKgogICAgICAgICAgICogQHNlZSBodHRwczovL3JlYWN0cm91dGVyLmNvbS9ob29rcy91c2Utb3V0bGV0CiAgICAgICAgICAgKi8KCiAgICAgICAgICBmdW5jdGlvbiB1c2VPdXRsZXQoY29udGV4dCkgewogICAgICAgICAgICB2YXIgb3V0bGV0ID0gcmVhY3QudXNlQ29udGV4dChSb3V0ZUNvbnRleHQpLm91dGxldDsKCiAgICAgICAgICAgIGlmIChvdXRsZXQpIHsKICAgICAgICAgICAgICByZXR1cm4gLyojX19QVVJFX18qL3JlYWN0LmNyZWF0ZUVsZW1lbnQoT3V0bGV0Q29udGV4dC5Qcm92aWRlciwgewogICAgICAgICAgICAgICAgdmFsdWU6IGNvbnRleHQKICAgICAgICAgICAgICB9LCBvdXRsZXQpOwogICAgICAgICAgICB9CgogICAgICAgICAgICByZXR1cm4gb3V0bGV0OwogICAgICAgICAgfQogICAgICAgICAgLyoqCiAgICAgICAgICAgKiBSZXR1cm5zIGFuIG9iamVjdCBvZiBrZXkvdmFsdWUgcGFpcnMgb2YgdGhlIGR5bmFtaWMgcGFyYW1zIGZyb20gdGhlIGN1cnJlbnQKICAgICAgICAgICAqIFVSTCB0aGF0IHdlcmUgbWF0Y2hlZCBieSB0aGUgcm91dGUgcGF0aC4KICAgICAgICAgICAqCiAgICAgICAgICAgKiBAc2VlIGh0dHBzOi8vcmVhY3Ryb3V0ZXIuY29tL2hvb2tzL3VzZS1wYXJhbXMKICAgICAgICAgICAqLwoKICAgICAgICAgIGZ1bmN0aW9uIHVzZVBhcmFtcygpIHsKICAgICAgICAgICAgdmFyIF9SZWFjdCR1c2VDb250ZXh0ID0KCiAgICAgICAgICAgICAgUmVhY3QudXNlQ29udGV4dChSb3V0ZUNvbnRleHQpLG1hdGNoZXMgPSBfUmVhY3QkdXNlQ29udGV4dC5tYXRjaGVzOwogICAgICAgICAgICB2YXIgcm91dGVNYXRjaCA9IG1hdGNoZXNbbWF0Y2hlcy5sZW5ndGggLSAxXTsKICAgICAgICAgICAgcmV0dXJuIHJvdXRlTWF0Y2ggPyByb3V0ZU1hdGNoLnBhcmFtcyA6IHt9OwogICAgICAgICAgfQogICAgICAgICAgLyoqCiAgICAgICAgICAgKiBSZXNvbHZlcyB0aGUgcGF0aG5hbWUgb2YgdGhlIGdpdmVuIGB0b2AgdmFsdWUgYWdhaW5zdCB0aGUgY3VycmVudCBsb2NhdGlvbi4KICAgICAgICAgICAqCiAgICAgICAgICAgKiBAc2VlIGh0dHBzOi8vcmVhY3Ryb3V0ZXIuY29tL2hvb2tzL3VzZS1yZXNvbHZlZC1wYXRoCiAgICAgICAgICAgKi8KCiAgICAgICAgICBmdW5jdGlvbiBkaXN0X3VzZVJlc29sdmVkUGF0aCh0bywgX3RlbXAyKSB7CiAgICAgICAgICAgIHZhciBfcmVmMzEgPQoKICAgICAgICAgICAgICBfdGVtcDIgPT09IHZvaWQgMCA/IHt9IDogX3RlbXAyLHJlbGF0aXZlID0gX3JlZjMxLnJlbGF0aXZlOwogICAgICAgICAgICB2YXIgX3JlYWN0JHVzZUNvbnRleHQ0ID0KCiAgICAgICAgICAgICAgcmVhY3QudXNlQ29udGV4dChSb3V0ZUNvbnRleHQpLG1hdGNoZXMgPSBfcmVhY3QkdXNlQ29udGV4dDQubWF0Y2hlczsKICAgICAgICAgICAgdmFyIF9kaXN0X3VzZUxvY2F0aW9uMyA9CgogICAgICAgICAgICAgIGRpc3RfdXNlTG9jYXRpb24oKSxsb2NhdGlvblBhdGhuYW1lID0gX2Rpc3RfdXNlTG9jYXRpb24zLnBhdGhuYW1lOwogICAgICAgICAgICB2YXIgcm91dGVQYXRobmFtZXNKc29uID0gSlNPTi5zdHJpbmdpZnkoZ2V0UGF0aENvbnRyaWJ1dGluZ01hdGNoZXMobWF0Y2hlcykubWFwKChtYXRjaCkgPT4gbWF0Y2gucGF0aG5hbWVCYXNlKSk7CiAgICAgICAgICAgIHJldHVybiByZWFjdC51c2VNZW1vKCgpID0+IHJlc29sdmVUbyh0bywgSlNPTi5wYXJzZShyb3V0ZVBhdGhuYW1lc0pzb24pLCBsb2NhdGlvblBhdGhuYW1lLCByZWxhdGl2ZSA9PT0gInBhdGgiKSwgW3RvLCByb3V0ZVBhdGhuYW1lc0pzb24sIGxvY2F0aW9uUGF0aG5hbWUsIHJlbGF0aXZlXSk7CiAgICAgICAgICB9CiAgICAgICAgICAvKioKICAgICAgICAgICAqIFJldHVybnMgdGhlIGVsZW1lbnQgb2YgdGhlIHJvdXRlIHRoYXQgbWF0Y2hlZCB0aGUgY3VycmVudCBsb2NhdGlvbiwgcHJlcGFyZWQKICAgICAgICAgICAqIHdpdGggdGhlIGNvcnJlY3QgY29udGV4dCB0byByZW5kZXIgdGhlIHJlbWFpbmRlciBvZiB0aGUgcm91dGUgdHJlZS4gUm91dGUKICAgICAgICAgICAqIGVsZW1lbnRzIGluIHRoZSB0cmVlIG11c3QgcmVuZGVyIGFuIDxPdXRsZXQ+IHRvIHJlbmRlciB0aGVpciBjaGlsZCByb3V0ZSdzCiAgICAgICAgICAgKiBlbGVtZW50LgogICAgICAgICAgICoKICAgICAgICAgICAqIEBzZWUgaHR0cHM6Ly9yZWFjdHJvdXRlci5jb20vaG9va3MvdXNlLXJvdXRlcwogICAgICAgICAgICovCgogICAgICAgICAgZnVuY3Rpb24gdXNlUm91dGVzKHJvdXRlcywgbG9jYXRpb25BcmcpIHsKICAgICAgICAgICAgIXVzZUluUm91dGVyQ29udGV4dCgpID8gZmFsc2UgPyAwIDogcm91dGVyX2ludmFyaWFudChmYWxzZSkgOiB2b2lkIDA7CiAgICAgICAgICAgIHZhciBfcmVhY3QkdXNlQ29udGV4dDUgPQoKICAgICAgICAgICAgICByZWFjdC51c2VDb250ZXh0KE5hdmlnYXRpb25Db250ZXh0KSxuYXZpZ2F0b3IgPSBfcmVhY3QkdXNlQ29udGV4dDUubmF2aWdhdG9yOwogICAgICAgICAgICB2YXIgZGF0YVJvdXRlclN0YXRlQ29udGV4dCA9IHJlYWN0LnVzZUNvbnRleHQoRGF0YVJvdXRlclN0YXRlQ29udGV4dCk7CiAgICAgICAgICAgIHZhciBfcmVhY3QkdXNlQ29udGV4dDYgPQoKICAgICAgICAgICAgICByZWFjdC51c2VDb250ZXh0KFJvdXRlQ29udGV4dCkscGFyZW50TWF0Y2hlcyA9IF9yZWFjdCR1c2VDb250ZXh0Ni5tYXRjaGVzOwogICAgICAgICAgICB2YXIgcm91dGVNYXRjaCA9IHBhcmVudE1hdGNoZXNbcGFyZW50TWF0Y2hlcy5sZW5ndGggLSAxXTsKICAgICAgICAgICAgdmFyIHBhcmVudFBhcmFtcyA9IHJvdXRlTWF0Y2ggPyByb3V0ZU1hdGNoLnBhcmFtcyA6IHt9OwogICAgICAgICAgICB2YXIgcGFyZW50UGF0aG5hbWUgPSByb3V0ZU1hdGNoID8gcm91dGVNYXRjaC5wYXRobmFtZSA6ICIvIjsKICAgICAgICAgICAgdmFyIHBhcmVudFBhdGhuYW1lQmFzZSA9IHJvdXRlTWF0Y2ggPyByb3V0ZU1hdGNoLnBhdGhuYW1lQmFzZSA6ICIvIjsKICAgICAgICAgICAgdmFyIHBhcmVudFJvdXRlID0gcm91dGVNYXRjaCAmJiByb3V0ZU1hdGNoLnJvdXRlOwoKICAgICAgICAgICAgaWYgKGZhbHNlKSB7fQoKICAgICAgICAgICAgdmFyIGxvY2F0aW9uRnJvbUNvbnRleHQgPSBkaXN0X3VzZUxvY2F0aW9uKCk7CiAgICAgICAgICAgIHZhciBsb2NhdGlvbjsKCiAgICAgICAgICAgIGlmIChsb2NhdGlvbkFyZykgewogICAgICAgICAgICAgIHZhciBfcGFyc2VkTG9jYXRpb25BcmckcGE7CgogICAgICAgICAgICAgIHZhciBwYXJzZWRMb2NhdGlvbkFyZyA9IHR5cGVvZiBsb2NhdGlvbkFyZyA9PT0gInN0cmluZyIgPyBwYXJzZVBhdGgobG9jYXRpb25BcmcpIDogbG9jYXRpb25Bcmc7CiAgICAgICAgICAgICAgIShwYXJlbnRQYXRobmFtZUJhc2UgPT09ICIvIiB8fCAoKF9wYXJzZWRMb2NhdGlvbkFyZyRwYSA9IHBhcnNlZExvY2F0aW9uQXJnLnBhdGhuYW1lKSA9PSBudWxsID8gdm9pZCAwIDogX3BhcnNlZExvY2F0aW9uQXJnJHBhLnN0YXJ0c1dpdGgocGFyZW50UGF0aG5hbWVCYXNlKSkpID8gZmFsc2UgPyAwIDogcm91dGVyX2ludmFyaWFudChmYWxzZSkgOiB2b2lkIDA7CiAgICAgICAgICAgICAgbG9jYXRpb24gPSBwYXJzZWRMb2NhdGlvbkFyZzsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICBsb2NhdGlvbiA9IGxvY2F0aW9uRnJvbUNvbnRleHQ7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHZhciBwYXRobmFtZSA9IGxvY2F0aW9uLnBhdGhuYW1lIHx8ICIvIjsKICAgICAgICAgICAgdmFyIHJlbWFpbmluZ1BhdGhuYW1lID0gcGFyZW50UGF0aG5hbWVCYXNlID09PSAiLyIgPyBwYXRobmFtZSA6IHBhdGhuYW1lLnNsaWNlKHBhcmVudFBhdGhuYW1lQmFzZS5sZW5ndGgpIHx8ICIvIjsKICAgICAgICAgICAgdmFyIG1hdGNoZXMgPSBtYXRjaFJvdXRlcyhyb3V0ZXMsIHsKICAgICAgICAgICAgICBwYXRobmFtZTogcmVtYWluaW5nUGF0aG5hbWUKICAgICAgICAgICAgfSk7CgogICAgICAgICAgICBpZiAoZmFsc2UpIHt9CgogICAgICAgICAgICB2YXIgcmVuZGVyZWRNYXRjaGVzID0gX3JlbmRlck1hdGNoZXMobWF0Y2hlcyAmJiBtYXRjaGVzLm1hcCgobWF0Y2gpID0+IE9iamVjdC5hc3NpZ24oe30sIG1hdGNoLCB7CiAgICAgICAgICAgICAgcGFyYW1zOiBPYmplY3QuYXNzaWduKHt9LCBwYXJlbnRQYXJhbXMsIG1hdGNoLnBhcmFtcyksCiAgICAgICAgICAgICAgcGF0aG5hbWU6IHJvdXRlcl9qb2luUGF0aHMoW3BhcmVudFBhdGhuYW1lQmFzZSwgLy8gUmUtZW5jb2RlIHBhdGhuYW1lcyB0aGF0IHdlcmUgZGVjb2RlZCBpbnNpZGUgbWF0Y2hSb3V0ZXMKICAgICAgICAgICAgICBuYXZpZ2F0b3IuZW5jb2RlTG9jYXRpb24gPyBuYXZpZ2F0b3IuZW5jb2RlTG9jYXRpb24obWF0Y2gucGF0aG5hbWUpLnBhdGhuYW1lIDogbWF0Y2gucGF0aG5hbWVdKSwKICAgICAgICAgICAgICBwYXRobmFtZUJhc2U6IG1hdGNoLnBhdGhuYW1lQmFzZSA9PT0gIi8iID8gcGFyZW50UGF0aG5hbWVCYXNlIDogcm91dGVyX2pvaW5QYXRocyhbcGFyZW50UGF0aG5hbWVCYXNlLCAvLyBSZS1lbmNvZGUgcGF0aG5hbWVzIHRoYXQgd2VyZSBkZWNvZGVkIGluc2lkZSBtYXRjaFJvdXRlcwogICAgICAgICAgICAgIG5hdmlnYXRvci5lbmNvZGVMb2NhdGlvbiA/IG5hdmlnYXRvci5lbmNvZGVMb2NhdGlvbihtYXRjaC5wYXRobmFtZUJhc2UpLnBhdGhuYW1lIDogbWF0Y2gucGF0aG5hbWVCYXNlXSkKICAgICAgICAgICAgfSkpLCBwYXJlbnRNYXRjaGVzLCBkYXRhUm91dGVyU3RhdGVDb250ZXh0IHx8IHVuZGVmaW5lZCk7IC8vIFdoZW4gYSB1c2VyIHBhc3NlcyBpbiBhIGBsb2NhdGlvbkFyZ2AsIHRoZSBhc3NvY2lhdGVkIHJvdXRlcyBuZWVkIHRvCiAgICAgICAgICAgIC8vIGJlIHdyYXBwZWQgaW4gYSBuZXcgYExvY2F0aW9uQ29udGV4dC5Qcm92aWRlcmAgaW4gb3JkZXIgZm9yIGB1c2VMb2NhdGlvbmAKICAgICAgICAgICAgLy8gdG8gdXNlIHRoZSBzY29wZWQgbG9jYXRpb24gaW5zdGVhZCBvZiB0aGUgZ2xvYmFsIGxvY2F0aW9uLgoKCiAgICAgICAgICAgIGlmIChsb2NhdGlvbkFyZyAmJiByZW5kZXJlZE1hdGNoZXMpIHsKICAgICAgICAgICAgICByZXR1cm4gLyojX19QVVJFX18qL3JlYWN0LmNyZWF0ZUVsZW1lbnQoTG9jYXRpb25Db250ZXh0LlByb3ZpZGVyLCB7CiAgICAgICAgICAgICAgICB2YWx1ZTogewogICAgICAgICAgICAgICAgICBsb2NhdGlvbjogZGlzdF9leHRlbmRzKHsKICAgICAgICAgICAgICAgICAgICBwYXRobmFtZTogIi8iLAogICAgICAgICAgICAgICAgICAgIHNlYXJjaDogIiIsCiAgICAgICAgICAgICAgICAgICAgaGFzaDogIiIsCiAgICAgICAgICAgICAgICAgICAgc3RhdGU6IG51bGwsCiAgICAgICAgICAgICAgICAgICAga2V5OiAiZGVmYXVsdCIKICAgICAgICAgICAgICAgICAgfSwgbG9jYXRpb24pLAogICAgICAgICAgICAgICAgICBuYXZpZ2F0aW9uVHlwZTogQWN0aW9uLlBvcAogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0sIHJlbmRlcmVkTWF0Y2hlcyk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybiByZW5kZXJlZE1hdGNoZXM7CiAgICAgICAgICB9CgogICAgICAgICAgZnVuY3Rpb24gRGVmYXVsdEVycm9yRWxlbWVudCgpIHsKICAgICAgICAgICAgdmFyIGVycm9yID0gdXNlUm91dGVFcnJvcigpOwogICAgICAgICAgICB2YXIgbWVzc2FnZSA9IGlzUm91dGVFcnJvclJlc3BvbnNlKGVycm9yKSA/IGVycm9yLnN0YXR1cyArICIgIiArIGVycm9yLnN0YXR1c1RleHQgOiBlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3IubWVzc2FnZSA6IEpTT04uc3RyaW5naWZ5KGVycm9yKTsKICAgICAgICAgICAgdmFyIHN0YWNrID0gZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLnN0YWNrIDogbnVsbDsKICAgICAgICAgICAgdmFyIGxpZ2h0Z3JleSA9ICJyZ2JhKDIwMCwyMDAsMjAwLCAwLjUpIjsKICAgICAgICAgICAgdmFyIHByZVN0eWxlcyA9IHsKICAgICAgICAgICAgICBwYWRkaW5nOiAiMC41cmVtIiwKICAgICAgICAgICAgICBiYWNrZ3JvdW5kQ29sb3I6IGxpZ2h0Z3JleQogICAgICAgICAgICB9OwogICAgICAgICAgICB2YXIgY29kZVN0eWxlcyA9IHsKICAgICAgICAgICAgICBwYWRkaW5nOiAiMnB4IDRweCIsCiAgICAgICAgICAgICAgYmFja2dyb3VuZENvbG9yOiBsaWdodGdyZXkKICAgICAgICAgICAgfTsKICAgICAgICAgICAgcmV0dXJuIC8qI19fUFVSRV9fKi9yZWFjdC5jcmVhdGVFbGVtZW50KHJlYWN0LkZyYWdtZW50LCBudWxsLCAvKiNfX1BVUkVfXyovcmVhY3QuY3JlYXRlRWxlbWVudCgiaDIiLCBudWxsLCAiVW5oYW5kbGVkIFRocm93biBFcnJvciEiKSwgLyojX19QVVJFX18qL3JlYWN0LmNyZWF0ZUVsZW1lbnQoImgzIiwgewogICAgICAgICAgICAgIHN0eWxlOiB7CiAgICAgICAgICAgICAgICBmb250U3R5bGU6ICJpdGFsaWMiCiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LCBtZXNzYWdlKSwgc3RhY2sgPyAvKiNfX1BVUkVfXyovcmVhY3QuY3JlYXRlRWxlbWVudCgicHJlIiwgewogICAgICAgICAgICAgIHN0eWxlOiBwcmVTdHlsZXMKICAgICAgICAgICAgfSwgc3RhY2spIDogbnVsbCwgLyojX19QVVJFX18qL3JlYWN0LmNyZWF0ZUVsZW1lbnQoInAiLCBudWxsLCAiXHVEODNEXHVEQ0JGIEhleSBkZXZlbG9wZXIgXHVEODNEXHVEQzRCIiksIC8qI19fUFVSRV9fKi9yZWFjdC5jcmVhdGVFbGVtZW50KCJwIiwgbnVsbCwgIllvdSBjYW4gcHJvdmlkZSBhIHdheSBiZXR0ZXIgVVggdGhhbiB0aGlzIHdoZW4geW91ciBhcHAgdGhyb3dzIGVycm9ycyBieSBwcm92aWRpbmcgeW91ciBvd25ceEEwIiwgLyojX19QVVJFX18qL3JlYWN0LmNyZWF0ZUVsZW1lbnQoImNvZGUiLCB7CiAgICAgICAgICAgICAgc3R5bGU6IGNvZGVTdHlsZXMKICAgICAgICAgICAgfSwgImVycm9yRWxlbWVudCIpLCAiIHByb3BzIG9uXHhBMCIsIC8qI19fUFVSRV9fKi9yZWFjdC5jcmVhdGVFbGVtZW50KCJjb2RlIiwgewogICAgICAgICAgICAgIHN0eWxlOiBjb2RlU3R5bGVzCiAgICAgICAgICAgIH0sICI8Um91dGU+IikpKTsKICAgICAgICAgIH12YXIKCiAgICAgICAgICBSZW5kZXJFcnJvckJvdW5kYXJ5ID0gLyojX19QVVJFX18qL2Z1bmN0aW9uIChfcmVhY3QkQ29tcG9uZW50KSB7X2luaGVyaXRzKFJlbmRlckVycm9yQm91bmRhcnksIF9yZWFjdCRDb21wb25lbnQpO3ZhciBfc3VwZXIyID0gX2NyZWF0ZVN1cGVyKFJlbmRlckVycm9yQm91bmRhcnkpOwogICAgICAgICAgICBmdW5jdGlvbiBSZW5kZXJFcnJvckJvdW5kYXJ5KHByb3BzKSB7dmFyIF90aGlzO19jbGFzc0NhbGxDaGVjazIodGhpcywgUmVuZGVyRXJyb3JCb3VuZGFyeSk7CiAgICAgICAgICAgICAgX3RoaXMgPSBfc3VwZXIyLmNhbGwodGhpcywgcHJvcHMpOwogICAgICAgICAgICAgIF90aGlzLnN0YXRlID0gewogICAgICAgICAgICAgICAgbG9jYXRpb246IHByb3BzLmxvY2F0aW9uLAogICAgICAgICAgICAgICAgZXJyb3I6IHByb3BzLmVycm9yCiAgICAgICAgICAgICAgfTtyZXR1cm4gX3RoaXM7CiAgICAgICAgICAgIH1fY3JlYXRlQ2xhc3MyKFJlbmRlckVycm9yQm91bmRhcnksIFt7IGtleTogImNvbXBvbmVudERpZENhdGNoIiwgdmFsdWU6CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCiAgICAgICAgICAgICAgZnVuY3Rpb24gY29tcG9uZW50RGlkQ2F0Y2goZXJyb3IsIGVycm9ySW5mbykgewogICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcigiUmVhY3QgUm91dGVyIGNhdWdodCB0aGUgZm9sbG93aW5nIGVycm9yIGR1cmluZyByZW5kZXIiLCBlcnJvciwgZXJyb3JJbmZvKTsKICAgICAgICAgICAgICB9IH0sIHsga2V5OiAicmVuZGVyIiwgdmFsdWU6CgogICAgICAgICAgICAgIGZ1bmN0aW9uIHJlbmRlcigpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnN0YXRlLmVycm9yID8gLyojX19QVVJFX18qL3JlYWN0LmNyZWF0ZUVsZW1lbnQoUm91dGVDb250ZXh0LlByb3ZpZGVyLCB7CiAgICAgICAgICAgICAgICAgIHZhbHVlOiB0aGlzLnByb3BzLnJvdXRlQ29udGV4dAogICAgICAgICAgICAgICAgfSwgLyojX19QVVJFX18qL3JlYWN0LmNyZWF0ZUVsZW1lbnQoUm91dGVFcnJvckNvbnRleHQuUHJvdmlkZXIsIHsKICAgICAgICAgICAgICAgICAgdmFsdWU6IHRoaXMuc3RhdGUuZXJyb3IsCiAgICAgICAgICAgICAgICAgIGNoaWxkcmVuOiB0aGlzLnByb3BzLmNvbXBvbmVudAogICAgICAgICAgICAgICAgfSkpIDogdGhpcy5wcm9wcy5jaGlsZHJlbjsKICAgICAgICAgICAgICB9IH1dLCBbeyBrZXk6ICJnZXREZXJpdmVkU3RhdGVGcm9tRXJyb3IiLCB2YWx1ZTogZnVuY3Rpb24gZ2V0RGVyaXZlZFN0YXRlRnJvbUVycm9yKGVycm9yKSB7cmV0dXJuIHsgZXJyb3I6IGVycm9yIH07fSB9LCB7IGtleTogImdldERlcml2ZWRTdGF0ZUZyb21Qcm9wcyIsIHZhbHVlOiBmdW5jdGlvbiBnZXREZXJpdmVkU3RhdGVGcm9tUHJvcHMocHJvcHMsIHN0YXRlKSB7Ly8gV2hlbiB3ZSBnZXQgaW50byBhbiBlcnJvciBzdGF0ZSwgdGhlIHVzZXIgd2lsbCBsaWtlbHkgY2xpY2sgImJhY2siIHRvIHRoZQogICAgICAgICAgICAgICAgLy8gcHJldmlvdXMgcGFnZSB0aGF0IGRpZG4ndCBoYXZlIGFuIGVycm9yLiBCZWNhdXNlIHRoaXMgd3JhcHMgdGhlIGVudGlyZQogICAgICAgICAgICAgICAgLy8gYXBwbGljYXRpb24sIHRoYXQgd2lsbCBoYXZlIG5vIGVmZmVjdC0tdGhlIGVycm9yIHBhZ2UgY29udGludWVzIHRvIGRpc3BsYXkuCiAgICAgICAgICAgICAgICAvLyBUaGlzIGdpdmVzIHVzIGEgbWVjaGFuaXNtIHRvIHJlY292ZXIgZnJvbSB0aGUgZXJyb3Igd2hlbiB0aGUgbG9jYXRpb24gY2hhbmdlcy4KICAgICAgICAgICAgICAgIC8vCiAgICAgICAgICAgICAgICAvLyBXaGV0aGVyIHdlJ3JlIGluIGFuIGVycm9yIHN0YXRlIG9yIG5vdCwgd2UgdXBkYXRlIHRoZSBsb2NhdGlvbiBpbiBzdGF0ZQogICAgICAgICAgICAgICAgLy8gc28gdGhhdCB3aGVuIHdlIGFyZSBpbiBhbiBlcnJvciBzdGF0ZSwgaXQgZ2V0cyByZXNldCB3aGVuIGEgbmV3IGxvY2F0aW9uCiAgICAgICAgICAgICAgICAvLyBjb21lcyBpbiBhbmQgdGhlIHVzZXIgcmVjb3ZlcnMgZnJvbSB0aGUgZXJyb3IuCiAgICAgICAgICAgICAgICBpZiAoc3RhdGUubG9jYXRpb24gIT09IHByb3BzLmxvY2F0aW9uKSB7cmV0dXJuIHsgZXJyb3I6IHByb3BzLmVycm9yLCBsb2NhdGlvbjogcHJvcHMubG9jYXRpb24gfTt9IC8vIElmIHdlJ3JlIG5vdCBjaGFuZ2luZyBsb2NhdGlvbnMsIHByZXNlcnZlIHRoZSBsb2NhdGlvbiBidXQgc3RpbGwgc3VyZmFjZQogICAgICAgICAgICAgICAgLy8gYW55IG5ldyBlcnJvcnMgdGhhdCBtYXkgY29tZSB0aHJvdWdoLiBXZSByZXRhaW4gdGhlIGV4aXN0aW5nIGVycm9yLCB3ZSBkbwogICAgICAgICAgICAgICAgLy8gdGhpcyBiZWNhdXNlIHRoZSBlcnJvciBwcm92aWRlZCBmcm9tIHRoZSBhcHAgc3RhdGUgbWF5IGJlIGNsZWFyZWQgd2l0aG91dAogICAgICAgICAgICAgICAgLy8gdGhlIGxvY2F0aW9uIGNoYW5naW5nLgogICAgICAgICAgICAgICAgcmV0dXJuIHsgZXJyb3I6IHByb3BzLmVycm9yIHx8IHN0YXRlLmVycm9yLCBsb2NhdGlvbjogc3RhdGUubG9jYXRpb24gfTt9IH1dKTtyZXR1cm4gUmVuZGVyRXJyb3JCb3VuZGFyeTt9KHJlYWN0LkNvbXBvbmVudCk7ZnVuY3Rpb24gUmVuZGVyZWRSb3V0ZShfcmVmKSB7dmFyIHJvdXRlQ29udGV4dCA9IF9yZWYucm91dGVDb250ZXh0LG1hdGNoID0gX3JlZi5tYXRjaCxjaGlsZHJlbiA9IF9yZWYuY2hpbGRyZW47dmFyIGRhdGFSb3V0ZXJDb250ZXh0ID0gcmVhY3QudXNlQ29udGV4dChEYXRhUm91dGVyQ29udGV4dCk7IC8vIFRyYWNrIGhvdyBkZWVwIHdlIGdvdCBpbiBvdXIgcmVuZGVyIHBhc3MgdG8gZW11bGF0ZSBTU1IgY29tcG9uZW50RGlkQ2F0Y2gKICAgICAgICAgICAgLy8gaW4gYSBEYXRhU3RhdGljUm91dGVyCiAgICAgICAgICAgIGlmIChkYXRhUm91dGVyQ29udGV4dCAmJiBkYXRhUm91dGVyQ29udGV4dC5zdGF0aWMgJiYgZGF0YVJvdXRlckNvbnRleHQuc3RhdGljQ29udGV4dCAmJiBtYXRjaC5yb3V0ZS5lcnJvckVsZW1lbnQpIHtkYXRhUm91dGVyQ29udGV4dC5zdGF0aWNDb250ZXh0Ll9kZWVwZXN0UmVuZGVyZWRCb3VuZGFyeUlkID0gbWF0Y2gucm91dGUuaWQ7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybiAvKiNfX1BVUkVfXyovcmVhY3QuY3JlYXRlRWxlbWVudChSb3V0ZUNvbnRleHQuUHJvdmlkZXIsIHsKICAgICAgICAgICAgICB2YWx1ZTogcm91dGVDb250ZXh0CiAgICAgICAgICAgIH0sIGNoaWxkcmVuKTsKICAgICAgICAgIH0KCiAgICAgICAgICBmdW5jdGlvbiBfcmVuZGVyTWF0Y2hlcyhtYXRjaGVzLCBwYXJlbnRNYXRjaGVzLCBkYXRhUm91dGVyU3RhdGUpIHsKICAgICAgICAgICAgaWYgKHBhcmVudE1hdGNoZXMgPT09IHZvaWQgMCkgewogICAgICAgICAgICAgIHBhcmVudE1hdGNoZXMgPSBbXTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKG1hdGNoZXMgPT0gbnVsbCkgewogICAgICAgICAgICAgIGlmIChkYXRhUm91dGVyU3RhdGUgIT0gbnVsbCAmJiBkYXRhUm91dGVyU3RhdGUuZXJyb3JzKSB7CiAgICAgICAgICAgICAgICAvLyBEb24ndCBiYWlsIGlmIHdlIGhhdmUgZGF0YSByb3V0ZXIgZXJyb3JzIHNvIHdlIGNhbiByZW5kZXIgdGhlbSBpbiB0aGUKICAgICAgICAgICAgICAgIC8vIGJvdW5kYXJ5LiAgVXNlIHRoZSBwcmUtbWF0Y2hlZCAob3Igc2hpbW1lZCkgbWF0Y2hlcwogICAgICAgICAgICAgICAgbWF0Y2hlcyA9IGRhdGFSb3V0ZXJTdGF0ZS5tYXRjaGVzOwogICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHZhciByZW5kZXJlZE1hdGNoZXMgPSBtYXRjaGVzOyAvLyBJZiB3ZSBoYXZlIGRhdGEgZXJyb3JzLCB0cmltIG1hdGNoZXMgdG8gdGhlIGhpZ2hlc3QgZXJyb3IgYm91bmRhcnkKCiAgICAgICAgICAgIHZhciBlcnJvcnMgPSBkYXRhUm91dGVyU3RhdGUgPT0gbnVsbCA/IHZvaWQgMCA6IGRhdGFSb3V0ZXJTdGF0ZS5lcnJvcnM7CgogICAgICAgICAgICBpZiAoZXJyb3JzICE9IG51bGwpIHsKICAgICAgICAgICAgICB2YXIgZXJyb3JJbmRleCA9IHJlbmRlcmVkTWF0Y2hlcy5maW5kSW5kZXgoKG0pID0+IG0ucm91dGUuaWQgJiYgKGVycm9ycyA9PSBudWxsID8gdm9pZCAwIDogZXJyb3JzW20ucm91dGUuaWRdKSk7CiAgICAgICAgICAgICAgIShlcnJvckluZGV4ID49IDApID8gZmFsc2UgPyAwIDogcm91dGVyX2ludmFyaWFudChmYWxzZSkgOiB2b2lkIDA7CiAgICAgICAgICAgICAgcmVuZGVyZWRNYXRjaGVzID0gcmVuZGVyZWRNYXRjaGVzLnNsaWNlKDAsIE1hdGgubWluKHJlbmRlcmVkTWF0Y2hlcy5sZW5ndGgsIGVycm9ySW5kZXggKyAxKSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybiByZW5kZXJlZE1hdGNoZXMucmVkdWNlUmlnaHQoKG91dGxldCwgbWF0Y2gsIGluZGV4KSA9PiB7CiAgICAgICAgICAgICAgdmFyIGVycm9yID0gbWF0Y2gucm91dGUuaWQgPyBlcnJvcnMgPT0gbnVsbCA/IHZvaWQgMCA6IGVycm9yc1ttYXRjaC5yb3V0ZS5pZF0gOiBudWxsOyAvLyBPbmx5IGRhdGEgcm91dGVycyBoYW5kbGUgZXJyb3JzCgogICAgICAgICAgICAgIHZhciBlcnJvckVsZW1lbnQgPSBkYXRhUm91dGVyU3RhdGUgPyBtYXRjaC5yb3V0ZS5lcnJvckVsZW1lbnQgfHwgLyojX19QVVJFX18qL3JlYWN0LmNyZWF0ZUVsZW1lbnQoRGVmYXVsdEVycm9yRWxlbWVudCwgbnVsbCkgOiBudWxsOwogICAgICAgICAgICAgIHZhciBtYXRjaGVzID0gcGFyZW50TWF0Y2hlcy5jb25jYXQocmVuZGVyZWRNYXRjaGVzLnNsaWNlKDAsIGluZGV4ICsgMSkpOwoKICAgICAgICAgICAgICB2YXIgZ2V0Q2hpbGRyZW4gPSAoKSA9PiAvKiNfX1BVUkVfXyovcmVhY3QuY3JlYXRlRWxlbWVudChSZW5kZXJlZFJvdXRlLCB7CiAgICAgICAgICAgICAgICBtYXRjaDogbWF0Y2gsCiAgICAgICAgICAgICAgICByb3V0ZUNvbnRleHQ6IHsKICAgICAgICAgICAgICAgICAgb3V0bGV0OiBvdXRsZXQsCiAgICAgICAgICAgICAgICAgIG1hdGNoZXM6IG1hdGNoZXMKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9LCBlcnJvciA/IGVycm9yRWxlbWVudCA6IG1hdGNoLnJvdXRlLmVsZW1lbnQgIT09IHVuZGVmaW5lZCA/IG1hdGNoLnJvdXRlLmVsZW1lbnQgOiBvdXRsZXQpOyAvLyBPbmx5IHdyYXAgaW4gYW4gZXJyb3IgYm91bmRhcnkgd2l0aGluIGRhdGEgcm91dGVyIHVzYWdlcyB3aGVuIHdlIGhhdmUgYW4KICAgICAgICAgICAgICAvLyBlcnJvckVsZW1lbnQgb24gdGhpcyByb3V0ZS4gIE90aGVyd2lzZSBsZXQgaXQgYnViYmxlIHVwIHRvIGFuIGFuY2VzdG9yCiAgICAgICAgICAgICAgLy8gZXJyb3JFbGVtZW50CgoKICAgICAgICAgICAgICByZXR1cm4gZGF0YVJvdXRlclN0YXRlICYmIChtYXRjaC5yb3V0ZS5lcnJvckVsZW1lbnQgfHwgaW5kZXggPT09IDApID8gLyojX19QVVJFX18qL3JlYWN0LmNyZWF0ZUVsZW1lbnQoUmVuZGVyRXJyb3JCb3VuZGFyeSwgewogICAgICAgICAgICAgICAgbG9jYXRpb246IGRhdGFSb3V0ZXJTdGF0ZS5sb2NhdGlvbiwKICAgICAgICAgICAgICAgIGNvbXBvbmVudDogZXJyb3JFbGVtZW50LAogICAgICAgICAgICAgICAgZXJyb3I6IGVycm9yLAogICAgICAgICAgICAgICAgY2hpbGRyZW46IGdldENoaWxkcmVuKCksCiAgICAgICAgICAgICAgICByb3V0ZUNvbnRleHQ6IHsKICAgICAgICAgICAgICAgICAgb3V0bGV0OiBudWxsLAogICAgICAgICAgICAgICAgICBtYXRjaGVzOiBtYXRjaGVzCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfSkgOiBnZXRDaGlsZHJlbigpOwogICAgICAgICAgICB9LCBudWxsKTsKICAgICAgICAgIH0KICAgICAgICAgIHZhciBEYXRhUm91dGVySG9vazsKCiAgICAgICAgICAoZnVuY3Rpb24gKERhdGFSb3V0ZXJIb29rKSB7CiAgICAgICAgICAgIERhdGFSb3V0ZXJIb29rWyJVc2VCbG9ja2VyIl0gPSAidXNlQmxvY2tlciI7CiAgICAgICAgICAgIERhdGFSb3V0ZXJIb29rWyJVc2VSZXZhbGlkYXRvciJdID0gInVzZVJldmFsaWRhdG9yIjsKICAgICAgICAgIH0pKERhdGFSb3V0ZXJIb29rIHx8IChEYXRhUm91dGVySG9vayA9IHt9KSk7CgogICAgICAgICAgdmFyIERhdGFSb3V0ZXJTdGF0ZUhvb2s7CgogICAgICAgICAgKGZ1bmN0aW9uIChEYXRhUm91dGVyU3RhdGVIb29rKSB7CiAgICAgICAgICAgIERhdGFSb3V0ZXJTdGF0ZUhvb2tbIlVzZUxvYWRlckRhdGEiXSA9ICJ1c2VMb2FkZXJEYXRhIjsKICAgICAgICAgICAgRGF0YVJvdXRlclN0YXRlSG9va1siVXNlQWN0aW9uRGF0YSJdID0gInVzZUFjdGlvbkRhdGEiOwogICAgICAgICAgICBEYXRhUm91dGVyU3RhdGVIb29rWyJVc2VSb3V0ZUVycm9yIl0gPSAidXNlUm91dGVFcnJvciI7CiAgICAgICAgICAgIERhdGFSb3V0ZXJTdGF0ZUhvb2tbIlVzZU5hdmlnYXRpb24iXSA9ICJ1c2VOYXZpZ2F0aW9uIjsKICAgICAgICAgICAgRGF0YVJvdXRlclN0YXRlSG9va1siVXNlUm91dGVMb2FkZXJEYXRhIl0gPSAidXNlUm91dGVMb2FkZXJEYXRhIjsKICAgICAgICAgICAgRGF0YVJvdXRlclN0YXRlSG9va1siVXNlTWF0Y2hlcyJdID0gInVzZU1hdGNoZXMiOwogICAgICAgICAgICBEYXRhUm91dGVyU3RhdGVIb29rWyJVc2VSZXZhbGlkYXRvciJdID0gInVzZVJldmFsaWRhdG9yIjsKICAgICAgICAgIH0pKERhdGFSb3V0ZXJTdGF0ZUhvb2sgfHwgKERhdGFSb3V0ZXJTdGF0ZUhvb2sgPSB7fSkpOwoKICAgICAgICAgIGZ1bmN0aW9uIGdldERhdGFSb3V0ZXJDb25zb2xlRXJyb3IoaG9va05hbWUpIHsKICAgICAgICAgICAgcmV0dXJuIGhvb2tOYW1lICsgIiBtdXN0IGJlIHVzZWQgd2l0aGluIGEgZGF0YSByb3V0ZXIuICBTZWUgaHR0cHM6Ly9yZWFjdHJvdXRlci5jb20vcm91dGVycy9waWNraW5nLWEtcm91dGVyLiI7CiAgICAgICAgICB9CgogICAgICAgICAgZnVuY3Rpb24gdXNlRGF0YVJvdXRlckNvbnRleHQoaG9va05hbWUpIHsKICAgICAgICAgICAgdmFyIGN0eCA9IFJlYWN0LnVzZUNvbnRleHQoRGF0YVJvdXRlckNvbnRleHQpOwogICAgICAgICAgICAhY3R4ID8gZmFsc2UgPyAwIDogaW52YXJpYW50KGZhbHNlKSA6IHZvaWQgMDsKICAgICAgICAgICAgcmV0dXJuIGN0eDsKICAgICAgICAgIH0KCiAgICAgICAgICBmdW5jdGlvbiB1c2VEYXRhUm91dGVyU3RhdGUoaG9va05hbWUpIHsKICAgICAgICAgICAgdmFyIHN0YXRlID0gcmVhY3QudXNlQ29udGV4dChEYXRhUm91dGVyU3RhdGVDb250ZXh0KTsKICAgICAgICAgICAgIXN0YXRlID8gZmFsc2UgPyAwIDogcm91dGVyX2ludmFyaWFudChmYWxzZSkgOiB2b2lkIDA7CiAgICAgICAgICAgIHJldHVybiBzdGF0ZTsKICAgICAgICAgIH0KCiAgICAgICAgICBmdW5jdGlvbiB1c2VSb3V0ZUNvbnRleHQoaG9va05hbWUpIHsKICAgICAgICAgICAgdmFyIHJvdXRlID0gcmVhY3QudXNlQ29udGV4dChSb3V0ZUNvbnRleHQpOwogICAgICAgICAgICAhcm91dGUgPyBmYWxzZSA/IDAgOiByb3V0ZXJfaW52YXJpYW50KGZhbHNlKSA6IHZvaWQgMDsKICAgICAgICAgICAgcmV0dXJuIHJvdXRlOwogICAgICAgICAgfQoKICAgICAgICAgIGZ1bmN0aW9uIHVzZUN1cnJlbnRSb3V0ZUlkKGhvb2tOYW1lKSB7CiAgICAgICAgICAgIHZhciByb3V0ZSA9IHVzZVJvdXRlQ29udGV4dChob29rTmFtZSk7CiAgICAgICAgICAgIHZhciB0aGlzUm91dGUgPSByb3V0ZS5tYXRjaGVzW3JvdXRlLm1hdGNoZXMubGVuZ3RoIC0gMV07CiAgICAgICAgICAgICF0aGlzUm91dGUucm91dGUuaWQgPyBmYWxzZSA/IDAgOiByb3V0ZXJfaW52YXJpYW50KGZhbHNlKSA6IHZvaWQgMDsKICAgICAgICAgICAgcmV0dXJuIHRoaXNSb3V0ZS5yb3V0ZS5pZDsKICAgICAgICAgIH0KICAgICAgICAgIC8qKgogICAgICAgICAgICogUmV0dXJucyB0aGUgY3VycmVudCBuYXZpZ2F0aW9uLCBkZWZhdWx0aW5nIHRvIGFuICJpZGxlIiBuYXZpZ2F0aW9uIHdoZW4KICAgICAgICAgICAqIG5vIG5hdmlnYXRpb24gaXMgaW4gcHJvZ3Jlc3MKICAgICAgICAgICAqLwoKCiAgICAgICAgICBmdW5jdGlvbiBkaXN0X3VzZU5hdmlnYXRpb24oKSB7CiAgICAgICAgICAgIHZhciBzdGF0ZSA9IHVzZURhdGFSb3V0ZXJTdGF0ZShEYXRhUm91dGVyU3RhdGVIb29rLlVzZU5hdmlnYXRpb24pOwogICAgICAgICAgICByZXR1cm4gc3RhdGUubmF2aWdhdGlvbjsKICAgICAgICAgIH0KICAgICAgICAgIC8qKgogICAgICAgICAgICogUmV0dXJucyBhIHJldmFsaWRhdGUgZnVuY3Rpb24gZm9yIG1hbnVhbGx5IHRyaWdnZXJpbmcgcmV2YWxpZGF0aW9uLCBhcyB3ZWxsCiAgICAgICAgICAgKiBhcyB0aGUgY3VycmVudCBzdGF0ZSBvZiBhbnkgbWFudWFsIHJldmFsaWRhdGlvbnMKICAgICAgICAgICAqLwoKICAgICAgICAgIGZ1bmN0aW9uIHVzZVJldmFsaWRhdG9yKCkgewogICAgICAgICAgICB2YXIgZGF0YVJvdXRlckNvbnRleHQgPSB1c2VEYXRhUm91dGVyQ29udGV4dChEYXRhUm91dGVySG9vay5Vc2VSZXZhbGlkYXRvcik7CiAgICAgICAgICAgIHZhciBzdGF0ZSA9IHVzZURhdGFSb3V0ZXJTdGF0ZShEYXRhUm91dGVyU3RhdGVIb29rLlVzZVJldmFsaWRhdG9yKTsKICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICByZXZhbGlkYXRlOiBkYXRhUm91dGVyQ29udGV4dC5yb3V0ZXIucmV2YWxpZGF0ZSwKICAgICAgICAgICAgICBzdGF0ZTogc3RhdGUucmV2YWxpZGF0aW9uCiAgICAgICAgICAgIH07CiAgICAgICAgICB9CiAgICAgICAgICAvKioKICAgICAgICAgICAqIFJldHVybnMgdGhlIGFjdGl2ZSByb3V0ZSBtYXRjaGVzLCB1c2VmdWwgZm9yIGFjY2Vzc2luZyBsb2FkZXJEYXRhIGZvcgogICAgICAgICAgICogcGFyZW50L2NoaWxkIHJvdXRlcyBvciB0aGUgcm91dGUgImhhbmRsZSIgcHJvcGVydHkKICAgICAgICAgICAqLwoKICAgICAgICAgIGZ1bmN0aW9uIGRpc3RfdXNlTWF0Y2hlcygpIHsKICAgICAgICAgICAgdmFyIF91c2VEYXRhUm91dGVyU3RhdGUgPQoKCiAgICAgICAgICAgICAgdXNlRGF0YVJvdXRlclN0YXRlKERhdGFSb3V0ZXJTdGF0ZUhvb2suVXNlTWF0Y2hlcyksbWF0Y2hlcyA9IF91c2VEYXRhUm91dGVyU3RhdGUubWF0Y2hlcyxsb2FkZXJEYXRhID0gX3VzZURhdGFSb3V0ZXJTdGF0ZS5sb2FkZXJEYXRhOwogICAgICAgICAgICByZXR1cm4gUmVhY3QudXNlTWVtbygoKSA9PiBtYXRjaGVzLm1hcCgobWF0Y2gpID0+IHsKICAgICAgICAgICAgICB2YXIKICAgICAgICAgICAgICAgIHBhdGhuYW1lID0KCiAgICAgICAgICAgICAgICBtYXRjaC5wYXRobmFtZSxwYXJhbXMgPSBtYXRjaC5wYXJhbXM7IC8vIE5vdGU6IFRoaXMgc3RydWN0dXJlIG1hdGNoZXMgdGhhdCBjcmVhdGVkIGJ5IGNyZWF0ZVVzZU1hdGNoZXNNYXRjaAogICAgICAgICAgICAgIC8vIGluIHRoZSBAcmVtaXgtcnVuL3JvdXRlciAsIHNvIGlmIHlvdSBjaGFuZ2UgdGhpcyBwbGVhc2UgYWxzbyBjaGFuZ2UKICAgICAgICAgICAgICAvLyB0aGF0IDopICBFdmVudHVhbGx5IHdlJ2xsIERSWSB0aGlzIHVwCgogICAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICBpZDogbWF0Y2gucm91dGUuaWQsCiAgICAgICAgICAgICAgICBwYXRobmFtZTogcGF0aG5hbWUsCiAgICAgICAgICAgICAgICBwYXJhbXM6IHBhcmFtcywKICAgICAgICAgICAgICAgIGRhdGE6IGxvYWRlckRhdGFbbWF0Y2gucm91dGUuaWRdLAogICAgICAgICAgICAgICAgaGFuZGxlOiBtYXRjaC5yb3V0ZS5oYW5kbGUKICAgICAgICAgICAgICB9OwogICAgICAgICAgICB9KSwgW21hdGNoZXMsIGxvYWRlckRhdGFdKTsKICAgICAgICAgIH0KICAgICAgICAgIC8qKgogICAgICAgICAgICogUmV0dXJucyB0aGUgbG9hZGVyIGRhdGEgZm9yIHRoZSBuZWFyZXN0IGFuY2VzdG9yIFJvdXRlIGxvYWRlcgogICAgICAgICAgICovCgogICAgICAgICAgZnVuY3Rpb24gdXNlTG9hZGVyRGF0YSgpIHsKICAgICAgICAgICAgdmFyIHN0YXRlID0gdXNlRGF0YVJvdXRlclN0YXRlKERhdGFSb3V0ZXJTdGF0ZUhvb2suVXNlTG9hZGVyRGF0YSk7CiAgICAgICAgICAgIHZhciByb3V0ZUlkID0gdXNlQ3VycmVudFJvdXRlSWQoRGF0YVJvdXRlclN0YXRlSG9vay5Vc2VMb2FkZXJEYXRhKTsKCiAgICAgICAgICAgIGlmIChzdGF0ZS5lcnJvcnMgJiYgc3RhdGUuZXJyb3JzW3JvdXRlSWRdICE9IG51bGwpIHsKICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKCJZb3UgY2Fubm90IGB1c2VMb2FkZXJEYXRhYCBpbiBhbiBlcnJvckVsZW1lbnQgKHJvdXRlSWQ6ICIgKyByb3V0ZUlkICsgIikiKTsKICAgICAgICAgICAgICByZXR1cm4gdW5kZWZpbmVkOwogICAgICAgICAgICB9CgogICAgICAgICAgICByZXR1cm4gc3RhdGUubG9hZGVyRGF0YVtyb3V0ZUlkXTsKICAgICAgICAgIH0KICAgICAgICAgIC8qKgogICAgICAgICAgICogUmV0dXJucyB0aGUgbG9hZGVyRGF0YSBmb3IgdGhlIGdpdmVuIHJvdXRlSWQKICAgICAgICAgICAqLwoKICAgICAgICAgIGZ1bmN0aW9uIHVzZVJvdXRlTG9hZGVyRGF0YShyb3V0ZUlkKSB7CiAgICAgICAgICAgIHZhciBzdGF0ZSA9IHVzZURhdGFSb3V0ZXJTdGF0ZShEYXRhUm91dGVyU3RhdGVIb29rLlVzZVJvdXRlTG9hZGVyRGF0YSk7CiAgICAgICAgICAgIHJldHVybiBzdGF0ZS5sb2FkZXJEYXRhW3JvdXRlSWRdOwogICAgICAgICAgfQogICAgICAgICAgLyoqCiAgICAgICAgICAgKiBSZXR1cm5zIHRoZSBhY3Rpb24gZGF0YSBmb3IgdGhlIG5lYXJlc3QgYW5jZXN0b3IgUm91dGUgYWN0aW9uCiAgICAgICAgICAgKi8KCiAgICAgICAgICBmdW5jdGlvbiB1c2VBY3Rpb25EYXRhKCkgewogICAgICAgICAgICB2YXIgc3RhdGUgPSB1c2VEYXRhUm91dGVyU3RhdGUoRGF0YVJvdXRlclN0YXRlSG9vay5Vc2VBY3Rpb25EYXRhKTsKICAgICAgICAgICAgdmFyIHJvdXRlID0gUmVhY3QudXNlQ29udGV4dChSb3V0ZUNvbnRleHQpOwogICAgICAgICAgICAhcm91dGUgPyBmYWxzZSA/IDAgOiBpbnZhcmlhbnQoZmFsc2UpIDogdm9pZCAwOwogICAgICAgICAgICByZXR1cm4gT2JqZWN0LnZhbHVlcygoc3RhdGUgPT0gbnVsbCA/IHZvaWQgMCA6IHN0YXRlLmFjdGlvbkRhdGEpIHx8IHt9KVswXTsKICAgICAgICAgIH0KICAgICAgICAgIC8qKgogICAgICAgICAgICogUmV0dXJucyB0aGUgbmVhcmVzdCBhbmNlc3RvciBSb3V0ZSBlcnJvciwgd2hpY2ggY291bGQgYmUgYSBsb2FkZXIvYWN0aW9uCiAgICAgICAgICAgKiBlcnJvciBvciBhIHJlbmRlciBlcnJvci4gIFRoaXMgaXMgaW50ZW5kZWQgdG8gYmUgY2FsbGVkIGZyb20geW91cgogICAgICAgICAgICogZXJyb3JFbGVtZW50IHRvIGRpc3BsYXkgYSBwcm9wZXIgZXJyb3IgbWVzc2FnZS4KICAgICAgICAgICAqLwoKICAgICAgICAgIGZ1bmN0aW9uIHVzZVJvdXRlRXJyb3IoKSB7CiAgICAgICAgICAgIHZhciBfc3RhdGUkZXJyb3JzOwoKICAgICAgICAgICAgdmFyIGVycm9yID0gcmVhY3QudXNlQ29udGV4dChSb3V0ZUVycm9yQ29udGV4dCk7CiAgICAgICAgICAgIHZhciBzdGF0ZSA9IHVzZURhdGFSb3V0ZXJTdGF0ZShEYXRhUm91dGVyU3RhdGVIb29rLlVzZVJvdXRlRXJyb3IpOwogICAgICAgICAgICB2YXIgcm91dGVJZCA9IHVzZUN1cnJlbnRSb3V0ZUlkKERhdGFSb3V0ZXJTdGF0ZUhvb2suVXNlUm91dGVFcnJvcik7IC8vIElmIHRoaXMgd2FzIGEgcmVuZGVyIGVycm9yLCB3ZSBwdXQgaXQgaW4gYSBSb3V0ZUVycm9yIGNvbnRleHQgaW5zaWRlCiAgICAgICAgICAgIC8vIG9mIFJlbmRlckVycm9yQm91bmRhcnkKCiAgICAgICAgICAgIGlmIChlcnJvcikgewogICAgICAgICAgICAgIHJldHVybiBlcnJvcjsKICAgICAgICAgICAgfSAvLyBPdGhlcndpc2UgbG9vayBmb3IgZXJyb3JzIGZyb20gb3VyIGRhdGEgcm91dGVyIHN0YXRlCgoKICAgICAgICAgICAgcmV0dXJuIChfc3RhdGUkZXJyb3JzID0gc3RhdGUuZXJyb3JzKSA9PSBudWxsID8gdm9pZCAwIDogX3N0YXRlJGVycm9yc1tyb3V0ZUlkXTsKICAgICAgICAgIH0KICAgICAgICAgIC8qKgogICAgICAgICAgICogUmV0dXJucyB0aGUgaGFwcHktcGF0aCBkYXRhIGZyb20gdGhlIG5lYXJlc3QgYW5jZXN0b3IgPEF3YWl0IC8+IHZhbHVlCiAgICAgICAgICAgKi8KCiAgICAgICAgICBmdW5jdGlvbiB1c2VBc3luY1ZhbHVlKCkgewogICAgICAgICAgICB2YXIgdmFsdWUgPSBSZWFjdC51c2VDb250ZXh0KEF3YWl0Q29udGV4dCk7CiAgICAgICAgICAgIHJldHVybiB2YWx1ZSA9PSBudWxsID8gdm9pZCAwIDogdmFsdWUuX2RhdGE7CiAgICAgICAgICB9CiAgICAgICAgICAvKioKICAgICAgICAgICAqIFJldHVybnMgdGhlIGVycm9yIGZyb20gdGhlIG5lYXJlc3QgYW5jZXN0b3IgPEF3YWl0IC8+IHZhbHVlCiAgICAgICAgICAgKi8KCiAgICAgICAgICBmdW5jdGlvbiB1c2VBc3luY0Vycm9yKCkgewogICAgICAgICAgICB2YXIgdmFsdWUgPSBSZWFjdC51c2VDb250ZXh0KEF3YWl0Q29udGV4dCk7CiAgICAgICAgICAgIHJldHVybiB2YWx1ZSA9PSBudWxsID8gdm9pZCAwIDogdmFsdWUuX2Vycm9yOwogICAgICAgICAgfSAvLyB1c2VCbG9ja2VyKCkgaXMgYSBzaW5nbGV0b24gZm9yIG5vdyBzaW5jZSB3ZSBkb24ndCBoYXZlIGFueSBjb21wZWxsaW5nIHVzZQogICAgICAgICAgLy8gY2FzZXMgZm9yIG11bHRpLWJsb2NrZXIgeWV0CgogICAgICAgICAgdmFyIGJsb2NrZXJLZXkgPSAiYmxvY2tlci1zaW5nbGV0b24iOwogICAgICAgICAgLyoqCiAgICAgICAgICAgKiBBbGxvdyB0aGUgYXBwbGljYXRpb24gdG8gYmxvY2sgbmF2aWdhdGlvbnMgd2l0aGluIHRoZSBTUEEgYW5kIHByZXNlbnQgdGhlCiAgICAgICAgICAgKiB1c2VyIGEgY29uZmlybWF0aW9uIGRpYWxvZyB0byBjb25maXJtIHRoZSBuYXZpZ2F0aW9uLiAgTW9zdGx5IHVzZWQgdG8gYXZvaWQKICAgICAgICAgICAqIHVzaW5nIGhhbGYtZmlsbGVkIGZvcm0gZGF0YS4gIFRoaXMgZG9lcyBub3QgaGFuZGxlIGhhcmQtcmVsb2FkcyBvcgogICAgICAgICAgICogY3Jvc3Mtb3JpZ2luIG5hdmlnYXRpb25zLgogICAgICAgICAgICovCgogICAgICAgICAgZnVuY3Rpb24gdXNlQmxvY2tlcihzaG91bGRCbG9jaykgewogICAgICAgICAgICB2YXIgX3VzZURhdGFSb3V0ZXJDb250ZXh0ID0KCiAgICAgICAgICAgICAgdXNlRGF0YVJvdXRlckNvbnRleHQoRGF0YVJvdXRlckhvb2suVXNlQmxvY2tlcikscm91dGVyID0gX3VzZURhdGFSb3V0ZXJDb250ZXh0LnJvdXRlcjsKICAgICAgICAgICAgdmFyIGJsb2NrZXJGdW5jdGlvbiA9IFJlYWN0LnVzZUNhbGxiYWNrKChhcmdzKSA9PiB7CiAgICAgICAgICAgICAgcmV0dXJuIHR5cGVvZiBzaG91bGRCbG9jayA9PT0gImZ1bmN0aW9uIiA/ICEhc2hvdWxkQmxvY2soYXJncykgOiAhIXNob3VsZEJsb2NrOwogICAgICAgICAgICB9LCBbc2hvdWxkQmxvY2tdKTsKICAgICAgICAgICAgdmFyIGJsb2NrZXIgPSByb3V0ZXIuZ2V0QmxvY2tlcihibG9ja2VyS2V5LCBibG9ja2VyRnVuY3Rpb24pOyAvLyBDbGVhbnVwIG9uIHVubW91bnQKCiAgICAgICAgICAgIFJlYWN0LnVzZUVmZmVjdCgoKSA9PiAoKSA9PiByb3V0ZXIuZGVsZXRlQmxvY2tlcihibG9ja2VyS2V5KSwgW3JvdXRlcl0pOwogICAgICAgICAgICByZXR1cm4gYmxvY2tlcjsKICAgICAgICAgIH0KICAgICAgICAgIHZhciBhbHJlYWR5V2FybmVkID0ge307CgogICAgICAgICAgZnVuY3Rpb24gd2FybmluZ09uY2Uoa2V5LCBjb25kLCBtZXNzYWdlKSB7CiAgICAgICAgICAgIGlmICghY29uZCAmJiAhYWxyZWFkeVdhcm5lZFtrZXldKSB7CiAgICAgICAgICAgICAgYWxyZWFkeVdhcm5lZFtrZXldID0gdHJ1ZTsKICAgICAgICAgICAgICBmYWxzZSA/IDAgOiB2b2lkIDA7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KCiAgICAgICAgICAvKioKICAgICAgICAgICAqIEdpdmVuIGEgUmVtaXggUm91dGVyIGluc3RhbmNlLCByZW5kZXIgdGhlIGFwcHJvcHJpYXRlIFVJCiAgICAgICAgICAgKi8KICAgICAgICAgIGZ1bmN0aW9uIFJvdXRlclByb3ZpZGVyKF9yZWYpIHsKICAgICAgICAgICAgdmFyCiAgICAgICAgICAgICAgZmFsbGJhY2tFbGVtZW50ID0KCiAgICAgICAgICAgICAgX3JlZi5mYWxsYmFja0VsZW1lbnQscm91dGVyID0gX3JlZi5yb3V0ZXI7CiAgICAgICAgICAgIC8vIFN5bmMgcm91dGVyIHN0YXRlIHRvIG91ciBjb21wb25lbnQgc3RhdGUgdG8gZm9yY2UgcmUtcmVuZGVycwogICAgICAgICAgICB2YXIgc3RhdGUgPSB1c2VTeW5jRXh0ZXJuYWxTdG9yZShyb3V0ZXIuc3Vic2NyaWJlLCAoKSA9PiByb3V0ZXIuc3RhdGUsIC8vIFdlIGhhdmUgdG8gcHJvdmlkZSB0aGlzIHNvIFJlYWN0QDE4IGRvZXNuJ3QgY29tcGxhaW4gZHVyaW5nIGh5ZHJhdGlvbiwKICAgICAgICAgICAgLy8gYnV0IHdlIHBhc3Mgb3VyIHNlcmlhbGl6ZWQgaHlkcmF0aW9uIGRhdGEgaW50byB0aGUgcm91dGVyIHNvIHN0YXRlIGhlcmUKICAgICAgICAgICAgLy8gaXMgYWxyZWFkeSBzeW5jZWQgd2l0aCB3aGF0IHRoZSBzZXJ2ZXIgc2F3CiAgICAgICAgICAgICgpID0+IHJvdXRlci5zdGF0ZSk7CiAgICAgICAgICAgIHZhciBuYXZpZ2F0b3IgPSBSZWFjdC51c2VNZW1vKCgpID0+IHsKICAgICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgY3JlYXRlSHJlZjogcm91dGVyLmNyZWF0ZUhyZWYsCiAgICAgICAgICAgICAgICBlbmNvZGVMb2NhdGlvbjogcm91dGVyLmVuY29kZUxvY2F0aW9uLAogICAgICAgICAgICAgICAgZ286IChuKSA9PiByb3V0ZXIubmF2aWdhdGUobiksCiAgICAgICAgICAgICAgICBwdXNoOiAodG8sIHN0YXRlLCBvcHRzKSA9PiByb3V0ZXIubmF2aWdhdGUodG8sIHsKICAgICAgICAgICAgICAgICAgc3RhdGU6IHN0YXRlLAogICAgICAgICAgICAgICAgICBwcmV2ZW50U2Nyb2xsUmVzZXQ6IG9wdHMgPT0gbnVsbCA/IHZvaWQgMCA6IG9wdHMucHJldmVudFNjcm9sbFJlc2V0CiAgICAgICAgICAgICAgICB9KSwKICAgICAgICAgICAgICAgIHJlcGxhY2U6ICh0bywgc3RhdGUsIG9wdHMpID0+IHJvdXRlci5uYXZpZ2F0ZSh0bywgewogICAgICAgICAgICAgICAgICByZXBsYWNlOiB0cnVlLAogICAgICAgICAgICAgICAgICBzdGF0ZTogc3RhdGUsCiAgICAgICAgICAgICAgICAgIHByZXZlbnRTY3JvbGxSZXNldDogb3B0cyA9PSBudWxsID8gdm9pZCAwIDogb3B0cy5wcmV2ZW50U2Nyb2xsUmVzZXQKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgfSwgW3JvdXRlcl0pOwogICAgICAgICAgICB2YXIgYmFzZW5hbWUgPSByb3V0ZXIuYmFzZW5hbWUgfHwgIi8iOyAvLyBUaGUgZnJhZ21lbnQgYW5kIHtudWxsfSBoZXJlIGFyZSBpbXBvcnRhbnQhICBXZSBuZWVkIHRoZW0gdG8ga2VlcCBSZWFjdCAxOCdzCiAgICAgICAgICAgIC8vIHVzZUlkIGhhcHB5IHdoZW4gd2UgYXJlIHNlcnZlci1yZW5kZXJpbmcgc2luY2Ugd2UgbWF5IGhhdmUgYSA8c2NyaXB0PiBoZXJlCiAgICAgICAgICAgIC8vIGNvbnRhaW5pbmcgdGhlIGh5ZHJhdGVkIHNlcnZlci1zaWRlIHN0YXRpY0NvbnRleHQgKGZyb20gU3RhdGljUm91dGVyUHJvdmlkZXIpLgogICAgICAgICAgICAvLyB1c2VJZCByZWxpZXMgb24gdGhlIGNvbXBvbmVudCB0cmVlIHN0cnVjdHVyZSB0byBnZW5lcmF0ZSBkZXRlcm1pbmlzdGljIGlkJ3MKICAgICAgICAgICAgLy8gc28gd2UgbmVlZCB0byBlbnN1cmUgaXQgcmVtYWlucyB0aGUgc2FtZSBvbiB0aGUgY2xpZW50IGV2ZW4gdGhvdWdoCiAgICAgICAgICAgIC8vIHdlIGRvbid0IG5lZWQgdGhlIDxzY3JpcHQ+IHRhZwoKICAgICAgICAgICAgcmV0dXJuIC8qI19fUFVSRV9fKi9SZWFjdC5jcmVhdGVFbGVtZW50KFJlYWN0LkZyYWdtZW50LCBudWxsLCAvKiNfX1BVUkVfXyovUmVhY3QuY3JlYXRlRWxlbWVudChEYXRhUm91dGVyQ29udGV4dC5Qcm92aWRlciwgewogICAgICAgICAgICAgIHZhbHVlOiB7CiAgICAgICAgICAgICAgICByb3V0ZXI6IHJvdXRlciwKICAgICAgICAgICAgICAgIG5hdmlnYXRvcjogbmF2aWdhdG9yLAogICAgICAgICAgICAgICAgc3RhdGljOiBmYWxzZSwKICAgICAgICAgICAgICAgIC8vIERvIHdlIG5lZWQgdGhpcz8KICAgICAgICAgICAgICAgIGJhc2VuYW1lOiBiYXNlbmFtZQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwgLyojX19QVVJFX18qL1JlYWN0LmNyZWF0ZUVsZW1lbnQoRGF0YVJvdXRlclN0YXRlQ29udGV4dC5Qcm92aWRlciwgewogICAgICAgICAgICAgIHZhbHVlOiBzdGF0ZQogICAgICAgICAgICB9LCAvKiNfX1BVUkVfXyovUmVhY3QuY3JlYXRlRWxlbWVudChkaXN0X1JvdXRlciwgewogICAgICAgICAgICAgIGJhc2VuYW1lOiByb3V0ZXIuYmFzZW5hbWUsCiAgICAgICAgICAgICAgbG9jYXRpb246IHJvdXRlci5zdGF0ZS5sb2NhdGlvbiwKICAgICAgICAgICAgICBuYXZpZ2F0aW9uVHlwZTogcm91dGVyLnN0YXRlLmhpc3RvcnlBY3Rpb24sCiAgICAgICAgICAgICAgbmF2aWdhdG9yOiBuYXZpZ2F0b3IKICAgICAgICAgICAgfSwgcm91dGVyLnN0YXRlLmluaXRpYWxpemVkID8gLyojX19QVVJFX18qL1JlYWN0LmNyZWF0ZUVsZW1lbnQoUm91dGVzLCBudWxsKSA6IGZhbGxiYWNrRWxlbWVudCkpKSwgbnVsbCk7CiAgICAgICAgICB9CgogICAgICAgICAgLyoqCiAgICAgICAgICAgKiBBIDxSb3V0ZXI+IHRoYXQgc3RvcmVzIGFsbCBlbnRyaWVzIGluIG1lbW9yeS4KICAgICAgICAgICAqCiAgICAgICAgICAgKiBAc2VlIGh0dHBzOi8vcmVhY3Ryb3V0ZXIuY29tL3JvdXRlci1jb21wb25lbnRzL21lbW9yeS1yb3V0ZXIKICAgICAgICAgICAqLwogICAgICAgICAgZnVuY3Rpb24gTWVtb3J5Um91dGVyKF9yZWYyKSB7CiAgICAgICAgICAgIHZhcgogICAgICAgICAgICAgIGJhc2VuYW1lID0KCgoKICAgICAgICAgICAgICBfcmVmMi5iYXNlbmFtZSxjaGlsZHJlbiA9IF9yZWYyLmNoaWxkcmVuLGluaXRpYWxFbnRyaWVzID0gX3JlZjIuaW5pdGlhbEVudHJpZXMsaW5pdGlhbEluZGV4ID0gX3JlZjIuaW5pdGlhbEluZGV4OwogICAgICAgICAgICB2YXIgaGlzdG9yeVJlZiA9IHJlYWN0LnVzZVJlZigpOwoKICAgICAgICAgICAgaWYgKGhpc3RvcnlSZWYuY3VycmVudCA9PSBudWxsKSB7CiAgICAgICAgICAgICAgaGlzdG9yeVJlZi5jdXJyZW50ID0gcm91dGVyX2NyZWF0ZU1lbW9yeUhpc3RvcnkoewogICAgICAgICAgICAgICAgaW5pdGlhbEVudHJpZXM6IGluaXRpYWxFbnRyaWVzLAogICAgICAgICAgICAgICAgaW5pdGlhbEluZGV4OiBpbml0aWFsSW5kZXgsCiAgICAgICAgICAgICAgICB2NUNvbXBhdDogdHJ1ZQogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CgogICAgICAgICAgICB2YXIgaGlzdG9yeSA9IGhpc3RvcnlSZWYuY3VycmVudDsKICAgICAgICAgICAgdmFyIF9yZWFjdCR1c2VTdGF0ZSA9IHJlYWN0LnVzZVN0YXRlKHsKICAgICAgICAgICAgICAgIGFjdGlvbjogaGlzdG9yeS5hY3Rpb24sCiAgICAgICAgICAgICAgICBsb2NhdGlvbjogaGlzdG9yeS5sb2NhdGlvbgogICAgICAgICAgICAgIH0pLF9yZWFjdCR1c2VTdGF0ZTIgPSBfc2xpY2VkVG9BcnJheTIoX3JlYWN0JHVzZVN0YXRlLCAyKSxzdGF0ZSA9IF9yZWFjdCR1c2VTdGF0ZTJbMF0sc2V0U3RhdGUgPSBfcmVhY3QkdXNlU3RhdGUyWzFdOwogICAgICAgICAgICByZWFjdC51c2VMYXlvdXRFZmZlY3QoKCkgPT4gaGlzdG9yeS5saXN0ZW4oc2V0U3RhdGUpLCBbaGlzdG9yeV0pOwogICAgICAgICAgICByZXR1cm4gLyojX19QVVJFX18qL3JlYWN0LmNyZWF0ZUVsZW1lbnQoZGlzdF9Sb3V0ZXIsIHsKICAgICAgICAgICAgICBiYXNlbmFtZTogYmFzZW5hbWUsCiAgICAgICAgICAgICAgY2hpbGRyZW46IGNoaWxkcmVuLAogICAgICAgICAgICAgIGxvY2F0aW9uOiBzdGF0ZS5sb2NhdGlvbiwKICAgICAgICAgICAgICBuYXZpZ2F0aW9uVHlwZTogc3RhdGUuYWN0aW9uLAogICAgICAgICAgICAgIG5hdmlnYXRvcjogaGlzdG9yeQogICAgICAgICAgICB9KTsKICAgICAgICAgIH0KCiAgICAgICAgICAvKioKICAgICAgICAgICAqIENoYW5nZXMgdGhlIGN1cnJlbnQgbG9jYXRpb24uCiAgICAgICAgICAgKgogICAgICAgICAgICogTm90ZTogVGhpcyBBUEkgaXMgbW9zdGx5IHVzZWZ1bCBpbiBSZWFjdC5Db21wb25lbnQgc3ViY2xhc3NlcyB0aGF0IGFyZSBub3QKICAgICAgICAgICAqIGFibGUgdG8gdXNlIGhvb2tzLiBJbiBmdW5jdGlvbmFsIGNvbXBvbmVudHMsIHdlIHJlY29tbWVuZCB5b3UgdXNlIHRoZQogICAgICAgICAgICogYHVzZU5hdmlnYXRlYCBob29rIGluc3RlYWQuCiAgICAgICAgICAgKgogICAgICAgICAgICogQHNlZSBodHRwczovL3JlYWN0cm91dGVyLmNvbS9jb21wb25lbnRzL25hdmlnYXRlCiAgICAgICAgICAgKi8KICAgICAgICAgIGZ1bmN0aW9uIE5hdmlnYXRlKF9yZWYzKSB7CiAgICAgICAgICAgIHZhcgogICAgICAgICAgICAgIHRvID0KCgoKICAgICAgICAgICAgICBfcmVmMy50byxyZXBsYWNlID0gX3JlZjMucmVwbGFjZSxzdGF0ZSA9IF9yZWYzLnN0YXRlLHJlbGF0aXZlID0gX3JlZjMucmVsYXRpdmU7CiAgICAgICAgICAgICF1c2VJblJvdXRlckNvbnRleHQoKSA/IGZhbHNlID8gMCA6IHJvdXRlcl9pbnZhcmlhbnQoZmFsc2UpIDogdm9pZCAwOwogICAgICAgICAgICBmYWxzZSA/IDAgOiB2b2lkIDA7CiAgICAgICAgICAgIHZhciBkYXRhUm91dGVyU3RhdGUgPSByZWFjdC51c2VDb250ZXh0KERhdGFSb3V0ZXJTdGF0ZUNvbnRleHQpOwogICAgICAgICAgICB2YXIgbmF2aWdhdGUgPSBkaXN0X3VzZU5hdmlnYXRlKCk7CiAgICAgICAgICAgIHJlYWN0LnVzZUVmZmVjdCgoKSA9PiB7CiAgICAgICAgICAgICAgLy8gQXZvaWQga2lja2luZyBvZmYgbXVsdGlwbGUgbmF2aWdhdGlvbnMgaWYgd2UncmUgaW4gdGhlIG1pZGRsZSBvZiBhCiAgICAgICAgICAgICAgLy8gZGF0YS1yb3V0ZXIgbmF2aWdhdGlvbiwgc2luY2UgY29tcG9uZW50cyBnZXQgcmUtcmVuZGVyZWQgd2hlbiB3ZSBlbnRlcgogICAgICAgICAgICAgIC8vIGEgc3VibWl0dGluZy9sb2FkaW5nIHN0YXRlCiAgICAgICAgICAgICAgaWYgKGRhdGFSb3V0ZXJTdGF0ZSAmJiBkYXRhUm91dGVyU3RhdGUubmF2aWdhdGlvbi5zdGF0ZSAhPT0gImlkbGUiKSB7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBuYXZpZ2F0ZSh0bywgewogICAgICAgICAgICAgICAgcmVwbGFjZTogcmVwbGFjZSwKICAgICAgICAgICAgICAgIHN0YXRlOiBzdGF0ZSwKICAgICAgICAgICAgICAgIHJlbGF0aXZlOiByZWxhdGl2ZQogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9KTsKICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgICB9CgogICAgICAgICAgLyoqCiAgICAgICAgICAgKiBSZW5kZXJzIHRoZSBjaGlsZCByb3V0ZSdzIGVsZW1lbnQsIGlmIHRoZXJlIGlzIG9uZS4KICAgICAgICAgICAqCiAgICAgICAgICAgKiBAc2VlIGh0dHBzOi8vcmVhY3Ryb3V0ZXIuY29tL2NvbXBvbmVudHMvb3V0bGV0CiAgICAgICAgICAgKi8KICAgICAgICAgIGZ1bmN0aW9uIE91dGxldChwcm9wcykgewogICAgICAgICAgICByZXR1cm4gdXNlT3V0bGV0KHByb3BzLmNvbnRleHQpOwogICAgICAgICAgfQoKICAgICAgICAgIC8qKgogICAgICAgICAgICogRGVjbGFyZXMgYW4gZWxlbWVudCB0aGF0IHNob3VsZCBiZSByZW5kZXJlZCBhdCBhIGNlcnRhaW4gVVJMIHBhdGguCiAgICAgICAgICAgKgogICAgICAgICAgICogQHNlZSBodHRwczovL3JlYWN0cm91dGVyLmNvbS9jb21wb25lbnRzL3JvdXRlCiAgICAgICAgICAgKi8KICAgICAgICAgIGZ1bmN0aW9uIFJvdXRlKF9wcm9wcykgewogICAgICAgICAgICBmYWxzZSA/IDAgOiByb3V0ZXJfaW52YXJpYW50KGZhbHNlKTsKICAgICAgICAgIH0KCiAgICAgICAgICAvKioKICAgICAgICAgICAqIFByb3ZpZGVzIGxvY2F0aW9uIGNvbnRleHQgZm9yIHRoZSByZXN0IG9mIHRoZSBhcHAuCiAgICAgICAgICAgKgogICAgICAgICAgICogTm90ZTogWW91IHVzdWFsbHkgd29uJ3QgcmVuZGVyIGEgPFJvdXRlcj4gZGlyZWN0bHkuIEluc3RlYWQsIHlvdSdsbCByZW5kZXIgYQogICAgICAgICAgICogcm91dGVyIHRoYXQgaXMgbW9yZSBzcGVjaWZpYyB0byB5b3VyIGVudmlyb25tZW50IHN1Y2ggYXMgYSA8QnJvd3NlclJvdXRlcj4KICAgICAgICAgICAqIGluIHdlYiBicm93c2VycyBvciBhIDxTdGF0aWNSb3V0ZXI+IGZvciBzZXJ2ZXIgcmVuZGVyaW5nLgogICAgICAgICAgICoKICAgICAgICAgICAqIEBzZWUgaHR0cHM6Ly9yZWFjdHJvdXRlci5jb20vcm91dGVyLWNvbXBvbmVudHMvcm91dGVyCiAgICAgICAgICAgKi8KICAgICAgICAgIGZ1bmN0aW9uIGRpc3RfUm91dGVyKF9yZWY0KSB7CiAgICAgICAgICAgIHZhciBfcmVmNCRiYXNlbmFtZSA9CgoKCgoKCiAgICAgICAgICAgICAgX3JlZjQuYmFzZW5hbWUsYmFzZW5hbWVQcm9wID0gX3JlZjQkYmFzZW5hbWUgPT09IHZvaWQgMCA/ICIvIiA6IF9yZWY0JGJhc2VuYW1lLF9yZWY0JGNoaWxkcmVuID0gX3JlZjQuY2hpbGRyZW4sY2hpbGRyZW4gPSBfcmVmNCRjaGlsZHJlbiA9PT0gdm9pZCAwID8gbnVsbCA6IF9yZWY0JGNoaWxkcmVuLGxvY2F0aW9uUHJvcCA9IF9yZWY0LmxvY2F0aW9uLF9yZWY0JG5hdmlnYXRpb25UeXBlID0gX3JlZjQubmF2aWdhdGlvblR5cGUsbmF2aWdhdGlvblR5cGUgPSBfcmVmNCRuYXZpZ2F0aW9uVHlwZSA9PT0gdm9pZCAwID8gQWN0aW9uLlBvcCA6IF9yZWY0JG5hdmlnYXRpb25UeXBlLG5hdmlnYXRvciA9IF9yZWY0Lm5hdmlnYXRvcixfcmVmNCRzdGF0aWMgPSBfcmVmNC5zdGF0aWMsc3RhdGljUHJvcCA9IF9yZWY0JHN0YXRpYyA9PT0gdm9pZCAwID8gZmFsc2UgOiBfcmVmNCRzdGF0aWM7CiAgICAgICAgICAgICEhdXNlSW5Sb3V0ZXJDb250ZXh0KCkgPyBmYWxzZSA/IDAgOiByb3V0ZXJfaW52YXJpYW50KGZhbHNlKSA6IHZvaWQgMDsgLy8gUHJlc2VydmUgdHJhaWxpbmcgc2xhc2hlcyBvbiBiYXNlbmFtZSwgc28gd2UgY2FuIGxldCB0aGUgdXNlciBjb250cm9sCiAgICAgICAgICAgIC8vIHRoZSBlbmZvcmNlbWVudCBvZiB0cmFpbGluZyBzbGFzaGVzIHRocm91Z2hvdXQgdGhlIGFwcAoKICAgICAgICAgICAgdmFyIGJhc2VuYW1lID0gYmFzZW5hbWVQcm9wLnJlcGxhY2UoL15cLyovLCAiLyIpOwogICAgICAgICAgICB2YXIgbmF2aWdhdGlvbkNvbnRleHQgPSByZWFjdC51c2VNZW1vKCgpID0+ICh7CiAgICAgICAgICAgICAgYmFzZW5hbWU6IGJhc2VuYW1lLAogICAgICAgICAgICAgIG5hdmlnYXRvcjogbmF2aWdhdG9yLAogICAgICAgICAgICAgIHN0YXRpYzogc3RhdGljUHJvcAogICAgICAgICAgICB9KSwgW2Jhc2VuYW1lLCBuYXZpZ2F0b3IsIHN0YXRpY1Byb3BdKTsKCiAgICAgICAgICAgIGlmICh0eXBlb2YgbG9jYXRpb25Qcm9wID09PSAic3RyaW5nIikgewogICAgICAgICAgICAgIGxvY2F0aW9uUHJvcCA9IHBhcnNlUGF0aChsb2NhdGlvblByb3ApOwogICAgICAgICAgICB9CgogICAgICAgICAgICB2YXIgX2xvY2F0aW9uUHJvcCA9CgoKCgoKICAgICAgICAgICAgICBsb2NhdGlvblByb3AsX2xvY2F0aW9uUHJvcCRwYXRobmFtID0gX2xvY2F0aW9uUHJvcC5wYXRobmFtZSxwYXRobmFtZSA9IF9sb2NhdGlvblByb3AkcGF0aG5hbSA9PT0gdm9pZCAwID8gIi8iIDogX2xvY2F0aW9uUHJvcCRwYXRobmFtLF9sb2NhdGlvblByb3Akc2VhcmNoID0gX2xvY2F0aW9uUHJvcC5zZWFyY2gsc2VhcmNoID0gX2xvY2F0aW9uUHJvcCRzZWFyY2ggPT09IHZvaWQgMCA/ICIiIDogX2xvY2F0aW9uUHJvcCRzZWFyY2gsX2xvY2F0aW9uUHJvcCRoYXNoID0gX2xvY2F0aW9uUHJvcC5oYXNoLGhhc2ggPSBfbG9jYXRpb25Qcm9wJGhhc2ggPT09IHZvaWQgMCA/ICIiIDogX2xvY2F0aW9uUHJvcCRoYXNoLF9sb2NhdGlvblByb3Akc3RhdGUgPSBfbG9jYXRpb25Qcm9wLnN0YXRlLHN0YXRlID0gX2xvY2F0aW9uUHJvcCRzdGF0ZSA9PT0gdm9pZCAwID8gbnVsbCA6IF9sb2NhdGlvblByb3Akc3RhdGUsX2xvY2F0aW9uUHJvcCRrZXkgPSBfbG9jYXRpb25Qcm9wLmtleSxrZXkgPSBfbG9jYXRpb25Qcm9wJGtleSA9PT0gdm9pZCAwID8gImRlZmF1bHQiIDogX2xvY2F0aW9uUHJvcCRrZXk7CiAgICAgICAgICAgIHZhciBsb2NhdGlvbiA9IHJlYWN0LnVzZU1lbW8oKCkgPT4gewogICAgICAgICAgICAgIHZhciB0cmFpbGluZ1BhdGhuYW1lID0gc3RyaXBCYXNlbmFtZShwYXRobmFtZSwgYmFzZW5hbWUpOwoKICAgICAgICAgICAgICBpZiAodHJhaWxpbmdQYXRobmFtZSA9PSBudWxsKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICBwYXRobmFtZTogdHJhaWxpbmdQYXRobmFtZSwKICAgICAgICAgICAgICAgIHNlYXJjaDogc2VhcmNoLAogICAgICAgICAgICAgICAgaGFzaDogaGFzaCwKICAgICAgICAgICAgICAgIHN0YXRlOiBzdGF0ZSwKICAgICAgICAgICAgICAgIGtleToga2V5CiAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgfSwgW2Jhc2VuYW1lLCBwYXRobmFtZSwgc2VhcmNoLCBoYXNoLCBzdGF0ZSwga2V5XSk7CiAgICAgICAgICAgIGZhbHNlID8gMCA6IHZvaWQgMDsKCiAgICAgICAgICAgIGlmIChsb2NhdGlvbiA9PSBudWxsKSB7CiAgICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybiAvKiNfX1BVUkVfXyovcmVhY3QuY3JlYXRlRWxlbWVudChOYXZpZ2F0aW9uQ29udGV4dC5Qcm92aWRlciwgewogICAgICAgICAgICAgIHZhbHVlOiBuYXZpZ2F0aW9uQ29udGV4dAogICAgICAgICAgICB9LCAvKiNfX1BVUkVfXyovcmVhY3QuY3JlYXRlRWxlbWVudChMb2NhdGlvbkNvbnRleHQuUHJvdmlkZXIsIHsKICAgICAgICAgICAgICBjaGlsZHJlbjogY2hpbGRyZW4sCiAgICAgICAgICAgICAgdmFsdWU6IHsKICAgICAgICAgICAgICAgIGxvY2F0aW9uOiBsb2NhdGlvbiwKICAgICAgICAgICAgICAgIG5hdmlnYXRpb25UeXBlOiBuYXZpZ2F0aW9uVHlwZQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSkpOwogICAgICAgICAgfQoKICAgICAgICAgIC8qKgogICAgICAgICAgICogQSBjb250YWluZXIgZm9yIGEgbmVzdGVkIHRyZWUgb2YgPFJvdXRlPiBlbGVtZW50cyB0aGF0IHJlbmRlcnMgdGhlIGJyYW5jaAogICAgICAgICAgICogdGhhdCBiZXN0IG1hdGNoZXMgdGhlIGN1cnJlbnQgbG9jYXRpb24uCiAgICAgICAgICAgKgogICAgICAgICAgICogQHNlZSBodHRwczovL3JlYWN0cm91dGVyLmNvbS9jb21wb25lbnRzL3JvdXRlcwogICAgICAgICAgICovCiAgICAgICAgICBmdW5jdGlvbiBSb3V0ZXMoX3JlZjUpIHsKICAgICAgICAgICAgdmFyCiAgICAgICAgICAgICAgY2hpbGRyZW4gPQoKICAgICAgICAgICAgICBfcmVmNS5jaGlsZHJlbixsb2NhdGlvbiA9IF9yZWY1LmxvY2F0aW9uOwogICAgICAgICAgICB2YXIgZGF0YVJvdXRlckNvbnRleHQgPSByZWFjdC51c2VDb250ZXh0KERhdGFSb3V0ZXJDb250ZXh0KTsgLy8gV2hlbiBpbiBhIERhdGFSb3V0ZXJDb250ZXh0IF93aXRob3V0XyBjaGlsZHJlbiwgd2UgdXNlIHRoZSByb3V0ZXIgcm91dGVzCiAgICAgICAgICAgIC8vIGRpcmVjdGx5LiAgSWYgd2UgaGF2ZSBjaGlsZHJlbiwgdGhlbiB3ZSdyZSBpbiBhIGRlc2NlbmRhbnQgdHJlZSBhbmQgd2UKICAgICAgICAgICAgLy8gbmVlZCB0byB1c2UgY2hpbGQgcm91dGVzLgoKICAgICAgICAgICAgdmFyIHJvdXRlcyA9IGRhdGFSb3V0ZXJDb250ZXh0ICYmICFjaGlsZHJlbiA/IGRhdGFSb3V0ZXJDb250ZXh0LnJvdXRlci5yb3V0ZXMgOiBjcmVhdGVSb3V0ZXNGcm9tQ2hpbGRyZW4oY2hpbGRyZW4pOwogICAgICAgICAgICByZXR1cm4gdXNlUm91dGVzKHJvdXRlcywgbG9jYXRpb24pOwogICAgICAgICAgfQoKICAgICAgICAgIC8qKgogICAgICAgICAgICogQ29tcG9uZW50IHRvIHVzZSBmb3IgcmVuZGVyaW5nIGxhemlseSBsb2FkZWQgZGF0YSBmcm9tIHJldHVybmluZyBkZWZlcigpCiAgICAgICAgICAgKiBpbiBhIGxvYWRlciBmdW5jdGlvbgogICAgICAgICAgICovCiAgICAgICAgICBmdW5jdGlvbiBBd2FpdChfcmVmNikgewogICAgICAgICAgICB2YXIKICAgICAgICAgICAgICBjaGlsZHJlbiA9CgoKICAgICAgICAgICAgICBfcmVmNi5jaGlsZHJlbixlcnJvckVsZW1lbnQgPSBfcmVmNi5lcnJvckVsZW1lbnQscmVzb2x2ZSA9IF9yZWY2LnJlc29sdmU7CiAgICAgICAgICAgIHJldHVybiAvKiNfX1BVUkVfXyovUmVhY3QuY3JlYXRlRWxlbWVudChBd2FpdEVycm9yQm91bmRhcnksIHsKICAgICAgICAgICAgICByZXNvbHZlOiByZXNvbHZlLAogICAgICAgICAgICAgIGVycm9yRWxlbWVudDogZXJyb3JFbGVtZW50CiAgICAgICAgICAgIH0sIC8qI19fUFVSRV9fKi9SZWFjdC5jcmVhdGVFbGVtZW50KFJlc29sdmVBd2FpdCwgbnVsbCwgY2hpbGRyZW4pKTsKICAgICAgICAgIH0KICAgICAgICAgIHZhciBBd2FpdFJlbmRlclN0YXR1czsKCiAgICAgICAgICAoZnVuY3Rpb24gKEF3YWl0UmVuZGVyU3RhdHVzKSB7CiAgICAgICAgICAgIEF3YWl0UmVuZGVyU3RhdHVzW0F3YWl0UmVuZGVyU3RhdHVzWyJwZW5kaW5nIl0gPSAwXSA9ICJwZW5kaW5nIjsKICAgICAgICAgICAgQXdhaXRSZW5kZXJTdGF0dXNbQXdhaXRSZW5kZXJTdGF0dXNbInN1Y2Nlc3MiXSA9IDFdID0gInN1Y2Nlc3MiOwogICAgICAgICAgICBBd2FpdFJlbmRlclN0YXR1c1tBd2FpdFJlbmRlclN0YXR1c1siZXJyb3IiXSA9IDJdID0gImVycm9yIjsKICAgICAgICAgIH0pKEF3YWl0UmVuZGVyU3RhdHVzIHx8IChBd2FpdFJlbmRlclN0YXR1cyA9IHt9KSk7CgogICAgICAgICAgdmFyIG5ldmVyU2V0dGxlZFByb21pc2UgPSBuZXcgUHJvbWlzZSgoKSA9PiB7fSk7dmFyCgogICAgICAgICAgQXdhaXRFcnJvckJvdW5kYXJ5ID0gLyojX19QVVJFX18qL2Z1bmN0aW9uIChfcmVhY3QkQ29tcG9uZW50Mikge19pbmhlcml0cyhBd2FpdEVycm9yQm91bmRhcnksIF9yZWFjdCRDb21wb25lbnQyKTt2YXIgX3N1cGVyMyA9IF9jcmVhdGVTdXBlcihBd2FpdEVycm9yQm91bmRhcnkpOwogICAgICAgICAgICBmdW5jdGlvbiBBd2FpdEVycm9yQm91bmRhcnkocHJvcHMpIHt2YXIgX3RoaXMyO19jbGFzc0NhbGxDaGVjazIodGhpcywgQXdhaXRFcnJvckJvdW5kYXJ5KTsKICAgICAgICAgICAgICBfdGhpczIgPSBfc3VwZXIzLmNhbGwodGhpcywgcHJvcHMpOwogICAgICAgICAgICAgIF90aGlzMi5zdGF0ZSA9IHsKICAgICAgICAgICAgICAgIGVycm9yOiBudWxsCiAgICAgICAgICAgICAgfTtyZXR1cm4gX3RoaXMyOwogICAgICAgICAgICB9X2NyZWF0ZUNsYXNzMihBd2FpdEVycm9yQm91bmRhcnksIFt7IGtleTogImNvbXBvbmVudERpZENhdGNoIiwgdmFsdWU6CgoKCgoKCgogICAgICAgICAgICAgIGZ1bmN0aW9uIGNvbXBvbmVudERpZENhdGNoKGVycm9yLCBlcnJvckluZm8pIHsKICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoIjxBd2FpdD4gY2F1Z2h0IHRoZSBmb2xsb3dpbmcgZXJyb3IgZHVyaW5nIHJlbmRlciIsIGVycm9yLCBlcnJvckluZm8pOwogICAgICAgICAgICAgIH0gfSwgeyBrZXk6ICJyZW5kZXIiLCB2YWx1ZToKCiAgICAgICAgICAgICAgZnVuY3Rpb24gcmVuZGVyKCkgewogICAgICAgICAgICAgICAgdmFyIF90aGlzJHByb3BzID0KCgoKICAgICAgICAgICAgICAgICAgdGhpcy5wcm9wcyxjaGlsZHJlbiA9IF90aGlzJHByb3BzLmNoaWxkcmVuLGVycm9yRWxlbWVudCA9IF90aGlzJHByb3BzLmVycm9yRWxlbWVudCxyZXNvbHZlID0gX3RoaXMkcHJvcHMucmVzb2x2ZTsKICAgICAgICAgICAgICAgIHZhciBwcm9taXNlID0gbnVsbDsKICAgICAgICAgICAgICAgIHZhciBzdGF0dXMgPSBBd2FpdFJlbmRlclN0YXR1cy5wZW5kaW5nOwoKICAgICAgICAgICAgICAgIGlmICghKHJlc29sdmUgaW5zdGFuY2VvZiBQcm9taXNlKSkgewogICAgICAgICAgICAgICAgICAvLyBEaWRuJ3QgZ2V0IGEgcHJvbWlzZSAtIHByb3ZpZGUgYXMgYSByZXNvbHZlZCBwcm9taXNlCiAgICAgICAgICAgICAgICAgIHN0YXR1cyA9IEF3YWl0UmVuZGVyU3RhdHVzLnN1Y2Nlc3M7CiAgICAgICAgICAgICAgICAgIHByb21pc2UgPSBQcm9taXNlLnJlc29sdmUoKTsKICAgICAgICAgICAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHByb21pc2UsICJfdHJhY2tlZCIsIHsKICAgICAgICAgICAgICAgICAgICBnZXQ6ICgpID0+IHRydWUKICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShwcm9taXNlLCAiX2RhdGEiLCB7CiAgICAgICAgICAgICAgICAgICAgZ2V0OiAoKSA9PiByZXNvbHZlCiAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfSBlbHNlIGlmICh0aGlzLnN0YXRlLmVycm9yKSB7CiAgICAgICAgICAgICAgICAgIC8vIENhdWdodCBhIHJlbmRlciBlcnJvciwgcHJvdmlkZSBpdCBhcyBhIHJlamVjdGVkIHByb21pc2UKICAgICAgICAgICAgICAgICAgc3RhdHVzID0gQXdhaXRSZW5kZXJTdGF0dXMuZXJyb3I7CiAgICAgICAgICAgICAgICAgIHZhciByZW5kZXJFcnJvciA9IHRoaXMuc3RhdGUuZXJyb3I7CiAgICAgICAgICAgICAgICAgIHByb21pc2UgPSBQcm9taXNlLnJlamVjdCgpLmNhdGNoKCgpID0+IHt9KTsgLy8gQXZvaWQgdW5oYW5kbGVkIHJlamVjdGlvbiB3YXJuaW5ncwoKICAgICAgICAgICAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHByb21pc2UsICJfdHJhY2tlZCIsIHsKICAgICAgICAgICAgICAgICAgICBnZXQ6ICgpID0+IHRydWUKICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShwcm9taXNlLCAiX2Vycm9yIiwgewogICAgICAgICAgICAgICAgICAgIGdldDogKCkgPT4gcmVuZGVyRXJyb3IKICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHJlc29sdmUuX3RyYWNrZWQpIHsKICAgICAgICAgICAgICAgICAgLy8gQWxyZWFkeSB0cmFja2VkIHByb21pc2UgLSBjaGVjayBjb250ZW50cwogICAgICAgICAgICAgICAgICBwcm9taXNlID0gcmVzb2x2ZTsKICAgICAgICAgICAgICAgICAgc3RhdHVzID0gcHJvbWlzZS5fZXJyb3IgIT09IHVuZGVmaW5lZCA/IEF3YWl0UmVuZGVyU3RhdHVzLmVycm9yIDogcHJvbWlzZS5fZGF0YSAhPT0gdW5kZWZpbmVkID8gQXdhaXRSZW5kZXJTdGF0dXMuc3VjY2VzcyA6IEF3YWl0UmVuZGVyU3RhdHVzLnBlbmRpbmc7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAvLyBSYXcgKHVudHJhY2tlZCkgcHJvbWlzZSAtIHRyYWNrIGl0CiAgICAgICAgICAgICAgICAgIHN0YXR1cyA9IEF3YWl0UmVuZGVyU3RhdHVzLnBlbmRpbmc7CiAgICAgICAgICAgICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShyZXNvbHZlLCAiX3RyYWNrZWQiLCB7CiAgICAgICAgICAgICAgICAgICAgZ2V0OiAoKSA9PiB0cnVlCiAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICBwcm9taXNlID0gcmVzb2x2ZS50aGVuKChkYXRhKSA9PiBPYmplY3QuZGVmaW5lUHJvcGVydHkocmVzb2x2ZSwgIl9kYXRhIiwgewogICAgICAgICAgICAgICAgICAgIGdldDogKCkgPT4gZGF0YQogICAgICAgICAgICAgICAgICB9KSwgKGVycm9yKSA9PiBPYmplY3QuZGVmaW5lUHJvcGVydHkocmVzb2x2ZSwgIl9lcnJvciIsIHsKICAgICAgICAgICAgICAgICAgICBnZXQ6ICgpID0+IGVycm9yCiAgICAgICAgICAgICAgICAgIH0pKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBpZiAoc3RhdHVzID09PSBBd2FpdFJlbmRlclN0YXR1cy5lcnJvciAmJiBwcm9taXNlLl9lcnJvciBpbnN0YW5jZW9mIEFib3J0ZWREZWZlcnJlZEVycm9yKSB7CiAgICAgICAgICAgICAgICAgIC8vIEZyZWV6ZSB0aGUgVUkgYnkgdGhyb3dpbmcgYSBuZXZlciByZXNvbHZlZCBwcm9taXNlCiAgICAgICAgICAgICAgICAgIHRocm93IG5ldmVyU2V0dGxlZFByb21pc2U7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgaWYgKHN0YXR1cyA9PT0gQXdhaXRSZW5kZXJTdGF0dXMuZXJyb3IgJiYgIWVycm9yRWxlbWVudCkgewogICAgICAgICAgICAgICAgICAvLyBObyBlcnJvckVsZW1lbnQsIHRocm93IHRvIHRoZSBuZWFyZXN0IHJvdXRlLWxldmVsIGVycm9yIGJvdW5kYXJ5CiAgICAgICAgICAgICAgICAgIHRocm93IHByb21pc2UuX2Vycm9yOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGlmIChzdGF0dXMgPT09IEF3YWl0UmVuZGVyU3RhdHVzLmVycm9yKSB7CiAgICAgICAgICAgICAgICAgIC8vIFJlbmRlciB2aWEgb3VyIGVycm9yRWxlbWVudAogICAgICAgICAgICAgICAgICByZXR1cm4gLyojX19QVVJFX18qL1JlYWN0LmNyZWF0ZUVsZW1lbnQoQXdhaXRDb250ZXh0LlByb3ZpZGVyLCB7CiAgICAgICAgICAgICAgICAgICAgdmFsdWU6IHByb21pc2UsCiAgICAgICAgICAgICAgICAgICAgY2hpbGRyZW46IGVycm9yRWxlbWVudAogICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBpZiAoc3RhdHVzID09PSBBd2FpdFJlbmRlclN0YXR1cy5zdWNjZXNzKSB7CiAgICAgICAgICAgICAgICAgIC8vIFJlbmRlciBjaGlsZHJlbiB3aXRoIHJlc29sdmVkIHZhbHVlCiAgICAgICAgICAgICAgICAgIHJldHVybiAvKiNfX1BVUkVfXyovUmVhY3QuY3JlYXRlRWxlbWVudChBd2FpdENvbnRleHQuUHJvdmlkZXIsIHsKICAgICAgICAgICAgICAgICAgICB2YWx1ZTogcHJvbWlzZSwKICAgICAgICAgICAgICAgICAgICBjaGlsZHJlbjogY2hpbGRyZW4KICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9IC8vIFRocm93IHRvIHRoZSBzdXNwZW5zZSBib3VuZGFyeQoKCiAgICAgICAgICAgICAgICB0aHJvdyBwcm9taXNlOwogICAgICAgICAgICAgIH0gfV0sIFt7IGtleTogImdldERlcml2ZWRTdGF0ZUZyb21FcnJvciIsIHZhbHVlOiBmdW5jdGlvbiBnZXREZXJpdmVkU3RhdGVGcm9tRXJyb3IoZXJyb3IpIHtyZXR1cm4geyBlcnJvcjogZXJyb3IgfTt9IH1dKTtyZXR1cm4gQXdhaXRFcnJvckJvdW5kYXJ5O30ocmVhY3QuQ29tcG9uZW50KTsKCgogICAgICAgICAgLyoqCiAgICAgICAgICAgKiBAcHJpdmF0ZQogICAgICAgICAgICogSW5kaXJlY3Rpb24gdG8gbGV2ZXJhZ2UgdXNlQXN5bmNWYWx1ZSBmb3IgYSByZW5kZXItcHJvcCBBUEkgb24gPEF3YWl0PgogICAgICAgICAgICovCgoKICAgICAgICAgIGZ1bmN0aW9uIFJlc29sdmVBd2FpdChfcmVmNykgewogICAgICAgICAgICB2YXIKICAgICAgICAgICAgY2hpbGRyZW4gPQogICAgICAgICAgICBfcmVmNy5jaGlsZHJlbjsKICAgICAgICAgICAgdmFyIGRhdGEgPSB1c2VBc3luY1ZhbHVlKCk7CiAgICAgICAgICAgIHZhciB0b1JlbmRlciA9IHR5cGVvZiBjaGlsZHJlbiA9PT0gImZ1bmN0aW9uIiA/IGNoaWxkcmVuKGRhdGEpIDogY2hpbGRyZW47CiAgICAgICAgICAgIHJldHVybiAvKiNfX1BVUkVfXyovUmVhY3QuY3JlYXRlRWxlbWVudChSZWFjdC5GcmFnbWVudCwgbnVsbCwgdG9SZW5kZXIpOwogICAgICAgICAgfSAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCiAgICAgICAgICAvLyBVVElMUwogICAgICAgICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwoKICAgICAgICAgIC8qKgogICAgICAgICAgICogQ3JlYXRlcyBhIHJvdXRlIGNvbmZpZyBmcm9tIGEgUmVhY3QgImNoaWxkcmVuIiBvYmplY3QsIHdoaWNoIGlzIHVzdWFsbHkKICAgICAgICAgICAqIGVpdGhlciBhIGA8Um91dGU+YCBlbGVtZW50IG9yIGFuIGFycmF5IG9mIHRoZW0uIFVzZWQgaW50ZXJuYWxseSBieQogICAgICAgICAgICogYDxSb3V0ZXM+YCB0byBjcmVhdGUgYSByb3V0ZSBjb25maWcgZnJvbSBpdHMgY2hpbGRyZW4uCiAgICAgICAgICAgKgogICAgICAgICAgICogQHNlZSBodHRwczovL3JlYWN0cm91dGVyLmNvbS91dGlscy9jcmVhdGUtcm91dGVzLWZyb20tY2hpbGRyZW4KICAgICAgICAgICAqLwoKCiAgICAgICAgICBmdW5jdGlvbiBjcmVhdGVSb3V0ZXNGcm9tQ2hpbGRyZW4oY2hpbGRyZW4sIHBhcmVudFBhdGgpIHsKICAgICAgICAgICAgaWYgKHBhcmVudFBhdGggPT09IHZvaWQgMCkgewogICAgICAgICAgICAgIHBhcmVudFBhdGggPSBbXTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdmFyIHJvdXRlcyA9IFtdOwogICAgICAgICAgICByZWFjdC5DaGlsZHJlbi5mb3JFYWNoKGNoaWxkcmVuLCAoZWxlbWVudCwgaW5kZXgpID0+IHsKICAgICAgICAgICAgICBpZiAoISAvKiNfX1BVUkVfXyovcmVhY3QuaXNWYWxpZEVsZW1lbnQoZWxlbWVudCkpIHsKICAgICAgICAgICAgICAgIC8vIElnbm9yZSBub24tZWxlbWVudHMuIFRoaXMgYWxsb3dzIHBlb3BsZSB0byBtb3JlIGVhc2lseSBpbmxpbmUKICAgICAgICAgICAgICAgIC8vIGNvbmRpdGlvbmFscyBpbiB0aGVpciByb3V0ZSBjb25maWcuCiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBpZiAoZWxlbWVudC50eXBlID09PSByZWFjdC5GcmFnbWVudCkgewogICAgICAgICAgICAgICAgLy8gVHJhbnNwYXJlbnRseSBzdXBwb3J0IFJlYWN0LkZyYWdtZW50IGFuZCBpdHMgY2hpbGRyZW4uCiAgICAgICAgICAgICAgICByb3V0ZXMucHVzaC5hcHBseShyb3V0ZXMsIGNyZWF0ZVJvdXRlc0Zyb21DaGlsZHJlbihlbGVtZW50LnByb3BzLmNoaWxkcmVuLCBwYXJlbnRQYXRoKSk7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAhKGVsZW1lbnQudHlwZSA9PT0gUm91dGUpID8gZmFsc2UgPyAwIDogcm91dGVyX2ludmFyaWFudChmYWxzZSkgOiB2b2lkIDA7CiAgICAgICAgICAgICAgISghZWxlbWVudC5wcm9wcy5pbmRleCB8fCAhZWxlbWVudC5wcm9wcy5jaGlsZHJlbikgPyBmYWxzZSA/IDAgOiByb3V0ZXJfaW52YXJpYW50KGZhbHNlKSA6IHZvaWQgMDsKICAgICAgICAgICAgICB2YXIgdHJlZVBhdGggPSBbXS5jb25jYXQoX3RvQ29uc3VtYWJsZUFycmF5KHBhcmVudFBhdGgpLCBbaW5kZXhdKTsKICAgICAgICAgICAgICB2YXIgcm91dGUgPSB7CiAgICAgICAgICAgICAgICBpZDogZWxlbWVudC5wcm9wcy5pZCB8fCB0cmVlUGF0aC5qb2luKCItIiksCiAgICAgICAgICAgICAgICBjYXNlU2Vuc2l0aXZlOiBlbGVtZW50LnByb3BzLmNhc2VTZW5zaXRpdmUsCiAgICAgICAgICAgICAgICBlbGVtZW50OiBlbGVtZW50LnByb3BzLmVsZW1lbnQsCiAgICAgICAgICAgICAgICBpbmRleDogZWxlbWVudC5wcm9wcy5pbmRleCwKICAgICAgICAgICAgICAgIHBhdGg6IGVsZW1lbnQucHJvcHMucGF0aCwKICAgICAgICAgICAgICAgIGxvYWRlcjogZWxlbWVudC5wcm9wcy5sb2FkZXIsCiAgICAgICAgICAgICAgICBhY3Rpb246IGVsZW1lbnQucHJvcHMuYWN0aW9uLAogICAgICAgICAgICAgICAgZXJyb3JFbGVtZW50OiBlbGVtZW50LnByb3BzLmVycm9yRWxlbWVudCwKICAgICAgICAgICAgICAgIGhhc0Vycm9yQm91bmRhcnk6IGVsZW1lbnQucHJvcHMuZXJyb3JFbGVtZW50ICE9IG51bGwsCiAgICAgICAgICAgICAgICBzaG91bGRSZXZhbGlkYXRlOiBlbGVtZW50LnByb3BzLnNob3VsZFJldmFsaWRhdGUsCiAgICAgICAgICAgICAgICBoYW5kbGU6IGVsZW1lbnQucHJvcHMuaGFuZGxlCiAgICAgICAgICAgICAgfTsKCiAgICAgICAgICAgICAgaWYgKGVsZW1lbnQucHJvcHMuY2hpbGRyZW4pIHsKICAgICAgICAgICAgICAgIHJvdXRlLmNoaWxkcmVuID0gY3JlYXRlUm91dGVzRnJvbUNoaWxkcmVuKGVsZW1lbnQucHJvcHMuY2hpbGRyZW4sIHRyZWVQYXRoKTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIHJvdXRlcy5wdXNoKHJvdXRlKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIHJldHVybiByb3V0ZXM7CiAgICAgICAgICB9CiAgICAgICAgICAvKioKICAgICAgICAgICAqIFJlbmRlcnMgdGhlIHJlc3VsdCBvZiBgbWF0Y2hSb3V0ZXMoKWAgaW50byBhIFJlYWN0IGVsZW1lbnQuCiAgICAgICAgICAgKi8KCiAgICAgICAgICBmdW5jdGlvbiByZW5kZXJNYXRjaGVzKG1hdGNoZXMpIHsKICAgICAgICAgICAgcmV0dXJuIF9yZW5kZXJNYXRjaGVzKG1hdGNoZXMpOwogICAgICAgICAgfQogICAgICAgICAgLyoqCiAgICAgICAgICAgKiBAcHJpdmF0ZQogICAgICAgICAgICogV2FsayB0aGUgcm91dGUgdHJlZSBhbmQgYWRkIGhhc0Vycm9yQm91bmRhcnkgaWYgaXQncyBub3QgcHJvdmlkZWQsIHNvIHRoYXQKICAgICAgICAgICAqIHVzZXJzIHByb3ZpZGluZyBtYW51YWwgcm91dGUgYXJyYXlzIGNhbiBqdXN0IHNwZWNpZnkgZXJyb3JFbGVtZW50CiAgICAgICAgICAgKi8KCiAgICAgICAgICBmdW5jdGlvbiBlbmhhbmNlTWFudWFsUm91dGVPYmplY3RzKHJvdXRlcykgewogICAgICAgICAgICByZXR1cm4gcm91dGVzLm1hcCgocm91dGUpID0+IHsKICAgICAgICAgICAgICB2YXIgcm91dGVDbG9uZSA9IGRpc3RfZXh0ZW5kcyh7fSwgcm91dGUpOwoKICAgICAgICAgICAgICBpZiAocm91dGVDbG9uZS5oYXNFcnJvckJvdW5kYXJ5ID09IG51bGwpIHsKICAgICAgICAgICAgICAgIHJvdXRlQ2xvbmUuaGFzRXJyb3JCb3VuZGFyeSA9IHJvdXRlQ2xvbmUuZXJyb3JFbGVtZW50ICE9IG51bGw7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBpZiAocm91dGVDbG9uZS5jaGlsZHJlbikgewogICAgICAgICAgICAgICAgcm91dGVDbG9uZS5jaGlsZHJlbiA9IGVuaGFuY2VNYW51YWxSb3V0ZU9iamVjdHMocm91dGVDbG9uZS5jaGlsZHJlbik7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICByZXR1cm4gcm91dGVDbG9uZTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9CgogICAgICAgICAgZnVuY3Rpb24gY3JlYXRlTWVtb3J5Um91dGVyKHJvdXRlcywgb3B0cykgewogICAgICAgICAgICByZXR1cm4gY3JlYXRlUm91dGVyKHsKICAgICAgICAgICAgICBiYXNlbmFtZTogb3B0cyA9PSBudWxsID8gdm9pZCAwIDogb3B0cy5iYXNlbmFtZSwKICAgICAgICAgICAgICBoaXN0b3J5OiBjcmVhdGVNZW1vcnlIaXN0b3J5KHsKICAgICAgICAgICAgICAgIGluaXRpYWxFbnRyaWVzOiBvcHRzID09IG51bGwgPyB2b2lkIDAgOiBvcHRzLmluaXRpYWxFbnRyaWVzLAogICAgICAgICAgICAgICAgaW5pdGlhbEluZGV4OiBvcHRzID09IG51bGwgPyB2b2lkIDAgOiBvcHRzLmluaXRpYWxJbmRleAogICAgICAgICAgICAgIH0pLAogICAgICAgICAgICAgIGh5ZHJhdGlvbkRhdGE6IG9wdHMgPT0gbnVsbCA/IHZvaWQgMCA6IG9wdHMuaHlkcmF0aW9uRGF0YSwKICAgICAgICAgICAgICByb3V0ZXM6IGVuaGFuY2VNYW51YWxSb3V0ZU9iamVjdHMocm91dGVzKQogICAgICAgICAgICB9KS5pbml0aWFsaXplKCk7CiAgICAgICAgICB9IC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KCgoKCiAgICAgICAgICA7IC8vIENPTkNBVEVOQVRFRCBNT0RVTEU6IC4vbm9kZV9tb2R1bGVzL3JlYWN0LXJvdXRlci1kb20vZGlzdC9pbmRleC5qcwogICAgICAgICAgLyoqCiAgICAgICAgICAgKiBSZWFjdCBSb3V0ZXIgRE9NIHY2LjcuMAogICAgICAgICAgICoKICAgICAgICAgICAqIENvcHlyaWdodCAoYykgUmVtaXggU29mdHdhcmUgSW5jLgogICAgICAgICAgICoKICAgICAgICAgICAqIFRoaXMgc291cmNlIGNvZGUgaXMgbGljZW5zZWQgdW5kZXIgdGhlIE1JVCBsaWNlbnNlIGZvdW5kIGluIHRoZQogICAgICAgICAgICogTElDRU5TRS5tZCBmaWxlIGluIHRoZSByb290IGRpcmVjdG9yeSBvZiB0aGlzIHNvdXJjZSB0cmVlLgogICAgICAgICAgICoKICAgICAgICAgICAqIEBsaWNlbnNlIE1JVAogICAgICAgICAgICovCgoKCgoKICAgICAgICAgIGZ1bmN0aW9uIHJlYWN0X3JvdXRlcl9kb21fZGlzdF9leHRlbmRzKCkgewogICAgICAgICAgICByZWFjdF9yb3V0ZXJfZG9tX2Rpc3RfZXh0ZW5kcyA9IE9iamVjdC5hc3NpZ24gPyBPYmplY3QuYXNzaWduLmJpbmQoKSA6IGZ1bmN0aW9uICh0YXJnZXQpIHsKICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMTsgaSA8IGFyZ3VtZW50cy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAgdmFyIHNvdXJjZSA9IGFyZ3VtZW50c1tpXTsKCiAgICAgICAgICAgICAgICBmb3IgKHZhciBrZXkgaW4gc291cmNlKSB7CiAgICAgICAgICAgICAgICAgIGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoc291cmNlLCBrZXkpKSB7CiAgICAgICAgICAgICAgICAgICAgdGFyZ2V0W2tleV0gPSBzb3VyY2Vba2V5XTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgcmV0dXJuIHRhcmdldDsKICAgICAgICAgICAgfTsKICAgICAgICAgICAgcmV0dXJuIHJlYWN0X3JvdXRlcl9kb21fZGlzdF9leHRlbmRzLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgICAgICB9CgogICAgICAgICAgZnVuY3Rpb24gX29iamVjdFdpdGhvdXRQcm9wZXJ0aWVzTG9vc2Uoc291cmNlLCBleGNsdWRlZCkgewogICAgICAgICAgICBpZiAoc291cmNlID09IG51bGwpIHJldHVybiB7fTsKICAgICAgICAgICAgdmFyIHRhcmdldCA9IHt9OwogICAgICAgICAgICB2YXIgc291cmNlS2V5cyA9IE9iamVjdC5rZXlzKHNvdXJjZSk7CiAgICAgICAgICAgIHZhciBrZXksIGk7CgogICAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgc291cmNlS2V5cy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgIGtleSA9IHNvdXJjZUtleXNbaV07CiAgICAgICAgICAgICAgaWYgKGV4Y2x1ZGVkLmluZGV4T2Yoa2V5KSA+PSAwKSBjb250aW51ZTsKICAgICAgICAgICAgICB0YXJnZXRba2V5XSA9IHNvdXJjZVtrZXldOwogICAgICAgICAgICB9CgogICAgICAgICAgICByZXR1cm4gdGFyZ2V0OwogICAgICAgICAgfQoKICAgICAgICAgIHZhciBkZWZhdWx0TWV0aG9kID0gImdldCI7CiAgICAgICAgICB2YXIgZGVmYXVsdEVuY1R5cGUgPSAiYXBwbGljYXRpb24veC13d3ctZm9ybS11cmxlbmNvZGVkIjsKICAgICAgICAgIGZ1bmN0aW9uIGlzSHRtbEVsZW1lbnQob2JqZWN0KSB7CiAgICAgICAgICAgIHJldHVybiBvYmplY3QgIT0gbnVsbCAmJiB0eXBlb2Ygb2JqZWN0LnRhZ05hbWUgPT09ICJzdHJpbmciOwogICAgICAgICAgfQogICAgICAgICAgZnVuY3Rpb24gaXNCdXR0b25FbGVtZW50KG9iamVjdCkgewogICAgICAgICAgICByZXR1cm4gaXNIdG1sRWxlbWVudChvYmplY3QpICYmIG9iamVjdC50YWdOYW1lLnRvTG93ZXJDYXNlKCkgPT09ICJidXR0b24iOwogICAgICAgICAgfQogICAgICAgICAgZnVuY3Rpb24gaXNGb3JtRWxlbWVudChvYmplY3QpIHsKICAgICAgICAgICAgcmV0dXJuIGlzSHRtbEVsZW1lbnQob2JqZWN0KSAmJiBvYmplY3QudGFnTmFtZS50b0xvd2VyQ2FzZSgpID09PSAiZm9ybSI7CiAgICAgICAgICB9CiAgICAgICAgICBmdW5jdGlvbiBpc0lucHV0RWxlbWVudChvYmplY3QpIHsKICAgICAgICAgICAgcmV0dXJuIGlzSHRtbEVsZW1lbnQob2JqZWN0KSAmJiBvYmplY3QudGFnTmFtZS50b0xvd2VyQ2FzZSgpID09PSAiaW5wdXQiOwogICAgICAgICAgfQoKICAgICAgICAgIGZ1bmN0aW9uIGlzTW9kaWZpZWRFdmVudChldmVudCkgewogICAgICAgICAgICByZXR1cm4gISEoZXZlbnQubWV0YUtleSB8fCBldmVudC5hbHRLZXkgfHwgZXZlbnQuY3RybEtleSB8fCBldmVudC5zaGlmdEtleSk7CiAgICAgICAgICB9CgogICAgICAgICAgZnVuY3Rpb24gc2hvdWxkUHJvY2Vzc0xpbmtDbGljayhldmVudCwgdGFyZ2V0KSB7CiAgICAgICAgICAgIHJldHVybiBldmVudC5idXR0b24gPT09IDAgJiYgKCAvLyBJZ25vcmUgZXZlcnl0aGluZyBidXQgbGVmdCBjbGlja3MKICAgICAgICAgICAgIXRhcmdldCB8fCB0YXJnZXQgPT09ICJfc2VsZiIpICYmIC8vIExldCBicm93c2VyIGhhbmRsZSAidGFyZ2V0PV9ibGFuayIgZXRjLgogICAgICAgICAgICAhaXNNb2RpZmllZEV2ZW50KGV2ZW50KSAvLyBJZ25vcmUgY2xpY2tzIHdpdGggbW9kaWZpZXIga2V5cwogICAgICAgICAgICA7CiAgICAgICAgICB9CiAgICAgICAgICAvKioKICAgICAgICAgICAqIENyZWF0ZXMgYSBVUkxTZWFyY2hQYXJhbXMgb2JqZWN0IHVzaW5nIHRoZSBnaXZlbiBpbml0aWFsaXplci4KICAgICAgICAgICAqCiAgICAgICAgICAgKiBUaGlzIGlzIGlkZW50aWNhbCB0byBgbmV3IFVSTFNlYXJjaFBhcmFtcyhpbml0KWAgZXhjZXB0IGl0IGFsc28KICAgICAgICAgICAqIHN1cHBvcnRzIGFycmF5cyBhcyB2YWx1ZXMgaW4gdGhlIG9iamVjdCBmb3JtIG9mIHRoZSBpbml0aWFsaXplcgogICAgICAgICAgICogaW5zdGVhZCBvZiBqdXN0IHN0cmluZ3MuIFRoaXMgaXMgY29udmVuaWVudCB3aGVuIHlvdSBuZWVkIG11bHRpcGxlCiAgICAgICAgICAgKiB2YWx1ZXMgZm9yIGEgZ2l2ZW4ga2V5LCBidXQgZG9uJ3Qgd2FudCB0byB1c2UgYW4gYXJyYXkgaW5pdGlhbGl6ZXIuCiAgICAgICAgICAgKgogICAgICAgICAgICogRm9yIGV4YW1wbGUsIGluc3RlYWQgb2Y6CiAgICAgICAgICAgKgogICAgICAgICAgICogICBsZXQgc2VhcmNoUGFyYW1zID0gbmV3IFVSTFNlYXJjaFBhcmFtcyhbCiAgICAgICAgICAgKiAgICAgWydzb3J0JywgJ25hbWUnXSwKICAgICAgICAgICAqICAgICBbJ3NvcnQnLCAncHJpY2UnXQogICAgICAgICAgICogICBdKTsKICAgICAgICAgICAqCiAgICAgICAgICAgKiB5b3UgY2FuIGRvOgogICAgICAgICAgICoKICAgICAgICAgICAqICAgbGV0IHNlYXJjaFBhcmFtcyA9IGNyZWF0ZVNlYXJjaFBhcmFtcyh7CiAgICAgICAgICAgKiAgICAgc29ydDogWyduYW1lJywgJ3ByaWNlJ10KICAgICAgICAgICAqICAgfSk7CiAgICAgICAgICAgKi8KCiAgICAgICAgICBmdW5jdGlvbiBjcmVhdGVTZWFyY2hQYXJhbXMoaW5pdCkgewogICAgICAgICAgICBpZiAoaW5pdCA9PT0gdm9pZCAwKSB7CiAgICAgICAgICAgICAgaW5pdCA9ICIiOwogICAgICAgICAgICB9CgogICAgICAgICAgICByZXR1cm4gbmV3IFVSTFNlYXJjaFBhcmFtcyh0eXBlb2YgaW5pdCA9PT0gInN0cmluZyIgfHwgQXJyYXkuaXNBcnJheShpbml0KSB8fCBpbml0IGluc3RhbmNlb2YgVVJMU2VhcmNoUGFyYW1zID8gaW5pdCA6IE9iamVjdC5rZXlzKGluaXQpLnJlZHVjZSgobWVtbywga2V5KSA9PiB7CiAgICAgICAgICAgICAgdmFyIHZhbHVlID0gaW5pdFtrZXldOwogICAgICAgICAgICAgIHJldHVybiBtZW1vLmNvbmNhdChBcnJheS5pc0FycmF5KHZhbHVlKSA/IHZhbHVlLm1hcCgodikgPT4gW2tleSwgdl0pIDogW1trZXksIHZhbHVlXV0pOwogICAgICAgICAgICB9LCBbXSkpOwogICAgICAgICAgfQogICAgICAgICAgZnVuY3Rpb24gZ2V0U2VhcmNoUGFyYW1zRm9yTG9jYXRpb24obG9jYXRpb25TZWFyY2gsIGRlZmF1bHRTZWFyY2hQYXJhbXMpIHsKICAgICAgICAgICAgdmFyIHNlYXJjaFBhcmFtcyA9IGNyZWF0ZVNlYXJjaFBhcmFtcyhsb2NhdGlvblNlYXJjaCk7dmFyIF9pdGVyYXRvcjEwID0gX2NyZWF0ZUZvck9mSXRlcmF0b3JIZWxwZXIyKAoKICAgICAgICAgICAgICBkZWZhdWx0U2VhcmNoUGFyYW1zLmtleXMoKSksX3N0ZXAxMDt0cnkge3ZhciBfbG9vcCA9IGZ1bmN0aW9uIF9sb29wKCkge3ZhciBrZXkgPSBfc3RlcDEwLnZhbHVlOwogICAgICAgICAgICAgICAgaWYgKCFzZWFyY2hQYXJhbXMuaGFzKGtleSkpIHsKICAgICAgICAgICAgICAgICAgZGVmYXVsdFNlYXJjaFBhcmFtcy5nZXRBbGwoa2V5KS5mb3JFYWNoKCh2YWx1ZSkgPT4gewogICAgICAgICAgICAgICAgICAgIHNlYXJjaFBhcmFtcy5hcHBlbmQoa2V5LCB2YWx1ZSk7CiAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH07Zm9yIChfaXRlcmF0b3IxMC5zKCk7ICEoX3N0ZXAxMCA9IF9pdGVyYXRvcjEwLm4oKSkuZG9uZTspIHtfbG9vcCgpO319IGNhdGNoIChlcnIpIHtfaXRlcmF0b3IxMC5lKGVycik7fSBmaW5hbGx5IHtfaXRlcmF0b3IxMC5mKCk7fQoKICAgICAgICAgICAgcmV0dXJuIHNlYXJjaFBhcmFtczsKICAgICAgICAgIH0KICAgICAgICAgIGZ1bmN0aW9uIGdldEZvcm1TdWJtaXNzaW9uSW5mbyh0YXJnZXQsIGRlZmF1bHRBY3Rpb24sIG9wdGlvbnMpIHsKICAgICAgICAgICAgdmFyIG1ldGhvZDsKICAgICAgICAgICAgdmFyIGFjdGlvbjsKICAgICAgICAgICAgdmFyIGVuY1R5cGU7CiAgICAgICAgICAgIHZhciBmb3JtRGF0YTsKCiAgICAgICAgICAgIGlmIChpc0Zvcm1FbGVtZW50KHRhcmdldCkpIHsKICAgICAgICAgICAgICB2YXIgc3VibWlzc2lvblRyaWdnZXIgPSBvcHRpb25zLnN1Ym1pc3Npb25UcmlnZ2VyOwogICAgICAgICAgICAgIG1ldGhvZCA9IG9wdGlvbnMubWV0aG9kIHx8IHRhcmdldC5nZXRBdHRyaWJ1dGUoIm1ldGhvZCIpIHx8IGRlZmF1bHRNZXRob2Q7CiAgICAgICAgICAgICAgYWN0aW9uID0gb3B0aW9ucy5hY3Rpb24gfHwgdGFyZ2V0LmdldEF0dHJpYnV0ZSgiYWN0aW9uIikgfHwgZGVmYXVsdEFjdGlvbjsKICAgICAgICAgICAgICBlbmNUeXBlID0gb3B0aW9ucy5lbmNUeXBlIHx8IHRhcmdldC5nZXRBdHRyaWJ1dGUoImVuY3R5cGUiKSB8fCBkZWZhdWx0RW5jVHlwZTsKICAgICAgICAgICAgICBmb3JtRGF0YSA9IG5ldyBGb3JtRGF0YSh0YXJnZXQpOwoKICAgICAgICAgICAgICBpZiAoc3VibWlzc2lvblRyaWdnZXIgJiYgc3VibWlzc2lvblRyaWdnZXIubmFtZSkgewogICAgICAgICAgICAgICAgZm9ybURhdGEuYXBwZW5kKHN1Ym1pc3Npb25UcmlnZ2VyLm5hbWUsIHN1Ym1pc3Npb25UcmlnZ2VyLnZhbHVlKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZWxzZSBpZiAoaXNCdXR0b25FbGVtZW50KHRhcmdldCkgfHwgaXNJbnB1dEVsZW1lbnQodGFyZ2V0KSAmJiAodGFyZ2V0LnR5cGUgPT09ICJzdWJtaXQiIHx8IHRhcmdldC50eXBlID09PSAiaW1hZ2UiKSkgewogICAgICAgICAgICAgIHZhciBmb3JtID0gdGFyZ2V0LmZvcm07CgogICAgICAgICAgICAgIGlmIChmb3JtID09IG51bGwpIHsKICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiQ2Fubm90IHN1Ym1pdCBhIDxidXR0b24+IG9yIDxpbnB1dCB0eXBlPVwic3VibWl0XCI+IHdpdGhvdXQgYSA8Zm9ybT4iKTsKICAgICAgICAgICAgICB9IC8vIDxidXR0b24+LzxpbnB1dCB0eXBlPSJzdWJtaXQiPiBtYXkgb3ZlcnJpZGUgYXR0cmlidXRlcyBvZiA8Zm9ybT4KCgogICAgICAgICAgICAgIG1ldGhvZCA9IG9wdGlvbnMubWV0aG9kIHx8IHRhcmdldC5nZXRBdHRyaWJ1dGUoImZvcm1tZXRob2QiKSB8fCBmb3JtLmdldEF0dHJpYnV0ZSgibWV0aG9kIikgfHwgZGVmYXVsdE1ldGhvZDsKICAgICAgICAgICAgICBhY3Rpb24gPSBvcHRpb25zLmFjdGlvbiB8fCB0YXJnZXQuZ2V0QXR0cmlidXRlKCJmb3JtYWN0aW9uIikgfHwgZm9ybS5nZXRBdHRyaWJ1dGUoImFjdGlvbiIpIHx8IGRlZmF1bHRBY3Rpb247CiAgICAgICAgICAgICAgZW5jVHlwZSA9IG9wdGlvbnMuZW5jVHlwZSB8fCB0YXJnZXQuZ2V0QXR0cmlidXRlKCJmb3JtZW5jdHlwZSIpIHx8IGZvcm0uZ2V0QXR0cmlidXRlKCJlbmN0eXBlIikgfHwgZGVmYXVsdEVuY1R5cGU7CiAgICAgICAgICAgICAgZm9ybURhdGEgPSBuZXcgRm9ybURhdGEoZm9ybSk7IC8vIEluY2x1ZGUgbmFtZSArIHZhbHVlIGZyb20gYSA8YnV0dG9uPiwgYXBwZW5kaW5nIGluIGNhc2UgdGhlIGJ1dHRvbiBuYW1lCiAgICAgICAgICAgICAgLy8gbWF0Y2hlcyBhbiBleGlzdGluZyBpbnB1dCBuYW1lCgogICAgICAgICAgICAgIGlmICh0YXJnZXQubmFtZSkgewogICAgICAgICAgICAgICAgZm9ybURhdGEuYXBwZW5kKHRhcmdldC5uYW1lLCB0YXJnZXQudmFsdWUpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBlbHNlIGlmIChpc0h0bWxFbGVtZW50KHRhcmdldCkpIHsKICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIkNhbm5vdCBzdWJtaXQgZWxlbWVudCB0aGF0IGlzIG5vdCA8Zm9ybT4sIDxidXR0b24+LCBvciAiICsgIjxpbnB1dCB0eXBlPVwic3VibWl0fGltYWdlXCI+Iik7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgbWV0aG9kID0gb3B0aW9ucy5tZXRob2QgfHwgZGVmYXVsdE1ldGhvZDsKICAgICAgICAgICAgICBhY3Rpb24gPSBvcHRpb25zLmFjdGlvbiB8fCBkZWZhdWx0QWN0aW9uOwogICAgICAgICAgICAgIGVuY1R5cGUgPSBvcHRpb25zLmVuY1R5cGUgfHwgZGVmYXVsdEVuY1R5cGU7CgogICAgICAgICAgICAgIGlmICh0YXJnZXQgaW5zdGFuY2VvZiBGb3JtRGF0YSkgewogICAgICAgICAgICAgICAgZm9ybURhdGEgPSB0YXJnZXQ7CiAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGZvcm1EYXRhID0gbmV3IEZvcm1EYXRhKCk7CgogICAgICAgICAgICAgICAgaWYgKHRhcmdldCBpbnN0YW5jZW9mIFVSTFNlYXJjaFBhcmFtcykge3ZhciBfaXRlcmF0b3IxMSA9IF9jcmVhdGVGb3JPZkl0ZXJhdG9ySGVscGVyMigKICAgICAgICAgICAgICAgICAgICB0YXJnZXQpLF9zdGVwMTE7dHJ5IHtmb3IgKF9pdGVyYXRvcjExLnMoKTsgIShfc3RlcDExID0gX2l0ZXJhdG9yMTEubigpKS5kb25lOykge3ZhciBfc3RlcDExJHZhbHVlID0gX3NsaWNlZFRvQXJyYXkyKF9zdGVwMTEudmFsdWUsIDIpLG5hbWUgPSBfc3RlcDExJHZhbHVlWzBdLHZhbHVlID0gX3N0ZXAxMSR2YWx1ZVsxXTsKICAgICAgICAgICAgICAgICAgICAgIGZvcm1EYXRhLmFwcGVuZChuYW1lLCB2YWx1ZSk7CiAgICAgICAgICAgICAgICAgICAgfX0gY2F0Y2ggKGVycikge19pdGVyYXRvcjExLmUoZXJyKTt9IGZpbmFsbHkge19pdGVyYXRvcjExLmYoKTt9CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHRhcmdldCAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICAgIGZvciAodmFyIF9pMiA9IDAsIF9PYmplY3Qka2V5cyA9IE9iamVjdC5rZXlzKHRhcmdldCk7IF9pMiA8IF9PYmplY3Qka2V5cy5sZW5ndGg7IF9pMisrKSB7dmFyIF9uYW1lID0gX09iamVjdCRrZXlzW19pMl07CiAgICAgICAgICAgICAgICAgICAgZm9ybURhdGEuYXBwZW5kKF9uYW1lLCB0YXJnZXRbX25hbWVdKTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgdmFyIF93aW5kb3ckbG9jYXRpb24yID0KCgogICAgICAgICAgICAgIHdpbmRvdy5sb2NhdGlvbixwcm90b2NvbCA9IF93aW5kb3ckbG9jYXRpb24yLnByb3RvY29sLGhvc3QgPSBfd2luZG93JGxvY2F0aW9uMi5ob3N0OwogICAgICAgICAgICB2YXIgdXJsID0gbmV3IFVSTChhY3Rpb24sIHByb3RvY29sICsgIi8vIiArIGhvc3QpOwogICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgIHVybDogdXJsLAogICAgICAgICAgICAgIG1ldGhvZDogbWV0aG9kLnRvTG93ZXJDYXNlKCksCiAgICAgICAgICAgICAgZW5jVHlwZTogZW5jVHlwZSwKICAgICAgICAgICAgICBmb3JtRGF0YTogZm9ybURhdGEKICAgICAgICAgICAgfTsKICAgICAgICAgIH0KCiAgICAgICAgICB2YXIgX2V4Y2x1ZGVkID0gWyJvbkNsaWNrIiwgInJlbGF0aXZlIiwgInJlbG9hZERvY3VtZW50IiwgInJlcGxhY2UiLCAic3RhdGUiLCAidGFyZ2V0IiwgInRvIiwgInByZXZlbnRTY3JvbGxSZXNldCJdLAogICAgICAgICAgICBfZXhjbHVkZWQyID0gWyJhcmlhLWN1cnJlbnQiLCAiY2FzZVNlbnNpdGl2ZSIsICJjbGFzc05hbWUiLCAiZW5kIiwgInN0eWxlIiwgInRvIiwgImNoaWxkcmVuIl0sCiAgICAgICAgICAgIF9leGNsdWRlZDMgPSAvKiB1bnVzZWQgcHVyZSBleHByZXNzaW9uIG9yIHN1cGVyICovbnVsbCAmJiBbInJlbG9hZERvY3VtZW50IiwgInJlcGxhY2UiLCAibWV0aG9kIiwgImFjdGlvbiIsICJvblN1Ym1pdCIsICJmZXRjaGVyS2V5IiwgInJvdXRlSWQiLCAicmVsYXRpdmUiLCAicHJldmVudFNjcm9sbFJlc2V0Il07CiAgICAgICAgICAvLyNyZWdpb24gUm91dGVycwogICAgICAgICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KCiAgICAgICAgICBmdW5jdGlvbiBjcmVhdGVCcm93c2VyUm91dGVyKHJvdXRlcywgb3B0cykgewogICAgICAgICAgICByZXR1cm4gY3JlYXRlUm91dGVyKHsKICAgICAgICAgICAgICBiYXNlbmFtZTogb3B0cyA9PSBudWxsID8gdm9pZCAwIDogb3B0cy5iYXNlbmFtZSwKICAgICAgICAgICAgICBoaXN0b3J5OiBjcmVhdGVCcm93c2VySGlzdG9yeSh7CiAgICAgICAgICAgICAgICB3aW5kb3c6IG9wdHMgPT0gbnVsbCA/IHZvaWQgMCA6IG9wdHMud2luZG93CiAgICAgICAgICAgICAgfSksCiAgICAgICAgICAgICAgaHlkcmF0aW9uRGF0YTogKG9wdHMgPT0gbnVsbCA/IHZvaWQgMCA6IG9wdHMuaHlkcmF0aW9uRGF0YSkgfHwgcGFyc2VIeWRyYXRpb25EYXRhKCksCiAgICAgICAgICAgICAgcm91dGVzOiBVTlNBRkVfZW5oYW5jZU1hbnVhbFJvdXRlT2JqZWN0cyhyb3V0ZXMpCiAgICAgICAgICAgIH0pLmluaXRpYWxpemUoKTsKICAgICAgICAgIH0KICAgICAgICAgIGZ1bmN0aW9uIGNyZWF0ZUhhc2hSb3V0ZXIocm91dGVzLCBvcHRzKSB7CiAgICAgICAgICAgIHJldHVybiBjcmVhdGVSb3V0ZXIoewogICAgICAgICAgICAgIGJhc2VuYW1lOiBvcHRzID09IG51bGwgPyB2b2lkIDAgOiBvcHRzLmJhc2VuYW1lLAogICAgICAgICAgICAgIGhpc3Rvcnk6IGNyZWF0ZUhhc2hIaXN0b3J5KHsKICAgICAgICAgICAgICAgIHdpbmRvdzogb3B0cyA9PSBudWxsID8gdm9pZCAwIDogb3B0cy53aW5kb3cKICAgICAgICAgICAgICB9KSwKICAgICAgICAgICAgICBoeWRyYXRpb25EYXRhOiAob3B0cyA9PSBudWxsID8gdm9pZCAwIDogb3B0cy5oeWRyYXRpb25EYXRhKSB8fCBwYXJzZUh5ZHJhdGlvbkRhdGEoKSwKICAgICAgICAgICAgICByb3V0ZXM6IFVOU0FGRV9lbmhhbmNlTWFudWFsUm91dGVPYmplY3RzKHJvdXRlcykKICAgICAgICAgICAgfSkuaW5pdGlhbGl6ZSgpOwogICAgICAgICAgfQoKICAgICAgICAgIGZ1bmN0aW9uIHBhcnNlSHlkcmF0aW9uRGF0YSgpIHsKICAgICAgICAgICAgdmFyIF93aW5kb3c7CgogICAgICAgICAgICB2YXIgc3RhdGUgPSAoX3dpbmRvdyA9IHdpbmRvdykgPT0gbnVsbCA/IHZvaWQgMCA6IF93aW5kb3cuX19zdGF0aWNSb3V0ZXJIeWRyYXRpb25EYXRhOwoKICAgICAgICAgICAgaWYgKHN0YXRlICYmIHN0YXRlLmVycm9ycykgewogICAgICAgICAgICAgIHN0YXRlID0gcmVhY3Rfcm91dGVyX2RvbV9kaXN0X2V4dGVuZHMoe30sIHN0YXRlLCB7CiAgICAgICAgICAgICAgICBlcnJvcnM6IGRlc2VyaWFsaXplRXJyb3JzKHN0YXRlLmVycm9ycykKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuIHN0YXRlOwogICAgICAgICAgfQoKICAgICAgICAgIGZ1bmN0aW9uIGRlc2VyaWFsaXplRXJyb3JzKGVycm9ycykgewogICAgICAgICAgICBpZiAoIWVycm9ycykgcmV0dXJuIG51bGw7CiAgICAgICAgICAgIHZhciBlbnRyaWVzID0gT2JqZWN0LmVudHJpZXMoZXJyb3JzKTsKICAgICAgICAgICAgdmFyIHNlcmlhbGl6ZWQgPSB7fTsKCiAgICAgICAgICAgIGZvciAodmFyIF9pMyA9IDAsIF9lbnRyaWVzID0gZW50cmllczsgX2kzIDwgX2VudHJpZXMubGVuZ3RoOyBfaTMrKykge3ZhciBfZW50cmllcyRfaSA9IF9zbGljZWRUb0FycmF5MihfZW50cmllc1tfaTNdLCAyKSxrZXkgPSBfZW50cmllcyRfaVswXSx2YWwgPSBfZW50cmllcyRfaVsxXTsKICAgICAgICAgICAgICAvLyBIZXkgeW91ISAgSWYgeW91IGNoYW5nZSB0aGlzLCBwbGVhc2UgY2hhbmdlIHRoZSBjb3JyZXNwb25kaW5nIGxvZ2ljIGluCiAgICAgICAgICAgICAgLy8gc2VyaWFsaXplRXJyb3JzIGluIHJlYWN0LXJvdXRlci1kb20vc2VydmVyLnRzeCA6KQogICAgICAgICAgICAgIGlmICh2YWwgJiYgdmFsLl9fdHlwZSA9PT0gIlJvdXRlRXJyb3JSZXNwb25zZSIpIHsKICAgICAgICAgICAgICAgIHNlcmlhbGl6ZWRba2V5XSA9IG5ldyBFcnJvclJlc3BvbnNlKHZhbC5zdGF0dXMsIHZhbC5zdGF0dXNUZXh0LCB2YWwuZGF0YSwgdmFsLmludGVybmFsID09PSB0cnVlKTsKICAgICAgICAgICAgICB9IGVsc2UgaWYgKHZhbCAmJiB2YWwuX190eXBlID09PSAiRXJyb3IiKSB7CiAgICAgICAgICAgICAgICB2YXIgZXJyb3IgPSBuZXcgRXJyb3IodmFsLm1lc3NhZ2UpOyAvLyBXaXBlIGF3YXkgdGhlIGNsaWVudC1zaWRlIHN0YWNrIHRyYWNlLiAgTm90aGluZyB0byBmaWxsIGl0IGluIHdpdGgKICAgICAgICAgICAgICAgIC8vIGJlY2F1c2Ugd2UgZG9uJ3Qgc2VyaWFsaXplIFNTUiBzdGFjayB0cmFjZXMgZm9yIHNlY3VyaXR5IHJlYXNvbnMKCiAgICAgICAgICAgICAgICBlcnJvci5zdGFjayA9ICIiOwogICAgICAgICAgICAgICAgc2VyaWFsaXplZFtrZXldID0gZXJyb3I7CiAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHNlcmlhbGl6ZWRba2V5XSA9IHZhbDsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybiBzZXJpYWxpemVkOwogICAgICAgICAgfQogICAgICAgICAgLyoqCiAgICAgICAgICAgKiBBIGA8Um91dGVyPmAgZm9yIHVzZSBpbiB3ZWIgYnJvd3NlcnMuIFByb3ZpZGVzIHRoZSBjbGVhbmVzdCBVUkxzLgogICAgICAgICAgICovCgoKICAgICAgICAgIGZ1bmN0aW9uIEJyb3dzZXJSb3V0ZXIoX3JlZikgewogICAgICAgICAgICB2YXIKICAgICAgICAgICAgICBiYXNlbmFtZSA9CgoKICAgICAgICAgICAgICBfcmVmLmJhc2VuYW1lLGNoaWxkcmVuID0gX3JlZi5jaGlsZHJlbix3aW5kb3cgPSBfcmVmLndpbmRvdzsKICAgICAgICAgICAgdmFyIGhpc3RvcnlSZWYgPSBSZWFjdC51c2VSZWYoKTsKCiAgICAgICAgICAgIGlmIChoaXN0b3J5UmVmLmN1cnJlbnQgPT0gbnVsbCkgewogICAgICAgICAgICAgIGhpc3RvcnlSZWYuY3VycmVudCA9IGNyZWF0ZUJyb3dzZXJIaXN0b3J5KHsKICAgICAgICAgICAgICAgIHdpbmRvdzogd2luZG93LAogICAgICAgICAgICAgICAgdjVDb21wYXQ6IHRydWUKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdmFyIGhpc3RvcnkgPSBoaXN0b3J5UmVmLmN1cnJlbnQ7CiAgICAgICAgICAgIHZhciBfUmVhY3QkdXNlU3RhdGUgPSBSZWFjdC51c2VTdGF0ZSh7CiAgICAgICAgICAgICAgICBhY3Rpb246IGhpc3RvcnkuYWN0aW9uLAogICAgICAgICAgICAgICAgbG9jYXRpb246IGhpc3RvcnkubG9jYXRpb24KICAgICAgICAgICAgICB9KSxfUmVhY3QkdXNlU3RhdGUyID0gX3NsaWNlZFRvQXJyYXkyKF9SZWFjdCR1c2VTdGF0ZSwgMiksc3RhdGUgPSBfUmVhY3QkdXNlU3RhdGUyWzBdLHNldFN0YXRlID0gX1JlYWN0JHVzZVN0YXRlMlsxXTsKICAgICAgICAgICAgUmVhY3QudXNlTGF5b3V0RWZmZWN0KCgpID0+IGhpc3RvcnkubGlzdGVuKHNldFN0YXRlKSwgW2hpc3RvcnldKTsKICAgICAgICAgICAgcmV0dXJuIC8qI19fUFVSRV9fKi9SZWFjdC5jcmVhdGVFbGVtZW50KFJvdXRlciwgewogICAgICAgICAgICAgIGJhc2VuYW1lOiBiYXNlbmFtZSwKICAgICAgICAgICAgICBjaGlsZHJlbjogY2hpbGRyZW4sCiAgICAgICAgICAgICAgbG9jYXRpb246IHN0YXRlLmxvY2F0aW9uLAogICAgICAgICAgICAgIG5hdmlnYXRpb25UeXBlOiBzdGF0ZS5hY3Rpb24sCiAgICAgICAgICAgICAgbmF2aWdhdG9yOiBoaXN0b3J5CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfQogICAgICAgICAgLyoqCiAgICAgICAgICAgKiBBIGA8Um91dGVyPmAgZm9yIHVzZSBpbiB3ZWIgYnJvd3NlcnMuIFN0b3JlcyB0aGUgbG9jYXRpb24gaW4gdGhlIGhhc2gKICAgICAgICAgICAqIHBvcnRpb24gb2YgdGhlIFVSTCBzbyBpdCBpcyBub3Qgc2VudCB0byB0aGUgc2VydmVyLgogICAgICAgICAgICovCgogICAgICAgICAgZnVuY3Rpb24gSGFzaFJvdXRlcihfcmVmMikgewogICAgICAgICAgICB2YXIKICAgICAgICAgICAgICBiYXNlbmFtZSA9CgoKICAgICAgICAgICAgICBfcmVmMi5iYXNlbmFtZSxjaGlsZHJlbiA9IF9yZWYyLmNoaWxkcmVuLHdpbmRvdyA9IF9yZWYyLndpbmRvdzsKICAgICAgICAgICAgdmFyIGhpc3RvcnlSZWYgPSBSZWFjdC51c2VSZWYoKTsKCiAgICAgICAgICAgIGlmIChoaXN0b3J5UmVmLmN1cnJlbnQgPT0gbnVsbCkgewogICAgICAgICAgICAgIGhpc3RvcnlSZWYuY3VycmVudCA9IGNyZWF0ZUhhc2hIaXN0b3J5KHsKICAgICAgICAgICAgICAgIHdpbmRvdzogd2luZG93LAogICAgICAgICAgICAgICAgdjVDb21wYXQ6IHRydWUKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdmFyIGhpc3RvcnkgPSBoaXN0b3J5UmVmLmN1cnJlbnQ7CiAgICAgICAgICAgIHZhciBfUmVhY3QkdXNlU3RhdGUzID0gUmVhY3QudXNlU3RhdGUoewogICAgICAgICAgICAgICAgYWN0aW9uOiBoaXN0b3J5LmFjdGlvbiwKICAgICAgICAgICAgICAgIGxvY2F0aW9uOiBoaXN0b3J5LmxvY2F0aW9uCiAgICAgICAgICAgICAgfSksX1JlYWN0JHVzZVN0YXRlNCA9IF9zbGljZWRUb0FycmF5MihfUmVhY3QkdXNlU3RhdGUzLCAyKSxzdGF0ZSA9IF9SZWFjdCR1c2VTdGF0ZTRbMF0sc2V0U3RhdGUgPSBfUmVhY3QkdXNlU3RhdGU0WzFdOwogICAgICAgICAgICBSZWFjdC51c2VMYXlvdXRFZmZlY3QoKCkgPT4gaGlzdG9yeS5saXN0ZW4oc2V0U3RhdGUpLCBbaGlzdG9yeV0pOwogICAgICAgICAgICByZXR1cm4gLyojX19QVVJFX18qL1JlYWN0LmNyZWF0ZUVsZW1lbnQoUm91dGVyLCB7CiAgICAgICAgICAgICAgYmFzZW5hbWU6IGJhc2VuYW1lLAogICAgICAgICAgICAgIGNoaWxkcmVuOiBjaGlsZHJlbiwKICAgICAgICAgICAgICBsb2NhdGlvbjogc3RhdGUubG9jYXRpb24sCiAgICAgICAgICAgICAgbmF2aWdhdGlvblR5cGU6IHN0YXRlLmFjdGlvbiwKICAgICAgICAgICAgICBuYXZpZ2F0b3I6IGhpc3RvcnkKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9CiAgICAgICAgICAvKioKICAgICAgICAgICAqIEEgYDxSb3V0ZXI+YCB0aGF0IGFjY2VwdHMgYSBwcmUtaW5zdGFudGlhdGVkIGhpc3Rvcnkgb2JqZWN0LiBJdCdzIGltcG9ydGFudAogICAgICAgICAgICogdG8gbm90ZSB0aGF0IHVzaW5nIHlvdXIgb3duIGhpc3Rvcnkgb2JqZWN0IGlzIGhpZ2hseSBkaXNjb3VyYWdlZCBhbmQgbWF5IGFkZAogICAgICAgICAgICogdHdvIHZlcnNpb25zIG9mIHRoZSBoaXN0b3J5IGxpYnJhcnkgdG8geW91ciBidW5kbGVzIHVubGVzcyB5b3UgdXNlIHRoZSBzYW1lCiAgICAgICAgICAgKiB2ZXJzaW9uIG9mIHRoZSBoaXN0b3J5IGxpYnJhcnkgdGhhdCBSZWFjdCBSb3V0ZXIgdXNlcyBpbnRlcm5hbGx5LgogICAgICAgICAgICovCgogICAgICAgICAgZnVuY3Rpb24gSGlzdG9yeVJvdXRlcihfcmVmMykgewogICAgICAgICAgICB2YXIKICAgICAgICAgICAgICBiYXNlbmFtZSA9CgoKICAgICAgICAgICAgICBfcmVmMy5iYXNlbmFtZSxjaGlsZHJlbiA9IF9yZWYzLmNoaWxkcmVuLGhpc3RvcnkgPSBfcmVmMy5oaXN0b3J5OwogICAgICAgICAgICB2YXIgX1JlYWN0JHVzZVN0YXRlNSA9IFJlYWN0LnVzZVN0YXRlKHsKICAgICAgICAgICAgICAgIGFjdGlvbjogaGlzdG9yeS5hY3Rpb24sCiAgICAgICAgICAgICAgICBsb2NhdGlvbjogaGlzdG9yeS5sb2NhdGlvbgogICAgICAgICAgICAgIH0pLF9SZWFjdCR1c2VTdGF0ZTYgPSBfc2xpY2VkVG9BcnJheTIoX1JlYWN0JHVzZVN0YXRlNSwgMiksc3RhdGUgPSBfUmVhY3QkdXNlU3RhdGU2WzBdLHNldFN0YXRlID0gX1JlYWN0JHVzZVN0YXRlNlsxXTsKICAgICAgICAgICAgUmVhY3QudXNlTGF5b3V0RWZmZWN0KCgpID0+IGhpc3RvcnkubGlzdGVuKHNldFN0YXRlKSwgW2hpc3RvcnldKTsKICAgICAgICAgICAgcmV0dXJuIC8qI19fUFVSRV9fKi9SZWFjdC5jcmVhdGVFbGVtZW50KFJvdXRlciwgewogICAgICAgICAgICAgIGJhc2VuYW1lOiBiYXNlbmFtZSwKICAgICAgICAgICAgICBjaGlsZHJlbjogY2hpbGRyZW4sCiAgICAgICAgICAgICAgbG9jYXRpb246IHN0YXRlLmxvY2F0aW9uLAogICAgICAgICAgICAgIG5hdmlnYXRpb25UeXBlOiBzdGF0ZS5hY3Rpb24sCiAgICAgICAgICAgICAgbmF2aWdhdG9yOiBoaXN0b3J5CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfQoKICAgICAgICAgIGlmIChmYWxzZSkge30KICAgICAgICAgIC8qKgogICAgICAgICAgICogVGhlIHB1YmxpYyBBUEkgZm9yIHJlbmRlcmluZyBhIGhpc3RvcnktYXdhcmUgPGE+LgogICAgICAgICAgICovCgogICAgICAgICAgdmFyIExpbmsgPSAvKiNfX1BVUkVfXyovcmVhY3QuZm9yd2FyZFJlZihmdW5jdGlvbiBMaW5rV2l0aFJlZihfcmVmNCwgcmVmKSB7CiAgICAgICAgICAgIHZhcgogICAgICAgICAgICAgIG9uQ2xpY2sgPQoKCgoKCgoKICAgICAgICAgICAgICBfcmVmNC5vbkNsaWNrLHJlbGF0aXZlID0gX3JlZjQucmVsYXRpdmUscmVsb2FkRG9jdW1lbnQgPSBfcmVmNC5yZWxvYWREb2N1bWVudCxyZXBsYWNlID0gX3JlZjQucmVwbGFjZSxzdGF0ZSA9IF9yZWY0LnN0YXRlLHRhcmdldCA9IF9yZWY0LnRhcmdldCx0byA9IF9yZWY0LnRvLHByZXZlbnRTY3JvbGxSZXNldCA9IF9yZWY0LnByZXZlbnRTY3JvbGxSZXNldCwKICAgICAgICAgICAgICByZXN0ID0gX29iamVjdFdpdGhvdXRQcm9wZXJ0aWVzTG9vc2UoX3JlZjQsIF9leGNsdWRlZCk7CgogICAgICAgICAgICB2YXIgaHJlZiA9IHVzZUhyZWYodG8sIHsKICAgICAgICAgICAgICByZWxhdGl2ZTogcmVsYXRpdmUKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIHZhciBpbnRlcm5hbE9uQ2xpY2sgPSB1c2VMaW5rQ2xpY2tIYW5kbGVyKHRvLCB7CiAgICAgICAgICAgICAgcmVwbGFjZTogcmVwbGFjZSwKICAgICAgICAgICAgICBzdGF0ZTogc3RhdGUsCiAgICAgICAgICAgICAgdGFyZ2V0OiB0YXJnZXQsCiAgICAgICAgICAgICAgcHJldmVudFNjcm9sbFJlc2V0OiBwcmV2ZW50U2Nyb2xsUmVzZXQsCiAgICAgICAgICAgICAgcmVsYXRpdmU6IHJlbGF0aXZlCiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgZnVuY3Rpb24gaGFuZGxlQ2xpY2soZXZlbnQpIHsKICAgICAgICAgICAgICBpZiAob25DbGljaykgb25DbGljayhldmVudCk7CgogICAgICAgICAgICAgIGlmICghZXZlbnQuZGVmYXVsdFByZXZlbnRlZCkgewogICAgICAgICAgICAgICAgaW50ZXJuYWxPbkNsaWNrKGV2ZW50KTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybiAoCiAgICAgICAgICAgICAgLyojX19QVVJFX18qLwogICAgICAgICAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBqc3gtYTExeS9hbmNob3ItaGFzLWNvbnRlbnQKICAgICAgICAgICAgICByZWFjdC5jcmVhdGVFbGVtZW50KCJhIiwgcmVhY3Rfcm91dGVyX2RvbV9kaXN0X2V4dGVuZHMoe30sIHJlc3QsIHsKICAgICAgICAgICAgICAgIGhyZWY6IGhyZWYsCiAgICAgICAgICAgICAgICBvbkNsaWNrOiByZWxvYWREb2N1bWVudCA/IG9uQ2xpY2sgOiBoYW5kbGVDbGljaywKICAgICAgICAgICAgICAgIHJlZjogcmVmLAogICAgICAgICAgICAgICAgdGFyZ2V0OiB0YXJnZXQKICAgICAgICAgICAgICB9KSkpOwoKICAgICAgICAgIH0pOwoKICAgICAgICAgIGlmIChmYWxzZSkge30KICAgICAgICAgIC8qKgogICAgICAgICAgICogQSA8TGluaz4gd3JhcHBlciB0aGF0IGtub3dzIGlmIGl0J3MgImFjdGl2ZSIgb3Igbm90LgogICAgICAgICAgICovCgoKICAgICAgICAgIHZhciBOYXZMaW5rID0gLyojX19QVVJFX18qL3JlYWN0LmZvcndhcmRSZWYoZnVuY3Rpb24gTmF2TGlua1dpdGhSZWYoX3JlZjUsIHJlZikgewogICAgICAgICAgICB2YXIgX3JlZjUkYXJpYUN1cnJlbnQgPQoKCgoKCgoKICAgICAgICAgICAgICBfcmVmNVsiYXJpYS1jdXJyZW50Il0sYXJpYUN1cnJlbnRQcm9wID0gX3JlZjUkYXJpYUN1cnJlbnQgPT09IHZvaWQgMCA/ICJwYWdlIiA6IF9yZWY1JGFyaWFDdXJyZW50LF9yZWY1JGNhc2VTZW5zaXRpdmUgPSBfcmVmNS5jYXNlU2Vuc2l0aXZlLGNhc2VTZW5zaXRpdmUgPSBfcmVmNSRjYXNlU2Vuc2l0aXZlID09PSB2b2lkIDAgPyBmYWxzZSA6IF9yZWY1JGNhc2VTZW5zaXRpdmUsX3JlZjUkY2xhc3NOYW1lID0gX3JlZjUuY2xhc3NOYW1lLGNsYXNzTmFtZVByb3AgPSBfcmVmNSRjbGFzc05hbWUgPT09IHZvaWQgMCA/ICIiIDogX3JlZjUkY2xhc3NOYW1lLF9yZWY1JGVuZCA9IF9yZWY1LmVuZCxlbmQgPSBfcmVmNSRlbmQgPT09IHZvaWQgMCA/IGZhbHNlIDogX3JlZjUkZW5kLHN0eWxlUHJvcCA9IF9yZWY1LnN0eWxlLHRvID0gX3JlZjUudG8sY2hpbGRyZW4gPSBfcmVmNS5jaGlsZHJlbiwKICAgICAgICAgICAgICByZXN0ID0gX29iamVjdFdpdGhvdXRQcm9wZXJ0aWVzTG9vc2UoX3JlZjUsIF9leGNsdWRlZDIpOwoKICAgICAgICAgICAgdmFyIHBhdGggPSBkaXN0X3VzZVJlc29sdmVkUGF0aCh0bywgewogICAgICAgICAgICAgIHJlbGF0aXZlOiByZXN0LnJlbGF0aXZlCiAgICAgICAgICAgIH0pOwogICAgICAgICAgICB2YXIgbG9jYXRpb24gPSBkaXN0X3VzZUxvY2F0aW9uKCk7CiAgICAgICAgICAgIHZhciByb3V0ZXJTdGF0ZSA9IHJlYWN0LnVzZUNvbnRleHQoRGF0YVJvdXRlclN0YXRlQ29udGV4dCk7CiAgICAgICAgICAgIHZhciBfcmVhY3QkdXNlQ29udGV4dDcgPQoKICAgICAgICAgICAgICByZWFjdC51c2VDb250ZXh0KE5hdmlnYXRpb25Db250ZXh0KSxuYXZpZ2F0b3IgPSBfcmVhY3QkdXNlQ29udGV4dDcubmF2aWdhdG9yOwogICAgICAgICAgICB2YXIgdG9QYXRobmFtZSA9IG5hdmlnYXRvci5lbmNvZGVMb2NhdGlvbiA/IG5hdmlnYXRvci5lbmNvZGVMb2NhdGlvbihwYXRoKS5wYXRobmFtZSA6IHBhdGgucGF0aG5hbWU7CiAgICAgICAgICAgIHZhciBsb2NhdGlvblBhdGhuYW1lID0gbG9jYXRpb24ucGF0aG5hbWU7CiAgICAgICAgICAgIHZhciBuZXh0TG9jYXRpb25QYXRobmFtZSA9IHJvdXRlclN0YXRlICYmIHJvdXRlclN0YXRlLm5hdmlnYXRpb24gJiYgcm91dGVyU3RhdGUubmF2aWdhdGlvbi5sb2NhdGlvbiA/IHJvdXRlclN0YXRlLm5hdmlnYXRpb24ubG9jYXRpb24ucGF0aG5hbWUgOiBudWxsOwoKICAgICAgICAgICAgaWYgKCFjYXNlU2Vuc2l0aXZlKSB7CiAgICAgICAgICAgICAgbG9jYXRpb25QYXRobmFtZSA9IGxvY2F0aW9uUGF0aG5hbWUudG9Mb3dlckNhc2UoKTsKICAgICAgICAgICAgICBuZXh0TG9jYXRpb25QYXRobmFtZSA9IG5leHRMb2NhdGlvblBhdGhuYW1lID8gbmV4dExvY2F0aW9uUGF0aG5hbWUudG9Mb3dlckNhc2UoKSA6IG51bGw7CiAgICAgICAgICAgICAgdG9QYXRobmFtZSA9IHRvUGF0aG5hbWUudG9Mb3dlckNhc2UoKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdmFyIGlzQWN0aXZlID0gbG9jYXRpb25QYXRobmFtZSA9PT0gdG9QYXRobmFtZSB8fCAhZW5kICYmIGxvY2F0aW9uUGF0aG5hbWUuc3RhcnRzV2l0aCh0b1BhdGhuYW1lKSAmJiBsb2NhdGlvblBhdGhuYW1lLmNoYXJBdCh0b1BhdGhuYW1lLmxlbmd0aCkgPT09ICIvIjsKICAgICAgICAgICAgdmFyIGlzUGVuZGluZyA9IG5leHRMb2NhdGlvblBhdGhuYW1lICE9IG51bGwgJiYgKG5leHRMb2NhdGlvblBhdGhuYW1lID09PSB0b1BhdGhuYW1lIHx8ICFlbmQgJiYgbmV4dExvY2F0aW9uUGF0aG5hbWUuc3RhcnRzV2l0aCh0b1BhdGhuYW1lKSAmJiBuZXh0TG9jYXRpb25QYXRobmFtZS5jaGFyQXQodG9QYXRobmFtZS5sZW5ndGgpID09PSAiLyIpOwogICAgICAgICAgICB2YXIgYXJpYUN1cnJlbnQgPSBpc0FjdGl2ZSA/IGFyaWFDdXJyZW50UHJvcCA6IHVuZGVmaW5lZDsKICAgICAgICAgICAgdmFyIGNsYXNzTmFtZTsKCiAgICAgICAgICAgIGlmICh0eXBlb2YgY2xhc3NOYW1lUHJvcCA9PT0gImZ1bmN0aW9uIikgewogICAgICAgICAgICAgIGNsYXNzTmFtZSA9IGNsYXNzTmFtZVByb3AoewogICAgICAgICAgICAgICAgaXNBY3RpdmU6IGlzQWN0aXZlLAogICAgICAgICAgICAgICAgaXNQZW5kaW5nOiBpc1BlbmRpbmcKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAvLyBJZiB0aGUgY2xhc3NOYW1lIHByb3AgaXMgbm90IGEgZnVuY3Rpb24sIHdlIHVzZSBhIGRlZmF1bHQgYGFjdGl2ZWAKICAgICAgICAgICAgICAvLyBjbGFzcyBmb3IgPE5hdkxpbmsgLz5zIHRoYXQgYXJlIGFjdGl2ZS4gSW4gdjUgYGFjdGl2ZWAgd2FzIHRoZSBkZWZhdWx0CiAgICAgICAgICAgICAgLy8gdmFsdWUgZm9yIGBhY3RpdmVDbGFzc05hbWVgLCBidXQgd2UgYXJlIHJlbW92aW5nIHRoYXQgQVBJIGFuZCBjYW4gc3RpbGwKICAgICAgICAgICAgICAvLyB1c2UgdGhlIG9sZCBkZWZhdWx0IGJlaGF2aW9yIGZvciBhIGNsZWFuZXIgdXBncmFkZSBwYXRoIGFuZCBrZWVwIHRoZQogICAgICAgICAgICAgIC8vIHNpbXBsZSBzdHlsaW5nIHJ1bGVzIHdvcmtpbmcgYXMgdGhleSBjdXJyZW50bHkgZG8uCiAgICAgICAgICAgICAgY2xhc3NOYW1lID0gW2NsYXNzTmFtZVByb3AsIGlzQWN0aXZlID8gImFjdGl2ZSIgOiBudWxsLCBpc1BlbmRpbmcgPyAicGVuZGluZyIgOiBudWxsXS5maWx0ZXIoQm9vbGVhbikuam9pbigiICIpOwogICAgICAgICAgICB9CgogICAgICAgICAgICB2YXIgc3R5bGUgPSB0eXBlb2Ygc3R5bGVQcm9wID09PSAiZnVuY3Rpb24iID8gc3R5bGVQcm9wKHsKICAgICAgICAgICAgICBpc0FjdGl2ZTogaXNBY3RpdmUsCiAgICAgICAgICAgICAgaXNQZW5kaW5nOiBpc1BlbmRpbmcKICAgICAgICAgICAgfSkgOiBzdHlsZVByb3A7CiAgICAgICAgICAgIHJldHVybiAvKiNfX1BVUkVfXyovcmVhY3QuY3JlYXRlRWxlbWVudChMaW5rLCByZWFjdF9yb3V0ZXJfZG9tX2Rpc3RfZXh0ZW5kcyh7fSwgcmVzdCwgewogICAgICAgICAgICAgICJhcmlhLWN1cnJlbnQiOiBhcmlhQ3VycmVudCwKICAgICAgICAgICAgICBjbGFzc05hbWU6IGNsYXNzTmFtZSwKICAgICAgICAgICAgICByZWY6IHJlZiwKICAgICAgICAgICAgICBzdHlsZTogc3R5bGUsCiAgICAgICAgICAgICAgdG86IHRvCiAgICAgICAgICAgIH0pLCB0eXBlb2YgY2hpbGRyZW4gPT09ICJmdW5jdGlvbiIgPyBjaGlsZHJlbih7CiAgICAgICAgICAgICAgaXNBY3RpdmU6IGlzQWN0aXZlLAogICAgICAgICAgICAgIGlzUGVuZGluZzogaXNQZW5kaW5nCiAgICAgICAgICAgIH0pIDogY2hpbGRyZW4pOwogICAgICAgICAgfSk7CgogICAgICAgICAgaWYgKGZhbHNlKSB7fQogICAgICAgICAgLyoqCiAgICAgICAgICAgKiBBIGBAcmVtaXgtcnVuL3JvdXRlcmAtYXdhcmUgYDxmb3JtPmAuIEl0IGJlaGF2ZXMgbGlrZSBhIG5vcm1hbCBmb3JtIGV4Y2VwdAogICAgICAgICAgICogdGhhdCB0aGUgaW50ZXJhY3Rpb24gd2l0aCB0aGUgc2VydmVyIGlzIHdpdGggYGZldGNoYCBpbnN0ZWFkIG9mIG5ldyBkb2N1bWVudAogICAgICAgICAgICogcmVxdWVzdHMsIGFsbG93aW5nIGNvbXBvbmVudHMgdG8gYWRkIG5pY2VyIFVYIHRvIHRoZSBwYWdlIGFzIHRoZSBmb3JtIGlzCiAgICAgICAgICAgKiBzdWJtaXR0ZWQgYW5kIHJldHVybnMgd2l0aCBkYXRhLgogICAgICAgICAgICovCgoKICAgICAgICAgIHZhciBGb3JtID0gLyojX19QVVJFX18qLyAvKiB1bnVzZWQgcHVyZSBleHByZXNzaW9uIG9yIHN1cGVyICovbnVsbCAmJiBSZWFjdC5mb3J3YXJkUmVmKChwcm9wcywgcmVmKSA9PiB7CiAgICAgICAgICAgIHJldHVybiAvKiNfX1BVUkVfXyovUmVhY3QuY3JlYXRlRWxlbWVudChGb3JtSW1wbCwgcmVhY3Rfcm91dGVyX2RvbV9kaXN0X2V4dGVuZHMoe30sIHByb3BzLCB7CiAgICAgICAgICAgICAgcmVmOiByZWYKICAgICAgICAgICAgfSkpOwogICAgICAgICAgfSk7CgogICAgICAgICAgaWYgKGZhbHNlKSB7fQoKICAgICAgICAgIHZhciBGb3JtSW1wbCA9IC8qI19fUFVSRV9fKi8gLyogdW51c2VkIHB1cmUgZXhwcmVzc2lvbiBvciBzdXBlciAqL251bGwgJiYgUmVhY3QuZm9yd2FyZFJlZigoX3JlZjYsIGZvcndhcmRlZFJlZikgPT4gewogICAgICAgICAgICB2YXIKICAgICAgICAgICAgICByZWxvYWREb2N1bWVudCA9CgoKCgoKCgoKICAgICAgICAgICAgICBfcmVmNi5yZWxvYWREb2N1bWVudCxyZXBsYWNlID0gX3JlZjYucmVwbGFjZSxfcmVmNiRtZXRob2QgPSBfcmVmNi5tZXRob2QsbWV0aG9kID0gX3JlZjYkbWV0aG9kID09PSB2b2lkIDAgPyBkZWZhdWx0TWV0aG9kIDogX3JlZjYkbWV0aG9kLGFjdGlvbiA9IF9yZWY2LmFjdGlvbixvblN1Ym1pdCA9IF9yZWY2Lm9uU3VibWl0LGZldGNoZXJLZXkgPSBfcmVmNi5mZXRjaGVyS2V5LHJvdXRlSWQgPSBfcmVmNi5yb3V0ZUlkLHJlbGF0aXZlID0gX3JlZjYucmVsYXRpdmUscHJldmVudFNjcm9sbFJlc2V0ID0gX3JlZjYucHJldmVudFNjcm9sbFJlc2V0LAogICAgICAgICAgICAgIHByb3BzID0gX29iamVjdFdpdGhvdXRQcm9wZXJ0aWVzTG9vc2UoX3JlZjYsIF9leGNsdWRlZDMpOwoKICAgICAgICAgICAgdmFyIHN1Ym1pdCA9IHVzZVN1Ym1pdEltcGwoZmV0Y2hlcktleSwgcm91dGVJZCk7CiAgICAgICAgICAgIHZhciBmb3JtTWV0aG9kID0gbWV0aG9kLnRvTG93ZXJDYXNlKCkgPT09ICJnZXQiID8gImdldCIgOiAicG9zdCI7CiAgICAgICAgICAgIHZhciBmb3JtQWN0aW9uID0gdXNlRm9ybUFjdGlvbihhY3Rpb24sIHsKICAgICAgICAgICAgICByZWxhdGl2ZTogcmVsYXRpdmUKICAgICAgICAgICAgfSk7CgogICAgICAgICAgICB2YXIgc3VibWl0SGFuZGxlciA9IChldmVudCkgPT4gewogICAgICAgICAgICAgIG9uU3VibWl0ICYmIG9uU3VibWl0KGV2ZW50KTsKICAgICAgICAgICAgICBpZiAoZXZlbnQuZGVmYXVsdFByZXZlbnRlZCkgcmV0dXJuOwogICAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgICAgICAgdmFyIHN1Ym1pdHRlciA9IGV2ZW50Lm5hdGl2ZUV2ZW50LnN1Ym1pdHRlcjsKICAgICAgICAgICAgICB2YXIgc3VibWl0TWV0aG9kID0gKHN1Ym1pdHRlciA9PSBudWxsID8gdm9pZCAwIDogc3VibWl0dGVyLmdldEF0dHJpYnV0ZSgiZm9ybW1ldGhvZCIpKSB8fCBtZXRob2Q7CiAgICAgICAgICAgICAgc3VibWl0KHN1Ym1pdHRlciB8fCBldmVudC5jdXJyZW50VGFyZ2V0LCB7CiAgICAgICAgICAgICAgICBtZXRob2Q6IHN1Ym1pdE1ldGhvZCwKICAgICAgICAgICAgICAgIHJlcGxhY2U6IHJlcGxhY2UsCiAgICAgICAgICAgICAgICByZWxhdGl2ZTogcmVsYXRpdmUsCiAgICAgICAgICAgICAgICBwcmV2ZW50U2Nyb2xsUmVzZXQ6IHByZXZlbnRTY3JvbGxSZXNldAogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9OwoKICAgICAgICAgICAgcmV0dXJuIC8qI19fUFVSRV9fKi9SZWFjdC5jcmVhdGVFbGVtZW50KCJmb3JtIiwgcmVhY3Rfcm91dGVyX2RvbV9kaXN0X2V4dGVuZHMoewogICAgICAgICAgICAgIHJlZjogZm9yd2FyZGVkUmVmLAogICAgICAgICAgICAgIG1ldGhvZDogZm9ybU1ldGhvZCwKICAgICAgICAgICAgICBhY3Rpb246IGZvcm1BY3Rpb24sCiAgICAgICAgICAgICAgb25TdWJtaXQ6IHJlbG9hZERvY3VtZW50ID8gb25TdWJtaXQgOiBzdWJtaXRIYW5kbGVyCiAgICAgICAgICAgIH0sIHByb3BzKSk7CiAgICAgICAgICB9KTsKCiAgICAgICAgICBpZiAoZmFsc2UpIHt9CiAgICAgICAgICAvKioKICAgICAgICAgICAqIFRoaXMgY29tcG9uZW50IHdpbGwgZW11bGF0ZSB0aGUgYnJvd3NlcidzIHNjcm9sbCByZXN0b3JhdGlvbiBvbiBsb2NhdGlvbgogICAgICAgICAgICogY2hhbmdlcy4KICAgICAgICAgICAqLwoKCiAgICAgICAgICBmdW5jdGlvbiBTY3JvbGxSZXN0b3JhdGlvbihfcmVmNykgewogICAgICAgICAgICB2YXIKICAgICAgICAgICAgICBnZXRLZXkgPQoKICAgICAgICAgICAgICBfcmVmNy5nZXRLZXksc3RvcmFnZUtleSA9IF9yZWY3LnN0b3JhZ2VLZXk7CiAgICAgICAgICAgIHVzZVNjcm9sbFJlc3RvcmF0aW9uKHsKICAgICAgICAgICAgICBnZXRLZXk6IGdldEtleSwKICAgICAgICAgICAgICBzdG9yYWdlS2V5OiBzdG9yYWdlS2V5CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoZmFsc2UpIHt9IC8vI2VuZHJlZ2lvbgogICAgICAgICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KICAgICAgICAgIC8vI3JlZ2lvbiBIb29rcwogICAgICAgICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KCgogICAgICAgICAgdmFyIGRpc3RfRGF0YVJvdXRlckhvb2s7CgogICAgICAgICAgKGZ1bmN0aW9uIChEYXRhUm91dGVySG9vaykgewogICAgICAgICAgICBEYXRhUm91dGVySG9va1siVXNlU2Nyb2xsUmVzdG9yYXRpb24iXSA9ICJ1c2VTY3JvbGxSZXN0b3JhdGlvbiI7CiAgICAgICAgICAgIERhdGFSb3V0ZXJIb29rWyJVc2VTdWJtaXRJbXBsIl0gPSAidXNlU3VibWl0SW1wbCI7CiAgICAgICAgICAgIERhdGFSb3V0ZXJIb29rWyJVc2VGZXRjaGVyIl0gPSAidXNlRmV0Y2hlciI7CiAgICAgICAgICB9KShkaXN0X0RhdGFSb3V0ZXJIb29rIHx8IChkaXN0X0RhdGFSb3V0ZXJIb29rID0ge30pKTsKCiAgICAgICAgICB2YXIgZGlzdF9EYXRhUm91dGVyU3RhdGVIb29rOwoKICAgICAgICAgIChmdW5jdGlvbiAoRGF0YVJvdXRlclN0YXRlSG9vaykgewogICAgICAgICAgICBEYXRhUm91dGVyU3RhdGVIb29rWyJVc2VGZXRjaGVycyJdID0gInVzZUZldGNoZXJzIjsKICAgICAgICAgICAgRGF0YVJvdXRlclN0YXRlSG9va1siVXNlU2Nyb2xsUmVzdG9yYXRpb24iXSA9ICJ1c2VTY3JvbGxSZXN0b3JhdGlvbiI7CiAgICAgICAgICB9KShkaXN0X0RhdGFSb3V0ZXJTdGF0ZUhvb2sgfHwgKGRpc3RfRGF0YVJvdXRlclN0YXRlSG9vayA9IHt9KSk7CgogICAgICAgICAgZnVuY3Rpb24gZGlzdF9nZXREYXRhUm91dGVyQ29uc29sZUVycm9yKGhvb2tOYW1lKSB7CiAgICAgICAgICAgIHJldHVybiBob29rTmFtZSArICIgbXVzdCBiZSB1c2VkIHdpdGhpbiBhIGRhdGEgcm91dGVyLiAgU2VlIGh0dHBzOi8vcmVhY3Ryb3V0ZXIuY29tL3JvdXRlcnMvcGlja2luZy1hLXJvdXRlci4iOwogICAgICAgICAgfQoKICAgICAgICAgIGZ1bmN0aW9uIGRpc3RfdXNlRGF0YVJvdXRlckNvbnRleHQoaG9va05hbWUpIHsKICAgICAgICAgICAgdmFyIGN0eCA9IFJlYWN0LnVzZUNvbnRleHQoVU5TQUZFX0RhdGFSb3V0ZXJDb250ZXh0KTsKICAgICAgICAgICAgIWN0eCA/IGZhbHNlID8gMCA6IGludmFyaWFudChmYWxzZSkgOiB2b2lkIDA7CiAgICAgICAgICAgIHJldHVybiBjdHg7CiAgICAgICAgICB9CgogICAgICAgICAgZnVuY3Rpb24gZGlzdF91c2VEYXRhUm91dGVyU3RhdGUoaG9va05hbWUpIHsKICAgICAgICAgICAgdmFyIHN0YXRlID0gUmVhY3QudXNlQ29udGV4dChVTlNBRkVfRGF0YVJvdXRlclN0YXRlQ29udGV4dCk7CiAgICAgICAgICAgICFzdGF0ZSA/IGZhbHNlID8gMCA6IGludmFyaWFudChmYWxzZSkgOiB2b2lkIDA7CiAgICAgICAgICAgIHJldHVybiBzdGF0ZTsKICAgICAgICAgIH0KICAgICAgICAgIC8qKgogICAgICAgICAgICogSGFuZGxlcyB0aGUgY2xpY2sgYmVoYXZpb3IgZm9yIHJvdXRlciBgPExpbms+YCBjb21wb25lbnRzLiBUaGlzIGlzIHVzZWZ1bCBpZgogICAgICAgICAgICogeW91IG5lZWQgdG8gY3JlYXRlIGN1c3RvbSBgPExpbms+YCBjb21wb25lbnRzIHdpdGggdGhlIHNhbWUgY2xpY2sgYmVoYXZpb3Igd2UKICAgICAgICAgICAqIHVzZSBpbiBvdXIgZXhwb3J0ZWQgYDxMaW5rPmAuCiAgICAgICAgICAgKi8KCgogICAgICAgICAgZnVuY3Rpb24gdXNlTGlua0NsaWNrSGFuZGxlcih0bywgX3RlbXApIHsKICAgICAgICAgICAgdmFyIF9yZWYzMiA9CgoKCgoKICAgICAgICAgICAgICBfdGVtcCA9PT0gdm9pZCAwID8ge30gOiBfdGVtcCx0YXJnZXQgPSBfcmVmMzIudGFyZ2V0LHJlcGxhY2VQcm9wID0gX3JlZjMyLnJlcGxhY2Usc3RhdGUgPSBfcmVmMzIuc3RhdGUscHJldmVudFNjcm9sbFJlc2V0ID0gX3JlZjMyLnByZXZlbnRTY3JvbGxSZXNldCxyZWxhdGl2ZSA9IF9yZWYzMi5yZWxhdGl2ZTsKICAgICAgICAgICAgdmFyIG5hdmlnYXRlID0gZGlzdF91c2VOYXZpZ2F0ZSgpOwogICAgICAgICAgICB2YXIgbG9jYXRpb24gPSBkaXN0X3VzZUxvY2F0aW9uKCk7CiAgICAgICAgICAgIHZhciBwYXRoID0gZGlzdF91c2VSZXNvbHZlZFBhdGgodG8sIHsKICAgICAgICAgICAgICByZWxhdGl2ZTogcmVsYXRpdmUKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIHJldHVybiByZWFjdC51c2VDYWxsYmFjaygoZXZlbnQpID0+IHsKICAgICAgICAgICAgICBpZiAoc2hvdWxkUHJvY2Vzc0xpbmtDbGljayhldmVudCwgdGFyZ2V0KSkgewogICAgICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTsgLy8gSWYgdGhlIFVSTCBoYXNuJ3QgY2hhbmdlZCwgYSByZWd1bGFyIDxhPiB3aWxsIGRvIGEgcmVwbGFjZSBpbnN0ZWFkIG9mCiAgICAgICAgICAgICAgICAvLyBhIHB1c2gsIHNvIGRvIHRoZSBzYW1lIGhlcmUgdW5sZXNzIHRoZSByZXBsYWNlIHByb3AgaXMgZXhwbGljaXRseSBzZXQKCiAgICAgICAgICAgICAgICB2YXIgcmVwbGFjZSA9IHJlcGxhY2VQcm9wICE9PSB1bmRlZmluZWQgPyByZXBsYWNlUHJvcCA6IHJvdXRlcl9jcmVhdGVQYXRoKGxvY2F0aW9uKSA9PT0gcm91dGVyX2NyZWF0ZVBhdGgocGF0aCk7CiAgICAgICAgICAgICAgICBuYXZpZ2F0ZSh0bywgewogICAgICAgICAgICAgICAgICByZXBsYWNlOiByZXBsYWNlLAogICAgICAgICAgICAgICAgICBzdGF0ZTogc3RhdGUsCiAgICAgICAgICAgICAgICAgIHByZXZlbnRTY3JvbGxSZXNldDogcHJldmVudFNjcm9sbFJlc2V0LAogICAgICAgICAgICAgICAgICByZWxhdGl2ZTogcmVsYXRpdmUKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwgW2xvY2F0aW9uLCBuYXZpZ2F0ZSwgcGF0aCwgcmVwbGFjZVByb3AsIHN0YXRlLCB0YXJnZXQsIHRvLCBwcmV2ZW50U2Nyb2xsUmVzZXQsIHJlbGF0aXZlXSk7CiAgICAgICAgICB9CiAgICAgICAgICAvKioKICAgICAgICAgICAqIEEgY29udmVuaWVudCB3cmFwcGVyIGZvciByZWFkaW5nIGFuZCB3cml0aW5nIHNlYXJjaCBwYXJhbWV0ZXJzIHZpYSB0aGUKICAgICAgICAgICAqIFVSTFNlYXJjaFBhcmFtcyBpbnRlcmZhY2UuCiAgICAgICAgICAgKi8KCiAgICAgICAgICBmdW5jdGlvbiB1c2VTZWFyY2hQYXJhbXMoZGVmYXVsdEluaXQpIHsKICAgICAgICAgICAgZmFsc2UgPyAwIDogdm9pZCAwOwogICAgICAgICAgICB2YXIgZGVmYXVsdFNlYXJjaFBhcmFtc1JlZiA9IFJlYWN0LnVzZVJlZihjcmVhdGVTZWFyY2hQYXJhbXMoZGVmYXVsdEluaXQpKTsKICAgICAgICAgICAgdmFyIGxvY2F0aW9uID0gdXNlTG9jYXRpb24oKTsKICAgICAgICAgICAgdmFyIHNlYXJjaFBhcmFtcyA9IFJlYWN0LnVzZU1lbW8oKCkgPT4gZ2V0U2VhcmNoUGFyYW1zRm9yTG9jYXRpb24obG9jYXRpb24uc2VhcmNoLCBkZWZhdWx0U2VhcmNoUGFyYW1zUmVmLmN1cnJlbnQpLCBbbG9jYXRpb24uc2VhcmNoXSk7CiAgICAgICAgICAgIHZhciBuYXZpZ2F0ZSA9IHVzZU5hdmlnYXRlKCk7CiAgICAgICAgICAgIHZhciBzZXRTZWFyY2hQYXJhbXMgPSBSZWFjdC51c2VDYWxsYmFjaygobmV4dEluaXQsIG5hdmlnYXRlT3B0aW9ucykgPT4gewogICAgICAgICAgICAgIHZhciBuZXdTZWFyY2hQYXJhbXMgPSBjcmVhdGVTZWFyY2hQYXJhbXModHlwZW9mIG5leHRJbml0ID09PSAiZnVuY3Rpb24iID8gbmV4dEluaXQoc2VhcmNoUGFyYW1zKSA6IG5leHRJbml0KTsKICAgICAgICAgICAgICBuYXZpZ2F0ZSgiPyIgKyBuZXdTZWFyY2hQYXJhbXMsIG5hdmlnYXRlT3B0aW9ucyk7CiAgICAgICAgICAgIH0sIFtuYXZpZ2F0ZSwgc2VhcmNoUGFyYW1zXSk7CiAgICAgICAgICAgIHJldHVybiBbc2VhcmNoUGFyYW1zLCBzZXRTZWFyY2hQYXJhbXNdOwogICAgICAgICAgfQogICAgICAgICAgLyoqCiAgICAgICAgICAgKiBSZXR1cm5zIGEgZnVuY3Rpb24gdGhhdCBtYXkgYmUgdXNlZCB0byBwcm9ncmFtbWF0aWNhbGx5IHN1Ym1pdCBhIGZvcm0gKG9yCiAgICAgICAgICAgKiBzb21lIGFyYml0cmFyeSBkYXRhKSB0byB0aGUgc2VydmVyLgogICAgICAgICAgICovCgogICAgICAgICAgZnVuY3Rpb24gdXNlU3VibWl0KCkgewogICAgICAgICAgICByZXR1cm4gdXNlU3VibWl0SW1wbCgpOwogICAgICAgICAgfQoKICAgICAgICAgIGZ1bmN0aW9uIHVzZVN1Ym1pdEltcGwoZmV0Y2hlcktleSwgcm91dGVJZCkgewogICAgICAgICAgICB2YXIgX2Rpc3RfdXNlRGF0YVJvdXRlckNvID0KCiAgICAgICAgICAgICAgZGlzdF91c2VEYXRhUm91dGVyQ29udGV4dChkaXN0X0RhdGFSb3V0ZXJIb29rLlVzZVN1Ym1pdEltcGwpLHJvdXRlciA9IF9kaXN0X3VzZURhdGFSb3V0ZXJDby5yb3V0ZXI7CiAgICAgICAgICAgIHZhciBkZWZhdWx0QWN0aW9uID0gdXNlRm9ybUFjdGlvbigpOwogICAgICAgICAgICByZXR1cm4gUmVhY3QudXNlQ2FsbGJhY2soZnVuY3Rpb24gKHRhcmdldCwgb3B0aW9ucykgewogICAgICAgICAgICAgIGlmIChvcHRpb25zID09PSB2b2lkIDApIHsKICAgICAgICAgICAgICAgIG9wdGlvbnMgPSB7fTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIGlmICh0eXBlb2YgZG9jdW1lbnQgPT09ICJ1bmRlZmluZWQiKSB7CiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIllvdSBhcmUgY2FsbGluZyBzdWJtaXQgZHVyaW5nIHRoZSBzZXJ2ZXIgcmVuZGVyLiAiICsgIlRyeSBjYWxsaW5nIHN1Ym1pdCB3aXRoaW4gYSBgdXNlRWZmZWN0YCBvciBjYWxsYmFjayBpbnN0ZWFkLiIpOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgdmFyIF9nZXRGb3JtU3VibWlzc2lvbkluZiA9CgoKCgogICAgICAgICAgICAgICAgZ2V0Rm9ybVN1Ym1pc3Npb25JbmZvKHRhcmdldCwgZGVmYXVsdEFjdGlvbiwgb3B0aW9ucyksbWV0aG9kID0gX2dldEZvcm1TdWJtaXNzaW9uSW5mLm1ldGhvZCxlbmNUeXBlID0gX2dldEZvcm1TdWJtaXNzaW9uSW5mLmVuY1R5cGUsZm9ybURhdGEgPSBfZ2V0Rm9ybVN1Ym1pc3Npb25JbmYuZm9ybURhdGEsdXJsID0gX2dldEZvcm1TdWJtaXNzaW9uSW5mLnVybDsKICAgICAgICAgICAgICB2YXIgaHJlZiA9IHVybC5wYXRobmFtZSArIHVybC5zZWFyY2g7CiAgICAgICAgICAgICAgdmFyIG9wdHMgPSB7CiAgICAgICAgICAgICAgICByZXBsYWNlOiBvcHRpb25zLnJlcGxhY2UsCiAgICAgICAgICAgICAgICBwcmV2ZW50U2Nyb2xsUmVzZXQ6IG9wdGlvbnMucHJldmVudFNjcm9sbFJlc2V0LAogICAgICAgICAgICAgICAgZm9ybURhdGE6IGZvcm1EYXRhLAogICAgICAgICAgICAgICAgZm9ybU1ldGhvZDogbWV0aG9kLAogICAgICAgICAgICAgICAgZm9ybUVuY1R5cGU6IGVuY1R5cGUKICAgICAgICAgICAgICB9OwoKICAgICAgICAgICAgICBpZiAoZmV0Y2hlcktleSkgewogICAgICAgICAgICAgICAgIShyb3V0ZUlkICE9IG51bGwpID8gZmFsc2UgPyAwIDogaW52YXJpYW50KGZhbHNlKSA6IHZvaWQgMDsKICAgICAgICAgICAgICAgIHJvdXRlci5mZXRjaChmZXRjaGVyS2V5LCByb3V0ZUlkLCBocmVmLCBvcHRzKTsKICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgcm91dGVyLm5hdmlnYXRlKGhyZWYsIG9wdHMpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwgW2RlZmF1bHRBY3Rpb24sIHJvdXRlciwgZmV0Y2hlcktleSwgcm91dGVJZF0pOwogICAgICAgICAgfQoKICAgICAgICAgIGZ1bmN0aW9uIHVzZUZvcm1BY3Rpb24oYWN0aW9uLCBfdGVtcDIpIHsKICAgICAgICAgICAgdmFyIF9yZWYzMyA9CgogICAgICAgICAgICAgIF90ZW1wMiA9PT0gdm9pZCAwID8ge30gOiBfdGVtcDIscmVsYXRpdmUgPSBfcmVmMzMucmVsYXRpdmU7CiAgICAgICAgICAgIHZhciBfUmVhY3QkdXNlQ29udGV4dDIgPQoKICAgICAgICAgICAgICBSZWFjdC51c2VDb250ZXh0KFVOU0FGRV9OYXZpZ2F0aW9uQ29udGV4dCksYmFzZW5hbWUgPSBfUmVhY3QkdXNlQ29udGV4dDIuYmFzZW5hbWU7CiAgICAgICAgICAgIHZhciByb3V0ZUNvbnRleHQgPSBSZWFjdC51c2VDb250ZXh0KFVOU0FGRV9Sb3V0ZUNvbnRleHQpOwogICAgICAgICAgICAhcm91dGVDb250ZXh0ID8gZmFsc2UgPyAwIDogaW52YXJpYW50KGZhbHNlKSA6IHZvaWQgMDsKICAgICAgICAgICAgdmFyIF9yb3V0ZUNvbnRleHQkbWF0Y2hlcyA9IHJvdXRlQ29udGV4dC5tYXRjaGVzLnNsaWNlKC0xKSxfcm91dGVDb250ZXh0JG1hdGNoZXMyID0gX3NsaWNlZFRvQXJyYXkyKF9yb3V0ZUNvbnRleHQkbWF0Y2hlcywgMSksbWF0Y2ggPSBfcm91dGVDb250ZXh0JG1hdGNoZXMyWzBdOyAvLyBTaGFsbG93IGNsb25lIHBhdGggc28gd2UgY2FuIG1vZGlmeSBpdCBiZWxvdywgb3RoZXJ3aXNlIHdlIG1vZGlmeSB0aGUKICAgICAgICAgICAgLy8gb2JqZWN0IHJlZmVyZW5jZWQgYnkgdXNlTWVtbyBpbnNpZGUgdXNlUmVzb2x2ZWRQYXRoCgogICAgICAgICAgICB2YXIgcGF0aCA9IHJlYWN0X3JvdXRlcl9kb21fZGlzdF9leHRlbmRzKHt9LCB1c2VSZXNvbHZlZFBhdGgoYWN0aW9uID8gYWN0aW9uIDogIi4iLCB7CiAgICAgICAgICAgICAgcmVsYXRpdmU6IHJlbGF0aXZlCiAgICAgICAgICAgIH0pKTsgLy8gUHJldmlvdXNseSB3ZSBzZXQgdGhlIGRlZmF1bHQgYWN0aW9uIHRvICIuIi4gVGhlIHByb2JsZW0gd2l0aCB0aGlzIGlzIHRoYXQKICAgICAgICAgICAgLy8gYHVzZVJlc29sdmVkUGF0aCgiLiIpYCBleGNsdWRlcyBzZWFyY2ggcGFyYW1zIGFuZCB0aGUgaGFzaCBvZiB0aGUgcmVzb2x2ZWQKICAgICAgICAgICAgLy8gVVJMLiBUaGlzIGlzIHRoZSBpbnRlbmRlZCBiZWhhdmlvciBvZiB3aGVuICIuIiBpcyBzcGVjaWZpY2FsbHkgcHJvdmlkZWQgYXMKICAgICAgICAgICAgLy8gdGhlIGZvcm0gYWN0aW9uLCBidXQgaW5jb25zaXN0ZW50IHcvIGJyb3dzZXJzIHdoZW4gdGhlIGFjdGlvbiBpcyBvbWl0dGVkLgogICAgICAgICAgICAvLyBodHRwczovL2dpdGh1Yi5jb20vcmVtaXgtcnVuL3JlbWl4L2lzc3Vlcy85MjcKCgogICAgICAgICAgICB2YXIgbG9jYXRpb24gPSB1c2VMb2NhdGlvbigpOwoKICAgICAgICAgICAgaWYgKGFjdGlvbiA9PSBudWxsKSB7CiAgICAgICAgICAgICAgLy8gU2FmZSB0byB3cml0ZSB0byB0aGVzZSBkaXJlY3RseSBoZXJlIHNpbmNlIGlmIGFjdGlvbiB3YXMgdW5kZWZpbmVkLCB3ZQogICAgICAgICAgICAgIC8vIHdvdWxkIGhhdmUgY2FsbGVkIHVzZVJlc29sdmVkUGF0aCgiLiIpIHdoaWNoIHdpbGwgbmV2ZXIgaW5jbHVkZSBhIHNlYXJjaAogICAgICAgICAgICAgIC8vIG9yIGhhc2gKICAgICAgICAgICAgICBwYXRoLnNlYXJjaCA9IGxvY2F0aW9uLnNlYXJjaDsKICAgICAgICAgICAgICBwYXRoLmhhc2ggPSBsb2NhdGlvbi5oYXNoOyAvLyBXaGVuIGdyYWJiaW5nIHNlYXJjaCBwYXJhbXMgZnJvbSB0aGUgVVJMLCByZW1vdmUgdGhlIGF1dG9tYXRpY2FsbHkKICAgICAgICAgICAgICAvLyBpbnNlcnRlZCA/aW5kZXggcGFyYW0gc28gd2UgbWF0Y2ggdGhlIHVzZVJlc29sdmVkUGF0aCBzZWFyY2ggYmVoYXZpb3IKICAgICAgICAgICAgICAvLyB3aGljaCB3b3VsZCBub3QgaW5jbHVkZSA/aW5kZXgKCiAgICAgICAgICAgICAgaWYgKG1hdGNoLnJvdXRlLmluZGV4KSB7CiAgICAgICAgICAgICAgICB2YXIgcGFyYW1zID0gbmV3IFVSTFNlYXJjaFBhcmFtcyhwYXRoLnNlYXJjaCk7CiAgICAgICAgICAgICAgICBwYXJhbXMuZGVsZXRlKCJpbmRleCIpOwogICAgICAgICAgICAgICAgcGF0aC5zZWFyY2ggPSBwYXJhbXMudG9TdHJpbmcoKSA/ICI/IiArIHBhcmFtcy50b1N0cmluZygpIDogIiI7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoKCFhY3Rpb24gfHwgYWN0aW9uID09PSAiLiIpICYmIG1hdGNoLnJvdXRlLmluZGV4KSB7CiAgICAgICAgICAgICAgcGF0aC5zZWFyY2ggPSBwYXRoLnNlYXJjaCA/IHBhdGguc2VhcmNoLnJlcGxhY2UoL15cPy8sICI/aW5kZXgmIikgOiAiP2luZGV4IjsKICAgICAgICAgICAgfSAvLyBJZiB3ZSdyZSBvcGVyYXRpbmcgd2l0aGluIGEgYmFzZW5hbWUsIHByZXBlbmQgaXQgdG8gdGhlIHBhdGhuYW1lIHByaW9yCiAgICAgICAgICAgIC8vIHRvIGNyZWF0aW5nIHRoZSBmb3JtIGFjdGlvbi4gIElmIHRoaXMgaXMgYSByb290IG5hdmlnYXRpb24sIHRoZW4ganVzdCB1c2UKICAgICAgICAgICAgLy8gdGhlIHJhdyBiYXNlbmFtZSB3aGljaCBhbGxvd3MgdGhlIGJhc2VuYW1lIHRvIGhhdmUgZnVsbCBjb250cm9sIG92ZXIgdGhlCiAgICAgICAgICAgIC8vIHByZXNlbmNlIG9mIGEgdHJhaWxpbmcgc2xhc2ggb24gcm9vdCBhY3Rpb25zCgoKICAgICAgICAgICAgaWYgKGJhc2VuYW1lICE9PSAiLyIpIHsKICAgICAgICAgICAgICBwYXRoLnBhdGhuYW1lID0gcGF0aC5wYXRobmFtZSA9PT0gIi8iID8gYmFzZW5hbWUgOiBqb2luUGF0aHMoW2Jhc2VuYW1lLCBwYXRoLnBhdGhuYW1lXSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybiBjcmVhdGVQYXRoKHBhdGgpOwogICAgICAgICAgfQoKICAgICAgICAgIGZ1bmN0aW9uIGNyZWF0ZUZldGNoZXJGb3JtKGZldGNoZXJLZXksIHJvdXRlSWQpIHsKICAgICAgICAgICAgdmFyIEZldGNoZXJGb3JtID0gLyojX19QVVJFX18qL1JlYWN0LmZvcndhcmRSZWYoKHByb3BzLCByZWYpID0+IHsKICAgICAgICAgICAgICByZXR1cm4gLyojX19QVVJFX18qL1JlYWN0LmNyZWF0ZUVsZW1lbnQoRm9ybUltcGwsIHJlYWN0X3JvdXRlcl9kb21fZGlzdF9leHRlbmRzKHt9LCBwcm9wcywgewogICAgICAgICAgICAgICAgcmVmOiByZWYsCiAgICAgICAgICAgICAgICBmZXRjaGVyS2V5OiBmZXRjaGVyS2V5LAogICAgICAgICAgICAgICAgcm91dGVJZDogcm91dGVJZAogICAgICAgICAgICAgIH0pKTsKICAgICAgICAgICAgfSk7CgogICAgICAgICAgICBpZiAoZmFsc2UpIHt9CgogICAgICAgICAgICByZXR1cm4gRmV0Y2hlckZvcm07CiAgICAgICAgICB9CgogICAgICAgICAgdmFyIGZldGNoZXJJZCA9IDA7CiAgICAgICAgICAvKioKICAgICAgICAgICAqIEludGVyYWN0cyB3aXRoIHJvdXRlIGxvYWRlcnMgYW5kIGFjdGlvbnMgd2l0aG91dCBjYXVzaW5nIGEgbmF2aWdhdGlvbi4gR3JlYXQKICAgICAgICAgICAqIGZvciBhbnkgaW50ZXJhY3Rpb24gdGhhdCBzdGF5cyBvbiB0aGUgc2FtZSBwYWdlLgogICAgICAgICAgICovCgogICAgICAgICAgZnVuY3Rpb24gdXNlRmV0Y2hlcigpIHsKICAgICAgICAgICAgdmFyIF9yb3V0ZSRtYXRjaGVzOwoKICAgICAgICAgICAgdmFyIF9kaXN0X3VzZURhdGFSb3V0ZXJDbzIgPQoKICAgICAgICAgICAgICBkaXN0X3VzZURhdGFSb3V0ZXJDb250ZXh0KGRpc3RfRGF0YVJvdXRlckhvb2suVXNlRmV0Y2hlcikscm91dGVyID0gX2Rpc3RfdXNlRGF0YVJvdXRlckNvMi5yb3V0ZXI7CiAgICAgICAgICAgIHZhciByb3V0ZSA9IFJlYWN0LnVzZUNvbnRleHQoVU5TQUZFX1JvdXRlQ29udGV4dCk7CiAgICAgICAgICAgICFyb3V0ZSA/IGZhbHNlID8gMCA6IGludmFyaWFudChmYWxzZSkgOiB2b2lkIDA7CiAgICAgICAgICAgIHZhciByb3V0ZUlkID0gKF9yb3V0ZSRtYXRjaGVzID0gcm91dGUubWF0Y2hlc1tyb3V0ZS5tYXRjaGVzLmxlbmd0aCAtIDFdKSA9PSBudWxsID8gdm9pZCAwIDogX3JvdXRlJG1hdGNoZXMucm91dGUuaWQ7CiAgICAgICAgICAgICEocm91dGVJZCAhPSBudWxsKSA/IGZhbHNlID8gMCA6IGludmFyaWFudChmYWxzZSkgOiB2b2lkIDA7CiAgICAgICAgICAgIHZhciBfUmVhY3QkdXNlU3RhdGU3ID0gUmVhY3QudXNlU3RhdGUoKCkgPT4gU3RyaW5nKCsrZmV0Y2hlcklkKSksX1JlYWN0JHVzZVN0YXRlOCA9IF9zbGljZWRUb0FycmF5MihfUmVhY3QkdXNlU3RhdGU3LCAxKSxmZXRjaGVyS2V5ID0gX1JlYWN0JHVzZVN0YXRlOFswXTsKICAgICAgICAgICAgdmFyIF9SZWFjdCR1c2VTdGF0ZTkgPSBSZWFjdC51c2VTdGF0ZSgoKSA9PiB7CiAgICAgICAgICAgICAgICAhcm91dGVJZCA/IGZhbHNlID8gMCA6IGludmFyaWFudChmYWxzZSkgOiB2b2lkIDA7CiAgICAgICAgICAgICAgICByZXR1cm4gY3JlYXRlRmV0Y2hlckZvcm0oZmV0Y2hlcktleSwgcm91dGVJZCk7CiAgICAgICAgICAgICAgfSksX1JlYWN0JHVzZVN0YXRlMTAgPSBfc2xpY2VkVG9BcnJheTIoX1JlYWN0JHVzZVN0YXRlOSwgMSksRm9ybSA9IF9SZWFjdCR1c2VTdGF0ZTEwWzBdOwogICAgICAgICAgICB2YXIgX1JlYWN0JHVzZVN0YXRlMTEgPSBSZWFjdC51c2VTdGF0ZSgoKSA9PiAoaHJlZikgPT4gewogICAgICAgICAgICAgICAgIXJvdXRlciA/IGZhbHNlID8gMCA6IGludmFyaWFudChmYWxzZSkgOiB2b2lkIDA7CiAgICAgICAgICAgICAgICAhcm91dGVJZCA/IGZhbHNlID8gMCA6IGludmFyaWFudChmYWxzZSkgOiB2b2lkIDA7CiAgICAgICAgICAgICAgICByb3V0ZXIuZmV0Y2goZmV0Y2hlcktleSwgcm91dGVJZCwgaHJlZik7CiAgICAgICAgICAgICAgfSksX1JlYWN0JHVzZVN0YXRlMTIgPSBfc2xpY2VkVG9BcnJheTIoX1JlYWN0JHVzZVN0YXRlMTEsIDEpLGxvYWQgPSBfUmVhY3QkdXNlU3RhdGUxMlswXTsKICAgICAgICAgICAgdmFyIHN1Ym1pdCA9IHVzZVN1Ym1pdEltcGwoZmV0Y2hlcktleSwgcm91dGVJZCk7CiAgICAgICAgICAgIHZhciBmZXRjaGVyID0gcm91dGVyLmdldEZldGNoZXIoZmV0Y2hlcktleSk7CiAgICAgICAgICAgIHZhciBmZXRjaGVyV2l0aENvbXBvbmVudHMgPSBSZWFjdC51c2VNZW1vKCgpID0+IHJlYWN0X3JvdXRlcl9kb21fZGlzdF9leHRlbmRzKHsKICAgICAgICAgICAgICBGb3JtOiBGb3JtLAogICAgICAgICAgICAgIHN1Ym1pdDogc3VibWl0LAogICAgICAgICAgICAgIGxvYWQ6IGxvYWQKICAgICAgICAgICAgfSwgZmV0Y2hlciksIFtmZXRjaGVyLCBGb3JtLCBzdWJtaXQsIGxvYWRdKTsKICAgICAgICAgICAgUmVhY3QudXNlRWZmZWN0KCgpID0+IHsKICAgICAgICAgICAgICAvLyBJcyB0aGlzIGJ1c3RlZCB3aGVuIHRoZSBSZWFjdCB0ZWFtIGdldHMgcmVhbCB3ZWlyZCBhbmQgY2FsbHMgZWZmZWN0cwogICAgICAgICAgICAgIC8vIHR3aWNlIG9uIG1vdW50PyAgV2UgcmVhbGx5IGp1c3QgbmVlZCB0byBnYXJiYWdlIGNvbGxlY3QgaGVyZSB3aGVuIHRoaXMKICAgICAgICAgICAgICAvLyBmZXRjaGVyIGlzIG5vIGxvbmdlciBhcm91bmQuCiAgICAgICAgICAgICAgcmV0dXJuICgpID0+IHsKICAgICAgICAgICAgICAgIGlmICghcm91dGVyKSB7CiAgICAgICAgICAgICAgICAgIGNvbnNvbGUud2FybigiTm8gZmV0Y2hlciBhdmFpbGFibGUgdG8gY2xlYW4gdXAgZnJvbSB1c2VGZXRjaGVyKCkiKTsKICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHJvdXRlci5kZWxldGVGZXRjaGVyKGZldGNoZXJLZXkpOwogICAgICAgICAgICAgIH07CiAgICAgICAgICAgIH0sIFtyb3V0ZXIsIGZldGNoZXJLZXldKTsKICAgICAgICAgICAgcmV0dXJuIGZldGNoZXJXaXRoQ29tcG9uZW50czsKICAgICAgICAgIH0KICAgICAgICAgIC8qKgogICAgICAgICAgICogUHJvdmlkZXMgYWxsIGZldGNoZXJzIGN1cnJlbnRseSBvbiB0aGUgcGFnZS4gVXNlZnVsIGZvciBsYXlvdXRzIGFuZCBwYXJlbnQKICAgICAgICAgICAqIHJvdXRlcyB0aGF0IG5lZWQgdG8gcHJvdmlkZSBwZW5kaW5nL29wdGltaXN0aWMgVUkgcmVnYXJkaW5nIHRoZSBmZXRjaC4KICAgICAgICAgICAqLwoKICAgICAgICAgIGZ1bmN0aW9uIHVzZUZldGNoZXJzKCkgewogICAgICAgICAgICB2YXIgc3RhdGUgPSBkaXN0X3VzZURhdGFSb3V0ZXJTdGF0ZShkaXN0X0RhdGFSb3V0ZXJTdGF0ZUhvb2suVXNlRmV0Y2hlcnMpOwogICAgICAgICAgICByZXR1cm4gX3RvQ29uc3VtYWJsZUFycmF5KHN0YXRlLmZldGNoZXJzLnZhbHVlcygpKTsKICAgICAgICAgIH0KICAgICAgICAgIHZhciBTQ1JPTExfUkVTVE9SQVRJT05fU1RPUkFHRV9LRVkgPSAicmVhY3Qtcm91dGVyLXNjcm9sbC1wb3NpdGlvbnMiOwogICAgICAgICAgdmFyIHNhdmVkU2Nyb2xsUG9zaXRpb25zID0ge307CiAgICAgICAgICAvKioKICAgICAgICAgICAqIFdoZW4gcmVuZGVyZWQgaW5zaWRlIGEgUm91dGVyUHJvdmlkZXIsIHdpbGwgcmVzdG9yZSBzY3JvbGwgcG9zaXRpb25zIG9uIG5hdmlnYXRpb25zCiAgICAgICAgICAgKi8KCiAgICAgICAgICBmdW5jdGlvbiB1c2VTY3JvbGxSZXN0b3JhdGlvbihfdGVtcDMpIHsKICAgICAgICAgICAgdmFyIF9yZWYzNCA9CgoKICAgICAgICAgICAgICBfdGVtcDMgPT09IHZvaWQgMCA/IHt9IDogX3RlbXAzLGdldEtleSA9IF9yZWYzNC5nZXRLZXksc3RvcmFnZUtleSA9IF9yZWYzNC5zdG9yYWdlS2V5OwogICAgICAgICAgICB2YXIgX2Rpc3RfdXNlRGF0YVJvdXRlckNvMyA9CgogICAgICAgICAgICAgIGRpc3RfdXNlRGF0YVJvdXRlckNvbnRleHQoZGlzdF9EYXRhUm91dGVySG9vay5Vc2VTY3JvbGxSZXN0b3JhdGlvbikscm91dGVyID0gX2Rpc3RfdXNlRGF0YVJvdXRlckNvMy5yb3V0ZXI7CiAgICAgICAgICAgIHZhciBfZGlzdF91c2VEYXRhUm91dGVyU3QgPQoKCiAgICAgICAgICAgICAgZGlzdF91c2VEYXRhUm91dGVyU3RhdGUoZGlzdF9EYXRhUm91dGVyU3RhdGVIb29rLlVzZVNjcm9sbFJlc3RvcmF0aW9uKSxyZXN0b3JlU2Nyb2xsUG9zaXRpb24gPSBfZGlzdF91c2VEYXRhUm91dGVyU3QucmVzdG9yZVNjcm9sbFBvc2l0aW9uLHByZXZlbnRTY3JvbGxSZXNldCA9IF9kaXN0X3VzZURhdGFSb3V0ZXJTdC5wcmV2ZW50U2Nyb2xsUmVzZXQ7CiAgICAgICAgICAgIHZhciBsb2NhdGlvbiA9IHVzZUxvY2F0aW9uKCk7CiAgICAgICAgICAgIHZhciBtYXRjaGVzID0gdXNlTWF0Y2hlcygpOwogICAgICAgICAgICB2YXIgbmF2aWdhdGlvbiA9IHVzZU5hdmlnYXRpb24oKTsgLy8gVHJpZ2dlciBtYW51YWwgc2Nyb2xsIHJlc3RvcmF0aW9uIHdoaWxlIHdlJ3JlIGFjdGl2ZQoKICAgICAgICAgICAgUmVhY3QudXNlRWZmZWN0KCgpID0+IHsKICAgICAgICAgICAgICB3aW5kb3cuaGlzdG9yeS5zY3JvbGxSZXN0b3JhdGlvbiA9ICJtYW51YWwiOwogICAgICAgICAgICAgIHJldHVybiAoKSA9PiB7CiAgICAgICAgICAgICAgICB3aW5kb3cuaGlzdG9yeS5zY3JvbGxSZXN0b3JhdGlvbiA9ICJhdXRvIjsKICAgICAgICAgICAgICB9OwogICAgICAgICAgICB9LCBbXSk7IC8vIFNhdmUgcG9zaXRpb25zIG9uIHVubG9hZAoKICAgICAgICAgICAgdXNlQmVmb3JlVW5sb2FkKFJlYWN0LnVzZUNhbGxiYWNrKCgpID0+IHsKICAgICAgICAgICAgICBpZiAobmF2aWdhdGlvbi5zdGF0ZSA9PT0gImlkbGUiKSB7CiAgICAgICAgICAgICAgICB2YXIga2V5ID0gKGdldEtleSA/IGdldEtleShsb2NhdGlvbiwgbWF0Y2hlcykgOiBudWxsKSB8fCBsb2NhdGlvbi5rZXk7CiAgICAgICAgICAgICAgICBzYXZlZFNjcm9sbFBvc2l0aW9uc1trZXldID0gd2luZG93LnNjcm9sbFk7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBzZXNzaW9uU3RvcmFnZS5zZXRJdGVtKHN0b3JhZ2VLZXkgfHwgU0NST0xMX1JFU1RPUkFUSU9OX1NUT1JBR0VfS0VZLCBKU09OLnN0cmluZ2lmeShzYXZlZFNjcm9sbFBvc2l0aW9ucykpOwogICAgICAgICAgICAgIHdpbmRvdy5oaXN0b3J5LnNjcm9sbFJlc3RvcmF0aW9uID0gImF1dG8iOwogICAgICAgICAgICB9LCBbc3RvcmFnZUtleSwgZ2V0S2V5LCBuYXZpZ2F0aW9uLnN0YXRlLCBsb2NhdGlvbiwgbWF0Y2hlc10pKTsgLy8gUmVhZCBpbiBhbnkgc2F2ZWQgc2Nyb2xsIGxvY2F0aW9ucwoKICAgICAgICAgICAgaWYgKHR5cGVvZiBkb2N1bWVudCAhPT0gInVuZGVmaW5lZCIpIHsKICAgICAgICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgcmVhY3QtaG9va3MvcnVsZXMtb2YtaG9va3MKICAgICAgICAgICAgICBSZWFjdC51c2VMYXlvdXRFZmZlY3QoKCkgPT4gewogICAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgICAgdmFyIHNlc3Npb25Qb3NpdGlvbnMgPSBzZXNzaW9uU3RvcmFnZS5nZXRJdGVtKHN0b3JhZ2VLZXkgfHwgU0NST0xMX1JFU1RPUkFUSU9OX1NUT1JBR0VfS0VZKTsKCiAgICAgICAgICAgICAgICAgIGlmIChzZXNzaW9uUG9zaXRpb25zKSB7CiAgICAgICAgICAgICAgICAgICAgc2F2ZWRTY3JvbGxQb3NpdGlvbnMgPSBKU09OLnBhcnNlKHNlc3Npb25Qb3NpdGlvbnMpOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgICAgICAgICAgIC8vIG5vLW9wLCB1c2UgZGVmYXVsdCBlbXB0eSBvYmplY3QKICAgICAgICAgICAgICAgIH19LCBbc3RvcmFnZUtleV0pOyAvLyBFbmFibGUgc2Nyb2xsIHJlc3RvcmF0aW9uIGluIHRoZSByb3V0ZXIKICAgICAgICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgcmVhY3QtaG9va3MvcnVsZXMtb2YtaG9va3MKCiAgICAgICAgICAgICAgUmVhY3QudXNlTGF5b3V0RWZmZWN0KCgpID0+IHsKICAgICAgICAgICAgICAgIHZhciBkaXNhYmxlU2Nyb2xsUmVzdG9yYXRpb24gPSByb3V0ZXIgPT0gbnVsbCA/IHZvaWQgMCA6IHJvdXRlci5lbmFibGVTY3JvbGxSZXN0b3JhdGlvbihzYXZlZFNjcm9sbFBvc2l0aW9ucywgKCkgPT4gd2luZG93LnNjcm9sbFksIGdldEtleSk7CiAgICAgICAgICAgICAgICByZXR1cm4gKCkgPT4gZGlzYWJsZVNjcm9sbFJlc3RvcmF0aW9uICYmIGRpc2FibGVTY3JvbGxSZXN0b3JhdGlvbigpOwogICAgICAgICAgICAgIH0sIFtyb3V0ZXIsIGdldEtleV0pOyAvLyBSZXN0b3JlIHNjcm9sbGluZyB3aGVuIHN0YXRlLnJlc3RvcmVTY3JvbGxQb3NpdGlvbiBjaGFuZ2VzCiAgICAgICAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIHJlYWN0LWhvb2tzL3J1bGVzLW9mLWhvb2tzCgogICAgICAgICAgICAgIFJlYWN0LnVzZUxheW91dEVmZmVjdCgoKSA9PiB7CiAgICAgICAgICAgICAgICAvLyBFeHBsaWNpdCBmYWxzZSBtZWFucyBkb24ndCBkbyBhbnl0aGluZyAodXNlZCBmb3Igc3VibWlzc2lvbnMpCiAgICAgICAgICAgICAgICBpZiAocmVzdG9yZVNjcm9sbFBvc2l0aW9uID09PSBmYWxzZSkgewogICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICB9IC8vIGJlZW4gaGVyZSBiZWZvcmUsIHNjcm9sbCB0byBpdAoKCiAgICAgICAgICAgICAgICBpZiAodHlwZW9mIHJlc3RvcmVTY3JvbGxQb3NpdGlvbiA9PT0gIm51bWJlciIpIHsKICAgICAgICAgICAgICAgICAgd2luZG93LnNjcm9sbFRvKDAsIHJlc3RvcmVTY3JvbGxQb3NpdGlvbik7CiAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgIH0gLy8gdHJ5IHRvIHNjcm9sbCB0byB0aGUgaGFzaAoKCiAgICAgICAgICAgICAgICBpZiAobG9jYXRpb24uaGFzaCkgewogICAgICAgICAgICAgICAgICB2YXIgZWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChsb2NhdGlvbi5oYXNoLnNsaWNlKDEpKTsKCiAgICAgICAgICAgICAgICAgIGlmIChlbCkgewogICAgICAgICAgICAgICAgICAgIGVsLnNjcm9sbEludG9WaWV3KCk7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9IC8vIERvbid0IHJlc2V0IGlmIHRoaXMgbmF2aWdhdGlvbiBvcHRlZCBvdXQKCgogICAgICAgICAgICAgICAgaWYgKHByZXZlbnRTY3JvbGxSZXNldCA9PT0gdHJ1ZSkgewogICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICB9IC8vIG90aGVyd2lzZSBnbyB0byB0aGUgdG9wIG9uIG5ldyBsb2NhdGlvbnMKCgogICAgICAgICAgICAgICAgd2luZG93LnNjcm9sbFRvKDAsIDApOwogICAgICAgICAgICAgIH0sIFtsb2NhdGlvbiwgcmVzdG9yZVNjcm9sbFBvc2l0aW9uLCBwcmV2ZW50U2Nyb2xsUmVzZXRdKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgLyoqCiAgICAgICAgICAgKiBTZXR1cCBhIGNhbGxiYWNrIHRvIGJlIGZpcmVkIG9uIHRoZSB3aW5kb3cncyBgYmVmb3JldW5sb2FkYCBldmVudC4gVGhpcyBpcwogICAgICAgICAgICogdXNlZnVsIGZvciBzYXZpbmcgc29tZSBkYXRhIHRvIGB3aW5kb3cubG9jYWxTdG9yYWdlYCBqdXN0IGJlZm9yZSB0aGUgcGFnZQogICAgICAgICAgICogcmVmcmVzaGVzLgogICAgICAgICAgICoKICAgICAgICAgICAqIE5vdGU6IFRoZSBgY2FsbGJhY2tgIGFyZ3VtZW50IHNob3VsZCBiZSBhIGZ1bmN0aW9uIGNyZWF0ZWQgd2l0aAogICAgICAgICAgICogYFJlYWN0LnVzZUNhbGxiYWNrKClgLgogICAgICAgICAgICovCgoKICAgICAgICAgIGZ1bmN0aW9uIHVzZUJlZm9yZVVubG9hZChjYWxsYmFjaywgb3B0aW9ucykgewogICAgICAgICAgICB2YXIgX3JlZjM1ID0KCiAgICAgICAgICAgICAgb3B0aW9ucyB8fCB7fSxjYXB0dXJlID0gX3JlZjM1LmNhcHR1cmU7CiAgICAgICAgICAgIFJlYWN0LnVzZUVmZmVjdCgoKSA9PiB7CiAgICAgICAgICAgICAgdmFyIG9wdHMgPSBjYXB0dXJlICE9IG51bGwgPyB7CiAgICAgICAgICAgICAgICBjYXB0dXJlOiBjYXB0dXJlCiAgICAgICAgICAgICAgfSA6IHVuZGVmaW5lZDsKICAgICAgICAgICAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigiYmVmb3JldW5sb2FkIiwgY2FsbGJhY2ssIG9wdHMpOwogICAgICAgICAgICAgIHJldHVybiAoKSA9PiB7CiAgICAgICAgICAgICAgICB3aW5kb3cucmVtb3ZlRXZlbnRMaXN0ZW5lcigiYmVmb3JldW5sb2FkIiwgY2FsbGJhY2ssIG9wdHMpOwogICAgICAgICAgICAgIH07CiAgICAgICAgICAgIH0sIFtjYWxsYmFjaywgY2FwdHVyZV0pOwogICAgICAgICAgfQogICAgICAgICAgLyoqCiAgICAgICAgICAgKiBXcmFwcGVyIGFyb3VuZCB1c2VCbG9ja2VyIHRvIHNob3cgYSB3aW5kb3cuY29uZmlybSBwcm9tcHQgdG8gdXNlcnMgaW5zdGVhZAogICAgICAgICAgICogb2YgYnVpbGRpbmcgYSBjdXN0b20gVUkgd2l0aCB1c2VCbG9ja2VyLgogICAgICAgICAgICoKICAgICAgICAgICAqIFdhcm5pbmc6IFRoaXMgaGFzICphIGxvdCBvZiByb3VnaCBlZGdlcyogYW5kIGJlaGF2ZXMgdmVyeSBkaWZmZXJlbnRseSAoYW5kCiAgICAgICAgICAgKiB2ZXJ5IGluY29ycmVjdGx5IGluIHNvbWUgY2FzZXMpIGFjcm9zcyBicm93c2VycyBpZiB1c2VyIGNsaWNrIGFkZGl0aW9uCiAgICAgICAgICAgKiBiYWNrL2ZvcndhcmQgbmF2aWdhdGlvbnMgd2hpbGUgdGhlIGNvbmZpcm0gaXMgb3Blbi4gIFVzZSBhdCB5b3VyIG93biByaXNrLgogICAgICAgICAgICovCgogICAgICAgICAgZnVuY3Rpb24gdXNlUHJvbXB0KF9yZWY4KSB7CiAgICAgICAgICAgIHZhcgogICAgICAgICAgICAgIHdoZW4gPQoKICAgICAgICAgICAgICBfcmVmOC53aGVuLG1lc3NhZ2UgPSBfcmVmOC5tZXNzYWdlOwogICAgICAgICAgICB2YXIgYmxvY2tlciA9IHVuc3RhYmxlX3VzZUJsb2NrZXIod2hlbik7CiAgICAgICAgICAgIFJlYWN0LnVzZUVmZmVjdCgoKSA9PiB7CiAgICAgICAgICAgICAgaWYgKGJsb2NrZXIuc3RhdGUgPT09ICJibG9ja2VkIiAmJiAhd2hlbikgewogICAgICAgICAgICAgICAgYmxvY2tlci5yZXNldCgpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwgW2Jsb2NrZXIsIHdoZW5dKTsKICAgICAgICAgICAgUmVhY3QudXNlRWZmZWN0KCgpID0+IHsKICAgICAgICAgICAgICBpZiAoYmxvY2tlci5zdGF0ZSA9PT0gImJsb2NrZWQiKSB7CiAgICAgICAgICAgICAgICB2YXIgcHJvY2VlZCA9IHdpbmRvdy5jb25maXJtKG1lc3NhZ2UpOwoKICAgICAgICAgICAgICAgIGlmIChwcm9jZWVkKSB7CiAgICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoYmxvY2tlci5wcm9jZWVkLCAwKTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgIGJsb2NrZXIucmVzZXQoKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sIFtibG9ja2VyLCBtZXNzYWdlXSk7CiAgICAgICAgICB9CiAgICAgICAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwogICAgICAgICAgLy8jcmVnaW9uIFV0aWxzCiAgICAgICAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwoKICAgICAgICAgIGZ1bmN0aW9uIGRpc3Rfd2FybmluZyhjb25kLCBtZXNzYWdlKSB7CiAgICAgICAgICAgIGlmICghY29uZCkgewogICAgICAgICAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBuby1jb25zb2xlCiAgICAgICAgICAgICAgaWYgKHR5cGVvZiBjb25zb2xlICE9PSAidW5kZWZpbmVkIikgY29uc29sZS53YXJuKG1lc3NhZ2UpOwoKICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgLy8gV2VsY29tZSB0byBkZWJ1Z2dpbmcgUmVhY3QgUm91dGVyIQogICAgICAgICAgICAgICAgLy8KICAgICAgICAgICAgICAgIC8vIFRoaXMgZXJyb3IgaXMgdGhyb3duIGFzIGEgY29udmVuaWVuY2Ugc28geW91IGNhbiBtb3JlIGVhc2lseQogICAgICAgICAgICAgICAgLy8gZmluZCB0aGUgc291cmNlIGZvciBhIHdhcm5pbmcgdGhhdCBhcHBlYXJzIGluIHRoZSBjb25zb2xlIGJ5CiAgICAgICAgICAgICAgICAvLyBlbmFibGluZyAicGF1c2Ugb24gZXhjZXB0aW9ucyIgaW4geW91ciBKYXZhU2NyaXB0IGRlYnVnZ2VyLgogICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKG1lc3NhZ2UpOyAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tZW1wdHkKICAgICAgICAgICAgICB9IGNhdGNoIChlKSB7fQogICAgICAgICAgICB9CiAgICAgICAgICB9IC8vI2VuZHJlZ2lvbgoKCgoKICAgICAgICAgIDsgLy8gQ09OQ0FURU5BVEVEIE1PRFVMRTogLi9zcmMvcmVsYXkvY29tcG9uZW50cy9MYXlvdXQudHN4CgoKCgogICAgICAgICAgdmFyIExheW91dCA9IGZ1bmN0aW9uIExheW91dChfcmVmKSB7dmFyIHBhZ2VzID0gX3JlZi5wYWdlczsKICAgICAgICAgICAgdmFyIG91dGxldCA9IC8qI19fUFVSRV9fKi8KICAgICAgICAgICAgcmVhY3QuY3JlYXRlRWxlbWVudChyZWFjdC5GcmFnbWVudCwgbnVsbCwgLyojX19QVVJFX18qLwogICAgICAgICAgICByZWFjdC5jcmVhdGVFbGVtZW50KCJkaXYiLCB7IGlkOiAibm90aWZpY2F0aW9uc0NvbnRhaW5lciIgfSksIC8qI19fUFVSRV9fKi8KICAgICAgICAgICAgcmVhY3QuY3JlYXRlRWxlbWVudCgiZGl2IiwgeyBpZDogInJlbGF5Q29udGFpbmVyIiB9LCAvKiNfX1BVUkVfXyovCiAgICAgICAgICAgIHJlYWN0LmNyZWF0ZUVsZW1lbnQoT3V0bGV0LCBudWxsKSkpOwoKCgoKICAgICAgICAgICAgaWYgKHBhZ2VzLmxlbmd0aCA8PSAxKSB7CiAgICAgICAgICAgICAgcmV0dXJuIG91dGxldDsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuIC8qI19fUFVSRV9fKi8oCiAgICAgICAgICAgICAgcmVhY3QuY3JlYXRlRWxlbWVudChyZWFjdC5GcmFnbWVudCwgbnVsbCwKICAgICAgICAgICAgICAiICIsIC8qI19fUFVSRV9fKi8KICAgICAgICAgICAgICByZWFjdC5jcmVhdGVFbGVtZW50KCJuYXYiLCBudWxsLCAvKiNfX1BVUkVfXyovCiAgICAgICAgICAgICAgcmVhY3QuY3JlYXRlRWxlbWVudCgiZGl2IiwgeyBjbGFzc05hbWU6ICJ0b3BCYXIiIH0sCiAgICAgICAgICAgICAgIiAiLAogICAgICAgICAgICAgIHBhZ2VzLm1hcChmdW5jdGlvbiAocCwgaW5kZXgpIHtyZXR1cm4gLyojX19QVVJFX18qLygKICAgICAgICAgICAgICAgICAgcmVhY3QuY3JlYXRlRWxlbWVudCgiZGl2IiwgeyBrZXk6IGluZGV4LCBjbGFzc05hbWU6ICJ0YWJFbnRyeSIgfSwgLyojX19QVVJFX18qLwogICAgICAgICAgICAgICAgICByZWFjdC5jcmVhdGVFbGVtZW50KE5hdkxpbmssIHsgdG86ICIvIiArIHAuZmlsZSB9LCBwLnBhZ2UpLCAiICIpKTt9KSkpLAoKCgogICAgICAgICAgICAgICIgIiwKICAgICAgICAgICAgICBvdXRsZXQpKTsKCgogICAgICAgICAgfTsKCiAgICAgICAgICAvKiBoYXJtb255IGRlZmF1bHQgZXhwb3J0ICovdmFyIGNvbXBvbmVudHNfTGF5b3V0ID0gTGF5b3V0OwogICAgICAgICAgOyAvLyBDT05DQVRFTkFURUQgTU9EVUxFOiAuL3NyYy9yZWxheS9hcGkvQXBpUmVxdWVzdC50c3gKICAgICAgICAgIGZ1bmN0aW9uIF90eXBlb2Yob2JqKSB7IkBiYWJlbC9oZWxwZXJzIC0gdHlwZW9mIjtyZXR1cm4gX3R5cGVvZiA9ICJmdW5jdGlvbiIgPT0gdHlwZW9mIFN5bWJvbCAmJiAic3ltYm9sIiA9PSB0eXBlb2YgU3ltYm9sLml0ZXJhdG9yID8gZnVuY3Rpb24gKG9iaikge3JldHVybiB0eXBlb2Ygb2JqO30gOiBmdW5jdGlvbiAob2JqKSB7cmV0dXJuIG9iaiAmJiAiZnVuY3Rpb24iID09IHR5cGVvZiBTeW1ib2wgJiYgb2JqLmNvbnN0cnVjdG9yID09PSBTeW1ib2wgJiYgb2JqICE9PSBTeW1ib2wucHJvdG90eXBlID8gInN5bWJvbCIgOiB0eXBlb2Ygb2JqO30sIF90eXBlb2Yob2JqKTt9ZnVuY3Rpb24gX3JlZ2VuZXJhdG9yUnVudGltZSgpIHsidXNlIHN0cmljdCI7CiAgICAgICAgICAgIC8qISByZWdlbmVyYXRvci1ydW50aW1lIC0tIENvcHlyaWdodCAoYykgMjAxNC1wcmVzZW50LCBGYWNlYm9vaywgSW5jLiAtLSBsaWNlbnNlIChNSVQpOiBodHRwczovL2dpdGh1Yi5jb20vZmFjZWJvb2svcmVnZW5lcmF0b3IvYmxvYi9tYWluL0xJQ0VOU0UgKi9fcmVnZW5lcmF0b3JSdW50aW1lID0gZnVuY3Rpb24gX3JlZ2VuZXJhdG9yUnVudGltZSgpIHtyZXR1cm4gZXhwb3J0czt9O3ZhciBleHBvcnRzID0ge30sT3AgPSBPYmplY3QucHJvdG90eXBlLGhhc093biA9IE9wLmhhc093blByb3BlcnR5LGRlZmluZVByb3BlcnR5ID0gT2JqZWN0LmRlZmluZVByb3BlcnR5IHx8IGZ1bmN0aW9uIChvYmosIGtleSwgZGVzYykge29ialtrZXldID0gZGVzYy52YWx1ZTt9LCRTeW1ib2wgPSAiZnVuY3Rpb24iID09IHR5cGVvZiBTeW1ib2wgPyBTeW1ib2wgOiB7fSxpdGVyYXRvclN5bWJvbCA9ICRTeW1ib2wuaXRlcmF0b3IgfHwgIkBAaXRlcmF0b3IiLGFzeW5jSXRlcmF0b3JTeW1ib2wgPSAkU3ltYm9sLmFzeW5jSXRlcmF0b3IgfHwgIkBAYXN5bmNJdGVyYXRvciIsdG9TdHJpbmdUYWdTeW1ib2wgPSAkU3ltYm9sLnRvU3RyaW5nVGFnIHx8ICJAQHRvU3RyaW5nVGFnIjtmdW5jdGlvbiBkZWZpbmUob2JqLCBrZXksIHZhbHVlKSB7cmV0dXJuIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvYmosIGtleSwgeyB2YWx1ZTogdmFsdWUsIGVudW1lcmFibGU6ICEwLCBjb25maWd1cmFibGU6ICEwLCB3cml0YWJsZTogITAgfSksIG9ialtrZXldO310cnkge2RlZmluZSh7fSwgIiIpO30gY2F0Y2ggKGVycikge2RlZmluZSA9IGZ1bmN0aW9uIGRlZmluZShvYmosIGtleSwgdmFsdWUpIHtyZXR1cm4gb2JqW2tleV0gPSB2YWx1ZTt9O31mdW5jdGlvbiB3cmFwKGlubmVyRm4sIG91dGVyRm4sIHNlbGYsIHRyeUxvY3NMaXN0KSB7dmFyIHByb3RvR2VuZXJhdG9yID0gb3V0ZXJGbiAmJiBvdXRlckZuLnByb3RvdHlwZSBpbnN0YW5jZW9mIEdlbmVyYXRvciA/IG91dGVyRm4gOiBHZW5lcmF0b3IsZ2VuZXJhdG9yID0gT2JqZWN0LmNyZWF0ZShwcm90b0dlbmVyYXRvci5wcm90b3R5cGUpLGNvbnRleHQgPSBuZXcgQ29udGV4dCh0cnlMb2NzTGlzdCB8fCBbXSk7cmV0dXJuIGRlZmluZVByb3BlcnR5KGdlbmVyYXRvciwgIl9pbnZva2UiLCB7IHZhbHVlOiBtYWtlSW52b2tlTWV0aG9kKGlubmVyRm4sIHNlbGYsIGNvbnRleHQpIH0pLCBnZW5lcmF0b3I7fWZ1bmN0aW9uIHRyeUNhdGNoKGZuLCBvYmosIGFyZykge3RyeSB7cmV0dXJuIHsgdHlwZTogIm5vcm1hbCIsIGFyZzogZm4uY2FsbChvYmosIGFyZykgfTt9IGNhdGNoIChlcnIpIHtyZXR1cm4geyB0eXBlOiAidGhyb3ciLCBhcmc6IGVyciB9O319ZXhwb3J0cy53cmFwID0gd3JhcDt2YXIgQ29udGludWVTZW50aW5lbCA9IHt9O2Z1bmN0aW9uIEdlbmVyYXRvcigpIHt9ZnVuY3Rpb24gR2VuZXJhdG9yRnVuY3Rpb24oKSB7fWZ1bmN0aW9uIEdlbmVyYXRvckZ1bmN0aW9uUHJvdG90eXBlKCkge312YXIgSXRlcmF0b3JQcm90b3R5cGUgPSB7fTtkZWZpbmUoSXRlcmF0b3JQcm90b3R5cGUsIGl0ZXJhdG9yU3ltYm9sLCBmdW5jdGlvbiAoKSB7cmV0dXJuIHRoaXM7fSk7dmFyIGdldFByb3RvID0gT2JqZWN0LmdldFByb3RvdHlwZU9mLE5hdGl2ZUl0ZXJhdG9yUHJvdG90eXBlID0gZ2V0UHJvdG8gJiYgZ2V0UHJvdG8oZ2V0UHJvdG8odmFsdWVzKFtdKSkpO05hdGl2ZUl0ZXJhdG9yUHJvdG90eXBlICYmIE5hdGl2ZUl0ZXJhdG9yUHJvdG90eXBlICE9PSBPcCAmJiBoYXNPd24uY2FsbChOYXRpdmVJdGVyYXRvclByb3RvdHlwZSwgaXRlcmF0b3JTeW1ib2wpICYmIChJdGVyYXRvclByb3RvdHlwZSA9IE5hdGl2ZUl0ZXJhdG9yUHJvdG90eXBlKTt2YXIgR3AgPSBHZW5lcmF0b3JGdW5jdGlvblByb3RvdHlwZS5wcm90b3R5cGUgPSBHZW5lcmF0b3IucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZShJdGVyYXRvclByb3RvdHlwZSk7ZnVuY3Rpb24gZGVmaW5lSXRlcmF0b3JNZXRob2RzKHByb3RvdHlwZSkge1sibmV4dCIsICJ0aHJvdyIsICJyZXR1cm4iXS5mb3JFYWNoKGZ1bmN0aW9uIChtZXRob2QpIHtkZWZpbmUocHJvdG90eXBlLCBtZXRob2QsIGZ1bmN0aW9uIChhcmcpIHtyZXR1cm4gdGhpcy5faW52b2tlKG1ldGhvZCwgYXJnKTt9KTt9KTt9ZnVuY3Rpb24gQXN5bmNJdGVyYXRvcihnZW5lcmF0b3IsIFByb21pc2VJbXBsKSB7ZnVuY3Rpb24gaW52b2tlKG1ldGhvZCwgYXJnLCByZXNvbHZlLCByZWplY3QpIHt2YXIgcmVjb3JkID0gdHJ5Q2F0Y2goZ2VuZXJhdG9yW21ldGhvZF0sIGdlbmVyYXRvciwgYXJnKTtpZiAoInRocm93IiAhPT0gcmVjb3JkLnR5cGUpIHt2YXIgcmVzdWx0ID0gcmVjb3JkLmFyZyx2YWx1ZSA9IHJlc3VsdC52YWx1ZTtyZXR1cm4gdmFsdWUgJiYgIm9iamVjdCIgPT0gX3R5cGVvZih2YWx1ZSkgJiYgaGFzT3duLmNhbGwodmFsdWUsICJfX2F3YWl0IikgPyBQcm9taXNlSW1wbC5yZXNvbHZlKHZhbHVlLl9fYXdhaXQpLnRoZW4oZnVuY3Rpb24gKHZhbHVlKSB7aW52b2tlKCJuZXh0IiwgdmFsdWUsIHJlc29sdmUsIHJlamVjdCk7fSwgZnVuY3Rpb24gKGVycikge2ludm9rZSgidGhyb3ciLCBlcnIsIHJlc29sdmUsIHJlamVjdCk7fSkgOiBQcm9taXNlSW1wbC5yZXNvbHZlKHZhbHVlKS50aGVuKGZ1bmN0aW9uICh1bndyYXBwZWQpIHtyZXN1bHQudmFsdWUgPSB1bndyYXBwZWQsIHJlc29sdmUocmVzdWx0KTt9LCBmdW5jdGlvbiAoZXJyb3IpIHtyZXR1cm4gaW52b2tlKCJ0aHJvdyIsIGVycm9yLCByZXNvbHZlLCByZWplY3QpO30pO31yZWplY3QocmVjb3JkLmFyZyk7fXZhciBwcmV2aW91c1Byb21pc2U7ZGVmaW5lUHJvcGVydHkodGhpcywgIl9pbnZva2UiLCB7IHZhbHVlOiBmdW5jdGlvbiB2YWx1ZShtZXRob2QsIGFyZykge2Z1bmN0aW9uIGNhbGxJbnZva2VXaXRoTWV0aG9kQW5kQXJnKCkge3JldHVybiBuZXcgUHJvbWlzZUltcGwoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge2ludm9rZShtZXRob2QsIGFyZywgcmVzb2x2ZSwgcmVqZWN0KTt9KTt9cmV0dXJuIHByZXZpb3VzUHJvbWlzZSA9IHByZXZpb3VzUHJvbWlzZSA/IHByZXZpb3VzUHJvbWlzZS50aGVuKGNhbGxJbnZva2VXaXRoTWV0aG9kQW5kQXJnLCBjYWxsSW52b2tlV2l0aE1ldGhvZEFuZEFyZykgOiBjYWxsSW52b2tlV2l0aE1ldGhvZEFuZEFyZygpO30gfSk7fWZ1bmN0aW9uIG1ha2VJbnZva2VNZXRob2QoaW5uZXJGbiwgc2VsZiwgY29udGV4dCkge3ZhciBzdGF0ZSA9ICJzdXNwZW5kZWRTdGFydCI7cmV0dXJuIGZ1bmN0aW9uIChtZXRob2QsIGFyZykge2lmICgiZXhlY3V0aW5nIiA9PT0gc3RhdGUpIHRocm93IG5ldyBFcnJvcigiR2VuZXJhdG9yIGlzIGFscmVhZHkgcnVubmluZyIpO2lmICgiY29tcGxldGVkIiA9PT0gc3RhdGUpIHtpZiAoInRocm93IiA9PT0gbWV0aG9kKSB0aHJvdyBhcmc7cmV0dXJuIGRvbmVSZXN1bHQoKTt9Zm9yIChjb250ZXh0Lm1ldGhvZCA9IG1ldGhvZCwgY29udGV4dC5hcmcgPSBhcmc7Oykge3ZhciBkZWxlZ2F0ZSA9IGNvbnRleHQuZGVsZWdhdGU7aWYgKGRlbGVnYXRlKSB7dmFyIGRlbGVnYXRlUmVzdWx0ID0gbWF5YmVJbnZva2VEZWxlZ2F0ZShkZWxlZ2F0ZSwgY29udGV4dCk7aWYgKGRlbGVnYXRlUmVzdWx0KSB7aWYgKGRlbGVnYXRlUmVzdWx0ID09PSBDb250aW51ZVNlbnRpbmVsKSBjb250aW51ZTtyZXR1cm4gZGVsZWdhdGVSZXN1bHQ7fX1pZiAoIm5leHQiID09PSBjb250ZXh0Lm1ldGhvZCkgY29udGV4dC5zZW50ID0gY29udGV4dC5fc2VudCA9IGNvbnRleHQuYXJnO2Vsc2UgaWYgKCJ0aHJvdyIgPT09IGNvbnRleHQubWV0aG9kKSB7aWYgKCJzdXNwZW5kZWRTdGFydCIgPT09IHN0YXRlKSB0aHJvdyBzdGF0ZSA9ICJjb21wbGV0ZWQiLCBjb250ZXh0LmFyZztjb250ZXh0LmRpc3BhdGNoRXhjZXB0aW9uKGNvbnRleHQuYXJnKTt9IGVsc2UgInJldHVybiIgPT09IGNvbnRleHQubWV0aG9kICYmIGNvbnRleHQuYWJydXB0KCJyZXR1cm4iLCBjb250ZXh0LmFyZyk7c3RhdGUgPSAiZXhlY3V0aW5nIjt2YXIgcmVjb3JkID0gdHJ5Q2F0Y2goaW5uZXJGbiwgc2VsZiwgY29udGV4dCk7aWYgKCJub3JtYWwiID09PSByZWNvcmQudHlwZSkge2lmIChzdGF0ZSA9IGNvbnRleHQuZG9uZSA/ICJjb21wbGV0ZWQiIDogInN1c3BlbmRlZFlpZWxkIiwgcmVjb3JkLmFyZyA9PT0gQ29udGludWVTZW50aW5lbCkgY29udGludWU7cmV0dXJuIHsgdmFsdWU6IHJlY29yZC5hcmcsIGRvbmU6IGNvbnRleHQuZG9uZSB9O30idGhyb3ciID09PSByZWNvcmQudHlwZSAmJiAoc3RhdGUgPSAiY29tcGxldGVkIiwgY29udGV4dC5tZXRob2QgPSAidGhyb3ciLCBjb250ZXh0LmFyZyA9IHJlY29yZC5hcmcpO319O31mdW5jdGlvbiBtYXliZUludm9rZURlbGVnYXRlKGRlbGVnYXRlLCBjb250ZXh0KSB7dmFyIG1ldGhvZE5hbWUgPSBjb250ZXh0Lm1ldGhvZCxtZXRob2QgPSBkZWxlZ2F0ZS5pdGVyYXRvclttZXRob2ROYW1lXTtpZiAodW5kZWZpbmVkID09PSBtZXRob2QpIHJldHVybiBjb250ZXh0LmRlbGVnYXRlID0gbnVsbCwgInRocm93IiA9PT0gbWV0aG9kTmFtZSAmJiBkZWxlZ2F0ZS5pdGVyYXRvclsicmV0dXJuIl0gJiYgKGNvbnRleHQubWV0aG9kID0gInJldHVybiIsIGNvbnRleHQuYXJnID0gdW5kZWZpbmVkLCBtYXliZUludm9rZURlbGVnYXRlKGRlbGVnYXRlLCBjb250ZXh0KSwgInRocm93IiA9PT0gY29udGV4dC5tZXRob2QpIHx8ICJyZXR1cm4iICE9PSBtZXRob2ROYW1lICYmIChjb250ZXh0Lm1ldGhvZCA9ICJ0aHJvdyIsIGNvbnRleHQuYXJnID0gbmV3IFR5cGVFcnJvcigiVGhlIGl0ZXJhdG9yIGRvZXMgbm90IHByb3ZpZGUgYSAnIiArIG1ldGhvZE5hbWUgKyAiJyBtZXRob2QiKSksIENvbnRpbnVlU2VudGluZWw7dmFyIHJlY29yZCA9IHRyeUNhdGNoKG1ldGhvZCwgZGVsZWdhdGUuaXRlcmF0b3IsIGNvbnRleHQuYXJnKTtpZiAoInRocm93IiA9PT0gcmVjb3JkLnR5cGUpIHJldHVybiBjb250ZXh0Lm1ldGhvZCA9ICJ0aHJvdyIsIGNvbnRleHQuYXJnID0gcmVjb3JkLmFyZywgY29udGV4dC5kZWxlZ2F0ZSA9IG51bGwsIENvbnRpbnVlU2VudGluZWw7dmFyIGluZm8gPSByZWNvcmQuYXJnO3JldHVybiBpbmZvID8gaW5mby5kb25lID8gKGNvbnRleHRbZGVsZWdhdGUucmVzdWx0TmFtZV0gPSBpbmZvLnZhbHVlLCBjb250ZXh0Lm5leHQgPSBkZWxlZ2F0ZS5uZXh0TG9jLCAicmV0dXJuIiAhPT0gY29udGV4dC5tZXRob2QgJiYgKGNvbnRleHQubWV0aG9kID0gIm5leHQiLCBjb250ZXh0LmFyZyA9IHVuZGVmaW5lZCksIGNvbnRleHQuZGVsZWdhdGUgPSBudWxsLCBDb250aW51ZVNlbnRpbmVsKSA6IGluZm8gOiAoY29udGV4dC5tZXRob2QgPSAidGhyb3ciLCBjb250ZXh0LmFyZyA9IG5ldyBUeXBlRXJyb3IoIml0ZXJhdG9yIHJlc3VsdCBpcyBub3QgYW4gb2JqZWN0IiksIGNvbnRleHQuZGVsZWdhdGUgPSBudWxsLCBDb250aW51ZVNlbnRpbmVsKTt9ZnVuY3Rpb24gcHVzaFRyeUVudHJ5KGxvY3MpIHt2YXIgZW50cnkgPSB7IHRyeUxvYzogbG9jc1swXSB9OzEgaW4gbG9jcyAmJiAoZW50cnkuY2F0Y2hMb2MgPSBsb2NzWzFdKSwgMiBpbiBsb2NzICYmIChlbnRyeS5maW5hbGx5TG9jID0gbG9jc1syXSwgZW50cnkuYWZ0ZXJMb2MgPSBsb2NzWzNdKSwgdGhpcy50cnlFbnRyaWVzLnB1c2goZW50cnkpO31mdW5jdGlvbiByZXNldFRyeUVudHJ5KGVudHJ5KSB7dmFyIHJlY29yZCA9IGVudHJ5LmNvbXBsZXRpb24gfHwge307cmVjb3JkLnR5cGUgPSAibm9ybWFsIiwgZGVsZXRlIHJlY29yZC5hcmcsIGVudHJ5LmNvbXBsZXRpb24gPSByZWNvcmQ7fWZ1bmN0aW9uIENvbnRleHQodHJ5TG9jc0xpc3QpIHt0aGlzLnRyeUVudHJpZXMgPSBbeyB0cnlMb2M6ICJyb290IiB9XSwgdHJ5TG9jc0xpc3QuZm9yRWFjaChwdXNoVHJ5RW50cnksIHRoaXMpLCB0aGlzLnJlc2V0KCEwKTt9ZnVuY3Rpb24gdmFsdWVzKGl0ZXJhYmxlKSB7aWYgKGl0ZXJhYmxlKSB7dmFyIGl0ZXJhdG9yTWV0aG9kID0gaXRlcmFibGVbaXRlcmF0b3JTeW1ib2xdO2lmIChpdGVyYXRvck1ldGhvZCkgcmV0dXJuIGl0ZXJhdG9yTWV0aG9kLmNhbGwoaXRlcmFibGUpO2lmICgiZnVuY3Rpb24iID09IHR5cGVvZiBpdGVyYWJsZS5uZXh0KSByZXR1cm4gaXRlcmFibGU7aWYgKCFpc05hTihpdGVyYWJsZS5sZW5ndGgpKSB7dmFyIGkgPSAtMSxuZXh0ID0gZnVuY3Rpb24gbmV4dCgpIHtmb3IgKDsgKytpIDwgaXRlcmFibGUubGVuZ3RoOykgaWYgKGhhc093bi5jYWxsKGl0ZXJhYmxlLCBpKSkgcmV0dXJuIG5leHQudmFsdWUgPSBpdGVyYWJsZVtpXSwgbmV4dC5kb25lID0gITEsIG5leHQ7cmV0dXJuIG5leHQudmFsdWUgPSB1bmRlZmluZWQsIG5leHQuZG9uZSA9ICEwLCBuZXh0O307cmV0dXJuIG5leHQubmV4dCA9IG5leHQ7fX1yZXR1cm4geyBuZXh0OiBkb25lUmVzdWx0IH07fWZ1bmN0aW9uIGRvbmVSZXN1bHQoKSB7cmV0dXJuIHsgdmFsdWU6IHVuZGVmaW5lZCwgZG9uZTogITAgfTt9cmV0dXJuIEdlbmVyYXRvckZ1bmN0aW9uLnByb3RvdHlwZSA9IEdlbmVyYXRvckZ1bmN0aW9uUHJvdG90eXBlLCBkZWZpbmVQcm9wZXJ0eShHcCwgImNvbnN0cnVjdG9yIiwgeyB2YWx1ZTogR2VuZXJhdG9yRnVuY3Rpb25Qcm90b3R5cGUsIGNvbmZpZ3VyYWJsZTogITAgfSksIGRlZmluZVByb3BlcnR5KEdlbmVyYXRvckZ1bmN0aW9uUHJvdG90eXBlLCAiY29uc3RydWN0b3IiLCB7IHZhbHVlOiBHZW5lcmF0b3JGdW5jdGlvbiwgY29uZmlndXJhYmxlOiAhMCB9KSwgR2VuZXJhdG9yRnVuY3Rpb24uZGlzcGxheU5hbWUgPSBkZWZpbmUoR2VuZXJhdG9yRnVuY3Rpb25Qcm90b3R5cGUsIHRvU3RyaW5nVGFnU3ltYm9sLCAiR2VuZXJhdG9yRnVuY3Rpb24iKSwgZXhwb3J0cy5pc0dlbmVyYXRvckZ1bmN0aW9uID0gZnVuY3Rpb24gKGdlbkZ1bikge3ZhciBjdG9yID0gImZ1bmN0aW9uIiA9PSB0eXBlb2YgZ2VuRnVuICYmIGdlbkZ1bi5jb25zdHJ1Y3RvcjtyZXR1cm4gISFjdG9yICYmIChjdG9yID09PSBHZW5lcmF0b3JGdW5jdGlvbiB8fCAiR2VuZXJhdG9yRnVuY3Rpb24iID09PSAoY3Rvci5kaXNwbGF5TmFtZSB8fCBjdG9yLm5hbWUpKTt9LCBleHBvcnRzLm1hcmsgPSBmdW5jdGlvbiAoZ2VuRnVuKSB7cmV0dXJuIE9iamVjdC5zZXRQcm90b3R5cGVPZiA/IE9iamVjdC5zZXRQcm90b3R5cGVPZihnZW5GdW4sIEdlbmVyYXRvckZ1bmN0aW9uUHJvdG90eXBlKSA6IChnZW5GdW4uX19wcm90b19fID0gR2VuZXJhdG9yRnVuY3Rpb25Qcm90b3R5cGUsIGRlZmluZShnZW5GdW4sIHRvU3RyaW5nVGFnU3ltYm9sLCAiR2VuZXJhdG9yRnVuY3Rpb24iKSksIGdlbkZ1bi5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKEdwKSwgZ2VuRnVuO30sIGV4cG9ydHMuYXdyYXAgPSBmdW5jdGlvbiAoYXJnKSB7cmV0dXJuIHsgX19hd2FpdDogYXJnIH07fSwgZGVmaW5lSXRlcmF0b3JNZXRob2RzKEFzeW5jSXRlcmF0b3IucHJvdG90eXBlKSwgZGVmaW5lKEFzeW5jSXRlcmF0b3IucHJvdG90eXBlLCBhc3luY0l0ZXJhdG9yU3ltYm9sLCBmdW5jdGlvbiAoKSB7cmV0dXJuIHRoaXM7fSksIGV4cG9ydHMuQXN5bmNJdGVyYXRvciA9IEFzeW5jSXRlcmF0b3IsIGV4cG9ydHMuYXN5bmMgPSBmdW5jdGlvbiAoaW5uZXJGbiwgb3V0ZXJGbiwgc2VsZiwgdHJ5TG9jc0xpc3QsIFByb21pc2VJbXBsKSB7dm9pZCAwID09PSBQcm9taXNlSW1wbCAmJiAoUHJvbWlzZUltcGwgPSBQcm9taXNlKTt2YXIgaXRlciA9IG5ldyBBc3luY0l0ZXJhdG9yKHdyYXAoaW5uZXJGbiwgb3V0ZXJGbiwgc2VsZiwgdHJ5TG9jc0xpc3QpLCBQcm9taXNlSW1wbCk7cmV0dXJuIGV4cG9ydHMuaXNHZW5lcmF0b3JGdW5jdGlvbihvdXRlckZuKSA/IGl0ZXIgOiBpdGVyLm5leHQoKS50aGVuKGZ1bmN0aW9uIChyZXN1bHQpIHtyZXR1cm4gcmVzdWx0LmRvbmUgPyByZXN1bHQudmFsdWUgOiBpdGVyLm5leHQoKTt9KTt9LCBkZWZpbmVJdGVyYXRvck1ldGhvZHMoR3ApLCBkZWZpbmUoR3AsIHRvU3RyaW5nVGFnU3ltYm9sLCAiR2VuZXJhdG9yIiksIGRlZmluZShHcCwgaXRlcmF0b3JTeW1ib2wsIGZ1bmN0aW9uICgpIHtyZXR1cm4gdGhpczt9KSwgZGVmaW5lKEdwLCAidG9TdHJpbmciLCBmdW5jdGlvbiAoKSB7cmV0dXJuICJbb2JqZWN0IEdlbmVyYXRvcl0iO30pLCBleHBvcnRzLmtleXMgPSBmdW5jdGlvbiAodmFsKSB7dmFyIG9iamVjdCA9IE9iamVjdCh2YWwpLGtleXMgPSBbXTtmb3IgKHZhciBrZXkgaW4gb2JqZWN0KSBrZXlzLnB1c2goa2V5KTtyZXR1cm4ga2V5cy5yZXZlcnNlKCksIGZ1bmN0aW9uIG5leHQoKSB7Zm9yICg7IGtleXMubGVuZ3RoOykge3ZhciBrZXkgPSBrZXlzLnBvcCgpO2lmIChrZXkgaW4gb2JqZWN0KSByZXR1cm4gbmV4dC52YWx1ZSA9IGtleSwgbmV4dC5kb25lID0gITEsIG5leHQ7fXJldHVybiBuZXh0LmRvbmUgPSAhMCwgbmV4dDt9O30sIGV4cG9ydHMudmFsdWVzID0gdmFsdWVzLCBDb250ZXh0LnByb3RvdHlwZSA9IHsgY29uc3RydWN0b3I6IENvbnRleHQsIHJlc2V0OiBmdW5jdGlvbiByZXNldChza2lwVGVtcFJlc2V0KSB7aWYgKHRoaXMucHJldiA9IDAsIHRoaXMubmV4dCA9IDAsIHRoaXMuc2VudCA9IHRoaXMuX3NlbnQgPSB1bmRlZmluZWQsIHRoaXMuZG9uZSA9ICExLCB0aGlzLmRlbGVnYXRlID0gbnVsbCwgdGhpcy5tZXRob2QgPSAibmV4dCIsIHRoaXMuYXJnID0gdW5kZWZpbmVkLCB0aGlzLnRyeUVudHJpZXMuZm9yRWFjaChyZXNldFRyeUVudHJ5KSwgIXNraXBUZW1wUmVzZXQpIGZvciAodmFyIG5hbWUgaW4gdGhpcykgInQiID09PSBuYW1lLmNoYXJBdCgwKSAmJiBoYXNPd24uY2FsbCh0aGlzLCBuYW1lKSAmJiAhaXNOYU4oK25hbWUuc2xpY2UoMSkpICYmICh0aGlzW25hbWVdID0gdW5kZWZpbmVkKTt9LCBzdG9wOiBmdW5jdGlvbiBzdG9wKCkge3RoaXMuZG9uZSA9ICEwO3ZhciByb290UmVjb3JkID0gdGhpcy50cnlFbnRyaWVzWzBdLmNvbXBsZXRpb247aWYgKCJ0aHJvdyIgPT09IHJvb3RSZWNvcmQudHlwZSkgdGhyb3cgcm9vdFJlY29yZC5hcmc7cmV0dXJuIHRoaXMucnZhbDt9LCBkaXNwYXRjaEV4Y2VwdGlvbjogZnVuY3Rpb24gZGlzcGF0Y2hFeGNlcHRpb24oZXhjZXB0aW9uKSB7aWYgKHRoaXMuZG9uZSkgdGhyb3cgZXhjZXB0aW9uO3ZhciBjb250ZXh0ID0gdGhpcztmdW5jdGlvbiBoYW5kbGUobG9jLCBjYXVnaHQpIHtyZXR1cm4gcmVjb3JkLnR5cGUgPSAidGhyb3ciLCByZWNvcmQuYXJnID0gZXhjZXB0aW9uLCBjb250ZXh0Lm5leHQgPSBsb2MsIGNhdWdodCAmJiAoY29udGV4dC5tZXRob2QgPSAibmV4dCIsIGNvbnRleHQuYXJnID0gdW5kZWZpbmVkKSwgISFjYXVnaHQ7fWZvciAodmFyIGkgPSB0aGlzLnRyeUVudHJpZXMubGVuZ3RoIC0gMTsgaSA+PSAwOyAtLWkpIHt2YXIgZW50cnkgPSB0aGlzLnRyeUVudHJpZXNbaV0scmVjb3JkID0gZW50cnkuY29tcGxldGlvbjtpZiAoInJvb3QiID09PSBlbnRyeS50cnlMb2MpIHJldHVybiBoYW5kbGUoImVuZCIpO2lmIChlbnRyeS50cnlMb2MgPD0gdGhpcy5wcmV2KSB7dmFyIGhhc0NhdGNoID0gaGFzT3duLmNhbGwoZW50cnksICJjYXRjaExvYyIpLGhhc0ZpbmFsbHkgPSBoYXNPd24uY2FsbChlbnRyeSwgImZpbmFsbHlMb2MiKTtpZiAoaGFzQ2F0Y2ggJiYgaGFzRmluYWxseSkge2lmICh0aGlzLnByZXYgPCBlbnRyeS5jYXRjaExvYykgcmV0dXJuIGhhbmRsZShlbnRyeS5jYXRjaExvYywgITApO2lmICh0aGlzLnByZXYgPCBlbnRyeS5maW5hbGx5TG9jKSByZXR1cm4gaGFuZGxlKGVudHJ5LmZpbmFsbHlMb2MpO30gZWxzZSBpZiAoaGFzQ2F0Y2gpIHtpZiAodGhpcy5wcmV2IDwgZW50cnkuY2F0Y2hMb2MpIHJldHVybiBoYW5kbGUoZW50cnkuY2F0Y2hMb2MsICEwKTt9IGVsc2Uge2lmICghaGFzRmluYWxseSkgdGhyb3cgbmV3IEVycm9yKCJ0cnkgc3RhdGVtZW50IHdpdGhvdXQgY2F0Y2ggb3IgZmluYWxseSIpO2lmICh0aGlzLnByZXYgPCBlbnRyeS5maW5hbGx5TG9jKSByZXR1cm4gaGFuZGxlKGVudHJ5LmZpbmFsbHlMb2MpO319fX0sIGFicnVwdDogZnVuY3Rpb24gYWJydXB0KHR5cGUsIGFyZykge2ZvciAodmFyIGkgPSB0aGlzLnRyeUVudHJpZXMubGVuZ3RoIC0gMTsgaSA+PSAwOyAtLWkpIHt2YXIgZW50cnkgPSB0aGlzLnRyeUVudHJpZXNbaV07aWYgKGVudHJ5LnRyeUxvYyA8PSB0aGlzLnByZXYgJiYgaGFzT3duLmNhbGwoZW50cnksICJmaW5hbGx5TG9jIikgJiYgdGhpcy5wcmV2IDwgZW50cnkuZmluYWxseUxvYykge3ZhciBmaW5hbGx5RW50cnkgPSBlbnRyeTticmVhazt9fWZpbmFsbHlFbnRyeSAmJiAoImJyZWFrIiA9PT0gdHlwZSB8fCAiY29udGludWUiID09PSB0eXBlKSAmJiBmaW5hbGx5RW50cnkudHJ5TG9jIDw9IGFyZyAmJiBhcmcgPD0gZmluYWxseUVudHJ5LmZpbmFsbHlMb2MgJiYgKGZpbmFsbHlFbnRyeSA9IG51bGwpO3ZhciByZWNvcmQgPSBmaW5hbGx5RW50cnkgPyBmaW5hbGx5RW50cnkuY29tcGxldGlvbiA6IHt9O3JldHVybiByZWNvcmQudHlwZSA9IHR5cGUsIHJlY29yZC5hcmcgPSBhcmcsIGZpbmFsbHlFbnRyeSA/ICh0aGlzLm1ldGhvZCA9ICJuZXh0IiwgdGhpcy5uZXh0ID0gZmluYWxseUVudHJ5LmZpbmFsbHlMb2MsIENvbnRpbnVlU2VudGluZWwpIDogdGhpcy5jb21wbGV0ZShyZWNvcmQpO30sIGNvbXBsZXRlOiBmdW5jdGlvbiBjb21wbGV0ZShyZWNvcmQsIGFmdGVyTG9jKSB7aWYgKCJ0aHJvdyIgPT09IHJlY29yZC50eXBlKSB0aHJvdyByZWNvcmQuYXJnO3JldHVybiAiYnJlYWsiID09PSByZWNvcmQudHlwZSB8fCAiY29udGludWUiID09PSByZWNvcmQudHlwZSA/IHRoaXMubmV4dCA9IHJlY29yZC5hcmcgOiAicmV0dXJuIiA9PT0gcmVjb3JkLnR5cGUgPyAodGhpcy5ydmFsID0gdGhpcy5hcmcgPSByZWNvcmQuYXJnLCB0aGlzLm1ldGhvZCA9ICJyZXR1cm4iLCB0aGlzLm5leHQgPSAiZW5kIikgOiAibm9ybWFsIiA9PT0gcmVjb3JkLnR5cGUgJiYgYWZ0ZXJMb2MgJiYgKHRoaXMubmV4dCA9IGFmdGVyTG9jKSwgQ29udGludWVTZW50aW5lbDt9LCBmaW5pc2g6IGZ1bmN0aW9uIGZpbmlzaChmaW5hbGx5TG9jKSB7Zm9yICh2YXIgaSA9IHRoaXMudHJ5RW50cmllcy5sZW5ndGggLSAxOyBpID49IDA7IC0taSkge3ZhciBlbnRyeSA9IHRoaXMudHJ5RW50cmllc1tpXTtpZiAoZW50cnkuZmluYWxseUxvYyA9PT0gZmluYWxseUxvYykgcmV0dXJuIHRoaXMuY29tcGxldGUoZW50cnkuY29tcGxldGlvbiwgZW50cnkuYWZ0ZXJMb2MpLCByZXNldFRyeUVudHJ5KGVudHJ5KSwgQ29udGludWVTZW50aW5lbDt9fSwgImNhdGNoIjogZnVuY3Rpb24gX2NhdGNoKHRyeUxvYykge2ZvciAodmFyIGkgPSB0aGlzLnRyeUVudHJpZXMubGVuZ3RoIC0gMTsgaSA+PSAwOyAtLWkpIHt2YXIgZW50cnkgPSB0aGlzLnRyeUVudHJpZXNbaV07aWYgKGVudHJ5LnRyeUxvYyA9PT0gdHJ5TG9jKSB7dmFyIHJlY29yZCA9IGVudHJ5LmNvbXBsZXRpb247aWYgKCJ0aHJvdyIgPT09IHJlY29yZC50eXBlKSB7dmFyIHRocm93biA9IHJlY29yZC5hcmc7cmVzZXRUcnlFbnRyeShlbnRyeSk7fXJldHVybiB0aHJvd247fX10aHJvdyBuZXcgRXJyb3IoImlsbGVnYWwgY2F0Y2ggYXR0ZW1wdCIpO30sIGRlbGVnYXRlWWllbGQ6IGZ1bmN0aW9uIGRlbGVnYXRlWWllbGQoaXRlcmFibGUsIHJlc3VsdE5hbWUsIG5leHRMb2MpIHtyZXR1cm4gdGhpcy5kZWxlZ2F0ZSA9IHsgaXRlcmF0b3I6IHZhbHVlcyhpdGVyYWJsZSksIHJlc3VsdE5hbWU6IHJlc3VsdE5hbWUsIG5leHRMb2M6IG5leHRMb2MgfSwgIm5leHQiID09PSB0aGlzLm1ldGhvZCAmJiAodGhpcy5hcmcgPSB1bmRlZmluZWQpLCBDb250aW51ZVNlbnRpbmVsO30gfSwgZXhwb3J0czt9ZnVuY3Rpb24gYXN5bmNHZW5lcmF0b3JTdGVwKGdlbiwgcmVzb2x2ZSwgcmVqZWN0LCBfbmV4dCwgX3Rocm93LCBrZXksIGFyZykge3RyeSB7dmFyIGluZm8gPSBnZW5ba2V5XShhcmcpO3ZhciB2YWx1ZSA9IGluZm8udmFsdWU7fSBjYXRjaCAoZXJyb3IpIHtyZWplY3QoZXJyb3IpO3JldHVybjt9aWYgKGluZm8uZG9uZSkge3Jlc29sdmUodmFsdWUpO30gZWxzZSB7UHJvbWlzZS5yZXNvbHZlKHZhbHVlKS50aGVuKF9uZXh0LCBfdGhyb3cpO319ZnVuY3Rpb24gX2FzeW5jVG9HZW5lcmF0b3IoZm4pIHtyZXR1cm4gZnVuY3Rpb24gKCkge3ZhciBzZWxmID0gdGhpcyxhcmdzID0gYXJndW1lbnRzO3JldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7dmFyIGdlbiA9IGZuLmFwcGx5KHNlbGYsIGFyZ3MpO2Z1bmN0aW9uIF9uZXh0KHZhbHVlKSB7YXN5bmNHZW5lcmF0b3JTdGVwKGdlbiwgcmVzb2x2ZSwgcmVqZWN0LCBfbmV4dCwgX3Rocm93LCAibmV4dCIsIHZhbHVlKTt9ZnVuY3Rpb24gX3Rocm93KGVycikge2FzeW5jR2VuZXJhdG9yU3RlcChnZW4sIHJlc29sdmUsIHJlamVjdCwgX25leHQsIF90aHJvdywgInRocm93IiwgZXJyKTt9X25leHQodW5kZWZpbmVkKTt9KTt9O30KICAgICAgICAgIGZ1bmN0aW9uIGFkZE5vdGlmaWNhdGlvbihub3RpZmljYXRpb24pIHsKICAgICAgICAgICAgdmFyIGVsZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpOwogICAgICAgICAgICBlbGUuY2xhc3NOYW1lID0gIm5vdGlmaWNhdGlvbiI7CiAgICAgICAgICAgIGVsZS5hZGRFdmVudExpc3RlbmVyKCJhbmltYXRpb25lbmQiLCBmdW5jdGlvbiAoKSB7cmV0dXJuIGVsZS5yZW1vdmUoKTt9KTsKICAgICAgICAgICAgZWxlLmlubmVyVGV4dCA9IG5vdGlmaWNhdGlvbjsKCiAgICAgICAgICAgIHZhciBjb250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgibm90aWZpY2F0aW9uc0NvbnRhaW5lciIpOwoKICAgICAgICAgICAgaWYgKCFjb250YWluZXIpIHsKICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGNvbnRhaW5lci5hcHBlbmRDaGlsZChlbGUpOwogICAgICAgICAgfQoKICAgICAgICAgIGZ1bmN0aW9uIHNhdmVTZXR0aW5ncygKICAgICAgICAgIHByb3BlcnRpZXMpCiAgICAgICAgICB7CiAgICAgICAgICAgIHJldHVybiBzZXRQcm9wZXJ0aWVzKAogICAgICAgICAgICBwcm9wZXJ0aWVzLgogICAgICAgICAgICBmaWx0ZXIoZnVuY3Rpb24gKHApIHsKICAgICAgICAgICAgICBpZiAocC5wcmV2aW91c1ZhbHVlID09PSBwLnZhbHVlKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBwLnByZXZpb3VzVmFsdWUgPSBwLnZhbHVlOwogICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICB9KS4KICAgICAgICAgICAgbWFwKGZ1bmN0aW9uIChwcm9wKSB7cmV0dXJuIFtwcm9wLnByZWZlcmVuY2UsIHByb3AudmFsdWUudHJpbSgpXTt9KSk7CgogICAgICAgICAgfQoKICAgICAgICAgIGZ1bmN0aW9uIHNldFByb3BlcnRpZXMoCiAgICAgICAgICBwcm9wZXJ0aWVzKQogICAgICAgICAgewogICAgICAgICAgICByZXR1cm4gcnVuUmVsYXkoInNldFByb3BlcnRpZXMiLCBKU09OLnN0cmluZ2lmeShwcm9wZXJ0aWVzKSkudGhlbihmdW5jdGlvbiAodmFsKSB7cmV0dXJuICgKICAgICAgICAgICAgICAgIEpTT04ucGFyc2UodmFsKSk7fSk7CgogICAgICAgICAgfWZ1bmN0aW9uCgogICAgICAgICAgcnVuUmVsYXkoX3gsIF94Mikge3JldHVybiBfcnVuUmVsYXkuYXBwbHkodGhpcywgYXJndW1lbnRzKTt9ZnVuY3Rpb24gX3J1blJlbGF5KCkge19ydW5SZWxheSA9IF9hc3luY1RvR2VuZXJhdG9yKCAvKiNfX1BVUkVfXyovX3JlZ2VuZXJhdG9yUnVudGltZSgpLm1hcmsoZnVuY3Rpb24gX2NhbGxlZShmb3JtTmFtZSwgcGFyYW0pIHtyZXR1cm4gX3JlZ2VuZXJhdG9yUnVudGltZSgpLndyYXAoZnVuY3Rpb24gX2NhbGxlZSQoX2NvbnRleHQpIHt3aGlsZSAoMSkgc3dpdGNoIChfY29udGV4dC5wcmV2ID0gX2NvbnRleHQubmV4dCkge2Nhc2UgMDpyZXR1cm4gX2NvbnRleHQuYWJydXB0KCJyZXR1cm4iLAogICAgICAgICAgICAgICAgICAgIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlKSB7CiAgICAgICAgICAgICAgICAgICAgICB2YXIgeGhyID0gbmV3IFhNTEh0dHBSZXF1ZXN0KCk7CiAgICAgICAgICAgICAgICAgICAgICB4aHIucmVzcG9uc2VUeXBlID0gInRleHQiOwogICAgICAgICAgICAgICAgICAgICAgeGhyLm9wZW4oIlBPU1QiLCBkb2N1bWVudC5sb2NhdGlvbi5ocmVmLCB0cnVlKTsKICAgICAgICAgICAgICAgICAgICAgIHhoci5zZXRSZXF1ZXN0SGVhZGVyKCJDb250ZW50LVR5cGUiLCAiYXBwbGljYXRpb24veC13d3ctZm9ybS11cmxlbmNvZGVkIik7CiAgICAgICAgICAgICAgICAgICAgICB4aHIuc2VuZChmb3JtTmFtZSArICI9IiArIGVuY29kZVVSSUNvbXBvbmVudChwYXJhbSkpOwogICAgICAgICAgICAgICAgICAgICAgeGhyLm9ucmVhZHlzdGF0ZWNoYW5nZSA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHhoci5yZWFkeVN0YXRlICE9IDQgfHwgeGhyLnN0YXR1cyAhPSAyMDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUoeGhyLnJlc3BvbnNlVGV4dCk7CiAgICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgICAgIH0pKTtjYXNlIDE6Y2FzZSAiZW5kIjpyZXR1cm4gX2NvbnRleHQuc3RvcCgpO319LCBfY2FsbGVlKTt9KSk7cmV0dXJuIF9ydW5SZWxheS5hcHBseSh0aGlzLCBhcmd1bWVudHMpO30KICAgICAgICAgIDsgLy8gQ09OQ0FURU5BVEVEIE1PRFVMRTogLi9zcmMvcmVsYXkvYXBpL1NldHRpbmdWYWxpZGF0b3IudHN4CiAgICAgICAgICBmdW5jdGlvbiBTZXR0aW5nVmFsaWRhdG9yX3R5cGVvZihvYmopIHsiQGJhYmVsL2hlbHBlcnMgLSB0eXBlb2YiO3JldHVybiBTZXR0aW5nVmFsaWRhdG9yX3R5cGVvZiA9ICJmdW5jdGlvbiIgPT0gdHlwZW9mIFN5bWJvbCAmJiAic3ltYm9sIiA9PSB0eXBlb2YgU3ltYm9sLml0ZXJhdG9yID8gZnVuY3Rpb24gKG9iaikge3JldHVybiB0eXBlb2Ygb2JqO30gOiBmdW5jdGlvbiAob2JqKSB7cmV0dXJuIG9iaiAmJiAiZnVuY3Rpb24iID09IHR5cGVvZiBTeW1ib2wgJiYgb2JqLmNvbnN0cnVjdG9yID09PSBTeW1ib2wgJiYgb2JqICE9PSBTeW1ib2wucHJvdG90eXBlID8gInN5bWJvbCIgOiB0eXBlb2Ygb2JqO30sIFNldHRpbmdWYWxpZGF0b3JfdHlwZW9mKG9iaik7fWZ1bmN0aW9uIF9zbGljZWRUb0FycmF5KGFyciwgaSkge3JldHVybiBfYXJyYXlXaXRoSG9sZXMoYXJyKSB8fCBfaXRlcmFibGVUb0FycmF5TGltaXQoYXJyLCBpKSB8fCBfdW5zdXBwb3J0ZWRJdGVyYWJsZVRvQXJyYXkoYXJyLCBpKSB8fCBfbm9uSXRlcmFibGVSZXN0KCk7fWZ1bmN0aW9uIF9ub25JdGVyYWJsZVJlc3QoKSB7dGhyb3cgbmV3IFR5cGVFcnJvcigiSW52YWxpZCBhdHRlbXB0IHRvIGRlc3RydWN0dXJlIG5vbi1pdGVyYWJsZSBpbnN0YW5jZS5cbkluIG9yZGVyIHRvIGJlIGl0ZXJhYmxlLCBub24tYXJyYXkgb2JqZWN0cyBtdXN0IGhhdmUgYSBbU3ltYm9sLml0ZXJhdG9yXSgpIG1ldGhvZC4iKTt9ZnVuY3Rpb24gX2l0ZXJhYmxlVG9BcnJheUxpbWl0KGFyciwgaSkge3ZhciBfaSA9IG51bGwgPT0gYXJyID8gbnVsbCA6ICJ1bmRlZmluZWQiICE9IHR5cGVvZiBTeW1ib2wgJiYgYXJyW1N5bWJvbC5pdGVyYXRvcl0gfHwgYXJyWyJAQGl0ZXJhdG9yIl07aWYgKG51bGwgIT0gX2kpIHt2YXIgX3MsX2UsX3gsX3IsX2FyciA9IFtdLF9uID0gITAsX2QgPSAhMTt0cnkge2lmIChfeCA9IChfaSA9IF9pLmNhbGwoYXJyKSkubmV4dCwgMCA9PT0gaSkge2lmIChPYmplY3QoX2kpICE9PSBfaSkgcmV0dXJuO19uID0gITE7fSBlbHNlIGZvciAoOyAhKF9uID0gKF9zID0gX3guY2FsbChfaSkpLmRvbmUpICYmIChfYXJyLnB1c2goX3MudmFsdWUpLCBfYXJyLmxlbmd0aCAhPT0gaSk7IF9uID0gITApO30gY2F0Y2ggKGVycikge19kID0gITAsIF9lID0gZXJyO30gZmluYWxseSB7dHJ5IHtpZiAoIV9uICYmIG51bGwgIT0gX2lbInJldHVybiJdICYmIChfciA9IF9pWyJyZXR1cm4iXSgpLCBPYmplY3QoX3IpICE9PSBfcikpIHJldHVybjt9IGZpbmFsbHkge2lmIChfZCkgdGhyb3cgX2U7fX1yZXR1cm4gX2Fycjt9fWZ1bmN0aW9uIF9hcnJheVdpdGhIb2xlcyhhcnIpIHtpZiAoQXJyYXkuaXNBcnJheShhcnIpKSByZXR1cm4gYXJyO31mdW5jdGlvbiBfY3JlYXRlRm9yT2ZJdGVyYXRvckhlbHBlcihvLCBhbGxvd0FycmF5TGlrZSkge3ZhciBpdCA9IHR5cGVvZiBTeW1ib2wgIT09ICJ1bmRlZmluZWQiICYmIG9bU3ltYm9sLml0ZXJhdG9yXSB8fCBvWyJAQGl0ZXJhdG9yIl07aWYgKCFpdCkge2lmIChBcnJheS5pc0FycmF5KG8pIHx8IChpdCA9IF91bnN1cHBvcnRlZEl0ZXJhYmxlVG9BcnJheShvKSkgfHwgYWxsb3dBcnJheUxpa2UgJiYgbyAmJiB0eXBlb2Ygby5sZW5ndGggPT09ICJudW1iZXIiKSB7aWYgKGl0KSBvID0gaXQ7dmFyIGkgPSAwO3ZhciBGID0gZnVuY3Rpb24gRigpIHt9O3JldHVybiB7IHM6IEYsIG46IGZ1bmN0aW9uIG4oKSB7aWYgKGkgPj0gby5sZW5ndGgpIHJldHVybiB7IGRvbmU6IHRydWUgfTtyZXR1cm4geyBkb25lOiBmYWxzZSwgdmFsdWU6IG9baSsrXSB9O30sIGU6IGZ1bmN0aW9uIGUoX2UyKSB7dGhyb3cgX2UyO30sIGY6IEYgfTt9dGhyb3cgbmV3IFR5cGVFcnJvcigiSW52YWxpZCBhdHRlbXB0IHRvIGl0ZXJhdGUgbm9uLWl0ZXJhYmxlIGluc3RhbmNlLlxuSW4gb3JkZXIgdG8gYmUgaXRlcmFibGUsIG5vbi1hcnJheSBvYmplY3RzIG11c3QgaGF2ZSBhIFtTeW1ib2wuaXRlcmF0b3JdKCkgbWV0aG9kLiIpO312YXIgbm9ybWFsQ29tcGxldGlvbiA9IHRydWUsZGlkRXJyID0gZmFsc2UsZXJyO3JldHVybiB7IHM6IGZ1bmN0aW9uIHMoKSB7aXQgPSBpdC5jYWxsKG8pO30sIG46IGZ1bmN0aW9uIG4oKSB7dmFyIHN0ZXAgPSBpdC5uZXh0KCk7bm9ybWFsQ29tcGxldGlvbiA9IHN0ZXAuZG9uZTtyZXR1cm4gc3RlcDt9LCBlOiBmdW5jdGlvbiBlKF9lMykge2RpZEVyciA9IHRydWU7ZXJyID0gX2UzO30sIGY6IGZ1bmN0aW9uIGYoKSB7dHJ5IHtpZiAoIW5vcm1hbENvbXBsZXRpb24gJiYgaXRbInJldHVybiJdICE9IG51bGwpIGl0WyJyZXR1cm4iXSgpO30gZmluYWxseSB7aWYgKGRpZEVycikgdGhyb3cgZXJyO319IH07fWZ1bmN0aW9uIF91bnN1cHBvcnRlZEl0ZXJhYmxlVG9BcnJheShvLCBtaW5MZW4pIHtpZiAoIW8pIHJldHVybjtpZiAodHlwZW9mIG8gPT09ICJzdHJpbmciKSByZXR1cm4gX2FycmF5TGlrZVRvQXJyYXkobywgbWluTGVuKTt2YXIgbiA9IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChvKS5zbGljZSg4LCAtMSk7aWYgKG4gPT09ICJPYmplY3QiICYmIG8uY29uc3RydWN0b3IpIG4gPSBvLmNvbnN0cnVjdG9yLm5hbWU7aWYgKG4gPT09ICJNYXAiIHx8IG4gPT09ICJTZXQiKSByZXR1cm4gQXJyYXkuZnJvbShvKTtpZiAobiA9PT0gIkFyZ3VtZW50cyIgfHwgL14oPzpVaXxJKW50KD86OHwxNnwzMikoPzpDbGFtcGVkKT9BcnJheSQvLnRlc3QobikpIHJldHVybiBfYXJyYXlMaWtlVG9BcnJheShvLCBtaW5MZW4pO31mdW5jdGlvbiBfYXJyYXlMaWtlVG9BcnJheShhcnIsIGxlbikge2lmIChsZW4gPT0gbnVsbCB8fCBsZW4gPiBhcnIubGVuZ3RoKSBsZW4gPSBhcnIubGVuZ3RoO2ZvciAodmFyIGkgPSAwLCBhcnIyID0gbmV3IEFycmF5KGxlbik7IGkgPCBsZW47IGkrKykgYXJyMltpXSA9IGFycltpXTtyZXR1cm4gYXJyMjt9ZnVuY3Rpb24gX2NsYXNzQ2FsbENoZWNrKGluc3RhbmNlLCBDb25zdHJ1Y3Rvcikge2lmICghKGluc3RhbmNlIGluc3RhbmNlb2YgQ29uc3RydWN0b3IpKSB7dGhyb3cgbmV3IFR5cGVFcnJvcigiQ2Fubm90IGNhbGwgYSBjbGFzcyBhcyBhIGZ1bmN0aW9uIik7fX1mdW5jdGlvbiBfZGVmaW5lUHJvcGVydGllcyh0YXJnZXQsIHByb3BzKSB7Zm9yICh2YXIgaSA9IDA7IGkgPCBwcm9wcy5sZW5ndGg7IGkrKykge3ZhciBkZXNjcmlwdG9yID0gcHJvcHNbaV07ZGVzY3JpcHRvci5lbnVtZXJhYmxlID0gZGVzY3JpcHRvci5lbnVtZXJhYmxlIHx8IGZhbHNlO2Rlc2NyaXB0b3IuY29uZmlndXJhYmxlID0gdHJ1ZTtpZiAoInZhbHVlIiBpbiBkZXNjcmlwdG9yKSBkZXNjcmlwdG9yLndyaXRhYmxlID0gdHJ1ZTtPYmplY3QuZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBfdG9Qcm9wZXJ0eUtleShkZXNjcmlwdG9yLmtleSksIGRlc2NyaXB0b3IpO319ZnVuY3Rpb24gX2NyZWF0ZUNsYXNzKENvbnN0cnVjdG9yLCBwcm90b1Byb3BzLCBzdGF0aWNQcm9wcykge2lmIChwcm90b1Byb3BzKSBfZGVmaW5lUHJvcGVydGllcyhDb25zdHJ1Y3Rvci5wcm90b3R5cGUsIHByb3RvUHJvcHMpO2lmIChzdGF0aWNQcm9wcykgX2RlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IsIHN0YXRpY1Byb3BzKTtPYmplY3QuZGVmaW5lUHJvcGVydHkoQ29uc3RydWN0b3IsICJwcm90b3R5cGUiLCB7IHdyaXRhYmxlOiBmYWxzZSB9KTtyZXR1cm4gQ29uc3RydWN0b3I7fWZ1bmN0aW9uIF9kZWZpbmVQcm9wZXJ0eShvYmosIGtleSwgdmFsdWUpIHtrZXkgPSBfdG9Qcm9wZXJ0eUtleShrZXkpO2lmIChrZXkgaW4gb2JqKSB7T2JqZWN0LmRlZmluZVByb3BlcnR5KG9iaiwga2V5LCB7IHZhbHVlOiB2YWx1ZSwgZW51bWVyYWJsZTogdHJ1ZSwgY29uZmlndXJhYmxlOiB0cnVlLCB3cml0YWJsZTogdHJ1ZSB9KTt9IGVsc2Uge29ialtrZXldID0gdmFsdWU7fXJldHVybiBvYmo7fWZ1bmN0aW9uIF90b1Byb3BlcnR5S2V5KGFyZykge3ZhciBrZXkgPSBfdG9QcmltaXRpdmUoYXJnLCAic3RyaW5nIik7cmV0dXJuIFNldHRpbmdWYWxpZGF0b3JfdHlwZW9mKGtleSkgPT09ICJzeW1ib2wiID8ga2V5IDogU3RyaW5nKGtleSk7fWZ1bmN0aW9uIF90b1ByaW1pdGl2ZShpbnB1dCwgaGludCkge2lmIChTZXR0aW5nVmFsaWRhdG9yX3R5cGVvZihpbnB1dCkgIT09ICJvYmplY3QiIHx8IGlucHV0ID09PSBudWxsKSByZXR1cm4gaW5wdXQ7dmFyIHByaW0gPSBpbnB1dFtTeW1ib2wudG9QcmltaXRpdmVdO2lmIChwcmltICE9PSB1bmRlZmluZWQpIHt2YXIgcmVzID0gcHJpbS5jYWxsKGlucHV0LCBoaW50IHx8ICJkZWZhdWx0Iik7aWYgKFNldHRpbmdWYWxpZGF0b3JfdHlwZW9mKHJlcykgIT09ICJvYmplY3QiKSByZXR1cm4gcmVzO3Rocm93IG5ldyBUeXBlRXJyb3IoIkBAdG9QcmltaXRpdmUgbXVzdCByZXR1cm4gYSBwcmltaXRpdmUgdmFsdWUuIik7fXJldHVybiAoaGludCA9PT0gInN0cmluZyIgPyBTdHJpbmcgOiBOdW1iZXIpKGlucHV0KTt9dmFyCgoKICAgICAgICAgIFNldHRpbmdWYWxpZGF0b3IgPSAvKiNfX1BVUkVfXyovZnVuY3Rpb24gKCkge2Z1bmN0aW9uIFNldHRpbmdWYWxpZGF0b3IoKSB7X2NsYXNzQ2FsbENoZWNrKHRoaXMsIFNldHRpbmdWYWxpZGF0b3IpO19kZWZpbmVQcm9wZXJ0eSh0aGlzLCAic2V0dGluZ3MiLAogICAgICAgICAgICAgIFtdKTtfZGVmaW5lUHJvcGVydHkodGhpcywgIm9iamVjdCIsCiAgICAgICAgICAgICAge30pO31fY3JlYXRlQ2xhc3MoU2V0dGluZ1ZhbGlkYXRvciwgW3sga2V5OiAiYWRkU2V0dGluZyIsIHZhbHVlOgoKICAgICAgICAgICAgICBmdW5jdGlvbiBhZGRTZXR0aW5nKHNldHRpbmcsIHNldFN0YXRlKSB7CiAgICAgICAgICAgICAgICB0aGlzLnNldHRpbmdzLnB1c2goW3NldHRpbmcsIHNldFN0YXRlXSk7CiAgICAgICAgICAgICAgfSB9LCB7IGtleTogInVwZGF0ZVNldHRpbmciLCB2YWx1ZToKCiAgICAgICAgICAgICAgZnVuY3Rpb24gdXBkYXRlU2V0dGluZyhzZXR0aW5nKSB7CiAgICAgICAgICAgICAgICB0aGlzLm9iamVjdFtzZXR0aW5nLnByZWZlcmVuY2VdID0gc2V0dGluZy52YWx1ZTsKICAgICAgICAgICAgICAgIHRoaXMuZG9WYWxpZGF0ZXMoKTsKICAgICAgICAgICAgICB9IH0sIHsga2V5OiAidXBkYXRlT2JqZWN0IiwgdmFsdWU6CgogICAgICAgICAgICAgIGZ1bmN0aW9uIHVwZGF0ZU9iamVjdCgpIHt2YXIgX2l0ZXJhdG9yID0gX2NyZWF0ZUZvck9mSXRlcmF0b3JIZWxwZXIoCiAgICAgICAgICAgICAgICAgIHRoaXMuc2V0dGluZ3MpLF9zdGVwO3RyeSB7Zm9yIChfaXRlcmF0b3IucygpOyAhKF9zdGVwID0gX2l0ZXJhdG9yLm4oKSkuZG9uZTspIHt2YXIgX3N0ZXAkdmFsdWUgPSBfc2xpY2VkVG9BcnJheShfc3RlcC52YWx1ZSwgMSksc2V0dGluZyA9IF9zdGVwJHZhbHVlWzBdOwogICAgICAgICAgICAgICAgICAgIHRoaXMub2JqZWN0W3NldHRpbmcucHJlZmVyZW5jZV0gPSBzZXR0aW5nLnZhbHVlOwogICAgICAgICAgICAgICAgICB9fSBjYXRjaCAoZXJyKSB7X2l0ZXJhdG9yLmUoZXJyKTt9IGZpbmFsbHkge19pdGVyYXRvci5mKCk7fQogICAgICAgICAgICAgIH0gfSwgeyBrZXk6ICJkb1ZhbGlkYXRlcyIsIHZhbHVlOgoKICAgICAgICAgICAgICBmdW5jdGlvbiBkb1ZhbGlkYXRlcygpIHt2YXIgX2l0ZXJhdG9yMiA9IF9jcmVhdGVGb3JPZkl0ZXJhdG9ySGVscGVyKAogICAgICAgICAgICAgICAgICB0aGlzLnNldHRpbmdzKSxfc3RlcDI7dHJ5IHtmb3IgKF9pdGVyYXRvcjIucygpOyAhKF9zdGVwMiA9IF9pdGVyYXRvcjIubigpKS5kb25lOykge3ZhciBfc3RlcDIkdmFsdWUgPSBfc2xpY2VkVG9BcnJheShfc3RlcDIudmFsdWUsIDIpLHNldHRpbmcgPSBfc3RlcDIkdmFsdWVbMF0sc2V0VmFsaWQgPSBfc3RlcDIkdmFsdWVbMV07CiAgICAgICAgICAgICAgICAgICAgc2V0VmFsaWQodGhpcy5pc1ZhbGlkKHNldHRpbmcpKTsKICAgICAgICAgICAgICAgICAgfX0gY2F0Y2ggKGVycikge19pdGVyYXRvcjIuZShlcnIpO30gZmluYWxseSB7X2l0ZXJhdG9yMi5mKCk7fQogICAgICAgICAgICAgIH0gfSwgeyBrZXk6ICJpc1ZhbGlkIiwgdmFsdWU6CgogICAgICAgICAgICAgIGZ1bmN0aW9uIGlzVmFsaWQoc2V0dGluZykgewogICAgICAgICAgICAgICAgcmV0dXJuICgKICAgICAgICAgICAgICAgICAgc2V0dGluZy52YWxpZGF0ZSA9PSBudWxsIHx8IHNldHRpbmcudmFsaWRhdGUoc2V0dGluZy52YWx1ZSwgdGhpcy5vYmplY3QpKTsKCiAgICAgICAgICAgICAgfSB9XSk7cmV0dXJuIFNldHRpbmdWYWxpZGF0b3I7fSgpOwoKCiAgICAgICAgICAvKiBoYXJtb255IGRlZmF1bHQgZXhwb3J0ICovdmFyIGFwaV9TZXR0aW5nVmFsaWRhdG9yID0gU2V0dGluZ1ZhbGlkYXRvcjsKICAgICAgICAgIDsgLy8gQ09OQ0FURU5BVEVEIE1PRFVMRTogLi9zcmMvcmVsYXkvY29tcG9uZW50cy9JbnRlcnJ1cHQudHN4CgoKCgogICAgICAgICAgZnVuY3Rpb24gSW50ZXJydXB0KF9yZWYpIHt2YXIgYnV0dG9uID0gX3JlZi5idXR0b247CiAgICAgICAgICAgIHJldHVybiAvKiNfX1BVUkVfXyovKAogICAgICAgICAgICAgIHJlYWN0LmNyZWF0ZUVsZW1lbnQoImlucHV0IiwgewogICAgICAgICAgICAgICAgY2xhc3NOYW1lOiAiaW50ZXJydXB0IiwKICAgICAgICAgICAgICAgIHR5cGU6ICJzdWJtaXQiLAogICAgICAgICAgICAgICAgdmFsdWU6IGJ1dHRvbi5uYW1lLAogICAgICAgICAgICAgICAgImRhdGEtbmFtZSI6IGJ1dHRvbi5uYW1lLAogICAgICAgICAgICAgICAgb25DbGljazogZnVuY3Rpb24gb25DbGljaygpIHsKICAgICAgICAgICAgICAgICAgc2V0UHJvcGVydGllcygKICAgICAgICAgICAgICAgICAgYnV0dG9uLmFjdGlvbnMubWFwKGZ1bmN0aW9uIChfcmVmMikge3ZhciBwcmVmZXJlbmNlID0gX3JlZjIucHJlZmVyZW5jZSx2YWx1ZSA9IF9yZWYyLnZhbHVlO3JldHVybiBbcHJlZmVyZW5jZSwgdmFsdWVdO30pKS4KICAgICAgICAgICAgICAgICAgdGhlbihmdW5jdGlvbiAoKSB7cmV0dXJuIGFkZE5vdGlmaWNhdGlvbihidXR0b24ubm90aWZpY2F0aW9uIHx8ICJJbnRlcnJ1cHRlZCEiKTt9KTsKICAgICAgICAgICAgICAgIH0gfSkpOwoKCiAgICAgICAgICB9CgogICAgICAgICAgLyogaGFybW9ueSBkZWZhdWx0IGV4cG9ydCAqL3ZhciBjb21wb25lbnRzX0ludGVycnVwdCA9IEludGVycnVwdDsKICAgICAgICAgIDsgLy8gQ09OQ0FURU5BVEVEIE1PRFVMRTogLi9zcmMvcmVsYXkvdHlwZXMvVHlwZXMudHN4CgoKICAgICAgICAgIHZhciBSZWxheUNvbXBvbmVudFR5cGU7KGZ1bmN0aW9uIChSZWxheUNvbXBvbmVudFR5cGUpIHtSZWxheUNvbXBvbmVudFR5cGVbIkJPT0xFQU4iXSA9ICJib29sZWFuIjtSZWxheUNvbXBvbmVudFR5cGVbIkRST1BET1dOIl0gPSAiZHJvcGRvd24iO1JlbGF5Q29tcG9uZW50VHlwZVsiU1RSSU5HIl0gPSAic3RyaW5nIjtSZWxheUNvbXBvbmVudFR5cGVbIkhUTUwiXSA9ICJodG1sIjtSZWxheUNvbXBvbmVudFR5cGVbIklOVEVSUlVQVCJdID0gImludGVycnVwdCI7fSkoUmVsYXlDb21wb25lbnRUeXBlIHx8IChSZWxheUNvbXBvbmVudFR5cGUgPSB7fSkpOwogICAgICAgICAgOyAvLyBDT05DQVRFTkFURUQgTU9EVUxFOiAuL3NyYy9yZWxheS9jb21wb25lbnRzL3NldHRpbmdzL0Jvb2xlYW5JbnB1dC50c3gKICAgICAgICAgIGZ1bmN0aW9uIEJvb2xlYW5JbnB1dF9zbGljZWRUb0FycmF5KGFyciwgaSkge3JldHVybiBCb29sZWFuSW5wdXRfYXJyYXlXaXRoSG9sZXMoYXJyKSB8fCBCb29sZWFuSW5wdXRfaXRlcmFibGVUb0FycmF5TGltaXQoYXJyLCBpKSB8fCBCb29sZWFuSW5wdXRfdW5zdXBwb3J0ZWRJdGVyYWJsZVRvQXJyYXkoYXJyLCBpKSB8fCBCb29sZWFuSW5wdXRfbm9uSXRlcmFibGVSZXN0KCk7fWZ1bmN0aW9uIEJvb2xlYW5JbnB1dF9ub25JdGVyYWJsZVJlc3QoKSB7dGhyb3cgbmV3IFR5cGVFcnJvcigiSW52YWxpZCBhdHRlbXB0IHRvIGRlc3RydWN0dXJlIG5vbi1pdGVyYWJsZSBpbnN0YW5jZS5cbkluIG9yZGVyIHRvIGJlIGl0ZXJhYmxlLCBub24tYXJyYXkgb2JqZWN0cyBtdXN0IGhhdmUgYSBbU3ltYm9sLml0ZXJhdG9yXSgpIG1ldGhvZC4iKTt9ZnVuY3Rpb24gQm9vbGVhbklucHV0X3Vuc3VwcG9ydGVkSXRlcmFibGVUb0FycmF5KG8sIG1pbkxlbikge2lmICghbykgcmV0dXJuO2lmICh0eXBlb2YgbyA9PT0gInN0cmluZyIpIHJldHVybiBCb29sZWFuSW5wdXRfYXJyYXlMaWtlVG9BcnJheShvLCBtaW5MZW4pO3ZhciBuID0gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKG8pLnNsaWNlKDgsIC0xKTtpZiAobiA9PT0gIk9iamVjdCIgJiYgby5jb25zdHJ1Y3RvcikgbiA9IG8uY29uc3RydWN0b3IubmFtZTtpZiAobiA9PT0gIk1hcCIgfHwgbiA9PT0gIlNldCIpIHJldHVybiBBcnJheS5mcm9tKG8pO2lmIChuID09PSAiQXJndW1lbnRzIiB8fCAvXig/OlVpfEkpbnQoPzo4fDE2fDMyKSg/OkNsYW1wZWQpP0FycmF5JC8udGVzdChuKSkgcmV0dXJuIEJvb2xlYW5JbnB1dF9hcnJheUxpa2VUb0FycmF5KG8sIG1pbkxlbik7fWZ1bmN0aW9uIEJvb2xlYW5JbnB1dF9hcnJheUxpa2VUb0FycmF5KGFyciwgbGVuKSB7aWYgKGxlbiA9PSBudWxsIHx8IGxlbiA+IGFyci5sZW5ndGgpIGxlbiA9IGFyci5sZW5ndGg7Zm9yICh2YXIgaSA9IDAsIGFycjIgPSBuZXcgQXJyYXkobGVuKTsgaSA8IGxlbjsgaSsrKSBhcnIyW2ldID0gYXJyW2ldO3JldHVybiBhcnIyO31mdW5jdGlvbiBCb29sZWFuSW5wdXRfaXRlcmFibGVUb0FycmF5TGltaXQoYXJyLCBpKSB7dmFyIF9pID0gbnVsbCA9PSBhcnIgPyBudWxsIDogInVuZGVmaW5lZCIgIT0gdHlwZW9mIFN5bWJvbCAmJiBhcnJbU3ltYm9sLml0ZXJhdG9yXSB8fCBhcnJbIkBAaXRlcmF0b3IiXTtpZiAobnVsbCAhPSBfaSkge3ZhciBfcyxfZSxfeCxfcixfYXJyID0gW10sX24gPSAhMCxfZCA9ICExO3RyeSB7aWYgKF94ID0gKF9pID0gX2kuY2FsbChhcnIpKS5uZXh0LCAwID09PSBpKSB7aWYgKE9iamVjdChfaSkgIT09IF9pKSByZXR1cm47X24gPSAhMTt9IGVsc2UgZm9yICg7ICEoX24gPSAoX3MgPSBfeC5jYWxsKF9pKSkuZG9uZSkgJiYgKF9hcnIucHVzaChfcy52YWx1ZSksIF9hcnIubGVuZ3RoICE9PSBpKTsgX24gPSAhMCk7fSBjYXRjaCAoZXJyKSB7X2QgPSAhMCwgX2UgPSBlcnI7fSBmaW5hbGx5IHt0cnkge2lmICghX24gJiYgbnVsbCAhPSBfaVsicmV0dXJuIl0gJiYgKF9yID0gX2lbInJldHVybiJdKCksIE9iamVjdChfcikgIT09IF9yKSkgcmV0dXJuO30gZmluYWxseSB7aWYgKF9kKSB0aHJvdyBfZTt9fXJldHVybiBfYXJyO319ZnVuY3Rpb24gQm9vbGVhbklucHV0X2FycmF5V2l0aEhvbGVzKGFycikge2lmIChBcnJheS5pc0FycmF5KGFycikpIHJldHVybiBhcnI7fQoKCgogICAgICAgICAgZnVuY3Rpb24gQm9vbGVhbklucHV0KF9yZWYpIHt2YXIgYnV0dG9uID0gX3JlZi5idXR0b247CiAgICAgICAgICAgIHZhciBfdXNlU3RhdGUgPSAoMCwgcmVhY3QudXNlU3RhdGUpKGJ1dHRvbi52YWx1ZSA9PT0gInRydWUiKSxfdXNlU3RhdGUyID0gQm9vbGVhbklucHV0X3NsaWNlZFRvQXJyYXkoX3VzZVN0YXRlLCAyKSx2YWx1ZSA9IF91c2VTdGF0ZTJbMF0sc2V0VmFsdWUgPSBfdXNlU3RhdGUyWzFdOwoKICAgICAgICAgICAgcmV0dXJuIC8qI19fUFVSRV9fKi8oCiAgICAgICAgICAgICAgcmVhY3QuY3JlYXRlRWxlbWVudCgibGFiZWwiLCB7IGNsYXNzTmFtZTogImNoZWNrY29udGFpbmVyIiB9LCAvKiNfX1BVUkVfXyovCiAgICAgICAgICAgICAgcmVhY3QuY3JlYXRlRWxlbWVudCgiaW5wdXQiLCB7IHR5cGU6ICJoaWRkZW4iLCBuYW1lOiBidXR0b24ubmFtZSwgdmFsdWU6IGJ1dHRvbi52YWx1ZSB9KSwgLyojX19QVVJFX18qLwogICAgICAgICAgICAgIHJlYWN0LmNyZWF0ZUVsZW1lbnQoImRpdiIsIHsKICAgICAgICAgICAgICAgIGNsYXNzTmFtZTogInRvZ2dsZS10cmFjayIsCiAgICAgICAgICAgICAgICBvbkNsaWNrOiBmdW5jdGlvbiBvbkNsaWNrKCkgewogICAgICAgICAgICAgICAgICBzZXRWYWx1ZSghdmFsdWUpOwogICAgICAgICAgICAgICAgICBidXR0b24uc2V0VmFsdWUoKCF2YWx1ZSkudG9TdHJpbmcoKSk7CiAgICAgICAgICAgICAgICB9IH0sIC8qI19fUFVSRV9fKi8KCiAgICAgICAgICAgICAgcmVhY3QuY3JlYXRlRWxlbWVudCgic3BhbiIsIHsgY2xhc3NOYW1lOiAidG9nZ2xlLWluZGljYXRvciIgfSwgLyojX19QVVJFX18qLwogICAgICAgICAgICAgIHJlYWN0LmNyZWF0ZUVsZW1lbnQoInNwYW4iLCB7IGNsYXNzTmFtZTogImNoZWNrTWFyayIgfSwgLyojX19QVVJFX18qLwogICAgICAgICAgICAgIHJlYWN0LmNyZWF0ZUVsZW1lbnQoInN2ZyIsIHsKICAgICAgICAgICAgICAgIHZpZXdCb3g6ICIwIDAgMjQgMjQiLAogICAgICAgICAgICAgICAgaWQ6ICJnaHEtc3ZnLWNoZWNrIiwKICAgICAgICAgICAgICAgIHJvbGU6ICJwcmVzZW50YXRpb24iLAogICAgICAgICAgICAgICAgImFyaWEtaGlkZGVuIjogInRydWUiIH0sIC8qI19fUFVSRV9fKi8KCiAgICAgICAgICAgICAgcmVhY3QuY3JlYXRlRWxlbWVudCgicGF0aCIsIHsgZDogIk05Ljg2IDE4YTEgMSAwIDAxLS43My0uMzJsLTQuODYtNS4xN2ExLjAwMSAxLjAwMSAwIDAxMS40Ni0xLjM3bDQuMTIgNC4zOSA4LjQxLTkuMmExIDEgMCAxMTEuNDggMS4zNGwtOS4xNCAxMGExIDEgMCAwMS0uNzMuMzNoLS4wMXoiIH0pKSkpKSkpOwoKCgoKCgogICAgICAgICAgfQoKICAgICAgICAgIC8qCiAgICAgICAgICA8ZGl2CiAgICAgICAgICAgIGNsYXNzPSJjaGVja21hcmsiCiAgICAgICAgICAgIG9uQ2xpY2s9eygpID0+IHsKICAgICAgICAgICAgICBzZXRWYWx1ZSghdmFsdWUpOwogICAgICAgICAgICB9fQogICAgICAgICAgLz4KICAgICAgICAgICAqLwogICAgICAgICAgLyogaGFybW9ueSBkZWZhdWx0IGV4cG9ydCAqL3ZhciBzZXR0aW5nc19Cb29sZWFuSW5wdXQgPSBCb29sZWFuSW5wdXQ7CiAgICAgICAgICA7IC8vIENPTkNBVEVOQVRFRCBNT0RVTEU6IC4vc3JjL3JlbGF5L2NvbXBvbmVudHMvc2V0dGluZ3MvRHJvcGRvd25JbnB1dC50c3gKCgoKICAgICAgICAgIGZ1bmN0aW9uIERyb3Bkb3duSW5wdXQoX3JlZikge3ZhciBidXR0b24gPSBfcmVmLmJ1dHRvbjsKICAgICAgICAgICAgcmV0dXJuIC8qI19fUFVSRV9fKi8oCiAgICAgICAgICAgICAgcmVhY3QuY3JlYXRlRWxlbWVudCgic2VsZWN0IiwgewogICAgICAgICAgICAgICAgY2xhc3NOYW1lOiAiZHJvcGRvd25jb250YWluZXIiLAogICAgICAgICAgICAgICAgbmFtZTogYnV0dG9uLm5hbWUsCiAgICAgICAgICAgICAgICBkZWZhdWx0VmFsdWU6IGJ1dHRvbi52YWx1ZSwKICAgICAgICAgICAgICAgIG9uQ2hhbmdlOiBmdW5jdGlvbiBvbkNoYW5nZShlKSB7cmV0dXJuIGJ1dHRvbi5zZXRWYWx1ZShlLnRhcmdldC52YWx1ZSk7fSB9LAoKICAgICAgICAgICAgICBidXR0b24uZHJvcGRvd24ubWFwKGZ1bmN0aW9uIChvcHRpb24pIHsKICAgICAgICAgICAgICAgIHJldHVybiAvKiNfX1BVUkVfXyovKAogICAgICAgICAgICAgICAgICByZWFjdC5jcmVhdGVFbGVtZW50KCJvcHRpb24iLCB7IGtleTogb3B0aW9uLnZhbHVlLCB2YWx1ZTogb3B0aW9uLnZhbHVlIH0sCiAgICAgICAgICAgICAgICAgIG9wdGlvbi5kaXNwbGF5IHx8IG9wdGlvbi52YWx1ZSkpOwoKCiAgICAgICAgICAgICAgfSkpKTsKCgogICAgICAgICAgfQoKICAgICAgICAgIC8qIGhhcm1vbnkgZGVmYXVsdCBleHBvcnQgKi92YXIgc2V0dGluZ3NfRHJvcGRvd25JbnB1dCA9IERyb3Bkb3duSW5wdXQ7CiAgICAgICAgICA7IC8vIENPTkNBVEVOQVRFRCBNT0RVTEU6IC4vc3JjL3JlbGF5L2NvbXBvbmVudHMvc2V0dGluZ3MvU3RyaW5nSW5wdXQudHN4CgoKCiAgICAgICAgICBmdW5jdGlvbiBTdHJpbmdJbnB1dChfcmVmKSB7dmFyIGJ1dHRvbiA9IF9yZWYuYnV0dG9uOwogICAgICAgICAgICByZXR1cm4gLyojX19QVVJFX18qLygKICAgICAgICAgICAgICByZWFjdC5jcmVhdGVFbGVtZW50KCJpbnB1dCIsIHsKICAgICAgICAgICAgICAgIGNsYXNzTmFtZTogInN0cmluZ2NvbnRhaW5lciIsCiAgICAgICAgICAgICAgICBuYW1lOiBidXR0b24ubmFtZSwKICAgICAgICAgICAgICAgIGRlZmF1bHRWYWx1ZTogYnV0dG9uLnZhbHVlLAogICAgICAgICAgICAgICAgb25DaGFuZ2U6IGZ1bmN0aW9uIG9uQ2hhbmdlKGUpIHtyZXR1cm4gYnV0dG9uLnNldFZhbHVlKGUudGFyZ2V0LnZhbHVlKTt9IH0pKTsKCgogICAgICAgICAgfQoKICAgICAgICAgIC8qIGhhcm1vbnkgZGVmYXVsdCBleHBvcnQgKi92YXIgc2V0dGluZ3NfU3RyaW5nSW5wdXQgPSBTdHJpbmdJbnB1dDsKICAgICAgICAgIDsgLy8gQ09OQ0FURU5BVEVEIE1PRFVMRTogLi9zcmMvcmVsYXkvY29tcG9uZW50cy9zZXR0aW5ncy9TZXR0aW5nLnRzeAogICAgICAgICAgZnVuY3Rpb24gU2V0dGluZ19zbGljZWRUb0FycmF5KGFyciwgaSkge3JldHVybiBTZXR0aW5nX2FycmF5V2l0aEhvbGVzKGFycikgfHwgU2V0dGluZ19pdGVyYWJsZVRvQXJyYXlMaW1pdChhcnIsIGkpIHx8IFNldHRpbmdfdW5zdXBwb3J0ZWRJdGVyYWJsZVRvQXJyYXkoYXJyLCBpKSB8fCBTZXR0aW5nX25vbkl0ZXJhYmxlUmVzdCgpO31mdW5jdGlvbiBTZXR0aW5nX25vbkl0ZXJhYmxlUmVzdCgpIHt0aHJvdyBuZXcgVHlwZUVycm9yKCJJbnZhbGlkIGF0dGVtcHQgdG8gZGVzdHJ1Y3R1cmUgbm9uLWl0ZXJhYmxlIGluc3RhbmNlLlxuSW4gb3JkZXIgdG8gYmUgaXRlcmFibGUsIG5vbi1hcnJheSBvYmplY3RzIG11c3QgaGF2ZSBhIFtTeW1ib2wuaXRlcmF0b3JdKCkgbWV0aG9kLiIpO31mdW5jdGlvbiBTZXR0aW5nX3Vuc3VwcG9ydGVkSXRlcmFibGVUb0FycmF5KG8sIG1pbkxlbikge2lmICghbykgcmV0dXJuO2lmICh0eXBlb2YgbyA9PT0gInN0cmluZyIpIHJldHVybiBTZXR0aW5nX2FycmF5TGlrZVRvQXJyYXkobywgbWluTGVuKTt2YXIgbiA9IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChvKS5zbGljZSg4LCAtMSk7aWYgKG4gPT09ICJPYmplY3QiICYmIG8uY29uc3RydWN0b3IpIG4gPSBvLmNvbnN0cnVjdG9yLm5hbWU7aWYgKG4gPT09ICJNYXAiIHx8IG4gPT09ICJTZXQiKSByZXR1cm4gQXJyYXkuZnJvbShvKTtpZiAobiA9PT0gIkFyZ3VtZW50cyIgfHwgL14oPzpVaXxJKW50KD86OHwxNnwzMikoPzpDbGFtcGVkKT9BcnJheSQvLnRlc3QobikpIHJldHVybiBTZXR0aW5nX2FycmF5TGlrZVRvQXJyYXkobywgbWluTGVuKTt9ZnVuY3Rpb24gU2V0dGluZ19hcnJheUxpa2VUb0FycmF5KGFyciwgbGVuKSB7aWYgKGxlbiA9PSBudWxsIHx8IGxlbiA+IGFyci5sZW5ndGgpIGxlbiA9IGFyci5sZW5ndGg7Zm9yICh2YXIgaSA9IDAsIGFycjIgPSBuZXcgQXJyYXkobGVuKTsgaSA8IGxlbjsgaSsrKSBhcnIyW2ldID0gYXJyW2ldO3JldHVybiBhcnIyO31mdW5jdGlvbiBTZXR0aW5nX2l0ZXJhYmxlVG9BcnJheUxpbWl0KGFyciwgaSkge3ZhciBfaSA9IG51bGwgPT0gYXJyID8gbnVsbCA6ICJ1bmRlZmluZWQiICE9IHR5cGVvZiBTeW1ib2wgJiYgYXJyW1N5bWJvbC5pdGVyYXRvcl0gfHwgYXJyWyJAQGl0ZXJhdG9yIl07aWYgKG51bGwgIT0gX2kpIHt2YXIgX3MsX2UsX3gsX3IsX2FyciA9IFtdLF9uID0gITAsX2QgPSAhMTt0cnkge2lmIChfeCA9IChfaSA9IF9pLmNhbGwoYXJyKSkubmV4dCwgMCA9PT0gaSkge2lmIChPYmplY3QoX2kpICE9PSBfaSkgcmV0dXJuO19uID0gITE7fSBlbHNlIGZvciAoOyAhKF9uID0gKF9zID0gX3guY2FsbChfaSkpLmRvbmUpICYmIChfYXJyLnB1c2goX3MudmFsdWUpLCBfYXJyLmxlbmd0aCAhPT0gaSk7IF9uID0gITApO30gY2F0Y2ggKGVycikge19kID0gITAsIF9lID0gZXJyO30gZmluYWxseSB7dHJ5IHtpZiAoIV9uICYmIG51bGwgIT0gX2lbInJldHVybiJdICYmIChfciA9IF9pWyJyZXR1cm4iXSgpLCBPYmplY3QoX3IpICE9PSBfcikpIHJldHVybjt9IGZpbmFsbHkge2lmIChfZCkgdGhyb3cgX2U7fX1yZXR1cm4gX2Fycjt9fWZ1bmN0aW9uIFNldHRpbmdfYXJyYXlXaXRoSG9sZXMoYXJyKSB7aWYgKEFycmF5LmlzQXJyYXkoYXJyKSkgcmV0dXJuIGFycjt9CgoKCgoKCiAgICAgICAgICBmdW5jdGlvbiBTZXR0aW5nKF9yZWYpCgoKCgoKICAgICAgICAgIHt2YXIgYnV0dG9uID0gX3JlZi5idXR0b24sdmFsaWRhdG9yID0gX3JlZi52YWxpZGF0b3I7CiAgICAgICAgICAgIHZhciBfdXNlU3RhdGUgPSAoMCwgcmVhY3QudXNlU3RhdGUpKHZhbGlkYXRvci5pc1ZhbGlkKGJ1dHRvbikpLF91c2VTdGF0ZTIgPSBTZXR0aW5nX3NsaWNlZFRvQXJyYXkoX3VzZVN0YXRlLCAyKSx2YWxpZCA9IF91c2VTdGF0ZTJbMF0sc2V0VmFsaWQgPSBfdXNlU3RhdGUyWzFdOwoKICAgICAgICAgICAgYnV0dG9uLnNldFZhbHVlID0gZnVuY3Rpb24gKHZhbCkgewogICAgICAgICAgICAgIGJ1dHRvbi52YWx1ZSA9IHZhbDsKICAgICAgICAgICAgICB2YWxpZGF0b3IudXBkYXRlU2V0dGluZyhidXR0b24pOwogICAgICAgICAgICB9OwoKICAgICAgICAgICAgdmFsaWRhdG9yLmFkZFNldHRpbmcoYnV0dG9uLCBzZXRWYWxpZCk7CgogICAgICAgICAgICByZXR1cm4gLyojX19QVVJFX18qLygKICAgICAgICAgICAgICByZWFjdC5jcmVhdGVFbGVtZW50KCJ0ciIsIHsKICAgICAgICAgICAgICAgIGNsYXNzTmFtZTogInVzZXJQcmVmZXJlbmNlIiwKICAgICAgICAgICAgICAgIGtleTogYnV0dG9uLnByZWZlcmVuY2UsCiAgICAgICAgICAgICAgICAiZGF0YS1uYW1lIjogYnV0dG9uLm5hbWUgfSwgLyojX19QVVJFX18qLwoKICAgICAgICAgICAgICByZWFjdC5jcmVhdGVFbGVtZW50KCJ0ZCIsIHsgY2xhc3NOYW1lOiAic2V0dGluZyIgfSwKICAgICAgICAgICAgICBidXR0b24ubmFtZSwgLyojX19QVVJFX18qLwogICAgICAgICAgICAgIHJlYWN0LmNyZWF0ZUVsZW1lbnQoImRpdiIsIHsgY2xhc3NOYW1lOiAic2V0dGluZ05hbWVIb3ZlciIgfSwgYnV0dG9uLnByZWZlcmVuY2UpKSwgLyojX19QVVJFX18qLwoKICAgICAgICAgICAgICByZWFjdC5jcmVhdGVFbGVtZW50KCJ0ZCIsIHsgY2xhc3NOYW1lOiB2YWxpZCA/ICJzZXR0aW5nSW5wdXQiIDogInNldHRpbmdJbnB1dCBpbnZhbGlkLXNldHRpbmciIH0sCiAgICAgICAgICAgICAgYnV0dG9uLnR5cGUgPT09IFJlbGF5Q29tcG9uZW50VHlwZS5CT09MRUFOID8gLyojX19QVVJFX18qLwogICAgICAgICAgICAgIHJlYWN0LmNyZWF0ZUVsZW1lbnQoc2V0dGluZ3NfQm9vbGVhbklucHV0LCB7IGJ1dHRvbjogYnV0dG9uIH0pIDoKICAgICAgICAgICAgICBidXR0b24udHlwZSA9PT0gUmVsYXlDb21wb25lbnRUeXBlLkRST1BET1dOID8gLyojX19QVVJFX18qLwogICAgICAgICAgICAgIHJlYWN0LmNyZWF0ZUVsZW1lbnQoc2V0dGluZ3NfRHJvcGRvd25JbnB1dCwgeyBidXR0b246IGJ1dHRvbiB9KSA6IC8qI19fUFVSRV9fKi8KCiAgICAgICAgICAgICAgcmVhY3QuY3JlYXRlRWxlbWVudChzZXR0aW5nc19TdHJpbmdJbnB1dCwgeyBidXR0b246IGJ1dHRvbiB9KSwKCiAgICAgICAgICAgICAgYnV0dG9uLmludmFsaWRSZWFzb24gIT0gbnVsbCA/IC8qI19fUFVSRV9fKi8KICAgICAgICAgICAgICByZWFjdC5jcmVhdGVFbGVtZW50KCJkaXYiLCB7IGNsYXNzTmFtZTogImludmFsaWQtcmVhc29uIiwgaGlkZGVuOiB2YWxpZCB9LCAvKiNfX1BVUkVfXyovCiAgICAgICAgICAgICAgcmVhY3QuY3JlYXRlRWxlbWVudCgic21hbGwiLCBudWxsLCBidXR0b24uaW52YWxpZFJlYXNvbikpIDogLyojX19QVVJFX18qLwoKCiAgICAgICAgICAgICAgcmVhY3QuY3JlYXRlRWxlbWVudChyZWFjdC5GcmFnbWVudCwgbnVsbCksIC8qI19fUFVSRV9fKi8KCgogICAgICAgICAgICAgIHJlYWN0LmNyZWF0ZUVsZW1lbnQoImRpdiIsIHsgY2xhc3NOYW1lOiAiaG92ZXJCb3giIH0sIC8qI19fUFVSRV9fKi8KICAgICAgICAgICAgICByZWFjdC5jcmVhdGVFbGVtZW50KCJzbWFsbCIsIHsgY2xhc3NOYW1lOiAic2V0dGluZ0RlZmF1bHRIb3ZlciIgfSwKICAgICAgICAgICAgICBidXR0b25bImRlZmF1bHQiXSAhPSBudWxsID8KICAgICAgICAgICAgICAiRGVmYXVsdDogIiArICgKICAgICAgICAgICAgICBidXR0b25bImRlZmF1bHQiXSA9PSAiIiA/ICI8RW1wdHk+IiA6IGJ1dHRvblsiZGVmYXVsdCJdKSA6CiAgICAgICAgICAgICAgIkRlZmF1bHQgbm90IHNldCIpKSksIC8qI19fUFVSRV9fKi8KCgoKICAgICAgICAgICAgICByZWFjdC5jcmVhdGVFbGVtZW50KCJ0ZCIsIG51bGwsIGJ1dHRvbi5kZXNjcmlwdGlvbikpKTsKCgogICAgICAgICAgfQoKICAgICAgICAgIC8qIGhhcm1vbnkgZGVmYXVsdCBleHBvcnQgKi92YXIgc2V0dGluZ3NfU2V0dGluZyA9IFNldHRpbmc7CiAgICAgICAgICA7IC8vIENPTkNBVEVOQVRFRCBNT0RVTEU6IC4vc3JjL3JlbGF5L3JvdXRlcy9SZWxheVBhZ2UudHN4CiAgICAgICAgICBmdW5jdGlvbiBSZWxheVBhZ2VfY3JlYXRlRm9yT2ZJdGVyYXRvckhlbHBlcihvLCBhbGxvd0FycmF5TGlrZSkge3ZhciBpdCA9IHR5cGVvZiBTeW1ib2wgIT09ICJ1bmRlZmluZWQiICYmIG9bU3ltYm9sLml0ZXJhdG9yXSB8fCBvWyJAQGl0ZXJhdG9yIl07aWYgKCFpdCkge2lmIChBcnJheS5pc0FycmF5KG8pIHx8IChpdCA9IFJlbGF5UGFnZV91bnN1cHBvcnRlZEl0ZXJhYmxlVG9BcnJheShvKSkgfHwgYWxsb3dBcnJheUxpa2UgJiYgbyAmJiB0eXBlb2Ygby5sZW5ndGggPT09ICJudW1iZXIiKSB7aWYgKGl0KSBvID0gaXQ7dmFyIGkgPSAwO3ZhciBGID0gZnVuY3Rpb24gRigpIHt9O3JldHVybiB7IHM6IEYsIG46IGZ1bmN0aW9uIG4oKSB7aWYgKGkgPj0gby5sZW5ndGgpIHJldHVybiB7IGRvbmU6IHRydWUgfTtyZXR1cm4geyBkb25lOiBmYWxzZSwgdmFsdWU6IG9baSsrXSB9O30sIGU6IGZ1bmN0aW9uIGUoX2UpIHt0aHJvdyBfZTt9LCBmOiBGIH07fXRocm93IG5ldyBUeXBlRXJyb3IoIkludmFsaWQgYXR0ZW1wdCB0byBpdGVyYXRlIG5vbi1pdGVyYWJsZSBpbnN0YW5jZS5cbkluIG9yZGVyIHRvIGJlIGl0ZXJhYmxlLCBub24tYXJyYXkgb2JqZWN0cyBtdXN0IGhhdmUgYSBbU3ltYm9sLml0ZXJhdG9yXSgpIG1ldGhvZC4iKTt9dmFyIG5vcm1hbENvbXBsZXRpb24gPSB0cnVlLGRpZEVyciA9IGZhbHNlLGVycjtyZXR1cm4geyBzOiBmdW5jdGlvbiBzKCkge2l0ID0gaXQuY2FsbChvKTt9LCBuOiBmdW5jdGlvbiBuKCkge3ZhciBzdGVwID0gaXQubmV4dCgpO25vcm1hbENvbXBsZXRpb24gPSBzdGVwLmRvbmU7cmV0dXJuIHN0ZXA7fSwgZTogZnVuY3Rpb24gZShfZTIpIHtkaWRFcnIgPSB0cnVlO2VyciA9IF9lMjt9LCBmOiBmdW5jdGlvbiBmKCkge3RyeSB7aWYgKCFub3JtYWxDb21wbGV0aW9uICYmIGl0WyJyZXR1cm4iXSAhPSBudWxsKSBpdFsicmV0dXJuIl0oKTt9IGZpbmFsbHkge2lmIChkaWRFcnIpIHRocm93IGVycjt9fSB9O31mdW5jdGlvbiBSZWxheVBhZ2VfdW5zdXBwb3J0ZWRJdGVyYWJsZVRvQXJyYXkobywgbWluTGVuKSB7aWYgKCFvKSByZXR1cm47aWYgKHR5cGVvZiBvID09PSAic3RyaW5nIikgcmV0dXJuIFJlbGF5UGFnZV9hcnJheUxpa2VUb0FycmF5KG8sIG1pbkxlbik7dmFyIG4gPSBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwobykuc2xpY2UoOCwgLTEpO2lmIChuID09PSAiT2JqZWN0IiAmJiBvLmNvbnN0cnVjdG9yKSBuID0gby5jb25zdHJ1Y3Rvci5uYW1lO2lmIChuID09PSAiTWFwIiB8fCBuID09PSAiU2V0IikgcmV0dXJuIEFycmF5LmZyb20obyk7aWYgKG4gPT09ICJBcmd1bWVudHMiIHx8IC9eKD86VWl8SSludCg/Ojh8MTZ8MzIpKD86Q2xhbXBlZCk/QXJyYXkkLy50ZXN0KG4pKSByZXR1cm4gUmVsYXlQYWdlX2FycmF5TGlrZVRvQXJyYXkobywgbWluTGVuKTt9ZnVuY3Rpb24gUmVsYXlQYWdlX2FycmF5TGlrZVRvQXJyYXkoYXJyLCBsZW4pIHtpZiAobGVuID09IG51bGwgfHwgbGVuID4gYXJyLmxlbmd0aCkgbGVuID0gYXJyLmxlbmd0aDtmb3IgKHZhciBpID0gMCwgYXJyMiA9IG5ldyBBcnJheShsZW4pOyBpIDwgbGVuOyBpKyspIGFycjJbaV0gPSBhcnJbaV07cmV0dXJuIGFycjI7fQoKCgoKCgogICAgICAgICAgZnVuY3Rpb24gUmVsYXlQYWdlKF9yZWYpIHt2YXIgcGFnZSA9IF9yZWYucGFnZTsKICAgICAgICAgICAgdmFyIGdyb3VwcyA9IFtdOwogICAgICAgICAgICB2YXIgY3VycmVudEdyb3VwID0gbnVsbDt2YXIgX2l0ZXJhdG9yID0gUmVsYXlQYWdlX2NyZWF0ZUZvck9mSXRlcmF0b3JIZWxwZXIoCgogICAgICAgICAgICAgIHBhZ2UuY29tcG9uZW50cyksX3N0ZXA7dHJ5IHtmb3IgKF9pdGVyYXRvci5zKCk7ICEoX3N0ZXAgPSBfaXRlcmF0b3IubigpKS5kb25lOykge3ZhciBjb21wb25lbnQgPSBfc3RlcC52YWx1ZTsKICAgICAgICAgICAgICAgIGlmICgKICAgICAgICAgICAgICAgIGNvbXBvbmVudC50eXBlID09IFJlbGF5Q29tcG9uZW50VHlwZS5IVE1MIHx8CiAgICAgICAgICAgICAgICBjb21wb25lbnQudHlwZSA9PSBSZWxheUNvbXBvbmVudFR5cGUuSU5URVJSVVBUKQogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICBncm91cHMucHVzaChjb21wb25lbnQpOwogICAgICAgICAgICAgICAgICBjdXJyZW50R3JvdXAgPSBudWxsOwogICAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBpZiAoY3VycmVudEdyb3VwID09IG51bGwpIHsKICAgICAgICAgICAgICAgICAgY3VycmVudEdyb3VwID0gW107CiAgICAgICAgICAgICAgICAgIGdyb3Vwcy5wdXNoKGN1cnJlbnRHcm91cCk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgY3VycmVudEdyb3VwLnB1c2goY29tcG9uZW50KTsKICAgICAgICAgICAgICB9fSBjYXRjaCAoZXJyKSB7X2l0ZXJhdG9yLmUoZXJyKTt9IGZpbmFsbHkge19pdGVyYXRvci5mKCk7fQoKICAgICAgICAgICAgdmFyIGVsZW1lbnRzID0gW107CiAgICAgICAgICAgIHZhciB2YWxpZGF0b3IgPSBuZXcgYXBpX1NldHRpbmdWYWxpZGF0b3IoKTsKCiAgICAgICAgICAgIGdyb3Vwcy5mb3JFYWNoKGZ1bmN0aW9uIChjb21wb25lbnRzKSB7CiAgICAgICAgICAgICAgaWYgKGNvbXBvbmVudHMudHlwZSA9PSBSZWxheUNvbXBvbmVudFR5cGUuSFRNTCkgewogICAgICAgICAgICAgICAgdmFyIGh0bWwgPSBjb21wb25lbnRzOwoKICAgICAgICAgICAgICAgIGlmIChodG1sLmRhdGEgPT0gbnVsbCkgewogICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgZWxlbWVudHMucHVzaCggLyojX19QVVJFX18qLwogICAgICAgICAgICAgICAgcmVhY3QuY3JlYXRlRWxlbWVudCgiZGl2IiwgewogICAgICAgICAgICAgICAgICBkYW5nZXJvdXNseVNldElubmVySFRNTDogewogICAgICAgICAgICAgICAgICAgIF9faHRtbDogY29tcG9uZW50cy5kYXRhCiAgICAgICAgICAgICAgICAgIH0gfSkpOwoKCiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBpZiAoY29tcG9uZW50cy50eXBlID09IFJlbGF5Q29tcG9uZW50VHlwZS5JTlRFUlJVUFQpIHsKICAgICAgICAgICAgICAgIGVsZW1lbnRzLnB1c2goIC8qI19fUFVSRV9fKi8KICAgICAgICAgICAgICAgIHJlYWN0LmNyZWF0ZUVsZW1lbnQoY29tcG9uZW50c19JbnRlcnJ1cHQsIHsgYnV0dG9uOiBjb21wb25lbnRzIH0pKTsKCiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICB2YXIgYnV0dG9ucyA9IGNvbXBvbmVudHM7CgogICAgICAgICAgICAgIGVsZW1lbnRzLnB1c2goIC8qI19fUFVSRV9fKi8KICAgICAgICAgICAgICByZWFjdC5jcmVhdGVFbGVtZW50KCJ0YWJsZSIsIG51bGwsIC8qI19fUFVSRV9fKi8KICAgICAgICAgICAgICByZWFjdC5jcmVhdGVFbGVtZW50KCJ0Ym9keSIsIG51bGwsCiAgICAgICAgICAgICAgYnV0dG9ucy5tYXAoZnVuY3Rpb24gKHNldHRpbmcsIGluZGV4KSB7cmV0dXJuIC8qI19fUFVSRV9fKi8oCiAgICAgICAgICAgICAgICAgIHJlYWN0LmNyZWF0ZUVsZW1lbnQoc2V0dGluZ3NfU2V0dGluZywgeyBrZXk6IGluZGV4LCBidXR0b246IHNldHRpbmcsIHZhbGlkYXRvcjogdmFsaWRhdG9yIH0pKTt9KSkpKTsKCgoKCiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgdmFsaWRhdG9yLnVwZGF0ZU9iamVjdCgpOwoKICAgICAgICAgICAgLy8gSWYgd2UgaGF2ZSBubyBzZXR0aW5ncyBpbiB3aGljaCB3ZSdkIHNhdmUgc3R1ZmYsIGRvbid0IGJvdGhlciByZW5kZXJpbmcgc2F2ZSBidXR0b24KICAgICAgICAgICAgaWYgKAogICAgICAgICAgICBwYWdlLmNvbXBvbmVudHMuZmluZChmdW5jdGlvbiAoYykge3JldHVybiBjLnByZWZlcmVuY2UgIT0gbnVsbDt9KSA9PQogICAgICAgICAgICBudWxsKQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgcmV0dXJuIC8qI19fUFVSRV9fKi9yZWFjdC5jcmVhdGVFbGVtZW50KHJlYWN0LkZyYWdtZW50LCBudWxsLCBlbGVtZW50cyk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybiAvKiNfX1BVUkVfXyovKAogICAgICAgICAgICAgIHJlYWN0LmNyZWF0ZUVsZW1lbnQocmVhY3QuRnJhZ21lbnQsIG51bGwsCiAgICAgICAgICAgICAgIiAiLAogICAgICAgICAgICAgIGVsZW1lbnRzLCAiICIsIC8qI19fUFVSRV9fKi9yZWFjdC5jcmVhdGVFbGVtZW50KCJiciIsIG51bGwpLCAvKiNfX1BVUkVfXyovCiAgICAgICAgICAgICAgcmVhY3QuY3JlYXRlRWxlbWVudCgiaW5wdXQiLCB7CiAgICAgICAgICAgICAgICBjbGFzc05hbWU6ICJzYXZlIiwKICAgICAgICAgICAgICAgIG9uQ2xpY2s6IGZ1bmN0aW9uIG9uQ2xpY2soKSB7cmV0dXJuICgKICAgICAgICAgICAgICAgICAgICBzYXZlU2V0dGluZ3MoCiAgICAgICAgICAgICAgICAgICAgcGFnZS5jb21wb25lbnRzLmZpbHRlcigKICAgICAgICAgICAgICAgICAgICBmdW5jdGlvbiAoYikge3JldHVybiBiLnByZWZlcmVuY2UgIT0gbnVsbDt9KSkuCgogICAgICAgICAgICAgICAgICAgIHRoZW4oZnVuY3Rpb24gKG5vdGlmcykge3ZhciBfaXRlcmF0b3IyID0gUmVsYXlQYWdlX2NyZWF0ZUZvck9mSXRlcmF0b3JIZWxwZXIoCiAgICAgICAgICAgICAgICAgICAgICAgIG5vdGlmcyksX3N0ZXAyO3RyeSB7Zm9yIChfaXRlcmF0b3IyLnMoKTsgIShfc3RlcDIgPSBfaXRlcmF0b3IyLm4oKSkuZG9uZTspIHt2YXIgbm90aWYgPSBfc3RlcDIudmFsdWU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgYWRkTm90aWZpY2F0aW9uKG5vdGlmKTsKICAgICAgICAgICAgICAgICAgICAgICAgfX0gY2F0Y2ggKGVycikge19pdGVyYXRvcjIuZShlcnIpO30gZmluYWxseSB7X2l0ZXJhdG9yMi5mKCk7fQogICAgICAgICAgICAgICAgICAgIH0pKTt9LAoKICAgICAgICAgICAgICAgIHR5cGU6ICJzdWJtaXQiLAogICAgICAgICAgICAgICAgdmFsdWU6ICJTYXZlIENoYW5nZXMiIH0pKSk7CgoKCiAgICAgICAgICB9CgogICAgICAgICAgLyogaGFybW9ueSBkZWZhdWx0IGV4cG9ydCAqL3ZhciByb3V0ZXNfUmVsYXlQYWdlID0gUmVsYXlQYWdlOwogICAgICAgICAgOyAvLyBDT05DQVRFTkFURUQgTU9EVUxFOiAuL3NyYy9yZWxheS9BcHAudHN4CgoKCgoKCiAgICAgICAgICBmdW5jdGlvbiBBcHAoX3JlZikge3ZhciBwYWdlcyA9IF9yZWYucGFnZXM7CiAgICAgICAgICAgIHJldHVybiAvKiNfX1BVUkVfXyovKAogICAgICAgICAgICAgIHJlYWN0LmNyZWF0ZUVsZW1lbnQoTWVtb3J5Um91dGVyLCBudWxsLAogICAgICAgICAgICAgICIgIiwgLyojX19QVVJFX18qLwogICAgICAgICAgICAgIHJlYWN0LmNyZWF0ZUVsZW1lbnQoUm91dGVzLCBudWxsLAogICAgICAgICAgICAgICIgIiwgLyojX19QVVJFX18qLwogICAgICAgICAgICAgIHJlYWN0LmNyZWF0ZUVsZW1lbnQoUm91dGUsIHsgZWxlbWVudDogLyojX19QVVJFX18qL3JlYWN0LmNyZWF0ZUVsZW1lbnQoY29tcG9uZW50c19MYXlvdXQsIHsgcGFnZXM6IHBhZ2VzIH0pIH0sCiAgICAgICAgICAgICAgIiAiLCAvKiNfX1BVUkVfXyovCiAgICAgICAgICAgICAgcmVhY3QuY3JlYXRlRWxlbWVudChSb3V0ZSwgewogICAgICAgICAgICAgICAgcGF0aDogIi8iLAogICAgICAgICAgICAgICAgZWxlbWVudDogLyojX19QVVJFX18qL3JlYWN0LmNyZWF0ZUVsZW1lbnQoTmF2aWdhdGUsIHsgdG86ICIvIiArIHBhZ2VzWzBdLmZpbGUsIHJlcGxhY2U6IHRydWUgfSkgfSksCiAgICAgICAgICAgICAgIiAiLAogICAgICAgICAgICAgIHBhZ2VzLm1hcChmdW5jdGlvbiAocCwgaW5kZXgpIHsKICAgICAgICAgICAgICAgIHJldHVybiAvKiNfX1BVUkVfXyovKAogICAgICAgICAgICAgICAgICByZWFjdC5jcmVhdGVFbGVtZW50KFJvdXRlLCB7CiAgICAgICAgICAgICAgICAgICAga2V5OiBpbmRleCwKICAgICAgICAgICAgICAgICAgICBwYXRoOiAiLyIgKyBwLmZpbGUsCiAgICAgICAgICAgICAgICAgICAgZWxlbWVudDogLyojX19QVVJFX18qL3JlYWN0LmNyZWF0ZUVsZW1lbnQocm91dGVzX1JlbGF5UGFnZSwgeyBwYWdlOiBwIH0pIH0pKTsKCgogICAgICAgICAgICAgIH0pLCAiICIpLAogICAgICAgICAgICAgICIgIiksCiAgICAgICAgICAgICAgIiAiKSk7CgoKICAgICAgICAgIH0KCiAgICAgICAgICAvKiBoYXJtb255IGRlZmF1bHQgZXhwb3J0ICovdmFyIHJlbGF5X0FwcCA9IEFwcDsKCiAgICAgICAgICAvKioqL30sCgogICAgICAgIC8qKiovNDQ4OgogICAgICAgIC8qKiovKF9fdW51c2VkX3dlYnBhY2tfbW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSA9PiB7CgogICAgICAgICAgLyoqCiAgICAgICAgICAgKiBAbGljZW5zZSBSZWFjdAogICAgICAgICAgICogcmVhY3QtZG9tLnByb2R1Y3Rpb24ubWluLmpzCiAgICAgICAgICAgKgogICAgICAgICAgICogQ29weXJpZ2h0IChjKSBGYWNlYm9vaywgSW5jLiBhbmQgaXRzIGFmZmlsaWF0ZXMuCiAgICAgICAgICAgKgogICAgICAgICAgICogVGhpcyBzb3VyY2UgY29kZSBpcyBsaWNlbnNlZCB1bmRlciB0aGUgTUlUIGxpY2Vuc2UgZm91bmQgaW4gdGhlCiAgICAgICAgICAgKiBMSUNFTlNFIGZpbGUgaW4gdGhlIHJvb3QgZGlyZWN0b3J5IG9mIHRoaXMgc291cmNlIHRyZWUuCiAgICAgICAgICAgKi8KICAgICAgICAgIC8qCiAgICAgICAgICAgTW9kZXJuaXpyIDMuMC4wcHJlIChDdXN0b20gQnVpbGQpIHwgTUlUCiAgICAgICAgICAqLwogICAgICAgICAgdmFyIGFhID0gX193ZWJwYWNrX3JlcXVpcmVfXygyOTQpLGNhID0gX193ZWJwYWNrX3JlcXVpcmVfXyg4NDApO2Z1bmN0aW9uIHAoYSkge2ZvciAodmFyIGIgPSAiaHR0cHM6Ly9yZWFjdGpzLm9yZy9kb2NzL2Vycm9yLWRlY29kZXIuaHRtbD9pbnZhcmlhbnQ9IiArIGEsIGMgPSAxOyBjIDwgYXJndW1lbnRzLmxlbmd0aDsgYysrKSBiICs9ICImYXJnc1tdPSIgKyBlbmNvZGVVUklDb21wb25lbnQoYXJndW1lbnRzW2NdKTtyZXR1cm4gIk1pbmlmaWVkIFJlYWN0IGVycm9yICMiICsgYSArICI7IHZpc2l0ICIgKyBiICsgIiBmb3IgdGhlIGZ1bGwgbWVzc2FnZSBvciB1c2UgdGhlIG5vbi1taW5pZmllZCBkZXYgZW52aXJvbm1lbnQgZm9yIGZ1bGwgZXJyb3JzIGFuZCBhZGRpdGlvbmFsIGhlbHBmdWwgd2FybmluZ3MuIjt9dmFyIGRhID0gbmV3IFNldCgpLGVhID0ge307ZnVuY3Rpb24gZmEoYSwgYikge2hhKGEsIGIpO2hhKGEgKyAiQ2FwdHVyZSIsIGIpO30KICAgICAgICAgIGZ1bmN0aW9uIGhhKGEsIGIpIHtlYVthXSA9IGI7Zm9yIChhID0gMDsgYSA8IGIubGVuZ3RoOyBhKyspIGRhLmFkZChiW2FdKTt9CiAgICAgICAgICB2YXIgaWEgPSAhKCJ1bmRlZmluZWQiID09PSB0eXBlb2Ygd2luZG93IHx8ICJ1bmRlZmluZWQiID09PSB0eXBlb2Ygd2luZG93LmRvY3VtZW50IHx8ICJ1bmRlZmluZWQiID09PSB0eXBlb2Ygd2luZG93LmRvY3VtZW50LmNyZWF0ZUVsZW1lbnQpLGphID0gT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eSxrYSA9IC9eWzpBLVpfYS16XHUwMEMwLVx1MDBENlx1MDBEOC1cdTAwRjZcdTAwRjgtXHUwMkZGXHUwMzcwLVx1MDM3RFx1MDM3Ri1cdTFGRkZcdTIwMEMtXHUyMDBEXHUyMDcwLVx1MjE4Rlx1MkMwMC1cdTJGRUZcdTMwMDEtXHVEN0ZGXHVGOTAwLVx1RkRDRlx1RkRGMC1cdUZGRkRdWzpBLVpfYS16XHUwMEMwLVx1MDBENlx1MDBEOC1cdTAwRjZcdTAwRjgtXHUwMkZGXHUwMzcwLVx1MDM3RFx1MDM3Ri1cdTFGRkZcdTIwMEMtXHUyMDBEXHUyMDcwLVx1MjE4Rlx1MkMwMC1cdTJGRUZcdTMwMDEtXHVEN0ZGXHVGOTAwLVx1RkRDRlx1RkRGMC1cdUZGRkRcLS4wLTlcdTAwQjdcdTAzMDAtXHUwMzZGXHUyMDNGLVx1MjA0MF0qJC8sbGEgPQogICAgICAgICAgICB7fSxtYSA9IHt9O2Z1bmN0aW9uIG9hKGEpIHtpZiAoamEuY2FsbChtYSwgYSkpIHJldHVybiAhMDtpZiAoamEuY2FsbChsYSwgYSkpIHJldHVybiAhMTtpZiAoa2EudGVzdChhKSkgcmV0dXJuIG1hW2FdID0gITA7bGFbYV0gPSAhMDtyZXR1cm4gITE7fWZ1bmN0aW9uIHBhKGEsIGIsIGMsIGQpIHtpZiAobnVsbCAhPT0gYyAmJiAwID09PSBjLnR5cGUpIHJldHVybiAhMTtzd2l0Y2ggKHR5cGVvZiBiKSB7Y2FzZSAiZnVuY3Rpb24iOmNhc2UgInN5bWJvbCI6cmV0dXJuICEwO2Nhc2UgImJvb2xlYW4iOmlmIChkKSByZXR1cm4gITE7aWYgKG51bGwgIT09IGMpIHJldHVybiAhYy5hY2NlcHRzQm9vbGVhbnM7YSA9IGEudG9Mb3dlckNhc2UoKS5zbGljZSgwLCA1KTtyZXR1cm4gImRhdGEtIiAhPT0gYSAmJiAiYXJpYS0iICE9PSBhO2RlZmF1bHQ6cmV0dXJuICExO319CiAgICAgICAgICBmdW5jdGlvbiBxYShhLCBiLCBjLCBkKSB7aWYgKG51bGwgPT09IGIgfHwgInVuZGVmaW5lZCIgPT09IHR5cGVvZiBiIHx8IHBhKGEsIGIsIGMsIGQpKSByZXR1cm4gITA7aWYgKGQpIHJldHVybiAhMTtpZiAobnVsbCAhPT0gYykgc3dpdGNoIChjLnR5cGUpIHtjYXNlIDM6cmV0dXJuICFiO2Nhc2UgNDpyZXR1cm4gITEgPT09IGI7Y2FzZSA1OnJldHVybiBpc05hTihiKTtjYXNlIDY6cmV0dXJuIGlzTmFOKGIpIHx8IDEgPiBiO31yZXR1cm4gITE7fWZ1bmN0aW9uIHYoYSwgYiwgYywgZCwgZSwgZiwgZykge3RoaXMuYWNjZXB0c0Jvb2xlYW5zID0gMiA9PT0gYiB8fCAzID09PSBiIHx8IDQgPT09IGI7dGhpcy5hdHRyaWJ1dGVOYW1lID0gZDt0aGlzLmF0dHJpYnV0ZU5hbWVzcGFjZSA9IGU7dGhpcy5tdXN0VXNlUHJvcGVydHkgPSBjO3RoaXMucHJvcGVydHlOYW1lID0gYTt0aGlzLnR5cGUgPSBiO3RoaXMuc2FuaXRpemVVUkwgPSBmO3RoaXMucmVtb3ZlRW1wdHlTdHJpbmcgPSBnO312YXIgeiA9IHt9OwogICAgICAgICAgImNoaWxkcmVuIGRhbmdlcm91c2x5U2V0SW5uZXJIVE1MIGRlZmF1bHRWYWx1ZSBkZWZhdWx0Q2hlY2tlZCBpbm5lckhUTUwgc3VwcHJlc3NDb250ZW50RWRpdGFibGVXYXJuaW5nIHN1cHByZXNzSHlkcmF0aW9uV2FybmluZyBzdHlsZSIuc3BsaXQoIiAiKS5mb3JFYWNoKGZ1bmN0aW9uIChhKSB7elthXSA9IG5ldyB2KGEsIDAsICExLCBhLCBudWxsLCAhMSwgITEpO30pO1tbImFjY2VwdENoYXJzZXQiLCAiYWNjZXB0LWNoYXJzZXQiXSwgWyJjbGFzc05hbWUiLCAiY2xhc3MiXSwgWyJodG1sRm9yIiwgImZvciJdLCBbImh0dHBFcXVpdiIsICJodHRwLWVxdWl2Il1dLmZvckVhY2goZnVuY3Rpb24gKGEpIHt2YXIgYiA9IGFbMF07eltiXSA9IG5ldyB2KGIsIDEsICExLCBhWzFdLCBudWxsLCAhMSwgITEpO30pO1siY29udGVudEVkaXRhYmxlIiwgImRyYWdnYWJsZSIsICJzcGVsbENoZWNrIiwgInZhbHVlIl0uZm9yRWFjaChmdW5jdGlvbiAoYSkge3pbYV0gPSBuZXcgdihhLCAyLCAhMSwgYS50b0xvd2VyQ2FzZSgpLCBudWxsLCAhMSwgITEpO30pOwogICAgICAgICAgWyJhdXRvUmV2ZXJzZSIsICJleHRlcm5hbFJlc291cmNlc1JlcXVpcmVkIiwgImZvY3VzYWJsZSIsICJwcmVzZXJ2ZUFscGhhIl0uZm9yRWFjaChmdW5jdGlvbiAoYSkge3pbYV0gPSBuZXcgdihhLCAyLCAhMSwgYSwgbnVsbCwgITEsICExKTt9KTsiYWxsb3dGdWxsU2NyZWVuIGFzeW5jIGF1dG9Gb2N1cyBhdXRvUGxheSBjb250cm9scyBkZWZhdWx0IGRlZmVyIGRpc2FibGVkIGRpc2FibGVQaWN0dXJlSW5QaWN0dXJlIGRpc2FibGVSZW1vdGVQbGF5YmFjayBmb3JtTm9WYWxpZGF0ZSBoaWRkZW4gbG9vcCBub01vZHVsZSBub1ZhbGlkYXRlIG9wZW4gcGxheXNJbmxpbmUgcmVhZE9ubHkgcmVxdWlyZWQgcmV2ZXJzZWQgc2NvcGVkIHNlYW1sZXNzIGl0ZW1TY29wZSIuc3BsaXQoIiAiKS5mb3JFYWNoKGZ1bmN0aW9uIChhKSB7elthXSA9IG5ldyB2KGEsIDMsICExLCBhLnRvTG93ZXJDYXNlKCksIG51bGwsICExLCAhMSk7fSk7CiAgICAgICAgICBbImNoZWNrZWQiLCAibXVsdGlwbGUiLCAibXV0ZWQiLCAic2VsZWN0ZWQiXS5mb3JFYWNoKGZ1bmN0aW9uIChhKSB7elthXSA9IG5ldyB2KGEsIDMsICEwLCBhLCBudWxsLCAhMSwgITEpO30pO1siY2FwdHVyZSIsICJkb3dubG9hZCJdLmZvckVhY2goZnVuY3Rpb24gKGEpIHt6W2FdID0gbmV3IHYoYSwgNCwgITEsIGEsIG51bGwsICExLCAhMSk7fSk7WyJjb2xzIiwgInJvd3MiLCAic2l6ZSIsICJzcGFuIl0uZm9yRWFjaChmdW5jdGlvbiAoYSkge3pbYV0gPSBuZXcgdihhLCA2LCAhMSwgYSwgbnVsbCwgITEsICExKTt9KTtbInJvd1NwYW4iLCAic3RhcnQiXS5mb3JFYWNoKGZ1bmN0aW9uIChhKSB7elthXSA9IG5ldyB2KGEsIDUsICExLCBhLnRvTG93ZXJDYXNlKCksIG51bGwsICExLCAhMSk7fSk7dmFyIHJhID0gL1tcLTpdKFthLXpdKS9nO2Z1bmN0aW9uIHNhKGEpIHtyZXR1cm4gYVsxXS50b1VwcGVyQ2FzZSgpO30KICAgICAgICAgICJhY2NlbnQtaGVpZ2h0IGFsaWdubWVudC1iYXNlbGluZSBhcmFiaWMtZm9ybSBiYXNlbGluZS1zaGlmdCBjYXAtaGVpZ2h0IGNsaXAtcGF0aCBjbGlwLXJ1bGUgY29sb3ItaW50ZXJwb2xhdGlvbiBjb2xvci1pbnRlcnBvbGF0aW9uLWZpbHRlcnMgY29sb3ItcHJvZmlsZSBjb2xvci1yZW5kZXJpbmcgZG9taW5hbnQtYmFzZWxpbmUgZW5hYmxlLWJhY2tncm91bmQgZmlsbC1vcGFjaXR5IGZpbGwtcnVsZSBmbG9vZC1jb2xvciBmbG9vZC1vcGFjaXR5IGZvbnQtZmFtaWx5IGZvbnQtc2l6ZSBmb250LXNpemUtYWRqdXN0IGZvbnQtc3RyZXRjaCBmb250LXN0eWxlIGZvbnQtdmFyaWFudCBmb250LXdlaWdodCBnbHlwaC1uYW1lIGdseXBoLW9yaWVudGF0aW9uLWhvcml6b250YWwgZ2x5cGgtb3JpZW50YXRpb24tdmVydGljYWwgaG9yaXotYWR2LXggaG9yaXotb3JpZ2luLXggaW1hZ2UtcmVuZGVyaW5nIGxldHRlci1zcGFjaW5nIGxpZ2h0aW5nLWNvbG9yIG1hcmtlci1lbmQgbWFya2VyLW1pZCBtYXJrZXItc3RhcnQgb3ZlcmxpbmUtcG9zaXRpb24gb3ZlcmxpbmUtdGhpY2tuZXNzIHBhaW50LW9yZGVyIHBhbm9zZS0xIHBvaW50ZXItZXZlbnRzIHJlbmRlcmluZy1pbnRlbnQgc2hhcGUtcmVuZGVyaW5nIHN0b3AtY29sb3Igc3RvcC1vcGFjaXR5IHN0cmlrZXRocm91Z2gtcG9zaXRpb24gc3RyaWtldGhyb3VnaC10aGlja25lc3Mgc3Ryb2tlLWRhc2hhcnJheSBzdHJva2UtZGFzaG9mZnNldCBzdHJva2UtbGluZWNhcCBzdHJva2UtbGluZWpvaW4gc3Ryb2tlLW1pdGVybGltaXQgc3Ryb2tlLW9wYWNpdHkgc3Ryb2tlLXdpZHRoIHRleHQtYW5jaG9yIHRleHQtZGVjb3JhdGlvbiB0ZXh0LXJlbmRlcmluZyB1bmRlcmxpbmUtcG9zaXRpb24gdW5kZXJsaW5lLXRoaWNrbmVzcyB1bmljb2RlLWJpZGkgdW5pY29kZS1yYW5nZSB1bml0cy1wZXItZW0gdi1hbHBoYWJldGljIHYtaGFuZ2luZyB2LWlkZW9ncmFwaGljIHYtbWF0aGVtYXRpY2FsIHZlY3Rvci1lZmZlY3QgdmVydC1hZHYteSB2ZXJ0LW9yaWdpbi14IHZlcnQtb3JpZ2luLXkgd29yZC1zcGFjaW5nIHdyaXRpbmctbW9kZSB4bWxuczp4bGluayB4LWhlaWdodCIuc3BsaXQoIiAiKS5mb3JFYWNoKGZ1bmN0aW9uIChhKSB7dmFyIGIgPSBhLnJlcGxhY2UocmEsCiAgICAgICAgICAgIHNhKTt6W2JdID0gbmV3IHYoYiwgMSwgITEsIGEsIG51bGwsICExLCAhMSk7fSk7InhsaW5rOmFjdHVhdGUgeGxpbms6YXJjcm9sZSB4bGluazpyb2xlIHhsaW5rOnNob3cgeGxpbms6dGl0bGUgeGxpbms6dHlwZSIuc3BsaXQoIiAiKS5mb3JFYWNoKGZ1bmN0aW9uIChhKSB7dmFyIGIgPSBhLnJlcGxhY2UocmEsIHNhKTt6W2JdID0gbmV3IHYoYiwgMSwgITEsIGEsICJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiwgITEsICExKTt9KTtbInhtbDpiYXNlIiwgInhtbDpsYW5nIiwgInhtbDpzcGFjZSJdLmZvckVhY2goZnVuY3Rpb24gKGEpIHt2YXIgYiA9IGEucmVwbGFjZShyYSwgc2EpO3pbYl0gPSBuZXcgdihiLCAxLCAhMSwgYSwgImh0dHA6Ly93d3cudzMub3JnL1hNTC8xOTk4L25hbWVzcGFjZSIsICExLCAhMSk7fSk7WyJ0YWJJbmRleCIsICJjcm9zc09yaWdpbiJdLmZvckVhY2goZnVuY3Rpb24gKGEpIHt6W2FdID0gbmV3IHYoYSwgMSwgITEsIGEudG9Mb3dlckNhc2UoKSwgbnVsbCwgITEsICExKTt9KTsKICAgICAgICAgIHoueGxpbmtIcmVmID0gbmV3IHYoInhsaW5rSHJlZiIsIDEsICExLCAieGxpbms6aHJlZiIsICJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiwgITAsICExKTtbInNyYyIsICJocmVmIiwgImFjdGlvbiIsICJmb3JtQWN0aW9uIl0uZm9yRWFjaChmdW5jdGlvbiAoYSkge3pbYV0gPSBuZXcgdihhLCAxLCAhMSwgYS50b0xvd2VyQ2FzZSgpLCBudWxsLCAhMCwgITApO30pOwogICAgICAgICAgZnVuY3Rpb24gdGEoYSwgYiwgYywgZCkge3ZhciBlID0gei5oYXNPd25Qcm9wZXJ0eShiKSA/IHpbYl0gOiBudWxsO2lmIChudWxsICE9PSBlID8gMCAhPT0gZS50eXBlIDogZCB8fCAhKDIgPCBiLmxlbmd0aCkgfHwgIm8iICE9PSBiWzBdICYmICJPIiAhPT0gYlswXSB8fCAibiIgIT09IGJbMV0gJiYgIk4iICE9PSBiWzFdKSBxYShiLCBjLCBlLCBkKSAmJiAoYyA9IG51bGwpLCBkIHx8IG51bGwgPT09IGUgPyBvYShiKSAmJiAobnVsbCA9PT0gYyA/IGEucmVtb3ZlQXR0cmlidXRlKGIpIDogYS5zZXRBdHRyaWJ1dGUoYiwgIiIgKyBjKSkgOiBlLm11c3RVc2VQcm9wZXJ0eSA/IGFbZS5wcm9wZXJ0eU5hbWVdID0gbnVsbCA9PT0gYyA/IDMgPT09IGUudHlwZSA/ICExIDogIiIgOiBjIDogKGIgPSBlLmF0dHJpYnV0ZU5hbWUsIGQgPSBlLmF0dHJpYnV0ZU5hbWVzcGFjZSwgbnVsbCA9PT0gYyA/IGEucmVtb3ZlQXR0cmlidXRlKGIpIDogKGUgPSBlLnR5cGUsIGMgPSAzID09PSBlIHx8IDQgPT09IGUgJiYgITAgPT09IGMgPyAiIiA6ICIiICsgYywgZCA/IGEuc2V0QXR0cmlidXRlTlMoZCwgYiwgYykgOiBhLnNldEF0dHJpYnV0ZShiLCBjKSkpO30KICAgICAgICAgIHZhciB1YSA9IGFhLl9fU0VDUkVUX0lOVEVSTkFMU19ET19OT1RfVVNFX09SX1lPVV9XSUxMX0JFX0ZJUkVELHZhID0gU3ltYm9sLmZvcigicmVhY3QuZWxlbWVudCIpLHdhID0gU3ltYm9sLmZvcigicmVhY3QucG9ydGFsIikseWEgPSBTeW1ib2wuZm9yKCJyZWFjdC5mcmFnbWVudCIpLHphID0gU3ltYm9sLmZvcigicmVhY3Quc3RyaWN0X21vZGUiKSxBYSA9IFN5bWJvbC5mb3IoInJlYWN0LnByb2ZpbGVyIiksQmEgPSBTeW1ib2wuZm9yKCJyZWFjdC5wcm92aWRlciIpLENhID0gU3ltYm9sLmZvcigicmVhY3QuY29udGV4dCIpLERhID0gU3ltYm9sLmZvcigicmVhY3QuZm9yd2FyZF9yZWYiKSxFYSA9IFN5bWJvbC5mb3IoInJlYWN0LnN1c3BlbnNlIiksRmEgPSBTeW1ib2wuZm9yKCJyZWFjdC5zdXNwZW5zZV9saXN0IiksR2EgPSBTeW1ib2wuZm9yKCJyZWFjdC5tZW1vIiksSGEgPSBTeW1ib2wuZm9yKCJyZWFjdC5sYXp5Iik7U3ltYm9sLmZvcigicmVhY3Quc2NvcGUiKTtTeW1ib2wuZm9yKCJyZWFjdC5kZWJ1Z190cmFjZV9tb2RlIik7CiAgICAgICAgICB2YXIgSWEgPSBTeW1ib2wuZm9yKCJyZWFjdC5vZmZzY3JlZW4iKTtTeW1ib2wuZm9yKCJyZWFjdC5sZWdhY3lfaGlkZGVuIik7U3ltYm9sLmZvcigicmVhY3QuY2FjaGUiKTtTeW1ib2wuZm9yKCJyZWFjdC50cmFjaW5nX21hcmtlciIpO3ZhciBKYSA9IFN5bWJvbC5pdGVyYXRvcjtmdW5jdGlvbiBLYShhKSB7aWYgKG51bGwgPT09IGEgfHwgIm9iamVjdCIgIT09IHR5cGVvZiBhKSByZXR1cm4gbnVsbDthID0gSmEgJiYgYVtKYV0gfHwgYVsiQEBpdGVyYXRvciJdO3JldHVybiAiZnVuY3Rpb24iID09PSB0eXBlb2YgYSA/IGEgOiBudWxsO312YXIgQSA9IE9iamVjdC5hc3NpZ24sTGE7ZnVuY3Rpb24gTWEoYSkge2lmICh2b2lkIDAgPT09IExhKSB0cnkge3Rocm93IEVycm9yKCk7fSBjYXRjaCAoYykge3ZhciBiID0gYy5zdGFjay50cmltKCkubWF0Y2goL1xuKCAqKGF0ICk/KS8pO0xhID0gYiAmJiBiWzFdIHx8ICIiO31yZXR1cm4gIlxuIiArIExhICsgYTt9dmFyIE5hID0gITE7CiAgICAgICAgICBmdW5jdGlvbiBPYShhLCBiKSB7aWYgKCFhIHx8IE5hKSByZXR1cm4gIiI7TmEgPSAhMDt2YXIgYyA9IEVycm9yLnByZXBhcmVTdGFja1RyYWNlO0Vycm9yLnByZXBhcmVTdGFja1RyYWNlID0gdm9pZCAwO3RyeSB7aWYgKGIpIHtpZiAoYiA9IGZ1bmN0aW9uIGIoKSB7dGhyb3cgRXJyb3IoKTt9LCBPYmplY3QuZGVmaW5lUHJvcGVydHkoYi5wcm90b3R5cGUsICJwcm9wcyIsIHsgc2V0OiBmdW5jdGlvbiBzZXQoKSB7dGhyb3cgRXJyb3IoKTt9IH0pLCAib2JqZWN0IiA9PT0gdHlwZW9mIFJlZmxlY3QgJiYgUmVmbGVjdC5jb25zdHJ1Y3QpIHt0cnkge1JlZmxlY3QuY29uc3RydWN0KGIsIFtdKTt9IGNhdGNoIChsKSB7dmFyIGQgPSBsO31SZWZsZWN0LmNvbnN0cnVjdChhLCBbXSwgYik7fSBlbHNlIHt0cnkge2IuY2FsbCgpO30gY2F0Y2ggKGwpIHtkID0gbDt9YS5jYWxsKGIucHJvdG90eXBlKTt9fSBlbHNlIHt0cnkge3Rocm93IEVycm9yKCk7fSBjYXRjaCAobCkge2QgPSBsO31hKCk7fX0gY2F0Y2ggKGwpIHtpZiAobCAmJiBkICYmICJzdHJpbmciID09PSB0eXBlb2YgbC5zdGFjaykge2ZvciAodmFyIGUgPSBsLnN0YWNrLnNwbGl0KCJcbiIpLAogICAgICAgICAgICAgICAgICBmID0gZC5zdGFjay5zcGxpdCgiXG4iKSwgZyA9IGUubGVuZ3RoIC0gMSwgaCA9IGYubGVuZ3RoIC0gMTsgMSA8PSBnICYmIDAgPD0gaCAmJiBlW2ddICE9PSBmW2hdOykgaC0tO2ZvciAoOyAxIDw9IGcgJiYgMCA8PSBoOyBnLS0sIGgtLSkgaWYgKGVbZ10gIT09IGZbaF0pIHtpZiAoMSAhPT0gZyB8fCAxICE9PSBoKSB7ZG8gaWYgKGctLSwgaC0tLCAwID4gaCB8fCBlW2ddICE9PSBmW2hdKSB7dmFyIGsgPSAiXG4iICsgZVtnXS5yZXBsYWNlKCIgYXQgbmV3ICIsICIgYXQgIik7YS5kaXNwbGF5TmFtZSAmJiBrLmluY2x1ZGVzKCI8YW5vbnltb3VzPiIpICYmIChrID0gay5yZXBsYWNlKCI8YW5vbnltb3VzPiIsIGEuZGlzcGxheU5hbWUpKTtyZXR1cm4gazt9IHdoaWxlICgxIDw9IGcgJiYgMCA8PSBoKTt9YnJlYWs7fX19IGZpbmFsbHkge05hID0gITEsIEVycm9yLnByZXBhcmVTdGFja1RyYWNlID0gYzt9cmV0dXJuIChhID0gYSA/IGEuZGlzcGxheU5hbWUgfHwgYS5uYW1lIDogIiIpID8gTWEoYSkgOiAiIjt9CiAgICAgICAgICBmdW5jdGlvbiBQYShhKSB7c3dpdGNoIChhLnRhZykge2Nhc2UgNTpyZXR1cm4gTWEoYS50eXBlKTtjYXNlIDE2OnJldHVybiBNYSgiTGF6eSIpO2Nhc2UgMTM6cmV0dXJuIE1hKCJTdXNwZW5zZSIpO2Nhc2UgMTk6cmV0dXJuIE1hKCJTdXNwZW5zZUxpc3QiKTtjYXNlIDA6Y2FzZSAyOmNhc2UgMTU6cmV0dXJuIGEgPSBPYShhLnR5cGUsICExKSwgYTtjYXNlIDExOnJldHVybiBhID0gT2EoYS50eXBlLnJlbmRlciwgITEpLCBhO2Nhc2UgMTpyZXR1cm4gYSA9IE9hKGEudHlwZSwgITApLCBhO2RlZmF1bHQ6cmV0dXJuICIiO319CiAgICAgICAgICBmdW5jdGlvbiBRYShhKSB7aWYgKG51bGwgPT0gYSkgcmV0dXJuIG51bGw7aWYgKCJmdW5jdGlvbiIgPT09IHR5cGVvZiBhKSByZXR1cm4gYS5kaXNwbGF5TmFtZSB8fCBhLm5hbWUgfHwgbnVsbDtpZiAoInN0cmluZyIgPT09IHR5cGVvZiBhKSByZXR1cm4gYTtzd2l0Y2ggKGEpIHtjYXNlIHlhOnJldHVybiAiRnJhZ21lbnQiO2Nhc2Ugd2E6cmV0dXJuICJQb3J0YWwiO2Nhc2UgQWE6cmV0dXJuICJQcm9maWxlciI7Y2FzZSB6YTpyZXR1cm4gIlN0cmljdE1vZGUiO2Nhc2UgRWE6cmV0dXJuICJTdXNwZW5zZSI7Y2FzZSBGYTpyZXR1cm4gIlN1c3BlbnNlTGlzdCI7fWlmICgib2JqZWN0IiA9PT0gdHlwZW9mIGEpIHN3aXRjaCAoYS4kJHR5cGVvZikge2Nhc2UgQ2E6cmV0dXJuIChhLmRpc3BsYXlOYW1lIHx8ICJDb250ZXh0IikgKyAiLkNvbnN1bWVyIjtjYXNlIEJhOnJldHVybiAoYS5fY29udGV4dC5kaXNwbGF5TmFtZSB8fCAiQ29udGV4dCIpICsgIi5Qcm92aWRlciI7Y2FzZSBEYTp2YXIgYiA9IGEucmVuZGVyO2EgPSBhLmRpc3BsYXlOYW1lO2EgfHwgKGEgPSBiLmRpc3BsYXlOYW1lIHx8CiAgICAgICAgICAgICAgICBiLm5hbWUgfHwgIiIsIGEgPSAiIiAhPT0gYSA/ICJGb3J3YXJkUmVmKCIgKyBhICsgIikiIDogIkZvcndhcmRSZWYiKTtyZXR1cm4gYTtjYXNlIEdhOnJldHVybiBiID0gYS5kaXNwbGF5TmFtZSB8fCBudWxsLCBudWxsICE9PSBiID8gYiA6IFFhKGEudHlwZSkgfHwgIk1lbW8iO2Nhc2UgSGE6YiA9IGEuX3BheWxvYWQ7YSA9IGEuX2luaXQ7dHJ5IHtyZXR1cm4gUWEoYShiKSk7fSBjYXRjaCAoYykge319cmV0dXJuIG51bGw7fQogICAgICAgICAgZnVuY3Rpb24gUmEoYSkge3ZhciBiID0gYS50eXBlO3N3aXRjaCAoYS50YWcpIHtjYXNlIDI0OnJldHVybiAiQ2FjaGUiO2Nhc2UgOTpyZXR1cm4gKGIuZGlzcGxheU5hbWUgfHwgIkNvbnRleHQiKSArICIuQ29uc3VtZXIiO2Nhc2UgMTA6cmV0dXJuIChiLl9jb250ZXh0LmRpc3BsYXlOYW1lIHx8ICJDb250ZXh0IikgKyAiLlByb3ZpZGVyIjtjYXNlIDE4OnJldHVybiAiRGVoeWRyYXRlZEZyYWdtZW50IjtjYXNlIDExOnJldHVybiBhID0gYi5yZW5kZXIsIGEgPSBhLmRpc3BsYXlOYW1lIHx8IGEubmFtZSB8fCAiIiwgYi5kaXNwbGF5TmFtZSB8fCAoIiIgIT09IGEgPyAiRm9yd2FyZFJlZigiICsgYSArICIpIiA6ICJGb3J3YXJkUmVmIik7Y2FzZSA3OnJldHVybiAiRnJhZ21lbnQiO2Nhc2UgNTpyZXR1cm4gYjtjYXNlIDQ6cmV0dXJuICJQb3J0YWwiO2Nhc2UgMzpyZXR1cm4gIlJvb3QiO2Nhc2UgNjpyZXR1cm4gIlRleHQiO2Nhc2UgMTY6cmV0dXJuIFFhKGIpO2Nhc2UgODpyZXR1cm4gYiA9PT0gemEgPyAiU3RyaWN0TW9kZSIgOiAiTW9kZSI7Y2FzZSAyMjpyZXR1cm4gIk9mZnNjcmVlbiI7CiAgICAgICAgICAgICAgY2FzZSAxMjpyZXR1cm4gIlByb2ZpbGVyIjtjYXNlIDIxOnJldHVybiAiU2NvcGUiO2Nhc2UgMTM6cmV0dXJuICJTdXNwZW5zZSI7Y2FzZSAxOTpyZXR1cm4gIlN1c3BlbnNlTGlzdCI7Y2FzZSAyNTpyZXR1cm4gIlRyYWNpbmdNYXJrZXIiO2Nhc2UgMTpjYXNlIDA6Y2FzZSAxNzpjYXNlIDI6Y2FzZSAxNDpjYXNlIDE1OmlmICgiZnVuY3Rpb24iID09PSB0eXBlb2YgYikgcmV0dXJuIGIuZGlzcGxheU5hbWUgfHwgYi5uYW1lIHx8IG51bGw7aWYgKCJzdHJpbmciID09PSB0eXBlb2YgYikgcmV0dXJuIGI7fXJldHVybiBudWxsO31mdW5jdGlvbiBTYShhKSB7c3dpdGNoICh0eXBlb2YgYSkge2Nhc2UgImJvb2xlYW4iOmNhc2UgIm51bWJlciI6Y2FzZSAic3RyaW5nIjpjYXNlICJ1bmRlZmluZWQiOnJldHVybiBhO2Nhc2UgIm9iamVjdCI6cmV0dXJuIGE7ZGVmYXVsdDpyZXR1cm4gIiI7fX0KICAgICAgICAgIGZ1bmN0aW9uIFRhKGEpIHt2YXIgYiA9IGEudHlwZTtyZXR1cm4gKGEgPSBhLm5vZGVOYW1lKSAmJiAiaW5wdXQiID09PSBhLnRvTG93ZXJDYXNlKCkgJiYgKCJjaGVja2JveCIgPT09IGIgfHwgInJhZGlvIiA9PT0gYik7fQogICAgICAgICAgZnVuY3Rpb24gVWEoYSkge3ZhciBiID0gVGEoYSkgPyAiY2hlY2tlZCIgOiAidmFsdWUiLGMgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKGEuY29uc3RydWN0b3IucHJvdG90eXBlLCBiKSxkID0gIiIgKyBhW2JdO2lmICghYS5oYXNPd25Qcm9wZXJ0eShiKSAmJiAidW5kZWZpbmVkIiAhPT0gdHlwZW9mIGMgJiYgImZ1bmN0aW9uIiA9PT0gdHlwZW9mIGMuZ2V0ICYmICJmdW5jdGlvbiIgPT09IHR5cGVvZiBjLnNldCkge3ZhciBlID0gYy5nZXQsZiA9IGMuc2V0O09iamVjdC5kZWZpbmVQcm9wZXJ0eShhLCBiLCB7IGNvbmZpZ3VyYWJsZTogITAsIGdldDogZnVuY3Rpb24gZ2V0KCkge3JldHVybiBlLmNhbGwodGhpcyk7fSwgc2V0OiBmdW5jdGlvbiBzZXQoYSkge2QgPSAiIiArIGE7Zi5jYWxsKHRoaXMsIGEpO30gfSk7T2JqZWN0LmRlZmluZVByb3BlcnR5KGEsIGIsIHsgZW51bWVyYWJsZTogYy5lbnVtZXJhYmxlIH0pO3JldHVybiB7IGdldFZhbHVlOiBmdW5jdGlvbiBnZXRWYWx1ZSgpIHtyZXR1cm4gZDt9LCBzZXRWYWx1ZTogZnVuY3Rpb24gc2V0VmFsdWUoYSkge2QgPSAiIiArIGE7fSwgc3RvcFRyYWNraW5nOiBmdW5jdGlvbiBzdG9wVHJhY2tpbmcoKSB7YS5fdmFsdWVUcmFja2VyID0KICAgICAgICAgICAgICAgICAgbnVsbDtkZWxldGUgYVtiXTt9IH07fX1mdW5jdGlvbiBWYShhKSB7YS5fdmFsdWVUcmFja2VyIHx8IChhLl92YWx1ZVRyYWNrZXIgPSBVYShhKSk7fWZ1bmN0aW9uIFdhKGEpIHtpZiAoIWEpIHJldHVybiAhMTt2YXIgYiA9IGEuX3ZhbHVlVHJhY2tlcjtpZiAoIWIpIHJldHVybiAhMDt2YXIgYyA9IGIuZ2V0VmFsdWUoKTt2YXIgZCA9ICIiO2EgJiYgKGQgPSBUYShhKSA/IGEuY2hlY2tlZCA/ICJ0cnVlIiA6ICJmYWxzZSIgOiBhLnZhbHVlKTthID0gZDtyZXR1cm4gYSAhPT0gYyA/IChiLnNldFZhbHVlKGEpLCAhMCkgOiAhMTt9ZnVuY3Rpb24gWGEoYSkge2EgPSBhIHx8ICgidW5kZWZpbmVkIiAhPT0gdHlwZW9mIGRvY3VtZW50ID8gZG9jdW1lbnQgOiB2b2lkIDApO2lmICgidW5kZWZpbmVkIiA9PT0gdHlwZW9mIGEpIHJldHVybiBudWxsO3RyeSB7cmV0dXJuIGEuYWN0aXZlRWxlbWVudCB8fCBhLmJvZHk7fSBjYXRjaCAoYikge3JldHVybiBhLmJvZHk7fX0KICAgICAgICAgIGZ1bmN0aW9uIFlhKGEsIGIpIHt2YXIgYyA9IGIuY2hlY2tlZDtyZXR1cm4gQSh7fSwgYiwgeyBkZWZhdWx0Q2hlY2tlZDogdm9pZCAwLCBkZWZhdWx0VmFsdWU6IHZvaWQgMCwgdmFsdWU6IHZvaWQgMCwgY2hlY2tlZDogbnVsbCAhPSBjID8gYyA6IGEuX3dyYXBwZXJTdGF0ZS5pbml0aWFsQ2hlY2tlZCB9KTt9ZnVuY3Rpb24gWmEoYSwgYikge3ZhciBjID0gbnVsbCA9PSBiLmRlZmF1bHRWYWx1ZSA/ICIiIDogYi5kZWZhdWx0VmFsdWUsZCA9IG51bGwgIT0gYi5jaGVja2VkID8gYi5jaGVja2VkIDogYi5kZWZhdWx0Q2hlY2tlZDtjID0gU2EobnVsbCAhPSBiLnZhbHVlID8gYi52YWx1ZSA6IGMpO2EuX3dyYXBwZXJTdGF0ZSA9IHsgaW5pdGlhbENoZWNrZWQ6IGQsIGluaXRpYWxWYWx1ZTogYywgY29udHJvbGxlZDogImNoZWNrYm94IiA9PT0gYi50eXBlIHx8ICJyYWRpbyIgPT09IGIudHlwZSA/IG51bGwgIT0gYi5jaGVja2VkIDogbnVsbCAhPSBiLnZhbHVlIH07fWZ1bmN0aW9uIGFiKGEsIGIpIHtiID0gYi5jaGVja2VkO251bGwgIT0gYiAmJiB0YShhLCAiY2hlY2tlZCIsIGIsICExKTt9CiAgICAgICAgICBmdW5jdGlvbiBiYihhLCBiKSB7YWIoYSwgYik7dmFyIGMgPSBTYShiLnZhbHVlKSxkID0gYi50eXBlO2lmIChudWxsICE9IGMpIHtpZiAoIm51bWJlciIgPT09IGQpIHtpZiAoMCA9PT0gYyAmJiAiIiA9PT0gYS52YWx1ZSB8fCBhLnZhbHVlICE9IGMpIGEudmFsdWUgPSAiIiArIGM7fSBlbHNlIGEudmFsdWUgIT09ICIiICsgYyAmJiAoYS52YWx1ZSA9ICIiICsgYyk7fSBlbHNlIGlmICgic3VibWl0IiA9PT0gZCB8fCAicmVzZXQiID09PSBkKSB7YS5yZW1vdmVBdHRyaWJ1dGUoInZhbHVlIik7cmV0dXJuO31iLmhhc093blByb3BlcnR5KCJ2YWx1ZSIpID8gY2IoYSwgYi50eXBlLCBjKSA6IGIuaGFzT3duUHJvcGVydHkoImRlZmF1bHRWYWx1ZSIpICYmIGNiKGEsIGIudHlwZSwgU2EoYi5kZWZhdWx0VmFsdWUpKTtudWxsID09IGIuY2hlY2tlZCAmJiBudWxsICE9IGIuZGVmYXVsdENoZWNrZWQgJiYgKGEuZGVmYXVsdENoZWNrZWQgPSAhIWIuZGVmYXVsdENoZWNrZWQpO30KICAgICAgICAgIGZ1bmN0aW9uIGRiKGEsIGIsIGMpIHtpZiAoYi5oYXNPd25Qcm9wZXJ0eSgidmFsdWUiKSB8fCBiLmhhc093blByb3BlcnR5KCJkZWZhdWx0VmFsdWUiKSkge3ZhciBkID0gYi50eXBlO2lmICghKCJzdWJtaXQiICE9PSBkICYmICJyZXNldCIgIT09IGQgfHwgdm9pZCAwICE9PSBiLnZhbHVlICYmIG51bGwgIT09IGIudmFsdWUpKSByZXR1cm47YiA9ICIiICsgYS5fd3JhcHBlclN0YXRlLmluaXRpYWxWYWx1ZTtjIHx8IGIgPT09IGEudmFsdWUgfHwgKGEudmFsdWUgPSBiKTthLmRlZmF1bHRWYWx1ZSA9IGI7fWMgPSBhLm5hbWU7IiIgIT09IGMgJiYgKGEubmFtZSA9ICIiKTthLmRlZmF1bHRDaGVja2VkID0gISFhLl93cmFwcGVyU3RhdGUuaW5pdGlhbENoZWNrZWQ7IiIgIT09IGMgJiYgKGEubmFtZSA9IGMpO30KICAgICAgICAgIGZ1bmN0aW9uIGNiKGEsIGIsIGMpIHtpZiAoIm51bWJlciIgIT09IGIgfHwgWGEoYS5vd25lckRvY3VtZW50KSAhPT0gYSkgbnVsbCA9PSBjID8gYS5kZWZhdWx0VmFsdWUgPSAiIiArIGEuX3dyYXBwZXJTdGF0ZS5pbml0aWFsVmFsdWUgOiBhLmRlZmF1bHRWYWx1ZSAhPT0gIiIgKyBjICYmIChhLmRlZmF1bHRWYWx1ZSA9ICIiICsgYyk7fXZhciBlYiA9IEFycmF5LmlzQXJyYXk7CiAgICAgICAgICBmdW5jdGlvbiBmYihhLCBiLCBjLCBkKSB7YSA9IGEub3B0aW9ucztpZiAoYikge2IgPSB7fTtmb3IgKHZhciBlID0gMDsgZSA8IGMubGVuZ3RoOyBlKyspIGJbIiQiICsgY1tlXV0gPSAhMDtmb3IgKGMgPSAwOyBjIDwgYS5sZW5ndGg7IGMrKykgZSA9IGIuaGFzT3duUHJvcGVydHkoIiQiICsgYVtjXS52YWx1ZSksIGFbY10uc2VsZWN0ZWQgIT09IGUgJiYgKGFbY10uc2VsZWN0ZWQgPSBlKSwgZSAmJiBkICYmIChhW2NdLmRlZmF1bHRTZWxlY3RlZCA9ICEwKTt9IGVsc2Uge2MgPSAiIiArIFNhKGMpO2IgPSBudWxsO2ZvciAoZSA9IDA7IGUgPCBhLmxlbmd0aDsgZSsrKSB7aWYgKGFbZV0udmFsdWUgPT09IGMpIHthW2VdLnNlbGVjdGVkID0gITA7ZCAmJiAoYVtlXS5kZWZhdWx0U2VsZWN0ZWQgPSAhMCk7cmV0dXJuO31udWxsICE9PSBiIHx8IGFbZV0uZGlzYWJsZWQgfHwgKGIgPSBhW2VdKTt9bnVsbCAhPT0gYiAmJiAoYi5zZWxlY3RlZCA9ICEwKTt9fQogICAgICAgICAgZnVuY3Rpb24gZ2IoYSwgYikge2lmIChudWxsICE9IGIuZGFuZ2Vyb3VzbHlTZXRJbm5lckhUTUwpIHRocm93IEVycm9yKHAoOTEpKTtyZXR1cm4gQSh7fSwgYiwgeyB2YWx1ZTogdm9pZCAwLCBkZWZhdWx0VmFsdWU6IHZvaWQgMCwgY2hpbGRyZW46ICIiICsgYS5fd3JhcHBlclN0YXRlLmluaXRpYWxWYWx1ZSB9KTt9ZnVuY3Rpb24gaGIoYSwgYikge3ZhciBjID0gYi52YWx1ZTtpZiAobnVsbCA9PSBjKSB7YyA9IGIuY2hpbGRyZW47YiA9IGIuZGVmYXVsdFZhbHVlO2lmIChudWxsICE9IGMpIHtpZiAobnVsbCAhPSBiKSB0aHJvdyBFcnJvcihwKDkyKSk7aWYgKGViKGMpKSB7aWYgKDEgPCBjLmxlbmd0aCkgdGhyb3cgRXJyb3IocCg5MykpO2MgPSBjWzBdO31iID0gYzt9bnVsbCA9PSBiICYmIChiID0gIiIpO2MgPSBiO31hLl93cmFwcGVyU3RhdGUgPSB7IGluaXRpYWxWYWx1ZTogU2EoYykgfTt9CiAgICAgICAgICBmdW5jdGlvbiBpYihhLCBiKSB7dmFyIGMgPSBTYShiLnZhbHVlKSxkID0gU2EoYi5kZWZhdWx0VmFsdWUpO251bGwgIT0gYyAmJiAoYyA9ICIiICsgYywgYyAhPT0gYS52YWx1ZSAmJiAoYS52YWx1ZSA9IGMpLCBudWxsID09IGIuZGVmYXVsdFZhbHVlICYmIGEuZGVmYXVsdFZhbHVlICE9PSBjICYmIChhLmRlZmF1bHRWYWx1ZSA9IGMpKTtudWxsICE9IGQgJiYgKGEuZGVmYXVsdFZhbHVlID0gIiIgKyBkKTt9ZnVuY3Rpb24gamIoYSkge3ZhciBiID0gYS50ZXh0Q29udGVudDtiID09PSBhLl93cmFwcGVyU3RhdGUuaW5pdGlhbFZhbHVlICYmICIiICE9PSBiICYmIG51bGwgIT09IGIgJiYgKGEudmFsdWUgPSBiKTt9ZnVuY3Rpb24ga2IoYSkge3N3aXRjaCAoYSkge2Nhc2UgInN2ZyI6cmV0dXJuICJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI7Y2FzZSAibWF0aCI6cmV0dXJuICJodHRwOi8vd3d3LnczLm9yZy8xOTk4L01hdGgvTWF0aE1MIjtkZWZhdWx0OnJldHVybiAiaHR0cDovL3d3dy53My5vcmcvMTk5OS94aHRtbCI7fX0KICAgICAgICAgIGZ1bmN0aW9uIGxiKGEsIGIpIHtyZXR1cm4gbnVsbCA9PSBhIHx8ICJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hodG1sIiA9PT0gYSA/IGtiKGIpIDogImh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiA9PT0gYSAmJiAiZm9yZWlnbk9iamVjdCIgPT09IGIgPyAiaHR0cDovL3d3dy53My5vcmcvMTk5OS94aHRtbCIgOiBhO30KICAgICAgICAgIHZhciBtYixuYiA9IGZ1bmN0aW9uIChhKSB7cmV0dXJuICJ1bmRlZmluZWQiICE9PSB0eXBlb2YgTVNBcHAgJiYgTVNBcHAuZXhlY1Vuc2FmZUxvY2FsRnVuY3Rpb24gPyBmdW5jdGlvbiAoYiwgYywgZCwgZSkge01TQXBwLmV4ZWNVbnNhZmVMb2NhbEZ1bmN0aW9uKGZ1bmN0aW9uICgpIHtyZXR1cm4gYShiLCBjLCBkLCBlKTt9KTt9IDogYTt9KGZ1bmN0aW9uIChhLCBiKSB7aWYgKCJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgIT09IGEubmFtZXNwYWNlVVJJIHx8ICJpbm5lckhUTUwiIGluIGEpIGEuaW5uZXJIVE1MID0gYjtlbHNlIHttYiA9IG1iIHx8IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpO21iLmlubmVySFRNTCA9ICI8c3ZnPiIgKyBiLnZhbHVlT2YoKS50b1N0cmluZygpICsgIjwvc3ZnPiI7Zm9yIChiID0gbWIuZmlyc3RDaGlsZDsgYS5maXJzdENoaWxkOykgYS5yZW1vdmVDaGlsZChhLmZpcnN0Q2hpbGQpO2ZvciAoOyBiLmZpcnN0Q2hpbGQ7KSBhLmFwcGVuZENoaWxkKGIuZmlyc3RDaGlsZCk7fX0pOwogICAgICAgICAgZnVuY3Rpb24gb2IoYSwgYikge2lmIChiKSB7dmFyIGMgPSBhLmZpcnN0Q2hpbGQ7aWYgKGMgJiYgYyA9PT0gYS5sYXN0Q2hpbGQgJiYgMyA9PT0gYy5ub2RlVHlwZSkge2Mubm9kZVZhbHVlID0gYjtyZXR1cm47fX1hLnRleHRDb250ZW50ID0gYjt9CiAgICAgICAgICB2YXIgcGIgPSB7IGFuaW1hdGlvbkl0ZXJhdGlvbkNvdW50OiAhMCwgYXNwZWN0UmF0aW86ICEwLCBib3JkZXJJbWFnZU91dHNldDogITAsIGJvcmRlckltYWdlU2xpY2U6ICEwLCBib3JkZXJJbWFnZVdpZHRoOiAhMCwgYm94RmxleDogITAsIGJveEZsZXhHcm91cDogITAsIGJveE9yZGluYWxHcm91cDogITAsIGNvbHVtbkNvdW50OiAhMCwgY29sdW1uczogITAsIGZsZXg6ICEwLCBmbGV4R3JvdzogITAsIGZsZXhQb3NpdGl2ZTogITAsIGZsZXhTaHJpbms6ICEwLCBmbGV4TmVnYXRpdmU6ICEwLCBmbGV4T3JkZXI6ICEwLCBncmlkQXJlYTogITAsIGdyaWRSb3c6ICEwLCBncmlkUm93RW5kOiAhMCwgZ3JpZFJvd1NwYW46ICEwLCBncmlkUm93U3RhcnQ6ICEwLCBncmlkQ29sdW1uOiAhMCwgZ3JpZENvbHVtbkVuZDogITAsIGdyaWRDb2x1bW5TcGFuOiAhMCwgZ3JpZENvbHVtblN0YXJ0OiAhMCwgZm9udFdlaWdodDogITAsIGxpbmVDbGFtcDogITAsIGxpbmVIZWlnaHQ6ICEwLCBvcGFjaXR5OiAhMCwgb3JkZXI6ICEwLCBvcnBoYW5zOiAhMCwgdGFiU2l6ZTogITAsIHdpZG93czogITAsIHpJbmRleDogITAsCiAgICAgICAgICAgICAgem9vbTogITAsIGZpbGxPcGFjaXR5OiAhMCwgZmxvb2RPcGFjaXR5OiAhMCwgc3RvcE9wYWNpdHk6ICEwLCBzdHJva2VEYXNoYXJyYXk6ICEwLCBzdHJva2VEYXNob2Zmc2V0OiAhMCwgc3Ryb2tlTWl0ZXJsaW1pdDogITAsIHN0cm9rZU9wYWNpdHk6ICEwLCBzdHJva2VXaWR0aDogITAgfSxxYiA9IFsiV2Via2l0IiwgIm1zIiwgIk1veiIsICJPIl07T2JqZWN0LmtleXMocGIpLmZvckVhY2goZnVuY3Rpb24gKGEpIHtxYi5mb3JFYWNoKGZ1bmN0aW9uIChiKSB7YiA9IGIgKyBhLmNoYXJBdCgwKS50b1VwcGVyQ2FzZSgpICsgYS5zdWJzdHJpbmcoMSk7cGJbYl0gPSBwYlthXTt9KTt9KTtmdW5jdGlvbiByYihhLCBiLCBjKSB7cmV0dXJuIG51bGwgPT0gYiB8fCAiYm9vbGVhbiIgPT09IHR5cGVvZiBiIHx8ICIiID09PSBiID8gIiIgOiBjIHx8ICJudW1iZXIiICE9PSB0eXBlb2YgYiB8fCAwID09PSBiIHx8IHBiLmhhc093blByb3BlcnR5KGEpICYmIHBiW2FdID8gKCIiICsgYikudHJpbSgpIDogYiArICJweCI7fQogICAgICAgICAgZnVuY3Rpb24gc2IoYSwgYikge2EgPSBhLnN0eWxlO2ZvciAodmFyIGMgaW4gYikgaWYgKGIuaGFzT3duUHJvcGVydHkoYykpIHt2YXIgZCA9IDAgPT09IGMuaW5kZXhPZigiLS0iKSxlID0gcmIoYywgYltjXSwgZCk7ImZsb2F0IiA9PT0gYyAmJiAoYyA9ICJjc3NGbG9hdCIpO2QgPyBhLnNldFByb3BlcnR5KGMsIGUpIDogYVtjXSA9IGU7fX12YXIgdGIgPSBBKHsgbWVudWl0ZW06ICEwIH0sIHsgYXJlYTogITAsIGJhc2U6ICEwLCBicjogITAsIGNvbDogITAsIGVtYmVkOiAhMCwgaHI6ICEwLCBpbWc6ICEwLCBpbnB1dDogITAsIGtleWdlbjogITAsIGxpbms6ICEwLCBtZXRhOiAhMCwgcGFyYW06ICEwLCBzb3VyY2U6ICEwLCB0cmFjazogITAsIHdicjogITAgfSk7CiAgICAgICAgICBmdW5jdGlvbiB1YihhLCBiKSB7aWYgKGIpIHtpZiAodGJbYV0gJiYgKG51bGwgIT0gYi5jaGlsZHJlbiB8fCBudWxsICE9IGIuZGFuZ2Vyb3VzbHlTZXRJbm5lckhUTUwpKSB0aHJvdyBFcnJvcihwKDEzNywgYSkpO2lmIChudWxsICE9IGIuZGFuZ2Vyb3VzbHlTZXRJbm5lckhUTUwpIHtpZiAobnVsbCAhPSBiLmNoaWxkcmVuKSB0aHJvdyBFcnJvcihwKDYwKSk7aWYgKCJvYmplY3QiICE9PSB0eXBlb2YgYi5kYW5nZXJvdXNseVNldElubmVySFRNTCB8fCAhKCJfX2h0bWwiIGluIGIuZGFuZ2Vyb3VzbHlTZXRJbm5lckhUTUwpKSB0aHJvdyBFcnJvcihwKDYxKSk7fWlmIChudWxsICE9IGIuc3R5bGUgJiYgIm9iamVjdCIgIT09IHR5cGVvZiBiLnN0eWxlKSB0aHJvdyBFcnJvcihwKDYyKSk7fX0KICAgICAgICAgIGZ1bmN0aW9uIHZiKGEsIGIpIHtpZiAoLTEgPT09IGEuaW5kZXhPZigiLSIpKSByZXR1cm4gInN0cmluZyIgPT09IHR5cGVvZiBiLmlzO3N3aXRjaCAoYSkge2Nhc2UgImFubm90YXRpb24teG1sIjpjYXNlICJjb2xvci1wcm9maWxlIjpjYXNlICJmb250LWZhY2UiOmNhc2UgImZvbnQtZmFjZS1zcmMiOmNhc2UgImZvbnQtZmFjZS11cmkiOmNhc2UgImZvbnQtZmFjZS1mb3JtYXQiOmNhc2UgImZvbnQtZmFjZS1uYW1lIjpjYXNlICJtaXNzaW5nLWdseXBoIjpyZXR1cm4gITE7ZGVmYXVsdDpyZXR1cm4gITA7fX12YXIgd2IgPSBudWxsO2Z1bmN0aW9uIHhiKGEpIHthID0gYS50YXJnZXQgfHwgYS5zcmNFbGVtZW50IHx8IHdpbmRvdzthLmNvcnJlc3BvbmRpbmdVc2VFbGVtZW50ICYmIChhID0gYS5jb3JyZXNwb25kaW5nVXNlRWxlbWVudCk7cmV0dXJuIDMgPT09IGEubm9kZVR5cGUgPyBhLnBhcmVudE5vZGUgOiBhO312YXIgeWIgPSBudWxsLHpiID0gbnVsbCxBYiA9IG51bGw7CiAgICAgICAgICBmdW5jdGlvbiBCYihhKSB7aWYgKGEgPSBDYihhKSkge2lmICgiZnVuY3Rpb24iICE9PSB0eXBlb2YgeWIpIHRocm93IEVycm9yKHAoMjgwKSk7dmFyIGIgPSBhLnN0YXRlTm9kZTtiICYmIChiID0gRGIoYiksIHliKGEuc3RhdGVOb2RlLCBhLnR5cGUsIGIpKTt9fWZ1bmN0aW9uIEViKGEpIHt6YiA/IEFiID8gQWIucHVzaChhKSA6IEFiID0gW2FdIDogemIgPSBhO31mdW5jdGlvbiBGYigpIHtpZiAoemIpIHt2YXIgYSA9IHpiLGIgPSBBYjtBYiA9IHpiID0gbnVsbDtCYihhKTtpZiAoYikgZm9yIChhID0gMDsgYSA8IGIubGVuZ3RoOyBhKyspIEJiKGJbYV0pO319ZnVuY3Rpb24gR2IoYSwgYikge3JldHVybiBhKGIpO31mdW5jdGlvbiBIYigpIHt9dmFyIEliID0gITE7ZnVuY3Rpb24gSmIoYSwgYiwgYykge2lmIChJYikgcmV0dXJuIGEoYiwgYyk7SWIgPSAhMDt0cnkge3JldHVybiBHYihhLCBiLCBjKTt9IGZpbmFsbHkge2lmIChJYiA9ICExLCBudWxsICE9PSB6YiB8fCBudWxsICE9PSBBYikgSGIoKSwgRmIoKTt9fQogICAgICAgICAgZnVuY3Rpb24gS2IoYSwgYikge3ZhciBjID0gYS5zdGF0ZU5vZGU7aWYgKG51bGwgPT09IGMpIHJldHVybiBudWxsO3ZhciBkID0gRGIoYyk7aWYgKG51bGwgPT09IGQpIHJldHVybiBudWxsO2MgPSBkW2JdO2E6IHN3aXRjaCAoYikge2Nhc2UgIm9uQ2xpY2siOmNhc2UgIm9uQ2xpY2tDYXB0dXJlIjpjYXNlICJvbkRvdWJsZUNsaWNrIjpjYXNlICJvbkRvdWJsZUNsaWNrQ2FwdHVyZSI6Y2FzZSAib25Nb3VzZURvd24iOmNhc2UgIm9uTW91c2VEb3duQ2FwdHVyZSI6Y2FzZSAib25Nb3VzZU1vdmUiOmNhc2UgIm9uTW91c2VNb3ZlQ2FwdHVyZSI6Y2FzZSAib25Nb3VzZVVwIjpjYXNlICJvbk1vdXNlVXBDYXB0dXJlIjpjYXNlICJvbk1vdXNlRW50ZXIiOihkID0gIWQuZGlzYWJsZWQpIHx8IChhID0gYS50eXBlLCBkID0gISgiYnV0dG9uIiA9PT0gYSB8fCAiaW5wdXQiID09PSBhIHx8ICJzZWxlY3QiID09PSBhIHx8ICJ0ZXh0YXJlYSIgPT09IGEpKTthID0gIWQ7YnJlYWsgYTtkZWZhdWx0OmEgPSAhMTt9aWYgKGEpIHJldHVybiBudWxsO2lmIChjICYmICJmdW5jdGlvbiIgIT09CiAgICAgICAgICAgIHR5cGVvZiBjKSB0aHJvdyBFcnJvcihwKDIzMSwgYiwgdHlwZW9mIGMpKTtyZXR1cm4gYzt9dmFyIExiID0gITE7aWYgKGlhKSB0cnkge3ZhciBNYiA9IHt9O09iamVjdC5kZWZpbmVQcm9wZXJ0eShNYiwgInBhc3NpdmUiLCB7IGdldDogZnVuY3Rpb24gZ2V0KCkge0xiID0gITA7fSB9KTt3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigidGVzdCIsIE1iLCBNYik7d2luZG93LnJlbW92ZUV2ZW50TGlzdGVuZXIoInRlc3QiLCBNYiwgTWIpO30gY2F0Y2ggKGEpIHtMYiA9ICExO31mdW5jdGlvbiBOYihhLCBiLCBjLCBkLCBlLCBmLCBnLCBoLCBrKSB7dmFyIGwgPSBBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChhcmd1bWVudHMsIDMpO3RyeSB7Yi5hcHBseShjLCBsKTt9IGNhdGNoIChtKSB7dGhpcy5vbkVycm9yKG0pO319dmFyIE9iID0gITEsUGIgPSBudWxsLFFiID0gITEsUmIgPSBudWxsLFNiID0geyBvbkVycm9yOiBmdW5jdGlvbiBvbkVycm9yKGEpIHtPYiA9ICEwO1BiID0gYTt9IH07ZnVuY3Rpb24gVGIoYSwgYiwgYywgZCwgZSwgZiwgZywgaCwgaykge09iID0gITE7UGIgPSBudWxsO05iLmFwcGx5KFNiLCBhcmd1bWVudHMpO30KICAgICAgICAgIGZ1bmN0aW9uIFViKGEsIGIsIGMsIGQsIGUsIGYsIGcsIGgsIGspIHtUYi5hcHBseSh0aGlzLCBhcmd1bWVudHMpO2lmIChPYikge2lmIChPYikge3ZhciBsID0gUGI7T2IgPSAhMTtQYiA9IG51bGw7fSBlbHNlIHRocm93IEVycm9yKHAoMTk4KSk7UWIgfHwgKFFiID0gITAsIFJiID0gbCk7fX1mdW5jdGlvbiBWYihhKSB7dmFyIGIgPSBhLGMgPSBhO2lmIChhLmFsdGVybmF0ZSkgZm9yICg7IGIucmV0dXJuOykgYiA9IGIucmV0dXJuO2Vsc2Uge2EgPSBiO2RvIGIgPSBhLCAwICE9PSAoYi5mbGFncyAmIDQwOTgpICYmIChjID0gYi5yZXR1cm4pLCBhID0gYi5yZXR1cm47IHdoaWxlIChhKTt9cmV0dXJuIDMgPT09IGIudGFnID8gYyA6IG51bGw7fWZ1bmN0aW9uIFdiKGEpIHtpZiAoMTMgPT09IGEudGFnKSB7dmFyIGIgPSBhLm1lbW9pemVkU3RhdGU7bnVsbCA9PT0gYiAmJiAoYSA9IGEuYWx0ZXJuYXRlLCBudWxsICE9PSBhICYmIChiID0gYS5tZW1vaXplZFN0YXRlKSk7aWYgKG51bGwgIT09IGIpIHJldHVybiBiLmRlaHlkcmF0ZWQ7fXJldHVybiBudWxsO31mdW5jdGlvbiBYYihhKSB7aWYgKFZiKGEpICE9PSBhKSB0aHJvdyBFcnJvcihwKDE4OCkpO30KICAgICAgICAgIGZ1bmN0aW9uIFliKGEpIHt2YXIgYiA9IGEuYWx0ZXJuYXRlO2lmICghYikge2IgPSBWYihhKTtpZiAobnVsbCA9PT0gYikgdGhyb3cgRXJyb3IocCgxODgpKTtyZXR1cm4gYiAhPT0gYSA/IG51bGwgOiBhO31mb3IgKHZhciBjID0gYSwgZCA9IGI7Oykge3ZhciBlID0gYy5yZXR1cm47aWYgKG51bGwgPT09IGUpIGJyZWFrO3ZhciBmID0gZS5hbHRlcm5hdGU7aWYgKG51bGwgPT09IGYpIHtkID0gZS5yZXR1cm47aWYgKG51bGwgIT09IGQpIHtjID0gZDtjb250aW51ZTt9YnJlYWs7fWlmIChlLmNoaWxkID09PSBmLmNoaWxkKSB7Zm9yIChmID0gZS5jaGlsZDsgZjspIHtpZiAoZiA9PT0gYykgcmV0dXJuIFhiKGUpLCBhO2lmIChmID09PSBkKSByZXR1cm4gWGIoZSksIGI7ZiA9IGYuc2libGluZzt9dGhyb3cgRXJyb3IocCgxODgpKTt9aWYgKGMucmV0dXJuICE9PSBkLnJldHVybikgYyA9IGUsIGQgPSBmO2Vsc2Uge2ZvciAodmFyIGcgPSAhMSwgaCA9IGUuY2hpbGQ7IGg7KSB7aWYgKGggPT09IGMpIHtnID0gITA7YyA9IGU7ZCA9IGY7YnJlYWs7fWlmIChoID09PSBkKSB7ZyA9ICEwO2QgPSBlO2MgPSBmO2JyZWFrO31oID0gaC5zaWJsaW5nO31pZiAoIWcpIHtmb3IgKGggPSBmLmNoaWxkOyBoOykge2lmIChoID09PQogICAgICAgICAgICAgICAgICAgIGMpIHtnID0gITA7YyA9IGY7ZCA9IGU7YnJlYWs7fWlmIChoID09PSBkKSB7ZyA9ICEwO2QgPSBmO2MgPSBlO2JyZWFrO31oID0gaC5zaWJsaW5nO31pZiAoIWcpIHRocm93IEVycm9yKHAoMTg5KSk7fX1pZiAoYy5hbHRlcm5hdGUgIT09IGQpIHRocm93IEVycm9yKHAoMTkwKSk7fWlmICgzICE9PSBjLnRhZykgdGhyb3cgRXJyb3IocCgxODgpKTtyZXR1cm4gYy5zdGF0ZU5vZGUuY3VycmVudCA9PT0gYyA/IGEgOiBiO31mdW5jdGlvbiBaYihhKSB7YSA9IFliKGEpO3JldHVybiBudWxsICE9PSBhID8gJGIoYSkgOiBudWxsO31mdW5jdGlvbiAkYihhKSB7aWYgKDUgPT09IGEudGFnIHx8IDYgPT09IGEudGFnKSByZXR1cm4gYTtmb3IgKGEgPSBhLmNoaWxkOyBudWxsICE9PSBhOykge3ZhciBiID0gJGIoYSk7aWYgKG51bGwgIT09IGIpIHJldHVybiBiO2EgPSBhLnNpYmxpbmc7fXJldHVybiBudWxsO30KICAgICAgICAgIHZhciBhYyA9IGNhLnVuc3RhYmxlX3NjaGVkdWxlQ2FsbGJhY2ssYmMgPSBjYS51bnN0YWJsZV9jYW5jZWxDYWxsYmFjayxjYyA9IGNhLnVuc3RhYmxlX3Nob3VsZFlpZWxkLGRjID0gY2EudW5zdGFibGVfcmVxdWVzdFBhaW50LEIgPSBjYS51bnN0YWJsZV9ub3csZWMgPSBjYS51bnN0YWJsZV9nZXRDdXJyZW50UHJpb3JpdHlMZXZlbCxmYyA9IGNhLnVuc3RhYmxlX0ltbWVkaWF0ZVByaW9yaXR5LGdjID0gY2EudW5zdGFibGVfVXNlckJsb2NraW5nUHJpb3JpdHksaGMgPSBjYS51bnN0YWJsZV9Ob3JtYWxQcmlvcml0eSxpYyA9IGNhLnVuc3RhYmxlX0xvd1ByaW9yaXR5LGpjID0gY2EudW5zdGFibGVfSWRsZVByaW9yaXR5LGtjID0gbnVsbCxsYyA9IG51bGw7ZnVuY3Rpb24gbWMoYSkge2lmIChsYyAmJiAiZnVuY3Rpb24iID09PSB0eXBlb2YgbGMub25Db21taXRGaWJlclJvb3QpIHRyeSB7bGMub25Db21taXRGaWJlclJvb3Qoa2MsIGEsIHZvaWQgMCwgMTI4ID09PSAoYS5jdXJyZW50LmZsYWdzICYgMTI4KSk7fSBjYXRjaCAoYikge319CiAgICAgICAgICB2YXIgb2MgPSBNYXRoLmNsejMyID8gTWF0aC5jbHozMiA6IG5jLHBjID0gTWF0aC5sb2cscWMgPSBNYXRoLkxOMjtmdW5jdGlvbiBuYyhhKSB7YSA+Pj49IDA7cmV0dXJuIDAgPT09IGEgPyAzMiA6IDMxIC0gKHBjKGEpIC8gcWMgfCAwKSB8IDA7fXZhciByYyA9IDY0LHNjID0gNDE5NDMwNDsKICAgICAgICAgIGZ1bmN0aW9uIHRjKGEpIHtzd2l0Y2ggKGEgJiAtYSkge2Nhc2UgMTpyZXR1cm4gMTtjYXNlIDI6cmV0dXJuIDI7Y2FzZSA0OnJldHVybiA0O2Nhc2UgODpyZXR1cm4gODtjYXNlIDE2OnJldHVybiAxNjtjYXNlIDMyOnJldHVybiAzMjtjYXNlIDY0OmNhc2UgMTI4OmNhc2UgMjU2OmNhc2UgNTEyOmNhc2UgMTAyNDpjYXNlIDIwNDg6Y2FzZSA0MDk2OmNhc2UgODE5MjpjYXNlIDE2Mzg0OmNhc2UgMzI3Njg6Y2FzZSA2NTUzNjpjYXNlIDEzMTA3MjpjYXNlIDI2MjE0NDpjYXNlIDUyNDI4ODpjYXNlIDEwNDg1NzY6Y2FzZSAyMDk3MTUyOnJldHVybiBhICYgNDE5NDI0MDtjYXNlIDQxOTQzMDQ6Y2FzZSA4Mzg4NjA4OmNhc2UgMTY3NzcyMTY6Y2FzZSAzMzU1NDQzMjpjYXNlIDY3MTA4ODY0OnJldHVybiBhICYgMTMwMDIzNDI0O2Nhc2UgMTM0MjE3NzI4OnJldHVybiAxMzQyMTc3Mjg7Y2FzZSAyNjg0MzU0NTY6cmV0dXJuIDI2ODQzNTQ1NjtjYXNlIDUzNjg3MDkxMjpyZXR1cm4gNTM2ODcwOTEyO2Nhc2UgMTA3Mzc0MTgyNDpyZXR1cm4gMTA3Mzc0MTgyNDsKICAgICAgICAgICAgICBkZWZhdWx0OnJldHVybiBhO319ZnVuY3Rpb24gdWMoYSwgYikge3ZhciBjID0gYS5wZW5kaW5nTGFuZXM7aWYgKDAgPT09IGMpIHJldHVybiAwO3ZhciBkID0gMCxlID0gYS5zdXNwZW5kZWRMYW5lcyxmID0gYS5waW5nZWRMYW5lcyxnID0gYyAmIDI2ODQzNTQ1NTtpZiAoMCAhPT0gZykge3ZhciBoID0gZyAmIH5lOzAgIT09IGggPyBkID0gdGMoaCkgOiAoZiAmPSBnLCAwICE9PSBmICYmIChkID0gdGMoZikpKTt9IGVsc2UgZyA9IGMgJiB+ZSwgMCAhPT0gZyA/IGQgPSB0YyhnKSA6IDAgIT09IGYgJiYgKGQgPSB0YyhmKSk7aWYgKDAgPT09IGQpIHJldHVybiAwO2lmICgwICE9PSBiICYmIGIgIT09IGQgJiYgMCA9PT0gKGIgJiBlKSAmJiAoZSA9IGQgJiAtZCwgZiA9IGIgJiAtYiwgZSA+PSBmIHx8IDE2ID09PSBlICYmIDAgIT09IChmICYgNDE5NDI0MCkpKSByZXR1cm4gYjswICE9PSAoZCAmIDQpICYmIChkIHw9IGMgJiAxNik7YiA9IGEuZW50YW5nbGVkTGFuZXM7aWYgKDAgIT09IGIpIGZvciAoYSA9IGEuZW50YW5nbGVtZW50cywgYiAmPSBkOyAwIDwgYjspIGMgPSAzMSAtIG9jKGIpLCBlID0gMSA8PCBjLCBkIHw9IGFbY10sIGIgJj0gfmU7cmV0dXJuIGQ7fQogICAgICAgICAgZnVuY3Rpb24gdmMoYSwgYikge3N3aXRjaCAoYSkge2Nhc2UgMTpjYXNlIDI6Y2FzZSA0OnJldHVybiBiICsgMjUwO2Nhc2UgODpjYXNlIDE2OmNhc2UgMzI6Y2FzZSA2NDpjYXNlIDEyODpjYXNlIDI1NjpjYXNlIDUxMjpjYXNlIDEwMjQ6Y2FzZSAyMDQ4OmNhc2UgNDA5NjpjYXNlIDgxOTI6Y2FzZSAxNjM4NDpjYXNlIDMyNzY4OmNhc2UgNjU1MzY6Y2FzZSAxMzEwNzI6Y2FzZSAyNjIxNDQ6Y2FzZSA1MjQyODg6Y2FzZSAxMDQ4NTc2OmNhc2UgMjA5NzE1MjpyZXR1cm4gYiArIDVFMztjYXNlIDQxOTQzMDQ6Y2FzZSA4Mzg4NjA4OmNhc2UgMTY3NzcyMTY6Y2FzZSAzMzU1NDQzMjpjYXNlIDY3MTA4ODY0OnJldHVybiAtMTtjYXNlIDEzNDIxNzcyODpjYXNlIDI2ODQzNTQ1NjpjYXNlIDUzNjg3MDkxMjpjYXNlIDEwNzM3NDE4MjQ6cmV0dXJuIC0xO2RlZmF1bHQ6cmV0dXJuIC0xO319CiAgICAgICAgICBmdW5jdGlvbiB3YyhhLCBiKSB7Zm9yICh2YXIgYyA9IGEuc3VzcGVuZGVkTGFuZXMsIGQgPSBhLnBpbmdlZExhbmVzLCBlID0gYS5leHBpcmF0aW9uVGltZXMsIGYgPSBhLnBlbmRpbmdMYW5lczsgMCA8IGY7KSB7dmFyIGcgPSAzMSAtIG9jKGYpLGggPSAxIDw8IGcsayA9IGVbZ107aWYgKC0xID09PSBrKSB7aWYgKDAgPT09IChoICYgYykgfHwgMCAhPT0gKGggJiBkKSkgZVtnXSA9IHZjKGgsIGIpO30gZWxzZSBrIDw9IGIgJiYgKGEuZXhwaXJlZExhbmVzIHw9IGgpO2YgJj0gfmg7fX1mdW5jdGlvbiB4YyhhKSB7YSA9IGEucGVuZGluZ0xhbmVzICYgLTEwNzM3NDE4MjU7cmV0dXJuIDAgIT09IGEgPyBhIDogYSAmIDEwNzM3NDE4MjQgPyAxMDczNzQxODI0IDogMDt9ZnVuY3Rpb24geWMoKSB7dmFyIGEgPSByYztyYyA8PD0gMTswID09PSAocmMgJiA0MTk0MjQwKSAmJiAocmMgPSA2NCk7cmV0dXJuIGE7fWZ1bmN0aW9uIHpjKGEpIHtmb3IgKHZhciBiID0gW10sIGMgPSAwOyAzMSA+IGM7IGMrKykgYi5wdXNoKGEpO3JldHVybiBiO30KICAgICAgICAgIGZ1bmN0aW9uIEFjKGEsIGIsIGMpIHthLnBlbmRpbmdMYW5lcyB8PSBiOzUzNjg3MDkxMiAhPT0gYiAmJiAoYS5zdXNwZW5kZWRMYW5lcyA9IDAsIGEucGluZ2VkTGFuZXMgPSAwKTthID0gYS5ldmVudFRpbWVzO2IgPSAzMSAtIG9jKGIpO2FbYl0gPSBjO31mdW5jdGlvbiBCYyhhLCBiKSB7dmFyIGMgPSBhLnBlbmRpbmdMYW5lcyAmIH5iO2EucGVuZGluZ0xhbmVzID0gYjthLnN1c3BlbmRlZExhbmVzID0gMDthLnBpbmdlZExhbmVzID0gMDthLmV4cGlyZWRMYW5lcyAmPSBiO2EubXV0YWJsZVJlYWRMYW5lcyAmPSBiO2EuZW50YW5nbGVkTGFuZXMgJj0gYjtiID0gYS5lbnRhbmdsZW1lbnRzO3ZhciBkID0gYS5ldmVudFRpbWVzO2ZvciAoYSA9IGEuZXhwaXJhdGlvblRpbWVzOyAwIDwgYzspIHt2YXIgZSA9IDMxIC0gb2MoYyksZiA9IDEgPDwgZTtiW2VdID0gMDtkW2VdID0gLTE7YVtlXSA9IC0xO2MgJj0gfmY7fX0KICAgICAgICAgIGZ1bmN0aW9uIENjKGEsIGIpIHt2YXIgYyA9IGEuZW50YW5nbGVkTGFuZXMgfD0gYjtmb3IgKGEgPSBhLmVudGFuZ2xlbWVudHM7IGM7KSB7dmFyIGQgPSAzMSAtIG9jKGMpLGUgPSAxIDw8IGQ7ZSAmIGIgfCBhW2RdICYgYiAmJiAoYVtkXSB8PSBiKTtjICY9IH5lO319dmFyIEMgPSAwO2Z1bmN0aW9uIERjKGEpIHthICY9IC1hO3JldHVybiAxIDwgYSA/IDQgPCBhID8gMCAhPT0gKGEgJiAyNjg0MzU0NTUpID8gMTYgOiA1MzY4NzA5MTIgOiA0IDogMTt9dmFyIEVjLEZjLEdjLEhjLEljLEpjID0gITEsS2MgPSBbXSxMYyA9IG51bGwsTWMgPSBudWxsLE5jID0gbnVsbCxPYyA9IG5ldyBNYXAoKSxQYyA9IG5ldyBNYXAoKSxRYyA9IFtdLFJjID0gIm1vdXNlZG93biBtb3VzZXVwIHRvdWNoY2FuY2VsIHRvdWNoZW5kIHRvdWNoc3RhcnQgYXV4Y2xpY2sgZGJsY2xpY2sgcG9pbnRlcmNhbmNlbCBwb2ludGVyZG93biBwb2ludGVydXAgZHJhZ2VuZCBkcmFnc3RhcnQgZHJvcCBjb21wb3NpdGlvbmVuZCBjb21wb3NpdGlvbnN0YXJ0IGtleWRvd24ga2V5cHJlc3Mga2V5dXAgaW5wdXQgdGV4dElucHV0IGNvcHkgY3V0IHBhc3RlIGNsaWNrIGNoYW5nZSBjb250ZXh0bWVudSByZXNldCBzdWJtaXQiLnNwbGl0KCIgIik7CiAgICAgICAgICBmdW5jdGlvbiBTYyhhLCBiKSB7c3dpdGNoIChhKSB7Y2FzZSAiZm9jdXNpbiI6Y2FzZSAiZm9jdXNvdXQiOkxjID0gbnVsbDticmVhaztjYXNlICJkcmFnZW50ZXIiOmNhc2UgImRyYWdsZWF2ZSI6TWMgPSBudWxsO2JyZWFrO2Nhc2UgIm1vdXNlb3ZlciI6Y2FzZSAibW91c2VvdXQiOk5jID0gbnVsbDticmVhaztjYXNlICJwb2ludGVyb3ZlciI6Y2FzZSAicG9pbnRlcm91dCI6T2MuZGVsZXRlKGIucG9pbnRlcklkKTticmVhaztjYXNlICJnb3Rwb2ludGVyY2FwdHVyZSI6Y2FzZSAibG9zdHBvaW50ZXJjYXB0dXJlIjpQYy5kZWxldGUoYi5wb2ludGVySWQpO319CiAgICAgICAgICBmdW5jdGlvbiBUYyhhLCBiLCBjLCBkLCBlLCBmKSB7aWYgKG51bGwgPT09IGEgfHwgYS5uYXRpdmVFdmVudCAhPT0gZikgcmV0dXJuIGEgPSB7IGJsb2NrZWRPbjogYiwgZG9tRXZlbnROYW1lOiBjLCBldmVudFN5c3RlbUZsYWdzOiBkLCBuYXRpdmVFdmVudDogZiwgdGFyZ2V0Q29udGFpbmVyczogW2VdIH0sIG51bGwgIT09IGIgJiYgKGIgPSBDYihiKSwgbnVsbCAhPT0gYiAmJiBGYyhiKSksIGE7YS5ldmVudFN5c3RlbUZsYWdzIHw9IGQ7YiA9IGEudGFyZ2V0Q29udGFpbmVycztudWxsICE9PSBlICYmIC0xID09PSBiLmluZGV4T2YoZSkgJiYgYi5wdXNoKGUpO3JldHVybiBhO30KICAgICAgICAgIGZ1bmN0aW9uIFVjKGEsIGIsIGMsIGQsIGUpIHtzd2l0Y2ggKGIpIHtjYXNlICJmb2N1c2luIjpyZXR1cm4gTGMgPSBUYyhMYywgYSwgYiwgYywgZCwgZSksICEwO2Nhc2UgImRyYWdlbnRlciI6cmV0dXJuIE1jID0gVGMoTWMsIGEsIGIsIGMsIGQsIGUpLCAhMDtjYXNlICJtb3VzZW92ZXIiOnJldHVybiBOYyA9IFRjKE5jLCBhLCBiLCBjLCBkLCBlKSwgITA7Y2FzZSAicG9pbnRlcm92ZXIiOnZhciBmID0gZS5wb2ludGVySWQ7T2Muc2V0KGYsIFRjKE9jLmdldChmKSB8fCBudWxsLCBhLCBiLCBjLCBkLCBlKSk7cmV0dXJuICEwO2Nhc2UgImdvdHBvaW50ZXJjYXB0dXJlIjpyZXR1cm4gZiA9IGUucG9pbnRlcklkLCBQYy5zZXQoZiwgVGMoUGMuZ2V0KGYpIHx8IG51bGwsIGEsIGIsIGMsIGQsIGUpKSwgITA7fXJldHVybiAhMTt9CiAgICAgICAgICBmdW5jdGlvbiBWYyhhKSB7dmFyIGIgPSBXYyhhLnRhcmdldCk7aWYgKG51bGwgIT09IGIpIHt2YXIgYyA9IFZiKGIpO2lmIChudWxsICE9PSBjKSBpZiAoYiA9IGMudGFnLCAxMyA9PT0gYikge2lmIChiID0gV2IoYyksIG51bGwgIT09IGIpIHthLmJsb2NrZWRPbiA9IGI7SWMoYS5wcmlvcml0eSwgZnVuY3Rpb24gKCkge0djKGMpO30pO3JldHVybjt9fSBlbHNlIGlmICgzID09PSBiICYmIGMuc3RhdGVOb2RlLmN1cnJlbnQubWVtb2l6ZWRTdGF0ZS5pc0RlaHlkcmF0ZWQpIHthLmJsb2NrZWRPbiA9IDMgPT09IGMudGFnID8gYy5zdGF0ZU5vZGUuY29udGFpbmVySW5mbyA6IG51bGw7cmV0dXJuO319YS5ibG9ja2VkT24gPSBudWxsO30KICAgICAgICAgIGZ1bmN0aW9uIFhjKGEpIHtpZiAobnVsbCAhPT0gYS5ibG9ja2VkT24pIHJldHVybiAhMTtmb3IgKHZhciBiID0gYS50YXJnZXRDb250YWluZXJzOyAwIDwgYi5sZW5ndGg7KSB7dmFyIGMgPSBZYyhhLmRvbUV2ZW50TmFtZSwgYS5ldmVudFN5c3RlbUZsYWdzLCBiWzBdLCBhLm5hdGl2ZUV2ZW50KTtpZiAobnVsbCA9PT0gYykge2MgPSBhLm5hdGl2ZUV2ZW50O3ZhciBkID0gbmV3IGMuY29uc3RydWN0b3IoYy50eXBlLCBjKTt3YiA9IGQ7Yy50YXJnZXQuZGlzcGF0Y2hFdmVudChkKTt3YiA9IG51bGw7fSBlbHNlIHJldHVybiBiID0gQ2IoYyksIG51bGwgIT09IGIgJiYgRmMoYiksIGEuYmxvY2tlZE9uID0gYywgITE7Yi5zaGlmdCgpO31yZXR1cm4gITA7fWZ1bmN0aW9uIFpjKGEsIGIsIGMpIHtYYyhhKSAmJiBjLmRlbGV0ZShiKTt9ZnVuY3Rpb24gJGMoKSB7SmMgPSAhMTtudWxsICE9PSBMYyAmJiBYYyhMYykgJiYgKExjID0gbnVsbCk7bnVsbCAhPT0gTWMgJiYgWGMoTWMpICYmIChNYyA9IG51bGwpO251bGwgIT09IE5jICYmIFhjKE5jKSAmJiAoTmMgPSBudWxsKTtPYy5mb3JFYWNoKFpjKTtQYy5mb3JFYWNoKFpjKTt9CiAgICAgICAgICBmdW5jdGlvbiBhZChhLCBiKSB7YS5ibG9ja2VkT24gPT09IGIgJiYgKGEuYmxvY2tlZE9uID0gbnVsbCwgSmMgfHwgKEpjID0gITAsIGNhLnVuc3RhYmxlX3NjaGVkdWxlQ2FsbGJhY2soY2EudW5zdGFibGVfTm9ybWFsUHJpb3JpdHksICRjKSkpO30KICAgICAgICAgIGZ1bmN0aW9uIGJkKGEpIHtmdW5jdGlvbiBiKGIpIHtyZXR1cm4gYWQoYiwgYSk7fWlmICgwIDwgS2MubGVuZ3RoKSB7YWQoS2NbMF0sIGEpO2ZvciAodmFyIGMgPSAxOyBjIDwgS2MubGVuZ3RoOyBjKyspIHt2YXIgZCA9IEtjW2NdO2QuYmxvY2tlZE9uID09PSBhICYmIChkLmJsb2NrZWRPbiA9IG51bGwpO319bnVsbCAhPT0gTGMgJiYgYWQoTGMsIGEpO251bGwgIT09IE1jICYmIGFkKE1jLCBhKTtudWxsICE9PSBOYyAmJiBhZChOYywgYSk7T2MuZm9yRWFjaChiKTtQYy5mb3JFYWNoKGIpO2ZvciAoYyA9IDA7IGMgPCBRYy5sZW5ndGg7IGMrKykgZCA9IFFjW2NdLCBkLmJsb2NrZWRPbiA9PT0gYSAmJiAoZC5ibG9ja2VkT24gPSBudWxsKTtmb3IgKDsgMCA8IFFjLmxlbmd0aCAmJiAoYyA9IFFjWzBdLCBudWxsID09PSBjLmJsb2NrZWRPbik7KSBWYyhjKSwgbnVsbCA9PT0gYy5ibG9ja2VkT24gJiYgUWMuc2hpZnQoKTt9dmFyIGNkID0gdWEuUmVhY3RDdXJyZW50QmF0Y2hDb25maWcsZGQgPSAhMDsKICAgICAgICAgIGZ1bmN0aW9uIGVkKGEsIGIsIGMsIGQpIHt2YXIgZSA9IEMsZiA9IGNkLnRyYW5zaXRpb247Y2QudHJhbnNpdGlvbiA9IG51bGw7dHJ5IHtDID0gMSwgZmQoYSwgYiwgYywgZCk7fSBmaW5hbGx5IHtDID0gZSwgY2QudHJhbnNpdGlvbiA9IGY7fX1mdW5jdGlvbiBnZChhLCBiLCBjLCBkKSB7dmFyIGUgPSBDLGYgPSBjZC50cmFuc2l0aW9uO2NkLnRyYW5zaXRpb24gPSBudWxsO3RyeSB7QyA9IDQsIGZkKGEsIGIsIGMsIGQpO30gZmluYWxseSB7QyA9IGUsIGNkLnRyYW5zaXRpb24gPSBmO319CiAgICAgICAgICBmdW5jdGlvbiBmZChhLCBiLCBjLCBkKSB7aWYgKGRkKSB7dmFyIGUgPSBZYyhhLCBiLCBjLCBkKTtpZiAobnVsbCA9PT0gZSkgaGQoYSwgYiwgZCwgaWQsIGMpLCBTYyhhLCBkKTtlbHNlIGlmIChVYyhlLCBhLCBiLCBjLCBkKSkgZC5zdG9wUHJvcGFnYXRpb24oKTtlbHNlIGlmIChTYyhhLCBkKSwgYiAmIDQgJiYgLTEgPCBSYy5pbmRleE9mKGEpKSB7Zm9yICg7IG51bGwgIT09IGU7KSB7dmFyIGYgPSBDYihlKTtudWxsICE9PSBmICYmIEVjKGYpO2YgPSBZYyhhLCBiLCBjLCBkKTtudWxsID09PSBmICYmIGhkKGEsIGIsIGQsIGlkLCBjKTtpZiAoZiA9PT0gZSkgYnJlYWs7ZSA9IGY7fW51bGwgIT09IGUgJiYgZC5zdG9wUHJvcGFnYXRpb24oKTt9IGVsc2UgaGQoYSwgYiwgZCwgbnVsbCwgYyk7fX12YXIgaWQgPSBudWxsOwogICAgICAgICAgZnVuY3Rpb24gWWMoYSwgYiwgYywgZCkge2lkID0gbnVsbDthID0geGIoZCk7YSA9IFdjKGEpO2lmIChudWxsICE9PSBhKSBpZiAoYiA9IFZiKGEpLCBudWxsID09PSBiKSBhID0gbnVsbDtlbHNlIGlmIChjID0gYi50YWcsIDEzID09PSBjKSB7YSA9IFdiKGIpO2lmIChudWxsICE9PSBhKSByZXR1cm4gYTthID0gbnVsbDt9IGVsc2UgaWYgKDMgPT09IGMpIHtpZiAoYi5zdGF0ZU5vZGUuY3VycmVudC5tZW1vaXplZFN0YXRlLmlzRGVoeWRyYXRlZCkgcmV0dXJuIDMgPT09IGIudGFnID8gYi5zdGF0ZU5vZGUuY29udGFpbmVySW5mbyA6IG51bGw7YSA9IG51bGw7fSBlbHNlIGIgIT09IGEgJiYgKGEgPSBudWxsKTtpZCA9IGE7cmV0dXJuIG51bGw7fQogICAgICAgICAgZnVuY3Rpb24gamQoYSkge3N3aXRjaCAoYSkge2Nhc2UgImNhbmNlbCI6Y2FzZSAiY2xpY2siOmNhc2UgImNsb3NlIjpjYXNlICJjb250ZXh0bWVudSI6Y2FzZSAiY29weSI6Y2FzZSAiY3V0IjpjYXNlICJhdXhjbGljayI6Y2FzZSAiZGJsY2xpY2siOmNhc2UgImRyYWdlbmQiOmNhc2UgImRyYWdzdGFydCI6Y2FzZSAiZHJvcCI6Y2FzZSAiZm9jdXNpbiI6Y2FzZSAiZm9jdXNvdXQiOmNhc2UgImlucHV0IjpjYXNlICJpbnZhbGlkIjpjYXNlICJrZXlkb3duIjpjYXNlICJrZXlwcmVzcyI6Y2FzZSAia2V5dXAiOmNhc2UgIm1vdXNlZG93biI6Y2FzZSAibW91c2V1cCI6Y2FzZSAicGFzdGUiOmNhc2UgInBhdXNlIjpjYXNlICJwbGF5IjpjYXNlICJwb2ludGVyY2FuY2VsIjpjYXNlICJwb2ludGVyZG93biI6Y2FzZSAicG9pbnRlcnVwIjpjYXNlICJyYXRlY2hhbmdlIjpjYXNlICJyZXNldCI6Y2FzZSAicmVzaXplIjpjYXNlICJzZWVrZWQiOmNhc2UgInN1Ym1pdCI6Y2FzZSAidG91Y2hjYW5jZWwiOmNhc2UgInRvdWNoZW5kIjpjYXNlICJ0b3VjaHN0YXJ0IjpjYXNlICJ2b2x1bWVjaGFuZ2UiOmNhc2UgImNoYW5nZSI6Y2FzZSAic2VsZWN0aW9uY2hhbmdlIjpjYXNlICJ0ZXh0SW5wdXQiOmNhc2UgImNvbXBvc2l0aW9uc3RhcnQiOmNhc2UgImNvbXBvc2l0aW9uZW5kIjpjYXNlICJjb21wb3NpdGlvbnVwZGF0ZSI6Y2FzZSAiYmVmb3JlYmx1ciI6Y2FzZSAiYWZ0ZXJibHVyIjpjYXNlICJiZWZvcmVpbnB1dCI6Y2FzZSAiYmx1ciI6Y2FzZSAiZnVsbHNjcmVlbmNoYW5nZSI6Y2FzZSAiZm9jdXMiOmNhc2UgImhhc2hjaGFuZ2UiOmNhc2UgInBvcHN0YXRlIjpjYXNlICJzZWxlY3QiOmNhc2UgInNlbGVjdHN0YXJ0IjpyZXR1cm4gMTtjYXNlICJkcmFnIjpjYXNlICJkcmFnZW50ZXIiOmNhc2UgImRyYWdleGl0IjpjYXNlICJkcmFnbGVhdmUiOmNhc2UgImRyYWdvdmVyIjpjYXNlICJtb3VzZW1vdmUiOmNhc2UgIm1vdXNlb3V0IjpjYXNlICJtb3VzZW92ZXIiOmNhc2UgInBvaW50ZXJtb3ZlIjpjYXNlICJwb2ludGVyb3V0IjpjYXNlICJwb2ludGVyb3ZlciI6Y2FzZSAic2Nyb2xsIjpjYXNlICJ0b2dnbGUiOmNhc2UgInRvdWNobW92ZSI6Y2FzZSAid2hlZWwiOmNhc2UgIm1vdXNlZW50ZXIiOmNhc2UgIm1vdXNlbGVhdmUiOmNhc2UgInBvaW50ZXJlbnRlciI6Y2FzZSAicG9pbnRlcmxlYXZlIjpyZXR1cm4gNDsKICAgICAgICAgICAgICBjYXNlICJtZXNzYWdlIjpzd2l0Y2ggKGVjKCkpIHtjYXNlIGZjOnJldHVybiAxO2Nhc2UgZ2M6cmV0dXJuIDQ7Y2FzZSBoYzpjYXNlIGljOnJldHVybiAxNjtjYXNlIGpjOnJldHVybiA1MzY4NzA5MTI7ZGVmYXVsdDpyZXR1cm4gMTY7fWRlZmF1bHQ6cmV0dXJuIDE2O319dmFyIGtkID0gbnVsbCxsZCA9IG51bGwsbWQgPSBudWxsO2Z1bmN0aW9uIG5kKCkge2lmIChtZCkgcmV0dXJuIG1kO3ZhciBhLGIgPSBsZCxjID0gYi5sZW5ndGgsZCxlID0gInZhbHVlIiBpbiBrZCA/IGtkLnZhbHVlIDoga2QudGV4dENvbnRlbnQsZiA9IGUubGVuZ3RoO2ZvciAoYSA9IDA7IGEgPCBjICYmIGJbYV0gPT09IGVbYV07IGErKyk7dmFyIGcgPSBjIC0gYTtmb3IgKGQgPSAxOyBkIDw9IGcgJiYgYltjIC0gZF0gPT09IGVbZiAtIGRdOyBkKyspO3JldHVybiBtZCA9IGUuc2xpY2UoYSwgMSA8IGQgPyAxIC0gZCA6IHZvaWQgMCk7fQogICAgICAgICAgZnVuY3Rpb24gb2QoYSkge3ZhciBiID0gYS5rZXlDb2RlOyJjaGFyQ29kZSIgaW4gYSA/IChhID0gYS5jaGFyQ29kZSwgMCA9PT0gYSAmJiAxMyA9PT0gYiAmJiAoYSA9IDEzKSkgOiBhID0gYjsxMCA9PT0gYSAmJiAoYSA9IDEzKTtyZXR1cm4gMzIgPD0gYSB8fCAxMyA9PT0gYSA/IGEgOiAwO31mdW5jdGlvbiBwZCgpIHtyZXR1cm4gITA7fWZ1bmN0aW9uIHFkKCkge3JldHVybiAhMTt9CiAgICAgICAgICBmdW5jdGlvbiByZChhKSB7ZnVuY3Rpb24gYihiLCBkLCBlLCBmLCBnKSB7dGhpcy5fcmVhY3ROYW1lID0gYjt0aGlzLl90YXJnZXRJbnN0ID0gZTt0aGlzLnR5cGUgPSBkO3RoaXMubmF0aXZlRXZlbnQgPSBmO3RoaXMudGFyZ2V0ID0gZzt0aGlzLmN1cnJlbnRUYXJnZXQgPSBudWxsO2ZvciAodmFyIGMgaW4gYSkgYS5oYXNPd25Qcm9wZXJ0eShjKSAmJiAoYiA9IGFbY10sIHRoaXNbY10gPSBiID8gYihmKSA6IGZbY10pO3RoaXMuaXNEZWZhdWx0UHJldmVudGVkID0gKG51bGwgIT0gZi5kZWZhdWx0UHJldmVudGVkID8gZi5kZWZhdWx0UHJldmVudGVkIDogITEgPT09IGYucmV0dXJuVmFsdWUpID8gcGQgOiBxZDt0aGlzLmlzUHJvcGFnYXRpb25TdG9wcGVkID0gcWQ7cmV0dXJuIHRoaXM7fUEoYi5wcm90b3R5cGUsIHsgcHJldmVudERlZmF1bHQ6IGZ1bmN0aW9uIHByZXZlbnREZWZhdWx0KCkge3RoaXMuZGVmYXVsdFByZXZlbnRlZCA9ICEwO3ZhciBhID0gdGhpcy5uYXRpdmVFdmVudDthICYmIChhLnByZXZlbnREZWZhdWx0ID8gYS5wcmV2ZW50RGVmYXVsdCgpIDogInVua25vd24iICE9PSB0eXBlb2YgYS5yZXR1cm5WYWx1ZSAmJiAoCiAgICAgICAgICAgICAgICBhLnJldHVyblZhbHVlID0gITEpLCB0aGlzLmlzRGVmYXVsdFByZXZlbnRlZCA9IHBkKTt9LCBzdG9wUHJvcGFnYXRpb246IGZ1bmN0aW9uIHN0b3BQcm9wYWdhdGlvbigpIHt2YXIgYSA9IHRoaXMubmF0aXZlRXZlbnQ7YSAmJiAoYS5zdG9wUHJvcGFnYXRpb24gPyBhLnN0b3BQcm9wYWdhdGlvbigpIDogInVua25vd24iICE9PSB0eXBlb2YgYS5jYW5jZWxCdWJibGUgJiYgKGEuY2FuY2VsQnViYmxlID0gITApLCB0aGlzLmlzUHJvcGFnYXRpb25TdG9wcGVkID0gcGQpO30sIHBlcnNpc3Q6IGZ1bmN0aW9uIHBlcnNpc3QoKSB7fSwgaXNQZXJzaXN0ZW50OiBwZCB9KTtyZXR1cm4gYjt9CiAgICAgICAgICB2YXIgc2QgPSB7IGV2ZW50UGhhc2U6IDAsIGJ1YmJsZXM6IDAsIGNhbmNlbGFibGU6IDAsIHRpbWVTdGFtcDogZnVuY3Rpb24gdGltZVN0YW1wKGEpIHtyZXR1cm4gYS50aW1lU3RhbXAgfHwgRGF0ZS5ub3coKTt9LCBkZWZhdWx0UHJldmVudGVkOiAwLCBpc1RydXN0ZWQ6IDAgfSx0ZCA9IHJkKHNkKSx1ZCA9IEEoe30sIHNkLCB7IHZpZXc6IDAsIGRldGFpbDogMCB9KSx2ZCA9IHJkKHVkKSx3ZCx4ZCx5ZCxBZCA9IEEoe30sIHVkLCB7IHNjcmVlblg6IDAsIHNjcmVlblk6IDAsIGNsaWVudFg6IDAsIGNsaWVudFk6IDAsIHBhZ2VYOiAwLCBwYWdlWTogMCwgY3RybEtleTogMCwgc2hpZnRLZXk6IDAsIGFsdEtleTogMCwgbWV0YUtleTogMCwgZ2V0TW9kaWZpZXJTdGF0ZTogemQsIGJ1dHRvbjogMCwgYnV0dG9uczogMCwgcmVsYXRlZFRhcmdldDogZnVuY3Rpb24gcmVsYXRlZFRhcmdldChhKSB7cmV0dXJuIHZvaWQgMCA9PT0gYS5yZWxhdGVkVGFyZ2V0ID8gYS5mcm9tRWxlbWVudCA9PT0gYS5zcmNFbGVtZW50ID8gYS50b0VsZW1lbnQgOiBhLmZyb21FbGVtZW50IDogYS5yZWxhdGVkVGFyZ2V0O30sIG1vdmVtZW50WDogZnVuY3Rpb24gbW92ZW1lbnRYKGEpIHtpZiAoIm1vdmVtZW50WCIgaW4KICAgICAgICAgICAgICAgIGEpIHJldHVybiBhLm1vdmVtZW50WDthICE9PSB5ZCAmJiAoeWQgJiYgIm1vdXNlbW92ZSIgPT09IGEudHlwZSA/ICh3ZCA9IGEuc2NyZWVuWCAtIHlkLnNjcmVlblgsIHhkID0gYS5zY3JlZW5ZIC0geWQuc2NyZWVuWSkgOiB4ZCA9IHdkID0gMCwgeWQgPSBhKTtyZXR1cm4gd2Q7fSwgbW92ZW1lbnRZOiBmdW5jdGlvbiBtb3ZlbWVudFkoYSkge3JldHVybiAibW92ZW1lbnRZIiBpbiBhID8gYS5tb3ZlbWVudFkgOiB4ZDt9IH0pLEJkID0gcmQoQWQpLENkID0gQSh7fSwgQWQsIHsgZGF0YVRyYW5zZmVyOiAwIH0pLERkID0gcmQoQ2QpLEVkID0gQSh7fSwgdWQsIHsgcmVsYXRlZFRhcmdldDogMCB9KSxGZCA9IHJkKEVkKSxHZCA9IEEoe30sIHNkLCB7IGFuaW1hdGlvbk5hbWU6IDAsIGVsYXBzZWRUaW1lOiAwLCBwc2V1ZG9FbGVtZW50OiAwIH0pLEhkID0gcmQoR2QpLElkID0gQSh7fSwgc2QsIHsgY2xpcGJvYXJkRGF0YTogZnVuY3Rpb24gY2xpcGJvYXJkRGF0YShhKSB7cmV0dXJuICJjbGlwYm9hcmREYXRhIiBpbiBhID8gYS5jbGlwYm9hcmREYXRhIDogd2luZG93LmNsaXBib2FyZERhdGE7fSB9KSxKZCA9IHJkKElkKSxLZCA9IEEoe30sIHNkLCB7IGRhdGE6IDAgfSksTGQgPSByZChLZCksTWQgPSB7IEVzYzogIkVzY2FwZSIsCiAgICAgICAgICAgICAgU3BhY2ViYXI6ICIgIiwgTGVmdDogIkFycm93TGVmdCIsIFVwOiAiQXJyb3dVcCIsIFJpZ2h0OiAiQXJyb3dSaWdodCIsIERvd246ICJBcnJvd0Rvd24iLCBEZWw6ICJEZWxldGUiLCBXaW46ICJPUyIsIE1lbnU6ICJDb250ZXh0TWVudSIsIEFwcHM6ICJDb250ZXh0TWVudSIsIFNjcm9sbDogIlNjcm9sbExvY2siLCBNb3pQcmludGFibGVLZXk6ICJVbmlkZW50aWZpZWQiIH0sTmQgPSB7IDg6ICJCYWNrc3BhY2UiLCA5OiAiVGFiIiwgMTI6ICJDbGVhciIsIDEzOiAiRW50ZXIiLCAxNjogIlNoaWZ0IiwgMTc6ICJDb250cm9sIiwgMTg6ICJBbHQiLCAxOTogIlBhdXNlIiwgMjA6ICJDYXBzTG9jayIsIDI3OiAiRXNjYXBlIiwgMzI6ICIgIiwgMzM6ICJQYWdlVXAiLCAzNDogIlBhZ2VEb3duIiwgMzU6ICJFbmQiLCAzNjogIkhvbWUiLCAzNzogIkFycm93TGVmdCIsIDM4OiAiQXJyb3dVcCIsIDM5OiAiQXJyb3dSaWdodCIsIDQwOiAiQXJyb3dEb3duIiwgNDU6ICJJbnNlcnQiLCA0NjogIkRlbGV0ZSIsIDExMjogIkYxIiwgMTEzOiAiRjIiLCAxMTQ6ICJGMyIsIDExNTogIkY0IiwgMTE2OiAiRjUiLCAxMTc6ICJGNiIsIDExODogIkY3IiwKICAgICAgICAgICAgICAxMTk6ICJGOCIsIDEyMDogIkY5IiwgMTIxOiAiRjEwIiwgMTIyOiAiRjExIiwgMTIzOiAiRjEyIiwgMTQ0OiAiTnVtTG9jayIsIDE0NTogIlNjcm9sbExvY2siLCAyMjQ6ICJNZXRhIiB9LE9kID0geyBBbHQ6ICJhbHRLZXkiLCBDb250cm9sOiAiY3RybEtleSIsIE1ldGE6ICJtZXRhS2V5IiwgU2hpZnQ6ICJzaGlmdEtleSIgfTtmdW5jdGlvbiBQZChhKSB7dmFyIGIgPSB0aGlzLm5hdGl2ZUV2ZW50O3JldHVybiBiLmdldE1vZGlmaWVyU3RhdGUgPyBiLmdldE1vZGlmaWVyU3RhdGUoYSkgOiAoYSA9IE9kW2FdKSA/ICEhYlthXSA6ICExO31mdW5jdGlvbiB6ZCgpIHtyZXR1cm4gUGQ7fQogICAgICAgICAgdmFyIFFkID0gQSh7fSwgdWQsIHsga2V5OiBmdW5jdGlvbiBrZXkoYSkge2lmIChhLmtleSkge3ZhciBiID0gTWRbYS5rZXldIHx8IGEua2V5O2lmICgiVW5pZGVudGlmaWVkIiAhPT0gYikgcmV0dXJuIGI7fXJldHVybiAia2V5cHJlc3MiID09PSBhLnR5cGUgPyAoYSA9IG9kKGEpLCAxMyA9PT0gYSA/ICJFbnRlciIgOiBTdHJpbmcuZnJvbUNoYXJDb2RlKGEpKSA6ICJrZXlkb3duIiA9PT0gYS50eXBlIHx8ICJrZXl1cCIgPT09IGEudHlwZSA/IE5kW2Eua2V5Q29kZV0gfHwgIlVuaWRlbnRpZmllZCIgOiAiIjt9LCBjb2RlOiAwLCBsb2NhdGlvbjogMCwgY3RybEtleTogMCwgc2hpZnRLZXk6IDAsIGFsdEtleTogMCwgbWV0YUtleTogMCwgcmVwZWF0OiAwLCBsb2NhbGU6IDAsIGdldE1vZGlmaWVyU3RhdGU6IHpkLCBjaGFyQ29kZTogZnVuY3Rpb24gY2hhckNvZGUoYSkge3JldHVybiAia2V5cHJlc3MiID09PSBhLnR5cGUgPyBvZChhKSA6IDA7fSwga2V5Q29kZTogZnVuY3Rpb24ga2V5Q29kZShhKSB7cmV0dXJuICJrZXlkb3duIiA9PT0gYS50eXBlIHx8ICJrZXl1cCIgPT09IGEudHlwZSA/IGEua2V5Q29kZSA6IDA7fSwgd2hpY2g6IGZ1bmN0aW9uIHdoaWNoKGEpIHtyZXR1cm4gImtleXByZXNzIiA9PT0KICAgICAgICAgICAgICAgIGEudHlwZSA/IG9kKGEpIDogImtleWRvd24iID09PSBhLnR5cGUgfHwgImtleXVwIiA9PT0gYS50eXBlID8gYS5rZXlDb2RlIDogMDt9IH0pLFJkID0gcmQoUWQpLFNkID0gQSh7fSwgQWQsIHsgcG9pbnRlcklkOiAwLCB3aWR0aDogMCwgaGVpZ2h0OiAwLCBwcmVzc3VyZTogMCwgdGFuZ2VudGlhbFByZXNzdXJlOiAwLCB0aWx0WDogMCwgdGlsdFk6IDAsIHR3aXN0OiAwLCBwb2ludGVyVHlwZTogMCwgaXNQcmltYXJ5OiAwIH0pLFRkID0gcmQoU2QpLFVkID0gQSh7fSwgdWQsIHsgdG91Y2hlczogMCwgdGFyZ2V0VG91Y2hlczogMCwgY2hhbmdlZFRvdWNoZXM6IDAsIGFsdEtleTogMCwgbWV0YUtleTogMCwgY3RybEtleTogMCwgc2hpZnRLZXk6IDAsIGdldE1vZGlmaWVyU3RhdGU6IHpkIH0pLFZkID0gcmQoVWQpLFdkID0gQSh7fSwgc2QsIHsgcHJvcGVydHlOYW1lOiAwLCBlbGFwc2VkVGltZTogMCwgcHNldWRvRWxlbWVudDogMCB9KSxYZCA9IHJkKFdkKSxZZCA9IEEoe30sIEFkLCB7IGRlbHRhWDogZnVuY3Rpb24gZGVsdGFYKGEpIHtyZXR1cm4gImRlbHRhWCIgaW4gYSA/IGEuZGVsdGFYIDogIndoZWVsRGVsdGFYIiBpbiBhID8gLWEud2hlZWxEZWx0YVggOiAwO30sCiAgICAgICAgICAgICAgZGVsdGFZOiBmdW5jdGlvbiBkZWx0YVkoYSkge3JldHVybiAiZGVsdGFZIiBpbiBhID8gYS5kZWx0YVkgOiAid2hlZWxEZWx0YVkiIGluIGEgPyAtYS53aGVlbERlbHRhWSA6ICJ3aGVlbERlbHRhIiBpbiBhID8gLWEud2hlZWxEZWx0YSA6IDA7fSwgZGVsdGFaOiAwLCBkZWx0YU1vZGU6IDAgfSksWmQgPSByZChZZCksJGQgPSBbOSwgMTMsIDI3LCAzMl0sYWUgPSBpYSAmJiAiQ29tcG9zaXRpb25FdmVudCIgaW4gd2luZG93LGJlID0gbnVsbDtpYSAmJiAiZG9jdW1lbnRNb2RlIiBpbiBkb2N1bWVudCAmJiAoYmUgPSBkb2N1bWVudC5kb2N1bWVudE1vZGUpO3ZhciBjZSA9IGlhICYmICJUZXh0RXZlbnQiIGluIHdpbmRvdyAmJiAhYmUsZGUgPSBpYSAmJiAoIWFlIHx8IGJlICYmIDggPCBiZSAmJiAxMSA+PSBiZSksZWUgPSBTdHJpbmcuZnJvbUNoYXJDb2RlKDMyKSxmZSA9ICExOwogICAgICAgICAgZnVuY3Rpb24gZ2UoYSwgYikge3N3aXRjaCAoYSkge2Nhc2UgImtleXVwIjpyZXR1cm4gLTEgIT09ICRkLmluZGV4T2YoYi5rZXlDb2RlKTtjYXNlICJrZXlkb3duIjpyZXR1cm4gMjI5ICE9PSBiLmtleUNvZGU7Y2FzZSAia2V5cHJlc3MiOmNhc2UgIm1vdXNlZG93biI6Y2FzZSAiZm9jdXNvdXQiOnJldHVybiAhMDtkZWZhdWx0OnJldHVybiAhMTt9fWZ1bmN0aW9uIGhlKGEpIHthID0gYS5kZXRhaWw7cmV0dXJuICJvYmplY3QiID09PSB0eXBlb2YgYSAmJiAiZGF0YSIgaW4gYSA/IGEuZGF0YSA6IG51bGw7fXZhciBpZSA9ICExO2Z1bmN0aW9uIGplKGEsIGIpIHtzd2l0Y2ggKGEpIHtjYXNlICJjb21wb3NpdGlvbmVuZCI6cmV0dXJuIGhlKGIpO2Nhc2UgImtleXByZXNzIjppZiAoMzIgIT09IGIud2hpY2gpIHJldHVybiBudWxsO2ZlID0gITA7cmV0dXJuIGVlO2Nhc2UgInRleHRJbnB1dCI6cmV0dXJuIGEgPSBiLmRhdGEsIGEgPT09IGVlICYmIGZlID8gbnVsbCA6IGE7ZGVmYXVsdDpyZXR1cm4gbnVsbDt9fQogICAgICAgICAgZnVuY3Rpb24ga2UoYSwgYikge2lmIChpZSkgcmV0dXJuICJjb21wb3NpdGlvbmVuZCIgPT09IGEgfHwgIWFlICYmIGdlKGEsIGIpID8gKGEgPSBuZCgpLCBtZCA9IGxkID0ga2QgPSBudWxsLCBpZSA9ICExLCBhKSA6IG51bGw7c3dpdGNoIChhKSB7Y2FzZSAicGFzdGUiOnJldHVybiBudWxsO2Nhc2UgImtleXByZXNzIjppZiAoIShiLmN0cmxLZXkgfHwgYi5hbHRLZXkgfHwgYi5tZXRhS2V5KSB8fCBiLmN0cmxLZXkgJiYgYi5hbHRLZXkpIHtpZiAoYi5jaGFyICYmIDEgPCBiLmNoYXIubGVuZ3RoKSByZXR1cm4gYi5jaGFyO2lmIChiLndoaWNoKSByZXR1cm4gU3RyaW5nLmZyb21DaGFyQ29kZShiLndoaWNoKTt9cmV0dXJuIG51bGw7Y2FzZSAiY29tcG9zaXRpb25lbmQiOnJldHVybiBkZSAmJiAia28iICE9PSBiLmxvY2FsZSA/IG51bGwgOiBiLmRhdGE7ZGVmYXVsdDpyZXR1cm4gbnVsbDt9fQogICAgICAgICAgdmFyIGxlID0geyBjb2xvcjogITAsIGRhdGU6ICEwLCBkYXRldGltZTogITAsICJkYXRldGltZS1sb2NhbCI6ICEwLCBlbWFpbDogITAsIG1vbnRoOiAhMCwgbnVtYmVyOiAhMCwgcGFzc3dvcmQ6ICEwLCByYW5nZTogITAsIHNlYXJjaDogITAsIHRlbDogITAsIHRleHQ6ICEwLCB0aW1lOiAhMCwgdXJsOiAhMCwgd2VlazogITAgfTtmdW5jdGlvbiBtZShhKSB7dmFyIGIgPSBhICYmIGEubm9kZU5hbWUgJiYgYS5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpO3JldHVybiAiaW5wdXQiID09PSBiID8gISFsZVthLnR5cGVdIDogInRleHRhcmVhIiA9PT0gYiA/ICEwIDogITE7fWZ1bmN0aW9uIG5lKGEsIGIsIGMsIGQpIHtFYihkKTtiID0gb2UoYiwgIm9uQ2hhbmdlIik7MCA8IGIubGVuZ3RoICYmIChjID0gbmV3IHRkKCJvbkNoYW5nZSIsICJjaGFuZ2UiLCBudWxsLCBjLCBkKSwgYS5wdXNoKHsgZXZlbnQ6IGMsIGxpc3RlbmVyczogYiB9KSk7fXZhciBwZSA9IG51bGwscWUgPSBudWxsO2Z1bmN0aW9uIHJlKGEpIHtzZShhLCAwKTt9ZnVuY3Rpb24gdGUoYSkge3ZhciBiID0gdWUoYSk7aWYgKFdhKGIpKSByZXR1cm4gYTt9CiAgICAgICAgICBmdW5jdGlvbiB2ZShhLCBiKSB7aWYgKCJjaGFuZ2UiID09PSBhKSByZXR1cm4gYjt9dmFyIHdlID0gITE7aWYgKGlhKSB7dmFyIHhlO2lmIChpYSkge3ZhciB5ZSA9ICgib25pbnB1dCIgaW4gZG9jdW1lbnQpO2lmICgheWUpIHt2YXIgemUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKTt6ZS5zZXRBdHRyaWJ1dGUoIm9uaW5wdXQiLCAicmV0dXJuOyIpO3llID0gImZ1bmN0aW9uIiA9PT0gdHlwZW9mIHplLm9uaW5wdXQ7fXhlID0geWU7fSBlbHNlIHhlID0gITE7d2UgPSB4ZSAmJiAoIWRvY3VtZW50LmRvY3VtZW50TW9kZSB8fCA5IDwgZG9jdW1lbnQuZG9jdW1lbnRNb2RlKTt9ZnVuY3Rpb24gQWUoKSB7cGUgJiYgKHBlLmRldGFjaEV2ZW50KCJvbnByb3BlcnR5Y2hhbmdlIiwgQmUpLCBxZSA9IHBlID0gbnVsbCk7fWZ1bmN0aW9uIEJlKGEpIHtpZiAoInZhbHVlIiA9PT0gYS5wcm9wZXJ0eU5hbWUgJiYgdGUocWUpKSB7dmFyIGIgPSBbXTtuZShiLCBxZSwgYSwgeGIoYSkpO0piKHJlLCBiKTt9fQogICAgICAgICAgZnVuY3Rpb24gQ2UoYSwgYiwgYykgeyJmb2N1c2luIiA9PT0gYSA/IChBZSgpLCBwZSA9IGIsIHFlID0gYywgcGUuYXR0YWNoRXZlbnQoIm9ucHJvcGVydHljaGFuZ2UiLCBCZSkpIDogImZvY3Vzb3V0IiA9PT0gYSAmJiBBZSgpO31mdW5jdGlvbiBEZShhKSB7aWYgKCJzZWxlY3Rpb25jaGFuZ2UiID09PSBhIHx8ICJrZXl1cCIgPT09IGEgfHwgImtleWRvd24iID09PSBhKSByZXR1cm4gdGUocWUpO31mdW5jdGlvbiBFZShhLCBiKSB7aWYgKCJjbGljayIgPT09IGEpIHJldHVybiB0ZShiKTt9ZnVuY3Rpb24gRmUoYSwgYikge2lmICgiaW5wdXQiID09PSBhIHx8ICJjaGFuZ2UiID09PSBhKSByZXR1cm4gdGUoYik7fWZ1bmN0aW9uIEdlKGEsIGIpIHtyZXR1cm4gYSA9PT0gYiAmJiAoMCAhPT0gYSB8fCAxIC8gYSA9PT0gMSAvIGIpIHx8IGEgIT09IGEgJiYgYiAhPT0gYjt9dmFyIEhlID0gImZ1bmN0aW9uIiA9PT0gdHlwZW9mIE9iamVjdC5pcyA/IE9iamVjdC5pcyA6IEdlOwogICAgICAgICAgZnVuY3Rpb24gSWUoYSwgYikge2lmIChIZShhLCBiKSkgcmV0dXJuICEwO2lmICgib2JqZWN0IiAhPT0gdHlwZW9mIGEgfHwgbnVsbCA9PT0gYSB8fCAib2JqZWN0IiAhPT0gdHlwZW9mIGIgfHwgbnVsbCA9PT0gYikgcmV0dXJuICExO3ZhciBjID0gT2JqZWN0LmtleXMoYSksZCA9IE9iamVjdC5rZXlzKGIpO2lmIChjLmxlbmd0aCAhPT0gZC5sZW5ndGgpIHJldHVybiAhMTtmb3IgKGQgPSAwOyBkIDwgYy5sZW5ndGg7IGQrKykge3ZhciBlID0gY1tkXTtpZiAoIWphLmNhbGwoYiwgZSkgfHwgIUhlKGFbZV0sIGJbZV0pKSByZXR1cm4gITE7fXJldHVybiAhMDt9ZnVuY3Rpb24gSmUoYSkge2ZvciAoOyBhICYmIGEuZmlyc3RDaGlsZDspIGEgPSBhLmZpcnN0Q2hpbGQ7cmV0dXJuIGE7fQogICAgICAgICAgZnVuY3Rpb24gS2UoYSwgYikge3ZhciBjID0gSmUoYSk7YSA9IDA7Zm9yICh2YXIgZDsgYzspIHtpZiAoMyA9PT0gYy5ub2RlVHlwZSkge2QgPSBhICsgYy50ZXh0Q29udGVudC5sZW5ndGg7aWYgKGEgPD0gYiAmJiBkID49IGIpIHJldHVybiB7IG5vZGU6IGMsIG9mZnNldDogYiAtIGEgfTthID0gZDt9YToge2ZvciAoOyBjOykge2lmIChjLm5leHRTaWJsaW5nKSB7YyA9IGMubmV4dFNpYmxpbmc7YnJlYWsgYTt9YyA9IGMucGFyZW50Tm9kZTt9YyA9IHZvaWQgMDt9YyA9IEplKGMpO319ZnVuY3Rpb24gTGUoYSwgYikge3JldHVybiBhICYmIGIgPyBhID09PSBiID8gITAgOiBhICYmIDMgPT09IGEubm9kZVR5cGUgPyAhMSA6IGIgJiYgMyA9PT0gYi5ub2RlVHlwZSA/IExlKGEsIGIucGFyZW50Tm9kZSkgOiAiY29udGFpbnMiIGluIGEgPyBhLmNvbnRhaW5zKGIpIDogYS5jb21wYXJlRG9jdW1lbnRQb3NpdGlvbiA/ICEhKGEuY29tcGFyZURvY3VtZW50UG9zaXRpb24oYikgJiAxNikgOiAhMSA6ICExO30KICAgICAgICAgIGZ1bmN0aW9uIE1lKCkge2ZvciAodmFyIGEgPSB3aW5kb3csIGIgPSBYYSgpOyBiIGluc3RhbmNlb2YgYS5IVE1MSUZyYW1lRWxlbWVudDspIHt0cnkge3ZhciBjID0gInN0cmluZyIgPT09IHR5cGVvZiBiLmNvbnRlbnRXaW5kb3cubG9jYXRpb24uaHJlZjt9IGNhdGNoIChkKSB7YyA9ICExO31pZiAoYykgYSA9IGIuY29udGVudFdpbmRvdztlbHNlIGJyZWFrO2IgPSBYYShhLmRvY3VtZW50KTt9cmV0dXJuIGI7fWZ1bmN0aW9uIE5lKGEpIHt2YXIgYiA9IGEgJiYgYS5ub2RlTmFtZSAmJiBhLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCk7cmV0dXJuIGIgJiYgKCJpbnB1dCIgPT09IGIgJiYgKCJ0ZXh0IiA9PT0gYS50eXBlIHx8ICJzZWFyY2giID09PSBhLnR5cGUgfHwgInRlbCIgPT09IGEudHlwZSB8fCAidXJsIiA9PT0gYS50eXBlIHx8ICJwYXNzd29yZCIgPT09IGEudHlwZSkgfHwgInRleHRhcmVhIiA9PT0gYiB8fCAidHJ1ZSIgPT09IGEuY29udGVudEVkaXRhYmxlKTt9CiAgICAgICAgICBmdW5jdGlvbiBPZShhKSB7dmFyIGIgPSBNZSgpLGMgPSBhLmZvY3VzZWRFbGVtLGQgPSBhLnNlbGVjdGlvblJhbmdlO2lmIChiICE9PSBjICYmIGMgJiYgYy5vd25lckRvY3VtZW50ICYmIExlKGMub3duZXJEb2N1bWVudC5kb2N1bWVudEVsZW1lbnQsIGMpKSB7aWYgKG51bGwgIT09IGQgJiYgTmUoYykpIGlmIChiID0gZC5zdGFydCwgYSA9IGQuZW5kLCB2b2lkIDAgPT09IGEgJiYgKGEgPSBiKSwgInNlbGVjdGlvblN0YXJ0IiBpbiBjKSBjLnNlbGVjdGlvblN0YXJ0ID0gYiwgYy5zZWxlY3Rpb25FbmQgPSBNYXRoLm1pbihhLCBjLnZhbHVlLmxlbmd0aCk7ZWxzZSBpZiAoYSA9IChiID0gYy5vd25lckRvY3VtZW50IHx8IGRvY3VtZW50KSAmJiBiLmRlZmF1bHRWaWV3IHx8IHdpbmRvdywgYS5nZXRTZWxlY3Rpb24pIHthID0gYS5nZXRTZWxlY3Rpb24oKTt2YXIgZSA9IGMudGV4dENvbnRlbnQubGVuZ3RoLGYgPSBNYXRoLm1pbihkLnN0YXJ0LCBlKTtkID0gdm9pZCAwID09PSBkLmVuZCA/IGYgOiBNYXRoLm1pbihkLmVuZCwgZSk7IWEuZXh0ZW5kICYmIGYgPiBkICYmIChlID0gZCwgZCA9IGYsIGYgPSBlKTtlID0gS2UoYywgZik7dmFyIGcgPSBLZShjLAogICAgICAgICAgICAgICAgZCk7ZSAmJiBnICYmICgxICE9PSBhLnJhbmdlQ291bnQgfHwgYS5hbmNob3JOb2RlICE9PSBlLm5vZGUgfHwgYS5hbmNob3JPZmZzZXQgIT09IGUub2Zmc2V0IHx8IGEuZm9jdXNOb2RlICE9PSBnLm5vZGUgfHwgYS5mb2N1c09mZnNldCAhPT0gZy5vZmZzZXQpICYmIChiID0gYi5jcmVhdGVSYW5nZSgpLCBiLnNldFN0YXJ0KGUubm9kZSwgZS5vZmZzZXQpLCBhLnJlbW92ZUFsbFJhbmdlcygpLCBmID4gZCA/IChhLmFkZFJhbmdlKGIpLCBhLmV4dGVuZChnLm5vZGUsIGcub2Zmc2V0KSkgOiAoYi5zZXRFbmQoZy5ub2RlLCBnLm9mZnNldCksIGEuYWRkUmFuZ2UoYikpKTt9YiA9IFtdO2ZvciAoYSA9IGM7IGEgPSBhLnBhcmVudE5vZGU7KSAxID09PSBhLm5vZGVUeXBlICYmIGIucHVzaCh7IGVsZW1lbnQ6IGEsIGxlZnQ6IGEuc2Nyb2xsTGVmdCwgdG9wOiBhLnNjcm9sbFRvcCB9KTsiZnVuY3Rpb24iID09PSB0eXBlb2YgYy5mb2N1cyAmJiBjLmZvY3VzKCk7Zm9yIChjID0gMDsgYyA8IGIubGVuZ3RoOyBjKyspIGEgPSBiW2NdLCBhLmVsZW1lbnQuc2Nyb2xsTGVmdCA9IGEubGVmdCwgYS5lbGVtZW50LnNjcm9sbFRvcCA9IGEudG9wO319CiAgICAgICAgICB2YXIgUGUgPSBpYSAmJiAiZG9jdW1lbnRNb2RlIiBpbiBkb2N1bWVudCAmJiAxMSA+PSBkb2N1bWVudC5kb2N1bWVudE1vZGUsUWUgPSBudWxsLFJlID0gbnVsbCxTZSA9IG51bGwsVGUgPSAhMTsKICAgICAgICAgIGZ1bmN0aW9uIFVlKGEsIGIsIGMpIHt2YXIgZCA9IGMud2luZG93ID09PSBjID8gYy5kb2N1bWVudCA6IDkgPT09IGMubm9kZVR5cGUgPyBjIDogYy5vd25lckRvY3VtZW50O1RlIHx8IG51bGwgPT0gUWUgfHwgUWUgIT09IFhhKGQpIHx8IChkID0gUWUsICJzZWxlY3Rpb25TdGFydCIgaW4gZCAmJiBOZShkKSA/IGQgPSB7IHN0YXJ0OiBkLnNlbGVjdGlvblN0YXJ0LCBlbmQ6IGQuc2VsZWN0aW9uRW5kIH0gOiAoZCA9IChkLm93bmVyRG9jdW1lbnQgJiYgZC5vd25lckRvY3VtZW50LmRlZmF1bHRWaWV3IHx8IHdpbmRvdykuZ2V0U2VsZWN0aW9uKCksIGQgPSB7IGFuY2hvck5vZGU6IGQuYW5jaG9yTm9kZSwgYW5jaG9yT2Zmc2V0OiBkLmFuY2hvck9mZnNldCwgZm9jdXNOb2RlOiBkLmZvY3VzTm9kZSwgZm9jdXNPZmZzZXQ6IGQuZm9jdXNPZmZzZXQgfSksIFNlICYmIEllKFNlLCBkKSB8fCAoU2UgPSBkLCBkID0gb2UoUmUsICJvblNlbGVjdCIpLCAwIDwgZC5sZW5ndGggJiYgKGIgPSBuZXcgdGQoIm9uU2VsZWN0IiwgInNlbGVjdCIsIG51bGwsIGIsIGMpLCBhLnB1c2goeyBldmVudDogYiwgbGlzdGVuZXJzOiBkIH0pLCBiLnRhcmdldCA9IFFlKSkpO30KICAgICAgICAgIGZ1bmN0aW9uIFZlKGEsIGIpIHt2YXIgYyA9IHt9O2NbYS50b0xvd2VyQ2FzZSgpXSA9IGIudG9Mb3dlckNhc2UoKTtjWyJXZWJraXQiICsgYV0gPSAid2Via2l0IiArIGI7Y1siTW96IiArIGFdID0gIm1veiIgKyBiO3JldHVybiBjO312YXIgV2UgPSB7IGFuaW1hdGlvbmVuZDogVmUoIkFuaW1hdGlvbiIsICJBbmltYXRpb25FbmQiKSwgYW5pbWF0aW9uaXRlcmF0aW9uOiBWZSgiQW5pbWF0aW9uIiwgIkFuaW1hdGlvbkl0ZXJhdGlvbiIpLCBhbmltYXRpb25zdGFydDogVmUoIkFuaW1hdGlvbiIsICJBbmltYXRpb25TdGFydCIpLCB0cmFuc2l0aW9uZW5kOiBWZSgiVHJhbnNpdGlvbiIsICJUcmFuc2l0aW9uRW5kIikgfSxYZSA9IHt9LFllID0ge307CiAgICAgICAgICBpYSAmJiAoWWUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKS5zdHlsZSwgIkFuaW1hdGlvbkV2ZW50IiBpbiB3aW5kb3cgfHwgKGRlbGV0ZSBXZS5hbmltYXRpb25lbmQuYW5pbWF0aW9uLCBkZWxldGUgV2UuYW5pbWF0aW9uaXRlcmF0aW9uLmFuaW1hdGlvbiwgZGVsZXRlIFdlLmFuaW1hdGlvbnN0YXJ0LmFuaW1hdGlvbiksICJUcmFuc2l0aW9uRXZlbnQiIGluIHdpbmRvdyB8fCBkZWxldGUgV2UudHJhbnNpdGlvbmVuZC50cmFuc2l0aW9uKTtmdW5jdGlvbiBaZShhKSB7aWYgKFhlW2FdKSByZXR1cm4gWGVbYV07aWYgKCFXZVthXSkgcmV0dXJuIGE7dmFyIGIgPSBXZVthXSxjO2ZvciAoYyBpbiBiKSBpZiAoYi5oYXNPd25Qcm9wZXJ0eShjKSAmJiBjIGluIFllKSByZXR1cm4gWGVbYV0gPSBiW2NdO3JldHVybiBhO312YXIgJGUgPSBaZSgiYW5pbWF0aW9uZW5kIiksYWYgPSBaZSgiYW5pbWF0aW9uaXRlcmF0aW9uIiksYmYgPSBaZSgiYW5pbWF0aW9uc3RhcnQiKSxjZiA9IFplKCJ0cmFuc2l0aW9uZW5kIiksZGYgPSBuZXcgTWFwKCksZWYgPSAiYWJvcnQgYXV4Q2xpY2sgY2FuY2VsIGNhblBsYXkgY2FuUGxheVRocm91Z2ggY2xpY2sgY2xvc2UgY29udGV4dE1lbnUgY29weSBjdXQgZHJhZyBkcmFnRW5kIGRyYWdFbnRlciBkcmFnRXhpdCBkcmFnTGVhdmUgZHJhZ092ZXIgZHJhZ1N0YXJ0IGRyb3AgZHVyYXRpb25DaGFuZ2UgZW1wdGllZCBlbmNyeXB0ZWQgZW5kZWQgZXJyb3IgZ290UG9pbnRlckNhcHR1cmUgaW5wdXQgaW52YWxpZCBrZXlEb3duIGtleVByZXNzIGtleVVwIGxvYWQgbG9hZGVkRGF0YSBsb2FkZWRNZXRhZGF0YSBsb2FkU3RhcnQgbG9zdFBvaW50ZXJDYXB0dXJlIG1vdXNlRG93biBtb3VzZU1vdmUgbW91c2VPdXQgbW91c2VPdmVyIG1vdXNlVXAgcGFzdGUgcGF1c2UgcGxheSBwbGF5aW5nIHBvaW50ZXJDYW5jZWwgcG9pbnRlckRvd24gcG9pbnRlck1vdmUgcG9pbnRlck91dCBwb2ludGVyT3ZlciBwb2ludGVyVXAgcHJvZ3Jlc3MgcmF0ZUNoYW5nZSByZXNldCByZXNpemUgc2Vla2VkIHNlZWtpbmcgc3RhbGxlZCBzdWJtaXQgc3VzcGVuZCB0aW1lVXBkYXRlIHRvdWNoQ2FuY2VsIHRvdWNoRW5kIHRvdWNoU3RhcnQgdm9sdW1lQ2hhbmdlIHNjcm9sbCB0b2dnbGUgdG91Y2hNb3ZlIHdhaXRpbmcgd2hlZWwiLnNwbGl0KCIgIik7CiAgICAgICAgICBmdW5jdGlvbiBmZihhLCBiKSB7ZGYuc2V0KGEsIGIpO2ZhKGIsIFthXSk7fWZvciAodmFyIGdmID0gMDsgZ2YgPCBlZi5sZW5ndGg7IGdmKyspIHt2YXIgaGYgPSBlZltnZl0samYgPSBoZi50b0xvd2VyQ2FzZSgpLGtmID0gaGZbMF0udG9VcHBlckNhc2UoKSArIGhmLnNsaWNlKDEpO2ZmKGpmLCAib24iICsga2YpO31mZigkZSwgIm9uQW5pbWF0aW9uRW5kIik7ZmYoYWYsICJvbkFuaW1hdGlvbkl0ZXJhdGlvbiIpO2ZmKGJmLCAib25BbmltYXRpb25TdGFydCIpO2ZmKCJkYmxjbGljayIsICJvbkRvdWJsZUNsaWNrIik7ZmYoImZvY3VzaW4iLCAib25Gb2N1cyIpO2ZmKCJmb2N1c291dCIsICJvbkJsdXIiKTtmZihjZiwgIm9uVHJhbnNpdGlvbkVuZCIpO2hhKCJvbk1vdXNlRW50ZXIiLCBbIm1vdXNlb3V0IiwgIm1vdXNlb3ZlciJdKTtoYSgib25Nb3VzZUxlYXZlIiwgWyJtb3VzZW91dCIsICJtb3VzZW92ZXIiXSk7aGEoIm9uUG9pbnRlckVudGVyIiwgWyJwb2ludGVyb3V0IiwgInBvaW50ZXJvdmVyIl0pOwogICAgICAgICAgaGEoIm9uUG9pbnRlckxlYXZlIiwgWyJwb2ludGVyb3V0IiwgInBvaW50ZXJvdmVyIl0pO2ZhKCJvbkNoYW5nZSIsICJjaGFuZ2UgY2xpY2sgZm9jdXNpbiBmb2N1c291dCBpbnB1dCBrZXlkb3duIGtleXVwIHNlbGVjdGlvbmNoYW5nZSIuc3BsaXQoIiAiKSk7ZmEoIm9uU2VsZWN0IiwgImZvY3Vzb3V0IGNvbnRleHRtZW51IGRyYWdlbmQgZm9jdXNpbiBrZXlkb3duIGtleXVwIG1vdXNlZG93biBtb3VzZXVwIHNlbGVjdGlvbmNoYW5nZSIuc3BsaXQoIiAiKSk7ZmEoIm9uQmVmb3JlSW5wdXQiLCBbImNvbXBvc2l0aW9uZW5kIiwgImtleXByZXNzIiwgInRleHRJbnB1dCIsICJwYXN0ZSJdKTtmYSgib25Db21wb3NpdGlvbkVuZCIsICJjb21wb3NpdGlvbmVuZCBmb2N1c291dCBrZXlkb3duIGtleXByZXNzIGtleXVwIG1vdXNlZG93biIuc3BsaXQoIiAiKSk7ZmEoIm9uQ29tcG9zaXRpb25TdGFydCIsICJjb21wb3NpdGlvbnN0YXJ0IGZvY3Vzb3V0IGtleWRvd24ga2V5cHJlc3Mga2V5dXAgbW91c2Vkb3duIi5zcGxpdCgiICIpKTsKICAgICAgICAgIGZhKCJvbkNvbXBvc2l0aW9uVXBkYXRlIiwgImNvbXBvc2l0aW9udXBkYXRlIGZvY3Vzb3V0IGtleWRvd24ga2V5cHJlc3Mga2V5dXAgbW91c2Vkb3duIi5zcGxpdCgiICIpKTt2YXIgbGYgPSAiYWJvcnQgY2FucGxheSBjYW5wbGF5dGhyb3VnaCBkdXJhdGlvbmNoYW5nZSBlbXB0aWVkIGVuY3J5cHRlZCBlbmRlZCBlcnJvciBsb2FkZWRkYXRhIGxvYWRlZG1ldGFkYXRhIGxvYWRzdGFydCBwYXVzZSBwbGF5IHBsYXlpbmcgcHJvZ3Jlc3MgcmF0ZWNoYW5nZSByZXNpemUgc2Vla2VkIHNlZWtpbmcgc3RhbGxlZCBzdXNwZW5kIHRpbWV1cGRhdGUgdm9sdW1lY2hhbmdlIHdhaXRpbmciLnNwbGl0KCIgIiksbWYgPSBuZXcgU2V0KCJjYW5jZWwgY2xvc2UgaW52YWxpZCBsb2FkIHNjcm9sbCB0b2dnbGUiLnNwbGl0KCIgIikuY29uY2F0KGxmKSk7CiAgICAgICAgICBmdW5jdGlvbiBuZihhLCBiLCBjKSB7dmFyIGQgPSBhLnR5cGUgfHwgInVua25vd24tZXZlbnQiO2EuY3VycmVudFRhcmdldCA9IGM7VWIoZCwgYiwgdm9pZCAwLCBhKTthLmN1cnJlbnRUYXJnZXQgPSBudWxsO30KICAgICAgICAgIGZ1bmN0aW9uIHNlKGEsIGIpIHtiID0gMCAhPT0gKGIgJiA0KTtmb3IgKHZhciBjID0gMDsgYyA8IGEubGVuZ3RoOyBjKyspIHt2YXIgZCA9IGFbY10sZSA9IGQuZXZlbnQ7ZCA9IGQubGlzdGVuZXJzO2E6IHt2YXIgZiA9IHZvaWQgMDtpZiAoYikgZm9yICh2YXIgZyA9IGQubGVuZ3RoIC0gMTsgMCA8PSBnOyBnLS0pIHt2YXIgaCA9IGRbZ10sayA9IGguaW5zdGFuY2UsbCA9IGguY3VycmVudFRhcmdldDtoID0gaC5saXN0ZW5lcjtpZiAoayAhPT0gZiAmJiBlLmlzUHJvcGFnYXRpb25TdG9wcGVkKCkpIGJyZWFrIGE7bmYoZSwgaCwgbCk7ZiA9IGs7fSBlbHNlIGZvciAoZyA9IDA7IGcgPCBkLmxlbmd0aDsgZysrKSB7aCA9IGRbZ107ayA9IGguaW5zdGFuY2U7bCA9IGguY3VycmVudFRhcmdldDtoID0gaC5saXN0ZW5lcjtpZiAoayAhPT0gZiAmJiBlLmlzUHJvcGFnYXRpb25TdG9wcGVkKCkpIGJyZWFrIGE7bmYoZSwgaCwgbCk7ZiA9IGs7fX19aWYgKFFiKSB0aHJvdyBhID0gUmIsIFFiID0gITEsIFJiID0gbnVsbCwgYTt9CiAgICAgICAgICBmdW5jdGlvbiBEKGEsIGIpIHt2YXIgYyA9IGJbb2ZdO3ZvaWQgMCA9PT0gYyAmJiAoYyA9IGJbb2ZdID0gbmV3IFNldCgpKTt2YXIgZCA9IGEgKyAiX19idWJibGUiO2MuaGFzKGQpIHx8IChwZihiLCBhLCAyLCAhMSksIGMuYWRkKGQpKTt9ZnVuY3Rpb24gcWYoYSwgYiwgYykge3ZhciBkID0gMDtiICYmIChkIHw9IDQpO3BmKGMsIGEsIGQsIGIpO312YXIgcmYgPSAiX3JlYWN0TGlzdGVuaW5nIiArIE1hdGgucmFuZG9tKCkudG9TdHJpbmcoMzYpLnNsaWNlKDIpO2Z1bmN0aW9uIHNmKGEpIHtpZiAoIWFbcmZdKSB7YVtyZl0gPSAhMDtkYS5mb3JFYWNoKGZ1bmN0aW9uIChiKSB7InNlbGVjdGlvbmNoYW5nZSIgIT09IGIgJiYgKG1mLmhhcyhiKSB8fCBxZihiLCAhMSwgYSksIHFmKGIsICEwLCBhKSk7fSk7dmFyIGIgPSA5ID09PSBhLm5vZGVUeXBlID8gYSA6IGEub3duZXJEb2N1bWVudDtudWxsID09PSBiIHx8IGJbcmZdIHx8IChiW3JmXSA9ICEwLCBxZigic2VsZWN0aW9uY2hhbmdlIiwgITEsIGIpKTt9fQogICAgICAgICAgZnVuY3Rpb24gcGYoYSwgYiwgYywgZCkge3N3aXRjaCAoamQoYikpIHtjYXNlIDE6dmFyIGUgPSBlZDticmVhaztjYXNlIDQ6ZSA9IGdkO2JyZWFrO2RlZmF1bHQ6ZSA9IGZkO31jID0gZS5iaW5kKG51bGwsIGIsIGMsIGEpO2UgPSB2b2lkIDA7IUxiIHx8ICJ0b3VjaHN0YXJ0IiAhPT0gYiAmJiAidG91Y2htb3ZlIiAhPT0gYiAmJiAid2hlZWwiICE9PSBiIHx8IChlID0gITApO2QgPyB2b2lkIDAgIT09IGUgPyBhLmFkZEV2ZW50TGlzdGVuZXIoYiwgYywgeyBjYXB0dXJlOiAhMCwgcGFzc2l2ZTogZSB9KSA6IGEuYWRkRXZlbnRMaXN0ZW5lcihiLCBjLCAhMCkgOiB2b2lkIDAgIT09IGUgPyBhLmFkZEV2ZW50TGlzdGVuZXIoYiwgYywgeyBwYXNzaXZlOiBlIH0pIDogYS5hZGRFdmVudExpc3RlbmVyKGIsIGMsICExKTt9CiAgICAgICAgICBmdW5jdGlvbiBoZChhLCBiLCBjLCBkLCBlKSB7dmFyIGYgPSBkO2lmICgwID09PSAoYiAmIDEpICYmIDAgPT09IChiICYgMikgJiYgbnVsbCAhPT0gZCkgYTogZm9yICg7Oykge2lmIChudWxsID09PSBkKSByZXR1cm47dmFyIGcgPSBkLnRhZztpZiAoMyA9PT0gZyB8fCA0ID09PSBnKSB7dmFyIGggPSBkLnN0YXRlTm9kZS5jb250YWluZXJJbmZvO2lmIChoID09PSBlIHx8IDggPT09IGgubm9kZVR5cGUgJiYgaC5wYXJlbnROb2RlID09PSBlKSBicmVhaztpZiAoNCA9PT0gZykgZm9yIChnID0gZC5yZXR1cm47IG51bGwgIT09IGc7KSB7dmFyIGsgPSBnLnRhZztpZiAoMyA9PT0gayB8fCA0ID09PSBrKSBpZiAoayA9IGcuc3RhdGVOb2RlLmNvbnRhaW5lckluZm8sIGsgPT09IGUgfHwgOCA9PT0gay5ub2RlVHlwZSAmJiBrLnBhcmVudE5vZGUgPT09IGUpIHJldHVybjtnID0gZy5yZXR1cm47fWZvciAoOyBudWxsICE9PSBoOykge2cgPSBXYyhoKTtpZiAobnVsbCA9PT0gZykgcmV0dXJuO2sgPSBnLnRhZztpZiAoNSA9PT0gayB8fCA2ID09PSBrKSB7ZCA9IGYgPSBnO2NvbnRpbnVlIGE7fWggPSBoLnBhcmVudE5vZGU7fX1kID0gZC5yZXR1cm47fUpiKGZ1bmN0aW9uICgpIHt2YXIgZCA9IGYsZSA9IHhiKGMpLGcgPSBbXTsKICAgICAgICAgICAgICBhOiB7dmFyIGggPSBkZi5nZXQoYSk7aWYgKHZvaWQgMCAhPT0gaCkge3ZhciBrID0gdGQsbiA9IGE7c3dpdGNoIChhKSB7Y2FzZSAia2V5cHJlc3MiOmlmICgwID09PSBvZChjKSkgYnJlYWsgYTtjYXNlICJrZXlkb3duIjpjYXNlICJrZXl1cCI6ayA9IFJkO2JyZWFrO2Nhc2UgImZvY3VzaW4iOm4gPSAiZm9jdXMiO2sgPSBGZDticmVhaztjYXNlICJmb2N1c291dCI6biA9ICJibHVyIjtrID0gRmQ7YnJlYWs7Y2FzZSAiYmVmb3JlYmx1ciI6Y2FzZSAiYWZ0ZXJibHVyIjprID0gRmQ7YnJlYWs7Y2FzZSAiY2xpY2siOmlmICgyID09PSBjLmJ1dHRvbikgYnJlYWsgYTtjYXNlICJhdXhjbGljayI6Y2FzZSAiZGJsY2xpY2siOmNhc2UgIm1vdXNlZG93biI6Y2FzZSAibW91c2Vtb3ZlIjpjYXNlICJtb3VzZXVwIjpjYXNlICJtb3VzZW91dCI6Y2FzZSAibW91c2VvdmVyIjpjYXNlICJjb250ZXh0bWVudSI6ayA9IEJkO2JyZWFrO2Nhc2UgImRyYWciOmNhc2UgImRyYWdlbmQiOmNhc2UgImRyYWdlbnRlciI6Y2FzZSAiZHJhZ2V4aXQiOmNhc2UgImRyYWdsZWF2ZSI6Y2FzZSAiZHJhZ292ZXIiOmNhc2UgImRyYWdzdGFydCI6Y2FzZSAiZHJvcCI6ayA9CiAgICAgICAgICAgICAgICAgICAgICBEZDticmVhaztjYXNlICJ0b3VjaGNhbmNlbCI6Y2FzZSAidG91Y2hlbmQiOmNhc2UgInRvdWNobW92ZSI6Y2FzZSAidG91Y2hzdGFydCI6ayA9IFZkO2JyZWFrO2Nhc2UgJGU6Y2FzZSBhZjpjYXNlIGJmOmsgPSBIZDticmVhaztjYXNlIGNmOmsgPSBYZDticmVhaztjYXNlICJzY3JvbGwiOmsgPSB2ZDticmVhaztjYXNlICJ3aGVlbCI6ayA9IFpkO2JyZWFrO2Nhc2UgImNvcHkiOmNhc2UgImN1dCI6Y2FzZSAicGFzdGUiOmsgPSBKZDticmVhaztjYXNlICJnb3Rwb2ludGVyY2FwdHVyZSI6Y2FzZSAibG9zdHBvaW50ZXJjYXB0dXJlIjpjYXNlICJwb2ludGVyY2FuY2VsIjpjYXNlICJwb2ludGVyZG93biI6Y2FzZSAicG9pbnRlcm1vdmUiOmNhc2UgInBvaW50ZXJvdXQiOmNhc2UgInBvaW50ZXJvdmVyIjpjYXNlICJwb2ludGVydXAiOmsgPSBUZDt9dmFyIHQgPSAwICE9PSAoYiAmIDQpLEogPSAhdCAmJiAic2Nyb2xsIiA9PT0gYSx4ID0gdCA/IG51bGwgIT09IGggPyBoICsgIkNhcHR1cmUiIDogbnVsbCA6IGg7dCA9IFtdO2ZvciAodmFyIHcgPSBkLCB1OyBudWxsICE9PQogICAgICAgICAgICAgICAgICB3Oykge3UgPSB3O3ZhciBGID0gdS5zdGF0ZU5vZGU7NSA9PT0gdS50YWcgJiYgbnVsbCAhPT0gRiAmJiAodSA9IEYsIG51bGwgIT09IHggJiYgKEYgPSBLYih3LCB4KSwgbnVsbCAhPSBGICYmIHQucHVzaCh0Zih3LCBGLCB1KSkpKTtpZiAoSikgYnJlYWs7dyA9IHcucmV0dXJuO30wIDwgdC5sZW5ndGggJiYgKGggPSBuZXcgayhoLCBuLCBudWxsLCBjLCBlKSwgZy5wdXNoKHsgZXZlbnQ6IGgsIGxpc3RlbmVyczogdCB9KSk7fX1pZiAoMCA9PT0gKGIgJiA3KSkge2E6IHtoID0gIm1vdXNlb3ZlciIgPT09IGEgfHwgInBvaW50ZXJvdmVyIiA9PT0gYTtrID0gIm1vdXNlb3V0IiA9PT0gYSB8fCAicG9pbnRlcm91dCIgPT09IGE7aWYgKGggJiYgYyAhPT0gd2IgJiYgKG4gPSBjLnJlbGF0ZWRUYXJnZXQgfHwgYy5mcm9tRWxlbWVudCkgJiYgKFdjKG4pIHx8IG5bdWZdKSkgYnJlYWsgYTtpZiAoayB8fCBoKSB7aCA9IGUud2luZG93ID09PSBlID8gZSA6IChoID0gZS5vd25lckRvY3VtZW50KSA/IGguZGVmYXVsdFZpZXcgfHwgaC5wYXJlbnRXaW5kb3cgOiB3aW5kb3c7aWYgKGspIHtpZiAobiA9IGMucmVsYXRlZFRhcmdldCB8fCBjLnRvRWxlbWVudCwgayA9IGQsIG4gPSBuID8gV2MobikgOiBudWxsLCBudWxsICE9PQogICAgICAgICAgICAgICAgICAgICAgbiAmJiAoSiA9IFZiKG4pLCBuICE9PSBKIHx8IDUgIT09IG4udGFnICYmIDYgIT09IG4udGFnKSkgbiA9IG51bGw7fSBlbHNlIGsgPSBudWxsLCBuID0gZDtpZiAoayAhPT0gbikge3QgPSBCZDtGID0gIm9uTW91c2VMZWF2ZSI7eCA9ICJvbk1vdXNlRW50ZXIiO3cgPSAibW91c2UiO2lmICgicG9pbnRlcm91dCIgPT09IGEgfHwgInBvaW50ZXJvdmVyIiA9PT0gYSkgdCA9IFRkLCBGID0gIm9uUG9pbnRlckxlYXZlIiwgeCA9ICJvblBvaW50ZXJFbnRlciIsIHcgPSAicG9pbnRlciI7SiA9IG51bGwgPT0gayA/IGggOiB1ZShrKTt1ID0gbnVsbCA9PSBuID8gaCA6IHVlKG4pO2ggPSBuZXcgdChGLCB3ICsgImxlYXZlIiwgaywgYywgZSk7aC50YXJnZXQgPSBKO2gucmVsYXRlZFRhcmdldCA9IHU7RiA9IG51bGw7V2MoZSkgPT09IGQgJiYgKHQgPSBuZXcgdCh4LCB3ICsgImVudGVyIiwgbiwgYywgZSksIHQudGFyZ2V0ID0gdSwgdC5yZWxhdGVkVGFyZ2V0ID0gSiwgRiA9IHQpO0ogPSBGO2lmIChrICYmIG4pIGI6IHt0ID0gazt4ID0gbjt3ID0gMDtmb3IgKHUgPSB0OyB1OyB1ID0gdmYodSkpIHcrKzt1ID0gMDtmb3IgKEYgPSB4OyBGOyBGID0gdmYoRikpIHUrKztmb3IgKDsgMCA8IHcgLSB1OykgdCA9IHZmKHQpLCB3LS07Zm9yICg7IDAgPCB1IC0gdzspIHggPQogICAgICAgICAgICAgICAgICAgICAgICB2Zih4KSwgdS0tO2ZvciAoOyB3LS07KSB7aWYgKHQgPT09IHggfHwgbnVsbCAhPT0geCAmJiB0ID09PSB4LmFsdGVybmF0ZSkgYnJlYWsgYjt0ID0gdmYodCk7eCA9IHZmKHgpO310ID0gbnVsbDt9IGVsc2UgdCA9IG51bGw7bnVsbCAhPT0gayAmJiB3ZihnLCBoLCBrLCB0LCAhMSk7bnVsbCAhPT0gbiAmJiBudWxsICE9PSBKICYmIHdmKGcsIEosIG4sIHQsICEwKTt9fX1hOiB7aCA9IGQgPyB1ZShkKSA6IHdpbmRvdztrID0gaC5ub2RlTmFtZSAmJiBoLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCk7aWYgKCJzZWxlY3QiID09PSBrIHx8ICJpbnB1dCIgPT09IGsgJiYgImZpbGUiID09PSBoLnR5cGUpIHZhciBuYSA9IHZlO2Vsc2UgaWYgKG1lKGgpKSB7aWYgKHdlKSBuYSA9IEZlO2Vsc2Uge25hID0gRGU7dmFyIHhhID0gQ2U7fX0gZWxzZSAoayA9IGgubm9kZU5hbWUpICYmICJpbnB1dCIgPT09IGsudG9Mb3dlckNhc2UoKSAmJiAoImNoZWNrYm94IiA9PT0gaC50eXBlIHx8ICJyYWRpbyIgPT09IGgudHlwZSkgJiYgKG5hID0gRWUpO2lmIChuYSAmJiAobmEgPSBuYShhLCBkKSkpIHtuZShnLCBuYSwgYywgZSk7YnJlYWsgYTt9eGEgJiYgeGEoYSwgaCwgZCk7ImZvY3Vzb3V0IiA9PT0gYSAmJiAoeGEgPSBoLl93cmFwcGVyU3RhdGUpICYmCiAgICAgICAgICAgICAgICAgIHhhLmNvbnRyb2xsZWQgJiYgIm51bWJlciIgPT09IGgudHlwZSAmJiBjYihoLCAibnVtYmVyIiwgaC52YWx1ZSk7fXhhID0gZCA/IHVlKGQpIDogd2luZG93O3N3aXRjaCAoYSkge2Nhc2UgImZvY3VzaW4iOmlmIChtZSh4YSkgfHwgInRydWUiID09PSB4YS5jb250ZW50RWRpdGFibGUpIFFlID0geGEsIFJlID0gZCwgU2UgPSBudWxsO2JyZWFrO2Nhc2UgImZvY3Vzb3V0IjpTZSA9IFJlID0gUWUgPSBudWxsO2JyZWFrO2Nhc2UgIm1vdXNlZG93biI6VGUgPSAhMDticmVhaztjYXNlICJjb250ZXh0bWVudSI6Y2FzZSAibW91c2V1cCI6Y2FzZSAiZHJhZ2VuZCI6VGUgPSAhMTtVZShnLCBjLCBlKTticmVhaztjYXNlICJzZWxlY3Rpb25jaGFuZ2UiOmlmIChQZSkgYnJlYWs7Y2FzZSAia2V5ZG93biI6Y2FzZSAia2V5dXAiOlVlKGcsIGMsIGUpO312YXIgJGE7aWYgKGFlKSBiOiB7c3dpdGNoIChhKSB7Y2FzZSAiY29tcG9zaXRpb25zdGFydCI6dmFyIGJhID0gIm9uQ29tcG9zaXRpb25TdGFydCI7YnJlYWsgYjtjYXNlICJjb21wb3NpdGlvbmVuZCI6YmEgPSAib25Db21wb3NpdGlvbkVuZCI7CiAgICAgICAgICAgICAgICAgICAgICBicmVhayBiO2Nhc2UgImNvbXBvc2l0aW9udXBkYXRlIjpiYSA9ICJvbkNvbXBvc2l0aW9uVXBkYXRlIjticmVhayBiO31iYSA9IHZvaWQgMDt9IGVsc2UgaWUgPyBnZShhLCBjKSAmJiAoYmEgPSAib25Db21wb3NpdGlvbkVuZCIpIDogImtleWRvd24iID09PSBhICYmIDIyOSA9PT0gYy5rZXlDb2RlICYmIChiYSA9ICJvbkNvbXBvc2l0aW9uU3RhcnQiKTtiYSAmJiAoZGUgJiYgImtvIiAhPT0gYy5sb2NhbGUgJiYgKGllIHx8ICJvbkNvbXBvc2l0aW9uU3RhcnQiICE9PSBiYSA/ICJvbkNvbXBvc2l0aW9uRW5kIiA9PT0gYmEgJiYgaWUgJiYgKCRhID0gbmQoKSkgOiAoa2QgPSBlLCBsZCA9ICJ2YWx1ZSIgaW4ga2QgPyBrZC52YWx1ZSA6IGtkLnRleHRDb250ZW50LCBpZSA9ICEwKSksIHhhID0gb2UoZCwgYmEpLCAwIDwgeGEubGVuZ3RoICYmIChiYSA9IG5ldyBMZChiYSwgYSwgbnVsbCwgYywgZSksIGcucHVzaCh7IGV2ZW50OiBiYSwgbGlzdGVuZXJzOiB4YSB9KSwgJGEgPyBiYS5kYXRhID0gJGEgOiAoJGEgPSBoZShjKSwgbnVsbCAhPT0gJGEgJiYgKGJhLmRhdGEgPSAkYSkpKSk7aWYgKCRhID0gY2UgPyBqZShhLCBjKSA6IGtlKGEsIGMpKSBkID0gb2UoZCwgIm9uQmVmb3JlSW5wdXQiKSwKICAgICAgICAgICAgICAgIDAgPCBkLmxlbmd0aCAmJiAoZSA9IG5ldyBMZCgib25CZWZvcmVJbnB1dCIsICJiZWZvcmVpbnB1dCIsIG51bGwsIGMsIGUpLCBnLnB1c2goeyBldmVudDogZSwgbGlzdGVuZXJzOiBkIH0pLCBlLmRhdGEgPSAkYSk7fXNlKGcsIGIpO30pO31mdW5jdGlvbiB0ZihhLCBiLCBjKSB7cmV0dXJuIHsgaW5zdGFuY2U6IGEsIGxpc3RlbmVyOiBiLCBjdXJyZW50VGFyZ2V0OiBjIH07fWZ1bmN0aW9uIG9lKGEsIGIpIHtmb3IgKHZhciBjID0gYiArICJDYXB0dXJlIiwgZCA9IFtdOyBudWxsICE9PSBhOykge3ZhciBlID0gYSxmID0gZS5zdGF0ZU5vZGU7NSA9PT0gZS50YWcgJiYgbnVsbCAhPT0gZiAmJiAoZSA9IGYsIGYgPSBLYihhLCBjKSwgbnVsbCAhPSBmICYmIGQudW5zaGlmdCh0ZihhLCBmLCBlKSksIGYgPSBLYihhLCBiKSwgbnVsbCAhPSBmICYmIGQucHVzaCh0ZihhLCBmLCBlKSkpO2EgPSBhLnJldHVybjt9cmV0dXJuIGQ7fWZ1bmN0aW9uIHZmKGEpIHtpZiAobnVsbCA9PT0gYSkgcmV0dXJuIG51bGw7ZG8gYSA9IGEucmV0dXJuOyB3aGlsZSAoYSAmJiA1ICE9PSBhLnRhZyk7cmV0dXJuIGEgPyBhIDogbnVsbDt9CiAgICAgICAgICBmdW5jdGlvbiB3ZihhLCBiLCBjLCBkLCBlKSB7Zm9yICh2YXIgZiA9IGIuX3JlYWN0TmFtZSwgZyA9IFtdOyBudWxsICE9PSBjICYmIGMgIT09IGQ7KSB7dmFyIGggPSBjLGsgPSBoLmFsdGVybmF0ZSxsID0gaC5zdGF0ZU5vZGU7aWYgKG51bGwgIT09IGsgJiYgayA9PT0gZCkgYnJlYWs7NSA9PT0gaC50YWcgJiYgbnVsbCAhPT0gbCAmJiAoaCA9IGwsIGUgPyAoayA9IEtiKGMsIGYpLCBudWxsICE9IGsgJiYgZy51bnNoaWZ0KHRmKGMsIGssIGgpKSkgOiBlIHx8IChrID0gS2IoYywgZiksIG51bGwgIT0gayAmJiBnLnB1c2godGYoYywgaywgaCkpKSk7YyA9IGMucmV0dXJuO30wICE9PSBnLmxlbmd0aCAmJiBhLnB1c2goeyBldmVudDogYiwgbGlzdGVuZXJzOiBnIH0pO312YXIgeGYgPSAvXHJcbj8vZyx5ZiA9IC9cdTAwMDB8XHVGRkZEL2c7ZnVuY3Rpb24gemYoYSkge3JldHVybiAoInN0cmluZyIgPT09IHR5cGVvZiBhID8gYSA6ICIiICsgYSkucmVwbGFjZSh4ZiwgIlxuIikucmVwbGFjZSh5ZiwgIiIpO31mdW5jdGlvbiBBZihhLCBiLCBjKSB7YiA9IHpmKGIpO2lmICh6ZihhKSAhPT0gYiAmJiBjKSB0aHJvdyBFcnJvcihwKDQyNSkpO31mdW5jdGlvbiBCZigpIHt9CiAgICAgICAgICB2YXIgQ2YgPSBudWxsLERmID0gbnVsbDtmdW5jdGlvbiBFZihhLCBiKSB7cmV0dXJuICJ0ZXh0YXJlYSIgPT09IGEgfHwgIm5vc2NyaXB0IiA9PT0gYSB8fCAic3RyaW5nIiA9PT0gdHlwZW9mIGIuY2hpbGRyZW4gfHwgIm51bWJlciIgPT09IHR5cGVvZiBiLmNoaWxkcmVuIHx8ICJvYmplY3QiID09PSB0eXBlb2YgYi5kYW5nZXJvdXNseVNldElubmVySFRNTCAmJiBudWxsICE9PSBiLmRhbmdlcm91c2x5U2V0SW5uZXJIVE1MICYmIG51bGwgIT0gYi5kYW5nZXJvdXNseVNldElubmVySFRNTC5fX2h0bWw7fQogICAgICAgICAgdmFyIEZmID0gImZ1bmN0aW9uIiA9PT0gdHlwZW9mIHNldFRpbWVvdXQgPyBzZXRUaW1lb3V0IDogdm9pZCAwLEdmID0gImZ1bmN0aW9uIiA9PT0gdHlwZW9mIGNsZWFyVGltZW91dCA/IGNsZWFyVGltZW91dCA6IHZvaWQgMCxIZiA9ICJmdW5jdGlvbiIgPT09IHR5cGVvZiBQcm9taXNlID8gUHJvbWlzZSA6IHZvaWQgMCxKZiA9ICJmdW5jdGlvbiIgPT09IHR5cGVvZiBxdWV1ZU1pY3JvdGFzayA/IHF1ZXVlTWljcm90YXNrIDogInVuZGVmaW5lZCIgIT09IHR5cGVvZiBIZiA/IGZ1bmN0aW9uIChhKSB7cmV0dXJuIEhmLnJlc29sdmUobnVsbCkudGhlbihhKS5jYXRjaChJZik7fSA6IEZmO2Z1bmN0aW9uIElmKGEpIHtzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHt0aHJvdyBhO30pO30KICAgICAgICAgIGZ1bmN0aW9uIEtmKGEsIGIpIHt2YXIgYyA9IGIsZCA9IDA7ZG8ge3ZhciBlID0gYy5uZXh0U2libGluZzthLnJlbW92ZUNoaWxkKGMpO2lmIChlICYmIDggPT09IGUubm9kZVR5cGUpIGlmIChjID0gZS5kYXRhLCAiLyQiID09PSBjKSB7aWYgKDAgPT09IGQpIHthLnJlbW92ZUNoaWxkKGUpO2JkKGIpO3JldHVybjt9ZC0tO30gZWxzZSAiJCIgIT09IGMgJiYgIiQ/IiAhPT0gYyAmJiAiJCEiICE9PSBjIHx8IGQrKztjID0gZTt9IHdoaWxlIChjKTtiZChiKTt9ZnVuY3Rpb24gTGYoYSkge2ZvciAoOyBudWxsICE9IGE7IGEgPSBhLm5leHRTaWJsaW5nKSB7dmFyIGIgPSBhLm5vZGVUeXBlO2lmICgxID09PSBiIHx8IDMgPT09IGIpIGJyZWFrO2lmICg4ID09PSBiKSB7YiA9IGEuZGF0YTtpZiAoIiQiID09PSBiIHx8ICIkISIgPT09IGIgfHwgIiQ/IiA9PT0gYikgYnJlYWs7aWYgKCIvJCIgPT09IGIpIHJldHVybiBudWxsO319cmV0dXJuIGE7fQogICAgICAgICAgZnVuY3Rpb24gTWYoYSkge2EgPSBhLnByZXZpb3VzU2libGluZztmb3IgKHZhciBiID0gMDsgYTspIHtpZiAoOCA9PT0gYS5ub2RlVHlwZSkge3ZhciBjID0gYS5kYXRhO2lmICgiJCIgPT09IGMgfHwgIiQhIiA9PT0gYyB8fCAiJD8iID09PSBjKSB7aWYgKDAgPT09IGIpIHJldHVybiBhO2ItLTt9IGVsc2UgIi8kIiA9PT0gYyAmJiBiKys7fWEgPSBhLnByZXZpb3VzU2libGluZzt9cmV0dXJuIG51bGw7fXZhciBOZiA9IE1hdGgucmFuZG9tKCkudG9TdHJpbmcoMzYpLnNsaWNlKDIpLE9mID0gIl9fcmVhY3RGaWJlciQiICsgTmYsUGYgPSAiX19yZWFjdFByb3BzJCIgKyBOZix1ZiA9ICJfX3JlYWN0Q29udGFpbmVyJCIgKyBOZixvZiA9ICJfX3JlYWN0RXZlbnRzJCIgKyBOZixRZiA9ICJfX3JlYWN0TGlzdGVuZXJzJCIgKyBOZixSZiA9ICJfX3JlYWN0SGFuZGxlcyQiICsgTmY7CiAgICAgICAgICBmdW5jdGlvbiBXYyhhKSB7dmFyIGIgPSBhW09mXTtpZiAoYikgcmV0dXJuIGI7Zm9yICh2YXIgYyA9IGEucGFyZW50Tm9kZTsgYzspIHtpZiAoYiA9IGNbdWZdIHx8IGNbT2ZdKSB7YyA9IGIuYWx0ZXJuYXRlO2lmIChudWxsICE9PSBiLmNoaWxkIHx8IG51bGwgIT09IGMgJiYgbnVsbCAhPT0gYy5jaGlsZCkgZm9yIChhID0gTWYoYSk7IG51bGwgIT09IGE7KSB7aWYgKGMgPSBhW09mXSkgcmV0dXJuIGM7YSA9IE1mKGEpO31yZXR1cm4gYjt9YSA9IGM7YyA9IGEucGFyZW50Tm9kZTt9cmV0dXJuIG51bGw7fWZ1bmN0aW9uIENiKGEpIHthID0gYVtPZl0gfHwgYVt1Zl07cmV0dXJuICFhIHx8IDUgIT09IGEudGFnICYmIDYgIT09IGEudGFnICYmIDEzICE9PSBhLnRhZyAmJiAzICE9PSBhLnRhZyA/IG51bGwgOiBhO31mdW5jdGlvbiB1ZShhKSB7aWYgKDUgPT09IGEudGFnIHx8IDYgPT09IGEudGFnKSByZXR1cm4gYS5zdGF0ZU5vZGU7dGhyb3cgRXJyb3IocCgzMykpO31mdW5jdGlvbiBEYihhKSB7cmV0dXJuIGFbUGZdIHx8IG51bGw7fXZhciBTZiA9IFtdLFRmID0gLTE7ZnVuY3Rpb24gVWYoYSkge3JldHVybiB7IGN1cnJlbnQ6IGEgfTt9CiAgICAgICAgICBmdW5jdGlvbiBFKGEpIHswID4gVGYgfHwgKGEuY3VycmVudCA9IFNmW1RmXSwgU2ZbVGZdID0gbnVsbCwgVGYtLSk7fWZ1bmN0aW9uIEcoYSwgYikge1RmKys7U2ZbVGZdID0gYS5jdXJyZW50O2EuY3VycmVudCA9IGI7fXZhciBWZiA9IHt9LEggPSBVZihWZiksV2YgPSBVZighMSksWGYgPSBWZjtmdW5jdGlvbiBZZihhLCBiKSB7dmFyIGMgPSBhLnR5cGUuY29udGV4dFR5cGVzO2lmICghYykgcmV0dXJuIFZmO3ZhciBkID0gYS5zdGF0ZU5vZGU7aWYgKGQgJiYgZC5fX3JlYWN0SW50ZXJuYWxNZW1vaXplZFVubWFza2VkQ2hpbGRDb250ZXh0ID09PSBiKSByZXR1cm4gZC5fX3JlYWN0SW50ZXJuYWxNZW1vaXplZE1hc2tlZENoaWxkQ29udGV4dDt2YXIgZSA9IHt9LGY7Zm9yIChmIGluIGMpIGVbZl0gPSBiW2ZdO2QgJiYgKGEgPSBhLnN0YXRlTm9kZSwgYS5fX3JlYWN0SW50ZXJuYWxNZW1vaXplZFVubWFza2VkQ2hpbGRDb250ZXh0ID0gYiwgYS5fX3JlYWN0SW50ZXJuYWxNZW1vaXplZE1hc2tlZENoaWxkQ29udGV4dCA9IGUpO3JldHVybiBlO30KICAgICAgICAgIGZ1bmN0aW9uIFpmKGEpIHthID0gYS5jaGlsZENvbnRleHRUeXBlcztyZXR1cm4gbnVsbCAhPT0gYSAmJiB2b2lkIDAgIT09IGE7fWZ1bmN0aW9uICRmKCkge0UoV2YpO0UoSCk7fWZ1bmN0aW9uIGFnKGEsIGIsIGMpIHtpZiAoSC5jdXJyZW50ICE9PSBWZikgdGhyb3cgRXJyb3IocCgxNjgpKTtHKEgsIGIpO0coV2YsIGMpO31mdW5jdGlvbiBiZyhhLCBiLCBjKSB7dmFyIGQgPSBhLnN0YXRlTm9kZTtiID0gYi5jaGlsZENvbnRleHRUeXBlcztpZiAoImZ1bmN0aW9uIiAhPT0gdHlwZW9mIGQuZ2V0Q2hpbGRDb250ZXh0KSByZXR1cm4gYztkID0gZC5nZXRDaGlsZENvbnRleHQoKTtmb3IgKHZhciBlIGluIGQpIGlmICghKGUgaW4gYikpIHRocm93IEVycm9yKHAoMTA4LCBSYShhKSB8fCAiVW5rbm93biIsIGUpKTtyZXR1cm4gQSh7fSwgYywgZCk7fQogICAgICAgICAgZnVuY3Rpb24gY2coYSkge2EgPSAoYSA9IGEuc3RhdGVOb2RlKSAmJiBhLl9fcmVhY3RJbnRlcm5hbE1lbW9pemVkTWVyZ2VkQ2hpbGRDb250ZXh0IHx8IFZmO1hmID0gSC5jdXJyZW50O0coSCwgYSk7RyhXZiwgV2YuY3VycmVudCk7cmV0dXJuICEwO31mdW5jdGlvbiBkZyhhLCBiLCBjKSB7dmFyIGQgPSBhLnN0YXRlTm9kZTtpZiAoIWQpIHRocm93IEVycm9yKHAoMTY5KSk7YyA/IChhID0gYmcoYSwgYiwgWGYpLCBkLl9fcmVhY3RJbnRlcm5hbE1lbW9pemVkTWVyZ2VkQ2hpbGRDb250ZXh0ID0gYSwgRShXZiksIEUoSCksIEcoSCwgYSkpIDogRShXZik7RyhXZiwgYyk7fXZhciBlZyA9IG51bGwsZmcgPSAhMSxnZyA9ICExO2Z1bmN0aW9uIGhnKGEpIHtudWxsID09PSBlZyA/IGVnID0gW2FdIDogZWcucHVzaChhKTt9ZnVuY3Rpb24gaWcoYSkge2ZnID0gITA7aGcoYSk7fQogICAgICAgICAgZnVuY3Rpb24gamcoKSB7aWYgKCFnZyAmJiBudWxsICE9PSBlZykge2dnID0gITA7dmFyIGEgPSAwLGIgPSBDO3RyeSB7dmFyIGMgPSBlZztmb3IgKEMgPSAxOyBhIDwgYy5sZW5ndGg7IGErKykge3ZhciBkID0gY1thXTtkbyBkID0gZCghMCk7IHdoaWxlIChudWxsICE9PSBkKTt9ZWcgPSBudWxsO2ZnID0gITE7fSBjYXRjaCAoZSkge3Rocm93IG51bGwgIT09IGVnICYmIChlZyA9IGVnLnNsaWNlKGEgKyAxKSksIGFjKGZjLCBqZyksIGU7fSBmaW5hbGx5IHtDID0gYiwgZ2cgPSAhMTt9fXJldHVybiBudWxsO312YXIga2cgPSBbXSxsZyA9IDAsbWcgPSBudWxsLG5nID0gMCxvZyA9IFtdLHBnID0gMCxxZyA9IG51bGwscmcgPSAxLHNnID0gIiI7ZnVuY3Rpb24gdGcoYSwgYikge2tnW2xnKytdID0gbmc7a2dbbGcrK10gPSBtZzttZyA9IGE7bmcgPSBiO30KICAgICAgICAgIGZ1bmN0aW9uIHVnKGEsIGIsIGMpIHtvZ1twZysrXSA9IHJnO29nW3BnKytdID0gc2c7b2dbcGcrK10gPSBxZztxZyA9IGE7dmFyIGQgPSByZzthID0gc2c7dmFyIGUgPSAzMiAtIG9jKGQpIC0gMTtkICY9IH4oMSA8PCBlKTtjICs9IDE7dmFyIGYgPSAzMiAtIG9jKGIpICsgZTtpZiAoMzAgPCBmKSB7dmFyIGcgPSBlIC0gZSAlIDU7ZiA9IChkICYgKDEgPDwgZykgLSAxKS50b1N0cmluZygzMik7ZCA+Pj0gZztlIC09IGc7cmcgPSAxIDw8IDMyIC0gb2MoYikgKyBlIHwgYyA8PCBlIHwgZDtzZyA9IGYgKyBhO30gZWxzZSByZyA9IDEgPDwgZiB8IGMgPDwgZSB8IGQsIHNnID0gYTt9ZnVuY3Rpb24gdmcoYSkge251bGwgIT09IGEucmV0dXJuICYmICh0ZyhhLCAxKSwgdWcoYSwgMSwgMCkpO31mdW5jdGlvbiB3ZyhhKSB7Zm9yICg7IGEgPT09IG1nOykgbWcgPSBrZ1stLWxnXSwga2dbbGddID0gbnVsbCwgbmcgPSBrZ1stLWxnXSwga2dbbGddID0gbnVsbDtmb3IgKDsgYSA9PT0gcWc7KSBxZyA9IG9nWy0tcGddLCBvZ1twZ10gPSBudWxsLCBzZyA9IG9nWy0tcGddLCBvZ1twZ10gPSBudWxsLCByZyA9IG9nWy0tcGddLCBvZ1twZ10gPSBudWxsO312YXIgeGcgPSBudWxsLHlnID0gbnVsbCxJID0gITEsemcgPSBudWxsOwogICAgICAgICAgZnVuY3Rpb24gQWcoYSwgYikge3ZhciBjID0gQmcoNSwgbnVsbCwgbnVsbCwgMCk7Yy5lbGVtZW50VHlwZSA9ICJERUxFVEVEIjtjLnN0YXRlTm9kZSA9IGI7Yy5yZXR1cm4gPSBhO2IgPSBhLmRlbGV0aW9ucztudWxsID09PSBiID8gKGEuZGVsZXRpb25zID0gW2NdLCBhLmZsYWdzIHw9IDE2KSA6IGIucHVzaChjKTt9CiAgICAgICAgICBmdW5jdGlvbiBDZyhhLCBiKSB7c3dpdGNoIChhLnRhZykge2Nhc2UgNTp2YXIgYyA9IGEudHlwZTtiID0gMSAhPT0gYi5ub2RlVHlwZSB8fCBjLnRvTG93ZXJDYXNlKCkgIT09IGIubm9kZU5hbWUudG9Mb3dlckNhc2UoKSA/IG51bGwgOiBiO3JldHVybiBudWxsICE9PSBiID8gKGEuc3RhdGVOb2RlID0gYiwgeGcgPSBhLCB5ZyA9IExmKGIuZmlyc3RDaGlsZCksICEwKSA6ICExO2Nhc2UgNjpyZXR1cm4gYiA9ICIiID09PSBhLnBlbmRpbmdQcm9wcyB8fCAzICE9PSBiLm5vZGVUeXBlID8gbnVsbCA6IGIsIG51bGwgIT09IGIgPyAoYS5zdGF0ZU5vZGUgPSBiLCB4ZyA9IGEsIHlnID0gbnVsbCwgITApIDogITE7Y2FzZSAxMzpyZXR1cm4gYiA9IDggIT09IGIubm9kZVR5cGUgPyBudWxsIDogYiwgbnVsbCAhPT0gYiA/IChjID0gbnVsbCAhPT0gcWcgPyB7IGlkOiByZywgb3ZlcmZsb3c6IHNnIH0gOiBudWxsLCBhLm1lbW9pemVkU3RhdGUgPSB7IGRlaHlkcmF0ZWQ6IGIsIHRyZWVDb250ZXh0OiBjLCByZXRyeUxhbmU6IDEwNzM3NDE4MjQgfSwgYyA9IEJnKDE4LCBudWxsLCBudWxsLCAwKSwgYy5zdGF0ZU5vZGUgPSBiLCBjLnJldHVybiA9IGEsIGEuY2hpbGQgPSBjLCB4ZyA9IGEsIHlnID0KICAgICAgICAgICAgICAgIG51bGwsICEwKSA6ICExO2RlZmF1bHQ6cmV0dXJuICExO319ZnVuY3Rpb24gRGcoYSkge3JldHVybiAwICE9PSAoYS5tb2RlICYgMSkgJiYgMCA9PT0gKGEuZmxhZ3MgJiAxMjgpO31mdW5jdGlvbiBFZyhhKSB7aWYgKEkpIHt2YXIgYiA9IHlnO2lmIChiKSB7dmFyIGMgPSBiO2lmICghQ2coYSwgYikpIHtpZiAoRGcoYSkpIHRocm93IEVycm9yKHAoNDE4KSk7YiA9IExmKGMubmV4dFNpYmxpbmcpO3ZhciBkID0geGc7YiAmJiBDZyhhLCBiKSA/IEFnKGQsIGMpIDogKGEuZmxhZ3MgPSBhLmZsYWdzICYgLTQwOTcgfCAyLCBJID0gITEsIHhnID0gYSk7fX0gZWxzZSB7aWYgKERnKGEpKSB0aHJvdyBFcnJvcihwKDQxOCkpO2EuZmxhZ3MgPSBhLmZsYWdzICYgLTQwOTcgfCAyO0kgPSAhMTt4ZyA9IGE7fX19ZnVuY3Rpb24gRmcoYSkge2ZvciAoYSA9IGEucmV0dXJuOyBudWxsICE9PSBhICYmIDUgIT09IGEudGFnICYmIDMgIT09IGEudGFnICYmIDEzICE9PSBhLnRhZzspIGEgPSBhLnJldHVybjt4ZyA9IGE7fQogICAgICAgICAgZnVuY3Rpb24gR2coYSkge2lmIChhICE9PSB4ZykgcmV0dXJuICExO2lmICghSSkgcmV0dXJuIEZnKGEpLCBJID0gITAsICExO3ZhciBiOyhiID0gMyAhPT0gYS50YWcpICYmICEoYiA9IDUgIT09IGEudGFnKSAmJiAoYiA9IGEudHlwZSwgYiA9ICJoZWFkIiAhPT0gYiAmJiAiYm9keSIgIT09IGIgJiYgIUVmKGEudHlwZSwgYS5tZW1vaXplZFByb3BzKSk7aWYgKGIgJiYgKGIgPSB5ZykpIHtpZiAoRGcoYSkpIHRocm93IEhnKCksIEVycm9yKHAoNDE4KSk7Zm9yICg7IGI7KSBBZyhhLCBiKSwgYiA9IExmKGIubmV4dFNpYmxpbmcpO31GZyhhKTtpZiAoMTMgPT09IGEudGFnKSB7YSA9IGEubWVtb2l6ZWRTdGF0ZTthID0gbnVsbCAhPT0gYSA/IGEuZGVoeWRyYXRlZCA6IG51bGw7aWYgKCFhKSB0aHJvdyBFcnJvcihwKDMxNykpO2E6IHthID0gYS5uZXh0U2libGluZztmb3IgKGIgPSAwOyBhOykge2lmICg4ID09PSBhLm5vZGVUeXBlKSB7dmFyIGMgPSBhLmRhdGE7aWYgKCIvJCIgPT09IGMpIHtpZiAoMCA9PT0gYikge3lnID0gTGYoYS5uZXh0U2libGluZyk7YnJlYWsgYTt9Yi0tO30gZWxzZSAiJCIgIT09IGMgJiYgIiQhIiAhPT0gYyAmJiAiJD8iICE9PSBjIHx8IGIrKzt9YSA9IGEubmV4dFNpYmxpbmc7fXlnID0KICAgICAgICAgICAgICAgIG51bGw7fX0gZWxzZSB5ZyA9IHhnID8gTGYoYS5zdGF0ZU5vZGUubmV4dFNpYmxpbmcpIDogbnVsbDtyZXR1cm4gITA7fWZ1bmN0aW9uIEhnKCkge2ZvciAodmFyIGEgPSB5ZzsgYTspIGEgPSBMZihhLm5leHRTaWJsaW5nKTt9ZnVuY3Rpb24gSWcoKSB7eWcgPSB4ZyA9IG51bGw7SSA9ICExO31mdW5jdGlvbiBKZyhhKSB7bnVsbCA9PT0gemcgPyB6ZyA9IFthXSA6IHpnLnB1c2goYSk7fXZhciBLZyA9IHVhLlJlYWN0Q3VycmVudEJhdGNoQ29uZmlnO2Z1bmN0aW9uIExnKGEsIGIpIHtpZiAoYSAmJiBhLmRlZmF1bHRQcm9wcykge2IgPSBBKHt9LCBiKTthID0gYS5kZWZhdWx0UHJvcHM7Zm9yICh2YXIgYyBpbiBhKSB2b2lkIDAgPT09IGJbY10gJiYgKGJbY10gPSBhW2NdKTtyZXR1cm4gYjt9cmV0dXJuIGI7fXZhciBNZyA9IFVmKG51bGwpLE5nID0gbnVsbCxPZyA9IG51bGwsUGcgPSBudWxsO2Z1bmN0aW9uIFFnKCkge1BnID0gT2cgPSBOZyA9IG51bGw7fWZ1bmN0aW9uIFJnKGEpIHt2YXIgYiA9IE1nLmN1cnJlbnQ7RShNZyk7YS5fY3VycmVudFZhbHVlID0gYjt9CiAgICAgICAgICBmdW5jdGlvbiBTZyhhLCBiLCBjKSB7Zm9yICg7IG51bGwgIT09IGE7KSB7dmFyIGQgPSBhLmFsdGVybmF0ZTsoYS5jaGlsZExhbmVzICYgYikgIT09IGIgPyAoYS5jaGlsZExhbmVzIHw9IGIsIG51bGwgIT09IGQgJiYgKGQuY2hpbGRMYW5lcyB8PSBiKSkgOiBudWxsICE9PSBkICYmIChkLmNoaWxkTGFuZXMgJiBiKSAhPT0gYiAmJiAoZC5jaGlsZExhbmVzIHw9IGIpO2lmIChhID09PSBjKSBicmVhazthID0gYS5yZXR1cm47fX1mdW5jdGlvbiBUZyhhLCBiKSB7TmcgPSBhO1BnID0gT2cgPSBudWxsO2EgPSBhLmRlcGVuZGVuY2llcztudWxsICE9PSBhICYmIG51bGwgIT09IGEuZmlyc3RDb250ZXh0ICYmICgwICE9PSAoYS5sYW5lcyAmIGIpICYmIChVZyA9ICEwKSwgYS5maXJzdENvbnRleHQgPSBudWxsKTt9CiAgICAgICAgICBmdW5jdGlvbiBWZyhhKSB7dmFyIGIgPSBhLl9jdXJyZW50VmFsdWU7aWYgKFBnICE9PSBhKSBpZiAoYSA9IHsgY29udGV4dDogYSwgbWVtb2l6ZWRWYWx1ZTogYiwgbmV4dDogbnVsbCB9LCBudWxsID09PSBPZykge2lmIChudWxsID09PSBOZykgdGhyb3cgRXJyb3IocCgzMDgpKTtPZyA9IGE7TmcuZGVwZW5kZW5jaWVzID0geyBsYW5lczogMCwgZmlyc3RDb250ZXh0OiBhIH07fSBlbHNlIE9nID0gT2cubmV4dCA9IGE7cmV0dXJuIGI7fXZhciBXZyA9IG51bGw7ZnVuY3Rpb24gWGcoYSkge251bGwgPT09IFdnID8gV2cgPSBbYV0gOiBXZy5wdXNoKGEpO31mdW5jdGlvbiBZZyhhLCBiLCBjLCBkKSB7dmFyIGUgPSBiLmludGVybGVhdmVkO251bGwgPT09IGUgPyAoYy5uZXh0ID0gYywgWGcoYikpIDogKGMubmV4dCA9IGUubmV4dCwgZS5uZXh0ID0gYyk7Yi5pbnRlcmxlYXZlZCA9IGM7cmV0dXJuIFpnKGEsIGQpO30KICAgICAgICAgIGZ1bmN0aW9uIFpnKGEsIGIpIHthLmxhbmVzIHw9IGI7dmFyIGMgPSBhLmFsdGVybmF0ZTtudWxsICE9PSBjICYmIChjLmxhbmVzIHw9IGIpO2MgPSBhO2ZvciAoYSA9IGEucmV0dXJuOyBudWxsICE9PSBhOykgYS5jaGlsZExhbmVzIHw9IGIsIGMgPSBhLmFsdGVybmF0ZSwgbnVsbCAhPT0gYyAmJiAoYy5jaGlsZExhbmVzIHw9IGIpLCBjID0gYSwgYSA9IGEucmV0dXJuO3JldHVybiAzID09PSBjLnRhZyA/IGMuc3RhdGVOb2RlIDogbnVsbDt9dmFyICRnID0gITE7ZnVuY3Rpb24gYWgoYSkge2EudXBkYXRlUXVldWUgPSB7IGJhc2VTdGF0ZTogYS5tZW1vaXplZFN0YXRlLCBmaXJzdEJhc2VVcGRhdGU6IG51bGwsIGxhc3RCYXNlVXBkYXRlOiBudWxsLCBzaGFyZWQ6IHsgcGVuZGluZzogbnVsbCwgaW50ZXJsZWF2ZWQ6IG51bGwsIGxhbmVzOiAwIH0sIGVmZmVjdHM6IG51bGwgfTt9CiAgICAgICAgICBmdW5jdGlvbiBiaChhLCBiKSB7YSA9IGEudXBkYXRlUXVldWU7Yi51cGRhdGVRdWV1ZSA9PT0gYSAmJiAoYi51cGRhdGVRdWV1ZSA9IHsgYmFzZVN0YXRlOiBhLmJhc2VTdGF0ZSwgZmlyc3RCYXNlVXBkYXRlOiBhLmZpcnN0QmFzZVVwZGF0ZSwgbGFzdEJhc2VVcGRhdGU6IGEubGFzdEJhc2VVcGRhdGUsIHNoYXJlZDogYS5zaGFyZWQsIGVmZmVjdHM6IGEuZWZmZWN0cyB9KTt9ZnVuY3Rpb24gY2goYSwgYikge3JldHVybiB7IGV2ZW50VGltZTogYSwgbGFuZTogYiwgdGFnOiAwLCBwYXlsb2FkOiBudWxsLCBjYWxsYmFjazogbnVsbCwgbmV4dDogbnVsbCB9O30KICAgICAgICAgIGZ1bmN0aW9uIGRoKGEsIGIsIGMpIHt2YXIgZCA9IGEudXBkYXRlUXVldWU7aWYgKG51bGwgPT09IGQpIHJldHVybiBudWxsO2QgPSBkLnNoYXJlZDtpZiAoMCAhPT0gKEsgJiAyKSkge3ZhciBlID0gZC5wZW5kaW5nO251bGwgPT09IGUgPyBiLm5leHQgPSBiIDogKGIubmV4dCA9IGUubmV4dCwgZS5uZXh0ID0gYik7ZC5wZW5kaW5nID0gYjtyZXR1cm4gWmcoYSwgYyk7fWUgPSBkLmludGVybGVhdmVkO251bGwgPT09IGUgPyAoYi5uZXh0ID0gYiwgWGcoZCkpIDogKGIubmV4dCA9IGUubmV4dCwgZS5uZXh0ID0gYik7ZC5pbnRlcmxlYXZlZCA9IGI7cmV0dXJuIFpnKGEsIGMpO31mdW5jdGlvbiBlaChhLCBiLCBjKSB7YiA9IGIudXBkYXRlUXVldWU7aWYgKG51bGwgIT09IGIgJiYgKGIgPSBiLnNoYXJlZCwgMCAhPT0gKGMgJiA0MTk0MjQwKSkpIHt2YXIgZCA9IGIubGFuZXM7ZCAmPSBhLnBlbmRpbmdMYW5lcztjIHw9IGQ7Yi5sYW5lcyA9IGM7Q2MoYSwgYyk7fX0KICAgICAgICAgIGZ1bmN0aW9uIGZoKGEsIGIpIHt2YXIgYyA9IGEudXBkYXRlUXVldWUsZCA9IGEuYWx0ZXJuYXRlO2lmIChudWxsICE9PSBkICYmIChkID0gZC51cGRhdGVRdWV1ZSwgYyA9PT0gZCkpIHt2YXIgZSA9IG51bGwsZiA9IG51bGw7YyA9IGMuZmlyc3RCYXNlVXBkYXRlO2lmIChudWxsICE9PSBjKSB7ZG8ge3ZhciBnID0geyBldmVudFRpbWU6IGMuZXZlbnRUaW1lLCBsYW5lOiBjLmxhbmUsIHRhZzogYy50YWcsIHBheWxvYWQ6IGMucGF5bG9hZCwgY2FsbGJhY2s6IGMuY2FsbGJhY2ssIG5leHQ6IG51bGwgfTtudWxsID09PSBmID8gZSA9IGYgPSBnIDogZiA9IGYubmV4dCA9IGc7YyA9IGMubmV4dDt9IHdoaWxlIChudWxsICE9PSBjKTtudWxsID09PSBmID8gZSA9IGYgPSBiIDogZiA9IGYubmV4dCA9IGI7fSBlbHNlIGUgPSBmID0gYjtjID0geyBiYXNlU3RhdGU6IGQuYmFzZVN0YXRlLCBmaXJzdEJhc2VVcGRhdGU6IGUsIGxhc3RCYXNlVXBkYXRlOiBmLCBzaGFyZWQ6IGQuc2hhcmVkLCBlZmZlY3RzOiBkLmVmZmVjdHMgfTthLnVwZGF0ZVF1ZXVlID0gYztyZXR1cm47fWEgPSBjLmxhc3RCYXNlVXBkYXRlO251bGwgPT09IGEgPyBjLmZpcnN0QmFzZVVwZGF0ZSA9IGIgOiBhLm5leHQgPQogICAgICAgICAgICBiO2MubGFzdEJhc2VVcGRhdGUgPSBiO30KICAgICAgICAgIGZ1bmN0aW9uIGdoKGEsIGIsIGMsIGQpIHt2YXIgZSA9IGEudXBkYXRlUXVldWU7JGcgPSAhMTt2YXIgZiA9IGUuZmlyc3RCYXNlVXBkYXRlLGcgPSBlLmxhc3RCYXNlVXBkYXRlLGggPSBlLnNoYXJlZC5wZW5kaW5nO2lmIChudWxsICE9PSBoKSB7ZS5zaGFyZWQucGVuZGluZyA9IG51bGw7dmFyIGsgPSBoLGwgPSBrLm5leHQ7ay5uZXh0ID0gbnVsbDtudWxsID09PSBnID8gZiA9IGwgOiBnLm5leHQgPSBsO2cgPSBrO3ZhciBtID0gYS5hbHRlcm5hdGU7bnVsbCAhPT0gbSAmJiAobSA9IG0udXBkYXRlUXVldWUsIGggPSBtLmxhc3RCYXNlVXBkYXRlLCBoICE9PSBnICYmIChudWxsID09PSBoID8gbS5maXJzdEJhc2VVcGRhdGUgPSBsIDogaC5uZXh0ID0gbCwgbS5sYXN0QmFzZVVwZGF0ZSA9IGspKTt9aWYgKG51bGwgIT09IGYpIHt2YXIgcSA9IGUuYmFzZVN0YXRlO2cgPSAwO20gPSBsID0gayA9IG51bGw7aCA9IGY7ZG8ge3ZhciByID0gaC5sYW5lLHkgPSBoLmV2ZW50VGltZTtpZiAoKGQgJiByKSA9PT0gcikge251bGwgIT09IG0gJiYgKG0gPSBtLm5leHQgPSB7IGV2ZW50VGltZTogeSwgbGFuZTogMCwgdGFnOiBoLnRhZywgcGF5bG9hZDogaC5wYXlsb2FkLCBjYWxsYmFjazogaC5jYWxsYmFjaywKICAgICAgICAgICAgICAgICAgICBuZXh0OiBudWxsIH0pO2E6IHt2YXIgbiA9IGEsdCA9IGg7ciA9IGI7eSA9IGM7c3dpdGNoICh0LnRhZykge2Nhc2UgMTpuID0gdC5wYXlsb2FkO2lmICgiZnVuY3Rpb24iID09PSB0eXBlb2Ygbikge3EgPSBuLmNhbGwoeSwgcSwgcik7YnJlYWsgYTt9cSA9IG47YnJlYWsgYTtjYXNlIDM6bi5mbGFncyA9IG4uZmxhZ3MgJiAtNjU1MzcgfCAxMjg7Y2FzZSAwOm4gPSB0LnBheWxvYWQ7ciA9ICJmdW5jdGlvbiIgPT09IHR5cGVvZiBuID8gbi5jYWxsKHksIHEsIHIpIDogbjtpZiAobnVsbCA9PT0gciB8fCB2b2lkIDAgPT09IHIpIGJyZWFrIGE7cSA9IEEoe30sIHEsIHIpO2JyZWFrIGE7Y2FzZSAyOiRnID0gITA7fX1udWxsICE9PSBoLmNhbGxiYWNrICYmIDAgIT09IGgubGFuZSAmJiAoYS5mbGFncyB8PSA2NCwgciA9IGUuZWZmZWN0cywgbnVsbCA9PT0gciA/IGUuZWZmZWN0cyA9IFtoXSA6IHIucHVzaChoKSk7fSBlbHNlIHkgPSB7IGV2ZW50VGltZTogeSwgbGFuZTogciwgdGFnOiBoLnRhZywgcGF5bG9hZDogaC5wYXlsb2FkLCBjYWxsYmFjazogaC5jYWxsYmFjaywgbmV4dDogbnVsbCB9LCBudWxsID09PSBtID8gKGwgPSBtID0geSwgayA9IHEpIDogbSA9IG0ubmV4dCA9IHksIGcgfD0gcjsKICAgICAgICAgICAgICAgIGggPSBoLm5leHQ7aWYgKG51bGwgPT09IGgpIGlmIChoID0gZS5zaGFyZWQucGVuZGluZywgbnVsbCA9PT0gaCkgYnJlYWs7ZWxzZSByID0gaCwgaCA9IHIubmV4dCwgci5uZXh0ID0gbnVsbCwgZS5sYXN0QmFzZVVwZGF0ZSA9IHIsIGUuc2hhcmVkLnBlbmRpbmcgPSBudWxsO30gd2hpbGUgKDEpO251bGwgPT09IG0gJiYgKGsgPSBxKTtlLmJhc2VTdGF0ZSA9IGs7ZS5maXJzdEJhc2VVcGRhdGUgPSBsO2UubGFzdEJhc2VVcGRhdGUgPSBtO2IgPSBlLnNoYXJlZC5pbnRlcmxlYXZlZDtpZiAobnVsbCAhPT0gYikge2UgPSBiO2RvIGcgfD0gZS5sYW5lLCBlID0gZS5uZXh0OyB3aGlsZSAoZSAhPT0gYik7fSBlbHNlIG51bGwgPT09IGYgJiYgKGUuc2hhcmVkLmxhbmVzID0gMCk7aGggfD0gZzthLmxhbmVzID0gZzthLm1lbW9pemVkU3RhdGUgPSBxO319CiAgICAgICAgICBmdW5jdGlvbiBpaChhLCBiLCBjKSB7YSA9IGIuZWZmZWN0cztiLmVmZmVjdHMgPSBudWxsO2lmIChudWxsICE9PSBhKSBmb3IgKGIgPSAwOyBiIDwgYS5sZW5ndGg7IGIrKykge3ZhciBkID0gYVtiXSxlID0gZC5jYWxsYmFjaztpZiAobnVsbCAhPT0gZSkge2QuY2FsbGJhY2sgPSBudWxsO2QgPSBjO2lmICgiZnVuY3Rpb24iICE9PSB0eXBlb2YgZSkgdGhyb3cgRXJyb3IocCgxOTEsIGUpKTtlLmNhbGwoZCk7fX19dmFyIGpoID0gbmV3IGFhLkNvbXBvbmVudCgpLnJlZnM7ZnVuY3Rpb24ga2goYSwgYiwgYywgZCkge2IgPSBhLm1lbW9pemVkU3RhdGU7YyA9IGMoZCwgYik7YyA9IG51bGwgPT09IGMgfHwgdm9pZCAwID09PSBjID8gYiA6IEEoe30sIGIsIGMpO2EubWVtb2l6ZWRTdGF0ZSA9IGM7MCA9PT0gYS5sYW5lcyAmJiAoYS51cGRhdGVRdWV1ZS5iYXNlU3RhdGUgPSBjKTt9CiAgICAgICAgICB2YXIgbmggPSB7IGlzTW91bnRlZDogZnVuY3Rpb24gaXNNb3VudGVkKGEpIHtyZXR1cm4gKGEgPSBhLl9yZWFjdEludGVybmFscykgPyBWYihhKSA9PT0gYSA6ICExO30sIGVucXVldWVTZXRTdGF0ZTogZnVuY3Rpb24gZW5xdWV1ZVNldFN0YXRlKGEsIGIsIGMpIHthID0gYS5fcmVhY3RJbnRlcm5hbHM7dmFyIGQgPSBMKCksZSA9IGxoKGEpLGYgPSBjaChkLCBlKTtmLnBheWxvYWQgPSBiO3ZvaWQgMCAhPT0gYyAmJiBudWxsICE9PSBjICYmIChmLmNhbGxiYWNrID0gYyk7YiA9IGRoKGEsIGYsIGUpO251bGwgIT09IGIgJiYgKG1oKGIsIGEsIGUsIGQpLCBlaChiLCBhLCBlKSk7fSwgZW5xdWV1ZVJlcGxhY2VTdGF0ZTogZnVuY3Rpb24gZW5xdWV1ZVJlcGxhY2VTdGF0ZShhLCBiLCBjKSB7YSA9IGEuX3JlYWN0SW50ZXJuYWxzO3ZhciBkID0gTCgpLGUgPSBsaChhKSxmID0gY2goZCwgZSk7Zi50YWcgPSAxO2YucGF5bG9hZCA9IGI7dm9pZCAwICE9PSBjICYmIG51bGwgIT09IGMgJiYgKGYuY2FsbGJhY2sgPSBjKTtiID0gZGgoYSwgZiwgZSk7bnVsbCAhPT0gYiAmJiAobWgoYiwgYSwgZSwgZCksIGVoKGIsIGEsIGUpKTt9LCBlbnF1ZXVlRm9yY2VVcGRhdGU6IGZ1bmN0aW9uIGVucXVldWVGb3JjZVVwZGF0ZShhLCBiKSB7YSA9IGEuX3JlYWN0SW50ZXJuYWxzO3ZhciBjID0gTCgpLGQgPQogICAgICAgICAgICAgICAgbGgoYSksZSA9IGNoKGMsIGQpO2UudGFnID0gMjt2b2lkIDAgIT09IGIgJiYgbnVsbCAhPT0gYiAmJiAoZS5jYWxsYmFjayA9IGIpO2IgPSBkaChhLCBlLCBkKTtudWxsICE9PSBiICYmIChtaChiLCBhLCBkLCBjKSwgZWgoYiwgYSwgZCkpO30gfTtmdW5jdGlvbiBvaChhLCBiLCBjLCBkLCBlLCBmLCBnKSB7YSA9IGEuc3RhdGVOb2RlO3JldHVybiAiZnVuY3Rpb24iID09PSB0eXBlb2YgYS5zaG91bGRDb21wb25lbnRVcGRhdGUgPyBhLnNob3VsZENvbXBvbmVudFVwZGF0ZShkLCBmLCBnKSA6IGIucHJvdG90eXBlICYmIGIucHJvdG90eXBlLmlzUHVyZVJlYWN0Q29tcG9uZW50ID8gIUllKGMsIGQpIHx8ICFJZShlLCBmKSA6ICEwO30KICAgICAgICAgIGZ1bmN0aW9uIHBoKGEsIGIsIGMpIHt2YXIgZCA9ICExLGUgPSBWZjt2YXIgZiA9IGIuY29udGV4dFR5cGU7Im9iamVjdCIgPT09IHR5cGVvZiBmICYmIG51bGwgIT09IGYgPyBmID0gVmcoZikgOiAoZSA9IFpmKGIpID8gWGYgOiBILmN1cnJlbnQsIGQgPSBiLmNvbnRleHRUeXBlcywgZiA9IChkID0gbnVsbCAhPT0gZCAmJiB2b2lkIDAgIT09IGQpID8gWWYoYSwgZSkgOiBWZik7YiA9IG5ldyBiKGMsIGYpO2EubWVtb2l6ZWRTdGF0ZSA9IG51bGwgIT09IGIuc3RhdGUgJiYgdm9pZCAwICE9PSBiLnN0YXRlID8gYi5zdGF0ZSA6IG51bGw7Yi51cGRhdGVyID0gbmg7YS5zdGF0ZU5vZGUgPSBiO2IuX3JlYWN0SW50ZXJuYWxzID0gYTtkICYmIChhID0gYS5zdGF0ZU5vZGUsIGEuX19yZWFjdEludGVybmFsTWVtb2l6ZWRVbm1hc2tlZENoaWxkQ29udGV4dCA9IGUsIGEuX19yZWFjdEludGVybmFsTWVtb2l6ZWRNYXNrZWRDaGlsZENvbnRleHQgPSBmKTtyZXR1cm4gYjt9CiAgICAgICAgICBmdW5jdGlvbiBxaChhLCBiLCBjLCBkKSB7YSA9IGIuc3RhdGU7ImZ1bmN0aW9uIiA9PT0gdHlwZW9mIGIuY29tcG9uZW50V2lsbFJlY2VpdmVQcm9wcyAmJiBiLmNvbXBvbmVudFdpbGxSZWNlaXZlUHJvcHMoYywgZCk7ImZ1bmN0aW9uIiA9PT0gdHlwZW9mIGIuVU5TQUZFX2NvbXBvbmVudFdpbGxSZWNlaXZlUHJvcHMgJiYgYi5VTlNBRkVfY29tcG9uZW50V2lsbFJlY2VpdmVQcm9wcyhjLCBkKTtiLnN0YXRlICE9PSBhICYmIG5oLmVucXVldWVSZXBsYWNlU3RhdGUoYiwgYi5zdGF0ZSwgbnVsbCk7fQogICAgICAgICAgZnVuY3Rpb24gcmgoYSwgYiwgYywgZCkge3ZhciBlID0gYS5zdGF0ZU5vZGU7ZS5wcm9wcyA9IGM7ZS5zdGF0ZSA9IGEubWVtb2l6ZWRTdGF0ZTtlLnJlZnMgPSBqaDthaChhKTt2YXIgZiA9IGIuY29udGV4dFR5cGU7Im9iamVjdCIgPT09IHR5cGVvZiBmICYmIG51bGwgIT09IGYgPyBlLmNvbnRleHQgPSBWZyhmKSA6IChmID0gWmYoYikgPyBYZiA6IEguY3VycmVudCwgZS5jb250ZXh0ID0gWWYoYSwgZikpO2Uuc3RhdGUgPSBhLm1lbW9pemVkU3RhdGU7ZiA9IGIuZ2V0RGVyaXZlZFN0YXRlRnJvbVByb3BzOyJmdW5jdGlvbiIgPT09IHR5cGVvZiBmICYmIChraChhLCBiLCBmLCBjKSwgZS5zdGF0ZSA9IGEubWVtb2l6ZWRTdGF0ZSk7ImZ1bmN0aW9uIiA9PT0gdHlwZW9mIGIuZ2V0RGVyaXZlZFN0YXRlRnJvbVByb3BzIHx8ICJmdW5jdGlvbiIgPT09IHR5cGVvZiBlLmdldFNuYXBzaG90QmVmb3JlVXBkYXRlIHx8ICJmdW5jdGlvbiIgIT09IHR5cGVvZiBlLlVOU0FGRV9jb21wb25lbnRXaWxsTW91bnQgJiYgImZ1bmN0aW9uIiAhPT0gdHlwZW9mIGUuY29tcG9uZW50V2lsbE1vdW50IHx8IChiID0gZS5zdGF0ZSwKICAgICAgICAgICAgImZ1bmN0aW9uIiA9PT0gdHlwZW9mIGUuY29tcG9uZW50V2lsbE1vdW50ICYmIGUuY29tcG9uZW50V2lsbE1vdW50KCksICJmdW5jdGlvbiIgPT09IHR5cGVvZiBlLlVOU0FGRV9jb21wb25lbnRXaWxsTW91bnQgJiYgZS5VTlNBRkVfY29tcG9uZW50V2lsbE1vdW50KCksIGIgIT09IGUuc3RhdGUgJiYgbmguZW5xdWV1ZVJlcGxhY2VTdGF0ZShlLCBlLnN0YXRlLCBudWxsKSwgZ2goYSwgYywgZSwgZCksIGUuc3RhdGUgPSBhLm1lbW9pemVkU3RhdGUpOyJmdW5jdGlvbiIgPT09IHR5cGVvZiBlLmNvbXBvbmVudERpZE1vdW50ICYmIChhLmZsYWdzIHw9IDQxOTQzMDgpO30KICAgICAgICAgIGZ1bmN0aW9uIHNoKGEsIGIsIGMpIHthID0gYy5yZWY7aWYgKG51bGwgIT09IGEgJiYgImZ1bmN0aW9uIiAhPT0gdHlwZW9mIGEgJiYgIm9iamVjdCIgIT09IHR5cGVvZiBhKSB7aWYgKGMuX293bmVyKSB7YyA9IGMuX293bmVyO2lmIChjKSB7aWYgKDEgIT09IGMudGFnKSB0aHJvdyBFcnJvcihwKDMwOSkpO3ZhciBkID0gYy5zdGF0ZU5vZGU7fWlmICghZCkgdGhyb3cgRXJyb3IocCgxNDcsIGEpKTt2YXIgZSA9IGQsZiA9ICIiICsgYTtpZiAobnVsbCAhPT0gYiAmJiBudWxsICE9PSBiLnJlZiAmJiAiZnVuY3Rpb24iID09PSB0eXBlb2YgYi5yZWYgJiYgYi5yZWYuX3N0cmluZ1JlZiA9PT0gZikgcmV0dXJuIGIucmVmO2IgPSBmdW5jdGlvbiBiKGEpIHt2YXIgYiA9IGUucmVmcztiID09PSBqaCAmJiAoYiA9IGUucmVmcyA9IHt9KTtudWxsID09PSBhID8gZGVsZXRlIGJbZl0gOiBiW2ZdID0gYTt9O2IuX3N0cmluZ1JlZiA9IGY7cmV0dXJuIGI7fWlmICgic3RyaW5nIiAhPT0gdHlwZW9mIGEpIHRocm93IEVycm9yKHAoMjg0KSk7aWYgKCFjLl9vd25lcikgdGhyb3cgRXJyb3IocCgyOTAsIGEpKTt9cmV0dXJuIGE7fQogICAgICAgICAgZnVuY3Rpb24gdGgoYSwgYikge2EgPSBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwoYik7dGhyb3cgRXJyb3IocCgzMSwgIltvYmplY3QgT2JqZWN0XSIgPT09IGEgPyAib2JqZWN0IHdpdGgga2V5cyB7IiArIE9iamVjdC5rZXlzKGIpLmpvaW4oIiwgIikgKyAifSIgOiBhKSk7fWZ1bmN0aW9uIHVoKGEpIHt2YXIgYiA9IGEuX2luaXQ7cmV0dXJuIGIoYS5fcGF5bG9hZCk7fQogICAgICAgICAgZnVuY3Rpb24gdmgoYSkge2Z1bmN0aW9uIGIoYiwgYykge2lmIChhKSB7dmFyIGQgPSBiLmRlbGV0aW9ucztudWxsID09PSBkID8gKGIuZGVsZXRpb25zID0gW2NdLCBiLmZsYWdzIHw9IDE2KSA6IGQucHVzaChjKTt9fWZ1bmN0aW9uIGMoYywgZCkge2lmICghYSkgcmV0dXJuIG51bGw7Zm9yICg7IG51bGwgIT09IGQ7KSBiKGMsIGQpLCBkID0gZC5zaWJsaW5nO3JldHVybiBudWxsO31mdW5jdGlvbiBkKGEsIGIpIHtmb3IgKGEgPSBuZXcgTWFwKCk7IG51bGwgIT09IGI7KSBudWxsICE9PSBiLmtleSA/IGEuc2V0KGIua2V5LCBiKSA6IGEuc2V0KGIuaW5kZXgsIGIpLCBiID0gYi5zaWJsaW5nO3JldHVybiBhO31mdW5jdGlvbiBlKGEsIGIpIHthID0gd2goYSwgYik7YS5pbmRleCA9IDA7YS5zaWJsaW5nID0gbnVsbDtyZXR1cm4gYTt9ZnVuY3Rpb24gZihiLCBjLCBkKSB7Yi5pbmRleCA9IGQ7aWYgKCFhKSByZXR1cm4gYi5mbGFncyB8PSAxMDQ4NTc2LCBjO2QgPSBiLmFsdGVybmF0ZTtpZiAobnVsbCAhPT0gZCkgcmV0dXJuIGQgPSBkLmluZGV4LCBkIDwgYyA/IChiLmZsYWdzIHw9IDIsIGMpIDogZDtiLmZsYWdzIHw9IDI7cmV0dXJuIGM7fWZ1bmN0aW9uIGcoYikge2EgJiYKICAgICAgICAgICAgICBudWxsID09PSBiLmFsdGVybmF0ZSAmJiAoYi5mbGFncyB8PSAyKTtyZXR1cm4gYjt9ZnVuY3Rpb24gaChhLCBiLCBjLCBkKSB7aWYgKG51bGwgPT09IGIgfHwgNiAhPT0gYi50YWcpIHJldHVybiBiID0geGgoYywgYS5tb2RlLCBkKSwgYi5yZXR1cm4gPSBhLCBiO2IgPSBlKGIsIGMpO2IucmV0dXJuID0gYTtyZXR1cm4gYjt9ZnVuY3Rpb24gayhhLCBiLCBjLCBkKSB7dmFyIGYgPSBjLnR5cGU7aWYgKGYgPT09IHlhKSByZXR1cm4gbShhLCBiLCBjLnByb3BzLmNoaWxkcmVuLCBkLCBjLmtleSk7aWYgKG51bGwgIT09IGIgJiYgKGIuZWxlbWVudFR5cGUgPT09IGYgfHwgIm9iamVjdCIgPT09IHR5cGVvZiBmICYmIG51bGwgIT09IGYgJiYgZi4kJHR5cGVvZiA9PT0gSGEgJiYgdWgoZikgPT09IGIudHlwZSkpIHJldHVybiBkID0gZShiLCBjLnByb3BzKSwgZC5yZWYgPSBzaChhLCBiLCBjKSwgZC5yZXR1cm4gPSBhLCBkO2QgPSB5aChjLnR5cGUsIGMua2V5LCBjLnByb3BzLCBudWxsLCBhLm1vZGUsIGQpO2QucmVmID0gc2goYSwgYiwgYyk7ZC5yZXR1cm4gPSBhO3JldHVybiBkO31mdW5jdGlvbiBsKGEsIGIsIGMsIGQpIHtpZiAobnVsbCA9PT0gYiB8fCA0ICE9PSBiLnRhZyB8fAogICAgICAgICAgICAgIGIuc3RhdGVOb2RlLmNvbnRhaW5lckluZm8gIT09IGMuY29udGFpbmVySW5mbyB8fCBiLnN0YXRlTm9kZS5pbXBsZW1lbnRhdGlvbiAhPT0gYy5pbXBsZW1lbnRhdGlvbikgcmV0dXJuIGIgPSB6aChjLCBhLm1vZGUsIGQpLCBiLnJldHVybiA9IGEsIGI7YiA9IGUoYiwgYy5jaGlsZHJlbiB8fCBbXSk7Yi5yZXR1cm4gPSBhO3JldHVybiBiO31mdW5jdGlvbiBtKGEsIGIsIGMsIGQsIGYpIHtpZiAobnVsbCA9PT0gYiB8fCA3ICE9PSBiLnRhZykgcmV0dXJuIGIgPSBBaChjLCBhLm1vZGUsIGQsIGYpLCBiLnJldHVybiA9IGEsIGI7YiA9IGUoYiwgYyk7Yi5yZXR1cm4gPSBhO3JldHVybiBiO31mdW5jdGlvbiBxKGEsIGIsIGMpIHtpZiAoInN0cmluZyIgPT09IHR5cGVvZiBiICYmICIiICE9PSBiIHx8ICJudW1iZXIiID09PSB0eXBlb2YgYikgcmV0dXJuIGIgPSB4aCgiIiArIGIsIGEubW9kZSwgYyksIGIucmV0dXJuID0gYSwgYjtpZiAoIm9iamVjdCIgPT09IHR5cGVvZiBiICYmIG51bGwgIT09IGIpIHtzd2l0Y2ggKGIuJCR0eXBlb2YpIHtjYXNlIHZhOnJldHVybiBjID0geWgoYi50eXBlLCBiLmtleSwgYi5wcm9wcywgbnVsbCwgYS5tb2RlLCBjKSwKICAgICAgICAgICAgICAgICAgICBjLnJlZiA9IHNoKGEsIG51bGwsIGIpLCBjLnJldHVybiA9IGEsIGM7Y2FzZSB3YTpyZXR1cm4gYiA9IHpoKGIsIGEubW9kZSwgYyksIGIucmV0dXJuID0gYSwgYjtjYXNlIEhhOnZhciBkID0gYi5faW5pdDtyZXR1cm4gcShhLCBkKGIuX3BheWxvYWQpLCBjKTt9aWYgKGViKGIpIHx8IEthKGIpKSByZXR1cm4gYiA9IEFoKGIsIGEubW9kZSwgYywgbnVsbCksIGIucmV0dXJuID0gYSwgYjt0aChhLCBiKTt9cmV0dXJuIG51bGw7fWZ1bmN0aW9uIHIoYSwgYiwgYywgZCkge3ZhciBlID0gbnVsbCAhPT0gYiA/IGIua2V5IDogbnVsbDtpZiAoInN0cmluZyIgPT09IHR5cGVvZiBjICYmICIiICE9PSBjIHx8ICJudW1iZXIiID09PSB0eXBlb2YgYykgcmV0dXJuIG51bGwgIT09IGUgPyBudWxsIDogaChhLCBiLCAiIiArIGMsIGQpO2lmICgib2JqZWN0IiA9PT0gdHlwZW9mIGMgJiYgbnVsbCAhPT0gYykge3N3aXRjaCAoYy4kJHR5cGVvZikge2Nhc2UgdmE6cmV0dXJuIGMua2V5ID09PSBlID8gayhhLCBiLCBjLCBkKSA6IG51bGw7Y2FzZSB3YTpyZXR1cm4gYy5rZXkgPT09IGUgPyBsKGEsIGIsIGMsIGQpIDogbnVsbDtjYXNlIEhhOnJldHVybiBlID0gYy5faW5pdCwgcihhLAogICAgICAgICAgICAgICAgICAgIGIsIGUoYy5fcGF5bG9hZCksIGQpO31pZiAoZWIoYykgfHwgS2EoYykpIHJldHVybiBudWxsICE9PSBlID8gbnVsbCA6IG0oYSwgYiwgYywgZCwgbnVsbCk7dGgoYSwgYyk7fXJldHVybiBudWxsO31mdW5jdGlvbiB5KGEsIGIsIGMsIGQsIGUpIHtpZiAoInN0cmluZyIgPT09IHR5cGVvZiBkICYmICIiICE9PSBkIHx8ICJudW1iZXIiID09PSB0eXBlb2YgZCkgcmV0dXJuIGEgPSBhLmdldChjKSB8fCBudWxsLCBoKGIsIGEsICIiICsgZCwgZSk7aWYgKCJvYmplY3QiID09PSB0eXBlb2YgZCAmJiBudWxsICE9PSBkKSB7c3dpdGNoIChkLiQkdHlwZW9mKSB7Y2FzZSB2YTpyZXR1cm4gYSA9IGEuZ2V0KG51bGwgPT09IGQua2V5ID8gYyA6IGQua2V5KSB8fCBudWxsLCBrKGIsIGEsIGQsIGUpO2Nhc2Ugd2E6cmV0dXJuIGEgPSBhLmdldChudWxsID09PSBkLmtleSA/IGMgOiBkLmtleSkgfHwgbnVsbCwgbChiLCBhLCBkLCBlKTtjYXNlIEhhOnZhciBmID0gZC5faW5pdDtyZXR1cm4geShhLCBiLCBjLCBmKGQuX3BheWxvYWQpLCBlKTt9aWYgKGViKGQpIHx8IEthKGQpKSByZXR1cm4gYSA9IGEuZ2V0KGMpIHx8IG51bGwsIG0oYiwgYSwgZCwgZSwgbnVsbCk7dGgoYiwgZCk7fXJldHVybiBudWxsO30KICAgICAgICAgICAgZnVuY3Rpb24gbihlLCBnLCBoLCBrKSB7Zm9yICh2YXIgbCA9IG51bGwsIG0gPSBudWxsLCB1ID0gZywgdyA9IGcgPSAwLCB4ID0gbnVsbDsgbnVsbCAhPT0gdSAmJiB3IDwgaC5sZW5ndGg7IHcrKykge3UuaW5kZXggPiB3ID8gKHggPSB1LCB1ID0gbnVsbCkgOiB4ID0gdS5zaWJsaW5nO3ZhciBuID0gcihlLCB1LCBoW3ddLCBrKTtpZiAobnVsbCA9PT0gbikge251bGwgPT09IHUgJiYgKHUgPSB4KTticmVhazt9YSAmJiB1ICYmIG51bGwgPT09IG4uYWx0ZXJuYXRlICYmIGIoZSwgdSk7ZyA9IGYobiwgZywgdyk7bnVsbCA9PT0gbSA/IGwgPSBuIDogbS5zaWJsaW5nID0gbjttID0gbjt1ID0geDt9aWYgKHcgPT09IGgubGVuZ3RoKSByZXR1cm4gYyhlLCB1KSwgSSAmJiB0ZyhlLCB3KSwgbDtpZiAobnVsbCA9PT0gdSkge2ZvciAoOyB3IDwgaC5sZW5ndGg7IHcrKykgdSA9IHEoZSwgaFt3XSwgayksIG51bGwgIT09IHUgJiYgKGcgPSBmKHUsIGcsIHcpLCBudWxsID09PSBtID8gbCA9IHUgOiBtLnNpYmxpbmcgPSB1LCBtID0gdSk7SSAmJiB0ZyhlLCB3KTtyZXR1cm4gbDt9Zm9yICh1ID0gZChlLCB1KTsgdyA8IGgubGVuZ3RoOyB3KyspIHggPSB5KHUsIGUsIHcsIGhbd10sIGspLCBudWxsICE9PSB4ICYmIChhICYmIG51bGwgIT09IHguYWx0ZXJuYXRlICYmIHUuZGVsZXRlKG51bGwgPT09CiAgICAgICAgICAgICAgeC5rZXkgPyB3IDogeC5rZXkpLCBnID0gZih4LCBnLCB3KSwgbnVsbCA9PT0gbSA/IGwgPSB4IDogbS5zaWJsaW5nID0geCwgbSA9IHgpO2EgJiYgdS5mb3JFYWNoKGZ1bmN0aW9uIChhKSB7cmV0dXJuIGIoZSwgYSk7fSk7SSAmJiB0ZyhlLCB3KTtyZXR1cm4gbDt9ZnVuY3Rpb24gdChlLCBnLCBoLCBrKSB7dmFyIGwgPSBLYShoKTtpZiAoImZ1bmN0aW9uIiAhPT0gdHlwZW9mIGwpIHRocm93IEVycm9yKHAoMTUwKSk7aCA9IGwuY2FsbChoKTtpZiAobnVsbCA9PSBoKSB0aHJvdyBFcnJvcihwKDE1MSkpO2ZvciAodmFyIHUgPSBsID0gbnVsbCwgbSA9IGcsIHcgPSBnID0gMCwgeCA9IG51bGwsIG4gPSBoLm5leHQoKTsgbnVsbCAhPT0gbSAmJiAhbi5kb25lOyB3KyssIG4gPSBoLm5leHQoKSkge20uaW5kZXggPiB3ID8gKHggPSBtLCBtID0gbnVsbCkgOiB4ID0gbS5zaWJsaW5nO3ZhciB0ID0gcihlLCBtLCBuLnZhbHVlLCBrKTtpZiAobnVsbCA9PT0gdCkge251bGwgPT09IG0gJiYgKG0gPSB4KTticmVhazt9YSAmJiBtICYmIG51bGwgPT09IHQuYWx0ZXJuYXRlICYmIGIoZSwgbSk7ZyA9IGYodCwgZywgdyk7bnVsbCA9PT0gdSA/IGwgPSB0IDogdS5zaWJsaW5nID0gdDt1ID0gdDttID0geDt9aWYgKG4uZG9uZSkgcmV0dXJuIGMoZSwKICAgICAgICAgICAgICBtKSwgSSAmJiB0ZyhlLCB3KSwgbDtpZiAobnVsbCA9PT0gbSkge2ZvciAoOyAhbi5kb25lOyB3KyssIG4gPSBoLm5leHQoKSkgbiA9IHEoZSwgbi52YWx1ZSwgayksIG51bGwgIT09IG4gJiYgKGcgPSBmKG4sIGcsIHcpLCBudWxsID09PSB1ID8gbCA9IG4gOiB1LnNpYmxpbmcgPSBuLCB1ID0gbik7SSAmJiB0ZyhlLCB3KTtyZXR1cm4gbDt9Zm9yIChtID0gZChlLCBtKTsgIW4uZG9uZTsgdysrLCBuID0gaC5uZXh0KCkpIG4gPSB5KG0sIGUsIHcsIG4udmFsdWUsIGspLCBudWxsICE9PSBuICYmIChhICYmIG51bGwgIT09IG4uYWx0ZXJuYXRlICYmIG0uZGVsZXRlKG51bGwgPT09IG4ua2V5ID8gdyA6IG4ua2V5KSwgZyA9IGYobiwgZywgdyksIG51bGwgPT09IHUgPyBsID0gbiA6IHUuc2libGluZyA9IG4sIHUgPSBuKTthICYmIG0uZm9yRWFjaChmdW5jdGlvbiAoYSkge3JldHVybiBiKGUsIGEpO30pO0kgJiYgdGcoZSwgdyk7cmV0dXJuIGw7fWZ1bmN0aW9uIEooYSwgZCwgZiwgaCkgeyJvYmplY3QiID09PSB0eXBlb2YgZiAmJiBudWxsICE9PSBmICYmIGYudHlwZSA9PT0geWEgJiYgbnVsbCA9PT0gZi5rZXkgJiYgKGYgPSBmLnByb3BzLmNoaWxkcmVuKTtpZiAoIm9iamVjdCIgPT09IHR5cGVvZiBmICYmIG51bGwgIT09IGYpIHtzd2l0Y2ggKGYuJCR0eXBlb2YpIHtjYXNlIHZhOmE6IHtmb3IgKHZhciBrID0KICAgICAgICAgICAgICAgICAgICAgICAgZi5rZXksIGwgPSBkOyBudWxsICE9PSBsOykge2lmIChsLmtleSA9PT0gaykge2sgPSBmLnR5cGU7aWYgKGsgPT09IHlhKSB7aWYgKDcgPT09IGwudGFnKSB7YyhhLCBsLnNpYmxpbmcpO2QgPSBlKGwsIGYucHJvcHMuY2hpbGRyZW4pO2QucmV0dXJuID0gYTthID0gZDticmVhayBhO319IGVsc2UgaWYgKGwuZWxlbWVudFR5cGUgPT09IGsgfHwgIm9iamVjdCIgPT09IHR5cGVvZiBrICYmIG51bGwgIT09IGsgJiYgay4kJHR5cGVvZiA9PT0gSGEgJiYgdWgoaykgPT09IGwudHlwZSkge2MoYSwgbC5zaWJsaW5nKTtkID0gZShsLCBmLnByb3BzKTtkLnJlZiA9IHNoKGEsIGwsIGYpO2QucmV0dXJuID0gYTthID0gZDticmVhayBhO31jKGEsIGwpO2JyZWFrO30gZWxzZSBiKGEsIGwpO2wgPSBsLnNpYmxpbmc7fWYudHlwZSA9PT0geWEgPyAoZCA9IEFoKGYucHJvcHMuY2hpbGRyZW4sIGEubW9kZSwgaCwgZi5rZXkpLCBkLnJldHVybiA9IGEsIGEgPSBkKSA6IChoID0geWgoZi50eXBlLCBmLmtleSwgZi5wcm9wcywgbnVsbCwgYS5tb2RlLCBoKSwgaC5yZWYgPSBzaChhLCBkLCBmKSwgaC5yZXR1cm4gPSBhLCBhID0gaCk7fXJldHVybiBnKGEpO2Nhc2Ugd2E6YToge2ZvciAobCA9IGYua2V5OyBudWxsICE9PQogICAgICAgICAgICAgICAgICAgICAgZDspIHtpZiAoZC5rZXkgPT09IGwpIHtpZiAoNCA9PT0gZC50YWcgJiYgZC5zdGF0ZU5vZGUuY29udGFpbmVySW5mbyA9PT0gZi5jb250YWluZXJJbmZvICYmIGQuc3RhdGVOb2RlLmltcGxlbWVudGF0aW9uID09PSBmLmltcGxlbWVudGF0aW9uKSB7YyhhLCBkLnNpYmxpbmcpO2QgPSBlKGQsIGYuY2hpbGRyZW4gfHwgW10pO2QucmV0dXJuID0gYTthID0gZDticmVhayBhO30gZWxzZSB7YyhhLCBkKTticmVhazt9fSBlbHNlIGIoYSwgZCk7ZCA9IGQuc2libGluZzt9ZCA9IHpoKGYsIGEubW9kZSwgaCk7ZC5yZXR1cm4gPSBhO2EgPSBkO31yZXR1cm4gZyhhKTtjYXNlIEhhOnJldHVybiBsID0gZi5faW5pdCwgSihhLCBkLCBsKGYuX3BheWxvYWQpLCBoKTt9aWYgKGViKGYpKSByZXR1cm4gbihhLCBkLCBmLCBoKTtpZiAoS2EoZikpIHJldHVybiB0KGEsIGQsIGYsIGgpO3RoKGEsIGYpO31yZXR1cm4gInN0cmluZyIgPT09IHR5cGVvZiBmICYmICIiICE9PSBmIHx8ICJudW1iZXIiID09PSB0eXBlb2YgZiA/IChmID0gIiIgKyBmLCBudWxsICE9PSBkICYmIDYgPT09IGQudGFnID8gKGMoYSwgZC5zaWJsaW5nKSwgZCA9IGUoZCwgZiksIGQucmV0dXJuID0gYSwgYSA9IGQpIDogKAogICAgICAgICAgICAgIGMoYSwgZCksIGQgPSB4aChmLCBhLm1vZGUsIGgpLCBkLnJldHVybiA9IGEsIGEgPSBkKSwgZyhhKSkgOiBjKGEsIGQpO31yZXR1cm4gSjt9dmFyIEJoID0gdmgoITApLENoID0gdmgoITEpLERoID0ge30sRWggPSBVZihEaCksRmggPSBVZihEaCksR2ggPSBVZihEaCk7ZnVuY3Rpb24gSGgoYSkge2lmIChhID09PSBEaCkgdGhyb3cgRXJyb3IocCgxNzQpKTtyZXR1cm4gYTt9ZnVuY3Rpb24gSWgoYSwgYikge0coR2gsIGIpO0coRmgsIGEpO0coRWgsIERoKTthID0gYi5ub2RlVHlwZTtzd2l0Y2ggKGEpIHtjYXNlIDk6Y2FzZSAxMTpiID0gKGIgPSBiLmRvY3VtZW50RWxlbWVudCkgPyBiLm5hbWVzcGFjZVVSSSA6IGxiKG51bGwsICIiKTticmVhaztkZWZhdWx0OmEgPSA4ID09PSBhID8gYi5wYXJlbnROb2RlIDogYiwgYiA9IGEubmFtZXNwYWNlVVJJIHx8IG51bGwsIGEgPSBhLnRhZ05hbWUsIGIgPSBsYihiLCBhKTt9RShFaCk7RyhFaCwgYik7fWZ1bmN0aW9uIEpoKCkge0UoRWgpO0UoRmgpO0UoR2gpO30KICAgICAgICAgIGZ1bmN0aW9uIEtoKGEpIHtIaChHaC5jdXJyZW50KTt2YXIgYiA9IEhoKEVoLmN1cnJlbnQpO3ZhciBjID0gbGIoYiwgYS50eXBlKTtiICE9PSBjICYmIChHKEZoLCBhKSwgRyhFaCwgYykpO31mdW5jdGlvbiBMaChhKSB7RmguY3VycmVudCA9PT0gYSAmJiAoRShFaCksIEUoRmgpKTt9dmFyIE0gPSBVZigwKTsKICAgICAgICAgIGZ1bmN0aW9uIE1oKGEpIHtmb3IgKHZhciBiID0gYTsgbnVsbCAhPT0gYjspIHtpZiAoMTMgPT09IGIudGFnKSB7dmFyIGMgPSBiLm1lbW9pemVkU3RhdGU7aWYgKG51bGwgIT09IGMgJiYgKGMgPSBjLmRlaHlkcmF0ZWQsIG51bGwgPT09IGMgfHwgIiQ/IiA9PT0gYy5kYXRhIHx8ICIkISIgPT09IGMuZGF0YSkpIHJldHVybiBiO30gZWxzZSBpZiAoMTkgPT09IGIudGFnICYmIHZvaWQgMCAhPT0gYi5tZW1vaXplZFByb3BzLnJldmVhbE9yZGVyKSB7aWYgKDAgIT09IChiLmZsYWdzICYgMTI4KSkgcmV0dXJuIGI7fSBlbHNlIGlmIChudWxsICE9PSBiLmNoaWxkKSB7Yi5jaGlsZC5yZXR1cm4gPSBiO2IgPSBiLmNoaWxkO2NvbnRpbnVlO31pZiAoYiA9PT0gYSkgYnJlYWs7Zm9yICg7IG51bGwgPT09IGIuc2libGluZzspIHtpZiAobnVsbCA9PT0gYi5yZXR1cm4gfHwgYi5yZXR1cm4gPT09IGEpIHJldHVybiBudWxsO2IgPSBiLnJldHVybjt9Yi5zaWJsaW5nLnJldHVybiA9IGIucmV0dXJuO2IgPSBiLnNpYmxpbmc7fXJldHVybiBudWxsO312YXIgTmggPSBbXTsKICAgICAgICAgIGZ1bmN0aW9uIE9oKCkge2ZvciAodmFyIGEgPSAwOyBhIDwgTmgubGVuZ3RoOyBhKyspIE5oW2FdLl93b3JrSW5Qcm9ncmVzc1ZlcnNpb25QcmltYXJ5ID0gbnVsbDtOaC5sZW5ndGggPSAwO312YXIgUGggPSB1YS5SZWFjdEN1cnJlbnREaXNwYXRjaGVyLFFoID0gdWEuUmVhY3RDdXJyZW50QmF0Y2hDb25maWcsUmggPSAwLE4gPSBudWxsLE8gPSBudWxsLFAgPSBudWxsLFNoID0gITEsVGggPSAhMSxVaCA9IDAsVmggPSAwO2Z1bmN0aW9uIFEoKSB7dGhyb3cgRXJyb3IocCgzMjEpKTt9ZnVuY3Rpb24gV2goYSwgYikge2lmIChudWxsID09PSBiKSByZXR1cm4gITE7Zm9yICh2YXIgYyA9IDA7IGMgPCBiLmxlbmd0aCAmJiBjIDwgYS5sZW5ndGg7IGMrKykgaWYgKCFIZShhW2NdLCBiW2NdKSkgcmV0dXJuICExO3JldHVybiAhMDt9CiAgICAgICAgICBmdW5jdGlvbiBYaChhLCBiLCBjLCBkLCBlLCBmKSB7UmggPSBmO04gPSBiO2IubWVtb2l6ZWRTdGF0ZSA9IG51bGw7Yi51cGRhdGVRdWV1ZSA9IG51bGw7Yi5sYW5lcyA9IDA7UGguY3VycmVudCA9IG51bGwgPT09IGEgfHwgbnVsbCA9PT0gYS5tZW1vaXplZFN0YXRlID8gWWggOiBaaDthID0gYyhkLCBlKTtpZiAoVGgpIHtmID0gMDtkbyB7VGggPSAhMTtVaCA9IDA7aWYgKDI1IDw9IGYpIHRocm93IEVycm9yKHAoMzAxKSk7ZiArPSAxO1AgPSBPID0gbnVsbDtiLnVwZGF0ZVF1ZXVlID0gbnVsbDtQaC5jdXJyZW50ID0gJGg7YSA9IGMoZCwgZSk7fSB3aGlsZSAoVGgpO31QaC5jdXJyZW50ID0gYWk7YiA9IG51bGwgIT09IE8gJiYgbnVsbCAhPT0gTy5uZXh0O1JoID0gMDtQID0gTyA9IE4gPSBudWxsO1NoID0gITE7aWYgKGIpIHRocm93IEVycm9yKHAoMzAwKSk7cmV0dXJuIGE7fWZ1bmN0aW9uIGJpKCkge3ZhciBhID0gMCAhPT0gVWg7VWggPSAwO3JldHVybiBhO30KICAgICAgICAgIGZ1bmN0aW9uIGNpKCkge3ZhciBhID0geyBtZW1vaXplZFN0YXRlOiBudWxsLCBiYXNlU3RhdGU6IG51bGwsIGJhc2VRdWV1ZTogbnVsbCwgcXVldWU6IG51bGwsIG5leHQ6IG51bGwgfTtudWxsID09PSBQID8gTi5tZW1vaXplZFN0YXRlID0gUCA9IGEgOiBQID0gUC5uZXh0ID0gYTtyZXR1cm4gUDt9ZnVuY3Rpb24gZGkoKSB7aWYgKG51bGwgPT09IE8pIHt2YXIgYSA9IE4uYWx0ZXJuYXRlO2EgPSBudWxsICE9PSBhID8gYS5tZW1vaXplZFN0YXRlIDogbnVsbDt9IGVsc2UgYSA9IE8ubmV4dDt2YXIgYiA9IG51bGwgPT09IFAgPyBOLm1lbW9pemVkU3RhdGUgOiBQLm5leHQ7aWYgKG51bGwgIT09IGIpIFAgPSBiLCBPID0gYTtlbHNlIHtpZiAobnVsbCA9PT0gYSkgdGhyb3cgRXJyb3IocCgzMTApKTtPID0gYTthID0geyBtZW1vaXplZFN0YXRlOiBPLm1lbW9pemVkU3RhdGUsIGJhc2VTdGF0ZTogTy5iYXNlU3RhdGUsIGJhc2VRdWV1ZTogTy5iYXNlUXVldWUsIHF1ZXVlOiBPLnF1ZXVlLCBuZXh0OiBudWxsIH07bnVsbCA9PT0gUCA/IE4ubWVtb2l6ZWRTdGF0ZSA9IFAgPSBhIDogUCA9IFAubmV4dCA9IGE7fXJldHVybiBQO30KICAgICAgICAgIGZ1bmN0aW9uIGVpKGEsIGIpIHtyZXR1cm4gImZ1bmN0aW9uIiA9PT0gdHlwZW9mIGIgPyBiKGEpIDogYjt9CiAgICAgICAgICBmdW5jdGlvbiBmaShhKSB7dmFyIGIgPSBkaSgpLGMgPSBiLnF1ZXVlO2lmIChudWxsID09PSBjKSB0aHJvdyBFcnJvcihwKDMxMSkpO2MubGFzdFJlbmRlcmVkUmVkdWNlciA9IGE7dmFyIGQgPSBPLGUgPSBkLmJhc2VRdWV1ZSxmID0gYy5wZW5kaW5nO2lmIChudWxsICE9PSBmKSB7aWYgKG51bGwgIT09IGUpIHt2YXIgZyA9IGUubmV4dDtlLm5leHQgPSBmLm5leHQ7Zi5uZXh0ID0gZzt9ZC5iYXNlUXVldWUgPSBlID0gZjtjLnBlbmRpbmcgPSBudWxsO31pZiAobnVsbCAhPT0gZSkge2YgPSBlLm5leHQ7ZCA9IGQuYmFzZVN0YXRlO3ZhciBoID0gZyA9IG51bGwsayA9IG51bGwsbCA9IGY7ZG8ge3ZhciBtID0gbC5sYW5lO2lmICgoUmggJiBtKSA9PT0gbSkgbnVsbCAhPT0gayAmJiAoayA9IGsubmV4dCA9IHsgbGFuZTogMCwgYWN0aW9uOiBsLmFjdGlvbiwgaGFzRWFnZXJTdGF0ZTogbC5oYXNFYWdlclN0YXRlLCBlYWdlclN0YXRlOiBsLmVhZ2VyU3RhdGUsIG5leHQ6IG51bGwgfSksIGQgPSBsLmhhc0VhZ2VyU3RhdGUgPyBsLmVhZ2VyU3RhdGUgOiBhKGQsIGwuYWN0aW9uKTtlbHNlIHt2YXIgcSA9IHsgbGFuZTogbSwgYWN0aW9uOiBsLmFjdGlvbiwgaGFzRWFnZXJTdGF0ZTogbC5oYXNFYWdlclN0YXRlLAogICAgICAgICAgICAgICAgICAgIGVhZ2VyU3RhdGU6IGwuZWFnZXJTdGF0ZSwgbmV4dDogbnVsbCB9O251bGwgPT09IGsgPyAoaCA9IGsgPSBxLCBnID0gZCkgOiBrID0gay5uZXh0ID0gcTtOLmxhbmVzIHw9IG07aGggfD0gbTt9bCA9IGwubmV4dDt9IHdoaWxlIChudWxsICE9PSBsICYmIGwgIT09IGYpO251bGwgPT09IGsgPyBnID0gZCA6IGsubmV4dCA9IGg7SGUoZCwgYi5tZW1vaXplZFN0YXRlKSB8fCAoVWcgPSAhMCk7Yi5tZW1vaXplZFN0YXRlID0gZDtiLmJhc2VTdGF0ZSA9IGc7Yi5iYXNlUXVldWUgPSBrO2MubGFzdFJlbmRlcmVkU3RhdGUgPSBkO31hID0gYy5pbnRlcmxlYXZlZDtpZiAobnVsbCAhPT0gYSkge2UgPSBhO2RvIGYgPSBlLmxhbmUsIE4ubGFuZXMgfD0gZiwgaGggfD0gZiwgZSA9IGUubmV4dDsgd2hpbGUgKGUgIT09IGEpO30gZWxzZSBudWxsID09PSBlICYmIChjLmxhbmVzID0gMCk7cmV0dXJuIFtiLm1lbW9pemVkU3RhdGUsIGMuZGlzcGF0Y2hdO30KICAgICAgICAgIGZ1bmN0aW9uIGdpKGEpIHt2YXIgYiA9IGRpKCksYyA9IGIucXVldWU7aWYgKG51bGwgPT09IGMpIHRocm93IEVycm9yKHAoMzExKSk7Yy5sYXN0UmVuZGVyZWRSZWR1Y2VyID0gYTt2YXIgZCA9IGMuZGlzcGF0Y2gsZSA9IGMucGVuZGluZyxmID0gYi5tZW1vaXplZFN0YXRlO2lmIChudWxsICE9PSBlKSB7Yy5wZW5kaW5nID0gbnVsbDt2YXIgZyA9IGUgPSBlLm5leHQ7ZG8gZiA9IGEoZiwgZy5hY3Rpb24pLCBnID0gZy5uZXh0OyB3aGlsZSAoZyAhPT0gZSk7SGUoZiwgYi5tZW1vaXplZFN0YXRlKSB8fCAoVWcgPSAhMCk7Yi5tZW1vaXplZFN0YXRlID0gZjtudWxsID09PSBiLmJhc2VRdWV1ZSAmJiAoYi5iYXNlU3RhdGUgPSBmKTtjLmxhc3RSZW5kZXJlZFN0YXRlID0gZjt9cmV0dXJuIFtmLCBkXTt9ZnVuY3Rpb24gaGkoKSB7fQogICAgICAgICAgZnVuY3Rpb24gaWkoYSwgYikge3ZhciBjID0gTixkID0gZGkoKSxlID0gYigpLGYgPSAhSGUoZC5tZW1vaXplZFN0YXRlLCBlKTtmICYmIChkLm1lbW9pemVkU3RhdGUgPSBlLCBVZyA9ICEwKTtkID0gZC5xdWV1ZTtqaShraS5iaW5kKG51bGwsIGMsIGQsIGEpLCBbYV0pO2lmIChkLmdldFNuYXBzaG90ICE9PSBiIHx8IGYgfHwgbnVsbCAhPT0gUCAmJiBQLm1lbW9pemVkU3RhdGUudGFnICYgMSkge2MuZmxhZ3MgfD0gMjA0ODtsaSg5LCBtaS5iaW5kKG51bGwsIGMsIGQsIGUsIGIpLCB2b2lkIDAsIG51bGwpO2lmIChudWxsID09PSBSKSB0aHJvdyBFcnJvcihwKDM0OSkpOzAgIT09IChSaCAmIDMwKSB8fCBuaShjLCBiLCBlKTt9cmV0dXJuIGU7fWZ1bmN0aW9uIG5pKGEsIGIsIGMpIHthLmZsYWdzIHw9IDE2Mzg0O2EgPSB7IGdldFNuYXBzaG90OiBiLCB2YWx1ZTogYyB9O2IgPSBOLnVwZGF0ZVF1ZXVlO251bGwgPT09IGIgPyAoYiA9IHsgbGFzdEVmZmVjdDogbnVsbCwgc3RvcmVzOiBudWxsIH0sIE4udXBkYXRlUXVldWUgPSBiLCBiLnN0b3JlcyA9IFthXSkgOiAoYyA9IGIuc3RvcmVzLCBudWxsID09PSBjID8gYi5zdG9yZXMgPSBbYV0gOiBjLnB1c2goYSkpO30KICAgICAgICAgIGZ1bmN0aW9uIG1pKGEsIGIsIGMsIGQpIHtiLnZhbHVlID0gYztiLmdldFNuYXBzaG90ID0gZDtvaShiKSAmJiBwaShhKTt9ZnVuY3Rpb24ga2koYSwgYiwgYykge3JldHVybiBjKGZ1bmN0aW9uICgpIHtvaShiKSAmJiBwaShhKTt9KTt9ZnVuY3Rpb24gb2koYSkge3ZhciBiID0gYS5nZXRTbmFwc2hvdDthID0gYS52YWx1ZTt0cnkge3ZhciBjID0gYigpO3JldHVybiAhSGUoYSwgYyk7fSBjYXRjaCAoZCkge3JldHVybiAhMDt9fWZ1bmN0aW9uIHBpKGEpIHt2YXIgYiA9IFpnKGEsIDEpO251bGwgIT09IGIgJiYgbWgoYiwgYSwgMSwgLTEpO30KICAgICAgICAgIGZ1bmN0aW9uIHFpKGEpIHt2YXIgYiA9IGNpKCk7ImZ1bmN0aW9uIiA9PT0gdHlwZW9mIGEgJiYgKGEgPSBhKCkpO2IubWVtb2l6ZWRTdGF0ZSA9IGIuYmFzZVN0YXRlID0gYTthID0geyBwZW5kaW5nOiBudWxsLCBpbnRlcmxlYXZlZDogbnVsbCwgbGFuZXM6IDAsIGRpc3BhdGNoOiBudWxsLCBsYXN0UmVuZGVyZWRSZWR1Y2VyOiBlaSwgbGFzdFJlbmRlcmVkU3RhdGU6IGEgfTtiLnF1ZXVlID0gYTthID0gYS5kaXNwYXRjaCA9IHJpLmJpbmQobnVsbCwgTiwgYSk7cmV0dXJuIFtiLm1lbW9pemVkU3RhdGUsIGFdO30KICAgICAgICAgIGZ1bmN0aW9uIGxpKGEsIGIsIGMsIGQpIHthID0geyB0YWc6IGEsIGNyZWF0ZTogYiwgZGVzdHJveTogYywgZGVwczogZCwgbmV4dDogbnVsbCB9O2IgPSBOLnVwZGF0ZVF1ZXVlO251bGwgPT09IGIgPyAoYiA9IHsgbGFzdEVmZmVjdDogbnVsbCwgc3RvcmVzOiBudWxsIH0sIE4udXBkYXRlUXVldWUgPSBiLCBiLmxhc3RFZmZlY3QgPSBhLm5leHQgPSBhKSA6IChjID0gYi5sYXN0RWZmZWN0LCBudWxsID09PSBjID8gYi5sYXN0RWZmZWN0ID0gYS5uZXh0ID0gYSA6IChkID0gYy5uZXh0LCBjLm5leHQgPSBhLCBhLm5leHQgPSBkLCBiLmxhc3RFZmZlY3QgPSBhKSk7cmV0dXJuIGE7fWZ1bmN0aW9uIHNpKCkge3JldHVybiBkaSgpLm1lbW9pemVkU3RhdGU7fWZ1bmN0aW9uIHRpKGEsIGIsIGMsIGQpIHt2YXIgZSA9IGNpKCk7Ti5mbGFncyB8PSBhO2UubWVtb2l6ZWRTdGF0ZSA9IGxpKDEgfCBiLCBjLCB2b2lkIDAsIHZvaWQgMCA9PT0gZCA/IG51bGwgOiBkKTt9CiAgICAgICAgICBmdW5jdGlvbiB1aShhLCBiLCBjLCBkKSB7dmFyIGUgPSBkaSgpO2QgPSB2b2lkIDAgPT09IGQgPyBudWxsIDogZDt2YXIgZiA9IHZvaWQgMDtpZiAobnVsbCAhPT0gTykge3ZhciBnID0gTy5tZW1vaXplZFN0YXRlO2YgPSBnLmRlc3Ryb3k7aWYgKG51bGwgIT09IGQgJiYgV2goZCwgZy5kZXBzKSkge2UubWVtb2l6ZWRTdGF0ZSA9IGxpKGIsIGMsIGYsIGQpO3JldHVybjt9fU4uZmxhZ3MgfD0gYTtlLm1lbW9pemVkU3RhdGUgPSBsaSgxIHwgYiwgYywgZiwgZCk7fWZ1bmN0aW9uIHZpKGEsIGIpIHtyZXR1cm4gdGkoODM5MDY1NiwgOCwgYSwgYik7fWZ1bmN0aW9uIGppKGEsIGIpIHtyZXR1cm4gdWkoMjA0OCwgOCwgYSwgYik7fWZ1bmN0aW9uIHdpKGEsIGIpIHtyZXR1cm4gdWkoNCwgMiwgYSwgYik7fWZ1bmN0aW9uIHhpKGEsIGIpIHtyZXR1cm4gdWkoNCwgNCwgYSwgYik7fQogICAgICAgICAgZnVuY3Rpb24geWkoYSwgYikge2lmICgiZnVuY3Rpb24iID09PSB0eXBlb2YgYikgcmV0dXJuIGEgPSBhKCksIGIoYSksIGZ1bmN0aW9uICgpIHtiKG51bGwpO307aWYgKG51bGwgIT09IGIgJiYgdm9pZCAwICE9PSBiKSByZXR1cm4gYSA9IGEoKSwgYi5jdXJyZW50ID0gYSwgZnVuY3Rpb24gKCkge2IuY3VycmVudCA9IG51bGw7fTt9ZnVuY3Rpb24gemkoYSwgYiwgYykge2MgPSBudWxsICE9PSBjICYmIHZvaWQgMCAhPT0gYyA/IGMuY29uY2F0KFthXSkgOiBudWxsO3JldHVybiB1aSg0LCA0LCB5aS5iaW5kKG51bGwsIGIsIGEpLCBjKTt9ZnVuY3Rpb24gQWkoKSB7fWZ1bmN0aW9uIEJpKGEsIGIpIHt2YXIgYyA9IGRpKCk7YiA9IHZvaWQgMCA9PT0gYiA/IG51bGwgOiBiO3ZhciBkID0gYy5tZW1vaXplZFN0YXRlO2lmIChudWxsICE9PSBkICYmIG51bGwgIT09IGIgJiYgV2goYiwgZFsxXSkpIHJldHVybiBkWzBdO2MubWVtb2l6ZWRTdGF0ZSA9IFthLCBiXTtyZXR1cm4gYTt9CiAgICAgICAgICBmdW5jdGlvbiBDaShhLCBiKSB7dmFyIGMgPSBkaSgpO2IgPSB2b2lkIDAgPT09IGIgPyBudWxsIDogYjt2YXIgZCA9IGMubWVtb2l6ZWRTdGF0ZTtpZiAobnVsbCAhPT0gZCAmJiBudWxsICE9PSBiICYmIFdoKGIsIGRbMV0pKSByZXR1cm4gZFswXTthID0gYSgpO2MubWVtb2l6ZWRTdGF0ZSA9IFthLCBiXTtyZXR1cm4gYTt9ZnVuY3Rpb24gRGkoYSwgYiwgYykge2lmICgwID09PSAoUmggJiAyMSkpIHJldHVybiBhLmJhc2VTdGF0ZSAmJiAoYS5iYXNlU3RhdGUgPSAhMSwgVWcgPSAhMCksIGEubWVtb2l6ZWRTdGF0ZSA9IGM7SGUoYywgYikgfHwgKGMgPSB5YygpLCBOLmxhbmVzIHw9IGMsIGhoIHw9IGMsIGEuYmFzZVN0YXRlID0gITApO3JldHVybiBiO31mdW5jdGlvbiBFaShhLCBiKSB7dmFyIGMgPSBDO0MgPSAwICE9PSBjICYmIDQgPiBjID8gYyA6IDQ7YSghMCk7dmFyIGQgPSBRaC50cmFuc2l0aW9uO1FoLnRyYW5zaXRpb24gPSB7fTt0cnkge2EoITEpLCBiKCk7fSBmaW5hbGx5IHtDID0gYywgUWgudHJhbnNpdGlvbiA9IGQ7fX1mdW5jdGlvbiBGaSgpIHtyZXR1cm4gZGkoKS5tZW1vaXplZFN0YXRlO30KICAgICAgICAgIGZ1bmN0aW9uIEdpKGEsIGIsIGMpIHt2YXIgZCA9IGxoKGEpO2MgPSB7IGxhbmU6IGQsIGFjdGlvbjogYywgaGFzRWFnZXJTdGF0ZTogITEsIGVhZ2VyU3RhdGU6IG51bGwsIG5leHQ6IG51bGwgfTtpZiAoSGkoYSkpIElpKGIsIGMpO2Vsc2UgaWYgKGMgPSBZZyhhLCBiLCBjLCBkKSwgbnVsbCAhPT0gYykge3ZhciBlID0gTCgpO21oKGMsIGEsIGQsIGUpO0ppKGMsIGIsIGQpO319CiAgICAgICAgICBmdW5jdGlvbiByaShhLCBiLCBjKSB7dmFyIGQgPSBsaChhKSxlID0geyBsYW5lOiBkLCBhY3Rpb246IGMsIGhhc0VhZ2VyU3RhdGU6ICExLCBlYWdlclN0YXRlOiBudWxsLCBuZXh0OiBudWxsIH07aWYgKEhpKGEpKSBJaShiLCBlKTtlbHNlIHt2YXIgZiA9IGEuYWx0ZXJuYXRlO2lmICgwID09PSBhLmxhbmVzICYmIChudWxsID09PSBmIHx8IDAgPT09IGYubGFuZXMpICYmIChmID0gYi5sYXN0UmVuZGVyZWRSZWR1Y2VyLCBudWxsICE9PSBmKSkgdHJ5IHt2YXIgZyA9IGIubGFzdFJlbmRlcmVkU3RhdGUsaCA9IGYoZywgYyk7ZS5oYXNFYWdlclN0YXRlID0gITA7ZS5lYWdlclN0YXRlID0gaDtpZiAoSGUoaCwgZykpIHt2YXIgayA9IGIuaW50ZXJsZWF2ZWQ7bnVsbCA9PT0gayA/IChlLm5leHQgPSBlLCBYZyhiKSkgOiAoZS5uZXh0ID0gay5uZXh0LCBrLm5leHQgPSBlKTtiLmludGVybGVhdmVkID0gZTtyZXR1cm47fX0gY2F0Y2ggKGwpIHt9IGZpbmFsbHkge31jID0gWWcoYSwgYiwgZSwgZCk7bnVsbCAhPT0gYyAmJiAoZSA9IEwoKSwgbWgoYywgYSwgZCwgZSksIEppKGMsIGIsIGQpKTt9fQogICAgICAgICAgZnVuY3Rpb24gSGkoYSkge3ZhciBiID0gYS5hbHRlcm5hdGU7cmV0dXJuIGEgPT09IE4gfHwgbnVsbCAhPT0gYiAmJiBiID09PSBOO31mdW5jdGlvbiBJaShhLCBiKSB7VGggPSBTaCA9ICEwO3ZhciBjID0gYS5wZW5kaW5nO251bGwgPT09IGMgPyBiLm5leHQgPSBiIDogKGIubmV4dCA9IGMubmV4dCwgYy5uZXh0ID0gYik7YS5wZW5kaW5nID0gYjt9ZnVuY3Rpb24gSmkoYSwgYiwgYykge2lmICgwICE9PSAoYyAmIDQxOTQyNDApKSB7dmFyIGQgPSBiLmxhbmVzO2QgJj0gYS5wZW5kaW5nTGFuZXM7YyB8PSBkO2IubGFuZXMgPSBjO0NjKGEsIGMpO319CiAgICAgICAgICB2YXIgYWkgPSB7IHJlYWRDb250ZXh0OiBWZywgdXNlQ2FsbGJhY2s6IFEsIHVzZUNvbnRleHQ6IFEsIHVzZUVmZmVjdDogUSwgdXNlSW1wZXJhdGl2ZUhhbmRsZTogUSwgdXNlSW5zZXJ0aW9uRWZmZWN0OiBRLCB1c2VMYXlvdXRFZmZlY3Q6IFEsIHVzZU1lbW86IFEsIHVzZVJlZHVjZXI6IFEsIHVzZVJlZjogUSwgdXNlU3RhdGU6IFEsIHVzZURlYnVnVmFsdWU6IFEsIHVzZURlZmVycmVkVmFsdWU6IFEsIHVzZVRyYW5zaXRpb246IFEsIHVzZU11dGFibGVTb3VyY2U6IFEsIHVzZVN5bmNFeHRlcm5hbFN0b3JlOiBRLCB1c2VJZDogUSwgdW5zdGFibGVfaXNOZXdSZWNvbmNpbGVyOiAhMSB9LFloID0geyByZWFkQ29udGV4dDogVmcsIHVzZUNhbGxiYWNrOiBmdW5jdGlvbiB1c2VDYWxsYmFjayhhLCBiKSB7Y2koKS5tZW1vaXplZFN0YXRlID0gW2EsIHZvaWQgMCA9PT0gYiA/IG51bGwgOiBiXTtyZXR1cm4gYTt9LCB1c2VDb250ZXh0OiBWZywgdXNlRWZmZWN0OiB2aSwgdXNlSW1wZXJhdGl2ZUhhbmRsZTogZnVuY3Rpb24gdXNlSW1wZXJhdGl2ZUhhbmRsZShhLCBiLCBjKSB7YyA9IG51bGwgIT09IGMgJiYgdm9pZCAwICE9PSBjID8gYy5jb25jYXQoW2FdKSA6IG51bGw7cmV0dXJuIHRpKDQxOTQzMDgsCiAgICAgICAgICAgICAgICA0LCB5aS5iaW5kKG51bGwsIGIsIGEpLCBjKTt9LCB1c2VMYXlvdXRFZmZlY3Q6IGZ1bmN0aW9uIHVzZUxheW91dEVmZmVjdChhLCBiKSB7cmV0dXJuIHRpKDQxOTQzMDgsIDQsIGEsIGIpO30sIHVzZUluc2VydGlvbkVmZmVjdDogZnVuY3Rpb24gdXNlSW5zZXJ0aW9uRWZmZWN0KGEsIGIpIHtyZXR1cm4gdGkoNCwgMiwgYSwgYik7fSwgdXNlTWVtbzogZnVuY3Rpb24gdXNlTWVtbyhhLCBiKSB7dmFyIGMgPSBjaSgpO2IgPSB2b2lkIDAgPT09IGIgPyBudWxsIDogYjthID0gYSgpO2MubWVtb2l6ZWRTdGF0ZSA9IFthLCBiXTtyZXR1cm4gYTt9LCB1c2VSZWR1Y2VyOiBmdW5jdGlvbiB1c2VSZWR1Y2VyKGEsIGIsIGMpIHt2YXIgZCA9IGNpKCk7YiA9IHZvaWQgMCAhPT0gYyA/IGMoYikgOiBiO2QubWVtb2l6ZWRTdGF0ZSA9IGQuYmFzZVN0YXRlID0gYjthID0geyBwZW5kaW5nOiBudWxsLCBpbnRlcmxlYXZlZDogbnVsbCwgbGFuZXM6IDAsIGRpc3BhdGNoOiBudWxsLCBsYXN0UmVuZGVyZWRSZWR1Y2VyOiBhLCBsYXN0UmVuZGVyZWRTdGF0ZTogYiB9O2QucXVldWUgPSBhO2EgPSBhLmRpc3BhdGNoID0gR2kuYmluZChudWxsLCBOLCBhKTtyZXR1cm4gW2QubWVtb2l6ZWRTdGF0ZSwgYV07fSwgdXNlUmVmOiBmdW5jdGlvbiB1c2VSZWYoYSkge3ZhciBiID0KICAgICAgICAgICAgICAgIGNpKCk7YSA9IHsgY3VycmVudDogYSB9O3JldHVybiBiLm1lbW9pemVkU3RhdGUgPSBhO30sIHVzZVN0YXRlOiBxaSwgdXNlRGVidWdWYWx1ZTogQWksIHVzZURlZmVycmVkVmFsdWU6IGZ1bmN0aW9uIHVzZURlZmVycmVkVmFsdWUoYSkge3JldHVybiBjaSgpLm1lbW9pemVkU3RhdGUgPSBhO30sIHVzZVRyYW5zaXRpb246IGZ1bmN0aW9uIHVzZVRyYW5zaXRpb24oKSB7dmFyIGEgPSBxaSghMSksYiA9IGFbMF07YSA9IEVpLmJpbmQobnVsbCwgYVsxXSk7Y2koKS5tZW1vaXplZFN0YXRlID0gYTtyZXR1cm4gW2IsIGFdO30sIHVzZU11dGFibGVTb3VyY2U6IGZ1bmN0aW9uIHVzZU11dGFibGVTb3VyY2UoKSB7fSwgdXNlU3luY0V4dGVybmFsU3RvcmU6IGZ1bmN0aW9uIHVzZVN5bmNFeHRlcm5hbFN0b3JlKGEsIGIsIGMpIHt2YXIgZCA9IE4sZSA9IGNpKCk7aWYgKEkpIHtpZiAodm9pZCAwID09PSBjKSB0aHJvdyBFcnJvcihwKDQwNykpO2MgPSBjKCk7fSBlbHNlIHtjID0gYigpO2lmIChudWxsID09PSBSKSB0aHJvdyBFcnJvcihwKDM0OSkpOzAgIT09IChSaCAmIDMwKSB8fCBuaShkLCBiLCBjKTt9ZS5tZW1vaXplZFN0YXRlID0gYzt2YXIgZiA9IHsgdmFsdWU6IGMsIGdldFNuYXBzaG90OiBiIH07ZS5xdWV1ZSA9IGY7dmkoa2kuYmluZChudWxsLCBkLAogICAgICAgICAgICAgICAgZiwgYSksIFthXSk7ZC5mbGFncyB8PSAyMDQ4O2xpKDksIG1pLmJpbmQobnVsbCwgZCwgZiwgYywgYiksIHZvaWQgMCwgbnVsbCk7cmV0dXJuIGM7fSwgdXNlSWQ6IGZ1bmN0aW9uIHVzZUlkKCkge3ZhciBhID0gY2koKSxiID0gUi5pZGVudGlmaWVyUHJlZml4O2lmIChJKSB7dmFyIGMgPSBzZzt2YXIgZCA9IHJnO2MgPSAoZCAmIH4oMSA8PCAzMiAtIG9jKGQpIC0gMSkpLnRvU3RyaW5nKDMyKSArIGM7YiA9ICI6IiArIGIgKyAiUiIgKyBjO2MgPSBVaCsrOzAgPCBjICYmIChiICs9ICJIIiArIGMudG9TdHJpbmcoMzIpKTtiICs9ICI6Ijt9IGVsc2UgYyA9IFZoKyssIGIgPSAiOiIgKyBiICsgInIiICsgYy50b1N0cmluZygzMikgKyAiOiI7cmV0dXJuIGEubWVtb2l6ZWRTdGF0ZSA9IGI7fSwgdW5zdGFibGVfaXNOZXdSZWNvbmNpbGVyOiAhMSB9LFpoID0geyByZWFkQ29udGV4dDogVmcsIHVzZUNhbGxiYWNrOiBCaSwgdXNlQ29udGV4dDogVmcsIHVzZUVmZmVjdDogamksIHVzZUltcGVyYXRpdmVIYW5kbGU6IHppLCB1c2VJbnNlcnRpb25FZmZlY3Q6IHdpLCB1c2VMYXlvdXRFZmZlY3Q6IHhpLCB1c2VNZW1vOiBDaSwgdXNlUmVkdWNlcjogZmksIHVzZVJlZjogc2ksIHVzZVN0YXRlOiBmdW5jdGlvbiB1c2VTdGF0ZSgpIHtyZXR1cm4gZmkoZWkpO30sCiAgICAgICAgICAgICAgdXNlRGVidWdWYWx1ZTogQWksIHVzZURlZmVycmVkVmFsdWU6IGZ1bmN0aW9uIHVzZURlZmVycmVkVmFsdWUoYSkge3ZhciBiID0gZGkoKTtyZXR1cm4gRGkoYiwgTy5tZW1vaXplZFN0YXRlLCBhKTt9LCB1c2VUcmFuc2l0aW9uOiBmdW5jdGlvbiB1c2VUcmFuc2l0aW9uKCkge3ZhciBhID0gZmkoZWkpWzBdLGIgPSBkaSgpLm1lbW9pemVkU3RhdGU7cmV0dXJuIFthLCBiXTt9LCB1c2VNdXRhYmxlU291cmNlOiBoaSwgdXNlU3luY0V4dGVybmFsU3RvcmU6IGlpLCB1c2VJZDogRmksIHVuc3RhYmxlX2lzTmV3UmVjb25jaWxlcjogITEgfSwkaCA9IHsgcmVhZENvbnRleHQ6IFZnLCB1c2VDYWxsYmFjazogQmksIHVzZUNvbnRleHQ6IFZnLCB1c2VFZmZlY3Q6IGppLCB1c2VJbXBlcmF0aXZlSGFuZGxlOiB6aSwgdXNlSW5zZXJ0aW9uRWZmZWN0OiB3aSwgdXNlTGF5b3V0RWZmZWN0OiB4aSwgdXNlTWVtbzogQ2ksIHVzZVJlZHVjZXI6IGdpLCB1c2VSZWY6IHNpLCB1c2VTdGF0ZTogZnVuY3Rpb24gdXNlU3RhdGUoKSB7cmV0dXJuIGdpKGVpKTt9LCB1c2VEZWJ1Z1ZhbHVlOiBBaSwgdXNlRGVmZXJyZWRWYWx1ZTogZnVuY3Rpb24gdXNlRGVmZXJyZWRWYWx1ZShhKSB7dmFyIGIgPSBkaSgpO3JldHVybiBudWxsID09PQogICAgICAgICAgICAgICAgTyA/IGIubWVtb2l6ZWRTdGF0ZSA9IGEgOiBEaShiLCBPLm1lbW9pemVkU3RhdGUsIGEpO30sIHVzZVRyYW5zaXRpb246IGZ1bmN0aW9uIHVzZVRyYW5zaXRpb24oKSB7dmFyIGEgPSBnaShlaSlbMF0sYiA9IGRpKCkubWVtb2l6ZWRTdGF0ZTtyZXR1cm4gW2EsIGJdO30sIHVzZU11dGFibGVTb3VyY2U6IGhpLCB1c2VTeW5jRXh0ZXJuYWxTdG9yZTogaWksIHVzZUlkOiBGaSwgdW5zdGFibGVfaXNOZXdSZWNvbmNpbGVyOiAhMSB9O2Z1bmN0aW9uIEtpKGEsIGIpIHt0cnkge3ZhciBjID0gIiIsZCA9IGI7ZG8gYyArPSBQYShkKSwgZCA9IGQucmV0dXJuOyB3aGlsZSAoZCk7dmFyIGUgPSBjO30gY2F0Y2ggKGYpIHtlID0gIlxuRXJyb3IgZ2VuZXJhdGluZyBzdGFjazogIiArIGYubWVzc2FnZSArICJcbiIgKyBmLnN0YWNrO31yZXR1cm4geyB2YWx1ZTogYSwgc291cmNlOiBiLCBzdGFjazogZSwgZGlnZXN0OiBudWxsIH07fWZ1bmN0aW9uIExpKGEsIGIsIGMpIHtyZXR1cm4geyB2YWx1ZTogYSwgc291cmNlOiBudWxsLCBzdGFjazogbnVsbCAhPSBjID8gYyA6IG51bGwsIGRpZ2VzdDogbnVsbCAhPSBiID8gYiA6IG51bGwgfTt9CiAgICAgICAgICBmdW5jdGlvbiBNaShhLCBiKSB7dHJ5IHtjb25zb2xlLmVycm9yKGIudmFsdWUpO30gY2F0Y2ggKGMpIHtzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHt0aHJvdyBjO30pO319dmFyIE5pID0gImZ1bmN0aW9uIiA9PT0gdHlwZW9mIFdlYWtNYXAgPyBXZWFrTWFwIDogTWFwO2Z1bmN0aW9uIE9pKGEsIGIsIGMpIHtjID0gY2goLTEsIGMpO2MudGFnID0gMztjLnBheWxvYWQgPSB7IGVsZW1lbnQ6IG51bGwgfTt2YXIgZCA9IGIudmFsdWU7Yy5jYWxsYmFjayA9IGZ1bmN0aW9uICgpIHtQaSB8fCAoUGkgPSAhMCwgUWkgPSBkKTtNaShhLCBiKTt9O3JldHVybiBjO30KICAgICAgICAgIGZ1bmN0aW9uIFJpKGEsIGIsIGMpIHtjID0gY2goLTEsIGMpO2MudGFnID0gMzt2YXIgZCA9IGEudHlwZS5nZXREZXJpdmVkU3RhdGVGcm9tRXJyb3I7aWYgKCJmdW5jdGlvbiIgPT09IHR5cGVvZiBkKSB7dmFyIGUgPSBiLnZhbHVlO2MucGF5bG9hZCA9IGZ1bmN0aW9uICgpIHtyZXR1cm4gZChlKTt9O2MuY2FsbGJhY2sgPSBmdW5jdGlvbiAoKSB7TWkoYSwgYik7fTt9dmFyIGYgPSBhLnN0YXRlTm9kZTtudWxsICE9PSBmICYmICJmdW5jdGlvbiIgPT09IHR5cGVvZiBmLmNvbXBvbmVudERpZENhdGNoICYmIChjLmNhbGxiYWNrID0gZnVuY3Rpb24gKCkge01pKGEsIGIpOyJmdW5jdGlvbiIgIT09IHR5cGVvZiBkICYmIChudWxsID09PSBTaSA/IFNpID0gbmV3IFNldChbdGhpc10pIDogU2kuYWRkKHRoaXMpKTt2YXIgYyA9IGIuc3RhY2s7dGhpcy5jb21wb25lbnREaWRDYXRjaChiLnZhbHVlLCB7IGNvbXBvbmVudFN0YWNrOiBudWxsICE9PSBjID8gYyA6ICIiIH0pO30pO3JldHVybiBjO30KICAgICAgICAgIGZ1bmN0aW9uIFRpKGEsIGIsIGMpIHt2YXIgZCA9IGEucGluZ0NhY2hlO2lmIChudWxsID09PSBkKSB7ZCA9IGEucGluZ0NhY2hlID0gbmV3IE5pKCk7dmFyIGUgPSBuZXcgU2V0KCk7ZC5zZXQoYiwgZSk7fSBlbHNlIGUgPSBkLmdldChiKSwgdm9pZCAwID09PSBlICYmIChlID0gbmV3IFNldCgpLCBkLnNldChiLCBlKSk7ZS5oYXMoYykgfHwgKGUuYWRkKGMpLCBhID0gVWkuYmluZChudWxsLCBhLCBiLCBjKSwgYi50aGVuKGEsIGEpKTt9ZnVuY3Rpb24gVmkoYSkge2RvIHt2YXIgYjtpZiAoYiA9IDEzID09PSBhLnRhZykgYiA9IGEubWVtb2l6ZWRTdGF0ZSwgYiA9IG51bGwgIT09IGIgPyBudWxsICE9PSBiLmRlaHlkcmF0ZWQgPyAhMCA6ICExIDogITA7aWYgKGIpIHJldHVybiBhO2EgPSBhLnJldHVybjt9IHdoaWxlIChudWxsICE9PSBhKTtyZXR1cm4gbnVsbDt9CiAgICAgICAgICBmdW5jdGlvbiBXaShhLCBiLCBjLCBkLCBlKSB7aWYgKDAgPT09IChhLm1vZGUgJiAxKSkgcmV0dXJuIGEgPT09IGIgPyBhLmZsYWdzIHw9IDY1NTM2IDogKGEuZmxhZ3MgfD0gMTI4LCBjLmZsYWdzIHw9IDEzMTA3MiwgYy5mbGFncyAmPSAtNTI4MDUsIDEgPT09IGMudGFnICYmIChudWxsID09PSBjLmFsdGVybmF0ZSA/IGMudGFnID0gMTcgOiAoYiA9IGNoKC0xLCAxKSwgYi50YWcgPSAyLCBkaChjLCBiLCAxKSkpLCBjLmxhbmVzIHw9IDEpLCBhO2EuZmxhZ3MgfD0gNjU1MzY7YS5sYW5lcyA9IGU7cmV0dXJuIGE7fXZhciBYaSA9IHVhLlJlYWN0Q3VycmVudE93bmVyLFVnID0gITE7ZnVuY3Rpb24gWWkoYSwgYiwgYywgZCkge2IuY2hpbGQgPSBudWxsID09PSBhID8gQ2goYiwgbnVsbCwgYywgZCkgOiBCaChiLCBhLmNoaWxkLCBjLCBkKTt9CiAgICAgICAgICBmdW5jdGlvbiBaaShhLCBiLCBjLCBkLCBlKSB7YyA9IGMucmVuZGVyO3ZhciBmID0gYi5yZWY7VGcoYiwgZSk7ZCA9IFhoKGEsIGIsIGMsIGQsIGYsIGUpO2MgPSBiaSgpO2lmIChudWxsICE9PSBhICYmICFVZykgcmV0dXJuIGIudXBkYXRlUXVldWUgPSBhLnVwZGF0ZVF1ZXVlLCBiLmZsYWdzICY9IC0yMDUzLCBhLmxhbmVzICY9IH5lLCAkaShhLCBiLCBlKTtJICYmIGMgJiYgdmcoYik7Yi5mbGFncyB8PSAxO1lpKGEsIGIsIGQsIGUpO3JldHVybiBiLmNoaWxkO30KICAgICAgICAgIGZ1bmN0aW9uIGFqKGEsIGIsIGMsIGQsIGUpIHtpZiAobnVsbCA9PT0gYSkge3ZhciBmID0gYy50eXBlO2lmICgiZnVuY3Rpb24iID09PSB0eXBlb2YgZiAmJiAhYmooZikgJiYgdm9pZCAwID09PSBmLmRlZmF1bHRQcm9wcyAmJiBudWxsID09PSBjLmNvbXBhcmUgJiYgdm9pZCAwID09PSBjLmRlZmF1bHRQcm9wcykgcmV0dXJuIGIudGFnID0gMTUsIGIudHlwZSA9IGYsIGNqKGEsIGIsIGYsIGQsIGUpO2EgPSB5aChjLnR5cGUsIG51bGwsIGQsIGIsIGIubW9kZSwgZSk7YS5yZWYgPSBiLnJlZjthLnJldHVybiA9IGI7cmV0dXJuIGIuY2hpbGQgPSBhO31mID0gYS5jaGlsZDtpZiAoMCA9PT0gKGEubGFuZXMgJiBlKSkge3ZhciBnID0gZi5tZW1vaXplZFByb3BzO2MgPSBjLmNvbXBhcmU7YyA9IG51bGwgIT09IGMgPyBjIDogSWU7aWYgKGMoZywgZCkgJiYgYS5yZWYgPT09IGIucmVmKSByZXR1cm4gJGkoYSwgYiwgZSk7fWIuZmxhZ3MgfD0gMTthID0gd2goZiwgZCk7YS5yZWYgPSBiLnJlZjthLnJldHVybiA9IGI7cmV0dXJuIGIuY2hpbGQgPSBhO30KICAgICAgICAgIGZ1bmN0aW9uIGNqKGEsIGIsIGMsIGQsIGUpIHtpZiAobnVsbCAhPT0gYSkge3ZhciBmID0gYS5tZW1vaXplZFByb3BzO2lmIChJZShmLCBkKSAmJiBhLnJlZiA9PT0gYi5yZWYpIGlmIChVZyA9ICExLCBiLnBlbmRpbmdQcm9wcyA9IGQgPSBmLCAwICE9PSAoYS5sYW5lcyAmIGUpKSAwICE9PSAoYS5mbGFncyAmIDEzMTA3MikgJiYgKFVnID0gITApO2Vsc2UgcmV0dXJuIGIubGFuZXMgPSBhLmxhbmVzLCAkaShhLCBiLCBlKTt9cmV0dXJuIGRqKGEsIGIsIGMsIGQsIGUpO30KICAgICAgICAgIGZ1bmN0aW9uIGVqKGEsIGIsIGMpIHt2YXIgZCA9IGIucGVuZGluZ1Byb3BzLGUgPSBkLmNoaWxkcmVuLGYgPSBudWxsICE9PSBhID8gYS5tZW1vaXplZFN0YXRlIDogbnVsbDtpZiAoImhpZGRlbiIgPT09IGQubW9kZSkge2lmICgwID09PSAoYi5tb2RlICYgMSkpIGIubWVtb2l6ZWRTdGF0ZSA9IHsgYmFzZUxhbmVzOiAwLCBjYWNoZVBvb2w6IG51bGwsIHRyYW5zaXRpb25zOiBudWxsIH0sIEcoZmosIGdqKSwgZ2ogfD0gYztlbHNlIHtpZiAoMCA9PT0gKGMgJiAxMDczNzQxODI0KSkgcmV0dXJuIGEgPSBudWxsICE9PSBmID8gZi5iYXNlTGFuZXMgfCBjIDogYywgYi5sYW5lcyA9IGIuY2hpbGRMYW5lcyA9IDEwNzM3NDE4MjQsIGIubWVtb2l6ZWRTdGF0ZSA9IHsgYmFzZUxhbmVzOiBhLCBjYWNoZVBvb2w6IG51bGwsIHRyYW5zaXRpb25zOiBudWxsIH0sIGIudXBkYXRlUXVldWUgPSBudWxsLCBHKGZqLCBnaiksIGdqIHw9IGEsIG51bGw7Yi5tZW1vaXplZFN0YXRlID0geyBiYXNlTGFuZXM6IDAsIGNhY2hlUG9vbDogbnVsbCwgdHJhbnNpdGlvbnM6IG51bGwgfTtkID0gbnVsbCAhPT0gZiA/IGYuYmFzZUxhbmVzIDogYztHKGZqLCBnaik7Z2ogfD0gZDt9fSBlbHNlIG51bGwgIT09CiAgICAgICAgICAgIGYgPyAoZCA9IGYuYmFzZUxhbmVzIHwgYywgYi5tZW1vaXplZFN0YXRlID0gbnVsbCkgOiBkID0gYywgRyhmaiwgZ2opLCBnaiB8PSBkO1lpKGEsIGIsIGUsIGMpO3JldHVybiBiLmNoaWxkO31mdW5jdGlvbiBoaihhLCBiKSB7dmFyIGMgPSBiLnJlZjtpZiAobnVsbCA9PT0gYSAmJiBudWxsICE9PSBjIHx8IG51bGwgIT09IGEgJiYgYS5yZWYgIT09IGMpIGIuZmxhZ3MgfD0gNTEyLCBiLmZsYWdzIHw9IDIwOTcxNTI7fWZ1bmN0aW9uIGRqKGEsIGIsIGMsIGQsIGUpIHt2YXIgZiA9IFpmKGMpID8gWGYgOiBILmN1cnJlbnQ7ZiA9IFlmKGIsIGYpO1RnKGIsIGUpO2MgPSBYaChhLCBiLCBjLCBkLCBmLCBlKTtkID0gYmkoKTtpZiAobnVsbCAhPT0gYSAmJiAhVWcpIHJldHVybiBiLnVwZGF0ZVF1ZXVlID0gYS51cGRhdGVRdWV1ZSwgYi5mbGFncyAmPSAtMjA1MywgYS5sYW5lcyAmPSB+ZSwgJGkoYSwgYiwgZSk7SSAmJiBkICYmIHZnKGIpO2IuZmxhZ3MgfD0gMTtZaShhLCBiLCBjLCBlKTtyZXR1cm4gYi5jaGlsZDt9CiAgICAgICAgICBmdW5jdGlvbiBpaihhLCBiLCBjLCBkLCBlKSB7aWYgKFpmKGMpKSB7dmFyIGYgPSAhMDtjZyhiKTt9IGVsc2UgZiA9ICExO1RnKGIsIGUpO2lmIChudWxsID09PSBiLnN0YXRlTm9kZSkgamooYSwgYiksIHBoKGIsIGMsIGQpLCByaChiLCBjLCBkLCBlKSwgZCA9ICEwO2Vsc2UgaWYgKG51bGwgPT09IGEpIHt2YXIgZyA9IGIuc3RhdGVOb2RlLGggPSBiLm1lbW9pemVkUHJvcHM7Zy5wcm9wcyA9IGg7dmFyIGsgPSBnLmNvbnRleHQsbCA9IGMuY29udGV4dFR5cGU7Im9iamVjdCIgPT09IHR5cGVvZiBsICYmIG51bGwgIT09IGwgPyBsID0gVmcobCkgOiAobCA9IFpmKGMpID8gWGYgOiBILmN1cnJlbnQsIGwgPSBZZihiLCBsKSk7dmFyIG0gPSBjLmdldERlcml2ZWRTdGF0ZUZyb21Qcm9wcyxxID0gImZ1bmN0aW9uIiA9PT0gdHlwZW9mIG0gfHwgImZ1bmN0aW9uIiA9PT0gdHlwZW9mIGcuZ2V0U25hcHNob3RCZWZvcmVVcGRhdGU7cSB8fCAiZnVuY3Rpb24iICE9PSB0eXBlb2YgZy5VTlNBRkVfY29tcG9uZW50V2lsbFJlY2VpdmVQcm9wcyAmJiAiZnVuY3Rpb24iICE9PSB0eXBlb2YgZy5jb21wb25lbnRXaWxsUmVjZWl2ZVByb3BzIHx8CiAgICAgICAgICAgICAgKGggIT09IGQgfHwgayAhPT0gbCkgJiYgcWgoYiwgZywgZCwgbCk7JGcgPSAhMTt2YXIgciA9IGIubWVtb2l6ZWRTdGF0ZTtnLnN0YXRlID0gcjtnaChiLCBkLCBnLCBlKTtrID0gYi5tZW1vaXplZFN0YXRlO2ggIT09IGQgfHwgciAhPT0gayB8fCBXZi5jdXJyZW50IHx8ICRnID8gKCJmdW5jdGlvbiIgPT09IHR5cGVvZiBtICYmIChraChiLCBjLCBtLCBkKSwgayA9IGIubWVtb2l6ZWRTdGF0ZSksIChoID0gJGcgfHwgb2goYiwgYywgaCwgZCwgciwgaywgbCkpID8gKHEgfHwgImZ1bmN0aW9uIiAhPT0gdHlwZW9mIGcuVU5TQUZFX2NvbXBvbmVudFdpbGxNb3VudCAmJiAiZnVuY3Rpb24iICE9PSB0eXBlb2YgZy5jb21wb25lbnRXaWxsTW91bnQgfHwgKCJmdW5jdGlvbiIgPT09IHR5cGVvZiBnLmNvbXBvbmVudFdpbGxNb3VudCAmJiBnLmNvbXBvbmVudFdpbGxNb3VudCgpLCAiZnVuY3Rpb24iID09PSB0eXBlb2YgZy5VTlNBRkVfY29tcG9uZW50V2lsbE1vdW50ICYmIGcuVU5TQUZFX2NvbXBvbmVudFdpbGxNb3VudCgpKSwgImZ1bmN0aW9uIiA9PT0gdHlwZW9mIGcuY29tcG9uZW50RGlkTW91bnQgJiYgKGIuZmxhZ3MgfD0gNDE5NDMwOCkpIDogKAogICAgICAgICAgICAgICJmdW5jdGlvbiIgPT09IHR5cGVvZiBnLmNvbXBvbmVudERpZE1vdW50ICYmIChiLmZsYWdzIHw9IDQxOTQzMDgpLCBiLm1lbW9pemVkUHJvcHMgPSBkLCBiLm1lbW9pemVkU3RhdGUgPSBrKSwgZy5wcm9wcyA9IGQsIGcuc3RhdGUgPSBrLCBnLmNvbnRleHQgPSBsLCBkID0gaCkgOiAoImZ1bmN0aW9uIiA9PT0gdHlwZW9mIGcuY29tcG9uZW50RGlkTW91bnQgJiYgKGIuZmxhZ3MgfD0gNDE5NDMwOCksIGQgPSAhMSk7fSBlbHNlIHtnID0gYi5zdGF0ZU5vZGU7YmgoYSwgYik7aCA9IGIubWVtb2l6ZWRQcm9wcztsID0gYi50eXBlID09PSBiLmVsZW1lbnRUeXBlID8gaCA6IExnKGIudHlwZSwgaCk7Zy5wcm9wcyA9IGw7cSA9IGIucGVuZGluZ1Byb3BzO3IgPSBnLmNvbnRleHQ7ayA9IGMuY29udGV4dFR5cGU7Im9iamVjdCIgPT09IHR5cGVvZiBrICYmIG51bGwgIT09IGsgPyBrID0gVmcoaykgOiAoayA9IFpmKGMpID8gWGYgOiBILmN1cnJlbnQsIGsgPSBZZihiLCBrKSk7dmFyIHkgPSBjLmdldERlcml2ZWRTdGF0ZUZyb21Qcm9wczsobSA9ICJmdW5jdGlvbiIgPT09IHR5cGVvZiB5IHx8ICJmdW5jdGlvbiIgPT09IHR5cGVvZiBnLmdldFNuYXBzaG90QmVmb3JlVXBkYXRlKSB8fAogICAgICAgICAgICAgICJmdW5jdGlvbiIgIT09IHR5cGVvZiBnLlVOU0FGRV9jb21wb25lbnRXaWxsUmVjZWl2ZVByb3BzICYmICJmdW5jdGlvbiIgIT09IHR5cGVvZiBnLmNvbXBvbmVudFdpbGxSZWNlaXZlUHJvcHMgfHwgKGggIT09IHEgfHwgciAhPT0gaykgJiYgcWgoYiwgZywgZCwgayk7JGcgPSAhMTtyID0gYi5tZW1vaXplZFN0YXRlO2cuc3RhdGUgPSByO2doKGIsIGQsIGcsIGUpO3ZhciBuID0gYi5tZW1vaXplZFN0YXRlO2ggIT09IHEgfHwgciAhPT0gbiB8fCBXZi5jdXJyZW50IHx8ICRnID8gKCJmdW5jdGlvbiIgPT09IHR5cGVvZiB5ICYmIChraChiLCBjLCB5LCBkKSwgbiA9IGIubWVtb2l6ZWRTdGF0ZSksIChsID0gJGcgfHwgb2goYiwgYywgbCwgZCwgciwgbiwgaykgfHwgITEpID8gKG0gfHwgImZ1bmN0aW9uIiAhPT0gdHlwZW9mIGcuVU5TQUZFX2NvbXBvbmVudFdpbGxVcGRhdGUgJiYgImZ1bmN0aW9uIiAhPT0gdHlwZW9mIGcuY29tcG9uZW50V2lsbFVwZGF0ZSB8fCAoImZ1bmN0aW9uIiA9PT0gdHlwZW9mIGcuY29tcG9uZW50V2lsbFVwZGF0ZSAmJiBnLmNvbXBvbmVudFdpbGxVcGRhdGUoZCwgbiwgayksICJmdW5jdGlvbiIgPT09IHR5cGVvZiBnLlVOU0FGRV9jb21wb25lbnRXaWxsVXBkYXRlICYmCiAgICAgICAgICAgICAgZy5VTlNBRkVfY29tcG9uZW50V2lsbFVwZGF0ZShkLCBuLCBrKSksICJmdW5jdGlvbiIgPT09IHR5cGVvZiBnLmNvbXBvbmVudERpZFVwZGF0ZSAmJiAoYi5mbGFncyB8PSA0KSwgImZ1bmN0aW9uIiA9PT0gdHlwZW9mIGcuZ2V0U25hcHNob3RCZWZvcmVVcGRhdGUgJiYgKGIuZmxhZ3MgfD0gMTAyNCkpIDogKCJmdW5jdGlvbiIgIT09IHR5cGVvZiBnLmNvbXBvbmVudERpZFVwZGF0ZSB8fCBoID09PSBhLm1lbW9pemVkUHJvcHMgJiYgciA9PT0gYS5tZW1vaXplZFN0YXRlIHx8IChiLmZsYWdzIHw9IDQpLCAiZnVuY3Rpb24iICE9PSB0eXBlb2YgZy5nZXRTbmFwc2hvdEJlZm9yZVVwZGF0ZSB8fCBoID09PSBhLm1lbW9pemVkUHJvcHMgJiYgciA9PT0gYS5tZW1vaXplZFN0YXRlIHx8IChiLmZsYWdzIHw9IDEwMjQpLCBiLm1lbW9pemVkUHJvcHMgPSBkLCBiLm1lbW9pemVkU3RhdGUgPSBuKSwgZy5wcm9wcyA9IGQsIGcuc3RhdGUgPSBuLCBnLmNvbnRleHQgPSBrLCBkID0gbCkgOiAoImZ1bmN0aW9uIiAhPT0gdHlwZW9mIGcuY29tcG9uZW50RGlkVXBkYXRlIHx8IGggPT09IGEubWVtb2l6ZWRQcm9wcyAmJiByID09PQogICAgICAgICAgICAgIGEubWVtb2l6ZWRTdGF0ZSB8fCAoYi5mbGFncyB8PSA0KSwgImZ1bmN0aW9uIiAhPT0gdHlwZW9mIGcuZ2V0U25hcHNob3RCZWZvcmVVcGRhdGUgfHwgaCA9PT0gYS5tZW1vaXplZFByb3BzICYmIHIgPT09IGEubWVtb2l6ZWRTdGF0ZSB8fCAoYi5mbGFncyB8PSAxMDI0KSwgZCA9ICExKTt9cmV0dXJuIGtqKGEsIGIsIGMsIGQsIGYsIGUpO30KICAgICAgICAgIGZ1bmN0aW9uIGtqKGEsIGIsIGMsIGQsIGUsIGYpIHtoaihhLCBiKTt2YXIgZyA9IDAgIT09IChiLmZsYWdzICYgMTI4KTtpZiAoIWQgJiYgIWcpIHJldHVybiBlICYmIGRnKGIsIGMsICExKSwgJGkoYSwgYiwgZik7ZCA9IGIuc3RhdGVOb2RlO1hpLmN1cnJlbnQgPSBiO3ZhciBoID0gZyAmJiAiZnVuY3Rpb24iICE9PSB0eXBlb2YgYy5nZXREZXJpdmVkU3RhdGVGcm9tRXJyb3IgPyBudWxsIDogZC5yZW5kZXIoKTtiLmZsYWdzIHw9IDE7bnVsbCAhPT0gYSAmJiBnID8gKGIuY2hpbGQgPSBCaChiLCBhLmNoaWxkLCBudWxsLCBmKSwgYi5jaGlsZCA9IEJoKGIsIG51bGwsIGgsIGYpKSA6IFlpKGEsIGIsIGgsIGYpO2IubWVtb2l6ZWRTdGF0ZSA9IGQuc3RhdGU7ZSAmJiBkZyhiLCBjLCAhMCk7cmV0dXJuIGIuY2hpbGQ7fWZ1bmN0aW9uIGxqKGEpIHt2YXIgYiA9IGEuc3RhdGVOb2RlO2IucGVuZGluZ0NvbnRleHQgPyBhZyhhLCBiLnBlbmRpbmdDb250ZXh0LCBiLnBlbmRpbmdDb250ZXh0ICE9PSBiLmNvbnRleHQpIDogYi5jb250ZXh0ICYmIGFnKGEsIGIuY29udGV4dCwgITEpO0loKGEsIGIuY29udGFpbmVySW5mbyk7fQogICAgICAgICAgZnVuY3Rpb24gbWooYSwgYiwgYywgZCwgZSkge0lnKCk7SmcoZSk7Yi5mbGFncyB8PSAyNTY7WWkoYSwgYiwgYywgZCk7cmV0dXJuIGIuY2hpbGQ7fXZhciBuaiA9IHsgZGVoeWRyYXRlZDogbnVsbCwgdHJlZUNvbnRleHQ6IG51bGwsIHJldHJ5TGFuZTogMCB9O2Z1bmN0aW9uIG9qKGEpIHtyZXR1cm4geyBiYXNlTGFuZXM6IGEsIGNhY2hlUG9vbDogbnVsbCwgdHJhbnNpdGlvbnM6IG51bGwgfTt9CiAgICAgICAgICBmdW5jdGlvbiBwaihhLCBiLCBjKSB7dmFyIGQgPSBiLnBlbmRpbmdQcm9wcyxlID0gTS5jdXJyZW50LGYgPSAhMSxnID0gMCAhPT0gKGIuZmxhZ3MgJiAxMjgpLGg7KGggPSBnKSB8fCAoaCA9IG51bGwgIT09IGEgJiYgbnVsbCA9PT0gYS5tZW1vaXplZFN0YXRlID8gITEgOiAwICE9PSAoZSAmIDIpKTtpZiAoaCkgZiA9ICEwLCBiLmZsYWdzICY9IC0xMjk7ZWxzZSBpZiAobnVsbCA9PT0gYSB8fCBudWxsICE9PSBhLm1lbW9pemVkU3RhdGUpIGUgfD0gMTtHKE0sIGUgJiAxKTtpZiAobnVsbCA9PT0gYSkge0VnKGIpO2EgPSBiLm1lbW9pemVkU3RhdGU7aWYgKG51bGwgIT09IGEgJiYgKGEgPSBhLmRlaHlkcmF0ZWQsIG51bGwgIT09IGEpKSByZXR1cm4gMCA9PT0gKGIubW9kZSAmIDEpID8gYi5sYW5lcyA9IDEgOiAiJCEiID09PSBhLmRhdGEgPyBiLmxhbmVzID0gOCA6IGIubGFuZXMgPSAxMDczNzQxODI0LCBudWxsO2cgPSBkLmNoaWxkcmVuO2EgPSBkLmZhbGxiYWNrO3JldHVybiBmID8gKGQgPSBiLm1vZGUsIGYgPSBiLmNoaWxkLCBnID0geyBtb2RlOiAiaGlkZGVuIiwgY2hpbGRyZW46IGcgfSwgMCA9PT0gKGQgJiAxKSAmJiBudWxsICE9PSBmID8gKGYuY2hpbGRMYW5lcyA9IDAsIGYucGVuZGluZ1Byb3BzID0KICAgICAgICAgICAgICBnKSA6IGYgPSBxaihnLCBkLCAwLCBudWxsKSwgYSA9IEFoKGEsIGQsIGMsIG51bGwpLCBmLnJldHVybiA9IGIsIGEucmV0dXJuID0gYiwgZi5zaWJsaW5nID0gYSwgYi5jaGlsZCA9IGYsIGIuY2hpbGQubWVtb2l6ZWRTdGF0ZSA9IG9qKGMpLCBiLm1lbW9pemVkU3RhdGUgPSBuaiwgYSkgOiByaihiLCBnKTt9ZSA9IGEubWVtb2l6ZWRTdGF0ZTtpZiAobnVsbCAhPT0gZSAmJiAoaCA9IGUuZGVoeWRyYXRlZCwgbnVsbCAhPT0gaCkpIHJldHVybiBzaihhLCBiLCBnLCBkLCBoLCBlLCBjKTtpZiAoZikge2YgPSBkLmZhbGxiYWNrO2cgPSBiLm1vZGU7ZSA9IGEuY2hpbGQ7aCA9IGUuc2libGluZzt2YXIgayA9IHsgbW9kZTogImhpZGRlbiIsIGNoaWxkcmVuOiBkLmNoaWxkcmVuIH07MCA9PT0gKGcgJiAxKSAmJiBiLmNoaWxkICE9PSBlID8gKGQgPSBiLmNoaWxkLCBkLmNoaWxkTGFuZXMgPSAwLCBkLnBlbmRpbmdQcm9wcyA9IGssIGIuZGVsZXRpb25zID0gbnVsbCkgOiAoZCA9IHdoKGUsIGspLCBkLnN1YnRyZWVGbGFncyA9IGUuc3VidHJlZUZsYWdzICYgMTQ2ODAwNjQpO251bGwgIT09IGggPyBmID0gd2goaCwgZikgOiAoZiA9IEFoKGYsIGcsIGMsIG51bGwpLCBmLmZsYWdzIHw9IDIpO2YucmV0dXJuID0KICAgICAgICAgICAgICBiO2QucmV0dXJuID0gYjtkLnNpYmxpbmcgPSBmO2IuY2hpbGQgPSBkO2QgPSBmO2YgPSBiLmNoaWxkO2cgPSBhLmNoaWxkLm1lbW9pemVkU3RhdGU7ZyA9IG51bGwgPT09IGcgPyBvaihjKSA6IHsgYmFzZUxhbmVzOiBnLmJhc2VMYW5lcyB8IGMsIGNhY2hlUG9vbDogbnVsbCwgdHJhbnNpdGlvbnM6IGcudHJhbnNpdGlvbnMgfTtmLm1lbW9pemVkU3RhdGUgPSBnO2YuY2hpbGRMYW5lcyA9IGEuY2hpbGRMYW5lcyAmIH5jO2IubWVtb2l6ZWRTdGF0ZSA9IG5qO3JldHVybiBkO31mID0gYS5jaGlsZDthID0gZi5zaWJsaW5nO2QgPSB3aChmLCB7IG1vZGU6ICJ2aXNpYmxlIiwgY2hpbGRyZW46IGQuY2hpbGRyZW4gfSk7MCA9PT0gKGIubW9kZSAmIDEpICYmIChkLmxhbmVzID0gYyk7ZC5yZXR1cm4gPSBiO2Quc2libGluZyA9IG51bGw7bnVsbCAhPT0gYSAmJiAoYyA9IGIuZGVsZXRpb25zLCBudWxsID09PSBjID8gKGIuZGVsZXRpb25zID0gW2FdLCBiLmZsYWdzIHw9IDE2KSA6IGMucHVzaChhKSk7Yi5jaGlsZCA9IGQ7Yi5tZW1vaXplZFN0YXRlID0gbnVsbDtyZXR1cm4gZDt9CiAgICAgICAgICBmdW5jdGlvbiByaihhLCBiKSB7YiA9IHFqKHsgbW9kZTogInZpc2libGUiLCBjaGlsZHJlbjogYiB9LCBhLm1vZGUsIDAsIG51bGwpO2IucmV0dXJuID0gYTtyZXR1cm4gYS5jaGlsZCA9IGI7fWZ1bmN0aW9uIHRqKGEsIGIsIGMsIGQpIHtudWxsICE9PSBkICYmIEpnKGQpO0JoKGIsIGEuY2hpbGQsIG51bGwsIGMpO2EgPSByaihiLCBiLnBlbmRpbmdQcm9wcy5jaGlsZHJlbik7YS5mbGFncyB8PSAyO2IubWVtb2l6ZWRTdGF0ZSA9IG51bGw7cmV0dXJuIGE7fQogICAgICAgICAgZnVuY3Rpb24gc2ooYSwgYiwgYywgZCwgZSwgZiwgZykge2lmIChjKSB7aWYgKGIuZmxhZ3MgJiAyNTYpIHJldHVybiBiLmZsYWdzICY9IC0yNTcsIGQgPSBMaShFcnJvcihwKDQyMikpKSwgdGooYSwgYiwgZywgZCk7aWYgKG51bGwgIT09IGIubWVtb2l6ZWRTdGF0ZSkgcmV0dXJuIGIuY2hpbGQgPSBhLmNoaWxkLCBiLmZsYWdzIHw9IDEyOCwgbnVsbDtmID0gZC5mYWxsYmFjaztlID0gYi5tb2RlO2QgPSBxaih7IG1vZGU6ICJ2aXNpYmxlIiwgY2hpbGRyZW46IGQuY2hpbGRyZW4gfSwgZSwgMCwgbnVsbCk7ZiA9IEFoKGYsIGUsIGcsIG51bGwpO2YuZmxhZ3MgfD0gMjtkLnJldHVybiA9IGI7Zi5yZXR1cm4gPSBiO2Quc2libGluZyA9IGY7Yi5jaGlsZCA9IGQ7MCAhPT0gKGIubW9kZSAmIDEpICYmIEJoKGIsIGEuY2hpbGQsIG51bGwsIGcpO2IuY2hpbGQubWVtb2l6ZWRTdGF0ZSA9IG9qKGcpO2IubWVtb2l6ZWRTdGF0ZSA9IG5qO3JldHVybiBmO31pZiAoMCA9PT0gKGIubW9kZSAmIDEpKSByZXR1cm4gdGooYSwgYiwgZywgbnVsbCk7aWYgKCIkISIgPT09IGUuZGF0YSkge2QgPSBlLm5leHRTaWJsaW5nICYmIGUubmV4dFNpYmxpbmcuZGF0YXNldDsKICAgICAgICAgICAgICBpZiAoZCkgdmFyIGggPSBkLmRnc3Q7ZCA9IGg7ZiA9IEVycm9yKHAoNDE5KSk7ZCA9IExpKGYsIGQsIHZvaWQgMCk7cmV0dXJuIHRqKGEsIGIsIGcsIGQpO31oID0gMCAhPT0gKGcgJiBhLmNoaWxkTGFuZXMpO2lmIChVZyB8fCBoKSB7ZCA9IFI7aWYgKG51bGwgIT09IGQpIHtzd2l0Y2ggKGcgJiAtZykge2Nhc2UgNDplID0gMjticmVhaztjYXNlIDE2OmUgPSA4O2JyZWFrO2Nhc2UgNjQ6Y2FzZSAxMjg6Y2FzZSAyNTY6Y2FzZSA1MTI6Y2FzZSAxMDI0OmNhc2UgMjA0ODpjYXNlIDQwOTY6Y2FzZSA4MTkyOmNhc2UgMTYzODQ6Y2FzZSAzMjc2ODpjYXNlIDY1NTM2OmNhc2UgMTMxMDcyOmNhc2UgMjYyMTQ0OmNhc2UgNTI0Mjg4OmNhc2UgMTA0ODU3NjpjYXNlIDIwOTcxNTI6Y2FzZSA0MTk0MzA0OmNhc2UgODM4ODYwODpjYXNlIDE2Nzc3MjE2OmNhc2UgMzM1NTQ0MzI6Y2FzZSA2NzEwODg2NDplID0gMzI7YnJlYWs7Y2FzZSA1MzY4NzA5MTI6ZSA9IDI2ODQzNTQ1NjticmVhaztkZWZhdWx0OmUgPSAwO31lID0gMCAhPT0gKGUgJiAoZC5zdXNwZW5kZWRMYW5lcyB8IGcpKSA/IDAgOiBlOwogICAgICAgICAgICAgICAgMCAhPT0gZSAmJiBlICE9PSBmLnJldHJ5TGFuZSAmJiAoZi5yZXRyeUxhbmUgPSBlLCBaZyhhLCBlKSwgbWgoZCwgYSwgZSwgLTEpKTt9dWooKTtkID0gTGkoRXJyb3IocCg0MjEpKSk7cmV0dXJuIHRqKGEsIGIsIGcsIGQpO31pZiAoIiQ/IiA9PT0gZS5kYXRhKSByZXR1cm4gYi5mbGFncyB8PSAxMjgsIGIuY2hpbGQgPSBhLmNoaWxkLCBiID0gdmouYmluZChudWxsLCBhKSwgZS5fcmVhY3RSZXRyeSA9IGIsIG51bGw7YSA9IGYudHJlZUNvbnRleHQ7eWcgPSBMZihlLm5leHRTaWJsaW5nKTt4ZyA9IGI7SSA9ICEwO3pnID0gbnVsbDtudWxsICE9PSBhICYmIChvZ1twZysrXSA9IHJnLCBvZ1twZysrXSA9IHNnLCBvZ1twZysrXSA9IHFnLCByZyA9IGEuaWQsIHNnID0gYS5vdmVyZmxvdywgcWcgPSBiKTtiID0gcmooYiwgZC5jaGlsZHJlbik7Yi5mbGFncyB8PSA0MDk2O3JldHVybiBiO31mdW5jdGlvbiB3aihhLCBiLCBjKSB7YS5sYW5lcyB8PSBiO3ZhciBkID0gYS5hbHRlcm5hdGU7bnVsbCAhPT0gZCAmJiAoZC5sYW5lcyB8PSBiKTtTZyhhLnJldHVybiwgYiwgYyk7fQogICAgICAgICAgZnVuY3Rpb24geGooYSwgYiwgYywgZCwgZSkge3ZhciBmID0gYS5tZW1vaXplZFN0YXRlO251bGwgPT09IGYgPyBhLm1lbW9pemVkU3RhdGUgPSB7IGlzQmFja3dhcmRzOiBiLCByZW5kZXJpbmc6IG51bGwsIHJlbmRlcmluZ1N0YXJ0VGltZTogMCwgbGFzdDogZCwgdGFpbDogYywgdGFpbE1vZGU6IGUgfSA6IChmLmlzQmFja3dhcmRzID0gYiwgZi5yZW5kZXJpbmcgPSBudWxsLCBmLnJlbmRlcmluZ1N0YXJ0VGltZSA9IDAsIGYubGFzdCA9IGQsIGYudGFpbCA9IGMsIGYudGFpbE1vZGUgPSBlKTt9CiAgICAgICAgICBmdW5jdGlvbiB5aihhLCBiLCBjKSB7dmFyIGQgPSBiLnBlbmRpbmdQcm9wcyxlID0gZC5yZXZlYWxPcmRlcixmID0gZC50YWlsO1lpKGEsIGIsIGQuY2hpbGRyZW4sIGMpO2QgPSBNLmN1cnJlbnQ7aWYgKDAgIT09IChkICYgMikpIGQgPSBkICYgMSB8IDIsIGIuZmxhZ3MgfD0gMTI4O2Vsc2Uge2lmIChudWxsICE9PSBhICYmIDAgIT09IChhLmZsYWdzICYgMTI4KSkgYTogZm9yIChhID0gYi5jaGlsZDsgbnVsbCAhPT0gYTspIHtpZiAoMTMgPT09IGEudGFnKSBudWxsICE9PSBhLm1lbW9pemVkU3RhdGUgJiYgd2ooYSwgYywgYik7ZWxzZSBpZiAoMTkgPT09IGEudGFnKSB3aihhLCBjLCBiKTtlbHNlIGlmIChudWxsICE9PSBhLmNoaWxkKSB7YS5jaGlsZC5yZXR1cm4gPSBhO2EgPSBhLmNoaWxkO2NvbnRpbnVlO31pZiAoYSA9PT0gYikgYnJlYWsgYTtmb3IgKDsgbnVsbCA9PT0gYS5zaWJsaW5nOykge2lmIChudWxsID09PSBhLnJldHVybiB8fCBhLnJldHVybiA9PT0gYikgYnJlYWsgYTthID0gYS5yZXR1cm47fWEuc2libGluZy5yZXR1cm4gPSBhLnJldHVybjthID0gYS5zaWJsaW5nO31kICY9IDE7fUcoTSwgZCk7aWYgKDAgPT09IChiLm1vZGUgJiAxKSkgYi5tZW1vaXplZFN0YXRlID0KICAgICAgICAgICAgbnVsbDtlbHNlIHN3aXRjaCAoZSkge2Nhc2UgImZvcndhcmRzIjpjID0gYi5jaGlsZDtmb3IgKGUgPSBudWxsOyBudWxsICE9PSBjOykgYSA9IGMuYWx0ZXJuYXRlLCBudWxsICE9PSBhICYmIG51bGwgPT09IE1oKGEpICYmIChlID0gYyksIGMgPSBjLnNpYmxpbmc7YyA9IGU7bnVsbCA9PT0gYyA/IChlID0gYi5jaGlsZCwgYi5jaGlsZCA9IG51bGwpIDogKGUgPSBjLnNpYmxpbmcsIGMuc2libGluZyA9IG51bGwpO3hqKGIsICExLCBlLCBjLCBmKTticmVhaztjYXNlICJiYWNrd2FyZHMiOmMgPSBudWxsO2UgPSBiLmNoaWxkO2ZvciAoYi5jaGlsZCA9IG51bGw7IG51bGwgIT09IGU7KSB7YSA9IGUuYWx0ZXJuYXRlO2lmIChudWxsICE9PSBhICYmIG51bGwgPT09IE1oKGEpKSB7Yi5jaGlsZCA9IGU7YnJlYWs7fWEgPSBlLnNpYmxpbmc7ZS5zaWJsaW5nID0gYztjID0gZTtlID0gYTt9eGooYiwgITAsIGMsIG51bGwsIGYpO2JyZWFrO2Nhc2UgInRvZ2V0aGVyIjp4aihiLCAhMSwgbnVsbCwgbnVsbCwgdm9pZCAwKTticmVhaztkZWZhdWx0OmIubWVtb2l6ZWRTdGF0ZSA9IG51bGw7fXJldHVybiBiLmNoaWxkO30KICAgICAgICAgIGZ1bmN0aW9uIGpqKGEsIGIpIHswID09PSAoYi5tb2RlICYgMSkgJiYgbnVsbCAhPT0gYSAmJiAoYS5hbHRlcm5hdGUgPSBudWxsLCBiLmFsdGVybmF0ZSA9IG51bGwsIGIuZmxhZ3MgfD0gMik7fWZ1bmN0aW9uICRpKGEsIGIsIGMpIHtudWxsICE9PSBhICYmIChiLmRlcGVuZGVuY2llcyA9IGEuZGVwZW5kZW5jaWVzKTtoaCB8PSBiLmxhbmVzO2lmICgwID09PSAoYyAmIGIuY2hpbGRMYW5lcykpIHJldHVybiBudWxsO2lmIChudWxsICE9PSBhICYmIGIuY2hpbGQgIT09IGEuY2hpbGQpIHRocm93IEVycm9yKHAoMTUzKSk7aWYgKG51bGwgIT09IGIuY2hpbGQpIHthID0gYi5jaGlsZDtjID0gd2goYSwgYS5wZW5kaW5nUHJvcHMpO2IuY2hpbGQgPSBjO2ZvciAoYy5yZXR1cm4gPSBiOyBudWxsICE9PSBhLnNpYmxpbmc7KSBhID0gYS5zaWJsaW5nLCBjID0gYy5zaWJsaW5nID0gd2goYSwgYS5wZW5kaW5nUHJvcHMpLCBjLnJldHVybiA9IGI7Yy5zaWJsaW5nID0gbnVsbDt9cmV0dXJuIGIuY2hpbGQ7fQogICAgICAgICAgZnVuY3Rpb24gemooYSwgYiwgYykge3N3aXRjaCAoYi50YWcpIHtjYXNlIDM6bGooYik7SWcoKTticmVhaztjYXNlIDU6S2goYik7YnJlYWs7Y2FzZSAxOlpmKGIudHlwZSkgJiYgY2coYik7YnJlYWs7Y2FzZSA0OkloKGIsIGIuc3RhdGVOb2RlLmNvbnRhaW5lckluZm8pO2JyZWFrO2Nhc2UgMTA6dmFyIGQgPSBiLnR5cGUuX2NvbnRleHQsZSA9IGIubWVtb2l6ZWRQcm9wcy52YWx1ZTtHKE1nLCBkLl9jdXJyZW50VmFsdWUpO2QuX2N1cnJlbnRWYWx1ZSA9IGU7YnJlYWs7Y2FzZSAxMzpkID0gYi5tZW1vaXplZFN0YXRlO2lmIChudWxsICE9PSBkKSB7aWYgKG51bGwgIT09IGQuZGVoeWRyYXRlZCkgcmV0dXJuIEcoTSwgTS5jdXJyZW50ICYgMSksIGIuZmxhZ3MgfD0gMTI4LCBudWxsO2lmICgwICE9PSAoYyAmIGIuY2hpbGQuY2hpbGRMYW5lcykpIHJldHVybiBwaihhLCBiLCBjKTtHKE0sIE0uY3VycmVudCAmIDEpO2EgPSAkaShhLCBiLCBjKTtyZXR1cm4gbnVsbCAhPT0gYSA/IGEuc2libGluZyA6IG51bGw7fUcoTSwgTS5jdXJyZW50ICYgMSk7YnJlYWs7Y2FzZSAxOTpkID0gMCAhPT0gKGMgJgogICAgICAgICAgICAgICAgYi5jaGlsZExhbmVzKTtpZiAoMCAhPT0gKGEuZmxhZ3MgJiAxMjgpKSB7aWYgKGQpIHJldHVybiB5aihhLCBiLCBjKTtiLmZsYWdzIHw9IDEyODt9ZSA9IGIubWVtb2l6ZWRTdGF0ZTtudWxsICE9PSBlICYmIChlLnJlbmRlcmluZyA9IG51bGwsIGUudGFpbCA9IG51bGwsIGUubGFzdEVmZmVjdCA9IG51bGwpO0coTSwgTS5jdXJyZW50KTtpZiAoZCkgYnJlYWs7ZWxzZSByZXR1cm4gbnVsbDtjYXNlIDIyOmNhc2UgMjM6cmV0dXJuIGIubGFuZXMgPSAwLCBlaihhLCBiLCBjKTt9cmV0dXJuICRpKGEsIGIsIGMpO312YXIgQWosIEJqLCBDaiwgRGo7CiAgICAgICAgICBBaiA9IGZ1bmN0aW9uIEFqKGEsIGIpIHtmb3IgKHZhciBjID0gYi5jaGlsZDsgbnVsbCAhPT0gYzspIHtpZiAoNSA9PT0gYy50YWcgfHwgNiA9PT0gYy50YWcpIGEuYXBwZW5kQ2hpbGQoYy5zdGF0ZU5vZGUpO2Vsc2UgaWYgKDQgIT09IGMudGFnICYmIG51bGwgIT09IGMuY2hpbGQpIHtjLmNoaWxkLnJldHVybiA9IGM7YyA9IGMuY2hpbGQ7Y29udGludWU7fWlmIChjID09PSBiKSBicmVhaztmb3IgKDsgbnVsbCA9PT0gYy5zaWJsaW5nOykge2lmIChudWxsID09PSBjLnJldHVybiB8fCBjLnJldHVybiA9PT0gYikgcmV0dXJuO2MgPSBjLnJldHVybjt9Yy5zaWJsaW5nLnJldHVybiA9IGMucmV0dXJuO2MgPSBjLnNpYmxpbmc7fX07QmogPSBmdW5jdGlvbiBCaigpIHt9OwogICAgICAgICAgQ2ogPSBmdW5jdGlvbiBDaihhLCBiLCBjLCBkKSB7dmFyIGUgPSBhLm1lbW9pemVkUHJvcHM7aWYgKGUgIT09IGQpIHthID0gYi5zdGF0ZU5vZGU7SGgoRWguY3VycmVudCk7dmFyIGYgPSBudWxsO3N3aXRjaCAoYykge2Nhc2UgImlucHV0IjplID0gWWEoYSwgZSk7ZCA9IFlhKGEsIGQpO2YgPSBbXTticmVhaztjYXNlICJzZWxlY3QiOmUgPSBBKHt9LCBlLCB7IHZhbHVlOiB2b2lkIDAgfSk7ZCA9IEEoe30sIGQsIHsgdmFsdWU6IHZvaWQgMCB9KTtmID0gW107YnJlYWs7Y2FzZSAidGV4dGFyZWEiOmUgPSBnYihhLCBlKTtkID0gZ2IoYSwgZCk7ZiA9IFtdO2JyZWFrO2RlZmF1bHQ6ImZ1bmN0aW9uIiAhPT0gdHlwZW9mIGUub25DbGljayAmJiAiZnVuY3Rpb24iID09PSB0eXBlb2YgZC5vbkNsaWNrICYmIChhLm9uY2xpY2sgPSBCZik7fXViKGMsIGQpO3ZhciBnO2MgPSBudWxsO2ZvciAobCBpbiBlKSBpZiAoIWQuaGFzT3duUHJvcGVydHkobCkgJiYgZS5oYXNPd25Qcm9wZXJ0eShsKSAmJiBudWxsICE9IGVbbF0pIGlmICgic3R5bGUiID09PSBsKSB7dmFyIGggPSBlW2xdO2ZvciAoZyBpbiBoKSBoLmhhc093blByb3BlcnR5KGcpICYmICgKICAgICAgICAgICAgICAgIGMgfHwgKGMgPSB7fSksIGNbZ10gPSAiIik7fSBlbHNlICJkYW5nZXJvdXNseVNldElubmVySFRNTCIgIT09IGwgJiYgImNoaWxkcmVuIiAhPT0gbCAmJiAic3VwcHJlc3NDb250ZW50RWRpdGFibGVXYXJuaW5nIiAhPT0gbCAmJiAic3VwcHJlc3NIeWRyYXRpb25XYXJuaW5nIiAhPT0gbCAmJiAiYXV0b0ZvY3VzIiAhPT0gbCAmJiAoZWEuaGFzT3duUHJvcGVydHkobCkgPyBmIHx8IChmID0gW10pIDogKGYgPSBmIHx8IFtdKS5wdXNoKGwsIG51bGwpKTtmb3IgKGwgaW4gZCkge3ZhciBrID0gZFtsXTtoID0gbnVsbCAhPSBlID8gZVtsXSA6IHZvaWQgMDtpZiAoZC5oYXNPd25Qcm9wZXJ0eShsKSAmJiBrICE9PSBoICYmIChudWxsICE9IGsgfHwgbnVsbCAhPSBoKSkgaWYgKCJzdHlsZSIgPT09IGwpIHtpZiAoaCkge2ZvciAoZyBpbiBoKSAhaC5oYXNPd25Qcm9wZXJ0eShnKSB8fCBrICYmIGsuaGFzT3duUHJvcGVydHkoZykgfHwgKGMgfHwgKGMgPSB7fSksIGNbZ10gPSAiIik7Zm9yIChnIGluIGspIGsuaGFzT3duUHJvcGVydHkoZykgJiYgaFtnXSAhPT0ga1tnXSAmJiAoYyB8fCAoYyA9IHt9KSwgY1tnXSA9IGtbZ10pO30gZWxzZSBjIHx8IChmIHx8IChmID0gW10pLCBmLnB1c2gobCwKICAgICAgICAgICAgICAgICAgYykpLCBjID0gazt9IGVsc2UgImRhbmdlcm91c2x5U2V0SW5uZXJIVE1MIiA9PT0gbCA/IChrID0gayA/IGsuX19odG1sIDogdm9pZCAwLCBoID0gaCA/IGguX19odG1sIDogdm9pZCAwLCBudWxsICE9IGsgJiYgaCAhPT0gayAmJiAoZiA9IGYgfHwgW10pLnB1c2gobCwgaykpIDogImNoaWxkcmVuIiA9PT0gbCA/ICJzdHJpbmciICE9PSB0eXBlb2YgayAmJiAibnVtYmVyIiAhPT0gdHlwZW9mIGsgfHwgKGYgPSBmIHx8IFtdKS5wdXNoKGwsICIiICsgaykgOiAic3VwcHJlc3NDb250ZW50RWRpdGFibGVXYXJuaW5nIiAhPT0gbCAmJiAic3VwcHJlc3NIeWRyYXRpb25XYXJuaW5nIiAhPT0gbCAmJiAoZWEuaGFzT3duUHJvcGVydHkobCkgPyAobnVsbCAhPSBrICYmICJvblNjcm9sbCIgPT09IGwgJiYgRCgic2Nyb2xsIiwgYSksIGYgfHwgaCA9PT0gayB8fCAoZiA9IFtdKSkgOiAoZiA9IGYgfHwgW10pLnB1c2gobCwgaykpO31jICYmIChmID0gZiB8fCBbXSkucHVzaCgic3R5bGUiLCBjKTt2YXIgbCA9IGY7aWYgKGIudXBkYXRlUXVldWUgPSBsKSBiLmZsYWdzIHw9IDQ7fX07RGogPSBmdW5jdGlvbiBEaihhLCBiLCBjLCBkKSB7YyAhPT0gZCAmJiAoYi5mbGFncyB8PSA0KTt9OwogICAgICAgICAgZnVuY3Rpb24gRWooYSwgYikge2lmICghSSkgc3dpdGNoIChhLnRhaWxNb2RlKSB7Y2FzZSAiaGlkZGVuIjpiID0gYS50YWlsO2ZvciAodmFyIGMgPSBudWxsOyBudWxsICE9PSBiOykgbnVsbCAhPT0gYi5hbHRlcm5hdGUgJiYgKGMgPSBiKSwgYiA9IGIuc2libGluZztudWxsID09PSBjID8gYS50YWlsID0gbnVsbCA6IGMuc2libGluZyA9IG51bGw7YnJlYWs7Y2FzZSAiY29sbGFwc2VkIjpjID0gYS50YWlsO2ZvciAodmFyIGQgPSBudWxsOyBudWxsICE9PSBjOykgbnVsbCAhPT0gYy5hbHRlcm5hdGUgJiYgKGQgPSBjKSwgYyA9IGMuc2libGluZztudWxsID09PSBkID8gYiB8fCBudWxsID09PSBhLnRhaWwgPyBhLnRhaWwgPSBudWxsIDogYS50YWlsLnNpYmxpbmcgPSBudWxsIDogZC5zaWJsaW5nID0gbnVsbDt9fQogICAgICAgICAgZnVuY3Rpb24gUyhhKSB7dmFyIGIgPSBudWxsICE9PSBhLmFsdGVybmF0ZSAmJiBhLmFsdGVybmF0ZS5jaGlsZCA9PT0gYS5jaGlsZCxjID0gMCxkID0gMDtpZiAoYikgZm9yICh2YXIgZSA9IGEuY2hpbGQ7IG51bGwgIT09IGU7KSBjIHw9IGUubGFuZXMgfCBlLmNoaWxkTGFuZXMsIGQgfD0gZS5zdWJ0cmVlRmxhZ3MgJiAxNDY4MDA2NCwgZCB8PSBlLmZsYWdzICYgMTQ2ODAwNjQsIGUucmV0dXJuID0gYSwgZSA9IGUuc2libGluZztlbHNlIGZvciAoZSA9IGEuY2hpbGQ7IG51bGwgIT09IGU7KSBjIHw9IGUubGFuZXMgfCBlLmNoaWxkTGFuZXMsIGQgfD0gZS5zdWJ0cmVlRmxhZ3MsIGQgfD0gZS5mbGFncywgZS5yZXR1cm4gPSBhLCBlID0gZS5zaWJsaW5nO2Euc3VidHJlZUZsYWdzIHw9IGQ7YS5jaGlsZExhbmVzID0gYztyZXR1cm4gYjt9CiAgICAgICAgICBmdW5jdGlvbiBGaihhLCBiLCBjKSB7dmFyIGQgPSBiLnBlbmRpbmdQcm9wczt3ZyhiKTtzd2l0Y2ggKGIudGFnKSB7Y2FzZSAyOmNhc2UgMTY6Y2FzZSAxNTpjYXNlIDA6Y2FzZSAxMTpjYXNlIDc6Y2FzZSA4OmNhc2UgMTI6Y2FzZSA5OmNhc2UgMTQ6cmV0dXJuIFMoYiksIG51bGw7Y2FzZSAxOnJldHVybiBaZihiLnR5cGUpICYmICRmKCksIFMoYiksIG51bGw7Y2FzZSAzOmQgPSBiLnN0YXRlTm9kZTtKaCgpO0UoV2YpO0UoSCk7T2goKTtkLnBlbmRpbmdDb250ZXh0ICYmIChkLmNvbnRleHQgPSBkLnBlbmRpbmdDb250ZXh0LCBkLnBlbmRpbmdDb250ZXh0ID0gbnVsbCk7aWYgKG51bGwgPT09IGEgfHwgbnVsbCA9PT0gYS5jaGlsZCkgR2coYikgPyBiLmZsYWdzIHw9IDQgOiBudWxsID09PSBhIHx8IGEubWVtb2l6ZWRTdGF0ZS5pc0RlaHlkcmF0ZWQgJiYgMCA9PT0gKGIuZmxhZ3MgJiAyNTYpIHx8IChiLmZsYWdzIHw9IDEwMjQsIG51bGwgIT09IHpnICYmIChHaih6ZyksIHpnID0gbnVsbCkpO0JqKGEsIGIpO1MoYik7cmV0dXJuIG51bGw7Y2FzZSA1OkxoKGIpO3ZhciBlID0gSGgoR2guY3VycmVudCk7CiAgICAgICAgICAgICAgICBjID0gYi50eXBlO2lmIChudWxsICE9PSBhICYmIG51bGwgIT0gYi5zdGF0ZU5vZGUpIENqKGEsIGIsIGMsIGQsIGUpLCBhLnJlZiAhPT0gYi5yZWYgJiYgKGIuZmxhZ3MgfD0gNTEyLCBiLmZsYWdzIHw9IDIwOTcxNTIpO2Vsc2Uge2lmICghZCkge2lmIChudWxsID09PSBiLnN0YXRlTm9kZSkgdGhyb3cgRXJyb3IocCgxNjYpKTtTKGIpO3JldHVybiBudWxsO31hID0gSGgoRWguY3VycmVudCk7aWYgKEdnKGIpKSB7ZCA9IGIuc3RhdGVOb2RlO2MgPSBiLnR5cGU7dmFyIGYgPSBiLm1lbW9pemVkUHJvcHM7ZFtPZl0gPSBiO2RbUGZdID0gZjthID0gMCAhPT0gKGIubW9kZSAmIDEpO3N3aXRjaCAoYykge2Nhc2UgImRpYWxvZyI6RCgiY2FuY2VsIiwgZCk7RCgiY2xvc2UiLCBkKTticmVhaztjYXNlICJpZnJhbWUiOmNhc2UgIm9iamVjdCI6Y2FzZSAiZW1iZWQiOkQoImxvYWQiLCBkKTticmVhaztjYXNlICJ2aWRlbyI6Y2FzZSAiYXVkaW8iOmZvciAoZSA9IDA7IGUgPCBsZi5sZW5ndGg7IGUrKykgRChsZltlXSwgZCk7YnJlYWs7Y2FzZSAic291cmNlIjpEKCJlcnJvciIsIGQpO2JyZWFrO2Nhc2UgImltZyI6Y2FzZSAiaW1hZ2UiOmNhc2UgImxpbmsiOkQoImVycm9yIiwKICAgICAgICAgICAgICAgICAgICAgICAgZCk7RCgibG9hZCIsIGQpO2JyZWFrO2Nhc2UgImRldGFpbHMiOkQoInRvZ2dsZSIsIGQpO2JyZWFrO2Nhc2UgImlucHV0IjpaYShkLCBmKTtEKCJpbnZhbGlkIiwgZCk7YnJlYWs7Y2FzZSAic2VsZWN0IjpkLl93cmFwcGVyU3RhdGUgPSB7IHdhc011bHRpcGxlOiAhIWYubXVsdGlwbGUgfTtEKCJpbnZhbGlkIiwgZCk7YnJlYWs7Y2FzZSAidGV4dGFyZWEiOmhiKGQsIGYpLCBEKCJpbnZhbGlkIiwgZCk7fXViKGMsIGYpO2UgPSBudWxsO2ZvciAodmFyIGcgaW4gZikgaWYgKGYuaGFzT3duUHJvcGVydHkoZykpIHt2YXIgaCA9IGZbZ107ImNoaWxkcmVuIiA9PT0gZyA/ICJzdHJpbmciID09PSB0eXBlb2YgaCA/IGQudGV4dENvbnRlbnQgIT09IGggJiYgKCEwICE9PSBmLnN1cHByZXNzSHlkcmF0aW9uV2FybmluZyAmJiBBZihkLnRleHRDb250ZW50LCBoLCBhKSwgZSA9IFsiY2hpbGRyZW4iLCBoXSkgOiAibnVtYmVyIiA9PT0gdHlwZW9mIGggJiYgZC50ZXh0Q29udGVudCAhPT0gIiIgKyBoICYmICghMCAhPT0gZi5zdXBwcmVzc0h5ZHJhdGlvbldhcm5pbmcgJiYgQWYoZC50ZXh0Q29udGVudCwKICAgICAgICAgICAgICAgICAgICAgIGgsIGEpLCBlID0gWyJjaGlsZHJlbiIsICIiICsgaF0pIDogZWEuaGFzT3duUHJvcGVydHkoZykgJiYgbnVsbCAhPSBoICYmICJvblNjcm9sbCIgPT09IGcgJiYgRCgic2Nyb2xsIiwgZCk7fXN3aXRjaCAoYykge2Nhc2UgImlucHV0IjpWYShkKTtkYihkLCBmLCAhMCk7YnJlYWs7Y2FzZSAidGV4dGFyZWEiOlZhKGQpO2piKGQpO2JyZWFrO2Nhc2UgInNlbGVjdCI6Y2FzZSAib3B0aW9uIjpicmVhaztkZWZhdWx0OiJmdW5jdGlvbiIgPT09IHR5cGVvZiBmLm9uQ2xpY2sgJiYgKGQub25jbGljayA9IEJmKTt9ZCA9IGU7Yi51cGRhdGVRdWV1ZSA9IGQ7bnVsbCAhPT0gZCAmJiAoYi5mbGFncyB8PSA0KTt9IGVsc2Uge2cgPSA5ID09PSBlLm5vZGVUeXBlID8gZSA6IGUub3duZXJEb2N1bWVudDsiaHR0cDovL3d3dy53My5vcmcvMTk5OS94aHRtbCIgPT09IGEgJiYgKGEgPSBrYihjKSk7Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGh0bWwiID09PSBhID8gInNjcmlwdCIgPT09IGMgPyAoYSA9IGcuY3JlYXRlRWxlbWVudCgiZGl2IiksIGEuaW5uZXJIVE1MID0gIjxzY3JpcHQ+XHgzYy9zY3JpcHQ+IiwgYSA9IGEucmVtb3ZlQ2hpbGQoYS5maXJzdENoaWxkKSkgOgogICAgICAgICAgICAgICAgICAgICJzdHJpbmciID09PSB0eXBlb2YgZC5pcyA/IGEgPSBnLmNyZWF0ZUVsZW1lbnQoYywgeyBpczogZC5pcyB9KSA6IChhID0gZy5jcmVhdGVFbGVtZW50KGMpLCAic2VsZWN0IiA9PT0gYyAmJiAoZyA9IGEsIGQubXVsdGlwbGUgPyBnLm11bHRpcGxlID0gITAgOiBkLnNpemUgJiYgKGcuc2l6ZSA9IGQuc2l6ZSkpKSA6IGEgPSBnLmNyZWF0ZUVsZW1lbnROUyhhLCBjKTthW09mXSA9IGI7YVtQZl0gPSBkO0FqKGEsIGIsICExLCAhMSk7Yi5zdGF0ZU5vZGUgPSBhO2E6IHtnID0gdmIoYywgZCk7c3dpdGNoIChjKSB7Y2FzZSAiZGlhbG9nIjpEKCJjYW5jZWwiLCBhKTtEKCJjbG9zZSIsIGEpO2UgPSBkO2JyZWFrO2Nhc2UgImlmcmFtZSI6Y2FzZSAib2JqZWN0IjpjYXNlICJlbWJlZCI6RCgibG9hZCIsIGEpO2UgPSBkO2JyZWFrO2Nhc2UgInZpZGVvIjpjYXNlICJhdWRpbyI6Zm9yIChlID0gMDsgZSA8IGxmLmxlbmd0aDsgZSsrKSBEKGxmW2VdLCBhKTtlID0gZDticmVhaztjYXNlICJzb3VyY2UiOkQoImVycm9yIiwgYSk7ZSA9IGQ7YnJlYWs7Y2FzZSAiaW1nIjpjYXNlICJpbWFnZSI6Y2FzZSAibGluayI6RCgiZXJyb3IiLAogICAgICAgICAgICAgICAgICAgICAgICAgIGEpO0QoImxvYWQiLCBhKTtlID0gZDticmVhaztjYXNlICJkZXRhaWxzIjpEKCJ0b2dnbGUiLCBhKTtlID0gZDticmVhaztjYXNlICJpbnB1dCI6WmEoYSwgZCk7ZSA9IFlhKGEsIGQpO0QoImludmFsaWQiLCBhKTticmVhaztjYXNlICJvcHRpb24iOmUgPSBkO2JyZWFrO2Nhc2UgInNlbGVjdCI6YS5fd3JhcHBlclN0YXRlID0geyB3YXNNdWx0aXBsZTogISFkLm11bHRpcGxlIH07ZSA9IEEoe30sIGQsIHsgdmFsdWU6IHZvaWQgMCB9KTtEKCJpbnZhbGlkIiwgYSk7YnJlYWs7Y2FzZSAidGV4dGFyZWEiOmhiKGEsIGQpO2UgPSBnYihhLCBkKTtEKCJpbnZhbGlkIiwgYSk7YnJlYWs7ZGVmYXVsdDplID0gZDt9dWIoYywgZSk7aCA9IGU7Zm9yIChmIGluIGgpIGlmIChoLmhhc093blByb3BlcnR5KGYpKSB7dmFyIGsgPSBoW2ZdOyJzdHlsZSIgPT09IGYgPyBzYihhLCBrKSA6ICJkYW5nZXJvdXNseVNldElubmVySFRNTCIgPT09IGYgPyAoayA9IGsgPyBrLl9faHRtbCA6IHZvaWQgMCwgbnVsbCAhPSBrICYmIG5iKGEsIGspKSA6ICJjaGlsZHJlbiIgPT09IGYgPyAic3RyaW5nIiA9PT0gdHlwZW9mIGsgPyAoInRleHRhcmVhIiAhPT0KICAgICAgICAgICAgICAgICAgICAgICAgYyB8fCAiIiAhPT0gaykgJiYgb2IoYSwgaykgOiAibnVtYmVyIiA9PT0gdHlwZW9mIGsgJiYgb2IoYSwgIiIgKyBrKSA6ICJzdXBwcmVzc0NvbnRlbnRFZGl0YWJsZVdhcm5pbmciICE9PSBmICYmICJzdXBwcmVzc0h5ZHJhdGlvbldhcm5pbmciICE9PSBmICYmICJhdXRvRm9jdXMiICE9PSBmICYmIChlYS5oYXNPd25Qcm9wZXJ0eShmKSA/IG51bGwgIT0gayAmJiAib25TY3JvbGwiID09PSBmICYmIEQoInNjcm9sbCIsIGEpIDogbnVsbCAhPSBrICYmIHRhKGEsIGYsIGssIGcpKTt9c3dpdGNoIChjKSB7Y2FzZSAiaW5wdXQiOlZhKGEpO2RiKGEsIGQsICExKTticmVhaztjYXNlICJ0ZXh0YXJlYSI6VmEoYSk7amIoYSk7YnJlYWs7Y2FzZSAib3B0aW9uIjpudWxsICE9IGQudmFsdWUgJiYgYS5zZXRBdHRyaWJ1dGUoInZhbHVlIiwgIiIgKyBTYShkLnZhbHVlKSk7YnJlYWs7Y2FzZSAic2VsZWN0IjphLm11bHRpcGxlID0gISFkLm11bHRpcGxlO2YgPSBkLnZhbHVlO251bGwgIT0gZiA/IGZiKGEsICEhZC5tdWx0aXBsZSwgZiwgITEpIDogbnVsbCAhPSBkLmRlZmF1bHRWYWx1ZSAmJiBmYihhLCAhIWQubXVsdGlwbGUsIGQuZGVmYXVsdFZhbHVlLAogICAgICAgICAgICAgICAgICAgICAgICAgICEwKTticmVhaztkZWZhdWx0OiJmdW5jdGlvbiIgPT09IHR5cGVvZiBlLm9uQ2xpY2sgJiYgKGEub25jbGljayA9IEJmKTt9c3dpdGNoIChjKSB7Y2FzZSAiYnV0dG9uIjpjYXNlICJpbnB1dCI6Y2FzZSAic2VsZWN0IjpjYXNlICJ0ZXh0YXJlYSI6ZCA9ICEhZC5hdXRvRm9jdXM7YnJlYWsgYTtjYXNlICJpbWciOmQgPSAhMDticmVhayBhO2RlZmF1bHQ6ZCA9ICExO319ZCAmJiAoYi5mbGFncyB8PSA0KTt9bnVsbCAhPT0gYi5yZWYgJiYgKGIuZmxhZ3MgfD0gNTEyLCBiLmZsYWdzIHw9IDIwOTcxNTIpO31TKGIpO3JldHVybiBudWxsO2Nhc2UgNjppZiAoYSAmJiBudWxsICE9IGIuc3RhdGVOb2RlKSBEaihhLCBiLCBhLm1lbW9pemVkUHJvcHMsIGQpO2Vsc2Uge2lmICgic3RyaW5nIiAhPT0gdHlwZW9mIGQgJiYgbnVsbCA9PT0gYi5zdGF0ZU5vZGUpIHRocm93IEVycm9yKHAoMTY2KSk7YyA9IEhoKEdoLmN1cnJlbnQpO0hoKEVoLmN1cnJlbnQpO2lmIChHZyhiKSkge2QgPSBiLnN0YXRlTm9kZTtjID0gYi5tZW1vaXplZFByb3BzO2RbT2ZdID0gYjtpZiAoZiA9IGQubm9kZVZhbHVlICE9PSBjKSBpZiAoYSA9CiAgICAgICAgICAgICAgICAgICAgeGcsIG51bGwgIT09IGEpIHN3aXRjaCAoYS50YWcpIHtjYXNlIDM6QWYoZC5ub2RlVmFsdWUsIGMsIDAgIT09IChhLm1vZGUgJiAxKSk7YnJlYWs7Y2FzZSA1OiEwICE9PSBhLm1lbW9pemVkUHJvcHMuc3VwcHJlc3NIeWRyYXRpb25XYXJuaW5nICYmIEFmKGQubm9kZVZhbHVlLCBjLCAwICE9PSAoYS5tb2RlICYgMSkpO31mICYmIChiLmZsYWdzIHw9IDQpO30gZWxzZSBkID0gKDkgPT09IGMubm9kZVR5cGUgPyBjIDogYy5vd25lckRvY3VtZW50KS5jcmVhdGVUZXh0Tm9kZShkKSwgZFtPZl0gPSBiLCBiLnN0YXRlTm9kZSA9IGQ7fVMoYik7cmV0dXJuIG51bGw7Y2FzZSAxMzpFKE0pO2QgPSBiLm1lbW9pemVkU3RhdGU7aWYgKG51bGwgPT09IGEgfHwgbnVsbCAhPT0gYS5tZW1vaXplZFN0YXRlICYmIG51bGwgIT09IGEubWVtb2l6ZWRTdGF0ZS5kZWh5ZHJhdGVkKSB7aWYgKEkgJiYgbnVsbCAhPT0geWcgJiYgMCAhPT0gKGIubW9kZSAmIDEpICYmIDAgPT09IChiLmZsYWdzICYgMTI4KSkgSGcoKSwgSWcoKSwgYi5mbGFncyB8PSA5ODU2MCwgZiA9ICExO2Vsc2UgaWYgKGYgPSBHZyhiKSwgbnVsbCAhPT0gZCAmJiBudWxsICE9PSBkLmRlaHlkcmF0ZWQpIHtpZiAobnVsbCA9PT0KICAgICAgICAgICAgICAgICAgICBhKSB7aWYgKCFmKSB0aHJvdyBFcnJvcihwKDMxOCkpO2YgPSBiLm1lbW9pemVkU3RhdGU7ZiA9IG51bGwgIT09IGYgPyBmLmRlaHlkcmF0ZWQgOiBudWxsO2lmICghZikgdGhyb3cgRXJyb3IocCgzMTcpKTtmW09mXSA9IGI7fSBlbHNlIElnKCksIDAgPT09IChiLmZsYWdzICYgMTI4KSAmJiAoYi5tZW1vaXplZFN0YXRlID0gbnVsbCksIGIuZmxhZ3MgfD0gNDtTKGIpO2YgPSAhMTt9IGVsc2UgbnVsbCAhPT0gemcgJiYgKEdqKHpnKSwgemcgPSBudWxsKSwgZiA9ICEwO2lmICghZikgcmV0dXJuIGIuZmxhZ3MgJiA2NTUzNiA/IGIgOiBudWxsO31pZiAoMCAhPT0gKGIuZmxhZ3MgJiAxMjgpKSByZXR1cm4gYi5sYW5lcyA9IGMsIGI7ZCA9IG51bGwgIT09IGQ7ZCAhPT0gKG51bGwgIT09IGEgJiYgbnVsbCAhPT0gYS5tZW1vaXplZFN0YXRlKSAmJiBkICYmIChiLmNoaWxkLmZsYWdzIHw9IDgxOTIsIDAgIT09IChiLm1vZGUgJiAxKSAmJiAobnVsbCA9PT0gYSB8fCAwICE9PSAoTS5jdXJyZW50ICYgMSkgPyAwID09PSBUICYmIChUID0gMykgOiB1aigpKSk7bnVsbCAhPT0gYi51cGRhdGVRdWV1ZSAmJiAoYi5mbGFncyB8PSA0KTtTKGIpO3JldHVybiBudWxsO2Nhc2UgNDpyZXR1cm4gSmgoKSwKICAgICAgICAgICAgICAgIEJqKGEsIGIpLCBudWxsID09PSBhICYmIHNmKGIuc3RhdGVOb2RlLmNvbnRhaW5lckluZm8pLCBTKGIpLCBudWxsO2Nhc2UgMTA6cmV0dXJuIFJnKGIudHlwZS5fY29udGV4dCksIFMoYiksIG51bGw7Y2FzZSAxNzpyZXR1cm4gWmYoYi50eXBlKSAmJiAkZigpLCBTKGIpLCBudWxsO2Nhc2UgMTk6RShNKTtmID0gYi5tZW1vaXplZFN0YXRlO2lmIChudWxsID09PSBmKSByZXR1cm4gUyhiKSwgbnVsbDtkID0gMCAhPT0gKGIuZmxhZ3MgJiAxMjgpO2cgPSBmLnJlbmRlcmluZztpZiAobnVsbCA9PT0gZykge2lmIChkKSBFaihmLCAhMSk7ZWxzZSB7aWYgKDAgIT09IFQgfHwgbnVsbCAhPT0gYSAmJiAwICE9PSAoYS5mbGFncyAmIDEyOCkpIGZvciAoYSA9IGIuY2hpbGQ7IG51bGwgIT09IGE7KSB7ZyA9IE1oKGEpO2lmIChudWxsICE9PSBnKSB7Yi5mbGFncyB8PSAxMjg7RWooZiwgITEpO2QgPSBnLnVwZGF0ZVF1ZXVlO251bGwgIT09IGQgJiYgKGIudXBkYXRlUXVldWUgPSBkLCBiLmZsYWdzIHw9IDQpO2Iuc3VidHJlZUZsYWdzID0gMDtkID0gYztmb3IgKGMgPSBiLmNoaWxkOyBudWxsICE9PSBjOykgZiA9IGMsIGEgPSBkLCBmLmZsYWdzICY9IDE0NjgwMDY2LAogICAgICAgICAgICAgICAgICAgICAgICBnID0gZi5hbHRlcm5hdGUsIG51bGwgPT09IGcgPyAoZi5jaGlsZExhbmVzID0gMCwgZi5sYW5lcyA9IGEsIGYuY2hpbGQgPSBudWxsLCBmLnN1YnRyZWVGbGFncyA9IDAsIGYubWVtb2l6ZWRQcm9wcyA9IG51bGwsIGYubWVtb2l6ZWRTdGF0ZSA9IG51bGwsIGYudXBkYXRlUXVldWUgPSBudWxsLCBmLmRlcGVuZGVuY2llcyA9IG51bGwsIGYuc3RhdGVOb2RlID0gbnVsbCkgOiAoZi5jaGlsZExhbmVzID0gZy5jaGlsZExhbmVzLCBmLmxhbmVzID0gZy5sYW5lcywgZi5jaGlsZCA9IGcuY2hpbGQsIGYuc3VidHJlZUZsYWdzID0gMCwgZi5kZWxldGlvbnMgPSBudWxsLCBmLm1lbW9pemVkUHJvcHMgPSBnLm1lbW9pemVkUHJvcHMsIGYubWVtb2l6ZWRTdGF0ZSA9IGcubWVtb2l6ZWRTdGF0ZSwgZi51cGRhdGVRdWV1ZSA9IGcudXBkYXRlUXVldWUsIGYudHlwZSA9IGcudHlwZSwgYSA9IGcuZGVwZW5kZW5jaWVzLCBmLmRlcGVuZGVuY2llcyA9IG51bGwgPT09IGEgPyBudWxsIDogeyBsYW5lczogYS5sYW5lcywgZmlyc3RDb250ZXh0OiBhLmZpcnN0Q29udGV4dCB9KSwgYyA9IGMuc2libGluZztHKE0sIE0uY3VycmVudCAmIDEgfCAyKTtyZXR1cm4gYi5jaGlsZDt9YSA9CiAgICAgICAgICAgICAgICAgICAgICBhLnNpYmxpbmc7fW51bGwgIT09IGYudGFpbCAmJiBCKCkgPiBIaiAmJiAoYi5mbGFncyB8PSAxMjgsIGQgPSAhMCwgRWooZiwgITEpLCBiLmxhbmVzID0gNDE5NDMwNCk7fX0gZWxzZSB7aWYgKCFkKSBpZiAoYSA9IE1oKGcpLCBudWxsICE9PSBhKSB7aWYgKGIuZmxhZ3MgfD0gMTI4LCBkID0gITAsIGMgPSBhLnVwZGF0ZVF1ZXVlLCBudWxsICE9PSBjICYmIChiLnVwZGF0ZVF1ZXVlID0gYywgYi5mbGFncyB8PSA0KSwgRWooZiwgITApLCBudWxsID09PSBmLnRhaWwgJiYgImhpZGRlbiIgPT09IGYudGFpbE1vZGUgJiYgIWcuYWx0ZXJuYXRlICYmICFJKSByZXR1cm4gUyhiKSwgbnVsbDt9IGVsc2UgMiAqIEIoKSAtIGYucmVuZGVyaW5nU3RhcnRUaW1lID4gSGogJiYgMTA3Mzc0MTgyNCAhPT0gYyAmJiAoYi5mbGFncyB8PSAxMjgsIGQgPSAhMCwgRWooZiwgITEpLCBiLmxhbmVzID0gNDE5NDMwNCk7Zi5pc0JhY2t3YXJkcyA/IChnLnNpYmxpbmcgPSBiLmNoaWxkLCBiLmNoaWxkID0gZykgOiAoYyA9IGYubGFzdCwgbnVsbCAhPT0gYyA/IGMuc2libGluZyA9IGcgOiBiLmNoaWxkID0gZywgZi5sYXN0ID0gZyk7fWlmIChudWxsICE9PSBmLnRhaWwpIHJldHVybiBiID0gZi50YWlsLCBmLnJlbmRlcmluZyA9CiAgICAgICAgICAgICAgICBiLCBmLnRhaWwgPSBiLnNpYmxpbmcsIGYucmVuZGVyaW5nU3RhcnRUaW1lID0gQigpLCBiLnNpYmxpbmcgPSBudWxsLCBjID0gTS5jdXJyZW50LCBHKE0sIGQgPyBjICYgMSB8IDIgOiBjICYgMSksIGI7UyhiKTtyZXR1cm4gbnVsbDtjYXNlIDIyOmNhc2UgMjM6cmV0dXJuIElqKCksIGQgPSBudWxsICE9PSBiLm1lbW9pemVkU3RhdGUsIG51bGwgIT09IGEgJiYgbnVsbCAhPT0gYS5tZW1vaXplZFN0YXRlICE9PSBkICYmIChiLmZsYWdzIHw9IDgxOTIpLCBkICYmIDAgIT09IChiLm1vZGUgJiAxKSA/IDAgIT09IChnaiAmIDEwNzM3NDE4MjQpICYmIChTKGIpLCBiLnN1YnRyZWVGbGFncyAmIDYgJiYgKGIuZmxhZ3MgfD0gODE5MikpIDogUyhiKSwgbnVsbDtjYXNlIDI0OnJldHVybiBudWxsO2Nhc2UgMjU6cmV0dXJuIG51bGw7fXRocm93IEVycm9yKHAoMTU2LCBiLnRhZykpO30KICAgICAgICAgIGZ1bmN0aW9uIEpqKGEsIGIpIHt3ZyhiKTtzd2l0Y2ggKGIudGFnKSB7Y2FzZSAxOnJldHVybiBaZihiLnR5cGUpICYmICRmKCksIGEgPSBiLmZsYWdzLCBhICYgNjU1MzYgPyAoYi5mbGFncyA9IGEgJiAtNjU1MzcgfCAxMjgsIGIpIDogbnVsbDtjYXNlIDM6cmV0dXJuIEpoKCksIEUoV2YpLCBFKEgpLCBPaCgpLCBhID0gYi5mbGFncywgMCAhPT0gKGEgJiA2NTUzNikgJiYgMCA9PT0gKGEgJiAxMjgpID8gKGIuZmxhZ3MgPSBhICYgLTY1NTM3IHwgMTI4LCBiKSA6IG51bGw7Y2FzZSA1OnJldHVybiBMaChiKSwgbnVsbDtjYXNlIDEzOkUoTSk7YSA9IGIubWVtb2l6ZWRTdGF0ZTtpZiAobnVsbCAhPT0gYSAmJiBudWxsICE9PSBhLmRlaHlkcmF0ZWQpIHtpZiAobnVsbCA9PT0gYi5hbHRlcm5hdGUpIHRocm93IEVycm9yKHAoMzQwKSk7SWcoKTt9YSA9IGIuZmxhZ3M7cmV0dXJuIGEgJiA2NTUzNiA/IChiLmZsYWdzID0gYSAmIC02NTUzNyB8IDEyOCwgYikgOiBudWxsO2Nhc2UgMTk6cmV0dXJuIEUoTSksIG51bGw7Y2FzZSA0OnJldHVybiBKaCgpLCBudWxsO2Nhc2UgMTA6cmV0dXJuIFJnKGIudHlwZS5fY29udGV4dCksIG51bGw7Y2FzZSAyMjpjYXNlIDIzOnJldHVybiBJaigpLAogICAgICAgICAgICAgICAgbnVsbDtjYXNlIDI0OnJldHVybiBudWxsO2RlZmF1bHQ6cmV0dXJuIG51bGw7fX12YXIgS2ogPSAhMSxVID0gITEsTGogPSAiZnVuY3Rpb24iID09PSB0eXBlb2YgV2Vha1NldCA/IFdlYWtTZXQgOiBTZXQsViA9IG51bGw7ZnVuY3Rpb24gTWooYSwgYikge3ZhciBjID0gYS5yZWY7aWYgKG51bGwgIT09IGMpIGlmICgiZnVuY3Rpb24iID09PSB0eXBlb2YgYykgdHJ5IHtjKG51bGwpO30gY2F0Y2ggKGQpIHtXKGEsIGIsIGQpO30gZWxzZSBjLmN1cnJlbnQgPSBudWxsO31mdW5jdGlvbiBOaihhLCBiLCBjKSB7dHJ5IHtjKCk7fSBjYXRjaCAoZCkge1coYSwgYiwgZCk7fX12YXIgT2ogPSAhMTsKICAgICAgICAgIGZ1bmN0aW9uIFBqKGEsIGIpIHtDZiA9IGRkO2EgPSBNZSgpO2lmIChOZShhKSkge2lmICgic2VsZWN0aW9uU3RhcnQiIGluIGEpIHZhciBjID0geyBzdGFydDogYS5zZWxlY3Rpb25TdGFydCwgZW5kOiBhLnNlbGVjdGlvbkVuZCB9O2Vsc2UgYToge2MgPSAoYyA9IGEub3duZXJEb2N1bWVudCkgJiYgYy5kZWZhdWx0VmlldyB8fCB3aW5kb3c7dmFyIGQgPSBjLmdldFNlbGVjdGlvbiAmJiBjLmdldFNlbGVjdGlvbigpO2lmIChkICYmIDAgIT09IGQucmFuZ2VDb3VudCkge2MgPSBkLmFuY2hvck5vZGU7dmFyIGUgPSBkLmFuY2hvck9mZnNldCxmID0gZC5mb2N1c05vZGU7ZCA9IGQuZm9jdXNPZmZzZXQ7dHJ5IHtjLm5vZGVUeXBlLCBmLm5vZGVUeXBlO30gY2F0Y2ggKEYpIHtjID0gbnVsbDticmVhayBhO312YXIgZyA9IDAsaCA9IC0xLGsgPSAtMSxsID0gMCxtID0gMCxxID0gYSxyID0gbnVsbDtiOiBmb3IgKDs7KSB7Zm9yICh2YXIgeTs7KSB7cSAhPT0gYyB8fCAwICE9PSBlICYmIDMgIT09IHEubm9kZVR5cGUgfHwgKGggPSBnICsgZSk7cSAhPT0gZiB8fCAwICE9PSBkICYmIDMgIT09IHEubm9kZVR5cGUgfHwgKGsgPSBnICsgZCk7MyA9PT0gcS5ub2RlVHlwZSAmJiAoZyArPQogICAgICAgICAgICAgICAgICAgICAgcS5ub2RlVmFsdWUubGVuZ3RoKTtpZiAobnVsbCA9PT0gKHkgPSBxLmZpcnN0Q2hpbGQpKSBicmVhaztyID0gcTtxID0geTt9Zm9yICg7Oykge2lmIChxID09PSBhKSBicmVhayBiO3IgPT09IGMgJiYgKytsID09PSBlICYmIChoID0gZyk7ciA9PT0gZiAmJiArK20gPT09IGQgJiYgKGsgPSBnKTtpZiAobnVsbCAhPT0gKHkgPSBxLm5leHRTaWJsaW5nKSkgYnJlYWs7cSA9IHI7ciA9IHEucGFyZW50Tm9kZTt9cSA9IHk7fWMgPSAtMSA9PT0gaCB8fCAtMSA9PT0gayA/IG51bGwgOiB7IHN0YXJ0OiBoLCBlbmQ6IGsgfTt9IGVsc2UgYyA9IG51bGw7fWMgPSBjIHx8IHsgc3RhcnQ6IDAsIGVuZDogMCB9O30gZWxzZSBjID0gbnVsbDtEZiA9IHsgZm9jdXNlZEVsZW06IGEsIHNlbGVjdGlvblJhbmdlOiBjIH07ZGQgPSAhMTtmb3IgKFYgPSBiOyBudWxsICE9PSBWOykgaWYgKGIgPSBWLCBhID0gYi5jaGlsZCwgMCAhPT0gKGIuc3VidHJlZUZsYWdzICYgMTAyOCkgJiYgbnVsbCAhPT0gYSkgYS5yZXR1cm4gPSBiLCBWID0gYTtlbHNlIGZvciAoOyBudWxsICE9PSBWOykge2IgPSBWO3RyeSB7dmFyIG4gPSBiLmFsdGVybmF0ZTtpZiAoMCAhPT0gKGIuZmxhZ3MgJiAxMDI0KSkgc3dpdGNoIChiLnRhZykge2Nhc2UgMDpjYXNlIDExOmNhc2UgMTU6YnJlYWs7CiAgICAgICAgICAgICAgICAgIGNhc2UgMTppZiAobnVsbCAhPT0gbikge3ZhciB0ID0gbi5tZW1vaXplZFByb3BzLEogPSBuLm1lbW9pemVkU3RhdGUseCA9IGIuc3RhdGVOb2RlLHcgPSB4LmdldFNuYXBzaG90QmVmb3JlVXBkYXRlKGIuZWxlbWVudFR5cGUgPT09IGIudHlwZSA/IHQgOiBMZyhiLnR5cGUsIHQpLCBKKTt4Ll9fcmVhY3RJbnRlcm5hbFNuYXBzaG90QmVmb3JlVXBkYXRlID0gdzt9YnJlYWs7Y2FzZSAzOnZhciB1ID0gYi5zdGF0ZU5vZGUuY29udGFpbmVySW5mbzsxID09PSB1Lm5vZGVUeXBlID8gdS50ZXh0Q29udGVudCA9ICIiIDogOSA9PT0gdS5ub2RlVHlwZSAmJiB1LmRvY3VtZW50RWxlbWVudCAmJiB1LnJlbW92ZUNoaWxkKHUuZG9jdW1lbnRFbGVtZW50KTticmVhaztjYXNlIDU6Y2FzZSA2OmNhc2UgNDpjYXNlIDE3OmJyZWFrO2RlZmF1bHQ6dGhyb3cgRXJyb3IocCgxNjMpKTt9fSBjYXRjaCAoRikge1coYiwgYi5yZXR1cm4sIEYpO31hID0gYi5zaWJsaW5nO2lmIChudWxsICE9PSBhKSB7YS5yZXR1cm4gPSBiLnJldHVybjtWID0gYTticmVhazt9ViA9IGIucmV0dXJuO31uID0gT2o7T2ogPSAhMTtyZXR1cm4gbjt9CiAgICAgICAgICBmdW5jdGlvbiBRaihhLCBiLCBjKSB7dmFyIGQgPSBiLnVwZGF0ZVF1ZXVlO2QgPSBudWxsICE9PSBkID8gZC5sYXN0RWZmZWN0IDogbnVsbDtpZiAobnVsbCAhPT0gZCkge3ZhciBlID0gZCA9IGQubmV4dDtkbyB7aWYgKChlLnRhZyAmIGEpID09PSBhKSB7dmFyIGYgPSBlLmRlc3Ryb3k7ZS5kZXN0cm95ID0gdm9pZCAwO3ZvaWQgMCAhPT0gZiAmJiBOaihiLCBjLCBmKTt9ZSA9IGUubmV4dDt9IHdoaWxlIChlICE9PSBkKTt9fWZ1bmN0aW9uIFJqKGEsIGIpIHtiID0gYi51cGRhdGVRdWV1ZTtiID0gbnVsbCAhPT0gYiA/IGIubGFzdEVmZmVjdCA6IG51bGw7aWYgKG51bGwgIT09IGIpIHt2YXIgYyA9IGIgPSBiLm5leHQ7ZG8ge2lmICgoYy50YWcgJiBhKSA9PT0gYSkge3ZhciBkID0gYy5jcmVhdGU7Yy5kZXN0cm95ID0gZCgpO31jID0gYy5uZXh0O30gd2hpbGUgKGMgIT09IGIpO319ZnVuY3Rpb24gU2ooYSkge3ZhciBiID0gYS5yZWY7aWYgKG51bGwgIT09IGIpIHt2YXIgYyA9IGEuc3RhdGVOb2RlO3N3aXRjaCAoYS50YWcpIHtjYXNlIDU6YSA9IGM7YnJlYWs7ZGVmYXVsdDphID0gYzt9ImZ1bmN0aW9uIiA9PT0gdHlwZW9mIGIgPyBiKGEpIDogYi5jdXJyZW50ID0gYTt9fQogICAgICAgICAgZnVuY3Rpb24gVGooYSkge3ZhciBiID0gYS5hbHRlcm5hdGU7bnVsbCAhPT0gYiAmJiAoYS5hbHRlcm5hdGUgPSBudWxsLCBUaihiKSk7YS5jaGlsZCA9IG51bGw7YS5kZWxldGlvbnMgPSBudWxsO2Euc2libGluZyA9IG51bGw7NSA9PT0gYS50YWcgJiYgKGIgPSBhLnN0YXRlTm9kZSwgbnVsbCAhPT0gYiAmJiAoZGVsZXRlIGJbT2ZdLCBkZWxldGUgYltQZl0sIGRlbGV0ZSBiW29mXSwgZGVsZXRlIGJbUWZdLCBkZWxldGUgYltSZl0pKTthLnN0YXRlTm9kZSA9IG51bGw7YS5yZXR1cm4gPSBudWxsO2EuZGVwZW5kZW5jaWVzID0gbnVsbDthLm1lbW9pemVkUHJvcHMgPSBudWxsO2EubWVtb2l6ZWRTdGF0ZSA9IG51bGw7YS5wZW5kaW5nUHJvcHMgPSBudWxsO2Euc3RhdGVOb2RlID0gbnVsbDthLnVwZGF0ZVF1ZXVlID0gbnVsbDt9ZnVuY3Rpb24gVWooYSkge3JldHVybiA1ID09PSBhLnRhZyB8fCAzID09PSBhLnRhZyB8fCA0ID09PSBhLnRhZzt9CiAgICAgICAgICBmdW5jdGlvbiBWaihhKSB7YTogZm9yICg7Oykge2ZvciAoOyBudWxsID09PSBhLnNpYmxpbmc7KSB7aWYgKG51bGwgPT09IGEucmV0dXJuIHx8IFVqKGEucmV0dXJuKSkgcmV0dXJuIG51bGw7YSA9IGEucmV0dXJuO31hLnNpYmxpbmcucmV0dXJuID0gYS5yZXR1cm47Zm9yIChhID0gYS5zaWJsaW5nOyA1ICE9PSBhLnRhZyAmJiA2ICE9PSBhLnRhZyAmJiAxOCAhPT0gYS50YWc7KSB7aWYgKGEuZmxhZ3MgJiAyKSBjb250aW51ZSBhO2lmIChudWxsID09PSBhLmNoaWxkIHx8IDQgPT09IGEudGFnKSBjb250aW51ZSBhO2Vsc2UgYS5jaGlsZC5yZXR1cm4gPSBhLCBhID0gYS5jaGlsZDt9aWYgKCEoYS5mbGFncyAmIDIpKSByZXR1cm4gYS5zdGF0ZU5vZGU7fX0KICAgICAgICAgIGZ1bmN0aW9uIFdqKGEsIGIsIGMpIHt2YXIgZCA9IGEudGFnO2lmICg1ID09PSBkIHx8IDYgPT09IGQpIGEgPSBhLnN0YXRlTm9kZSwgYiA/IDggPT09IGMubm9kZVR5cGUgPyBjLnBhcmVudE5vZGUuaW5zZXJ0QmVmb3JlKGEsIGIpIDogYy5pbnNlcnRCZWZvcmUoYSwgYikgOiAoOCA9PT0gYy5ub2RlVHlwZSA/IChiID0gYy5wYXJlbnROb2RlLCBiLmluc2VydEJlZm9yZShhLCBjKSkgOiAoYiA9IGMsIGIuYXBwZW5kQ2hpbGQoYSkpLCBjID0gYy5fcmVhY3RSb290Q29udGFpbmVyLCBudWxsICE9PSBjICYmIHZvaWQgMCAhPT0gYyB8fCBudWxsICE9PSBiLm9uY2xpY2sgfHwgKGIub25jbGljayA9IEJmKSk7ZWxzZSBpZiAoNCAhPT0gZCAmJiAoYSA9IGEuY2hpbGQsIG51bGwgIT09IGEpKSBmb3IgKFdqKGEsIGIsIGMpLCBhID0gYS5zaWJsaW5nOyBudWxsICE9PSBhOykgV2ooYSwgYiwgYyksIGEgPSBhLnNpYmxpbmc7fQogICAgICAgICAgZnVuY3Rpb24gWGooYSwgYiwgYykge3ZhciBkID0gYS50YWc7aWYgKDUgPT09IGQgfHwgNiA9PT0gZCkgYSA9IGEuc3RhdGVOb2RlLCBiID8gYy5pbnNlcnRCZWZvcmUoYSwgYikgOiBjLmFwcGVuZENoaWxkKGEpO2Vsc2UgaWYgKDQgIT09IGQgJiYgKGEgPSBhLmNoaWxkLCBudWxsICE9PSBhKSkgZm9yIChYaihhLCBiLCBjKSwgYSA9IGEuc2libGluZzsgbnVsbCAhPT0gYTspIFhqKGEsIGIsIGMpLCBhID0gYS5zaWJsaW5nO312YXIgWCA9IG51bGwsWWogPSAhMTtmdW5jdGlvbiBaaihhLCBiLCBjKSB7Zm9yIChjID0gYy5jaGlsZDsgbnVsbCAhPT0gYzspIGFrKGEsIGIsIGMpLCBjID0gYy5zaWJsaW5nO30KICAgICAgICAgIGZ1bmN0aW9uIGFrKGEsIGIsIGMpIHtpZiAobGMgJiYgImZ1bmN0aW9uIiA9PT0gdHlwZW9mIGxjLm9uQ29tbWl0RmliZXJVbm1vdW50KSB0cnkge2xjLm9uQ29tbWl0RmliZXJVbm1vdW50KGtjLCBjKTt9IGNhdGNoIChoKSB7fXN3aXRjaCAoYy50YWcpIHtjYXNlIDU6VSB8fCBNaihjLCBiKTtjYXNlIDY6dmFyIGQgPSBYLGUgPSBZajtYID0gbnVsbDtaaihhLCBiLCBjKTtYID0gZDtZaiA9IGU7bnVsbCAhPT0gWCAmJiAoWWogPyAoYSA9IFgsIGMgPSBjLnN0YXRlTm9kZSwgOCA9PT0gYS5ub2RlVHlwZSA/IGEucGFyZW50Tm9kZS5yZW1vdmVDaGlsZChjKSA6IGEucmVtb3ZlQ2hpbGQoYykpIDogWC5yZW1vdmVDaGlsZChjLnN0YXRlTm9kZSkpO2JyZWFrO2Nhc2UgMTg6bnVsbCAhPT0gWCAmJiAoWWogPyAoYSA9IFgsIGMgPSBjLnN0YXRlTm9kZSwgOCA9PT0gYS5ub2RlVHlwZSA/IEtmKGEucGFyZW50Tm9kZSwgYykgOiAxID09PSBhLm5vZGVUeXBlICYmIEtmKGEsIGMpLCBiZChhKSkgOiBLZihYLCBjLnN0YXRlTm9kZSkpO2JyZWFrO2Nhc2UgNDpkID0gWDtlID0gWWo7WCA9IGMuc3RhdGVOb2RlLmNvbnRhaW5lckluZm87WWogPSAhMDsKICAgICAgICAgICAgICAgIFpqKGEsIGIsIGMpO1ggPSBkO1lqID0gZTticmVhaztjYXNlIDA6Y2FzZSAxMTpjYXNlIDE0OmNhc2UgMTU6aWYgKCFVICYmIChkID0gYy51cGRhdGVRdWV1ZSwgbnVsbCAhPT0gZCAmJiAoZCA9IGQubGFzdEVmZmVjdCwgbnVsbCAhPT0gZCkpKSB7ZSA9IGQgPSBkLm5leHQ7ZG8ge3ZhciBmID0gZSxnID0gZi5kZXN0cm95O2YgPSBmLnRhZzt2b2lkIDAgIT09IGcgJiYgKDAgIT09IChmICYgMikgPyBOaihjLCBiLCBnKSA6IDAgIT09IChmICYgNCkgJiYgTmooYywgYiwgZykpO2UgPSBlLm5leHQ7fSB3aGlsZSAoZSAhPT0gZCk7fVpqKGEsIGIsIGMpO2JyZWFrO2Nhc2UgMTppZiAoIVUgJiYgKE1qKGMsIGIpLCBkID0gYy5zdGF0ZU5vZGUsICJmdW5jdGlvbiIgPT09IHR5cGVvZiBkLmNvbXBvbmVudFdpbGxVbm1vdW50KSkgdHJ5IHtkLnByb3BzID0gYy5tZW1vaXplZFByb3BzLCBkLnN0YXRlID0gYy5tZW1vaXplZFN0YXRlLCBkLmNvbXBvbmVudFdpbGxVbm1vdW50KCk7fSBjYXRjaCAoaCkge1coYywgYiwgaCk7fVpqKGEsIGIsIGMpO2JyZWFrO2Nhc2UgMjE6WmooYSwgYiwgYyk7YnJlYWs7Y2FzZSAyMjpjLm1vZGUgJiAxID8gKFUgPSAoZCA9IFUpIHx8IG51bGwgIT09CiAgICAgICAgICAgICAgICBjLm1lbW9pemVkU3RhdGUsIFpqKGEsIGIsIGMpLCBVID0gZCkgOiBaaihhLCBiLCBjKTticmVhaztkZWZhdWx0OlpqKGEsIGIsIGMpO319ZnVuY3Rpb24gYmsoYSkge3ZhciBiID0gYS51cGRhdGVRdWV1ZTtpZiAobnVsbCAhPT0gYikge2EudXBkYXRlUXVldWUgPSBudWxsO3ZhciBjID0gYS5zdGF0ZU5vZGU7bnVsbCA9PT0gYyAmJiAoYyA9IGEuc3RhdGVOb2RlID0gbmV3IExqKCkpO2IuZm9yRWFjaChmdW5jdGlvbiAoYikge3ZhciBkID0gY2suYmluZChudWxsLCBhLCBiKTtjLmhhcyhiKSB8fCAoYy5hZGQoYiksIGIudGhlbihkLCBkKSk7fSk7fX0KICAgICAgICAgIGZ1bmN0aW9uIGRrKGEsIGIpIHt2YXIgYyA9IGIuZGVsZXRpb25zO2lmIChudWxsICE9PSBjKSBmb3IgKHZhciBkID0gMDsgZCA8IGMubGVuZ3RoOyBkKyspIHt2YXIgZSA9IGNbZF07dHJ5IHt2YXIgZiA9IGEsZyA9IGIsaCA9IGc7YTogZm9yICg7IG51bGwgIT09IGg7KSB7c3dpdGNoIChoLnRhZykge2Nhc2UgNTpYID0gaC5zdGF0ZU5vZGU7WWogPSAhMTticmVhayBhO2Nhc2UgMzpYID0gaC5zdGF0ZU5vZGUuY29udGFpbmVySW5mbztZaiA9ICEwO2JyZWFrIGE7Y2FzZSA0OlggPSBoLnN0YXRlTm9kZS5jb250YWluZXJJbmZvO1lqID0gITA7YnJlYWsgYTt9aCA9IGgucmV0dXJuO31pZiAobnVsbCA9PT0gWCkgdGhyb3cgRXJyb3IocCgxNjApKTthayhmLCBnLCBlKTtYID0gbnVsbDtZaiA9ICExO3ZhciBrID0gZS5hbHRlcm5hdGU7bnVsbCAhPT0gayAmJiAoay5yZXR1cm4gPSBudWxsKTtlLnJldHVybiA9IG51bGw7fSBjYXRjaCAobCkge1coZSwgYiwgbCk7fX1pZiAoYi5zdWJ0cmVlRmxhZ3MgJiAxMjg1NCkgZm9yIChiID0gYi5jaGlsZDsgbnVsbCAhPT0gYjspIGVrKGIsIGEpLCBiID0gYi5zaWJsaW5nO30KICAgICAgICAgIGZ1bmN0aW9uIGVrKGEsIGIpIHt2YXIgYyA9IGEuYWx0ZXJuYXRlLGQgPSBhLmZsYWdzO3N3aXRjaCAoYS50YWcpIHtjYXNlIDA6Y2FzZSAxMTpjYXNlIDE0OmNhc2UgMTU6ZGsoYiwgYSk7ZmsoYSk7aWYgKGQgJiA0KSB7dHJ5IHtRaigzLCBhLCBhLnJldHVybiksIFJqKDMsIGEpO30gY2F0Y2ggKHQpIHtXKGEsIGEucmV0dXJuLCB0KTt9dHJ5IHtRaig1LCBhLCBhLnJldHVybik7fSBjYXRjaCAodCkge1coYSwgYS5yZXR1cm4sIHQpO319YnJlYWs7Y2FzZSAxOmRrKGIsIGEpO2ZrKGEpO2QgJiA1MTIgJiYgbnVsbCAhPT0gYyAmJiBNaihjLCBjLnJldHVybik7YnJlYWs7Y2FzZSA1OmRrKGIsIGEpO2ZrKGEpO2QgJiA1MTIgJiYgbnVsbCAhPT0gYyAmJiBNaihjLCBjLnJldHVybik7aWYgKGEuZmxhZ3MgJiAzMikge3ZhciBlID0gYS5zdGF0ZU5vZGU7dHJ5IHtvYihlLCAiIik7fSBjYXRjaCAodCkge1coYSwgYS5yZXR1cm4sIHQpO319aWYgKGQgJiA0ICYmIChlID0gYS5zdGF0ZU5vZGUsIG51bGwgIT0gZSkpIHt2YXIgZiA9IGEubWVtb2l6ZWRQcm9wcyxnID0gbnVsbCAhPT0gYyA/IGMubWVtb2l6ZWRQcm9wcyA6IGYsaCA9IGEudHlwZSxrID0gYS51cGRhdGVRdWV1ZTsKICAgICAgICAgICAgICAgICAgYS51cGRhdGVRdWV1ZSA9IG51bGw7aWYgKG51bGwgIT09IGspIHRyeSB7ImlucHV0IiA9PT0gaCAmJiAicmFkaW8iID09PSBmLnR5cGUgJiYgbnVsbCAhPSBmLm5hbWUgJiYgYWIoZSwgZik7dmIoaCwgZyk7dmFyIGwgPSB2YihoLCBmKTtmb3IgKGcgPSAwOyBnIDwgay5sZW5ndGg7IGcgKz0gMikge3ZhciBtID0ga1tnXSxxID0ga1tnICsgMV07InN0eWxlIiA9PT0gbSA/IHNiKGUsIHEpIDogImRhbmdlcm91c2x5U2V0SW5uZXJIVE1MIiA9PT0gbSA/IG5iKGUsIHEpIDogImNoaWxkcmVuIiA9PT0gbSA/IG9iKGUsIHEpIDogdGEoZSwgbSwgcSwgbCk7fXN3aXRjaCAoaCkge2Nhc2UgImlucHV0IjpiYihlLCBmKTticmVhaztjYXNlICJ0ZXh0YXJlYSI6aWIoZSwgZik7YnJlYWs7Y2FzZSAic2VsZWN0Ijp2YXIgciA9IGUuX3dyYXBwZXJTdGF0ZS53YXNNdWx0aXBsZTtlLl93cmFwcGVyU3RhdGUud2FzTXVsdGlwbGUgPSAhIWYubXVsdGlwbGU7dmFyIHkgPSBmLnZhbHVlO251bGwgIT0geSA/IGZiKGUsICEhZi5tdWx0aXBsZSwgeSwgITEpIDogciAhPT0gISFmLm11bHRpcGxlICYmIChudWxsICE9IGYuZGVmYXVsdFZhbHVlID8gZmIoZSwgISFmLm11bHRpcGxlLAogICAgICAgICAgICAgICAgICAgICAgICBmLmRlZmF1bHRWYWx1ZSwgITApIDogZmIoZSwgISFmLm11bHRpcGxlLCBmLm11bHRpcGxlID8gW10gOiAiIiwgITEpKTt9ZVtQZl0gPSBmO30gY2F0Y2ggKHQpIHtXKGEsIGEucmV0dXJuLCB0KTt9fWJyZWFrO2Nhc2UgNjpkayhiLCBhKTtmayhhKTtpZiAoZCAmIDQpIHtpZiAobnVsbCA9PT0gYS5zdGF0ZU5vZGUpIHRocm93IEVycm9yKHAoMTYyKSk7ZSA9IGEuc3RhdGVOb2RlO2YgPSBhLm1lbW9pemVkUHJvcHM7dHJ5IHtlLm5vZGVWYWx1ZSA9IGY7fSBjYXRjaCAodCkge1coYSwgYS5yZXR1cm4sIHQpO319YnJlYWs7Y2FzZSAzOmRrKGIsIGEpO2ZrKGEpO2lmIChkICYgNCAmJiBudWxsICE9PSBjICYmIGMubWVtb2l6ZWRTdGF0ZS5pc0RlaHlkcmF0ZWQpIHRyeSB7YmQoYi5jb250YWluZXJJbmZvKTt9IGNhdGNoICh0KSB7VyhhLCBhLnJldHVybiwgdCk7fWJyZWFrO2Nhc2UgNDpkayhiLCBhKTtmayhhKTticmVhaztjYXNlIDEzOmRrKGIsIGEpO2ZrKGEpO2UgPSBhLmNoaWxkO2UuZmxhZ3MgJiA4MTkyICYmIChmID0gbnVsbCAhPT0gZS5tZW1vaXplZFN0YXRlLCBlLnN0YXRlTm9kZS5pc0hpZGRlbiA9IGYsICFmIHx8CiAgICAgICAgICAgICAgICBudWxsICE9PSBlLmFsdGVybmF0ZSAmJiBudWxsICE9PSBlLmFsdGVybmF0ZS5tZW1vaXplZFN0YXRlIHx8IChnayA9IEIoKSkpO2QgJiA0ICYmIGJrKGEpO2JyZWFrO2Nhc2UgMjI6bSA9IG51bGwgIT09IGMgJiYgbnVsbCAhPT0gYy5tZW1vaXplZFN0YXRlO2EubW9kZSAmIDEgPyAoVSA9IChsID0gVSkgfHwgbSwgZGsoYiwgYSksIFUgPSBsKSA6IGRrKGIsIGEpO2ZrKGEpO2lmIChkICYgODE5Mikge2wgPSBudWxsICE9PSBhLm1lbW9pemVkU3RhdGU7aWYgKChhLnN0YXRlTm9kZS5pc0hpZGRlbiA9IGwpICYmICFtICYmIDAgIT09IChhLm1vZGUgJiAxKSkgZm9yIChWID0gYSwgbSA9IGEuY2hpbGQ7IG51bGwgIT09IG07KSB7Zm9yIChxID0gViA9IG07IG51bGwgIT09IFY7KSB7ciA9IFY7eSA9IHIuY2hpbGQ7c3dpdGNoIChyLnRhZykge2Nhc2UgMDpjYXNlIDExOmNhc2UgMTQ6Y2FzZSAxNTpRaig0LCByLCByLnJldHVybik7YnJlYWs7Y2FzZSAxOk1qKHIsIHIucmV0dXJuKTt2YXIgbiA9IHIuc3RhdGVOb2RlO2lmICgiZnVuY3Rpb24iID09PSB0eXBlb2Ygbi5jb21wb25lbnRXaWxsVW5tb3VudCkge2QgPSByO2MgPSByLnJldHVybjt0cnkge2IgPSBkLCBuLnByb3BzID0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYi5tZW1vaXplZFByb3BzLCBuLnN0YXRlID0gYi5tZW1vaXplZFN0YXRlLCBuLmNvbXBvbmVudFdpbGxVbm1vdW50KCk7fSBjYXRjaCAodCkge1coZCwgYywgdCk7fX1icmVhaztjYXNlIDU6TWoociwgci5yZXR1cm4pO2JyZWFrO2Nhc2UgMjI6aWYgKG51bGwgIT09IHIubWVtb2l6ZWRTdGF0ZSkge2hrKHEpO2NvbnRpbnVlO319bnVsbCAhPT0geSA/ICh5LnJldHVybiA9IHIsIFYgPSB5KSA6IGhrKHEpO31tID0gbS5zaWJsaW5nO31hOiBmb3IgKG0gPSBudWxsLCBxID0gYTs7KSB7aWYgKDUgPT09IHEudGFnKSB7aWYgKG51bGwgPT09IG0pIHttID0gcTt0cnkge2UgPSBxLnN0YXRlTm9kZSwgbCA/IChmID0gZS5zdHlsZSwgImZ1bmN0aW9uIiA9PT0gdHlwZW9mIGYuc2V0UHJvcGVydHkgPyBmLnNldFByb3BlcnR5KCJkaXNwbGF5IiwgIm5vbmUiLCAiaW1wb3J0YW50IikgOiBmLmRpc3BsYXkgPSAibm9uZSIpIDogKGggPSBxLnN0YXRlTm9kZSwgayA9IHEubWVtb2l6ZWRQcm9wcy5zdHlsZSwgZyA9IHZvaWQgMCAhPT0gayAmJiBudWxsICE9PSBrICYmIGsuaGFzT3duUHJvcGVydHkoImRpc3BsYXkiKSA/IGsuZGlzcGxheSA6IG51bGwsIGguc3R5bGUuZGlzcGxheSA9CiAgICAgICAgICAgICAgICAgICAgICAgICAgcmIoImRpc3BsYXkiLCBnKSk7fSBjYXRjaCAodCkge1coYSwgYS5yZXR1cm4sIHQpO319fSBlbHNlIGlmICg2ID09PSBxLnRhZykge2lmIChudWxsID09PSBtKSB0cnkge3Euc3RhdGVOb2RlLm5vZGVWYWx1ZSA9IGwgPyAiIiA6IHEubWVtb2l6ZWRQcm9wczt9IGNhdGNoICh0KSB7VyhhLCBhLnJldHVybiwgdCk7fX0gZWxzZSBpZiAoKDIyICE9PSBxLnRhZyAmJiAyMyAhPT0gcS50YWcgfHwgbnVsbCA9PT0gcS5tZW1vaXplZFN0YXRlIHx8IHEgPT09IGEpICYmIG51bGwgIT09IHEuY2hpbGQpIHtxLmNoaWxkLnJldHVybiA9IHE7cSA9IHEuY2hpbGQ7Y29udGludWU7fWlmIChxID09PSBhKSBicmVhayBhO2ZvciAoOyBudWxsID09PSBxLnNpYmxpbmc7KSB7aWYgKG51bGwgPT09IHEucmV0dXJuIHx8IHEucmV0dXJuID09PSBhKSBicmVhayBhO20gPT09IHEgJiYgKG0gPSBudWxsKTtxID0gcS5yZXR1cm47fW0gPT09IHEgJiYgKG0gPSBudWxsKTtxLnNpYmxpbmcucmV0dXJuID0gcS5yZXR1cm47cSA9IHEuc2libGluZzt9fWJyZWFrO2Nhc2UgMTk6ZGsoYiwgYSk7ZmsoYSk7ZCAmIDQgJiYgYmsoYSk7YnJlYWs7Y2FzZSAyMTpicmVhaztkZWZhdWx0OmRrKGIsCiAgICAgICAgICAgICAgICBhKSwgZmsoYSk7fX1mdW5jdGlvbiBmayhhKSB7dmFyIGIgPSBhLmZsYWdzO2lmIChiICYgMikge3RyeSB7YToge2ZvciAodmFyIGMgPSBhLnJldHVybjsgbnVsbCAhPT0gYzspIHtpZiAoVWooYykpIHt2YXIgZCA9IGM7YnJlYWsgYTt9YyA9IGMucmV0dXJuO310aHJvdyBFcnJvcihwKDE2MCkpO31zd2l0Y2ggKGQudGFnKSB7Y2FzZSA1OnZhciBlID0gZC5zdGF0ZU5vZGU7ZC5mbGFncyAmIDMyICYmIChvYihlLCAiIiksIGQuZmxhZ3MgJj0gLTMzKTt2YXIgZiA9IFZqKGEpO1hqKGEsIGYsIGUpO2JyZWFrO2Nhc2UgMzpjYXNlIDQ6dmFyIGcgPSBkLnN0YXRlTm9kZS5jb250YWluZXJJbmZvLGggPSBWaihhKTtXaihhLCBoLCBnKTticmVhaztkZWZhdWx0OnRocm93IEVycm9yKHAoMTYxKSk7fX0gY2F0Y2ggKGspIHtXKGEsIGEucmV0dXJuLCBrKTt9YS5mbGFncyAmPSAtMzt9YiAmIDQwOTYgJiYgKGEuZmxhZ3MgJj0gLTQwOTcpO31mdW5jdGlvbiBpayhhLCBiLCBjKSB7ViA9IGE7amsoYSwgYiwgYyk7fQogICAgICAgICAgZnVuY3Rpb24gamsoYSwgYiwgYykge2ZvciAodmFyIGQgPSAwICE9PSAoYS5tb2RlICYgMSk7IG51bGwgIT09IFY7KSB7dmFyIGUgPSBWLGYgPSBlLmNoaWxkO2lmICgyMiA9PT0gZS50YWcgJiYgZCkge3ZhciBnID0gbnVsbCAhPT0gZS5tZW1vaXplZFN0YXRlIHx8IEtqO2lmICghZykge3ZhciBoID0gZS5hbHRlcm5hdGUsayA9IG51bGwgIT09IGggJiYgbnVsbCAhPT0gaC5tZW1vaXplZFN0YXRlIHx8IFU7aCA9IEtqO3ZhciBsID0gVTtLaiA9IGc7aWYgKChVID0gaykgJiYgIWwpIGZvciAoViA9IGU7IG51bGwgIT09IFY7KSBnID0gViwgayA9IGcuY2hpbGQsIDIyID09PSBnLnRhZyAmJiBudWxsICE9PSBnLm1lbW9pemVkU3RhdGUgPyBrayhlKSA6IG51bGwgIT09IGsgPyAoay5yZXR1cm4gPSBnLCBWID0gaykgOiBrayhlKTtmb3IgKDsgbnVsbCAhPT0gZjspIFYgPSBmLCBqayhmLCBiLCBjKSwgZiA9IGYuc2libGluZztWID0gZTtLaiA9IGg7VSA9IGw7fWxrKGEsIGIsIGMpO30gZWxzZSAwICE9PSAoZS5zdWJ0cmVlRmxhZ3MgJiA4NzcyKSAmJiBudWxsICE9PSBmID8gKGYucmV0dXJuID0gZSwgViA9IGYpIDogbGsoYSwgYiwgYyk7fX0KICAgICAgICAgIGZ1bmN0aW9uIGxrKGEpIHtmb3IgKDsgbnVsbCAhPT0gVjspIHt2YXIgYiA9IFY7aWYgKDAgIT09IChiLmZsYWdzICYgODc3MikpIHt2YXIgYyA9IGIuYWx0ZXJuYXRlO3RyeSB7aWYgKDAgIT09IChiLmZsYWdzICYgODc3MikpIHN3aXRjaCAoYi50YWcpIHtjYXNlIDA6Y2FzZSAxMTpjYXNlIDE1OlUgfHwgUmooNSwgYik7YnJlYWs7Y2FzZSAxOnZhciBkID0gYi5zdGF0ZU5vZGU7aWYgKGIuZmxhZ3MgJiA0ICYmICFVKSBpZiAobnVsbCA9PT0gYykgZC5jb21wb25lbnREaWRNb3VudCgpO2Vsc2Uge3ZhciBlID0gYi5lbGVtZW50VHlwZSA9PT0gYi50eXBlID8gYy5tZW1vaXplZFByb3BzIDogTGcoYi50eXBlLCBjLm1lbW9pemVkUHJvcHMpO2QuY29tcG9uZW50RGlkVXBkYXRlKGUsIGMubWVtb2l6ZWRTdGF0ZSwgZC5fX3JlYWN0SW50ZXJuYWxTbmFwc2hvdEJlZm9yZVVwZGF0ZSk7fXZhciBmID0gYi51cGRhdGVRdWV1ZTtudWxsICE9PSBmICYmIGloKGIsIGYsIGQpO2JyZWFrO2Nhc2UgMzp2YXIgZyA9IGIudXBkYXRlUXVldWU7aWYgKG51bGwgIT09IGcpIHtjID0gbnVsbDtpZiAobnVsbCAhPT0gYi5jaGlsZCkgc3dpdGNoIChiLmNoaWxkLnRhZykge2Nhc2UgNTpjID0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGIuY2hpbGQuc3RhdGVOb2RlO2JyZWFrO2Nhc2UgMTpjID0gYi5jaGlsZC5zdGF0ZU5vZGU7fWloKGIsIGcsIGMpO31icmVhaztjYXNlIDU6dmFyIGggPSBiLnN0YXRlTm9kZTtpZiAobnVsbCA9PT0gYyAmJiBiLmZsYWdzICYgNCkge2MgPSBoO3ZhciBrID0gYi5tZW1vaXplZFByb3BzO3N3aXRjaCAoYi50eXBlKSB7Y2FzZSAiYnV0dG9uIjpjYXNlICJpbnB1dCI6Y2FzZSAic2VsZWN0IjpjYXNlICJ0ZXh0YXJlYSI6ay5hdXRvRm9jdXMgJiYgYy5mb2N1cygpO2JyZWFrO2Nhc2UgImltZyI6ay5zcmMgJiYgKGMuc3JjID0gay5zcmMpO319YnJlYWs7Y2FzZSA2OmJyZWFrO2Nhc2UgNDpicmVhaztjYXNlIDEyOmJyZWFrO2Nhc2UgMTM6aWYgKG51bGwgPT09IGIubWVtb2l6ZWRTdGF0ZSkge3ZhciBsID0gYi5hbHRlcm5hdGU7aWYgKG51bGwgIT09IGwpIHt2YXIgbSA9IGwubWVtb2l6ZWRTdGF0ZTtpZiAobnVsbCAhPT0gbSkge3ZhciBxID0gbS5kZWh5ZHJhdGVkO251bGwgIT09IHEgJiYgYmQocSk7fX19YnJlYWs7Y2FzZSAxOTpjYXNlIDE3OmNhc2UgMjE6Y2FzZSAyMjpjYXNlIDIzOmNhc2UgMjU6YnJlYWs7CiAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDp0aHJvdyBFcnJvcihwKDE2MykpO31VIHx8IGIuZmxhZ3MgJiA1MTIgJiYgU2ooYik7fSBjYXRjaCAocikge1coYiwgYi5yZXR1cm4sIHIpO319aWYgKGIgPT09IGEpIHtWID0gbnVsbDticmVhazt9YyA9IGIuc2libGluZztpZiAobnVsbCAhPT0gYykge2MucmV0dXJuID0gYi5yZXR1cm47ViA9IGM7YnJlYWs7fVYgPSBiLnJldHVybjt9fWZ1bmN0aW9uIGhrKGEpIHtmb3IgKDsgbnVsbCAhPT0gVjspIHt2YXIgYiA9IFY7aWYgKGIgPT09IGEpIHtWID0gbnVsbDticmVhazt9dmFyIGMgPSBiLnNpYmxpbmc7aWYgKG51bGwgIT09IGMpIHtjLnJldHVybiA9IGIucmV0dXJuO1YgPSBjO2JyZWFrO31WID0gYi5yZXR1cm47fX0KICAgICAgICAgIGZ1bmN0aW9uIGtrKGEpIHtmb3IgKDsgbnVsbCAhPT0gVjspIHt2YXIgYiA9IFY7dHJ5IHtzd2l0Y2ggKGIudGFnKSB7Y2FzZSAwOmNhc2UgMTE6Y2FzZSAxNTp2YXIgYyA9IGIucmV0dXJuO3RyeSB7UmooNCwgYik7fSBjYXRjaCAoaykge1coYiwgYywgayk7fWJyZWFrO2Nhc2UgMTp2YXIgZCA9IGIuc3RhdGVOb2RlO2lmICgiZnVuY3Rpb24iID09PSB0eXBlb2YgZC5jb21wb25lbnREaWRNb3VudCkge3ZhciBlID0gYi5yZXR1cm47dHJ5IHtkLmNvbXBvbmVudERpZE1vdW50KCk7fSBjYXRjaCAoaykge1coYiwgZSwgayk7fX12YXIgZiA9IGIucmV0dXJuO3RyeSB7U2ooYik7fSBjYXRjaCAoaykge1coYiwgZiwgayk7fWJyZWFrO2Nhc2UgNTp2YXIgZyA9IGIucmV0dXJuO3RyeSB7U2ooYik7fSBjYXRjaCAoaykge1coYiwgZywgayk7fX19IGNhdGNoIChrKSB7VyhiLCBiLnJldHVybiwgayk7fWlmIChiID09PSBhKSB7ViA9IG51bGw7YnJlYWs7fXZhciBoID0gYi5zaWJsaW5nO2lmIChudWxsICE9PSBoKSB7aC5yZXR1cm4gPSBiLnJldHVybjtWID0gaDticmVhazt9ViA9IGIucmV0dXJuO319CiAgICAgICAgICB2YXIgbWsgPSBNYXRoLmNlaWwsbmsgPSB1YS5SZWFjdEN1cnJlbnREaXNwYXRjaGVyLG9rID0gdWEuUmVhY3RDdXJyZW50T3duZXIscGsgPSB1YS5SZWFjdEN1cnJlbnRCYXRjaENvbmZpZyxLID0gMCxSID0gbnVsbCxZID0gbnVsbCxaID0gMCxnaiA9IDAsZmogPSBVZigwKSxUID0gMCxxayA9IG51bGwsaGggPSAwLHJrID0gMCxzayA9IDAsdGsgPSBudWxsLHVrID0gbnVsbCxnayA9IDAsSGogPSBJbmZpbml0eSx2ayA9IG51bGwsUGkgPSAhMSxRaSA9IG51bGwsU2kgPSBudWxsLHdrID0gITEseGsgPSBudWxsLHlrID0gMCx6ayA9IDAsQWsgPSBudWxsLEJrID0gLTEsQ2sgPSAwO2Z1bmN0aW9uIEwoKSB7cmV0dXJuIDAgIT09IChLICYgNikgPyBCKCkgOiAtMSAhPT0gQmsgPyBCayA6IEJrID0gQigpO30KICAgICAgICAgIGZ1bmN0aW9uIGxoKGEpIHtpZiAoMCA9PT0gKGEubW9kZSAmIDEpKSByZXR1cm4gMTtpZiAoMCAhPT0gKEsgJiAyKSAmJiAwICE9PSBaKSByZXR1cm4gWiAmIC1aO2lmIChudWxsICE9PSBLZy50cmFuc2l0aW9uKSByZXR1cm4gMCA9PT0gQ2sgJiYgKENrID0geWMoKSksIENrO2EgPSBDO2lmICgwICE9PSBhKSByZXR1cm4gYTthID0gd2luZG93LmV2ZW50O2EgPSB2b2lkIDAgPT09IGEgPyAxNiA6IGpkKGEudHlwZSk7cmV0dXJuIGE7fWZ1bmN0aW9uIG1oKGEsIGIsIGMsIGQpIHtpZiAoNTAgPCB6aykgdGhyb3cgemsgPSAwLCBBayA9IG51bGwsIEVycm9yKHAoMTg1KSk7QWMoYSwgYywgZCk7aWYgKDAgPT09IChLICYgMikgfHwgYSAhPT0gUikgYSA9PT0gUiAmJiAoMCA9PT0gKEsgJiAyKSAmJiAocmsgfD0gYyksIDQgPT09IFQgJiYgRGsoYSwgWikpLCBFayhhLCBkKSwgMSA9PT0gYyAmJiAwID09PSBLICYmIDAgPT09IChiLm1vZGUgJiAxKSAmJiAoSGogPSBCKCkgKyA1MDAsIGZnICYmIGpnKCkpO30KICAgICAgICAgIGZ1bmN0aW9uIEVrKGEsIGIpIHt2YXIgYyA9IGEuY2FsbGJhY2tOb2RlO3djKGEsIGIpO3ZhciBkID0gdWMoYSwgYSA9PT0gUiA/IFogOiAwKTtpZiAoMCA9PT0gZCkgbnVsbCAhPT0gYyAmJiBiYyhjKSwgYS5jYWxsYmFja05vZGUgPSBudWxsLCBhLmNhbGxiYWNrUHJpb3JpdHkgPSAwO2Vsc2UgaWYgKGIgPSBkICYgLWQsIGEuY2FsbGJhY2tQcmlvcml0eSAhPT0gYikge251bGwgIT0gYyAmJiBiYyhjKTtpZiAoMSA9PT0gYikgMCA9PT0gYS50YWcgPyBpZyhGay5iaW5kKG51bGwsIGEpKSA6IGhnKEZrLmJpbmQobnVsbCwgYSkpLCBKZihmdW5jdGlvbiAoKSB7MCA9PT0gKEsgJiA2KSAmJiBqZygpO30pLCBjID0gbnVsbDtlbHNlIHtzd2l0Y2ggKERjKGQpKSB7Y2FzZSAxOmMgPSBmYzticmVhaztjYXNlIDQ6YyA9IGdjO2JyZWFrO2Nhc2UgMTY6YyA9IGhjO2JyZWFrO2Nhc2UgNTM2ODcwOTEyOmMgPSBqYzticmVhaztkZWZhdWx0OmMgPSBoYzt9YyA9IEdrKGMsIEhrLmJpbmQobnVsbCwgYSkpO31hLmNhbGxiYWNrUHJpb3JpdHkgPSBiO2EuY2FsbGJhY2tOb2RlID0gYzt9fQogICAgICAgICAgZnVuY3Rpb24gSGsoYSwgYikge0JrID0gLTE7Q2sgPSAwO2lmICgwICE9PSAoSyAmIDYpKSB0aHJvdyBFcnJvcihwKDMyNykpO3ZhciBjID0gYS5jYWxsYmFja05vZGU7aWYgKElrKCkgJiYgYS5jYWxsYmFja05vZGUgIT09IGMpIHJldHVybiBudWxsO3ZhciBkID0gdWMoYSwgYSA9PT0gUiA/IFogOiAwKTtpZiAoMCA9PT0gZCkgcmV0dXJuIG51bGw7aWYgKDAgIT09IChkICYgMzApIHx8IDAgIT09IChkICYgYS5leHBpcmVkTGFuZXMpIHx8IGIpIGIgPSBKayhhLCBkKTtlbHNlIHtiID0gZDt2YXIgZSA9IEs7SyB8PSAyO3ZhciBmID0gS2soKTtpZiAoUiAhPT0gYSB8fCBaICE9PSBiKSB2ayA9IG51bGwsIEhqID0gQigpICsgNTAwLCBMayhhLCBiKTtkbyB0cnkge01rKCk7YnJlYWs7fSBjYXRjaCAoaCkge05rKGEsIGgpO30gd2hpbGUgKDEpO1FnKCk7bmsuY3VycmVudCA9IGY7SyA9IGU7bnVsbCAhPT0gWSA/IGIgPSAwIDogKFIgPSBudWxsLCBaID0gMCwgYiA9IFQpO31pZiAoMCAhPT0gYikgezIgPT09IGIgJiYgKGUgPSB4YyhhKSwgMCAhPT0gZSAmJiAoZCA9IGUsIGIgPSBPayhhLCBlKSkpO2lmICgxID09PSBiKSB0aHJvdyBjID0gcWssIExrKGEsIDApLCBEayhhLCBkKSwgRWsoYSwgQigpKSwgYztpZiAoNiA9PT0gYikgRGsoYSwgZCk7ZWxzZQogICAgICAgICAgICAgIHtlID0gYS5jdXJyZW50LmFsdGVybmF0ZTtpZiAoMCA9PT0gKGQgJiAzMCkgJiYgIVBrKGUpICYmIChiID0gSmsoYSwgZCksIDIgPT09IGIgJiYgKGYgPSB4YyhhKSwgMCAhPT0gZiAmJiAoZCA9IGYsIGIgPSBPayhhLCBmKSkpLCAxID09PSBiKSkgdGhyb3cgYyA9IHFrLCBMayhhLCAwKSwgRGsoYSwgZCksIEVrKGEsIEIoKSksIGM7YS5maW5pc2hlZFdvcmsgPSBlO2EuZmluaXNoZWRMYW5lcyA9IGQ7c3dpdGNoIChiKSB7Y2FzZSAwOmNhc2UgMTp0aHJvdyBFcnJvcihwKDM0NSkpO2Nhc2UgMjpRayhhLCB1aywgdmspO2JyZWFrO2Nhc2UgMzpEayhhLCBkKTtpZiAoKGQgJiAxMzAwMjM0MjQpID09PSBkICYmIChiID0gZ2sgKyA1MDAgLSBCKCksIDEwIDwgYikpIHtpZiAoMCAhPT0gdWMoYSwgMCkpIGJyZWFrO2UgPSBhLnN1c3BlbmRlZExhbmVzO2lmICgoZSAmIGQpICE9PSBkKSB7TCgpO2EucGluZ2VkTGFuZXMgfD0gYS5zdXNwZW5kZWRMYW5lcyAmIGU7YnJlYWs7fWEudGltZW91dEhhbmRsZSA9IEZmKFFrLmJpbmQobnVsbCwgYSwgdWssIHZrKSwgYik7YnJlYWs7fVFrKGEsIHVrLCB2ayk7YnJlYWs7Y2FzZSA0OkRrKGEsIGQpO2lmICgoZCAmIDQxOTQyNDApID09PQogICAgICAgICAgICAgICAgICAgIGQpIGJyZWFrO2IgPSBhLmV2ZW50VGltZXM7Zm9yIChlID0gLTE7IDAgPCBkOykge3ZhciBnID0gMzEgLSBvYyhkKTtmID0gMSA8PCBnO2cgPSBiW2ddO2cgPiBlICYmIChlID0gZyk7ZCAmPSB+Zjt9ZCA9IGU7ZCA9IEIoKSAtIGQ7ZCA9ICgxMjAgPiBkID8gMTIwIDogNDgwID4gZCA/IDQ4MCA6IDEwODAgPiBkID8gMTA4MCA6IDE5MjAgPiBkID8gMTkyMCA6IDNFMyA+IGQgPyAzRTMgOiA0MzIwID4gZCA/IDQzMjAgOiAxOTYwICogbWsoZCAvIDE5NjApKSAtIGQ7aWYgKDEwIDwgZCkge2EudGltZW91dEhhbmRsZSA9IEZmKFFrLmJpbmQobnVsbCwgYSwgdWssIHZrKSwgZCk7YnJlYWs7fVFrKGEsIHVrLCB2ayk7YnJlYWs7Y2FzZSA1OlFrKGEsIHVrLCB2ayk7YnJlYWs7ZGVmYXVsdDp0aHJvdyBFcnJvcihwKDMyOSkpO319fUVrKGEsIEIoKSk7cmV0dXJuIGEuY2FsbGJhY2tOb2RlID09PSBjID8gSGsuYmluZChudWxsLCBhKSA6IG51bGw7fQogICAgICAgICAgZnVuY3Rpb24gT2soYSwgYikge3ZhciBjID0gdGs7YS5jdXJyZW50Lm1lbW9pemVkU3RhdGUuaXNEZWh5ZHJhdGVkICYmIChMayhhLCBiKS5mbGFncyB8PSAyNTYpO2EgPSBKayhhLCBiKTsyICE9PSBhICYmIChiID0gdWssIHVrID0gYywgbnVsbCAhPT0gYiAmJiBHaihiKSk7cmV0dXJuIGE7fWZ1bmN0aW9uIEdqKGEpIHtudWxsID09PSB1ayA/IHVrID0gYSA6IHVrLnB1c2guYXBwbHkodWssIGEpO30KICAgICAgICAgIGZ1bmN0aW9uIFBrKGEpIHtmb3IgKHZhciBiID0gYTs7KSB7aWYgKGIuZmxhZ3MgJiAxNjM4NCkge3ZhciBjID0gYi51cGRhdGVRdWV1ZTtpZiAobnVsbCAhPT0gYyAmJiAoYyA9IGMuc3RvcmVzLCBudWxsICE9PSBjKSkgZm9yICh2YXIgZCA9IDA7IGQgPCBjLmxlbmd0aDsgZCsrKSB7dmFyIGUgPSBjW2RdLGYgPSBlLmdldFNuYXBzaG90O2UgPSBlLnZhbHVlO3RyeSB7aWYgKCFIZShmKCksIGUpKSByZXR1cm4gITE7fSBjYXRjaCAoZykge3JldHVybiAhMTt9fX1jID0gYi5jaGlsZDtpZiAoYi5zdWJ0cmVlRmxhZ3MgJiAxNjM4NCAmJiBudWxsICE9PSBjKSBjLnJldHVybiA9IGIsIGIgPSBjO2Vsc2Uge2lmIChiID09PSBhKSBicmVhaztmb3IgKDsgbnVsbCA9PT0gYi5zaWJsaW5nOykge2lmIChudWxsID09PSBiLnJldHVybiB8fCBiLnJldHVybiA9PT0gYSkgcmV0dXJuICEwO2IgPSBiLnJldHVybjt9Yi5zaWJsaW5nLnJldHVybiA9IGIucmV0dXJuO2IgPSBiLnNpYmxpbmc7fX1yZXR1cm4gITA7fQogICAgICAgICAgZnVuY3Rpb24gRGsoYSwgYikge2IgJj0gfnNrO2IgJj0gfnJrO2Euc3VzcGVuZGVkTGFuZXMgfD0gYjthLnBpbmdlZExhbmVzICY9IH5iO2ZvciAoYSA9IGEuZXhwaXJhdGlvblRpbWVzOyAwIDwgYjspIHt2YXIgYyA9IDMxIC0gb2MoYiksZCA9IDEgPDwgYzthW2NdID0gLTE7YiAmPSB+ZDt9fWZ1bmN0aW9uIEZrKGEpIHtpZiAoMCAhPT0gKEsgJiA2KSkgdGhyb3cgRXJyb3IocCgzMjcpKTtJaygpO3ZhciBiID0gdWMoYSwgMCk7aWYgKDAgPT09IChiICYgMSkpIHJldHVybiBFayhhLCBCKCkpLCBudWxsO3ZhciBjID0gSmsoYSwgYik7aWYgKDAgIT09IGEudGFnICYmIDIgPT09IGMpIHt2YXIgZCA9IHhjKGEpOzAgIT09IGQgJiYgKGIgPSBkLCBjID0gT2soYSwgZCkpO31pZiAoMSA9PT0gYykgdGhyb3cgYyA9IHFrLCBMayhhLCAwKSwgRGsoYSwgYiksIEVrKGEsIEIoKSksIGM7aWYgKDYgPT09IGMpIHRocm93IEVycm9yKHAoMzQ1KSk7YS5maW5pc2hlZFdvcmsgPSBhLmN1cnJlbnQuYWx0ZXJuYXRlO2EuZmluaXNoZWRMYW5lcyA9IGI7UWsoYSwgdWssIHZrKTtFayhhLCBCKCkpO3JldHVybiBudWxsO30KICAgICAgICAgIGZ1bmN0aW9uIFJrKGEsIGIpIHt2YXIgYyA9IEs7SyB8PSAxO3RyeSB7cmV0dXJuIGEoYik7fSBmaW5hbGx5IHtLID0gYywgMCA9PT0gSyAmJiAoSGogPSBCKCkgKyA1MDAsIGZnICYmIGpnKCkpO319ZnVuY3Rpb24gU2soYSkge251bGwgIT09IHhrICYmIDAgPT09IHhrLnRhZyAmJiAwID09PSAoSyAmIDYpICYmIElrKCk7dmFyIGIgPSBLO0sgfD0gMTt2YXIgYyA9IHBrLnRyYW5zaXRpb24sZCA9IEM7dHJ5IHtpZiAocGsudHJhbnNpdGlvbiA9IG51bGwsIEMgPSAxLCBhKSByZXR1cm4gYSgpO30gZmluYWxseSB7QyA9IGQsIHBrLnRyYW5zaXRpb24gPSBjLCBLID0gYiwgMCA9PT0gKEsgJiA2KSAmJiBqZygpO319ZnVuY3Rpb24gSWooKSB7Z2ogPSBmai5jdXJyZW50O0UoZmopO30KICAgICAgICAgIGZ1bmN0aW9uIExrKGEsIGIpIHthLmZpbmlzaGVkV29yayA9IG51bGw7YS5maW5pc2hlZExhbmVzID0gMDt2YXIgYyA9IGEudGltZW91dEhhbmRsZTstMSAhPT0gYyAmJiAoYS50aW1lb3V0SGFuZGxlID0gLTEsIEdmKGMpKTtpZiAobnVsbCAhPT0gWSkgZm9yIChjID0gWS5yZXR1cm47IG51bGwgIT09IGM7KSB7dmFyIGQgPSBjO3dnKGQpO3N3aXRjaCAoZC50YWcpIHtjYXNlIDE6ZCA9IGQudHlwZS5jaGlsZENvbnRleHRUeXBlcztudWxsICE9PSBkICYmIHZvaWQgMCAhPT0gZCAmJiAkZigpO2JyZWFrO2Nhc2UgMzpKaCgpO0UoV2YpO0UoSCk7T2goKTticmVhaztjYXNlIDU6TGgoZCk7YnJlYWs7Y2FzZSA0OkpoKCk7YnJlYWs7Y2FzZSAxMzpFKE0pO2JyZWFrO2Nhc2UgMTk6RShNKTticmVhaztjYXNlIDEwOlJnKGQudHlwZS5fY29udGV4dCk7YnJlYWs7Y2FzZSAyMjpjYXNlIDIzOklqKCk7fWMgPSBjLnJldHVybjt9UiA9IGE7WSA9IGEgPSB3aChhLmN1cnJlbnQsIG51bGwpO1ogPSBnaiA9IGI7VCA9IDA7cWsgPSBudWxsO3NrID0gcmsgPSBoaCA9IDA7dWsgPSB0ayA9IG51bGw7aWYgKG51bGwgIT09IFdnKSB7Zm9yIChiID0KICAgICAgICAgICAgICAwOyBiIDwgV2cubGVuZ3RoOyBiKyspIGlmIChjID0gV2dbYl0sIGQgPSBjLmludGVybGVhdmVkLCBudWxsICE9PSBkKSB7Yy5pbnRlcmxlYXZlZCA9IG51bGw7dmFyIGUgPSBkLm5leHQsZiA9IGMucGVuZGluZztpZiAobnVsbCAhPT0gZikge3ZhciBnID0gZi5uZXh0O2YubmV4dCA9IGU7ZC5uZXh0ID0gZzt9Yy5wZW5kaW5nID0gZDt9V2cgPSBudWxsO31yZXR1cm4gYTt9CiAgICAgICAgICBmdW5jdGlvbiBOayhhLCBiKSB7ZG8ge3ZhciBjID0gWTt0cnkge1FnKCk7UGguY3VycmVudCA9IGFpO2lmIChTaCkge2ZvciAodmFyIGQgPSBOLm1lbW9pemVkU3RhdGU7IG51bGwgIT09IGQ7KSB7dmFyIGUgPSBkLnF1ZXVlO251bGwgIT09IGUgJiYgKGUucGVuZGluZyA9IG51bGwpO2QgPSBkLm5leHQ7fVNoID0gITE7fVJoID0gMDtQID0gTyA9IE4gPSBudWxsO1RoID0gITE7VWggPSAwO29rLmN1cnJlbnQgPSBudWxsO2lmIChudWxsID09PSBjIHx8IG51bGwgPT09IGMucmV0dXJuKSB7VCA9IDE7cWsgPSBiO1kgPSBudWxsO2JyZWFrO31hOiB7dmFyIGYgPSBhLGcgPSBjLnJldHVybixoID0gYyxrID0gYjtiID0gWjtoLmZsYWdzIHw9IDMyNzY4O2lmIChudWxsICE9PSBrICYmICJvYmplY3QiID09PSB0eXBlb2YgayAmJiAiZnVuY3Rpb24iID09PSB0eXBlb2Ygay50aGVuKSB7dmFyIGwgPSBrLG0gPSBoLHEgPSBtLnRhZztpZiAoMCA9PT0gKG0ubW9kZSAmIDEpICYmICgwID09PSBxIHx8IDExID09PSBxIHx8IDE1ID09PSBxKSkge3ZhciByID0gbS5hbHRlcm5hdGU7ciA/IChtLnVwZGF0ZVF1ZXVlID0gci51cGRhdGVRdWV1ZSwgbS5tZW1vaXplZFN0YXRlID0gci5tZW1vaXplZFN0YXRlLAogICAgICAgICAgICAgICAgICAgICAgbS5sYW5lcyA9IHIubGFuZXMpIDogKG0udXBkYXRlUXVldWUgPSBudWxsLCBtLm1lbW9pemVkU3RhdGUgPSBudWxsKTt9dmFyIHkgPSBWaShnKTtpZiAobnVsbCAhPT0geSkge3kuZmxhZ3MgJj0gLTI1NztXaSh5LCBnLCBoLCBmLCBiKTt5Lm1vZGUgJiAxICYmIFRpKGYsIGwsIGIpO2IgPSB5O2sgPSBsO3ZhciBuID0gYi51cGRhdGVRdWV1ZTtpZiAobnVsbCA9PT0gbikge3ZhciB0ID0gbmV3IFNldCgpO3QuYWRkKGspO2IudXBkYXRlUXVldWUgPSB0O30gZWxzZSBuLmFkZChrKTticmVhayBhO30gZWxzZSB7aWYgKDAgPT09IChiICYgMSkpIHtUaShmLCBsLCBiKTt1aigpO2JyZWFrIGE7fWsgPSBFcnJvcihwKDQyNikpO319IGVsc2UgaWYgKEkgJiYgaC5tb2RlICYgMSkge3ZhciBKID0gVmkoZyk7aWYgKG51bGwgIT09IEopIHswID09PSAoSi5mbGFncyAmIDY1NTM2KSAmJiAoSi5mbGFncyB8PSAyNTYpO1dpKEosIGcsIGgsIGYsIGIpO0pnKEtpKGssIGgpKTticmVhayBhO319ZiA9IGsgPSBLaShrLCBoKTs0ICE9PSBUICYmIChUID0gMik7bnVsbCA9PT0gdGsgPyB0ayA9IFtmXSA6IHRrLnB1c2goZik7ZiA9IGc7ZG8ge3N3aXRjaCAoZi50YWcpIHtjYXNlIDM6Zi5mbGFncyB8PSA2NTUzNjsKICAgICAgICAgICAgICAgICAgICAgICAgYiAmPSAtYjtmLmxhbmVzIHw9IGI7dmFyIHggPSBPaShmLCBrLCBiKTtmaChmLCB4KTticmVhayBhO2Nhc2UgMTpoID0gazt2YXIgdyA9IGYudHlwZSx1ID0gZi5zdGF0ZU5vZGU7aWYgKDAgPT09IChmLmZsYWdzICYgMTI4KSAmJiAoImZ1bmN0aW9uIiA9PT0gdHlwZW9mIHcuZ2V0RGVyaXZlZFN0YXRlRnJvbUVycm9yIHx8IG51bGwgIT09IHUgJiYgImZ1bmN0aW9uIiA9PT0gdHlwZW9mIHUuY29tcG9uZW50RGlkQ2F0Y2ggJiYgKG51bGwgPT09IFNpIHx8ICFTaS5oYXModSkpKSkge2YuZmxhZ3MgfD0gNjU1MzY7YiAmPSAtYjtmLmxhbmVzIHw9IGI7dmFyIEYgPSBSaShmLCBoLCBiKTtmaChmLCBGKTticmVhayBhO319ZiA9IGYucmV0dXJuO30gd2hpbGUgKG51bGwgIT09IGYpO31UayhjKTt9IGNhdGNoIChuYSkge2IgPSBuYTtZID09PSBjICYmIG51bGwgIT09IGMgJiYgKFkgPSBjID0gYy5yZXR1cm4pO2NvbnRpbnVlO31icmVhazt9IHdoaWxlICgxKTt9ZnVuY3Rpb24gS2soKSB7dmFyIGEgPSBuay5jdXJyZW50O25rLmN1cnJlbnQgPSBhaTtyZXR1cm4gbnVsbCA9PT0gYSA/IGFpIDogYTt9CiAgICAgICAgICBmdW5jdGlvbiB1aigpIHtpZiAoMCA9PT0gVCB8fCAzID09PSBUIHx8IDIgPT09IFQpIFQgPSA0O251bGwgPT09IFIgfHwgMCA9PT0gKGhoICYgMjY4NDM1NDU1KSAmJiAwID09PSAocmsgJiAyNjg0MzU0NTUpIHx8IERrKFIsIFopO31mdW5jdGlvbiBKayhhLCBiKSB7dmFyIGMgPSBLO0sgfD0gMjt2YXIgZCA9IEtrKCk7aWYgKFIgIT09IGEgfHwgWiAhPT0gYikgdmsgPSBudWxsLCBMayhhLCBiKTtkbyB0cnkge1VrKCk7YnJlYWs7fSBjYXRjaCAoZSkge05rKGEsIGUpO30gd2hpbGUgKDEpO1FnKCk7SyA9IGM7bmsuY3VycmVudCA9IGQ7aWYgKG51bGwgIT09IFkpIHRocm93IEVycm9yKHAoMjYxKSk7UiA9IG51bGw7WiA9IDA7cmV0dXJuIFQ7fWZ1bmN0aW9uIFVrKCkge2ZvciAoOyBudWxsICE9PSBZOykgVmsoWSk7fWZ1bmN0aW9uIE1rKCkge2ZvciAoOyBudWxsICE9PSBZICYmICFjYygpOykgVmsoWSk7fWZ1bmN0aW9uIFZrKGEpIHt2YXIgYiA9IFdrKGEuYWx0ZXJuYXRlLCBhLCBnaik7YS5tZW1vaXplZFByb3BzID0gYS5wZW5kaW5nUHJvcHM7bnVsbCA9PT0gYiA/IFRrKGEpIDogWSA9IGI7b2suY3VycmVudCA9IG51bGw7fQogICAgICAgICAgZnVuY3Rpb24gVGsoYSkge3ZhciBiID0gYTtkbyB7dmFyIGMgPSBiLmFsdGVybmF0ZTthID0gYi5yZXR1cm47aWYgKDAgPT09IChiLmZsYWdzICYgMzI3NjgpKSB7aWYgKGMgPSBGaihjLCBiLCBnaiksIG51bGwgIT09IGMpIHtZID0gYztyZXR1cm47fX0gZWxzZSB7YyA9IEpqKGMsIGIpO2lmIChudWxsICE9PSBjKSB7Yy5mbGFncyAmPSAzMjc2NztZID0gYztyZXR1cm47fWlmIChudWxsICE9PSBhKSBhLmZsYWdzIHw9IDMyNzY4LCBhLnN1YnRyZWVGbGFncyA9IDAsIGEuZGVsZXRpb25zID0gbnVsbDtlbHNlIHtUID0gNjtZID0gbnVsbDtyZXR1cm47fX1iID0gYi5zaWJsaW5nO2lmIChudWxsICE9PSBiKSB7WSA9IGI7cmV0dXJuO31ZID0gYiA9IGE7fSB3aGlsZSAobnVsbCAhPT0gYik7MCA9PT0gVCAmJiAoVCA9IDUpO31mdW5jdGlvbiBRayhhLCBiLCBjKSB7dmFyIGQgPSBDLGUgPSBway50cmFuc2l0aW9uO3RyeSB7cGsudHJhbnNpdGlvbiA9IG51bGwsIEMgPSAxLCBYayhhLCBiLCBjLCBkKTt9IGZpbmFsbHkge3BrLnRyYW5zaXRpb24gPSBlLCBDID0gZDt9cmV0dXJuIG51bGw7fQogICAgICAgICAgZnVuY3Rpb24gWGsoYSwgYiwgYywgZCkge2RvIElrKCk7IHdoaWxlIChudWxsICE9PSB4ayk7aWYgKDAgIT09IChLICYgNikpIHRocm93IEVycm9yKHAoMzI3KSk7YyA9IGEuZmluaXNoZWRXb3JrO3ZhciBlID0gYS5maW5pc2hlZExhbmVzO2lmIChudWxsID09PSBjKSByZXR1cm4gbnVsbDthLmZpbmlzaGVkV29yayA9IG51bGw7YS5maW5pc2hlZExhbmVzID0gMDtpZiAoYyA9PT0gYS5jdXJyZW50KSB0aHJvdyBFcnJvcihwKDE3NykpO2EuY2FsbGJhY2tOb2RlID0gbnVsbDthLmNhbGxiYWNrUHJpb3JpdHkgPSAwO3ZhciBmID0gYy5sYW5lcyB8IGMuY2hpbGRMYW5lcztCYyhhLCBmKTthID09PSBSICYmIChZID0gUiA9IG51bGwsIFogPSAwKTswID09PSAoYy5zdWJ0cmVlRmxhZ3MgJiAyMDY0KSAmJiAwID09PSAoYy5mbGFncyAmIDIwNjQpIHx8IHdrIHx8ICh3ayA9ICEwLCBHayhoYywgZnVuY3Rpb24gKCkge0lrKCk7cmV0dXJuIG51bGw7fSkpO2YgPSAwICE9PSAoYy5mbGFncyAmIDE1OTkwKTtpZiAoMCAhPT0gKGMuc3VidHJlZUZsYWdzICYgMTU5OTApIHx8IGYpIHtmID0gcGsudHJhbnNpdGlvbjtway50cmFuc2l0aW9uID0gbnVsbDsKICAgICAgICAgICAgICB2YXIgZyA9IEM7QyA9IDE7dmFyIGggPSBLO0sgfD0gNDtvay5jdXJyZW50ID0gbnVsbDtQaihhLCBjKTtlayhjLCBhKTtPZShEZik7ZGQgPSAhIUNmO0RmID0gQ2YgPSBudWxsO2EuY3VycmVudCA9IGM7aWsoYywgYSwgZSk7ZGMoKTtLID0gaDtDID0gZztway50cmFuc2l0aW9uID0gZjt9IGVsc2UgYS5jdXJyZW50ID0gYzt3ayAmJiAod2sgPSAhMSwgeGsgPSBhLCB5ayA9IGUpO2YgPSBhLnBlbmRpbmdMYW5lczswID09PSBmICYmIChTaSA9IG51bGwpO21jKGMuc3RhdGVOb2RlLCBkKTtFayhhLCBCKCkpO2lmIChudWxsICE9PSBiKSBmb3IgKGQgPSBhLm9uUmVjb3ZlcmFibGVFcnJvciwgYyA9IDA7IGMgPCBiLmxlbmd0aDsgYysrKSBlID0gYltjXSwgZChlLnZhbHVlLCB7IGNvbXBvbmVudFN0YWNrOiBlLnN0YWNrLCBkaWdlc3Q6IGUuZGlnZXN0IH0pO2lmIChQaSkgdGhyb3cgUGkgPSAhMSwgYSA9IFFpLCBRaSA9IG51bGwsIGE7MCAhPT0gKHlrICYgMSkgJiYgMCAhPT0gYS50YWcgJiYgSWsoKTtmID0gYS5wZW5kaW5nTGFuZXM7MCAhPT0gKGYgJiAxKSA/IGEgPT09IEFrID8gemsrKyA6ICh6ayA9IDAsIEFrID0gYSkgOiB6ayA9IDA7amcoKTtyZXR1cm4gbnVsbDt9CiAgICAgICAgICBmdW5jdGlvbiBJaygpIHtpZiAobnVsbCAhPT0geGspIHt2YXIgYSA9IERjKHlrKSxiID0gcGsudHJhbnNpdGlvbixjID0gQzt0cnkge3BrLnRyYW5zaXRpb24gPSBudWxsO0MgPSAxNiA+IGEgPyAxNiA6IGE7aWYgKG51bGwgPT09IHhrKSB2YXIgZCA9ICExO2Vsc2Uge2EgPSB4azt4ayA9IG51bGw7eWsgPSAwO2lmICgwICE9PSAoSyAmIDYpKSB0aHJvdyBFcnJvcihwKDMzMSkpO3ZhciBlID0gSztLIHw9IDQ7Zm9yIChWID0gYS5jdXJyZW50OyBudWxsICE9PSBWOykge3ZhciBmID0gVixnID0gZi5jaGlsZDtpZiAoMCAhPT0gKFYuZmxhZ3MgJiAxNikpIHt2YXIgaCA9IGYuZGVsZXRpb25zO2lmIChudWxsICE9PSBoKSB7Zm9yICh2YXIgayA9IDA7IGsgPCBoLmxlbmd0aDsgaysrKSB7dmFyIGwgPSBoW2tdO2ZvciAoViA9IGw7IG51bGwgIT09IFY7KSB7dmFyIG0gPSBWO3N3aXRjaCAobS50YWcpIHtjYXNlIDA6Y2FzZSAxMTpjYXNlIDE1OlFqKDgsIG0sIGYpO312YXIgcSA9IG0uY2hpbGQ7aWYgKG51bGwgIT09IHEpIHEucmV0dXJuID0gbSwgViA9IHE7ZWxzZSBmb3IgKDsgbnVsbCAhPT0gVjspIHttID0gVjt2YXIgciA9IG0uc2libGluZyx5ID0gbS5yZXR1cm47VGoobSk7aWYgKG0gPT09CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGwpIHtWID0gbnVsbDticmVhazt9aWYgKG51bGwgIT09IHIpIHtyLnJldHVybiA9IHk7ViA9IHI7YnJlYWs7fVYgPSB5O319fXZhciBuID0gZi5hbHRlcm5hdGU7aWYgKG51bGwgIT09IG4pIHt2YXIgdCA9IG4uY2hpbGQ7aWYgKG51bGwgIT09IHQpIHtuLmNoaWxkID0gbnVsbDtkbyB7dmFyIEogPSB0LnNpYmxpbmc7dC5zaWJsaW5nID0gbnVsbDt0ID0gSjt9IHdoaWxlIChudWxsICE9PSB0KTt9fVYgPSBmO319aWYgKDAgIT09IChmLnN1YnRyZWVGbGFncyAmIDIwNjQpICYmIG51bGwgIT09IGcpIGcucmV0dXJuID0gZiwgViA9IGc7ZWxzZSBiOiBmb3IgKDsgbnVsbCAhPT0gVjspIHtmID0gVjtpZiAoMCAhPT0gKGYuZmxhZ3MgJiAyMDQ4KSkgc3dpdGNoIChmLnRhZykge2Nhc2UgMDpjYXNlIDExOmNhc2UgMTU6UWooOSwgZiwgZi5yZXR1cm4pO312YXIgeCA9IGYuc2libGluZztpZiAobnVsbCAhPT0geCkge3gucmV0dXJuID0gZi5yZXR1cm47ViA9IHg7YnJlYWsgYjt9ViA9IGYucmV0dXJuO319dmFyIHcgPSBhLmN1cnJlbnQ7Zm9yIChWID0gdzsgbnVsbCAhPT0gVjspIHtnID0gVjt2YXIgdSA9IGcuY2hpbGQ7aWYgKDAgIT09IChnLnN1YnRyZWVGbGFncyAmIDIwNjQpICYmIG51bGwgIT09CiAgICAgICAgICAgICAgICAgICAgdSkgdS5yZXR1cm4gPSBnLCBWID0gdTtlbHNlIGI6IGZvciAoZyA9IHc7IG51bGwgIT09IFY7KSB7aCA9IFY7aWYgKDAgIT09IChoLmZsYWdzICYgMjA0OCkpIHRyeSB7c3dpdGNoIChoLnRhZykge2Nhc2UgMDpjYXNlIDExOmNhc2UgMTU6UmooOSwgaCk7fX0gY2F0Y2ggKG5hKSB7VyhoLCBoLnJldHVybiwgbmEpO31pZiAoaCA9PT0gZykge1YgPSBudWxsO2JyZWFrIGI7fXZhciBGID0gaC5zaWJsaW5nO2lmIChudWxsICE9PSBGKSB7Ri5yZXR1cm4gPSBoLnJldHVybjtWID0gRjticmVhayBiO31WID0gaC5yZXR1cm47fX1LID0gZTtqZygpO2lmIChsYyAmJiAiZnVuY3Rpb24iID09PSB0eXBlb2YgbGMub25Qb3N0Q29tbWl0RmliZXJSb290KSB0cnkge2xjLm9uUG9zdENvbW1pdEZpYmVyUm9vdChrYywgYSk7fSBjYXRjaCAobmEpIHt9ZCA9ICEwO31yZXR1cm4gZDt9IGZpbmFsbHkge0MgPSBjLCBway50cmFuc2l0aW9uID0gYjt9fXJldHVybiAhMTt9ZnVuY3Rpb24gWWsoYSwgYiwgYykge2IgPSBLaShjLCBiKTtiID0gT2koYSwgYiwgMSk7YSA9IGRoKGEsIGIsIDEpO2IgPSBMKCk7bnVsbCAhPT0gYSAmJiAoQWMoYSwgMSwgYiksIEVrKGEsIGIpKTt9CiAgICAgICAgICBmdW5jdGlvbiBXKGEsIGIsIGMpIHtpZiAoMyA9PT0gYS50YWcpIFlrKGEsIGEsIGMpO2Vsc2UgZm9yICg7IG51bGwgIT09IGI7KSB7aWYgKDMgPT09IGIudGFnKSB7WWsoYiwgYSwgYyk7YnJlYWs7fSBlbHNlIGlmICgxID09PSBiLnRhZykge3ZhciBkID0gYi5zdGF0ZU5vZGU7aWYgKCJmdW5jdGlvbiIgPT09IHR5cGVvZiBiLnR5cGUuZ2V0RGVyaXZlZFN0YXRlRnJvbUVycm9yIHx8ICJmdW5jdGlvbiIgPT09IHR5cGVvZiBkLmNvbXBvbmVudERpZENhdGNoICYmIChudWxsID09PSBTaSB8fCAhU2kuaGFzKGQpKSkge2EgPSBLaShjLCBhKTthID0gUmkoYiwgYSwgMSk7YiA9IGRoKGIsIGEsIDEpO2EgPSBMKCk7bnVsbCAhPT0gYiAmJiAoQWMoYiwgMSwgYSksIEVrKGIsIGEpKTticmVhazt9fWIgPSBiLnJldHVybjt9fQogICAgICAgICAgZnVuY3Rpb24gVWkoYSwgYiwgYykge3ZhciBkID0gYS5waW5nQ2FjaGU7bnVsbCAhPT0gZCAmJiBkLmRlbGV0ZShiKTtiID0gTCgpO2EucGluZ2VkTGFuZXMgfD0gYS5zdXNwZW5kZWRMYW5lcyAmIGM7UiA9PT0gYSAmJiAoWiAmIGMpID09PSBjICYmICg0ID09PSBUIHx8IDMgPT09IFQgJiYgKFogJiAxMzAwMjM0MjQpID09PSBaICYmIDUwMCA+IEIoKSAtIGdrID8gTGsoYSwgMCkgOiBzayB8PSBjKTtFayhhLCBiKTt9ZnVuY3Rpb24gWmsoYSwgYikgezAgPT09IGIgJiYgKDAgPT09IChhLm1vZGUgJiAxKSA/IGIgPSAxIDogKGIgPSBzYywgc2MgPDw9IDEsIDAgPT09IChzYyAmIDEzMDAyMzQyNCkgJiYgKHNjID0gNDE5NDMwNCkpKTt2YXIgYyA9IEwoKTthID0gWmcoYSwgYik7bnVsbCAhPT0gYSAmJiAoQWMoYSwgYiwgYyksIEVrKGEsIGMpKTt9ZnVuY3Rpb24gdmooYSkge3ZhciBiID0gYS5tZW1vaXplZFN0YXRlLGMgPSAwO251bGwgIT09IGIgJiYgKGMgPSBiLnJldHJ5TGFuZSk7WmsoYSwgYyk7fQogICAgICAgICAgZnVuY3Rpb24gY2soYSwgYikge3ZhciBjID0gMDtzd2l0Y2ggKGEudGFnKSB7Y2FzZSAxMzp2YXIgZCA9IGEuc3RhdGVOb2RlO3ZhciBlID0gYS5tZW1vaXplZFN0YXRlO251bGwgIT09IGUgJiYgKGMgPSBlLnJldHJ5TGFuZSk7YnJlYWs7Y2FzZSAxOTpkID0gYS5zdGF0ZU5vZGU7YnJlYWs7ZGVmYXVsdDp0aHJvdyBFcnJvcihwKDMxNCkpO31udWxsICE9PSBkICYmIGQuZGVsZXRlKGIpO1prKGEsIGMpO312YXIgV2s7CiAgICAgICAgICBXayA9IGZ1bmN0aW9uIFdrKGEsIGIsIGMpIHtpZiAobnVsbCAhPT0gYSkge2lmIChhLm1lbW9pemVkUHJvcHMgIT09IGIucGVuZGluZ1Byb3BzIHx8IFdmLmN1cnJlbnQpIFVnID0gITA7ZWxzZSB7aWYgKDAgPT09IChhLmxhbmVzICYgYykgJiYgMCA9PT0gKGIuZmxhZ3MgJiAxMjgpKSByZXR1cm4gVWcgPSAhMSwgemooYSwgYiwgYyk7VWcgPSAwICE9PSAoYS5mbGFncyAmIDEzMTA3MikgPyAhMCA6ICExO319IGVsc2UgVWcgPSAhMSwgSSAmJiAwICE9PSAoYi5mbGFncyAmIDEwNDg1NzYpICYmIHVnKGIsIG5nLCBiLmluZGV4KTtiLmxhbmVzID0gMDtzd2l0Y2ggKGIudGFnKSB7Y2FzZSAyOnZhciBkID0gYi50eXBlO2pqKGEsIGIpO2EgPSBiLnBlbmRpbmdQcm9wczt2YXIgZSA9IFlmKGIsIEguY3VycmVudCk7VGcoYiwgYyk7ZSA9IFhoKG51bGwsIGIsIGQsIGEsIGUsIGMpO3ZhciBmID0gYmkoKTtiLmZsYWdzIHw9IDE7Im9iamVjdCIgPT09IHR5cGVvZiBlICYmIG51bGwgIT09IGUgJiYgImZ1bmN0aW9uIiA9PT0gdHlwZW9mIGUucmVuZGVyICYmIHZvaWQgMCA9PT0gZS4kJHR5cGVvZiA/IChiLnRhZyA9IDEsIGIubWVtb2l6ZWRTdGF0ZSA9IG51bGwsIGIudXBkYXRlUXVldWUgPQogICAgICAgICAgICAgICAgbnVsbCwgWmYoZCkgPyAoZiA9ICEwLCBjZyhiKSkgOiBmID0gITEsIGIubWVtb2l6ZWRTdGF0ZSA9IG51bGwgIT09IGUuc3RhdGUgJiYgdm9pZCAwICE9PSBlLnN0YXRlID8gZS5zdGF0ZSA6IG51bGwsIGFoKGIpLCBlLnVwZGF0ZXIgPSBuaCwgYi5zdGF0ZU5vZGUgPSBlLCBlLl9yZWFjdEludGVybmFscyA9IGIsIHJoKGIsIGQsIGEsIGMpLCBiID0ga2oobnVsbCwgYiwgZCwgITAsIGYsIGMpKSA6IChiLnRhZyA9IDAsIEkgJiYgZiAmJiB2ZyhiKSwgWWkobnVsbCwgYiwgZSwgYyksIGIgPSBiLmNoaWxkKTtyZXR1cm4gYjtjYXNlIDE2OmQgPSBiLmVsZW1lbnRUeXBlO2E6IHtqaihhLCBiKTthID0gYi5wZW5kaW5nUHJvcHM7ZSA9IGQuX2luaXQ7ZCA9IGUoZC5fcGF5bG9hZCk7Yi50eXBlID0gZDtlID0gYi50YWcgPSAkayhkKTthID0gTGcoZCwgYSk7c3dpdGNoIChlKSB7Y2FzZSAwOmIgPSBkaihudWxsLCBiLCBkLCBhLCBjKTticmVhayBhO2Nhc2UgMTpiID0gaWoobnVsbCwgYiwgZCwgYSwgYyk7YnJlYWsgYTtjYXNlIDExOmIgPSBaaShudWxsLCBiLCBkLCBhLCBjKTticmVhayBhO2Nhc2UgMTQ6YiA9IGFqKG51bGwsIGIsIGQsIExnKGQudHlwZSwgYSksIGMpO2JyZWFrIGE7fXRocm93IEVycm9yKHAoMzA2LAogICAgICAgICAgICAgICAgICBkLCAiIikpO31yZXR1cm4gYjtjYXNlIDA6cmV0dXJuIGQgPSBiLnR5cGUsIGUgPSBiLnBlbmRpbmdQcm9wcywgZSA9IGIuZWxlbWVudFR5cGUgPT09IGQgPyBlIDogTGcoZCwgZSksIGRqKGEsIGIsIGQsIGUsIGMpO2Nhc2UgMTpyZXR1cm4gZCA9IGIudHlwZSwgZSA9IGIucGVuZGluZ1Byb3BzLCBlID0gYi5lbGVtZW50VHlwZSA9PT0gZCA/IGUgOiBMZyhkLCBlKSwgaWooYSwgYiwgZCwgZSwgYyk7Y2FzZSAzOmE6IHtsaihiKTtpZiAobnVsbCA9PT0gYSkgdGhyb3cgRXJyb3IocCgzODcpKTtkID0gYi5wZW5kaW5nUHJvcHM7ZiA9IGIubWVtb2l6ZWRTdGF0ZTtlID0gZi5lbGVtZW50O2JoKGEsIGIpO2doKGIsIGQsIG51bGwsIGMpO3ZhciBnID0gYi5tZW1vaXplZFN0YXRlO2QgPSBnLmVsZW1lbnQ7aWYgKGYuaXNEZWh5ZHJhdGVkKSB7aWYgKGYgPSB7IGVsZW1lbnQ6IGQsIGlzRGVoeWRyYXRlZDogITEsIGNhY2hlOiBnLmNhY2hlLCBwZW5kaW5nU3VzcGVuc2VCb3VuZGFyaWVzOiBnLnBlbmRpbmdTdXNwZW5zZUJvdW5kYXJpZXMsIHRyYW5zaXRpb25zOiBnLnRyYW5zaXRpb25zIH0sIGIudXBkYXRlUXVldWUuYmFzZVN0YXRlID0KICAgICAgICAgICAgICAgICAgICBmLCBiLm1lbW9pemVkU3RhdGUgPSBmLCBiLmZsYWdzICYgMjU2KSB7ZSA9IEtpKEVycm9yKHAoNDIzKSksIGIpO2IgPSBtaihhLCBiLCBkLCBjLCBlKTticmVhayBhO30gZWxzZSBpZiAoZCAhPT0gZSkge2UgPSBLaShFcnJvcihwKDQyNCkpLCBiKTtiID0gbWooYSwgYiwgZCwgYywgZSk7YnJlYWsgYTt9IGVsc2UgZm9yICh5ZyA9IExmKGIuc3RhdGVOb2RlLmNvbnRhaW5lckluZm8uZmlyc3RDaGlsZCksIHhnID0gYiwgSSA9ICEwLCB6ZyA9IG51bGwsIGMgPSBDaChiLCBudWxsLCBkLCBjKSwgYi5jaGlsZCA9IGM7IGM7KSBjLmZsYWdzID0gYy5mbGFncyAmIC0zIHwgNDA5NiwgYyA9IGMuc2libGluZzt9IGVsc2Uge0lnKCk7aWYgKGQgPT09IGUpIHtiID0gJGkoYSwgYiwgYyk7YnJlYWsgYTt9WWkoYSwgYiwgZCwgYyk7fWIgPSBiLmNoaWxkO31yZXR1cm4gYjtjYXNlIDU6cmV0dXJuIEtoKGIpLCBudWxsID09PSBhICYmIEVnKGIpLCBkID0gYi50eXBlLCBlID0gYi5wZW5kaW5nUHJvcHMsIGYgPSBudWxsICE9PSBhID8gYS5tZW1vaXplZFByb3BzIDogbnVsbCwgZyA9IGUuY2hpbGRyZW4sIEVmKGQsIGUpID8gZyA9IG51bGwgOiBudWxsICE9PSBmICYmIEVmKGQsIGYpICYmIChiLmZsYWdzIHw9IDMyKSwKICAgICAgICAgICAgICAgIGhqKGEsIGIpLCBZaShhLCBiLCBnLCBjKSwgYi5jaGlsZDtjYXNlIDY6cmV0dXJuIG51bGwgPT09IGEgJiYgRWcoYiksIG51bGw7Y2FzZSAxMzpyZXR1cm4gcGooYSwgYiwgYyk7Y2FzZSA0OnJldHVybiBJaChiLCBiLnN0YXRlTm9kZS5jb250YWluZXJJbmZvKSwgZCA9IGIucGVuZGluZ1Byb3BzLCBudWxsID09PSBhID8gYi5jaGlsZCA9IEJoKGIsIG51bGwsIGQsIGMpIDogWWkoYSwgYiwgZCwgYyksIGIuY2hpbGQ7Y2FzZSAxMTpyZXR1cm4gZCA9IGIudHlwZSwgZSA9IGIucGVuZGluZ1Byb3BzLCBlID0gYi5lbGVtZW50VHlwZSA9PT0gZCA/IGUgOiBMZyhkLCBlKSwgWmkoYSwgYiwgZCwgZSwgYyk7Y2FzZSA3OnJldHVybiBZaShhLCBiLCBiLnBlbmRpbmdQcm9wcywgYyksIGIuY2hpbGQ7Y2FzZSA4OnJldHVybiBZaShhLCBiLCBiLnBlbmRpbmdQcm9wcy5jaGlsZHJlbiwgYyksIGIuY2hpbGQ7Y2FzZSAxMjpyZXR1cm4gWWkoYSwgYiwgYi5wZW5kaW5nUHJvcHMuY2hpbGRyZW4sIGMpLCBiLmNoaWxkO2Nhc2UgMTA6YToge2QgPSBiLnR5cGUuX2NvbnRleHQ7ZSA9IGIucGVuZGluZ1Byb3BzO2YgPSBiLm1lbW9pemVkUHJvcHM7CiAgICAgICAgICAgICAgICAgIGcgPSBlLnZhbHVlO0coTWcsIGQuX2N1cnJlbnRWYWx1ZSk7ZC5fY3VycmVudFZhbHVlID0gZztpZiAobnVsbCAhPT0gZikgaWYgKEhlKGYudmFsdWUsIGcpKSB7aWYgKGYuY2hpbGRyZW4gPT09IGUuY2hpbGRyZW4gJiYgIVdmLmN1cnJlbnQpIHtiID0gJGkoYSwgYiwgYyk7YnJlYWsgYTt9fSBlbHNlIGZvciAoZiA9IGIuY2hpbGQsIG51bGwgIT09IGYgJiYgKGYucmV0dXJuID0gYik7IG51bGwgIT09IGY7KSB7dmFyIGggPSBmLmRlcGVuZGVuY2llcztpZiAobnVsbCAhPT0gaCkge2cgPSBmLmNoaWxkO2ZvciAodmFyIGsgPSBoLmZpcnN0Q29udGV4dDsgbnVsbCAhPT0gazspIHtpZiAoay5jb250ZXh0ID09PSBkKSB7aWYgKDEgPT09IGYudGFnKSB7ayA9IGNoKC0xLCBjICYgLWMpO2sudGFnID0gMjt2YXIgbCA9IGYudXBkYXRlUXVldWU7aWYgKG51bGwgIT09IGwpIHtsID0gbC5zaGFyZWQ7dmFyIG0gPSBsLnBlbmRpbmc7bnVsbCA9PT0gbSA/IGsubmV4dCA9IGsgOiAoay5uZXh0ID0gbS5uZXh0LCBtLm5leHQgPSBrKTtsLnBlbmRpbmcgPSBrO319Zi5sYW5lcyB8PSBjO2sgPSBmLmFsdGVybmF0ZTtudWxsICE9PSBrICYmIChrLmxhbmVzIHw9IGMpO1NnKGYucmV0dXJuLAogICAgICAgICAgICAgICAgICAgICAgICAgIGMsIGIpO2gubGFuZXMgfD0gYzticmVhazt9ayA9IGsubmV4dDt9fSBlbHNlIGlmICgxMCA9PT0gZi50YWcpIGcgPSBmLnR5cGUgPT09IGIudHlwZSA/IG51bGwgOiBmLmNoaWxkO2Vsc2UgaWYgKDE4ID09PSBmLnRhZykge2cgPSBmLnJldHVybjtpZiAobnVsbCA9PT0gZykgdGhyb3cgRXJyb3IocCgzNDEpKTtnLmxhbmVzIHw9IGM7aCA9IGcuYWx0ZXJuYXRlO251bGwgIT09IGggJiYgKGgubGFuZXMgfD0gYyk7U2coZywgYywgYik7ZyA9IGYuc2libGluZzt9IGVsc2UgZyA9IGYuY2hpbGQ7aWYgKG51bGwgIT09IGcpIGcucmV0dXJuID0gZjtlbHNlIGZvciAoZyA9IGY7IG51bGwgIT09IGc7KSB7aWYgKGcgPT09IGIpIHtnID0gbnVsbDticmVhazt9ZiA9IGcuc2libGluZztpZiAobnVsbCAhPT0gZikge2YucmV0dXJuID0gZy5yZXR1cm47ZyA9IGY7YnJlYWs7fWcgPSBnLnJldHVybjt9ZiA9IGc7fVlpKGEsIGIsIGUuY2hpbGRyZW4sIGMpO2IgPSBiLmNoaWxkO31yZXR1cm4gYjtjYXNlIDk6cmV0dXJuIGUgPSBiLnR5cGUsIGQgPSBiLnBlbmRpbmdQcm9wcy5jaGlsZHJlbiwgVGcoYiwgYyksIGUgPSBWZyhlKSwgZCA9IGQoZSksIGIuZmxhZ3MgfD0gMSwgWWkoYSwgYiwgZCwgYyksCiAgICAgICAgICAgICAgICBiLmNoaWxkO2Nhc2UgMTQ6cmV0dXJuIGQgPSBiLnR5cGUsIGUgPSBMZyhkLCBiLnBlbmRpbmdQcm9wcyksIGUgPSBMZyhkLnR5cGUsIGUpLCBhaihhLCBiLCBkLCBlLCBjKTtjYXNlIDE1OnJldHVybiBjaihhLCBiLCBiLnR5cGUsIGIucGVuZGluZ1Byb3BzLCBjKTtjYXNlIDE3OnJldHVybiBkID0gYi50eXBlLCBlID0gYi5wZW5kaW5nUHJvcHMsIGUgPSBiLmVsZW1lbnRUeXBlID09PSBkID8gZSA6IExnKGQsIGUpLCBqaihhLCBiKSwgYi50YWcgPSAxLCBaZihkKSA/IChhID0gITAsIGNnKGIpKSA6IGEgPSAhMSwgVGcoYiwgYyksIHBoKGIsIGQsIGUpLCByaChiLCBkLCBlLCBjKSwga2oobnVsbCwgYiwgZCwgITAsIGEsIGMpO2Nhc2UgMTk6cmV0dXJuIHlqKGEsIGIsIGMpO2Nhc2UgMjI6cmV0dXJuIGVqKGEsIGIsIGMpO310aHJvdyBFcnJvcihwKDE1NiwgYi50YWcpKTt9O2Z1bmN0aW9uIEdrKGEsIGIpIHtyZXR1cm4gYWMoYSwgYik7fQogICAgICAgICAgZnVuY3Rpb24gYWwoYSwgYiwgYywgZCkge3RoaXMudGFnID0gYTt0aGlzLmtleSA9IGM7dGhpcy5zaWJsaW5nID0gdGhpcy5jaGlsZCA9IHRoaXMucmV0dXJuID0gdGhpcy5zdGF0ZU5vZGUgPSB0aGlzLnR5cGUgPSB0aGlzLmVsZW1lbnRUeXBlID0gbnVsbDt0aGlzLmluZGV4ID0gMDt0aGlzLnJlZiA9IG51bGw7dGhpcy5wZW5kaW5nUHJvcHMgPSBiO3RoaXMuZGVwZW5kZW5jaWVzID0gdGhpcy5tZW1vaXplZFN0YXRlID0gdGhpcy51cGRhdGVRdWV1ZSA9IHRoaXMubWVtb2l6ZWRQcm9wcyA9IG51bGw7dGhpcy5tb2RlID0gZDt0aGlzLnN1YnRyZWVGbGFncyA9IHRoaXMuZmxhZ3MgPSAwO3RoaXMuZGVsZXRpb25zID0gbnVsbDt0aGlzLmNoaWxkTGFuZXMgPSB0aGlzLmxhbmVzID0gMDt0aGlzLmFsdGVybmF0ZSA9IG51bGw7fWZ1bmN0aW9uIEJnKGEsIGIsIGMsIGQpIHtyZXR1cm4gbmV3IGFsKGEsIGIsIGMsIGQpO31mdW5jdGlvbiBiaihhKSB7YSA9IGEucHJvdG90eXBlO3JldHVybiAhKCFhIHx8ICFhLmlzUmVhY3RDb21wb25lbnQpO30KICAgICAgICAgIGZ1bmN0aW9uICRrKGEpIHtpZiAoImZ1bmN0aW9uIiA9PT0gdHlwZW9mIGEpIHJldHVybiBiaihhKSA/IDEgOiAwO2lmICh2b2lkIDAgIT09IGEgJiYgbnVsbCAhPT0gYSkge2EgPSBhLiQkdHlwZW9mO2lmIChhID09PSBEYSkgcmV0dXJuIDExO2lmIChhID09PSBHYSkgcmV0dXJuIDE0O31yZXR1cm4gMjt9CiAgICAgICAgICBmdW5jdGlvbiB3aChhLCBiKSB7dmFyIGMgPSBhLmFsdGVybmF0ZTtudWxsID09PSBjID8gKGMgPSBCZyhhLnRhZywgYiwgYS5rZXksIGEubW9kZSksIGMuZWxlbWVudFR5cGUgPSBhLmVsZW1lbnRUeXBlLCBjLnR5cGUgPSBhLnR5cGUsIGMuc3RhdGVOb2RlID0gYS5zdGF0ZU5vZGUsIGMuYWx0ZXJuYXRlID0gYSwgYS5hbHRlcm5hdGUgPSBjKSA6IChjLnBlbmRpbmdQcm9wcyA9IGIsIGMudHlwZSA9IGEudHlwZSwgYy5mbGFncyA9IDAsIGMuc3VidHJlZUZsYWdzID0gMCwgYy5kZWxldGlvbnMgPSBudWxsKTtjLmZsYWdzID0gYS5mbGFncyAmIDE0NjgwMDY0O2MuY2hpbGRMYW5lcyA9IGEuY2hpbGRMYW5lcztjLmxhbmVzID0gYS5sYW5lcztjLmNoaWxkID0gYS5jaGlsZDtjLm1lbW9pemVkUHJvcHMgPSBhLm1lbW9pemVkUHJvcHM7Yy5tZW1vaXplZFN0YXRlID0gYS5tZW1vaXplZFN0YXRlO2MudXBkYXRlUXVldWUgPSBhLnVwZGF0ZVF1ZXVlO2IgPSBhLmRlcGVuZGVuY2llcztjLmRlcGVuZGVuY2llcyA9IG51bGwgPT09IGIgPyBudWxsIDogeyBsYW5lczogYi5sYW5lcywgZmlyc3RDb250ZXh0OiBiLmZpcnN0Q29udGV4dCB9OwogICAgICAgICAgICBjLnNpYmxpbmcgPSBhLnNpYmxpbmc7Yy5pbmRleCA9IGEuaW5kZXg7Yy5yZWYgPSBhLnJlZjtyZXR1cm4gYzt9CiAgICAgICAgICBmdW5jdGlvbiB5aChhLCBiLCBjLCBkLCBlLCBmKSB7dmFyIGcgPSAyO2QgPSBhO2lmICgiZnVuY3Rpb24iID09PSB0eXBlb2YgYSkgYmooYSkgJiYgKGcgPSAxKTtlbHNlIGlmICgic3RyaW5nIiA9PT0gdHlwZW9mIGEpIGcgPSA1O2Vsc2UgYTogc3dpdGNoIChhKSB7Y2FzZSB5YTpyZXR1cm4gQWgoYy5jaGlsZHJlbiwgZSwgZiwgYik7Y2FzZSB6YTpnID0gODtlIHw9IDg7YnJlYWs7Y2FzZSBBYTpyZXR1cm4gYSA9IEJnKDEyLCBjLCBiLCBlIHwgMiksIGEuZWxlbWVudFR5cGUgPSBBYSwgYS5sYW5lcyA9IGYsIGE7Y2FzZSBFYTpyZXR1cm4gYSA9IEJnKDEzLCBjLCBiLCBlKSwgYS5lbGVtZW50VHlwZSA9IEVhLCBhLmxhbmVzID0gZiwgYTtjYXNlIEZhOnJldHVybiBhID0gQmcoMTksIGMsIGIsIGUpLCBhLmVsZW1lbnRUeXBlID0gRmEsIGEubGFuZXMgPSBmLCBhO2Nhc2UgSWE6cmV0dXJuIHFqKGMsIGUsIGYsIGIpO2RlZmF1bHQ6aWYgKCJvYmplY3QiID09PSB0eXBlb2YgYSAmJiBudWxsICE9PSBhKSBzd2l0Y2ggKGEuJCR0eXBlb2YpIHtjYXNlIEJhOmcgPSAxMDticmVhayBhO2Nhc2UgQ2E6ZyA9IDk7YnJlYWsgYTtjYXNlIERhOmcgPSAxMTsKICAgICAgICAgICAgICAgICAgICBicmVhayBhO2Nhc2UgR2E6ZyA9IDE0O2JyZWFrIGE7Y2FzZSBIYTpnID0gMTY7ZCA9IG51bGw7YnJlYWsgYTt9dGhyb3cgRXJyb3IocCgxMzAsIG51bGwgPT0gYSA/IGEgOiB0eXBlb2YgYSwgIiIpKTt9YiA9IEJnKGcsIGMsIGIsIGUpO2IuZWxlbWVudFR5cGUgPSBhO2IudHlwZSA9IGQ7Yi5sYW5lcyA9IGY7cmV0dXJuIGI7fWZ1bmN0aW9uIEFoKGEsIGIsIGMsIGQpIHthID0gQmcoNywgYSwgZCwgYik7YS5sYW5lcyA9IGM7cmV0dXJuIGE7fWZ1bmN0aW9uIHFqKGEsIGIsIGMsIGQpIHthID0gQmcoMjIsIGEsIGQsIGIpO2EuZWxlbWVudFR5cGUgPSBJYTthLmxhbmVzID0gYzthLnN0YXRlTm9kZSA9IHsgaXNIaWRkZW46ICExIH07cmV0dXJuIGE7fWZ1bmN0aW9uIHhoKGEsIGIsIGMpIHthID0gQmcoNiwgYSwgbnVsbCwgYik7YS5sYW5lcyA9IGM7cmV0dXJuIGE7fQogICAgICAgICAgZnVuY3Rpb24gemgoYSwgYiwgYykge2IgPSBCZyg0LCBudWxsICE9PSBhLmNoaWxkcmVuID8gYS5jaGlsZHJlbiA6IFtdLCBhLmtleSwgYik7Yi5sYW5lcyA9IGM7Yi5zdGF0ZU5vZGUgPSB7IGNvbnRhaW5lckluZm86IGEuY29udGFpbmVySW5mbywgcGVuZGluZ0NoaWxkcmVuOiBudWxsLCBpbXBsZW1lbnRhdGlvbjogYS5pbXBsZW1lbnRhdGlvbiB9O3JldHVybiBiO30KICAgICAgICAgIGZ1bmN0aW9uIGJsKGEsIGIsIGMsIGQsIGUpIHt0aGlzLnRhZyA9IGI7dGhpcy5jb250YWluZXJJbmZvID0gYTt0aGlzLmZpbmlzaGVkV29yayA9IHRoaXMucGluZ0NhY2hlID0gdGhpcy5jdXJyZW50ID0gdGhpcy5wZW5kaW5nQ2hpbGRyZW4gPSBudWxsO3RoaXMudGltZW91dEhhbmRsZSA9IC0xO3RoaXMuY2FsbGJhY2tOb2RlID0gdGhpcy5wZW5kaW5nQ29udGV4dCA9IHRoaXMuY29udGV4dCA9IG51bGw7dGhpcy5jYWxsYmFja1ByaW9yaXR5ID0gMDt0aGlzLmV2ZW50VGltZXMgPSB6YygwKTt0aGlzLmV4cGlyYXRpb25UaW1lcyA9IHpjKC0xKTt0aGlzLmVudGFuZ2xlZExhbmVzID0gdGhpcy5maW5pc2hlZExhbmVzID0gdGhpcy5tdXRhYmxlUmVhZExhbmVzID0gdGhpcy5leHBpcmVkTGFuZXMgPSB0aGlzLnBpbmdlZExhbmVzID0gdGhpcy5zdXNwZW5kZWRMYW5lcyA9IHRoaXMucGVuZGluZ0xhbmVzID0gMDt0aGlzLmVudGFuZ2xlbWVudHMgPSB6YygwKTt0aGlzLmlkZW50aWZpZXJQcmVmaXggPSBkO3RoaXMub25SZWNvdmVyYWJsZUVycm9yID0gZTt0aGlzLm11dGFibGVTb3VyY2VFYWdlckh5ZHJhdGlvbkRhdGEgPQogICAgICAgICAgICBudWxsO31mdW5jdGlvbiBjbChhLCBiLCBjLCBkLCBlLCBmLCBnLCBoLCBrKSB7YSA9IG5ldyBibChhLCBiLCBjLCBoLCBrKTsxID09PSBiID8gKGIgPSAxLCAhMCA9PT0gZiAmJiAoYiB8PSA4KSkgOiBiID0gMDtmID0gQmcoMywgbnVsbCwgbnVsbCwgYik7YS5jdXJyZW50ID0gZjtmLnN0YXRlTm9kZSA9IGE7Zi5tZW1vaXplZFN0YXRlID0geyBlbGVtZW50OiBkLCBpc0RlaHlkcmF0ZWQ6IGMsIGNhY2hlOiBudWxsLCB0cmFuc2l0aW9uczogbnVsbCwgcGVuZGluZ1N1c3BlbnNlQm91bmRhcmllczogbnVsbCB9O2FoKGYpO3JldHVybiBhO31mdW5jdGlvbiBkbChhLCBiLCBjKSB7dmFyIGQgPSAzIDwgYXJndW1lbnRzLmxlbmd0aCAmJiB2b2lkIDAgIT09IGFyZ3VtZW50c1szXSA/IGFyZ3VtZW50c1szXSA6IG51bGw7cmV0dXJuIHsgJCR0eXBlb2Y6IHdhLCBrZXk6IG51bGwgPT0gZCA/IG51bGwgOiAiIiArIGQsIGNoaWxkcmVuOiBhLCBjb250YWluZXJJbmZvOiBiLCBpbXBsZW1lbnRhdGlvbjogYyB9O30KICAgICAgICAgIGZ1bmN0aW9uIGVsKGEpIHtpZiAoIWEpIHJldHVybiBWZjthID0gYS5fcmVhY3RJbnRlcm5hbHM7YToge2lmIChWYihhKSAhPT0gYSB8fCAxICE9PSBhLnRhZykgdGhyb3cgRXJyb3IocCgxNzApKTt2YXIgYiA9IGE7ZG8ge3N3aXRjaCAoYi50YWcpIHtjYXNlIDM6YiA9IGIuc3RhdGVOb2RlLmNvbnRleHQ7YnJlYWsgYTtjYXNlIDE6aWYgKFpmKGIudHlwZSkpIHtiID0gYi5zdGF0ZU5vZGUuX19yZWFjdEludGVybmFsTWVtb2l6ZWRNZXJnZWRDaGlsZENvbnRleHQ7YnJlYWsgYTt9fWIgPSBiLnJldHVybjt9IHdoaWxlIChudWxsICE9PSBiKTt0aHJvdyBFcnJvcihwKDE3MSkpO31pZiAoMSA9PT0gYS50YWcpIHt2YXIgYyA9IGEudHlwZTtpZiAoWmYoYykpIHJldHVybiBiZyhhLCBjLCBiKTt9cmV0dXJuIGI7fQogICAgICAgICAgZnVuY3Rpb24gZmwoYSwgYiwgYywgZCwgZSwgZiwgZywgaCwgaykge2EgPSBjbChjLCBkLCAhMCwgYSwgZSwgZiwgZywgaCwgayk7YS5jb250ZXh0ID0gZWwobnVsbCk7YyA9IGEuY3VycmVudDtkID0gTCgpO2UgPSBsaChjKTtmID0gY2goZCwgZSk7Zi5jYWxsYmFjayA9IHZvaWQgMCAhPT0gYiAmJiBudWxsICE9PSBiID8gYiA6IG51bGw7ZGgoYywgZiwgZSk7YS5jdXJyZW50LmxhbmVzID0gZTtBYyhhLCBlLCBkKTtFayhhLCBkKTtyZXR1cm4gYTt9ZnVuY3Rpb24gZ2woYSwgYiwgYywgZCkge3ZhciBlID0gYi5jdXJyZW50LGYgPSBMKCksZyA9IGxoKGUpO2MgPSBlbChjKTtudWxsID09PSBiLmNvbnRleHQgPyBiLmNvbnRleHQgPSBjIDogYi5wZW5kaW5nQ29udGV4dCA9IGM7YiA9IGNoKGYsIGcpO2IucGF5bG9hZCA9IHsgZWxlbWVudDogYSB9O2QgPSB2b2lkIDAgPT09IGQgPyBudWxsIDogZDtudWxsICE9PSBkICYmIChiLmNhbGxiYWNrID0gZCk7YSA9IGRoKGUsIGIsIGcpO251bGwgIT09IGEgJiYgKG1oKGEsIGUsIGcsIGYpLCBlaChhLCBlLCBnKSk7cmV0dXJuIGc7fQogICAgICAgICAgZnVuY3Rpb24gaGwoYSkge2EgPSBhLmN1cnJlbnQ7aWYgKCFhLmNoaWxkKSByZXR1cm4gbnVsbDtzd2l0Y2ggKGEuY2hpbGQudGFnKSB7Y2FzZSA1OnJldHVybiBhLmNoaWxkLnN0YXRlTm9kZTtkZWZhdWx0OnJldHVybiBhLmNoaWxkLnN0YXRlTm9kZTt9fWZ1bmN0aW9uIGlsKGEsIGIpIHthID0gYS5tZW1vaXplZFN0YXRlO2lmIChudWxsICE9PSBhICYmIG51bGwgIT09IGEuZGVoeWRyYXRlZCkge3ZhciBjID0gYS5yZXRyeUxhbmU7YS5yZXRyeUxhbmUgPSAwICE9PSBjICYmIGMgPCBiID8gYyA6IGI7fX1mdW5jdGlvbiBqbChhLCBiKSB7aWwoYSwgYik7KGEgPSBhLmFsdGVybmF0ZSkgJiYgaWwoYSwgYik7fWZ1bmN0aW9uIGtsKCkge3JldHVybiBudWxsO312YXIgbGwgPSAiZnVuY3Rpb24iID09PSB0eXBlb2YgcmVwb3J0RXJyb3IgPyByZXBvcnRFcnJvciA6IGZ1bmN0aW9uIChhKSB7Y29uc29sZS5lcnJvcihhKTt9O2Z1bmN0aW9uIG1sKGEpIHt0aGlzLl9pbnRlcm5hbFJvb3QgPSBhO30KICAgICAgICAgIG5sLnByb3RvdHlwZS5yZW5kZXIgPSBtbC5wcm90b3R5cGUucmVuZGVyID0gZnVuY3Rpb24gKGEpIHt2YXIgYiA9IHRoaXMuX2ludGVybmFsUm9vdDtpZiAobnVsbCA9PT0gYikgdGhyb3cgRXJyb3IocCg0MDkpKTtnbChhLCBiLCBudWxsLCBudWxsKTt9O25sLnByb3RvdHlwZS51bm1vdW50ID0gbWwucHJvdG90eXBlLnVubW91bnQgPSBmdW5jdGlvbiAoKSB7dmFyIGEgPSB0aGlzLl9pbnRlcm5hbFJvb3Q7aWYgKG51bGwgIT09IGEpIHt0aGlzLl9pbnRlcm5hbFJvb3QgPSBudWxsO3ZhciBiID0gYS5jb250YWluZXJJbmZvO1NrKGZ1bmN0aW9uICgpIHtnbChudWxsLCBhLCBudWxsLCBudWxsKTt9KTtiW3VmXSA9IG51bGw7fX07ZnVuY3Rpb24gbmwoYSkge3RoaXMuX2ludGVybmFsUm9vdCA9IGE7fQogICAgICAgICAgbmwucHJvdG90eXBlLnVuc3RhYmxlX3NjaGVkdWxlSHlkcmF0aW9uID0gZnVuY3Rpb24gKGEpIHtpZiAoYSkge3ZhciBiID0gSGMoKTthID0geyBibG9ja2VkT246IG51bGwsIHRhcmdldDogYSwgcHJpb3JpdHk6IGIgfTtmb3IgKHZhciBjID0gMDsgYyA8IFFjLmxlbmd0aCAmJiAwICE9PSBiICYmIGIgPCBRY1tjXS5wcmlvcml0eTsgYysrKTtRYy5zcGxpY2UoYywgMCwgYSk7MCA9PT0gYyAmJiBWYyhhKTt9fTtmdW5jdGlvbiBvbChhKSB7cmV0dXJuICEoIWEgfHwgMSAhPT0gYS5ub2RlVHlwZSAmJiA5ICE9PSBhLm5vZGVUeXBlICYmIDExICE9PSBhLm5vZGVUeXBlKTt9ZnVuY3Rpb24gcGwoYSkge3JldHVybiAhKCFhIHx8IDEgIT09IGEubm9kZVR5cGUgJiYgOSAhPT0gYS5ub2RlVHlwZSAmJiAxMSAhPT0gYS5ub2RlVHlwZSAmJiAoOCAhPT0gYS5ub2RlVHlwZSB8fCAiIHJlYWN0LW1vdW50LXBvaW50LXVuc3RhYmxlICIgIT09IGEubm9kZVZhbHVlKSk7fWZ1bmN0aW9uIHFsKCkge30KICAgICAgICAgIGZ1bmN0aW9uIHJsKGEsIGIsIGMsIGQsIGUpIHtpZiAoZSkge2lmICgiZnVuY3Rpb24iID09PSB0eXBlb2YgZCkge3ZhciBmID0gZDtkID0gZnVuY3Rpb24gZCgpIHt2YXIgYSA9IGhsKGcpO2YuY2FsbChhKTt9O312YXIgZyA9IGZsKGIsIGQsIGEsIDAsIG51bGwsICExLCAhMSwgIiIsIHFsKTthLl9yZWFjdFJvb3RDb250YWluZXIgPSBnO2FbdWZdID0gZy5jdXJyZW50O3NmKDggPT09IGEubm9kZVR5cGUgPyBhLnBhcmVudE5vZGUgOiBhKTtTaygpO3JldHVybiBnO31mb3IgKDsgZSA9IGEubGFzdENoaWxkOykgYS5yZW1vdmVDaGlsZChlKTtpZiAoImZ1bmN0aW9uIiA9PT0gdHlwZW9mIGQpIHt2YXIgaCA9IGQ7ZCA9IGZ1bmN0aW9uIGQoKSB7dmFyIGEgPSBobChrKTtoLmNhbGwoYSk7fTt9dmFyIGsgPSBjbChhLCAwLCAhMSwgbnVsbCwgbnVsbCwgITEsICExLCAiIiwgcWwpO2EuX3JlYWN0Um9vdENvbnRhaW5lciA9IGs7YVt1Zl0gPSBrLmN1cnJlbnQ7c2YoOCA9PT0gYS5ub2RlVHlwZSA/IGEucGFyZW50Tm9kZSA6IGEpO1NrKGZ1bmN0aW9uICgpIHtnbChiLCBrLCBjLCBkKTt9KTtyZXR1cm4gazt9CiAgICAgICAgICBmdW5jdGlvbiBzbChhLCBiLCBjLCBkLCBlKSB7dmFyIGYgPSBjLl9yZWFjdFJvb3RDb250YWluZXI7aWYgKGYpIHt2YXIgZyA9IGY7aWYgKCJmdW5jdGlvbiIgPT09IHR5cGVvZiBlKSB7dmFyIGggPSBlO2UgPSBmdW5jdGlvbiBlKCkge3ZhciBhID0gaGwoZyk7aC5jYWxsKGEpO307fWdsKGIsIGcsIGEsIGUpO30gZWxzZSBnID0gcmwoYywgYiwgYSwgZSwgZCk7cmV0dXJuIGhsKGcpO31FYyA9IGZ1bmN0aW9uIEVjKGEpIHtzd2l0Y2ggKGEudGFnKSB7Y2FzZSAzOnZhciBiID0gYS5zdGF0ZU5vZGU7aWYgKGIuY3VycmVudC5tZW1vaXplZFN0YXRlLmlzRGVoeWRyYXRlZCkge3ZhciBjID0gdGMoYi5wZW5kaW5nTGFuZXMpOzAgIT09IGMgJiYgKENjKGIsIGMgfCAxKSwgRWsoYiwgQigpKSwgMCA9PT0gKEsgJiA2KSAmJiAoSGogPSBCKCkgKyA1MDAsIGpnKCkpKTt9YnJlYWs7Y2FzZSAxMzpTayhmdW5jdGlvbiAoKSB7dmFyIGIgPSBaZyhhLCAxKTtpZiAobnVsbCAhPT0gYikge3ZhciBjID0gTCgpO21oKGIsIGEsIDEsIGMpO319KSwgamwoYSwgMSk7fX07CiAgICAgICAgICBGYyA9IGZ1bmN0aW9uIEZjKGEpIHtpZiAoMTMgPT09IGEudGFnKSB7dmFyIGIgPSBaZyhhLCAxMzQyMTc3MjgpO2lmIChudWxsICE9PSBiKSB7dmFyIGMgPSBMKCk7bWgoYiwgYSwgMTM0MjE3NzI4LCBjKTt9amwoYSwgMTM0MjE3NzI4KTt9fTtHYyA9IGZ1bmN0aW9uIEdjKGEpIHtpZiAoMTMgPT09IGEudGFnKSB7dmFyIGIgPSBsaChhKSxjID0gWmcoYSwgYik7aWYgKG51bGwgIT09IGMpIHt2YXIgZCA9IEwoKTttaChjLCBhLCBiLCBkKTt9amwoYSwgYik7fX07SGMgPSBmdW5jdGlvbiBIYygpIHtyZXR1cm4gQzt9O0ljID0gZnVuY3Rpb24gSWMoYSwgYikge3ZhciBjID0gQzt0cnkge3JldHVybiBDID0gYSwgYigpO30gZmluYWxseSB7QyA9IGM7fX07CiAgICAgICAgICB5YiA9IGZ1bmN0aW9uIHliKGEsIGIsIGMpIHtzd2l0Y2ggKGIpIHtjYXNlICJpbnB1dCI6YmIoYSwgYyk7YiA9IGMubmFtZTtpZiAoInJhZGlvIiA9PT0gYy50eXBlICYmIG51bGwgIT0gYikge2ZvciAoYyA9IGE7IGMucGFyZW50Tm9kZTspIGMgPSBjLnBhcmVudE5vZGU7YyA9IGMucXVlcnlTZWxlY3RvckFsbCgiaW5wdXRbbmFtZT0iICsgSlNPTi5zdHJpbmdpZnkoIiIgKyBiKSArICddW3R5cGU9InJhZGlvIl0nKTtmb3IgKGIgPSAwOyBiIDwgYy5sZW5ndGg7IGIrKykge3ZhciBkID0gY1tiXTtpZiAoZCAhPT0gYSAmJiBkLmZvcm0gPT09IGEuZm9ybSkge3ZhciBlID0gRGIoZCk7aWYgKCFlKSB0aHJvdyBFcnJvcihwKDkwKSk7V2EoZCk7YmIoZCwgZSk7fX19YnJlYWs7Y2FzZSAidGV4dGFyZWEiOmliKGEsIGMpO2JyZWFrO2Nhc2UgInNlbGVjdCI6YiA9IGMudmFsdWUsIG51bGwgIT0gYiAmJiBmYihhLCAhIWMubXVsdGlwbGUsIGIsICExKTt9fTtHYiA9IFJrO0hiID0gU2s7CiAgICAgICAgICB2YXIgdGwgPSB7IHVzaW5nQ2xpZW50RW50cnlQb2ludDogITEsIEV2ZW50czogW0NiLCB1ZSwgRGIsIEViLCBGYiwgUmtdIH0sdWwgPSB7IGZpbmRGaWJlckJ5SG9zdEluc3RhbmNlOiBXYywgYnVuZGxlVHlwZTogMCwgdmVyc2lvbjogIjE4LjIuMCIsIHJlbmRlcmVyUGFja2FnZU5hbWU6ICJyZWFjdC1kb20iIH07CiAgICAgICAgICB2YXIgdmwgPSB7IGJ1bmRsZVR5cGU6IHVsLmJ1bmRsZVR5cGUsIHZlcnNpb246IHVsLnZlcnNpb24sIHJlbmRlcmVyUGFja2FnZU5hbWU6IHVsLnJlbmRlcmVyUGFja2FnZU5hbWUsIHJlbmRlcmVyQ29uZmlnOiB1bC5yZW5kZXJlckNvbmZpZywgb3ZlcnJpZGVIb29rU3RhdGU6IG51bGwsIG92ZXJyaWRlSG9va1N0YXRlRGVsZXRlUGF0aDogbnVsbCwgb3ZlcnJpZGVIb29rU3RhdGVSZW5hbWVQYXRoOiBudWxsLCBvdmVycmlkZVByb3BzOiBudWxsLCBvdmVycmlkZVByb3BzRGVsZXRlUGF0aDogbnVsbCwgb3ZlcnJpZGVQcm9wc1JlbmFtZVBhdGg6IG51bGwsIHNldEVycm9ySGFuZGxlcjogbnVsbCwgc2V0U3VzcGVuc2VIYW5kbGVyOiBudWxsLCBzY2hlZHVsZVVwZGF0ZTogbnVsbCwgY3VycmVudERpc3BhdGNoZXJSZWY6IHVhLlJlYWN0Q3VycmVudERpc3BhdGNoZXIsIGZpbmRIb3N0SW5zdGFuY2VCeUZpYmVyOiBmdW5jdGlvbiBmaW5kSG9zdEluc3RhbmNlQnlGaWJlcihhKSB7YSA9IFpiKGEpO3JldHVybiBudWxsID09PSBhID8gbnVsbCA6IGEuc3RhdGVOb2RlO30sIGZpbmRGaWJlckJ5SG9zdEluc3RhbmNlOiB1bC5maW5kRmliZXJCeUhvc3RJbnN0YW5jZSB8fAogICAgICAgICAgICBrbCwgZmluZEhvc3RJbnN0YW5jZXNGb3JSZWZyZXNoOiBudWxsLCBzY2hlZHVsZVJlZnJlc2g6IG51bGwsIHNjaGVkdWxlUm9vdDogbnVsbCwgc2V0UmVmcmVzaEhhbmRsZXI6IG51bGwsIGdldEN1cnJlbnRGaWJlcjogbnVsbCwgcmVjb25jaWxlclZlcnNpb246ICIxOC4yLjAtbmV4dC05ZTNiNzcyYjgtMjAyMjA2MDgiIH07aWYgKCJ1bmRlZmluZWQiICE9PSB0eXBlb2YgX19SRUFDVF9ERVZUT09MU19HTE9CQUxfSE9PS19fKSB7dmFyIHdsID0gX19SRUFDVF9ERVZUT09MU19HTE9CQUxfSE9PS19fO2lmICghd2wuaXNEaXNhYmxlZCAmJiB3bC5zdXBwb3J0c0ZpYmVyKSB0cnkge2tjID0gd2wuaW5qZWN0KHZsKSwgbGMgPSB3bDt9IGNhdGNoIChhKSB7fX1leHBvcnRzLl9fU0VDUkVUX0lOVEVSTkFMU19ET19OT1RfVVNFX09SX1lPVV9XSUxMX0JFX0ZJUkVEID0gdGw7CiAgICAgICAgICBleHBvcnRzLmNyZWF0ZVBvcnRhbCA9IGZ1bmN0aW9uIChhLCBiKSB7dmFyIGMgPSAyIDwgYXJndW1lbnRzLmxlbmd0aCAmJiB2b2lkIDAgIT09IGFyZ3VtZW50c1syXSA/IGFyZ3VtZW50c1syXSA6IG51bGw7aWYgKCFvbChiKSkgdGhyb3cgRXJyb3IocCgyMDApKTtyZXR1cm4gZGwoYSwgYiwgbnVsbCwgYyk7fTtleHBvcnRzLmNyZWF0ZVJvb3QgPSBmdW5jdGlvbiAoYSwgYikge2lmICghb2woYSkpIHRocm93IEVycm9yKHAoMjk5KSk7dmFyIGMgPSAhMSxkID0gIiIsZSA9IGxsO251bGwgIT09IGIgJiYgdm9pZCAwICE9PSBiICYmICghMCA9PT0gYi51bnN0YWJsZV9zdHJpY3RNb2RlICYmIChjID0gITApLCB2b2lkIDAgIT09IGIuaWRlbnRpZmllclByZWZpeCAmJiAoZCA9IGIuaWRlbnRpZmllclByZWZpeCksIHZvaWQgMCAhPT0gYi5vblJlY292ZXJhYmxlRXJyb3IgJiYgKGUgPSBiLm9uUmVjb3ZlcmFibGVFcnJvcikpO2IgPSBjbChhLCAxLCAhMSwgbnVsbCwgbnVsbCwgYywgITEsIGQsIGUpO2FbdWZdID0gYi5jdXJyZW50O3NmKDggPT09IGEubm9kZVR5cGUgPyBhLnBhcmVudE5vZGUgOiBhKTtyZXR1cm4gbmV3IG1sKGIpO307CiAgICAgICAgICBleHBvcnRzLmZpbmRET01Ob2RlID0gZnVuY3Rpb24gKGEpIHtpZiAobnVsbCA9PSBhKSByZXR1cm4gbnVsbDtpZiAoMSA9PT0gYS5ub2RlVHlwZSkgcmV0dXJuIGE7dmFyIGIgPSBhLl9yZWFjdEludGVybmFscztpZiAodm9pZCAwID09PSBiKSB7aWYgKCJmdW5jdGlvbiIgPT09IHR5cGVvZiBhLnJlbmRlcikgdGhyb3cgRXJyb3IocCgxODgpKTthID0gT2JqZWN0LmtleXMoYSkuam9pbigiLCIpO3Rocm93IEVycm9yKHAoMjY4LCBhKSk7fWEgPSBaYihiKTthID0gbnVsbCA9PT0gYSA/IG51bGwgOiBhLnN0YXRlTm9kZTtyZXR1cm4gYTt9O2V4cG9ydHMuZmx1c2hTeW5jID0gZnVuY3Rpb24gKGEpIHtyZXR1cm4gU2soYSk7fTtleHBvcnRzLmh5ZHJhdGUgPSBmdW5jdGlvbiAoYSwgYiwgYykge2lmICghcGwoYikpIHRocm93IEVycm9yKHAoMjAwKSk7cmV0dXJuIHNsKG51bGwsIGEsIGIsICEwLCBjKTt9OwogICAgICAgICAgZXhwb3J0cy5oeWRyYXRlUm9vdCA9IGZ1bmN0aW9uIChhLCBiLCBjKSB7aWYgKCFvbChhKSkgdGhyb3cgRXJyb3IocCg0MDUpKTt2YXIgZCA9IG51bGwgIT0gYyAmJiBjLmh5ZHJhdGVkU291cmNlcyB8fCBudWxsLGUgPSAhMSxmID0gIiIsZyA9IGxsO251bGwgIT09IGMgJiYgdm9pZCAwICE9PSBjICYmICghMCA9PT0gYy51bnN0YWJsZV9zdHJpY3RNb2RlICYmIChlID0gITApLCB2b2lkIDAgIT09IGMuaWRlbnRpZmllclByZWZpeCAmJiAoZiA9IGMuaWRlbnRpZmllclByZWZpeCksIHZvaWQgMCAhPT0gYy5vblJlY292ZXJhYmxlRXJyb3IgJiYgKGcgPSBjLm9uUmVjb3ZlcmFibGVFcnJvcikpO2IgPSBmbChiLCBudWxsLCBhLCAxLCBudWxsICE9IGMgPyBjIDogbnVsbCwgZSwgITEsIGYsIGcpO2FbdWZdID0gYi5jdXJyZW50O3NmKGEpO2lmIChkKSBmb3IgKGEgPSAwOyBhIDwgZC5sZW5ndGg7IGErKykgYyA9IGRbYV0sIGUgPSBjLl9nZXRWZXJzaW9uLCBlID0gZShjLl9zb3VyY2UpLCBudWxsID09IGIubXV0YWJsZVNvdXJjZUVhZ2VySHlkcmF0aW9uRGF0YSA/IGIubXV0YWJsZVNvdXJjZUVhZ2VySHlkcmF0aW9uRGF0YSA9IFtjLCBlXSA6IGIubXV0YWJsZVNvdXJjZUVhZ2VySHlkcmF0aW9uRGF0YS5wdXNoKGMsCiAgICAgICAgICAgIGUpO3JldHVybiBuZXcgbmwoYik7fTtleHBvcnRzLnJlbmRlciA9IGZ1bmN0aW9uIChhLCBiLCBjKSB7aWYgKCFwbChiKSkgdGhyb3cgRXJyb3IocCgyMDApKTtyZXR1cm4gc2wobnVsbCwgYSwgYiwgITEsIGMpO307ZXhwb3J0cy51bm1vdW50Q29tcG9uZW50QXROb2RlID0gZnVuY3Rpb24gKGEpIHtpZiAoIXBsKGEpKSB0aHJvdyBFcnJvcihwKDQwKSk7cmV0dXJuIGEuX3JlYWN0Um9vdENvbnRhaW5lciA/IChTayhmdW5jdGlvbiAoKSB7c2wobnVsbCwgbnVsbCwgYSwgITEsIGZ1bmN0aW9uICgpIHthLl9yZWFjdFJvb3RDb250YWluZXIgPSBudWxsO2FbdWZdID0gbnVsbDt9KTt9KSwgITApIDogITE7fTtleHBvcnRzLnVuc3RhYmxlX2JhdGNoZWRVcGRhdGVzID0gUms7CiAgICAgICAgICBleHBvcnRzLnVuc3RhYmxlX3JlbmRlclN1YnRyZWVJbnRvQ29udGFpbmVyID0gZnVuY3Rpb24gKGEsIGIsIGMsIGQpIHtpZiAoIXBsKGMpKSB0aHJvdyBFcnJvcihwKDIwMCkpO2lmIChudWxsID09IGEgfHwgdm9pZCAwID09PSBhLl9yZWFjdEludGVybmFscykgdGhyb3cgRXJyb3IocCgzOCkpO3JldHVybiBzbChhLCBiLCBjLCAhMSwgZCk7fTtleHBvcnRzLnZlcnNpb24gPSAiMTguMi4wLW5leHQtOWUzYjc3MmI4LTIwMjIwNjA4IjsKCgogICAgICAgICAgLyoqKi99LAoKICAgICAgICAvKioqLzc0NToKICAgICAgICAvKioqLyhfX3VudXNlZF93ZWJwYWNrX21vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgPT4gewoKICAgICAgICAgIHZhciBfX3dlYnBhY2tfdW51c2VkX2V4cG9ydF9fOwoKCiAgICAgICAgICB2YXIgbSA9IF9fd2VicGFja19yZXF1aXJlX18oOTM1KTsKICAgICAgICAgIGlmICh0cnVlKSB7CiAgICAgICAgICAgIGV4cG9ydHMucyA9IG0uY3JlYXRlUm9vdDsKICAgICAgICAgICAgX193ZWJwYWNrX3VudXNlZF9leHBvcnRfXyA9IG0uaHlkcmF0ZVJvb3Q7CiAgICAgICAgICB9IGVsc2Uge3ZhciBpO30KCgogICAgICAgICAgLyoqKi99LAoKICAgICAgICAvKioqLzkzNToKICAgICAgICAvKioqLyhtb2R1bGUsIF9fdW51c2VkX3dlYnBhY2tfZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgPT4gewoKCgogICAgICAgICAgZnVuY3Rpb24gY2hlY2tEQ0UoKSB7CiAgICAgICAgICAgIC8qIGdsb2JhbCBfX1JFQUNUX0RFVlRPT0xTX0dMT0JBTF9IT09LX18gKi8KICAgICAgICAgICAgaWYgKAogICAgICAgICAgICB0eXBlb2YgX19SRUFDVF9ERVZUT09MU19HTE9CQUxfSE9PS19fID09PSAndW5kZWZpbmVkJyB8fAogICAgICAgICAgICB0eXBlb2YgX19SRUFDVF9ERVZUT09MU19HTE9CQUxfSE9PS19fLmNoZWNrRENFICE9PSAnZnVuY3Rpb24nKQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChmYWxzZSkge30KICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAvLyBWZXJpZnkgdGhhdCB0aGUgY29kZSBhYm92ZSBoYXMgYmVlbiBkZWFkIGNvZGUgZWxpbWluYXRlZCAoRENFJ2QpLgogICAgICAgICAgICAgIF9fUkVBQ1RfREVWVE9PTFNfR0xPQkFMX0hPT0tfXy5jaGVja0RDRShjaGVja0RDRSk7CiAgICAgICAgICAgIH0gY2F0Y2ggKGVycikgewogICAgICAgICAgICAgIC8vIERldlRvb2xzIHNob3VsZG4ndCBjcmFzaCBSZWFjdCwgbm8gbWF0dGVyIHdoYXQuCiAgICAgICAgICAgICAgLy8gV2Ugc2hvdWxkIHN0aWxsIHJlcG9ydCBpbiBjYXNlIHdlIGJyZWFrIHRoaXMgY29kZS4KICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKGVycik7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KCiAgICAgICAgICBpZiAodHJ1ZSkgewogICAgICAgICAgICAvLyBEQ0UgY2hlY2sgc2hvdWxkIGhhcHBlbiBiZWZvcmUgUmVhY3RET00gYnVuZGxlIGV4ZWN1dGVzIHNvIHRoYXQKICAgICAgICAgICAgLy8gRGV2VG9vbHMgY2FuIHJlcG9ydCBiYWQgbWluaWZpY2F0aW9uIGR1cmluZyBpbmplY3Rpb24uCiAgICAgICAgICAgIGNoZWNrRENFKCk7CiAgICAgICAgICAgIG1vZHVsZS5leHBvcnRzID0gX193ZWJwYWNrX3JlcXVpcmVfXyg0NDgpOwogICAgICAgICAgfSBlbHNlIHt9CgoKICAgICAgICAgIC8qKiovfSwKCiAgICAgICAgLyoqKi80MDg6CiAgICAgICAgLyoqKi8oX191bnVzZWRfd2VicGFja19tb2R1bGUsIGV4cG9ydHMpID0+IHsKCiAgICAgICAgICAvKioKICAgICAgICAgICAqIEBsaWNlbnNlIFJlYWN0CiAgICAgICAgICAgKiByZWFjdC5wcm9kdWN0aW9uLm1pbi5qcwogICAgICAgICAgICoKICAgICAgICAgICAqIENvcHlyaWdodCAoYykgRmFjZWJvb2ssIEluYy4gYW5kIGl0cyBhZmZpbGlhdGVzLgogICAgICAgICAgICoKICAgICAgICAgICAqIFRoaXMgc291cmNlIGNvZGUgaXMgbGljZW5zZWQgdW5kZXIgdGhlIE1JVCBsaWNlbnNlIGZvdW5kIGluIHRoZQogICAgICAgICAgICogTElDRU5TRSBmaWxlIGluIHRoZSByb290IGRpcmVjdG9yeSBvZiB0aGlzIHNvdXJjZSB0cmVlLgogICAgICAgICAgICovCiAgICAgICAgICB2YXIgbCA9IFN5bWJvbC5mb3IoInJlYWN0LmVsZW1lbnQiKSxuID0gU3ltYm9sLmZvcigicmVhY3QucG9ydGFsIikscCA9IFN5bWJvbC5mb3IoInJlYWN0LmZyYWdtZW50IikscSA9IFN5bWJvbC5mb3IoInJlYWN0LnN0cmljdF9tb2RlIiksciA9IFN5bWJvbC5mb3IoInJlYWN0LnByb2ZpbGVyIiksdCA9IFN5bWJvbC5mb3IoInJlYWN0LnByb3ZpZGVyIiksdSA9IFN5bWJvbC5mb3IoInJlYWN0LmNvbnRleHQiKSx2ID0gU3ltYm9sLmZvcigicmVhY3QuZm9yd2FyZF9yZWYiKSx3ID0gU3ltYm9sLmZvcigicmVhY3Quc3VzcGVuc2UiKSx4ID0gU3ltYm9sLmZvcigicmVhY3QubWVtbyIpLHkgPSBTeW1ib2wuZm9yKCJyZWFjdC5sYXp5IikseiA9IFN5bWJvbC5pdGVyYXRvcjtmdW5jdGlvbiBBKGEpIHtpZiAobnVsbCA9PT0gYSB8fCAib2JqZWN0IiAhPT0gdHlwZW9mIGEpIHJldHVybiBudWxsO2EgPSB6ICYmIGFbel0gfHwgYVsiQEBpdGVyYXRvciJdO3JldHVybiAiZnVuY3Rpb24iID09PSB0eXBlb2YgYSA/IGEgOiBudWxsO30KICAgICAgICAgIHZhciBCID0geyBpc01vdW50ZWQ6IGZ1bmN0aW9uIGlzTW91bnRlZCgpIHtyZXR1cm4gITE7fSwgZW5xdWV1ZUZvcmNlVXBkYXRlOiBmdW5jdGlvbiBlbnF1ZXVlRm9yY2VVcGRhdGUoKSB7fSwgZW5xdWV1ZVJlcGxhY2VTdGF0ZTogZnVuY3Rpb24gZW5xdWV1ZVJlcGxhY2VTdGF0ZSgpIHt9LCBlbnF1ZXVlU2V0U3RhdGU6IGZ1bmN0aW9uIGVucXVldWVTZXRTdGF0ZSgpIHt9IH0sQyA9IE9iamVjdC5hc3NpZ24sRCA9IHt9O2Z1bmN0aW9uIEUoYSwgYiwgZSkge3RoaXMucHJvcHMgPSBhO3RoaXMuY29udGV4dCA9IGI7dGhpcy5yZWZzID0gRDt0aGlzLnVwZGF0ZXIgPSBlIHx8IEI7fUUucHJvdG90eXBlLmlzUmVhY3RDb21wb25lbnQgPSB7fTsKICAgICAgICAgIEUucHJvdG90eXBlLnNldFN0YXRlID0gZnVuY3Rpb24gKGEsIGIpIHtpZiAoIm9iamVjdCIgIT09IHR5cGVvZiBhICYmICJmdW5jdGlvbiIgIT09IHR5cGVvZiBhICYmIG51bGwgIT0gYSkgdGhyb3cgRXJyb3IoInNldFN0YXRlKC4uLik6IHRha2VzIGFuIG9iamVjdCBvZiBzdGF0ZSB2YXJpYWJsZXMgdG8gdXBkYXRlIG9yIGEgZnVuY3Rpb24gd2hpY2ggcmV0dXJucyBhbiBvYmplY3Qgb2Ygc3RhdGUgdmFyaWFibGVzLiIpO3RoaXMudXBkYXRlci5lbnF1ZXVlU2V0U3RhdGUodGhpcywgYSwgYiwgInNldFN0YXRlIik7fTtFLnByb3RvdHlwZS5mb3JjZVVwZGF0ZSA9IGZ1bmN0aW9uIChhKSB7dGhpcy51cGRhdGVyLmVucXVldWVGb3JjZVVwZGF0ZSh0aGlzLCBhLCAiZm9yY2VVcGRhdGUiKTt9O2Z1bmN0aW9uIEYoKSB7fUYucHJvdG90eXBlID0gRS5wcm90b3R5cGU7ZnVuY3Rpb24gRyhhLCBiLCBlKSB7dGhpcy5wcm9wcyA9IGE7dGhpcy5jb250ZXh0ID0gYjt0aGlzLnJlZnMgPSBEO3RoaXMudXBkYXRlciA9IGUgfHwgQjt9dmFyIEggPSBHLnByb3RvdHlwZSA9IG5ldyBGKCk7CiAgICAgICAgICBILmNvbnN0cnVjdG9yID0gRztDKEgsIEUucHJvdG90eXBlKTtILmlzUHVyZVJlYWN0Q29tcG9uZW50ID0gITA7dmFyIEkgPSBBcnJheS5pc0FycmF5LEogPSBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LEsgPSB7IGN1cnJlbnQ6IG51bGwgfSxMID0geyBrZXk6ICEwLCByZWY6ICEwLCBfX3NlbGY6ICEwLCBfX3NvdXJjZTogITAgfTsKICAgICAgICAgIGZ1bmN0aW9uIE0oYSwgYiwgZSkge3ZhciBkLGMgPSB7fSxrID0gbnVsbCxoID0gbnVsbDtpZiAobnVsbCAhPSBiKSBmb3IgKGQgaW4gdm9pZCAwICE9PSBiLnJlZiAmJiAoaCA9IGIucmVmKSwgdm9pZCAwICE9PSBiLmtleSAmJiAoayA9ICIiICsgYi5rZXkpLCBiKSBKLmNhbGwoYiwgZCkgJiYgIUwuaGFzT3duUHJvcGVydHkoZCkgJiYgKGNbZF0gPSBiW2RdKTt2YXIgZyA9IGFyZ3VtZW50cy5sZW5ndGggLSAyO2lmICgxID09PSBnKSBjLmNoaWxkcmVuID0gZTtlbHNlIGlmICgxIDwgZykge2ZvciAodmFyIGYgPSBBcnJheShnKSwgbSA9IDA7IG0gPCBnOyBtKyspIGZbbV0gPSBhcmd1bWVudHNbbSArIDJdO2MuY2hpbGRyZW4gPSBmO31pZiAoYSAmJiBhLmRlZmF1bHRQcm9wcykgZm9yIChkIGluIGcgPSBhLmRlZmF1bHRQcm9wcywgZykgdm9pZCAwID09PSBjW2RdICYmIChjW2RdID0gZ1tkXSk7cmV0dXJuIHsgJCR0eXBlb2Y6IGwsIHR5cGU6IGEsIGtleTogaywgcmVmOiBoLCBwcm9wczogYywgX293bmVyOiBLLmN1cnJlbnQgfTt9CiAgICAgICAgICBmdW5jdGlvbiBOKGEsIGIpIHtyZXR1cm4geyAkJHR5cGVvZjogbCwgdHlwZTogYS50eXBlLCBrZXk6IGIsIHJlZjogYS5yZWYsIHByb3BzOiBhLnByb3BzLCBfb3duZXI6IGEuX293bmVyIH07fWZ1bmN0aW9uIE8oYSkge3JldHVybiAib2JqZWN0IiA9PT0gdHlwZW9mIGEgJiYgbnVsbCAhPT0gYSAmJiBhLiQkdHlwZW9mID09PSBsO31mdW5jdGlvbiBlc2NhcGUoYSkge3ZhciBiID0geyAiPSI6ICI9MCIsICI6IjogIj0yIiB9O3JldHVybiAiJCIgKyBhLnJlcGxhY2UoL1s9Ol0vZywgZnVuY3Rpb24gKGEpIHtyZXR1cm4gYlthXTt9KTt9dmFyIFAgPSAvXC8rL2c7ZnVuY3Rpb24gUShhLCBiKSB7cmV0dXJuICJvYmplY3QiID09PSB0eXBlb2YgYSAmJiBudWxsICE9PSBhICYmIG51bGwgIT0gYS5rZXkgPyBlc2NhcGUoIiIgKyBhLmtleSkgOiBiLnRvU3RyaW5nKDM2KTt9CiAgICAgICAgICBmdW5jdGlvbiBSKGEsIGIsIGUsIGQsIGMpIHt2YXIgayA9IHR5cGVvZiBhO2lmICgidW5kZWZpbmVkIiA9PT0gayB8fCAiYm9vbGVhbiIgPT09IGspIGEgPSBudWxsO3ZhciBoID0gITE7aWYgKG51bGwgPT09IGEpIGggPSAhMDtlbHNlIHN3aXRjaCAoaykge2Nhc2UgInN0cmluZyI6Y2FzZSAibnVtYmVyIjpoID0gITA7YnJlYWs7Y2FzZSAib2JqZWN0Ijpzd2l0Y2ggKGEuJCR0eXBlb2YpIHtjYXNlIGw6Y2FzZSBuOmggPSAhMDt9fWlmIChoKSByZXR1cm4gaCA9IGEsIGMgPSBjKGgpLCBhID0gIiIgPT09IGQgPyAiLiIgKyBRKGgsIDApIDogZCwgSShjKSA/IChlID0gIiIsIG51bGwgIT0gYSAmJiAoZSA9IGEucmVwbGFjZShQLCAiJCYvIikgKyAiLyIpLCBSKGMsIGIsIGUsICIiLCBmdW5jdGlvbiAoYSkge3JldHVybiBhO30pKSA6IG51bGwgIT0gYyAmJiAoTyhjKSAmJiAoYyA9IE4oYywgZSArICghYy5rZXkgfHwgaCAmJiBoLmtleSA9PT0gYy5rZXkgPyAiIiA6ICgiIiArIGMua2V5KS5yZXBsYWNlKFAsICIkJi8iKSArICIvIikgKyBhKSksIGIucHVzaChjKSksIDE7aCA9IDA7ZCA9ICIiID09PSBkID8gIi4iIDogZCArICI6IjtpZiAoSShhKSkgZm9yICh2YXIgZyA9IDA7IGcgPCBhLmxlbmd0aDsgZysrKSB7ayA9CiAgICAgICAgICAgICAgYVtnXTt2YXIgZiA9IGQgKyBRKGssIGcpO2ggKz0gUihrLCBiLCBlLCBmLCBjKTt9IGVsc2UgaWYgKGYgPSBBKGEpLCAiZnVuY3Rpb24iID09PSB0eXBlb2YgZikgZm9yIChhID0gZi5jYWxsKGEpLCBnID0gMDsgIShrID0gYS5uZXh0KCkpLmRvbmU7KSBrID0gay52YWx1ZSwgZiA9IGQgKyBRKGssIGcrKyksIGggKz0gUihrLCBiLCBlLCBmLCBjKTtlbHNlIGlmICgib2JqZWN0IiA9PT0gaykgdGhyb3cgYiA9IFN0cmluZyhhKSwgRXJyb3IoIk9iamVjdHMgYXJlIG5vdCB2YWxpZCBhcyBhIFJlYWN0IGNoaWxkIChmb3VuZDogIiArICgiW29iamVjdCBPYmplY3RdIiA9PT0gYiA/ICJvYmplY3Qgd2l0aCBrZXlzIHsiICsgT2JqZWN0LmtleXMoYSkuam9pbigiLCAiKSArICJ9IiA6IGIpICsgIikuIElmIHlvdSBtZWFudCB0byByZW5kZXIgYSBjb2xsZWN0aW9uIG9mIGNoaWxkcmVuLCB1c2UgYW4gYXJyYXkgaW5zdGVhZC4iKTtyZXR1cm4gaDt9CiAgICAgICAgICBmdW5jdGlvbiBTKGEsIGIsIGUpIHtpZiAobnVsbCA9PSBhKSByZXR1cm4gYTt2YXIgZCA9IFtdLGMgPSAwO1IoYSwgZCwgIiIsICIiLCBmdW5jdGlvbiAoYSkge3JldHVybiBiLmNhbGwoZSwgYSwgYysrKTt9KTtyZXR1cm4gZDt9ZnVuY3Rpb24gVChhKSB7aWYgKC0xID09PSBhLl9zdGF0dXMpIHt2YXIgYiA9IGEuX3Jlc3VsdDtiID0gYigpO2IudGhlbihmdW5jdGlvbiAoYikge2lmICgwID09PSBhLl9zdGF0dXMgfHwgLTEgPT09IGEuX3N0YXR1cykgYS5fc3RhdHVzID0gMSwgYS5fcmVzdWx0ID0gYjt9LCBmdW5jdGlvbiAoYikge2lmICgwID09PSBhLl9zdGF0dXMgfHwgLTEgPT09IGEuX3N0YXR1cykgYS5fc3RhdHVzID0gMiwgYS5fcmVzdWx0ID0gYjt9KTstMSA9PT0gYS5fc3RhdHVzICYmIChhLl9zdGF0dXMgPSAwLCBhLl9yZXN1bHQgPSBiKTt9aWYgKDEgPT09IGEuX3N0YXR1cykgcmV0dXJuIGEuX3Jlc3VsdC5kZWZhdWx0O3Rocm93IGEuX3Jlc3VsdDt9CiAgICAgICAgICB2YXIgVSA9IHsgY3VycmVudDogbnVsbCB9LFYgPSB7IHRyYW5zaXRpb246IG51bGwgfSxXID0geyBSZWFjdEN1cnJlbnREaXNwYXRjaGVyOiBVLCBSZWFjdEN1cnJlbnRCYXRjaENvbmZpZzogViwgUmVhY3RDdXJyZW50T3duZXI6IEsgfTtleHBvcnRzLkNoaWxkcmVuID0geyBtYXA6IFMsIGZvckVhY2g6IGZ1bmN0aW9uIGZvckVhY2goYSwgYiwgZSkge1MoYSwgZnVuY3Rpb24gKCkge2IuYXBwbHkodGhpcywgYXJndW1lbnRzKTt9LCBlKTt9LCBjb3VudDogZnVuY3Rpb24gY291bnQoYSkge3ZhciBiID0gMDtTKGEsIGZ1bmN0aW9uICgpIHtiKys7fSk7cmV0dXJuIGI7fSwgdG9BcnJheTogZnVuY3Rpb24gdG9BcnJheShhKSB7cmV0dXJuIFMoYSwgZnVuY3Rpb24gKGEpIHtyZXR1cm4gYTt9KSB8fCBbXTt9LCBvbmx5OiBmdW5jdGlvbiBvbmx5KGEpIHtpZiAoIU8oYSkpIHRocm93IEVycm9yKCJSZWFjdC5DaGlsZHJlbi5vbmx5IGV4cGVjdGVkIHRvIHJlY2VpdmUgYSBzaW5nbGUgUmVhY3QgZWxlbWVudCBjaGlsZC4iKTtyZXR1cm4gYTt9IH07ZXhwb3J0cy5Db21wb25lbnQgPSBFO2V4cG9ydHMuRnJhZ21lbnQgPSBwOwogICAgICAgICAgZXhwb3J0cy5Qcm9maWxlciA9IHI7ZXhwb3J0cy5QdXJlQ29tcG9uZW50ID0gRztleHBvcnRzLlN0cmljdE1vZGUgPSBxO2V4cG9ydHMuU3VzcGVuc2UgPSB3O2V4cG9ydHMuX19TRUNSRVRfSU5URVJOQUxTX0RPX05PVF9VU0VfT1JfWU9VX1dJTExfQkVfRklSRUQgPSBXOwogICAgICAgICAgZXhwb3J0cy5jbG9uZUVsZW1lbnQgPSBmdW5jdGlvbiAoYSwgYiwgZSkge2lmIChudWxsID09PSBhIHx8IHZvaWQgMCA9PT0gYSkgdGhyb3cgRXJyb3IoIlJlYWN0LmNsb25lRWxlbWVudCguLi4pOiBUaGUgYXJndW1lbnQgbXVzdCBiZSBhIFJlYWN0IGVsZW1lbnQsIGJ1dCB5b3UgcGFzc2VkICIgKyBhICsgIi4iKTt2YXIgZCA9IEMoe30sIGEucHJvcHMpLGMgPSBhLmtleSxrID0gYS5yZWYsaCA9IGEuX293bmVyO2lmIChudWxsICE9IGIpIHt2b2lkIDAgIT09IGIucmVmICYmIChrID0gYi5yZWYsIGggPSBLLmN1cnJlbnQpO3ZvaWQgMCAhPT0gYi5rZXkgJiYgKGMgPSAiIiArIGIua2V5KTtpZiAoYS50eXBlICYmIGEudHlwZS5kZWZhdWx0UHJvcHMpIHZhciBnID0gYS50eXBlLmRlZmF1bHRQcm9wcztmb3IgKGYgaW4gYikgSi5jYWxsKGIsIGYpICYmICFMLmhhc093blByb3BlcnR5KGYpICYmIChkW2ZdID0gdm9pZCAwID09PSBiW2ZdICYmIHZvaWQgMCAhPT0gZyA/IGdbZl0gOiBiW2ZdKTt9dmFyIGYgPSBhcmd1bWVudHMubGVuZ3RoIC0gMjtpZiAoMSA9PT0gZikgZC5jaGlsZHJlbiA9IGU7ZWxzZSBpZiAoMSA8IGYpIHtnID0gQXJyYXkoZik7CiAgICAgICAgICAgICAgZm9yICh2YXIgbSA9IDA7IG0gPCBmOyBtKyspIGdbbV0gPSBhcmd1bWVudHNbbSArIDJdO2QuY2hpbGRyZW4gPSBnO31yZXR1cm4geyAkJHR5cGVvZjogbCwgdHlwZTogYS50eXBlLCBrZXk6IGMsIHJlZjogaywgcHJvcHM6IGQsIF9vd25lcjogaCB9O307ZXhwb3J0cy5jcmVhdGVDb250ZXh0ID0gZnVuY3Rpb24gKGEpIHthID0geyAkJHR5cGVvZjogdSwgX2N1cnJlbnRWYWx1ZTogYSwgX2N1cnJlbnRWYWx1ZTI6IGEsIF90aHJlYWRDb3VudDogMCwgUHJvdmlkZXI6IG51bGwsIENvbnN1bWVyOiBudWxsLCBfZGVmYXVsdFZhbHVlOiBudWxsLCBfZ2xvYmFsTmFtZTogbnVsbCB9O2EuUHJvdmlkZXIgPSB7ICQkdHlwZW9mOiB0LCBfY29udGV4dDogYSB9O3JldHVybiBhLkNvbnN1bWVyID0gYTt9O2V4cG9ydHMuY3JlYXRlRWxlbWVudCA9IE07ZXhwb3J0cy5jcmVhdGVGYWN0b3J5ID0gZnVuY3Rpb24gKGEpIHt2YXIgYiA9IE0uYmluZChudWxsLCBhKTtiLnR5cGUgPSBhO3JldHVybiBiO307ZXhwb3J0cy5jcmVhdGVSZWYgPSBmdW5jdGlvbiAoKSB7cmV0dXJuIHsgY3VycmVudDogbnVsbCB9O307CiAgICAgICAgICBleHBvcnRzLmZvcndhcmRSZWYgPSBmdW5jdGlvbiAoYSkge3JldHVybiB7ICQkdHlwZW9mOiB2LCByZW5kZXI6IGEgfTt9O2V4cG9ydHMuaXNWYWxpZEVsZW1lbnQgPSBPO2V4cG9ydHMubGF6eSA9IGZ1bmN0aW9uIChhKSB7cmV0dXJuIHsgJCR0eXBlb2Y6IHksIF9wYXlsb2FkOiB7IF9zdGF0dXM6IC0xLCBfcmVzdWx0OiBhIH0sIF9pbml0OiBUIH07fTtleHBvcnRzLm1lbW8gPSBmdW5jdGlvbiAoYSwgYikge3JldHVybiB7ICQkdHlwZW9mOiB4LCB0eXBlOiBhLCBjb21wYXJlOiB2b2lkIDAgPT09IGIgPyBudWxsIDogYiB9O307ZXhwb3J0cy5zdGFydFRyYW5zaXRpb24gPSBmdW5jdGlvbiAoYSkge3ZhciBiID0gVi50cmFuc2l0aW9uO1YudHJhbnNpdGlvbiA9IHt9O3RyeSB7YSgpO30gZmluYWxseSB7Vi50cmFuc2l0aW9uID0gYjt9fTtleHBvcnRzLnVuc3RhYmxlX2FjdCA9IGZ1bmN0aW9uICgpIHt0aHJvdyBFcnJvcigiYWN0KC4uLikgaXMgbm90IHN1cHBvcnRlZCBpbiBwcm9kdWN0aW9uIGJ1aWxkcyBvZiBSZWFjdC4iKTt9OwogICAgICAgICAgZXhwb3J0cy51c2VDYWxsYmFjayA9IGZ1bmN0aW9uIChhLCBiKSB7cmV0dXJuIFUuY3VycmVudC51c2VDYWxsYmFjayhhLCBiKTt9O2V4cG9ydHMudXNlQ29udGV4dCA9IGZ1bmN0aW9uIChhKSB7cmV0dXJuIFUuY3VycmVudC51c2VDb250ZXh0KGEpO307ZXhwb3J0cy51c2VEZWJ1Z1ZhbHVlID0gZnVuY3Rpb24gKCkge307ZXhwb3J0cy51c2VEZWZlcnJlZFZhbHVlID0gZnVuY3Rpb24gKGEpIHtyZXR1cm4gVS5jdXJyZW50LnVzZURlZmVycmVkVmFsdWUoYSk7fTtleHBvcnRzLnVzZUVmZmVjdCA9IGZ1bmN0aW9uIChhLCBiKSB7cmV0dXJuIFUuY3VycmVudC51c2VFZmZlY3QoYSwgYik7fTtleHBvcnRzLnVzZUlkID0gZnVuY3Rpb24gKCkge3JldHVybiBVLmN1cnJlbnQudXNlSWQoKTt9O2V4cG9ydHMudXNlSW1wZXJhdGl2ZUhhbmRsZSA9IGZ1bmN0aW9uIChhLCBiLCBlKSB7cmV0dXJuIFUuY3VycmVudC51c2VJbXBlcmF0aXZlSGFuZGxlKGEsIGIsIGUpO307CiAgICAgICAgICBleHBvcnRzLnVzZUluc2VydGlvbkVmZmVjdCA9IGZ1bmN0aW9uIChhLCBiKSB7cmV0dXJuIFUuY3VycmVudC51c2VJbnNlcnRpb25FZmZlY3QoYSwgYik7fTtleHBvcnRzLnVzZUxheW91dEVmZmVjdCA9IGZ1bmN0aW9uIChhLCBiKSB7cmV0dXJuIFUuY3VycmVudC51c2VMYXlvdXRFZmZlY3QoYSwgYik7fTtleHBvcnRzLnVzZU1lbW8gPSBmdW5jdGlvbiAoYSwgYikge3JldHVybiBVLmN1cnJlbnQudXNlTWVtbyhhLCBiKTt9O2V4cG9ydHMudXNlUmVkdWNlciA9IGZ1bmN0aW9uIChhLCBiLCBlKSB7cmV0dXJuIFUuY3VycmVudC51c2VSZWR1Y2VyKGEsIGIsIGUpO307ZXhwb3J0cy51c2VSZWYgPSBmdW5jdGlvbiAoYSkge3JldHVybiBVLmN1cnJlbnQudXNlUmVmKGEpO307ZXhwb3J0cy51c2VTdGF0ZSA9IGZ1bmN0aW9uIChhKSB7cmV0dXJuIFUuY3VycmVudC51c2VTdGF0ZShhKTt9O2V4cG9ydHMudXNlU3luY0V4dGVybmFsU3RvcmUgPSBmdW5jdGlvbiAoYSwgYiwgZSkge3JldHVybiBVLmN1cnJlbnQudXNlU3luY0V4dGVybmFsU3RvcmUoYSwgYiwgZSk7fTsKICAgICAgICAgIGV4cG9ydHMudXNlVHJhbnNpdGlvbiA9IGZ1bmN0aW9uICgpIHtyZXR1cm4gVS5jdXJyZW50LnVzZVRyYW5zaXRpb24oKTt9O2V4cG9ydHMudmVyc2lvbiA9ICIxOC4yLjAiOwoKCiAgICAgICAgICAvKioqL30sCgogICAgICAgIC8qKiovMjk0OgogICAgICAgIC8qKiovKG1vZHVsZSwgX191bnVzZWRfd2VicGFja19leHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSA9PiB7CgoKCiAgICAgICAgICBpZiAodHJ1ZSkgewogICAgICAgICAgICBtb2R1bGUuZXhwb3J0cyA9IF9fd2VicGFja19yZXF1aXJlX18oNDA4KTsKICAgICAgICAgIH0gZWxzZSB7fQoKCiAgICAgICAgICAvKioqL30sCgogICAgICAgIC8qKiovNTM6CiAgICAgICAgLyoqKi8oX191bnVzZWRfd2VicGFja19tb2R1bGUsIGV4cG9ydHMpID0+IHsKCiAgICAgICAgICAvKioKICAgICAgICAgICAqIEBsaWNlbnNlIFJlYWN0CiAgICAgICAgICAgKiBzY2hlZHVsZXIucHJvZHVjdGlvbi5taW4uanMKICAgICAgICAgICAqCiAgICAgICAgICAgKiBDb3B5cmlnaHQgKGMpIEZhY2Vib29rLCBJbmMuIGFuZCBpdHMgYWZmaWxpYXRlcy4KICAgICAgICAgICAqCiAgICAgICAgICAgKiBUaGlzIHNvdXJjZSBjb2RlIGlzIGxpY2Vuc2VkIHVuZGVyIHRoZSBNSVQgbGljZW5zZSBmb3VuZCBpbiB0aGUKICAgICAgICAgICAqIExJQ0VOU0UgZmlsZSBpbiB0aGUgcm9vdCBkaXJlY3Rvcnkgb2YgdGhpcyBzb3VyY2UgdHJlZS4KICAgICAgICAgICAqLwogICAgICAgICAgZnVuY3Rpb24gZihhLCBiKSB7dmFyIGMgPSBhLmxlbmd0aDthLnB1c2goYik7YTogZm9yICg7IDAgPCBjOykge3ZhciBkID0gYyAtIDEgPj4+IDEsZSA9IGFbZF07aWYgKDAgPCBnKGUsIGIpKSBhW2RdID0gYiwgYVtjXSA9IGUsIGMgPSBkO2Vsc2UgYnJlYWsgYTt9fWZ1bmN0aW9uIGgoYSkge3JldHVybiAwID09PSBhLmxlbmd0aCA/IG51bGwgOiBhWzBdO31mdW5jdGlvbiBrKGEpIHtpZiAoMCA9PT0gYS5sZW5ndGgpIHJldHVybiBudWxsO3ZhciBiID0gYVswXSxjID0gYS5wb3AoKTtpZiAoYyAhPT0gYikge2FbMF0gPSBjO2E6IGZvciAodmFyIGQgPSAwLCBlID0gYS5sZW5ndGgsIHcgPSBlID4+PiAxOyBkIDwgdzspIHt2YXIgbSA9IDIgKiAoZCArIDEpIC0gMSxDID0gYVttXSxuID0gbSArIDEseCA9IGFbbl07aWYgKDAgPiBnKEMsIGMpKSBuIDwgZSAmJiAwID4gZyh4LCBDKSA/IChhW2RdID0geCwgYVtuXSA9IGMsIGQgPSBuKSA6IChhW2RdID0gQywgYVttXSA9IGMsIGQgPSBtKTtlbHNlIGlmIChuIDwgZSAmJiAwID4gZyh4LCBjKSkgYVtkXSA9IHgsIGFbbl0gPSBjLCBkID0gbjtlbHNlIGJyZWFrIGE7fX1yZXR1cm4gYjt9CiAgICAgICAgICBmdW5jdGlvbiBnKGEsIGIpIHt2YXIgYyA9IGEuc29ydEluZGV4IC0gYi5zb3J0SW5kZXg7cmV0dXJuIDAgIT09IGMgPyBjIDogYS5pZCAtIGIuaWQ7fWlmICgib2JqZWN0IiA9PT0gdHlwZW9mIHBlcmZvcm1hbmNlICYmICJmdW5jdGlvbiIgPT09IHR5cGVvZiBwZXJmb3JtYW5jZS5ub3cpIHt2YXIgbCA9IHBlcmZvcm1hbmNlO2V4cG9ydHMudW5zdGFibGVfbm93ID0gZnVuY3Rpb24gKCkge3JldHVybiBsLm5vdygpO307fSBlbHNlIHt2YXIgcCA9IERhdGUscSA9IHAubm93KCk7ZXhwb3J0cy51bnN0YWJsZV9ub3cgPSBmdW5jdGlvbiAoKSB7cmV0dXJuIHAubm93KCkgLSBxO307fXZhciByID0gW10sdCA9IFtdLHUgPSAxLHYgPSBudWxsLHkgPSAzLHogPSAhMSxBID0gITEsQiA9ICExLEQgPSAiZnVuY3Rpb24iID09PSB0eXBlb2Ygc2V0VGltZW91dCA/IHNldFRpbWVvdXQgOiBudWxsLEUgPSAiZnVuY3Rpb24iID09PSB0eXBlb2YgY2xlYXJUaW1lb3V0ID8gY2xlYXJUaW1lb3V0IDogbnVsbCxGID0gInVuZGVmaW5lZCIgIT09IHR5cGVvZiBzZXRJbW1lZGlhdGUgPyBzZXRJbW1lZGlhdGUgOiBudWxsOwogICAgICAgICAgInVuZGVmaW5lZCIgIT09IHR5cGVvZiBuYXZpZ2F0b3IgJiYgdm9pZCAwICE9PSBuYXZpZ2F0b3Iuc2NoZWR1bGluZyAmJiB2b2lkIDAgIT09IG5hdmlnYXRvci5zY2hlZHVsaW5nLmlzSW5wdXRQZW5kaW5nICYmIG5hdmlnYXRvci5zY2hlZHVsaW5nLmlzSW5wdXRQZW5kaW5nLmJpbmQobmF2aWdhdG9yLnNjaGVkdWxpbmcpO2Z1bmN0aW9uIEcoYSkge2ZvciAodmFyIGIgPSBoKHQpOyBudWxsICE9PSBiOykge2lmIChudWxsID09PSBiLmNhbGxiYWNrKSBrKHQpO2Vsc2UgaWYgKGIuc3RhcnRUaW1lIDw9IGEpIGsodCksIGIuc29ydEluZGV4ID0gYi5leHBpcmF0aW9uVGltZSwgZihyLCBiKTtlbHNlIGJyZWFrO2IgPSBoKHQpO319ZnVuY3Rpb24gSChhKSB7QiA9ICExO0coYSk7aWYgKCFBKSBpZiAobnVsbCAhPT0gaChyKSkgQSA9ICEwLCBJKEopO2Vsc2Uge3ZhciBiID0gaCh0KTtudWxsICE9PSBiICYmIEsoSCwgYi5zdGFydFRpbWUgLSBhKTt9fQogICAgICAgICAgZnVuY3Rpb24gSihhLCBiKSB7QSA9ICExO0IgJiYgKEIgPSAhMSwgRShMKSwgTCA9IC0xKTt6ID0gITA7dmFyIGMgPSB5O3RyeSB7RyhiKTtmb3IgKHYgPSBoKHIpOyBudWxsICE9PSB2ICYmICghKHYuZXhwaXJhdGlvblRpbWUgPiBiKSB8fCBhICYmICFNKCkpOykge3ZhciBkID0gdi5jYWxsYmFjaztpZiAoImZ1bmN0aW9uIiA9PT0gdHlwZW9mIGQpIHt2LmNhbGxiYWNrID0gbnVsbDt5ID0gdi5wcmlvcml0eUxldmVsO3ZhciBlID0gZCh2LmV4cGlyYXRpb25UaW1lIDw9IGIpO2IgPSBleHBvcnRzLnVuc3RhYmxlX25vdygpOyJmdW5jdGlvbiIgPT09IHR5cGVvZiBlID8gdi5jYWxsYmFjayA9IGUgOiB2ID09PSBoKHIpICYmIGsocik7RyhiKTt9IGVsc2UgayhyKTt2ID0gaChyKTt9aWYgKG51bGwgIT09IHYpIHZhciB3ID0gITA7ZWxzZSB7dmFyIG0gPSBoKHQpO251bGwgIT09IG0gJiYgSyhILCBtLnN0YXJ0VGltZSAtIGIpO3cgPSAhMTt9cmV0dXJuIHc7fSBmaW5hbGx5IHt2ID0gbnVsbCwgeSA9IGMsIHogPSAhMTt9fXZhciBOID0gITEsTyA9IG51bGwsTCA9IC0xLFAgPSA1LFEgPSAtMTsKICAgICAgICAgIGZ1bmN0aW9uIE0oKSB7cmV0dXJuIGV4cG9ydHMudW5zdGFibGVfbm93KCkgLSBRIDwgUCA/ICExIDogITA7fWZ1bmN0aW9uIFIoKSB7aWYgKG51bGwgIT09IE8pIHt2YXIgYSA9IGV4cG9ydHMudW5zdGFibGVfbm93KCk7USA9IGE7dmFyIGIgPSAhMDt0cnkge2IgPSBPKCEwLCBhKTt9IGZpbmFsbHkge2IgPyBTKCkgOiAoTiA9ICExLCBPID0gbnVsbCk7fX0gZWxzZSBOID0gITE7fXZhciBTO2lmICgiZnVuY3Rpb24iID09PSB0eXBlb2YgRikgUyA9IGZ1bmN0aW9uIFMoKSB7RihSKTt9O2Vsc2UgaWYgKCJ1bmRlZmluZWQiICE9PSB0eXBlb2YgTWVzc2FnZUNoYW5uZWwpIHt2YXIgVCA9IG5ldyBNZXNzYWdlQ2hhbm5lbCgpLFUgPSBULnBvcnQyO1QucG9ydDEub25tZXNzYWdlID0gUjtTID0gZnVuY3Rpb24gUygpIHtVLnBvc3RNZXNzYWdlKG51bGwpO307fSBlbHNlIFMgPSBmdW5jdGlvbiBTKCkge0QoUiwgMCk7fTtmdW5jdGlvbiBJKGEpIHtPID0gYTtOIHx8IChOID0gITAsIFMoKSk7fWZ1bmN0aW9uIEsoYSwgYikge0wgPSBEKGZ1bmN0aW9uICgpIHthKGV4cG9ydHMudW5zdGFibGVfbm93KCkpO30sIGIpO30KICAgICAgICAgIGV4cG9ydHMudW5zdGFibGVfSWRsZVByaW9yaXR5ID0gNTtleHBvcnRzLnVuc3RhYmxlX0ltbWVkaWF0ZVByaW9yaXR5ID0gMTtleHBvcnRzLnVuc3RhYmxlX0xvd1ByaW9yaXR5ID0gNDtleHBvcnRzLnVuc3RhYmxlX05vcm1hbFByaW9yaXR5ID0gMztleHBvcnRzLnVuc3RhYmxlX1Byb2ZpbGluZyA9IG51bGw7ZXhwb3J0cy51bnN0YWJsZV9Vc2VyQmxvY2tpbmdQcmlvcml0eSA9IDI7ZXhwb3J0cy51bnN0YWJsZV9jYW5jZWxDYWxsYmFjayA9IGZ1bmN0aW9uIChhKSB7YS5jYWxsYmFjayA9IG51bGw7fTtleHBvcnRzLnVuc3RhYmxlX2NvbnRpbnVlRXhlY3V0aW9uID0gZnVuY3Rpb24gKCkge0EgfHwgeiB8fCAoQSA9ICEwLCBJKEopKTt9OwogICAgICAgICAgZXhwb3J0cy51bnN0YWJsZV9mb3JjZUZyYW1lUmF0ZSA9IGZ1bmN0aW9uIChhKSB7MCA+IGEgfHwgMTI1IDwgYSA/IGNvbnNvbGUuZXJyb3IoImZvcmNlRnJhbWVSYXRlIHRha2VzIGEgcG9zaXRpdmUgaW50IGJldHdlZW4gMCBhbmQgMTI1LCBmb3JjaW5nIGZyYW1lIHJhdGVzIGhpZ2hlciB0aGFuIDEyNSBmcHMgaXMgbm90IHN1cHBvcnRlZCIpIDogUCA9IDAgPCBhID8gTWF0aC5mbG9vcigxRTMgLyBhKSA6IDU7fTtleHBvcnRzLnVuc3RhYmxlX2dldEN1cnJlbnRQcmlvcml0eUxldmVsID0gZnVuY3Rpb24gKCkge3JldHVybiB5O307ZXhwb3J0cy51bnN0YWJsZV9nZXRGaXJzdENhbGxiYWNrTm9kZSA9IGZ1bmN0aW9uICgpIHtyZXR1cm4gaChyKTt9O2V4cG9ydHMudW5zdGFibGVfbmV4dCA9IGZ1bmN0aW9uIChhKSB7c3dpdGNoICh5KSB7Y2FzZSAxOmNhc2UgMjpjYXNlIDM6dmFyIGIgPSAzO2JyZWFrO2RlZmF1bHQ6YiA9IHk7fXZhciBjID0geTt5ID0gYjt0cnkge3JldHVybiBhKCk7fSBmaW5hbGx5IHt5ID0gYzt9fTtleHBvcnRzLnVuc3RhYmxlX3BhdXNlRXhlY3V0aW9uID0gZnVuY3Rpb24gKCkge307CiAgICAgICAgICBleHBvcnRzLnVuc3RhYmxlX3JlcXVlc3RQYWludCA9IGZ1bmN0aW9uICgpIHt9O2V4cG9ydHMudW5zdGFibGVfcnVuV2l0aFByaW9yaXR5ID0gZnVuY3Rpb24gKGEsIGIpIHtzd2l0Y2ggKGEpIHtjYXNlIDE6Y2FzZSAyOmNhc2UgMzpjYXNlIDQ6Y2FzZSA1OmJyZWFrO2RlZmF1bHQ6YSA9IDM7fXZhciBjID0geTt5ID0gYTt0cnkge3JldHVybiBiKCk7fSBmaW5hbGx5IHt5ID0gYzt9fTsKICAgICAgICAgIGV4cG9ydHMudW5zdGFibGVfc2NoZWR1bGVDYWxsYmFjayA9IGZ1bmN0aW9uIChhLCBiLCBjKSB7dmFyIGQgPSBleHBvcnRzLnVuc3RhYmxlX25vdygpOyJvYmplY3QiID09PSB0eXBlb2YgYyAmJiBudWxsICE9PSBjID8gKGMgPSBjLmRlbGF5LCBjID0gIm51bWJlciIgPT09IHR5cGVvZiBjICYmIDAgPCBjID8gZCArIGMgOiBkKSA6IGMgPSBkO3N3aXRjaCAoYSkge2Nhc2UgMTp2YXIgZSA9IC0xO2JyZWFrO2Nhc2UgMjplID0gMjUwO2JyZWFrO2Nhc2UgNTplID0gMTA3Mzc0MTgyMzticmVhaztjYXNlIDQ6ZSA9IDFFNDticmVhaztkZWZhdWx0OmUgPSA1RTM7fWUgPSBjICsgZTthID0geyBpZDogdSsrLCBjYWxsYmFjazogYiwgcHJpb3JpdHlMZXZlbDogYSwgc3RhcnRUaW1lOiBjLCBleHBpcmF0aW9uVGltZTogZSwgc29ydEluZGV4OiAtMSB9O2MgPiBkID8gKGEuc29ydEluZGV4ID0gYywgZih0LCBhKSwgbnVsbCA9PT0gaChyKSAmJiBhID09PSBoKHQpICYmIChCID8gKEUoTCksIEwgPSAtMSkgOiBCID0gITAsIEsoSCwgYyAtIGQpKSkgOiAoYS5zb3J0SW5kZXggPSBlLCBmKHIsIGEpLCBBIHx8IHogfHwgKEEgPSAhMCwgSShKKSkpO3JldHVybiBhO307CiAgICAgICAgICBleHBvcnRzLnVuc3RhYmxlX3Nob3VsZFlpZWxkID0gTTtleHBvcnRzLnVuc3RhYmxlX3dyYXBDYWxsYmFjayA9IGZ1bmN0aW9uIChhKSB7dmFyIGIgPSB5O3JldHVybiBmdW5jdGlvbiAoKSB7dmFyIGMgPSB5O3kgPSBiO3RyeSB7cmV0dXJuIGEuYXBwbHkodGhpcywgYXJndW1lbnRzKTt9IGZpbmFsbHkge3kgPSBjO319O307CgoKICAgICAgICAgIC8qKiovfSwKCiAgICAgICAgLyoqKi84NDA6CiAgICAgICAgLyoqKi8obW9kdWxlLCBfX3VudXNlZF93ZWJwYWNrX2V4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pID0+IHsKCgoKICAgICAgICAgIGlmICh0cnVlKSB7CiAgICAgICAgICAgIG1vZHVsZS5leHBvcnRzID0gX193ZWJwYWNrX3JlcXVpcmVfXyg1Myk7CiAgICAgICAgICB9IGVsc2Uge30KCgogICAgICAgICAgLyoqKi99CgogICAgICAgIC8qKioqKiovIH07CiAgICAgIC8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovCiAgICAgIC8qKioqKiovIC8vIFRoZSBtb2R1bGUgY2FjaGUKICAgICAgLyoqKioqKi92YXIgX193ZWJwYWNrX21vZHVsZV9jYWNoZV9fID0ge307CiAgICAgIC8qKioqKiovCiAgICAgIC8qKioqKiovIC8vIFRoZSByZXF1aXJlIGZ1bmN0aW9uCiAgICAgIC8qKioqKiovZnVuY3Rpb24gX193ZWJwYWNrX3JlcXVpcmVfXyhtb2R1bGVJZCkgewogICAgICAgIC8qKioqKiovIC8vIENoZWNrIGlmIG1vZHVsZSBpcyBpbiBjYWNoZQogICAgICAgIC8qKioqKiovdmFyIGNhY2hlZE1vZHVsZSA9IF9fd2VicGFja19tb2R1bGVfY2FjaGVfX1ttb2R1bGVJZF07CiAgICAgICAgLyoqKioqKi9pZiAoY2FjaGVkTW9kdWxlICE9PSB1bmRlZmluZWQpIHsKICAgICAgICAgIC8qKioqKiovcmV0dXJuIGNhY2hlZE1vZHVsZS5leHBvcnRzOwogICAgICAgICAgLyoqKioqKi99CiAgICAgICAgLyoqKioqKi8gLy8gQ3JlYXRlIGEgbmV3IG1vZHVsZSAoYW5kIHB1dCBpdCBpbnRvIHRoZSBjYWNoZSkKICAgICAgICAvKioqKioqL3ZhciBtb2R1bGUgPSBfX3dlYnBhY2tfbW9kdWxlX2NhY2hlX19bbW9kdWxlSWRdID0gewogICAgICAgICAgLyoqKioqKi8gLy8gbm8gbW9kdWxlLmlkIG5lZWRlZAogICAgICAgICAgLyoqKioqKi8gLy8gbm8gbW9kdWxlLmxvYWRlZCBuZWVkZWQKICAgICAgICAgIC8qKioqKiovZXhwb3J0czoge30KICAgICAgICAgIC8qKioqKiovIH07CiAgICAgICAgLyoqKioqKi8KICAgICAgICAvKioqKioqLyAvLyBFeGVjdXRlIHRoZSBtb2R1bGUgZnVuY3Rpb24KICAgICAgICAvKioqKioqL19fd2VicGFja19tb2R1bGVzX19bbW9kdWxlSWRdKG1vZHVsZSwgbW9kdWxlLmV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pOwogICAgICAgIC8qKioqKiovCiAgICAgICAgLyoqKioqKi8gLy8gUmV0dXJuIHRoZSBleHBvcnRzIG9mIHRoZSBtb2R1bGUKICAgICAgICAvKioqKioqL3JldHVybiBtb2R1bGUuZXhwb3J0czsKICAgICAgICAvKioqKioqL30KICAgICAgLyoqKioqKi8KICAgICAgLyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi8KICAgICAgLyoqKioqKi8gLyogd2VicGFjay9ydW50aW1lL2NyZWF0ZSBmYWtlIG5hbWVzcGFjZSBvYmplY3QgKi8KICAgICAgLyoqKioqKi8oKCkgPT4gewogICAgICAgIC8qKioqKiovdmFyIGdldFByb3RvID0gT2JqZWN0LmdldFByb3RvdHlwZU9mID8gKG9iaikgPT4gT2JqZWN0LmdldFByb3RvdHlwZU9mKG9iaikgOiAob2JqKSA9PiBvYmouX19wcm90b19fOwogICAgICAgIC8qKioqKiovdmFyIGxlYWZQcm90b3R5cGVzOwogICAgICAgIC8qKioqKiovIC8vIGNyZWF0ZSBhIGZha2UgbmFtZXNwYWNlIG9iamVjdAogICAgICAgIC8qKioqKiovIC8vIG1vZGUgJiAxOiB2YWx1ZSBpcyBhIG1vZHVsZSBpZCwgcmVxdWlyZSBpdAogICAgICAgIC8qKioqKiovIC8vIG1vZGUgJiAyOiBtZXJnZSBhbGwgcHJvcGVydGllcyBvZiB2YWx1ZSBpbnRvIHRoZSBucwogICAgICAgIC8qKioqKiovIC8vIG1vZGUgJiA0OiByZXR1cm4gdmFsdWUgd2hlbiBhbHJlYWR5IG5zIG9iamVjdAogICAgICAgIC8qKioqKiovIC8vIG1vZGUgJiAxNjogcmV0dXJuIHZhbHVlIHdoZW4gaXQncyBQcm9taXNlLWxpa2UKICAgICAgICAvKioqKioqLyAvLyBtb2RlICYgOHwxOiBiZWhhdmUgbGlrZSByZXF1aXJlCiAgICAgICAgLyoqKioqKi9fX3dlYnBhY2tfcmVxdWlyZV9fLnQgPSBmdW5jdGlvbiAodmFsdWUsIG1vZGUpIHsKICAgICAgICAgIC8qKioqKiovaWYgKG1vZGUgJiAxKSB2YWx1ZSA9IHRoaXModmFsdWUpOwogICAgICAgICAgLyoqKioqKi9pZiAobW9kZSAmIDgpIHJldHVybiB2YWx1ZTsKICAgICAgICAgIC8qKioqKiovaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ29iamVjdCcgJiYgdmFsdWUpIHsKICAgICAgICAgICAgLyoqKioqKi9pZiAobW9kZSAmIDQgJiYgdmFsdWUuX19lc01vZHVsZSkgcmV0dXJuIHZhbHVlOwogICAgICAgICAgICAvKioqKioqL2lmIChtb2RlICYgMTYgJiYgdHlwZW9mIHZhbHVlLnRoZW4gPT09ICdmdW5jdGlvbicpIHJldHVybiB2YWx1ZTsKICAgICAgICAgICAgLyoqKioqKi99CiAgICAgICAgICAvKioqKioqL3ZhciBucyA9IE9iamVjdC5jcmVhdGUobnVsbCk7CiAgICAgICAgICAvKioqKioqL19fd2VicGFja19yZXF1aXJlX18ucihucyk7CiAgICAgICAgICAvKioqKioqL3ZhciBkZWYgPSB7fTsKICAgICAgICAgIC8qKioqKiovbGVhZlByb3RvdHlwZXMgPSBsZWFmUHJvdG90eXBlcyB8fCBbbnVsbCwgZ2V0UHJvdG8oe30pLCBnZXRQcm90byhbXSksIGdldFByb3RvKGdldFByb3RvKV07CiAgICAgICAgICAvKioqKioqL2ZvciAodmFyIGN1cnJlbnQgPSBtb2RlICYgMiAmJiB2YWx1ZTsgdHlwZW9mIGN1cnJlbnQgPT0gJ29iamVjdCcgJiYgIX5sZWFmUHJvdG90eXBlcy5pbmRleE9mKGN1cnJlbnQpOyBjdXJyZW50ID0gZ2V0UHJvdG8oY3VycmVudCkpIHsKICAgICAgICAgICAgLyoqKioqKi9PYmplY3QuZ2V0T3duUHJvcGVydHlOYW1lcyhjdXJyZW50KS5mb3JFYWNoKChrZXkpID0+IGRlZltrZXldID0gKCkgPT4gdmFsdWVba2V5XSk7CiAgICAgICAgICAgIC8qKioqKiovfQogICAgICAgICAgLyoqKioqKi9kZWZbJ2RlZmF1bHQnXSA9ICgpID0+IHZhbHVlOwogICAgICAgICAgLyoqKioqKi9fX3dlYnBhY2tfcmVxdWlyZV9fLmQobnMsIGRlZik7CiAgICAgICAgICAvKioqKioqL3JldHVybiBuczsKICAgICAgICAgIC8qKioqKiovfTsKICAgICAgICAvKioqKioqL30pKCk7CiAgICAgIC8qKioqKiovCiAgICAgIC8qKioqKiovIC8qIHdlYnBhY2svcnVudGltZS9kZWZpbmUgcHJvcGVydHkgZ2V0dGVycyAqLwogICAgICAvKioqKioqLygoKSA9PiB7CiAgICAgICAgLyoqKioqKi8gLy8gZGVmaW5lIGdldHRlciBmdW5jdGlvbnMgZm9yIGhhcm1vbnkgZXhwb3J0cwogICAgICAgIC8qKioqKiovX193ZWJwYWNrX3JlcXVpcmVfXy5kID0gKGV4cG9ydHMsIGRlZmluaXRpb24pID0+IHsKICAgICAgICAgIC8qKioqKiovZm9yICh2YXIga2V5IGluIGRlZmluaXRpb24pIHsKICAgICAgICAgICAgLyoqKioqKi9pZiAoX193ZWJwYWNrX3JlcXVpcmVfXy5vKGRlZmluaXRpb24sIGtleSkgJiYgIV9fd2VicGFja19yZXF1aXJlX18ubyhleHBvcnRzLCBrZXkpKSB7CiAgICAgICAgICAgICAgLyoqKioqKi9PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywga2V5LCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZGVmaW5pdGlvbltrZXldIH0pOwogICAgICAgICAgICAgIC8qKioqKiovfQogICAgICAgICAgICAvKioqKioqL30KICAgICAgICAgIC8qKioqKiovfTsKICAgICAgICAvKioqKioqL30pKCk7CiAgICAgIC8qKioqKiovCiAgICAgIC8qKioqKiovIC8qIHdlYnBhY2svcnVudGltZS9oYXNPd25Qcm9wZXJ0eSBzaG9ydGhhbmQgKi8KICAgICAgLyoqKioqKi8oKCkgPT4gewogICAgICAgIC8qKioqKiovX193ZWJwYWNrX3JlcXVpcmVfXy5vID0gKG9iaiwgcHJvcCkgPT4gT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG9iaiwgcHJvcCk7CiAgICAgICAgLyoqKioqKi99KSgpOwogICAgICAvKioqKioqLwogICAgICAvKioqKioqLyAvKiB3ZWJwYWNrL3J1bnRpbWUvbWFrZSBuYW1lc3BhY2Ugb2JqZWN0ICovCiAgICAgIC8qKioqKiovKCgpID0+IHsKICAgICAgICAvKioqKioqLyAvLyBkZWZpbmUgX19lc01vZHVsZSBvbiBleHBvcnRzCiAgICAgICAgLyoqKioqKi9fX3dlYnBhY2tfcmVxdWlyZV9fLnIgPSAoZXhwb3J0cykgPT4gewogICAgICAgICAgLyoqKioqKi9pZiAodHlwZW9mIFN5bWJvbCAhPT0gJ3VuZGVmaW5lZCcgJiYgU3ltYm9sLnRvU3RyaW5nVGFnKSB7CiAgICAgICAgICAgIC8qKioqKiovT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFN5bWJvbC50b1N0cmluZ1RhZywgeyB2YWx1ZTogJ01vZHVsZScgfSk7CiAgICAgICAgICAgIC8qKioqKiovfQogICAgICAgICAgLyoqKioqKi9PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgJ19fZXNNb2R1bGUnLCB7IHZhbHVlOiB0cnVlIH0pOwogICAgICAgICAgLyoqKioqKi99OwogICAgICAgIC8qKioqKiovfSkoKTsKICAgICAgLyoqKioqKi8KICAgICAgLyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi8KICAgICAgdmFyIF9fd2VicGFja19leHBvcnRzX18gPSB7fTsKICAgICAgLy8gVGhpcyBlbnRyeSBuZWVkIHRvIGJlIHdyYXBwZWQgaW4gYW4gSUlGRSBiZWNhdXNlIGl0IG5lZWQgdG8gYmUgaXNvbGF0ZWQgYWdhaW5zdCBvdGhlciBtb2R1bGVzIGluIHRoZSBjaHVuay4KICAgICAgKCgpID0+IHsKICAgICAgICBfX3dlYnBhY2tfcmVxdWlyZV9fLnIoX193ZWJwYWNrX2V4cG9ydHNfXyk7CiAgICAgICAgLyogaGFybW9ueSBpbXBvcnQgKi92YXIgX0FwcF9fV0VCUEFDS19JTVBPUlRFRF9NT0RVTEVfMF9fID0gX193ZWJwYWNrX3JlcXVpcmVfXygyNDIpOwogICAgICAgIC8qIGhhcm1vbnkgaW1wb3J0ICovdmFyIHJlYWN0X2RvbV9jbGllbnRfX1dFQlBBQ0tfSU1QT1JURURfTU9EVUxFXzFfXyA9IF9fd2VicGFja19yZXF1aXJlX18oNzQ1KTsKICAgICAgICAvKiBoYXJtb255IGltcG9ydCAqL3ZhciByZWFjdF9fV0VCUEFDS19JTVBPUlRFRF9NT0RVTEVfMl9fID0gX193ZWJwYWNrX3JlcXVpcmVfXygyOTQpOwogICAgICAgIGZ1bmN0aW9uIF9jcmVhdGVGb3JPZkl0ZXJhdG9ySGVscGVyKG8sIGFsbG93QXJyYXlMaWtlKSB7dmFyIGl0ID0gdHlwZW9mIFN5bWJvbCAhPT0gInVuZGVmaW5lZCIgJiYgb1tTeW1ib2wuaXRlcmF0b3JdIHx8IG9bIkBAaXRlcmF0b3IiXTtpZiAoIWl0KSB7aWYgKEFycmF5LmlzQXJyYXkobykgfHwgKGl0ID0gX3Vuc3VwcG9ydGVkSXRlcmFibGVUb0FycmF5KG8pKSB8fCBhbGxvd0FycmF5TGlrZSAmJiBvICYmIHR5cGVvZiBvLmxlbmd0aCA9PT0gIm51bWJlciIpIHtpZiAoaXQpIG8gPSBpdDt2YXIgaSA9IDA7dmFyIEYgPSBmdW5jdGlvbiBGKCkge307cmV0dXJuIHsgczogRiwgbjogZnVuY3Rpb24gbigpIHtpZiAoaSA+PSBvLmxlbmd0aCkgcmV0dXJuIHsgZG9uZTogdHJ1ZSB9O3JldHVybiB7IGRvbmU6IGZhbHNlLCB2YWx1ZTogb1tpKytdIH07fSwgZTogZnVuY3Rpb24gZShfZSkge3Rocm93IF9lO30sIGY6IEYgfTt9dGhyb3cgbmV3IFR5cGVFcnJvcigiSW52YWxpZCBhdHRlbXB0IHRvIGl0ZXJhdGUgbm9uLWl0ZXJhYmxlIGluc3RhbmNlLlxuSW4gb3JkZXIgdG8gYmUgaXRlcmFibGUsIG5vbi1hcnJheSBvYmplY3RzIG11c3QgaGF2ZSBhIFtTeW1ib2wuaXRlcmF0b3JdKCkgbWV0aG9kLiIpO312YXIgbm9ybWFsQ29tcGxldGlvbiA9IHRydWUsZGlkRXJyID0gZmFsc2UsZXJyO3JldHVybiB7IHM6IGZ1bmN0aW9uIHMoKSB7aXQgPSBpdC5jYWxsKG8pO30sIG46IGZ1bmN0aW9uIG4oKSB7dmFyIHN0ZXAgPSBpdC5uZXh0KCk7bm9ybWFsQ29tcGxldGlvbiA9IHN0ZXAuZG9uZTtyZXR1cm4gc3RlcDt9LCBlOiBmdW5jdGlvbiBlKF9lMikge2RpZEVyciA9IHRydWU7ZXJyID0gX2UyO30sIGY6IGZ1bmN0aW9uIGYoKSB7dHJ5IHtpZiAoIW5vcm1hbENvbXBsZXRpb24gJiYgaXRbInJldHVybiJdICE9IG51bGwpIGl0WyJyZXR1cm4iXSgpO30gZmluYWxseSB7aWYgKGRpZEVycikgdGhyb3cgZXJyO319IH07fWZ1bmN0aW9uIF91bnN1cHBvcnRlZEl0ZXJhYmxlVG9BcnJheShvLCBtaW5MZW4pIHtpZiAoIW8pIHJldHVybjtpZiAodHlwZW9mIG8gPT09ICJzdHJpbmciKSByZXR1cm4gX2FycmF5TGlrZVRvQXJyYXkobywgbWluTGVuKTt2YXIgbiA9IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChvKS5zbGljZSg4LCAtMSk7aWYgKG4gPT09ICJPYmplY3QiICYmIG8uY29uc3RydWN0b3IpIG4gPSBvLmNvbnN0cnVjdG9yLm5hbWU7aWYgKG4gPT09ICJNYXAiIHx8IG4gPT09ICJTZXQiKSByZXR1cm4gQXJyYXkuZnJvbShvKTtpZiAobiA9PT0gIkFyZ3VtZW50cyIgfHwgL14oPzpVaXxJKW50KD86OHwxNnwzMikoPzpDbGFtcGVkKT9BcnJheSQvLnRlc3QobikpIHJldHVybiBfYXJyYXlMaWtlVG9BcnJheShvLCBtaW5MZW4pO31mdW5jdGlvbiBfYXJyYXlMaWtlVG9BcnJheShhcnIsIGxlbikge2lmIChsZW4gPT0gbnVsbCB8fCBsZW4gPiBhcnIubGVuZ3RoKSBsZW4gPSBhcnIubGVuZ3RoO2ZvciAodmFyIGkgPSAwLCBhcnIyID0gbmV3IEFycmF5KGxlbik7IGkgPCBsZW47IGkrKykgYXJyMltpXSA9IGFycltpXTtyZXR1cm4gYXJyMjt9CgoKCgoKICAgICAgICBnZXREYXRhKGZ1bmN0aW9uIChwYWdlcykge3ZhciBfaXRlcmF0b3IgPSBfY3JlYXRlRm9yT2ZJdGVyYXRvckhlbHBlcigKICAgICAgICAgICAgcGFnZXMpLF9zdGVwO3RyeSB7Zm9yIChfaXRlcmF0b3IucygpOyAhKF9zdGVwID0gX2l0ZXJhdG9yLm4oKSkuZG9uZTspIHt2YXIgcGFnZSA9IF9zdGVwLnZhbHVlOwogICAgICAgICAgICAgIGZvciAodmFyIF9pID0gMCwgX2FyciA9IHBhZ2UuY29tcG9uZW50czsgX2kgPCBfYXJyLmxlbmd0aDsgX2krKykge3ZhciBjb21wb25lbnQgPSBfYXJyW19pXTsKICAgICAgICAgICAgICAgIGNvbXBvbmVudC5wcmV2aW91c1ZhbHVlID0gY29tcG9uZW50LnZhbHVlOwoKICAgICAgICAgICAgICAgIGlmIChjb21wb25lbnQudmFsaWRhdGUgIT0gbnVsbCkgewogICAgICAgICAgICAgICAgICBjb21wb25lbnQudmFsaWRhdGUgPSBldmFsKGNvbXBvbmVudC52YWxpZGF0ZSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9fSBjYXRjaCAoZXJyKSB7X2l0ZXJhdG9yLmUoZXJyKTt9IGZpbmFsbHkge19pdGVyYXRvci5mKCk7fQoKICAgICAgICAgIHZhciBjb250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgicm9vdCIpOwogICAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9uby1ub24tbnVsbC1hc3NlcnRpb24KICAgICAgICAgIHZhciByb290ID0gKDAsIHJlYWN0X2RvbV9jbGllbnRfX1dFQlBBQ0tfSU1QT1JURURfTU9EVUxFXzFfXyAvKiAuY3JlYXRlUm9vdCAqLy5zKShjb250YWluZXIpOwogICAgICAgICAgcm9vdC5yZW5kZXIoIC8qI19fUFVSRV9fKi9yZWFjdF9fV0VCUEFDS19JTVBPUlRFRF9NT0RVTEVfMl9fLmNyZWF0ZUVsZW1lbnQoX0FwcF9fV0VCUEFDS19JTVBPUlRFRF9NT0RVTEVfMF9fIC8qIFsiZGVmYXVsdCJdICovLlosIHsgcGFnZXM6IHBhZ2VzIH0pKTsKICAgICAgICB9KTsKICAgICAgfSkoKTsKCiAgICAgIC8qKioqKiovcmV0dXJuIF9fd2VicGFja19leHBvcnRzX187CiAgICAgIC8qKioqKiovfSkoKSk7Cgp9KTs=";

/***/ }),

/***/ 171:
/***/ ((module) => {

module.exports = "#relayContainer{margin:1rem;font-family:Arial,Helvetica,sans-serif}#notificationsContainer{pointer-events:none;position:fixed;top:5%;left:70%;transform:translateX(-50%);z-index:999}img{display:block;margin:auto}input.stringcontainer{background-color:#fff;border-radius:5px;border:1px solid #121943;height:24px;margin:auto;display:flex;padding-left:5px}input.interrupt{width:100%;border-color:darkred;background-color:#f1948a;color:darkred;margin:10px 0px;cursor:pointer}input.interrupt:hover{background-color:#f5867a}input.interrupt:active{background-color:#f77163}input.save,input.interrupt{margin:auto;display:block;font-size:x-large;padding:5px 25px;border-radius:10px}.notification{border:3px solid #00529b;background-color:#bde5f8;width:fit-content;margin-right:auto;margin-left:auto;border-radius:40px;color:#00529b;padding:7px 60px;animation:2s fadeOut 5s 1 forwards;cursor:default;pointer-events:auto}@keyframes fadeOut{0%{opacity:1}99%{height:100%}100%{opacity:0;height:0}}td{padding:.5rem}.toggle{align-items:center;border-radius:100px;display:flex;font-weight:700;margin-bottom:16px}.toggle:last-of-type{margin:0}.toggle__input{clip:rect(0 0 0 0);clip-path:inset(50%);height:1px;overflow:hidden;position:absolute;white-space:nowrap;width:1px}.toggle__input:not([disabled]):active+.toggle-track,.toggle__input:not([disabled]):focus+.toggle-track{border:1px solid rgba(0,0,0,0);box-shadow:0px 0px 0px 2px #121943}.toggle__input:disabled+.toggle-track{cursor:not-allowed;opacity:.7}.toggle-track{background:#fff;border:1px solid #5a72b5;border-radius:100px;cursor:pointer;display:flex;height:30px;margin:auto;position:relative;width:60px}.toggle-indicator{align-items:center;background:#121943;border-radius:24px;bottom:2px;display:flex;height:24px;justify-content:center;left:2px;outline:solid 2px rgba(0,0,0,0);position:absolute;transition:.4s;width:24px}.checkMark{fill:#fff;height:20px;width:20px;opacity:0;transition:opacity .4s ease-in-out}.dropdowncontainer{padding:8px 16px;border:1px solid rgba(0,0,0,0);border-color:#000}input[value=true]+.toggle-track .toggle-indicator{background:#121943;transform:translateX(30px)}input[value=true]+.toggle-track .toggle-indicator .checkMark{opacity:1;transition:opacity .4s ease-in-out}@media screen and (-ms-high-contrast: active){.toggle-track{border-radius:0;background-color:red}}.topBar{display:flex}.tabEntry{margin-right:10px;border-radius:10px;background-color:#333}.tabEntry a{display:block;color:#fff;text-align:center;padding:6px;text-decoration:none}.tabEntry a[aria-current=page]{background-color:#00529b;border-radius:10px}.tabEntry a:hover[aria-current=page]{background-color:#002c53;border-radius:10px}.tabEntry a:hover{background-color:#111;border-radius:10px}.setting{position:relative}.setting .settingNameHover{visibility:hidden;background-color:#cacaca;color:#000;text-align:center;border-radius:6px;border-color:#000;position:absolute;z-index:1}.setting:hover .settingNameHover{visibility:visible;padding:5px;margin-left:15px}.hoverBox{position:relative;white-space:nowrap}.settingInput .settingDefaultHover{visibility:hidden;color:#666;position:absolute;z-index:1;left:50%;transform:translateX(-50%)}.settingInput:hover .settingDefaultHover{visibility:visible}.invalid-setting input,.invalid-setting select,.invalid-setting .toggle-track{background:pink !important}.invalid-reason{text-align:center}.invalid-reason small{padding:0px 5px;border-radius:10px;color:red}\n";

/***/ }),

/***/ 530:
/***/ ((module) => {

module.exports = require("kolmafia");

/***/ })

/******/ 	});
/************************************************************************/
/******/ 	// The module cache
/******/ 	var __webpack_module_cache__ = {};
/******/ 	
/******/ 	// The require function
/******/ 	function __webpack_require__(moduleId) {
/******/ 		// Check if module is in cache
/******/ 		var cachedModule = __webpack_module_cache__[moduleId];
/******/ 		if (cachedModule !== undefined) {
/******/ 			return cachedModule.exports;
/******/ 		}
/******/ 		// Create a new module (and put it into the cache)
/******/ 		var module = __webpack_module_cache__[moduleId] = {
/******/ 			// no module.id needed
/******/ 			// no module.loaded needed
/******/ 			exports: {}
/******/ 		};
/******/ 	
/******/ 		// Execute the module function
/******/ 		__webpack_modules__[moduleId](module, module.exports, __webpack_require__);
/******/ 	
/******/ 		// Return the exports of the module
/******/ 		return module.exports;
/******/ 	}
/******/ 	
/************************************************************************/
/******/ 	/* webpack/runtime/compat get default export */
/******/ 	(() => {
/******/ 		// getDefaultExport function for compatibility with non-harmony modules
/******/ 		__webpack_require__.n = (module) => {
/******/ 			var getter = module && module.__esModule ?
/******/ 				() => (module['default']) :
/******/ 				() => (module);
/******/ 			__webpack_require__.d(getter, { a: getter });
/******/ 			return getter;
/******/ 		};
/******/ 	})();
/******/ 	
/******/ 	/* webpack/runtime/define property getters */
/******/ 	(() => {
/******/ 		// define getter functions for harmony exports
/******/ 		__webpack_require__.d = (exports, definition) => {
/******/ 			for(var key in definition) {
/******/ 				if(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {
/******/ 					Object.defineProperty(exports, key, { enumerable: true, get: definition[key] });
/******/ 				}
/******/ 			}
/******/ 		};
/******/ 	})();
/******/ 	
/******/ 	/* webpack/runtime/hasOwnProperty shorthand */
/******/ 	(() => {
/******/ 		__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))
/******/ 	})();
/******/ 	
/******/ 	/* webpack/runtime/make namespace object */
/******/ 	(() => {
/******/ 		// define __esModule on exports
/******/ 		__webpack_require__.r = (exports) => {
/******/ 			if(typeof Symbol !== 'undefined' && Symbol.toStringTag) {
/******/ 				Object.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });
/******/ 			}
/******/ 			Object.defineProperty(exports, '__esModule', { value: true });
/******/ 		};
/******/ 	})();
/******/ 	
/************************************************************************/
var __webpack_exports__ = {};
// This entry need to be wrapped in an IIFE because it need to be isolated against other modules in the chunk.
(() => {
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "main": () => (/* binding */ main)
/* harmony export */ });
/* harmony import */ var kolmafia__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(530);
/* harmony import */ var kolmafia__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(kolmafia__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var _RelayUtils__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(616);
function _createForOfIteratorHelper(o, allowArrayLike) {var it = typeof Symbol !== "undefined" && o[Symbol.iterator] || o["@@iterator"];if (!it) {if (Array.isArray(o) || (it = _unsupportedIterableToArray(o)) || allowArrayLike && o && typeof o.length === "number") {if (it) o = it;var i = 0;var F = function F() {};return { s: F, n: function n() {if (i >= o.length) return { done: true };return { done: false, value: o[i++] };}, e: function e(_e) {throw _e;}, f: F };}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");}var normalCompletion = true,didErr = false,err;return { s: function s() {it = it.call(o);}, n: function n() {var step = it.next();normalCompletion = step.done;return step;}, e: function e(_e2) {didErr = true;err = _e2;}, f: function f() {try {if (!normalCompletion && it.return != null) it.return();} finally {if (didErr) throw err;}} };}function _unsupportedIterableToArray(o, minLen) {if (!o) return;if (typeof o === "string") return _arrayLikeToArray(o, minLen);var n = Object.prototype.toString.call(o).slice(8, -1);if (n === "Object" && o.constructor) n = o.constructor.name;if (n === "Map" || n === "Set") return Array.from(o);if (n === "Arguments" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen);}function _arrayLikeToArray(arr, len) {if (len == null || len > arr.length) len = arr.length;for (var i = 0, arr2 = new Array(len); i < len; i++) arr2[i] = arr[i];return arr2;}



function main() {for (var _len = arguments.length, pagesToLoad = new Array(_len), _key = 0; _key < _len; _key++) {pagesToLoad[_key] = arguments[_key];}
  if ((0,_RelayUtils__WEBPACK_IMPORTED_MODULE_1__/* .handleApiRequest */ .SU)()) {
    return;
  }

  if (pagesToLoad.length == 0) {
    // Find any 'page' or 'pages' parameters
    pagesToLoad = ((0,kolmafia__WEBPACK_IMPORTED_MODULE_0__.formFields)()["page"] || (0,kolmafia__WEBPACK_IMPORTED_MODULE_0__.formFields)()["pages"] || "").
    split(",").
    filter((s) => s.length > 0);
  }

  var pages = [];
  var extraHtml;

  if (pagesToLoad.length > 0) {
    var cssFile;var _iterator = _createForOfIteratorHelper(
      pagesToLoad),_step;try {for (_iterator.s(); !(_step = _iterator.n()).done;) {var pageName = _step.value;
        try {var _extraHtml$css;
          var page = null;

          // If the parameter is a string, then try to load from file
          if (typeof pageName == "string") {
            cssFile = (0,_RelayUtils__WEBPACK_IMPORTED_MODULE_1__/* .parseCssFromFile */ .$p)(pageName);
            page = (0,_RelayUtils__WEBPACK_IMPORTED_MODULE_1__/* .parsePageFromFile */ .jU)(pageName);
          } else {
            page = pageName;
          }

          if (page == null) {
            continue;
          }

          // Assume at this point it must be a RelayPage
          pages.push(page);

          if (cssFile == null) {
            continue;
          }

          if (extraHtml == null) {
            extraHtml = { cssFiles: [] };
          }

          extraHtml.css = ((_extraHtml$css = extraHtml.css) !== null && _extraHtml$css !== void 0 ? _extraHtml$css : "") + cssFile;
        } catch (e) {
          (0,kolmafia__WEBPACK_IMPORTED_MODULE_0__.write)(
          "<h2>An error occured while trying to load " + (
          typeof pageName == "string" ?
          (0,_RelayUtils__WEBPACK_IMPORTED_MODULE_1__/* .getPagePath */ .mn)(pageName) + ", is your json properly formatted?" :
          "a relay page") +
          "</h2>");


          if (e) {
            (0,kolmafia__WEBPACK_IMPORTED_MODULE_0__.write)("<br>");
            (0,kolmafia__WEBPACK_IMPORTED_MODULE_0__.write)(e);

            if (e.stack) {
              for (var _i = 0, _arr = e.stack.split("\n"); _i < _arr.length; _i++) {var s = _arr[_i];
                while (s.match(/\t|\r/)) {
                  s = s.replace(/\t|\r/, "");
                }

                (0,kolmafia__WEBPACK_IMPORTED_MODULE_0__.write)("<br>");
                (0,kolmafia__WEBPACK_IMPORTED_MODULE_0__.write)(s);
              }
            }
          }
          return;
        }
      }} catch (err) {_iterator.e(err);} finally {_iterator.f();}
  }

  if (pages.length == 0) {
    (0,kolmafia__WEBPACK_IMPORTED_MODULE_0__.write)(
    "<h3>The relay script could not find any pages to load, either invalid/missing pages were provided or nothing was.</h3>");

    return;
  }

  (0,kolmafia__WEBPACK_IMPORTED_MODULE_0__.write)((0,_RelayUtils__WEBPACK_IMPORTED_MODULE_1__/* .generateHTML */ .ar)(pages, extraHtml));
}
})();

var __webpack_export_target__ = exports;
for(var i in __webpack_exports__) __webpack_export_target__[i] = __webpack_exports__[i];
if(__webpack_exports__.__esModule) Object.defineProperty(__webpack_export_target__, "__esModule", { value: true });
/******/ })()
;