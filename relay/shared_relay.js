/******/ (() => { // webpackBootstrap
/******/ 	"use strict";
/******/ 	var __webpack_modules__ = ({

/***/ 616:
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "$p": () => (/* binding */ parseCssFromFile),
/* harmony export */   "SU": () => (/* binding */ handleApiRequest),
/* harmony export */   "ar": () => (/* binding */ generateHTML),
/* harmony export */   "jU": () => (/* binding */ parsePageFromFile),
/* harmony export */   "mn": () => (/* binding */ getPagePath)
/* harmony export */ });
/* unused harmony export parsePageFromJson */
/* harmony import */ var kolmafia__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(530);
/* harmony import */ var kolmafia__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(kolmafia__WEBPACK_IMPORTED_MODULE_0__);
function _toConsumableArray(arr) {return _arrayWithoutHoles(arr) || _iterableToArray(arr) || _unsupportedIterableToArray(arr) || _nonIterableSpread();}function _nonIterableSpread() {throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");}function _iterableToArray(iter) {if (typeof Symbol !== "undefined" && iter[Symbol.iterator] != null || iter["@@iterator"] != null) return Array.from(iter);}function _arrayWithoutHoles(arr) {if (Array.isArray(arr)) return _arrayLikeToArray(arr);}function _slicedToArray(arr, i) {return _arrayWithHoles(arr) || _iterableToArrayLimit(arr, i) || _unsupportedIterableToArray(arr, i) || _nonIterableRest();}function _nonIterableRest() {throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");}function _iterableToArrayLimit(arr, i) {var _i = null == arr ? null : "undefined" != typeof Symbol && arr[Symbol.iterator] || arr["@@iterator"];if (null != _i) {var _s,_e,_x,_r,_arr = [],_n = !0,_d = !1;try {if (_x = (_i = _i.call(arr)).next, 0 === i) {if (Object(_i) !== _i) return;_n = !1;} else for (; !(_n = (_s = _x.call(_i)).done) && (_arr.push(_s.value), _arr.length !== i); _n = !0) {;}} catch (err) {_d = !0, _e = err;} finally {try {if (!_n && null != _i.return && (_r = _i.return(), Object(_r) !== _r)) return;} finally {if (_d) throw _e;}}return _arr;}}function _arrayWithHoles(arr) {if (Array.isArray(arr)) return arr;}function _createForOfIteratorHelper(o, allowArrayLike) {var it = typeof Symbol !== "undefined" && o[Symbol.iterator] || o["@@iterator"];if (!it) {if (Array.isArray(o) || (it = _unsupportedIterableToArray(o)) || allowArrayLike && o && typeof o.length === "number") {if (it) o = it;var i = 0;var F = function F() {};return { s: F, n: function n() {if (i >= o.length) return { done: true };return { done: false, value: o[i++] };}, e: function e(_e2) {throw _e2;}, f: F };}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");}var normalCompletion = true,didErr = false,err;return { s: function s() {it = it.call(o);}, n: function n() {var step = it.next();normalCompletion = step.done;return step;}, e: function e(_e3) {didErr = true;err = _e3;}, f: function f() {try {if (!normalCompletion && it.return != null) it.return();} finally {if (didErr) throw err;}} };}function _unsupportedIterableToArray(o, minLen) {if (!o) return;if (typeof o === "string") return _arrayLikeToArray(o, minLen);var n = Object.prototype.toString.call(o).slice(8, -1);if (n === "Object" && o.constructor) n = o.constructor.name;if (n === "Map" || n === "Set") return Array.from(o);if (n === "Arguments" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen);}function _arrayLikeToArray(arr, len) {if (len == null || len > arr.length) len = arr.length;for (var i = 0, arr2 = new Array(len); i < len; i++) {arr2[i] = arr[i];}return arr2;}








function handleApiRequest() {
  if (handleJavascript()) {
    return true;
  }

  if (handleProperties()) {
    return true;
  }

  return false;
}

function handleProperties() {
  var toSet = (0,kolmafia__WEBPACK_IMPORTED_MODULE_0__.formFields)()["setProperties"];

  if (toSet == null) {
    return false;
  }

  var props = JSON.parse(toSet);
  var notifications = [];var _iterator = _createForOfIteratorHelper(

    props),_step;try {for (_iterator.s(); !(_step = _iterator.n()).done;) {var _step$value = _slicedToArray(_step.value, 2),key = _step$value[0],value = _step$value[1];
      var prevValue = (0,kolmafia__WEBPACK_IMPORTED_MODULE_0__.getProperty)(key);

      if (prevValue === value) {
        continue;
      }

      (0,kolmafia__WEBPACK_IMPORTED_MODULE_0__.setProperty)(key, value);
      notifications.push("".concat(key, " changed from `").concat(prevValue, "` to `").concat(value, "`"));
    }} catch (err) {_iterator.e(err);} finally {_iterator.f();}

  if (notifications.length == 0) {
    notifications.push("No settings were modified.");
  }

  // We include the ' ' because otherwise the browser doesn't like an empty page
  (0,kolmafia__WEBPACK_IMPORTED_MODULE_0__.write)(JSON.stringify(notifications));
  return true;
}

function handleJavascript() {
  var js = (0,kolmafia__WEBPACK_IMPORTED_MODULE_0__.formFields)()["javascript"];

  if (js == null) {
    return false;
  }

  var returns = eval(js) || "";
  // We include the ' ' because otherwise the browser doesn't like an empty page
  (0,kolmafia__WEBPACK_IMPORTED_MODULE_0__.write)(returns + (returns ? "" : " "));
  return true;
}

function validateComponents(components) {var _iterator2 = _createForOfIteratorHelper(
    components),_step2;try {for (_iterator2.s(); !(_step2 = _iterator2.n()).done;) {var _button$name;var component = _step2.value;
      var button = component;

      if (button.preference == null) {
        continue;
      }

      button.name = (_button$name = button.name) !== null && _button$name !== void 0 ? _button$name : button.preference;

      if (button.validate != null) {
        try {
          eval(button.validate);
        } catch (e) {
          (0,kolmafia__WEBPACK_IMPORTED_MODULE_0__.print)("Unable to load ".concat(button.name, "'s validator '").concat(button.validate, "'"));
          button.validate = null;
        }
      }

      if (button.default != undefined && typeof button.default != "string") {
        button.default = button.default + "";
      }

      if (button.value != undefined && typeof button.value != "string") {
        button.value = button.value + "";
      }

      if (button.default == null && button.type == "boolean") {
        button.default = "true";
      }

      if (button.value != null) {
        continue;
      }

      var val = void 0;

      if ((0,kolmafia__WEBPACK_IMPORTED_MODULE_0__.propertyExists)(button.preference)) {
        val = (0,kolmafia__WEBPACK_IMPORTED_MODULE_0__.getProperty)(button.preference);
      } else if (button.default != null) {
        val = button.default;
      } else {
        if (button.type == "dropdown") {
          val = button.dropdown[0].value;
        } else if (button.type == "boolean") {
          val = "true";
        } else {
          val = "";
        }
      }

      button.value = val;
    }} catch (err) {_iterator2.e(err);} finally {_iterator2.f();}
}

function generateHTML(
pages,
extraHtml)
{
  pages = pages.filter((p) => p != null);var _iterator3 = _createForOfIteratorHelper(

    pages),_step3;try {for (_iterator3.s(); !(_step3 = _iterator3.n()).done;) {var _page$file;var page = _step3.value;
      page.file = (_page$file = page.file) !== null && _page$file !== void 0 ? _page$file : page.page;

      validateComponents(page.components);
    }} catch (err) {_iterator3.e(err);} finally {_iterator3.f();}

  var buffer = [];

  var cssFiles = [];

  if (extraHtml && extraHtml.cssFiles) {
    cssFiles.push.apply(cssFiles, _toConsumableArray(extraHtml.cssFiles));
  }

  buffer.push("<head>");

  cssFiles.forEach((s) => {
    buffer.push("<link rel=\"stylesheet\" src=\"".concat(s, "\">"));
  });

  buffer.push("<style>");
  buffer.push("".concat(__webpack_require__(171)));

  if (extraHtml && extraHtml.css) {
    buffer.push(extraHtml.css);
  }

  buffer.push("</style>");

  buffer.push("</head>");

  buffer.push('<div id="root"></div>');

  buffer.push("<script>");

  // add script that react calls when loaded to get kol data
  buffer.push("let getData = function(callback) {callback(".concat(
  JSON.stringify(pages), ")}"));


  // close notifications when they are clicked on
  buffer.push("document.onclick = (e) => {\n    if(e.target.classList.contains('notification')) e.target.remove();\n  }");



  buffer.push("</script>");

  // include react script
  buffer.push("<script src=\"".concat(
  __webpack_require__(832), "\"></script>"));


  return buffer.join("\n");
}

function getPagePath(file) {
  var fileName = file.includes("/") ?
  file :
  "relay/shared_relay/pages/" + file + ".json";

  if (!fileName.endsWith(".json") && (0,kolmafia__WEBPACK_IMPORTED_MODULE_0__.fileToBuffer)(fileName).length == 0) {
    fileName += ".json";
  }

  return fileName;
}

/**
 * Parses from relay/shared_relay/pages/ if no slashes are in the name, otherwise expects a valid json file
 */
function parsePageFromFile(file) {
  var data = (0,kolmafia__WEBPACK_IMPORTED_MODULE_0__.fileToBuffer)(getPagePath(file));

  return parsePageFromJson(file, data);
}

function parseCssFromFile(file) {
  var fileName = file.includes("/") ?
  file :
  "shared_relay/pages/" + file + ".css";

  if (!fileName.endsWith(".css")) {
    fileName += ".css";
  }

  var data = (0,kolmafia__WEBPACK_IMPORTED_MODULE_0__.fileToBuffer)(fileName);

  if (data.length == 0) {
    return null;
  }

  return fileName;
}

function parsePageFromJson(id, jsonData) {
  if (jsonData.length == 0) {
    return null;
  }

  var subpage = JSON.parse(jsonData);

  subpage.file = id;

  for (var _i2 = 0, _arr2 = subpage.components; _i2 < _arr2.length; _i2++) {var _button$dropdown;var button = _arr2[_i2];
    if (button.type != "dropdown") {
      continue;
    }

    if (button.dropdown == null) {
      button.dropdown = [];
    } else if (typeof button.dropdown[0] == "string") {
      button.dropdown = button.dropdown.map((s) => {
        return {
          display: s,
          value: s
        };
      });
    }

    if (button.dropdownFiller == null) {
      continue;
    }

    var data =
    eval(button.dropdownFiller).
    map((_ref) => {var _ref2 = _slicedToArray(_ref, 2),display = _ref2[0],value = _ref2[1];
      return {
        display: display,
        value: value
      };
    });

    (_button$dropdown = button.dropdown).push.apply(_button$dropdown, _toConsumableArray(data));
  }

  return subpage;
}

/***/ }),

/***/ 832:
/***/ ((module) => {

module.exports = "data:application/javascript;base64,ZnVuY3Rpb24gX2NyZWF0ZUZvck9mSXRlcmF0b3JIZWxwZXIyKG8sIGFsbG93QXJyYXlMaWtlKSB7dmFyIGl0ID0gdHlwZW9mIFN5bWJvbCAhPT0gInVuZGVmaW5lZCIgJiYgb1tTeW1ib2wuaXRlcmF0b3JdIHx8IG9bIkBAaXRlcmF0b3IiXTtpZiAoIWl0KSB7aWYgKEFycmF5LmlzQXJyYXkobykgfHwgKGl0ID0gX3Vuc3VwcG9ydGVkSXRlcmFibGVUb0FycmF5MihvKSkgfHwgYWxsb3dBcnJheUxpa2UgJiYgbyAmJiB0eXBlb2Ygby5sZW5ndGggPT09ICJudW1iZXIiKSB7aWYgKGl0KSBvID0gaXQ7dmFyIGkgPSAwO3ZhciBGID0gZnVuY3Rpb24gRigpIHt9O3JldHVybiB7IHM6IEYsIG46IGZ1bmN0aW9uIG4oKSB7aWYgKGkgPj0gby5sZW5ndGgpIHJldHVybiB7IGRvbmU6IHRydWUgfTtyZXR1cm4geyBkb25lOiBmYWxzZSwgdmFsdWU6IG9baSsrXSB9O30sIGU6IGZ1bmN0aW9uIGUoX2U0KSB7dGhyb3cgX2U0O30sIGY6IEYgfTt9dGhyb3cgbmV3IFR5cGVFcnJvcigiSW52YWxpZCBhdHRlbXB0IHRvIGl0ZXJhdGUgbm9uLWl0ZXJhYmxlIGluc3RhbmNlLlxuSW4gb3JkZXIgdG8gYmUgaXRlcmFibGUsIG5vbi1hcnJheSBvYmplY3RzIG11c3QgaGF2ZSBhIFtTeW1ib2wuaXRlcmF0b3JdKCkgbWV0aG9kLiIpO312YXIgbm9ybWFsQ29tcGxldGlvbiA9IHRydWUsZGlkRXJyID0gZmFsc2UsZXJyO3JldHVybiB7IHM6IGZ1bmN0aW9uIHMoKSB7aXQgPSBpdC5jYWxsKG8pO30sIG46IGZ1bmN0aW9uIG4oKSB7dmFyIHN0ZXAgPSBpdC5uZXh0KCk7bm9ybWFsQ29tcGxldGlvbiA9IHN0ZXAuZG9uZTtyZXR1cm4gc3RlcDt9LCBlOiBmdW5jdGlvbiBlKF9lNSkge2RpZEVyciA9IHRydWU7ZXJyID0gX2U1O30sIGY6IGZ1bmN0aW9uIGYoKSB7dHJ5IHtpZiAoIW5vcm1hbENvbXBsZXRpb24gJiYgaXQucmV0dXJuICE9IG51bGwpIGl0LnJldHVybigpO30gZmluYWxseSB7aWYgKGRpZEVycikgdGhyb3cgZXJyO319IH07fWZ1bmN0aW9uIF9yZWdlbmVyYXRvclJ1bnRpbWUyKCkgeyJ1c2Ugc3RyaWN0IjsKLyohIHJlZ2VuZXJhdG9yLXJ1bnRpbWUgLS0gQ29weXJpZ2h0IChjKSAyMDE0LXByZXNlbnQsIEZhY2Vib29rLCBJbmMuIC0tIGxpY2Vuc2UgKE1JVCk6IGh0dHBzOi8vZ2l0aHViLmNvbS9mYWNlYm9vay9yZWdlbmVyYXRvci9ibG9iL21haW4vTElDRU5TRSAqL19yZWdlbmVyYXRvclJ1bnRpbWUyID0gZnVuY3Rpb24gX3JlZ2VuZXJhdG9yUnVudGltZTIoKSB7cmV0dXJuIGV4cG9ydHM7fTt2YXIgZXhwb3J0cyA9IHt9LE9wID0gT2JqZWN0LnByb3RvdHlwZSxoYXNPd24gPSBPcC5oYXNPd25Qcm9wZXJ0eSxkZWZpbmVQcm9wZXJ0eSA9IE9iamVjdC5kZWZpbmVQcm9wZXJ0eSB8fCBmdW5jdGlvbiAob2JqLCBrZXksIGRlc2MpIHtvYmpba2V5XSA9IGRlc2MudmFsdWU7fSwkU3ltYm9sID0gImZ1bmN0aW9uIiA9PSB0eXBlb2YgU3ltYm9sID8gU3ltYm9sIDoge30saXRlcmF0b3JTeW1ib2wgPSAkU3ltYm9sLml0ZXJhdG9yIHx8ICJAQGl0ZXJhdG9yIixhc3luY0l0ZXJhdG9yU3ltYm9sID0gJFN5bWJvbC5hc3luY0l0ZXJhdG9yIHx8ICJAQGFzeW5jSXRlcmF0b3IiLHRvU3RyaW5nVGFnU3ltYm9sID0gJFN5bWJvbC50b1N0cmluZ1RhZyB8fCAiQEB0b1N0cmluZ1RhZyI7ZnVuY3Rpb24gZGVmaW5lKG9iaiwga2V5LCB2YWx1ZSkge3JldHVybiBPYmplY3QuZGVmaW5lUHJvcGVydHkob2JqLCBrZXksIHsgdmFsdWU6IHZhbHVlLCBlbnVtZXJhYmxlOiAhMCwgY29uZmlndXJhYmxlOiAhMCwgd3JpdGFibGU6ICEwIH0pLCBvYmpba2V5XTt9dHJ5IHtkZWZpbmUoe30sICIiKTt9IGNhdGNoIChlcnIpIHtkZWZpbmUgPSBmdW5jdGlvbiBkZWZpbmUob2JqLCBrZXksIHZhbHVlKSB7cmV0dXJuIG9ialtrZXldID0gdmFsdWU7fTt9ZnVuY3Rpb24gd3JhcChpbm5lckZuLCBvdXRlckZuLCBzZWxmLCB0cnlMb2NzTGlzdCkge3ZhciBwcm90b0dlbmVyYXRvciA9IG91dGVyRm4gJiYgb3V0ZXJGbi5wcm90b3R5cGUgaW5zdGFuY2VvZiBHZW5lcmF0b3IgPyBvdXRlckZuIDogR2VuZXJhdG9yLGdlbmVyYXRvciA9IE9iamVjdC5jcmVhdGUocHJvdG9HZW5lcmF0b3IucHJvdG90eXBlKSxjb250ZXh0ID0gbmV3IENvbnRleHQodHJ5TG9jc0xpc3QgfHwgW10pO3JldHVybiBkZWZpbmVQcm9wZXJ0eShnZW5lcmF0b3IsICJfaW52b2tlIiwgeyB2YWx1ZTogbWFrZUludm9rZU1ldGhvZChpbm5lckZuLCBzZWxmLCBjb250ZXh0KSB9KSwgZ2VuZXJhdG9yO31mdW5jdGlvbiB0cnlDYXRjaChmbiwgb2JqLCBhcmcpIHt0cnkge3JldHVybiB7IHR5cGU6ICJub3JtYWwiLCBhcmc6IGZuLmNhbGwob2JqLCBhcmcpIH07fSBjYXRjaCAoZXJyKSB7cmV0dXJuIHsgdHlwZTogInRocm93IiwgYXJnOiBlcnIgfTt9fWV4cG9ydHMud3JhcCA9IHdyYXA7dmFyIENvbnRpbnVlU2VudGluZWwgPSB7fTtmdW5jdGlvbiBHZW5lcmF0b3IoKSB7fWZ1bmN0aW9uIEdlbmVyYXRvckZ1bmN0aW9uKCkge31mdW5jdGlvbiBHZW5lcmF0b3JGdW5jdGlvblByb3RvdHlwZSgpIHt9dmFyIEl0ZXJhdG9yUHJvdG90eXBlID0ge307ZGVmaW5lKEl0ZXJhdG9yUHJvdG90eXBlLCBpdGVyYXRvclN5bWJvbCwgZnVuY3Rpb24gKCkge3JldHVybiB0aGlzO30pO3ZhciBnZXRQcm90byA9IE9iamVjdC5nZXRQcm90b3R5cGVPZixOYXRpdmVJdGVyYXRvclByb3RvdHlwZSA9IGdldFByb3RvICYmIGdldFByb3RvKGdldFByb3RvKHZhbHVlcyhbXSkpKTtOYXRpdmVJdGVyYXRvclByb3RvdHlwZSAmJiBOYXRpdmVJdGVyYXRvclByb3RvdHlwZSAhPT0gT3AgJiYgaGFzT3duLmNhbGwoTmF0aXZlSXRlcmF0b3JQcm90b3R5cGUsIGl0ZXJhdG9yU3ltYm9sKSAmJiAoSXRlcmF0b3JQcm90b3R5cGUgPSBOYXRpdmVJdGVyYXRvclByb3RvdHlwZSk7dmFyIEdwID0gR2VuZXJhdG9yRnVuY3Rpb25Qcm90b3R5cGUucHJvdG90eXBlID0gR2VuZXJhdG9yLnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoSXRlcmF0b3JQcm90b3R5cGUpO2Z1bmN0aW9uIGRlZmluZUl0ZXJhdG9yTWV0aG9kcyhwcm90b3R5cGUpIHtbIm5leHQiLCAidGhyb3ciLCAicmV0dXJuIl0uZm9yRWFjaChmdW5jdGlvbiAobWV0aG9kKSB7ZGVmaW5lKHByb3RvdHlwZSwgbWV0aG9kLCBmdW5jdGlvbiAoYXJnKSB7cmV0dXJuIHRoaXMuX2ludm9rZShtZXRob2QsIGFyZyk7fSk7fSk7fWZ1bmN0aW9uIEFzeW5jSXRlcmF0b3IoZ2VuZXJhdG9yLCBQcm9taXNlSW1wbCkge2Z1bmN0aW9uIGludm9rZShtZXRob2QsIGFyZywgcmVzb2x2ZSwgcmVqZWN0KSB7dmFyIHJlY29yZCA9IHRyeUNhdGNoKGdlbmVyYXRvclttZXRob2RdLCBnZW5lcmF0b3IsIGFyZyk7aWYgKCJ0aHJvdyIgIT09IHJlY29yZC50eXBlKSB7dmFyIHJlc3VsdCA9IHJlY29yZC5hcmcsdmFsdWUgPSByZXN1bHQudmFsdWU7cmV0dXJuIHZhbHVlICYmICJvYmplY3QiID09IHR5cGVvZiB2YWx1ZSAmJiBoYXNPd24uY2FsbCh2YWx1ZSwgIl9fYXdhaXQiKSA/IFByb21pc2VJbXBsLnJlc29sdmUodmFsdWUuX19hd2FpdCkudGhlbihmdW5jdGlvbiAodmFsdWUpIHtpbnZva2UoIm5leHQiLCB2YWx1ZSwgcmVzb2x2ZSwgcmVqZWN0KTt9LCBmdW5jdGlvbiAoZXJyKSB7aW52b2tlKCJ0aHJvdyIsIGVyciwgcmVzb2x2ZSwgcmVqZWN0KTt9KSA6IFByb21pc2VJbXBsLnJlc29sdmUodmFsdWUpLnRoZW4oZnVuY3Rpb24gKHVud3JhcHBlZCkge3Jlc3VsdC52YWx1ZSA9IHVud3JhcHBlZCwgcmVzb2x2ZShyZXN1bHQpO30sIGZ1bmN0aW9uIChlcnJvcikge3JldHVybiBpbnZva2UoInRocm93IiwgZXJyb3IsIHJlc29sdmUsIHJlamVjdCk7fSk7fXJlamVjdChyZWNvcmQuYXJnKTt9dmFyIHByZXZpb3VzUHJvbWlzZTtkZWZpbmVQcm9wZXJ0eSh0aGlzLCAiX2ludm9rZSIsIHsgdmFsdWU6IGZ1bmN0aW9uIHZhbHVlKG1ldGhvZCwgYXJnKSB7ZnVuY3Rpb24gY2FsbEludm9rZVdpdGhNZXRob2RBbmRBcmcoKSB7cmV0dXJuIG5ldyBQcm9taXNlSW1wbChmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7aW52b2tlKG1ldGhvZCwgYXJnLCByZXNvbHZlLCByZWplY3QpO30pO31yZXR1cm4gcHJldmlvdXNQcm9taXNlID0gcHJldmlvdXNQcm9taXNlID8gcHJldmlvdXNQcm9taXNlLnRoZW4oY2FsbEludm9rZVdpdGhNZXRob2RBbmRBcmcsIGNhbGxJbnZva2VXaXRoTWV0aG9kQW5kQXJnKSA6IGNhbGxJbnZva2VXaXRoTWV0aG9kQW5kQXJnKCk7fSB9KTt9ZnVuY3Rpb24gbWFrZUludm9rZU1ldGhvZChpbm5lckZuLCBzZWxmLCBjb250ZXh0KSB7dmFyIHN0YXRlID0gInN1c3BlbmRlZFN0YXJ0IjtyZXR1cm4gZnVuY3Rpb24gKG1ldGhvZCwgYXJnKSB7aWYgKCJleGVjdXRpbmciID09PSBzdGF0ZSkgdGhyb3cgbmV3IEVycm9yKCJHZW5lcmF0b3IgaXMgYWxyZWFkeSBydW5uaW5nIik7aWYgKCJjb21wbGV0ZWQiID09PSBzdGF0ZSkge2lmICgidGhyb3ciID09PSBtZXRob2QpIHRocm93IGFyZztyZXR1cm4gZG9uZVJlc3VsdCgpO31mb3IgKGNvbnRleHQubWV0aG9kID0gbWV0aG9kLCBjb250ZXh0LmFyZyA9IGFyZzs7KSB7dmFyIGRlbGVnYXRlID0gY29udGV4dC5kZWxlZ2F0ZTtpZiAoZGVsZWdhdGUpIHt2YXIgZGVsZWdhdGVSZXN1bHQgPSBtYXliZUludm9rZURlbGVnYXRlKGRlbGVnYXRlLCBjb250ZXh0KTtpZiAoZGVsZWdhdGVSZXN1bHQpIHtpZiAoZGVsZWdhdGVSZXN1bHQgPT09IENvbnRpbnVlU2VudGluZWwpIGNvbnRpbnVlO3JldHVybiBkZWxlZ2F0ZVJlc3VsdDt9fWlmICgibmV4dCIgPT09IGNvbnRleHQubWV0aG9kKSBjb250ZXh0LnNlbnQgPSBjb250ZXh0Ll9zZW50ID0gY29udGV4dC5hcmc7ZWxzZSBpZiAoInRocm93IiA9PT0gY29udGV4dC5tZXRob2QpIHtpZiAoInN1c3BlbmRlZFN0YXJ0IiA9PT0gc3RhdGUpIHRocm93IHN0YXRlID0gImNvbXBsZXRlZCIsIGNvbnRleHQuYXJnO2NvbnRleHQuZGlzcGF0Y2hFeGNlcHRpb24oY29udGV4dC5hcmcpO30gZWxzZSAicmV0dXJuIiA9PT0gY29udGV4dC5tZXRob2QgJiYgY29udGV4dC5hYnJ1cHQoInJldHVybiIsIGNvbnRleHQuYXJnKTtzdGF0ZSA9ICJleGVjdXRpbmciO3ZhciByZWNvcmQgPSB0cnlDYXRjaChpbm5lckZuLCBzZWxmLCBjb250ZXh0KTtpZiAoIm5vcm1hbCIgPT09IHJlY29yZC50eXBlKSB7aWYgKHN0YXRlID0gY29udGV4dC5kb25lID8gImNvbXBsZXRlZCIgOiAic3VzcGVuZGVkWWllbGQiLCByZWNvcmQuYXJnID09PSBDb250aW51ZVNlbnRpbmVsKSBjb250aW51ZTtyZXR1cm4geyB2YWx1ZTogcmVjb3JkLmFyZywgZG9uZTogY29udGV4dC5kb25lIH07fSJ0aHJvdyIgPT09IHJlY29yZC50eXBlICYmIChzdGF0ZSA9ICJjb21wbGV0ZWQiLCBjb250ZXh0Lm1ldGhvZCA9ICJ0aHJvdyIsIGNvbnRleHQuYXJnID0gcmVjb3JkLmFyZyk7fX07fWZ1bmN0aW9uIG1heWJlSW52b2tlRGVsZWdhdGUoZGVsZWdhdGUsIGNvbnRleHQpIHt2YXIgbWV0aG9kTmFtZSA9IGNvbnRleHQubWV0aG9kLG1ldGhvZCA9IGRlbGVnYXRlLml0ZXJhdG9yW21ldGhvZE5hbWVdO2lmICh1bmRlZmluZWQgPT09IG1ldGhvZCkgcmV0dXJuIGNvbnRleHQuZGVsZWdhdGUgPSBudWxsLCAidGhyb3ciID09PSBtZXRob2ROYW1lICYmIGRlbGVnYXRlLml0ZXJhdG9yLnJldHVybiAmJiAoY29udGV4dC5tZXRob2QgPSAicmV0dXJuIiwgY29udGV4dC5hcmcgPSB1bmRlZmluZWQsIG1heWJlSW52b2tlRGVsZWdhdGUoZGVsZWdhdGUsIGNvbnRleHQpLCAidGhyb3ciID09PSBjb250ZXh0Lm1ldGhvZCkgfHwgInJldHVybiIgIT09IG1ldGhvZE5hbWUgJiYgKGNvbnRleHQubWV0aG9kID0gInRocm93IiwgY29udGV4dC5hcmcgPSBuZXcgVHlwZUVycm9yKCJUaGUgaXRlcmF0b3IgZG9lcyBub3QgcHJvdmlkZSBhICciICsgbWV0aG9kTmFtZSArICInIG1ldGhvZCIpKSwgQ29udGludWVTZW50aW5lbDt2YXIgcmVjb3JkID0gdHJ5Q2F0Y2gobWV0aG9kLCBkZWxlZ2F0ZS5pdGVyYXRvciwgY29udGV4dC5hcmcpO2lmICgidGhyb3ciID09PSByZWNvcmQudHlwZSkgcmV0dXJuIGNvbnRleHQubWV0aG9kID0gInRocm93IiwgY29udGV4dC5hcmcgPSByZWNvcmQuYXJnLCBjb250ZXh0LmRlbGVnYXRlID0gbnVsbCwgQ29udGludWVTZW50aW5lbDt2YXIgaW5mbyA9IHJlY29yZC5hcmc7cmV0dXJuIGluZm8gPyBpbmZvLmRvbmUgPyAoY29udGV4dFtkZWxlZ2F0ZS5yZXN1bHROYW1lXSA9IGluZm8udmFsdWUsIGNvbnRleHQubmV4dCA9IGRlbGVnYXRlLm5leHRMb2MsICJyZXR1cm4iICE9PSBjb250ZXh0Lm1ldGhvZCAmJiAoY29udGV4dC5tZXRob2QgPSAibmV4dCIsIGNvbnRleHQuYXJnID0gdW5kZWZpbmVkKSwgY29udGV4dC5kZWxlZ2F0ZSA9IG51bGwsIENvbnRpbnVlU2VudGluZWwpIDogaW5mbyA6IChjb250ZXh0Lm1ldGhvZCA9ICJ0aHJvdyIsIGNvbnRleHQuYXJnID0gbmV3IFR5cGVFcnJvcigiaXRlcmF0b3IgcmVzdWx0IGlzIG5vdCBhbiBvYmplY3QiKSwgY29udGV4dC5kZWxlZ2F0ZSA9IG51bGwsIENvbnRpbnVlU2VudGluZWwpO31mdW5jdGlvbiBwdXNoVHJ5RW50cnkobG9jcykge3ZhciBlbnRyeSA9IHsgdHJ5TG9jOiBsb2NzWzBdIH07MSBpbiBsb2NzICYmIChlbnRyeS5jYXRjaExvYyA9IGxvY3NbMV0pLCAyIGluIGxvY3MgJiYgKGVudHJ5LmZpbmFsbHlMb2MgPSBsb2NzWzJdLCBlbnRyeS5hZnRlckxvYyA9IGxvY3NbM10pLCB0aGlzLnRyeUVudHJpZXMucHVzaChlbnRyeSk7fWZ1bmN0aW9uIHJlc2V0VHJ5RW50cnkoZW50cnkpIHt2YXIgcmVjb3JkID0gZW50cnkuY29tcGxldGlvbiB8fCB7fTtyZWNvcmQudHlwZSA9ICJub3JtYWwiLCBkZWxldGUgcmVjb3JkLmFyZywgZW50cnkuY29tcGxldGlvbiA9IHJlY29yZDt9ZnVuY3Rpb24gQ29udGV4dCh0cnlMb2NzTGlzdCkge3RoaXMudHJ5RW50cmllcyA9IFt7IHRyeUxvYzogInJvb3QiIH1dLCB0cnlMb2NzTGlzdC5mb3JFYWNoKHB1c2hUcnlFbnRyeSwgdGhpcyksIHRoaXMucmVzZXQoITApO31mdW5jdGlvbiB2YWx1ZXMoaXRlcmFibGUpIHtpZiAoaXRlcmFibGUpIHt2YXIgaXRlcmF0b3JNZXRob2QgPSBpdGVyYWJsZVtpdGVyYXRvclN5bWJvbF07aWYgKGl0ZXJhdG9yTWV0aG9kKSByZXR1cm4gaXRlcmF0b3JNZXRob2QuY2FsbChpdGVyYWJsZSk7aWYgKCJmdW5jdGlvbiIgPT0gdHlwZW9mIGl0ZXJhYmxlLm5leHQpIHJldHVybiBpdGVyYWJsZTtpZiAoIWlzTmFOKGl0ZXJhYmxlLmxlbmd0aCkpIHt2YXIgaSA9IC0xLG5leHQgPSBmdW5jdGlvbiBuZXh0KCkge2ZvciAoOyArK2kgPCBpdGVyYWJsZS5sZW5ndGg7KSB7aWYgKGhhc093bi5jYWxsKGl0ZXJhYmxlLCBpKSkgcmV0dXJuIG5leHQudmFsdWUgPSBpdGVyYWJsZVtpXSwgbmV4dC5kb25lID0gITEsIG5leHQ7fXJldHVybiBuZXh0LnZhbHVlID0gdW5kZWZpbmVkLCBuZXh0LmRvbmUgPSAhMCwgbmV4dDt9O3JldHVybiBuZXh0Lm5leHQgPSBuZXh0O319cmV0dXJuIHsgbmV4dDogZG9uZVJlc3VsdCB9O31mdW5jdGlvbiBkb25lUmVzdWx0KCkge3JldHVybiB7IHZhbHVlOiB1bmRlZmluZWQsIGRvbmU6ICEwIH07fXJldHVybiBHZW5lcmF0b3JGdW5jdGlvbi5wcm90b3R5cGUgPSBHZW5lcmF0b3JGdW5jdGlvblByb3RvdHlwZSwgZGVmaW5lUHJvcGVydHkoR3AsICJjb25zdHJ1Y3RvciIsIHsgdmFsdWU6IEdlbmVyYXRvckZ1bmN0aW9uUHJvdG90eXBlLCBjb25maWd1cmFibGU6ICEwIH0pLCBkZWZpbmVQcm9wZXJ0eShHZW5lcmF0b3JGdW5jdGlvblByb3RvdHlwZSwgImNvbnN0cnVjdG9yIiwgeyB2YWx1ZTogR2VuZXJhdG9yRnVuY3Rpb24sIGNvbmZpZ3VyYWJsZTogITAgfSksIEdlbmVyYXRvckZ1bmN0aW9uLmRpc3BsYXlOYW1lID0gZGVmaW5lKEdlbmVyYXRvckZ1bmN0aW9uUHJvdG90eXBlLCB0b1N0cmluZ1RhZ1N5bWJvbCwgIkdlbmVyYXRvckZ1bmN0aW9uIiksIGV4cG9ydHMuaXNHZW5lcmF0b3JGdW5jdGlvbiA9IGZ1bmN0aW9uIChnZW5GdW4pIHt2YXIgY3RvciA9ICJmdW5jdGlvbiIgPT0gdHlwZW9mIGdlbkZ1biAmJiBnZW5GdW4uY29uc3RydWN0b3I7cmV0dXJuICEhY3RvciAmJiAoY3RvciA9PT0gR2VuZXJhdG9yRnVuY3Rpb24gfHwgIkdlbmVyYXRvckZ1bmN0aW9uIiA9PT0gKGN0b3IuZGlzcGxheU5hbWUgfHwgY3Rvci5uYW1lKSk7fSwgZXhwb3J0cy5tYXJrID0gZnVuY3Rpb24gKGdlbkZ1bikge3JldHVybiBPYmplY3Quc2V0UHJvdG90eXBlT2YgPyBPYmplY3Quc2V0UHJvdG90eXBlT2YoZ2VuRnVuLCBHZW5lcmF0b3JGdW5jdGlvblByb3RvdHlwZSkgOiAoZ2VuRnVuLl9fcHJvdG9fXyA9IEdlbmVyYXRvckZ1bmN0aW9uUHJvdG90eXBlLCBkZWZpbmUoZ2VuRnVuLCB0b1N0cmluZ1RhZ1N5bWJvbCwgIkdlbmVyYXRvckZ1bmN0aW9uIikpLCBnZW5GdW4ucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZShHcCksIGdlbkZ1bjt9LCBleHBvcnRzLmF3cmFwID0gZnVuY3Rpb24gKGFyZykge3JldHVybiB7IF9fYXdhaXQ6IGFyZyB9O30sIGRlZmluZUl0ZXJhdG9yTWV0aG9kcyhBc3luY0l0ZXJhdG9yLnByb3RvdHlwZSksIGRlZmluZShBc3luY0l0ZXJhdG9yLnByb3RvdHlwZSwgYXN5bmNJdGVyYXRvclN5bWJvbCwgZnVuY3Rpb24gKCkge3JldHVybiB0aGlzO30pLCBleHBvcnRzLkFzeW5jSXRlcmF0b3IgPSBBc3luY0l0ZXJhdG9yLCBleHBvcnRzLmFzeW5jID0gZnVuY3Rpb24gKGlubmVyRm4sIG91dGVyRm4sIHNlbGYsIHRyeUxvY3NMaXN0LCBQcm9taXNlSW1wbCkge3ZvaWQgMCA9PT0gUHJvbWlzZUltcGwgJiYgKFByb21pc2VJbXBsID0gUHJvbWlzZSk7dmFyIGl0ZXIgPSBuZXcgQXN5bmNJdGVyYXRvcih3cmFwKGlubmVyRm4sIG91dGVyRm4sIHNlbGYsIHRyeUxvY3NMaXN0KSwgUHJvbWlzZUltcGwpO3JldHVybiBleHBvcnRzLmlzR2VuZXJhdG9yRnVuY3Rpb24ob3V0ZXJGbikgPyBpdGVyIDogaXRlci5uZXh0KCkudGhlbihmdW5jdGlvbiAocmVzdWx0KSB7cmV0dXJuIHJlc3VsdC5kb25lID8gcmVzdWx0LnZhbHVlIDogaXRlci5uZXh0KCk7fSk7fSwgZGVmaW5lSXRlcmF0b3JNZXRob2RzKEdwKSwgZGVmaW5lKEdwLCB0b1N0cmluZ1RhZ1N5bWJvbCwgIkdlbmVyYXRvciIpLCBkZWZpbmUoR3AsIGl0ZXJhdG9yU3ltYm9sLCBmdW5jdGlvbiAoKSB7cmV0dXJuIHRoaXM7fSksIGRlZmluZShHcCwgInRvU3RyaW5nIiwgZnVuY3Rpb24gKCkge3JldHVybiAiW29iamVjdCBHZW5lcmF0b3JdIjt9KSwgZXhwb3J0cy5rZXlzID0gZnVuY3Rpb24gKHZhbCkge3ZhciBvYmplY3QgPSBPYmplY3QodmFsKSxrZXlzID0gW107Zm9yICh2YXIga2V5IGluIG9iamVjdCkge2tleXMucHVzaChrZXkpO31yZXR1cm4ga2V5cy5yZXZlcnNlKCksIGZ1bmN0aW9uIG5leHQoKSB7Zm9yICg7IGtleXMubGVuZ3RoOykge3ZhciBrZXkgPSBrZXlzLnBvcCgpO2lmIChrZXkgaW4gb2JqZWN0KSByZXR1cm4gbmV4dC52YWx1ZSA9IGtleSwgbmV4dC5kb25lID0gITEsIG5leHQ7fXJldHVybiBuZXh0LmRvbmUgPSAhMCwgbmV4dDt9O30sIGV4cG9ydHMudmFsdWVzID0gdmFsdWVzLCBDb250ZXh0LnByb3RvdHlwZSA9IHsgY29uc3RydWN0b3I6IENvbnRleHQsIHJlc2V0OiBmdW5jdGlvbiByZXNldChza2lwVGVtcFJlc2V0KSB7aWYgKHRoaXMucHJldiA9IDAsIHRoaXMubmV4dCA9IDAsIHRoaXMuc2VudCA9IHRoaXMuX3NlbnQgPSB1bmRlZmluZWQsIHRoaXMuZG9uZSA9ICExLCB0aGlzLmRlbGVnYXRlID0gbnVsbCwgdGhpcy5tZXRob2QgPSAibmV4dCIsIHRoaXMuYXJnID0gdW5kZWZpbmVkLCB0aGlzLnRyeUVudHJpZXMuZm9yRWFjaChyZXNldFRyeUVudHJ5KSwgIXNraXBUZW1wUmVzZXQpIGZvciAodmFyIG5hbWUgaW4gdGhpcykgeyJ0IiA9PT0gbmFtZS5jaGFyQXQoMCkgJiYgaGFzT3duLmNhbGwodGhpcywgbmFtZSkgJiYgIWlzTmFOKCtuYW1lLnNsaWNlKDEpKSAmJiAodGhpc1tuYW1lXSA9IHVuZGVmaW5lZCk7fX0sIHN0b3A6IGZ1bmN0aW9uIHN0b3AoKSB7dGhpcy5kb25lID0gITA7dmFyIHJvb3RSZWNvcmQgPSB0aGlzLnRyeUVudHJpZXNbMF0uY29tcGxldGlvbjtpZiAoInRocm93IiA9PT0gcm9vdFJlY29yZC50eXBlKSB0aHJvdyByb290UmVjb3JkLmFyZztyZXR1cm4gdGhpcy5ydmFsO30sIGRpc3BhdGNoRXhjZXB0aW9uOiBmdW5jdGlvbiBkaXNwYXRjaEV4Y2VwdGlvbihleGNlcHRpb24pIHtpZiAodGhpcy5kb25lKSB0aHJvdyBleGNlcHRpb247dmFyIGNvbnRleHQgPSB0aGlzO2Z1bmN0aW9uIGhhbmRsZShsb2MsIGNhdWdodCkge3JldHVybiByZWNvcmQudHlwZSA9ICJ0aHJvdyIsIHJlY29yZC5hcmcgPSBleGNlcHRpb24sIGNvbnRleHQubmV4dCA9IGxvYywgY2F1Z2h0ICYmIChjb250ZXh0Lm1ldGhvZCA9ICJuZXh0IiwgY29udGV4dC5hcmcgPSB1bmRlZmluZWQpLCAhIWNhdWdodDt9Zm9yICh2YXIgaSA9IHRoaXMudHJ5RW50cmllcy5sZW5ndGggLSAxOyBpID49IDA7IC0taSkge3ZhciBlbnRyeSA9IHRoaXMudHJ5RW50cmllc1tpXSxyZWNvcmQgPSBlbnRyeS5jb21wbGV0aW9uO2lmICgicm9vdCIgPT09IGVudHJ5LnRyeUxvYykgcmV0dXJuIGhhbmRsZSgiZW5kIik7aWYgKGVudHJ5LnRyeUxvYyA8PSB0aGlzLnByZXYpIHt2YXIgaGFzQ2F0Y2ggPSBoYXNPd24uY2FsbChlbnRyeSwgImNhdGNoTG9jIiksaGFzRmluYWxseSA9IGhhc093bi5jYWxsKGVudHJ5LCAiZmluYWxseUxvYyIpO2lmIChoYXNDYXRjaCAmJiBoYXNGaW5hbGx5KSB7aWYgKHRoaXMucHJldiA8IGVudHJ5LmNhdGNoTG9jKSByZXR1cm4gaGFuZGxlKGVudHJ5LmNhdGNoTG9jLCAhMCk7aWYgKHRoaXMucHJldiA8IGVudHJ5LmZpbmFsbHlMb2MpIHJldHVybiBoYW5kbGUoZW50cnkuZmluYWxseUxvYyk7fSBlbHNlIGlmIChoYXNDYXRjaCkge2lmICh0aGlzLnByZXYgPCBlbnRyeS5jYXRjaExvYykgcmV0dXJuIGhhbmRsZShlbnRyeS5jYXRjaExvYywgITApO30gZWxzZSB7aWYgKCFoYXNGaW5hbGx5KSB0aHJvdyBuZXcgRXJyb3IoInRyeSBzdGF0ZW1lbnQgd2l0aG91dCBjYXRjaCBvciBmaW5hbGx5Iik7aWYgKHRoaXMucHJldiA8IGVudHJ5LmZpbmFsbHlMb2MpIHJldHVybiBoYW5kbGUoZW50cnkuZmluYWxseUxvYyk7fX19fSwgYWJydXB0OiBmdW5jdGlvbiBhYnJ1cHQodHlwZSwgYXJnKSB7Zm9yICh2YXIgaSA9IHRoaXMudHJ5RW50cmllcy5sZW5ndGggLSAxOyBpID49IDA7IC0taSkge3ZhciBlbnRyeSA9IHRoaXMudHJ5RW50cmllc1tpXTtpZiAoZW50cnkudHJ5TG9jIDw9IHRoaXMucHJldiAmJiBoYXNPd24uY2FsbChlbnRyeSwgImZpbmFsbHlMb2MiKSAmJiB0aGlzLnByZXYgPCBlbnRyeS5maW5hbGx5TG9jKSB7dmFyIGZpbmFsbHlFbnRyeSA9IGVudHJ5O2JyZWFrO319ZmluYWxseUVudHJ5ICYmICgiYnJlYWsiID09PSB0eXBlIHx8ICJjb250aW51ZSIgPT09IHR5cGUpICYmIGZpbmFsbHlFbnRyeS50cnlMb2MgPD0gYXJnICYmIGFyZyA8PSBmaW5hbGx5RW50cnkuZmluYWxseUxvYyAmJiAoZmluYWxseUVudHJ5ID0gbnVsbCk7dmFyIHJlY29yZCA9IGZpbmFsbHlFbnRyeSA/IGZpbmFsbHlFbnRyeS5jb21wbGV0aW9uIDoge307cmV0dXJuIHJlY29yZC50eXBlID0gdHlwZSwgcmVjb3JkLmFyZyA9IGFyZywgZmluYWxseUVudHJ5ID8gKHRoaXMubWV0aG9kID0gIm5leHQiLCB0aGlzLm5leHQgPSBmaW5hbGx5RW50cnkuZmluYWxseUxvYywgQ29udGludWVTZW50aW5lbCkgOiB0aGlzLmNvbXBsZXRlKHJlY29yZCk7fSwgY29tcGxldGU6IGZ1bmN0aW9uIGNvbXBsZXRlKHJlY29yZCwgYWZ0ZXJMb2MpIHtpZiAoInRocm93IiA9PT0gcmVjb3JkLnR5cGUpIHRocm93IHJlY29yZC5hcmc7cmV0dXJuICJicmVhayIgPT09IHJlY29yZC50eXBlIHx8ICJjb250aW51ZSIgPT09IHJlY29yZC50eXBlID8gdGhpcy5uZXh0ID0gcmVjb3JkLmFyZyA6ICJyZXR1cm4iID09PSByZWNvcmQudHlwZSA/ICh0aGlzLnJ2YWwgPSB0aGlzLmFyZyA9IHJlY29yZC5hcmcsIHRoaXMubWV0aG9kID0gInJldHVybiIsIHRoaXMubmV4dCA9ICJlbmQiKSA6ICJub3JtYWwiID09PSByZWNvcmQudHlwZSAmJiBhZnRlckxvYyAmJiAodGhpcy5uZXh0ID0gYWZ0ZXJMb2MpLCBDb250aW51ZVNlbnRpbmVsO30sIGZpbmlzaDogZnVuY3Rpb24gZmluaXNoKGZpbmFsbHlMb2MpIHtmb3IgKHZhciBpID0gdGhpcy50cnlFbnRyaWVzLmxlbmd0aCAtIDE7IGkgPj0gMDsgLS1pKSB7dmFyIGVudHJ5ID0gdGhpcy50cnlFbnRyaWVzW2ldO2lmIChlbnRyeS5maW5hbGx5TG9jID09PSBmaW5hbGx5TG9jKSByZXR1cm4gdGhpcy5jb21wbGV0ZShlbnRyeS5jb21wbGV0aW9uLCBlbnRyeS5hZnRlckxvYyksIHJlc2V0VHJ5RW50cnkoZW50cnkpLCBDb250aW51ZVNlbnRpbmVsO319LCBjYXRjaDogZnVuY3Rpb24gX2NhdGNoKHRyeUxvYykge2ZvciAodmFyIGkgPSB0aGlzLnRyeUVudHJpZXMubGVuZ3RoIC0gMTsgaSA+PSAwOyAtLWkpIHt2YXIgZW50cnkgPSB0aGlzLnRyeUVudHJpZXNbaV07aWYgKGVudHJ5LnRyeUxvYyA9PT0gdHJ5TG9jKSB7dmFyIHJlY29yZCA9IGVudHJ5LmNvbXBsZXRpb247aWYgKCJ0aHJvdyIgPT09IHJlY29yZC50eXBlKSB7dmFyIHRocm93biA9IHJlY29yZC5hcmc7cmVzZXRUcnlFbnRyeShlbnRyeSk7fXJldHVybiB0aHJvd247fX10aHJvdyBuZXcgRXJyb3IoImlsbGVnYWwgY2F0Y2ggYXR0ZW1wdCIpO30sIGRlbGVnYXRlWWllbGQ6IGZ1bmN0aW9uIGRlbGVnYXRlWWllbGQoaXRlcmFibGUsIHJlc3VsdE5hbWUsIG5leHRMb2MpIHtyZXR1cm4gdGhpcy5kZWxlZ2F0ZSA9IHsgaXRlcmF0b3I6IHZhbHVlcyhpdGVyYWJsZSksIHJlc3VsdE5hbWU6IHJlc3VsdE5hbWUsIG5leHRMb2M6IG5leHRMb2MgfSwgIm5leHQiID09PSB0aGlzLm1ldGhvZCAmJiAodGhpcy5hcmcgPSB1bmRlZmluZWQpLCBDb250aW51ZVNlbnRpbmVsO30gfSwgZXhwb3J0czt9ZnVuY3Rpb24gYXN5bmNHZW5lcmF0b3JTdGVwKGdlbiwgcmVzb2x2ZSwgcmVqZWN0LCBfbmV4dCwgX3Rocm93LCBrZXksIGFyZykge3RyeSB7dmFyIGluZm8gPSBnZW5ba2V5XShhcmcpO3ZhciB2YWx1ZSA9IGluZm8udmFsdWU7fSBjYXRjaCAoZXJyb3IpIHtyZWplY3QoZXJyb3IpO3JldHVybjt9aWYgKGluZm8uZG9uZSkge3Jlc29sdmUodmFsdWUpO30gZWxzZSB7UHJvbWlzZS5yZXNvbHZlKHZhbHVlKS50aGVuKF9uZXh0LCBfdGhyb3cpO319ZnVuY3Rpb24gX2FzeW5jVG9HZW5lcmF0b3IyKGZuKSB7cmV0dXJuIGZ1bmN0aW9uICgpIHt2YXIgc2VsZiA9IHRoaXMsYXJncyA9IGFyZ3VtZW50cztyZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge3ZhciBnZW4gPSBmbi5hcHBseShzZWxmLCBhcmdzKTtmdW5jdGlvbiBfbmV4dCh2YWx1ZSkge2FzeW5jR2VuZXJhdG9yU3RlcChnZW4sIHJlc29sdmUsIHJlamVjdCwgX25leHQsIF90aHJvdywgIm5leHQiLCB2YWx1ZSk7fWZ1bmN0aW9uIF90aHJvdyhlcnIpIHthc3luY0dlbmVyYXRvclN0ZXAoZ2VuLCByZXNvbHZlLCByZWplY3QsIF9uZXh0LCBfdGhyb3csICJ0aHJvdyIsIGVycik7fV9uZXh0KHVuZGVmaW5lZCk7fSk7fTt9ZnVuY3Rpb24gX2RlZmluZVByb3BlcnR5MihvYmosIGtleSwgdmFsdWUpIHtrZXkgPSBfdG9Qcm9wZXJ0eUtleTIoa2V5KTtpZiAoa2V5IGluIG9iaikge09iamVjdC5kZWZpbmVQcm9wZXJ0eShvYmosIGtleSwgeyB2YWx1ZTogdmFsdWUsIGVudW1lcmFibGU6IHRydWUsIGNvbmZpZ3VyYWJsZTogdHJ1ZSwgd3JpdGFibGU6IHRydWUgfSk7fSBlbHNlIHtvYmpba2V5XSA9IHZhbHVlO31yZXR1cm4gb2JqO31mdW5jdGlvbiBfZGVmaW5lUHJvcGVydGllcyh0YXJnZXQsIHByb3BzKSB7Zm9yICh2YXIgaSA9IDA7IGkgPCBwcm9wcy5sZW5ndGg7IGkrKykge3ZhciBkZXNjcmlwdG9yID0gcHJvcHNbaV07ZGVzY3JpcHRvci5lbnVtZXJhYmxlID0gZGVzY3JpcHRvci5lbnVtZXJhYmxlIHx8IGZhbHNlO2Rlc2NyaXB0b3IuY29uZmlndXJhYmxlID0gdHJ1ZTtpZiAoInZhbHVlIiBpbiBkZXNjcmlwdG9yKSBkZXNjcmlwdG9yLndyaXRhYmxlID0gdHJ1ZTtPYmplY3QuZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBfdG9Qcm9wZXJ0eUtleTIoZGVzY3JpcHRvci5rZXkpLCBkZXNjcmlwdG9yKTt9fWZ1bmN0aW9uIF9jcmVhdGVDbGFzczIoQ29uc3RydWN0b3IsIHByb3RvUHJvcHMsIHN0YXRpY1Byb3BzKSB7aWYgKHByb3RvUHJvcHMpIF9kZWZpbmVQcm9wZXJ0aWVzKENvbnN0cnVjdG9yLnByb3RvdHlwZSwgcHJvdG9Qcm9wcyk7aWYgKHN0YXRpY1Byb3BzKSBfZGVmaW5lUHJvcGVydGllcyhDb25zdHJ1Y3Rvciwgc3RhdGljUHJvcHMpO09iamVjdC5kZWZpbmVQcm9wZXJ0eShDb25zdHJ1Y3RvciwgInByb3RvdHlwZSIsIHsgd3JpdGFibGU6IGZhbHNlIH0pO3JldHVybiBDb25zdHJ1Y3Rvcjt9ZnVuY3Rpb24gX3RvUHJvcGVydHlLZXkyKGFyZykge3ZhciBrZXkgPSBfdG9QcmltaXRpdmUyKGFyZywgInN0cmluZyIpO3JldHVybiB0eXBlb2Yga2V5ID09PSAic3ltYm9sIiA/IGtleSA6IFN0cmluZyhrZXkpO31mdW5jdGlvbiBfdG9QcmltaXRpdmUyKGlucHV0LCBoaW50KSB7aWYgKHR5cGVvZiBpbnB1dCAhPT0gIm9iamVjdCIgfHwgaW5wdXQgPT09IG51bGwpIHJldHVybiBpbnB1dDt2YXIgcHJpbSA9IGlucHV0W1N5bWJvbC50b1ByaW1pdGl2ZV07aWYgKHByaW0gIT09IHVuZGVmaW5lZCkge3ZhciByZXMgPSBwcmltLmNhbGwoaW5wdXQsIGhpbnQgfHwgImRlZmF1bHQiKTtpZiAodHlwZW9mIHJlcyAhPT0gIm9iamVjdCIpIHJldHVybiByZXM7dGhyb3cgbmV3IFR5cGVFcnJvcigiQEB0b1ByaW1pdGl2ZSBtdXN0IHJldHVybiBhIHByaW1pdGl2ZSB2YWx1ZS4iKTt9cmV0dXJuIChoaW50ID09PSAic3RyaW5nIiA/IFN0cmluZyA6IE51bWJlcikoaW5wdXQpO31mdW5jdGlvbiBfY2xhc3NDYWxsQ2hlY2syKGluc3RhbmNlLCBDb25zdHJ1Y3Rvcikge2lmICghKGluc3RhbmNlIGluc3RhbmNlb2YgQ29uc3RydWN0b3IpKSB7dGhyb3cgbmV3IFR5cGVFcnJvcigiQ2Fubm90IGNhbGwgYSBjbGFzcyBhcyBhIGZ1bmN0aW9uIik7fX1mdW5jdGlvbiBfaW5oZXJpdHMoc3ViQ2xhc3MsIHN1cGVyQ2xhc3MpIHtpZiAodHlwZW9mIHN1cGVyQ2xhc3MgIT09ICJmdW5jdGlvbiIgJiYgc3VwZXJDbGFzcyAhPT0gbnVsbCkge3Rocm93IG5ldyBUeXBlRXJyb3IoIlN1cGVyIGV4cHJlc3Npb24gbXVzdCBlaXRoZXIgYmUgbnVsbCBvciBhIGZ1bmN0aW9uIik7fXN1YkNsYXNzLnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoc3VwZXJDbGFzcyAmJiBzdXBlckNsYXNzLnByb3RvdHlwZSwgeyBjb25zdHJ1Y3RvcjogeyB2YWx1ZTogc3ViQ2xhc3MsIHdyaXRhYmxlOiB0cnVlLCBjb25maWd1cmFibGU6IHRydWUgfSB9KTtPYmplY3QuZGVmaW5lUHJvcGVydHkoc3ViQ2xhc3MsICJwcm90b3R5cGUiLCB7IHdyaXRhYmxlOiBmYWxzZSB9KTtpZiAoc3VwZXJDbGFzcykgX3NldFByb3RvdHlwZU9mKHN1YkNsYXNzLCBzdXBlckNsYXNzKTt9ZnVuY3Rpb24gX2NyZWF0ZVN1cGVyKERlcml2ZWQpIHt2YXIgaGFzTmF0aXZlUmVmbGVjdENvbnN0cnVjdCA9IF9pc05hdGl2ZVJlZmxlY3RDb25zdHJ1Y3QoKTtyZXR1cm4gZnVuY3Rpb24gX2NyZWF0ZVN1cGVySW50ZXJuYWwoKSB7dmFyIFN1cGVyID0gX2dldFByb3RvdHlwZU9mKERlcml2ZWQpLHJlc3VsdDtpZiAoaGFzTmF0aXZlUmVmbGVjdENvbnN0cnVjdCkge3ZhciBOZXdUYXJnZXQgPSBfZ2V0UHJvdG90eXBlT2YodGhpcykuY29uc3RydWN0b3I7cmVzdWx0ID0gUmVmbGVjdC5jb25zdHJ1Y3QoU3VwZXIsIGFyZ3VtZW50cywgTmV3VGFyZ2V0KTt9IGVsc2Uge3Jlc3VsdCA9IFN1cGVyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7fXJldHVybiBfcG9zc2libGVDb25zdHJ1Y3RvclJldHVybih0aGlzLCByZXN1bHQpO307fWZ1bmN0aW9uIF9wb3NzaWJsZUNvbnN0cnVjdG9yUmV0dXJuKHNlbGYsIGNhbGwpIHtpZiAoY2FsbCAmJiAodHlwZW9mIGNhbGwgPT09ICJvYmplY3QiIHx8IHR5cGVvZiBjYWxsID09PSAiZnVuY3Rpb24iKSkge3JldHVybiBjYWxsO30gZWxzZSBpZiAoY2FsbCAhPT0gdm9pZCAwKSB7dGhyb3cgbmV3IFR5cGVFcnJvcigiRGVyaXZlZCBjb25zdHJ1Y3RvcnMgbWF5IG9ubHkgcmV0dXJuIG9iamVjdCBvciB1bmRlZmluZWQiKTt9cmV0dXJuIF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoc2VsZik7fWZ1bmN0aW9uIF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoc2VsZikge2lmIChzZWxmID09PSB2b2lkIDApIHt0aHJvdyBuZXcgUmVmZXJlbmNlRXJyb3IoInRoaXMgaGFzbid0IGJlZW4gaW5pdGlhbGlzZWQgLSBzdXBlcigpIGhhc24ndCBiZWVuIGNhbGxlZCIpO31yZXR1cm4gc2VsZjt9ZnVuY3Rpb24gX3dyYXBOYXRpdmVTdXBlcihDbGFzcykge3ZhciBfY2FjaGUgPSB0eXBlb2YgTWFwID09PSAiZnVuY3Rpb24iID8gbmV3IE1hcCgpIDogdW5kZWZpbmVkO193cmFwTmF0aXZlU3VwZXIgPSBmdW5jdGlvbiBfd3JhcE5hdGl2ZVN1cGVyKENsYXNzKSB7aWYgKENsYXNzID09PSBudWxsIHx8ICFfaXNOYXRpdmVGdW5jdGlvbihDbGFzcykpIHJldHVybiBDbGFzcztpZiAodHlwZW9mIENsYXNzICE9PSAiZnVuY3Rpb24iKSB7dGhyb3cgbmV3IFR5cGVFcnJvcigiU3VwZXIgZXhwcmVzc2lvbiBtdXN0IGVpdGhlciBiZSBudWxsIG9yIGEgZnVuY3Rpb24iKTt9aWYgKHR5cGVvZiBfY2FjaGUgIT09ICJ1bmRlZmluZWQiKSB7aWYgKF9jYWNoZS5oYXMoQ2xhc3MpKSByZXR1cm4gX2NhY2hlLmdldChDbGFzcyk7X2NhY2hlLnNldChDbGFzcywgV3JhcHBlcik7fWZ1bmN0aW9uIFdyYXBwZXIoKSB7cmV0dXJuIF9jb25zdHJ1Y3QoQ2xhc3MsIGFyZ3VtZW50cywgX2dldFByb3RvdHlwZU9mKHRoaXMpLmNvbnN0cnVjdG9yKTt9V3JhcHBlci5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKENsYXNzLnByb3RvdHlwZSwgeyBjb25zdHJ1Y3RvcjogeyB2YWx1ZTogV3JhcHBlciwgZW51bWVyYWJsZTogZmFsc2UsIHdyaXRhYmxlOiB0cnVlLCBjb25maWd1cmFibGU6IHRydWUgfSB9KTtyZXR1cm4gX3NldFByb3RvdHlwZU9mKFdyYXBwZXIsIENsYXNzKTt9O3JldHVybiBfd3JhcE5hdGl2ZVN1cGVyKENsYXNzKTt9ZnVuY3Rpb24gX2NvbnN0cnVjdChQYXJlbnQsIGFyZ3MsIENsYXNzKSB7aWYgKF9pc05hdGl2ZVJlZmxlY3RDb25zdHJ1Y3QoKSkge19jb25zdHJ1Y3QgPSBSZWZsZWN0LmNvbnN0cnVjdC5iaW5kKCk7fSBlbHNlIHtfY29uc3RydWN0ID0gZnVuY3Rpb24gX2NvbnN0cnVjdChQYXJlbnQsIGFyZ3MsIENsYXNzKSB7dmFyIGEgPSBbbnVsbF07YS5wdXNoLmFwcGx5KGEsIGFyZ3MpO3ZhciBDb25zdHJ1Y3RvciA9IEZ1bmN0aW9uLmJpbmQuYXBwbHkoUGFyZW50LCBhKTt2YXIgaW5zdGFuY2UgPSBuZXcgQ29uc3RydWN0b3IoKTtpZiAoQ2xhc3MpIF9zZXRQcm90b3R5cGVPZihpbnN0YW5jZSwgQ2xhc3MucHJvdG90eXBlKTtyZXR1cm4gaW5zdGFuY2U7fTt9cmV0dXJuIF9jb25zdHJ1Y3QuYXBwbHkobnVsbCwgYXJndW1lbnRzKTt9ZnVuY3Rpb24gX2lzTmF0aXZlUmVmbGVjdENvbnN0cnVjdCgpIHtpZiAodHlwZW9mIFJlZmxlY3QgPT09ICJ1bmRlZmluZWQiIHx8ICFSZWZsZWN0LmNvbnN0cnVjdCkgcmV0dXJuIGZhbHNlO2lmIChSZWZsZWN0LmNvbnN0cnVjdC5zaGFtKSByZXR1cm4gZmFsc2U7aWYgKHR5cGVvZiBQcm94eSA9PT0gImZ1bmN0aW9uIikgcmV0dXJuIHRydWU7dHJ5IHtCb29sZWFuLnByb3RvdHlwZS52YWx1ZU9mLmNhbGwoUmVmbGVjdC5jb25zdHJ1Y3QoQm9vbGVhbiwgW10sIGZ1bmN0aW9uICgpIHt9KSk7cmV0dXJuIHRydWU7fSBjYXRjaCAoZSkge3JldHVybiBmYWxzZTt9fWZ1bmN0aW9uIF9pc05hdGl2ZUZ1bmN0aW9uKGZuKSB7cmV0dXJuIEZ1bmN0aW9uLnRvU3RyaW5nLmNhbGwoZm4pLmluZGV4T2YoIltuYXRpdmUgY29kZV0iKSAhPT0gLTE7fWZ1bmN0aW9uIF9zZXRQcm90b3R5cGVPZihvLCBwKSB7X3NldFByb3RvdHlwZU9mID0gT2JqZWN0LnNldFByb3RvdHlwZU9mID8gT2JqZWN0LnNldFByb3RvdHlwZU9mLmJpbmQoKSA6IGZ1bmN0aW9uIF9zZXRQcm90b3R5cGVPZihvLCBwKSB7by5fX3Byb3RvX18gPSBwO3JldHVybiBvO307cmV0dXJuIF9zZXRQcm90b3R5cGVPZihvLCBwKTt9ZnVuY3Rpb24gX2dldFByb3RvdHlwZU9mKG8pIHtfZ2V0UHJvdG90eXBlT2YgPSBPYmplY3Quc2V0UHJvdG90eXBlT2YgPyBPYmplY3QuZ2V0UHJvdG90eXBlT2YuYmluZCgpIDogZnVuY3Rpb24gX2dldFByb3RvdHlwZU9mKG8pIHtyZXR1cm4gby5fX3Byb3RvX18gfHwgT2JqZWN0LmdldFByb3RvdHlwZU9mKG8pO307cmV0dXJuIF9nZXRQcm90b3R5cGVPZihvKTt9ZnVuY3Rpb24gX3NsaWNlZFRvQXJyYXkyKGFyciwgaSkge3JldHVybiBfYXJyYXlXaXRoSG9sZXMyKGFycikgfHwgX2l0ZXJhYmxlVG9BcnJheUxpbWl0MihhcnIsIGkpIHx8IF91bnN1cHBvcnRlZEl0ZXJhYmxlVG9BcnJheTIoYXJyLCBpKSB8fCBfbm9uSXRlcmFibGVSZXN0MigpO31mdW5jdGlvbiBfbm9uSXRlcmFibGVSZXN0MigpIHt0aHJvdyBuZXcgVHlwZUVycm9yKCJJbnZhbGlkIGF0dGVtcHQgdG8gZGVzdHJ1Y3R1cmUgbm9uLWl0ZXJhYmxlIGluc3RhbmNlLlxuSW4gb3JkZXIgdG8gYmUgaXRlcmFibGUsIG5vbi1hcnJheSBvYmplY3RzIG11c3QgaGF2ZSBhIFtTeW1ib2wuaXRlcmF0b3JdKCkgbWV0aG9kLiIpO31mdW5jdGlvbiBfaXRlcmFibGVUb0FycmF5TGltaXQyKGFyciwgaSkge3ZhciBfaSA9IG51bGwgPT0gYXJyID8gbnVsbCA6ICJ1bmRlZmluZWQiICE9IHR5cGVvZiBTeW1ib2wgJiYgYXJyW1N5bWJvbC5pdGVyYXRvcl0gfHwgYXJyWyJAQGl0ZXJhdG9yIl07aWYgKG51bGwgIT0gX2kpIHt2YXIgX3MsX2UsX3gsX3IsX2FyciA9IFtdLF9uID0gITAsX2QgPSAhMTt0cnkge2lmIChfeCA9IChfaSA9IF9pLmNhbGwoYXJyKSkubmV4dCwgMCA9PT0gaSkge2lmIChPYmplY3QoX2kpICE9PSBfaSkgcmV0dXJuO19uID0gITE7fSBlbHNlIGZvciAoOyAhKF9uID0gKF9zID0gX3guY2FsbChfaSkpLmRvbmUpICYmIChfYXJyLnB1c2goX3MudmFsdWUpLCBfYXJyLmxlbmd0aCAhPT0gaSk7IF9uID0gITApIHs7fX0gY2F0Y2ggKGVycikge19kID0gITAsIF9lID0gZXJyO30gZmluYWxseSB7dHJ5IHtpZiAoIV9uICYmIG51bGwgIT0gX2kucmV0dXJuICYmIChfciA9IF9pLnJldHVybigpLCBPYmplY3QoX3IpICE9PSBfcikpIHJldHVybjt9IGZpbmFsbHkge2lmIChfZCkgdGhyb3cgX2U7fX1yZXR1cm4gX2Fycjt9fWZ1bmN0aW9uIF9hcnJheVdpdGhIb2xlczIoYXJyKSB7aWYgKEFycmF5LmlzQXJyYXkoYXJyKSkgcmV0dXJuIGFycjt9ZnVuY3Rpb24gX3RvQ29uc3VtYWJsZUFycmF5MihhcnIpIHtyZXR1cm4gX2FycmF5V2l0aG91dEhvbGVzMihhcnIpIHx8IF9pdGVyYWJsZVRvQXJyYXkyKGFycikgfHwgX3Vuc3VwcG9ydGVkSXRlcmFibGVUb0FycmF5MihhcnIpIHx8IF9ub25JdGVyYWJsZVNwcmVhZDIoKTt9ZnVuY3Rpb24gX25vbkl0ZXJhYmxlU3ByZWFkMigpIHt0aHJvdyBuZXcgVHlwZUVycm9yKCJJbnZhbGlkIGF0dGVtcHQgdG8gc3ByZWFkIG5vbi1pdGVyYWJsZSBpbnN0YW5jZS5cbkluIG9yZGVyIHRvIGJlIGl0ZXJhYmxlLCBub24tYXJyYXkgb2JqZWN0cyBtdXN0IGhhdmUgYSBbU3ltYm9sLml0ZXJhdG9yXSgpIG1ldGhvZC4iKTt9ZnVuY3Rpb24gX3Vuc3VwcG9ydGVkSXRlcmFibGVUb0FycmF5MihvLCBtaW5MZW4pIHtpZiAoIW8pIHJldHVybjtpZiAodHlwZW9mIG8gPT09ICJzdHJpbmciKSByZXR1cm4gX2FycmF5TGlrZVRvQXJyYXkyKG8sIG1pbkxlbik7dmFyIG4gPSBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwobykuc2xpY2UoOCwgLTEpO2lmIChuID09PSAiT2JqZWN0IiAmJiBvLmNvbnN0cnVjdG9yKSBuID0gby5jb25zdHJ1Y3Rvci5uYW1lO2lmIChuID09PSAiTWFwIiB8fCBuID09PSAiU2V0IikgcmV0dXJuIEFycmF5LmZyb20obyk7aWYgKG4gPT09ICJBcmd1bWVudHMiIHx8IC9eKD86VWl8SSludCg/Ojh8MTZ8MzIpKD86Q2xhbXBlZCk/QXJyYXkkLy50ZXN0KG4pKSByZXR1cm4gX2FycmF5TGlrZVRvQXJyYXkyKG8sIG1pbkxlbik7fWZ1bmN0aW9uIF9pdGVyYWJsZVRvQXJyYXkyKGl0ZXIpIHtpZiAodHlwZW9mIFN5bWJvbCAhPT0gInVuZGVmaW5lZCIgJiYgaXRlcltTeW1ib2wuaXRlcmF0b3JdICE9IG51bGwgfHwgaXRlclsiQEBpdGVyYXRvciJdICE9IG51bGwpIHJldHVybiBBcnJheS5mcm9tKGl0ZXIpO31mdW5jdGlvbiBfYXJyYXlXaXRob3V0SG9sZXMyKGFycikge2lmIChBcnJheS5pc0FycmF5KGFycikpIHJldHVybiBfYXJyYXlMaWtlVG9BcnJheTIoYXJyKTt9ZnVuY3Rpb24gX2FycmF5TGlrZVRvQXJyYXkyKGFyciwgbGVuKSB7aWYgKGxlbiA9PSBudWxsIHx8IGxlbiA+IGFyci5sZW5ndGgpIGxlbiA9IGFyci5sZW5ndGg7Zm9yICh2YXIgaSA9IDAsIGFycjIgPSBuZXcgQXJyYXkobGVuKTsgaSA8IGxlbjsgaSsrKSB7YXJyMltpXSA9IGFycltpXTt9cmV0dXJuIGFycjI7fShmdW5jdGlvbiB3ZWJwYWNrVW5pdmVyc2FsTW9kdWxlRGVmaW5pdGlvbihyb290LCBmYWN0b3J5KSB7aWYgKHR5cGVvZiBleHBvcnRzID09PSAnb2JqZWN0JyAmJiB0eXBlb2YgbW9kdWxlID09PSAnb2JqZWN0JykKICBtb2R1bGUuZXhwb3J0cyA9IGZhY3RvcnkoKTtlbHNlCiAgaWYgKHR5cGVvZiBkZWZpbmUgPT09ICdmdW5jdGlvbicgJiYgZGVmaW5lLmFtZCkKICBkZWZpbmUoW10sIGZhY3RvcnkpO2Vsc2UKICB7CiAgICB2YXIgYSA9IGZhY3RvcnkoKTsKICAgIGZvciAodmFyIGkgaW4gYSkgeyh0eXBlb2YgZXhwb3J0cyA9PT0gJ29iamVjdCcgPyBleHBvcnRzIDogcm9vdClbaV0gPSBhW2ldO30KICB9Cn0pKHNlbGYsICgpID0+IHsKICByZXR1cm4gKC8qKioqKiovKCgpID0+IHsvLyB3ZWJwYWNrQm9vdHN0cmFwCiAgICAgIC8qKioqKiovInVzZSBzdHJpY3QiOwogICAgICAvKioqKioqL3ZhciBfX3dlYnBhY2tfbW9kdWxlc19fID0gewoKICAgICAgICAvKioqLzI0MjoKICAgICAgICAvKioqLyhfX3VudXNlZF93ZWJwYWNrX21vZHVsZSwgX193ZWJwYWNrX2V4cG9ydHNfXywgX193ZWJwYWNrX3JlcXVpcmVfXykgPT4gewoKCiAgICAgICAgICAvLyBFWFBPUlRTCiAgICAgICAgICBfX3dlYnBhY2tfcmVxdWlyZV9fLmQoX193ZWJwYWNrX2V4cG9ydHNfXywgewogICAgICAgICAgICAiWiI6ICgpID0+IC8qIGJpbmRpbmcgKi9yZWxheV9BcHAKICAgICAgICAgIH0pOwoKICAgICAgICAgIDsgLy8gQ09OQ0FURU5BVEVEIE1PRFVMRTogLi9ub2RlX21vZHVsZXMvQHJlbWl4LXJ1bi9yb3V0ZXIvZGlzdC9yb3V0ZXIuanMKICAgICAgICAgIC8qKgogICAgICAgICAgICogQHJlbWl4LXJ1bi9yb3V0ZXIgdjEuMC40CiAgICAgICAgICAgKgogICAgICAgICAgICogQ29weXJpZ2h0IChjKSBSZW1peCBTb2Z0d2FyZSBJbmMuCiAgICAgICAgICAgKgogICAgICAgICAgICogVGhpcyBzb3VyY2UgY29kZSBpcyBsaWNlbnNlZCB1bmRlciB0aGUgTUlUIGxpY2Vuc2UgZm91bmQgaW4gdGhlCiAgICAgICAgICAgKiBMSUNFTlNFLm1kIGZpbGUgaW4gdGhlIHJvb3QgZGlyZWN0b3J5IG9mIHRoaXMgc291cmNlIHRyZWUuCiAgICAgICAgICAgKgogICAgICAgICAgICogQGxpY2Vuc2UgTUlUCiAgICAgICAgICAgKi8KICAgICAgICAgIGZ1bmN0aW9uIF9leHRlbmRzKCkgewogICAgICAgICAgICBfZXh0ZW5kcyA9IE9iamVjdC5hc3NpZ24gPyBPYmplY3QuYXNzaWduLmJpbmQoKSA6IGZ1bmN0aW9uICh0YXJnZXQpIHsKICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMTsgaSA8IGFyZ3VtZW50cy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAgdmFyIHNvdXJjZSA9IGFyZ3VtZW50c1tpXTsKCiAgICAgICAgICAgICAgICBmb3IgKHZhciBrZXkgaW4gc291cmNlKSB7CiAgICAgICAgICAgICAgICAgIGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoc291cmNlLCBrZXkpKSB7CiAgICAgICAgICAgICAgICAgICAgdGFyZ2V0W2tleV0gPSBzb3VyY2Vba2V5XTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgcmV0dXJuIHRhcmdldDsKICAgICAgICAgICAgfTsKICAgICAgICAgICAgcmV0dXJuIF9leHRlbmRzLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgICAgICB9CgogICAgICAgICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KICAgICAgICAgIC8vI3JlZ2lvbiBUeXBlcyBhbmQgQ29uc3RhbnRzCiAgICAgICAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwoKICAgICAgICAgIC8qKgogICAgICAgICAgICogQWN0aW9ucyByZXByZXNlbnQgdGhlIHR5cGUgb2YgY2hhbmdlIHRvIGEgbG9jYXRpb24gdmFsdWUuCiAgICAgICAgICAgKi8KICAgICAgICAgIHZhciBBY3Rpb247CgogICAgICAgICAgKGZ1bmN0aW9uIChBY3Rpb24pIHsKICAgICAgICAgICAgLyoqCiAgICAgICAgICAgICAqIEEgUE9QIGluZGljYXRlcyBhIGNoYW5nZSB0byBhbiBhcmJpdHJhcnkgaW5kZXggaW4gdGhlIGhpc3Rvcnkgc3RhY2ssIHN1Y2gKICAgICAgICAgICAgICogYXMgYSBiYWNrIG9yIGZvcndhcmQgbmF2aWdhdGlvbi4gSXQgZG9lcyBub3QgZGVzY3JpYmUgdGhlIGRpcmVjdGlvbiBvZiB0aGUKICAgICAgICAgICAgICogbmF2aWdhdGlvbiwgb25seSB0aGF0IHRoZSBjdXJyZW50IGluZGV4IGNoYW5nZWQuCiAgICAgICAgICAgICAqCiAgICAgICAgICAgICAqIE5vdGU6IFRoaXMgaXMgdGhlIGRlZmF1bHQgYWN0aW9uIGZvciBuZXdseSBjcmVhdGVkIGhpc3Rvcnkgb2JqZWN0cy4KICAgICAgICAgICAgICovCiAgICAgICAgICAgIEFjdGlvblsiUG9wIl0gPSAiUE9QIjsKICAgICAgICAgICAgLyoqCiAgICAgICAgICAgICAqIEEgUFVTSCBpbmRpY2F0ZXMgYSBuZXcgZW50cnkgYmVpbmcgYWRkZWQgdG8gdGhlIGhpc3Rvcnkgc3RhY2ssIHN1Y2ggYXMgd2hlbgogICAgICAgICAgICAgKiBhIGxpbmsgaXMgY2xpY2tlZCBhbmQgYSBuZXcgcGFnZSBsb2Fkcy4gV2hlbiB0aGlzIGhhcHBlbnMsIGFsbCBzdWJzZXF1ZW50CiAgICAgICAgICAgICAqIGVudHJpZXMgaW4gdGhlIHN0YWNrIGFyZSBsb3N0LgogICAgICAgICAgICAgKi8KCiAgICAgICAgICAgIEFjdGlvblsiUHVzaCJdID0gIlBVU0giOwogICAgICAgICAgICAvKioKICAgICAgICAgICAgICogQSBSRVBMQUNFIGluZGljYXRlcyB0aGUgZW50cnkgYXQgdGhlIGN1cnJlbnQgaW5kZXggaW4gdGhlIGhpc3Rvcnkgc3RhY2sKICAgICAgICAgICAgICogYmVpbmcgcmVwbGFjZWQgYnkgYSBuZXcgb25lLgogICAgICAgICAgICAgKi8KCiAgICAgICAgICAgIEFjdGlvblsiUmVwbGFjZSJdID0gIlJFUExBQ0UiOwogICAgICAgICAgfSkoQWN0aW9uIHx8IChBY3Rpb24gPSB7fSkpOwoKICAgICAgICAgIHZhciBQb3BTdGF0ZUV2ZW50VHlwZSA9ICJwb3BzdGF0ZSI7CiAgICAgICAgICAvKioKICAgICAgICAgICAqIE1lbW9yeSBoaXN0b3J5IHN0b3JlcyB0aGUgY3VycmVudCBsb2NhdGlvbiBpbiBtZW1vcnkuIEl0IGlzIGRlc2lnbmVkIGZvciB1c2UKICAgICAgICAgICAqIGluIHN0YXRlZnVsIG5vbi1icm93c2VyIGVudmlyb25tZW50cyBsaWtlIHRlc3RzIGFuZCBSZWFjdCBOYXRpdmUuCiAgICAgICAgICAgKi8KCiAgICAgICAgICBmdW5jdGlvbiByb3V0ZXJfY3JlYXRlTWVtb3J5SGlzdG9yeShvcHRpb25zKSB7CiAgICAgICAgICAgIGlmIChvcHRpb25zID09PSB2b2lkIDApIHsKICAgICAgICAgICAgICBvcHRpb25zID0ge307CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHZhciBfb3B0aW9ucyA9CgoKCiAgICAgICAgICAgICAgb3B0aW9ucyxfb3B0aW9ucyRpbml0aWFsRW50cmkgPSBfb3B0aW9ucy5pbml0aWFsRW50cmllcyxpbml0aWFsRW50cmllcyA9IF9vcHRpb25zJGluaXRpYWxFbnRyaSA9PT0gdm9pZCAwID8gWyIvIl0gOiBfb3B0aW9ucyRpbml0aWFsRW50cmksaW5pdGlhbEluZGV4ID0gX29wdGlvbnMuaW5pdGlhbEluZGV4LF9vcHRpb25zJHY1Q29tcGF0ID0gX29wdGlvbnMudjVDb21wYXQsdjVDb21wYXQgPSBfb3B0aW9ucyR2NUNvbXBhdCA9PT0gdm9pZCAwID8gZmFsc2UgOiBfb3B0aW9ucyR2NUNvbXBhdDsKICAgICAgICAgICAgdmFyIGVudHJpZXM7IC8vIERlY2xhcmUgc28gd2UgY2FuIGFjY2VzcyBmcm9tIGNyZWF0ZU1lbW9yeUxvY2F0aW9uCgogICAgICAgICAgICBlbnRyaWVzID0gaW5pdGlhbEVudHJpZXMubWFwKChlbnRyeSwgaW5kZXgpID0+IGNyZWF0ZU1lbW9yeUxvY2F0aW9uKGVudHJ5LCB0eXBlb2YgZW50cnkgPT09ICJzdHJpbmciID8gbnVsbCA6IGVudHJ5LnN0YXRlLCBpbmRleCA9PT0gMCA/ICJkZWZhdWx0IiA6IHVuZGVmaW5lZCkpOwogICAgICAgICAgICB2YXIgaW5kZXggPSBjbGFtcEluZGV4KGluaXRpYWxJbmRleCA9PSBudWxsID8gZW50cmllcy5sZW5ndGggLSAxIDogaW5pdGlhbEluZGV4KTsKICAgICAgICAgICAgdmFyIGFjdGlvbiA9IEFjdGlvbi5Qb3A7CiAgICAgICAgICAgIHZhciBsaXN0ZW5lciA9IG51bGw7CgogICAgICAgICAgICBmdW5jdGlvbiBjbGFtcEluZGV4KG4pIHsKICAgICAgICAgICAgICByZXR1cm4gTWF0aC5taW4oTWF0aC5tYXgobiwgMCksIGVudHJpZXMubGVuZ3RoIC0gMSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGZ1bmN0aW9uIGdldEN1cnJlbnRMb2NhdGlvbigpIHsKICAgICAgICAgICAgICByZXR1cm4gZW50cmllc1tpbmRleF07CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGZ1bmN0aW9uIGNyZWF0ZU1lbW9yeUxvY2F0aW9uKHRvLCBzdGF0ZSwga2V5KSB7CiAgICAgICAgICAgICAgaWYgKHN0YXRlID09PSB2b2lkIDApIHsKICAgICAgICAgICAgICAgIHN0YXRlID0gbnVsbDsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIHZhciBsb2NhdGlvbiA9IGNyZWF0ZUxvY2F0aW9uKGVudHJpZXMgPyBnZXRDdXJyZW50TG9jYXRpb24oKS5wYXRobmFtZSA6ICIvIiwgdG8sIHN0YXRlLCBrZXkpOwogICAgICAgICAgICAgIHdhcm5pbmckMShsb2NhdGlvbi5wYXRobmFtZS5jaGFyQXQoMCkgPT09ICIvIiwgInJlbGF0aXZlIHBhdGhuYW1lcyBhcmUgbm90IHN1cHBvcnRlZCBpbiBtZW1vcnkgaGlzdG9yeTogIiArIEpTT04uc3RyaW5naWZ5KHRvKSk7CiAgICAgICAgICAgICAgcmV0dXJuIGxvY2F0aW9uOwogICAgICAgICAgICB9CgogICAgICAgICAgICB2YXIgaGlzdG9yeSA9IHsKICAgICAgICAgICAgICBnZXQgaW5kZXgoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gaW5kZXg7CiAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgZ2V0IGFjdGlvbigpIHsKICAgICAgICAgICAgICAgIHJldHVybiBhY3Rpb247CiAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgZ2V0IGxvY2F0aW9uKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIGdldEN1cnJlbnRMb2NhdGlvbigpOwogICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgIGNyZWF0ZUhyZWY6IGZ1bmN0aW9uIGNyZWF0ZUhyZWYodG8pIHsKICAgICAgICAgICAgICAgIHJldHVybiB0eXBlb2YgdG8gPT09ICJzdHJpbmciID8gdG8gOiByb3V0ZXJfY3JlYXRlUGF0aCh0byk7CiAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgZW5jb2RlTG9jYXRpb246IGZ1bmN0aW9uIGVuY29kZUxvY2F0aW9uKHRvKSB7CiAgICAgICAgICAgICAgICB2YXIgcGF0aCA9IHR5cGVvZiB0byA9PT0gInN0cmluZyIgPyBwYXJzZVBhdGgodG8pIDogdG87CiAgICAgICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgICBwYXRobmFtZTogcGF0aC5wYXRobmFtZSB8fCAiIiwKICAgICAgICAgICAgICAgICAgc2VhcmNoOiBwYXRoLnNlYXJjaCB8fCAiIiwKICAgICAgICAgICAgICAgICAgaGFzaDogcGF0aC5oYXNoIHx8ICIiCiAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgIHB1c2g6IGZ1bmN0aW9uIHB1c2godG8sIHN0YXRlKSB7CiAgICAgICAgICAgICAgICBhY3Rpb24gPSBBY3Rpb24uUHVzaDsKICAgICAgICAgICAgICAgIHZhciBuZXh0TG9jYXRpb24gPSBjcmVhdGVNZW1vcnlMb2NhdGlvbih0bywgc3RhdGUpOwogICAgICAgICAgICAgICAgaW5kZXggKz0gMTsKICAgICAgICAgICAgICAgIGVudHJpZXMuc3BsaWNlKGluZGV4LCBlbnRyaWVzLmxlbmd0aCwgbmV4dExvY2F0aW9uKTsKCiAgICAgICAgICAgICAgICBpZiAodjVDb21wYXQgJiYgbGlzdGVuZXIpIHsKICAgICAgICAgICAgICAgICAgbGlzdGVuZXIoewogICAgICAgICAgICAgICAgICAgIGFjdGlvbjogYWN0aW9uLAogICAgICAgICAgICAgICAgICAgIGxvY2F0aW9uOiBuZXh0TG9jYXRpb24KICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgcmVwbGFjZTogZnVuY3Rpb24gcmVwbGFjZSh0bywgc3RhdGUpIHsKICAgICAgICAgICAgICAgIGFjdGlvbiA9IEFjdGlvbi5SZXBsYWNlOwogICAgICAgICAgICAgICAgdmFyIG5leHRMb2NhdGlvbiA9IGNyZWF0ZU1lbW9yeUxvY2F0aW9uKHRvLCBzdGF0ZSk7CiAgICAgICAgICAgICAgICBlbnRyaWVzW2luZGV4XSA9IG5leHRMb2NhdGlvbjsKCiAgICAgICAgICAgICAgICBpZiAodjVDb21wYXQgJiYgbGlzdGVuZXIpIHsKICAgICAgICAgICAgICAgICAgbGlzdGVuZXIoewogICAgICAgICAgICAgICAgICAgIGFjdGlvbjogYWN0aW9uLAogICAgICAgICAgICAgICAgICAgIGxvY2F0aW9uOiBuZXh0TG9jYXRpb24KICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgZ286IGZ1bmN0aW9uIGdvKGRlbHRhKSB7CiAgICAgICAgICAgICAgICBhY3Rpb24gPSBBY3Rpb24uUG9wOwogICAgICAgICAgICAgICAgaW5kZXggPSBjbGFtcEluZGV4KGluZGV4ICsgZGVsdGEpOwoKICAgICAgICAgICAgICAgIGlmIChsaXN0ZW5lcikgewogICAgICAgICAgICAgICAgICBsaXN0ZW5lcih7CiAgICAgICAgICAgICAgICAgICAgYWN0aW9uOiBhY3Rpb24sCiAgICAgICAgICAgICAgICAgICAgbG9jYXRpb246IGdldEN1cnJlbnRMb2NhdGlvbigpCiAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgIGxpc3RlbjogZnVuY3Rpb24gbGlzdGVuKGZuKSB7CiAgICAgICAgICAgICAgICBsaXN0ZW5lciA9IGZuOwogICAgICAgICAgICAgICAgcmV0dXJuICgpID0+IHsKICAgICAgICAgICAgICAgICAgbGlzdGVuZXIgPSBudWxsOwogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICB9OwogICAgICAgICAgICByZXR1cm4gaGlzdG9yeTsKICAgICAgICAgIH0KICAgICAgICAgIC8qKgogICAgICAgICAgICogQnJvd3NlciBoaXN0b3J5IHN0b3JlcyB0aGUgbG9jYXRpb24gaW4gcmVndWxhciBVUkxzLiBUaGlzIGlzIHRoZSBzdGFuZGFyZCBmb3IKICAgICAgICAgICAqIG1vc3Qgd2ViIGFwcHMsIGJ1dCBpdCByZXF1aXJlcyBzb21lIGNvbmZpZ3VyYXRpb24gb24gdGhlIHNlcnZlciB0byBlbnN1cmUgeW91CiAgICAgICAgICAgKiBzZXJ2ZSB0aGUgc2FtZSBhcHAgYXQgbXVsdGlwbGUgVVJMcy4KICAgICAgICAgICAqCiAgICAgICAgICAgKiBAc2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9yZW1peC1ydW4vaGlzdG9yeS90cmVlL21haW4vZG9jcy9hcGktcmVmZXJlbmNlLm1kI2NyZWF0ZWJyb3dzZXJoaXN0b3J5CiAgICAgICAgICAgKi8KCiAgICAgICAgICBmdW5jdGlvbiByb3V0ZXJfY3JlYXRlQnJvd3Nlckhpc3Rvcnkob3B0aW9ucykgewogICAgICAgICAgICBpZiAob3B0aW9ucyA9PT0gdm9pZCAwKSB7CiAgICAgICAgICAgICAgb3B0aW9ucyA9IHt9OwogICAgICAgICAgICB9CgogICAgICAgICAgICBmdW5jdGlvbiBjcmVhdGVCcm93c2VyTG9jYXRpb24od2luZG93LCBnbG9iYWxIaXN0b3J5KSB7CiAgICAgICAgICAgICAgdmFyIF93aW5kb3ckbG9jYXRpb24gPQoKCgogICAgICAgICAgICAgICAgd2luZG93LmxvY2F0aW9uLHBhdGhuYW1lID0gX3dpbmRvdyRsb2NhdGlvbi5wYXRobmFtZSxzZWFyY2ggPSBfd2luZG93JGxvY2F0aW9uLnNlYXJjaCxoYXNoID0gX3dpbmRvdyRsb2NhdGlvbi5oYXNoOwogICAgICAgICAgICAgIHJldHVybiBjcmVhdGVMb2NhdGlvbigiIiwgewogICAgICAgICAgICAgICAgcGF0aG5hbWU6IHBhdGhuYW1lLAogICAgICAgICAgICAgICAgc2VhcmNoOiBzZWFyY2gsCiAgICAgICAgICAgICAgICBoYXNoOiBoYXNoCiAgICAgICAgICAgICAgfSwgLy8gc3RhdGUgZGVmYXVsdHMgdG8gYG51bGxgIGJlY2F1c2UgYHdpbmRvdy5oaXN0b3J5LnN0YXRlYCBkb2VzCiAgICAgICAgICAgICAgZ2xvYmFsSGlzdG9yeS5zdGF0ZSAmJiBnbG9iYWxIaXN0b3J5LnN0YXRlLnVzciB8fCBudWxsLCBnbG9iYWxIaXN0b3J5LnN0YXRlICYmIGdsb2JhbEhpc3Rvcnkuc3RhdGUua2V5IHx8ICJkZWZhdWx0Iik7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGZ1bmN0aW9uIGNyZWF0ZUJyb3dzZXJIcmVmKHdpbmRvdywgdG8pIHsKICAgICAgICAgICAgICByZXR1cm4gdHlwZW9mIHRvID09PSAic3RyaW5nIiA/IHRvIDogcm91dGVyX2NyZWF0ZVBhdGgodG8pOwogICAgICAgICAgICB9CgogICAgICAgICAgICByZXR1cm4gZ2V0VXJsQmFzZWRIaXN0b3J5KGNyZWF0ZUJyb3dzZXJMb2NhdGlvbiwgY3JlYXRlQnJvd3NlckhyZWYsIG51bGwsIG9wdGlvbnMpOwogICAgICAgICAgfQogICAgICAgICAgLyoqCiAgICAgICAgICAgKiBIYXNoIGhpc3Rvcnkgc3RvcmVzIHRoZSBsb2NhdGlvbiBpbiB3aW5kb3cubG9jYXRpb24uaGFzaC4gVGhpcyBtYWtlcyBpdCBpZGVhbAogICAgICAgICAgICogZm9yIHNpdHVhdGlvbnMgd2hlcmUgeW91IGRvbid0IHdhbnQgdG8gc2VuZCB0aGUgbG9jYXRpb24gdG8gdGhlIHNlcnZlciBmb3IKICAgICAgICAgICAqIHNvbWUgcmVhc29uLCBlaXRoZXIgYmVjYXVzZSB5b3UgZG8gY2Fubm90IGNvbmZpZ3VyZSBpdCBvciB0aGUgVVJMIHNwYWNlIGlzCiAgICAgICAgICAgKiByZXNlcnZlZCBmb3Igc29tZXRoaW5nIGVsc2UuCiAgICAgICAgICAgKgogICAgICAgICAgICogQHNlZSBodHRwczovL2dpdGh1Yi5jb20vcmVtaXgtcnVuL2hpc3RvcnkvdHJlZS9tYWluL2RvY3MvYXBpLXJlZmVyZW5jZS5tZCNjcmVhdGVoYXNoaGlzdG9yeQogICAgICAgICAgICovCgogICAgICAgICAgZnVuY3Rpb24gcm91dGVyX2NyZWF0ZUhhc2hIaXN0b3J5KG9wdGlvbnMpIHsKICAgICAgICAgICAgaWYgKG9wdGlvbnMgPT09IHZvaWQgMCkgewogICAgICAgICAgICAgIG9wdGlvbnMgPSB7fTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgZnVuY3Rpb24gY3JlYXRlSGFzaExvY2F0aW9uKHdpbmRvdywgZ2xvYmFsSGlzdG9yeSkgewogICAgICAgICAgICAgIHZhciBfcGFyc2VQYXRoID0KCgoKICAgICAgICAgICAgICAgIHBhcnNlUGF0aCh3aW5kb3cubG9jYXRpb24uaGFzaC5zdWJzdHIoMSkpLF9wYXJzZVBhdGgkcGF0aG5hbWUgPSBfcGFyc2VQYXRoLnBhdGhuYW1lLHBhdGhuYW1lID0gX3BhcnNlUGF0aCRwYXRobmFtZSA9PT0gdm9pZCAwID8gIi8iIDogX3BhcnNlUGF0aCRwYXRobmFtZSxfcGFyc2VQYXRoJHNlYXJjaCA9IF9wYXJzZVBhdGguc2VhcmNoLHNlYXJjaCA9IF9wYXJzZVBhdGgkc2VhcmNoID09PSB2b2lkIDAgPyAiIiA6IF9wYXJzZVBhdGgkc2VhcmNoLF9wYXJzZVBhdGgkaGFzaCA9IF9wYXJzZVBhdGguaGFzaCxoYXNoID0gX3BhcnNlUGF0aCRoYXNoID09PSB2b2lkIDAgPyAiIiA6IF9wYXJzZVBhdGgkaGFzaDsKICAgICAgICAgICAgICByZXR1cm4gY3JlYXRlTG9jYXRpb24oIiIsIHsKICAgICAgICAgICAgICAgIHBhdGhuYW1lOiBwYXRobmFtZSwKICAgICAgICAgICAgICAgIHNlYXJjaDogc2VhcmNoLAogICAgICAgICAgICAgICAgaGFzaDogaGFzaAogICAgICAgICAgICAgIH0sIC8vIHN0YXRlIGRlZmF1bHRzIHRvIGBudWxsYCBiZWNhdXNlIGB3aW5kb3cuaGlzdG9yeS5zdGF0ZWAgZG9lcwogICAgICAgICAgICAgIGdsb2JhbEhpc3Rvcnkuc3RhdGUgJiYgZ2xvYmFsSGlzdG9yeS5zdGF0ZS51c3IgfHwgbnVsbCwgZ2xvYmFsSGlzdG9yeS5zdGF0ZSAmJiBnbG9iYWxIaXN0b3J5LnN0YXRlLmtleSB8fCAiZGVmYXVsdCIpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBmdW5jdGlvbiBjcmVhdGVIYXNoSHJlZih3aW5kb3csIHRvKSB7CiAgICAgICAgICAgICAgdmFyIGJhc2UgPSB3aW5kb3cuZG9jdW1lbnQucXVlcnlTZWxlY3RvcigiYmFzZSIpOwogICAgICAgICAgICAgIHZhciBocmVmID0gIiI7CgogICAgICAgICAgICAgIGlmIChiYXNlICYmIGJhc2UuZ2V0QXR0cmlidXRlKCJocmVmIikpIHsKICAgICAgICAgICAgICAgIHZhciB1cmwgPSB3aW5kb3cubG9jYXRpb24uaHJlZjsKICAgICAgICAgICAgICAgIHZhciBoYXNoSW5kZXggPSB1cmwuaW5kZXhPZigiIyIpOwogICAgICAgICAgICAgICAgaHJlZiA9IGhhc2hJbmRleCA9PT0gLTEgPyB1cmwgOiB1cmwuc2xpY2UoMCwgaGFzaEluZGV4KTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIHJldHVybiBocmVmICsgIiMiICsgKHR5cGVvZiB0byA9PT0gInN0cmluZyIgPyB0byA6IHJvdXRlcl9jcmVhdGVQYXRoKHRvKSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGZ1bmN0aW9uIHZhbGlkYXRlSGFzaExvY2F0aW9uKGxvY2F0aW9uLCB0bykgewogICAgICAgICAgICAgIHdhcm5pbmckMShsb2NhdGlvbi5wYXRobmFtZS5jaGFyQXQoMCkgPT09ICIvIiwgInJlbGF0aXZlIHBhdGhuYW1lcyBhcmUgbm90IHN1cHBvcnRlZCBpbiBoYXNoIGhpc3RvcnkucHVzaCgiICsgSlNPTi5zdHJpbmdpZnkodG8pICsgIikiKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuIGdldFVybEJhc2VkSGlzdG9yeShjcmVhdGVIYXNoTG9jYXRpb24sIGNyZWF0ZUhhc2hIcmVmLCB2YWxpZGF0ZUhhc2hMb2NhdGlvbiwgb3B0aW9ucyk7CiAgICAgICAgICB9IC8vI2VuZHJlZ2lvbgogICAgICAgICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KICAgICAgICAgIC8vI3JlZ2lvbiBVVElMUwogICAgICAgICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KCiAgICAgICAgICBmdW5jdGlvbiB3YXJuaW5nJDEoY29uZCwgbWVzc2FnZSkgewogICAgICAgICAgICBpZiAoIWNvbmQpIHsKICAgICAgICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tY29uc29sZQogICAgICAgICAgICAgIGlmICh0eXBlb2YgY29uc29sZSAhPT0gInVuZGVmaW5lZCIpIGNvbnNvbGUud2FybihtZXNzYWdlKTsKCiAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIC8vIFdlbGNvbWUgdG8gZGVidWdnaW5nIGhpc3RvcnkhCiAgICAgICAgICAgICAgICAvLwogICAgICAgICAgICAgICAgLy8gVGhpcyBlcnJvciBpcyB0aHJvd24gYXMgYSBjb252ZW5pZW5jZSBzbyB5b3UgY2FuIG1vcmUgZWFzaWx5CiAgICAgICAgICAgICAgICAvLyBmaW5kIHRoZSBzb3VyY2UgZm9yIGEgd2FybmluZyB0aGF0IGFwcGVhcnMgaW4gdGhlIGNvbnNvbGUgYnkKICAgICAgICAgICAgICAgIC8vIGVuYWJsaW5nICJwYXVzZSBvbiBleGNlcHRpb25zIiBpbiB5b3VyIEphdmFTY3JpcHQgZGVidWdnZXIuCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IobWVzc2FnZSk7IC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBuby1lbXB0eQogICAgICAgICAgICAgIH0gY2F0Y2ggKGUpIHt9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KCiAgICAgICAgICBmdW5jdGlvbiBjcmVhdGVLZXkoKSB7CiAgICAgICAgICAgIHJldHVybiBNYXRoLnJhbmRvbSgpLnRvU3RyaW5nKDM2KS5zdWJzdHIoMiwgOCk7CiAgICAgICAgICB9CiAgICAgICAgICAvKioKICAgICAgICAgICAqIEZvciBicm93c2VyLWJhc2VkIGhpc3Rvcmllcywgd2UgY29tYmluZSB0aGUgc3RhdGUgYW5kIGtleSBpbnRvIGFuIG9iamVjdAogICAgICAgICAgICovCgoKICAgICAgICAgIGZ1bmN0aW9uIGdldEhpc3RvcnlTdGF0ZShsb2NhdGlvbikgewogICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgIHVzcjogbG9jYXRpb24uc3RhdGUsCiAgICAgICAgICAgICAga2V5OiBsb2NhdGlvbi5rZXkKICAgICAgICAgICAgfTsKICAgICAgICAgIH0KICAgICAgICAgIC8qKgogICAgICAgICAgICogQ3JlYXRlcyBhIExvY2F0aW9uIG9iamVjdCB3aXRoIGEgdW5pcXVlIGtleSBmcm9tIHRoZSBnaXZlbiBQYXRoCiAgICAgICAgICAgKi8KCgogICAgICAgICAgZnVuY3Rpb24gY3JlYXRlTG9jYXRpb24oY3VycmVudCwgdG8sIHN0YXRlLCBrZXkpIHsKICAgICAgICAgICAgaWYgKHN0YXRlID09PSB2b2lkIDApIHsKICAgICAgICAgICAgICBzdGF0ZSA9IG51bGw7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHZhciBsb2NhdGlvbiA9IF9leHRlbmRzKHsKICAgICAgICAgICAgICBwYXRobmFtZTogdHlwZW9mIGN1cnJlbnQgPT09ICJzdHJpbmciID8gY3VycmVudCA6IGN1cnJlbnQucGF0aG5hbWUsCiAgICAgICAgICAgICAgc2VhcmNoOiAiIiwKICAgICAgICAgICAgICBoYXNoOiAiIgogICAgICAgICAgICB9LCB0eXBlb2YgdG8gPT09ICJzdHJpbmciID8gcGFyc2VQYXRoKHRvKSA6IHRvLCB7CiAgICAgICAgICAgICAgc3RhdGU6IHN0YXRlLAogICAgICAgICAgICAgIC8vIFRPRE86IFRoaXMgY291bGQgYmUgY2xlYW5lZCB1cC4gIHB1c2gvcmVwbGFjZSBzaG91bGQgcHJvYmFibHkganVzdCB0YWtlCiAgICAgICAgICAgICAgLy8gZnVsbCBMb2NhdGlvbnMgbm93IGFuZCBhdm9pZCB0aGUgbmVlZCB0byBydW4gdGhyb3VnaCB0aGlzIGZsb3cgYXQgYWxsCiAgICAgICAgICAgICAgLy8gQnV0IHRoYXQncyBhIHByZXR0eSBiaWcgcmVmYWN0b3IgdG8gdGhlIGN1cnJlbnQgdGVzdCBzdWl0ZSBzbyBnb2luZyB0bwogICAgICAgICAgICAgIC8vIGtlZXAgYXMgaXMgZm9yIHRoZSB0aW1lIGJlaW5nIGFuZCBqdXN0IGxldCBhbnkgaW5jb21pbmcga2V5cyB0YWtlIHByZWNlZGVuY2UKICAgICAgICAgICAgICBrZXk6IHRvICYmIHRvLmtleSB8fCBrZXkgfHwgY3JlYXRlS2V5KCkKICAgICAgICAgICAgfSk7CgogICAgICAgICAgICByZXR1cm4gbG9jYXRpb247CiAgICAgICAgICB9CiAgICAgICAgICAvKioKICAgICAgICAgICAqIENyZWF0ZXMgYSBzdHJpbmcgVVJMIHBhdGggZnJvbSB0aGUgZ2l2ZW4gcGF0aG5hbWUsIHNlYXJjaCwgYW5kIGhhc2ggY29tcG9uZW50cy4KICAgICAgICAgICAqLwoKICAgICAgICAgIGZ1bmN0aW9uIHJvdXRlcl9jcmVhdGVQYXRoKF9yZWYpIHsKICAgICAgICAgICAgdmFyIF9yZWYkcGF0aG5hbWUgPQoKCgogICAgICAgICAgICAgIF9yZWYucGF0aG5hbWUscGF0aG5hbWUgPSBfcmVmJHBhdGhuYW1lID09PSB2b2lkIDAgPyAiLyIgOiBfcmVmJHBhdGhuYW1lLF9yZWYkc2VhcmNoID0gX3JlZi5zZWFyY2gsc2VhcmNoID0gX3JlZiRzZWFyY2ggPT09IHZvaWQgMCA/ICIiIDogX3JlZiRzZWFyY2gsX3JlZiRoYXNoID0gX3JlZi5oYXNoLGhhc2ggPSBfcmVmJGhhc2ggPT09IHZvaWQgMCA/ICIiIDogX3JlZiRoYXNoOwogICAgICAgICAgICBpZiAoc2VhcmNoICYmIHNlYXJjaCAhPT0gIj8iKSBwYXRobmFtZSArPSBzZWFyY2guY2hhckF0KDApID09PSAiPyIgPyBzZWFyY2ggOiAiPyIgKyBzZWFyY2g7CiAgICAgICAgICAgIGlmIChoYXNoICYmIGhhc2ggIT09ICIjIikgcGF0aG5hbWUgKz0gaGFzaC5jaGFyQXQoMCkgPT09ICIjIiA/IGhhc2ggOiAiIyIgKyBoYXNoOwogICAgICAgICAgICByZXR1cm4gcGF0aG5hbWU7CiAgICAgICAgICB9CiAgICAgICAgICAvKioKICAgICAgICAgICAqIFBhcnNlcyBhIHN0cmluZyBVUkwgcGF0aCBpbnRvIGl0cyBzZXBhcmF0ZSBwYXRobmFtZSwgc2VhcmNoLCBhbmQgaGFzaCBjb21wb25lbnRzLgogICAgICAgICAgICovCgogICAgICAgICAgZnVuY3Rpb24gcGFyc2VQYXRoKHBhdGgpIHsKICAgICAgICAgICAgdmFyIHBhcnNlZFBhdGggPSB7fTsKCiAgICAgICAgICAgIGlmIChwYXRoKSB7CiAgICAgICAgICAgICAgdmFyIGhhc2hJbmRleCA9IHBhdGguaW5kZXhPZigiIyIpOwoKICAgICAgICAgICAgICBpZiAoaGFzaEluZGV4ID49IDApIHsKICAgICAgICAgICAgICAgIHBhcnNlZFBhdGguaGFzaCA9IHBhdGguc3Vic3RyKGhhc2hJbmRleCk7CiAgICAgICAgICAgICAgICBwYXRoID0gcGF0aC5zdWJzdHIoMCwgaGFzaEluZGV4KTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIHZhciBzZWFyY2hJbmRleCA9IHBhdGguaW5kZXhPZigiPyIpOwoKICAgICAgICAgICAgICBpZiAoc2VhcmNoSW5kZXggPj0gMCkgewogICAgICAgICAgICAgICAgcGFyc2VkUGF0aC5zZWFyY2ggPSBwYXRoLnN1YnN0cihzZWFyY2hJbmRleCk7CiAgICAgICAgICAgICAgICBwYXRoID0gcGF0aC5zdWJzdHIoMCwgc2VhcmNoSW5kZXgpOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgaWYgKHBhdGgpIHsKICAgICAgICAgICAgICAgIHBhcnNlZFBhdGgucGF0aG5hbWUgPSBwYXRoOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuIHBhcnNlZFBhdGg7CiAgICAgICAgICB9CiAgICAgICAgICBmdW5jdGlvbiBjcmVhdGVVUkwobG9jYXRpb24pIHsKICAgICAgICAgICAgLy8gd2luZG93LmxvY2F0aW9uLm9yaWdpbiBpcyAibnVsbCIgKHRoZSBsaXRlcmFsIHN0cmluZyB2YWx1ZSkgaW4gRmlyZWZveAogICAgICAgICAgICAvLyB1bmRlciBjZXJ0YWluIGNvbmRpdGlvbnMsIG5vdGFibHkgd2hlbiBzZXJ2aW5nIGZyb20gYSBsb2NhbCBIVE1MIGZpbGUKICAgICAgICAgICAgLy8gU2VlIGh0dHBzOi8vYnVnemlsbGEubW96aWxsYS5vcmcvc2hvd19idWcuY2dpP2lkPTg3ODI5NwogICAgICAgICAgICB2YXIgYmFzZSA9IHR5cGVvZiB3aW5kb3cgIT09ICJ1bmRlZmluZWQiICYmIHR5cGVvZiB3aW5kb3cubG9jYXRpb24gIT09ICJ1bmRlZmluZWQiICYmIHdpbmRvdy5sb2NhdGlvbi5vcmlnaW4gIT09ICJudWxsIiA/IHdpbmRvdy5sb2NhdGlvbi5vcmlnaW4gOiAidW5rbm93bjovL3Vua25vd24iOwogICAgICAgICAgICB2YXIgaHJlZiA9IHR5cGVvZiBsb2NhdGlvbiA9PT0gInN0cmluZyIgPyBsb2NhdGlvbiA6IHJvdXRlcl9jcmVhdGVQYXRoKGxvY2F0aW9uKTsKICAgICAgICAgICAgcmV0dXJuIG5ldyBVUkwoaHJlZiwgYmFzZSk7CiAgICAgICAgICB9CgogICAgICAgICAgZnVuY3Rpb24gZ2V0VXJsQmFzZWRIaXN0b3J5KGdldExvY2F0aW9uLCBfY3JlYXRlSHJlZiwgdmFsaWRhdGVMb2NhdGlvbiwgb3B0aW9ucykgewogICAgICAgICAgICBpZiAob3B0aW9ucyA9PT0gdm9pZCAwKSB7CiAgICAgICAgICAgICAgb3B0aW9ucyA9IHt9OwogICAgICAgICAgICB9CgogICAgICAgICAgICB2YXIgX29wdGlvbnMyID0KCgogICAgICAgICAgICAgIG9wdGlvbnMsX29wdGlvbnMyJHdpbmRvdyA9IF9vcHRpb25zMi53aW5kb3csd2luZG93ID0gX29wdGlvbnMyJHdpbmRvdyA9PT0gdm9pZCAwID8gZG9jdW1lbnQuZGVmYXVsdFZpZXcgOiBfb3B0aW9uczIkd2luZG93LF9vcHRpb25zMiR2NUNvbXBhdCA9IF9vcHRpb25zMi52NUNvbXBhdCx2NUNvbXBhdCA9IF9vcHRpb25zMiR2NUNvbXBhdCA9PT0gdm9pZCAwID8gZmFsc2UgOiBfb3B0aW9uczIkdjVDb21wYXQ7CiAgICAgICAgICAgIHZhciBnbG9iYWxIaXN0b3J5ID0gd2luZG93Lmhpc3Rvcnk7CiAgICAgICAgICAgIHZhciBhY3Rpb24gPSBBY3Rpb24uUG9wOwogICAgICAgICAgICB2YXIgbGlzdGVuZXIgPSBudWxsOwoKICAgICAgICAgICAgZnVuY3Rpb24gaGFuZGxlUG9wKCkgewogICAgICAgICAgICAgIGFjdGlvbiA9IEFjdGlvbi5Qb3A7CgogICAgICAgICAgICAgIGlmIChsaXN0ZW5lcikgewogICAgICAgICAgICAgICAgbGlzdGVuZXIoewogICAgICAgICAgICAgICAgICBhY3Rpb246IGFjdGlvbiwKICAgICAgICAgICAgICAgICAgbG9jYXRpb246IGhpc3RvcnkubG9jYXRpb24KICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgZnVuY3Rpb24gcHVzaCh0bywgc3RhdGUpIHsKICAgICAgICAgICAgICBhY3Rpb24gPSBBY3Rpb24uUHVzaDsKICAgICAgICAgICAgICB2YXIgbG9jYXRpb24gPSBjcmVhdGVMb2NhdGlvbihoaXN0b3J5LmxvY2F0aW9uLCB0bywgc3RhdGUpOwogICAgICAgICAgICAgIGlmICh2YWxpZGF0ZUxvY2F0aW9uKSB2YWxpZGF0ZUxvY2F0aW9uKGxvY2F0aW9uLCB0byk7CiAgICAgICAgICAgICAgdmFyIGhpc3RvcnlTdGF0ZSA9IGdldEhpc3RvcnlTdGF0ZShsb2NhdGlvbik7CiAgICAgICAgICAgICAgdmFyIHVybCA9IGhpc3RvcnkuY3JlYXRlSHJlZihsb2NhdGlvbik7IC8vIHRyeS4uLmNhdGNoIGJlY2F1c2UgaU9TIGxpbWl0cyB1cyB0byAxMDAgcHVzaFN0YXRlIGNhbGxzIDovCgogICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICBnbG9iYWxIaXN0b3J5LnB1c2hTdGF0ZShoaXN0b3J5U3RhdGUsICIiLCB1cmwpOwogICAgICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgICAgICAgICAvLyBUaGV5IGFyZSBnb2luZyB0byBsb3NlIHN0YXRlIGhlcmUsIGJ1dCB0aGVyZSBpcyBubyByZWFsCiAgICAgICAgICAgICAgICAvLyB3YXkgdG8gd2FybiB0aGVtIGFib3V0IGl0IHNpbmNlIHRoZSBwYWdlIHdpbGwgcmVmcmVzaC4uLgogICAgICAgICAgICAgICAgd2luZG93LmxvY2F0aW9uLmFzc2lnbih1cmwpOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgaWYgKHY1Q29tcGF0ICYmIGxpc3RlbmVyKSB7CiAgICAgICAgICAgICAgICBsaXN0ZW5lcih7CiAgICAgICAgICAgICAgICAgIGFjdGlvbjogYWN0aW9uLAogICAgICAgICAgICAgICAgICBsb2NhdGlvbjogaGlzdG9yeS5sb2NhdGlvbgogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICBmdW5jdGlvbiByZXBsYWNlKHRvLCBzdGF0ZSkgewogICAgICAgICAgICAgIGFjdGlvbiA9IEFjdGlvbi5SZXBsYWNlOwogICAgICAgICAgICAgIHZhciBsb2NhdGlvbiA9IGNyZWF0ZUxvY2F0aW9uKGhpc3RvcnkubG9jYXRpb24sIHRvLCBzdGF0ZSk7CiAgICAgICAgICAgICAgaWYgKHZhbGlkYXRlTG9jYXRpb24pIHZhbGlkYXRlTG9jYXRpb24obG9jYXRpb24sIHRvKTsKICAgICAgICAgICAgICB2YXIgaGlzdG9yeVN0YXRlID0gZ2V0SGlzdG9yeVN0YXRlKGxvY2F0aW9uKTsKICAgICAgICAgICAgICB2YXIgdXJsID0gaGlzdG9yeS5jcmVhdGVIcmVmKGxvY2F0aW9uKTsKICAgICAgICAgICAgICBnbG9iYWxIaXN0b3J5LnJlcGxhY2VTdGF0ZShoaXN0b3J5U3RhdGUsICIiLCB1cmwpOwoKICAgICAgICAgICAgICBpZiAodjVDb21wYXQgJiYgbGlzdGVuZXIpIHsKICAgICAgICAgICAgICAgIGxpc3RlbmVyKHsKICAgICAgICAgICAgICAgICAgYWN0aW9uOiBhY3Rpb24sCiAgICAgICAgICAgICAgICAgIGxvY2F0aW9uOiBoaXN0b3J5LmxvY2F0aW9uCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHZhciBoaXN0b3J5ID0gewogICAgICAgICAgICAgIGdldCBhY3Rpb24oKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gYWN0aW9uOwogICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgIGdldCBsb2NhdGlvbigpIHsKICAgICAgICAgICAgICAgIHJldHVybiBnZXRMb2NhdGlvbih3aW5kb3csIGdsb2JhbEhpc3RvcnkpOwogICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgIGxpc3RlbjogZnVuY3Rpb24gbGlzdGVuKGZuKSB7CiAgICAgICAgICAgICAgICBpZiAobGlzdGVuZXIpIHsKICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJBIGhpc3Rvcnkgb25seSBhY2NlcHRzIG9uZSBhY3RpdmUgbGlzdGVuZXIiKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcihQb3BTdGF0ZUV2ZW50VHlwZSwgaGFuZGxlUG9wKTsKICAgICAgICAgICAgICAgIGxpc3RlbmVyID0gZm47CiAgICAgICAgICAgICAgICByZXR1cm4gKCkgPT4gewogICAgICAgICAgICAgICAgICB3aW5kb3cucmVtb3ZlRXZlbnRMaXN0ZW5lcihQb3BTdGF0ZUV2ZW50VHlwZSwgaGFuZGxlUG9wKTsKICAgICAgICAgICAgICAgICAgbGlzdGVuZXIgPSBudWxsOwogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICBjcmVhdGVIcmVmOiBmdW5jdGlvbiBjcmVhdGVIcmVmKHRvKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gX2NyZWF0ZUhyZWYod2luZG93LCB0byk7CiAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgZW5jb2RlTG9jYXRpb246IGZ1bmN0aW9uIGVuY29kZUxvY2F0aW9uKHRvKSB7CiAgICAgICAgICAgICAgICAvLyBFbmNvZGUgYSBMb2NhdGlvbiB0aGUgc2FtZSB3YXkgd2luZG93LmxvY2F0aW9uIHdvdWxkCiAgICAgICAgICAgICAgICB2YXIgdXJsID0gY3JlYXRlVVJMKHR5cGVvZiB0byA9PT0gInN0cmluZyIgPyB0byA6IHJvdXRlcl9jcmVhdGVQYXRoKHRvKSk7CiAgICAgICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgICBwYXRobmFtZTogdXJsLnBhdGhuYW1lLAogICAgICAgICAgICAgICAgICBzZWFyY2g6IHVybC5zZWFyY2gsCiAgICAgICAgICAgICAgICAgIGhhc2g6IHVybC5oYXNoCiAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgIHB1c2g6IHB1c2gsCiAgICAgICAgICAgICAgcmVwbGFjZTogcmVwbGFjZSwKCiAgICAgICAgICAgICAgZ286IGZ1bmN0aW9uIGdvKG4pIHsKICAgICAgICAgICAgICAgIHJldHVybiBnbG9iYWxIaXN0b3J5LmdvKG4pOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgIH07CiAgICAgICAgICAgIHJldHVybiBoaXN0b3J5OwogICAgICAgICAgfSAvLyNlbmRyZWdpb24KCiAgICAgICAgICB2YXIgUmVzdWx0VHlwZTsKCiAgICAgICAgICAoZnVuY3Rpb24gKFJlc3VsdFR5cGUpIHsKICAgICAgICAgICAgUmVzdWx0VHlwZVsiZGF0YSJdID0gImRhdGEiOwogICAgICAgICAgICBSZXN1bHRUeXBlWyJkZWZlcnJlZCJdID0gImRlZmVycmVkIjsKICAgICAgICAgICAgUmVzdWx0VHlwZVsicmVkaXJlY3QiXSA9ICJyZWRpcmVjdCI7CiAgICAgICAgICAgIFJlc3VsdFR5cGVbImVycm9yIl0gPSAiZXJyb3IiOwogICAgICAgICAgfSkoUmVzdWx0VHlwZSB8fCAoUmVzdWx0VHlwZSA9IHt9KSk7CgogICAgICAgICAgZnVuY3Rpb24gaXNJbmRleFJvdXRlKHJvdXRlKSB7CiAgICAgICAgICAgIHJldHVybiByb3V0ZS5pbmRleCA9PT0gdHJ1ZTsKICAgICAgICAgIH0gLy8gV2FsayB0aGUgcm91dGUgdHJlZSBnZW5lcmF0aW5nIHVuaXF1ZSBJRHMgd2hlcmUgbmVjZXNzYXJ5IHNvIHdlIGFyZSB3b3JraW5nCiAgICAgICAgICAvLyBzb2xlbHkgd2l0aCBBZ25vc3RpY0RhdGFSb3V0ZU9iamVjdCdzIHdpdGhpbiB0aGUgUm91dGVyCgoKICAgICAgICAgIGZ1bmN0aW9uIGNvbnZlcnRSb3V0ZXNUb0RhdGFSb3V0ZXMocm91dGVzLCBwYXJlbnRQYXRoLCBhbGxJZHMpIHsKICAgICAgICAgICAgaWYgKHBhcmVudFBhdGggPT09IHZvaWQgMCkgewogICAgICAgICAgICAgIHBhcmVudFBhdGggPSBbXTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKGFsbElkcyA9PT0gdm9pZCAwKSB7CiAgICAgICAgICAgICAgYWxsSWRzID0gbmV3IFNldCgpOwogICAgICAgICAgICB9CgogICAgICAgICAgICByZXR1cm4gcm91dGVzLm1hcCgocm91dGUsIGluZGV4KSA9PiB7CiAgICAgICAgICAgICAgdmFyIHRyZWVQYXRoID0gW10uY29uY2F0KF90b0NvbnN1bWFibGVBcnJheTIocGFyZW50UGF0aCksIFtpbmRleF0pOwogICAgICAgICAgICAgIHZhciBpZCA9IHR5cGVvZiByb3V0ZS5pZCA9PT0gInN0cmluZyIgPyByb3V0ZS5pZCA6IHRyZWVQYXRoLmpvaW4oIi0iKTsKICAgICAgICAgICAgICByb3V0ZXJfaW52YXJpYW50KHJvdXRlLmluZGV4ICE9PSB0cnVlIHx8ICFyb3V0ZS5jaGlsZHJlbiwgIkNhbm5vdCBzcGVjaWZ5IGNoaWxkcmVuIG9uIGFuIGluZGV4IHJvdXRlIik7CiAgICAgICAgICAgICAgcm91dGVyX2ludmFyaWFudCghYWxsSWRzLmhhcyhpZCksICJGb3VuZCBhIHJvdXRlIGlkIGNvbGxpc2lvbiBvbiBpZCBcIiIgKyBpZCArICJcIi4gIFJvdXRlICIgKyAiaWQncyBtdXN0IGJlIGdsb2JhbGx5IHVuaXF1ZSB3aXRoaW4gRGF0YSBSb3V0ZXIgdXNhZ2VzIik7CiAgICAgICAgICAgICAgYWxsSWRzLmFkZChpZCk7CgogICAgICAgICAgICAgIGlmIChpc0luZGV4Um91dGUocm91dGUpKSB7CiAgICAgICAgICAgICAgICB2YXIgaW5kZXhSb3V0ZSA9IF9leHRlbmRzKHt9LCByb3V0ZSwgewogICAgICAgICAgICAgICAgICBpZDogaWQKICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICAgIHJldHVybiBpbmRleFJvdXRlOwogICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICB2YXIgcGF0aE9yTGF5b3V0Um91dGUgPSBfZXh0ZW5kcyh7fSwgcm91dGUsIHsKICAgICAgICAgICAgICAgICAgaWQ6IGlkLAogICAgICAgICAgICAgICAgICBjaGlsZHJlbjogcm91dGUuY2hpbGRyZW4gPyBjb252ZXJ0Um91dGVzVG9EYXRhUm91dGVzKHJvdXRlLmNoaWxkcmVuLCB0cmVlUGF0aCwgYWxsSWRzKSA6IHVuZGVmaW5lZAogICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgICAgcmV0dXJuIHBhdGhPckxheW91dFJvdXRlOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgICB9CiAgICAgICAgICAvKioKICAgICAgICAgICAqIE1hdGNoZXMgdGhlIGdpdmVuIHJvdXRlcyB0byBhIGxvY2F0aW9uIGFuZCByZXR1cm5zIHRoZSBtYXRjaCBkYXRhLgogICAgICAgICAgICoKICAgICAgICAgICAqIEBzZWUgaHR0cHM6Ly9yZWFjdHJvdXRlci5jb20vZG9jcy9lbi92Ni91dGlscy9tYXRjaC1yb3V0ZXMKICAgICAgICAgICAqLwoKICAgICAgICAgIGZ1bmN0aW9uIG1hdGNoUm91dGVzKHJvdXRlcywgbG9jYXRpb25BcmcsIGJhc2VuYW1lKSB7CiAgICAgICAgICAgIGlmIChiYXNlbmFtZSA9PT0gdm9pZCAwKSB7CiAgICAgICAgICAgICAgYmFzZW5hbWUgPSAiLyI7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHZhciBsb2NhdGlvbiA9IHR5cGVvZiBsb2NhdGlvbkFyZyA9PT0gInN0cmluZyIgPyBwYXJzZVBhdGgobG9jYXRpb25BcmcpIDogbG9jYXRpb25Bcmc7CiAgICAgICAgICAgIHZhciBwYXRobmFtZSA9IHN0cmlwQmFzZW5hbWUobG9jYXRpb24ucGF0aG5hbWUgfHwgIi8iLCBiYXNlbmFtZSk7CgogICAgICAgICAgICBpZiAocGF0aG5hbWUgPT0gbnVsbCkgewogICAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgICAgICB9CgogICAgICAgICAgICB2YXIgYnJhbmNoZXMgPSBmbGF0dGVuUm91dGVzKHJvdXRlcyk7CiAgICAgICAgICAgIHJhbmtSb3V0ZUJyYW5jaGVzKGJyYW5jaGVzKTsKICAgICAgICAgICAgdmFyIG1hdGNoZXMgPSBudWxsOwoKICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IG1hdGNoZXMgPT0gbnVsbCAmJiBpIDwgYnJhbmNoZXMubGVuZ3RoOyArK2kpIHsKICAgICAgICAgICAgICBtYXRjaGVzID0gbWF0Y2hSb3V0ZUJyYW5jaChicmFuY2hlc1tpXSwgLy8gSW5jb21pbmcgcGF0aG5hbWVzIGFyZSBnZW5lcmFsbHkgZW5jb2RlZCBmcm9tIGVpdGhlciB3aW5kb3cubG9jYXRpb24KICAgICAgICAgICAgICAvLyBvciBmcm9tIHJvdXRlci5uYXZpZ2F0ZSwgYnV0IHdlIHdhbnQgdG8gbWF0Y2ggYWdhaW5zdCB0aGUgdW5lbmNvZGVkCiAgICAgICAgICAgICAgLy8gcGF0aHMgaW4gdGhlIHJvdXRlIGRlZmluaXRpb25zLiAgTWVtb3J5IHJvdXRlciBsb2NhdGlvbnMgd29uJ3QgYmUKICAgICAgICAgICAgICAvLyBlbmNvZGVkIGhlcmUgYnV0IHRoZXJlIGFsc28gc2hvdWxkbid0IGJlIGFueXRoaW5nIHRvIGRlY29kZSBzbyB0aGlzCiAgICAgICAgICAgICAgLy8gc2hvdWxkIGJlIGEgc2FmZSBvcGVyYXRpb24uICBUaGlzIGF2b2lkcyBuZWVkaW5nIG1hdGNoUm91dGVzIHRvIGJlCiAgICAgICAgICAgICAgLy8gaGlzdG9yeS1hd2FyZS4KICAgICAgICAgICAgICBzYWZlbHlEZWNvZGVVUkkocGF0aG5hbWUpKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuIG1hdGNoZXM7CiAgICAgICAgICB9CgogICAgICAgICAgZnVuY3Rpb24gZmxhdHRlblJvdXRlcyhyb3V0ZXMsIGJyYW5jaGVzLCBwYXJlbnRzTWV0YSwgcGFyZW50UGF0aCkgewogICAgICAgICAgICBpZiAoYnJhbmNoZXMgPT09IHZvaWQgMCkgewogICAgICAgICAgICAgIGJyYW5jaGVzID0gW107CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChwYXJlbnRzTWV0YSA9PT0gdm9pZCAwKSB7CiAgICAgICAgICAgICAgcGFyZW50c01ldGEgPSBbXTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKHBhcmVudFBhdGggPT09IHZvaWQgMCkgewogICAgICAgICAgICAgIHBhcmVudFBhdGggPSAiIjsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcm91dGVzLmZvckVhY2goKHJvdXRlLCBpbmRleCkgPT4gewogICAgICAgICAgICAgIHZhciBtZXRhID0gewogICAgICAgICAgICAgICAgcmVsYXRpdmVQYXRoOiByb3V0ZS5wYXRoIHx8ICIiLAogICAgICAgICAgICAgICAgY2FzZVNlbnNpdGl2ZTogcm91dGUuY2FzZVNlbnNpdGl2ZSA9PT0gdHJ1ZSwKICAgICAgICAgICAgICAgIGNoaWxkcmVuSW5kZXg6IGluZGV4LAogICAgICAgICAgICAgICAgcm91dGU6IHJvdXRlCiAgICAgICAgICAgICAgfTsKCiAgICAgICAgICAgICAgaWYgKG1ldGEucmVsYXRpdmVQYXRoLnN0YXJ0c1dpdGgoIi8iKSkgewogICAgICAgICAgICAgICAgcm91dGVyX2ludmFyaWFudChtZXRhLnJlbGF0aXZlUGF0aC5zdGFydHNXaXRoKHBhcmVudFBhdGgpLCAiQWJzb2x1dGUgcm91dGUgcGF0aCBcIiIgKyBtZXRhLnJlbGF0aXZlUGF0aCArICJcIiBuZXN0ZWQgdW5kZXIgcGF0aCAiICsgKCJcIiIgKyBwYXJlbnRQYXRoICsgIlwiIGlzIG5vdCB2YWxpZC4gQW4gYWJzb2x1dGUgY2hpbGQgcm91dGUgcGF0aCAiKSArICJtdXN0IHN0YXJ0IHdpdGggdGhlIGNvbWJpbmVkIHBhdGggb2YgYWxsIGl0cyBwYXJlbnQgcm91dGVzLiIpOwogICAgICAgICAgICAgICAgbWV0YS5yZWxhdGl2ZVBhdGggPSBtZXRhLnJlbGF0aXZlUGF0aC5zbGljZShwYXJlbnRQYXRoLmxlbmd0aCk7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICB2YXIgcGF0aCA9IHJvdXRlcl9qb2luUGF0aHMoW3BhcmVudFBhdGgsIG1ldGEucmVsYXRpdmVQYXRoXSk7CiAgICAgICAgICAgICAgdmFyIHJvdXRlc01ldGEgPSBwYXJlbnRzTWV0YS5jb25jYXQobWV0YSk7IC8vIEFkZCB0aGUgY2hpbGRyZW4gYmVmb3JlIGFkZGluZyB0aGlzIHJvdXRlIHRvIHRoZSBhcnJheSBzbyB3ZSB0cmF2ZXJzZSB0aGUKICAgICAgICAgICAgICAvLyByb3V0ZSB0cmVlIGRlcHRoLWZpcnN0IGFuZCBjaGlsZCByb3V0ZXMgYXBwZWFyIGJlZm9yZSB0aGVpciBwYXJlbnRzIGluCiAgICAgICAgICAgICAgLy8gdGhlICJmbGF0dGVuZWQiIHZlcnNpb24uCgogICAgICAgICAgICAgIGlmIChyb3V0ZS5jaGlsZHJlbiAmJiByb3V0ZS5jaGlsZHJlbi5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgICAgICByb3V0ZXJfaW52YXJpYW50KCAvLyBPdXIgdHlwZXMga25vdyBiZXR0ZXIsIGJ1dCBydW50aW1lIEpTIG1heSBub3QhCiAgICAgICAgICAgICAgICAvLyBAdHMtZXhwZWN0LWVycm9yCiAgICAgICAgICAgICAgICByb3V0ZS5pbmRleCAhPT0gdHJ1ZSwgIkluZGV4IHJvdXRlcyBtdXN0IG5vdCBoYXZlIGNoaWxkIHJvdXRlcy4gUGxlYXNlIHJlbW92ZSAiICsgKCJhbGwgY2hpbGQgcm91dGVzIGZyb20gcm91dGUgcGF0aCBcIiIgKyBwYXRoICsgIlwiLiIpKTsKICAgICAgICAgICAgICAgIGZsYXR0ZW5Sb3V0ZXMocm91dGUuY2hpbGRyZW4sIGJyYW5jaGVzLCByb3V0ZXNNZXRhLCBwYXRoKTsKICAgICAgICAgICAgICB9IC8vIFJvdXRlcyB3aXRob3V0IGEgcGF0aCBzaG91bGRuJ3QgZXZlciBtYXRjaCBieSB0aGVtc2VsdmVzIHVubGVzcyB0aGV5IGFyZQogICAgICAgICAgICAgIC8vIGluZGV4IHJvdXRlcywgc28gZG9uJ3QgYWRkIHRoZW0gdG8gdGhlIGxpc3Qgb2YgcG9zc2libGUgYnJhbmNoZXMuCgoKICAgICAgICAgICAgICBpZiAocm91dGUucGF0aCA9PSBudWxsICYmICFyb3V0ZS5pbmRleCkgewogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgYnJhbmNoZXMucHVzaCh7CiAgICAgICAgICAgICAgICBwYXRoOiBwYXRoLAogICAgICAgICAgICAgICAgc2NvcmU6IGNvbXB1dGVTY29yZShwYXRoLCByb3V0ZS5pbmRleCksCiAgICAgICAgICAgICAgICByb3V0ZXNNZXRhOiByb3V0ZXNNZXRhCiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICByZXR1cm4gYnJhbmNoZXM7CiAgICAgICAgICB9CgogICAgICAgICAgZnVuY3Rpb24gcmFua1JvdXRlQnJhbmNoZXMoYnJhbmNoZXMpIHsKICAgICAgICAgICAgYnJhbmNoZXMuc29ydCgoYSwgYikgPT4gYS5zY29yZSAhPT0gYi5zY29yZSA/IGIuc2NvcmUgLSBhLnNjb3JlIC8vIEhpZ2hlciBzY29yZSBmaXJzdAogICAgICAgICAgICA6IGNvbXBhcmVJbmRleGVzKGEucm91dGVzTWV0YS5tYXAoKG1ldGEpID0+IG1ldGEuY2hpbGRyZW5JbmRleCksIGIucm91dGVzTWV0YS5tYXAoKG1ldGEpID0+IG1ldGEuY2hpbGRyZW5JbmRleCkpKTsKICAgICAgICAgIH0KCiAgICAgICAgICB2YXIgcGFyYW1SZSA9IC9eOlx3KyQvOwogICAgICAgICAgdmFyIGR5bmFtaWNTZWdtZW50VmFsdWUgPSAzOwogICAgICAgICAgdmFyIGluZGV4Um91dGVWYWx1ZSA9IDI7CiAgICAgICAgICB2YXIgZW1wdHlTZWdtZW50VmFsdWUgPSAxOwogICAgICAgICAgdmFyIHN0YXRpY1NlZ21lbnRWYWx1ZSA9IDEwOwogICAgICAgICAgdmFyIHNwbGF0UGVuYWx0eSA9IC0yOwoKICAgICAgICAgIHZhciBpc1NwbGF0ID0gKHMpID0+IHMgPT09ICIqIjsKCiAgICAgICAgICBmdW5jdGlvbiBjb21wdXRlU2NvcmUocGF0aCwgaW5kZXgpIHsKICAgICAgICAgICAgdmFyIHNlZ21lbnRzID0gcGF0aC5zcGxpdCgiLyIpOwogICAgICAgICAgICB2YXIgaW5pdGlhbFNjb3JlID0gc2VnbWVudHMubGVuZ3RoOwoKICAgICAgICAgICAgaWYgKHNlZ21lbnRzLnNvbWUoaXNTcGxhdCkpIHsKICAgICAgICAgICAgICBpbml0aWFsU2NvcmUgKz0gc3BsYXRQZW5hbHR5OwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoaW5kZXgpIHsKICAgICAgICAgICAgICBpbml0aWFsU2NvcmUgKz0gaW5kZXhSb3V0ZVZhbHVlOwogICAgICAgICAgICB9CgogICAgICAgICAgICByZXR1cm4gc2VnbWVudHMuZmlsdGVyKChzKSA9PiAhaXNTcGxhdChzKSkucmVkdWNlKChzY29yZSwgc2VnbWVudCkgPT4gc2NvcmUgKyAocGFyYW1SZS50ZXN0KHNlZ21lbnQpID8gZHluYW1pY1NlZ21lbnRWYWx1ZSA6IHNlZ21lbnQgPT09ICIiID8gZW1wdHlTZWdtZW50VmFsdWUgOiBzdGF0aWNTZWdtZW50VmFsdWUpLCBpbml0aWFsU2NvcmUpOwogICAgICAgICAgfQoKICAgICAgICAgIGZ1bmN0aW9uIGNvbXBhcmVJbmRleGVzKGEsIGIpIHsKICAgICAgICAgICAgdmFyIHNpYmxpbmdzID0gYS5sZW5ndGggPT09IGIubGVuZ3RoICYmIGEuc2xpY2UoMCwgLTEpLmV2ZXJ5KChuLCBpKSA9PiBuID09PSBiW2ldKTsKICAgICAgICAgICAgcmV0dXJuIHNpYmxpbmdzID8gLy8gSWYgdHdvIHJvdXRlcyBhcmUgc2libGluZ3MsIHdlIHNob3VsZCB0cnkgdG8gbWF0Y2ggdGhlIGVhcmxpZXIgc2libGluZwogICAgICAgICAgICAvLyBmaXJzdC4gVGhpcyBhbGxvd3MgcGVvcGxlIHRvIGhhdmUgZmluZS1ncmFpbmVkIGNvbnRyb2wgb3ZlciB0aGUgbWF0Y2hpbmcKICAgICAgICAgICAgLy8gYmVoYXZpb3IgYnkgc2ltcGx5IHB1dHRpbmcgcm91dGVzIHdpdGggaWRlbnRpY2FsIHBhdGhzIGluIHRoZSBvcmRlciB0aGV5CiAgICAgICAgICAgIC8vIHdhbnQgdGhlbSB0cmllZC4KICAgICAgICAgICAgYVthLmxlbmd0aCAtIDFdIC0gYltiLmxlbmd0aCAtIDFdIDogLy8gT3RoZXJ3aXNlLCBpdCBkb2Vzbid0IHJlYWxseSBtYWtlIHNlbnNlIHRvIHJhbmsgbm9uLXNpYmxpbmdzIGJ5IGluZGV4LAogICAgICAgICAgICAvLyBzbyB0aGV5IHNvcnQgZXF1YWxseS4KICAgICAgICAgICAgMDsKICAgICAgICAgIH0KCiAgICAgICAgICBmdW5jdGlvbiBtYXRjaFJvdXRlQnJhbmNoKGJyYW5jaCwgcGF0aG5hbWUpIHsKICAgICAgICAgICAgdmFyCiAgICAgICAgICAgIHJvdXRlc01ldGEgPQogICAgICAgICAgICBicmFuY2gucm91dGVzTWV0YTsKICAgICAgICAgICAgdmFyIG1hdGNoZWRQYXJhbXMgPSB7fTsKICAgICAgICAgICAgdmFyIG1hdGNoZWRQYXRobmFtZSA9ICIvIjsKICAgICAgICAgICAgdmFyIG1hdGNoZXMgPSBbXTsKCiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgcm91dGVzTWV0YS5sZW5ndGg7ICsraSkgewogICAgICAgICAgICAgIHZhciBtZXRhID0gcm91dGVzTWV0YVtpXTsKICAgICAgICAgICAgICB2YXIgZW5kID0gaSA9PT0gcm91dGVzTWV0YS5sZW5ndGggLSAxOwogICAgICAgICAgICAgIHZhciByZW1haW5pbmdQYXRobmFtZSA9IG1hdGNoZWRQYXRobmFtZSA9PT0gIi8iID8gcGF0aG5hbWUgOiBwYXRobmFtZS5zbGljZShtYXRjaGVkUGF0aG5hbWUubGVuZ3RoKSB8fCAiLyI7CiAgICAgICAgICAgICAgdmFyIG1hdGNoID0gcm91dGVyX21hdGNoUGF0aCh7CiAgICAgICAgICAgICAgICBwYXRoOiBtZXRhLnJlbGF0aXZlUGF0aCwKICAgICAgICAgICAgICAgIGNhc2VTZW5zaXRpdmU6IG1ldGEuY2FzZVNlbnNpdGl2ZSwKICAgICAgICAgICAgICAgIGVuZDogZW5kCiAgICAgICAgICAgICAgfSwgcmVtYWluaW5nUGF0aG5hbWUpOwogICAgICAgICAgICAgIGlmICghbWF0Y2gpIHJldHVybiBudWxsOwogICAgICAgICAgICAgIE9iamVjdC5hc3NpZ24obWF0Y2hlZFBhcmFtcywgbWF0Y2gucGFyYW1zKTsKICAgICAgICAgICAgICB2YXIgcm91dGUgPSBtZXRhLnJvdXRlOwogICAgICAgICAgICAgIG1hdGNoZXMucHVzaCh7CiAgICAgICAgICAgICAgICAvLyBUT0RPOiBDYW4gdGhpcyBhcyBiZSBhdm9pZGVkPwogICAgICAgICAgICAgICAgcGFyYW1zOiBtYXRjaGVkUGFyYW1zLAogICAgICAgICAgICAgICAgcGF0aG5hbWU6IHJvdXRlcl9qb2luUGF0aHMoW21hdGNoZWRQYXRobmFtZSwgbWF0Y2gucGF0aG5hbWVdKSwKICAgICAgICAgICAgICAgIHBhdGhuYW1lQmFzZTogbm9ybWFsaXplUGF0aG5hbWUocm91dGVyX2pvaW5QYXRocyhbbWF0Y2hlZFBhdGhuYW1lLCBtYXRjaC5wYXRobmFtZUJhc2VdKSksCiAgICAgICAgICAgICAgICByb3V0ZTogcm91dGUKICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgaWYgKG1hdGNoLnBhdGhuYW1lQmFzZSAhPT0gIi8iKSB7CiAgICAgICAgICAgICAgICBtYXRjaGVkUGF0aG5hbWUgPSByb3V0ZXJfam9pblBhdGhzKFttYXRjaGVkUGF0aG5hbWUsIG1hdGNoLnBhdGhuYW1lQmFzZV0pOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuIG1hdGNoZXM7CiAgICAgICAgICB9CiAgICAgICAgICAvKioKICAgICAgICAgICAqIFJldHVybnMgYSBwYXRoIHdpdGggcGFyYW1zIGludGVycG9sYXRlZC4KICAgICAgICAgICAqCiAgICAgICAgICAgKiBAc2VlIGh0dHBzOi8vcmVhY3Ryb3V0ZXIuY29tL2RvY3MvZW4vdjYvdXRpbHMvZ2VuZXJhdGUtcGF0aAogICAgICAgICAgICovCgoKICAgICAgICAgIGZ1bmN0aW9uIGdlbmVyYXRlUGF0aChwYXRoLCBwYXJhbXMpIHsKICAgICAgICAgICAgaWYgKHBhcmFtcyA9PT0gdm9pZCAwKSB7CiAgICAgICAgICAgICAgcGFyYW1zID0ge307CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybiBwYXRoLnJlcGxhY2UoLzooXHcrKS9nLCAoXywga2V5KSA9PiB7CiAgICAgICAgICAgICAgcm91dGVyX2ludmFyaWFudChwYXJhbXNba2V5XSAhPSBudWxsLCAiTWlzc2luZyBcIjoiICsga2V5ICsgIlwiIHBhcmFtIik7CiAgICAgICAgICAgICAgcmV0dXJuIHBhcmFtc1trZXldOwogICAgICAgICAgICB9KS5yZXBsYWNlKC8oXC8/KVwqLywgKF8sIHByZWZpeCwgX18sIHN0cikgPT4gewogICAgICAgICAgICAgIHZhciBzdGFyID0gIioiOwoKICAgICAgICAgICAgICBpZiAocGFyYW1zW3N0YXJdID09IG51bGwpIHsKICAgICAgICAgICAgICAgIC8vIElmIG5vIHNwbGF0IHdhcyBwcm92aWRlZCwgdHJpbSB0aGUgdHJhaWxpbmcgc2xhc2ggX3VubGVzc18gaXQncwogICAgICAgICAgICAgICAgLy8gdGhlIGVudGlyZSBwYXRoCiAgICAgICAgICAgICAgICByZXR1cm4gc3RyID09PSAiLyoiID8gIi8iIDogIiI7CiAgICAgICAgICAgICAgfSAvLyBBcHBseSB0aGUgc3BsYXQKCgogICAgICAgICAgICAgIHJldHVybiAiIiArIHByZWZpeCArIHBhcmFtc1tzdGFyXTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9CiAgICAgICAgICAvKioKICAgICAgICAgICAqIFBlcmZvcm1zIHBhdHRlcm4gbWF0Y2hpbmcgb24gYSBVUkwgcGF0aG5hbWUgYW5kIHJldHVybnMgaW5mb3JtYXRpb24gYWJvdXQKICAgICAgICAgICAqIHRoZSBtYXRjaC4KICAgICAgICAgICAqCiAgICAgICAgICAgKiBAc2VlIGh0dHBzOi8vcmVhY3Ryb3V0ZXIuY29tL2RvY3MvZW4vdjYvdXRpbHMvbWF0Y2gtcGF0aAogICAgICAgICAgICovCgogICAgICAgICAgZnVuY3Rpb24gcm91dGVyX21hdGNoUGF0aChwYXR0ZXJuLCBwYXRobmFtZSkgewogICAgICAgICAgICBpZiAodHlwZW9mIHBhdHRlcm4gPT09ICJzdHJpbmciKSB7CiAgICAgICAgICAgICAgcGF0dGVybiA9IHsKICAgICAgICAgICAgICAgIHBhdGg6IHBhdHRlcm4sCiAgICAgICAgICAgICAgICBjYXNlU2Vuc2l0aXZlOiBmYWxzZSwKICAgICAgICAgICAgICAgIGVuZDogdHJ1ZQogICAgICAgICAgICAgIH07CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHZhciBfY29tcGlsZVBhdGggPSBjb21waWxlUGF0aChwYXR0ZXJuLnBhdGgsIHBhdHRlcm4uY2FzZVNlbnNpdGl2ZSwgcGF0dGVybi5lbmQpLF9jb21waWxlUGF0aDIgPSBfc2xpY2VkVG9BcnJheTIoX2NvbXBpbGVQYXRoLCAyKSxtYXRjaGVyID0gX2NvbXBpbGVQYXRoMlswXSxwYXJhbU5hbWVzID0gX2NvbXBpbGVQYXRoMlsxXTsKICAgICAgICAgICAgdmFyIG1hdGNoID0gcGF0aG5hbWUubWF0Y2gobWF0Y2hlcik7CiAgICAgICAgICAgIGlmICghbWF0Y2gpIHJldHVybiBudWxsOwogICAgICAgICAgICB2YXIgbWF0Y2hlZFBhdGhuYW1lID0gbWF0Y2hbMF07CiAgICAgICAgICAgIHZhciBwYXRobmFtZUJhc2UgPSBtYXRjaGVkUGF0aG5hbWUucmVwbGFjZSgvKC4pXC8rJC8sICIkMSIpOwogICAgICAgICAgICB2YXIgY2FwdHVyZUdyb3VwcyA9IG1hdGNoLnNsaWNlKDEpOwogICAgICAgICAgICB2YXIgcGFyYW1zID0gcGFyYW1OYW1lcy5yZWR1Y2UoKG1lbW8sIHBhcmFtTmFtZSwgaW5kZXgpID0+IHsKICAgICAgICAgICAgICAvLyBXZSBuZWVkIHRvIGNvbXB1dGUgdGhlIHBhdGhuYW1lQmFzZSBoZXJlIHVzaW5nIHRoZSByYXcgc3BsYXQgdmFsdWUKICAgICAgICAgICAgICAvLyBpbnN0ZWFkIG9mIHVzaW5nIHBhcmFtc1siKiJdIGxhdGVyIGJlY2F1c2UgaXQgd2lsbCBiZSBkZWNvZGVkIHRoZW4KICAgICAgICAgICAgICBpZiAocGFyYW1OYW1lID09PSAiKiIpIHsKICAgICAgICAgICAgICAgIHZhciBzcGxhdFZhbHVlID0gY2FwdHVyZUdyb3Vwc1tpbmRleF0gfHwgIiI7CiAgICAgICAgICAgICAgICBwYXRobmFtZUJhc2UgPSBtYXRjaGVkUGF0aG5hbWUuc2xpY2UoMCwgbWF0Y2hlZFBhdGhuYW1lLmxlbmd0aCAtIHNwbGF0VmFsdWUubGVuZ3RoKS5yZXBsYWNlKC8oLilcLyskLywgIiQxIik7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBtZW1vW3BhcmFtTmFtZV0gPSBzYWZlbHlEZWNvZGVVUklDb21wb25lbnQoY2FwdHVyZUdyb3Vwc1tpbmRleF0gfHwgIiIsIHBhcmFtTmFtZSk7CiAgICAgICAgICAgICAgcmV0dXJuIG1lbW87CiAgICAgICAgICAgIH0sIHt9KTsKICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICBwYXJhbXM6IHBhcmFtcywKICAgICAgICAgICAgICBwYXRobmFtZTogbWF0Y2hlZFBhdGhuYW1lLAogICAgICAgICAgICAgIHBhdGhuYW1lQmFzZTogcGF0aG5hbWVCYXNlLAogICAgICAgICAgICAgIHBhdHRlcm46IHBhdHRlcm4KICAgICAgICAgICAgfTsKICAgICAgICAgIH0KCiAgICAgICAgICBmdW5jdGlvbiBjb21waWxlUGF0aChwYXRoLCBjYXNlU2Vuc2l0aXZlLCBlbmQpIHsKICAgICAgICAgICAgaWYgKGNhc2VTZW5zaXRpdmUgPT09IHZvaWQgMCkgewogICAgICAgICAgICAgIGNhc2VTZW5zaXRpdmUgPSBmYWxzZTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKGVuZCA9PT0gdm9pZCAwKSB7CiAgICAgICAgICAgICAgZW5kID0gdHJ1ZTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgd2FybmluZyhwYXRoID09PSAiKiIgfHwgIXBhdGguZW5kc1dpdGgoIioiKSB8fCBwYXRoLmVuZHNXaXRoKCIvKiIpLCAiUm91dGUgcGF0aCBcIiIgKyBwYXRoICsgIlwiIHdpbGwgYmUgdHJlYXRlZCBhcyBpZiBpdCB3ZXJlICIgKyAoIlwiIiArIHBhdGgucmVwbGFjZSgvXCokLywgIi8qIikgKyAiXCIgYmVjYXVzZSB0aGUgYCpgIGNoYXJhY3RlciBtdXN0ICIpICsgImFsd2F5cyBmb2xsb3cgYSBgL2AgaW4gdGhlIHBhdHRlcm4uIFRvIGdldCByaWQgb2YgdGhpcyB3YXJuaW5nLCAiICsgKCJwbGVhc2UgY2hhbmdlIHRoZSByb3V0ZSBwYXRoIHRvIFwiIiArIHBhdGgucmVwbGFjZSgvXCokLywgIi8qIikgKyAiXCIuIikpOwogICAgICAgICAgICB2YXIgcGFyYW1OYW1lcyA9IFtdOwogICAgICAgICAgICB2YXIgcmVnZXhwU291cmNlID0gIl4iICsgcGF0aC5yZXBsYWNlKC9cLypcKj8kLywgIiIpIC8vIElnbm9yZSB0cmFpbGluZyAvIGFuZCAvKiwgd2UnbGwgaGFuZGxlIGl0IGJlbG93CiAgICAgICAgICAgIC5yZXBsYWNlKC9eXC8qLywgIi8iKSAvLyBNYWtlIHN1cmUgaXQgaGFzIGEgbGVhZGluZyAvCiAgICAgICAgICAgIC5yZXBsYWNlKC9bXFwuKiteJD97fXwoKVtcXV0vZywgIlxcJCYiKSAvLyBFc2NhcGUgc3BlY2lhbCByZWdleCBjaGFycwogICAgICAgICAgICAucmVwbGFjZSgvOihcdyspL2csIChfLCBwYXJhbU5hbWUpID0+IHsKICAgICAgICAgICAgICBwYXJhbU5hbWVzLnB1c2gocGFyYW1OYW1lKTsKICAgICAgICAgICAgICByZXR1cm4gIihbXlxcL10rKSI7CiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgaWYgKHBhdGguZW5kc1dpdGgoIioiKSkgewogICAgICAgICAgICAgIHBhcmFtTmFtZXMucHVzaCgiKiIpOwogICAgICAgICAgICAgIHJlZ2V4cFNvdXJjZSArPSBwYXRoID09PSAiKiIgfHwgcGF0aCA9PT0gIi8qIiA/ICIoLiopJCIgLy8gQWxyZWFkeSBtYXRjaGVkIHRoZSBpbml0aWFsIC8sIGp1c3QgbWF0Y2ggdGhlIHJlc3QKICAgICAgICAgICAgICA6ICIoPzpcXC8oLispfFxcLyopJCI7IC8vIERvbid0IGluY2x1ZGUgdGhlIC8gaW4gcGFyYW1zWyIqIl0KICAgICAgICAgICAgfSBlbHNlIGlmIChlbmQpIHsKICAgICAgICAgICAgICAvLyBXaGVuIG1hdGNoaW5nIHRvIHRoZSBlbmQsIGlnbm9yZSB0cmFpbGluZyBzbGFzaGVzCiAgICAgICAgICAgICAgcmVnZXhwU291cmNlICs9ICJcXC8qJCI7CiAgICAgICAgICAgIH0gZWxzZSBpZiAocGF0aCAhPT0gIiIgJiYgcGF0aCAhPT0gIi8iKSB7CiAgICAgICAgICAgICAgLy8gSWYgb3VyIHBhdGggaXMgbm9uLWVtcHR5IGFuZCBjb250YWlucyBhbnl0aGluZyBiZXlvbmQgYW4gaW5pdGlhbCBzbGFzaCwKICAgICAgICAgICAgICAvLyB0aGVuIHdlIGhhdmUgX3NvbWVfIGZvcm0gb2YgcGF0aCBpbiBvdXIgcmVnZXggc28gd2Ugc2hvdWxkIGV4cGVjdCB0bwogICAgICAgICAgICAgIC8vIG1hdGNoIG9ubHkgaWYgd2UgZmluZCB0aGUgZW5kIG9mIHRoaXMgcGF0aCBzZWdtZW50LiAgTG9vayBmb3IgYW4gb3B0aW9uYWwKICAgICAgICAgICAgICAvLyBub24tY2FwdHVyZWQgdHJhaWxpbmcgc2xhc2ggKHRvIG1hdGNoIGEgcG9ydGlvbiBvZiB0aGUgVVJMKSBvciB0aGUgZW5kCiAgICAgICAgICAgICAgLy8gb2YgdGhlIHBhdGggKGlmIHdlJ3ZlIG1hdGNoZWQgdG8gdGhlIGVuZCkuICBXZSB1c2VkIHRvIGRvIHRoaXMgd2l0aCBhCiAgICAgICAgICAgICAgLy8gd29yZCBib3VuZGFyeSBidXQgdGhhdCBnaXZlcyBmYWxzZSBwb3NpdGl2ZXMgb24gcm91dGVzIGxpa2UKICAgICAgICAgICAgICAvLyAvdXNlci1wcmVmZXJlbmNlcyBzaW5jZSBgLWAgY291bnRzIGFzIGEgd29yZCBib3VuZGFyeS4KICAgICAgICAgICAgICByZWdleHBTb3VyY2UgKz0gIig/Oig/PVxcL3wkKSkiOwogICAgICAgICAgICB9IGVsc2UgOwoKICAgICAgICAgICAgdmFyIG1hdGNoZXIgPSBuZXcgUmVnRXhwKHJlZ2V4cFNvdXJjZSwgY2FzZVNlbnNpdGl2ZSA/IHVuZGVmaW5lZCA6ICJpIik7CiAgICAgICAgICAgIHJldHVybiBbbWF0Y2hlciwgcGFyYW1OYW1lc107CiAgICAgICAgICB9CgogICAgICAgICAgZnVuY3Rpb24gc2FmZWx5RGVjb2RlVVJJKHZhbHVlKSB7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgcmV0dXJuIGRlY29kZVVSSSh2YWx1ZSk7CiAgICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgICAgICAgd2FybmluZyhmYWxzZSwgIlRoZSBVUkwgcGF0aCBcIiIgKyB2YWx1ZSArICJcIiBjb3VsZCBub3QgYmUgZGVjb2RlZCBiZWNhdXNlIGl0IGlzIGlzIGEgIiArICJtYWxmb3JtZWQgVVJMIHNlZ21lbnQuIFRoaXMgaXMgcHJvYmFibHkgZHVlIHRvIGEgYmFkIHBlcmNlbnQgIiArICgiZW5jb2RpbmcgKCIgKyBlcnJvciArICIpLiIpKTsKICAgICAgICAgICAgICByZXR1cm4gdmFsdWU7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KCiAgICAgICAgICBmdW5jdGlvbiBzYWZlbHlEZWNvZGVVUklDb21wb25lbnQodmFsdWUsIHBhcmFtTmFtZSkgewogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgIHJldHVybiBkZWNvZGVVUklDb21wb25lbnQodmFsdWUpOwogICAgICAgICAgICB9IGNhdGNoIChlcnJvcikgewogICAgICAgICAgICAgIHdhcm5pbmcoZmFsc2UsICJUaGUgdmFsdWUgZm9yIHRoZSBVUkwgcGFyYW0gXCIiICsgcGFyYW1OYW1lICsgIlwiIHdpbGwgbm90IGJlIGRlY29kZWQgYmVjYXVzZSIgKyAoIiB0aGUgc3RyaW5nIFwiIiArIHZhbHVlICsgIlwiIGlzIGEgbWFsZm9ybWVkIFVSTCBzZWdtZW50LiBUaGlzIGlzIHByb2JhYmx5IikgKyAoIiBkdWUgdG8gYSBiYWQgcGVyY2VudCBlbmNvZGluZyAoIiArIGVycm9yICsgIikuIikpOwogICAgICAgICAgICAgIHJldHVybiB2YWx1ZTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgLyoqCiAgICAgICAgICAgKiBAcHJpdmF0ZQogICAgICAgICAgICovCgoKICAgICAgICAgIGZ1bmN0aW9uIHN0cmlwQmFzZW5hbWUocGF0aG5hbWUsIGJhc2VuYW1lKSB7CiAgICAgICAgICAgIGlmIChiYXNlbmFtZSA9PT0gIi8iKSByZXR1cm4gcGF0aG5hbWU7CgogICAgICAgICAgICBpZiAoIXBhdGhuYW1lLnRvTG93ZXJDYXNlKCkuc3RhcnRzV2l0aChiYXNlbmFtZS50b0xvd2VyQ2FzZSgpKSkgewogICAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgICAgICB9IC8vIFdlIHdhbnQgdG8gbGVhdmUgdHJhaWxpbmcgc2xhc2ggYmVoYXZpb3IgaW4gdGhlIHVzZXIncyBjb250cm9sLCBzbyBpZiB0aGV5CiAgICAgICAgICAgIC8vIHNwZWNpZnkgYSBiYXNlbmFtZSB3aXRoIGEgdHJhaWxpbmcgc2xhc2gsIHdlIHNob3VsZCBzdXBwb3J0IGl0CgoKICAgICAgICAgICAgdmFyIHN0YXJ0SW5kZXggPSBiYXNlbmFtZS5lbmRzV2l0aCgiLyIpID8gYmFzZW5hbWUubGVuZ3RoIC0gMSA6IGJhc2VuYW1lLmxlbmd0aDsKICAgICAgICAgICAgdmFyIG5leHRDaGFyID0gcGF0aG5hbWUuY2hhckF0KHN0YXJ0SW5kZXgpOwoKICAgICAgICAgICAgaWYgKG5leHRDaGFyICYmIG5leHRDaGFyICE9PSAiLyIpIHsKICAgICAgICAgICAgICAvLyBwYXRobmFtZSBkb2VzIG5vdCBzdGFydCB3aXRoIGJhc2VuYW1lLwogICAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgICAgICB9CgogICAgICAgICAgICByZXR1cm4gcGF0aG5hbWUuc2xpY2Uoc3RhcnRJbmRleCkgfHwgIi8iOwogICAgICAgICAgfQogICAgICAgICAgZnVuY3Rpb24gcm91dGVyX2ludmFyaWFudCh2YWx1ZSwgbWVzc2FnZSkgewogICAgICAgICAgICBpZiAodmFsdWUgPT09IGZhbHNlIHx8IHZhbHVlID09PSBudWxsIHx8IHR5cGVvZiB2YWx1ZSA9PT0gInVuZGVmaW5lZCIpIHsKICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IobWVzc2FnZSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIC8qKgogICAgICAgICAgICogQHByaXZhdGUKICAgICAgICAgICAqLwoKICAgICAgICAgIGZ1bmN0aW9uIHdhcm5pbmcoY29uZCwgbWVzc2FnZSkgewogICAgICAgICAgICBpZiAoIWNvbmQpIHsKICAgICAgICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tY29uc29sZQogICAgICAgICAgICAgIGlmICh0eXBlb2YgY29uc29sZSAhPT0gInVuZGVmaW5lZCIpIGNvbnNvbGUud2FybihtZXNzYWdlKTsKCiAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIC8vIFdlbGNvbWUgdG8gZGVidWdnaW5nIFJlYWN0IFJvdXRlciEKICAgICAgICAgICAgICAgIC8vCiAgICAgICAgICAgICAgICAvLyBUaGlzIGVycm9yIGlzIHRocm93biBhcyBhIGNvbnZlbmllbmNlIHNvIHlvdSBjYW4gbW9yZSBlYXNpbHkKICAgICAgICAgICAgICAgIC8vIGZpbmQgdGhlIHNvdXJjZSBmb3IgYSB3YXJuaW5nIHRoYXQgYXBwZWFycyBpbiB0aGUgY29uc29sZSBieQogICAgICAgICAgICAgICAgLy8gZW5hYmxpbmcgInBhdXNlIG9uIGV4Y2VwdGlvbnMiIGluIHlvdXIgSmF2YVNjcmlwdCBkZWJ1Z2dlci4KICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihtZXNzYWdlKTsgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG5vLWVtcHR5CiAgICAgICAgICAgICAgfSBjYXRjaCAoZSkge30KICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgLyoqCiAgICAgICAgICAgKiBSZXR1cm5zIGEgcmVzb2x2ZWQgcGF0aCBvYmplY3QgcmVsYXRpdmUgdG8gdGhlIGdpdmVuIHBhdGhuYW1lLgogICAgICAgICAgICoKICAgICAgICAgICAqIEBzZWUgaHR0cHM6Ly9yZWFjdHJvdXRlci5jb20vZG9jcy9lbi92Ni91dGlscy9yZXNvbHZlLXBhdGgKICAgICAgICAgICAqLwoKICAgICAgICAgIGZ1bmN0aW9uIHJlc29sdmVQYXRoKHRvLCBmcm9tUGF0aG5hbWUpIHsKICAgICAgICAgICAgaWYgKGZyb21QYXRobmFtZSA9PT0gdm9pZCAwKSB7CiAgICAgICAgICAgICAgZnJvbVBhdGhuYW1lID0gIi8iOwogICAgICAgICAgICB9CgogICAgICAgICAgICB2YXIgX3JlZjExID0KCgoKICAgICAgICAgICAgICB0eXBlb2YgdG8gPT09ICJzdHJpbmciID8gcGFyc2VQYXRoKHRvKSA6IHRvLHRvUGF0aG5hbWUgPSBfcmVmMTEucGF0aG5hbWUsX3JlZjExJHNlYXJjaCA9IF9yZWYxMS5zZWFyY2gsc2VhcmNoID0gX3JlZjExJHNlYXJjaCA9PT0gdm9pZCAwID8gIiIgOiBfcmVmMTEkc2VhcmNoLF9yZWYxMSRoYXNoID0gX3JlZjExLmhhc2gsaGFzaCA9IF9yZWYxMSRoYXNoID09PSB2b2lkIDAgPyAiIiA6IF9yZWYxMSRoYXNoOwogICAgICAgICAgICB2YXIgcGF0aG5hbWUgPSB0b1BhdGhuYW1lID8gdG9QYXRobmFtZS5zdGFydHNXaXRoKCIvIikgPyB0b1BhdGhuYW1lIDogcmVzb2x2ZVBhdGhuYW1lKHRvUGF0aG5hbWUsIGZyb21QYXRobmFtZSkgOiBmcm9tUGF0aG5hbWU7CiAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgcGF0aG5hbWU6IHBhdGhuYW1lLAogICAgICAgICAgICAgIHNlYXJjaDogbm9ybWFsaXplU2VhcmNoKHNlYXJjaCksCiAgICAgICAgICAgICAgaGFzaDogbm9ybWFsaXplSGFzaChoYXNoKQogICAgICAgICAgICB9OwogICAgICAgICAgfQoKICAgICAgICAgIGZ1bmN0aW9uIHJlc29sdmVQYXRobmFtZShyZWxhdGl2ZVBhdGgsIGZyb21QYXRobmFtZSkgewogICAgICAgICAgICB2YXIgc2VnbWVudHMgPSBmcm9tUGF0aG5hbWUucmVwbGFjZSgvXC8rJC8sICIiKS5zcGxpdCgiLyIpOwogICAgICAgICAgICB2YXIgcmVsYXRpdmVTZWdtZW50cyA9IHJlbGF0aXZlUGF0aC5zcGxpdCgiLyIpOwogICAgICAgICAgICByZWxhdGl2ZVNlZ21lbnRzLmZvckVhY2goKHNlZ21lbnQpID0+IHsKICAgICAgICAgICAgICBpZiAoc2VnbWVudCA9PT0gIi4uIikgewogICAgICAgICAgICAgICAgLy8gS2VlcCB0aGUgcm9vdCAiIiBzZWdtZW50IHNvIHRoZSBwYXRobmFtZSBzdGFydHMgYXQgLwogICAgICAgICAgICAgICAgaWYgKHNlZ21lbnRzLmxlbmd0aCA+IDEpIHNlZ21lbnRzLnBvcCgpOwogICAgICAgICAgICAgIH0gZWxzZSBpZiAoc2VnbWVudCAhPT0gIi4iKSB7CiAgICAgICAgICAgICAgICBzZWdtZW50cy5wdXNoKHNlZ21lbnQpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIHJldHVybiBzZWdtZW50cy5sZW5ndGggPiAxID8gc2VnbWVudHMuam9pbigiLyIpIDogIi8iOwogICAgICAgICAgfQoKICAgICAgICAgIGZ1bmN0aW9uIGdldEludmFsaWRQYXRoRXJyb3IoY2hhciwgZmllbGQsIGRlc3QsIHBhdGgpIHsKICAgICAgICAgICAgcmV0dXJuICJDYW5ub3QgaW5jbHVkZSBhICciICsgY2hhciArICInIGNoYXJhY3RlciBpbiBhIG1hbnVhbGx5IHNwZWNpZmllZCAiICsgKCJgdG8uIiArIGZpZWxkICsgImAgZmllbGQgWyIgKyBKU09OLnN0cmluZ2lmeShwYXRoKSArICJdLiAgUGxlYXNlIHNlcGFyYXRlIGl0IG91dCB0byB0aGUgIikgKyAoImB0by4iICsgZGVzdCArICJgIGZpZWxkLiBBbHRlcm5hdGl2ZWx5IHlvdSBtYXkgcHJvdmlkZSB0aGUgZnVsbCBwYXRoIGFzICIpICsgImEgc3RyaW5nIGluIDxMaW5rIHRvPVwiLi4uXCI+IGFuZCB0aGUgcm91dGVyIHdpbGwgcGFyc2UgaXQgZm9yIHlvdS4iOwogICAgICAgICAgfQogICAgICAgICAgLyoqCiAgICAgICAgICAgKiBAcHJpdmF0ZQogICAgICAgICAgICoKICAgICAgICAgICAqIFdoZW4gcHJvY2Vzc2luZyByZWxhdGl2ZSBuYXZpZ2F0aW9uIHdlIHdhbnQgdG8gaWdub3JlIGFuY2VzdG9yIHJvdXRlcyB0aGF0CiAgICAgICAgICAgKiBkbyBub3QgY29udHJpYnV0ZSB0byB0aGUgcGF0aCwgc3VjaCB0aGF0IGluZGV4L3BhdGhsZXNzIGxheW91dCByb3V0ZXMgZG9uJ3QKICAgICAgICAgICAqIGludGVyZmVyZS4KICAgICAgICAgICAqCiAgICAgICAgICAgKiBGb3IgZXhhbXBsZSwgd2hlbiBtb3ZpbmcgYSByb3V0ZSBlbGVtZW50IGludG8gYW4gaW5kZXggcm91dGUgYW5kL29yIGEKICAgICAgICAgICAqIHBhdGhsZXNzIGxheW91dCByb3V0ZSwgcmVsYXRpdmUgbGluayBiZWhhdmlvciBjb250YWluZWQgd2l0aGluIHNob3VsZCBzdGF5CiAgICAgICAgICAgKiB0aGUgc2FtZS4gIEJvdGggb2YgdGhlIGZvbGxvd2luZyBleGFtcGxlcyBzaG91bGQgbGluayBiYWNrIHRvIHRoZSByb290OgogICAgICAgICAgICoKICAgICAgICAgICAqICAgPFJvdXRlIHBhdGg9Ii8iPgogICAgICAgICAgICogICAgIDxSb3V0ZSBwYXRoPSJhY2NvdW50cyIgZWxlbWVudD17PExpbmsgdG89Ii4uIn0+CiAgICAgICAgICAgKiAgIDwvUm91dGU+CiAgICAgICAgICAgKgogICAgICAgICAgICogICA8Um91dGUgcGF0aD0iLyI+CiAgICAgICAgICAgKiAgICAgPFJvdXRlIHBhdGg9ImFjY291bnRzIj4KICAgICAgICAgICAqICAgICAgIDxSb3V0ZSBlbGVtZW50PXs8QWNjb3VudHNMYXlvdXQgLz59PiAgICAgICAvLyA8LS0gRG9lcyBub3QgY29udHJpYnV0ZQogICAgICAgICAgICogICAgICAgICA8Um91dGUgaW5kZXggZWxlbWVudD17PExpbmsgdG89Ii4uIn0gLz4gIC8vIDwtLSBEb2VzIG5vdCBjb250cmlidXRlCiAgICAgICAgICAgKiAgICAgICA8L1JvdXRlCiAgICAgICAgICAgKiAgICAgPC9Sb3V0ZT4KICAgICAgICAgICAqICAgPC9Sb3V0ZT4KICAgICAgICAgICAqLwoKCiAgICAgICAgICBmdW5jdGlvbiBnZXRQYXRoQ29udHJpYnV0aW5nTWF0Y2hlcyhtYXRjaGVzKSB7CiAgICAgICAgICAgIHJldHVybiBtYXRjaGVzLmZpbHRlcigobWF0Y2gsIGluZGV4KSA9PiBpbmRleCA9PT0gMCB8fCBtYXRjaC5yb3V0ZS5wYXRoICYmIG1hdGNoLnJvdXRlLnBhdGgubGVuZ3RoID4gMCk7CiAgICAgICAgICB9CiAgICAgICAgICAvKioKICAgICAgICAgICAqIEBwcml2YXRlCiAgICAgICAgICAgKi8KCiAgICAgICAgICBmdW5jdGlvbiByZXNvbHZlVG8odG9BcmcsIHJvdXRlUGF0aG5hbWVzLCBsb2NhdGlvblBhdGhuYW1lLCBpc1BhdGhSZWxhdGl2ZSkgewogICAgICAgICAgICBpZiAoaXNQYXRoUmVsYXRpdmUgPT09IHZvaWQgMCkgewogICAgICAgICAgICAgIGlzUGF0aFJlbGF0aXZlID0gZmFsc2U7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHZhciB0bzsKCiAgICAgICAgICAgIGlmICh0eXBlb2YgdG9BcmcgPT09ICJzdHJpbmciKSB7CiAgICAgICAgICAgICAgdG8gPSBwYXJzZVBhdGgodG9BcmcpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIHRvID0gX2V4dGVuZHMoe30sIHRvQXJnKTsKICAgICAgICAgICAgICByb3V0ZXJfaW52YXJpYW50KCF0by5wYXRobmFtZSB8fCAhdG8ucGF0aG5hbWUuaW5jbHVkZXMoIj8iKSwgZ2V0SW52YWxpZFBhdGhFcnJvcigiPyIsICJwYXRobmFtZSIsICJzZWFyY2giLCB0bykpOwogICAgICAgICAgICAgIHJvdXRlcl9pbnZhcmlhbnQoIXRvLnBhdGhuYW1lIHx8ICF0by5wYXRobmFtZS5pbmNsdWRlcygiIyIpLCBnZXRJbnZhbGlkUGF0aEVycm9yKCIjIiwgInBhdGhuYW1lIiwgImhhc2giLCB0bykpOwogICAgICAgICAgICAgIHJvdXRlcl9pbnZhcmlhbnQoIXRvLnNlYXJjaCB8fCAhdG8uc2VhcmNoLmluY2x1ZGVzKCIjIiksIGdldEludmFsaWRQYXRoRXJyb3IoIiMiLCAic2VhcmNoIiwgImhhc2giLCB0bykpOwogICAgICAgICAgICB9CgogICAgICAgICAgICB2YXIgaXNFbXB0eVBhdGggPSB0b0FyZyA9PT0gIiIgfHwgdG8ucGF0aG5hbWUgPT09ICIiOwogICAgICAgICAgICB2YXIgdG9QYXRobmFtZSA9IGlzRW1wdHlQYXRoID8gIi8iIDogdG8ucGF0aG5hbWU7CiAgICAgICAgICAgIHZhciBmcm9tOyAvLyBSb3V0aW5nIGlzIHJlbGF0aXZlIHRvIHRoZSBjdXJyZW50IHBhdGhuYW1lIGlmIGV4cGxpY2l0bHkgcmVxdWVzdGVkLgogICAgICAgICAgICAvLwogICAgICAgICAgICAvLyBJZiBhIHBhdGhuYW1lIGlzIGV4cGxpY2l0bHkgcHJvdmlkZWQgaW4gYHRvYCwgaXQgc2hvdWxkIGJlIHJlbGF0aXZlIHRvIHRoZQogICAgICAgICAgICAvLyByb3V0ZSBjb250ZXh0LiBUaGlzIGlzIGV4cGxhaW5lZCBpbiBgTm90ZSBvbiBgPExpbmsgdG8+YCB2YWx1ZXNgIGluIG91cgogICAgICAgICAgICAvLyBtaWdyYXRpb24gZ3VpZGUgZnJvbSB2NSBhcyBhIG1lYW5zIG9mIGRpc2FtYmlndWF0aW9uIGJldHdlZW4gYHRvYCB2YWx1ZXMKICAgICAgICAgICAgLy8gdGhhdCBiZWdpbiB3aXRoIGAvYCBhbmQgdGhvc2UgdGhhdCBkbyBub3QuIEhvd2V2ZXIsIHRoaXMgaXMgcHJvYmxlbWF0aWMgZm9yCiAgICAgICAgICAgIC8vIGB0b2AgdmFsdWVzIHRoYXQgZG8gbm90IHByb3ZpZGUgYSBwYXRobmFtZS4gYHRvYCBjYW4gc2ltcGx5IGJlIGEgc2VhcmNoIG9yCiAgICAgICAgICAgIC8vIGhhc2ggc3RyaW5nLCBpbiB3aGljaCBjYXNlIHdlIHNob3VsZCBhc3N1bWUgdGhhdCB0aGUgbmF2aWdhdGlvbiBpcyByZWxhdGl2ZQogICAgICAgICAgICAvLyB0byB0aGUgY3VycmVudCBsb2NhdGlvbidzIHBhdGhuYW1lIGFuZCAqbm90KiB0aGUgcm91dGUgcGF0aG5hbWUuCgogICAgICAgICAgICBpZiAoaXNQYXRoUmVsYXRpdmUgfHwgdG9QYXRobmFtZSA9PSBudWxsKSB7CiAgICAgICAgICAgICAgZnJvbSA9IGxvY2F0aW9uUGF0aG5hbWU7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgdmFyIHJvdXRlUGF0aG5hbWVJbmRleCA9IHJvdXRlUGF0aG5hbWVzLmxlbmd0aCAtIDE7CgogICAgICAgICAgICAgIGlmICh0b1BhdGhuYW1lLnN0YXJ0c1dpdGgoIi4uIikpIHsKICAgICAgICAgICAgICAgIHZhciB0b1NlZ21lbnRzID0gdG9QYXRobmFtZS5zcGxpdCgiLyIpOyAvLyBFYWNoIGxlYWRpbmcgLi4gc2VnbWVudCBtZWFucyAiZ28gdXAgb25lIHJvdXRlIiBpbnN0ZWFkIG9mICJnbyB1cCBvbmUKICAgICAgICAgICAgICAgIC8vIFVSTCBzZWdtZW50Ii4gIFRoaXMgaXMgYSBrZXkgZGlmZmVyZW5jZSBmcm9tIGhvdyA8YSBocmVmPiB3b3JrcyBhbmQgYQogICAgICAgICAgICAgICAgLy8gbWFqb3IgcmVhc29uIHdlIGNhbGwgdGhpcyBhICJ0byIgdmFsdWUgaW5zdGVhZCBvZiBhICJocmVmIi4KCiAgICAgICAgICAgICAgICB3aGlsZSAodG9TZWdtZW50c1swXSA9PT0gIi4uIikgewogICAgICAgICAgICAgICAgICB0b1NlZ21lbnRzLnNoaWZ0KCk7CiAgICAgICAgICAgICAgICAgIHJvdXRlUGF0aG5hbWVJbmRleCAtPSAxOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHRvLnBhdGhuYW1lID0gdG9TZWdtZW50cy5qb2luKCIvIik7CiAgICAgICAgICAgICAgfSAvLyBJZiB0aGVyZSBhcmUgbW9yZSAiLi4iIHNlZ21lbnRzIHRoYW4gcGFyZW50IHJvdXRlcywgcmVzb2x2ZSByZWxhdGl2ZSB0bwogICAgICAgICAgICAgIC8vIHRoZSByb290IC8gVVJMLgoKCiAgICAgICAgICAgICAgZnJvbSA9IHJvdXRlUGF0aG5hbWVJbmRleCA+PSAwID8gcm91dGVQYXRobmFtZXNbcm91dGVQYXRobmFtZUluZGV4XSA6ICIvIjsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdmFyIHBhdGggPSByZXNvbHZlUGF0aCh0bywgZnJvbSk7IC8vIEVuc3VyZSB0aGUgcGF0aG5hbWUgaGFzIGEgdHJhaWxpbmcgc2xhc2ggaWYgdGhlIG9yaWdpbmFsICJ0byIgaGFkIG9uZQoKICAgICAgICAgICAgdmFyIGhhc0V4cGxpY2l0VHJhaWxpbmdTbGFzaCA9IHRvUGF0aG5hbWUgJiYgdG9QYXRobmFtZSAhPT0gIi8iICYmIHRvUGF0aG5hbWUuZW5kc1dpdGgoIi8iKTsgLy8gT3IgaWYgdGhpcyB3YXMgYSBsaW5rIHRvIHRoZSBjdXJyZW50IHBhdGggd2hpY2ggaGFzIGEgdHJhaWxpbmcgc2xhc2gKCiAgICAgICAgICAgIHZhciBoYXNDdXJyZW50VHJhaWxpbmdTbGFzaCA9IChpc0VtcHR5UGF0aCB8fCB0b1BhdGhuYW1lID09PSAiLiIpICYmIGxvY2F0aW9uUGF0aG5hbWUuZW5kc1dpdGgoIi8iKTsKCiAgICAgICAgICAgIGlmICghcGF0aC5wYXRobmFtZS5lbmRzV2l0aCgiLyIpICYmIChoYXNFeHBsaWNpdFRyYWlsaW5nU2xhc2ggfHwgaGFzQ3VycmVudFRyYWlsaW5nU2xhc2gpKSB7CiAgICAgICAgICAgICAgcGF0aC5wYXRobmFtZSArPSAiLyI7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybiBwYXRoOwogICAgICAgICAgfQogICAgICAgICAgLyoqCiAgICAgICAgICAgKiBAcHJpdmF0ZQogICAgICAgICAgICovCgogICAgICAgICAgZnVuY3Rpb24gZ2V0VG9QYXRobmFtZSh0bykgewogICAgICAgICAgICAvLyBFbXB0eSBzdHJpbmdzIHNob3VsZCBiZSB0cmVhdGVkIHRoZSBzYW1lIGFzIC8gcGF0aHMKICAgICAgICAgICAgcmV0dXJuIHRvID09PSAiIiB8fCB0by5wYXRobmFtZSA9PT0gIiIgPyAiLyIgOiB0eXBlb2YgdG8gPT09ICJzdHJpbmciID8gcGFyc2VQYXRoKHRvKS5wYXRobmFtZSA6IHRvLnBhdGhuYW1lOwogICAgICAgICAgfQogICAgICAgICAgLyoqCiAgICAgICAgICAgKiBAcHJpdmF0ZQogICAgICAgICAgICovCgogICAgICAgICAgdmFyIHJvdXRlcl9qb2luUGF0aHMgPSAocGF0aHMpID0+IHBhdGhzLmpvaW4oIi8iKS5yZXBsYWNlKC9cL1wvKy9nLCAiLyIpOwogICAgICAgICAgLyoqCiAgICAgICAgICAgKiBAcHJpdmF0ZQogICAgICAgICAgICovCgogICAgICAgICAgdmFyIG5vcm1hbGl6ZVBhdGhuYW1lID0gKHBhdGhuYW1lKSA9PiBwYXRobmFtZS5yZXBsYWNlKC9cLyskLywgIiIpLnJlcGxhY2UoL15cLyovLCAiLyIpOwogICAgICAgICAgLyoqCiAgICAgICAgICAgKiBAcHJpdmF0ZQogICAgICAgICAgICovCgogICAgICAgICAgdmFyIG5vcm1hbGl6ZVNlYXJjaCA9IChzZWFyY2gpID0+ICFzZWFyY2ggfHwgc2VhcmNoID09PSAiPyIgPyAiIiA6IHNlYXJjaC5zdGFydHNXaXRoKCI/IikgPyBzZWFyY2ggOiAiPyIgKyBzZWFyY2g7CiAgICAgICAgICAvKioKICAgICAgICAgICAqIEBwcml2YXRlCiAgICAgICAgICAgKi8KCiAgICAgICAgICB2YXIgbm9ybWFsaXplSGFzaCA9IChoYXNoKSA9PiAhaGFzaCB8fCBoYXNoID09PSAiIyIgPyAiIiA6IGhhc2guc3RhcnRzV2l0aCgiIyIpID8gaGFzaCA6ICIjIiArIGhhc2g7CiAgICAgICAgICAvKioKICAgICAgICAgICAqIFRoaXMgaXMgYSBzaG9ydGN1dCBmb3IgY3JlYXRpbmcgYGFwcGxpY2F0aW9uL2pzb25gIHJlc3BvbnNlcy4gQ29udmVydHMgYGRhdGFgCiAgICAgICAgICAgKiB0byBKU09OIGFuZCBzZXRzIHRoZSBgQ29udGVudC1UeXBlYCBoZWFkZXIuCiAgICAgICAgICAgKi8KCiAgICAgICAgICB2YXIganNvbiA9IGZ1bmN0aW9uIGpzb24oZGF0YSwgaW5pdCkgewogICAgICAgICAgICBpZiAoaW5pdCA9PT0gdm9pZCAwKSB7CiAgICAgICAgICAgICAgaW5pdCA9IHt9OwogICAgICAgICAgICB9CgogICAgICAgICAgICB2YXIgcmVzcG9uc2VJbml0ID0gdHlwZW9mIGluaXQgPT09ICJudW1iZXIiID8gewogICAgICAgICAgICAgIHN0YXR1czogaW5pdAogICAgICAgICAgICB9IDogaW5pdDsKICAgICAgICAgICAgdmFyIGhlYWRlcnMgPSBuZXcgSGVhZGVycyhyZXNwb25zZUluaXQuaGVhZGVycyk7CgogICAgICAgICAgICBpZiAoIWhlYWRlcnMuaGFzKCJDb250ZW50LVR5cGUiKSkgewogICAgICAgICAgICAgIGhlYWRlcnMuc2V0KCJDb250ZW50LVR5cGUiLCAiYXBwbGljYXRpb24vanNvbjsgY2hhcnNldD11dGYtOCIpOwogICAgICAgICAgICB9CgogICAgICAgICAgICByZXR1cm4gbmV3IFJlc3BvbnNlKEpTT04uc3RyaW5naWZ5KGRhdGEpLCBfZXh0ZW5kcyh7fSwgcmVzcG9uc2VJbml0LCB7CiAgICAgICAgICAgICAgaGVhZGVyczogaGVhZGVycwogICAgICAgICAgICB9KSk7CiAgICAgICAgICB9O3ZhcgogICAgICAgICAgcm91dGVyX0Fib3J0ZWREZWZlcnJlZEVycm9yID0gLyojX19QVVJFX18qL2Z1bmN0aW9uIChfRXJyb3IpIHtfaW5oZXJpdHMocm91dGVyX0Fib3J0ZWREZWZlcnJlZEVycm9yLCBfRXJyb3IpO3ZhciBfc3VwZXIgPSBfY3JlYXRlU3VwZXIocm91dGVyX0Fib3J0ZWREZWZlcnJlZEVycm9yKTtmdW5jdGlvbiByb3V0ZXJfQWJvcnRlZERlZmVycmVkRXJyb3IoKSB7X2NsYXNzQ2FsbENoZWNrMih0aGlzLCByb3V0ZXJfQWJvcnRlZERlZmVycmVkRXJyb3IpO3JldHVybiBfc3VwZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKTt9cmV0dXJuIF9jcmVhdGVDbGFzczIocm91dGVyX0Fib3J0ZWREZWZlcnJlZEVycm9yKTt9KCAvKiNfX1BVUkVfXyovX3dyYXBOYXRpdmVTdXBlcihFcnJvcikpO3ZhcgogICAgICAgICAgRGVmZXJyZWREYXRhID0gLyojX19QVVJFX18qL2Z1bmN0aW9uICgpIHsKICAgICAgICAgICAgZnVuY3Rpb24gRGVmZXJyZWREYXRhKGRhdGEpIHtfY2xhc3NDYWxsQ2hlY2syKHRoaXMsIERlZmVycmVkRGF0YSk7CiAgICAgICAgICAgICAgdGhpcy5wZW5kaW5nS2V5cyA9IG5ldyBTZXQoKTsKICAgICAgICAgICAgICB0aGlzLnN1YnNjcmliZXIgPSB1bmRlZmluZWQ7CiAgICAgICAgICAgICAgcm91dGVyX2ludmFyaWFudChkYXRhICYmIHR5cGVvZiBkYXRhID09PSAib2JqZWN0IiAmJiAhQXJyYXkuaXNBcnJheShkYXRhKSwgImRlZmVyKCkgb25seSBhY2NlcHRzIHBsYWluIG9iamVjdHMiKTsgLy8gU2V0IHVwIGFuIEFib3J0Q29udHJvbGxlciArIFByb21pc2Ugd2UgY2FuIHJhY2UgYWdhaW5zdCB0byBleGl0IGVhcmx5CiAgICAgICAgICAgICAgLy8gY2FuY2VsbGF0aW9uCgogICAgICAgICAgICAgIHZhciByZWplY3Q7CiAgICAgICAgICAgICAgdGhpcy5hYm9ydFByb21pc2UgPSBuZXcgUHJvbWlzZSgoXywgcikgPT4gcmVqZWN0ID0gcik7CiAgICAgICAgICAgICAgdGhpcy5jb250cm9sbGVyID0gbmV3IEFib3J0Q29udHJvbGxlcigpOwoKICAgICAgICAgICAgICB2YXIgb25BYm9ydCA9ICgpID0+IHJlamVjdChuZXcgcm91dGVyX0Fib3J0ZWREZWZlcnJlZEVycm9yKCJEZWZlcnJlZCBkYXRhIGFib3J0ZWQiKSk7CgogICAgICAgICAgICAgIHRoaXMudW5saXN0ZW5BYm9ydFNpZ25hbCA9ICgpID0+IHRoaXMuY29udHJvbGxlci5zaWduYWwucmVtb3ZlRXZlbnRMaXN0ZW5lcigiYWJvcnQiLCBvbkFib3J0KTsKCiAgICAgICAgICAgICAgdGhpcy5jb250cm9sbGVyLnNpZ25hbC5hZGRFdmVudExpc3RlbmVyKCJhYm9ydCIsIG9uQWJvcnQpOwogICAgICAgICAgICAgIHRoaXMuZGF0YSA9IE9iamVjdC5lbnRyaWVzKGRhdGEpLnJlZHVjZSgoYWNjLCBfcmVmKSA9PiB7CiAgICAgICAgICAgICAgICB2YXIgX3JlZjEyID0gX3NsaWNlZFRvQXJyYXkyKF9yZWYsIDIpLGtleSA9IF9yZWYxMlswXSx2YWx1ZSA9IF9yZWYxMlsxXTsKICAgICAgICAgICAgICAgIHJldHVybiBPYmplY3QuYXNzaWduKGFjYywgX2RlZmluZVByb3BlcnR5Mih7fSwKICAgICAgICAgICAgICAgIGtleSwgdGhpcy50cmFja1Byb21pc2Uoa2V5LCB2YWx1ZSkpKTsKCiAgICAgICAgICAgICAgfSwge30pOwogICAgICAgICAgICB9X2NyZWF0ZUNsYXNzMihEZWZlcnJlZERhdGEsIFt7IGtleTogInRyYWNrUHJvbWlzZSIsIHZhbHVlOgoKICAgICAgICAgICAgICBmdW5jdGlvbiB0cmFja1Byb21pc2Uoa2V5LCB2YWx1ZSkgewogICAgICAgICAgICAgICAgaWYgKCEodmFsdWUgaW5zdGFuY2VvZiBQcm9taXNlKSkgewogICAgICAgICAgICAgICAgICByZXR1cm4gdmFsdWU7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgdGhpcy5wZW5kaW5nS2V5cy5hZGQoa2V5KTsgLy8gV2Ugc3RvcmUgYSBsaXR0bGUgd3JhcHBlciBwcm9taXNlIHRoYXQgd2lsbCBiZSBleHRlbmRlZCB3aXRoCiAgICAgICAgICAgICAgICAvLyBfZGF0YS9fZXJyb3IgcHJvcHMgdXBvbiByZXNvbHZlL3JlamVjdAoKICAgICAgICAgICAgICAgIHZhciBwcm9taXNlID0gUHJvbWlzZS5yYWNlKFt2YWx1ZSwgdGhpcy5hYm9ydFByb21pc2VdKS50aGVuKChkYXRhKSA9PiB0aGlzLm9uU2V0dGxlKHByb21pc2UsIGtleSwgbnVsbCwgZGF0YSksIChlcnJvcikgPT4gdGhpcy5vblNldHRsZShwcm9taXNlLCBrZXksIGVycm9yKSk7IC8vIFJlZ2lzdGVyIHJlamVjdGlvbiBsaXN0ZW5lcnMgdG8gYXZvaWQgdW5jYXVnaHQgcHJvbWlzZSByZWplY3Rpb25zIG9uCiAgICAgICAgICAgICAgICAvLyBlcnJvcnMgb3IgYWJvcnRlZCBkZWZlcnJlZCB2YWx1ZXMKCiAgICAgICAgICAgICAgICBwcm9taXNlLmNhdGNoKCgpID0+IHt9KTsKICAgICAgICAgICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShwcm9taXNlLCAiX3RyYWNrZWQiLCB7CiAgICAgICAgICAgICAgICAgIGdldDogKCkgPT4gdHJ1ZQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICByZXR1cm4gcHJvbWlzZTsKICAgICAgICAgICAgICB9IH0sIHsga2V5OiAib25TZXR0bGUiLCB2YWx1ZToKCiAgICAgICAgICAgICAgZnVuY3Rpb24gb25TZXR0bGUocHJvbWlzZSwga2V5LCBlcnJvciwgZGF0YSkgewogICAgICAgICAgICAgICAgaWYgKHRoaXMuY29udHJvbGxlci5zaWduYWwuYWJvcnRlZCAmJiBlcnJvciBpbnN0YW5jZW9mIHJvdXRlcl9BYm9ydGVkRGVmZXJyZWRFcnJvcikgewogICAgICAgICAgICAgICAgICB0aGlzLnVubGlzdGVuQWJvcnRTaWduYWwoKTsKICAgICAgICAgICAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHByb21pc2UsICJfZXJyb3IiLCB7CiAgICAgICAgICAgICAgICAgICAgZ2V0OiAoKSA9PiBlcnJvcgogICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KGVycm9yKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICB0aGlzLnBlbmRpbmdLZXlzLmRlbGV0ZShrZXkpOwoKICAgICAgICAgICAgICAgIGlmICh0aGlzLmRvbmUpIHsKICAgICAgICAgICAgICAgICAgLy8gTm90aGluZyBsZWZ0IHRvIGFib3J0IQogICAgICAgICAgICAgICAgICB0aGlzLnVubGlzdGVuQWJvcnRTaWduYWwoKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICB2YXIgc3Vic2NyaWJlciA9IHRoaXMuc3Vic2NyaWJlcjsKCiAgICAgICAgICAgICAgICBpZiAoZXJyb3IpIHsKICAgICAgICAgICAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHByb21pc2UsICJfZXJyb3IiLCB7CiAgICAgICAgICAgICAgICAgICAgZ2V0OiAoKSA9PiBlcnJvcgogICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgc3Vic2NyaWJlciAmJiBzdWJzY3JpYmVyKGZhbHNlKTsKICAgICAgICAgICAgICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KGVycm9yKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkocHJvbWlzZSwgIl9kYXRhIiwgewogICAgICAgICAgICAgICAgICBnZXQ6ICgpID0+IGRhdGEKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgc3Vic2NyaWJlciAmJiBzdWJzY3JpYmVyKGZhbHNlKTsKICAgICAgICAgICAgICAgIHJldHVybiBkYXRhOwogICAgICAgICAgICAgIH0gfSwgeyBrZXk6ICJzdWJzY3JpYmUiLCB2YWx1ZToKCiAgICAgICAgICAgICAgZnVuY3Rpb24gc3Vic2NyaWJlKGZuKSB7CiAgICAgICAgICAgICAgICB0aGlzLnN1YnNjcmliZXIgPSBmbjsKICAgICAgICAgICAgICB9IH0sIHsga2V5OiAiY2FuY2VsIiwgdmFsdWU6CgogICAgICAgICAgICAgIGZ1bmN0aW9uIGNhbmNlbCgpIHsKICAgICAgICAgICAgICAgIHRoaXMuY29udHJvbGxlci5hYm9ydCgpOwogICAgICAgICAgICAgICAgdGhpcy5wZW5kaW5nS2V5cy5mb3JFYWNoKCh2LCBrKSA9PiB0aGlzLnBlbmRpbmdLZXlzLmRlbGV0ZShrKSk7CiAgICAgICAgICAgICAgICB2YXIgc3Vic2NyaWJlciA9IHRoaXMuc3Vic2NyaWJlcjsKICAgICAgICAgICAgICAgIHN1YnNjcmliZXIgJiYgc3Vic2NyaWJlcih0cnVlKTsKICAgICAgICAgICAgICB9IH0sIHsga2V5OiAicmVzb2x2ZURhdGEiLCB2YWx1ZTogZnVuY3Rpb24gKCkge3ZhciBfcmVzb2x2ZURhdGEgPSBfYXN5bmNUb0dlbmVyYXRvcjIoIC8qI19fUFVSRV9fKi9fcmVnZW5lcmF0b3JSdW50aW1lMigpLm1hcmsoCgogICAgICAgICAgICAgICAgZnVuY3Rpb24gX2NhbGxlZTIoc2lnbmFsKSB7dmFyIGFib3J0ZWQsIG9uQWJvcnQ7cmV0dXJuIF9yZWdlbmVyYXRvclJ1bnRpbWUyKCkud3JhcChmdW5jdGlvbiBfY2FsbGVlMiQoX2NvbnRleHQyKSB7d2hpbGUgKDEpIHtzd2l0Y2ggKF9jb250ZXh0Mi5wcmV2ID0gX2NvbnRleHQyLm5leHQpIHtjYXNlIDA6CiAgICAgICAgICAgICAgICAgICAgICAgICAgYWJvcnRlZCA9IGZhbHNlO2lmICgKCiAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5kb25lKSB7X2NvbnRleHQyLm5leHQgPSA3O2JyZWFrO30KICAgICAgICAgICAgICAgICAgICAgICAgICBvbkFib3J0ID0gKCkgPT4gdGhpcy5jYW5jZWwoKTsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgc2lnbmFsLmFkZEV2ZW50TGlzdGVuZXIoImFib3J0Iiwgb25BYm9ydCk7X2NvbnRleHQyLm5leHQgPSA2O3JldHVybiAoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnN1YnNjcmliZSgoYWJvcnRlZCkgPT4gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNpZ25hbC5yZW1vdmVFdmVudExpc3RlbmVyKCJhYm9ydCIsIG9uQWJvcnQpOwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoYWJvcnRlZCB8fCB0aGlzLmRvbmUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUoYWJvcnRlZCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pKTtjYXNlIDY6YWJvcnRlZCA9IF9jb250ZXh0Mi5zZW50O2Nhc2UgNzpyZXR1cm4gX2NvbnRleHQyLmFicnVwdCgicmV0dXJuIiwKCgogICAgICAgICAgICAgICAgICAgICAgICAgIGFib3J0ZWQpO2Nhc2UgODpjYXNlICJlbmQiOnJldHVybiBfY29udGV4dDIuc3RvcCgpO319fSwgX2NhbGxlZTIsIHRoaXMpO30pKTtmdW5jdGlvbiByZXNvbHZlRGF0YShfeDMpIHtyZXR1cm4gX3Jlc29sdmVEYXRhLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7fXJldHVybiByZXNvbHZlRGF0YTt9KCkgfSwgeyBrZXk6ICJkb25lIiwgZ2V0OgoKCiAgICAgICAgICAgICAgZnVuY3Rpb24gZ2V0KCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMucGVuZGluZ0tleXMuc2l6ZSA9PT0gMDsKICAgICAgICAgICAgICB9IH0sIHsga2V5OiAidW53cmFwcGVkRGF0YSIsIGdldDoKCiAgICAgICAgICAgICAgZnVuY3Rpb24gZ2V0KCkgewogICAgICAgICAgICAgICAgcm91dGVyX2ludmFyaWFudCh0aGlzLmRhdGEgIT09IG51bGwgJiYgdGhpcy5kb25lLCAiQ2FuIG9ubHkgdW53cmFwIGRhdGEgb24gaW5pdGlhbGl6ZWQgYW5kIHNldHRsZWQgZGVmZXJyZWRzIik7CiAgICAgICAgICAgICAgICByZXR1cm4gT2JqZWN0LmVudHJpZXModGhpcy5kYXRhKS5yZWR1Y2UoKGFjYywgX3JlZjIpID0+IHsKICAgICAgICAgICAgICAgICAgdmFyIF9yZWYxMyA9IF9zbGljZWRUb0FycmF5MihfcmVmMiwgMiksa2V5ID0gX3JlZjEzWzBdLHZhbHVlID0gX3JlZjEzWzFdOwogICAgICAgICAgICAgICAgICByZXR1cm4gT2JqZWN0LmFzc2lnbihhY2MsIF9kZWZpbmVQcm9wZXJ0eTIoe30sCiAgICAgICAgICAgICAgICAgIGtleSwgdW53cmFwVHJhY2tlZFByb21pc2UodmFsdWUpKSk7CgogICAgICAgICAgICAgICAgfSwge30pOwogICAgICAgICAgICAgIH0gfV0pO3JldHVybiBEZWZlcnJlZERhdGE7fSgpOwoKCgogICAgICAgICAgZnVuY3Rpb24gaXNUcmFja2VkUHJvbWlzZSh2YWx1ZSkgewogICAgICAgICAgICByZXR1cm4gdmFsdWUgaW5zdGFuY2VvZiBQcm9taXNlICYmIHZhbHVlLl90cmFja2VkID09PSB0cnVlOwogICAgICAgICAgfQoKICAgICAgICAgIGZ1bmN0aW9uIHVud3JhcFRyYWNrZWRQcm9taXNlKHZhbHVlKSB7CiAgICAgICAgICAgIGlmICghaXNUcmFja2VkUHJvbWlzZSh2YWx1ZSkpIHsKICAgICAgICAgICAgICByZXR1cm4gdmFsdWU7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmICh2YWx1ZS5fZXJyb3IpIHsKICAgICAgICAgICAgICB0aHJvdyB2YWx1ZS5fZXJyb3I7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybiB2YWx1ZS5fZGF0YTsKICAgICAgICAgIH0KCiAgICAgICAgICBmdW5jdGlvbiBkZWZlcihkYXRhKSB7CiAgICAgICAgICAgIHJldHVybiBuZXcgRGVmZXJyZWREYXRhKGRhdGEpOwogICAgICAgICAgfQogICAgICAgICAgLyoqCiAgICAgICAgICAgKiBBIHJlZGlyZWN0IHJlc3BvbnNlLiBTZXRzIHRoZSBzdGF0dXMgY29kZSBhbmQgdGhlIGBMb2NhdGlvbmAgaGVhZGVyLgogICAgICAgICAgICogRGVmYXVsdHMgdG8gIjMwMiBGb3VuZCIuCiAgICAgICAgICAgKi8KCiAgICAgICAgICB2YXIgcmVkaXJlY3QgPSBmdW5jdGlvbiByZWRpcmVjdCh1cmwsIGluaXQpIHsKICAgICAgICAgICAgaWYgKGluaXQgPT09IHZvaWQgMCkgewogICAgICAgICAgICAgIGluaXQgPSAzMDI7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHZhciByZXNwb25zZUluaXQgPSBpbml0OwoKICAgICAgICAgICAgaWYgKHR5cGVvZiByZXNwb25zZUluaXQgPT09ICJudW1iZXIiKSB7CiAgICAgICAgICAgICAgcmVzcG9uc2VJbml0ID0gewogICAgICAgICAgICAgICAgc3RhdHVzOiByZXNwb25zZUluaXQKICAgICAgICAgICAgICB9OwogICAgICAgICAgICB9IGVsc2UgaWYgKHR5cGVvZiByZXNwb25zZUluaXQuc3RhdHVzID09PSAidW5kZWZpbmVkIikgewogICAgICAgICAgICAgIHJlc3BvbnNlSW5pdC5zdGF0dXMgPSAzMDI7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHZhciBoZWFkZXJzID0gbmV3IEhlYWRlcnMocmVzcG9uc2VJbml0LmhlYWRlcnMpOwogICAgICAgICAgICBoZWFkZXJzLnNldCgiTG9jYXRpb24iLCB1cmwpOwogICAgICAgICAgICByZXR1cm4gbmV3IFJlc3BvbnNlKG51bGwsIF9leHRlbmRzKHt9LCByZXNwb25zZUluaXQsIHsKICAgICAgICAgICAgICBoZWFkZXJzOiBoZWFkZXJzCiAgICAgICAgICAgIH0pKTsKICAgICAgICAgIH07CiAgICAgICAgICAvKioKICAgICAgICAgICAqIEBwcml2YXRlCiAgICAgICAgICAgKiBVdGlsaXR5IGNsYXNzIHdlIHVzZSB0byBob2xkIGF1dG8tdW53cmFwcGVkIDR4eC81eHggUmVzcG9uc2UgYm9kaWVzCiAgICAgICAgICAgKi92YXIKCiAgICAgICAgICByb3V0ZXJfRXJyb3JSZXNwb25zZSA9IC8qI19fUFVSRV9fKi9fY3JlYXRlQ2xhc3MyKAogICAgICAgICAgZnVuY3Rpb24gcm91dGVyX0Vycm9yUmVzcG9uc2Uoc3RhdHVzLCBzdGF0dXNUZXh0LCBkYXRhLCBpbnRlcm5hbCkge19jbGFzc0NhbGxDaGVjazIodGhpcywgcm91dGVyX0Vycm9yUmVzcG9uc2UpOwogICAgICAgICAgICBpZiAoaW50ZXJuYWwgPT09IHZvaWQgMCkgewogICAgICAgICAgICAgIGludGVybmFsID0gZmFsc2U7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHRoaXMuc3RhdHVzID0gc3RhdHVzOwogICAgICAgICAgICB0aGlzLnN0YXR1c1RleHQgPSBzdGF0dXNUZXh0IHx8ICIiOwogICAgICAgICAgICB0aGlzLmludGVybmFsID0gaW50ZXJuYWw7CgogICAgICAgICAgICBpZiAoZGF0YSBpbnN0YW5jZW9mIEVycm9yKSB7CiAgICAgICAgICAgICAgdGhpcy5kYXRhID0gZGF0YS50b1N0cmluZygpOwogICAgICAgICAgICAgIHRoaXMuZXJyb3IgPSBkYXRhOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIHRoaXMuZGF0YSA9IGRhdGE7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0pOwoKCiAgICAgICAgICAvKioKICAgICAgICAgICAqIENoZWNrIGlmIHRoZSBnaXZlbiBlcnJvciBpcyBhbiBFcnJvclJlc3BvbnNlIGdlbmVyYXRlZCBmcm9tIGEgNHh4LzV4eAogICAgICAgICAgICogUmVzcG9uc2UgdGhyb3cgZnJvbSBhbiBhY3Rpb24vbG9hZGVyCiAgICAgICAgICAgKi8KCiAgICAgICAgICBmdW5jdGlvbiBpc1JvdXRlRXJyb3JSZXNwb25zZShlKSB7CiAgICAgICAgICAgIHJldHVybiBlIGluc3RhbmNlb2Ygcm91dGVyX0Vycm9yUmVzcG9uc2U7CiAgICAgICAgICB9CgogICAgICAgICAgdmFyIHZhbGlkQWN0aW9uTWV0aG9kc0FyciA9IFsicG9zdCIsICJwdXQiLCAicGF0Y2giLCAiZGVsZXRlIl07CiAgICAgICAgICB2YXIgdmFsaWRBY3Rpb25NZXRob2RzID0gbmV3IFNldCh2YWxpZEFjdGlvbk1ldGhvZHNBcnIpOwogICAgICAgICAgdmFyIHZhbGlkUmVxdWVzdE1ldGhvZHNBcnIgPSBbImdldCJdLmNvbmNhdCh2YWxpZEFjdGlvbk1ldGhvZHNBcnIpOwogICAgICAgICAgdmFyIHZhbGlkUmVxdWVzdE1ldGhvZHMgPSBuZXcgU2V0KHZhbGlkUmVxdWVzdE1ldGhvZHNBcnIpOwogICAgICAgICAgdmFyIHJlZGlyZWN0U3RhdHVzQ29kZXMgPSBuZXcgU2V0KFszMDEsIDMwMiwgMzAzLCAzMDcsIDMwOF0pOwogICAgICAgICAgdmFyIHJlZGlyZWN0UHJlc2VydmVNZXRob2RTdGF0dXNDb2RlcyA9IG5ldyBTZXQoWzMwNywgMzA4XSk7CiAgICAgICAgICB2YXIgSURMRV9OQVZJR0FUSU9OID0gewogICAgICAgICAgICBzdGF0ZTogImlkbGUiLAogICAgICAgICAgICBsb2NhdGlvbjogdW5kZWZpbmVkLAogICAgICAgICAgICBmb3JtTWV0aG9kOiB1bmRlZmluZWQsCiAgICAgICAgICAgIGZvcm1BY3Rpb246IHVuZGVmaW5lZCwKICAgICAgICAgICAgZm9ybUVuY1R5cGU6IHVuZGVmaW5lZCwKICAgICAgICAgICAgZm9ybURhdGE6IHVuZGVmaW5lZAogICAgICAgICAgfTsKICAgICAgICAgIHZhciBJRExFX0ZFVENIRVIgPSB7CiAgICAgICAgICAgIHN0YXRlOiAiaWRsZSIsCiAgICAgICAgICAgIGRhdGE6IHVuZGVmaW5lZCwKICAgICAgICAgICAgZm9ybU1ldGhvZDogdW5kZWZpbmVkLAogICAgICAgICAgICBmb3JtQWN0aW9uOiB1bmRlZmluZWQsCiAgICAgICAgICAgIGZvcm1FbmNUeXBlOiB1bmRlZmluZWQsCiAgICAgICAgICAgIGZvcm1EYXRhOiB1bmRlZmluZWQKICAgICAgICAgIH07CiAgICAgICAgICB2YXIgaXNCcm93c2VyID0gdHlwZW9mIHdpbmRvdyAhPT0gInVuZGVmaW5lZCIgJiYgdHlwZW9mIHdpbmRvdy5kb2N1bWVudCAhPT0gInVuZGVmaW5lZCIgJiYgdHlwZW9mIHdpbmRvdy5kb2N1bWVudC5jcmVhdGVFbGVtZW50ICE9PSAidW5kZWZpbmVkIjsKICAgICAgICAgIHZhciBpc1NlcnZlciA9ICFpc0Jyb3dzZXI7IC8vI2VuZHJlZ2lvbgogICAgICAgICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KICAgICAgICAgIC8vI3JlZ2lvbiBjcmVhdGVSb3V0ZXIKICAgICAgICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCgogICAgICAgICAgLyoqCiAgICAgICAgICAgKiBDcmVhdGUgYSByb3V0ZXIgYW5kIGxpc3RlbiB0byBoaXN0b3J5IFBPUCBuYXZpZ2F0aW9ucwogICAgICAgICAgICovCgogICAgICAgICAgZnVuY3Rpb24gcm91dGVyX2NyZWF0ZVJvdXRlcihpbml0KSB7CiAgICAgICAgICAgIHJvdXRlcl9pbnZhcmlhbnQoaW5pdC5yb3V0ZXMubGVuZ3RoID4gMCwgIllvdSBtdXN0IHByb3ZpZGUgYSBub24tZW1wdHkgcm91dGVzIGFycmF5IHRvIGNyZWF0ZVJvdXRlciIpOwogICAgICAgICAgICB2YXIgZGF0YVJvdXRlcyA9IGNvbnZlcnRSb3V0ZXNUb0RhdGFSb3V0ZXMoaW5pdC5yb3V0ZXMpOyAvLyBDbGVhbnVwIGZ1bmN0aW9uIGZvciBoaXN0b3J5CgogICAgICAgICAgICB2YXIgdW5saXN0ZW5IaXN0b3J5ID0gbnVsbDsgLy8gRXh0ZXJuYWxseS1wcm92aWRlZCBmdW5jdGlvbnMgdG8gY2FsbCBvbiBhbGwgc3RhdGUgY2hhbmdlcwoKICAgICAgICAgICAgdmFyIHN1YnNjcmliZXJzID0gbmV3IFNldCgpOyAvLyBFeHRlcm5hbGx5LXByb3ZpZGVkIG9iamVjdCB0byBob2xkIHNjcm9sbCByZXN0b3JhdGlvbiBsb2NhdGlvbnMgZHVyaW5nIHJvdXRpbmcKCiAgICAgICAgICAgIHZhciBzYXZlZFNjcm9sbFBvc2l0aW9ucyA9IG51bGw7IC8vIEV4dGVybmFsbHktcHJvdmlkZWQgZnVuY3Rpb24gdG8gZ2V0IHNjcm9sbCByZXN0b3JhdGlvbiBrZXlzCgogICAgICAgICAgICB2YXIgZ2V0U2Nyb2xsUmVzdG9yYXRpb25LZXkgPSBudWxsOyAvLyBFeHRlcm5hbGx5LXByb3ZpZGVkIGZ1bmN0aW9uIHRvIGdldCBjdXJyZW50IHNjcm9sbCBwb3NpdGlvbgoKICAgICAgICAgICAgdmFyIGdldFNjcm9sbFBvc2l0aW9uID0gbnVsbDsgLy8gT25lLXRpbWUgZmxhZyB0byBjb250cm9sIHRoZSBpbml0aWFsIGh5ZHJhdGlvbiBzY3JvbGwgcmVzdG9yYXRpb24uICBCZWNhdXNlCiAgICAgICAgICAgIC8vIHdlIGRvbid0IGdldCB0aGUgc2F2ZWQgcG9zaXRpb25zIGZyb20gPFNjcm9sbFJlc3RvcmF0aW9uIC8+IHVudGlsIF9hZnRlcl8KICAgICAgICAgICAgLy8gdGhlIGluaXRpYWwgcmVuZGVyLCB3ZSBuZWVkIHRvIG1hbnVhbGx5IHRyaWdnZXIgYSBzZXBhcmF0ZSB1cGRhdGVTdGF0ZSB0bwogICAgICAgICAgICAvLyBzZW5kIGFsb25nIHRoZSByZXN0b3JlU2Nyb2xsUG9zaXRpb24KCiAgICAgICAgICAgIHZhciBpbml0aWFsU2Nyb2xsUmVzdG9yZWQgPSBmYWxzZTsKICAgICAgICAgICAgdmFyIGluaXRpYWxNYXRjaGVzID0gbWF0Y2hSb3V0ZXMoZGF0YVJvdXRlcywgaW5pdC5oaXN0b3J5LmxvY2F0aW9uLCBpbml0LmJhc2VuYW1lKTsKICAgICAgICAgICAgdmFyIGluaXRpYWxFcnJvcnMgPSBudWxsOwoKICAgICAgICAgICAgaWYgKGluaXRpYWxNYXRjaGVzID09IG51bGwpIHsKICAgICAgICAgICAgICAvLyBJZiB3ZSBkbyBub3QgbWF0Y2ggYSB1c2VyLXByb3ZpZGVkLXJvdXRlLCBmYWxsIGJhY2sgdG8gdGhlIHJvb3QKICAgICAgICAgICAgICAvLyB0byBhbGxvdyB0aGUgZXJyb3IgYm91bmRhcnkgdG8gdGFrZSBvdmVyCiAgICAgICAgICAgICAgdmFyIGVycm9yID0gZ2V0SW50ZXJuYWxSb3V0ZXJFcnJvcig0MDQsIHsKICAgICAgICAgICAgICAgIHBhdGhuYW1lOiBpbml0Lmhpc3RvcnkubG9jYXRpb24ucGF0aG5hbWUKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICB2YXIgX2dldFNob3J0Q2lyY3VpdE1hdGNoID0KCgogICAgICAgICAgICAgICAgZ2V0U2hvcnRDaXJjdWl0TWF0Y2hlcyhkYXRhUm91dGVzKSxtYXRjaGVzID0gX2dldFNob3J0Q2lyY3VpdE1hdGNoLm1hdGNoZXMscm91dGUgPSBfZ2V0U2hvcnRDaXJjdWl0TWF0Y2gucm91dGU7CiAgICAgICAgICAgICAgaW5pdGlhbE1hdGNoZXMgPSBtYXRjaGVzOwogICAgICAgICAgICAgIGluaXRpYWxFcnJvcnMgPSBfZGVmaW5lUHJvcGVydHkyKHt9LAogICAgICAgICAgICAgIHJvdXRlLmlkLCBlcnJvcik7CgogICAgICAgICAgICB9CgogICAgICAgICAgICB2YXIgaW5pdGlhbGl6ZWQgPSAhaW5pdGlhbE1hdGNoZXMuc29tZSgobSkgPT4gbS5yb3V0ZS5sb2FkZXIpIHx8IGluaXQuaHlkcmF0aW9uRGF0YSAhPSBudWxsOwogICAgICAgICAgICB2YXIgcm91dGVyOwogICAgICAgICAgICB2YXIgc3RhdGUgPSB7CiAgICAgICAgICAgICAgaGlzdG9yeUFjdGlvbjogaW5pdC5oaXN0b3J5LmFjdGlvbiwKICAgICAgICAgICAgICBsb2NhdGlvbjogaW5pdC5oaXN0b3J5LmxvY2F0aW9uLAogICAgICAgICAgICAgIG1hdGNoZXM6IGluaXRpYWxNYXRjaGVzLAogICAgICAgICAgICAgIGluaXRpYWxpemVkOiBpbml0aWFsaXplZCwKICAgICAgICAgICAgICBuYXZpZ2F0aW9uOiBJRExFX05BVklHQVRJT04sCiAgICAgICAgICAgICAgcmVzdG9yZVNjcm9sbFBvc2l0aW9uOiBudWxsLAogICAgICAgICAgICAgIHByZXZlbnRTY3JvbGxSZXNldDogZmFsc2UsCiAgICAgICAgICAgICAgcmV2YWxpZGF0aW9uOiAiaWRsZSIsCiAgICAgICAgICAgICAgbG9hZGVyRGF0YTogaW5pdC5oeWRyYXRpb25EYXRhICYmIGluaXQuaHlkcmF0aW9uRGF0YS5sb2FkZXJEYXRhIHx8IHt9LAogICAgICAgICAgICAgIGFjdGlvbkRhdGE6IGluaXQuaHlkcmF0aW9uRGF0YSAmJiBpbml0Lmh5ZHJhdGlvbkRhdGEuYWN0aW9uRGF0YSB8fCBudWxsLAogICAgICAgICAgICAgIGVycm9yczogaW5pdC5oeWRyYXRpb25EYXRhICYmIGluaXQuaHlkcmF0aW9uRGF0YS5lcnJvcnMgfHwgaW5pdGlhbEVycm9ycywKICAgICAgICAgICAgICBmZXRjaGVyczogbmV3IE1hcCgpCiAgICAgICAgICAgIH07IC8vIC0tIFN0YXRlZnVsIGludGVybmFsIHZhcmlhYmxlcyB0byBtYW5hZ2UgbmF2aWdhdGlvbnMgLS0KICAgICAgICAgICAgLy8gQ3VycmVudCBuYXZpZ2F0aW9uIGluIHByb2dyZXNzICh0byBiZSBjb21taXR0ZWQgaW4gY29tcGxldGVOYXZpZ2F0aW9uKQoKICAgICAgICAgICAgdmFyIHBlbmRpbmdBY3Rpb24gPSBBY3Rpb24uUG9wOyAvLyBTaG91bGQgdGhlIGN1cnJlbnQgbmF2aWdhdGlvbiBwcmV2ZW50IHRoZSBzY3JvbGwgcmVzZXQgaWYgc2Nyb2xsIGNhbm5vdAogICAgICAgICAgICAvLyBiZSByZXN0b3JlZD8KCiAgICAgICAgICAgIHZhciBwZW5kaW5nUHJldmVudFNjcm9sbFJlc2V0ID0gZmFsc2U7IC8vIEFib3J0Q29udHJvbGxlciBmb3IgdGhlIGFjdGl2ZSBuYXZpZ2F0aW9uCgogICAgICAgICAgICB2YXIgcGVuZGluZ05hdmlnYXRpb25Db250cm9sbGVyOyAvLyBXZSB1c2UgdGhpcyB0byBhdm9pZCB0b3VjaGluZyBoaXN0b3J5IGluIGNvbXBsZXRlTmF2aWdhdGlvbiBpZiBhCiAgICAgICAgICAgIC8vIHJldmFsaWRhdGlvbiBpcyBlbnRpcmVseSB1bmludGVycnVwdGVkCgogICAgICAgICAgICB2YXIgaXNVbmludGVycnVwdGVkUmV2YWxpZGF0aW9uID0gZmFsc2U7IC8vIFVzZSB0aGlzIGludGVybmFsIGZsYWcgdG8gZm9yY2UgcmV2YWxpZGF0aW9uIG9mIGFsbCBsb2FkZXJzOgogICAgICAgICAgICAvLyAgLSBzdWJtaXNzaW9ucyAoY29tcGxldGVkIG9yIGludGVycnVwdGVkKQogICAgICAgICAgICAvLyAgLSB1c2VSZXZhbGlkYXRlKCkKICAgICAgICAgICAgLy8gIC0gWC1SZW1peC1SZXZhbGlkYXRlIChmcm9tIHJlZGlyZWN0KQoKICAgICAgICAgICAgdmFyIGlzUmV2YWxpZGF0aW9uUmVxdWlyZWQgPSBmYWxzZTsgLy8gVXNlIHRoaXMgaW50ZXJuYWwgYXJyYXkgdG8gY2FwdHVyZSByb3V0ZXMgdGhhdCByZXF1aXJlIHJldmFsaWRhdGlvbiBkdWUKICAgICAgICAgICAgLy8gdG8gYSBjYW5jZWxsZWQgZGVmZXJyZWQgb24gYWN0aW9uIHN1Ym1pc3Npb24KCiAgICAgICAgICAgIHZhciBjYW5jZWxsZWREZWZlcnJlZFJvdXRlcyA9IFtdOyAvLyBVc2UgdGhpcyBpbnRlcm5hbCBhcnJheSB0byBjYXB0dXJlIGZldGNoZXIgbG9hZHMgdGhhdCB3ZXJlIGNhbmNlbGxlZCBieSBhbgogICAgICAgICAgICAvLyBhY3Rpb24gbmF2aWdhdGlvbiBhbmQgcmVxdWlyZSByZXZhbGlkYXRpb24KCiAgICAgICAgICAgIHZhciBjYW5jZWxsZWRGZXRjaGVyTG9hZHMgPSBbXTsgLy8gQWJvcnRDb250cm9sbGVycyBmb3IgYW55IGluLWZsaWdodCBmZXRjaGVycwoKICAgICAgICAgICAgdmFyIGZldGNoQ29udHJvbGxlcnMgPSBuZXcgTWFwKCk7IC8vIFRyYWNrIGxvYWRzIGJhc2VkIG9uIHRoZSBvcmRlciBpbiB3aGljaCB0aGV5IHN0YXJ0ZWQKCiAgICAgICAgICAgIHZhciBpbmNyZW1lbnRpbmdMb2FkSWQgPSAwOyAvLyBUcmFjayB0aGUgb3V0c3RhbmRpbmcgcGVuZGluZyBuYXZpZ2F0aW9uIGRhdGEgbG9hZCB0byBiZSBjb21wYXJlZCBhZ2FpbnN0CiAgICAgICAgICAgIC8vIHRoZSBnbG9iYWxseSBpbmNyZW1lbnRpbmcgbG9hZCB3aGVuIGEgZmV0Y2hlciBsb2FkIGxhbmRzIGFmdGVyIGEgY29tcGxldGVkCiAgICAgICAgICAgIC8vIG5hdmlnYXRpb24KCiAgICAgICAgICAgIHZhciBwZW5kaW5nTmF2aWdhdGlvbkxvYWRJZCA9IC0xOyAvLyBGZXRjaGVycyB0aGF0IHRyaWdnZXJlZCBkYXRhIHJlbG9hZHMgYXMgYSByZXN1bHQgb2YgdGhlaXIgYWN0aW9ucwoKICAgICAgICAgICAgdmFyIGZldGNoUmVsb2FkSWRzID0gbmV3IE1hcCgpOyAvLyBGZXRjaGVycyB0aGF0IHRyaWdnZXJlZCByZWRpcmVjdCBuYXZpZ2F0aW9ucyBmcm9tIHRoZWlyIGFjdGlvbnMKCiAgICAgICAgICAgIHZhciBmZXRjaFJlZGlyZWN0SWRzID0gbmV3IFNldCgpOyAvLyBNb3N0IHJlY2VudCBocmVmL21hdGNoIGZvciBmZXRjaGVyLmxvYWQgY2FsbHMgZm9yIGZldGNoZXJzCgogICAgICAgICAgICB2YXIgZmV0Y2hMb2FkTWF0Y2hlcyA9IG5ldyBNYXAoKTsgLy8gU3RvcmUgRGVmZXJyZWREYXRhIGluc3RhbmNlcyBmb3IgYWN0aXZlIHJvdXRlIG1hdGNoZXMuICBXaGVuIGEKICAgICAgICAgICAgLy8gcm91dGUgbG9hZGVyIHJldHVybnMgZGVmZXIoKSB3ZSBzdGljayBvbmUgaW4gaGVyZS4gIFRoZW4sIHdoZW4gYSBuZXN0ZWQKICAgICAgICAgICAgLy8gcHJvbWlzZSByZXNvbHZlcyB3ZSB1cGRhdGUgbG9hZGVyRGF0YS4gIElmIGEgbmV3IG5hdmlnYXRpb24gc3RhcnRzIHdlCiAgICAgICAgICAgIC8vIGNhbmNlbCBhY3RpdmUgZGVmZXJyZWRzIGZvciBlbGltaW5hdGVkIHJvdXRlcy4KCiAgICAgICAgICAgIHZhciBhY3RpdmVEZWZlcnJlZHMgPSBuZXcgTWFwKCk7IC8vIEluaXRpYWxpemUgdGhlIHJvdXRlciwgYWxsIHNpZGUgZWZmZWN0cyBzaG91bGQgYmUga2lja2VkIG9mZiBmcm9tIGhlcmUuCiAgICAgICAgICAgIC8vIEltcGxlbWVudGVkIGFzIGEgRmx1ZW50IEFQSSBmb3IgZWFzZSBvZjoKICAgICAgICAgICAgLy8gICBsZXQgcm91dGVyID0gY3JlYXRlUm91dGVyKGluaXQpLmluaXRpYWxpemUoKTsKCiAgICAgICAgICAgIGZ1bmN0aW9uIGluaXRpYWxpemUoKSB7CiAgICAgICAgICAgICAgLy8gSWYgaGlzdG9yeSBpbmZvcm1zIHVzIG9mIGEgUE9QIG5hdmlnYXRpb24sIHN0YXJ0IHRoZSBuYXZpZ2F0aW9uIGJ1dCBkbyBub3QgdXBkYXRlCiAgICAgICAgICAgICAgLy8gc3RhdGUuICBXZSdsbCB1cGRhdGUgb3VyIG93biBzdGF0ZSBvbmNlIHRoZSBuYXZpZ2F0aW9uIGNvbXBsZXRlcwogICAgICAgICAgICAgIHVubGlzdGVuSGlzdG9yeSA9IGluaXQuaGlzdG9yeS5saXN0ZW4oKF9yZWYpID0+IHsKICAgICAgICAgICAgICAgIHZhcgogICAgICAgICAgICAgICAgICBoaXN0b3J5QWN0aW9uID0KCiAgICAgICAgICAgICAgICAgIF9yZWYuYWN0aW9uLGxvY2F0aW9uID0gX3JlZi5sb2NhdGlvbjsKICAgICAgICAgICAgICAgIHJldHVybiBzdGFydE5hdmlnYXRpb24oaGlzdG9yeUFjdGlvbiwgbG9jYXRpb24pOwogICAgICAgICAgICAgIH0pOyAvLyBLaWNrIG9mZiBpbml0aWFsIGRhdGEgbG9hZCBpZiBuZWVkZWQuICBVc2UgUG9wIHRvIGF2b2lkIG1vZGlmeWluZyBoaXN0b3J5CgogICAgICAgICAgICAgIGlmICghc3RhdGUuaW5pdGlhbGl6ZWQpIHsKICAgICAgICAgICAgICAgIHN0YXJ0TmF2aWdhdGlvbihBY3Rpb24uUG9wLCBzdGF0ZS5sb2NhdGlvbik7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICByZXR1cm4gcm91dGVyOwogICAgICAgICAgICB9IC8vIENsZWFuIHVwIGEgcm91dGVyIGFuZCBpdCdzIHNpZGUgZWZmZWN0cwoKCiAgICAgICAgICAgIGZ1bmN0aW9uIGRpc3Bvc2UoKSB7CiAgICAgICAgICAgICAgaWYgKHVubGlzdGVuSGlzdG9yeSkgewogICAgICAgICAgICAgICAgdW5saXN0ZW5IaXN0b3J5KCk7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBzdWJzY3JpYmVycy5jbGVhcigpOwogICAgICAgICAgICAgIHBlbmRpbmdOYXZpZ2F0aW9uQ29udHJvbGxlciAmJiBwZW5kaW5nTmF2aWdhdGlvbkNvbnRyb2xsZXIuYWJvcnQoKTsKICAgICAgICAgICAgICBzdGF0ZS5mZXRjaGVycy5mb3JFYWNoKChfLCBrZXkpID0+IGRlbGV0ZUZldGNoZXIoa2V5KSk7CiAgICAgICAgICAgIH0gLy8gU3Vic2NyaWJlIHRvIHN0YXRlIHVwZGF0ZXMgZm9yIHRoZSByb3V0ZXIKCgogICAgICAgICAgICBmdW5jdGlvbiBzdWJzY3JpYmUoZm4pIHsKICAgICAgICAgICAgICBzdWJzY3JpYmVycy5hZGQoZm4pOwogICAgICAgICAgICAgIHJldHVybiAoKSA9PiBzdWJzY3JpYmVycy5kZWxldGUoZm4pOwogICAgICAgICAgICB9IC8vIFVwZGF0ZSBvdXIgc3RhdGUgYW5kIG5vdGlmeSB0aGUgY2FsbGluZyBjb250ZXh0IG9mIHRoZSBjaGFuZ2UKCgogICAgICAgICAgICBmdW5jdGlvbiB1cGRhdGVTdGF0ZShuZXdTdGF0ZSkgewogICAgICAgICAgICAgIHN0YXRlID0gX2V4dGVuZHMoe30sIHN0YXRlLCBuZXdTdGF0ZSk7CiAgICAgICAgICAgICAgc3Vic2NyaWJlcnMuZm9yRWFjaCgoc3Vic2NyaWJlcikgPT4gc3Vic2NyaWJlcihzdGF0ZSkpOwogICAgICAgICAgICB9IC8vIENvbXBsZXRlIGEgbmF2aWdhdGlvbiByZXR1cm5pbmcgdGhlIHN0YXRlLm5hdmlnYXRpb24gYmFjayB0byB0aGUgSURMRV9OQVZJR0FUSU9OCiAgICAgICAgICAgIC8vIGFuZCBzZXR0aW5nIHN0YXRlLltoaXN0b3J5QWN0aW9uL2xvY2F0aW9uL21hdGNoZXNdIHRvIHRoZSBuZXcgcm91dGUuCiAgICAgICAgICAgIC8vIC0gTG9jYXRpb24gaXMgYSByZXF1aXJlZCBwYXJhbQogICAgICAgICAgICAvLyAtIE5hdmlnYXRpb24gd2lsbCBhbHdheXMgYmUgc2V0IHRvIElETEVfTkFWSUdBVElPTgogICAgICAgICAgICAvLyAtIENhbiBwYXNzIGFueSBvdGhlciBzdGF0ZSBpbiBuZXdTdGF0ZQoKCiAgICAgICAgICAgIGZ1bmN0aW9uIGNvbXBsZXRlTmF2aWdhdGlvbihsb2NhdGlvbiwgbmV3U3RhdGUpIHsKICAgICAgICAgICAgICB2YXIgX3N0YXRlJG5hdmlnYXRpb24kZm9yOwoKICAgICAgICAgICAgICAvLyBEZWR1Y2UgaWYgd2UncmUgaW4gYSBsb2FkaW5nL2FjdGlvblJlbG9hZCBzdGF0ZToKICAgICAgICAgICAgICAvLyAtIFdlIGhhdmUgY29tbWl0dGVkIGFjdGlvbkRhdGEgaW4gdGhlIHN0b3JlCiAgICAgICAgICAgICAgLy8gLSBUaGUgY3VycmVudCBuYXZpZ2F0aW9uIHdhcyBhIHN1Ym1pc3Npb24KICAgICAgICAgICAgICAvLyAtIFdlJ3JlIHBhc3QgdGhlIHN1Ym1pdHRpbmcgc3RhdGUgYW5kIGludG8gdGhlIGxvYWRpbmcgc3RhdGUKICAgICAgICAgICAgICAvLyAtIFRoZSBsb2NhdGlvbiB3ZSd2ZSBmaW5pc2hlZCBsb2FkaW5nIGlzIGRpZmZlcmVudCBmcm9tIHRoZSBzdWJtaXNzaW9uCiAgICAgICAgICAgICAgLy8gICBsb2NhdGlvbiwgaW5kaWNhdGluZyB3ZSByZWRpcmVjdGVkIGZyb20gdGhlIGFjdGlvbiAoYXZvaWRzIGZhbHNlCiAgICAgICAgICAgICAgLy8gICBwb3NpdGl2ZXMgZm9yIGxvYWRpbmcvc3VibWlzc2lvblJlZGlyZWN0IHdoZW4gYWN0aW9uRGF0YSByZXR1cm5lZAogICAgICAgICAgICAgIC8vICAgb24gYSBwcmlvciBzdWJtaXNzaW9uKQogICAgICAgICAgICAgIHZhciBpc0FjdGlvblJlbG9hZCA9IHN0YXRlLmFjdGlvbkRhdGEgIT0gbnVsbCAmJiBzdGF0ZS5uYXZpZ2F0aW9uLmZvcm1NZXRob2QgIT0gbnVsbCAmJiBzdGF0ZS5uYXZpZ2F0aW9uLnN0YXRlID09PSAibG9hZGluZyIgJiYgKChfc3RhdGUkbmF2aWdhdGlvbiRmb3IgPSBzdGF0ZS5uYXZpZ2F0aW9uLmZvcm1BY3Rpb24pID09IG51bGwgPyB2b2lkIDAgOiBfc3RhdGUkbmF2aWdhdGlvbiRmb3Iuc3BsaXQoIj8iKVswXSkgPT09IGxvY2F0aW9uLnBhdGhuYW1lOyAvLyBBbHdheXMgcHJlc2VydmUgYW55IGV4aXN0aW5nIGxvYWRlckRhdGEgZnJvbSByZS11c2VkIHJvdXRlcwoKICAgICAgICAgICAgICB2YXIgbmV3TG9hZGVyRGF0YSA9IG5ld1N0YXRlLmxvYWRlckRhdGEgPyB7CiAgICAgICAgICAgICAgICBsb2FkZXJEYXRhOiBtZXJnZUxvYWRlckRhdGEoc3RhdGUubG9hZGVyRGF0YSwgbmV3U3RhdGUubG9hZGVyRGF0YSwgbmV3U3RhdGUubWF0Y2hlcyB8fCBbXSkKICAgICAgICAgICAgICB9IDoge307CiAgICAgICAgICAgICAgdXBkYXRlU3RhdGUoX2V4dGVuZHMoe30sIGlzQWN0aW9uUmVsb2FkID8ge30gOiB7CiAgICAgICAgICAgICAgICBhY3Rpb25EYXRhOiBudWxsCiAgICAgICAgICAgICAgfSwgbmV3U3RhdGUsIG5ld0xvYWRlckRhdGEsIHsKICAgICAgICAgICAgICAgIGhpc3RvcnlBY3Rpb246IHBlbmRpbmdBY3Rpb24sCiAgICAgICAgICAgICAgICBsb2NhdGlvbjogbG9jYXRpb24sCiAgICAgICAgICAgICAgICBpbml0aWFsaXplZDogdHJ1ZSwKICAgICAgICAgICAgICAgIG5hdmlnYXRpb246IElETEVfTkFWSUdBVElPTiwKICAgICAgICAgICAgICAgIHJldmFsaWRhdGlvbjogImlkbGUiLAogICAgICAgICAgICAgICAgLy8gRG9uJ3QgcmVzdG9yZSBvbiBzdWJtaXNzaW9uIG5hdmlnYXRpb25zCiAgICAgICAgICAgICAgICByZXN0b3JlU2Nyb2xsUG9zaXRpb246IHN0YXRlLm5hdmlnYXRpb24uZm9ybURhdGEgPyBmYWxzZSA6IGdldFNhdmVkU2Nyb2xsUG9zaXRpb24obG9jYXRpb24sIG5ld1N0YXRlLm1hdGNoZXMgfHwgc3RhdGUubWF0Y2hlcyksCiAgICAgICAgICAgICAgICBwcmV2ZW50U2Nyb2xsUmVzZXQ6IHBlbmRpbmdQcmV2ZW50U2Nyb2xsUmVzZXQKICAgICAgICAgICAgICB9KSk7CgogICAgICAgICAgICAgIGlmIChpc1VuaW50ZXJydXB0ZWRSZXZhbGlkYXRpb24pIDtlbHNlIGlmIChwZW5kaW5nQWN0aW9uID09PSBBY3Rpb24uUG9wKSA7ZWxzZSBpZiAocGVuZGluZ0FjdGlvbiA9PT0gQWN0aW9uLlB1c2gpIHsKICAgICAgICAgICAgICAgIGluaXQuaGlzdG9yeS5wdXNoKGxvY2F0aW9uLCBsb2NhdGlvbi5zdGF0ZSk7CiAgICAgICAgICAgICAgfSBlbHNlIGlmIChwZW5kaW5nQWN0aW9uID09PSBBY3Rpb24uUmVwbGFjZSkgewogICAgICAgICAgICAgICAgaW5pdC5oaXN0b3J5LnJlcGxhY2UobG9jYXRpb24sIGxvY2F0aW9uLnN0YXRlKTsKICAgICAgICAgICAgICB9IC8vIFJlc2V0IHN0YXRlZnVsIG5hdmlnYXRpb24gdmFycwoKCiAgICAgICAgICAgICAgcGVuZGluZ0FjdGlvbiA9IEFjdGlvbi5Qb3A7CiAgICAgICAgICAgICAgcGVuZGluZ1ByZXZlbnRTY3JvbGxSZXNldCA9IGZhbHNlOwogICAgICAgICAgICAgIGlzVW5pbnRlcnJ1cHRlZFJldmFsaWRhdGlvbiA9IGZhbHNlOwogICAgICAgICAgICAgIGlzUmV2YWxpZGF0aW9uUmVxdWlyZWQgPSBmYWxzZTsKICAgICAgICAgICAgICBjYW5jZWxsZWREZWZlcnJlZFJvdXRlcyA9IFtdOwogICAgICAgICAgICAgIGNhbmNlbGxlZEZldGNoZXJMb2FkcyA9IFtdOwogICAgICAgICAgICB9IC8vIFRyaWdnZXIgYSBuYXZpZ2F0aW9uIGV2ZW50LCB3aGljaCBjYW4gZWl0aGVyIGJlIGEgbnVtZXJpY2FsIFBPUCBvciBhIFBVU0gKICAgICAgICAgICAgLy8gcmVwbGFjZSB3aXRoIGFuIG9wdGlvbmFsIHN1Ym1pc3Npb24KICAgICAgICAgICAgZnVuY3Rpb24KCiAgICAgICAgICAgIG5hdmlnYXRlKF94NCwgX3g1KSB7cmV0dXJuIF9uYXZpZ2F0ZS5hcHBseSh0aGlzLCBhcmd1bWVudHMpO30KCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKICAgICAgICAgICAgLy8gUmV2YWxpZGF0ZSBhbGwgY3VycmVudCBsb2FkZXJzLiAgSWYgYSBuYXZpZ2F0aW9uIGlzIGluIHByb2dyZXNzIG9yIGlmIHRoaXMKICAgICAgICAgICAgLy8gaXMgaW50ZXJydXB0ZWQgYnkgYSBuYXZpZ2F0aW9uLCBhbGxvdyB0aGlzIHRvICJzdWNjZWVkIiBieSBjYWxsaW5nIGFsbAogICAgICAgICAgICAvLyBsb2FkZXJzIGR1cmluZyB0aGUgbmV4dCBsb2FkZXIgcm91bmQKICAgICAgICAgICAgZnVuY3Rpb24gX25hdmlnYXRlKCkge19uYXZpZ2F0ZSA9IF9hc3luY1RvR2VuZXJhdG9yMiggLyojX19QVVJFX18qL19yZWdlbmVyYXRvclJ1bnRpbWUyKCkubWFyayhmdW5jdGlvbiBfY2FsbGVlMyh0bywgb3B0cykge3ZhciBfbm9ybWFsaXplTmF2aWdhdGVPcHQyLCBwYXRoLCBzdWJtaXNzaW9uLCBlcnJvciwgbG9jYXRpb24sIGhpc3RvcnlBY3Rpb24sIHByZXZlbnRTY3JvbGxSZXNldDtyZXR1cm4gX3JlZ2VuZXJhdG9yUnVudGltZTIoKS53cmFwKGZ1bmN0aW9uIF9jYWxsZWUzJChfY29udGV4dDMpIHt3aGlsZSAoMSkge3N3aXRjaCAoX2NvbnRleHQzLnByZXYgPSBfY29udGV4dDMubmV4dCkge2Nhc2UgMDppZiAoISh0eXBlb2YgdG8gPT09ICJudW1iZXIiKSkge19jb250ZXh0My5uZXh0ID0gMzticmVhazt9aW5pdC5oaXN0b3J5LmdvKHRvKTtyZXR1cm4gX2NvbnRleHQzLmFicnVwdCgicmV0dXJuIik7Y2FzZSAzOl9ub3JtYWxpemVOYXZpZ2F0ZU9wdDIgPSBub3JtYWxpemVOYXZpZ2F0ZU9wdGlvbnModG8sIG9wdHMpLCBwYXRoID0gX25vcm1hbGl6ZU5hdmlnYXRlT3B0Mi5wYXRoLCBzdWJtaXNzaW9uID0gX25vcm1hbGl6ZU5hdmlnYXRlT3B0Mi5zdWJtaXNzaW9uLCBlcnJvciA9IF9ub3JtYWxpemVOYXZpZ2F0ZU9wdDIuZXJyb3I7bG9jYXRpb24gPSBjcmVhdGVMb2NhdGlvbihzdGF0ZS5sb2NhdGlvbiwgcGF0aCwgb3B0cyAmJiBvcHRzLnN0YXRlKTsgLy8gV2hlbiB1c2luZyBuYXZpZ2F0ZSBhcyBhIFBVU0gvUkVQTEFDRSB3ZSBhcmVuJ3QgcmVhZGluZyBhbiBhbHJlYWR5LWVuY29kZWQKICAgICAgICAgICAgICAgICAgICAgICAgLy8gVVJMIGZyb20gd2luZG93LmxvY2F0aW9uLCBzbyB3ZSBuZWVkIHRvIGVuY29kZSBpdCBoZXJlIHNvIHRoZSBiZWhhdmlvcgogICAgICAgICAgICAgICAgICAgICAgICAvLyByZW1haW5zIHRoZSBzYW1lIGFzIFBPUCBhbmQgbm9uLWRhdGEtcm91dGVyIHVzYWdlcy4gIG5ldyBVUkwoKSBkb2VzIGFsbAogICAgICAgICAgICAgICAgICAgICAgICAvLyB0aGUgc2FtZSBlbmNvZGluZyB3ZSdkIGdldCBmcm9tIGEgaGlzdG9yeS5wdXNoU3RhdGUvd2luZG93LmxvY2F0aW9uIHJlYWQKICAgICAgICAgICAgICAgICAgICAgICAgLy8gd2l0aG91dCBoYXZpbmcgdG8gdG91Y2ggaGlzdG9yeQogICAgICAgICAgICAgICAgICAgICAgICBsb2NhdGlvbiA9IF9leHRlbmRzKHt9LCBsb2NhdGlvbiwgaW5pdC5oaXN0b3J5LmVuY29kZUxvY2F0aW9uKGxvY2F0aW9uKSk7aGlzdG9yeUFjdGlvbiA9IChvcHRzICYmIG9wdHMucmVwbGFjZSkgPT09IHRydWUgfHwgc3VibWlzc2lvbiAhPSBudWxsID8gQWN0aW9uLlJlcGxhY2UgOiBBY3Rpb24uUHVzaDtwcmV2ZW50U2Nyb2xsUmVzZXQgPSBvcHRzICYmICJwcmV2ZW50U2Nyb2xsUmVzZXQiIGluIG9wdHMgPyBvcHRzLnByZXZlbnRTY3JvbGxSZXNldCA9PT0gdHJ1ZSA6IHVuZGVmaW5lZDtfY29udGV4dDMubmV4dCA9IDEwO3JldHVybiBzdGFydE5hdmlnYXRpb24oaGlzdG9yeUFjdGlvbiwgbG9jYXRpb24sIHsgc3VibWlzc2lvbjogc3VibWlzc2lvbiwgLy8gU2VuZCB0aHJvdWdoIHRoZSBmb3JtRGF0YSBzZXJpYWxpemF0aW9uIGVycm9yIGlmIHdlIGhhdmUgb25lIHNvIHdlIGNhbgogICAgICAgICAgICAgICAgICAgICAgICAgIC8vIHJlbmRlciBhdCB0aGUgcmlnaHQgZXJyb3IgYm91bmRhcnkgYWZ0ZXIgd2UgbWF0Y2ggcm91dGVzCiAgICAgICAgICAgICAgICAgICAgICAgICAgcGVuZGluZ0Vycm9yOiBlcnJvciwgcHJldmVudFNjcm9sbFJlc2V0OiBwcmV2ZW50U2Nyb2xsUmVzZXQsIHJlcGxhY2U6IG9wdHMgJiYgb3B0cy5yZXBsYWNlIH0pO2Nhc2UgMTA6cmV0dXJuIF9jb250ZXh0My5hYnJ1cHQoInJldHVybiIsIF9jb250ZXh0My5zZW50KTtjYXNlIDExOmNhc2UgImVuZCI6cmV0dXJuIF9jb250ZXh0My5zdG9wKCk7fX19LCBfY2FsbGVlMyk7fSkpO3JldHVybiBfbmF2aWdhdGUuYXBwbHkodGhpcywgYXJndW1lbnRzKTt9ZnVuY3Rpb24gcmV2YWxpZGF0ZSgpIHtpbnRlcnJ1cHRBY3RpdmVMb2FkcygpO3VwZGF0ZVN0YXRlKHsgcmV2YWxpZGF0aW9uOiAibG9hZGluZyIgfSk7IC8vIElmIHdlJ3JlIGN1cnJlbnRseSBzdWJtaXR0aW5nIGFuIGFjdGlvbiwgd2UgZG9uJ3QgbmVlZCB0byBzdGFydCBhIG5ldwogICAgICAgICAgICAgIC8vIG5hdmlnYXRpb24sIHdlJ2xsIGp1c3QgbGV0IHRoZSBmb2xsb3cgdXAgbG9hZGVyIGV4ZWN1dGlvbiBjYWxsIGFsbCBsb2FkZXJzCiAgICAgICAgICAgICAgaWYgKHN0YXRlLm5hdmlnYXRpb24uc3RhdGUgPT09ICJzdWJtaXR0aW5nIikgewogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgIH0gLy8gSWYgd2UncmUgY3VycmVudGx5IGluIGFuIGlkbGUgc3RhdGUsIHN0YXJ0IGEgbmV3IG5hdmlnYXRpb24gZm9yIHRoZSBjdXJyZW50CiAgICAgICAgICAgICAgLy8gYWN0aW9uL2xvY2F0aW9uIGFuZCBtYXJrIGl0IGFzIHVuaW50ZXJydXB0ZWQsIHdoaWNoIHdpbGwgc2tpcCB0aGUgaGlzdG9yeQogICAgICAgICAgICAgIC8vIHVwZGF0ZSBpbiBjb21wbGV0ZU5hdmlnYXRpb24KCgogICAgICAgICAgICAgIGlmIChzdGF0ZS5uYXZpZ2F0aW9uLnN0YXRlID09PSAiaWRsZSIpIHsKICAgICAgICAgICAgICAgIHN0YXJ0TmF2aWdhdGlvbihzdGF0ZS5oaXN0b3J5QWN0aW9uLCBzdGF0ZS5sb2NhdGlvbiwgewogICAgICAgICAgICAgICAgICBzdGFydFVuaW50ZXJydXB0ZWRSZXZhbGlkYXRpb246IHRydWUKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgIH0gLy8gT3RoZXJ3aXNlLCBpZiB3ZSdyZSBjdXJyZW50bHkgaW4gYSBsb2FkaW5nIHN0YXRlLCBqdXN0IHN0YXJ0IGEgbmV3CiAgICAgICAgICAgICAgLy8gbmF2aWdhdGlvbiB0byB0aGUgbmF2aWdhdGlvbi5sb2NhdGlvbiBidXQgZG8gbm90IHRyaWdnZXIgYW4gdW5pbnRlcnJ1cHRlZAogICAgICAgICAgICAgIC8vIHJldmFsaWRhdGlvbiBzbyB0aGF0IGhpc3RvcnkgY29ycmVjdGx5IHVwZGF0ZXMgb25jZSB0aGUgbmF2aWdhdGlvbiBjb21wbGV0ZXMKCgogICAgICAgICAgICAgIHN0YXJ0TmF2aWdhdGlvbihwZW5kaW5nQWN0aW9uIHx8IHN0YXRlLmhpc3RvcnlBY3Rpb24sIHN0YXRlLm5hdmlnYXRpb24ubG9jYXRpb24sIHsKICAgICAgICAgICAgICAgIG92ZXJyaWRlTmF2aWdhdGlvbjogc3RhdGUubmF2aWdhdGlvbgogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9IC8vIFN0YXJ0IGEgbmF2aWdhdGlvbiB0byB0aGUgZ2l2ZW4gYWN0aW9uL2xvY2F0aW9uLiAgQ2FuIG9wdGlvbmFsbHkgcHJvdmlkZSBhCiAgICAgICAgICAgIC8vIG92ZXJyaWRlTmF2aWdhdGlvbiB3aGljaCB3aWxsIG92ZXJyaWRlIHRoZSBub3JtYWxMb2FkIGluIHRoZSBjYXNlIG9mIGEgcmVkaXJlY3QKICAgICAgICAgICAgLy8gbmF2aWdhdGlvbgogICAgICAgICAgICBmdW5jdGlvbgoKICAgICAgICAgICAgc3RhcnROYXZpZ2F0aW9uKF94NiwgX3g3LCBfeDgpIHtyZXR1cm4gX3N0YXJ0TmF2aWdhdGlvbi5hcHBseSh0aGlzLCBhcmd1bWVudHMpO30KCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCiAgICAgICAgICAgIC8vIENhbGwgdGhlIGFjdGlvbiBtYXRjaGVkIGJ5IHRoZSBsZWFmIHJvdXRlIGZvciB0aGlzIG5hdmlnYXRpb24gYW5kIGhhbmRsZQogICAgICAgICAgICAvLyByZWRpcmVjdHMvZXJyb3JzCiAgICAgICAgICAgIGZ1bmN0aW9uIF9zdGFydE5hdmlnYXRpb24oKSB7X3N0YXJ0TmF2aWdhdGlvbiA9IF9hc3luY1RvR2VuZXJhdG9yMiggLyojX19QVVJFX18qL19yZWdlbmVyYXRvclJ1bnRpbWUyKCkubWFyayhmdW5jdGlvbiBfY2FsbGVlNChoaXN0b3J5QWN0aW9uLCBsb2NhdGlvbiwgb3B0cykge3ZhciBsb2FkaW5nTmF2aWdhdGlvbiwgbWF0Y2hlcywgX2Vycm9yLCBfZ2V0U2hvcnRDaXJjdWl0TWF0Y2gyLCBub3RGb3VuZE1hdGNoZXMsIF9yb3V0ZSwgcmVxdWVzdCwgcGVuZGluZ0FjdGlvbkRhdGEsIHBlbmRpbmdFcnJvciwgYWN0aW9uT3V0cHV0LCBuYXZpZ2F0aW9uLCBfeWllbGQkaGFuZGxlTG9hZGVycywgc2hvcnRDaXJjdWl0ZWQsIGxvYWRlckRhdGEsIGVycm9ycztyZXR1cm4gX3JlZ2VuZXJhdG9yUnVudGltZTIoKS53cmFwKGZ1bmN0aW9uIF9jYWxsZWU0JChfY29udGV4dDQpIHt3aGlsZSAoMSkge3N3aXRjaCAoX2NvbnRleHQ0LnByZXYgPSBfY29udGV4dDQubmV4dCkge2Nhc2UgMDogLy8gQWJvcnQgYW55IGluLXByb2dyZXNzIG5hdmlnYXRpb25zIGFuZCBzdGFydCBhIG5ldyBvbmUuIFVuc2V0IGFueSBvbmdvaW5nCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIHVuaW50ZXJydXB0ZWQgcmV2YWxpZGF0aW9ucyB1bmxlc3MgdG9sZCBvdGhlcndpc2UsIHNpbmNlIHdlIHdhbnQgdGhpcwogICAgICAgICAgICAgICAgICAgICAgICAvLyBuZXcgbmF2aWdhdGlvbiB0byB1cGRhdGUgaGlzdG9yeSBub3JtYWxseQogICAgICAgICAgICAgICAgICAgICAgICBwZW5kaW5nTmF2aWdhdGlvbkNvbnRyb2xsZXIgJiYgcGVuZGluZ05hdmlnYXRpb25Db250cm9sbGVyLmFib3J0KCk7cGVuZGluZ05hdmlnYXRpb25Db250cm9sbGVyID0gbnVsbDtwZW5kaW5nQWN0aW9uID0gaGlzdG9yeUFjdGlvbjtpc1VuaW50ZXJydXB0ZWRSZXZhbGlkYXRpb24gPSAob3B0cyAmJiBvcHRzLnN0YXJ0VW5pbnRlcnJ1cHRlZFJldmFsaWRhdGlvbikgPT09IHRydWU7IC8vIFNhdmUgdGhlIGN1cnJlbnQgc2Nyb2xsIHBvc2l0aW9uIGV2ZXJ5IHRpbWUgd2Ugc3RhcnQgYSBuZXcgbmF2aWdhdGlvbiwKICAgICAgICAgICAgICAgICAgICAgICAgLy8gYW5kIHRyYWNrIHdoZXRoZXIgd2Ugc2hvdWxkIHJlc2V0IHNjcm9sbCBvbiBjb21wbGV0aW9uCiAgICAgICAgICAgICAgICAgICAgICAgIHNhdmVTY3JvbGxQb3NpdGlvbihzdGF0ZS5sb2NhdGlvbiwgc3RhdGUubWF0Y2hlcyk7cGVuZGluZ1ByZXZlbnRTY3JvbGxSZXNldCA9IChvcHRzICYmIG9wdHMucHJldmVudFNjcm9sbFJlc2V0KSA9PT0gdHJ1ZTtsb2FkaW5nTmF2aWdhdGlvbiA9IG9wdHMgJiYgb3B0cy5vdmVycmlkZU5hdmlnYXRpb247bWF0Y2hlcyA9IG1hdGNoUm91dGVzKGRhdGFSb3V0ZXMsIGxvY2F0aW9uLCBpbml0LmJhc2VuYW1lKTsgLy8gU2hvcnQgY2lyY3VpdCB3aXRoIGEgNDA0IG9uIHRoZSByb290IGVycm9yIGJvdW5kYXJ5IGlmIHdlIG1hdGNoIG5vdGhpbmcKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG1hdGNoZXMpIHtfY29udGV4dDQubmV4dCA9IDE0O2JyZWFrO31fZXJyb3IgPSBnZXRJbnRlcm5hbFJvdXRlckVycm9yKDQwNCwgeyBwYXRobmFtZTogbG9jYXRpb24ucGF0aG5hbWUgfSk7X2dldFNob3J0Q2lyY3VpdE1hdGNoMiA9IGdldFNob3J0Q2lyY3VpdE1hdGNoZXMoZGF0YVJvdXRlcyksIG5vdEZvdW5kTWF0Y2hlcyA9IF9nZXRTaG9ydENpcmN1aXRNYXRjaDIubWF0Y2hlcywgX3JvdXRlID0gX2dldFNob3J0Q2lyY3VpdE1hdGNoMi5yb3V0ZTsgLy8gQ2FuY2VsIGFsbCBwZW5kaW5nIGRlZmVycmVkIG9uIDQwNHMgc2luY2Ugd2UgZG9uJ3Qga2VlcCBhbnkgcm91dGVzCiAgICAgICAgICAgICAgICAgICAgICAgIGNhbmNlbEFjdGl2ZURlZmVycmVkcygpO2NvbXBsZXRlTmF2aWdhdGlvbihsb2NhdGlvbiwgeyBtYXRjaGVzOiBub3RGb3VuZE1hdGNoZXMsIGxvYWRlckRhdGE6IHt9LCBlcnJvcnM6IF9kZWZpbmVQcm9wZXJ0eTIoe30sIF9yb3V0ZS5pZCwgX2Vycm9yKSB9KTtyZXR1cm4gX2NvbnRleHQ0LmFicnVwdCgicmV0dXJuIik7Y2FzZSAxNDppZiAoIWlzSGFzaENoYW5nZU9ubHkoc3RhdGUubG9jYXRpb24sIGxvY2F0aW9uKSkge19jb250ZXh0NC5uZXh0ID0gMTc7YnJlYWs7fWNvbXBsZXRlTmF2aWdhdGlvbihsb2NhdGlvbiwgeyBtYXRjaGVzOiBtYXRjaGVzIH0pO3JldHVybiBfY29udGV4dDQuYWJydXB0KCJyZXR1cm4iKTtjYXNlIDE3OiAvLyBDcmVhdGUgYSBjb250cm9sbGVyL1JlcXVlc3QgZm9yIHRoaXMgbmF2aWdhdGlvbgogICAgICAgICAgICAgICAgICAgICAgICBwZW5kaW5nTmF2aWdhdGlvbkNvbnRyb2xsZXIgPSBuZXcgQWJvcnRDb250cm9sbGVyKCk7cmVxdWVzdCA9IGNyZWF0ZVJlcXVlc3QobG9jYXRpb24sIHBlbmRpbmdOYXZpZ2F0aW9uQ29udHJvbGxlci5zaWduYWwsIG9wdHMgJiYgb3B0cy5zdWJtaXNzaW9uKTtpZiAoIShvcHRzICYmIG9wdHMucGVuZGluZ0Vycm9yKSkge19jb250ZXh0NC5uZXh0ID0gMjM7YnJlYWs7fSAvLyBJZiB3ZSBoYXZlIGEgcGVuZGluZ0Vycm9yLCBpdCBtZWFucyB0aGUgdXNlciBhdHRlbXB0ZWQgYSBHRVQgc3VibWlzc2lvbgogICAgICAgICAgICAgICAgICAgICAgICAvLyB3aXRoIGJpbmFyeSBGb3JtRGF0YSBzbyBhc3NpZ24gaGVyZSBhbmQgc2tpcCB0byBoYW5kbGVMb2FkZXJzLiAgVGhhdAogICAgICAgICAgICAgICAgICAgICAgICAvLyB3YXkgd2UgaGFuZGxlIGNhbGxpbmcgbG9hZGVycyBhYm92ZSB0aGUgYm91bmRhcnkgZXRjLiAgSXQncyBub3QgcmVhbGx5CiAgICAgICAgICAgICAgICAgICAgICAgIC8vIGRpZmZlcmVudCBmcm9tIGFuIGFjdGlvbkVycm9yIGluIHRoYXQgc2Vuc2UuCiAgICAgICAgICAgICAgICAgICAgICAgIHBlbmRpbmdFcnJvciA9IF9kZWZpbmVQcm9wZXJ0eTIoe30sIGZpbmROZWFyZXN0Qm91bmRhcnkobWF0Y2hlcykucm91dGUuaWQsIG9wdHMucGVuZGluZ0Vycm9yKTtfY29udGV4dDQubmV4dCA9IDMzO2JyZWFrO2Nhc2UgMjM6aWYgKCEob3B0cyAmJiBvcHRzLnN1Ym1pc3Npb24pKSB7X2NvbnRleHQ0Lm5leHQgPSAzMzticmVhazt9X2NvbnRleHQ0Lm5leHQgPSAyNjtyZXR1cm4gaGFuZGxlQWN0aW9uKHJlcXVlc3QsIGxvY2F0aW9uLCBvcHRzLnN1Ym1pc3Npb24sIG1hdGNoZXMsIHsgcmVwbGFjZTogb3B0cy5yZXBsYWNlIH0pO2Nhc2UgMjY6YWN0aW9uT3V0cHV0ID0gX2NvbnRleHQ0LnNlbnQ7aWYgKCFhY3Rpb25PdXRwdXQuc2hvcnRDaXJjdWl0ZWQpIHtfY29udGV4dDQubmV4dCA9IDI5O2JyZWFrO31yZXR1cm4gX2NvbnRleHQ0LmFicnVwdCgicmV0dXJuIik7Y2FzZSAyOTpwZW5kaW5nQWN0aW9uRGF0YSA9IGFjdGlvbk91dHB1dC5wZW5kaW5nQWN0aW9uRGF0YTtwZW5kaW5nRXJyb3IgPSBhY3Rpb25PdXRwdXQucGVuZGluZ0FjdGlvbkVycm9yO25hdmlnYXRpb24gPSBfZXh0ZW5kcyh7IHN0YXRlOiAibG9hZGluZyIsIGxvY2F0aW9uOiBsb2NhdGlvbiB9LCBvcHRzLnN1Ym1pc3Npb24pO2xvYWRpbmdOYXZpZ2F0aW9uID0gbmF2aWdhdGlvbjtjYXNlIDMzOl9jb250ZXh0NC5uZXh0ID0gMzU7cmV0dXJuIGhhbmRsZUxvYWRlcnMocmVxdWVzdCwgbG9jYXRpb24sIG1hdGNoZXMsIGxvYWRpbmdOYXZpZ2F0aW9uLCBvcHRzICYmIG9wdHMuc3VibWlzc2lvbiwgb3B0cyAmJiBvcHRzLnJlcGxhY2UsIHBlbmRpbmdBY3Rpb25EYXRhLCBwZW5kaW5nRXJyb3IpO2Nhc2UgMzU6X3lpZWxkJGhhbmRsZUxvYWRlcnMgPSBfY29udGV4dDQuc2VudDtzaG9ydENpcmN1aXRlZCA9IF95aWVsZCRoYW5kbGVMb2FkZXJzLnNob3J0Q2lyY3VpdGVkO2xvYWRlckRhdGEgPSBfeWllbGQkaGFuZGxlTG9hZGVycy5sb2FkZXJEYXRhO2Vycm9ycyA9IF95aWVsZCRoYW5kbGVMb2FkZXJzLmVycm9ycztpZiAoIXNob3J0Q2lyY3VpdGVkKSB7X2NvbnRleHQ0Lm5leHQgPSA0MTticmVhazt9cmV0dXJuIF9jb250ZXh0NC5hYnJ1cHQoInJldHVybiIpO2Nhc2UgNDE6IC8vIENsZWFuIHVwIG5vdyB0aGF0IHRoZSBhY3Rpb24vbG9hZGVycyBoYXZlIGNvbXBsZXRlZC4gIERvbid0IGNsZWFuIHVwIGlmCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIHdlIHNob3J0IGNpcmN1aXRlZCBiZWNhdXNlIHBlbmRpbmdOYXZpZ2F0aW9uQ29udHJvbGxlciB3aWxsIGhhdmUgYWxyZWFkeQogICAgICAgICAgICAgICAgICAgICAgICAvLyBiZWVuIGFzc2lnbmVkIHRvIGEgbmV3IGNvbnRyb2xsZXIgZm9yIHRoZSBuZXh0IG5hdmlnYXRpb24KICAgICAgICAgICAgICAgICAgICAgICAgcGVuZGluZ05hdmlnYXRpb25Db250cm9sbGVyID0gbnVsbDtjb21wbGV0ZU5hdmlnYXRpb24obG9jYXRpb24sIHsgbWF0Y2hlczogbWF0Y2hlcywgbG9hZGVyRGF0YTogbG9hZGVyRGF0YSwgZXJyb3JzOiBlcnJvcnMgfSk7Y2FzZSA0MzpjYXNlICJlbmQiOnJldHVybiBfY29udGV4dDQuc3RvcCgpO319fSwgX2NhbGxlZTQpO30pKTtyZXR1cm4gX3N0YXJ0TmF2aWdhdGlvbi5hcHBseSh0aGlzLCBhcmd1bWVudHMpO31mdW5jdGlvbiBoYW5kbGVBY3Rpb24oX3g5LCBfeDEwLCBfeDExLCBfeDEyLCBfeDEzKSB7cmV0dXJuIF9oYW5kbGVBY3Rpb24uYXBwbHkodGhpcywgYXJndW1lbnRzKTt9CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgogICAgICAgICAgICAvLyBDYWxsIGFsbCBhcHBsaWNhYmxlIGxvYWRlcnMgZm9yIHRoZSBnaXZlbiBtYXRjaGVzLCBoYW5kbGluZyByZWRpcmVjdHMsCiAgICAgICAgICAgIC8vIGVycm9ycywgZXRjLgogICAgICAgICAgICBmdW5jdGlvbiBfaGFuZGxlQWN0aW9uKCkge19oYW5kbGVBY3Rpb24gPSBfYXN5bmNUb0dlbmVyYXRvcjIoIC8qI19fUFVSRV9fKi9fcmVnZW5lcmF0b3JSdW50aW1lMigpLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTUocmVxdWVzdCwgbG9jYXRpb24sIHN1Ym1pc3Npb24sIG1hdGNoZXMsIG9wdHMpIHt2YXIgbmF2aWdhdGlvbiwgcmVzdWx0LCBhY3Rpb25NYXRjaCwgYm91bmRhcnlNYXRjaDtyZXR1cm4gX3JlZ2VuZXJhdG9yUnVudGltZTIoKS53cmFwKGZ1bmN0aW9uIF9jYWxsZWU1JChfY29udGV4dDUpIHt3aGlsZSAoMSkge3N3aXRjaCAoX2NvbnRleHQ1LnByZXYgPSBfY29udGV4dDUubmV4dCkge2Nhc2UgMDppbnRlcnJ1cHRBY3RpdmVMb2FkcygpOyAvLyBQdXQgdXMgaW4gYSBzdWJtaXR0aW5nIHN0YXRlCiAgICAgICAgICAgICAgICAgICAgICAgIG5hdmlnYXRpb24gPSBfZXh0ZW5kcyh7IHN0YXRlOiAic3VibWl0dGluZyIsIGxvY2F0aW9uOiBsb2NhdGlvbiB9LCBzdWJtaXNzaW9uKTt1cGRhdGVTdGF0ZSh7IG5hdmlnYXRpb246IG5hdmlnYXRpb24gfSk7IC8vIENhbGwgb3VyIGFjdGlvbiBhbmQgZ2V0IHRoZSByZXN1bHQKICAgICAgICAgICAgICAgICAgICAgICAgYWN0aW9uTWF0Y2ggPSBnZXRUYXJnZXRNYXRjaChtYXRjaGVzLCBsb2NhdGlvbik7aWYgKGFjdGlvbk1hdGNoLnJvdXRlLmFjdGlvbikge19jb250ZXh0NS5uZXh0ID0gODticmVhazt9cmVzdWx0ID0geyB0eXBlOiBSZXN1bHRUeXBlLmVycm9yLCBlcnJvcjogZ2V0SW50ZXJuYWxSb3V0ZXJFcnJvcig0MDUsIHsgbWV0aG9kOiByZXF1ZXN0Lm1ldGhvZCwgcGF0aG5hbWU6IGxvY2F0aW9uLnBhdGhuYW1lLCByb3V0ZUlkOiBhY3Rpb25NYXRjaC5yb3V0ZS5pZCB9KSB9O19jb250ZXh0NS5uZXh0ID0gMTM7YnJlYWs7Y2FzZSA4Ol9jb250ZXh0NS5uZXh0ID0gMTA7cmV0dXJuIGNhbGxMb2FkZXJPckFjdGlvbigiYWN0aW9uIiwgcmVxdWVzdCwgYWN0aW9uTWF0Y2gsIG1hdGNoZXMsIHJvdXRlci5iYXNlbmFtZSk7Y2FzZSAxMDpyZXN1bHQgPSBfY29udGV4dDUuc2VudDtpZiAoIXJlcXVlc3Quc2lnbmFsLmFib3J0ZWQpIHtfY29udGV4dDUubmV4dCA9IDEzO2JyZWFrO31yZXR1cm4gX2NvbnRleHQ1LmFicnVwdCgicmV0dXJuIiwgeyBzaG9ydENpcmN1aXRlZDogdHJ1ZSB9KTtjYXNlIDEzOmlmICghaXNSZWRpcmVjdFJlc3VsdChyZXN1bHQpKSB7X2NvbnRleHQ1Lm5leHQgPSAxNzticmVhazt9X2NvbnRleHQ1Lm5leHQgPSAxNjtyZXR1cm4gc3RhcnRSZWRpcmVjdE5hdmlnYXRpb24oc3RhdGUsIHJlc3VsdCwgb3B0cyAmJiBvcHRzLnJlcGxhY2UgPT09IHRydWUpO2Nhc2UgMTY6cmV0dXJuIF9jb250ZXh0NS5hYnJ1cHQoInJldHVybiIsIHsgc2hvcnRDaXJjdWl0ZWQ6IHRydWUgfSk7Y2FzZSAxNzppZiAoIWlzRXJyb3JSZXN1bHQocmVzdWx0KSkge19jb250ZXh0NS5uZXh0ID0gMjE7YnJlYWs7fSAvLyBTdG9yZSBvZmYgdGhlIHBlbmRpbmcgZXJyb3IgLSB3ZSB1c2UgaXQgdG8gZGV0ZXJtaW5lIHdoaWNoIGxvYWRlcnMKICAgICAgICAgICAgICAgICAgICAgICAgLy8gdG8gY2FsbCBhbmQgd2lsbCBjb21taXQgaXQgd2hlbiB3ZSBjb21wbGV0ZSB0aGUgbmF2aWdhdGlvbgogICAgICAgICAgICAgICAgICAgICAgICBib3VuZGFyeU1hdGNoID0gZmluZE5lYXJlc3RCb3VuZGFyeShtYXRjaGVzLCBhY3Rpb25NYXRjaC5yb3V0ZS5pZCk7IC8vIEJ5IGRlZmF1bHQsIGFsbCBzdWJtaXNzaW9ucyBhcmUgUkVQTEFDRSBuYXZpZ2F0aW9ucywgYnV0IGlmIHRoZQogICAgICAgICAgICAgICAgICAgICAgICAvLyBhY3Rpb24gdGhyZXcgYW4gZXJyb3IgdGhhdCdsbCBiZSByZW5kZXJlZCBpbiBhbiBlcnJvckVsZW1lbnQsIHdlIGZhbGwKICAgICAgICAgICAgICAgICAgICAgICAgLy8gYmFjayB0byBQVVNIIHNvIHRoYXQgdGhlIHVzZXIgY2FuIHVzZSB0aGUgYmFjayBidXR0b24gdG8gZ2V0IGJhY2sgdG8KICAgICAgICAgICAgICAgICAgICAgICAgLy8gdGhlIHByZS1zdWJtaXNzaW9uIGZvcm0gbG9jYXRpb24gdG8gdHJ5IGFnYWluCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICgob3B0cyAmJiBvcHRzLnJlcGxhY2UpICE9PSB0cnVlKSB7cGVuZGluZ0FjdGlvbiA9IEFjdGlvbi5QdXNoO31yZXR1cm4gX2NvbnRleHQ1LmFicnVwdCgicmV0dXJuIiwgeyBwZW5kaW5nQWN0aW9uRXJyb3I6IF9kZWZpbmVQcm9wZXJ0eTIoe30sIGJvdW5kYXJ5TWF0Y2gucm91dGUuaWQsIHJlc3VsdC5lcnJvcikgfSk7Y2FzZSAyMTppZiAoIWlzRGVmZXJyZWRSZXN1bHQocmVzdWx0KSkge19jb250ZXh0NS5uZXh0ID0gMjM7YnJlYWs7fXRocm93IG5ldyBFcnJvcigiZGVmZXIoKSBpcyBub3Qgc3VwcG9ydGVkIGluIGFjdGlvbnMiKTtjYXNlIDIzOnJldHVybiBfY29udGV4dDUuYWJydXB0KCJyZXR1cm4iLCB7IHBlbmRpbmdBY3Rpb25EYXRhOiBfZGVmaW5lUHJvcGVydHkyKHt9LCBhY3Rpb25NYXRjaC5yb3V0ZS5pZCwgcmVzdWx0LmRhdGEpIH0pO2Nhc2UgMjQ6Y2FzZSAiZW5kIjpyZXR1cm4gX2NvbnRleHQ1LnN0b3AoKTt9fX0sIF9jYWxsZWU1KTt9KSk7cmV0dXJuIF9oYW5kbGVBY3Rpb24uYXBwbHkodGhpcywgYXJndW1lbnRzKTt9ZnVuY3Rpb24gaGFuZGxlTG9hZGVycyhfeDE0LCBfeDE1LCBfeDE2LCBfeDE3LCBfeDE4LCBfeDE5LCBfeDIwLCBfeDIxKSB7cmV0dXJuIF9oYW5kbGVMb2FkZXJzLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7fWZ1bmN0aW9uIF9oYW5kbGVMb2FkZXJzKCkge19oYW5kbGVMb2FkZXJzID0gX2FzeW5jVG9HZW5lcmF0b3IyKCAvKiNfX1BVUkVfXyovX3JlZ2VuZXJhdG9yUnVudGltZTIoKS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWU2KHJlcXVlc3QsIGxvY2F0aW9uLCBtYXRjaGVzLCBvdmVycmlkZU5hdmlnYXRpb24sIHN1Ym1pc3Npb24sIHJlcGxhY2UsIHBlbmRpbmdBY3Rpb25EYXRhLCBwZW5kaW5nRXJyb3IpIHt2YXIgbG9hZGluZ05hdmlnYXRpb24sIG5hdmlnYXRpb24sIF9nZXRNYXRjaGVzVG9Mb2FkLCBfZ2V0TWF0Y2hlc1RvTG9hZDIsIG1hdGNoZXNUb0xvYWQsIHJldmFsaWRhdGluZ0ZldGNoZXJzLCBfeWllbGQkY2FsbExvYWRlcnNBbmQsIHJlc3VsdHMsIGxvYWRlclJlc3VsdHMsIGZldGNoZXJSZXN1bHRzLCByZWRpcmVjdCwgX3Byb2Nlc3NMb2FkZXJEYXRhLCBsb2FkZXJEYXRhLCBlcnJvcnMsIGRpZEFib3J0RmV0Y2hMb2FkcztyZXR1cm4gX3JlZ2VuZXJhdG9yUnVudGltZTIoKS53cmFwKGZ1bmN0aW9uIF9jYWxsZWU2JChfY29udGV4dDYpIHt3aGlsZSAoMSkge3N3aXRjaCAoX2NvbnRleHQ2LnByZXYgPSBfY29udGV4dDYubmV4dCkge2Nhc2UgMDogLy8gRmlndXJlIG91dCB0aGUgcmlnaHQgbmF2aWdhdGlvbiB3ZSB3YW50IHRvIHVzZSBmb3IgZGF0YSBsb2FkaW5nCiAgICAgICAgICAgICAgICAgICAgICAgIGxvYWRpbmdOYXZpZ2F0aW9uID0gb3ZlcnJpZGVOYXZpZ2F0aW9uO2lmICghbG9hZGluZ05hdmlnYXRpb24pIHtuYXZpZ2F0aW9uID0geyBzdGF0ZTogImxvYWRpbmciLCBsb2NhdGlvbjogbG9jYXRpb24sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3JtTWV0aG9kOiB1bmRlZmluZWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3JtQWN0aW9uOiB1bmRlZmluZWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3JtRW5jVHlwZTogdW5kZWZpbmVkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9ybURhdGE6IHVuZGVmaW5lZAogICAgICAgICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgICAgICAgICAgbG9hZGluZ05hdmlnYXRpb24gPSBuYXZpZ2F0aW9uOwogICAgICAgICAgICAgICAgICAgICAgICB9X2dldE1hdGNoZXNUb0xvYWQgPQoKICAgICAgICAgICAgICAgICAgICAgICAgZ2V0TWF0Y2hlc1RvTG9hZChzdGF0ZSwgbWF0Y2hlcywgc3VibWlzc2lvbiwgbG9jYXRpb24sIGlzUmV2YWxpZGF0aW9uUmVxdWlyZWQsIGNhbmNlbGxlZERlZmVycmVkUm91dGVzLCBjYW5jZWxsZWRGZXRjaGVyTG9hZHMsIHBlbmRpbmdBY3Rpb25EYXRhLCBwZW5kaW5nRXJyb3IsIGZldGNoTG9hZE1hdGNoZXMpLCBfZ2V0TWF0Y2hlc1RvTG9hZDIgPSBfc2xpY2VkVG9BcnJheTIoX2dldE1hdGNoZXNUb0xvYWQsIDIpLCBtYXRjaGVzVG9Mb2FkID0gX2dldE1hdGNoZXNUb0xvYWQyWzBdLCByZXZhbGlkYXRpbmdGZXRjaGVycyA9IF9nZXRNYXRjaGVzVG9Mb2FkMlsxXTsgLy8gQ2FuY2VsIHBlbmRpbmcgZGVmZXJyZWRzIGZvciBuby1sb25nZXItbWF0Y2hlZCByb3V0ZXMgb3Igcm91dGVzIHdlJ3JlCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIGFib3V0IHRvIHJlbG9hZC4gIE5vdGUgdGhhdCBpZiB0aGlzIGlzIGFuIGFjdGlvbiByZWxvYWQgd2Ugd291bGQgaGF2ZQogICAgICAgICAgICAgICAgICAgICAgICAvLyBhbHJlYWR5IGNhbmNlbGxlZCBhbGwgcGVuZGluZyBkZWZlcnJlZHMgc28gdGhpcyB3b3VsZCBiZSBhIG5vLW9wCgogICAgICAgICAgICAgICAgICAgICAgICBjYW5jZWxBY3RpdmVEZWZlcnJlZHMoKHJvdXRlSWQpID0+ICEobWF0Y2hlcyAmJiBtYXRjaGVzLnNvbWUoKG0pID0+IG0ucm91dGUuaWQgPT09IHJvdXRlSWQpKSB8fCBtYXRjaGVzVG9Mb2FkICYmIG1hdGNoZXNUb0xvYWQuc29tZSgobSkgPT4gbS5yb3V0ZS5pZCA9PT0gcm91dGVJZCkpOyAvLyBTaG9ydCBjaXJjdWl0IGlmIHdlIGhhdmUgbm8gbG9hZGVycyB0byBydW4KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCEoCiAgICAgICAgICAgICAgICAgICAgICAgIG1hdGNoZXNUb0xvYWQubGVuZ3RoID09PSAwICYmIHJldmFsaWRhdGluZ0ZldGNoZXJzLmxlbmd0aCA9PT0gMCkpIHtfY29udGV4dDYubmV4dCA9IDc7YnJlYWs7fQogICAgICAgICAgICAgICAgICAgICAgICBjb21wbGV0ZU5hdmlnYXRpb24obG9jYXRpb24sIHsKICAgICAgICAgICAgICAgICAgICAgICAgICBtYXRjaGVzOiBtYXRjaGVzLAogICAgICAgICAgICAgICAgICAgICAgICAgIGxvYWRlckRhdGE6IG1lcmdlTG9hZGVyRGF0YShzdGF0ZS5sb2FkZXJEYXRhLCB7fSwgbWF0Y2hlcyksCiAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gQ29tbWl0IHBlbmRpbmcgZXJyb3IgaWYgd2UncmUgc2hvcnQgY2lyY3VpdGluZwogICAgICAgICAgICAgICAgICAgICAgICAgIGVycm9yczogcGVuZGluZ0Vycm9yIHx8IG51bGwsCiAgICAgICAgICAgICAgICAgICAgICAgICAgYWN0aW9uRGF0YTogcGVuZGluZ0FjdGlvbkRhdGEgfHwgbnVsbAogICAgICAgICAgICAgICAgICAgICAgICB9KTtyZXR1cm4gX2NvbnRleHQ2LmFicnVwdCgicmV0dXJuIiwKICAgICAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICAgIHNob3J0Q2lyY3VpdGVkOiB0cnVlCiAgICAgICAgICAgICAgICAgICAgICAgIH0pO2Nhc2UgNzoKICAgICAgICAgICAgICAgICAgICAgICAgLy8gSWYgdGhpcyBpcyBhbiB1bmludGVycnVwdGVkIHJldmFsaWRhdGlvbiwgd2UgcmVtYWluIGluIG91ciBjdXJyZW50IGlkbGUKICAgICAgICAgICAgICAgICAgICAgICAgLy8gc3RhdGUuICBJZiBub3QsIHdlIG5lZWQgdG8gc3dpdGNoIHRvIG91ciBsb2FkaW5nIHN0YXRlIGFuZCBsb2FkIGRhdGEsCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIHByZXNlcnZpbmcgYW55IG5ldyBhY3Rpb24gZGF0YSBvciBleGlzdGluZyBhY3Rpb24gZGF0YSAoaW4gdGhlIGNhc2Ugb2YKICAgICAgICAgICAgICAgICAgICAgICAgLy8gYSByZXZhbGlkYXRpb24gaW50ZXJydXB0aW5nIGFuIGFjdGlvblJlbG9hZCkKCgogICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWlzVW5pbnRlcnJ1cHRlZFJldmFsaWRhdGlvbikgewogICAgICAgICAgICAgICAgICAgICAgICAgIHJldmFsaWRhdGluZ0ZldGNoZXJzLmZvckVhY2goKF9yZWYyKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgX3JlZjE0ID0gX3NsaWNlZFRvQXJyYXkyKF9yZWYyLCAxKSxrZXkgPSBfcmVmMTRbMF07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgZmV0Y2hlciA9IHN0YXRlLmZldGNoZXJzLmdldChrZXkpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHJldmFsaWRhdGluZ0ZldGNoZXIgPSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YXRlOiAibG9hZGluZyIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGE6IGZldGNoZXIgJiYgZmV0Y2hlci5kYXRhLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3JtTWV0aG9kOiB1bmRlZmluZWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvcm1BY3Rpb246IHVuZGVmaW5lZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9ybUVuY1R5cGU6IHVuZGVmaW5lZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9ybURhdGE6IHVuZGVmaW5lZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YXRlLmZldGNoZXJzLnNldChrZXksIHJldmFsaWRhdGluZ0ZldGNoZXIpOwogICAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICAgIHVwZGF0ZVN0YXRlKF9leHRlbmRzKHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5hdmlnYXRpb246IGxvYWRpbmdOYXZpZ2F0aW9uLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgYWN0aW9uRGF0YTogcGVuZGluZ0FjdGlvbkRhdGEgfHwgc3RhdGUuYWN0aW9uRGF0YSB8fCBudWxsCiAgICAgICAgICAgICAgICAgICAgICAgICAgfSwgcmV2YWxpZGF0aW5nRmV0Y2hlcnMubGVuZ3RoID4gMCA/IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZldGNoZXJzOiBuZXcgTWFwKHN0YXRlLmZldGNoZXJzKQogICAgICAgICAgICAgICAgICAgICAgICAgIH0gOiB7fSkpOwogICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICBwZW5kaW5nTmF2aWdhdGlvbkxvYWRJZCA9ICsraW5jcmVtZW50aW5nTG9hZElkOwogICAgICAgICAgICAgICAgICAgICAgICByZXZhbGlkYXRpbmdGZXRjaGVycy5mb3JFYWNoKChfcmVmMykgPT4gewogICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBfcmVmMTUgPSBfc2xpY2VkVG9BcnJheTIoX3JlZjMsIDEpLGtleSA9IF9yZWYxNVswXTsKICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmV0Y2hDb250cm9sbGVycy5zZXQoa2V5LCBwZW5kaW5nTmF2aWdhdGlvbkNvbnRyb2xsZXIpOwogICAgICAgICAgICAgICAgICAgICAgICB9KTtfY29udGV4dDYubmV4dCA9IDEyO3JldHVybiAoCgoKCgogICAgICAgICAgICAgICAgICAgICAgICAgIGNhbGxMb2FkZXJzQW5kTWF5YmVSZXNvbHZlRGF0YShzdGF0ZS5tYXRjaGVzLCBtYXRjaGVzLCBtYXRjaGVzVG9Mb2FkLCByZXZhbGlkYXRpbmdGZXRjaGVycywgcmVxdWVzdCkpO2Nhc2UgMTI6X3lpZWxkJGNhbGxMb2FkZXJzQW5kID0gX2NvbnRleHQ2LnNlbnQ7cmVzdWx0cyA9IF95aWVsZCRjYWxsTG9hZGVyc0FuZC5yZXN1bHRzO2xvYWRlclJlc3VsdHMgPSBfeWllbGQkY2FsbExvYWRlcnNBbmQubG9hZGVyUmVzdWx0cztmZXRjaGVyUmVzdWx0cyA9IF95aWVsZCRjYWxsTG9hZGVyc0FuZC5mZXRjaGVyUmVzdWx0cztpZiAoIQoKICAgICAgICAgICAgICAgICAgICAgICAgcmVxdWVzdC5zaWduYWwuYWJvcnRlZCkge19jb250ZXh0Ni5uZXh0ID0gMTg7YnJlYWs7fXJldHVybiBfY29udGV4dDYuYWJydXB0KCJyZXR1cm4iLAogICAgICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgc2hvcnRDaXJjdWl0ZWQ6IHRydWUKICAgICAgICAgICAgICAgICAgICAgICAgfSk7Y2FzZSAxODoKICAgICAgICAgICAgICAgICAgICAgICAgLy8gQ2xlYW4gdXAgX2FmdGVyXyBsb2FkZXJzIGhhdmUgY29tcGxldGVkLiAgRG9uJ3QgY2xlYW4gdXAgaWYgd2Ugc2hvcnQKICAgICAgICAgICAgICAgICAgICAgICAgLy8gY2lyY3VpdGVkIGJlY2F1c2UgZmV0Y2hDb250cm9sbGVycyB3b3VsZCBoYXZlIGJlZW4gYWJvcnRlZCBhbmQKICAgICAgICAgICAgICAgICAgICAgICAgLy8gcmVhc3NpZ25lZCB0byBuZXcgY29udHJvbGxlcnMgZm9yIHRoZSBuZXh0IG5hdmlnYXRpb24KCgogICAgICAgICAgICAgICAgICAgICAgICByZXZhbGlkYXRpbmdGZXRjaGVycy5mb3JFYWNoKChfcmVmNCkgPT4gewogICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBfcmVmMTYgPSBfc2xpY2VkVG9BcnJheTIoX3JlZjQsIDEpLGtleSA9IF9yZWYxNlswXTsKICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmV0Y2hDb250cm9sbGVycy5kZWxldGUoa2V5KTsKICAgICAgICAgICAgICAgICAgICAgICAgfSk7IC8vIElmIGFueSBsb2FkZXJzIHJldHVybmVkIGEgcmVkaXJlY3QgUmVzcG9uc2UsIHN0YXJ0IGEgbmV3IFJFUExBQ0UgbmF2aWdhdGlvbgoKICAgICAgICAgICAgICAgICAgICAgICAgcmVkaXJlY3QgPSBmaW5kUmVkaXJlY3QocmVzdWx0cyk7aWYgKCEKCiAgICAgICAgICAgICAgICAgICAgICAgIHJlZGlyZWN0KSB7X2NvbnRleHQ2Lm5leHQgPSAyNDticmVhazt9X2NvbnRleHQ2Lm5leHQgPSAyMztyZXR1cm4gKAogICAgICAgICAgICAgICAgICAgICAgICAgIHN0YXJ0UmVkaXJlY3ROYXZpZ2F0aW9uKHN0YXRlLCByZWRpcmVjdCwgcmVwbGFjZSkpO2Nhc2UgMjM6cmV0dXJuIF9jb250ZXh0Ni5hYnJ1cHQoInJldHVybiIsCiAgICAgICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgICBzaG9ydENpcmN1aXRlZDogdHJ1ZQogICAgICAgICAgICAgICAgICAgICAgICB9KTtjYXNlIDI0OgogICAgICAgICAgICAgICAgICAgICAgICAvLyBQcm9jZXNzIGFuZCBjb21taXQgb3V0cHV0IGZyb20gbG9hZGVycwogICAgICAgICAgICAgICAgICAgICAgICBfcHJvY2Vzc0xvYWRlckRhdGEgPQoKCgoKICAgICAgICAgICAgICAgICAgICAgICAgcHJvY2Vzc0xvYWRlckRhdGEoc3RhdGUsIG1hdGNoZXMsIG1hdGNoZXNUb0xvYWQsIGxvYWRlclJlc3VsdHMsIHBlbmRpbmdFcnJvciwgcmV2YWxpZGF0aW5nRmV0Y2hlcnMsIGZldGNoZXJSZXN1bHRzLCBhY3RpdmVEZWZlcnJlZHMpLCBsb2FkZXJEYXRhID0gX3Byb2Nlc3NMb2FkZXJEYXRhLmxvYWRlckRhdGEsIGVycm9ycyA9IF9wcm9jZXNzTG9hZGVyRGF0YS5lcnJvcnM7IC8vIFdpcmUgdXAgc3Vic2NyaWJlcnMgdG8gdXBkYXRlIGxvYWRlckRhdGEgYXMgcHJvbWlzZXMgc2V0dGxlCgogICAgICAgICAgICAgICAgICAgICAgICBhY3RpdmVEZWZlcnJlZHMuZm9yRWFjaCgoZGVmZXJyZWREYXRhLCByb3V0ZUlkKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgZGVmZXJyZWREYXRhLnN1YnNjcmliZSgoYWJvcnRlZCkgPT4gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gTm90ZTogTm8gbmVlZCB0byB1cGRhdGVTdGF0ZSBoZXJlIHNpbmNlIHRoZSBUcmFja2VkUHJvbWlzZSBvbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gbG9hZGVyRGF0YSBpcyBzdGFibGUgYWNyb3NzIHJlc29sdmUvcmVqZWN0CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBSZW1vdmUgdGhpcyBpbnN0YW5jZSBpZiB3ZSB3ZXJlIGFib3J0ZWQgb3IgaWYgcHJvbWlzZXMgaGF2ZSBzZXR0bGVkCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoYWJvcnRlZCB8fCBkZWZlcnJlZERhdGEuZG9uZSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhY3RpdmVEZWZlcnJlZHMuZGVsZXRlKHJvdXRlSWQpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgbWFya0ZldGNoUmVkaXJlY3RzRG9uZSgpOwogICAgICAgICAgICAgICAgICAgICAgICBkaWRBYm9ydEZldGNoTG9hZHMgPSBhYm9ydFN0YWxlRmV0Y2hMb2FkcyhwZW5kaW5nTmF2aWdhdGlvbkxvYWRJZCk7cmV0dXJuIF9jb250ZXh0Ni5hYnJ1cHQoInJldHVybiIsCiAgICAgICAgICAgICAgICAgICAgICAgIF9leHRlbmRzKHsKICAgICAgICAgICAgICAgICAgICAgICAgICBsb2FkZXJEYXRhOiBsb2FkZXJEYXRhLAogICAgICAgICAgICAgICAgICAgICAgICAgIGVycm9yczogZXJyb3JzCiAgICAgICAgICAgICAgICAgICAgICAgIH0sIGRpZEFib3J0RmV0Y2hMb2FkcyB8fCByZXZhbGlkYXRpbmdGZXRjaGVycy5sZW5ndGggPiAwID8gewogICAgICAgICAgICAgICAgICAgICAgICAgIGZldGNoZXJzOiBuZXcgTWFwKHN0YXRlLmZldGNoZXJzKQogICAgICAgICAgICAgICAgICAgICAgICB9IDoge30pKTtjYXNlIDI5OmNhc2UgImVuZCI6cmV0dXJuIF9jb250ZXh0Ni5zdG9wKCk7fX19LCBfY2FsbGVlNik7fSkpO3JldHVybiBfaGFuZGxlTG9hZGVycy5hcHBseSh0aGlzLCBhcmd1bWVudHMpO30KCgogICAgICAgICAgICBmdW5jdGlvbiBnZXRGZXRjaGVyKGtleSkgewogICAgICAgICAgICAgIHJldHVybiBzdGF0ZS5mZXRjaGVycy5nZXQoa2V5KSB8fCBJRExFX0ZFVENIRVI7CiAgICAgICAgICAgIH0gLy8gVHJpZ2dlciBhIGZldGNoZXIgbG9hZC9zdWJtaXQgZm9yIHRoZSBnaXZlbiBmZXRjaGVyIGtleQoKCiAgICAgICAgICAgIGZ1bmN0aW9uIGZldGNoKGtleSwgcm91dGVJZCwgaHJlZiwgb3B0cykgewogICAgICAgICAgICAgIGlmIChpc1NlcnZlcikgewogICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJyb3V0ZXIuZmV0Y2goKSB3YXMgY2FsbGVkIGR1cmluZyB0aGUgc2VydmVyIHJlbmRlciwgYnV0IGl0IHNob3VsZG4ndCBiZS4gIiArICJZb3UgYXJlIGxpa2VseSBjYWxsaW5nIGEgdXNlRmV0Y2hlcigpIG1ldGhvZCBpbiB0aGUgYm9keSBvZiB5b3VyIGNvbXBvbmVudC4gIiArICJUcnkgbW92aW5nIGl0IHRvIGEgdXNlRWZmZWN0IG9yIGEgY2FsbGJhY2suIik7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBpZiAoZmV0Y2hDb250cm9sbGVycy5oYXMoa2V5KSkgYWJvcnRGZXRjaGVyKGtleSk7CiAgICAgICAgICAgICAgdmFyIG1hdGNoZXMgPSBtYXRjaFJvdXRlcyhkYXRhUm91dGVzLCBocmVmLCBpbml0LmJhc2VuYW1lKTsKCiAgICAgICAgICAgICAgaWYgKCFtYXRjaGVzKSB7CiAgICAgICAgICAgICAgICBzZXRGZXRjaGVyRXJyb3Ioa2V5LCByb3V0ZUlkLCBnZXRJbnRlcm5hbFJvdXRlckVycm9yKDQwNCwgewogICAgICAgICAgICAgICAgICBwYXRobmFtZTogaHJlZgogICAgICAgICAgICAgICAgfSkpOwogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgdmFyIF9ub3JtYWxpemVOYXZpZ2F0ZU9wdCA9CgoKICAgICAgICAgICAgICAgIG5vcm1hbGl6ZU5hdmlnYXRlT3B0aW9ucyhocmVmLCBvcHRzLCB0cnVlKSxwYXRoID0gX25vcm1hbGl6ZU5hdmlnYXRlT3B0LnBhdGgsc3VibWlzc2lvbiA9IF9ub3JtYWxpemVOYXZpZ2F0ZU9wdC5zdWJtaXNzaW9uOwogICAgICAgICAgICAgIHZhciBtYXRjaCA9IGdldFRhcmdldE1hdGNoKG1hdGNoZXMsIHBhdGgpOwoKICAgICAgICAgICAgICBpZiAoc3VibWlzc2lvbikgewogICAgICAgICAgICAgICAgaGFuZGxlRmV0Y2hlckFjdGlvbihrZXksIHJvdXRlSWQsIHBhdGgsIG1hdGNoLCBtYXRjaGVzLCBzdWJtaXNzaW9uKTsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICB9IC8vIFN0b3JlIG9mZiB0aGUgbWF0Y2ggc28gd2UgY2FuIGNhbGwgaXQncyBzaG91bGRSZXZhbGlkYXRlIG9uIHN1YnNlcXVlbnQKICAgICAgICAgICAgICAvLyByZXZhbGlkYXRpb25zCgoKICAgICAgICAgICAgICBmZXRjaExvYWRNYXRjaGVzLnNldChrZXksIFtwYXRoLCBtYXRjaCwgbWF0Y2hlc10pOwogICAgICAgICAgICAgIGhhbmRsZUZldGNoZXJMb2FkZXIoa2V5LCByb3V0ZUlkLCBwYXRoLCBtYXRjaCwgbWF0Y2hlcyk7CiAgICAgICAgICAgIH0gLy8gQ2FsbCB0aGUgYWN0aW9uIGZvciB0aGUgbWF0Y2hlZCBmZXRjaGVyLnN1Ym1pdCgpLCBhbmQgdGhlbiBoYW5kbGUgcmVkaXJlY3RzLAogICAgICAgICAgICAvLyBlcnJvcnMsIGFuZCByZXZhbGlkYXRpb24KICAgICAgICAgICAgZnVuY3Rpb24KCiAgICAgICAgICAgIGhhbmRsZUZldGNoZXJBY3Rpb24oX3gyMiwgX3gyMywgX3gyNCwgX3gyNSwgX3gyNiwgX3gyNykge3JldHVybiBfaGFuZGxlRmV0Y2hlckFjdGlvbi5hcHBseSh0aGlzLCBhcmd1bWVudHMpO30KCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCiAgICAgICAgICAgIC8vIENhbGwgdGhlIG1hdGNoZWQgbG9hZGVyIGZvciBmZXRjaGVyLmxvYWQoKSwgaGFuZGxpbmcgcmVkaXJlY3RzLCBlcnJvcnMsIGV0Yy4KICAgICAgICAgICAgZnVuY3Rpb24gX2hhbmRsZUZldGNoZXJBY3Rpb24oKSB7X2hhbmRsZUZldGNoZXJBY3Rpb24gPSBfYXN5bmNUb0dlbmVyYXRvcjIoIC8qI19fUFVSRV9fKi9fcmVnZW5lcmF0b3JSdW50aW1lMigpLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTcoa2V5LCByb3V0ZUlkLCBwYXRoLCBtYXRjaCwgcmVxdWVzdE1hdGNoZXMsIHN1Ym1pc3Npb24pIHt2YXIgX2Vycm9yMiwgZXhpc3RpbmdGZXRjaGVyLCBmZXRjaGVyLCBhYm9ydENvbnRyb2xsZXIsIGZldGNoUmVxdWVzdCwgYWN0aW9uUmVzdWx0LCBsb2FkaW5nRmV0Y2hlciwgbmV4dExvY2F0aW9uLCByZXZhbGlkYXRpb25SZXF1ZXN0LCBtYXRjaGVzLCBsb2FkSWQsIGxvYWRGZXRjaGVyLCBfZ2V0TWF0Y2hlc1RvTG9hZDMsIF9nZXRNYXRjaGVzVG9Mb2FkNCwgbWF0Y2hlc1RvTG9hZCwgcmV2YWxpZGF0aW5nRmV0Y2hlcnMsIF95aWVsZCRjYWxsTG9hZGVyc0FuZDIsIHJlc3VsdHMsIGxvYWRlclJlc3VsdHMsIGZldGNoZXJSZXN1bHRzLCByZWRpcmVjdCwgX3Byb2Nlc3NMb2FkZXJEYXRhMiwgbG9hZGVyRGF0YSwgZXJyb3JzLCBkb25lRmV0Y2hlciwgZGlkQWJvcnRGZXRjaExvYWRzO3JldHVybiBfcmVnZW5lcmF0b3JSdW50aW1lMigpLndyYXAoZnVuY3Rpb24gX2NhbGxlZTckKF9jb250ZXh0Nykge3doaWxlICgxKSB7c3dpdGNoIChfY29udGV4dDcucHJldiA9IF9jb250ZXh0Ny5uZXh0KSB7Y2FzZSAwOmludGVycnVwdEFjdGl2ZUxvYWRzKCk7ZmV0Y2hMb2FkTWF0Y2hlcy5kZWxldGUoa2V5KTtpZiAobWF0Y2gucm91dGUuYWN0aW9uKSB7X2NvbnRleHQ3Lm5leHQgPSA2O2JyZWFrO31fZXJyb3IyID0gZ2V0SW50ZXJuYWxSb3V0ZXJFcnJvcig0MDUsIHsgbWV0aG9kOiBzdWJtaXNzaW9uLmZvcm1NZXRob2QsIHBhdGhuYW1lOiBwYXRoLCByb3V0ZUlkOiByb3V0ZUlkIH0pO3NldEZldGNoZXJFcnJvcihrZXksIHJvdXRlSWQsIF9lcnJvcjIpO3JldHVybiBfY29udGV4dDcuYWJydXB0KCJyZXR1cm4iKTtjYXNlIDY6IC8vIFB1dCB0aGlzIGZldGNoZXIgaW50byBpdCdzIHN1Ym1pdHRpbmcgc3RhdGUKICAgICAgICAgICAgICAgICAgICAgICAgZXhpc3RpbmdGZXRjaGVyID0gc3RhdGUuZmV0Y2hlcnMuZ2V0KGtleSk7ZmV0Y2hlciA9IF9leHRlbmRzKHsgc3RhdGU6ICJzdWJtaXR0aW5nIiB9LCBzdWJtaXNzaW9uLCB7IGRhdGE6IGV4aXN0aW5nRmV0Y2hlciAmJiBleGlzdGluZ0ZldGNoZXIuZGF0YSB9KTtzdGF0ZS5mZXRjaGVycy5zZXQoa2V5LCBmZXRjaGVyKTt1cGRhdGVTdGF0ZSh7IGZldGNoZXJzOiBuZXcgTWFwKHN0YXRlLmZldGNoZXJzKSB9KTsgLy8gQ2FsbCB0aGUgYWN0aW9uIGZvciB0aGUgZmV0Y2hlcgogICAgICAgICAgICAgICAgICAgICAgICBhYm9ydENvbnRyb2xsZXIgPSBuZXcgQWJvcnRDb250cm9sbGVyKCk7ZmV0Y2hSZXF1ZXN0ID0gY3JlYXRlUmVxdWVzdChwYXRoLCBhYm9ydENvbnRyb2xsZXIuc2lnbmFsLCBzdWJtaXNzaW9uKTtmZXRjaENvbnRyb2xsZXJzLnNldChrZXksIGFib3J0Q29udHJvbGxlcik7X2NvbnRleHQ3Lm5leHQgPSAxNTtyZXR1cm4gY2FsbExvYWRlck9yQWN0aW9uKCJhY3Rpb24iLCBmZXRjaFJlcXVlc3QsIG1hdGNoLCByZXF1ZXN0TWF0Y2hlcywgcm91dGVyLmJhc2VuYW1lKTtjYXNlIDE1OmFjdGlvblJlc3VsdCA9IF9jb250ZXh0Ny5zZW50O2lmICghZmV0Y2hSZXF1ZXN0LnNpZ25hbC5hYm9ydGVkKSB7X2NvbnRleHQ3Lm5leHQgPSAxOTticmVhazt9IC8vIFdlIGNhbiBkZWxldGUgdGhpcyBzbyBsb25nIGFzIHdlIHdlcmVuJ3QgYWJvcnRlZCBieSBvdSBvdXIgb3duIGZldGNoZXIKICAgICAgICAgICAgICAgICAgICAgICAgLy8gcmUtc3VibWl0IHdoaWNoIHdvdWxkIGhhdmUgcHV0IF9uZXdfIGNvbnRyb2xsZXIgaXMgaW4gZmV0Y2hDb250cm9sbGVycwogICAgICAgICAgICAgICAgICAgICAgICBpZiAoZmV0Y2hDb250cm9sbGVycy5nZXQoa2V5KSA9PT0gYWJvcnRDb250cm9sbGVyKSB7ZmV0Y2hDb250cm9sbGVycy5kZWxldGUoa2V5KTt9cmV0dXJuIF9jb250ZXh0Ny5hYnJ1cHQoInJldHVybiIpO2Nhc2UgMTk6aWYgKCFpc1JlZGlyZWN0UmVzdWx0KGFjdGlvblJlc3VsdCkpIHtfY29udGV4dDcubmV4dCA9IDI2O2JyZWFrO31mZXRjaENvbnRyb2xsZXJzLmRlbGV0ZShrZXkpO2ZldGNoUmVkaXJlY3RJZHMuYWRkKGtleSk7bG9hZGluZ0ZldGNoZXIgPSBfZXh0ZW5kcyh7IHN0YXRlOiAibG9hZGluZyIgfSwgc3VibWlzc2lvbiwgeyBkYXRhOiB1bmRlZmluZWQgfSk7c3RhdGUuZmV0Y2hlcnMuc2V0KGtleSwgbG9hZGluZ0ZldGNoZXIpO3VwZGF0ZVN0YXRlKHsgZmV0Y2hlcnM6IG5ldyBNYXAoc3RhdGUuZmV0Y2hlcnMpIH0pO3JldHVybiBfY29udGV4dDcuYWJydXB0KCJyZXR1cm4iLCBzdGFydFJlZGlyZWN0TmF2aWdhdGlvbihzdGF0ZSwgYWN0aW9uUmVzdWx0KSk7Y2FzZSAyNjppZiAoIWlzRXJyb3JSZXN1bHQoYWN0aW9uUmVzdWx0KSkge19jb250ZXh0Ny5uZXh0ID0gMjk7YnJlYWs7fXNldEZldGNoZXJFcnJvcihrZXksIHJvdXRlSWQsIGFjdGlvblJlc3VsdC5lcnJvcik7cmV0dXJuIF9jb250ZXh0Ny5hYnJ1cHQoInJldHVybiIpO2Nhc2UgMjk6aWYgKGlzRGVmZXJyZWRSZXN1bHQoYWN0aW9uUmVzdWx0KSkge3JvdXRlcl9pbnZhcmlhbnQoZmFsc2UsICJkZWZlcigpIGlzIG5vdCBzdXBwb3J0ZWQgaW4gYWN0aW9ucyIpO30gLy8gU3RhcnQgdGhlIGRhdGEgbG9hZCBmb3IgY3VycmVudCBtYXRjaGVzLCBvciB0aGUgbmV4dCBsb2NhdGlvbiBpZiB3ZSdyZQogICAgICAgICAgICAgICAgICAgICAgICAvLyBpbiB0aGUgbWlkZGxlIG9mIGEgbmF2aWdhdGlvbgogICAgICAgICAgICAgICAgICAgICAgICBuZXh0TG9jYXRpb24gPSBzdGF0ZS5uYXZpZ2F0aW9uLmxvY2F0aW9uIHx8IHN0YXRlLmxvY2F0aW9uO3JldmFsaWRhdGlvblJlcXVlc3QgPSBjcmVhdGVSZXF1ZXN0KG5leHRMb2NhdGlvbiwgYWJvcnRDb250cm9sbGVyLnNpZ25hbCk7bWF0Y2hlcyA9IHN0YXRlLm5hdmlnYXRpb24uc3RhdGUgIT09ICJpZGxlIiA/IG1hdGNoUm91dGVzKGRhdGFSb3V0ZXMsIHN0YXRlLm5hdmlnYXRpb24ubG9jYXRpb24sIGluaXQuYmFzZW5hbWUpIDogc3RhdGUubWF0Y2hlcztyb3V0ZXJfaW52YXJpYW50KG1hdGNoZXMsICJEaWRuJ3QgZmluZCBhbnkgbWF0Y2hlcyBhZnRlciBmZXRjaGVyIGFjdGlvbiIpO2xvYWRJZCA9ICsraW5jcmVtZW50aW5nTG9hZElkO2ZldGNoUmVsb2FkSWRzLnNldChrZXksIGxvYWRJZCk7bG9hZEZldGNoZXIgPSBfZXh0ZW5kcyh7IHN0YXRlOiAibG9hZGluZyIsIGRhdGE6IGFjdGlvblJlc3VsdC5kYXRhIH0sIHN1Ym1pc3Npb24pO3N0YXRlLmZldGNoZXJzLnNldChrZXksIGxvYWRGZXRjaGVyKTtfZ2V0TWF0Y2hlc1RvTG9hZDMgPSBnZXRNYXRjaGVzVG9Mb2FkKHN0YXRlLCBtYXRjaGVzLCBzdWJtaXNzaW9uLCBuZXh0TG9jYXRpb24sIGlzUmV2YWxpZGF0aW9uUmVxdWlyZWQsIGNhbmNlbGxlZERlZmVycmVkUm91dGVzLCBjYW5jZWxsZWRGZXRjaGVyTG9hZHMsIF9kZWZpbmVQcm9wZXJ0eTIoe30sIG1hdGNoLnJvdXRlLmlkLCBhY3Rpb25SZXN1bHQuZGF0YSksIHVuZGVmaW5lZCwgLy8gTm8gbmVlZCB0byBzZW5kIHRocm91Z2ggZXJyb3JzIHNpbmNlIHdlIHNob3J0IGNpcmN1aXQgYWJvdmUKICAgICAgICAgICAgICAgICAgICAgICAgZmV0Y2hMb2FkTWF0Y2hlcyksIF9nZXRNYXRjaGVzVG9Mb2FkNCA9IF9zbGljZWRUb0FycmF5MihfZ2V0TWF0Y2hlc1RvTG9hZDMsIDIpLCBtYXRjaGVzVG9Mb2FkID0gX2dldE1hdGNoZXNUb0xvYWQ0WzBdLCByZXZhbGlkYXRpbmdGZXRjaGVycyA9IF9nZXRNYXRjaGVzVG9Mb2FkNFsxXTsgLy8gUHV0IGFsbCByZXZhbGlkYXRpbmcgZmV0Y2hlcnMgaW50byB0aGUgbG9hZGluZyBzdGF0ZSwgZXhjZXB0IGZvciB0aGUKICAgICAgICAgICAgICAgICAgICAgICAgLy8gY3VycmVudCBmZXRjaGVyIHdoaWNoIHdlIHdhbnQgdG8ga2VlcCBpbiBpdCdzIGN1cnJlbnQgbG9hZGluZyBzdGF0ZSB3aGljaAogICAgICAgICAgICAgICAgICAgICAgICAvLyBjb250YWlucyBpdCdzIGFjdGlvbiBzdWJtaXNzaW9uIGluZm8gKyBhY3Rpb24gZGF0YQogICAgICAgICAgICAgICAgICAgICAgICByZXZhbGlkYXRpbmdGZXRjaGVycy5maWx0ZXIoKF9yZWY1KSA9PiB7dmFyIF9yZWYxNyA9IF9zbGljZWRUb0FycmF5MihfcmVmNSwgMSksc3RhbGVLZXkgPSBfcmVmMTdbMF07cmV0dXJuIHN0YWxlS2V5ICE9PSBrZXk7fSkuZm9yRWFjaCgoX3JlZjYpID0+IHt2YXIgX3JlZjE4ID0gX3NsaWNlZFRvQXJyYXkyKF9yZWY2LCAxKSxzdGFsZUtleSA9IF9yZWYxOFswXTt2YXIgZXhpc3RpbmdGZXRjaGVyID0gc3RhdGUuZmV0Y2hlcnMuZ2V0KHN0YWxlS2V5KTt2YXIgcmV2YWxpZGF0aW5nRmV0Y2hlciA9IHsgc3RhdGU6ICJsb2FkaW5nIiwgZGF0YTogZXhpc3RpbmdGZXRjaGVyICYmIGV4aXN0aW5nRmV0Y2hlci5kYXRhLCBmb3JtTWV0aG9kOiB1bmRlZmluZWQsIGZvcm1BY3Rpb246IHVuZGVmaW5lZCwgZm9ybUVuY1R5cGU6IHVuZGVmaW5lZCwgZm9ybURhdGE6IHVuZGVmaW5lZCB9O3N0YXRlLmZldGNoZXJzLnNldChzdGFsZUtleSwgcmV2YWxpZGF0aW5nRmV0Y2hlcik7ZmV0Y2hDb250cm9sbGVycy5zZXQoc3RhbGVLZXksIGFib3J0Q29udHJvbGxlcik7fSk7dXBkYXRlU3RhdGUoeyBmZXRjaGVyczogbmV3IE1hcChzdGF0ZS5mZXRjaGVycykgfSk7X2NvbnRleHQ3Lm5leHQgPSA0MztyZXR1cm4gY2FsbExvYWRlcnNBbmRNYXliZVJlc29sdmVEYXRhKHN0YXRlLm1hdGNoZXMsIG1hdGNoZXMsIG1hdGNoZXNUb0xvYWQsIHJldmFsaWRhdGluZ0ZldGNoZXJzLCByZXZhbGlkYXRpb25SZXF1ZXN0KTtjYXNlIDQzOl95aWVsZCRjYWxsTG9hZGVyc0FuZDIgPSBfY29udGV4dDcuc2VudDtyZXN1bHRzID0gX3lpZWxkJGNhbGxMb2FkZXJzQW5kMi5yZXN1bHRzO2xvYWRlclJlc3VsdHMgPSBfeWllbGQkY2FsbExvYWRlcnNBbmQyLmxvYWRlclJlc3VsdHM7ZmV0Y2hlclJlc3VsdHMgPSBfeWllbGQkY2FsbExvYWRlcnNBbmQyLmZldGNoZXJSZXN1bHRzO2lmICghYWJvcnRDb250cm9sbGVyLnNpZ25hbC5hYm9ydGVkKSB7X2NvbnRleHQ3Lm5leHQgPSA0OTticmVhazt9cmV0dXJuIF9jb250ZXh0Ny5hYnJ1cHQoInJldHVybiIpO2Nhc2UgNDk6ZmV0Y2hSZWxvYWRJZHMuZGVsZXRlKGtleSk7ZmV0Y2hDb250cm9sbGVycy5kZWxldGUoa2V5KTtyZXZhbGlkYXRpbmdGZXRjaGVycy5mb3JFYWNoKChfcmVmNykgPT4ge3ZhciBfcmVmMTkgPSBfc2xpY2VkVG9BcnJheTIoX3JlZjcsIDEpLHN0YWxlS2V5ID0gX3JlZjE5WzBdO3JldHVybiBmZXRjaENvbnRyb2xsZXJzLmRlbGV0ZShzdGFsZUtleSk7fSk7cmVkaXJlY3QgPSBmaW5kUmVkaXJlY3QocmVzdWx0cyk7aWYgKCFyZWRpcmVjdCkge19jb250ZXh0Ny5uZXh0ID0gNTU7YnJlYWs7fXJldHVybiBfY29udGV4dDcuYWJydXB0KCJyZXR1cm4iLCBzdGFydFJlZGlyZWN0TmF2aWdhdGlvbihzdGF0ZSwgcmVkaXJlY3QpKTtjYXNlIDU1OiAvLyBQcm9jZXNzIGFuZCBjb21taXQgb3V0cHV0IGZyb20gbG9hZGVycwogICAgICAgICAgICAgICAgICAgICAgICBfcHJvY2Vzc0xvYWRlckRhdGEyID0gcHJvY2Vzc0xvYWRlckRhdGEoc3RhdGUsIHN0YXRlLm1hdGNoZXMsIG1hdGNoZXNUb0xvYWQsIGxvYWRlclJlc3VsdHMsIHVuZGVmaW5lZCwgcmV2YWxpZGF0aW5nRmV0Y2hlcnMsIGZldGNoZXJSZXN1bHRzLCBhY3RpdmVEZWZlcnJlZHMpLCBsb2FkZXJEYXRhID0gX3Byb2Nlc3NMb2FkZXJEYXRhMi5sb2FkZXJEYXRhLCBlcnJvcnMgPSBfcHJvY2Vzc0xvYWRlckRhdGEyLmVycm9ycztkb25lRmV0Y2hlciA9IHsgc3RhdGU6ICJpZGxlIiwgZGF0YTogYWN0aW9uUmVzdWx0LmRhdGEsIGZvcm1NZXRob2Q6IHVuZGVmaW5lZCwgZm9ybUFjdGlvbjogdW5kZWZpbmVkLCBmb3JtRW5jVHlwZTogdW5kZWZpbmVkLCBmb3JtRGF0YTogdW5kZWZpbmVkIH07c3RhdGUuZmV0Y2hlcnMuc2V0KGtleSwgZG9uZUZldGNoZXIpO2RpZEFib3J0RmV0Y2hMb2FkcyA9IGFib3J0U3RhbGVGZXRjaExvYWRzKGxvYWRJZCk7IC8vIElmIHdlIGFyZSBjdXJyZW50bHkgaW4gYSBuYXZpZ2F0aW9uIGxvYWRpbmcgc3RhdGUgYW5kIHRoaXMgZmV0Y2hlciBpcwogICAgICAgICAgICAgICAgICAgICAgICAvLyBtb3JlIHJlY2VudCB0aGFuIHRoZSBuYXZpZ2F0aW9uLCB3ZSB3YW50IHRoZSBuZXdlciBkYXRhIHNvIGFib3J0IHRoZQogICAgICAgICAgICAgICAgICAgICAgICAvLyBuYXZpZ2F0aW9uIGFuZCBjb21wbGV0ZSBpdCB3aXRoIHRoZSBmZXRjaGVyIGRhdGEKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHN0YXRlLm5hdmlnYXRpb24uc3RhdGUgPT09ICJsb2FkaW5nIiAmJiBsb2FkSWQgPiBwZW5kaW5nTmF2aWdhdGlvbkxvYWRJZCkge3JvdXRlcl9pbnZhcmlhbnQocGVuZGluZ0FjdGlvbiwgIkV4cGVjdGVkIHBlbmRpbmcgYWN0aW9uIik7cGVuZGluZ05hdmlnYXRpb25Db250cm9sbGVyICYmIHBlbmRpbmdOYXZpZ2F0aW9uQ29udHJvbGxlci5hYm9ydCgpO2NvbXBsZXRlTmF2aWdhdGlvbihzdGF0ZS5uYXZpZ2F0aW9uLmxvY2F0aW9uLCB7IG1hdGNoZXM6IG1hdGNoZXMsIGxvYWRlckRhdGE6IGxvYWRlckRhdGEsIGVycm9yczogZXJyb3JzLCBmZXRjaGVyczogbmV3IE1hcChzdGF0ZS5mZXRjaGVycykgfSk7fSBlbHNlIHsvLyBvdGhlcndpc2UganVzdCB1cGRhdGUgd2l0aCB0aGUgZmV0Y2hlciBkYXRhLCBwcmVzZXJ2aW5nIGFueSBleGlzdGluZwogICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGxvYWRlckRhdGEgZm9yIGxvYWRlcnMgdGhhdCBkaWQgbm90IG5lZWQgdG8gcmVsb2FkLiAgV2UgaGF2ZSB0bwogICAgICAgICAgICAgICAgICAgICAgICAgIC8vIG1hbnVhbGx5IG1lcmdlIGhlcmUgc2luY2Ugd2UgYXJlbid0IGdvaW5nIHRocm91Z2ggY29tcGxldGVOYXZpZ2F0aW9uCiAgICAgICAgICAgICAgICAgICAgICAgICAgdXBkYXRlU3RhdGUoX2V4dGVuZHMoeyBlcnJvcnM6IGVycm9ycywgbG9hZGVyRGF0YTogbWVyZ2VMb2FkZXJEYXRhKHN0YXRlLmxvYWRlckRhdGEsIGxvYWRlckRhdGEsIG1hdGNoZXMpIH0sIGRpZEFib3J0RmV0Y2hMb2FkcyA/IHsgZmV0Y2hlcnM6IG5ldyBNYXAoc3RhdGUuZmV0Y2hlcnMpIH0gOiB7fSkpO2lzUmV2YWxpZGF0aW9uUmVxdWlyZWQgPSBmYWxzZTt9Y2FzZSA2MDpjYXNlICJlbmQiOnJldHVybiBfY29udGV4dDcuc3RvcCgpO319fSwgX2NhbGxlZTcpO30pKTtyZXR1cm4gX2hhbmRsZUZldGNoZXJBY3Rpb24uYXBwbHkodGhpcywgYXJndW1lbnRzKTt9ZnVuY3Rpb24gaGFuZGxlRmV0Y2hlckxvYWRlcihfeDI4LCBfeDI5LCBfeDMwLCBfeDMxLCBfeDMyKSB7cmV0dXJuIF9oYW5kbGVGZXRjaGVyTG9hZGVyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7fQoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCiAgICAgICAgICAgIC8qKgogICAgICAgICAgICAgKiBVdGlsaXR5IGZ1bmN0aW9uIHRvIGhhbmRsZSByZWRpcmVjdHMgcmV0dXJuZWQgZnJvbSBhbiBhY3Rpb24gb3IgbG9hZGVyLgogICAgICAgICAgICAgKiBOb3JtYWxseSwgYSByZWRpcmVjdCAicmVwbGFjZXMiIHRoZSBuYXZpZ2F0aW9uIHRoYXQgdHJpZ2dlcmVkIGl0LiAgU28sIGZvcgogICAgICAgICAgICAgKiBleGFtcGxlOgogICAgICAgICAgICAgKgogICAgICAgICAgICAgKiAgLSB1c2VyIGlzIG9uIC9hCiAgICAgICAgICAgICAqICAtIHVzZXIgY2xpY2tzIGEgbGluayB0byAvYgogICAgICAgICAgICAgKiAgLSBsb2FkZXIgZm9yIC9iIHJlZGlyZWN0cyB0byAvYwogICAgICAgICAgICAgKgogICAgICAgICAgICAgKiBJbiBhIG5vbi1KUyBhcHAgdGhlIGJyb3dzZXIgd291bGQgdHJhY2sgdGhlIGluLWZsaWdodCBuYXZpZ2F0aW9uIHRvIC9iIGFuZAogICAgICAgICAgICAgKiB0aGVuIHJlcGxhY2UgaXQgd2l0aCAvYyB3aGVuIGl0IGVuY291bnRlcmVkIHRoZSByZWRpcmVjdCByZXNwb25zZS4gIEluCiAgICAgICAgICAgICAqIHRoZSBlbmQgaXQgd291bGQgb25seSBldmVyIHVwZGF0ZSB0aGUgVVJMIGJhciB3aXRoIC9jLgogICAgICAgICAgICAgKgogICAgICAgICAgICAgKiBJbiBjbGllbnQtc2lkZSByb3V0aW5nIHVzaW5nIHB1c2hTdGF0ZS9yZXBsYWNlU3RhdGUsIHdlIGFpbSB0byBlbXVsYXRlCiAgICAgICAgICAgICAqIHRoaXMgYmVoYXZpb3IgYW5kIHdlIGFsc28gZG8gbm90IHVwZGF0ZSBoaXN0b3J5IHVudGlsIHRoZSBlbmQgb2YgdGhlCiAgICAgICAgICAgICAqIG5hdmlnYXRpb24gKGluY2x1ZGluZyBwcm9jZXNzZWQgcmVkaXJlY3RzKS4gIFRoaXMgbWVhbnMgdGhhdCB3ZSBuZXZlcgogICAgICAgICAgICAgKiBhY3R1YWxseSB0b3VjaCBoaXN0b3J5IHVudGlsIHdlJ3ZlIHByb2Nlc3NlZCByZWRpcmVjdHMsIHNvIHdlIGp1c3QgdXNlCiAgICAgICAgICAgICAqIHRoZSBoaXN0b3J5IGFjdGlvbiBmcm9tIHRoZSBvcmlnaW5hbCBuYXZpZ2F0aW9uIChQVVNIIG9yIFJFUExBQ0UpLgogICAgICAgICAgICAgKi9mdW5jdGlvbiBfaGFuZGxlRmV0Y2hlckxvYWRlcigpIHtfaGFuZGxlRmV0Y2hlckxvYWRlciA9IF9hc3luY1RvR2VuZXJhdG9yMiggLyojX19QVVJFX18qL19yZWdlbmVyYXRvclJ1bnRpbWUyKCkubWFyayhmdW5jdGlvbiBfY2FsbGVlOChrZXksIHJvdXRlSWQsIHBhdGgsIG1hdGNoLCBtYXRjaGVzKSB7dmFyIGV4aXN0aW5nRmV0Y2hlciwgbG9hZGluZ0ZldGNoZXIsIGFib3J0Q29udHJvbGxlciwgZmV0Y2hSZXF1ZXN0LCByZXN1bHQsIGJvdW5kYXJ5TWF0Y2gsIGRvbmVGZXRjaGVyO3JldHVybiBfcmVnZW5lcmF0b3JSdW50aW1lMigpLndyYXAoZnVuY3Rpb24gX2NhbGxlZTgkKF9jb250ZXh0OCkge3doaWxlICgxKSB7c3dpdGNoIChfY29udGV4dDgucHJldiA9IF9jb250ZXh0OC5uZXh0KSB7Y2FzZSAwOmV4aXN0aW5nRmV0Y2hlciA9IHN0YXRlLmZldGNoZXJzLmdldChrZXkpOyAvLyBQdXQgdGhpcyBmZXRjaGVyIGludG8gaXQncyBsb2FkaW5nIHN0YXRlCiAgICAgICAgICAgICAgICAgICAgICAgIGxvYWRpbmdGZXRjaGVyID0geyBzdGF0ZTogImxvYWRpbmciLCBmb3JtTWV0aG9kOiB1bmRlZmluZWQsIGZvcm1BY3Rpb246IHVuZGVmaW5lZCwgZm9ybUVuY1R5cGU6IHVuZGVmaW5lZCwgZm9ybURhdGE6IHVuZGVmaW5lZCwgZGF0YTogZXhpc3RpbmdGZXRjaGVyICYmIGV4aXN0aW5nRmV0Y2hlci5kYXRhIH07c3RhdGUuZmV0Y2hlcnMuc2V0KGtleSwgbG9hZGluZ0ZldGNoZXIpO3VwZGF0ZVN0YXRlKHsgZmV0Y2hlcnM6IG5ldyBNYXAoc3RhdGUuZmV0Y2hlcnMpIH0pOyAvLyBDYWxsIHRoZSBsb2FkZXIgZm9yIHRoaXMgZmV0Y2hlciByb3V0ZSBtYXRjaAogICAgICAgICAgICAgICAgICAgICAgICBhYm9ydENvbnRyb2xsZXIgPSBuZXcgQWJvcnRDb250cm9sbGVyKCk7ZmV0Y2hSZXF1ZXN0ID0gY3JlYXRlUmVxdWVzdChwYXRoLCBhYm9ydENvbnRyb2xsZXIuc2lnbmFsKTtmZXRjaENvbnRyb2xsZXJzLnNldChrZXksIGFib3J0Q29udHJvbGxlcik7X2NvbnRleHQ4Lm5leHQgPSA5O3JldHVybiBjYWxsTG9hZGVyT3JBY3Rpb24oImxvYWRlciIsIGZldGNoUmVxdWVzdCwgbWF0Y2gsIG1hdGNoZXMsIHJvdXRlci5iYXNlbmFtZSk7Y2FzZSA5OnJlc3VsdCA9IF9jb250ZXh0OC5zZW50O2lmICghaXNEZWZlcnJlZFJlc3VsdChyZXN1bHQpKSB7X2NvbnRleHQ4Lm5leHQgPSAxNzticmVhazt9X2NvbnRleHQ4Lm5leHQgPSAxMztyZXR1cm4gcmVzb2x2ZURlZmVycmVkRGF0YShyZXN1bHQsIGZldGNoUmVxdWVzdC5zaWduYWwsIHRydWUpO2Nhc2UgMTM6X2NvbnRleHQ4LnQwID0gX2NvbnRleHQ4LnNlbnQ7aWYgKF9jb250ZXh0OC50MCkge19jb250ZXh0OC5uZXh0ID0gMTY7YnJlYWs7fV9jb250ZXh0OC50MCA9IHJlc3VsdDtjYXNlIDE2OnJlc3VsdCA9IF9jb250ZXh0OC50MDtjYXNlIDE3OiAvLyBXZSBjYW4gZGVsZXRlIHRoaXMgc28gbG9uZyBhcyB3ZSB3ZXJlbid0IGFib3J0ZWQgYnkgb3Ugb3VyIG93biBmZXRjaGVyCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIHJlLWxvYWQgd2hpY2ggd291bGQgaGF2ZSBwdXQgX25ld18gY29udHJvbGxlciBpcyBpbiBmZXRjaENvbnRyb2xsZXJzCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChmZXRjaENvbnRyb2xsZXJzLmdldChrZXkpID09PSBhYm9ydENvbnRyb2xsZXIpIHtmZXRjaENvbnRyb2xsZXJzLmRlbGV0ZShrZXkpO31pZiAoIWZldGNoUmVxdWVzdC5zaWduYWwuYWJvcnRlZCkge19jb250ZXh0OC5uZXh0ID0gMjA7YnJlYWs7fXJldHVybiBfY29udGV4dDguYWJydXB0KCJyZXR1cm4iKTtjYXNlIDIwOmlmICghaXNSZWRpcmVjdFJlc3VsdChyZXN1bHQpKSB7X2NvbnRleHQ4Lm5leHQgPSAyNDticmVhazt9X2NvbnRleHQ4Lm5leHQgPSAyMztyZXR1cm4gc3RhcnRSZWRpcmVjdE5hdmlnYXRpb24oc3RhdGUsIHJlc3VsdCk7Y2FzZSAyMzpyZXR1cm4gX2NvbnRleHQ4LmFicnVwdCgicmV0dXJuIik7Y2FzZSAyNDppZiAoIWlzRXJyb3JSZXN1bHQocmVzdWx0KSkge19jb250ZXh0OC5uZXh0ID0gMjk7YnJlYWs7fWJvdW5kYXJ5TWF0Y2ggPSBmaW5kTmVhcmVzdEJvdW5kYXJ5KHN0YXRlLm1hdGNoZXMsIHJvdXRlSWQpO3N0YXRlLmZldGNoZXJzLmRlbGV0ZShrZXkpOyAvLyBUT0RPOiBJbiByZW1peCwgdGhpcyB3b3VsZCByZXNldCB0byBJRExFX05BVklHQVRJT04gaWYgaXQgd2FzIGEgY2F0Y2ggLQogICAgICAgICAgICAgICAgICAgICAgICAvLyBkbyB3ZSBuZWVkIHRvIGJlaGF2ZSBhbnkgZGlmZmVyZW50bHkgd2l0aCBvdXIgbm9uLXJlZGlyZWN0IGVycm9ycz8KICAgICAgICAgICAgICAgICAgICAgICAgLy8gV2hhdCBpZiBpdCB3YXMgYSBub24tcmVkaXJlY3QgUmVzcG9uc2U/CiAgICAgICAgICAgICAgICAgICAgICAgIHVwZGF0ZVN0YXRlKHsgZmV0Y2hlcnM6IG5ldyBNYXAoc3RhdGUuZmV0Y2hlcnMpLCBlcnJvcnM6IF9kZWZpbmVQcm9wZXJ0eTIoe30sIGJvdW5kYXJ5TWF0Y2gucm91dGUuaWQsIHJlc3VsdC5lcnJvcikgfSk7cmV0dXJuIF9jb250ZXh0OC5hYnJ1cHQoInJldHVybiIpO2Nhc2UgMjk6cm91dGVyX2ludmFyaWFudCghaXNEZWZlcnJlZFJlc3VsdChyZXN1bHQpLCAiVW5oYW5kbGVkIGZldGNoZXIgZGVmZXJyZWQgZGF0YSIpOyAvLyBQdXQgdGhlIGZldGNoZXIgYmFjayBpbnRvIGFuIGlkbGUgc3RhdGUKICAgICAgICAgICAgICAgICAgICAgICAgZG9uZUZldGNoZXIgPSB7IHN0YXRlOiAiaWRsZSIsIGRhdGE6IHJlc3VsdC5kYXRhLCBmb3JtTWV0aG9kOiB1bmRlZmluZWQsIGZvcm1BY3Rpb246IHVuZGVmaW5lZCwgZm9ybUVuY1R5cGU6IHVuZGVmaW5lZCwgZm9ybURhdGE6IHVuZGVmaW5lZCB9O3N0YXRlLmZldGNoZXJzLnNldChrZXksIGRvbmVGZXRjaGVyKTt1cGRhdGVTdGF0ZSh7IGZldGNoZXJzOiBuZXcgTWFwKHN0YXRlLmZldGNoZXJzKSB9KTtjYXNlIDMzOmNhc2UgImVuZCI6cmV0dXJuIF9jb250ZXh0OC5zdG9wKCk7fX19LCBfY2FsbGVlOCk7fSkpO3JldHVybiBfaGFuZGxlRmV0Y2hlckxvYWRlci5hcHBseSh0aGlzLCBhcmd1bWVudHMpO31mdW5jdGlvbiBzdGFydFJlZGlyZWN0TmF2aWdhdGlvbihfeDMzLCBfeDM0LCBfeDM1KSB7cmV0dXJuIF9zdGFydFJlZGlyZWN0TmF2aWdhdGlvbi5hcHBseSh0aGlzLCBhcmd1bWVudHMpO31mdW5jdGlvbiBfc3RhcnRSZWRpcmVjdE5hdmlnYXRpb24oKSB7X3N0YXJ0UmVkaXJlY3ROYXZpZ2F0aW9uID0gX2FzeW5jVG9HZW5lcmF0b3IyKCAvKiNfX1BVUkVfXyovX3JlZ2VuZXJhdG9yUnVudGltZTIoKS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWU5KHN0YXRlLCByZWRpcmVjdCwgcmVwbGFjZSkge3ZhciByZWRpcmVjdExvY2F0aW9uLCByZWRpcmVjdEhpc3RvcnlBY3Rpb24sIF9zdGF0ZSRuYXZpZ2F0aW9uLCBmb3JtTWV0aG9kLCBmb3JtQWN0aW9uLCBmb3JtRW5jVHlwZSwgZm9ybURhdGE7cmV0dXJuIF9yZWdlbmVyYXRvclJ1bnRpbWUyKCkud3JhcChmdW5jdGlvbiBfY2FsbGVlOSQoX2NvbnRleHQ5KSB7d2hpbGUgKDEpIHtzd2l0Y2ggKF9jb250ZXh0OS5wcmV2ID0gX2NvbnRleHQ5Lm5leHQpIHtjYXNlIDA6aWYgKHJlZGlyZWN0LnJldmFsaWRhdGUpIHtpc1JldmFsaWRhdGlvblJlcXVpcmVkID0gdHJ1ZTt9cmVkaXJlY3RMb2NhdGlvbiA9IGNyZWF0ZUxvY2F0aW9uKHN0YXRlLmxvY2F0aW9uLCByZWRpcmVjdC5sb2NhdGlvbik7CiAgICAgICAgICAgICAgICAgICAgICAgIHJvdXRlcl9pbnZhcmlhbnQocmVkaXJlY3RMb2NhdGlvbiwgIkV4cGVjdGVkIGEgbG9jYXRpb24gb24gdGhlIHJlZGlyZWN0IG5hdmlnYXRpb24iKTtpZiAoISgKCiAgICAgICAgICAgICAgICAgICAgICAgIHJlZGlyZWN0LmV4dGVybmFsICYmIHR5cGVvZiB3aW5kb3cgIT09ICJ1bmRlZmluZWQiICYmIHR5cGVvZiB3aW5kb3cubG9jYXRpb24gIT09ICJ1bmRlZmluZWQiKSkge19jb250ZXh0OS5uZXh0ID0gNjticmVhazt9CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZXBsYWNlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgd2luZG93LmxvY2F0aW9uLnJlcGxhY2UocmVkaXJlY3QubG9jYXRpb24pOwogICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvdy5sb2NhdGlvbi5hc3NpZ24ocmVkaXJlY3QubG9jYXRpb24pOwogICAgICAgICAgICAgICAgICAgICAgICB9cmV0dXJuIF9jb250ZXh0OS5hYnJ1cHQoInJldHVybiIpO2Nhc2UgNjoKCgogICAgICAgICAgICAgICAgICAgICAgICAvLyBUaGVyZSdzIG5vIG5lZWQgdG8gYWJvcnQgb24gcmVkaXJlY3RzLCBzaW5jZSB3ZSBkb24ndCBkZXRlY3QgdGhlCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIHJlZGlyZWN0IHVudGlsIHRoZSBhY3Rpb24vbG9hZGVycyBoYXZlIHNldHRsZWQKCgogICAgICAgICAgICAgICAgICAgICAgICBwZW5kaW5nTmF2aWdhdGlvbkNvbnRyb2xsZXIgPSBudWxsOwogICAgICAgICAgICAgICAgICAgICAgICByZWRpcmVjdEhpc3RvcnlBY3Rpb24gPSByZXBsYWNlID09PSB0cnVlID8gQWN0aW9uLlJlcGxhY2UgOiBBY3Rpb24uUHVzaDtfc3RhdGUkbmF2aWdhdGlvbiA9CgoKCgoKICAgICAgICAgICAgICAgICAgICAgICAgc3RhdGUubmF2aWdhdGlvbiwgZm9ybU1ldGhvZCA9IF9zdGF0ZSRuYXZpZ2F0aW9uLmZvcm1NZXRob2QsIGZvcm1BY3Rpb24gPSBfc3RhdGUkbmF2aWdhdGlvbi5mb3JtQWN0aW9uLCBmb3JtRW5jVHlwZSA9IF9zdGF0ZSRuYXZpZ2F0aW9uLmZvcm1FbmNUeXBlLCBmb3JtRGF0YSA9IF9zdGF0ZSRuYXZpZ2F0aW9uLmZvcm1EYXRhOyAvLyBJZiB0aGlzIHdhcyBhIDMwNy8zMDggc3VibWlzc2lvbiB3ZSB3YW50IHRvIHByZXNlcnZlIHRoZSBIVFRQIG1ldGhvZCBhbmQKICAgICAgICAgICAgICAgICAgICAgICAgLy8gcmUtc3VibWl0IHRoZSBQT1NUL1BVVC9QQVRDSC9ERUxFVEUgYXMgYSBzdWJtaXNzaW9uIG5hdmlnYXRpb24gdG8gdGhlCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIHJlZGlyZWN0ZWQgbG9jYXRpb24KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCEoCiAgICAgICAgICAgICAgICAgICAgICAgIHJlZGlyZWN0UHJlc2VydmVNZXRob2RTdGF0dXNDb2Rlcy5oYXMocmVkaXJlY3Quc3RhdHVzKSAmJiBmb3JtTWV0aG9kICYmIGlzU3VibWlzc2lvbk1ldGhvZChmb3JtTWV0aG9kKSAmJiBmb3JtRW5jVHlwZSAmJiBmb3JtRGF0YSkpIHtfY29udGV4dDkubmV4dCA9IDE0O2JyZWFrO31fY29udGV4dDkubmV4dCA9IDEyO3JldHVybiAoCiAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhcnROYXZpZ2F0aW9uKHJlZGlyZWN0SGlzdG9yeUFjdGlvbiwgcmVkaXJlY3RMb2NhdGlvbiwgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgc3VibWlzc2lvbjogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3JtTWV0aG9kOiBmb3JtTWV0aG9kLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3JtQWN0aW9uOiByZWRpcmVjdC5sb2NhdGlvbiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9ybUVuY1R5cGU6IGZvcm1FbmNUeXBlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3JtRGF0YTogZm9ybURhdGEKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICB9KSk7Y2FzZSAxMjpfY29udGV4dDkubmV4dCA9IDE2O2JyZWFrO2Nhc2UgMTQ6X2NvbnRleHQ5Lm5leHQgPSAxNjtyZXR1cm4gKAoKCgogICAgICAgICAgICAgICAgICAgICAgICAgIHN0YXJ0TmF2aWdhdGlvbihyZWRpcmVjdEhpc3RvcnlBY3Rpb24sIHJlZGlyZWN0TG9jYXRpb24sIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG92ZXJyaWRlTmF2aWdhdGlvbjogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGF0ZTogImxvYWRpbmciLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2NhdGlvbjogcmVkaXJlY3RMb2NhdGlvbiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9ybU1ldGhvZDogZm9ybU1ldGhvZCB8fCB1bmRlZmluZWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvcm1BY3Rpb246IGZvcm1BY3Rpb24gfHwgdW5kZWZpbmVkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3JtRW5jVHlwZTogZm9ybUVuY1R5cGUgfHwgdW5kZWZpbmVkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3JtRGF0YTogZm9ybURhdGEgfHwgdW5kZWZpbmVkCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgfSkpO2Nhc2UgMTY6Y2FzZSAiZW5kIjpyZXR1cm4gX2NvbnRleHQ5LnN0b3AoKTt9fX0sIF9jYWxsZWU5KTt9KSk7cmV0dXJuIF9zdGFydFJlZGlyZWN0TmF2aWdhdGlvbi5hcHBseSh0aGlzLCBhcmd1bWVudHMpO31mdW5jdGlvbgoKCgogICAgICAgICAgICBjYWxsTG9hZGVyc0FuZE1heWJlUmVzb2x2ZURhdGEoX3gzNiwgX3gzNywgX3gzOCwgX3gzOSwgX3g0MCkge3JldHVybiBfY2FsbExvYWRlcnNBbmRNYXliZVJlc29sdmVEYXRhLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7fWZ1bmN0aW9uIF9jYWxsTG9hZGVyc0FuZE1heWJlUmVzb2x2ZURhdGEoKSB7X2NhbGxMb2FkZXJzQW5kTWF5YmVSZXNvbHZlRGF0YSA9IF9hc3luY1RvR2VuZXJhdG9yMiggLyojX19QVVJFX18qL19yZWdlbmVyYXRvclJ1bnRpbWUyKCkubWFyayhmdW5jdGlvbiBfY2FsbGVlMTAoY3VycmVudE1hdGNoZXMsIG1hdGNoZXMsIG1hdGNoZXNUb0xvYWQsIGZldGNoZXJzVG9Mb2FkLCByZXF1ZXN0KSB7dmFyIHJlc3VsdHMsIGxvYWRlclJlc3VsdHMsIGZldGNoZXJSZXN1bHRzO3JldHVybiBfcmVnZW5lcmF0b3JSdW50aW1lMigpLndyYXAoZnVuY3Rpb24gX2NhbGxlZTEwJChfY29udGV4dDEwKSB7d2hpbGUgKDEpIHtzd2l0Y2ggKF9jb250ZXh0MTAucHJldiA9IF9jb250ZXh0MTAubmV4dCkge2Nhc2UgMDpfY29udGV4dDEwLm5leHQgPSAyO3JldHVybiAoCgoKCiAgICAgICAgICAgICAgICAgICAgICAgICAgUHJvbWlzZS5hbGwoW10uY29uY2F0KF90b0NvbnN1bWFibGVBcnJheTIobWF0Y2hlc1RvTG9hZC5tYXAoKG1hdGNoKSA9PiBjYWxsTG9hZGVyT3JBY3Rpb24oImxvYWRlciIsIHJlcXVlc3QsIG1hdGNoLCBtYXRjaGVzLCByb3V0ZXIuYmFzZW5hbWUpKSksIF90b0NvbnN1bWFibGVBcnJheTIoZmV0Y2hlcnNUb0xvYWQubWFwKChfcmVmOCkgPT4gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIF9yZWYyMCA9IF9zbGljZWRUb0FycmF5MihfcmVmOCwgNCksaHJlZiA9IF9yZWYyMFsxXSxtYXRjaCA9IF9yZWYyMFsyXSxmZXRjaE1hdGNoZXMgPSBfcmVmMjBbM107CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gY2FsbExvYWRlck9yQWN0aW9uKCJsb2FkZXIiLCBjcmVhdGVSZXF1ZXN0KGhyZWYsIHJlcXVlc3Quc2lnbmFsKSwgbWF0Y2gsIGZldGNoTWF0Y2hlcywgcm91dGVyLmJhc2VuYW1lKTsKICAgICAgICAgICAgICAgICAgICAgICAgICB9KSkpKSk7Y2FzZSAyOnJlc3VsdHMgPSBfY29udGV4dDEwLnNlbnQ7CiAgICAgICAgICAgICAgICAgICAgICAgIGxvYWRlclJlc3VsdHMgPSByZXN1bHRzLnNsaWNlKDAsIG1hdGNoZXNUb0xvYWQubGVuZ3RoKTsKICAgICAgICAgICAgICAgICAgICAgICAgZmV0Y2hlclJlc3VsdHMgPSByZXN1bHRzLnNsaWNlKG1hdGNoZXNUb0xvYWQubGVuZ3RoKTtfY29udGV4dDEwLm5leHQgPSA3O3JldHVybiAoCiAgICAgICAgICAgICAgICAgICAgICAgICAgUHJvbWlzZS5hbGwoW3Jlc29sdmVEZWZlcnJlZFJlc3VsdHMoY3VycmVudE1hdGNoZXMsIG1hdGNoZXNUb0xvYWQsIGxvYWRlclJlc3VsdHMsIHJlcXVlc3Quc2lnbmFsLCBmYWxzZSwgc3RhdGUubG9hZGVyRGF0YSksIHJlc29sdmVEZWZlcnJlZFJlc3VsdHMoY3VycmVudE1hdGNoZXMsIGZldGNoZXJzVG9Mb2FkLm1hcCgoX3JlZjkpID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBfcmVmMjEgPSBfc2xpY2VkVG9BcnJheTIoX3JlZjksIDMpLG1hdGNoID0gX3JlZjIxWzJdOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG1hdGNoOwogICAgICAgICAgICAgICAgICAgICAgICAgIH0pLCBmZXRjaGVyUmVzdWx0cywgcmVxdWVzdC5zaWduYWwsIHRydWUpXSkpO2Nhc2UgNzpyZXR1cm4gX2NvbnRleHQxMC5hYnJ1cHQoInJldHVybiIsCiAgICAgICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgICByZXN1bHRzOiByZXN1bHRzLAogICAgICAgICAgICAgICAgICAgICAgICAgIGxvYWRlclJlc3VsdHM6IGxvYWRlclJlc3VsdHMsCiAgICAgICAgICAgICAgICAgICAgICAgICAgZmV0Y2hlclJlc3VsdHM6IGZldGNoZXJSZXN1bHRzCiAgICAgICAgICAgICAgICAgICAgICAgIH0pO2Nhc2UgODpjYXNlICJlbmQiOnJldHVybiBfY29udGV4dDEwLnN0b3AoKTt9fX0sIF9jYWxsZWUxMCk7fSkpO3JldHVybiBfY2FsbExvYWRlcnNBbmRNYXliZVJlc29sdmVEYXRhLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7fQoKCiAgICAgICAgICAgIGZ1bmN0aW9uIGludGVycnVwdEFjdGl2ZUxvYWRzKCkge3ZhciBfY2FuY2VsbGVkRGVmZXJyZWRSb3U7CiAgICAgICAgICAgICAgLy8gRXZlcnkgaW50ZXJydXB0aW9uIHRyaWdnZXJzIGEgcmV2YWxpZGF0aW9uCiAgICAgICAgICAgICAgaXNSZXZhbGlkYXRpb25SZXF1aXJlZCA9IHRydWU7IC8vIENhbmNlbCBwZW5kaW5nIHJvdXRlLWxldmVsIGRlZmVycmVkcyBhbmQgbWFyayBjYW5jZWxsZWQgcm91dGVzIGZvcgogICAgICAgICAgICAgIC8vIHJldmFsaWRhdGlvbgoKICAgICAgICAgICAgICAoX2NhbmNlbGxlZERlZmVycmVkUm91ID0gY2FuY2VsbGVkRGVmZXJyZWRSb3V0ZXMpLnB1c2guYXBwbHkoX2NhbmNlbGxlZERlZmVycmVkUm91LCBfdG9Db25zdW1hYmxlQXJyYXkyKGNhbmNlbEFjdGl2ZURlZmVycmVkcygpKSk7IC8vIEFib3J0IGluLWZsaWdodCBmZXRjaGVyIGxvYWRzCgogICAgICAgICAgICAgIGZldGNoTG9hZE1hdGNoZXMuZm9yRWFjaCgoXywga2V5KSA9PiB7CiAgICAgICAgICAgICAgICBpZiAoZmV0Y2hDb250cm9sbGVycy5oYXMoa2V5KSkgewogICAgICAgICAgICAgICAgICBjYW5jZWxsZWRGZXRjaGVyTG9hZHMucHVzaChrZXkpOwogICAgICAgICAgICAgICAgICBhYm9ydEZldGNoZXIoa2V5KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgZnVuY3Rpb24gc2V0RmV0Y2hlckVycm9yKGtleSwgcm91dGVJZCwgZXJyb3IpIHsKICAgICAgICAgICAgICB2YXIgYm91bmRhcnlNYXRjaCA9IGZpbmROZWFyZXN0Qm91bmRhcnkoc3RhdGUubWF0Y2hlcywgcm91dGVJZCk7CiAgICAgICAgICAgICAgZGVsZXRlRmV0Y2hlcihrZXkpOwogICAgICAgICAgICAgIHVwZGF0ZVN0YXRlKHsKICAgICAgICAgICAgICAgIGVycm9yczogX2RlZmluZVByb3BlcnR5Mih7fSwKICAgICAgICAgICAgICAgIGJvdW5kYXJ5TWF0Y2gucm91dGUuaWQsIGVycm9yKSwKCiAgICAgICAgICAgICAgICBmZXRjaGVyczogbmV3IE1hcChzdGF0ZS5mZXRjaGVycykKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgZnVuY3Rpb24gZGVsZXRlRmV0Y2hlcihrZXkpIHsKICAgICAgICAgICAgICBpZiAoZmV0Y2hDb250cm9sbGVycy5oYXMoa2V5KSkgYWJvcnRGZXRjaGVyKGtleSk7CiAgICAgICAgICAgICAgZmV0Y2hMb2FkTWF0Y2hlcy5kZWxldGUoa2V5KTsKICAgICAgICAgICAgICBmZXRjaFJlbG9hZElkcy5kZWxldGUoa2V5KTsKICAgICAgICAgICAgICBmZXRjaFJlZGlyZWN0SWRzLmRlbGV0ZShrZXkpOwogICAgICAgICAgICAgIHN0YXRlLmZldGNoZXJzLmRlbGV0ZShrZXkpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBmdW5jdGlvbiBhYm9ydEZldGNoZXIoa2V5KSB7CiAgICAgICAgICAgICAgdmFyIGNvbnRyb2xsZXIgPSBmZXRjaENvbnRyb2xsZXJzLmdldChrZXkpOwogICAgICAgICAgICAgIHJvdXRlcl9pbnZhcmlhbnQoY29udHJvbGxlciwgIkV4cGVjdGVkIGZldGNoIGNvbnRyb2xsZXI6ICIgKyBrZXkpOwogICAgICAgICAgICAgIGNvbnRyb2xsZXIuYWJvcnQoKTsKICAgICAgICAgICAgICBmZXRjaENvbnRyb2xsZXJzLmRlbGV0ZShrZXkpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBmdW5jdGlvbiBtYXJrRmV0Y2hlcnNEb25lKGtleXMpIHt2YXIgX2l0ZXJhdG9yMyA9IF9jcmVhdGVGb3JPZkl0ZXJhdG9ySGVscGVyMigKICAgICAgICAgICAgICAgIGtleXMpLF9zdGVwMzt0cnkge2ZvciAoX2l0ZXJhdG9yMy5zKCk7ICEoX3N0ZXAzID0gX2l0ZXJhdG9yMy5uKCkpLmRvbmU7KSB7dmFyIGtleSA9IF9zdGVwMy52YWx1ZTsKICAgICAgICAgICAgICAgICAgdmFyIGZldGNoZXIgPSBnZXRGZXRjaGVyKGtleSk7CiAgICAgICAgICAgICAgICAgIHZhciBkb25lRmV0Y2hlciA9IHsKICAgICAgICAgICAgICAgICAgICBzdGF0ZTogImlkbGUiLAogICAgICAgICAgICAgICAgICAgIGRhdGE6IGZldGNoZXIuZGF0YSwKICAgICAgICAgICAgICAgICAgICBmb3JtTWV0aG9kOiB1bmRlZmluZWQsCiAgICAgICAgICAgICAgICAgICAgZm9ybUFjdGlvbjogdW5kZWZpbmVkLAogICAgICAgICAgICAgICAgICAgIGZvcm1FbmNUeXBlOiB1bmRlZmluZWQsCiAgICAgICAgICAgICAgICAgICAgZm9ybURhdGE6IHVuZGVmaW5lZAogICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgICBzdGF0ZS5mZXRjaGVycy5zZXQoa2V5LCBkb25lRmV0Y2hlcik7CiAgICAgICAgICAgICAgICB9fSBjYXRjaCAoZXJyKSB7X2l0ZXJhdG9yMy5lKGVycik7fSBmaW5hbGx5IHtfaXRlcmF0b3IzLmYoKTt9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGZ1bmN0aW9uIG1hcmtGZXRjaFJlZGlyZWN0c0RvbmUoKSB7CiAgICAgICAgICAgICAgdmFyIGRvbmVLZXlzID0gW107dmFyIF9pdGVyYXRvcjQgPSBfY3JlYXRlRm9yT2ZJdGVyYXRvckhlbHBlcjIoCgogICAgICAgICAgICAgICAgZmV0Y2hSZWRpcmVjdElkcyksX3N0ZXA0O3RyeSB7Zm9yIChfaXRlcmF0b3I0LnMoKTsgIShfc3RlcDQgPSBfaXRlcmF0b3I0Lm4oKSkuZG9uZTspIHt2YXIga2V5ID0gX3N0ZXA0LnZhbHVlOwogICAgICAgICAgICAgICAgICB2YXIgZmV0Y2hlciA9IHN0YXRlLmZldGNoZXJzLmdldChrZXkpOwogICAgICAgICAgICAgICAgICByb3V0ZXJfaW52YXJpYW50KGZldGNoZXIsICJFeHBlY3RlZCBmZXRjaGVyOiAiICsga2V5KTsKCiAgICAgICAgICAgICAgICAgIGlmIChmZXRjaGVyLnN0YXRlID09PSAibG9hZGluZyIpIHsKICAgICAgICAgICAgICAgICAgICBmZXRjaFJlZGlyZWN0SWRzLmRlbGV0ZShrZXkpOwogICAgICAgICAgICAgICAgICAgIGRvbmVLZXlzLnB1c2goa2V5KTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfX0gY2F0Y2ggKGVycikge19pdGVyYXRvcjQuZShlcnIpO30gZmluYWxseSB7X2l0ZXJhdG9yNC5mKCk7fQoKICAgICAgICAgICAgICBtYXJrRmV0Y2hlcnNEb25lKGRvbmVLZXlzKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgZnVuY3Rpb24gYWJvcnRTdGFsZUZldGNoTG9hZHMobGFuZGVkSWQpIHsKICAgICAgICAgICAgICB2YXIgeWVldGVkS2V5cyA9IFtdO3ZhciBfaXRlcmF0b3I1ID0gX2NyZWF0ZUZvck9mSXRlcmF0b3JIZWxwZXIyKAoKICAgICAgICAgICAgICAgIGZldGNoUmVsb2FkSWRzKSxfc3RlcDU7dHJ5IHtmb3IgKF9pdGVyYXRvcjUucygpOyAhKF9zdGVwNSA9IF9pdGVyYXRvcjUubigpKS5kb25lOykge3ZhciBfc3RlcDUkdmFsdWUgPSBfc2xpY2VkVG9BcnJheTIoX3N0ZXA1LnZhbHVlLCAyKSxrZXkgPSBfc3RlcDUkdmFsdWVbMF0saWQgPSBfc3RlcDUkdmFsdWVbMV07CiAgICAgICAgICAgICAgICAgIGlmIChpZCA8IGxhbmRlZElkKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIGZldGNoZXIgPSBzdGF0ZS5mZXRjaGVycy5nZXQoa2V5KTsKICAgICAgICAgICAgICAgICAgICByb3V0ZXJfaW52YXJpYW50KGZldGNoZXIsICJFeHBlY3RlZCBmZXRjaGVyOiAiICsga2V5KTsKCiAgICAgICAgICAgICAgICAgICAgaWYgKGZldGNoZXIuc3RhdGUgPT09ICJsb2FkaW5nIikgewogICAgICAgICAgICAgICAgICAgICAgYWJvcnRGZXRjaGVyKGtleSk7CiAgICAgICAgICAgICAgICAgICAgICBmZXRjaFJlbG9hZElkcy5kZWxldGUoa2V5KTsKICAgICAgICAgICAgICAgICAgICAgIHllZXRlZEtleXMucHVzaChrZXkpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfX0gY2F0Y2ggKGVycikge19pdGVyYXRvcjUuZShlcnIpO30gZmluYWxseSB7X2l0ZXJhdG9yNS5mKCk7fQoKICAgICAgICAgICAgICBtYXJrRmV0Y2hlcnNEb25lKHllZXRlZEtleXMpOwogICAgICAgICAgICAgIHJldHVybiB5ZWV0ZWRLZXlzLmxlbmd0aCA+IDA7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGZ1bmN0aW9uIGNhbmNlbEFjdGl2ZURlZmVycmVkcyhwcmVkaWNhdGUpIHsKICAgICAgICAgICAgICB2YXIgY2FuY2VsbGVkUm91dGVJZHMgPSBbXTsKICAgICAgICAgICAgICBhY3RpdmVEZWZlcnJlZHMuZm9yRWFjaCgoZGZkLCByb3V0ZUlkKSA9PiB7CiAgICAgICAgICAgICAgICBpZiAoIXByZWRpY2F0ZSB8fCBwcmVkaWNhdGUocm91dGVJZCkpIHsKICAgICAgICAgICAgICAgICAgLy8gQ2FuY2VsIHRoZSBkZWZlcnJlZCAtIGJ1dCBkbyBub3QgcmVtb3ZlIGZyb20gYWN0aXZlRGVmZXJyZWRzIGhlcmUgLQogICAgICAgICAgICAgICAgICAvLyB3ZSByZWx5IG9uIHRoZSBzdWJzY3JpYmVycyB0byBkbyB0aGF0IHNvIG91ciB0ZXN0cyBjYW4gYXNzZXJ0IHByb3BlcgogICAgICAgICAgICAgICAgICAvLyBjbGVhbnVwIHZpYSBfaW50ZXJuYWxBY3RpdmVEZWZlcnJlZHMKICAgICAgICAgICAgICAgICAgZGZkLmNhbmNlbCgpOwogICAgICAgICAgICAgICAgICBjYW5jZWxsZWRSb3V0ZUlkcy5wdXNoKHJvdXRlSWQpOwogICAgICAgICAgICAgICAgICBhY3RpdmVEZWZlcnJlZHMuZGVsZXRlKHJvdXRlSWQpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgIHJldHVybiBjYW5jZWxsZWRSb3V0ZUlkczsKICAgICAgICAgICAgfSAvLyBPcHQgaW4gdG8gY2FwdHVyaW5nIGFuZCByZXBvcnRpbmcgc2Nyb2xsIHBvc2l0aW9ucyBkdXJpbmcgbmF2aWdhdGlvbnMsCiAgICAgICAgICAgIC8vIHVzZWQgYnkgdGhlIDxTY3JvbGxSZXN0b3JhdGlvbj4gY29tcG9uZW50CgoKICAgICAgICAgICAgZnVuY3Rpb24gZW5hYmxlU2Nyb2xsUmVzdG9yYXRpb24ocG9zaXRpb25zLCBnZXRQb3NpdGlvbiwgZ2V0S2V5KSB7CiAgICAgICAgICAgICAgc2F2ZWRTY3JvbGxQb3NpdGlvbnMgPSBwb3NpdGlvbnM7CiAgICAgICAgICAgICAgZ2V0U2Nyb2xsUG9zaXRpb24gPSBnZXRQb3NpdGlvbjsKCiAgICAgICAgICAgICAgZ2V0U2Nyb2xsUmVzdG9yYXRpb25LZXkgPSBnZXRLZXkgfHwgKChsb2NhdGlvbikgPT4gbG9jYXRpb24ua2V5KTsgLy8gUGVyZm9ybSBpbml0aWFsIGh5ZHJhdGlvbiBzY3JvbGwgcmVzdG9yYXRpb24sIHNpbmNlIHdlIG1pc3MgdGhlIGJvYXQgb24KICAgICAgICAgICAgICAvLyB0aGUgaW5pdGlhbCB1cGRhdGVTdGF0ZSgpIGJlY2F1c2Ugd2UndmUgbm90IHlldCByZW5kZXJlZCA8U2Nyb2xsUmVzdG9yYXRpb24vPgogICAgICAgICAgICAgIC8vIGFuZCB0aGVyZWZvcmUgaGF2ZSBubyBzYXZlZFNjcm9sbFBvc2l0aW9ucyBhdmFpbGFibGUKCgogICAgICAgICAgICAgIGlmICghaW5pdGlhbFNjcm9sbFJlc3RvcmVkICYmIHN0YXRlLm5hdmlnYXRpb24gPT09IElETEVfTkFWSUdBVElPTikgewogICAgICAgICAgICAgICAgaW5pdGlhbFNjcm9sbFJlc3RvcmVkID0gdHJ1ZTsKICAgICAgICAgICAgICAgIHZhciB5ID0gZ2V0U2F2ZWRTY3JvbGxQb3NpdGlvbihzdGF0ZS5sb2NhdGlvbiwgc3RhdGUubWF0Y2hlcyk7CgogICAgICAgICAgICAgICAgaWYgKHkgIT0gbnVsbCkgewogICAgICAgICAgICAgICAgICB1cGRhdGVTdGF0ZSh7CiAgICAgICAgICAgICAgICAgICAgcmVzdG9yZVNjcm9sbFBvc2l0aW9uOiB5CiAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgcmV0dXJuICgpID0+IHsKICAgICAgICAgICAgICAgIHNhdmVkU2Nyb2xsUG9zaXRpb25zID0gbnVsbDsKICAgICAgICAgICAgICAgIGdldFNjcm9sbFBvc2l0aW9uID0gbnVsbDsKICAgICAgICAgICAgICAgIGdldFNjcm9sbFJlc3RvcmF0aW9uS2V5ID0gbnVsbDsKICAgICAgICAgICAgICB9OwogICAgICAgICAgICB9CgogICAgICAgICAgICBmdW5jdGlvbiBzYXZlU2Nyb2xsUG9zaXRpb24obG9jYXRpb24sIG1hdGNoZXMpIHsKICAgICAgICAgICAgICBpZiAoc2F2ZWRTY3JvbGxQb3NpdGlvbnMgJiYgZ2V0U2Nyb2xsUmVzdG9yYXRpb25LZXkgJiYgZ2V0U2Nyb2xsUG9zaXRpb24pIHsKICAgICAgICAgICAgICAgIHZhciB1c2VyTWF0Y2hlcyA9IG1hdGNoZXMubWFwKChtKSA9PiBjcmVhdGVVc2VNYXRjaGVzTWF0Y2gobSwgc3RhdGUubG9hZGVyRGF0YSkpOwogICAgICAgICAgICAgICAgdmFyIGtleSA9IGdldFNjcm9sbFJlc3RvcmF0aW9uS2V5KGxvY2F0aW9uLCB1c2VyTWF0Y2hlcykgfHwgbG9jYXRpb24ua2V5OwogICAgICAgICAgICAgICAgc2F2ZWRTY3JvbGxQb3NpdGlvbnNba2V5XSA9IGdldFNjcm9sbFBvc2l0aW9uKCk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICBmdW5jdGlvbiBnZXRTYXZlZFNjcm9sbFBvc2l0aW9uKGxvY2F0aW9uLCBtYXRjaGVzKSB7CiAgICAgICAgICAgICAgaWYgKHNhdmVkU2Nyb2xsUG9zaXRpb25zICYmIGdldFNjcm9sbFJlc3RvcmF0aW9uS2V5ICYmIGdldFNjcm9sbFBvc2l0aW9uKSB7CiAgICAgICAgICAgICAgICB2YXIgdXNlck1hdGNoZXMgPSBtYXRjaGVzLm1hcCgobSkgPT4gY3JlYXRlVXNlTWF0Y2hlc01hdGNoKG0sIHN0YXRlLmxvYWRlckRhdGEpKTsKICAgICAgICAgICAgICAgIHZhciBrZXkgPSBnZXRTY3JvbGxSZXN0b3JhdGlvbktleShsb2NhdGlvbiwgdXNlck1hdGNoZXMpIHx8IGxvY2F0aW9uLmtleTsKICAgICAgICAgICAgICAgIHZhciB5ID0gc2F2ZWRTY3JvbGxQb3NpdGlvbnNba2V5XTsKCiAgICAgICAgICAgICAgICBpZiAodHlwZW9mIHkgPT09ICJudW1iZXIiKSB7CiAgICAgICAgICAgICAgICAgIHJldHVybiB5OwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJvdXRlciA9IHsKICAgICAgICAgICAgICBnZXQgYmFzZW5hbWUoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gaW5pdC5iYXNlbmFtZTsKICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICBnZXQgc3RhdGUoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gc3RhdGU7CiAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgZ2V0IHJvdXRlcygpIHsKICAgICAgICAgICAgICAgIHJldHVybiBkYXRhUm91dGVzOwogICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgIGluaXRpYWxpemU6IGluaXRpYWxpemUsCiAgICAgICAgICAgICAgc3Vic2NyaWJlOiBzdWJzY3JpYmUsCiAgICAgICAgICAgICAgZW5hYmxlU2Nyb2xsUmVzdG9yYXRpb246IGVuYWJsZVNjcm9sbFJlc3RvcmF0aW9uLAogICAgICAgICAgICAgIG5hdmlnYXRlOiBuYXZpZ2F0ZSwKICAgICAgICAgICAgICBmZXRjaDogZmV0Y2gsCiAgICAgICAgICAgICAgcmV2YWxpZGF0ZTogcmV2YWxpZGF0ZSwKICAgICAgICAgICAgICAvLyBQYXNzdGhyb3VnaCB0byBoaXN0b3J5LWF3YXJlIGNyZWF0ZUhyZWYgdXNlZCBieSB1c2VIcmVmIHNvIHdlIGdldCBwcm9wZXIKICAgICAgICAgICAgICAvLyBoYXNoLWF3YXJlIFVSTHMgaW4gRE9NIHBhdGhzCiAgICAgICAgICAgICAgY3JlYXRlSHJlZjogKHRvKSA9PiBpbml0Lmhpc3RvcnkuY3JlYXRlSHJlZih0byksCiAgICAgICAgICAgICAgZW5jb2RlTG9jYXRpb246ICh0bykgPT4gaW5pdC5oaXN0b3J5LmVuY29kZUxvY2F0aW9uKHRvKSwKICAgICAgICAgICAgICBnZXRGZXRjaGVyOiBnZXRGZXRjaGVyLAogICAgICAgICAgICAgIGRlbGV0ZUZldGNoZXI6IGRlbGV0ZUZldGNoZXIsCiAgICAgICAgICAgICAgZGlzcG9zZTogZGlzcG9zZSwKICAgICAgICAgICAgICBfaW50ZXJuYWxGZXRjaENvbnRyb2xsZXJzOiBmZXRjaENvbnRyb2xsZXJzLAogICAgICAgICAgICAgIF9pbnRlcm5hbEFjdGl2ZURlZmVycmVkczogYWN0aXZlRGVmZXJyZWRzCiAgICAgICAgICAgIH07CiAgICAgICAgICAgIHJldHVybiByb3V0ZXI7CiAgICAgICAgICB9IC8vI2VuZHJlZ2lvbgogICAgICAgICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KICAgICAgICAgIC8vI3JlZ2lvbiBjcmVhdGVTdGF0aWNIYW5kbGVyCiAgICAgICAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwoKICAgICAgICAgIGZ1bmN0aW9uIHVuc3RhYmxlX2NyZWF0ZVN0YXRpY0hhbmRsZXIocm91dGVzLCBvcHRzKSB7CiAgICAgICAgICAgIHJvdXRlcl9pbnZhcmlhbnQocm91dGVzLmxlbmd0aCA+IDAsICJZb3UgbXVzdCBwcm92aWRlIGEgbm9uLWVtcHR5IHJvdXRlcyBhcnJheSB0byB1bnN0YWJsZV9jcmVhdGVTdGF0aWNIYW5kbGVyIik7CiAgICAgICAgICAgIHZhciBkYXRhUm91dGVzID0gY29udmVydFJvdXRlc1RvRGF0YVJvdXRlcyhyb3V0ZXMpOwogICAgICAgICAgICB2YXIgYmFzZW5hbWUgPSAob3B0cyA/IG9wdHMuYmFzZW5hbWUgOiBudWxsKSB8fCAiLyI7CiAgICAgICAgICAgIC8qKgogICAgICAgICAgICAgKiBUaGUgcXVlcnkoKSBtZXRob2QgaXMgaW50ZW5kZWQgZm9yIGRvY3VtZW50IHJlcXVlc3RzLCBpbiB3aGljaCB3ZSB3YW50IHRvCiAgICAgICAgICAgICAqIGNhbGwgYW4gb3B0aW9uYWwgYWN0aW9uIGFuZCBwb3RlbnRpYWxseSBtdWx0aXBsZSBsb2FkZXJzIGZvciBhbGwgbmVzdGVkCiAgICAgICAgICAgICAqIHJvdXRlcy4gIEl0IHJldHVybnMgYSBTdGF0aWNIYW5kbGVyQ29udGV4dCBvYmplY3QsIHdoaWNoIGlzIHZlcnkgc2ltaWxhcgogICAgICAgICAgICAgKiB0byB0aGUgcm91dGVyIHN0YXRlIChsb2NhdGlvbiwgbG9hZGVyRGF0YSwgYWN0aW9uRGF0YSwgZXJyb3JzLCBldGMuKSBhbmQKICAgICAgICAgICAgICogYWxzbyBhZGRzIFNTUi1zcGVjaWZpYyBpbmZvcm1hdGlvbiBzdWNoIGFzIHRoZSBzdGF0dXNDb2RlIGFuZCBoZWFkZXJzCiAgICAgICAgICAgICAqIGZyb20gYWN0aW9uL2xvYWRlcnMgUmVzcG9uc2VzLgogICAgICAgICAgICAgKgogICAgICAgICAgICAgKiBJdCBfc2hvdWxkXyBuZXZlciB0aHJvdyBhbmQgc2hvdWxkIHJlcG9ydCBhbGwgZXJyb3JzIHRocm91Z2ggdGhlCiAgICAgICAgICAgICAqIHJldHVybmVkIGNvbnRleHQuZXJyb3JzIG9iamVjdCwgcHJvcGVybHkgYXNzb2NpYXRpbmcgZXJyb3JzIHRvIHRoZWlyIGVycm9yCiAgICAgICAgICAgICAqIGJvdW5kYXJ5LiAgQWRkaXRpb25hbGx5LCBpdCB0cmFja3MgX2RlZXBlc3RSZW5kZXJlZEJvdW5kYXJ5SWQgd2hpY2ggY2FuIGJlCiAgICAgICAgICAgICAqIHVzZWQgdG8gZW11bGF0ZSBSZWFjdCBlcnJvciBib3VuZGFyaWVzIGR1cmluZyBTU3IgYnkgcGVyZm9ybWluZyBhIHNlY29uZAogICAgICAgICAgICAgKiBwYXNzIG9ubHkgZG93biB0byB0aGUgYm91bmRhcnlJZC4KICAgICAgICAgICAgICoKICAgICAgICAgICAgICogVGhlIG9uZSBleGNlcHRpb24gd2hlcmUgd2UgZG8gbm90IHJldHVybiBhIFN0YXRpY0hhbmRsZXJDb250ZXh0IGlzIHdoZW4gYQogICAgICAgICAgICAgKiByZWRpcmVjdCByZXNwb25zZSBpcyByZXR1cm5lZCBvciB0aHJvd24gZnJvbSBhbnkgYWN0aW9uL2xvYWRlci4gIFdlCiAgICAgICAgICAgICAqIHByb3BhZ2F0ZSB0aGF0IG91dCBhbmQgcmV0dXJuIHRoZSByYXcgUmVzcG9uc2Ugc28gdGhlIEhUVFAgc2VydmVyIGNhbgogICAgICAgICAgICAgKiByZXR1cm4gaXQgZGlyZWN0bHkuCiAgICAgICAgICAgICAqL2Z1bmN0aW9uCgogICAgICAgICAgICBxdWVyeShfeDQxKSB7cmV0dXJuIF9xdWVyeS5hcHBseSh0aGlzLCBhcmd1bWVudHMpO30KCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKICAgICAgICAgICAgLyoqCiAgICAgICAgICAgICAqIFRoZSBxdWVyeVJvdXRlKCkgbWV0aG9kIGlzIGludGVuZGVkIGZvciB0YXJnZXRlZCByb3V0ZSByZXF1ZXN0cywgZWl0aGVyCiAgICAgICAgICAgICAqIGZvciBmZXRjaCA/X2RhdGEgcmVxdWVzdHMgb3IgcmVzb3VyY2Ugcm91dGUgcmVxdWVzdHMuICBJbiB0aGlzIGNhc2UsIHdlCiAgICAgICAgICAgICAqIGFyZSBvbmx5IGV2ZXIgY2FsbGluZyBhIHNpbmdsZSBhY3Rpb24gb3IgbG9hZGVyLCBhbmQgd2UgYXJlIHJldHVybmluZyB0aGUKICAgICAgICAgICAgICogcmV0dXJuZWQgdmFsdWUgZGlyZWN0bHkuICBJbiBtb3N0IGNhc2VzLCB0aGlzIHdpbGwgYmUgYSBSZXNwb25zZSByZXR1cm5lZAogICAgICAgICAgICAgKiBmcm9tIHRoZSBhY3Rpb24vbG9hZGVyLCBidXQgaXQgbWF5IGJlIGEgcHJpbWl0aXZlIG9yIG90aGVyIHZhbHVlIGFzIHdlbGwgLQogICAgICAgICAgICAgKiBhbmQgaW4gc3VjaCBjYXNlcyB0aGUgY2FsbGluZyBjb250ZXh0IHNob3VsZCBoYW5kbGUgdGhhdCBhY2NvcmRpbmdseS4KICAgICAgICAgICAgICoKICAgICAgICAgICAgICogV2UgZG8gcmVzcGVjdCB0aGUgdGhyb3cvcmV0dXJuIGRpZmZlcmVudGlhdGlvbiwgc28gaWYgYW4gYWN0aW9uL2xvYWRlcgogICAgICAgICAgICAgKiB0aHJvd3MsIHRoZW4gdGhpcyBtZXRob2Qgd2lsbCB0aHJvdyB0aGUgdmFsdWUuICBUaGlzIGlzIGltcG9ydGFudCBzbyB3ZQogICAgICAgICAgICAgKiBjYW4gZG8gcHJvcGVyIGJvdW5kYXJ5IGlkZW50aWZpY2F0aW9uIGluIFJlbWl4IHdoZXJlIGEgdGhyb3duIFJlc3BvbnNlCiAgICAgICAgICAgICAqIG11c3QgZ28gdG8gdGhlIENhdGNoIEJvdW5kYXJ5IGJ1dCBhIHJldHVybmVkIFJlc3BvbnNlIGlzIGhhcHB5LXBhdGguCiAgICAgICAgICAgICAqCiAgICAgICAgICAgICAqIE9uZSB0aGluZyB0byBub3RlIGlzIHRoYXQgYW55IFJvdXRlci1pbml0aWF0ZWQgRXJyb3JzIHRoYXQgbWFrZSBzZW5zZQogICAgICAgICAgICAgKiB0byBhc3NvY2lhdGUgd2l0aCBhIHN0YXR1cyBjb2RlIHdpbGwgYmUgdGhyb3duIGFzIGFuIEVycm9yUmVzcG9uc2UKICAgICAgICAgICAgICogaW5zdGFuY2Ugd2hpY2ggaW5jbHVkZSB0aGUgcmF3IEVycm9yLCBzdWNoIHRoYXQgdGhlIGNhbGxpbmcgY29udGV4dCBjYW4KICAgICAgICAgICAgICogc2VyaWFsaXplIHRoZSBlcnJvciBhcyB0aGV5IHNlZSBmaXQgd2hpbGUgaW5jbHVkaW5nIHRoZSBwcm9wZXIgcmVzcG9uc2UKICAgICAgICAgICAgICogY29kZS4gIEV4YW1wbGVzIGhlcmUgYXJlIDQwNCBhbmQgNDA1IGVycm9ycyB0aGF0IG9jY3VyIHByaW9yIHRvIHJlYWNoaW5nCiAgICAgICAgICAgICAqIGFueSB1c2VyLWRlZmluZWQgbG9hZGVycy4KICAgICAgICAgICAgICovZnVuY3Rpb24gX3F1ZXJ5KCkge19xdWVyeSA9IF9hc3luY1RvR2VuZXJhdG9yMiggLyojX19QVVJFX18qL19yZWdlbmVyYXRvclJ1bnRpbWUyKCkubWFyayhmdW5jdGlvbiBfY2FsbGVlMTEocmVxdWVzdCkge3ZhciB1cmwsIG1ldGhvZCwgbG9jYXRpb24sIG1hdGNoZXMsIGVycm9yLCBfZ2V0U2hvcnRDaXJjdWl0TWF0Y2gzLCBtZXRob2ROb3RBbGxvd2VkTWF0Y2hlcywgcm91dGUsIF9lcnJvcjMsIF9nZXRTaG9ydENpcmN1aXRNYXRjaDQsIG5vdEZvdW5kTWF0Y2hlcywgX3JvdXRlMiwgcmVzdWx0O3JldHVybiBfcmVnZW5lcmF0b3JSdW50aW1lMigpLndyYXAoZnVuY3Rpb24gX2NhbGxlZTExJChfY29udGV4dDExKSB7d2hpbGUgKDEpIHtzd2l0Y2ggKF9jb250ZXh0MTEucHJldiA9IF9jb250ZXh0MTEubmV4dCkge2Nhc2UgMDp1cmwgPSBuZXcgVVJMKHJlcXVlc3QudXJsKTttZXRob2QgPSByZXF1ZXN0Lm1ldGhvZC50b0xvd2VyQ2FzZSgpO2xvY2F0aW9uID0gY3JlYXRlTG9jYXRpb24oIiIsIHJvdXRlcl9jcmVhdGVQYXRoKHVybCksIG51bGwsICJkZWZhdWx0Iik7bWF0Y2hlcyA9IG1hdGNoUm91dGVzKGRhdGFSb3V0ZXMsIGxvY2F0aW9uLCBiYXNlbmFtZSk7IC8vIFNTUiBzdXBwb3J0cyBIRUFEIHJlcXVlc3RzIHdoaWxlIFNQQSBkb2Vzbid0CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghKCFpc1ZhbGlkTWV0aG9kKG1ldGhvZCkgJiYgbWV0aG9kICE9PSAiaGVhZCIpKSB7X2NvbnRleHQxMS5uZXh0ID0gMTA7YnJlYWs7fWVycm9yID0gZ2V0SW50ZXJuYWxSb3V0ZXJFcnJvcig0MDUsIHsgbWV0aG9kOiBtZXRob2QgfSk7X2dldFNob3J0Q2lyY3VpdE1hdGNoMyA9IGdldFNob3J0Q2lyY3VpdE1hdGNoZXMoZGF0YVJvdXRlcyksIG1ldGhvZE5vdEFsbG93ZWRNYXRjaGVzID0gX2dldFNob3J0Q2lyY3VpdE1hdGNoMy5tYXRjaGVzLCByb3V0ZSA9IF9nZXRTaG9ydENpcmN1aXRNYXRjaDMucm91dGU7cmV0dXJuIF9jb250ZXh0MTEuYWJydXB0KCJyZXR1cm4iLCB7IGJhc2VuYW1lOiBiYXNlbmFtZSwgbG9jYXRpb246IGxvY2F0aW9uLCBtYXRjaGVzOiBtZXRob2ROb3RBbGxvd2VkTWF0Y2hlcywgbG9hZGVyRGF0YToge30sIGFjdGlvbkRhdGE6IG51bGwsIGVycm9yczogX2RlZmluZVByb3BlcnR5Mih7fSwgcm91dGUuaWQsIGVycm9yKSwgc3RhdHVzQ29kZTogZXJyb3Iuc3RhdHVzLCBsb2FkZXJIZWFkZXJzOiB7fSwgYWN0aW9uSGVhZGVyczoge30gfSk7Y2FzZSAxMDppZiAobWF0Y2hlcykge19jb250ZXh0MTEubmV4dCA9IDE0O2JyZWFrO31fZXJyb3IzID0gZ2V0SW50ZXJuYWxSb3V0ZXJFcnJvcig0MDQsIHsgcGF0aG5hbWU6IGxvY2F0aW9uLnBhdGhuYW1lIH0pO19nZXRTaG9ydENpcmN1aXRNYXRjaDQgPSBnZXRTaG9ydENpcmN1aXRNYXRjaGVzKGRhdGFSb3V0ZXMpLCBub3RGb3VuZE1hdGNoZXMgPSBfZ2V0U2hvcnRDaXJjdWl0TWF0Y2g0Lm1hdGNoZXMsIF9yb3V0ZTIgPSBfZ2V0U2hvcnRDaXJjdWl0TWF0Y2g0LnJvdXRlO3JldHVybiBfY29udGV4dDExLmFicnVwdCgicmV0dXJuIiwgeyBiYXNlbmFtZTogYmFzZW5hbWUsIGxvY2F0aW9uOiBsb2NhdGlvbiwgbWF0Y2hlczogbm90Rm91bmRNYXRjaGVzLCBsb2FkZXJEYXRhOiB7fSwgYWN0aW9uRGF0YTogbnVsbCwgZXJyb3JzOiBfZGVmaW5lUHJvcGVydHkyKHt9LCBfcm91dGUyLmlkLCBfZXJyb3IzKSwgc3RhdHVzQ29kZTogX2Vycm9yMy5zdGF0dXMsIGxvYWRlckhlYWRlcnM6IHt9LCBhY3Rpb25IZWFkZXJzOiB7fSB9KTtjYXNlIDE0Ol9jb250ZXh0MTEubmV4dCA9IDE2O3JldHVybiBxdWVyeUltcGwocmVxdWVzdCwgbG9jYXRpb24sIG1hdGNoZXMpO2Nhc2UgMTY6cmVzdWx0ID0gX2NvbnRleHQxMS5zZW50O2lmICghKHJlc3VsdCBpbnN0YW5jZW9mIFJlc3BvbnNlKSkge19jb250ZXh0MTEubmV4dCA9IDE5O2JyZWFrO31yZXR1cm4gX2NvbnRleHQxMS5hYnJ1cHQoInJldHVybiIsIHJlc3VsdCk7Y2FzZSAxOTpyZXR1cm4gX2NvbnRleHQxMS5hYnJ1cHQoInJldHVybiIsIF9leHRlbmRzKHsgbG9jYXRpb246IGxvY2F0aW9uLCBiYXNlbmFtZTogYmFzZW5hbWUgfSwgcmVzdWx0KSk7Y2FzZSAyMDpjYXNlICJlbmQiOnJldHVybiBfY29udGV4dDExLnN0b3AoKTt9fX0sIF9jYWxsZWUxMSk7fSkpO3JldHVybiBfcXVlcnkuYXBwbHkodGhpcywgYXJndW1lbnRzKTt9ZnVuY3Rpb24KCiAgICAgICAgICAgIHF1ZXJ5Um91dGUoX3g0MiwgX3g0Mykge3JldHVybiBfcXVlcnlSb3V0ZS5hcHBseSh0aGlzLCBhcmd1bWVudHMpO31mdW5jdGlvbiBfcXVlcnlSb3V0ZSgpIHtfcXVlcnlSb3V0ZSA9IF9hc3luY1RvR2VuZXJhdG9yMiggLyojX19QVVJFX18qL19yZWdlbmVyYXRvclJ1bnRpbWUyKCkubWFyayhmdW5jdGlvbiBfY2FsbGVlMTIocmVxdWVzdCwgcm91dGVJZCkge3ZhciB1cmwsIG1ldGhvZCwgbG9jYXRpb24sIG1hdGNoZXMsIG1hdGNoLCByZXN1bHQsIGVycm9yLCByb3V0ZURhdGE7cmV0dXJuIF9yZWdlbmVyYXRvclJ1bnRpbWUyKCkud3JhcChmdW5jdGlvbiBfY2FsbGVlMTIkKF9jb250ZXh0MTIpIHt3aGlsZSAoMSkge3N3aXRjaCAoX2NvbnRleHQxMi5wcmV2ID0gX2NvbnRleHQxMi5uZXh0KSB7Y2FzZSAwOgogICAgICAgICAgICAgICAgICAgICAgICB1cmwgPSBuZXcgVVJMKHJlcXVlc3QudXJsKTsKICAgICAgICAgICAgICAgICAgICAgICAgbWV0aG9kID0gcmVxdWVzdC5tZXRob2QudG9Mb3dlckNhc2UoKTsKICAgICAgICAgICAgICAgICAgICAgICAgbG9jYXRpb24gPSBjcmVhdGVMb2NhdGlvbigiIiwgcm91dGVyX2NyZWF0ZVBhdGgodXJsKSwgbnVsbCwgImRlZmF1bHQiKTsKICAgICAgICAgICAgICAgICAgICAgICAgbWF0Y2hlcyA9IG1hdGNoUm91dGVzKGRhdGFSb3V0ZXMsIGxvY2F0aW9uLCBiYXNlbmFtZSk7IC8vIFNTUiBzdXBwb3J0cyBIRUFEIHJlcXVlc3RzIHdoaWxlIFNQQSBkb2Vzbid0CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghKAogICAgICAgICAgICAgICAgICAgICAgICAhaXNWYWxpZE1ldGhvZChtZXRob2QpICYmIG1ldGhvZCAhPT0gImhlYWQiKSkge19jb250ZXh0MTIubmV4dCA9IDg7YnJlYWs7fXRocm93ICgKICAgICAgICAgICAgICAgICAgICAgICAgICBnZXRJbnRlcm5hbFJvdXRlckVycm9yKDQwNSwgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgbWV0aG9kOiBtZXRob2QKICAgICAgICAgICAgICAgICAgICAgICAgICB9KSk7Y2FzZSA4OmlmICgKICAgICAgICAgICAgICAgICAgICAgICAgbWF0Y2hlcykge19jb250ZXh0MTIubmV4dCA9IDEwO2JyZWFrO310aHJvdyAoCiAgICAgICAgICAgICAgICAgICAgICAgICAgZ2V0SW50ZXJuYWxSb3V0ZXJFcnJvcig0MDQsIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhdGhuYW1lOiBsb2NhdGlvbi5wYXRobmFtZQogICAgICAgICAgICAgICAgICAgICAgICAgIH0pKTtjYXNlIDEwOgoKCiAgICAgICAgICAgICAgICAgICAgICAgIG1hdGNoID0gcm91dGVJZCA/IG1hdGNoZXMuZmluZCgobSkgPT4gbS5yb3V0ZS5pZCA9PT0gcm91dGVJZCkgOiBnZXRUYXJnZXRNYXRjaChtYXRjaGVzLCBsb2NhdGlvbik7aWYgKCEoCgogICAgICAgICAgICAgICAgICAgICAgICByb3V0ZUlkICYmICFtYXRjaCkpIHtfY29udGV4dDEyLm5leHQgPSAxNTticmVhazt9dGhyb3cgKAogICAgICAgICAgICAgICAgICAgICAgICAgIGdldEludGVybmFsUm91dGVyRXJyb3IoNDAzLCB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXRobmFtZTogbG9jYXRpb24ucGF0aG5hbWUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByb3V0ZUlkOiByb3V0ZUlkCiAgICAgICAgICAgICAgICAgICAgICAgICAgfSkpO2Nhc2UgMTU6aWYgKAogICAgICAgICAgICAgICAgICAgICAgICBtYXRjaCkge19jb250ZXh0MTIubmV4dCA9IDE3O2JyZWFrO310aHJvdyAoCgogICAgICAgICAgICAgICAgICAgICAgICAgIGdldEludGVybmFsUm91dGVyRXJyb3IoNDA0LCB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXRobmFtZTogbG9jYXRpb24ucGF0aG5hbWUKICAgICAgICAgICAgICAgICAgICAgICAgICB9KSk7Y2FzZSAxNzpfY29udGV4dDEyLm5leHQgPSAxOTtyZXR1cm4gKAoKCiAgICAgICAgICAgICAgICAgICAgICAgICAgcXVlcnlJbXBsKHJlcXVlc3QsIGxvY2F0aW9uLCBtYXRjaGVzLCBtYXRjaCkpO2Nhc2UgMTk6cmVzdWx0ID0gX2NvbnRleHQxMi5zZW50O2lmICghKAoKICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0IGluc3RhbmNlb2YgUmVzcG9uc2UpKSB7X2NvbnRleHQxMi5uZXh0ID0gMjI7YnJlYWs7fXJldHVybiBfY29udGV4dDEyLmFicnVwdCgicmV0dXJuIiwKICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0KTtjYXNlIDIyOgoKCiAgICAgICAgICAgICAgICAgICAgICAgIGVycm9yID0gcmVzdWx0LmVycm9ycyA/IE9iamVjdC52YWx1ZXMocmVzdWx0LmVycm9ycylbMF0gOiB1bmRlZmluZWQ7aWYgKCEoCgogICAgICAgICAgICAgICAgICAgICAgICBlcnJvciAhPT0gdW5kZWZpbmVkKSkge19jb250ZXh0MTIubmV4dCA9IDI1O2JyZWFrO310aHJvdyAoCgoKCgogICAgICAgICAgICAgICAgICAgICAgICAgIGVycm9yKTtjYXNlIDI1OgogICAgICAgICAgICAgICAgICAgICAgICAvLyBQaWNrIG9mZiB0aGUgcmlnaHQgc3RhdGUgdmFsdWUgdG8gcmV0dXJuCgoKICAgICAgICAgICAgICAgICAgICAgICAgcm91dGVEYXRhID0gW3Jlc3VsdC5hY3Rpb25EYXRhLCByZXN1bHQubG9hZGVyRGF0YV0uZmluZCgodikgPT4gdik7cmV0dXJuIF9jb250ZXh0MTIuYWJydXB0KCJyZXR1cm4iLAogICAgICAgICAgICAgICAgICAgICAgICBPYmplY3QudmFsdWVzKHJvdXRlRGF0YSB8fCB7fSlbMF0pO2Nhc2UgMjc6Y2FzZSAiZW5kIjpyZXR1cm4gX2NvbnRleHQxMi5zdG9wKCk7fX19LCBfY2FsbGVlMTIpO30pKTtyZXR1cm4gX3F1ZXJ5Um91dGUuYXBwbHkodGhpcywgYXJndW1lbnRzKTt9ZnVuY3Rpb24KCgogICAgICAgICAgICBxdWVyeUltcGwoX3g0NCwgX3g0NSwgX3g0NiwgX3g0Nykge3JldHVybiBfcXVlcnlJbXBsLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7fWZ1bmN0aW9uIF9xdWVyeUltcGwoKSB7X3F1ZXJ5SW1wbCA9IF9hc3luY1RvR2VuZXJhdG9yMiggLyojX19QVVJFX18qL19yZWdlbmVyYXRvclJ1bnRpbWUyKCkubWFyayhmdW5jdGlvbiBfY2FsbGVlMTMocmVxdWVzdCwgbG9jYXRpb24sIG1hdGNoZXMsIHJvdXRlTWF0Y2gpIHt2YXIgX3Jlc3VsdCwgcmVzdWx0O3JldHVybiBfcmVnZW5lcmF0b3JSdW50aW1lMigpLndyYXAoZnVuY3Rpb24gX2NhbGxlZTEzJChfY29udGV4dDEzKSB7d2hpbGUgKDEpIHtzd2l0Y2ggKF9jb250ZXh0MTMucHJldiA9IF9jb250ZXh0MTMubmV4dCkge2Nhc2UgMDoKICAgICAgICAgICAgICAgICAgICAgICAgcm91dGVyX2ludmFyaWFudChyZXF1ZXN0LnNpZ25hbCwgInF1ZXJ5KCkvcXVlcnlSb3V0ZSgpIHJlcXVlc3RzIG11c3QgY29udGFpbiBhbiBBYm9ydENvbnRyb2xsZXIgc2lnbmFsIik7X2NvbnRleHQxMy5wcmV2ID0gMTtpZiAoIQoKCiAgICAgICAgICAgICAgICAgICAgICAgIGlzU3VibWlzc2lvbk1ldGhvZChyZXF1ZXN0Lm1ldGhvZC50b0xvd2VyQ2FzZSgpKSkge19jb250ZXh0MTMubmV4dCA9IDc7YnJlYWs7fV9jb250ZXh0MTMubmV4dCA9IDU7cmV0dXJuICgKICAgICAgICAgICAgICAgICAgICAgICAgICBzdWJtaXQocmVxdWVzdCwgbWF0Y2hlcywgcm91dGVNYXRjaCB8fCBnZXRUYXJnZXRNYXRjaChtYXRjaGVzLCBsb2NhdGlvbiksIHJvdXRlTWF0Y2ggIT0gbnVsbCkpO2Nhc2UgNTpfcmVzdWx0ID0gX2NvbnRleHQxMy5zZW50O3JldHVybiBfY29udGV4dDEzLmFicnVwdCgicmV0dXJuIiwKICAgICAgICAgICAgICAgICAgICAgICAgX3Jlc3VsdCk7Y2FzZSA3Ol9jb250ZXh0MTMubmV4dCA9IDk7cmV0dXJuICgKCgogICAgICAgICAgICAgICAgICAgICAgICAgIGxvYWRSb3V0ZURhdGEocmVxdWVzdCwgbWF0Y2hlcywgcm91dGVNYXRjaCkpO2Nhc2UgOTpyZXN1bHQgPSBfY29udGV4dDEzLnNlbnQ7cmV0dXJuIF9jb250ZXh0MTMuYWJydXB0KCJyZXR1cm4iLAogICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQgaW5zdGFuY2VvZiBSZXNwb25zZSA/IHJlc3VsdCA6IF9leHRlbmRzKHt9LCByZXN1bHQsIHsKICAgICAgICAgICAgICAgICAgICAgICAgICBhY3Rpb25EYXRhOiBudWxsLAogICAgICAgICAgICAgICAgICAgICAgICAgIGFjdGlvbkhlYWRlcnM6IHt9CiAgICAgICAgICAgICAgICAgICAgICAgIH0pKTtjYXNlIDEzOl9jb250ZXh0MTMucHJldiA9IDEzO19jb250ZXh0MTMudDAgPSBfY29udGV4dDEzWyJjYXRjaCJdKDEpO2lmICghCgoKCgogICAgICAgICAgICAgICAgICAgICAgICBpc1F1ZXJ5Um91dGVSZXNwb25zZShfY29udGV4dDEzLnQwKSkge19jb250ZXh0MTMubmV4dCA9IDE5O2JyZWFrO31pZiAoISgKICAgICAgICAgICAgICAgICAgICAgICAgX2NvbnRleHQxMy50MC50eXBlID09PSBSZXN1bHRUeXBlLmVycm9yICYmICFpc1JlZGlyZWN0UmVzcG9uc2UoX2NvbnRleHQxMy50MC5yZXNwb25zZSkpKSB7X2NvbnRleHQxMy5uZXh0ID0gMTg7YnJlYWs7fXRocm93ICgKICAgICAgICAgICAgICAgICAgICAgICAgICBfY29udGV4dDEzLnQwLnJlc3BvbnNlKTtjYXNlIDE4OnJldHVybiBfY29udGV4dDEzLmFicnVwdCgicmV0dXJuIiwKCgogICAgICAgICAgICAgICAgICAgICAgICBfY29udGV4dDEzLnQwLnJlc3BvbnNlKTtjYXNlIDE5OmlmICghCgoKCgogICAgICAgICAgICAgICAgICAgICAgICBpc1JlZGlyZWN0UmVzcG9uc2UoX2NvbnRleHQxMy50MCkpIHtfY29udGV4dDEzLm5leHQgPSAyMTticmVhazt9cmV0dXJuIF9jb250ZXh0MTMuYWJydXB0KCJyZXR1cm4iLCBfY29udGV4dDEzLnQwKTtjYXNlIDIxOnRocm93IF9jb250ZXh0MTMudDA7Y2FzZSAyMjpjYXNlICJlbmQiOnJldHVybiBfY29udGV4dDEzLnN0b3AoKTt9fX0sIF9jYWxsZWUxMywgbnVsbCwgW1sxLCAxM11dKTt9KSk7cmV0dXJuIF9xdWVyeUltcGwuYXBwbHkodGhpcywgYXJndW1lbnRzKTt9ZnVuY3Rpb24KCgoKCgoKCiAgICAgICAgICAgIHN1Ym1pdChfeDQ4LCBfeDQ5LCBfeDUwLCBfeDUxKSB7cmV0dXJuIF9zdWJtaXQuYXBwbHkodGhpcywgYXJndW1lbnRzKTt9ZnVuY3Rpb24gX3N1Ym1pdCgpIHtfc3VibWl0ID0gX2FzeW5jVG9HZW5lcmF0b3IyKCAvKiNfX1BVUkVfXyovX3JlZ2VuZXJhdG9yUnVudGltZTIoKS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUxNChyZXF1ZXN0LCBtYXRjaGVzLCBhY3Rpb25NYXRjaCwgaXNSb3V0ZVJlcXVlc3QpIHt2YXIgcmVzdWx0LCBlcnJvciwgbWV0aG9kLCBib3VuZGFyeU1hdGNoLCBfY29udGV4dDE0LCBjb250ZXh0O3JldHVybiBfcmVnZW5lcmF0b3JSdW50aW1lMigpLndyYXAoZnVuY3Rpb24gX2NhbGxlZTE0JChfY29udGV4dDE1KSB7d2hpbGUgKDEpIHtzd2l0Y2ggKF9jb250ZXh0MTUucHJldiA9IF9jb250ZXh0MTUubmV4dCkge2Nhc2UgMDppZiAoCgoKICAgICAgICAgICAgICAgICAgICAgICAgYWN0aW9uTWF0Y2gucm91dGUuYWN0aW9uKSB7X2NvbnRleHQxNS5uZXh0ID0gNzticmVhazt9CiAgICAgICAgICAgICAgICAgICAgICAgIGVycm9yID0gZ2V0SW50ZXJuYWxSb3V0ZXJFcnJvcig0MDUsIHsKICAgICAgICAgICAgICAgICAgICAgICAgICBtZXRob2Q6IHJlcXVlc3QubWV0aG9kLAogICAgICAgICAgICAgICAgICAgICAgICAgIHBhdGhuYW1lOiBjcmVhdGVVUkwocmVxdWVzdC51cmwpLnBhdGhuYW1lLAogICAgICAgICAgICAgICAgICAgICAgICAgIHJvdXRlSWQ6IGFjdGlvbk1hdGNoLnJvdXRlLmlkCiAgICAgICAgICAgICAgICAgICAgICAgIH0pO2lmICghCgogICAgICAgICAgICAgICAgICAgICAgICBpc1JvdXRlUmVxdWVzdCkge19jb250ZXh0MTUubmV4dCA9IDQ7YnJlYWs7fXRocm93ICgKICAgICAgICAgICAgICAgICAgICAgICAgICBlcnJvcik7Y2FzZSA0OgoKCiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdCA9IHsKICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiBSZXN1bHRUeXBlLmVycm9yLAogICAgICAgICAgICAgICAgICAgICAgICAgIGVycm9yOiBlcnJvcgogICAgICAgICAgICAgICAgICAgICAgICB9O19jb250ZXh0MTUubmV4dCA9IDEzO2JyZWFrO2Nhc2UgNzpfY29udGV4dDE1Lm5leHQgPSA5O3JldHVybiAoCgogICAgICAgICAgICAgICAgICAgICAgICAgIGNhbGxMb2FkZXJPckFjdGlvbigiYWN0aW9uIiwgcmVxdWVzdCwgYWN0aW9uTWF0Y2gsIG1hdGNoZXMsIGJhc2VuYW1lLCB0cnVlLCBpc1JvdXRlUmVxdWVzdCkpO2Nhc2UgOTpyZXN1bHQgPSBfY29udGV4dDE1LnNlbnQ7aWYgKCEKCiAgICAgICAgICAgICAgICAgICAgICAgIHJlcXVlc3Quc2lnbmFsLmFib3J0ZWQpIHtfY29udGV4dDE1Lm5leHQgPSAxMzticmVhazt9CiAgICAgICAgICAgICAgICAgICAgICAgIG1ldGhvZCA9IGlzUm91dGVSZXF1ZXN0ID8gInF1ZXJ5Um91dGUiIDogInF1ZXJ5Ijt0aHJvdyAoCiAgICAgICAgICAgICAgICAgICAgICAgICAgbmV3IEVycm9yKG1ldGhvZCArICIoKSBjYWxsIGFib3J0ZWQiKSk7Y2FzZSAxMzppZiAoIQoKCgogICAgICAgICAgICAgICAgICAgICAgICBpc1JlZGlyZWN0UmVzdWx0KHJlc3VsdCkpIHtfY29udGV4dDE1Lm5leHQgPSAxNTticmVhazt9dGhyb3cgKAoKCgoKICAgICAgICAgICAgICAgICAgICAgICAgICBuZXcgUmVzcG9uc2UobnVsbCwgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhdHVzOiByZXN1bHQuc3RhdHVzLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgaGVhZGVyczogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBMb2NhdGlvbjogcmVzdWx0LmxvY2F0aW9uCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgfSkpO2Nhc2UgMTU6aWYgKCEKCgogICAgICAgICAgICAgICAgICAgICAgICBpc0RlZmVycmVkUmVzdWx0KHJlc3VsdCkpIHtfY29udGV4dDE1Lm5leHQgPSAxNzticmVhazt9dGhyb3cgKAogICAgICAgICAgICAgICAgICAgICAgICAgIG5ldyBFcnJvcigiZGVmZXIoKSBpcyBub3Qgc3VwcG9ydGVkIGluIGFjdGlvbnMiKSk7Y2FzZSAxNzppZiAoIQoKCiAgICAgICAgICAgICAgICAgICAgICAgIGlzUm91dGVSZXF1ZXN0KSB7X2NvbnRleHQxNS5uZXh0ID0gMjE7YnJlYWs7fWlmICghCgoKICAgICAgICAgICAgICAgICAgICAgICAgaXNFcnJvclJlc3VsdChyZXN1bHQpKSB7X2NvbnRleHQxNS5uZXh0ID0gMjA7YnJlYWs7fXRocm93ICgKICAgICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQuZXJyb3IpO2Nhc2UgMjA6cmV0dXJuIF9jb250ZXh0MTUuYWJydXB0KCJyZXR1cm4iLAoKCiAgICAgICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgICBtYXRjaGVzOiBbYWN0aW9uTWF0Y2hdLAogICAgICAgICAgICAgICAgICAgICAgICAgIGxvYWRlckRhdGE6IHt9LAogICAgICAgICAgICAgICAgICAgICAgICAgIGFjdGlvbkRhdGE6IF9kZWZpbmVQcm9wZXJ0eTIoe30sCiAgICAgICAgICAgICAgICAgICAgICAgICAgYWN0aW9uTWF0Y2gucm91dGUuaWQsIHJlc3VsdC5kYXRhKSwKCiAgICAgICAgICAgICAgICAgICAgICAgICAgZXJyb3JzOiBudWxsLAogICAgICAgICAgICAgICAgICAgICAgICAgIC8vIE5vdGU6IHN0YXR1c0NvZGUgKyBoZWFkZXJzIGFyZSB1bnVzZWQgaGVyZSBzaW5jZSBxdWVyeVJvdXRlIHdpbGwKICAgICAgICAgICAgICAgICAgICAgICAgICAvLyByZXR1cm4gdGhlIHJhdyBSZXNwb25zZSBvciB2YWx1ZQogICAgICAgICAgICAgICAgICAgICAgICAgIHN0YXR1c0NvZGU6IDIwMCwKICAgICAgICAgICAgICAgICAgICAgICAgICBsb2FkZXJIZWFkZXJzOiB7fSwKICAgICAgICAgICAgICAgICAgICAgICAgICBhY3Rpb25IZWFkZXJzOiB7fQogICAgICAgICAgICAgICAgICAgICAgICB9KTtjYXNlIDIxOmlmICghCgoKICAgICAgICAgICAgICAgICAgICAgICAgaXNFcnJvclJlc3VsdChyZXN1bHQpKSB7X2NvbnRleHQxNS5uZXh0ID0gMjc7YnJlYWs7fQogICAgICAgICAgICAgICAgICAgICAgICAvLyBTdG9yZSBvZmYgdGhlIHBlbmRpbmcgZXJyb3IgLSB3ZSB1c2UgaXQgdG8gZGV0ZXJtaW5lIHdoaWNoIGxvYWRlcnMKICAgICAgICAgICAgICAgICAgICAgICAgLy8gdG8gY2FsbCBhbmQgd2lsbCBjb21taXQgaXQgd2hlbiB3ZSBjb21wbGV0ZSB0aGUgbmF2aWdhdGlvbgogICAgICAgICAgICAgICAgICAgICAgICBib3VuZGFyeU1hdGNoID0gZmluZE5lYXJlc3RCb3VuZGFyeShtYXRjaGVzLCBhY3Rpb25NYXRjaC5yb3V0ZS5pZCk7X2NvbnRleHQxNS5uZXh0ID0gMjU7cmV0dXJuICgKICAgICAgICAgICAgICAgICAgICAgICAgICBsb2FkUm91dGVEYXRhKHJlcXVlc3QsIG1hdGNoZXMsIHVuZGVmaW5lZCwgX2RlZmluZVByb3BlcnR5Mih7fSwKICAgICAgICAgICAgICAgICAgICAgICAgICBib3VuZGFyeU1hdGNoLnJvdXRlLmlkLCByZXN1bHQuZXJyb3IpKSk7Y2FzZSAyNTpfY29udGV4dDE0ID0gX2NvbnRleHQxNS5zZW50O3JldHVybiBfY29udGV4dDE1LmFicnVwdCgicmV0dXJuIiwKCgogICAgICAgICAgICAgICAgICAgICAgICBfZXh0ZW5kcyh7fSwgX2NvbnRleHQxNCwgewogICAgICAgICAgICAgICAgICAgICAgICAgIHN0YXR1c0NvZGU6IGlzUm91dGVFcnJvclJlc3BvbnNlKHJlc3VsdC5lcnJvcikgPyByZXN1bHQuZXJyb3Iuc3RhdHVzIDogNTAwLAogICAgICAgICAgICAgICAgICAgICAgICAgIGFjdGlvbkRhdGE6IG51bGwsCiAgICAgICAgICAgICAgICAgICAgICAgICAgYWN0aW9uSGVhZGVyczogX2V4dGVuZHMoe30sIHJlc3VsdC5oZWFkZXJzID8gX2RlZmluZVByb3BlcnR5Mih7fSwKICAgICAgICAgICAgICAgICAgICAgICAgICBhY3Rpb25NYXRjaC5yb3V0ZS5pZCwgcmVzdWx0LmhlYWRlcnMpIDoKICAgICAgICAgICAgICAgICAgICAgICAgICB7fSkKICAgICAgICAgICAgICAgICAgICAgICAgfSkpO2Nhc2UgMjc6X2NvbnRleHQxNS5uZXh0ID0gMjk7cmV0dXJuICgKCgogICAgICAgICAgICAgICAgICAgICAgICAgIGxvYWRSb3V0ZURhdGEocmVxdWVzdCwgbWF0Y2hlcykpO2Nhc2UgMjk6Y29udGV4dCA9IF9jb250ZXh0MTUuc2VudDtyZXR1cm4gX2NvbnRleHQxNS5hYnJ1cHQoInJldHVybiIsCiAgICAgICAgICAgICAgICAgICAgICAgIF9leHRlbmRzKHt9LCBjb250ZXh0LCByZXN1bHQuc3RhdHVzQ29kZSA/IHsKICAgICAgICAgICAgICAgICAgICAgICAgICBzdGF0dXNDb2RlOiByZXN1bHQuc3RhdHVzQ29kZQogICAgICAgICAgICAgICAgICAgICAgICB9IDoge30sIHsKICAgICAgICAgICAgICAgICAgICAgICAgICBhY3Rpb25EYXRhOiBfZGVmaW5lUHJvcGVydHkyKHt9LAogICAgICAgICAgICAgICAgICAgICAgICAgIGFjdGlvbk1hdGNoLnJvdXRlLmlkLCByZXN1bHQuZGF0YSksCgogICAgICAgICAgICAgICAgICAgICAgICAgIGFjdGlvbkhlYWRlcnM6IF9leHRlbmRzKHt9LCByZXN1bHQuaGVhZGVycyA/IF9kZWZpbmVQcm9wZXJ0eTIoe30sCiAgICAgICAgICAgICAgICAgICAgICAgICAgYWN0aW9uTWF0Y2gucm91dGUuaWQsIHJlc3VsdC5oZWFkZXJzKSA6CiAgICAgICAgICAgICAgICAgICAgICAgICAge30pCiAgICAgICAgICAgICAgICAgICAgICAgIH0pKTtjYXNlIDMxOmNhc2UgImVuZCI6cmV0dXJuIF9jb250ZXh0MTUuc3RvcCgpO319fSwgX2NhbGxlZTE0KTt9KSk7cmV0dXJuIF9zdWJtaXQuYXBwbHkodGhpcywgYXJndW1lbnRzKTt9ZnVuY3Rpb24KCgogICAgICAgICAgICBsb2FkUm91dGVEYXRhKF94NTIsIF94NTMsIF94NTQsIF94NTUpIHtyZXR1cm4gX2xvYWRSb3V0ZURhdGEuYXBwbHkodGhpcywgYXJndW1lbnRzKTt9ZnVuY3Rpb24gX2xvYWRSb3V0ZURhdGEoKSB7X2xvYWRSb3V0ZURhdGEgPSBfYXN5bmNUb0dlbmVyYXRvcjIoIC8qI19fUFVSRV9fKi9fcmVnZW5lcmF0b3JSdW50aW1lMigpLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTE1KHJlcXVlc3QsIG1hdGNoZXMsIHJvdXRlTWF0Y2gsIHBlbmRpbmdBY3Rpb25FcnJvcikge3ZhciBpc1JvdXRlUmVxdWVzdCwgcmVxdWVzdE1hdGNoZXMsIG1hdGNoZXNUb0xvYWQsIHJlc3VsdHMsIG1ldGhvZCwgY29udGV4dDtyZXR1cm4gX3JlZ2VuZXJhdG9yUnVudGltZTIoKS53cmFwKGZ1bmN0aW9uIF9jYWxsZWUxNSQoX2NvbnRleHQxNikge3doaWxlICgxKSB7c3dpdGNoIChfY29udGV4dDE2LnByZXYgPSBfY29udGV4dDE2Lm5leHQpIHtjYXNlIDA6CiAgICAgICAgICAgICAgICAgICAgICAgIGlzUm91dGVSZXF1ZXN0ID0gcm91dGVNYXRjaCAhPSBudWxsOyAvLyBTaG9ydCBjaXJjdWl0IGlmIHdlIGhhdmUgbm8gbG9hZGVycyB0byBydW4gKHF1ZXJ5Um91dGUoKSkKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCEoCiAgICAgICAgICAgICAgICAgICAgICAgIGlzUm91dGVSZXF1ZXN0ICYmICEocm91dGVNYXRjaCAhPSBudWxsICYmIHJvdXRlTWF0Y2gucm91dGUubG9hZGVyKSkpIHtfY29udGV4dDE2Lm5leHQgPSAzO2JyZWFrO310aHJvdyAoCiAgICAgICAgICAgICAgICAgICAgICAgICAgZ2V0SW50ZXJuYWxSb3V0ZXJFcnJvcig0MDAsIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1ldGhvZDogcmVxdWVzdC5tZXRob2QsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXRobmFtZTogY3JlYXRlVVJMKHJlcXVlc3QudXJsKS5wYXRobmFtZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJvdXRlSWQ6IHJvdXRlTWF0Y2ggPT0gbnVsbCA/IHZvaWQgMCA6IHJvdXRlTWF0Y2gucm91dGUuaWQKICAgICAgICAgICAgICAgICAgICAgICAgICB9KSk7Y2FzZSAzOgoKCiAgICAgICAgICAgICAgICAgICAgICAgIHJlcXVlc3RNYXRjaGVzID0gcm91dGVNYXRjaCA/IFtyb3V0ZU1hdGNoXSA6IGdldExvYWRlck1hdGNoZXNVbnRpbEJvdW5kYXJ5KG1hdGNoZXMsIE9iamVjdC5rZXlzKHBlbmRpbmdBY3Rpb25FcnJvciB8fCB7fSlbMF0pOwogICAgICAgICAgICAgICAgICAgICAgICBtYXRjaGVzVG9Mb2FkID0gcmVxdWVzdE1hdGNoZXMuZmlsdGVyKChtKSA9PiBtLnJvdXRlLmxvYWRlcik7IC8vIFNob3J0IGNpcmN1aXQgaWYgd2UgaGF2ZSBubyBsb2FkZXJzIHRvIHJ1biAocXVlcnkoKSkKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCEoCiAgICAgICAgICAgICAgICAgICAgICAgIG1hdGNoZXNUb0xvYWQubGVuZ3RoID09PSAwKSkge19jb250ZXh0MTYubmV4dCA9IDc7YnJlYWs7fXJldHVybiBfY29udGV4dDE2LmFicnVwdCgicmV0dXJuIiwKICAgICAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICAgIG1hdGNoZXM6IG1hdGNoZXMsCiAgICAgICAgICAgICAgICAgICAgICAgICAgbG9hZGVyRGF0YToge30sCiAgICAgICAgICAgICAgICAgICAgICAgICAgZXJyb3JzOiBwZW5kaW5nQWN0aW9uRXJyb3IgfHwgbnVsbCwKICAgICAgICAgICAgICAgICAgICAgICAgICBzdGF0dXNDb2RlOiAyMDAsCiAgICAgICAgICAgICAgICAgICAgICAgICAgbG9hZGVySGVhZGVyczoge30KICAgICAgICAgICAgICAgICAgICAgICAgfSk7Y2FzZSA3Ol9jb250ZXh0MTYubmV4dCA9IDk7cmV0dXJuICgKCgogICAgICAgICAgICAgICAgICAgICAgICAgIFByb21pc2UuYWxsKF90b0NvbnN1bWFibGVBcnJheTIobWF0Y2hlc1RvTG9hZC5tYXAoKG1hdGNoKSA9PiBjYWxsTG9hZGVyT3JBY3Rpb24oImxvYWRlciIsIHJlcXVlc3QsIG1hdGNoLCBtYXRjaGVzLCBiYXNlbmFtZSwgdHJ1ZSwgaXNSb3V0ZVJlcXVlc3QpKSkpKTtjYXNlIDk6cmVzdWx0cyA9IF9jb250ZXh0MTYuc2VudDtpZiAoIQoKICAgICAgICAgICAgICAgICAgICAgICAgcmVxdWVzdC5zaWduYWwuYWJvcnRlZCkge19jb250ZXh0MTYubmV4dCA9IDEzO2JyZWFrO30KICAgICAgICAgICAgICAgICAgICAgICAgbWV0aG9kID0gaXNSb3V0ZVJlcXVlc3QgPyAicXVlcnlSb3V0ZSIgOiAicXVlcnkiO3Rocm93ICgKICAgICAgICAgICAgICAgICAgICAgICAgICBuZXcgRXJyb3IobWV0aG9kICsgIigpIGNhbGwgYWJvcnRlZCIpKTtjYXNlIDEzOgogICAgICAgICAgICAgICAgICAgICAgICAvLyBDYW4ndCBkbyBhbnl0aGluZyB3aXRoIHRoZXNlIHdpdGhvdXQgdGhlIFJlbWl4IHNpZGUgb2YgdGhpbmdzLCBzbyBqdXN0CiAgICAgICAgICAgICAgICAgICAgICAgIC8vIGNhbmNlbCB0aGVtIGZvciBub3cKCgogICAgICAgICAgICAgICAgICAgICAgICByZXN1bHRzLmZvckVhY2goKHJlc3VsdCkgPT4gewogICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpc0RlZmVycmVkUmVzdWx0KHJlc3VsdCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdC5kZWZlcnJlZERhdGEuY2FuY2VsKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9KTsgLy8gUHJvY2VzcyBhbmQgY29tbWl0IG91dHB1dCBmcm9tIGxvYWRlcnMKCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRleHQgPSBwcm9jZXNzUm91dGVMb2FkZXJEYXRhKG1hdGNoZXMsIG1hdGNoZXNUb0xvYWQsIHJlc3VsdHMsIHBlbmRpbmdBY3Rpb25FcnJvcik7cmV0dXJuIF9jb250ZXh0MTYuYWJydXB0KCJyZXR1cm4iLAogICAgICAgICAgICAgICAgICAgICAgICBfZXh0ZW5kcyh7fSwgY29udGV4dCwgewogICAgICAgICAgICAgICAgICAgICAgICAgIG1hdGNoZXM6IG1hdGNoZXMKICAgICAgICAgICAgICAgICAgICAgICAgfSkpO2Nhc2UgMTY6Y2FzZSAiZW5kIjpyZXR1cm4gX2NvbnRleHQxNi5zdG9wKCk7fX19LCBfY2FsbGVlMTUpO30pKTtyZXR1cm4gX2xvYWRSb3V0ZURhdGEuYXBwbHkodGhpcywgYXJndW1lbnRzKTt9CgoKICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICBkYXRhUm91dGVzOiBkYXRhUm91dGVzLAogICAgICAgICAgICAgIHF1ZXJ5OiBxdWVyeSwKICAgICAgICAgICAgICBxdWVyeVJvdXRlOiBxdWVyeVJvdXRlCiAgICAgICAgICAgIH07CiAgICAgICAgICB9IC8vI2VuZHJlZ2lvbgogICAgICAgICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KICAgICAgICAgIC8vI3JlZ2lvbiBIZWxwZXJzCiAgICAgICAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwoKICAgICAgICAgIC8qKgogICAgICAgICAgICogR2l2ZW4gYW4gZXhpc3RpbmcgU3RhdGljSGFuZGxlckNvbnRleHQgYW5kIGFuIGVycm9yIHRocm93biBhdCByZW5kZXIgdGltZSwKICAgICAgICAgICAqIHByb3ZpZGUgYW4gdXBkYXRlZCBTdGF0aWNIYW5kbGVyQ29udGV4dCBzdWl0YWJsZSBmb3IgYSBzZWNvbmQgU1NSIHJlbmRlcgogICAgICAgICAgICovCgogICAgICAgICAgZnVuY3Rpb24gZ2V0U3RhdGljQ29udGV4dEZyb21FcnJvcihyb3V0ZXMsIGNvbnRleHQsIGVycm9yKSB7CiAgICAgICAgICAgIHZhciBuZXdDb250ZXh0ID0gX2V4dGVuZHMoe30sIGNvbnRleHQsIHsKICAgICAgICAgICAgICBzdGF0dXNDb2RlOiA1MDAsCiAgICAgICAgICAgICAgZXJyb3JzOiBfZGVmaW5lUHJvcGVydHkyKHt9LAogICAgICAgICAgICAgIGNvbnRleHQuX2RlZXBlc3RSZW5kZXJlZEJvdW5kYXJ5SWQgfHwgcm91dGVzWzBdLmlkLCBlcnJvcikKCiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgcmV0dXJuIG5ld0NvbnRleHQ7CiAgICAgICAgICB9CgogICAgICAgICAgZnVuY3Rpb24gaXNTdWJtaXNzaW9uTmF2aWdhdGlvbihvcHRzKSB7CiAgICAgICAgICAgIHJldHVybiBvcHRzICE9IG51bGwgJiYgImZvcm1EYXRhIiBpbiBvcHRzOwogICAgICAgICAgfSAvLyBOb3JtYWxpemUgbmF2aWdhdGlvbiBvcHRpb25zIGJ5IGNvbnZlcnRpbmcgZm9ybU1ldGhvZD1HRVQgZm9ybURhdGEgb2JqZWN0cyB0bwogICAgICAgICAgLy8gVVJMU2VhcmNoUGFyYW1zIHNvIHRoZXkgYmVoYXZlIGlkZW50aWNhbGx5IHRvIGxpbmtzIHdpdGggcXVlcnkgcGFyYW1zCgoKICAgICAgICAgIGZ1bmN0aW9uIG5vcm1hbGl6ZU5hdmlnYXRlT3B0aW9ucyh0bywgb3B0cywgaXNGZXRjaGVyKSB7CiAgICAgICAgICAgIGlmIChpc0ZldGNoZXIgPT09IHZvaWQgMCkgewogICAgICAgICAgICAgIGlzRmV0Y2hlciA9IGZhbHNlOwogICAgICAgICAgICB9CgogICAgICAgICAgICB2YXIgcGF0aCA9IHR5cGVvZiB0byA9PT0gInN0cmluZyIgPyB0byA6IHJvdXRlcl9jcmVhdGVQYXRoKHRvKTsgLy8gUmV0dXJuIGxvY2F0aW9uIHZlcmJhdGltIG9uIG5vbi1zdWJtaXNzaW9uIG5hdmlnYXRpb25zCgogICAgICAgICAgICBpZiAoIW9wdHMgfHwgIWlzU3VibWlzc2lvbk5hdmlnYXRpb24ob3B0cykpIHsKICAgICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgcGF0aDogcGF0aAogICAgICAgICAgICAgIH07CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChvcHRzLmZvcm1NZXRob2QgJiYgIWlzVmFsaWRNZXRob2Qob3B0cy5mb3JtTWV0aG9kKSkgewogICAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICBwYXRoOiBwYXRoLAogICAgICAgICAgICAgICAgZXJyb3I6IGdldEludGVybmFsUm91dGVyRXJyb3IoNDA1LCB7CiAgICAgICAgICAgICAgICAgIG1ldGhvZDogb3B0cy5mb3JtTWV0aG9kCiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgIH07CiAgICAgICAgICAgIH0gLy8gQ3JlYXRlIGEgU3VibWlzc2lvbiBvbiBub24tR0VUIG5hdmlnYXRpb25zCgoKICAgICAgICAgICAgaWYgKG9wdHMuZm9ybU1ldGhvZCAmJiBpc1N1Ym1pc3Npb25NZXRob2Qob3B0cy5mb3JtTWV0aG9kKSkgewogICAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICBwYXRoOiBwYXRoLAogICAgICAgICAgICAgICAgc3VibWlzc2lvbjogewogICAgICAgICAgICAgICAgICBmb3JtTWV0aG9kOiBvcHRzLmZvcm1NZXRob2QsCiAgICAgICAgICAgICAgICAgIGZvcm1BY3Rpb246IHN0cmlwSGFzaEZyb21QYXRoKHBhdGgpLAogICAgICAgICAgICAgICAgICBmb3JtRW5jVHlwZTogb3B0cyAmJiBvcHRzLmZvcm1FbmNUeXBlIHx8ICJhcHBsaWNhdGlvbi94LXd3dy1mb3JtLXVybGVuY29kZWQiLAogICAgICAgICAgICAgICAgICBmb3JtRGF0YTogb3B0cy5mb3JtRGF0YQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH07CiAgICAgICAgICAgIH0gLy8gRmxhdHRlbiBzdWJtaXNzaW9uIG9udG8gVVJMU2VhcmNoUGFyYW1zIGZvciBHRVQgc3VibWlzc2lvbnMKCgogICAgICAgICAgICB2YXIgcGFyc2VkUGF0aCA9IHBhcnNlUGF0aChwYXRoKTsKCiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgdmFyIHNlYXJjaFBhcmFtcyA9IGNvbnZlcnRGb3JtRGF0YVRvU2VhcmNoUGFyYW1zKG9wdHMuZm9ybURhdGEpOyAvLyBTaW5jZSBmZXRjaGVyIEdFVCBzdWJtaXNzaW9ucyBvbmx5IHJ1biBhIHNpbmdsZSBsb2FkZXIgKGFzIG9wcG9zZWQgdG8KICAgICAgICAgICAgICAvLyBuYXZpZ2F0aW9uIEdFVCBzdWJtaXNzaW9ucyB3aGljaCBydW4gYWxsIGxvYWRlcnMpLCB3ZSBuZWVkIHRvIHByZXNlcnZlCiAgICAgICAgICAgICAgLy8gYW55IGluY29taW5nID9pbmRleCBwYXJhbXMKCiAgICAgICAgICAgICAgaWYgKGlzRmV0Y2hlciAmJiBwYXJzZWRQYXRoLnNlYXJjaCAmJiBoYXNOYWtlZEluZGV4UXVlcnkocGFyc2VkUGF0aC5zZWFyY2gpKSB7CiAgICAgICAgICAgICAgICBzZWFyY2hQYXJhbXMuYXBwZW5kKCJpbmRleCIsICIiKTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIHBhcnNlZFBhdGguc2VhcmNoID0gIj8iICsgc2VhcmNoUGFyYW1zOwogICAgICAgICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgIHBhdGg6IHBhdGgsCiAgICAgICAgICAgICAgICBlcnJvcjogZ2V0SW50ZXJuYWxSb3V0ZXJFcnJvcig0MDApCiAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICBwYXRoOiByb3V0ZXJfY3JlYXRlUGF0aChwYXJzZWRQYXRoKQogICAgICAgICAgICB9OwogICAgICAgICAgfSAvLyBGaWx0ZXIgb3V0IGFsbCByb3V0ZXMgYmVsb3cgYW55IGNhdWdodCBlcnJvciBhcyB0aGV5IGFyZW4ndCBnb2luZyB0bwogICAgICAgICAgLy8gcmVuZGVyIHNvIHdlIGRvbid0IG5lZWQgdG8gbG9hZCB0aGVtCgoKICAgICAgICAgIGZ1bmN0aW9uIGdldExvYWRlck1hdGNoZXNVbnRpbEJvdW5kYXJ5KG1hdGNoZXMsIGJvdW5kYXJ5SWQpIHsKICAgICAgICAgICAgdmFyIGJvdW5kYXJ5TWF0Y2hlcyA9IG1hdGNoZXM7CgogICAgICAgICAgICBpZiAoYm91bmRhcnlJZCkgewogICAgICAgICAgICAgIHZhciBpbmRleCA9IG1hdGNoZXMuZmluZEluZGV4KChtKSA9PiBtLnJvdXRlLmlkID09PSBib3VuZGFyeUlkKTsKCiAgICAgICAgICAgICAgaWYgKGluZGV4ID49IDApIHsKICAgICAgICAgICAgICAgIGJvdW5kYXJ5TWF0Y2hlcyA9IG1hdGNoZXMuc2xpY2UoMCwgaW5kZXgpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuIGJvdW5kYXJ5TWF0Y2hlczsKICAgICAgICAgIH0KCiAgICAgICAgICBmdW5jdGlvbiBnZXRNYXRjaGVzVG9Mb2FkKHN0YXRlLCBtYXRjaGVzLCBzdWJtaXNzaW9uLCBsb2NhdGlvbiwgaXNSZXZhbGlkYXRpb25SZXF1aXJlZCwgY2FuY2VsbGVkRGVmZXJyZWRSb3V0ZXMsIGNhbmNlbGxlZEZldGNoZXJMb2FkcywgcGVuZGluZ0FjdGlvbkRhdGEsIHBlbmRpbmdFcnJvciwgZmV0Y2hMb2FkTWF0Y2hlcykgewogICAgICAgICAgICB2YXIgYWN0aW9uUmVzdWx0ID0gcGVuZGluZ0Vycm9yID8gT2JqZWN0LnZhbHVlcyhwZW5kaW5nRXJyb3IpWzBdIDogcGVuZGluZ0FjdGlvbkRhdGEgPyBPYmplY3QudmFsdWVzKHBlbmRpbmdBY3Rpb25EYXRhKVswXSA6IG51bGw7IC8vIFBpY2sgbmF2aWdhdGlvbiBtYXRjaGVzIHRoYXQgYXJlIG5ldC1uZXcgb3IgcXVhbGlmeSBmb3IgcmV2YWxpZGF0aW9uCgogICAgICAgICAgICB2YXIgYm91bmRhcnlJZCA9IHBlbmRpbmdFcnJvciA/IE9iamVjdC5rZXlzKHBlbmRpbmdFcnJvcilbMF0gOiB1bmRlZmluZWQ7CiAgICAgICAgICAgIHZhciBib3VuZGFyeU1hdGNoZXMgPSBnZXRMb2FkZXJNYXRjaGVzVW50aWxCb3VuZGFyeShtYXRjaGVzLCBib3VuZGFyeUlkKTsKICAgICAgICAgICAgdmFyIG5hdmlnYXRpb25NYXRjaGVzID0gYm91bmRhcnlNYXRjaGVzLmZpbHRlcigobWF0Y2gsIGluZGV4KSA9PiBtYXRjaC5yb3V0ZS5sb2FkZXIgIT0gbnVsbCAmJiAoaXNOZXdMb2FkZXIoc3RhdGUubG9hZGVyRGF0YSwgc3RhdGUubWF0Y2hlc1tpbmRleF0sIG1hdGNoKSB8fCAvLyBJZiB0aGlzIHJvdXRlIGhhZCBhIHBlbmRpbmcgZGVmZXJyZWQgY2FuY2VsbGVkIGl0IG11c3QgYmUgcmV2YWxpZGF0ZWQKICAgICAgICAgICAgY2FuY2VsbGVkRGVmZXJyZWRSb3V0ZXMuc29tZSgoaWQpID0+IGlkID09PSBtYXRjaC5yb3V0ZS5pZCkgfHwgc2hvdWxkUmV2YWxpZGF0ZUxvYWRlcihzdGF0ZS5sb2NhdGlvbiwgc3RhdGUubWF0Y2hlc1tpbmRleF0sIHN1Ym1pc3Npb24sIGxvY2F0aW9uLCBtYXRjaCwgaXNSZXZhbGlkYXRpb25SZXF1aXJlZCwgYWN0aW9uUmVzdWx0KSkpOyAvLyBQaWNrIGZldGNoZXIubG9hZHMgdGhhdCBuZWVkIHRvIGJlIHJldmFsaWRhdGVkCgogICAgICAgICAgICB2YXIgcmV2YWxpZGF0aW5nRmV0Y2hlcnMgPSBbXTsKICAgICAgICAgICAgZmV0Y2hMb2FkTWF0Y2hlcyAmJiBmZXRjaExvYWRNYXRjaGVzLmZvckVhY2goKF9yZWYxMCwga2V5KSA9PiB7CiAgICAgICAgICAgICAgdmFyIF9yZWYyNCA9IF9zbGljZWRUb0FycmF5MihfcmVmMTAsIDMpLGhyZWYgPSBfcmVmMjRbMF0sbWF0Y2ggPSBfcmVmMjRbMV0sZmV0Y2hNYXRjaGVzID0gX3JlZjI0WzJdOwoKICAgICAgICAgICAgICAvLyBUaGlzIGZldGNoZXIgd2FzIGNhbmNlbGxlZCBmcm9tIGEgcHJpb3IgYWN0aW9uIHN1Ym1pc3Npb24gLSBmb3JjZSByZWxvYWQKICAgICAgICAgICAgICBpZiAoY2FuY2VsbGVkRmV0Y2hlckxvYWRzLmluY2x1ZGVzKGtleSkpIHsKICAgICAgICAgICAgICAgIHJldmFsaWRhdGluZ0ZldGNoZXJzLnB1c2goW2tleSwgaHJlZiwgbWF0Y2gsIGZldGNoTWF0Y2hlc10pOwogICAgICAgICAgICAgIH0gZWxzZSBpZiAoaXNSZXZhbGlkYXRpb25SZXF1aXJlZCkgewogICAgICAgICAgICAgICAgdmFyIHNob3VsZFJldmFsaWRhdGUgPSBzaG91bGRSZXZhbGlkYXRlTG9hZGVyKGhyZWYsIG1hdGNoLCBzdWJtaXNzaW9uLCBocmVmLCBtYXRjaCwgaXNSZXZhbGlkYXRpb25SZXF1aXJlZCwgYWN0aW9uUmVzdWx0KTsKCiAgICAgICAgICAgICAgICBpZiAoc2hvdWxkUmV2YWxpZGF0ZSkgewogICAgICAgICAgICAgICAgICByZXZhbGlkYXRpbmdGZXRjaGVycy5wdXNoKFtrZXksIGhyZWYsIG1hdGNoLCBmZXRjaE1hdGNoZXNdKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICByZXR1cm4gW25hdmlnYXRpb25NYXRjaGVzLCByZXZhbGlkYXRpbmdGZXRjaGVyc107CiAgICAgICAgICB9CgogICAgICAgICAgZnVuY3Rpb24gaXNOZXdMb2FkZXIoY3VycmVudExvYWRlckRhdGEsIGN1cnJlbnRNYXRjaCwgbWF0Y2gpIHsKICAgICAgICAgICAgdmFyIGlzTmV3ID0gLy8gW2FdIC0+IFthLCBiXQogICAgICAgICAgICAhY3VycmVudE1hdGNoIHx8IC8vIFthLCBiXSAtPiBbYSwgY10KICAgICAgICAgICAgbWF0Y2gucm91dGUuaWQgIT09IGN1cnJlbnRNYXRjaC5yb3V0ZS5pZDsgLy8gSGFuZGxlIHRoZSBjYXNlIHRoYXQgd2UgZG9uJ3QgaGF2ZSBkYXRhIGZvciBhIHJlLXVzZWQgcm91dGUsIHBvdGVudGlhbGx5CiAgICAgICAgICAgIC8vIGZyb20gYSBwcmlvciBlcnJvciBvciBmcm9tIGEgY2FuY2VsbGVkIHBlbmRpbmcgZGVmZXJyZWQKCiAgICAgICAgICAgIHZhciBpc01pc3NpbmdEYXRhID0gY3VycmVudExvYWRlckRhdGFbbWF0Y2gucm91dGUuaWRdID09PSB1bmRlZmluZWQ7IC8vIEFsd2F5cyBsb2FkIGlmIHRoaXMgaXMgYSBuZXQtbmV3IHJvdXRlIG9yIHdlIGRvbid0IHlldCBoYXZlIGRhdGEKCiAgICAgICAgICAgIHJldHVybiBpc05ldyB8fCBpc01pc3NpbmdEYXRhOwogICAgICAgICAgfQoKICAgICAgICAgIGZ1bmN0aW9uIGlzTmV3Um91dGVJbnN0YW5jZShjdXJyZW50TWF0Y2gsIG1hdGNoKSB7CiAgICAgICAgICAgIHZhciBjdXJyZW50UGF0aCA9IGN1cnJlbnRNYXRjaC5yb3V0ZS5wYXRoOwogICAgICAgICAgICByZXR1cm4gKC8vIHBhcmFtIGNoYW5nZSBmb3IgdGhpcyBtYXRjaCwgL3VzZXJzLzEyMyAtPiAvdXNlcnMvNDU2CiAgICAgICAgICAgICAgY3VycmVudE1hdGNoLnBhdGhuYW1lICE9PSBtYXRjaC5wYXRobmFtZSB8fCAvLyBzcGxhdCBwYXJhbSBjaGFuZ2VkLCB3aGljaCBpcyBub3QgcHJlc2VudCBpbiBtYXRjaC5wYXRoCiAgICAgICAgICAgICAgLy8gZS5nLiAvZmlsZXMvaW1hZ2VzL2F2YXRhci5qcGcgLT4gZmlsZXMvZmluYW5jZXMueGxzCiAgICAgICAgICAgICAgY3VycmVudFBhdGggJiYgY3VycmVudFBhdGguZW5kc1dpdGgoIioiKSAmJiBjdXJyZW50TWF0Y2gucGFyYW1zWyIqIl0gIT09IG1hdGNoLnBhcmFtc1siKiJdKTsKCiAgICAgICAgICB9CgogICAgICAgICAgZnVuY3Rpb24gc2hvdWxkUmV2YWxpZGF0ZUxvYWRlcihjdXJyZW50TG9jYXRpb24sIGN1cnJlbnRNYXRjaCwgc3VibWlzc2lvbiwgbG9jYXRpb24sIG1hdGNoLCBpc1JldmFsaWRhdGlvblJlcXVpcmVkLCBhY3Rpb25SZXN1bHQpIHsKICAgICAgICAgICAgdmFyIGN1cnJlbnRVcmwgPSBjcmVhdGVVUkwoY3VycmVudExvY2F0aW9uKTsKICAgICAgICAgICAgdmFyIGN1cnJlbnRQYXJhbXMgPSBjdXJyZW50TWF0Y2gucGFyYW1zOwogICAgICAgICAgICB2YXIgbmV4dFVybCA9IGNyZWF0ZVVSTChsb2NhdGlvbik7CiAgICAgICAgICAgIHZhciBuZXh0UGFyYW1zID0gbWF0Y2gucGFyYW1zOyAvLyBUaGlzIGlzIHRoZSBkZWZhdWx0IGltcGxlbWVudGF0aW9uIGFzIHRvIHdoZW4gd2UgcmV2YWxpZGF0ZS4gIElmIHRoZSByb3V0ZQogICAgICAgICAgICAvLyBwcm92aWRlcyBpdCdzIG93biBpbXBsZW1lbnRhdGlvbiwgdGhlbiB3ZSBnaXZlIHRoZW0gZnVsbCBjb250cm9sIGJ1dAogICAgICAgICAgICAvLyBwcm92aWRlIHRoaXMgdmFsdWUgc28gdGhleSBjYW4gbGV2ZXJhZ2UgaXQgaWYgbmVlZGVkIGFmdGVyIHRoZXkgY2hlY2sKICAgICAgICAgICAgLy8gdGhlaXIgb3duIHNwZWNpZmljIHVzZSBjYXNlcwogICAgICAgICAgICAvLyBOb3RlIHRoYXQgZmV0Y2hlcnMgYWx3YXlzIHByb3ZpZGUgdGhlIHNhbWUgY3VycmVudC9uZXh0IGxvY2F0aW9ucyBzbyB0aGUKICAgICAgICAgICAgLy8gVVJMLWJhc2VkIGNoZWNrcyBoZXJlIGRvbid0IGFwcGx5IHRvIGZldGNoZXIgc2hvdWxkUmV2YWxpZGF0ZSBjYWxscwoKICAgICAgICAgICAgdmFyIGRlZmF1bHRTaG91bGRSZXZhbGlkYXRlID0gaXNOZXdSb3V0ZUluc3RhbmNlKGN1cnJlbnRNYXRjaCwgbWF0Y2gpIHx8IC8vIENsaWNrZWQgdGhlIHNhbWUgbGluaywgcmVzdWJtaXR0ZWQgYSBHRVQgZm9ybQogICAgICAgICAgICBjdXJyZW50VXJsLnRvU3RyaW5nKCkgPT09IG5leHRVcmwudG9TdHJpbmcoKSB8fCAvLyBTZWFyY2ggcGFyYW1zIGFmZmVjdCBhbGwgbG9hZGVycwogICAgICAgICAgICBjdXJyZW50VXJsLnNlYXJjaCAhPT0gbmV4dFVybC5zZWFyY2ggfHwgLy8gRm9yY2VkIHJldmFsaWRhdGlvbiBkdWUgdG8gc3VibWlzc2lvbiwgdXNlUmV2YWxpZGF0ZSwgb3IgWC1SZW1peC1SZXZhbGlkYXRlCiAgICAgICAgICAgIGlzUmV2YWxpZGF0aW9uUmVxdWlyZWQ7CgogICAgICAgICAgICBpZiAobWF0Y2gucm91dGUuc2hvdWxkUmV2YWxpZGF0ZSkgewogICAgICAgICAgICAgIHZhciByb3V0ZUNob2ljZSA9IG1hdGNoLnJvdXRlLnNob3VsZFJldmFsaWRhdGUoX2V4dGVuZHMoewogICAgICAgICAgICAgICAgY3VycmVudFVybDogY3VycmVudFVybCwKICAgICAgICAgICAgICAgIGN1cnJlbnRQYXJhbXM6IGN1cnJlbnRQYXJhbXMsCiAgICAgICAgICAgICAgICBuZXh0VXJsOiBuZXh0VXJsLAogICAgICAgICAgICAgICAgbmV4dFBhcmFtczogbmV4dFBhcmFtcwogICAgICAgICAgICAgIH0sIHN1Ym1pc3Npb24sIHsKICAgICAgICAgICAgICAgIGFjdGlvblJlc3VsdDogYWN0aW9uUmVzdWx0LAogICAgICAgICAgICAgICAgZGVmYXVsdFNob3VsZFJldmFsaWRhdGU6IGRlZmF1bHRTaG91bGRSZXZhbGlkYXRlCiAgICAgICAgICAgICAgfSkpOwoKICAgICAgICAgICAgICBpZiAodHlwZW9mIHJvdXRlQ2hvaWNlID09PSAiYm9vbGVhbiIpIHsKICAgICAgICAgICAgICAgIHJldHVybiByb3V0ZUNob2ljZTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybiBkZWZhdWx0U2hvdWxkUmV2YWxpZGF0ZTsKICAgICAgICAgIH1mdW5jdGlvbgoKICAgICAgICAgIGNhbGxMb2FkZXJPckFjdGlvbihfeDU2LCBfeDU3LCBfeDU4LCBfeDU5LCBfeDYwLCBfeDYxLCBfeDYyKSB7cmV0dXJuIF9jYWxsTG9hZGVyT3JBY3Rpb24uYXBwbHkodGhpcywgYXJndW1lbnRzKTt9ZnVuY3Rpb24gX2NhbGxMb2FkZXJPckFjdGlvbigpIHtfY2FsbExvYWRlck9yQWN0aW9uID0gX2FzeW5jVG9HZW5lcmF0b3IyKCAvKiNfX1BVUkVfXyovX3JlZ2VuZXJhdG9yUnVudGltZTIoKS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUxNih0eXBlLCByZXF1ZXN0LCBtYXRjaCwgbWF0Y2hlcywgYmFzZW5hbWUsIGlzU3RhdGljUmVxdWVzdCwgaXNSb3V0ZVJlcXVlc3QpIHt2YXIgcmVzdWx0VHlwZSwgcmVzdWx0LCByZWplY3QsIGFib3J0UHJvbWlzZSwgb25SZWplY3QsIGhhbmRsZXIsIHN0YXR1cywgbG9jYXRpb24sIGV4dGVybmFsLCBhY3RpdmVNYXRjaGVzLCByb3V0ZVBhdGhuYW1lcywgcmVxdWVzdFBhdGgsIHJlc29sdmVkTG9jYXRpb24sIHBhdGgsIGRhdGEsIGNvbnRlbnRUeXBlO3JldHVybiBfcmVnZW5lcmF0b3JSdW50aW1lMigpLndyYXAoZnVuY3Rpb24gX2NhbGxlZTE2JChfY29udGV4dDE3KSB7d2hpbGUgKDEpIHtzd2l0Y2ggKF9jb250ZXh0MTcucHJldiA9IF9jb250ZXh0MTcubmV4dCkge2Nhc2UgMDoKICAgICAgICAgICAgICAgICAgICAgIGlmIChiYXNlbmFtZSA9PT0gdm9pZCAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGJhc2VuYW1lID0gIi8iOwogICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgIGlmIChpc1N0YXRpY1JlcXVlc3QgPT09IHZvaWQgMCkgewogICAgICAgICAgICAgICAgICAgICAgICBpc1N0YXRpY1JlcXVlc3QgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICBpZiAoaXNSb3V0ZVJlcXVlc3QgPT09IHZvaWQgMCkgewogICAgICAgICAgICAgICAgICAgICAgICBpc1JvdXRlUmVxdWVzdCA9IGZhbHNlOwogICAgICAgICAgICAgICAgICAgICAgfQoKCgoKCiAgICAgICAgICAgICAgICAgICAgICBhYm9ydFByb21pc2UgPSBuZXcgUHJvbWlzZSgoXywgcikgPT4gcmVqZWN0ID0gcik7CgogICAgICAgICAgICAgICAgICAgICAgb25SZWplY3QgPSAoKSA9PiByZWplY3QoKTsKCiAgICAgICAgICAgICAgICAgICAgICByZXF1ZXN0LnNpZ25hbC5hZGRFdmVudExpc3RlbmVyKCJhYm9ydCIsIG9uUmVqZWN0KTtfY29udGV4dDE3LnByZXYgPSA2OwoKCiAgICAgICAgICAgICAgICAgICAgICBoYW5kbGVyID0gbWF0Y2gucm91dGVbdHlwZV07CiAgICAgICAgICAgICAgICAgICAgICByb3V0ZXJfaW52YXJpYW50KGhhbmRsZXIsICJDb3VsZCBub3QgZmluZCB0aGUgIiArIHR5cGUgKyAiIHRvIHJ1biBvbiB0aGUgXCIiICsgbWF0Y2gucm91dGUuaWQgKyAiXCIgcm91dGUiKTtfY29udGV4dDE3Lm5leHQgPSAxMTtyZXR1cm4gKAogICAgICAgICAgICAgICAgICAgICAgICBQcm9taXNlLnJhY2UoW2hhbmRsZXIoewogICAgICAgICAgICAgICAgICAgICAgICAgIHJlcXVlc3Q6IHJlcXVlc3QsCiAgICAgICAgICAgICAgICAgICAgICAgICAgcGFyYW1zOiBtYXRjaC5wYXJhbXMKICAgICAgICAgICAgICAgICAgICAgICAgfSksIGFib3J0UHJvbWlzZV0pKTtjYXNlIDExOnJlc3VsdCA9IF9jb250ZXh0MTcuc2VudDsKICAgICAgICAgICAgICAgICAgICAgIHJvdXRlcl9pbnZhcmlhbnQocmVzdWx0ICE9PSB1bmRlZmluZWQsICJZb3UgZGVmaW5lZCAiICsgKHR5cGUgPT09ICJhY3Rpb24iID8gImFuIGFjdGlvbiIgOiAiYSBsb2FkZXIiKSArICIgZm9yIHJvdXRlICIgKyAoIlwiIiArIG1hdGNoLnJvdXRlLmlkICsgIlwiIGJ1dCBkaWRuJ3QgcmV0dXJuIGFueXRoaW5nIGZyb20geW91ciBgIiArIHR5cGUgKyAiYCAiKSArICJmdW5jdGlvbi4gUGxlYXNlIHJldHVybiBhIHZhbHVlIG9yIGBudWxsYC4iKTtfY29udGV4dDE3Lm5leHQgPSAxOTticmVhaztjYXNlIDE1Ol9jb250ZXh0MTcucHJldiA9IDE1O19jb250ZXh0MTcudDAgPSBfY29udGV4dDE3WyJjYXRjaCJdKDYpOwoKICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdFR5cGUgPSBSZXN1bHRUeXBlLmVycm9yOwogICAgICAgICAgICAgICAgICAgICAgcmVzdWx0ID0gX2NvbnRleHQxNy50MDtjYXNlIDE5Ol9jb250ZXh0MTcucHJldiA9IDE5OwoKICAgICAgICAgICAgICAgICAgICAgIHJlcXVlc3Quc2lnbmFsLnJlbW92ZUV2ZW50TGlzdGVuZXIoImFib3J0Iiwgb25SZWplY3QpO3JldHVybiBfY29udGV4dDE3LmZpbmlzaCgxOSk7Y2FzZSAyMjppZiAoISgKCgogICAgICAgICAgICAgICAgICAgICAgcmVzdWx0IGluc3RhbmNlb2YgUmVzcG9uc2UpKSB7X2NvbnRleHQxNy5uZXh0ID0gNDg7YnJlYWs7fQogICAgICAgICAgICAgICAgICAgICAgc3RhdHVzID0gcmVzdWx0LnN0YXR1czsgLy8gUHJvY2VzcyByZWRpcmVjdHMKICAgICAgICAgICAgICAgICAgICAgIGlmICghCiAgICAgICAgICAgICAgICAgICAgICByZWRpcmVjdFN0YXR1c0NvZGVzLmhhcyhzdGF0dXMpKSB7X2NvbnRleHQxNy5uZXh0ID0gMzM7YnJlYWs7fQogICAgICAgICAgICAgICAgICAgICAgbG9jYXRpb24gPSByZXN1bHQuaGVhZGVycy5nZXQoIkxvY2F0aW9uIik7CiAgICAgICAgICAgICAgICAgICAgICByb3V0ZXJfaW52YXJpYW50KGxvY2F0aW9uLCAiUmVkaXJlY3RzIHJldHVybmVkL3Rocm93biBmcm9tIGxvYWRlcnMvYWN0aW9ucyBtdXN0IGhhdmUgYSBMb2NhdGlvbiBoZWFkZXIiKTsgLy8gQ2hlY2sgaWYgdGhpcyBhbiBleHRlcm5hbCByZWRpcmVjdCB0aGF0IGdvZXMgdG8gYSBuZXcgb3JpZ2luCgogICAgICAgICAgICAgICAgICAgICAgZXh0ZXJuYWwgPSBjcmVhdGVVUkwobG9jYXRpb24pLm9yaWdpbiAhPT0gY3JlYXRlVVJMKCIvIikub3JpZ2luOyAvLyBTdXBwb3J0IHJlbGF0aXZlIHJvdXRpbmcgaW4gaW50ZXJuYWwgcmVkaXJlY3RzCgogICAgICAgICAgICAgICAgICAgICAgaWYgKCFleHRlcm5hbCkgewogICAgICAgICAgICAgICAgICAgICAgICBhY3RpdmVNYXRjaGVzID0gbWF0Y2hlcy5zbGljZSgwLCBtYXRjaGVzLmluZGV4T2YobWF0Y2gpICsgMSk7CiAgICAgICAgICAgICAgICAgICAgICAgIHJvdXRlUGF0aG5hbWVzID0gZ2V0UGF0aENvbnRyaWJ1dGluZ01hdGNoZXMoYWN0aXZlTWF0Y2hlcykubWFwKChtYXRjaCkgPT4gbWF0Y2gucGF0aG5hbWVCYXNlKTsKICAgICAgICAgICAgICAgICAgICAgICAgcmVxdWVzdFBhdGggPSBjcmVhdGVVUkwocmVxdWVzdC51cmwpLnBhdGhuYW1lOwogICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlZExvY2F0aW9uID0gcmVzb2x2ZVRvKGxvY2F0aW9uLCByb3V0ZVBhdGhuYW1lcywgcmVxdWVzdFBhdGgpOwogICAgICAgICAgICAgICAgICAgICAgICByb3V0ZXJfaW52YXJpYW50KHJvdXRlcl9jcmVhdGVQYXRoKHJlc29sdmVkTG9jYXRpb24pLCAiVW5hYmxlIHRvIHJlc29sdmUgcmVkaXJlY3QgbG9jYXRpb246ICIgKyBsb2NhdGlvbik7IC8vIFByZXBlbmQgdGhlIGJhc2VuYW1lIHRvIHRoZSByZWRpcmVjdCBsb2NhdGlvbiBpZiB3ZSBoYXZlIG9uZQoKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGJhc2VuYW1lKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgcGF0aCA9IHJlc29sdmVkTG9jYXRpb24ucGF0aG5hbWU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZWRMb2NhdGlvbi5wYXRobmFtZSA9IHBhdGggPT09ICIvIiA/IGJhc2VuYW1lIDogcm91dGVyX2pvaW5QYXRocyhbYmFzZW5hbWUsIHBhdGhdKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgbG9jYXRpb24gPSByb3V0ZXJfY3JlYXRlUGF0aChyZXNvbHZlZExvY2F0aW9uKTsKICAgICAgICAgICAgICAgICAgICAgIH0gLy8gRG9uJ3QgcHJvY2VzcyByZWRpcmVjdHMgaW4gdGhlIHJvdXRlciBkdXJpbmcgc3RhdGljIHJlcXVlc3RzIHJlcXVlc3RzLgogICAgICAgICAgICAgICAgICAgICAgLy8gSW5zdGVhZCwgdGhyb3cgdGhlIFJlc3BvbnNlIGFuZCBsZXQgdGhlIHNlcnZlciBoYW5kbGUgaXQgd2l0aCBhbiBIVFRQCiAgICAgICAgICAgICAgICAgICAgICAvLyByZWRpcmVjdC4gIFdlIGFsc28gdXBkYXRlIHRoZSBMb2NhdGlvbiBoZWFkZXIgaW4gcGxhY2UgaW4gdGhpcyBmbG93IHNvCiAgICAgICAgICAgICAgICAgICAgICAvLyBiYXNlbmFtZSBhbmQgcmVsYXRpdmUgcm91dGluZyBpcyB0YWtlbiBpbnRvIGFjY291bnQKICAgICAgICAgICAgICAgICAgICAgIGlmICghCgogICAgICAgICAgICAgICAgICAgICAgaXNTdGF0aWNSZXF1ZXN0KSB7X2NvbnRleHQxNy5uZXh0ID0gMzI7YnJlYWs7fQogICAgICAgICAgICAgICAgICAgICAgcmVzdWx0LmhlYWRlcnMuc2V0KCJMb2NhdGlvbiIsIGxvY2F0aW9uKTt0aHJvdyAoCiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdCk7Y2FzZSAzMjpyZXR1cm4gX2NvbnRleHQxNy5hYnJ1cHQoInJldHVybiIsCgoKICAgICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogUmVzdWx0VHlwZS5yZWRpcmVjdCwKICAgICAgICAgICAgICAgICAgICAgICAgc3RhdHVzOiBzdGF0dXMsCiAgICAgICAgICAgICAgICAgICAgICAgIGxvY2F0aW9uOiBsb2NhdGlvbiwKICAgICAgICAgICAgICAgICAgICAgICAgcmV2YWxpZGF0ZTogcmVzdWx0LmhlYWRlcnMuZ2V0KCJYLVJlbWl4LVJldmFsaWRhdGUiKSAhPT0gbnVsbCwKICAgICAgICAgICAgICAgICAgICAgICAgZXh0ZXJuYWw6IGV4dGVybmFsCiAgICAgICAgICAgICAgICAgICAgICB9KTtjYXNlIDMzOmlmICghCgoKCgoKICAgICAgICAgICAgICAgICAgICAgIGlzUm91dGVSZXF1ZXN0KSB7X2NvbnRleHQxNy5uZXh0ID0gMzU7YnJlYWs7fXRocm93ICgKCiAgICAgICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiByZXN1bHRUeXBlIHx8IFJlc3VsdFR5cGUuZGF0YSwKICAgICAgICAgICAgICAgICAgICAgICAgICByZXNwb25zZTogcmVzdWx0CiAgICAgICAgICAgICAgICAgICAgICAgIH0pO2Nhc2UgMzU6CgoKCiAgICAgICAgICAgICAgICAgICAgICBjb250ZW50VHlwZSA9IHJlc3VsdC5oZWFkZXJzLmdldCgiQ29udGVudC1UeXBlIik7aWYgKCEoCgogICAgICAgICAgICAgICAgICAgICAgY29udGVudFR5cGUgJiYgY29udGVudFR5cGUuc3RhcnRzV2l0aCgiYXBwbGljYXRpb24vanNvbiIpKSkge19jb250ZXh0MTcubmV4dCA9IDQyO2JyZWFrO31fY29udGV4dDE3Lm5leHQgPSAzOTtyZXR1cm4gKAogICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQuanNvbigpKTtjYXNlIDM5OmRhdGEgPSBfY29udGV4dDE3LnNlbnQ7X2NvbnRleHQxNy5uZXh0ID0gNDU7YnJlYWs7Y2FzZSA0MjpfY29udGV4dDE3Lm5leHQgPSA0NDtyZXR1cm4gKAoKICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0LnRleHQoKSk7Y2FzZSA0NDpkYXRhID0gX2NvbnRleHQxNy5zZW50O2Nhc2UgNDU6aWYgKCEoCgoKICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdFR5cGUgPT09IFJlc3VsdFR5cGUuZXJyb3IpKSB7X2NvbnRleHQxNy5uZXh0ID0gNDc7YnJlYWs7fXJldHVybiBfY29udGV4dDE3LmFicnVwdCgicmV0dXJuIiwKICAgICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogcmVzdWx0VHlwZSwKICAgICAgICAgICAgICAgICAgICAgICAgZXJyb3I6IG5ldyByb3V0ZXJfRXJyb3JSZXNwb25zZShzdGF0dXMsIHJlc3VsdC5zdGF0dXNUZXh0LCBkYXRhKSwKICAgICAgICAgICAgICAgICAgICAgICAgaGVhZGVyczogcmVzdWx0LmhlYWRlcnMKICAgICAgICAgICAgICAgICAgICAgIH0pO2Nhc2UgNDc6cmV0dXJuIF9jb250ZXh0MTcuYWJydXB0KCJyZXR1cm4iLAoKCiAgICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6IFJlc3VsdFR5cGUuZGF0YSwKICAgICAgICAgICAgICAgICAgICAgICAgZGF0YTogZGF0YSwKICAgICAgICAgICAgICAgICAgICAgICAgc3RhdHVzQ29kZTogcmVzdWx0LnN0YXR1cywKICAgICAgICAgICAgICAgICAgICAgICAgaGVhZGVyczogcmVzdWx0LmhlYWRlcnMKICAgICAgICAgICAgICAgICAgICAgIH0pO2Nhc2UgNDg6aWYgKCEoCgoKICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdFR5cGUgPT09IFJlc3VsdFR5cGUuZXJyb3IpKSB7X2NvbnRleHQxNy5uZXh0ID0gNTA7YnJlYWs7fXJldHVybiBfY29udGV4dDE3LmFicnVwdCgicmV0dXJuIiwKICAgICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogcmVzdWx0VHlwZSwKICAgICAgICAgICAgICAgICAgICAgICAgZXJyb3I6IHJlc3VsdAogICAgICAgICAgICAgICAgICAgICAgfSk7Y2FzZSA1MDppZiAoISgKCgogICAgICAgICAgICAgICAgICAgICAgcmVzdWx0IGluc3RhbmNlb2YgRGVmZXJyZWREYXRhKSkge19jb250ZXh0MTcubmV4dCA9IDUyO2JyZWFrO31yZXR1cm4gX2NvbnRleHQxNy5hYnJ1cHQoInJldHVybiIsCiAgICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6IFJlc3VsdFR5cGUuZGVmZXJyZWQsCiAgICAgICAgICAgICAgICAgICAgICAgIGRlZmVycmVkRGF0YTogcmVzdWx0CiAgICAgICAgICAgICAgICAgICAgICB9KTtjYXNlIDUyOnJldHVybiBfY29udGV4dDE3LmFicnVwdCgicmV0dXJuIiwKCgogICAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiBSZXN1bHRUeXBlLmRhdGEsCiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGE6IHJlc3VsdAogICAgICAgICAgICAgICAgICAgICAgfSk7Y2FzZSA1MzpjYXNlICJlbmQiOnJldHVybiBfY29udGV4dDE3LnN0b3AoKTt9fX0sIF9jYWxsZWUxNiwgbnVsbCwgW1s2LCAxNSwgMTksIDIyXV0pO30pKTtyZXR1cm4gX2NhbGxMb2FkZXJPckFjdGlvbi5hcHBseSh0aGlzLCBhcmd1bWVudHMpO30KCgogICAgICAgICAgZnVuY3Rpb24gY3JlYXRlUmVxdWVzdChsb2NhdGlvbiwgc2lnbmFsLCBzdWJtaXNzaW9uKSB7CiAgICAgICAgICAgIHZhciB1cmwgPSBjcmVhdGVVUkwoc3RyaXBIYXNoRnJvbVBhdGgobG9jYXRpb24pKS50b1N0cmluZygpOwogICAgICAgICAgICB2YXIgaW5pdCA9IHsKICAgICAgICAgICAgICBzaWduYWw6IHNpZ25hbAogICAgICAgICAgICB9OwoKICAgICAgICAgICAgaWYgKHN1Ym1pc3Npb24pIHsKICAgICAgICAgICAgICB2YXIKICAgICAgICAgICAgICAgIGZvcm1NZXRob2QgPQoKCiAgICAgICAgICAgICAgICBzdWJtaXNzaW9uLmZvcm1NZXRob2QsZm9ybUVuY1R5cGUgPSBzdWJtaXNzaW9uLmZvcm1FbmNUeXBlLGZvcm1EYXRhID0gc3VibWlzc2lvbi5mb3JtRGF0YTsKICAgICAgICAgICAgICBpbml0Lm1ldGhvZCA9IGZvcm1NZXRob2QudG9VcHBlckNhc2UoKTsKICAgICAgICAgICAgICBpbml0LmJvZHkgPSBmb3JtRW5jVHlwZSA9PT0gImFwcGxpY2F0aW9uL3gtd3d3LWZvcm0tdXJsZW5jb2RlZCIgPyBjb252ZXJ0Rm9ybURhdGFUb1NlYXJjaFBhcmFtcyhmb3JtRGF0YSkgOiBmb3JtRGF0YTsKICAgICAgICAgICAgfSAvLyBDb250ZW50LVR5cGUgaXMgaW5mZXJyZWQgKGh0dHBzOi8vZmV0Y2guc3BlYy53aGF0d2cub3JnLyNkb20tcmVxdWVzdCkKCgogICAgICAgICAgICByZXR1cm4gbmV3IFJlcXVlc3QodXJsLCBpbml0KTsKICAgICAgICAgIH0KCiAgICAgICAgICBmdW5jdGlvbiBjb252ZXJ0Rm9ybURhdGFUb1NlYXJjaFBhcmFtcyhmb3JtRGF0YSkgewogICAgICAgICAgICB2YXIgc2VhcmNoUGFyYW1zID0gbmV3IFVSTFNlYXJjaFBhcmFtcygpO3ZhciBfaXRlcmF0b3I2ID0gX2NyZWF0ZUZvck9mSXRlcmF0b3JIZWxwZXIyKAoKICAgICAgICAgICAgICBmb3JtRGF0YS5lbnRyaWVzKCkpLF9zdGVwNjt0cnkge2ZvciAoX2l0ZXJhdG9yNi5zKCk7ICEoX3N0ZXA2ID0gX2l0ZXJhdG9yNi5uKCkpLmRvbmU7KSB7dmFyIF9zdGVwNiR2YWx1ZSA9IF9zbGljZWRUb0FycmF5Mihfc3RlcDYudmFsdWUsIDIpLGtleSA9IF9zdGVwNiR2YWx1ZVswXSx2YWx1ZSA9IF9zdGVwNiR2YWx1ZVsxXTsKICAgICAgICAgICAgICAgIHJvdXRlcl9pbnZhcmlhbnQodHlwZW9mIHZhbHVlID09PSAic3RyaW5nIiwgJ0ZpbGUgaW5wdXRzIGFyZSBub3Qgc3VwcG9ydGVkIHdpdGggZW5jVHlwZSAiYXBwbGljYXRpb24veC13d3ctZm9ybS11cmxlbmNvZGVkIiwgJyArICdwbGVhc2UgdXNlICJtdWx0aXBhcnQvZm9ybS1kYXRhIiBpbnN0ZWFkLicpOwogICAgICAgICAgICAgICAgc2VhcmNoUGFyYW1zLmFwcGVuZChrZXksIHZhbHVlKTsKICAgICAgICAgICAgICB9fSBjYXRjaCAoZXJyKSB7X2l0ZXJhdG9yNi5lKGVycik7fSBmaW5hbGx5IHtfaXRlcmF0b3I2LmYoKTt9CgogICAgICAgICAgICByZXR1cm4gc2VhcmNoUGFyYW1zOwogICAgICAgICAgfQoKICAgICAgICAgIGZ1bmN0aW9uIHByb2Nlc3NSb3V0ZUxvYWRlckRhdGEobWF0Y2hlcywgbWF0Y2hlc1RvTG9hZCwgcmVzdWx0cywgcGVuZGluZ0Vycm9yLCBhY3RpdmVEZWZlcnJlZHMpIHsKICAgICAgICAgICAgLy8gRmlsbCBpbiBsb2FkZXJEYXRhL2Vycm9ycyBmcm9tIG91ciBsb2FkZXJzCiAgICAgICAgICAgIHZhciBsb2FkZXJEYXRhID0ge307CiAgICAgICAgICAgIHZhciBlcnJvcnMgPSBudWxsOwogICAgICAgICAgICB2YXIgc3RhdHVzQ29kZTsKICAgICAgICAgICAgdmFyIGZvdW5kRXJyb3IgPSBmYWxzZTsKICAgICAgICAgICAgdmFyIGxvYWRlckhlYWRlcnMgPSB7fTsgLy8gUHJvY2VzcyBsb2FkZXIgcmVzdWx0cyBpbnRvIHN0YXRlLmxvYWRlckRhdGEvc3RhdGUuZXJyb3JzCgogICAgICAgICAgICByZXN1bHRzLmZvckVhY2goKHJlc3VsdCwgaW5kZXgpID0+IHsKICAgICAgICAgICAgICB2YXIgaWQgPSBtYXRjaGVzVG9Mb2FkW2luZGV4XS5yb3V0ZS5pZDsKICAgICAgICAgICAgICByb3V0ZXJfaW52YXJpYW50KCFpc1JlZGlyZWN0UmVzdWx0KHJlc3VsdCksICJDYW5ub3QgaGFuZGxlIHJlZGlyZWN0IHJlc3VsdHMgaW4gcHJvY2Vzc0xvYWRlckRhdGEiKTsKCiAgICAgICAgICAgICAgaWYgKGlzRXJyb3JSZXN1bHQocmVzdWx0KSkgewogICAgICAgICAgICAgICAgLy8gTG9vayB1cHdhcmRzIGZyb20gdGhlIG1hdGNoZWQgcm91dGUgZm9yIHRoZSBjbG9zZXN0IGFuY2VzdG9yCiAgICAgICAgICAgICAgICAvLyBlcnJvciBib3VuZGFyeSwgZGVmYXVsdGluZyB0byB0aGUgcm9vdCBtYXRjaAogICAgICAgICAgICAgICAgdmFyIGJvdW5kYXJ5TWF0Y2ggPSBmaW5kTmVhcmVzdEJvdW5kYXJ5KG1hdGNoZXMsIGlkKTsKICAgICAgICAgICAgICAgIHZhciBlcnJvciA9IHJlc3VsdC5lcnJvcjsgLy8gSWYgd2UgaGF2ZSBhIHBlbmRpbmcgYWN0aW9uIGVycm9yLCB3ZSByZXBvcnQgaXQgYXQgdGhlIGhpZ2hlc3Qtcm91dGUKICAgICAgICAgICAgICAgIC8vIHRoYXQgdGhyb3dzIGEgbG9hZGVyIGVycm9yLCBhbmQgdGhlbiBjbGVhciBpdCBvdXQgdG8gaW5kaWNhdGUgdGhhdAogICAgICAgICAgICAgICAgLy8gaXQgd2FzIGNvbnN1bWVkCgogICAgICAgICAgICAgICAgaWYgKHBlbmRpbmdFcnJvcikgewogICAgICAgICAgICAgICAgICBlcnJvciA9IE9iamVjdC52YWx1ZXMocGVuZGluZ0Vycm9yKVswXTsKICAgICAgICAgICAgICAgICAgcGVuZGluZ0Vycm9yID0gdW5kZWZpbmVkOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGVycm9ycyA9IE9iamVjdC5hc3NpZ24oZXJyb3JzIHx8IHt9LCBfZGVmaW5lUHJvcGVydHkyKHt9LAogICAgICAgICAgICAgICAgYm91bmRhcnlNYXRjaC5yb3V0ZS5pZCwgZXJyb3IpKTsKICAgICAgICAgICAgICAgIC8vIE9uY2Ugd2UgZmluZCBvdXIgZmlyc3QgKGhpZ2hlc3QpIGVycm9yLCB3ZSBzZXQgdGhlIHN0YXR1cyBjb2RlIGFuZAogICAgICAgICAgICAgICAgLy8gcHJldmVudCBkZWVwZXIgc3RhdHVzIGNvZGVzIGZyb20gb3ZlcnJpZGluZwoKICAgICAgICAgICAgICAgIGlmICghZm91bmRFcnJvcikgewogICAgICAgICAgICAgICAgICBmb3VuZEVycm9yID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgc3RhdHVzQ29kZSA9IGlzUm91dGVFcnJvclJlc3BvbnNlKHJlc3VsdC5lcnJvcikgPyByZXN1bHQuZXJyb3Iuc3RhdHVzIDogNTAwOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGlmIChyZXN1bHQuaGVhZGVycykgewogICAgICAgICAgICAgICAgICBsb2FkZXJIZWFkZXJzW2lkXSA9IHJlc3VsdC5oZWFkZXJzOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0gZWxzZSBpZiAoaXNEZWZlcnJlZFJlc3VsdChyZXN1bHQpKSB7CiAgICAgICAgICAgICAgICBhY3RpdmVEZWZlcnJlZHMgJiYgYWN0aXZlRGVmZXJyZWRzLnNldChpZCwgcmVzdWx0LmRlZmVycmVkRGF0YSk7CiAgICAgICAgICAgICAgICBsb2FkZXJEYXRhW2lkXSA9IHJlc3VsdC5kZWZlcnJlZERhdGEuZGF0YTsgLy8gVE9ETzogQWRkIHN0YXR1c0NvZGUvaGVhZGVycyBvbmNlIHdlIHdpcmUgdXAgc3RyZWFtaW5nIGluIFJlbWl4CiAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGxvYWRlckRhdGFbaWRdID0gcmVzdWx0LmRhdGE7IC8vIEVycm9yIHN0YXR1cyBjb2RlcyBhbHdheXMgb3ZlcnJpZGUgc3VjY2VzcyBzdGF0dXMgY29kZXMsIGJ1dCBpZiBhbGwKICAgICAgICAgICAgICAgIC8vIGxvYWRlcnMgYXJlIHN1Y2Nlc3NmdWwgd2UgdGFrZSB0aGUgZGVlcGVzdCBzdGF0dXMgY29kZS4KCiAgICAgICAgICAgICAgICBpZiAocmVzdWx0LnN0YXR1c0NvZGUgIT0gbnVsbCAmJiByZXN1bHQuc3RhdHVzQ29kZSAhPT0gMjAwICYmICFmb3VuZEVycm9yKSB7CiAgICAgICAgICAgICAgICAgIHN0YXR1c0NvZGUgPSByZXN1bHQuc3RhdHVzQ29kZTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBpZiAocmVzdWx0LmhlYWRlcnMpIHsKICAgICAgICAgICAgICAgICAgbG9hZGVySGVhZGVyc1tpZF0gPSByZXN1bHQuaGVhZGVyczsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOyAvLyBJZiB3ZSBkaWRuJ3QgY29uc3VtZSB0aGUgcGVuZGluZyBhY3Rpb24gZXJyb3IgKGkuZS4sIGFsbCBsb2FkZXJzCiAgICAgICAgICAgIC8vIHJlc29sdmVkKSwgdGhlbiBjb25zdW1lIGl0IGhlcmUKCiAgICAgICAgICAgIGlmIChwZW5kaW5nRXJyb3IpIHsKICAgICAgICAgICAgICBlcnJvcnMgPSBwZW5kaW5nRXJyb3I7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgbG9hZGVyRGF0YTogbG9hZGVyRGF0YSwKICAgICAgICAgICAgICBlcnJvcnM6IGVycm9ycywKICAgICAgICAgICAgICBzdGF0dXNDb2RlOiBzdGF0dXNDb2RlIHx8IDIwMCwKICAgICAgICAgICAgICBsb2FkZXJIZWFkZXJzOiBsb2FkZXJIZWFkZXJzCiAgICAgICAgICAgIH07CiAgICAgICAgICB9CgogICAgICAgICAgZnVuY3Rpb24gcHJvY2Vzc0xvYWRlckRhdGEoc3RhdGUsIG1hdGNoZXMsIG1hdGNoZXNUb0xvYWQsIHJlc3VsdHMsIHBlbmRpbmdFcnJvciwgcmV2YWxpZGF0aW5nRmV0Y2hlcnMsIGZldGNoZXJSZXN1bHRzLCBhY3RpdmVEZWZlcnJlZHMpIHsKICAgICAgICAgICAgdmFyIF9wcm9jZXNzUm91dGVMb2FkZXJEYSA9CgoKICAgICAgICAgICAgICBwcm9jZXNzUm91dGVMb2FkZXJEYXRhKG1hdGNoZXMsIG1hdGNoZXNUb0xvYWQsIHJlc3VsdHMsIHBlbmRpbmdFcnJvciwgYWN0aXZlRGVmZXJyZWRzKSxsb2FkZXJEYXRhID0gX3Byb2Nlc3NSb3V0ZUxvYWRlckRhLmxvYWRlckRhdGEsZXJyb3JzID0gX3Byb2Nlc3NSb3V0ZUxvYWRlckRhLmVycm9yczsgLy8gUHJvY2VzcyByZXN1bHRzIGZyb20gb3VyIHJldmFsaWRhdGluZyBmZXRjaGVycwoKICAgICAgICAgICAgZm9yICh2YXIgaW5kZXggPSAwOyBpbmRleCA8IHJldmFsaWRhdGluZ0ZldGNoZXJzLmxlbmd0aDsgaW5kZXgrKykgewogICAgICAgICAgICAgIHZhciBfcmV2YWxpZGF0aW5nRmV0Y2hlcnMgPSBfc2xpY2VkVG9BcnJheTIocmV2YWxpZGF0aW5nRmV0Y2hlcnNbaW5kZXhdLCAzKSxrZXkgPSBfcmV2YWxpZGF0aW5nRmV0Y2hlcnNbMF0sbWF0Y2ggPSBfcmV2YWxpZGF0aW5nRmV0Y2hlcnNbMl07CiAgICAgICAgICAgICAgcm91dGVyX2ludmFyaWFudChmZXRjaGVyUmVzdWx0cyAhPT0gdW5kZWZpbmVkICYmIGZldGNoZXJSZXN1bHRzW2luZGV4XSAhPT0gdW5kZWZpbmVkLCAiRGlkIG5vdCBmaW5kIGNvcnJlc3BvbmRpbmcgZmV0Y2hlciByZXN1bHQiKTsKICAgICAgICAgICAgICB2YXIgcmVzdWx0ID0gZmV0Y2hlclJlc3VsdHNbaW5kZXhdOyAvLyBQcm9jZXNzIGZldGNoZXIgbm9uLXJlZGlyZWN0IGVycm9ycwoKICAgICAgICAgICAgICBpZiAoaXNFcnJvclJlc3VsdChyZXN1bHQpKSB7CiAgICAgICAgICAgICAgICB2YXIgYm91bmRhcnlNYXRjaCA9IGZpbmROZWFyZXN0Qm91bmRhcnkoc3RhdGUubWF0Y2hlcywgbWF0Y2gucm91dGUuaWQpOwoKICAgICAgICAgICAgICAgIGlmICghKGVycm9ycyAmJiBlcnJvcnNbYm91bmRhcnlNYXRjaC5yb3V0ZS5pZF0pKSB7CiAgICAgICAgICAgICAgICAgIGVycm9ycyA9IF9leHRlbmRzKHt9LCBlcnJvcnMsIF9kZWZpbmVQcm9wZXJ0eTIoe30sCiAgICAgICAgICAgICAgICAgIGJvdW5kYXJ5TWF0Y2gucm91dGUuaWQsIHJlc3VsdC5lcnJvcikpOwoKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBzdGF0ZS5mZXRjaGVycy5kZWxldGUoa2V5KTsKICAgICAgICAgICAgICB9IGVsc2UgaWYgKGlzUmVkaXJlY3RSZXN1bHQocmVzdWx0KSkgewogICAgICAgICAgICAgICAgLy8gU2hvdWxkIG5ldmVyIGdldCBoZXJlLCByZWRpcmVjdHMgc2hvdWxkIGdldCBwcm9jZXNzZWQgYWJvdmUsIGJ1dCB3ZQogICAgICAgICAgICAgICAgLy8ga2VlcCB0aGlzIHRvIHR5cGUgbmFycm93IHRvIGEgc3VjY2VzcyByZXN1bHQgaW4gdGhlIGVsc2UKICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiVW5oYW5kbGVkIGZldGNoZXIgcmV2YWxpZGF0aW9uIHJlZGlyZWN0Iik7CiAgICAgICAgICAgICAgfSBlbHNlIGlmIChpc0RlZmVycmVkUmVzdWx0KHJlc3VsdCkpIHsKICAgICAgICAgICAgICAgIC8vIFNob3VsZCBuZXZlciBnZXQgaGVyZSwgZGVmZXJyZWQgZGF0YSBzaG91bGQgYmUgYXdhaXRlZCBmb3IgZmV0Y2hlcnMKICAgICAgICAgICAgICAgIC8vIGluIHJlc29sdmVEZWZlcnJlZFJlc3VsdHMKICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiVW5oYW5kbGVkIGZldGNoZXIgZGVmZXJyZWQgZGF0YSIpOwogICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICB2YXIgZG9uZUZldGNoZXIgPSB7CiAgICAgICAgICAgICAgICAgIHN0YXRlOiAiaWRsZSIsCiAgICAgICAgICAgICAgICAgIGRhdGE6IHJlc3VsdC5kYXRhLAogICAgICAgICAgICAgICAgICBmb3JtTWV0aG9kOiB1bmRlZmluZWQsCiAgICAgICAgICAgICAgICAgIGZvcm1BY3Rpb246IHVuZGVmaW5lZCwKICAgICAgICAgICAgICAgICAgZm9ybUVuY1R5cGU6IHVuZGVmaW5lZCwKICAgICAgICAgICAgICAgICAgZm9ybURhdGE6IHVuZGVmaW5lZAogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgIHN0YXRlLmZldGNoZXJzLnNldChrZXksIGRvbmVGZXRjaGVyKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgbG9hZGVyRGF0YTogbG9hZGVyRGF0YSwKICAgICAgICAgICAgICBlcnJvcnM6IGVycm9ycwogICAgICAgICAgICB9OwogICAgICAgICAgfQoKICAgICAgICAgIGZ1bmN0aW9uIG1lcmdlTG9hZGVyRGF0YShsb2FkZXJEYXRhLCBuZXdMb2FkZXJEYXRhLCBtYXRjaGVzKSB7CiAgICAgICAgICAgIHZhciBtZXJnZWRMb2FkZXJEYXRhID0gX2V4dGVuZHMoe30sIG5ld0xvYWRlckRhdGEpOwoKICAgICAgICAgICAgbWF0Y2hlcy5mb3JFYWNoKChtYXRjaCkgPT4gewogICAgICAgICAgICAgIHZhciBpZCA9IG1hdGNoLnJvdXRlLmlkOwoKICAgICAgICAgICAgICBpZiAobmV3TG9hZGVyRGF0YVtpZF0gPT09IHVuZGVmaW5lZCAmJiBsb2FkZXJEYXRhW2lkXSAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgICAgICBtZXJnZWRMb2FkZXJEYXRhW2lkXSA9IGxvYWRlckRhdGFbaWRdOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIHJldHVybiBtZXJnZWRMb2FkZXJEYXRhOwogICAgICAgICAgfSAvLyBGaW5kIHRoZSBuZWFyZXN0IGVycm9yIGJvdW5kYXJ5LCBsb29raW5nIHVwd2FyZHMgZnJvbSB0aGUgbGVhZiByb3V0ZSAob3IgdGhlCiAgICAgICAgICAvLyByb3V0ZSBzcGVjaWZpZWQgYnkgcm91dGVJZCkgZm9yIHRoZSBjbG9zZXN0IGFuY2VzdG9yIGVycm9yIGJvdW5kYXJ5LAogICAgICAgICAgLy8gZGVmYXVsdGluZyB0byB0aGUgcm9vdCBtYXRjaAoKCiAgICAgICAgICBmdW5jdGlvbiBmaW5kTmVhcmVzdEJvdW5kYXJ5KG1hdGNoZXMsIHJvdXRlSWQpIHsKICAgICAgICAgICAgdmFyIGVsaWdpYmxlTWF0Y2hlcyA9IHJvdXRlSWQgPyBtYXRjaGVzLnNsaWNlKDAsIG1hdGNoZXMuZmluZEluZGV4KChtKSA9PiBtLnJvdXRlLmlkID09PSByb3V0ZUlkKSArIDEpIDogX3RvQ29uc3VtYWJsZUFycmF5MihtYXRjaGVzKTsKICAgICAgICAgICAgcmV0dXJuIGVsaWdpYmxlTWF0Y2hlcy5yZXZlcnNlKCkuZmluZCgobSkgPT4gbS5yb3V0ZS5oYXNFcnJvckJvdW5kYXJ5ID09PSB0cnVlKSB8fCBtYXRjaGVzWzBdOwogICAgICAgICAgfQoKICAgICAgICAgIGZ1bmN0aW9uIGdldFNob3J0Q2lyY3VpdE1hdGNoZXMocm91dGVzKSB7CiAgICAgICAgICAgIC8vIFByZWZlciBhIHJvb3QgbGF5b3V0IHJvdXRlIGlmIHByZXNlbnQsIG90aGVyd2lzZSBzaGltIGluIGEgcm91dGUgb2JqZWN0CiAgICAgICAgICAgIHZhciByb3V0ZSA9IHJvdXRlcy5maW5kKChyKSA9PiByLmluZGV4IHx8ICFyLnBhdGggfHwgci5wYXRoID09PSAiLyIpIHx8IHsKICAgICAgICAgICAgICBpZDogIl9fc2hpbS1lcnJvci1yb3V0ZV9fIgogICAgICAgICAgICB9OwogICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgIG1hdGNoZXM6IFt7CiAgICAgICAgICAgICAgICBwYXJhbXM6IHt9LAogICAgICAgICAgICAgICAgcGF0aG5hbWU6ICIiLAogICAgICAgICAgICAgICAgcGF0aG5hbWVCYXNlOiAiIiwKICAgICAgICAgICAgICAgIHJvdXRlOiByb3V0ZQogICAgICAgICAgICAgIH1dLAogICAgICAgICAgICAgIHJvdXRlOiByb3V0ZQogICAgICAgICAgICB9OwogICAgICAgICAgfQoKICAgICAgICAgIGZ1bmN0aW9uIGdldEludGVybmFsUm91dGVyRXJyb3Ioc3RhdHVzLCBfdGVtcCkgewogICAgICAgICAgICB2YXIgX3JlZjI1ID0KCgoKCiAgICAgICAgICAgICAgX3RlbXAgPT09IHZvaWQgMCA/IHt9IDogX3RlbXAscGF0aG5hbWUgPSBfcmVmMjUucGF0aG5hbWUscm91dGVJZCA9IF9yZWYyNS5yb3V0ZUlkLG1ldGhvZCA9IF9yZWYyNS5tZXRob2QsbWVzc2FnZSA9IF9yZWYyNS5tZXNzYWdlOwogICAgICAgICAgICB2YXIgc3RhdHVzVGV4dCA9ICJVbmtub3duIFNlcnZlciBFcnJvciI7CiAgICAgICAgICAgIHZhciBlcnJvck1lc3NhZ2UgPSAiVW5rbm93biBAcmVtaXgtcnVuL3JvdXRlciBlcnJvciI7CgogICAgICAgICAgICBpZiAoc3RhdHVzID09PSA0MDApIHsKICAgICAgICAgICAgICBzdGF0dXNUZXh0ID0gIkJhZCBSZXF1ZXN0IjsKCiAgICAgICAgICAgICAgaWYgKG1ldGhvZCAmJiBwYXRobmFtZSAmJiByb3V0ZUlkKSB7CiAgICAgICAgICAgICAgICBlcnJvck1lc3NhZ2UgPSAiWW91IG1hZGUgYSAiICsgbWV0aG9kICsgIiByZXF1ZXN0IHRvIFwiIiArIHBhdGhuYW1lICsgIlwiIGJ1dCAiICsgKCJkaWQgbm90IHByb3ZpZGUgYSBgbG9hZGVyYCBmb3Igcm91dGUgXCIiICsgcm91dGVJZCArICJcIiwgIikgKyAic28gdGhlcmUgaXMgbm8gd2F5IHRvIGhhbmRsZSB0aGUgcmVxdWVzdC4iOwogICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBlcnJvck1lc3NhZ2UgPSAiQ2Fubm90IHN1Ym1pdCBiaW5hcnkgZm9ybSBkYXRhIHVzaW5nIEdFVCI7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2UgaWYgKHN0YXR1cyA9PT0gNDAzKSB7CiAgICAgICAgICAgICAgc3RhdHVzVGV4dCA9ICJGb3JiaWRkZW4iOwogICAgICAgICAgICAgIGVycm9yTWVzc2FnZSA9ICJSb3V0ZSBcIiIgKyByb3V0ZUlkICsgIlwiIGRvZXMgbm90IG1hdGNoIFVSTCBcIiIgKyBwYXRobmFtZSArICJcIiI7CiAgICAgICAgICAgIH0gZWxzZSBpZiAoc3RhdHVzID09PSA0MDQpIHsKICAgICAgICAgICAgICBzdGF0dXNUZXh0ID0gIk5vdCBGb3VuZCI7CiAgICAgICAgICAgICAgZXJyb3JNZXNzYWdlID0gIk5vIHJvdXRlIG1hdGNoZXMgVVJMIFwiIiArIHBhdGhuYW1lICsgIlwiIjsKICAgICAgICAgICAgfSBlbHNlIGlmIChzdGF0dXMgPT09IDQwNSkgewogICAgICAgICAgICAgIHN0YXR1c1RleHQgPSAiTWV0aG9kIE5vdCBBbGxvd2VkIjsKCiAgICAgICAgICAgICAgaWYgKG1ldGhvZCAmJiBwYXRobmFtZSAmJiByb3V0ZUlkKSB7CiAgICAgICAgICAgICAgICBlcnJvck1lc3NhZ2UgPSAiWW91IG1hZGUgYSAiICsgbWV0aG9kLnRvVXBwZXJDYXNlKCkgKyAiIHJlcXVlc3QgdG8gXCIiICsgcGF0aG5hbWUgKyAiXCIgYnV0ICIgKyAoImRpZCBub3QgcHJvdmlkZSBhbiBgYWN0aW9uYCBmb3Igcm91dGUgXCIiICsgcm91dGVJZCArICJcIiwgIikgKyAic28gdGhlcmUgaXMgbm8gd2F5IHRvIGhhbmRsZSB0aGUgcmVxdWVzdC4iOwogICAgICAgICAgICAgIH0gZWxzZSBpZiAobWV0aG9kKSB7CiAgICAgICAgICAgICAgICBlcnJvck1lc3NhZ2UgPSAiSW52YWxpZCByZXF1ZXN0IG1ldGhvZCBcIiIgKyBtZXRob2QudG9VcHBlckNhc2UoKSArICJcIiI7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICByZXR1cm4gbmV3IHJvdXRlcl9FcnJvclJlc3BvbnNlKHN0YXR1cyB8fCA1MDAsIHN0YXR1c1RleHQsIG5ldyBFcnJvcihlcnJvck1lc3NhZ2UpLCB0cnVlKTsKICAgICAgICAgIH0gLy8gRmluZCBhbnkgcmV0dXJuZWQgcmVkaXJlY3QgZXJyb3JzLCBzdGFydGluZyBmcm9tIHRoZSBsb3dlc3QgbWF0Y2gKCgogICAgICAgICAgZnVuY3Rpb24gZmluZFJlZGlyZWN0KHJlc3VsdHMpIHsKICAgICAgICAgICAgZm9yICh2YXIgaSA9IHJlc3VsdHMubGVuZ3RoIC0gMTsgaSA+PSAwOyBpLS0pIHsKICAgICAgICAgICAgICB2YXIgcmVzdWx0ID0gcmVzdWx0c1tpXTsKCiAgICAgICAgICAgICAgaWYgKGlzUmVkaXJlY3RSZXN1bHQocmVzdWx0KSkgewogICAgICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KCiAgICAgICAgICBmdW5jdGlvbiBzdHJpcEhhc2hGcm9tUGF0aChwYXRoKSB7CiAgICAgICAgICAgIHZhciBwYXJzZWRQYXRoID0gdHlwZW9mIHBhdGggPT09ICJzdHJpbmciID8gcGFyc2VQYXRoKHBhdGgpIDogcGF0aDsKICAgICAgICAgICAgcmV0dXJuIHJvdXRlcl9jcmVhdGVQYXRoKF9leHRlbmRzKHt9LCBwYXJzZWRQYXRoLCB7CiAgICAgICAgICAgICAgaGFzaDogIiIKICAgICAgICAgICAgfSkpOwogICAgICAgICAgfQoKICAgICAgICAgIGZ1bmN0aW9uIGlzSGFzaENoYW5nZU9ubHkoYSwgYikgewogICAgICAgICAgICByZXR1cm4gYS5wYXRobmFtZSA9PT0gYi5wYXRobmFtZSAmJiBhLnNlYXJjaCA9PT0gYi5zZWFyY2ggJiYgYS5oYXNoICE9PSBiLmhhc2g7CiAgICAgICAgICB9CgogICAgICAgICAgZnVuY3Rpb24gaXNEZWZlcnJlZFJlc3VsdChyZXN1bHQpIHsKICAgICAgICAgICAgcmV0dXJuIHJlc3VsdC50eXBlID09PSBSZXN1bHRUeXBlLmRlZmVycmVkOwogICAgICAgICAgfQoKICAgICAgICAgIGZ1bmN0aW9uIGlzRXJyb3JSZXN1bHQocmVzdWx0KSB7CiAgICAgICAgICAgIHJldHVybiByZXN1bHQudHlwZSA9PT0gUmVzdWx0VHlwZS5lcnJvcjsKICAgICAgICAgIH0KCiAgICAgICAgICBmdW5jdGlvbiBpc1JlZGlyZWN0UmVzdWx0KHJlc3VsdCkgewogICAgICAgICAgICByZXR1cm4gKHJlc3VsdCAmJiByZXN1bHQudHlwZSkgPT09IFJlc3VsdFR5cGUucmVkaXJlY3Q7CiAgICAgICAgICB9CgogICAgICAgICAgZnVuY3Rpb24gaXNSZWRpcmVjdFJlc3BvbnNlKHJlc3VsdCkgewogICAgICAgICAgICBpZiAoIShyZXN1bHQgaW5zdGFuY2VvZiBSZXNwb25zZSkpIHsKICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHZhciBzdGF0dXMgPSByZXN1bHQuc3RhdHVzOwogICAgICAgICAgICB2YXIgbG9jYXRpb24gPSByZXN1bHQuaGVhZGVycy5nZXQoIkxvY2F0aW9uIik7CiAgICAgICAgICAgIHJldHVybiBzdGF0dXMgPj0gMzAwICYmIHN0YXR1cyA8PSAzOTkgJiYgbG9jYXRpb24gIT0gbnVsbDsKICAgICAgICAgIH0KCiAgICAgICAgICBmdW5jdGlvbiBpc1F1ZXJ5Um91dGVSZXNwb25zZShvYmopIHsKICAgICAgICAgICAgcmV0dXJuIG9iaiAmJiBvYmoucmVzcG9uc2UgaW5zdGFuY2VvZiBSZXNwb25zZSAmJiAob2JqLnR5cGUgPT09IFJlc3VsdFR5cGUuZGF0YSB8fCBSZXN1bHRUeXBlLmVycm9yKTsKICAgICAgICAgIH0KCiAgICAgICAgICBmdW5jdGlvbiBpc1ZhbGlkTWV0aG9kKG1ldGhvZCkgewogICAgICAgICAgICByZXR1cm4gdmFsaWRSZXF1ZXN0TWV0aG9kcy5oYXMobWV0aG9kKTsKICAgICAgICAgIH0KCiAgICAgICAgICBmdW5jdGlvbiBpc1N1Ym1pc3Npb25NZXRob2QobWV0aG9kKSB7CiAgICAgICAgICAgIHJldHVybiB2YWxpZEFjdGlvbk1ldGhvZHMuaGFzKG1ldGhvZCk7CiAgICAgICAgICB9ZnVuY3Rpb24KCiAgICAgICAgICByZXNvbHZlRGVmZXJyZWRSZXN1bHRzKF94NjMsIF94NjQsIF94NjUsIF94NjYsIF94NjcsIF94NjgpIHtyZXR1cm4gX3Jlc29sdmVEZWZlcnJlZFJlc3VsdHMuYXBwbHkodGhpcywgYXJndW1lbnRzKTt9ZnVuY3Rpb24gX3Jlc29sdmVEZWZlcnJlZFJlc3VsdHMoKSB7X3Jlc29sdmVEZWZlcnJlZFJlc3VsdHMgPSBfYXN5bmNUb0dlbmVyYXRvcjIoIC8qI19fUFVSRV9fKi9fcmVnZW5lcmF0b3JSdW50aW1lMigpLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTE3KGN1cnJlbnRNYXRjaGVzLCBtYXRjaGVzVG9Mb2FkLCByZXN1bHRzLCBzaWduYWwsIGlzRmV0Y2hlciwgY3VycmVudExvYWRlckRhdGEpIHt2YXIgX2xvb3AyLCBpbmRleDtyZXR1cm4gX3JlZ2VuZXJhdG9yUnVudGltZTIoKS53cmFwKGZ1bmN0aW9uIF9jYWxsZWUxNyQoX2NvbnRleHQxOSkge3doaWxlICgxKSB7c3dpdGNoIChfY29udGV4dDE5LnByZXYgPSBfY29udGV4dDE5Lm5leHQpIHtjYXNlIDA6X2xvb3AyID0gLyojX19QVVJFX18qL19yZWdlbmVyYXRvclJ1bnRpbWUyKCkubWFyayhmdW5jdGlvbiBfbG9vcDIoCiAgICAgICAgICAgICAgICAgICAgICBpbmRleCkge3ZhciByZXN1bHQsIG1hdGNoLCBjdXJyZW50TWF0Y2gsIGlzUmV2YWxpZGF0aW5nTG9hZGVyO3JldHVybiBfcmVnZW5lcmF0b3JSdW50aW1lMigpLndyYXAoZnVuY3Rpb24gX2xvb3AyJChfY29udGV4dDE4KSB7d2hpbGUgKDEpIHtzd2l0Y2ggKF9jb250ZXh0MTgucHJldiA9IF9jb250ZXh0MTgubmV4dCkge2Nhc2UgMDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQgPSByZXN1bHRzW2luZGV4XTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtYXRjaCA9IG1hdGNoZXNUb0xvYWRbaW5kZXhdOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbnRNYXRjaCA9IGN1cnJlbnRNYXRjaGVzLmZpbmQoKG0pID0+IG0ucm91dGUuaWQgPT09IG1hdGNoLnJvdXRlLmlkKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpc1JldmFsaWRhdGluZ0xvYWRlciA9IGN1cnJlbnRNYXRjaCAhPSBudWxsICYmICFpc05ld1JvdXRlSW5zdGFuY2UoY3VycmVudE1hdGNoLCBtYXRjaCkgJiYgKGN1cnJlbnRMb2FkZXJEYXRhICYmIGN1cnJlbnRMb2FkZXJEYXRhW21hdGNoLnJvdXRlLmlkXSkgIT09IHVuZGVmaW5lZDtpZiAoISgKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaXNEZWZlcnJlZFJlc3VsdChyZXN1bHQpICYmIChpc0ZldGNoZXIgfHwgaXNSZXZhbGlkYXRpbmdMb2FkZXIpKSkge19jb250ZXh0MTgubmV4dCA9IDc7YnJlYWs7fV9jb250ZXh0MTgubmV4dCA9IDc7cmV0dXJuICgKCgoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmVEZWZlcnJlZERhdGEocmVzdWx0LCBzaWduYWwsIGlzRmV0Y2hlcikudGhlbigocmVzdWx0KSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZXN1bHQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXN1bHRzW2luZGV4XSA9IHJlc3VsdCB8fCByZXN1bHRzW2luZGV4XTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSkpO2Nhc2UgNzpjYXNlICJlbmQiOnJldHVybiBfY29udGV4dDE4LnN0b3AoKTt9fX0sIF9sb29wMik7fSk7aW5kZXggPSAwO2Nhc2UgMjppZiAoIShpbmRleCA8IHJlc3VsdHMubGVuZ3RoKSkge19jb250ZXh0MTkubmV4dCA9IDc7YnJlYWs7fXJldHVybiBfY29udGV4dDE5LmRlbGVnYXRlWWllbGQoX2xvb3AyKGluZGV4KSwgInQwIiwgNCk7Y2FzZSA0OmluZGV4Kys7X2NvbnRleHQxOS5uZXh0ID0gMjticmVhaztjYXNlIDc6Y2FzZSAiZW5kIjpyZXR1cm4gX2NvbnRleHQxOS5zdG9wKCk7fX19LCBfY2FsbGVlMTcpO30pKTtyZXR1cm4gX3Jlc29sdmVEZWZlcnJlZFJlc3VsdHMuYXBwbHkodGhpcywgYXJndW1lbnRzKTt9ZnVuY3Rpb24KCgoKCiAgICAgICAgICByZXNvbHZlRGVmZXJyZWREYXRhKF94NjksIF94NzAsIF94NzEpIHtyZXR1cm4gX3Jlc29sdmVEZWZlcnJlZERhdGEuYXBwbHkodGhpcywgYXJndW1lbnRzKTt9ZnVuY3Rpb24gX3Jlc29sdmVEZWZlcnJlZERhdGEoKSB7X3Jlc29sdmVEZWZlcnJlZERhdGEgPSBfYXN5bmNUb0dlbmVyYXRvcjIoIC8qI19fUFVSRV9fKi9fcmVnZW5lcmF0b3JSdW50aW1lMigpLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTE4KHJlc3VsdCwgc2lnbmFsLCB1bndyYXApIHt2YXIgYWJvcnRlZDtyZXR1cm4gX3JlZ2VuZXJhdG9yUnVudGltZTIoKS53cmFwKGZ1bmN0aW9uIF9jYWxsZWUxOCQoX2NvbnRleHQyMCkge3doaWxlICgxKSB7c3dpdGNoIChfY29udGV4dDIwLnByZXYgPSBfY29udGV4dDIwLm5leHQpIHtjYXNlIDA6CiAgICAgICAgICAgICAgICAgICAgICBpZiAodW53cmFwID09PSB2b2lkIDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgdW53cmFwID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgICB9X2NvbnRleHQyMC5uZXh0ID0gMztyZXR1cm4gKAoKICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0LmRlZmVycmVkRGF0YS5yZXNvbHZlRGF0YShzaWduYWwpKTtjYXNlIDM6YWJvcnRlZCA9IF9jb250ZXh0MjAuc2VudDtpZiAoIQoKICAgICAgICAgICAgICAgICAgICAgIGFib3J0ZWQpIHtfY29udGV4dDIwLm5leHQgPSA2O2JyZWFrO31yZXR1cm4gX2NvbnRleHQyMC5hYnJ1cHQoInJldHVybiIpO2Nhc2UgNjppZiAoIQoKCgogICAgICAgICAgICAgICAgICAgICAgdW53cmFwKSB7X2NvbnRleHQyMC5uZXh0ID0gMTQ7YnJlYWs7fV9jb250ZXh0MjAucHJldiA9IDc7cmV0dXJuIF9jb250ZXh0MjAuYWJydXB0KCJyZXR1cm4iLAoKICAgICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogUmVzdWx0VHlwZS5kYXRhLAogICAgICAgICAgICAgICAgICAgICAgICBkYXRhOiByZXN1bHQuZGVmZXJyZWREYXRhLnVud3JhcHBlZERhdGEKICAgICAgICAgICAgICAgICAgICAgIH0pO2Nhc2UgMTE6X2NvbnRleHQyMC5wcmV2ID0gMTE7X2NvbnRleHQyMC50MCA9IF9jb250ZXh0MjBbImNhdGNoIl0oNyk7cmV0dXJuIF9jb250ZXh0MjAuYWJydXB0KCJyZXR1cm4iLAoKCiAgICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6IFJlc3VsdFR5cGUuZXJyb3IsCiAgICAgICAgICAgICAgICAgICAgICAgIGVycm9yOiBfY29udGV4dDIwLnQwCiAgICAgICAgICAgICAgICAgICAgICB9KTtjYXNlIDE0OnJldHVybiBfY29udGV4dDIwLmFicnVwdCgicmV0dXJuIiwKCgoKICAgICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogUmVzdWx0VHlwZS5kYXRhLAogICAgICAgICAgICAgICAgICAgICAgICBkYXRhOiByZXN1bHQuZGVmZXJyZWREYXRhLmRhdGEKICAgICAgICAgICAgICAgICAgICAgIH0pO2Nhc2UgMTU6Y2FzZSAiZW5kIjpyZXR1cm4gX2NvbnRleHQyMC5zdG9wKCk7fX19LCBfY2FsbGVlMTgsIG51bGwsIFtbNywgMTFdXSk7fSkpO3JldHVybiBfcmVzb2x2ZURlZmVycmVkRGF0YS5hcHBseSh0aGlzLCBhcmd1bWVudHMpO30KCgogICAgICAgICAgZnVuY3Rpb24gaGFzTmFrZWRJbmRleFF1ZXJ5KHNlYXJjaCkgewogICAgICAgICAgICByZXR1cm4gbmV3IFVSTFNlYXJjaFBhcmFtcyhzZWFyY2gpLmdldEFsbCgiaW5kZXgiKS5zb21lKCh2KSA9PiB2ID09PSAiIik7CiAgICAgICAgICB9IC8vIE5vdGU6IFRoaXMgc2hvdWxkIG1hdGNoIHRoZSBmb3JtYXQgZXhwb3J0ZWQgYnkgdXNlTWF0Y2hlcywgc28gaWYgeW91IGNoYW5nZQogICAgICAgICAgLy8gdGhpcyBwbGVhc2UgYWxzbyBjaGFuZ2UgdGhhdCA6KSAgRXZlbnR1YWxseSB3ZSdsbCBEUlkgdGhpcyB1cAoKCiAgICAgICAgICBmdW5jdGlvbiBjcmVhdGVVc2VNYXRjaGVzTWF0Y2gobWF0Y2gsIGxvYWRlckRhdGEpIHsKICAgICAgICAgICAgdmFyCiAgICAgICAgICAgICAgcm91dGUgPQoKCiAgICAgICAgICAgICAgbWF0Y2gucm91dGUscGF0aG5hbWUgPSBtYXRjaC5wYXRobmFtZSxwYXJhbXMgPSBtYXRjaC5wYXJhbXM7CiAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgaWQ6IHJvdXRlLmlkLAogICAgICAgICAgICAgIHBhdGhuYW1lOiBwYXRobmFtZSwKICAgICAgICAgICAgICBwYXJhbXM6IHBhcmFtcywKICAgICAgICAgICAgICBkYXRhOiBsb2FkZXJEYXRhW3JvdXRlLmlkXSwKICAgICAgICAgICAgICBoYW5kbGU6IHJvdXRlLmhhbmRsZQogICAgICAgICAgICB9OwogICAgICAgICAgfQoKICAgICAgICAgIGZ1bmN0aW9uIGdldFRhcmdldE1hdGNoKG1hdGNoZXMsIGxvY2F0aW9uKSB7CiAgICAgICAgICAgIHZhciBzZWFyY2ggPSB0eXBlb2YgbG9jYXRpb24gPT09ICJzdHJpbmciID8gcGFyc2VQYXRoKGxvY2F0aW9uKS5zZWFyY2ggOiBsb2NhdGlvbi5zZWFyY2g7CgogICAgICAgICAgICBpZiAobWF0Y2hlc1ttYXRjaGVzLmxlbmd0aCAtIDFdLnJvdXRlLmluZGV4ICYmIGhhc05ha2VkSW5kZXhRdWVyeShzZWFyY2ggfHwgIiIpKSB7CiAgICAgICAgICAgICAgLy8gUmV0dXJuIHRoZSBsZWFmIGluZGV4IHJvdXRlIHdoZW4gaW5kZXggaXMgcHJlc2VudAogICAgICAgICAgICAgIHJldHVybiBtYXRjaGVzW21hdGNoZXMubGVuZ3RoIC0gMV07CiAgICAgICAgICAgIH0gLy8gT3RoZXJ3aXNlIGdyYWIgdGhlIGRlZXBlc3QgInBhdGggY29udHJpYnV0aW5nIiBtYXRjaCAoaWdub3JpbmcgaW5kZXggYW5kCiAgICAgICAgICAgIC8vIHBhdGhsZXNzIGxheW91dCByb3V0ZXMpCgoKICAgICAgICAgICAgdmFyIHBhdGhNYXRjaGVzID0gZ2V0UGF0aENvbnRyaWJ1dGluZ01hdGNoZXMobWF0Y2hlcyk7CiAgICAgICAgICAgIHJldHVybiBwYXRoTWF0Y2hlc1twYXRoTWF0Y2hlcy5sZW5ndGggLSAxXTsKICAgICAgICAgIH0gLy8jZW5kcmVnaW9uCgoKCgogICAgICAgICAgLy8gRVhURVJOQUwgTU9EVUxFOiAuL25vZGVfbW9kdWxlcy9yZWFjdC9pbmRleC5qcwogICAgICAgICAgdmFyIHJlYWN0ID0gX193ZWJwYWNrX3JlcXVpcmVfXygyOTQpOwogICAgICAgICAgdmFyIHJlYWN0X25hbWVzcGFjZU9iamVjdCA9IC8qI19fUFVSRV9fKi9fX3dlYnBhY2tfcmVxdWlyZV9fLnQocmVhY3QsIDIpOwogICAgICAgICAgOyAvLyBDT05DQVRFTkFURUQgTU9EVUxFOiAuL25vZGVfbW9kdWxlcy9yZWFjdC1yb3V0ZXIvZGlzdC9pbmRleC5qcwogICAgICAgICAgLyoqCiAgICAgICAgICAgKiBSZWFjdCBSb3V0ZXIgdjYuNC40CiAgICAgICAgICAgKgogICAgICAgICAgICogQ29weXJpZ2h0IChjKSBSZW1peCBTb2Z0d2FyZSBJbmMuCiAgICAgICAgICAgKgogICAgICAgICAgICogVGhpcyBzb3VyY2UgY29kZSBpcyBsaWNlbnNlZCB1bmRlciB0aGUgTUlUIGxpY2Vuc2UgZm91bmQgaW4gdGhlCiAgICAgICAgICAgKiBMSUNFTlNFLm1kIGZpbGUgaW4gdGhlIHJvb3QgZGlyZWN0b3J5IG9mIHRoaXMgc291cmNlIHRyZWUuCiAgICAgICAgICAgKgogICAgICAgICAgICogQGxpY2Vuc2UgTUlUCiAgICAgICAgICAgKi8KCgoKCiAgICAgICAgICBmdW5jdGlvbiBkaXN0X2V4dGVuZHMoKSB7CiAgICAgICAgICAgIGRpc3RfZXh0ZW5kcyA9IE9iamVjdC5hc3NpZ24gPyBPYmplY3QuYXNzaWduLmJpbmQoKSA6IGZ1bmN0aW9uICh0YXJnZXQpIHsKICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMTsgaSA8IGFyZ3VtZW50cy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAgdmFyIHNvdXJjZSA9IGFyZ3VtZW50c1tpXTsKCiAgICAgICAgICAgICAgICBmb3IgKHZhciBrZXkgaW4gc291cmNlKSB7CiAgICAgICAgICAgICAgICAgIGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoc291cmNlLCBrZXkpKSB7CiAgICAgICAgICAgICAgICAgICAgdGFyZ2V0W2tleV0gPSBzb3VyY2Vba2V5XTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgcmV0dXJuIHRhcmdldDsKICAgICAgICAgICAgfTsKICAgICAgICAgICAgcmV0dXJuIGRpc3RfZXh0ZW5kcy5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICAgICAgfQoKICAgICAgICAgIC8qKgogICAgICAgICAgICogQ29weXJpZ2h0IChjKSBGYWNlYm9vaywgSW5jLiBhbmQgaXRzIGFmZmlsaWF0ZXMuCiAgICAgICAgICAgKgogICAgICAgICAgICogVGhpcyBzb3VyY2UgY29kZSBpcyBsaWNlbnNlZCB1bmRlciB0aGUgTUlUIGxpY2Vuc2UgZm91bmQgaW4gdGhlCiAgICAgICAgICAgKiBMSUNFTlNFIGZpbGUgaW4gdGhlIHJvb3QgZGlyZWN0b3J5IG9mIHRoaXMgc291cmNlIHRyZWUuCiAgICAgICAgICAgKi8KICAgICAgICAgIC8qKgogICAgICAgICAgICogaW5saW5lZCBPYmplY3QuaXMgcG9seWZpbGwgdG8gYXZvaWQgcmVxdWlyaW5nIGNvbnN1bWVycyBzaGlwIHRoZWlyIG93bgogICAgICAgICAgICogaHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvZW4tVVMvZG9jcy9XZWIvSmF2YVNjcmlwdC9SZWZlcmVuY2UvR2xvYmFsX09iamVjdHMvT2JqZWN0L2lzCiAgICAgICAgICAgKi8KCiAgICAgICAgICBmdW5jdGlvbiBpc1BvbHlmaWxsKHgsIHkpIHsKICAgICAgICAgICAgcmV0dXJuIHggPT09IHkgJiYgKHggIT09IDAgfHwgMSAvIHggPT09IDEgLyB5KSB8fCB4ICE9PSB4ICYmIHkgIT09IHkgLy8gZXNsaW50LWRpc2FibGUtbGluZSBuby1zZWxmLWNvbXBhcmUKICAgICAgICAgICAgOwogICAgICAgICAgfQoKICAgICAgICAgIHZhciBpcyA9IHR5cGVvZiBPYmplY3QuaXMgPT09ICJmdW5jdGlvbiIgPyBPYmplY3QuaXMgOiBpc1BvbHlmaWxsOyAvLyBJbnRlbnRpb25hbGx5IG5vdCB1c2luZyBuYW1lZCBpbXBvcnRzIGJlY2F1c2UgUm9sbHVwIHVzZXMgZHluYW1pYwogICAgICAgICAgLy8gZGlzcGF0Y2ggZm9yIENvbW1vbkpTIGludGVyb3AgbmFtZWQgaW1wb3J0cy4KCiAgICAgICAgICB2YXIKICAgICAgICAgICAgdXNlU3RhdGUgPQoKCgogICAgICAgICAgICByZWFjdF9uYW1lc3BhY2VPYmplY3QudXNlU3RhdGUsdXNlRWZmZWN0ID0gcmVhY3RfbmFtZXNwYWNlT2JqZWN0LnVzZUVmZmVjdCx1c2VMYXlvdXRFZmZlY3QgPSByZWFjdF9uYW1lc3BhY2VPYmplY3QudXNlTGF5b3V0RWZmZWN0LHVzZURlYnVnVmFsdWUgPSByZWFjdF9uYW1lc3BhY2VPYmplY3QudXNlRGVidWdWYWx1ZTsKICAgICAgICAgIHZhciBkaWRXYXJuT2xkMThBbHBoYSA9IGZhbHNlOwogICAgICAgICAgdmFyIGRpZFdhcm5VbmNhY2hlZEdldFNuYXBzaG90ID0gZmFsc2U7IC8vIERpc2NsYWltZXI6IFRoaXMgc2hpbSBicmVha3MgbWFueSBvZiB0aGUgcnVsZXMgb2YgUmVhY3QsIGFuZCBvbmx5IHdvcmtzCiAgICAgICAgICAvLyBiZWNhdXNlIG9mIGEgdmVyeSBwYXJ0aWN1bGFyIHNldCBvZiBpbXBsZW1lbnRhdGlvbiBkZXRhaWxzIGFuZCBhc3N1bXB0aW9ucwogICAgICAgICAgLy8gLS0gY2hhbmdlIGFueSBvbmUgb2YgdGhlbSBhbmQgaXQgd2lsbCBicmVhay4gVGhlIG1vc3QgaW1wb3J0YW50IGFzc3VtcHRpb24KICAgICAgICAgIC8vIGlzIHRoYXQgdXBkYXRlcyBhcmUgYWx3YXlzIHN5bmNocm9ub3VzLCBiZWNhdXNlIGNvbmN1cnJlbnQgcmVuZGVyaW5nIGlzCiAgICAgICAgICAvLyBvbmx5IGF2YWlsYWJsZSBpbiB2ZXJzaW9ucyBvZiBSZWFjdCB0aGF0IGFsc28gaGF2ZSBhIGJ1aWx0LWluCiAgICAgICAgICAvLyB1c2VTeW5jRXh0ZXJuYWxTdG9yZSBBUEkuIEFuZCB3ZSBvbmx5IHVzZSB0aGlzIHNoaW0gd2hlbiB0aGUgYnVpbHQtaW4gQVBJCiAgICAgICAgICAvLyBkb2VzIG5vdCBleGlzdC4KICAgICAgICAgIC8vCiAgICAgICAgICAvLyBEbyBub3QgYXNzdW1lIHRoYXQgdGhlIGNsZXZlciBoYWNrcyB1c2VkIGJ5IHRoaXMgaG9vayBhbHNvIHdvcmsgaW4gZ2VuZXJhbC4KICAgICAgICAgIC8vIFRoZSBwb2ludCBvZiB0aGlzIHNoaW0gaXMgdG8gcmVwbGFjZSB0aGUgbmVlZCBmb3IgaGFja3MgYnkgb3RoZXIgbGlicmFyaWVzLgoKICAgICAgICAgIGZ1bmN0aW9uIHVzZVN5bmNFeHRlcm5hbFN0b3JlJDIoc3Vic2NyaWJlLCBnZXRTbmFwc2hvdCwgLy8gTm90ZTogVGhlIHNoaW0gZG9lcyBub3QgdXNlIGdldFNlcnZlclNuYXBzaG90LCBiZWNhdXNlIHByZS0xOCB2ZXJzaW9ucyBvZgogICAgICAgICAgLy8gUmVhY3QgZG8gbm90IGV4cG9zZSBhIHdheSB0byBjaGVjayBpZiB3ZSdyZSBoeWRyYXRpbmcuIFNvIHVzZXJzIG9mIHRoZSBzaGltCiAgICAgICAgICAvLyB3aWxsIG5lZWQgdG8gdHJhY2sgdGhhdCB0aGVtc2VsdmVzIGFuZCByZXR1cm4gdGhlIGNvcnJlY3QgdmFsdWUKICAgICAgICAgIC8vIGZyb20gYGdldFNuYXBzaG90YC4KICAgICAgICAgIGdldFNlcnZlclNuYXBzaG90KSB7CiAgICAgICAgICAgIGlmIChmYWxzZSkge30gLy8gUmVhZCB0aGUgY3VycmVudCBzbmFwc2hvdCBmcm9tIHRoZSBzdG9yZSBvbiBldmVyeSByZW5kZXIuIEFnYWluLCB0aGlzCiAgICAgICAgICAgIC8vIGJyZWFrcyB0aGUgcnVsZXMgb2YgUmVhY3QsIGFuZCBvbmx5IHdvcmtzIGhlcmUgYmVjYXVzZSBvZiBzcGVjaWZpYwogICAgICAgICAgICAvLyBpbXBsZW1lbnRhdGlvbiBkZXRhaWxzLCBtb3N0IGltcG9ydGFudGx5IHRoYXQgdXBkYXRlcyBhcmUKICAgICAgICAgICAgLy8gYWx3YXlzIHN5bmNocm9ub3VzLgoKCiAgICAgICAgICAgIHZhciB2YWx1ZSA9IGdldFNuYXBzaG90KCk7CgogICAgICAgICAgICBpZiAoZmFsc2UpIHt9IC8vIEJlY2F1c2UgdXBkYXRlcyBhcmUgc3luY2hyb25vdXMsIHdlIGRvbid0IHF1ZXVlIHRoZW0uIEluc3RlYWQgd2UgZm9yY2UgYQogICAgICAgICAgICAvLyByZS1yZW5kZXIgd2hlbmV2ZXIgdGhlIHN1YnNjcmliZWQgc3RhdGUgY2hhbmdlcyBieSB1cGRhdGluZyBhbiBzb21lCiAgICAgICAgICAgIC8vIGFyYml0cmFyeSB1c2VTdGF0ZSBob29rLiBUaGVuLCBkdXJpbmcgcmVuZGVyLCB3ZSBjYWxsIGdldFNuYXBzaG90IHRvIHJlYWQKICAgICAgICAgICAgLy8gdGhlIGN1cnJlbnQgdmFsdWUuCiAgICAgICAgICAgIC8vCiAgICAgICAgICAgIC8vIEJlY2F1c2Ugd2UgZG9uJ3QgYWN0dWFsbHkgdXNlIHRoZSBzdGF0ZSByZXR1cm5lZCBieSB0aGUgdXNlU3RhdGUgaG9vaywgd2UKICAgICAgICAgICAgLy8gY2FuIHNhdmUgYSBiaXQgb2YgbWVtb3J5IGJ5IHN0b3Jpbmcgb3RoZXIgc3R1ZmYgaW4gdGhhdCBzbG90LgogICAgICAgICAgICAvLwogICAgICAgICAgICAvLyBUbyBpbXBsZW1lbnQgdGhlIGVhcmx5IGJhaWxvdXQsIHdlIG5lZWQgdG8gdHJhY2sgc29tZSB0aGluZ3Mgb24gYSBtdXRhYmxlCiAgICAgICAgICAgIC8vIG9iamVjdC4gVXN1YWxseSwgd2Ugd291bGQgcHV0IHRoYXQgaW4gYSB1c2VSZWYgaG9vaywgYnV0IHdlIGNhbiBzdGFzaCBpdCBpbgogICAgICAgICAgICAvLyBvdXIgdXNlU3RhdGUgaG9vayBpbnN0ZWFkLgogICAgICAgICAgICAvLwogICAgICAgICAgICAvLyBUbyBmb3JjZSBhIHJlLXJlbmRlciwgd2UgY2FsbCBmb3JjZVVwZGF0ZSh7aW5zdH0pLiBUaGF0IHdvcmtzIGJlY2F1c2UgdGhlCiAgICAgICAgICAgIC8vIG5ldyBvYmplY3QgYWx3YXlzIGZhaWxzIGFuIGVxdWFsaXR5IGNoZWNrLgoKCiAgICAgICAgICAgIHZhciBfdXNlU3RhdGUzID0KCiAgICAgICAgICAgICAgdXNlU3RhdGUoewogICAgICAgICAgICAgICAgaW5zdDogewogICAgICAgICAgICAgICAgICB2YWx1ZTogdmFsdWUsCiAgICAgICAgICAgICAgICAgIGdldFNuYXBzaG90OiBnZXRTbmFwc2hvdAogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0pLF91c2VTdGF0ZTQgPSBfc2xpY2VkVG9BcnJheTIoX3VzZVN0YXRlMywgMiksaW5zdCA9IF91c2VTdGF0ZTRbMF0uaW5zdCxmb3JjZVVwZGF0ZSA9IF91c2VTdGF0ZTRbMV07IC8vIFRyYWNrIHRoZSBsYXRlc3QgZ2V0U25hcHNob3QgZnVuY3Rpb24gd2l0aCBhIHJlZi4gVGhpcyBuZWVkcyB0byBiZSB1cGRhdGVkCiAgICAgICAgICAgIC8vIGluIHRoZSBsYXlvdXQgcGhhc2Ugc28gd2UgY2FuIGFjY2VzcyBpdCBkdXJpbmcgdGhlIHRlYXJpbmcgY2hlY2sgdGhhdAogICAgICAgICAgICAvLyBoYXBwZW5zIG9uIHN1YnNjcmliZS4KCiAgICAgICAgICAgIHVzZUxheW91dEVmZmVjdCgoKSA9PiB7CiAgICAgICAgICAgICAgaW5zdC52YWx1ZSA9IHZhbHVlOwogICAgICAgICAgICAgIGluc3QuZ2V0U25hcHNob3QgPSBnZXRTbmFwc2hvdDsgLy8gV2hlbmV2ZXIgZ2V0U25hcHNob3Qgb3Igc3Vic2NyaWJlIGNoYW5nZXMsIHdlIG5lZWQgdG8gY2hlY2sgaW4gdGhlCiAgICAgICAgICAgICAgLy8gY29tbWl0IHBoYXNlIGlmIHRoZXJlIHdhcyBhbiBpbnRlcmxlYXZlZCBtdXRhdGlvbi4gSW4gY29uY3VycmVudCBtb2RlCiAgICAgICAgICAgICAgLy8gdGhpcyBjYW4gaGFwcGVuIGFsbCB0aGUgdGltZSwgYnV0IGV2ZW4gaW4gc3luY2hyb25vdXMgbW9kZSwgYW4gZWFybGllcgogICAgICAgICAgICAgIC8vIGVmZmVjdCBtYXkgaGF2ZSBtdXRhdGVkIHRoZSBzdG9yZS4KCiAgICAgICAgICAgICAgaWYgKGNoZWNrSWZTbmFwc2hvdENoYW5nZWQoaW5zdCkpIHsKICAgICAgICAgICAgICAgIC8vIEZvcmNlIGEgcmUtcmVuZGVyLgogICAgICAgICAgICAgICAgZm9yY2VVcGRhdGUoewogICAgICAgICAgICAgICAgICBpbnN0OiBpbnN0CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICB9IC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSByZWFjdC1ob29rcy9leGhhdXN0aXZlLWRlcHMKCiAgICAgICAgICAgIH0sIFtzdWJzY3JpYmUsIHZhbHVlLCBnZXRTbmFwc2hvdF0pOwogICAgICAgICAgICB1c2VFZmZlY3QoKCkgPT4gewogICAgICAgICAgICAgIC8vIENoZWNrIGZvciBjaGFuZ2VzIHJpZ2h0IGJlZm9yZSBzdWJzY3JpYmluZy4gU3Vic2VxdWVudCBjaGFuZ2VzIHdpbGwgYmUKICAgICAgICAgICAgICAvLyBkZXRlY3RlZCBpbiB0aGUgc3Vic2NyaXB0aW9uIGhhbmRsZXIuCiAgICAgICAgICAgICAgaWYgKGNoZWNrSWZTbmFwc2hvdENoYW5nZWQoaW5zdCkpIHsKICAgICAgICAgICAgICAgIC8vIEZvcmNlIGEgcmUtcmVuZGVyLgogICAgICAgICAgICAgICAgZm9yY2VVcGRhdGUoewogICAgICAgICAgICAgICAgICBpbnN0OiBpbnN0CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIHZhciBoYW5kbGVTdG9yZUNoYW5nZSA9ICgpID0+IHsKICAgICAgICAgICAgICAgIC8vIFRPRE86IEJlY2F1c2UgdGhlcmUgaXMgbm8gY3Jvc3MtcmVuZGVyZXIgQVBJIGZvciBiYXRjaGluZyB1cGRhdGVzLCBpdCdzCiAgICAgICAgICAgICAgICAvLyB1cCB0byB0aGUgY29uc3VtZXIgb2YgdGhpcyBsaWJyYXJ5IHRvIHdyYXAgdGhlaXIgc3Vic2NyaXB0aW9uIGV2ZW50CiAgICAgICAgICAgICAgICAvLyB3aXRoIHVuc3RhYmxlX2JhdGNoZWRVcGRhdGVzLiBTaG91bGQgd2UgdHJ5IHRvIGRldGVjdCB3aGVuIHRoaXMgaXNuJ3QKICAgICAgICAgICAgICAgIC8vIHRoZSBjYXNlIGFuZCBwcmludCBhIHdhcm5pbmcgaW4gZGV2ZWxvcG1lbnQ/CiAgICAgICAgICAgICAgICAvLyBUaGUgc3RvcmUgY2hhbmdlZC4gQ2hlY2sgaWYgdGhlIHNuYXBzaG90IGNoYW5nZWQgc2luY2UgdGhlIGxhc3QgdGltZSB3ZQogICAgICAgICAgICAgICAgLy8gcmVhZCBmcm9tIHRoZSBzdG9yZS4KICAgICAgICAgICAgICAgIGlmIChjaGVja0lmU25hcHNob3RDaGFuZ2VkKGluc3QpKSB7CiAgICAgICAgICAgICAgICAgIC8vIEZvcmNlIGEgcmUtcmVuZGVyLgogICAgICAgICAgICAgICAgICBmb3JjZVVwZGF0ZSh7CiAgICAgICAgICAgICAgICAgICAgaW5zdDogaW5zdAogICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9OyAvLyBTdWJzY3JpYmUgdG8gdGhlIHN0b3JlIGFuZCByZXR1cm4gYSBjbGVhbi11cCBmdW5jdGlvbi4KCgogICAgICAgICAgICAgIHJldHVybiBzdWJzY3JpYmUoaGFuZGxlU3RvcmVDaGFuZ2UpOyAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgcmVhY3QtaG9va3MvZXhoYXVzdGl2ZS1kZXBzCiAgICAgICAgICAgIH0sIFtzdWJzY3JpYmVdKTsKICAgICAgICAgICAgdXNlRGVidWdWYWx1ZSh2YWx1ZSk7CiAgICAgICAgICAgIHJldHVybiB2YWx1ZTsKICAgICAgICAgIH0KCiAgICAgICAgICBmdW5jdGlvbiBjaGVja0lmU25hcHNob3RDaGFuZ2VkKGluc3QpIHsKICAgICAgICAgICAgdmFyIGxhdGVzdEdldFNuYXBzaG90ID0gaW5zdC5nZXRTbmFwc2hvdDsKICAgICAgICAgICAgdmFyIHByZXZWYWx1ZSA9IGluc3QudmFsdWU7CgogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgIHZhciBuZXh0VmFsdWUgPSBsYXRlc3RHZXRTbmFwc2hvdCgpOwogICAgICAgICAgICAgIHJldHVybiAhaXMocHJldlZhbHVlLCBuZXh0VmFsdWUpOwogICAgICAgICAgICB9IGNhdGNoIChlcnJvcikgewogICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICB9CiAgICAgICAgICB9CgogICAgICAgICAgLyoqCiAgICAgICAgICAgKiBDb3B5cmlnaHQgKGMpIEZhY2Vib29rLCBJbmMuIGFuZCBpdHMgYWZmaWxpYXRlcy4KICAgICAgICAgICAqCiAgICAgICAgICAgKiBUaGlzIHNvdXJjZSBjb2RlIGlzIGxpY2Vuc2VkIHVuZGVyIHRoZSBNSVQgbGljZW5zZSBmb3VuZCBpbiB0aGUKICAgICAgICAgICAqIExJQ0VOU0UgZmlsZSBpbiB0aGUgcm9vdCBkaXJlY3Rvcnkgb2YgdGhpcyBzb3VyY2UgdHJlZS4KICAgICAgICAgICAqCiAgICAgICAgICAgKiBAZmxvdwogICAgICAgICAgICovCiAgICAgICAgICBmdW5jdGlvbiB1c2VTeW5jRXh0ZXJuYWxTdG9yZSQxKHN1YnNjcmliZSwgZ2V0U25hcHNob3QsIGdldFNlcnZlclNuYXBzaG90KSB7CiAgICAgICAgICAgIC8vIE5vdGU6IFRoZSBzaGltIGRvZXMgbm90IHVzZSBnZXRTZXJ2ZXJTbmFwc2hvdCwgYmVjYXVzZSBwcmUtMTggdmVyc2lvbnMgb2YKICAgICAgICAgICAgLy8gUmVhY3QgZG8gbm90IGV4cG9zZSBhIHdheSB0byBjaGVjayBpZiB3ZSdyZSBoeWRyYXRpbmcuIFNvIHVzZXJzIG9mIHRoZSBzaGltCiAgICAgICAgICAgIC8vIHdpbGwgbmVlZCB0byB0cmFjayB0aGF0IHRoZW1zZWx2ZXMgYW5kIHJldHVybiB0aGUgY29ycmVjdCB2YWx1ZQogICAgICAgICAgICAvLyBmcm9tIGBnZXRTbmFwc2hvdGAuCiAgICAgICAgICAgIHJldHVybiBnZXRTbmFwc2hvdCgpOwogICAgICAgICAgfQoKICAgICAgICAgIC8qKgogICAgICAgICAgICogSW5saW5lZCBpbnRvIHRoZSByZWFjdC1yb3V0ZXIgcmVwbyBzaW5jZSB1c2Utc3luYy1leHRlcm5hbC1zdG9yZSBkb2VzIG5vdAogICAgICAgICAgICogcHJvdmlkZSBhIFVNRC1jb21wYXRpYmxlIHBhY2thZ2UsIHNvIHdlIG5lZWQgdGhpcyB0byBiZSBhYmxlIHRvIGRpc3RyaWJ1dGUKICAgICAgICAgICAqIFVNRCByZWFjdC1yb3V0ZXIgYnVuZGxlcwogICAgICAgICAgICovCiAgICAgICAgICB2YXIgY2FuVXNlRE9NID0gISEodHlwZW9mIHdpbmRvdyAhPT0gInVuZGVmaW5lZCIgJiYgdHlwZW9mIHdpbmRvdy5kb2N1bWVudCAhPT0gInVuZGVmaW5lZCIgJiYgdHlwZW9mIHdpbmRvdy5kb2N1bWVudC5jcmVhdGVFbGVtZW50ICE9PSAidW5kZWZpbmVkIik7CiAgICAgICAgICB2YXIgaXNTZXJ2ZXJFbnZpcm9ubWVudCA9ICFjYW5Vc2VET007CiAgICAgICAgICB2YXIgc2hpbSA9IGlzU2VydmVyRW52aXJvbm1lbnQgPyB1c2VTeW5jRXh0ZXJuYWxTdG9yZSQxIDogdXNlU3luY0V4dGVybmFsU3RvcmUkMjsKICAgICAgICAgIHZhciB1c2VTeW5jRXh0ZXJuYWxTdG9yZSA9IHRydWUgPyAoKG1vZHVsZSkgPT4gbW9kdWxlLnVzZVN5bmNFeHRlcm5hbFN0b3JlKShyZWFjdF9uYW1lc3BhY2VPYmplY3QpIDogc2hpbTsKCiAgICAgICAgICAvLyBDb250ZXh0cyBmb3IgZGF0YSByb3V0ZXJzCiAgICAgICAgICB2YXIgRGF0YVN0YXRpY1JvdXRlckNvbnRleHQgPSAvKiNfX1BVUkVfXyovcmVhY3QuY3JlYXRlQ29udGV4dChudWxsKTsKCiAgICAgICAgICBpZiAoZmFsc2UpIHt9CgogICAgICAgICAgdmFyIERhdGFSb3V0ZXJDb250ZXh0ID0gLyojX19QVVJFX18qL3JlYWN0LmNyZWF0ZUNvbnRleHQobnVsbCk7CgogICAgICAgICAgaWYgKGZhbHNlKSB7fQoKICAgICAgICAgIHZhciBEYXRhUm91dGVyU3RhdGVDb250ZXh0ID0gLyojX19QVVJFX18qL3JlYWN0LmNyZWF0ZUNvbnRleHQobnVsbCk7CgogICAgICAgICAgaWYgKGZhbHNlKSB7fQoKICAgICAgICAgIHZhciBBd2FpdENvbnRleHQgPSAvKiNfX1BVUkVfXyovIC8qIHVudXNlZCBwdXJlIGV4cHJlc3Npb24gb3Igc3VwZXIgKi9udWxsICYmIFJlYWN0LmNyZWF0ZUNvbnRleHQobnVsbCk7CgogICAgICAgICAgaWYgKGZhbHNlKSB7fQoKICAgICAgICAgIHZhciBOYXZpZ2F0aW9uQ29udGV4dCA9IC8qI19fUFVSRV9fKi9yZWFjdC5jcmVhdGVDb250ZXh0KG51bGwpOwoKICAgICAgICAgIGlmIChmYWxzZSkge30KCiAgICAgICAgICB2YXIgTG9jYXRpb25Db250ZXh0ID0gLyojX19QVVJFX18qL3JlYWN0LmNyZWF0ZUNvbnRleHQobnVsbCk7CgogICAgICAgICAgaWYgKGZhbHNlKSB7fQoKICAgICAgICAgIHZhciBSb3V0ZUNvbnRleHQgPSAvKiNfX1BVUkVfXyovcmVhY3QuY3JlYXRlQ29udGV4dCh7CiAgICAgICAgICAgIG91dGxldDogbnVsbCwKICAgICAgICAgICAgbWF0Y2hlczogW10KICAgICAgICAgIH0pOwoKICAgICAgICAgIGlmIChmYWxzZSkge30KCiAgICAgICAgICB2YXIgUm91dGVFcnJvckNvbnRleHQgPSAvKiNfX1BVUkVfXyovcmVhY3QuY3JlYXRlQ29udGV4dChudWxsKTsKCiAgICAgICAgICBpZiAoZmFsc2UpIHt9CgogICAgICAgICAgLyoqCiAgICAgICAgICAgKiBSZXR1cm5zIHRoZSBmdWxsIGhyZWYgZm9yIHRoZSBnaXZlbiAidG8iIHZhbHVlLiBUaGlzIGlzIHVzZWZ1bCBmb3IgYnVpbGRpbmcKICAgICAgICAgICAqIGN1c3RvbSBsaW5rcyB0aGF0IGFyZSBhbHNvIGFjY2Vzc2libGUgYW5kIHByZXNlcnZlIHJpZ2h0LWNsaWNrIGJlaGF2aW9yLgogICAgICAgICAgICoKICAgICAgICAgICAqIEBzZWUgaHR0cHM6Ly9yZWFjdHJvdXRlci5jb20vZG9jcy9lbi92Ni9ob29rcy91c2UtaHJlZgogICAgICAgICAgICovCgogICAgICAgICAgZnVuY3Rpb24gdXNlSHJlZih0bywgX3RlbXApIHsKICAgICAgICAgICAgdmFyIF9yZWYyNiA9CgogICAgICAgICAgICAgIF90ZW1wID09PSB2b2lkIDAgPyB7fSA6IF90ZW1wLHJlbGF0aXZlID0gX3JlZjI2LnJlbGF0aXZlOwogICAgICAgICAgICAhdXNlSW5Sb3V0ZXJDb250ZXh0KCkgPyBmYWxzZSA/IDAgOiByb3V0ZXJfaW52YXJpYW50KGZhbHNlKSA6IHZvaWQgMDsKICAgICAgICAgICAgdmFyIF9yZWFjdCR1c2VDb250ZXh0ID0KCgogICAgICAgICAgICAgIHJlYWN0LnVzZUNvbnRleHQoTmF2aWdhdGlvbkNvbnRleHQpLGJhc2VuYW1lID0gX3JlYWN0JHVzZUNvbnRleHQuYmFzZW5hbWUsbmF2aWdhdG9yID0gX3JlYWN0JHVzZUNvbnRleHQubmF2aWdhdG9yOwogICAgICAgICAgICB2YXIgX2Rpc3RfdXNlUmVzb2x2ZWRQYXRoID0KCgoKICAgICAgICAgICAgICBkaXN0X3VzZVJlc29sdmVkUGF0aCh0bywgewogICAgICAgICAgICAgICAgcmVsYXRpdmU6IHJlbGF0aXZlCiAgICAgICAgICAgICAgfSksaGFzaCA9IF9kaXN0X3VzZVJlc29sdmVkUGF0aC5oYXNoLHBhdGhuYW1lID0gX2Rpc3RfdXNlUmVzb2x2ZWRQYXRoLnBhdGhuYW1lLHNlYXJjaCA9IF9kaXN0X3VzZVJlc29sdmVkUGF0aC5zZWFyY2g7CiAgICAgICAgICAgIHZhciBqb2luZWRQYXRobmFtZSA9IHBhdGhuYW1lOyAvLyBJZiB3ZSdyZSBvcGVyYXRpbmcgd2l0aGluIGEgYmFzZW5hbWUsIHByZXBlbmQgaXQgdG8gdGhlIHBhdGhuYW1lIHByaW9yCiAgICAgICAgICAgIC8vIHRvIGNyZWF0aW5nIHRoZSBocmVmLiAgSWYgdGhpcyBpcyBhIHJvb3QgbmF2aWdhdGlvbiwgdGhlbiBqdXN0IHVzZSB0aGUgcmF3CiAgICAgICAgICAgIC8vIGJhc2VuYW1lIHdoaWNoIGFsbG93cyB0aGUgYmFzZW5hbWUgdG8gaGF2ZSBmdWxsIGNvbnRyb2wgb3ZlciB0aGUgcHJlc2VuY2UKICAgICAgICAgICAgLy8gb2YgYSB0cmFpbGluZyBzbGFzaCBvbiByb290IGxpbmtzCgogICAgICAgICAgICBpZiAoYmFzZW5hbWUgIT09ICIvIikgewogICAgICAgICAgICAgIGpvaW5lZFBhdGhuYW1lID0gcGF0aG5hbWUgPT09ICIvIiA/IGJhc2VuYW1lIDogcm91dGVyX2pvaW5QYXRocyhbYmFzZW5hbWUsIHBhdGhuYW1lXSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybiBuYXZpZ2F0b3IuY3JlYXRlSHJlZih7CiAgICAgICAgICAgICAgcGF0aG5hbWU6IGpvaW5lZFBhdGhuYW1lLAogICAgICAgICAgICAgIHNlYXJjaDogc2VhcmNoLAogICAgICAgICAgICAgIGhhc2g6IGhhc2gKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9CiAgICAgICAgICAvKioKICAgICAgICAgICAqIFJldHVybnMgdHJ1ZSBpZiB0aGlzIGNvbXBvbmVudCBpcyBhIGRlc2NlbmRhbnQgb2YgYSA8Um91dGVyPi4KICAgICAgICAgICAqCiAgICAgICAgICAgKiBAc2VlIGh0dHBzOi8vcmVhY3Ryb3V0ZXIuY29tL2RvY3MvZW4vdjYvaG9va3MvdXNlLWluLXJvdXRlci1jb250ZXh0CiAgICAgICAgICAgKi8KCiAgICAgICAgICBmdW5jdGlvbiB1c2VJblJvdXRlckNvbnRleHQoKSB7CiAgICAgICAgICAgIHJldHVybiByZWFjdC51c2VDb250ZXh0KExvY2F0aW9uQ29udGV4dCkgIT0gbnVsbDsKICAgICAgICAgIH0KICAgICAgICAgIC8qKgogICAgICAgICAgICogUmV0dXJucyB0aGUgY3VycmVudCBsb2NhdGlvbiBvYmplY3QsIHdoaWNoIHJlcHJlc2VudHMgdGhlIGN1cnJlbnQgVVJMIGluIHdlYgogICAgICAgICAgICogYnJvd3NlcnMuCiAgICAgICAgICAgKgogICAgICAgICAgICogTm90ZTogSWYgeW91J3JlIHVzaW5nIHRoaXMgaXQgbWF5IG1lYW4geW91J3JlIGRvaW5nIHNvbWUgb2YgeW91ciBvd24KICAgICAgICAgICAqICJyb3V0aW5nIiBpbiB5b3VyIGFwcCwgYW5kIHdlJ2QgbGlrZSB0byBrbm93IHdoYXQgeW91ciB1c2UgY2FzZSBpcy4gV2UgbWF5CiAgICAgICAgICAgKiBiZSBhYmxlIHRvIHByb3ZpZGUgc29tZXRoaW5nIGhpZ2hlci1sZXZlbCB0byBiZXR0ZXIgc3VpdCB5b3VyIG5lZWRzLgogICAgICAgICAgICoKICAgICAgICAgICAqIEBzZWUgaHR0cHM6Ly9yZWFjdHJvdXRlci5jb20vZG9jcy9lbi92Ni9ob29rcy91c2UtbG9jYXRpb24KICAgICAgICAgICAqLwoKICAgICAgICAgIGZ1bmN0aW9uIGRpc3RfdXNlTG9jYXRpb24oKSB7CiAgICAgICAgICAgICF1c2VJblJvdXRlckNvbnRleHQoKSA/IGZhbHNlID8gMCA6IHJvdXRlcl9pbnZhcmlhbnQoZmFsc2UpIDogdm9pZCAwOwogICAgICAgICAgICByZXR1cm4gcmVhY3QudXNlQ29udGV4dChMb2NhdGlvbkNvbnRleHQpLmxvY2F0aW9uOwogICAgICAgICAgfQogICAgICAgICAgLyoqCiAgICAgICAgICAgKiBSZXR1cm5zIHRoZSBjdXJyZW50IG5hdmlnYXRpb24gYWN0aW9uIHdoaWNoIGRlc2NyaWJlcyBob3cgdGhlIHJvdXRlciBjYW1lIHRvCiAgICAgICAgICAgKiB0aGUgY3VycmVudCBsb2NhdGlvbiwgZWl0aGVyIGJ5IGEgcG9wLCBwdXNoLCBvciByZXBsYWNlIG9uIHRoZSBoaXN0b3J5IHN0YWNrLgogICAgICAgICAgICoKICAgICAgICAgICAqIEBzZWUgaHR0cHM6Ly9yZWFjdHJvdXRlci5jb20vZG9jcy9lbi92Ni9ob29rcy91c2UtbmF2aWdhdGlvbi10eXBlCiAgICAgICAgICAgKi8KCiAgICAgICAgICBmdW5jdGlvbiB1c2VOYXZpZ2F0aW9uVHlwZSgpIHsKICAgICAgICAgICAgcmV0dXJuIFJlYWN0LnVzZUNvbnRleHQoTG9jYXRpb25Db250ZXh0KS5uYXZpZ2F0aW9uVHlwZTsKICAgICAgICAgIH0KICAgICAgICAgIC8qKgogICAgICAgICAgICogUmV0dXJucyBhIFBhdGhNYXRjaCBvYmplY3QgaWYgdGhlIGdpdmVuIHBhdHRlcm4gbWF0Y2hlcyB0aGUgY3VycmVudCBVUkwuCiAgICAgICAgICAgKiBUaGlzIGlzIHVzZWZ1bCBmb3IgY29tcG9uZW50cyB0aGF0IG5lZWQgdG8ga25vdyAiYWN0aXZlIiBzdGF0ZSwgZS5nLgogICAgICAgICAgICogPE5hdkxpbms+LgogICAgICAgICAgICoKICAgICAgICAgICAqIEBzZWUgaHR0cHM6Ly9yZWFjdHJvdXRlci5jb20vZG9jcy9lbi92Ni9ob29rcy91c2UtbWF0Y2gKICAgICAgICAgICAqLwoKICAgICAgICAgIGZ1bmN0aW9uIHVzZU1hdGNoKHBhdHRlcm4pIHsKICAgICAgICAgICAgIXVzZUluUm91dGVyQ29udGV4dCgpID8gZmFsc2UgPyAwIDogaW52YXJpYW50KGZhbHNlKSA6IHZvaWQgMDsKICAgICAgICAgICAgdmFyIF9kaXN0X3VzZUxvY2F0aW9uID0KCiAgICAgICAgICAgICAgZGlzdF91c2VMb2NhdGlvbigpLHBhdGhuYW1lID0gX2Rpc3RfdXNlTG9jYXRpb24ucGF0aG5hbWU7CiAgICAgICAgICAgIHJldHVybiBSZWFjdC51c2VNZW1vKCgpID0+IG1hdGNoUGF0aChwYXR0ZXJuLCBwYXRobmFtZSksIFtwYXRobmFtZSwgcGF0dGVybl0pOwogICAgICAgICAgfQogICAgICAgICAgLyoqCiAgICAgICAgICAgKiBUaGUgaW50ZXJmYWNlIGZvciB0aGUgbmF2aWdhdGUoKSBmdW5jdGlvbiByZXR1cm5lZCBmcm9tIHVzZU5hdmlnYXRlKCkuCiAgICAgICAgICAgKi8KCiAgICAgICAgICAvKioKICAgICAgICAgICAqIFJldHVybnMgYW4gaW1wZXJhdGl2ZSBtZXRob2QgZm9yIGNoYW5naW5nIHRoZSBsb2NhdGlvbi4gVXNlZCBieSA8TGluaz5zLCBidXQKICAgICAgICAgICAqIG1heSBhbHNvIGJlIHVzZWQgYnkgb3RoZXIgZWxlbWVudHMgdG8gY2hhbmdlIHRoZSBsb2NhdGlvbi4KICAgICAgICAgICAqCiAgICAgICAgICAgKiBAc2VlIGh0dHBzOi8vcmVhY3Ryb3V0ZXIuY29tL2RvY3MvZW4vdjYvaG9va3MvdXNlLW5hdmlnYXRlCiAgICAgICAgICAgKi8KICAgICAgICAgIGZ1bmN0aW9uIGRpc3RfdXNlTmF2aWdhdGUoKSB7CiAgICAgICAgICAgICF1c2VJblJvdXRlckNvbnRleHQoKSA/IGZhbHNlID8gMCA6IHJvdXRlcl9pbnZhcmlhbnQoZmFsc2UpIDogdm9pZCAwOwogICAgICAgICAgICB2YXIgX3JlYWN0JHVzZUNvbnRleHQyID0KCgogICAgICAgICAgICAgIHJlYWN0LnVzZUNvbnRleHQoTmF2aWdhdGlvbkNvbnRleHQpLGJhc2VuYW1lID0gX3JlYWN0JHVzZUNvbnRleHQyLmJhc2VuYW1lLG5hdmlnYXRvciA9IF9yZWFjdCR1c2VDb250ZXh0Mi5uYXZpZ2F0b3I7CiAgICAgICAgICAgIHZhciBfcmVhY3QkdXNlQ29udGV4dDMgPQoKICAgICAgICAgICAgICByZWFjdC51c2VDb250ZXh0KFJvdXRlQ29udGV4dCksbWF0Y2hlcyA9IF9yZWFjdCR1c2VDb250ZXh0My5tYXRjaGVzOwogICAgICAgICAgICB2YXIgX2Rpc3RfdXNlTG9jYXRpb24yID0KCiAgICAgICAgICAgICAgZGlzdF91c2VMb2NhdGlvbigpLGxvY2F0aW9uUGF0aG5hbWUgPSBfZGlzdF91c2VMb2NhdGlvbjIucGF0aG5hbWU7CiAgICAgICAgICAgIHZhciByb3V0ZVBhdGhuYW1lc0pzb24gPSBKU09OLnN0cmluZ2lmeShnZXRQYXRoQ29udHJpYnV0aW5nTWF0Y2hlcyhtYXRjaGVzKS5tYXAoKG1hdGNoKSA9PiBtYXRjaC5wYXRobmFtZUJhc2UpKTsKICAgICAgICAgICAgdmFyIGFjdGl2ZVJlZiA9IHJlYWN0LnVzZVJlZihmYWxzZSk7CiAgICAgICAgICAgIHJlYWN0LnVzZUVmZmVjdCgoKSA9PiB7CiAgICAgICAgICAgICAgYWN0aXZlUmVmLmN1cnJlbnQgPSB0cnVlOwogICAgICAgICAgICB9KTsKICAgICAgICAgICAgdmFyIG5hdmlnYXRlID0gcmVhY3QudXNlQ2FsbGJhY2soZnVuY3Rpb24gKHRvLCBvcHRpb25zKSB7CiAgICAgICAgICAgICAgaWYgKG9wdGlvbnMgPT09IHZvaWQgMCkgewogICAgICAgICAgICAgICAgb3B0aW9ucyA9IHt9OwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgZmFsc2UgPyAwIDogdm9pZCAwOwogICAgICAgICAgICAgIGlmICghYWN0aXZlUmVmLmN1cnJlbnQpIHJldHVybjsKCiAgICAgICAgICAgICAgaWYgKHR5cGVvZiB0byA9PT0gIm51bWJlciIpIHsKICAgICAgICAgICAgICAgIG5hdmlnYXRvci5nbyh0byk7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICB2YXIgcGF0aCA9IHJlc29sdmVUbyh0bywgSlNPTi5wYXJzZShyb3V0ZVBhdGhuYW1lc0pzb24pLCBsb2NhdGlvblBhdGhuYW1lLCBvcHRpb25zLnJlbGF0aXZlID09PSAicGF0aCIpOyAvLyBJZiB3ZSdyZSBvcGVyYXRpbmcgd2l0aGluIGEgYmFzZW5hbWUsIHByZXBlbmQgaXQgdG8gdGhlIHBhdGhuYW1lIHByaW9yCiAgICAgICAgICAgICAgLy8gdG8gaGFuZGluZyBvZmYgdG8gaGlzdG9yeS4gIElmIHRoaXMgaXMgYSByb290IG5hdmlnYXRpb24sIHRoZW4gd2UKICAgICAgICAgICAgICAvLyBuYXZpZ2F0ZSB0byB0aGUgcmF3IGJhc2VuYW1lIHdoaWNoIGFsbG93cyB0aGUgYmFzZW5hbWUgdG8gaGF2ZSBmdWxsCiAgICAgICAgICAgICAgLy8gY29udHJvbCBvdmVyIHRoZSBwcmVzZW5jZSBvZiBhIHRyYWlsaW5nIHNsYXNoIG9uIHJvb3QgbGlua3MKCiAgICAgICAgICAgICAgaWYgKGJhc2VuYW1lICE9PSAiLyIpIHsKICAgICAgICAgICAgICAgIHBhdGgucGF0aG5hbWUgPSBwYXRoLnBhdGhuYW1lID09PSAiLyIgPyBiYXNlbmFtZSA6IHJvdXRlcl9qb2luUGF0aHMoW2Jhc2VuYW1lLCBwYXRoLnBhdGhuYW1lXSk7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAoISFvcHRpb25zLnJlcGxhY2UgPyBuYXZpZ2F0b3IucmVwbGFjZSA6IG5hdmlnYXRvci5wdXNoKShwYXRoLCBvcHRpb25zLnN0YXRlLCBvcHRpb25zKTsKICAgICAgICAgICAgfSwgW2Jhc2VuYW1lLCBuYXZpZ2F0b3IsIHJvdXRlUGF0aG5hbWVzSnNvbiwgbG9jYXRpb25QYXRobmFtZV0pOwogICAgICAgICAgICByZXR1cm4gbmF2aWdhdGU7CiAgICAgICAgICB9CiAgICAgICAgICB2YXIgT3V0bGV0Q29udGV4dCA9IC8qI19fUFVSRV9fKi9yZWFjdC5jcmVhdGVDb250ZXh0KG51bGwpOwogICAgICAgICAgLyoqCiAgICAgICAgICAgKiBSZXR1cm5zIHRoZSBjb250ZXh0IChpZiBwcm92aWRlZCkgZm9yIHRoZSBjaGlsZCByb3V0ZSBhdCB0aGlzIGxldmVsIG9mIHRoZSByb3V0ZQogICAgICAgICAgICogaGllcmFyY2h5LgogICAgICAgICAgICogQHNlZSBodHRwczovL3JlYWN0cm91dGVyLmNvbS9kb2NzL2VuL3Y2L2hvb2tzL3VzZS1vdXRsZXQtY29udGV4dAogICAgICAgICAgICovCgogICAgICAgICAgZnVuY3Rpb24gdXNlT3V0bGV0Q29udGV4dCgpIHsKICAgICAgICAgICAgcmV0dXJuIFJlYWN0LnVzZUNvbnRleHQoT3V0bGV0Q29udGV4dCk7CiAgICAgICAgICB9CiAgICAgICAgICAvKioKICAgICAgICAgICAqIFJldHVybnMgdGhlIGVsZW1lbnQgZm9yIHRoZSBjaGlsZCByb3V0ZSBhdCB0aGlzIGxldmVsIG9mIHRoZSByb3V0ZQogICAgICAgICAgICogaGllcmFyY2h5LiBVc2VkIGludGVybmFsbHkgYnkgPE91dGxldD4gdG8gcmVuZGVyIGNoaWxkIHJvdXRlcy4KICAgICAgICAgICAqCiAgICAgICAgICAgKiBAc2VlIGh0dHBzOi8vcmVhY3Ryb3V0ZXIuY29tL2RvY3MvZW4vdjYvaG9va3MvdXNlLW91dGxldAogICAgICAgICAgICovCgogICAgICAgICAgZnVuY3Rpb24gdXNlT3V0bGV0KGNvbnRleHQpIHsKICAgICAgICAgICAgdmFyIG91dGxldCA9IHJlYWN0LnVzZUNvbnRleHQoUm91dGVDb250ZXh0KS5vdXRsZXQ7CgogICAgICAgICAgICBpZiAob3V0bGV0KSB7CiAgICAgICAgICAgICAgcmV0dXJuIC8qI19fUFVSRV9fKi9yZWFjdC5jcmVhdGVFbGVtZW50KE91dGxldENvbnRleHQuUHJvdmlkZXIsIHsKICAgICAgICAgICAgICAgIHZhbHVlOiBjb250ZXh0CiAgICAgICAgICAgICAgfSwgb3V0bGV0KTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuIG91dGxldDsKICAgICAgICAgIH0KICAgICAgICAgIC8qKgogICAgICAgICAgICogUmV0dXJucyBhbiBvYmplY3Qgb2Yga2V5L3ZhbHVlIHBhaXJzIG9mIHRoZSBkeW5hbWljIHBhcmFtcyBmcm9tIHRoZSBjdXJyZW50CiAgICAgICAgICAgKiBVUkwgdGhhdCB3ZXJlIG1hdGNoZWQgYnkgdGhlIHJvdXRlIHBhdGguCiAgICAgICAgICAgKgogICAgICAgICAgICogQHNlZSBodHRwczovL3JlYWN0cm91dGVyLmNvbS9kb2NzL2VuL3Y2L2hvb2tzL3VzZS1wYXJhbXMKICAgICAgICAgICAqLwoKICAgICAgICAgIGZ1bmN0aW9uIHVzZVBhcmFtcygpIHsKICAgICAgICAgICAgdmFyIF9SZWFjdCR1c2VDb250ZXh0ID0KCiAgICAgICAgICAgICAgUmVhY3QudXNlQ29udGV4dChSb3V0ZUNvbnRleHQpLG1hdGNoZXMgPSBfUmVhY3QkdXNlQ29udGV4dC5tYXRjaGVzOwogICAgICAgICAgICB2YXIgcm91dGVNYXRjaCA9IG1hdGNoZXNbbWF0Y2hlcy5sZW5ndGggLSAxXTsKICAgICAgICAgICAgcmV0dXJuIHJvdXRlTWF0Y2ggPyByb3V0ZU1hdGNoLnBhcmFtcyA6IHt9OwogICAgICAgICAgfQogICAgICAgICAgLyoqCiAgICAgICAgICAgKiBSZXNvbHZlcyB0aGUgcGF0aG5hbWUgb2YgdGhlIGdpdmVuIGB0b2AgdmFsdWUgYWdhaW5zdCB0aGUgY3VycmVudCBsb2NhdGlvbi4KICAgICAgICAgICAqCiAgICAgICAgICAgKiBAc2VlIGh0dHBzOi8vcmVhY3Ryb3V0ZXIuY29tL2RvY3MvZW4vdjYvaG9va3MvdXNlLXJlc29sdmVkLXBhdGgKICAgICAgICAgICAqLwoKICAgICAgICAgIGZ1bmN0aW9uIGRpc3RfdXNlUmVzb2x2ZWRQYXRoKHRvLCBfdGVtcDIpIHsKICAgICAgICAgICAgdmFyIF9yZWYyNyA9CgogICAgICAgICAgICAgIF90ZW1wMiA9PT0gdm9pZCAwID8ge30gOiBfdGVtcDIscmVsYXRpdmUgPSBfcmVmMjcucmVsYXRpdmU7CiAgICAgICAgICAgIHZhciBfcmVhY3QkdXNlQ29udGV4dDQgPQoKICAgICAgICAgICAgICByZWFjdC51c2VDb250ZXh0KFJvdXRlQ29udGV4dCksbWF0Y2hlcyA9IF9yZWFjdCR1c2VDb250ZXh0NC5tYXRjaGVzOwogICAgICAgICAgICB2YXIgX2Rpc3RfdXNlTG9jYXRpb24zID0KCiAgICAgICAgICAgICAgZGlzdF91c2VMb2NhdGlvbigpLGxvY2F0aW9uUGF0aG5hbWUgPSBfZGlzdF91c2VMb2NhdGlvbjMucGF0aG5hbWU7CiAgICAgICAgICAgIHZhciByb3V0ZVBhdGhuYW1lc0pzb24gPSBKU09OLnN0cmluZ2lmeShnZXRQYXRoQ29udHJpYnV0aW5nTWF0Y2hlcyhtYXRjaGVzKS5tYXAoKG1hdGNoKSA9PiBtYXRjaC5wYXRobmFtZUJhc2UpKTsKICAgICAgICAgICAgcmV0dXJuIHJlYWN0LnVzZU1lbW8oKCkgPT4gcmVzb2x2ZVRvKHRvLCBKU09OLnBhcnNlKHJvdXRlUGF0aG5hbWVzSnNvbiksIGxvY2F0aW9uUGF0aG5hbWUsIHJlbGF0aXZlID09PSAicGF0aCIpLCBbdG8sIHJvdXRlUGF0aG5hbWVzSnNvbiwgbG9jYXRpb25QYXRobmFtZSwgcmVsYXRpdmVdKTsKICAgICAgICAgIH0KICAgICAgICAgIC8qKgogICAgICAgICAgICogUmV0dXJucyB0aGUgZWxlbWVudCBvZiB0aGUgcm91dGUgdGhhdCBtYXRjaGVkIHRoZSBjdXJyZW50IGxvY2F0aW9uLCBwcmVwYXJlZAogICAgICAgICAgICogd2l0aCB0aGUgY29ycmVjdCBjb250ZXh0IHRvIHJlbmRlciB0aGUgcmVtYWluZGVyIG9mIHRoZSByb3V0ZSB0cmVlLiBSb3V0ZQogICAgICAgICAgICogZWxlbWVudHMgaW4gdGhlIHRyZWUgbXVzdCByZW5kZXIgYW4gPE91dGxldD4gdG8gcmVuZGVyIHRoZWlyIGNoaWxkIHJvdXRlJ3MKICAgICAgICAgICAqIGVsZW1lbnQuCiAgICAgICAgICAgKgogICAgICAgICAgICogQHNlZSBodHRwczovL3JlYWN0cm91dGVyLmNvbS9kb2NzL2VuL3Y2L2hvb2tzL3VzZS1yb3V0ZXMKICAgICAgICAgICAqLwoKICAgICAgICAgIGZ1bmN0aW9uIHVzZVJvdXRlcyhyb3V0ZXMsIGxvY2F0aW9uQXJnKSB7CiAgICAgICAgICAgICF1c2VJblJvdXRlckNvbnRleHQoKSA/IGZhbHNlID8gMCA6IHJvdXRlcl9pbnZhcmlhbnQoZmFsc2UpIDogdm9pZCAwOwogICAgICAgICAgICB2YXIgX3JlYWN0JHVzZUNvbnRleHQ1ID0KCiAgICAgICAgICAgICAgcmVhY3QudXNlQ29udGV4dChOYXZpZ2F0aW9uQ29udGV4dCksbmF2aWdhdG9yID0gX3JlYWN0JHVzZUNvbnRleHQ1Lm5hdmlnYXRvcjsKICAgICAgICAgICAgdmFyIGRhdGFSb3V0ZXJTdGF0ZUNvbnRleHQgPSByZWFjdC51c2VDb250ZXh0KERhdGFSb3V0ZXJTdGF0ZUNvbnRleHQpOwogICAgICAgICAgICB2YXIgX3JlYWN0JHVzZUNvbnRleHQ2ID0KCiAgICAgICAgICAgICAgcmVhY3QudXNlQ29udGV4dChSb3V0ZUNvbnRleHQpLHBhcmVudE1hdGNoZXMgPSBfcmVhY3QkdXNlQ29udGV4dDYubWF0Y2hlczsKICAgICAgICAgICAgdmFyIHJvdXRlTWF0Y2ggPSBwYXJlbnRNYXRjaGVzW3BhcmVudE1hdGNoZXMubGVuZ3RoIC0gMV07CiAgICAgICAgICAgIHZhciBwYXJlbnRQYXJhbXMgPSByb3V0ZU1hdGNoID8gcm91dGVNYXRjaC5wYXJhbXMgOiB7fTsKICAgICAgICAgICAgdmFyIHBhcmVudFBhdGhuYW1lID0gcm91dGVNYXRjaCA/IHJvdXRlTWF0Y2gucGF0aG5hbWUgOiAiLyI7CiAgICAgICAgICAgIHZhciBwYXJlbnRQYXRobmFtZUJhc2UgPSByb3V0ZU1hdGNoID8gcm91dGVNYXRjaC5wYXRobmFtZUJhc2UgOiAiLyI7CiAgICAgICAgICAgIHZhciBwYXJlbnRSb3V0ZSA9IHJvdXRlTWF0Y2ggJiYgcm91dGVNYXRjaC5yb3V0ZTsKCiAgICAgICAgICAgIGlmIChmYWxzZSkge30KCiAgICAgICAgICAgIHZhciBsb2NhdGlvbkZyb21Db250ZXh0ID0gZGlzdF91c2VMb2NhdGlvbigpOwogICAgICAgICAgICB2YXIgbG9jYXRpb247CgogICAgICAgICAgICBpZiAobG9jYXRpb25BcmcpIHsKICAgICAgICAgICAgICB2YXIgX3BhcnNlZExvY2F0aW9uQXJnJHBhOwoKICAgICAgICAgICAgICB2YXIgcGFyc2VkTG9jYXRpb25BcmcgPSB0eXBlb2YgbG9jYXRpb25BcmcgPT09ICJzdHJpbmciID8gcGFyc2VQYXRoKGxvY2F0aW9uQXJnKSA6IGxvY2F0aW9uQXJnOwogICAgICAgICAgICAgICEocGFyZW50UGF0aG5hbWVCYXNlID09PSAiLyIgfHwgKChfcGFyc2VkTG9jYXRpb25BcmckcGEgPSBwYXJzZWRMb2NhdGlvbkFyZy5wYXRobmFtZSkgPT0gbnVsbCA/IHZvaWQgMCA6IF9wYXJzZWRMb2NhdGlvbkFyZyRwYS5zdGFydHNXaXRoKHBhcmVudFBhdGhuYW1lQmFzZSkpKSA/IGZhbHNlID8gMCA6IHJvdXRlcl9pbnZhcmlhbnQoZmFsc2UpIDogdm9pZCAwOwogICAgICAgICAgICAgIGxvY2F0aW9uID0gcGFyc2VkTG9jYXRpb25Bcmc7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgbG9jYXRpb24gPSBsb2NhdGlvbkZyb21Db250ZXh0OwogICAgICAgICAgICB9CgogICAgICAgICAgICB2YXIgcGF0aG5hbWUgPSBsb2NhdGlvbi5wYXRobmFtZSB8fCAiLyI7CiAgICAgICAgICAgIHZhciByZW1haW5pbmdQYXRobmFtZSA9IHBhcmVudFBhdGhuYW1lQmFzZSA9PT0gIi8iID8gcGF0aG5hbWUgOiBwYXRobmFtZS5zbGljZShwYXJlbnRQYXRobmFtZUJhc2UubGVuZ3RoKSB8fCAiLyI7CiAgICAgICAgICAgIHZhciBtYXRjaGVzID0gbWF0Y2hSb3V0ZXMocm91dGVzLCB7CiAgICAgICAgICAgICAgcGF0aG5hbWU6IHJlbWFpbmluZ1BhdGhuYW1lCiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgaWYgKGZhbHNlKSB7fQoKICAgICAgICAgICAgdmFyIHJlbmRlcmVkTWF0Y2hlcyA9IF9yZW5kZXJNYXRjaGVzKG1hdGNoZXMgJiYgbWF0Y2hlcy5tYXAoKG1hdGNoKSA9PiBPYmplY3QuYXNzaWduKHt9LCBtYXRjaCwgewogICAgICAgICAgICAgIHBhcmFtczogT2JqZWN0LmFzc2lnbih7fSwgcGFyZW50UGFyYW1zLCBtYXRjaC5wYXJhbXMpLAogICAgICAgICAgICAgIHBhdGhuYW1lOiByb3V0ZXJfam9pblBhdGhzKFtwYXJlbnRQYXRobmFtZUJhc2UsIC8vIFJlLWVuY29kZSBwYXRobmFtZXMgdGhhdCB3ZXJlIGRlY29kZWQgaW5zaWRlIG1hdGNoUm91dGVzCiAgICAgICAgICAgICAgbmF2aWdhdG9yLmVuY29kZUxvY2F0aW9uID8gbmF2aWdhdG9yLmVuY29kZUxvY2F0aW9uKG1hdGNoLnBhdGhuYW1lKS5wYXRobmFtZSA6IG1hdGNoLnBhdGhuYW1lXSksCiAgICAgICAgICAgICAgcGF0aG5hbWVCYXNlOiBtYXRjaC5wYXRobmFtZUJhc2UgPT09ICIvIiA/IHBhcmVudFBhdGhuYW1lQmFzZSA6IHJvdXRlcl9qb2luUGF0aHMoW3BhcmVudFBhdGhuYW1lQmFzZSwgLy8gUmUtZW5jb2RlIHBhdGhuYW1lcyB0aGF0IHdlcmUgZGVjb2RlZCBpbnNpZGUgbWF0Y2hSb3V0ZXMKICAgICAgICAgICAgICBuYXZpZ2F0b3IuZW5jb2RlTG9jYXRpb24gPyBuYXZpZ2F0b3IuZW5jb2RlTG9jYXRpb24obWF0Y2gucGF0aG5hbWVCYXNlKS5wYXRobmFtZSA6IG1hdGNoLnBhdGhuYW1lQmFzZV0pCiAgICAgICAgICAgIH0pKSwgcGFyZW50TWF0Y2hlcywgZGF0YVJvdXRlclN0YXRlQ29udGV4dCB8fCB1bmRlZmluZWQpOyAvLyBXaGVuIGEgdXNlciBwYXNzZXMgaW4gYSBgbG9jYXRpb25BcmdgLCB0aGUgYXNzb2NpYXRlZCByb3V0ZXMgbmVlZCB0bwogICAgICAgICAgICAvLyBiZSB3cmFwcGVkIGluIGEgbmV3IGBMb2NhdGlvbkNvbnRleHQuUHJvdmlkZXJgIGluIG9yZGVyIGZvciBgdXNlTG9jYXRpb25gCiAgICAgICAgICAgIC8vIHRvIHVzZSB0aGUgc2NvcGVkIGxvY2F0aW9uIGluc3RlYWQgb2YgdGhlIGdsb2JhbCBsb2NhdGlvbi4KCgogICAgICAgICAgICBpZiAobG9jYXRpb25BcmcgJiYgcmVuZGVyZWRNYXRjaGVzKSB7CiAgICAgICAgICAgICAgcmV0dXJuIC8qI19fUFVSRV9fKi9yZWFjdC5jcmVhdGVFbGVtZW50KExvY2F0aW9uQ29udGV4dC5Qcm92aWRlciwgewogICAgICAgICAgICAgICAgdmFsdWU6IHsKICAgICAgICAgICAgICAgICAgbG9jYXRpb246IGRpc3RfZXh0ZW5kcyh7CiAgICAgICAgICAgICAgICAgICAgcGF0aG5hbWU6ICIvIiwKICAgICAgICAgICAgICAgICAgICBzZWFyY2g6ICIiLAogICAgICAgICAgICAgICAgICAgIGhhc2g6ICIiLAogICAgICAgICAgICAgICAgICAgIHN0YXRlOiBudWxsLAogICAgICAgICAgICAgICAgICAgIGtleTogImRlZmF1bHQiCiAgICAgICAgICAgICAgICAgIH0sIGxvY2F0aW9uKSwKICAgICAgICAgICAgICAgICAgbmF2aWdhdGlvblR5cGU6IEFjdGlvbi5Qb3AKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9LCByZW5kZXJlZE1hdGNoZXMpOwogICAgICAgICAgICB9CgogICAgICAgICAgICByZXR1cm4gcmVuZGVyZWRNYXRjaGVzOwogICAgICAgICAgfQoKICAgICAgICAgIGZ1bmN0aW9uIERlZmF1bHRFcnJvckVsZW1lbnQoKSB7CiAgICAgICAgICAgIHZhciBlcnJvciA9IHVzZVJvdXRlRXJyb3IoKTsKICAgICAgICAgICAgdmFyIG1lc3NhZ2UgPSBpc1JvdXRlRXJyb3JSZXNwb25zZShlcnJvcikgPyBlcnJvci5zdGF0dXMgKyAiICIgKyBlcnJvci5zdGF0dXNUZXh0IDogZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiBKU09OLnN0cmluZ2lmeShlcnJvcik7CiAgICAgICAgICAgIHZhciBzdGFjayA9IGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5zdGFjayA6IG51bGw7CiAgICAgICAgICAgIHZhciBsaWdodGdyZXkgPSAicmdiYSgyMDAsMjAwLDIwMCwgMC41KSI7CiAgICAgICAgICAgIHZhciBwcmVTdHlsZXMgPSB7CiAgICAgICAgICAgICAgcGFkZGluZzogIjAuNXJlbSIsCiAgICAgICAgICAgICAgYmFja2dyb3VuZENvbG9yOiBsaWdodGdyZXkKICAgICAgICAgICAgfTsKICAgICAgICAgICAgdmFyIGNvZGVTdHlsZXMgPSB7CiAgICAgICAgICAgICAgcGFkZGluZzogIjJweCA0cHgiLAogICAgICAgICAgICAgIGJhY2tncm91bmRDb2xvcjogbGlnaHRncmV5CiAgICAgICAgICAgIH07CiAgICAgICAgICAgIHJldHVybiAvKiNfX1BVUkVfXyovcmVhY3QuY3JlYXRlRWxlbWVudChyZWFjdC5GcmFnbWVudCwgbnVsbCwgLyojX19QVVJFX18qL3JlYWN0LmNyZWF0ZUVsZW1lbnQoImgyIiwgbnVsbCwgIlVuaGFuZGxlZCBUaHJvd24gRXJyb3IhIiksIC8qI19fUFVSRV9fKi9yZWFjdC5jcmVhdGVFbGVtZW50KCJoMyIsIHsKICAgICAgICAgICAgICBzdHlsZTogewogICAgICAgICAgICAgICAgZm9udFN0eWxlOiAiaXRhbGljIgogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwgbWVzc2FnZSksIHN0YWNrID8gLyojX19QVVJFX18qL3JlYWN0LmNyZWF0ZUVsZW1lbnQoInByZSIsIHsKICAgICAgICAgICAgICBzdHlsZTogcHJlU3R5bGVzCiAgICAgICAgICAgIH0sIHN0YWNrKSA6IG51bGwsIC8qI19fUFVSRV9fKi9yZWFjdC5jcmVhdGVFbGVtZW50KCJwIiwgbnVsbCwgIlx1RDgzRFx1RENCRiBIZXkgZGV2ZWxvcGVyIFx1RDgzRFx1REM0QiIpLCAvKiNfX1BVUkVfXyovcmVhY3QuY3JlYXRlRWxlbWVudCgicCIsIG51bGwsICJZb3UgY2FuIHByb3ZpZGUgYSB3YXkgYmV0dGVyIFVYIHRoYW4gdGhpcyB3aGVuIHlvdXIgYXBwIHRocm93cyBlcnJvcnMgYnkgcHJvdmlkaW5nIHlvdXIgb3duXHhBMCIsIC8qI19fUFVSRV9fKi9yZWFjdC5jcmVhdGVFbGVtZW50KCJjb2RlIiwgewogICAgICAgICAgICAgIHN0eWxlOiBjb2RlU3R5bGVzCiAgICAgICAgICAgIH0sICJlcnJvckVsZW1lbnQiKSwgIiBwcm9wcyBvblx4QTAiLCAvKiNfX1BVUkVfXyovcmVhY3QuY3JlYXRlRWxlbWVudCgiY29kZSIsIHsKICAgICAgICAgICAgICBzdHlsZTogY29kZVN0eWxlcwogICAgICAgICAgICB9LCAiPFJvdXRlPiIpKSk7CiAgICAgICAgICB9dmFyCgogICAgICAgICAgUmVuZGVyRXJyb3JCb3VuZGFyeSA9IC8qI19fUFVSRV9fKi9mdW5jdGlvbiAoX3JlYWN0JENvbXBvbmVudCkge19pbmhlcml0cyhSZW5kZXJFcnJvckJvdW5kYXJ5LCBfcmVhY3QkQ29tcG9uZW50KTt2YXIgX3N1cGVyMiA9IF9jcmVhdGVTdXBlcihSZW5kZXJFcnJvckJvdW5kYXJ5KTsKICAgICAgICAgICAgZnVuY3Rpb24gUmVuZGVyRXJyb3JCb3VuZGFyeShwcm9wcykge3ZhciBfdGhpcztfY2xhc3NDYWxsQ2hlY2syKHRoaXMsIFJlbmRlckVycm9yQm91bmRhcnkpOwogICAgICAgICAgICAgIF90aGlzID0gX3N1cGVyMi5jYWxsKHRoaXMsIHByb3BzKTsKICAgICAgICAgICAgICBfdGhpcy5zdGF0ZSA9IHsKICAgICAgICAgICAgICAgIGxvY2F0aW9uOiBwcm9wcy5sb2NhdGlvbiwKICAgICAgICAgICAgICAgIGVycm9yOiBwcm9wcy5lcnJvcgogICAgICAgICAgICAgIH07cmV0dXJuIF90aGlzOwogICAgICAgICAgICB9X2NyZWF0ZUNsYXNzMihSZW5kZXJFcnJvckJvdW5kYXJ5LCBbeyBrZXk6ICJjb21wb25lbnREaWRDYXRjaCIsIHZhbHVlOgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgogICAgICAgICAgICAgIGZ1bmN0aW9uIGNvbXBvbmVudERpZENhdGNoKGVycm9yLCBlcnJvckluZm8pIHsKICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoIlJlYWN0IFJvdXRlciBjYXVnaHQgdGhlIGZvbGxvd2luZyBlcnJvciBkdXJpbmcgcmVuZGVyIiwgZXJyb3IsIGVycm9ySW5mbyk7CiAgICAgICAgICAgICAgfSB9LCB7IGtleTogInJlbmRlciIsIHZhbHVlOgoKICAgICAgICAgICAgICBmdW5jdGlvbiByZW5kZXIoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5zdGF0ZS5lcnJvciA/IC8qI19fUFVSRV9fKi9yZWFjdC5jcmVhdGVFbGVtZW50KFJvdXRlRXJyb3JDb250ZXh0LlByb3ZpZGVyLCB7CiAgICAgICAgICAgICAgICAgIHZhbHVlOiB0aGlzLnN0YXRlLmVycm9yLAogICAgICAgICAgICAgICAgICBjaGlsZHJlbjogdGhpcy5wcm9wcy5jb21wb25lbnQKICAgICAgICAgICAgICAgIH0pIDogdGhpcy5wcm9wcy5jaGlsZHJlbjsKICAgICAgICAgICAgICB9IH1dLCBbeyBrZXk6ICJnZXREZXJpdmVkU3RhdGVGcm9tRXJyb3IiLCB2YWx1ZTogZnVuY3Rpb24gZ2V0RGVyaXZlZFN0YXRlRnJvbUVycm9yKGVycm9yKSB7cmV0dXJuIHsgZXJyb3I6IGVycm9yIH07fSB9LCB7IGtleTogImdldERlcml2ZWRTdGF0ZUZyb21Qcm9wcyIsIHZhbHVlOiBmdW5jdGlvbiBnZXREZXJpdmVkU3RhdGVGcm9tUHJvcHMocHJvcHMsIHN0YXRlKSB7Ly8gV2hlbiB3ZSBnZXQgaW50byBhbiBlcnJvciBzdGF0ZSwgdGhlIHVzZXIgd2lsbCBsaWtlbHkgY2xpY2sgImJhY2siIHRvIHRoZQogICAgICAgICAgICAgICAgLy8gcHJldmlvdXMgcGFnZSB0aGF0IGRpZG4ndCBoYXZlIGFuIGVycm9yLiBCZWNhdXNlIHRoaXMgd3JhcHMgdGhlIGVudGlyZQogICAgICAgICAgICAgICAgLy8gYXBwbGljYXRpb24sIHRoYXQgd2lsbCBoYXZlIG5vIGVmZmVjdC0tdGhlIGVycm9yIHBhZ2UgY29udGludWVzIHRvIGRpc3BsYXkuCiAgICAgICAgICAgICAgICAvLyBUaGlzIGdpdmVzIHVzIGEgbWVjaGFuaXNtIHRvIHJlY292ZXIgZnJvbSB0aGUgZXJyb3Igd2hlbiB0aGUgbG9jYXRpb24gY2hhbmdlcy4KICAgICAgICAgICAgICAgIC8vCiAgICAgICAgICAgICAgICAvLyBXaGV0aGVyIHdlJ3JlIGluIGFuIGVycm9yIHN0YXRlIG9yIG5vdCwgd2UgdXBkYXRlIHRoZSBsb2NhdGlvbiBpbiBzdGF0ZQogICAgICAgICAgICAgICAgLy8gc28gdGhhdCB3aGVuIHdlIGFyZSBpbiBhbiBlcnJvciBzdGF0ZSwgaXQgZ2V0cyByZXNldCB3aGVuIGEgbmV3IGxvY2F0aW9uCiAgICAgICAgICAgICAgICAvLyBjb21lcyBpbiBhbmQgdGhlIHVzZXIgcmVjb3ZlcnMgZnJvbSB0aGUgZXJyb3IuCiAgICAgICAgICAgICAgICBpZiAoc3RhdGUubG9jYXRpb24gIT09IHByb3BzLmxvY2F0aW9uKSB7cmV0dXJuIHsgZXJyb3I6IHByb3BzLmVycm9yLCBsb2NhdGlvbjogcHJvcHMubG9jYXRpb24gfTt9IC8vIElmIHdlJ3JlIG5vdCBjaGFuZ2luZyBsb2NhdGlvbnMsIHByZXNlcnZlIHRoZSBsb2NhdGlvbiBidXQgc3RpbGwgc3VyZmFjZQogICAgICAgICAgICAgICAgLy8gYW55IG5ldyBlcnJvcnMgdGhhdCBtYXkgY29tZSB0aHJvdWdoLiBXZSByZXRhaW4gdGhlIGV4aXN0aW5nIGVycm9yLCB3ZSBkbwogICAgICAgICAgICAgICAgLy8gdGhpcyBiZWNhdXNlIHRoZSBlcnJvciBwcm92aWRlZCBmcm9tIHRoZSBhcHAgc3RhdGUgbWF5IGJlIGNsZWFyZWQgd2l0aG91dAogICAgICAgICAgICAgICAgLy8gdGhlIGxvY2F0aW9uIGNoYW5naW5nLgogICAgICAgICAgICAgICAgcmV0dXJuIHsgZXJyb3I6IHByb3BzLmVycm9yIHx8IHN0YXRlLmVycm9yLCBsb2NhdGlvbjogc3RhdGUubG9jYXRpb24gfTt9IH1dKTtyZXR1cm4gUmVuZGVyRXJyb3JCb3VuZGFyeTt9KHJlYWN0LkNvbXBvbmVudCk7ZnVuY3Rpb24gUmVuZGVyZWRSb3V0ZShfcmVmKSB7dmFyIHJvdXRlQ29udGV4dCA9IF9yZWYucm91dGVDb250ZXh0LG1hdGNoID0gX3JlZi5tYXRjaCxjaGlsZHJlbiA9IF9yZWYuY2hpbGRyZW47dmFyIGRhdGFTdGF0aWNSb3V0ZXJDb250ZXh0ID0gcmVhY3QudXNlQ29udGV4dChEYXRhU3RhdGljUm91dGVyQ29udGV4dCk7IC8vIFRyYWNrIGhvdyBkZWVwIHdlIGdvdCBpbiBvdXIgcmVuZGVyIHBhc3MgdG8gZW11bGF0ZSBTU1IgY29tcG9uZW50RGlkQ2F0Y2gKICAgICAgICAgICAgLy8gaW4gYSBEYXRhU3RhdGljUm91dGVyCiAgICAgICAgICAgIGlmIChkYXRhU3RhdGljUm91dGVyQ29udGV4dCAmJiBtYXRjaC5yb3V0ZS5lcnJvckVsZW1lbnQpIHtkYXRhU3RhdGljUm91dGVyQ29udGV4dC5fZGVlcGVzdFJlbmRlcmVkQm91bmRhcnlJZCA9IG1hdGNoLnJvdXRlLmlkOwogICAgICAgICAgICB9CgogICAgICAgICAgICByZXR1cm4gLyojX19QVVJFX18qL3JlYWN0LmNyZWF0ZUVsZW1lbnQoUm91dGVDb250ZXh0LlByb3ZpZGVyLCB7CiAgICAgICAgICAgICAgdmFsdWU6IHJvdXRlQ29udGV4dAogICAgICAgICAgICB9LCBjaGlsZHJlbik7CiAgICAgICAgICB9CgogICAgICAgICAgZnVuY3Rpb24gX3JlbmRlck1hdGNoZXMobWF0Y2hlcywgcGFyZW50TWF0Y2hlcywgZGF0YVJvdXRlclN0YXRlKSB7CiAgICAgICAgICAgIGlmIChwYXJlbnRNYXRjaGVzID09PSB2b2lkIDApIHsKICAgICAgICAgICAgICBwYXJlbnRNYXRjaGVzID0gW107CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChtYXRjaGVzID09IG51bGwpIHsKICAgICAgICAgICAgICBpZiAoZGF0YVJvdXRlclN0YXRlICE9IG51bGwgJiYgZGF0YVJvdXRlclN0YXRlLmVycm9ycykgewogICAgICAgICAgICAgICAgLy8gRG9uJ3QgYmFpbCBpZiB3ZSBoYXZlIGRhdGEgcm91dGVyIGVycm9ycyBzbyB3ZSBjYW4gcmVuZGVyIHRoZW0gaW4gdGhlCiAgICAgICAgICAgICAgICAvLyBib3VuZGFyeS4gIFVzZSB0aGUgcHJlLW1hdGNoZWQgKG9yIHNoaW1tZWQpIG1hdGNoZXMKICAgICAgICAgICAgICAgIG1hdGNoZXMgPSBkYXRhUm91dGVyU3RhdGUubWF0Y2hlczsKICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICB2YXIgcmVuZGVyZWRNYXRjaGVzID0gbWF0Y2hlczsgLy8gSWYgd2UgaGF2ZSBkYXRhIGVycm9ycywgdHJpbSBtYXRjaGVzIHRvIHRoZSBoaWdoZXN0IGVycm9yIGJvdW5kYXJ5CgogICAgICAgICAgICB2YXIgZXJyb3JzID0gZGF0YVJvdXRlclN0YXRlID09IG51bGwgPyB2b2lkIDAgOiBkYXRhUm91dGVyU3RhdGUuZXJyb3JzOwoKICAgICAgICAgICAgaWYgKGVycm9ycyAhPSBudWxsKSB7CiAgICAgICAgICAgICAgdmFyIGVycm9ySW5kZXggPSByZW5kZXJlZE1hdGNoZXMuZmluZEluZGV4KChtKSA9PiBtLnJvdXRlLmlkICYmIChlcnJvcnMgPT0gbnVsbCA/IHZvaWQgMCA6IGVycm9yc1ttLnJvdXRlLmlkXSkpOwogICAgICAgICAgICAgICEoZXJyb3JJbmRleCA+PSAwKSA/IGZhbHNlID8gMCA6IHJvdXRlcl9pbnZhcmlhbnQoZmFsc2UpIDogdm9pZCAwOwogICAgICAgICAgICAgIHJlbmRlcmVkTWF0Y2hlcyA9IHJlbmRlcmVkTWF0Y2hlcy5zbGljZSgwLCBNYXRoLm1pbihyZW5kZXJlZE1hdGNoZXMubGVuZ3RoLCBlcnJvckluZGV4ICsgMSkpOwogICAgICAgICAgICB9CgogICAgICAgICAgICByZXR1cm4gcmVuZGVyZWRNYXRjaGVzLnJlZHVjZVJpZ2h0KChvdXRsZXQsIG1hdGNoLCBpbmRleCkgPT4gewogICAgICAgICAgICAgIHZhciBlcnJvciA9IG1hdGNoLnJvdXRlLmlkID8gZXJyb3JzID09IG51bGwgPyB2b2lkIDAgOiBlcnJvcnNbbWF0Y2gucm91dGUuaWRdIDogbnVsbDsgLy8gT25seSBkYXRhIHJvdXRlcnMgaGFuZGxlIGVycm9ycwoKICAgICAgICAgICAgICB2YXIgZXJyb3JFbGVtZW50ID0gZGF0YVJvdXRlclN0YXRlID8gbWF0Y2gucm91dGUuZXJyb3JFbGVtZW50IHx8IC8qI19fUFVSRV9fKi9yZWFjdC5jcmVhdGVFbGVtZW50KERlZmF1bHRFcnJvckVsZW1lbnQsIG51bGwpIDogbnVsbDsKCiAgICAgICAgICAgICAgdmFyIGdldENoaWxkcmVuID0gKCkgPT4gLyojX19QVVJFX18qL3JlYWN0LmNyZWF0ZUVsZW1lbnQoUmVuZGVyZWRSb3V0ZSwgewogICAgICAgICAgICAgICAgbWF0Y2g6IG1hdGNoLAogICAgICAgICAgICAgICAgcm91dGVDb250ZXh0OiB7CiAgICAgICAgICAgICAgICAgIG91dGxldDogb3V0bGV0LAogICAgICAgICAgICAgICAgICBtYXRjaGVzOiBwYXJlbnRNYXRjaGVzLmNvbmNhdChyZW5kZXJlZE1hdGNoZXMuc2xpY2UoMCwgaW5kZXggKyAxKSkKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9LCBlcnJvciA/IGVycm9yRWxlbWVudCA6IG1hdGNoLnJvdXRlLmVsZW1lbnQgIT09IHVuZGVmaW5lZCA/IG1hdGNoLnJvdXRlLmVsZW1lbnQgOiBvdXRsZXQpOyAvLyBPbmx5IHdyYXAgaW4gYW4gZXJyb3IgYm91bmRhcnkgd2l0aGluIGRhdGEgcm91dGVyIHVzYWdlcyB3aGVuIHdlIGhhdmUgYW4KICAgICAgICAgICAgICAvLyBlcnJvckVsZW1lbnQgb24gdGhpcyByb3V0ZS4gIE90aGVyd2lzZSBsZXQgaXQgYnViYmxlIHVwIHRvIGFuIGFuY2VzdG9yCiAgICAgICAgICAgICAgLy8gZXJyb3JFbGVtZW50CgoKICAgICAgICAgICAgICByZXR1cm4gZGF0YVJvdXRlclN0YXRlICYmIChtYXRjaC5yb3V0ZS5lcnJvckVsZW1lbnQgfHwgaW5kZXggPT09IDApID8gLyojX19QVVJFX18qL3JlYWN0LmNyZWF0ZUVsZW1lbnQoUmVuZGVyRXJyb3JCb3VuZGFyeSwgewogICAgICAgICAgICAgICAgbG9jYXRpb246IGRhdGFSb3V0ZXJTdGF0ZS5sb2NhdGlvbiwKICAgICAgICAgICAgICAgIGNvbXBvbmVudDogZXJyb3JFbGVtZW50LAogICAgICAgICAgICAgICAgZXJyb3I6IGVycm9yLAogICAgICAgICAgICAgICAgY2hpbGRyZW46IGdldENoaWxkcmVuKCkKICAgICAgICAgICAgICB9KSA6IGdldENoaWxkcmVuKCk7CiAgICAgICAgICAgIH0sIG51bGwpOwogICAgICAgICAgfQogICAgICAgICAgdmFyIERhdGFSb3V0ZXJIb29rOwoKICAgICAgICAgIChmdW5jdGlvbiAoRGF0YVJvdXRlckhvb2spIHsKICAgICAgICAgICAgRGF0YVJvdXRlckhvb2tbIlVzZVJldmFsaWRhdG9yIl0gPSAidXNlUmV2YWxpZGF0b3IiOwogICAgICAgICAgfSkoRGF0YVJvdXRlckhvb2sgfHwgKERhdGFSb3V0ZXJIb29rID0ge30pKTsKCiAgICAgICAgICB2YXIgRGF0YVJvdXRlclN0YXRlSG9vazsKCiAgICAgICAgICAoZnVuY3Rpb24gKERhdGFSb3V0ZXJTdGF0ZUhvb2spIHsKICAgICAgICAgICAgRGF0YVJvdXRlclN0YXRlSG9va1siVXNlTG9hZGVyRGF0YSJdID0gInVzZUxvYWRlckRhdGEiOwogICAgICAgICAgICBEYXRhUm91dGVyU3RhdGVIb29rWyJVc2VBY3Rpb25EYXRhIl0gPSAidXNlQWN0aW9uRGF0YSI7CiAgICAgICAgICAgIERhdGFSb3V0ZXJTdGF0ZUhvb2tbIlVzZVJvdXRlRXJyb3IiXSA9ICJ1c2VSb3V0ZUVycm9yIjsKICAgICAgICAgICAgRGF0YVJvdXRlclN0YXRlSG9va1siVXNlTmF2aWdhdGlvbiJdID0gInVzZU5hdmlnYXRpb24iOwogICAgICAgICAgICBEYXRhUm91dGVyU3RhdGVIb29rWyJVc2VSb3V0ZUxvYWRlckRhdGEiXSA9ICJ1c2VSb3V0ZUxvYWRlckRhdGEiOwogICAgICAgICAgICBEYXRhUm91dGVyU3RhdGVIb29rWyJVc2VNYXRjaGVzIl0gPSAidXNlTWF0Y2hlcyI7CiAgICAgICAgICAgIERhdGFSb3V0ZXJTdGF0ZUhvb2tbIlVzZVJldmFsaWRhdG9yIl0gPSAidXNlUmV2YWxpZGF0b3IiOwogICAgICAgICAgfSkoRGF0YVJvdXRlclN0YXRlSG9vayB8fCAoRGF0YVJvdXRlclN0YXRlSG9vayA9IHt9KSk7CgogICAgICAgICAgZnVuY3Rpb24gZ2V0RGF0YVJvdXRlckNvbnNvbGVFcnJvcihob29rTmFtZSkgewogICAgICAgICAgICByZXR1cm4gaG9va05hbWUgKyAiIG11c3QgYmUgdXNlZCB3aXRoaW4gYSBkYXRhIHJvdXRlci4gIFNlZSBodHRwczovL3JlYWN0cm91dGVyLmNvbS9lbi9tYWluL3JvdXRlcnMvcGlja2luZy1hLXJvdXRlci4iOwogICAgICAgICAgfQoKICAgICAgICAgIGZ1bmN0aW9uIHVzZURhdGFSb3V0ZXJDb250ZXh0KGhvb2tOYW1lKSB7CiAgICAgICAgICAgIHZhciBjdHggPSBSZWFjdC51c2VDb250ZXh0KERhdGFSb3V0ZXJDb250ZXh0KTsKICAgICAgICAgICAgIWN0eCA/IGZhbHNlID8gMCA6IGludmFyaWFudChmYWxzZSkgOiB2b2lkIDA7CiAgICAgICAgICAgIHJldHVybiBjdHg7CiAgICAgICAgICB9CgogICAgICAgICAgZnVuY3Rpb24gdXNlRGF0YVJvdXRlclN0YXRlKGhvb2tOYW1lKSB7CiAgICAgICAgICAgIHZhciBzdGF0ZSA9IHJlYWN0LnVzZUNvbnRleHQoRGF0YVJvdXRlclN0YXRlQ29udGV4dCk7CiAgICAgICAgICAgICFzdGF0ZSA/IGZhbHNlID8gMCA6IHJvdXRlcl9pbnZhcmlhbnQoZmFsc2UpIDogdm9pZCAwOwogICAgICAgICAgICByZXR1cm4gc3RhdGU7CiAgICAgICAgICB9CiAgICAgICAgICAvKioKICAgICAgICAgICAqIFJldHVybnMgdGhlIGN1cnJlbnQgbmF2aWdhdGlvbiwgZGVmYXVsdGluZyB0byBhbiAiaWRsZSIgbmF2aWdhdGlvbiB3aGVuCiAgICAgICAgICAgKiBubyBuYXZpZ2F0aW9uIGlzIGluIHByb2dyZXNzCiAgICAgICAgICAgKi8KCgogICAgICAgICAgZnVuY3Rpb24gZGlzdF91c2VOYXZpZ2F0aW9uKCkgewogICAgICAgICAgICB2YXIgc3RhdGUgPSB1c2VEYXRhUm91dGVyU3RhdGUoRGF0YVJvdXRlclN0YXRlSG9vay5Vc2VOYXZpZ2F0aW9uKTsKICAgICAgICAgICAgcmV0dXJuIHN0YXRlLm5hdmlnYXRpb247CiAgICAgICAgICB9CiAgICAgICAgICAvKioKICAgICAgICAgICAqIFJldHVybnMgYSByZXZhbGlkYXRlIGZ1bmN0aW9uIGZvciBtYW51YWxseSB0cmlnZ2VyaW5nIHJldmFsaWRhdGlvbiwgYXMgd2VsbAogICAgICAgICAgICogYXMgdGhlIGN1cnJlbnQgc3RhdGUgb2YgYW55IG1hbnVhbCByZXZhbGlkYXRpb25zCiAgICAgICAgICAgKi8KCiAgICAgICAgICBmdW5jdGlvbiB1c2VSZXZhbGlkYXRvcigpIHsKICAgICAgICAgICAgdmFyIGRhdGFSb3V0ZXJDb250ZXh0ID0gdXNlRGF0YVJvdXRlckNvbnRleHQoRGF0YVJvdXRlckhvb2suVXNlUmV2YWxpZGF0b3IpOwogICAgICAgICAgICB2YXIgc3RhdGUgPSB1c2VEYXRhUm91dGVyU3RhdGUoRGF0YVJvdXRlclN0YXRlSG9vay5Vc2VSZXZhbGlkYXRvcik7CiAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgcmV2YWxpZGF0ZTogZGF0YVJvdXRlckNvbnRleHQucm91dGVyLnJldmFsaWRhdGUsCiAgICAgICAgICAgICAgc3RhdGU6IHN0YXRlLnJldmFsaWRhdGlvbgogICAgICAgICAgICB9OwogICAgICAgICAgfQogICAgICAgICAgLyoqCiAgICAgICAgICAgKiBSZXR1cm5zIHRoZSBhY3RpdmUgcm91dGUgbWF0Y2hlcywgdXNlZnVsIGZvciBhY2Nlc3NpbmcgbG9hZGVyRGF0YSBmb3IKICAgICAgICAgICAqIHBhcmVudC9jaGlsZCByb3V0ZXMgb3IgdGhlIHJvdXRlICJoYW5kbGUiIHByb3BlcnR5CiAgICAgICAgICAgKi8KCiAgICAgICAgICBmdW5jdGlvbiBkaXN0X3VzZU1hdGNoZXMoKSB7CiAgICAgICAgICAgIHZhciBfdXNlRGF0YVJvdXRlclN0YXRlID0KCgogICAgICAgICAgICAgIHVzZURhdGFSb3V0ZXJTdGF0ZShEYXRhUm91dGVyU3RhdGVIb29rLlVzZU1hdGNoZXMpLG1hdGNoZXMgPSBfdXNlRGF0YVJvdXRlclN0YXRlLm1hdGNoZXMsbG9hZGVyRGF0YSA9IF91c2VEYXRhUm91dGVyU3RhdGUubG9hZGVyRGF0YTsKICAgICAgICAgICAgcmV0dXJuIFJlYWN0LnVzZU1lbW8oKCkgPT4gbWF0Y2hlcy5tYXAoKG1hdGNoKSA9PiB7CiAgICAgICAgICAgICAgdmFyCiAgICAgICAgICAgICAgICBwYXRobmFtZSA9CgogICAgICAgICAgICAgICAgbWF0Y2gucGF0aG5hbWUscGFyYW1zID0gbWF0Y2gucGFyYW1zOyAvLyBOb3RlOiBUaGlzIHN0cnVjdHVyZSBtYXRjaGVzIHRoYXQgY3JlYXRlZCBieSBjcmVhdGVVc2VNYXRjaGVzTWF0Y2gKICAgICAgICAgICAgICAvLyBpbiB0aGUgQHJlbWl4LXJ1bi9yb3V0ZXIgLCBzbyBpZiB5b3UgY2hhbmdlIHRoaXMgcGxlYXNlIGFsc28gY2hhbmdlCiAgICAgICAgICAgICAgLy8gdGhhdCA6KSAgRXZlbnR1YWxseSB3ZSdsbCBEUlkgdGhpcyB1cAoKICAgICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgaWQ6IG1hdGNoLnJvdXRlLmlkLAogICAgICAgICAgICAgICAgcGF0aG5hbWU6IHBhdGhuYW1lLAogICAgICAgICAgICAgICAgcGFyYW1zOiBwYXJhbXMsCiAgICAgICAgICAgICAgICBkYXRhOiBsb2FkZXJEYXRhW21hdGNoLnJvdXRlLmlkXSwKICAgICAgICAgICAgICAgIGhhbmRsZTogbWF0Y2gucm91dGUuaGFuZGxlCiAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgfSksIFttYXRjaGVzLCBsb2FkZXJEYXRhXSk7CiAgICAgICAgICB9CiAgICAgICAgICAvKioKICAgICAgICAgICAqIFJldHVybnMgdGhlIGxvYWRlciBkYXRhIGZvciB0aGUgbmVhcmVzdCBhbmNlc3RvciBSb3V0ZSBsb2FkZXIKICAgICAgICAgICAqLwoKICAgICAgICAgIGZ1bmN0aW9uIHVzZUxvYWRlckRhdGEoKSB7CiAgICAgICAgICAgIHZhciBzdGF0ZSA9IHVzZURhdGFSb3V0ZXJTdGF0ZShEYXRhUm91dGVyU3RhdGVIb29rLlVzZUxvYWRlckRhdGEpOwogICAgICAgICAgICB2YXIgcm91dGUgPSBSZWFjdC51c2VDb250ZXh0KFJvdXRlQ29udGV4dCk7CiAgICAgICAgICAgICFyb3V0ZSA/IGZhbHNlID8gMCA6IGludmFyaWFudChmYWxzZSkgOiB2b2lkIDA7CiAgICAgICAgICAgIHZhciB0aGlzUm91dGUgPSByb3V0ZS5tYXRjaGVzW3JvdXRlLm1hdGNoZXMubGVuZ3RoIC0gMV07CiAgICAgICAgICAgICF0aGlzUm91dGUucm91dGUuaWQgPyBmYWxzZSA/IDAgOiBpbnZhcmlhbnQoZmFsc2UpIDogdm9pZCAwOwogICAgICAgICAgICByZXR1cm4gc3RhdGUubG9hZGVyRGF0YVt0aGlzUm91dGUucm91dGUuaWRdOwogICAgICAgICAgfQogICAgICAgICAgLyoqCiAgICAgICAgICAgKiBSZXR1cm5zIHRoZSBsb2FkZXJEYXRhIGZvciB0aGUgZ2l2ZW4gcm91dGVJZAogICAgICAgICAgICovCgogICAgICAgICAgZnVuY3Rpb24gdXNlUm91dGVMb2FkZXJEYXRhKHJvdXRlSWQpIHsKICAgICAgICAgICAgdmFyIHN0YXRlID0gdXNlRGF0YVJvdXRlclN0YXRlKERhdGFSb3V0ZXJTdGF0ZUhvb2suVXNlUm91dGVMb2FkZXJEYXRhKTsKICAgICAgICAgICAgcmV0dXJuIHN0YXRlLmxvYWRlckRhdGFbcm91dGVJZF07CiAgICAgICAgICB9CiAgICAgICAgICAvKioKICAgICAgICAgICAqIFJldHVybnMgdGhlIGFjdGlvbiBkYXRhIGZvciB0aGUgbmVhcmVzdCBhbmNlc3RvciBSb3V0ZSBhY3Rpb24KICAgICAgICAgICAqLwoKICAgICAgICAgIGZ1bmN0aW9uIHVzZUFjdGlvbkRhdGEoKSB7CiAgICAgICAgICAgIHZhciBzdGF0ZSA9IHVzZURhdGFSb3V0ZXJTdGF0ZShEYXRhUm91dGVyU3RhdGVIb29rLlVzZUFjdGlvbkRhdGEpOwogICAgICAgICAgICB2YXIgcm91dGUgPSBSZWFjdC51c2VDb250ZXh0KFJvdXRlQ29udGV4dCk7CiAgICAgICAgICAgICFyb3V0ZSA/IGZhbHNlID8gMCA6IGludmFyaWFudChmYWxzZSkgOiB2b2lkIDA7CiAgICAgICAgICAgIHJldHVybiBPYmplY3QudmFsdWVzKChzdGF0ZSA9PSBudWxsID8gdm9pZCAwIDogc3RhdGUuYWN0aW9uRGF0YSkgfHwge30pWzBdOwogICAgICAgICAgfQogICAgICAgICAgLyoqCiAgICAgICAgICAgKiBSZXR1cm5zIHRoZSBuZWFyZXN0IGFuY2VzdG9yIFJvdXRlIGVycm9yLCB3aGljaCBjb3VsZCBiZSBhIGxvYWRlci9hY3Rpb24KICAgICAgICAgICAqIGVycm9yIG9yIGEgcmVuZGVyIGVycm9yLiAgVGhpcyBpcyBpbnRlbmRlZCB0byBiZSBjYWxsZWQgZnJvbSB5b3VyCiAgICAgICAgICAgKiBlcnJvckVsZW1lbnQgdG8gZGlzcGxheSBhIHByb3BlciBlcnJvciBtZXNzYWdlLgogICAgICAgICAgICovCgogICAgICAgICAgZnVuY3Rpb24gdXNlUm91dGVFcnJvcigpIHsKICAgICAgICAgICAgdmFyIF9zdGF0ZSRlcnJvcnM7CgogICAgICAgICAgICB2YXIgZXJyb3IgPSByZWFjdC51c2VDb250ZXh0KFJvdXRlRXJyb3JDb250ZXh0KTsKICAgICAgICAgICAgdmFyIHN0YXRlID0gdXNlRGF0YVJvdXRlclN0YXRlKERhdGFSb3V0ZXJTdGF0ZUhvb2suVXNlUm91dGVFcnJvcik7CiAgICAgICAgICAgIHZhciByb3V0ZSA9IHJlYWN0LnVzZUNvbnRleHQoUm91dGVDb250ZXh0KTsKICAgICAgICAgICAgdmFyIHRoaXNSb3V0ZSA9IHJvdXRlLm1hdGNoZXNbcm91dGUubWF0Y2hlcy5sZW5ndGggLSAxXTsgLy8gSWYgdGhpcyB3YXMgYSByZW5kZXIgZXJyb3IsIHdlIHB1dCBpdCBpbiBhIFJvdXRlRXJyb3IgY29udGV4dCBpbnNpZGUKICAgICAgICAgICAgLy8gb2YgUmVuZGVyRXJyb3JCb3VuZGFyeQoKICAgICAgICAgICAgaWYgKGVycm9yKSB7CiAgICAgICAgICAgICAgcmV0dXJuIGVycm9yOwogICAgICAgICAgICB9CgogICAgICAgICAgICAhcm91dGUgPyBmYWxzZSA/IDAgOiByb3V0ZXJfaW52YXJpYW50KGZhbHNlKSA6IHZvaWQgMDsKICAgICAgICAgICAgIXRoaXNSb3V0ZS5yb3V0ZS5pZCA/IGZhbHNlID8gMCA6IHJvdXRlcl9pbnZhcmlhbnQoZmFsc2UpIDogdm9pZCAwOyAvLyBPdGhlcndpc2UgbG9vayBmb3IgZXJyb3JzIGZyb20gb3VyIGRhdGEgcm91dGVyIHN0YXRlCgogICAgICAgICAgICByZXR1cm4gKF9zdGF0ZSRlcnJvcnMgPSBzdGF0ZS5lcnJvcnMpID09IG51bGwgPyB2b2lkIDAgOiBfc3RhdGUkZXJyb3JzW3RoaXNSb3V0ZS5yb3V0ZS5pZF07CiAgICAgICAgICB9CiAgICAgICAgICAvKioKICAgICAgICAgICAqIFJldHVybnMgdGhlIGhhcHB5LXBhdGggZGF0YSBmcm9tIHRoZSBuZWFyZXN0IGFuY2VzdG9yIDxBd2FpdCAvPiB2YWx1ZQogICAgICAgICAgICovCgogICAgICAgICAgZnVuY3Rpb24gdXNlQXN5bmNWYWx1ZSgpIHsKICAgICAgICAgICAgdmFyIHZhbHVlID0gUmVhY3QudXNlQ29udGV4dChBd2FpdENvbnRleHQpOwogICAgICAgICAgICByZXR1cm4gdmFsdWUgPT0gbnVsbCA/IHZvaWQgMCA6IHZhbHVlLl9kYXRhOwogICAgICAgICAgfQogICAgICAgICAgLyoqCiAgICAgICAgICAgKiBSZXR1cm5zIHRoZSBlcnJvciBmcm9tIHRoZSBuZWFyZXN0IGFuY2VzdG9yIDxBd2FpdCAvPiB2YWx1ZQogICAgICAgICAgICovCgogICAgICAgICAgZnVuY3Rpb24gdXNlQXN5bmNFcnJvcigpIHsKICAgICAgICAgICAgdmFyIHZhbHVlID0gUmVhY3QudXNlQ29udGV4dChBd2FpdENvbnRleHQpOwogICAgICAgICAgICByZXR1cm4gdmFsdWUgPT0gbnVsbCA/IHZvaWQgMCA6IHZhbHVlLl9lcnJvcjsKICAgICAgICAgIH0KICAgICAgICAgIHZhciBhbHJlYWR5V2FybmVkID0ge307CgogICAgICAgICAgZnVuY3Rpb24gd2FybmluZ09uY2Uoa2V5LCBjb25kLCBtZXNzYWdlKSB7CiAgICAgICAgICAgIGlmICghY29uZCAmJiAhYWxyZWFkeVdhcm5lZFtrZXldKSB7CiAgICAgICAgICAgICAgYWxyZWFkeVdhcm5lZFtrZXldID0gdHJ1ZTsKICAgICAgICAgICAgICBmYWxzZSA/IDAgOiB2b2lkIDA7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KCiAgICAgICAgICAvKioKICAgICAgICAgICAqIEdpdmVuIGEgUmVtaXggUm91dGVyIGluc3RhbmNlLCByZW5kZXIgdGhlIGFwcHJvcHJpYXRlIFVJCiAgICAgICAgICAgKi8KICAgICAgICAgIGZ1bmN0aW9uIFJvdXRlclByb3ZpZGVyKF9yZWYpIHsKICAgICAgICAgICAgdmFyCiAgICAgICAgICAgICAgZmFsbGJhY2tFbGVtZW50ID0KCiAgICAgICAgICAgICAgX3JlZi5mYWxsYmFja0VsZW1lbnQscm91dGVyID0gX3JlZi5yb3V0ZXI7CiAgICAgICAgICAgIC8vIFN5bmMgcm91dGVyIHN0YXRlIHRvIG91ciBjb21wb25lbnQgc3RhdGUgdG8gZm9yY2UgcmUtcmVuZGVycwogICAgICAgICAgICB2YXIgc3RhdGUgPSB1c2VTeW5jRXh0ZXJuYWxTdG9yZShyb3V0ZXIuc3Vic2NyaWJlLCAoKSA9PiByb3V0ZXIuc3RhdGUsIC8vIFdlIGhhdmUgdG8gcHJvdmlkZSB0aGlzIHNvIFJlYWN0QDE4IGRvZXNuJ3QgY29tcGxhaW4gZHVyaW5nIGh5ZHJhdGlvbiwKICAgICAgICAgICAgLy8gYnV0IHdlIHBhc3Mgb3VyIHNlcmlhbGl6ZWQgaHlkcmF0aW9uIGRhdGEgaW50byB0aGUgcm91dGVyIHNvIHN0YXRlIGhlcmUKICAgICAgICAgICAgLy8gaXMgYWxyZWFkeSBzeW5jZWQgd2l0aCB3aGF0IHRoZSBzZXJ2ZXIgc2F3CiAgICAgICAgICAgICgpID0+IHJvdXRlci5zdGF0ZSk7CiAgICAgICAgICAgIHZhciBuYXZpZ2F0b3IgPSBSZWFjdC51c2VNZW1vKCgpID0+IHsKICAgICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgY3JlYXRlSHJlZjogcm91dGVyLmNyZWF0ZUhyZWYsCiAgICAgICAgICAgICAgICBlbmNvZGVMb2NhdGlvbjogcm91dGVyLmVuY29kZUxvY2F0aW9uLAogICAgICAgICAgICAgICAgZ286IChuKSA9PiByb3V0ZXIubmF2aWdhdGUobiksCiAgICAgICAgICAgICAgICBwdXNoOiAodG8sIHN0YXRlLCBvcHRzKSA9PiByb3V0ZXIubmF2aWdhdGUodG8sIHsKICAgICAgICAgICAgICAgICAgc3RhdGU6IHN0YXRlLAogICAgICAgICAgICAgICAgICBwcmV2ZW50U2Nyb2xsUmVzZXQ6IG9wdHMgPT0gbnVsbCA/IHZvaWQgMCA6IG9wdHMucHJldmVudFNjcm9sbFJlc2V0CiAgICAgICAgICAgICAgICB9KSwKICAgICAgICAgICAgICAgIHJlcGxhY2U6ICh0bywgc3RhdGUsIG9wdHMpID0+IHJvdXRlci5uYXZpZ2F0ZSh0bywgewogICAgICAgICAgICAgICAgICByZXBsYWNlOiB0cnVlLAogICAgICAgICAgICAgICAgICBzdGF0ZTogc3RhdGUsCiAgICAgICAgICAgICAgICAgIHByZXZlbnRTY3JvbGxSZXNldDogb3B0cyA9PSBudWxsID8gdm9pZCAwIDogb3B0cy5wcmV2ZW50U2Nyb2xsUmVzZXQKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgfSwgW3JvdXRlcl0pOwogICAgICAgICAgICB2YXIgYmFzZW5hbWUgPSByb3V0ZXIuYmFzZW5hbWUgfHwgIi8iOwogICAgICAgICAgICByZXR1cm4gLyojX19QVVJFX18qL1JlYWN0LmNyZWF0ZUVsZW1lbnQoRGF0YVJvdXRlckNvbnRleHQuUHJvdmlkZXIsIHsKICAgICAgICAgICAgICB2YWx1ZTogewogICAgICAgICAgICAgICAgcm91dGVyOiByb3V0ZXIsCiAgICAgICAgICAgICAgICBuYXZpZ2F0b3I6IG5hdmlnYXRvciwKICAgICAgICAgICAgICAgIHN0YXRpYzogZmFsc2UsCiAgICAgICAgICAgICAgICAvLyBEbyB3ZSBuZWVkIHRoaXM/CiAgICAgICAgICAgICAgICBiYXNlbmFtZTogYmFzZW5hbWUKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sIC8qI19fUFVSRV9fKi9SZWFjdC5jcmVhdGVFbGVtZW50KERhdGFSb3V0ZXJTdGF0ZUNvbnRleHQuUHJvdmlkZXIsIHsKICAgICAgICAgICAgICB2YWx1ZTogc3RhdGUKICAgICAgICAgICAgfSwgLyojX19QVVJFX18qL1JlYWN0LmNyZWF0ZUVsZW1lbnQoZGlzdF9Sb3V0ZXIsIHsKICAgICAgICAgICAgICBiYXNlbmFtZTogcm91dGVyLmJhc2VuYW1lLAogICAgICAgICAgICAgIGxvY2F0aW9uOiByb3V0ZXIuc3RhdGUubG9jYXRpb24sCiAgICAgICAgICAgICAgbmF2aWdhdGlvblR5cGU6IHJvdXRlci5zdGF0ZS5oaXN0b3J5QWN0aW9uLAogICAgICAgICAgICAgIG5hdmlnYXRvcjogbmF2aWdhdG9yCiAgICAgICAgICAgIH0sIHJvdXRlci5zdGF0ZS5pbml0aWFsaXplZCA/IC8qI19fUFVSRV9fKi9SZWFjdC5jcmVhdGVFbGVtZW50KFJvdXRlcywgbnVsbCkgOiBmYWxsYmFja0VsZW1lbnQpKSk7CiAgICAgICAgICB9CgogICAgICAgICAgLyoqCiAgICAgICAgICAgKiBBIDxSb3V0ZXI+IHRoYXQgc3RvcmVzIGFsbCBlbnRyaWVzIGluIG1lbW9yeS4KICAgICAgICAgICAqCiAgICAgICAgICAgKiBAc2VlIGh0dHBzOi8vcmVhY3Ryb3V0ZXIuY29tL2RvY3MvZW4vdjYvcm91dGVycy9tZW1vcnktcm91dGVyCiAgICAgICAgICAgKi8KICAgICAgICAgIGZ1bmN0aW9uIE1lbW9yeVJvdXRlcihfcmVmMikgewogICAgICAgICAgICB2YXIKICAgICAgICAgICAgICBiYXNlbmFtZSA9CgoKCiAgICAgICAgICAgICAgX3JlZjIuYmFzZW5hbWUsY2hpbGRyZW4gPSBfcmVmMi5jaGlsZHJlbixpbml0aWFsRW50cmllcyA9IF9yZWYyLmluaXRpYWxFbnRyaWVzLGluaXRpYWxJbmRleCA9IF9yZWYyLmluaXRpYWxJbmRleDsKICAgICAgICAgICAgdmFyIGhpc3RvcnlSZWYgPSByZWFjdC51c2VSZWYoKTsKCiAgICAgICAgICAgIGlmIChoaXN0b3J5UmVmLmN1cnJlbnQgPT0gbnVsbCkgewogICAgICAgICAgICAgIGhpc3RvcnlSZWYuY3VycmVudCA9IHJvdXRlcl9jcmVhdGVNZW1vcnlIaXN0b3J5KHsKICAgICAgICAgICAgICAgIGluaXRpYWxFbnRyaWVzOiBpbml0aWFsRW50cmllcywKICAgICAgICAgICAgICAgIGluaXRpYWxJbmRleDogaW5pdGlhbEluZGV4LAogICAgICAgICAgICAgICAgdjVDb21wYXQ6IHRydWUKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdmFyIGhpc3RvcnkgPSBoaXN0b3J5UmVmLmN1cnJlbnQ7CiAgICAgICAgICAgIHZhciBfcmVhY3QkdXNlU3RhdGUgPSByZWFjdC51c2VTdGF0ZSh7CiAgICAgICAgICAgICAgICBhY3Rpb246IGhpc3RvcnkuYWN0aW9uLAogICAgICAgICAgICAgICAgbG9jYXRpb246IGhpc3RvcnkubG9jYXRpb24KICAgICAgICAgICAgICB9KSxfcmVhY3QkdXNlU3RhdGUyID0gX3NsaWNlZFRvQXJyYXkyKF9yZWFjdCR1c2VTdGF0ZSwgMiksc3RhdGUgPSBfcmVhY3QkdXNlU3RhdGUyWzBdLHNldFN0YXRlID0gX3JlYWN0JHVzZVN0YXRlMlsxXTsKICAgICAgICAgICAgcmVhY3QudXNlTGF5b3V0RWZmZWN0KCgpID0+IGhpc3RvcnkubGlzdGVuKHNldFN0YXRlKSwgW2hpc3RvcnldKTsKICAgICAgICAgICAgcmV0dXJuIC8qI19fUFVSRV9fKi9yZWFjdC5jcmVhdGVFbGVtZW50KGRpc3RfUm91dGVyLCB7CiAgICAgICAgICAgICAgYmFzZW5hbWU6IGJhc2VuYW1lLAogICAgICAgICAgICAgIGNoaWxkcmVuOiBjaGlsZHJlbiwKICAgICAgICAgICAgICBsb2NhdGlvbjogc3RhdGUubG9jYXRpb24sCiAgICAgICAgICAgICAgbmF2aWdhdGlvblR5cGU6IHN0YXRlLmFjdGlvbiwKICAgICAgICAgICAgICBuYXZpZ2F0b3I6IGhpc3RvcnkKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9CgogICAgICAgICAgLyoqCiAgICAgICAgICAgKiBDaGFuZ2VzIHRoZSBjdXJyZW50IGxvY2F0aW9uLgogICAgICAgICAgICoKICAgICAgICAgICAqIE5vdGU6IFRoaXMgQVBJIGlzIG1vc3RseSB1c2VmdWwgaW4gUmVhY3QuQ29tcG9uZW50IHN1YmNsYXNzZXMgdGhhdCBhcmUgbm90CiAgICAgICAgICAgKiBhYmxlIHRvIHVzZSBob29rcy4gSW4gZnVuY3Rpb25hbCBjb21wb25lbnRzLCB3ZSByZWNvbW1lbmQgeW91IHVzZSB0aGUKICAgICAgICAgICAqIGB1c2VOYXZpZ2F0ZWAgaG9vayBpbnN0ZWFkLgogICAgICAgICAgICoKICAgICAgICAgICAqIEBzZWUgaHR0cHM6Ly9yZWFjdHJvdXRlci5jb20vZG9jcy9lbi92Ni9jb21wb25lbnRzL25hdmlnYXRlCiAgICAgICAgICAgKi8KICAgICAgICAgIGZ1bmN0aW9uIE5hdmlnYXRlKF9yZWYzKSB7CiAgICAgICAgICAgIHZhcgogICAgICAgICAgICAgIHRvID0KCgoKICAgICAgICAgICAgICBfcmVmMy50byxyZXBsYWNlID0gX3JlZjMucmVwbGFjZSxzdGF0ZSA9IF9yZWYzLnN0YXRlLHJlbGF0aXZlID0gX3JlZjMucmVsYXRpdmU7CiAgICAgICAgICAgICF1c2VJblJvdXRlckNvbnRleHQoKSA/IGZhbHNlID8gMCA6IHJvdXRlcl9pbnZhcmlhbnQoZmFsc2UpIDogdm9pZCAwOwogICAgICAgICAgICBmYWxzZSA/IDAgOiB2b2lkIDA7CiAgICAgICAgICAgIHZhciBkYXRhUm91dGVyU3RhdGUgPSByZWFjdC51c2VDb250ZXh0KERhdGFSb3V0ZXJTdGF0ZUNvbnRleHQpOwogICAgICAgICAgICB2YXIgbmF2aWdhdGUgPSBkaXN0X3VzZU5hdmlnYXRlKCk7CiAgICAgICAgICAgIHJlYWN0LnVzZUVmZmVjdCgoKSA9PiB7CiAgICAgICAgICAgICAgLy8gQXZvaWQga2lja2luZyBvZmYgbXVsdGlwbGUgbmF2aWdhdGlvbnMgaWYgd2UncmUgaW4gdGhlIG1pZGRsZSBvZiBhCiAgICAgICAgICAgICAgLy8gZGF0YS1yb3V0ZXIgbmF2aWdhdGlvbiwgc2luY2UgY29tcG9uZW50cyBnZXQgcmUtcmVuZGVyZWQgd2hlbiB3ZSBlbnRlcgogICAgICAgICAgICAgIC8vIGEgc3VibWl0dGluZy9sb2FkaW5nIHN0YXRlCiAgICAgICAgICAgICAgaWYgKGRhdGFSb3V0ZXJTdGF0ZSAmJiBkYXRhUm91dGVyU3RhdGUubmF2aWdhdGlvbi5zdGF0ZSAhPT0gImlkbGUiKSB7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBuYXZpZ2F0ZSh0bywgewogICAgICAgICAgICAgICAgcmVwbGFjZTogcmVwbGFjZSwKICAgICAgICAgICAgICAgIHN0YXRlOiBzdGF0ZSwKICAgICAgICAgICAgICAgIHJlbGF0aXZlOiByZWxhdGl2ZQogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9KTsKICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgICB9CgogICAgICAgICAgLyoqCiAgICAgICAgICAgKiBSZW5kZXJzIHRoZSBjaGlsZCByb3V0ZSdzIGVsZW1lbnQsIGlmIHRoZXJlIGlzIG9uZS4KICAgICAgICAgICAqCiAgICAgICAgICAgKiBAc2VlIGh0dHBzOi8vcmVhY3Ryb3V0ZXIuY29tL2RvY3MvZW4vdjYvY29tcG9uZW50cy9vdXRsZXQKICAgICAgICAgICAqLwogICAgICAgICAgZnVuY3Rpb24gT3V0bGV0KHByb3BzKSB7CiAgICAgICAgICAgIHJldHVybiB1c2VPdXRsZXQocHJvcHMuY29udGV4dCk7CiAgICAgICAgICB9CgogICAgICAgICAgLyoqCiAgICAgICAgICAgKiBEZWNsYXJlcyBhbiBlbGVtZW50IHRoYXQgc2hvdWxkIGJlIHJlbmRlcmVkIGF0IGEgY2VydGFpbiBVUkwgcGF0aC4KICAgICAgICAgICAqCiAgICAgICAgICAgKiBAc2VlIGh0dHBzOi8vcmVhY3Ryb3V0ZXIuY29tL2RvY3MvZW4vdjYvY29tcG9uZW50cy9yb3V0ZQogICAgICAgICAgICovCiAgICAgICAgICBmdW5jdGlvbiBSb3V0ZShfcHJvcHMpIHsKICAgICAgICAgICAgZmFsc2UgPyAwIDogcm91dGVyX2ludmFyaWFudChmYWxzZSk7CiAgICAgICAgICB9CgogICAgICAgICAgLyoqCiAgICAgICAgICAgKiBQcm92aWRlcyBsb2NhdGlvbiBjb250ZXh0IGZvciB0aGUgcmVzdCBvZiB0aGUgYXBwLgogICAgICAgICAgICoKICAgICAgICAgICAqIE5vdGU6IFlvdSB1c3VhbGx5IHdvbid0IHJlbmRlciBhIDxSb3V0ZXI+IGRpcmVjdGx5LiBJbnN0ZWFkLCB5b3UnbGwgcmVuZGVyIGEKICAgICAgICAgICAqIHJvdXRlciB0aGF0IGlzIG1vcmUgc3BlY2lmaWMgdG8geW91ciBlbnZpcm9ubWVudCBzdWNoIGFzIGEgPEJyb3dzZXJSb3V0ZXI+CiAgICAgICAgICAgKiBpbiB3ZWIgYnJvd3NlcnMgb3IgYSA8U3RhdGljUm91dGVyPiBmb3Igc2VydmVyIHJlbmRlcmluZy4KICAgICAgICAgICAqCiAgICAgICAgICAgKiBAc2VlIGh0dHBzOi8vcmVhY3Ryb3V0ZXIuY29tL2RvY3MvZW4vdjYvcm91dGVycy9yb3V0ZXIKICAgICAgICAgICAqLwogICAgICAgICAgZnVuY3Rpb24gZGlzdF9Sb3V0ZXIoX3JlZjQpIHsKICAgICAgICAgICAgdmFyIF9yZWY0JGJhc2VuYW1lID0KCgoKCgoKICAgICAgICAgICAgICBfcmVmNC5iYXNlbmFtZSxiYXNlbmFtZVByb3AgPSBfcmVmNCRiYXNlbmFtZSA9PT0gdm9pZCAwID8gIi8iIDogX3JlZjQkYmFzZW5hbWUsX3JlZjQkY2hpbGRyZW4gPSBfcmVmNC5jaGlsZHJlbixjaGlsZHJlbiA9IF9yZWY0JGNoaWxkcmVuID09PSB2b2lkIDAgPyBudWxsIDogX3JlZjQkY2hpbGRyZW4sbG9jYXRpb25Qcm9wID0gX3JlZjQubG9jYXRpb24sX3JlZjQkbmF2aWdhdGlvblR5cGUgPSBfcmVmNC5uYXZpZ2F0aW9uVHlwZSxuYXZpZ2F0aW9uVHlwZSA9IF9yZWY0JG5hdmlnYXRpb25UeXBlID09PSB2b2lkIDAgPyBBY3Rpb24uUG9wIDogX3JlZjQkbmF2aWdhdGlvblR5cGUsbmF2aWdhdG9yID0gX3JlZjQubmF2aWdhdG9yLF9yZWY0JHN0YXRpYyA9IF9yZWY0LnN0YXRpYyxzdGF0aWNQcm9wID0gX3JlZjQkc3RhdGljID09PSB2b2lkIDAgPyBmYWxzZSA6IF9yZWY0JHN0YXRpYzsKICAgICAgICAgICAgISF1c2VJblJvdXRlckNvbnRleHQoKSA/IGZhbHNlID8gMCA6IHJvdXRlcl9pbnZhcmlhbnQoZmFsc2UpIDogdm9pZCAwOyAvLyBQcmVzZXJ2ZSB0cmFpbGluZyBzbGFzaGVzIG9uIGJhc2VuYW1lLCBzbyB3ZSBjYW4gbGV0IHRoZSB1c2VyIGNvbnRyb2wKICAgICAgICAgICAgLy8gdGhlIGVuZm9yY2VtZW50IG9mIHRyYWlsaW5nIHNsYXNoZXMgdGhyb3VnaG91dCB0aGUgYXBwCgogICAgICAgICAgICB2YXIgYmFzZW5hbWUgPSBiYXNlbmFtZVByb3AucmVwbGFjZSgvXlwvKi8sICIvIik7CiAgICAgICAgICAgIHZhciBuYXZpZ2F0aW9uQ29udGV4dCA9IHJlYWN0LnVzZU1lbW8oKCkgPT4gKHsKICAgICAgICAgICAgICBiYXNlbmFtZTogYmFzZW5hbWUsCiAgICAgICAgICAgICAgbmF2aWdhdG9yOiBuYXZpZ2F0b3IsCiAgICAgICAgICAgICAgc3RhdGljOiBzdGF0aWNQcm9wCiAgICAgICAgICAgIH0pLCBbYmFzZW5hbWUsIG5hdmlnYXRvciwgc3RhdGljUHJvcF0pOwoKICAgICAgICAgICAgaWYgKHR5cGVvZiBsb2NhdGlvblByb3AgPT09ICJzdHJpbmciKSB7CiAgICAgICAgICAgICAgbG9jYXRpb25Qcm9wID0gcGFyc2VQYXRoKGxvY2F0aW9uUHJvcCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHZhciBfbG9jYXRpb25Qcm9wID0KCgoKCgogICAgICAgICAgICAgIGxvY2F0aW9uUHJvcCxfbG9jYXRpb25Qcm9wJHBhdGhuYW0gPSBfbG9jYXRpb25Qcm9wLnBhdGhuYW1lLHBhdGhuYW1lID0gX2xvY2F0aW9uUHJvcCRwYXRobmFtID09PSB2b2lkIDAgPyAiLyIgOiBfbG9jYXRpb25Qcm9wJHBhdGhuYW0sX2xvY2F0aW9uUHJvcCRzZWFyY2ggPSBfbG9jYXRpb25Qcm9wLnNlYXJjaCxzZWFyY2ggPSBfbG9jYXRpb25Qcm9wJHNlYXJjaCA9PT0gdm9pZCAwID8gIiIgOiBfbG9jYXRpb25Qcm9wJHNlYXJjaCxfbG9jYXRpb25Qcm9wJGhhc2ggPSBfbG9jYXRpb25Qcm9wLmhhc2gsaGFzaCA9IF9sb2NhdGlvblByb3AkaGFzaCA9PT0gdm9pZCAwID8gIiIgOiBfbG9jYXRpb25Qcm9wJGhhc2gsX2xvY2F0aW9uUHJvcCRzdGF0ZSA9IF9sb2NhdGlvblByb3Auc3RhdGUsc3RhdGUgPSBfbG9jYXRpb25Qcm9wJHN0YXRlID09PSB2b2lkIDAgPyBudWxsIDogX2xvY2F0aW9uUHJvcCRzdGF0ZSxfbG9jYXRpb25Qcm9wJGtleSA9IF9sb2NhdGlvblByb3Aua2V5LGtleSA9IF9sb2NhdGlvblByb3Aka2V5ID09PSB2b2lkIDAgPyAiZGVmYXVsdCIgOiBfbG9jYXRpb25Qcm9wJGtleTsKICAgICAgICAgICAgdmFyIGxvY2F0aW9uID0gcmVhY3QudXNlTWVtbygoKSA9PiB7CiAgICAgICAgICAgICAgdmFyIHRyYWlsaW5nUGF0aG5hbWUgPSBzdHJpcEJhc2VuYW1lKHBhdGhuYW1lLCBiYXNlbmFtZSk7CgogICAgICAgICAgICAgIGlmICh0cmFpbGluZ1BhdGhuYW1lID09IG51bGwpIHsKICAgICAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgIHBhdGhuYW1lOiB0cmFpbGluZ1BhdGhuYW1lLAogICAgICAgICAgICAgICAgc2VhcmNoOiBzZWFyY2gsCiAgICAgICAgICAgICAgICBoYXNoOiBoYXNoLAogICAgICAgICAgICAgICAgc3RhdGU6IHN0YXRlLAogICAgICAgICAgICAgICAga2V5OiBrZXkKICAgICAgICAgICAgICB9OwogICAgICAgICAgICB9LCBbYmFzZW5hbWUsIHBhdGhuYW1lLCBzZWFyY2gsIGhhc2gsIHN0YXRlLCBrZXldKTsKICAgICAgICAgICAgZmFsc2UgPyAwIDogdm9pZCAwOwoKICAgICAgICAgICAgaWYgKGxvY2F0aW9uID09IG51bGwpIHsKICAgICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuIC8qI19fUFVSRV9fKi9yZWFjdC5jcmVhdGVFbGVtZW50KE5hdmlnYXRpb25Db250ZXh0LlByb3ZpZGVyLCB7CiAgICAgICAgICAgICAgdmFsdWU6IG5hdmlnYXRpb25Db250ZXh0CiAgICAgICAgICAgIH0sIC8qI19fUFVSRV9fKi9yZWFjdC5jcmVhdGVFbGVtZW50KExvY2F0aW9uQ29udGV4dC5Qcm92aWRlciwgewogICAgICAgICAgICAgIGNoaWxkcmVuOiBjaGlsZHJlbiwKICAgICAgICAgICAgICB2YWx1ZTogewogICAgICAgICAgICAgICAgbG9jYXRpb246IGxvY2F0aW9uLAogICAgICAgICAgICAgICAgbmF2aWdhdGlvblR5cGU6IG5hdmlnYXRpb25UeXBlCiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KSk7CiAgICAgICAgICB9CgogICAgICAgICAgLyoqCiAgICAgICAgICAgKiBBIGNvbnRhaW5lciBmb3IgYSBuZXN0ZWQgdHJlZSBvZiA8Um91dGU+IGVsZW1lbnRzIHRoYXQgcmVuZGVycyB0aGUgYnJhbmNoCiAgICAgICAgICAgKiB0aGF0IGJlc3QgbWF0Y2hlcyB0aGUgY3VycmVudCBsb2NhdGlvbi4KICAgICAgICAgICAqCiAgICAgICAgICAgKiBAc2VlIGh0dHBzOi8vcmVhY3Ryb3V0ZXIuY29tL2RvY3MvZW4vdjYvY29tcG9uZW50cy9yb3V0ZXMKICAgICAgICAgICAqLwogICAgICAgICAgZnVuY3Rpb24gUm91dGVzKF9yZWY1KSB7CiAgICAgICAgICAgIHZhcgogICAgICAgICAgICAgIGNoaWxkcmVuID0KCiAgICAgICAgICAgICAgX3JlZjUuY2hpbGRyZW4sbG9jYXRpb24gPSBfcmVmNS5sb2NhdGlvbjsKICAgICAgICAgICAgdmFyIGRhdGFSb3V0ZXJDb250ZXh0ID0gcmVhY3QudXNlQ29udGV4dChEYXRhUm91dGVyQ29udGV4dCk7IC8vIFdoZW4gaW4gYSBEYXRhUm91dGVyQ29udGV4dCBfd2l0aG91dF8gY2hpbGRyZW4sIHdlIHVzZSB0aGUgcm91dGVyIHJvdXRlcwogICAgICAgICAgICAvLyBkaXJlY3RseS4gIElmIHdlIGhhdmUgY2hpbGRyZW4sIHRoZW4gd2UncmUgaW4gYSBkZXNjZW5kYW50IHRyZWUgYW5kIHdlCiAgICAgICAgICAgIC8vIG5lZWQgdG8gdXNlIGNoaWxkIHJvdXRlcy4KCiAgICAgICAgICAgIHZhciByb3V0ZXMgPSBkYXRhUm91dGVyQ29udGV4dCAmJiAhY2hpbGRyZW4gPyBkYXRhUm91dGVyQ29udGV4dC5yb3V0ZXIucm91dGVzIDogY3JlYXRlUm91dGVzRnJvbUNoaWxkcmVuKGNoaWxkcmVuKTsKICAgICAgICAgICAgcmV0dXJuIHVzZVJvdXRlcyhyb3V0ZXMsIGxvY2F0aW9uKTsKICAgICAgICAgIH0KCiAgICAgICAgICAvKioKICAgICAgICAgICAqIENvbXBvbmVudCB0byB1c2UgZm9yIHJlbmRlcmluZyBsYXppbHkgbG9hZGVkIGRhdGEgZnJvbSByZXR1cm5pbmcgZGVmZXIoKQogICAgICAgICAgICogaW4gYSBsb2FkZXIgZnVuY3Rpb24KICAgICAgICAgICAqLwogICAgICAgICAgZnVuY3Rpb24gQXdhaXQoX3JlZjYpIHsKICAgICAgICAgICAgdmFyCiAgICAgICAgICAgICAgY2hpbGRyZW4gPQoKCiAgICAgICAgICAgICAgX3JlZjYuY2hpbGRyZW4sZXJyb3JFbGVtZW50ID0gX3JlZjYuZXJyb3JFbGVtZW50LHJlc29sdmUgPSBfcmVmNi5yZXNvbHZlOwogICAgICAgICAgICByZXR1cm4gLyojX19QVVJFX18qL1JlYWN0LmNyZWF0ZUVsZW1lbnQoQXdhaXRFcnJvckJvdW5kYXJ5LCB7CiAgICAgICAgICAgICAgcmVzb2x2ZTogcmVzb2x2ZSwKICAgICAgICAgICAgICBlcnJvckVsZW1lbnQ6IGVycm9yRWxlbWVudAogICAgICAgICAgICB9LCAvKiNfX1BVUkVfXyovUmVhY3QuY3JlYXRlRWxlbWVudChSZXNvbHZlQXdhaXQsIG51bGwsIGNoaWxkcmVuKSk7CiAgICAgICAgICB9CiAgICAgICAgICB2YXIgQXdhaXRSZW5kZXJTdGF0dXM7CgogICAgICAgICAgKGZ1bmN0aW9uIChBd2FpdFJlbmRlclN0YXR1cykgewogICAgICAgICAgICBBd2FpdFJlbmRlclN0YXR1c1tBd2FpdFJlbmRlclN0YXR1c1sicGVuZGluZyJdID0gMF0gPSAicGVuZGluZyI7CiAgICAgICAgICAgIEF3YWl0UmVuZGVyU3RhdHVzW0F3YWl0UmVuZGVyU3RhdHVzWyJzdWNjZXNzIl0gPSAxXSA9ICJzdWNjZXNzIjsKICAgICAgICAgICAgQXdhaXRSZW5kZXJTdGF0dXNbQXdhaXRSZW5kZXJTdGF0dXNbImVycm9yIl0gPSAyXSA9ICJlcnJvciI7CiAgICAgICAgICB9KShBd2FpdFJlbmRlclN0YXR1cyB8fCAoQXdhaXRSZW5kZXJTdGF0dXMgPSB7fSkpOwoKICAgICAgICAgIHZhciBuZXZlclNldHRsZWRQcm9taXNlID0gbmV3IFByb21pc2UoKCkgPT4ge30pO3ZhcgoKICAgICAgICAgIEF3YWl0RXJyb3JCb3VuZGFyeSA9IC8qI19fUFVSRV9fKi9mdW5jdGlvbiAoX3JlYWN0JENvbXBvbmVudDIpIHtfaW5oZXJpdHMoQXdhaXRFcnJvckJvdW5kYXJ5LCBfcmVhY3QkQ29tcG9uZW50Mik7dmFyIF9zdXBlcjMgPSBfY3JlYXRlU3VwZXIoQXdhaXRFcnJvckJvdW5kYXJ5KTsKICAgICAgICAgICAgZnVuY3Rpb24gQXdhaXRFcnJvckJvdW5kYXJ5KHByb3BzKSB7dmFyIF90aGlzMjtfY2xhc3NDYWxsQ2hlY2syKHRoaXMsIEF3YWl0RXJyb3JCb3VuZGFyeSk7CiAgICAgICAgICAgICAgX3RoaXMyID0gX3N1cGVyMy5jYWxsKHRoaXMsIHByb3BzKTsKICAgICAgICAgICAgICBfdGhpczIuc3RhdGUgPSB7CiAgICAgICAgICAgICAgICBlcnJvcjogbnVsbAogICAgICAgICAgICAgIH07cmV0dXJuIF90aGlzMjsKICAgICAgICAgICAgfV9jcmVhdGVDbGFzczIoQXdhaXRFcnJvckJvdW5kYXJ5LCBbeyBrZXk6ICJjb21wb25lbnREaWRDYXRjaCIsIHZhbHVlOgoKCgoKCgoKICAgICAgICAgICAgICBmdW5jdGlvbiBjb21wb25lbnREaWRDYXRjaChlcnJvciwgZXJyb3JJbmZvKSB7CiAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKCI8QXdhaXQ+IGNhdWdodCB0aGUgZm9sbG93aW5nIGVycm9yIGR1cmluZyByZW5kZXIiLCBlcnJvciwgZXJyb3JJbmZvKTsKICAgICAgICAgICAgICB9IH0sIHsga2V5OiAicmVuZGVyIiwgdmFsdWU6CgogICAgICAgICAgICAgIGZ1bmN0aW9uIHJlbmRlcigpIHsKICAgICAgICAgICAgICAgIHZhciBfdGhpcyRwcm9wcyA9CgoKCiAgICAgICAgICAgICAgICAgIHRoaXMucHJvcHMsY2hpbGRyZW4gPSBfdGhpcyRwcm9wcy5jaGlsZHJlbixlcnJvckVsZW1lbnQgPSBfdGhpcyRwcm9wcy5lcnJvckVsZW1lbnQscmVzb2x2ZSA9IF90aGlzJHByb3BzLnJlc29sdmU7CiAgICAgICAgICAgICAgICB2YXIgcHJvbWlzZSA9IG51bGw7CiAgICAgICAgICAgICAgICB2YXIgc3RhdHVzID0gQXdhaXRSZW5kZXJTdGF0dXMucGVuZGluZzsKCiAgICAgICAgICAgICAgICBpZiAoIShyZXNvbHZlIGluc3RhbmNlb2YgUHJvbWlzZSkpIHsKICAgICAgICAgICAgICAgICAgLy8gRGlkbid0IGdldCBhIHByb21pc2UgLSBwcm92aWRlIGFzIGEgcmVzb2x2ZWQgcHJvbWlzZQogICAgICAgICAgICAgICAgICBzdGF0dXMgPSBBd2FpdFJlbmRlclN0YXR1cy5zdWNjZXNzOwogICAgICAgICAgICAgICAgICBwcm9taXNlID0gUHJvbWlzZS5yZXNvbHZlKCk7CiAgICAgICAgICAgICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShwcm9taXNlLCAiX3RyYWNrZWQiLCB7CiAgICAgICAgICAgICAgICAgICAgZ2V0OiAoKSA9PiB0cnVlCiAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkocHJvbWlzZSwgIl9kYXRhIiwgewogICAgICAgICAgICAgICAgICAgIGdldDogKCkgPT4gcmVzb2x2ZQogICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAodGhpcy5zdGF0ZS5lcnJvcikgewogICAgICAgICAgICAgICAgICAvLyBDYXVnaHQgYSByZW5kZXIgZXJyb3IsIHByb3ZpZGUgaXQgYXMgYSByZWplY3RlZCBwcm9taXNlCiAgICAgICAgICAgICAgICAgIHN0YXR1cyA9IEF3YWl0UmVuZGVyU3RhdHVzLmVycm9yOwogICAgICAgICAgICAgICAgICB2YXIgcmVuZGVyRXJyb3IgPSB0aGlzLnN0YXRlLmVycm9yOwogICAgICAgICAgICAgICAgICBwcm9taXNlID0gUHJvbWlzZS5yZWplY3QoKS5jYXRjaCgoKSA9PiB7fSk7IC8vIEF2b2lkIHVuaGFuZGxlZCByZWplY3Rpb24gd2FybmluZ3MKCiAgICAgICAgICAgICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShwcm9taXNlLCAiX3RyYWNrZWQiLCB7CiAgICAgICAgICAgICAgICAgICAgZ2V0OiAoKSA9PiB0cnVlCiAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkocHJvbWlzZSwgIl9lcnJvciIsIHsKICAgICAgICAgICAgICAgICAgICBnZXQ6ICgpID0+IHJlbmRlckVycm9yCiAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfSBlbHNlIGlmIChyZXNvbHZlLl90cmFja2VkKSB7CiAgICAgICAgICAgICAgICAgIC8vIEFscmVhZHkgdHJhY2tlZCBwcm9taXNlIC0gY2hlY2sgY29udGVudHMKICAgICAgICAgICAgICAgICAgcHJvbWlzZSA9IHJlc29sdmU7CiAgICAgICAgICAgICAgICAgIHN0YXR1cyA9IHByb21pc2UuX2Vycm9yICE9PSB1bmRlZmluZWQgPyBBd2FpdFJlbmRlclN0YXR1cy5lcnJvciA6IHByb21pc2UuX2RhdGEgIT09IHVuZGVmaW5lZCA/IEF3YWl0UmVuZGVyU3RhdHVzLnN1Y2Nlc3MgOiBBd2FpdFJlbmRlclN0YXR1cy5wZW5kaW5nOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgLy8gUmF3ICh1bnRyYWNrZWQpIHByb21pc2UgLSB0cmFjayBpdAogICAgICAgICAgICAgICAgICBzdGF0dXMgPSBBd2FpdFJlbmRlclN0YXR1cy5wZW5kaW5nOwogICAgICAgICAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkocmVzb2x2ZSwgIl90cmFja2VkIiwgewogICAgICAgICAgICAgICAgICAgIGdldDogKCkgPT4gdHJ1ZQogICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgcHJvbWlzZSA9IHJlc29sdmUudGhlbigoZGF0YSkgPT4gT2JqZWN0LmRlZmluZVByb3BlcnR5KHJlc29sdmUsICJfZGF0YSIsIHsKICAgICAgICAgICAgICAgICAgICBnZXQ6ICgpID0+IGRhdGEKICAgICAgICAgICAgICAgICAgfSksIChlcnJvcikgPT4gT2JqZWN0LmRlZmluZVByb3BlcnR5KHJlc29sdmUsICJfZXJyb3IiLCB7CiAgICAgICAgICAgICAgICAgICAgZ2V0OiAoKSA9PiBlcnJvcgogICAgICAgICAgICAgICAgICB9KSk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgaWYgKHN0YXR1cyA9PT0gQXdhaXRSZW5kZXJTdGF0dXMuZXJyb3IgJiYgcHJvbWlzZS5fZXJyb3IgaW5zdGFuY2VvZiBBYm9ydGVkRGVmZXJyZWRFcnJvcikgewogICAgICAgICAgICAgICAgICAvLyBGcmVlemUgdGhlIFVJIGJ5IHRocm93aW5nIGEgbmV2ZXIgcmVzb2x2ZWQgcHJvbWlzZQogICAgICAgICAgICAgICAgICB0aHJvdyBuZXZlclNldHRsZWRQcm9taXNlOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGlmIChzdGF0dXMgPT09IEF3YWl0UmVuZGVyU3RhdHVzLmVycm9yICYmICFlcnJvckVsZW1lbnQpIHsKICAgICAgICAgICAgICAgICAgLy8gTm8gZXJyb3JFbGVtZW50LCB0aHJvdyB0byB0aGUgbmVhcmVzdCByb3V0ZS1sZXZlbCBlcnJvciBib3VuZGFyeQogICAgICAgICAgICAgICAgICB0aHJvdyBwcm9taXNlLl9lcnJvcjsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBpZiAoc3RhdHVzID09PSBBd2FpdFJlbmRlclN0YXR1cy5lcnJvcikgewogICAgICAgICAgICAgICAgICAvLyBSZW5kZXIgdmlhIG91ciBlcnJvckVsZW1lbnQKICAgICAgICAgICAgICAgICAgcmV0dXJuIC8qI19fUFVSRV9fKi9SZWFjdC5jcmVhdGVFbGVtZW50KEF3YWl0Q29udGV4dC5Qcm92aWRlciwgewogICAgICAgICAgICAgICAgICAgIHZhbHVlOiBwcm9taXNlLAogICAgICAgICAgICAgICAgICAgIGNoaWxkcmVuOiBlcnJvckVsZW1lbnQKICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgaWYgKHN0YXR1cyA9PT0gQXdhaXRSZW5kZXJTdGF0dXMuc3VjY2VzcykgewogICAgICAgICAgICAgICAgICAvLyBSZW5kZXIgY2hpbGRyZW4gd2l0aCByZXNvbHZlZCB2YWx1ZQogICAgICAgICAgICAgICAgICByZXR1cm4gLyojX19QVVJFX18qL1JlYWN0LmNyZWF0ZUVsZW1lbnQoQXdhaXRDb250ZXh0LlByb3ZpZGVyLCB7CiAgICAgICAgICAgICAgICAgICAgdmFsdWU6IHByb21pc2UsCiAgICAgICAgICAgICAgICAgICAgY2hpbGRyZW46IGNoaWxkcmVuCiAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfSAvLyBUaHJvdyB0byB0aGUgc3VzcGVuc2UgYm91bmRhcnkKCgogICAgICAgICAgICAgICAgdGhyb3cgcHJvbWlzZTsKICAgICAgICAgICAgICB9IH1dLCBbeyBrZXk6ICJnZXREZXJpdmVkU3RhdGVGcm9tRXJyb3IiLCB2YWx1ZTogZnVuY3Rpb24gZ2V0RGVyaXZlZFN0YXRlRnJvbUVycm9yKGVycm9yKSB7cmV0dXJuIHsgZXJyb3I6IGVycm9yIH07fSB9XSk7cmV0dXJuIEF3YWl0RXJyb3JCb3VuZGFyeTt9KHJlYWN0LkNvbXBvbmVudCk7CgoKICAgICAgICAgIC8qKgogICAgICAgICAgICogQHByaXZhdGUKICAgICAgICAgICAqIEluZGlyZWN0aW9uIHRvIGxldmVyYWdlIHVzZUFzeW5jVmFsdWUgZm9yIGEgcmVuZGVyLXByb3AgQVBJIG9uIDxBd2FpdD4KICAgICAgICAgICAqLwoKCiAgICAgICAgICBmdW5jdGlvbiBSZXNvbHZlQXdhaXQoX3JlZjcpIHsKICAgICAgICAgICAgdmFyCiAgICAgICAgICAgIGNoaWxkcmVuID0KICAgICAgICAgICAgX3JlZjcuY2hpbGRyZW47CiAgICAgICAgICAgIHZhciBkYXRhID0gdXNlQXN5bmNWYWx1ZSgpOwoKICAgICAgICAgICAgaWYgKHR5cGVvZiBjaGlsZHJlbiA9PT0gImZ1bmN0aW9uIikgewogICAgICAgICAgICAgIHJldHVybiBjaGlsZHJlbihkYXRhKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuIC8qI19fUFVSRV9fKi9SZWFjdC5jcmVhdGVFbGVtZW50KFJlYWN0LkZyYWdtZW50LCBudWxsLCBjaGlsZHJlbik7CiAgICAgICAgICB9IC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KICAgICAgICAgIC8vIFVUSUxTCiAgICAgICAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCgogICAgICAgICAgLyoqCiAgICAgICAgICAgKiBDcmVhdGVzIGEgcm91dGUgY29uZmlnIGZyb20gYSBSZWFjdCAiY2hpbGRyZW4iIG9iamVjdCwgd2hpY2ggaXMgdXN1YWxseQogICAgICAgICAgICogZWl0aGVyIGEgYDxSb3V0ZT5gIGVsZW1lbnQgb3IgYW4gYXJyYXkgb2YgdGhlbS4gVXNlZCBpbnRlcm5hbGx5IGJ5CiAgICAgICAgICAgKiBgPFJvdXRlcz5gIHRvIGNyZWF0ZSBhIHJvdXRlIGNvbmZpZyBmcm9tIGl0cyBjaGlsZHJlbi4KICAgICAgICAgICAqCiAgICAgICAgICAgKiBAc2VlIGh0dHBzOi8vcmVhY3Ryb3V0ZXIuY29tL2RvY3MvZW4vdjYvdXRpbHMvY3JlYXRlLXJvdXRlcy1mcm9tLWNoaWxkcmVuCiAgICAgICAgICAgKi8KCgogICAgICAgICAgZnVuY3Rpb24gY3JlYXRlUm91dGVzRnJvbUNoaWxkcmVuKGNoaWxkcmVuLCBwYXJlbnRQYXRoKSB7CiAgICAgICAgICAgIGlmIChwYXJlbnRQYXRoID09PSB2b2lkIDApIHsKICAgICAgICAgICAgICBwYXJlbnRQYXRoID0gW107CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHZhciByb3V0ZXMgPSBbXTsKICAgICAgICAgICAgcmVhY3QuQ2hpbGRyZW4uZm9yRWFjaChjaGlsZHJlbiwgKGVsZW1lbnQsIGluZGV4KSA9PiB7CiAgICAgICAgICAgICAgaWYgKCEgLyojX19QVVJFX18qL3JlYWN0LmlzVmFsaWRFbGVtZW50KGVsZW1lbnQpKSB7CiAgICAgICAgICAgICAgICAvLyBJZ25vcmUgbm9uLWVsZW1lbnRzLiBUaGlzIGFsbG93cyBwZW9wbGUgdG8gbW9yZSBlYXNpbHkgaW5saW5lCiAgICAgICAgICAgICAgICAvLyBjb25kaXRpb25hbHMgaW4gdGhlaXIgcm91dGUgY29uZmlnLgogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgaWYgKGVsZW1lbnQudHlwZSA9PT0gcmVhY3QuRnJhZ21lbnQpIHsKICAgICAgICAgICAgICAgIC8vIFRyYW5zcGFyZW50bHkgc3VwcG9ydCBSZWFjdC5GcmFnbWVudCBhbmQgaXRzIGNoaWxkcmVuLgogICAgICAgICAgICAgICAgcm91dGVzLnB1c2guYXBwbHkocm91dGVzLCBjcmVhdGVSb3V0ZXNGcm9tQ2hpbGRyZW4oZWxlbWVudC5wcm9wcy5jaGlsZHJlbiwgcGFyZW50UGF0aCkpOwogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgIShlbGVtZW50LnR5cGUgPT09IFJvdXRlKSA/IGZhbHNlID8gMCA6IHJvdXRlcl9pbnZhcmlhbnQoZmFsc2UpIDogdm9pZCAwOwogICAgICAgICAgICAgICEoIWVsZW1lbnQucHJvcHMuaW5kZXggfHwgIWVsZW1lbnQucHJvcHMuY2hpbGRyZW4pID8gZmFsc2UgPyAwIDogcm91dGVyX2ludmFyaWFudChmYWxzZSkgOiB2b2lkIDA7CiAgICAgICAgICAgICAgdmFyIHRyZWVQYXRoID0gW10uY29uY2F0KF90b0NvbnN1bWFibGVBcnJheTIocGFyZW50UGF0aCksIFtpbmRleF0pOwogICAgICAgICAgICAgIHZhciByb3V0ZSA9IHsKICAgICAgICAgICAgICAgIGlkOiBlbGVtZW50LnByb3BzLmlkIHx8IHRyZWVQYXRoLmpvaW4oIi0iKSwKICAgICAgICAgICAgICAgIGNhc2VTZW5zaXRpdmU6IGVsZW1lbnQucHJvcHMuY2FzZVNlbnNpdGl2ZSwKICAgICAgICAgICAgICAgIGVsZW1lbnQ6IGVsZW1lbnQucHJvcHMuZWxlbWVudCwKICAgICAgICAgICAgICAgIGluZGV4OiBlbGVtZW50LnByb3BzLmluZGV4LAogICAgICAgICAgICAgICAgcGF0aDogZWxlbWVudC5wcm9wcy5wYXRoLAogICAgICAgICAgICAgICAgbG9hZGVyOiBlbGVtZW50LnByb3BzLmxvYWRlciwKICAgICAgICAgICAgICAgIGFjdGlvbjogZWxlbWVudC5wcm9wcy5hY3Rpb24sCiAgICAgICAgICAgICAgICBlcnJvckVsZW1lbnQ6IGVsZW1lbnQucHJvcHMuZXJyb3JFbGVtZW50LAogICAgICAgICAgICAgICAgaGFzRXJyb3JCb3VuZGFyeTogZWxlbWVudC5wcm9wcy5lcnJvckVsZW1lbnQgIT0gbnVsbCwKICAgICAgICAgICAgICAgIHNob3VsZFJldmFsaWRhdGU6IGVsZW1lbnQucHJvcHMuc2hvdWxkUmV2YWxpZGF0ZSwKICAgICAgICAgICAgICAgIGhhbmRsZTogZWxlbWVudC5wcm9wcy5oYW5kbGUKICAgICAgICAgICAgICB9OwoKICAgICAgICAgICAgICBpZiAoZWxlbWVudC5wcm9wcy5jaGlsZHJlbikgewogICAgICAgICAgICAgICAgcm91dGUuY2hpbGRyZW4gPSBjcmVhdGVSb3V0ZXNGcm9tQ2hpbGRyZW4oZWxlbWVudC5wcm9wcy5jaGlsZHJlbiwgdHJlZVBhdGgpOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgcm91dGVzLnB1c2gocm91dGUpOwogICAgICAgICAgICB9KTsKICAgICAgICAgICAgcmV0dXJuIHJvdXRlczsKICAgICAgICAgIH0KICAgICAgICAgIC8qKgogICAgICAgICAgICogUmVuZGVycyB0aGUgcmVzdWx0IG9mIGBtYXRjaFJvdXRlcygpYCBpbnRvIGEgUmVhY3QgZWxlbWVudC4KICAgICAgICAgICAqLwoKICAgICAgICAgIGZ1bmN0aW9uIHJlbmRlck1hdGNoZXMobWF0Y2hlcykgewogICAgICAgICAgICByZXR1cm4gX3JlbmRlck1hdGNoZXMobWF0Y2hlcyk7CiAgICAgICAgICB9CiAgICAgICAgICAvKioKICAgICAgICAgICAqIEBwcml2YXRlCiAgICAgICAgICAgKiBXYWxrIHRoZSByb3V0ZSB0cmVlIGFuZCBhZGQgaGFzRXJyb3JCb3VuZGFyeSBpZiBpdCdzIG5vdCBwcm92aWRlZCwgc28gdGhhdAogICAgICAgICAgICogdXNlcnMgcHJvdmlkaW5nIG1hbnVhbCByb3V0ZSBhcnJheXMgY2FuIGp1c3Qgc3BlY2lmeSBlcnJvckVsZW1lbnQKICAgICAgICAgICAqLwoKICAgICAgICAgIGZ1bmN0aW9uIGVuaGFuY2VNYW51YWxSb3V0ZU9iamVjdHMocm91dGVzKSB7CiAgICAgICAgICAgIHJldHVybiByb3V0ZXMubWFwKChyb3V0ZSkgPT4gewogICAgICAgICAgICAgIHZhciByb3V0ZUNsb25lID0gZGlzdF9leHRlbmRzKHt9LCByb3V0ZSk7CgogICAgICAgICAgICAgIGlmIChyb3V0ZUNsb25lLmhhc0Vycm9yQm91bmRhcnkgPT0gbnVsbCkgewogICAgICAgICAgICAgICAgcm91dGVDbG9uZS5oYXNFcnJvckJvdW5kYXJ5ID0gcm91dGVDbG9uZS5lcnJvckVsZW1lbnQgIT0gbnVsbDsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIGlmIChyb3V0ZUNsb25lLmNoaWxkcmVuKSB7CiAgICAgICAgICAgICAgICByb3V0ZUNsb25lLmNoaWxkcmVuID0gZW5oYW5jZU1hbnVhbFJvdXRlT2JqZWN0cyhyb3V0ZUNsb25lLmNoaWxkcmVuKTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIHJldHVybiByb3V0ZUNsb25lOwogICAgICAgICAgICB9KTsKICAgICAgICAgIH0KCiAgICAgICAgICBmdW5jdGlvbiBjcmVhdGVNZW1vcnlSb3V0ZXIocm91dGVzLCBvcHRzKSB7CiAgICAgICAgICAgIHJldHVybiBjcmVhdGVSb3V0ZXIoewogICAgICAgICAgICAgIGJhc2VuYW1lOiBvcHRzID09IG51bGwgPyB2b2lkIDAgOiBvcHRzLmJhc2VuYW1lLAogICAgICAgICAgICAgIGhpc3Rvcnk6IGNyZWF0ZU1lbW9yeUhpc3RvcnkoewogICAgICAgICAgICAgICAgaW5pdGlhbEVudHJpZXM6IG9wdHMgPT0gbnVsbCA/IHZvaWQgMCA6IG9wdHMuaW5pdGlhbEVudHJpZXMsCiAgICAgICAgICAgICAgICBpbml0aWFsSW5kZXg6IG9wdHMgPT0gbnVsbCA/IHZvaWQgMCA6IG9wdHMuaW5pdGlhbEluZGV4CiAgICAgICAgICAgICAgfSksCiAgICAgICAgICAgICAgaHlkcmF0aW9uRGF0YTogb3B0cyA9PSBudWxsID8gdm9pZCAwIDogb3B0cy5oeWRyYXRpb25EYXRhLAogICAgICAgICAgICAgIHJvdXRlczogZW5oYW5jZU1hbnVhbFJvdXRlT2JqZWN0cyhyb3V0ZXMpCiAgICAgICAgICAgIH0pLmluaXRpYWxpemUoKTsKICAgICAgICAgIH0gLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwoKCgoKICAgICAgICAgIDsgLy8gQ09OQ0FURU5BVEVEIE1PRFVMRTogLi9ub2RlX21vZHVsZXMvcmVhY3Qtcm91dGVyLWRvbS9kaXN0L2luZGV4LmpzCiAgICAgICAgICAvKioKICAgICAgICAgICAqIFJlYWN0IFJvdXRlciBET00gdjYuNC40CiAgICAgICAgICAgKgogICAgICAgICAgICogQ29weXJpZ2h0IChjKSBSZW1peCBTb2Z0d2FyZSBJbmMuCiAgICAgICAgICAgKgogICAgICAgICAgICogVGhpcyBzb3VyY2UgY29kZSBpcyBsaWNlbnNlZCB1bmRlciB0aGUgTUlUIGxpY2Vuc2UgZm91bmQgaW4gdGhlCiAgICAgICAgICAgKiBMSUNFTlNFLm1kIGZpbGUgaW4gdGhlIHJvb3QgZGlyZWN0b3J5IG9mIHRoaXMgc291cmNlIHRyZWUuCiAgICAgICAgICAgKgogICAgICAgICAgICogQGxpY2Vuc2UgTUlUCiAgICAgICAgICAgKi8KCgoKCgogICAgICAgICAgZnVuY3Rpb24gcmVhY3Rfcm91dGVyX2RvbV9kaXN0X2V4dGVuZHMoKSB7CiAgICAgICAgICAgIHJlYWN0X3JvdXRlcl9kb21fZGlzdF9leHRlbmRzID0gT2JqZWN0LmFzc2lnbiA/IE9iamVjdC5hc3NpZ24uYmluZCgpIDogZnVuY3Rpb24gKHRhcmdldCkgewogICAgICAgICAgICAgIGZvciAodmFyIGkgPSAxOyBpIDwgYXJndW1lbnRzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAgICB2YXIgc291cmNlID0gYXJndW1lbnRzW2ldOwoKICAgICAgICAgICAgICAgIGZvciAodmFyIGtleSBpbiBzb3VyY2UpIHsKICAgICAgICAgICAgICAgICAgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChzb3VyY2UsIGtleSkpIHsKICAgICAgICAgICAgICAgICAgICB0YXJnZXRba2V5XSA9IHNvdXJjZVtrZXldOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICByZXR1cm4gdGFyZ2V0OwogICAgICAgICAgICB9OwogICAgICAgICAgICByZXR1cm4gcmVhY3Rfcm91dGVyX2RvbV9kaXN0X2V4dGVuZHMuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgICAgIH0KCiAgICAgICAgICBmdW5jdGlvbiBfb2JqZWN0V2l0aG91dFByb3BlcnRpZXNMb29zZShzb3VyY2UsIGV4Y2x1ZGVkKSB7CiAgICAgICAgICAgIGlmIChzb3VyY2UgPT0gbnVsbCkgcmV0dXJuIHt9OwogICAgICAgICAgICB2YXIgdGFyZ2V0ID0ge307CiAgICAgICAgICAgIHZhciBzb3VyY2VLZXlzID0gT2JqZWN0LmtleXMoc291cmNlKTsKICAgICAgICAgICAgdmFyIGtleSwgaTsKCiAgICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCBzb3VyY2VLZXlzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAga2V5ID0gc291cmNlS2V5c1tpXTsKICAgICAgICAgICAgICBpZiAoZXhjbHVkZWQuaW5kZXhPZihrZXkpID49IDApIGNvbnRpbnVlOwogICAgICAgICAgICAgIHRhcmdldFtrZXldID0gc291cmNlW2tleV07CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybiB0YXJnZXQ7CiAgICAgICAgICB9CgogICAgICAgICAgdmFyIGRlZmF1bHRNZXRob2QgPSAiZ2V0IjsKICAgICAgICAgIHZhciBkZWZhdWx0RW5jVHlwZSA9ICJhcHBsaWNhdGlvbi94LXd3dy1mb3JtLXVybGVuY29kZWQiOwogICAgICAgICAgZnVuY3Rpb24gaXNIdG1sRWxlbWVudChvYmplY3QpIHsKICAgICAgICAgICAgcmV0dXJuIG9iamVjdCAhPSBudWxsICYmIHR5cGVvZiBvYmplY3QudGFnTmFtZSA9PT0gInN0cmluZyI7CiAgICAgICAgICB9CiAgICAgICAgICBmdW5jdGlvbiBpc0J1dHRvbkVsZW1lbnQob2JqZWN0KSB7CiAgICAgICAgICAgIHJldHVybiBpc0h0bWxFbGVtZW50KG9iamVjdCkgJiYgb2JqZWN0LnRhZ05hbWUudG9Mb3dlckNhc2UoKSA9PT0gImJ1dHRvbiI7CiAgICAgICAgICB9CiAgICAgICAgICBmdW5jdGlvbiBpc0Zvcm1FbGVtZW50KG9iamVjdCkgewogICAgICAgICAgICByZXR1cm4gaXNIdG1sRWxlbWVudChvYmplY3QpICYmIG9iamVjdC50YWdOYW1lLnRvTG93ZXJDYXNlKCkgPT09ICJmb3JtIjsKICAgICAgICAgIH0KICAgICAgICAgIGZ1bmN0aW9uIGlzSW5wdXRFbGVtZW50KG9iamVjdCkgewogICAgICAgICAgICByZXR1cm4gaXNIdG1sRWxlbWVudChvYmplY3QpICYmIG9iamVjdC50YWdOYW1lLnRvTG93ZXJDYXNlKCkgPT09ICJpbnB1dCI7CiAgICAgICAgICB9CgogICAgICAgICAgZnVuY3Rpb24gaXNNb2RpZmllZEV2ZW50KGV2ZW50KSB7CiAgICAgICAgICAgIHJldHVybiAhIShldmVudC5tZXRhS2V5IHx8IGV2ZW50LmFsdEtleSB8fCBldmVudC5jdHJsS2V5IHx8IGV2ZW50LnNoaWZ0S2V5KTsKICAgICAgICAgIH0KCiAgICAgICAgICBmdW5jdGlvbiBzaG91bGRQcm9jZXNzTGlua0NsaWNrKGV2ZW50LCB0YXJnZXQpIHsKICAgICAgICAgICAgcmV0dXJuIGV2ZW50LmJ1dHRvbiA9PT0gMCAmJiAoIC8vIElnbm9yZSBldmVyeXRoaW5nIGJ1dCBsZWZ0IGNsaWNrcwogICAgICAgICAgICAhdGFyZ2V0IHx8IHRhcmdldCA9PT0gIl9zZWxmIikgJiYgLy8gTGV0IGJyb3dzZXIgaGFuZGxlICJ0YXJnZXQ9X2JsYW5rIiBldGMuCiAgICAgICAgICAgICFpc01vZGlmaWVkRXZlbnQoZXZlbnQpIC8vIElnbm9yZSBjbGlja3Mgd2l0aCBtb2RpZmllciBrZXlzCiAgICAgICAgICAgIDsKICAgICAgICAgIH0KICAgICAgICAgIC8qKgogICAgICAgICAgICogQ3JlYXRlcyBhIFVSTFNlYXJjaFBhcmFtcyBvYmplY3QgdXNpbmcgdGhlIGdpdmVuIGluaXRpYWxpemVyLgogICAgICAgICAgICoKICAgICAgICAgICAqIFRoaXMgaXMgaWRlbnRpY2FsIHRvIGBuZXcgVVJMU2VhcmNoUGFyYW1zKGluaXQpYCBleGNlcHQgaXQgYWxzbwogICAgICAgICAgICogc3VwcG9ydHMgYXJyYXlzIGFzIHZhbHVlcyBpbiB0aGUgb2JqZWN0IGZvcm0gb2YgdGhlIGluaXRpYWxpemVyCiAgICAgICAgICAgKiBpbnN0ZWFkIG9mIGp1c3Qgc3RyaW5ncy4gVGhpcyBpcyBjb252ZW5pZW50IHdoZW4geW91IG5lZWQgbXVsdGlwbGUKICAgICAgICAgICAqIHZhbHVlcyBmb3IgYSBnaXZlbiBrZXksIGJ1dCBkb24ndCB3YW50IHRvIHVzZSBhbiBhcnJheSBpbml0aWFsaXplci4KICAgICAgICAgICAqCiAgICAgICAgICAgKiBGb3IgZXhhbXBsZSwgaW5zdGVhZCBvZjoKICAgICAgICAgICAqCiAgICAgICAgICAgKiAgIGxldCBzZWFyY2hQYXJhbXMgPSBuZXcgVVJMU2VhcmNoUGFyYW1zKFsKICAgICAgICAgICAqICAgICBbJ3NvcnQnLCAnbmFtZSddLAogICAgICAgICAgICogICAgIFsnc29ydCcsICdwcmljZSddCiAgICAgICAgICAgKiAgIF0pOwogICAgICAgICAgICoKICAgICAgICAgICAqIHlvdSBjYW4gZG86CiAgICAgICAgICAgKgogICAgICAgICAgICogICBsZXQgc2VhcmNoUGFyYW1zID0gY3JlYXRlU2VhcmNoUGFyYW1zKHsKICAgICAgICAgICAqICAgICBzb3J0OiBbJ25hbWUnLCAncHJpY2UnXQogICAgICAgICAgICogICB9KTsKICAgICAgICAgICAqLwoKICAgICAgICAgIGZ1bmN0aW9uIGNyZWF0ZVNlYXJjaFBhcmFtcyhpbml0KSB7CiAgICAgICAgICAgIGlmIChpbml0ID09PSB2b2lkIDApIHsKICAgICAgICAgICAgICBpbml0ID0gIiI7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybiBuZXcgVVJMU2VhcmNoUGFyYW1zKHR5cGVvZiBpbml0ID09PSAic3RyaW5nIiB8fCBBcnJheS5pc0FycmF5KGluaXQpIHx8IGluaXQgaW5zdGFuY2VvZiBVUkxTZWFyY2hQYXJhbXMgPyBpbml0IDogT2JqZWN0LmtleXMoaW5pdCkucmVkdWNlKChtZW1vLCBrZXkpID0+IHsKICAgICAgICAgICAgICB2YXIgdmFsdWUgPSBpbml0W2tleV07CiAgICAgICAgICAgICAgcmV0dXJuIG1lbW8uY29uY2F0KEFycmF5LmlzQXJyYXkodmFsdWUpID8gdmFsdWUubWFwKCh2KSA9PiBba2V5LCB2XSkgOiBbW2tleSwgdmFsdWVdXSk7CiAgICAgICAgICAgIH0sIFtdKSk7CiAgICAgICAgICB9CiAgICAgICAgICBmdW5jdGlvbiBnZXRTZWFyY2hQYXJhbXNGb3JMb2NhdGlvbihsb2NhdGlvblNlYXJjaCwgZGVmYXVsdFNlYXJjaFBhcmFtcykgewogICAgICAgICAgICB2YXIgc2VhcmNoUGFyYW1zID0gY3JlYXRlU2VhcmNoUGFyYW1zKGxvY2F0aW9uU2VhcmNoKTt2YXIgX2l0ZXJhdG9yNyA9IF9jcmVhdGVGb3JPZkl0ZXJhdG9ySGVscGVyMigKCiAgICAgICAgICAgICAgZGVmYXVsdFNlYXJjaFBhcmFtcy5rZXlzKCkpLF9zdGVwNzt0cnkge3ZhciBfbG9vcCA9IGZ1bmN0aW9uIF9sb29wKCkge3ZhciBrZXkgPSBfc3RlcDcudmFsdWU7CiAgICAgICAgICAgICAgICBpZiAoIXNlYXJjaFBhcmFtcy5oYXMoa2V5KSkgewogICAgICAgICAgICAgICAgICBkZWZhdWx0U2VhcmNoUGFyYW1zLmdldEFsbChrZXkpLmZvckVhY2goKHZhbHVlKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgc2VhcmNoUGFyYW1zLmFwcGVuZChrZXksIHZhbHVlKTsKICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9fTtmb3IgKF9pdGVyYXRvcjcucygpOyAhKF9zdGVwNyA9IF9pdGVyYXRvcjcubigpKS5kb25lOykge19sb29wKCk7CiAgICAgICAgICAgICAgfX0gY2F0Y2ggKGVycikge19pdGVyYXRvcjcuZShlcnIpO30gZmluYWxseSB7X2l0ZXJhdG9yNy5mKCk7fQoKICAgICAgICAgICAgcmV0dXJuIHNlYXJjaFBhcmFtczsKICAgICAgICAgIH0KICAgICAgICAgIGZ1bmN0aW9uIGdldEZvcm1TdWJtaXNzaW9uSW5mbyh0YXJnZXQsIGRlZmF1bHRBY3Rpb24sIG9wdGlvbnMpIHsKICAgICAgICAgICAgdmFyIG1ldGhvZDsKICAgICAgICAgICAgdmFyIGFjdGlvbjsKICAgICAgICAgICAgdmFyIGVuY1R5cGU7CiAgICAgICAgICAgIHZhciBmb3JtRGF0YTsKCiAgICAgICAgICAgIGlmIChpc0Zvcm1FbGVtZW50KHRhcmdldCkpIHsKICAgICAgICAgICAgICB2YXIgc3VibWlzc2lvblRyaWdnZXIgPSBvcHRpb25zLnN1Ym1pc3Npb25UcmlnZ2VyOwogICAgICAgICAgICAgIG1ldGhvZCA9IG9wdGlvbnMubWV0aG9kIHx8IHRhcmdldC5nZXRBdHRyaWJ1dGUoIm1ldGhvZCIpIHx8IGRlZmF1bHRNZXRob2Q7CiAgICAgICAgICAgICAgYWN0aW9uID0gb3B0aW9ucy5hY3Rpb24gfHwgdGFyZ2V0LmdldEF0dHJpYnV0ZSgiYWN0aW9uIikgfHwgZGVmYXVsdEFjdGlvbjsKICAgICAgICAgICAgICBlbmNUeXBlID0gb3B0aW9ucy5lbmNUeXBlIHx8IHRhcmdldC5nZXRBdHRyaWJ1dGUoImVuY3R5cGUiKSB8fCBkZWZhdWx0RW5jVHlwZTsKICAgICAgICAgICAgICBmb3JtRGF0YSA9IG5ldyBGb3JtRGF0YSh0YXJnZXQpOwoKICAgICAgICAgICAgICBpZiAoc3VibWlzc2lvblRyaWdnZXIgJiYgc3VibWlzc2lvblRyaWdnZXIubmFtZSkgewogICAgICAgICAgICAgICAgZm9ybURhdGEuYXBwZW5kKHN1Ym1pc3Npb25UcmlnZ2VyLm5hbWUsIHN1Ym1pc3Npb25UcmlnZ2VyLnZhbHVlKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZWxzZSBpZiAoaXNCdXR0b25FbGVtZW50KHRhcmdldCkgfHwgaXNJbnB1dEVsZW1lbnQodGFyZ2V0KSAmJiAodGFyZ2V0LnR5cGUgPT09ICJzdWJtaXQiIHx8IHRhcmdldC50eXBlID09PSAiaW1hZ2UiKSkgewogICAgICAgICAgICAgIHZhciBmb3JtID0gdGFyZ2V0LmZvcm07CgogICAgICAgICAgICAgIGlmIChmb3JtID09IG51bGwpIHsKICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiQ2Fubm90IHN1Ym1pdCBhIDxidXR0b24+IG9yIDxpbnB1dCB0eXBlPVwic3VibWl0XCI+IHdpdGhvdXQgYSA8Zm9ybT4iKTsKICAgICAgICAgICAgICB9IC8vIDxidXR0b24+LzxpbnB1dCB0eXBlPSJzdWJtaXQiPiBtYXkgb3ZlcnJpZGUgYXR0cmlidXRlcyBvZiA8Zm9ybT4KCgogICAgICAgICAgICAgIG1ldGhvZCA9IG9wdGlvbnMubWV0aG9kIHx8IHRhcmdldC5nZXRBdHRyaWJ1dGUoImZvcm1tZXRob2QiKSB8fCBmb3JtLmdldEF0dHJpYnV0ZSgibWV0aG9kIikgfHwgZGVmYXVsdE1ldGhvZDsKICAgICAgICAgICAgICBhY3Rpb24gPSBvcHRpb25zLmFjdGlvbiB8fCB0YXJnZXQuZ2V0QXR0cmlidXRlKCJmb3JtYWN0aW9uIikgfHwgZm9ybS5nZXRBdHRyaWJ1dGUoImFjdGlvbiIpIHx8IGRlZmF1bHRBY3Rpb247CiAgICAgICAgICAgICAgZW5jVHlwZSA9IG9wdGlvbnMuZW5jVHlwZSB8fCB0YXJnZXQuZ2V0QXR0cmlidXRlKCJmb3JtZW5jdHlwZSIpIHx8IGZvcm0uZ2V0QXR0cmlidXRlKCJlbmN0eXBlIikgfHwgZGVmYXVsdEVuY1R5cGU7CiAgICAgICAgICAgICAgZm9ybURhdGEgPSBuZXcgRm9ybURhdGEoZm9ybSk7IC8vIEluY2x1ZGUgbmFtZSArIHZhbHVlIGZyb20gYSA8YnV0dG9uPiwgYXBwZW5kaW5nIGluIGNhc2UgdGhlIGJ1dHRvbiBuYW1lCiAgICAgICAgICAgICAgLy8gbWF0Y2hlcyBhbiBleGlzdGluZyBpbnB1dCBuYW1lCgogICAgICAgICAgICAgIGlmICh0YXJnZXQubmFtZSkgewogICAgICAgICAgICAgICAgZm9ybURhdGEuYXBwZW5kKHRhcmdldC5uYW1lLCB0YXJnZXQudmFsdWUpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBlbHNlIGlmIChpc0h0bWxFbGVtZW50KHRhcmdldCkpIHsKICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIkNhbm5vdCBzdWJtaXQgZWxlbWVudCB0aGF0IGlzIG5vdCA8Zm9ybT4sIDxidXR0b24+LCBvciAiICsgIjxpbnB1dCB0eXBlPVwic3VibWl0fGltYWdlXCI+Iik7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgbWV0aG9kID0gb3B0aW9ucy5tZXRob2QgfHwgZGVmYXVsdE1ldGhvZDsKICAgICAgICAgICAgICBhY3Rpb24gPSBvcHRpb25zLmFjdGlvbiB8fCBkZWZhdWx0QWN0aW9uOwogICAgICAgICAgICAgIGVuY1R5cGUgPSBvcHRpb25zLmVuY1R5cGUgfHwgZGVmYXVsdEVuY1R5cGU7CgogICAgICAgICAgICAgIGlmICh0YXJnZXQgaW5zdGFuY2VvZiBGb3JtRGF0YSkgewogICAgICAgICAgICAgICAgZm9ybURhdGEgPSB0YXJnZXQ7CiAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGZvcm1EYXRhID0gbmV3IEZvcm1EYXRhKCk7CgogICAgICAgICAgICAgICAgaWYgKHRhcmdldCBpbnN0YW5jZW9mIFVSTFNlYXJjaFBhcmFtcykge3ZhciBfaXRlcmF0b3I4ID0gX2NyZWF0ZUZvck9mSXRlcmF0b3JIZWxwZXIyKAogICAgICAgICAgICAgICAgICAgIHRhcmdldCksX3N0ZXA4O3RyeSB7Zm9yIChfaXRlcmF0b3I4LnMoKTsgIShfc3RlcDggPSBfaXRlcmF0b3I4Lm4oKSkuZG9uZTspIHt2YXIgX3N0ZXA4JHZhbHVlID0gX3NsaWNlZFRvQXJyYXkyKF9zdGVwOC52YWx1ZSwgMiksbmFtZSA9IF9zdGVwOCR2YWx1ZVswXSx2YWx1ZSA9IF9zdGVwOCR2YWx1ZVsxXTsKICAgICAgICAgICAgICAgICAgICAgIGZvcm1EYXRhLmFwcGVuZChuYW1lLCB2YWx1ZSk7CiAgICAgICAgICAgICAgICAgICAgfX0gY2F0Y2ggKGVycikge19pdGVyYXRvcjguZShlcnIpO30gZmluYWxseSB7X2l0ZXJhdG9yOC5mKCk7fQogICAgICAgICAgICAgICAgfSBlbHNlIGlmICh0YXJnZXQgIT0gbnVsbCkgewogICAgICAgICAgICAgICAgICBmb3IgKHZhciBfaTIgPSAwLCBfT2JqZWN0JGtleXMgPSBPYmplY3Qua2V5cyh0YXJnZXQpOyBfaTIgPCBfT2JqZWN0JGtleXMubGVuZ3RoOyBfaTIrKykge3ZhciBfbmFtZSA9IF9PYmplY3Qka2V5c1tfaTJdOwogICAgICAgICAgICAgICAgICAgIGZvcm1EYXRhLmFwcGVuZChfbmFtZSwgdGFyZ2V0W19uYW1lXSk7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHZhciBfd2luZG93JGxvY2F0aW9uMiA9CgoKICAgICAgICAgICAgICB3aW5kb3cubG9jYXRpb24scHJvdG9jb2wgPSBfd2luZG93JGxvY2F0aW9uMi5wcm90b2NvbCxob3N0ID0gX3dpbmRvdyRsb2NhdGlvbjIuaG9zdDsKICAgICAgICAgICAgdmFyIHVybCA9IG5ldyBVUkwoYWN0aW9uLCBwcm90b2NvbCArICIvLyIgKyBob3N0KTsKICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICB1cmw6IHVybCwKICAgICAgICAgICAgICBtZXRob2Q6IG1ldGhvZCwKICAgICAgICAgICAgICBlbmNUeXBlOiBlbmNUeXBlLAogICAgICAgICAgICAgIGZvcm1EYXRhOiBmb3JtRGF0YQogICAgICAgICAgICB9OwogICAgICAgICAgfQoKICAgICAgICAgIHZhciBfZXhjbHVkZWQgPSBbIm9uQ2xpY2siLCAicmVsYXRpdmUiLCAicmVsb2FkRG9jdW1lbnQiLCAicmVwbGFjZSIsICJzdGF0ZSIsICJ0YXJnZXQiLCAidG8iLCAicHJldmVudFNjcm9sbFJlc2V0Il0sCiAgICAgICAgICAgIF9leGNsdWRlZDIgPSBbImFyaWEtY3VycmVudCIsICJjYXNlU2Vuc2l0aXZlIiwgImNsYXNzTmFtZSIsICJlbmQiLCAic3R5bGUiLCAidG8iLCAiY2hpbGRyZW4iXSwKICAgICAgICAgICAgX2V4Y2x1ZGVkMyA9IC8qIHVudXNlZCBwdXJlIGV4cHJlc3Npb24gb3Igc3VwZXIgKi9udWxsICYmIFsicmVsb2FkRG9jdW1lbnQiLCAicmVwbGFjZSIsICJtZXRob2QiLCAiYWN0aW9uIiwgIm9uU3VibWl0IiwgImZldGNoZXJLZXkiLCAicm91dGVJZCIsICJyZWxhdGl2ZSJdOwogICAgICAgICAgLy8jcmVnaW9uIFJvdXRlcnMKICAgICAgICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCgogICAgICAgICAgZnVuY3Rpb24gY3JlYXRlQnJvd3NlclJvdXRlcihyb3V0ZXMsIG9wdHMpIHsKICAgICAgICAgICAgcmV0dXJuIGNyZWF0ZVJvdXRlcih7CiAgICAgICAgICAgICAgYmFzZW5hbWU6IG9wdHMgPT0gbnVsbCA/IHZvaWQgMCA6IG9wdHMuYmFzZW5hbWUsCiAgICAgICAgICAgICAgaGlzdG9yeTogY3JlYXRlQnJvd3Nlckhpc3RvcnkoewogICAgICAgICAgICAgICAgd2luZG93OiBvcHRzID09IG51bGwgPyB2b2lkIDAgOiBvcHRzLndpbmRvdwogICAgICAgICAgICAgIH0pLAogICAgICAgICAgICAgIGh5ZHJhdGlvbkRhdGE6IChvcHRzID09IG51bGwgPyB2b2lkIDAgOiBvcHRzLmh5ZHJhdGlvbkRhdGEpIHx8IHBhcnNlSHlkcmF0aW9uRGF0YSgpLAogICAgICAgICAgICAgIHJvdXRlczogVU5TQUZFX2VuaGFuY2VNYW51YWxSb3V0ZU9iamVjdHMocm91dGVzKQogICAgICAgICAgICB9KS5pbml0aWFsaXplKCk7CiAgICAgICAgICB9CiAgICAgICAgICBmdW5jdGlvbiBjcmVhdGVIYXNoUm91dGVyKHJvdXRlcywgb3B0cykgewogICAgICAgICAgICByZXR1cm4gY3JlYXRlUm91dGVyKHsKICAgICAgICAgICAgICBiYXNlbmFtZTogb3B0cyA9PSBudWxsID8gdm9pZCAwIDogb3B0cy5iYXNlbmFtZSwKICAgICAgICAgICAgICBoaXN0b3J5OiBjcmVhdGVIYXNoSGlzdG9yeSh7CiAgICAgICAgICAgICAgICB3aW5kb3c6IG9wdHMgPT0gbnVsbCA/IHZvaWQgMCA6IG9wdHMud2luZG93CiAgICAgICAgICAgICAgfSksCiAgICAgICAgICAgICAgaHlkcmF0aW9uRGF0YTogKG9wdHMgPT0gbnVsbCA/IHZvaWQgMCA6IG9wdHMuaHlkcmF0aW9uRGF0YSkgfHwgcGFyc2VIeWRyYXRpb25EYXRhKCksCiAgICAgICAgICAgICAgcm91dGVzOiBVTlNBRkVfZW5oYW5jZU1hbnVhbFJvdXRlT2JqZWN0cyhyb3V0ZXMpCiAgICAgICAgICAgIH0pLmluaXRpYWxpemUoKTsKICAgICAgICAgIH0KCiAgICAgICAgICBmdW5jdGlvbiBwYXJzZUh5ZHJhdGlvbkRhdGEoKSB7CiAgICAgICAgICAgIHZhciBfd2luZG93OwoKICAgICAgICAgICAgdmFyIHN0YXRlID0gKF93aW5kb3cgPSB3aW5kb3cpID09IG51bGwgPyB2b2lkIDAgOiBfd2luZG93Ll9fc3RhdGljUm91dGVySHlkcmF0aW9uRGF0YTsKCiAgICAgICAgICAgIGlmIChzdGF0ZSAmJiBzdGF0ZS5lcnJvcnMpIHsKICAgICAgICAgICAgICBzdGF0ZSA9IHJlYWN0X3JvdXRlcl9kb21fZGlzdF9leHRlbmRzKHt9LCBzdGF0ZSwgewogICAgICAgICAgICAgICAgZXJyb3JzOiBkZXNlcmlhbGl6ZUVycm9ycyhzdGF0ZS5lcnJvcnMpCiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybiBzdGF0ZTsKICAgICAgICAgIH0KCiAgICAgICAgICBmdW5jdGlvbiBkZXNlcmlhbGl6ZUVycm9ycyhlcnJvcnMpIHsKICAgICAgICAgICAgaWYgKCFlcnJvcnMpIHJldHVybiBudWxsOwogICAgICAgICAgICB2YXIgZW50cmllcyA9IE9iamVjdC5lbnRyaWVzKGVycm9ycyk7CiAgICAgICAgICAgIHZhciBzZXJpYWxpemVkID0ge307CgogICAgICAgICAgICBmb3IgKHZhciBfaTMgPSAwLCBfZW50cmllcyA9IGVudHJpZXM7IF9pMyA8IF9lbnRyaWVzLmxlbmd0aDsgX2kzKyspIHt2YXIgX2VudHJpZXMkX2kgPSBfc2xpY2VkVG9BcnJheTIoX2VudHJpZXNbX2kzXSwgMiksa2V5ID0gX2VudHJpZXMkX2lbMF0sdmFsID0gX2VudHJpZXMkX2lbMV07CiAgICAgICAgICAgICAgLy8gSGV5IHlvdSEgIElmIHlvdSBjaGFuZ2UgdGhpcywgcGxlYXNlIGNoYW5nZSB0aGUgY29ycmVzcG9uZGluZyBsb2dpYyBpbgogICAgICAgICAgICAgIC8vIHNlcmlhbGl6ZUVycm9ycyBpbiByZWFjdC1yb3V0ZXItZG9tL3NlcnZlci50c3ggOikKICAgICAgICAgICAgICBpZiAodmFsICYmIHZhbC5fX3R5cGUgPT09ICJSb3V0ZUVycm9yUmVzcG9uc2UiKSB7CiAgICAgICAgICAgICAgICBzZXJpYWxpemVkW2tleV0gPSBuZXcgRXJyb3JSZXNwb25zZSh2YWwuc3RhdHVzLCB2YWwuc3RhdHVzVGV4dCwgdmFsLmRhdGEsIHZhbC5pbnRlcm5hbCA9PT0gdHJ1ZSk7CiAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHNlcmlhbGl6ZWRba2V5XSA9IHZhbDsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybiBzZXJpYWxpemVkOwogICAgICAgICAgfQogICAgICAgICAgLyoqCiAgICAgICAgICAgKiBBIGA8Um91dGVyPmAgZm9yIHVzZSBpbiB3ZWIgYnJvd3NlcnMuIFByb3ZpZGVzIHRoZSBjbGVhbmVzdCBVUkxzLgogICAgICAgICAgICovCgoKICAgICAgICAgIGZ1bmN0aW9uIEJyb3dzZXJSb3V0ZXIoX3JlZikgewogICAgICAgICAgICB2YXIKICAgICAgICAgICAgICBiYXNlbmFtZSA9CgoKICAgICAgICAgICAgICBfcmVmLmJhc2VuYW1lLGNoaWxkcmVuID0gX3JlZi5jaGlsZHJlbix3aW5kb3cgPSBfcmVmLndpbmRvdzsKICAgICAgICAgICAgdmFyIGhpc3RvcnlSZWYgPSBSZWFjdC51c2VSZWYoKTsKCiAgICAgICAgICAgIGlmIChoaXN0b3J5UmVmLmN1cnJlbnQgPT0gbnVsbCkgewogICAgICAgICAgICAgIGhpc3RvcnlSZWYuY3VycmVudCA9IGNyZWF0ZUJyb3dzZXJIaXN0b3J5KHsKICAgICAgICAgICAgICAgIHdpbmRvdzogd2luZG93LAogICAgICAgICAgICAgICAgdjVDb21wYXQ6IHRydWUKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdmFyIGhpc3RvcnkgPSBoaXN0b3J5UmVmLmN1cnJlbnQ7CiAgICAgICAgICAgIHZhciBfUmVhY3QkdXNlU3RhdGUgPSBSZWFjdC51c2VTdGF0ZSh7CiAgICAgICAgICAgICAgICBhY3Rpb246IGhpc3RvcnkuYWN0aW9uLAogICAgICAgICAgICAgICAgbG9jYXRpb246IGhpc3RvcnkubG9jYXRpb24KICAgICAgICAgICAgICB9KSxfUmVhY3QkdXNlU3RhdGUyID0gX3NsaWNlZFRvQXJyYXkyKF9SZWFjdCR1c2VTdGF0ZSwgMiksc3RhdGUgPSBfUmVhY3QkdXNlU3RhdGUyWzBdLHNldFN0YXRlID0gX1JlYWN0JHVzZVN0YXRlMlsxXTsKICAgICAgICAgICAgUmVhY3QudXNlTGF5b3V0RWZmZWN0KCgpID0+IGhpc3RvcnkubGlzdGVuKHNldFN0YXRlKSwgW2hpc3RvcnldKTsKICAgICAgICAgICAgcmV0dXJuIC8qI19fUFVSRV9fKi9SZWFjdC5jcmVhdGVFbGVtZW50KFJvdXRlciwgewogICAgICAgICAgICAgIGJhc2VuYW1lOiBiYXNlbmFtZSwKICAgICAgICAgICAgICBjaGlsZHJlbjogY2hpbGRyZW4sCiAgICAgICAgICAgICAgbG9jYXRpb246IHN0YXRlLmxvY2F0aW9uLAogICAgICAgICAgICAgIG5hdmlnYXRpb25UeXBlOiBzdGF0ZS5hY3Rpb24sCiAgICAgICAgICAgICAgbmF2aWdhdG9yOiBoaXN0b3J5CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfQogICAgICAgICAgLyoqCiAgICAgICAgICAgKiBBIGA8Um91dGVyPmAgZm9yIHVzZSBpbiB3ZWIgYnJvd3NlcnMuIFN0b3JlcyB0aGUgbG9jYXRpb24gaW4gdGhlIGhhc2gKICAgICAgICAgICAqIHBvcnRpb24gb2YgdGhlIFVSTCBzbyBpdCBpcyBub3Qgc2VudCB0byB0aGUgc2VydmVyLgogICAgICAgICAgICovCgogICAgICAgICAgZnVuY3Rpb24gSGFzaFJvdXRlcihfcmVmMikgewogICAgICAgICAgICB2YXIKICAgICAgICAgICAgICBiYXNlbmFtZSA9CgoKICAgICAgICAgICAgICBfcmVmMi5iYXNlbmFtZSxjaGlsZHJlbiA9IF9yZWYyLmNoaWxkcmVuLHdpbmRvdyA9IF9yZWYyLndpbmRvdzsKICAgICAgICAgICAgdmFyIGhpc3RvcnlSZWYgPSBSZWFjdC51c2VSZWYoKTsKCiAgICAgICAgICAgIGlmIChoaXN0b3J5UmVmLmN1cnJlbnQgPT0gbnVsbCkgewogICAgICAgICAgICAgIGhpc3RvcnlSZWYuY3VycmVudCA9IGNyZWF0ZUhhc2hIaXN0b3J5KHsKICAgICAgICAgICAgICAgIHdpbmRvdzogd2luZG93LAogICAgICAgICAgICAgICAgdjVDb21wYXQ6IHRydWUKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdmFyIGhpc3RvcnkgPSBoaXN0b3J5UmVmLmN1cnJlbnQ7CiAgICAgICAgICAgIHZhciBfUmVhY3QkdXNlU3RhdGUzID0gUmVhY3QudXNlU3RhdGUoewogICAgICAgICAgICAgICAgYWN0aW9uOiBoaXN0b3J5LmFjdGlvbiwKICAgICAgICAgICAgICAgIGxvY2F0aW9uOiBoaXN0b3J5LmxvY2F0aW9uCiAgICAgICAgICAgICAgfSksX1JlYWN0JHVzZVN0YXRlNCA9IF9zbGljZWRUb0FycmF5MihfUmVhY3QkdXNlU3RhdGUzLCAyKSxzdGF0ZSA9IF9SZWFjdCR1c2VTdGF0ZTRbMF0sc2V0U3RhdGUgPSBfUmVhY3QkdXNlU3RhdGU0WzFdOwogICAgICAgICAgICBSZWFjdC51c2VMYXlvdXRFZmZlY3QoKCkgPT4gaGlzdG9yeS5saXN0ZW4oc2V0U3RhdGUpLCBbaGlzdG9yeV0pOwogICAgICAgICAgICByZXR1cm4gLyojX19QVVJFX18qL1JlYWN0LmNyZWF0ZUVsZW1lbnQoUm91dGVyLCB7CiAgICAgICAgICAgICAgYmFzZW5hbWU6IGJhc2VuYW1lLAogICAgICAgICAgICAgIGNoaWxkcmVuOiBjaGlsZHJlbiwKICAgICAgICAgICAgICBsb2NhdGlvbjogc3RhdGUubG9jYXRpb24sCiAgICAgICAgICAgICAgbmF2aWdhdGlvblR5cGU6IHN0YXRlLmFjdGlvbiwKICAgICAgICAgICAgICBuYXZpZ2F0b3I6IGhpc3RvcnkKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9CiAgICAgICAgICAvKioKICAgICAgICAgICAqIEEgYDxSb3V0ZXI+YCB0aGF0IGFjY2VwdHMgYSBwcmUtaW5zdGFudGlhdGVkIGhpc3Rvcnkgb2JqZWN0LiBJdCdzIGltcG9ydGFudAogICAgICAgICAgICogdG8gbm90ZSB0aGF0IHVzaW5nIHlvdXIgb3duIGhpc3Rvcnkgb2JqZWN0IGlzIGhpZ2hseSBkaXNjb3VyYWdlZCBhbmQgbWF5IGFkZAogICAgICAgICAgICogdHdvIHZlcnNpb25zIG9mIHRoZSBoaXN0b3J5IGxpYnJhcnkgdG8geW91ciBidW5kbGVzIHVubGVzcyB5b3UgdXNlIHRoZSBzYW1lCiAgICAgICAgICAgKiB2ZXJzaW9uIG9mIHRoZSBoaXN0b3J5IGxpYnJhcnkgdGhhdCBSZWFjdCBSb3V0ZXIgdXNlcyBpbnRlcm5hbGx5LgogICAgICAgICAgICovCgogICAgICAgICAgZnVuY3Rpb24gSGlzdG9yeVJvdXRlcihfcmVmMykgewogICAgICAgICAgICB2YXIKICAgICAgICAgICAgICBiYXNlbmFtZSA9CgoKICAgICAgICAgICAgICBfcmVmMy5iYXNlbmFtZSxjaGlsZHJlbiA9IF9yZWYzLmNoaWxkcmVuLGhpc3RvcnkgPSBfcmVmMy5oaXN0b3J5OwogICAgICAgICAgICB2YXIgX1JlYWN0JHVzZVN0YXRlNSA9IFJlYWN0LnVzZVN0YXRlKHsKICAgICAgICAgICAgICAgIGFjdGlvbjogaGlzdG9yeS5hY3Rpb24sCiAgICAgICAgICAgICAgICBsb2NhdGlvbjogaGlzdG9yeS5sb2NhdGlvbgogICAgICAgICAgICAgIH0pLF9SZWFjdCR1c2VTdGF0ZTYgPSBfc2xpY2VkVG9BcnJheTIoX1JlYWN0JHVzZVN0YXRlNSwgMiksc3RhdGUgPSBfUmVhY3QkdXNlU3RhdGU2WzBdLHNldFN0YXRlID0gX1JlYWN0JHVzZVN0YXRlNlsxXTsKICAgICAgICAgICAgUmVhY3QudXNlTGF5b3V0RWZmZWN0KCgpID0+IGhpc3RvcnkubGlzdGVuKHNldFN0YXRlKSwgW2hpc3RvcnldKTsKICAgICAgICAgICAgcmV0dXJuIC8qI19fUFVSRV9fKi9SZWFjdC5jcmVhdGVFbGVtZW50KFJvdXRlciwgewogICAgICAgICAgICAgIGJhc2VuYW1lOiBiYXNlbmFtZSwKICAgICAgICAgICAgICBjaGlsZHJlbjogY2hpbGRyZW4sCiAgICAgICAgICAgICAgbG9jYXRpb246IHN0YXRlLmxvY2F0aW9uLAogICAgICAgICAgICAgIG5hdmlnYXRpb25UeXBlOiBzdGF0ZS5hY3Rpb24sCiAgICAgICAgICAgICAgbmF2aWdhdG9yOiBoaXN0b3J5CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfQoKICAgICAgICAgIGlmIChmYWxzZSkge30KICAgICAgICAgIC8qKgogICAgICAgICAgICogVGhlIHB1YmxpYyBBUEkgZm9yIHJlbmRlcmluZyBhIGhpc3RvcnktYXdhcmUgPGE+LgogICAgICAgICAgICovCgogICAgICAgICAgdmFyIExpbmsgPSAvKiNfX1BVUkVfXyovcmVhY3QuZm9yd2FyZFJlZihmdW5jdGlvbiBMaW5rV2l0aFJlZihfcmVmNCwgcmVmKSB7CiAgICAgICAgICAgIHZhcgogICAgICAgICAgICAgIG9uQ2xpY2sgPQoKCgoKCgoKICAgICAgICAgICAgICBfcmVmNC5vbkNsaWNrLHJlbGF0aXZlID0gX3JlZjQucmVsYXRpdmUscmVsb2FkRG9jdW1lbnQgPSBfcmVmNC5yZWxvYWREb2N1bWVudCxyZXBsYWNlID0gX3JlZjQucmVwbGFjZSxzdGF0ZSA9IF9yZWY0LnN0YXRlLHRhcmdldCA9IF9yZWY0LnRhcmdldCx0byA9IF9yZWY0LnRvLHByZXZlbnRTY3JvbGxSZXNldCA9IF9yZWY0LnByZXZlbnRTY3JvbGxSZXNldCwKICAgICAgICAgICAgICByZXN0ID0gX29iamVjdFdpdGhvdXRQcm9wZXJ0aWVzTG9vc2UoX3JlZjQsIF9leGNsdWRlZCk7CgogICAgICAgICAgICB2YXIgaHJlZiA9IHVzZUhyZWYodG8sIHsKICAgICAgICAgICAgICByZWxhdGl2ZTogcmVsYXRpdmUKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIHZhciBpbnRlcm5hbE9uQ2xpY2sgPSB1c2VMaW5rQ2xpY2tIYW5kbGVyKHRvLCB7CiAgICAgICAgICAgICAgcmVwbGFjZTogcmVwbGFjZSwKICAgICAgICAgICAgICBzdGF0ZTogc3RhdGUsCiAgICAgICAgICAgICAgdGFyZ2V0OiB0YXJnZXQsCiAgICAgICAgICAgICAgcHJldmVudFNjcm9sbFJlc2V0OiBwcmV2ZW50U2Nyb2xsUmVzZXQsCiAgICAgICAgICAgICAgcmVsYXRpdmU6IHJlbGF0aXZlCiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgZnVuY3Rpb24gaGFuZGxlQ2xpY2soZXZlbnQpIHsKICAgICAgICAgICAgICBpZiAob25DbGljaykgb25DbGljayhldmVudCk7CgogICAgICAgICAgICAgIGlmICghZXZlbnQuZGVmYXVsdFByZXZlbnRlZCkgewogICAgICAgICAgICAgICAgaW50ZXJuYWxPbkNsaWNrKGV2ZW50KTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybiAoCiAgICAgICAgICAgICAgLyojX19QVVJFX18qLwogICAgICAgICAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBqc3gtYTExeS9hbmNob3ItaGFzLWNvbnRlbnQKICAgICAgICAgICAgICByZWFjdC5jcmVhdGVFbGVtZW50KCJhIiwgcmVhY3Rfcm91dGVyX2RvbV9kaXN0X2V4dGVuZHMoe30sIHJlc3QsIHsKICAgICAgICAgICAgICAgIGhyZWY6IGhyZWYsCiAgICAgICAgICAgICAgICBvbkNsaWNrOiByZWxvYWREb2N1bWVudCA/IG9uQ2xpY2sgOiBoYW5kbGVDbGljaywKICAgICAgICAgICAgICAgIHJlZjogcmVmLAogICAgICAgICAgICAgICAgdGFyZ2V0OiB0YXJnZXQKICAgICAgICAgICAgICB9KSkpOwoKICAgICAgICAgIH0pOwoKICAgICAgICAgIGlmIChmYWxzZSkge30KICAgICAgICAgIC8qKgogICAgICAgICAgICogQSA8TGluaz4gd3JhcHBlciB0aGF0IGtub3dzIGlmIGl0J3MgImFjdGl2ZSIgb3Igbm90LgogICAgICAgICAgICovCgoKICAgICAgICAgIHZhciBOYXZMaW5rID0gLyojX19QVVJFX18qL3JlYWN0LmZvcndhcmRSZWYoZnVuY3Rpb24gTmF2TGlua1dpdGhSZWYoX3JlZjUsIHJlZikgewogICAgICAgICAgICB2YXIgX3JlZjUkYXJpYUN1cnJlbnQgPQoKCgoKCgoKICAgICAgICAgICAgICBfcmVmNVsiYXJpYS1jdXJyZW50Il0sYXJpYUN1cnJlbnRQcm9wID0gX3JlZjUkYXJpYUN1cnJlbnQgPT09IHZvaWQgMCA/ICJwYWdlIiA6IF9yZWY1JGFyaWFDdXJyZW50LF9yZWY1JGNhc2VTZW5zaXRpdmUgPSBfcmVmNS5jYXNlU2Vuc2l0aXZlLGNhc2VTZW5zaXRpdmUgPSBfcmVmNSRjYXNlU2Vuc2l0aXZlID09PSB2b2lkIDAgPyBmYWxzZSA6IF9yZWY1JGNhc2VTZW5zaXRpdmUsX3JlZjUkY2xhc3NOYW1lID0gX3JlZjUuY2xhc3NOYW1lLGNsYXNzTmFtZVByb3AgPSBfcmVmNSRjbGFzc05hbWUgPT09IHZvaWQgMCA/ICIiIDogX3JlZjUkY2xhc3NOYW1lLF9yZWY1JGVuZCA9IF9yZWY1LmVuZCxlbmQgPSBfcmVmNSRlbmQgPT09IHZvaWQgMCA/IGZhbHNlIDogX3JlZjUkZW5kLHN0eWxlUHJvcCA9IF9yZWY1LnN0eWxlLHRvID0gX3JlZjUudG8sY2hpbGRyZW4gPSBfcmVmNS5jaGlsZHJlbiwKICAgICAgICAgICAgICByZXN0ID0gX29iamVjdFdpdGhvdXRQcm9wZXJ0aWVzTG9vc2UoX3JlZjUsIF9leGNsdWRlZDIpOwoKICAgICAgICAgICAgdmFyIHBhdGggPSBkaXN0X3VzZVJlc29sdmVkUGF0aCh0bywgewogICAgICAgICAgICAgIHJlbGF0aXZlOiByZXN0LnJlbGF0aXZlCiAgICAgICAgICAgIH0pOwogICAgICAgICAgICB2YXIgbG9jYXRpb24gPSBkaXN0X3VzZUxvY2F0aW9uKCk7CiAgICAgICAgICAgIHZhciByb3V0ZXJTdGF0ZSA9IHJlYWN0LnVzZUNvbnRleHQoRGF0YVJvdXRlclN0YXRlQ29udGV4dCk7CiAgICAgICAgICAgIHZhciBfcmVhY3QkdXNlQ29udGV4dDcgPQoKICAgICAgICAgICAgICByZWFjdC51c2VDb250ZXh0KE5hdmlnYXRpb25Db250ZXh0KSxuYXZpZ2F0b3IgPSBfcmVhY3QkdXNlQ29udGV4dDcubmF2aWdhdG9yOwogICAgICAgICAgICB2YXIgdG9QYXRobmFtZSA9IG5hdmlnYXRvci5lbmNvZGVMb2NhdGlvbiA/IG5hdmlnYXRvci5lbmNvZGVMb2NhdGlvbihwYXRoKS5wYXRobmFtZSA6IHBhdGgucGF0aG5hbWU7CiAgICAgICAgICAgIHZhciBsb2NhdGlvblBhdGhuYW1lID0gbG9jYXRpb24ucGF0aG5hbWU7CiAgICAgICAgICAgIHZhciBuZXh0TG9jYXRpb25QYXRobmFtZSA9IHJvdXRlclN0YXRlICYmIHJvdXRlclN0YXRlLm5hdmlnYXRpb24gJiYgcm91dGVyU3RhdGUubmF2aWdhdGlvbi5sb2NhdGlvbiA/IHJvdXRlclN0YXRlLm5hdmlnYXRpb24ubG9jYXRpb24ucGF0aG5hbWUgOiBudWxsOwoKICAgICAgICAgICAgaWYgKCFjYXNlU2Vuc2l0aXZlKSB7CiAgICAgICAgICAgICAgbG9jYXRpb25QYXRobmFtZSA9IGxvY2F0aW9uUGF0aG5hbWUudG9Mb3dlckNhc2UoKTsKICAgICAgICAgICAgICBuZXh0TG9jYXRpb25QYXRobmFtZSA9IG5leHRMb2NhdGlvblBhdGhuYW1lID8gbmV4dExvY2F0aW9uUGF0aG5hbWUudG9Mb3dlckNhc2UoKSA6IG51bGw7CiAgICAgICAgICAgICAgdG9QYXRobmFtZSA9IHRvUGF0aG5hbWUudG9Mb3dlckNhc2UoKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdmFyIGlzQWN0aXZlID0gbG9jYXRpb25QYXRobmFtZSA9PT0gdG9QYXRobmFtZSB8fCAhZW5kICYmIGxvY2F0aW9uUGF0aG5hbWUuc3RhcnRzV2l0aCh0b1BhdGhuYW1lKSAmJiBsb2NhdGlvblBhdGhuYW1lLmNoYXJBdCh0b1BhdGhuYW1lLmxlbmd0aCkgPT09ICIvIjsKICAgICAgICAgICAgdmFyIGlzUGVuZGluZyA9IG5leHRMb2NhdGlvblBhdGhuYW1lICE9IG51bGwgJiYgKG5leHRMb2NhdGlvblBhdGhuYW1lID09PSB0b1BhdGhuYW1lIHx8ICFlbmQgJiYgbmV4dExvY2F0aW9uUGF0aG5hbWUuc3RhcnRzV2l0aCh0b1BhdGhuYW1lKSAmJiBuZXh0TG9jYXRpb25QYXRobmFtZS5jaGFyQXQodG9QYXRobmFtZS5sZW5ndGgpID09PSAiLyIpOwogICAgICAgICAgICB2YXIgYXJpYUN1cnJlbnQgPSBpc0FjdGl2ZSA/IGFyaWFDdXJyZW50UHJvcCA6IHVuZGVmaW5lZDsKICAgICAgICAgICAgdmFyIGNsYXNzTmFtZTsKCiAgICAgICAgICAgIGlmICh0eXBlb2YgY2xhc3NOYW1lUHJvcCA9PT0gImZ1bmN0aW9uIikgewogICAgICAgICAgICAgIGNsYXNzTmFtZSA9IGNsYXNzTmFtZVByb3AoewogICAgICAgICAgICAgICAgaXNBY3RpdmU6IGlzQWN0aXZlLAogICAgICAgICAgICAgICAgaXNQZW5kaW5nOiBpc1BlbmRpbmcKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAvLyBJZiB0aGUgY2xhc3NOYW1lIHByb3AgaXMgbm90IGEgZnVuY3Rpb24sIHdlIHVzZSBhIGRlZmF1bHQgYGFjdGl2ZWAKICAgICAgICAgICAgICAvLyBjbGFzcyBmb3IgPE5hdkxpbmsgLz5zIHRoYXQgYXJlIGFjdGl2ZS4gSW4gdjUgYGFjdGl2ZWAgd2FzIHRoZSBkZWZhdWx0CiAgICAgICAgICAgICAgLy8gdmFsdWUgZm9yIGBhY3RpdmVDbGFzc05hbWVgLCBidXQgd2UgYXJlIHJlbW92aW5nIHRoYXQgQVBJIGFuZCBjYW4gc3RpbGwKICAgICAgICAgICAgICAvLyB1c2UgdGhlIG9sZCBkZWZhdWx0IGJlaGF2aW9yIGZvciBhIGNsZWFuZXIgdXBncmFkZSBwYXRoIGFuZCBrZWVwIHRoZQogICAgICAgICAgICAgIC8vIHNpbXBsZSBzdHlsaW5nIHJ1bGVzIHdvcmtpbmcgYXMgdGhleSBjdXJyZW50bHkgZG8uCiAgICAgICAgICAgICAgY2xhc3NOYW1lID0gW2NsYXNzTmFtZVByb3AsIGlzQWN0aXZlID8gImFjdGl2ZSIgOiBudWxsLCBpc1BlbmRpbmcgPyAicGVuZGluZyIgOiBudWxsXS5maWx0ZXIoQm9vbGVhbikuam9pbigiICIpOwogICAgICAgICAgICB9CgogICAgICAgICAgICB2YXIgc3R5bGUgPSB0eXBlb2Ygc3R5bGVQcm9wID09PSAiZnVuY3Rpb24iID8gc3R5bGVQcm9wKHsKICAgICAgICAgICAgICBpc0FjdGl2ZTogaXNBY3RpdmUsCiAgICAgICAgICAgICAgaXNQZW5kaW5nOiBpc1BlbmRpbmcKICAgICAgICAgICAgfSkgOiBzdHlsZVByb3A7CiAgICAgICAgICAgIHJldHVybiAvKiNfX1BVUkVfXyovcmVhY3QuY3JlYXRlRWxlbWVudChMaW5rLCByZWFjdF9yb3V0ZXJfZG9tX2Rpc3RfZXh0ZW5kcyh7fSwgcmVzdCwgewogICAgICAgICAgICAgICJhcmlhLWN1cnJlbnQiOiBhcmlhQ3VycmVudCwKICAgICAgICAgICAgICBjbGFzc05hbWU6IGNsYXNzTmFtZSwKICAgICAgICAgICAgICByZWY6IHJlZiwKICAgICAgICAgICAgICBzdHlsZTogc3R5bGUsCiAgICAgICAgICAgICAgdG86IHRvCiAgICAgICAgICAgIH0pLCB0eXBlb2YgY2hpbGRyZW4gPT09ICJmdW5jdGlvbiIgPyBjaGlsZHJlbih7CiAgICAgICAgICAgICAgaXNBY3RpdmU6IGlzQWN0aXZlLAogICAgICAgICAgICAgIGlzUGVuZGluZzogaXNQZW5kaW5nCiAgICAgICAgICAgIH0pIDogY2hpbGRyZW4pOwogICAgICAgICAgfSk7CgogICAgICAgICAgaWYgKGZhbHNlKSB7fQogICAgICAgICAgLyoqCiAgICAgICAgICAgKiBBIGBAcmVtaXgtcnVuL3JvdXRlcmAtYXdhcmUgYDxmb3JtPmAuIEl0IGJlaGF2ZXMgbGlrZSBhIG5vcm1hbCBmb3JtIGV4Y2VwdAogICAgICAgICAgICogdGhhdCB0aGUgaW50ZXJhY3Rpb24gd2l0aCB0aGUgc2VydmVyIGlzIHdpdGggYGZldGNoYCBpbnN0ZWFkIG9mIG5ldyBkb2N1bWVudAogICAgICAgICAgICogcmVxdWVzdHMsIGFsbG93aW5nIGNvbXBvbmVudHMgdG8gYWRkIG5pY2VyIFVYIHRvIHRoZSBwYWdlIGFzIHRoZSBmb3JtIGlzCiAgICAgICAgICAgKiBzdWJtaXR0ZWQgYW5kIHJldHVybnMgd2l0aCBkYXRhLgogICAgICAgICAgICovCgoKICAgICAgICAgIHZhciBGb3JtID0gLyojX19QVVJFX18qLyAvKiB1bnVzZWQgcHVyZSBleHByZXNzaW9uIG9yIHN1cGVyICovbnVsbCAmJiBSZWFjdC5mb3J3YXJkUmVmKChwcm9wcywgcmVmKSA9PiB7CiAgICAgICAgICAgIHJldHVybiAvKiNfX1BVUkVfXyovUmVhY3QuY3JlYXRlRWxlbWVudChGb3JtSW1wbCwgcmVhY3Rfcm91dGVyX2RvbV9kaXN0X2V4dGVuZHMoe30sIHByb3BzLCB7CiAgICAgICAgICAgICAgcmVmOiByZWYKICAgICAgICAgICAgfSkpOwogICAgICAgICAgfSk7CgogICAgICAgICAgaWYgKGZhbHNlKSB7fQoKICAgICAgICAgIHZhciBGb3JtSW1wbCA9IC8qI19fUFVSRV9fKi8gLyogdW51c2VkIHB1cmUgZXhwcmVzc2lvbiBvciBzdXBlciAqL251bGwgJiYgUmVhY3QuZm9yd2FyZFJlZigoX3JlZjYsIGZvcndhcmRlZFJlZikgPT4gewogICAgICAgICAgICB2YXIKICAgICAgICAgICAgICByZWxvYWREb2N1bWVudCA9CgoKCgoKCgogICAgICAgICAgICAgIF9yZWY2LnJlbG9hZERvY3VtZW50LHJlcGxhY2UgPSBfcmVmNi5yZXBsYWNlLF9yZWY2JG1ldGhvZCA9IF9yZWY2Lm1ldGhvZCxtZXRob2QgPSBfcmVmNiRtZXRob2QgPT09IHZvaWQgMCA/IGRlZmF1bHRNZXRob2QgOiBfcmVmNiRtZXRob2QsYWN0aW9uID0gX3JlZjYuYWN0aW9uLG9uU3VibWl0ID0gX3JlZjYub25TdWJtaXQsZmV0Y2hlcktleSA9IF9yZWY2LmZldGNoZXJLZXkscm91dGVJZCA9IF9yZWY2LnJvdXRlSWQscmVsYXRpdmUgPSBfcmVmNi5yZWxhdGl2ZSwKICAgICAgICAgICAgICBwcm9wcyA9IF9vYmplY3RXaXRob3V0UHJvcGVydGllc0xvb3NlKF9yZWY2LCBfZXhjbHVkZWQzKTsKCiAgICAgICAgICAgIHZhciBzdWJtaXQgPSB1c2VTdWJtaXRJbXBsKGZldGNoZXJLZXksIHJvdXRlSWQpOwogICAgICAgICAgICB2YXIgZm9ybU1ldGhvZCA9IG1ldGhvZC50b0xvd2VyQ2FzZSgpID09PSAiZ2V0IiA/ICJnZXQiIDogInBvc3QiOwogICAgICAgICAgICB2YXIgZm9ybUFjdGlvbiA9IHVzZUZvcm1BY3Rpb24oYWN0aW9uLCB7CiAgICAgICAgICAgICAgcmVsYXRpdmU6IHJlbGF0aXZlCiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgdmFyIHN1Ym1pdEhhbmRsZXIgPSAoZXZlbnQpID0+IHsKICAgICAgICAgICAgICBvblN1Ym1pdCAmJiBvblN1Ym1pdChldmVudCk7CiAgICAgICAgICAgICAgaWYgKGV2ZW50LmRlZmF1bHRQcmV2ZW50ZWQpIHJldHVybjsKICAgICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgICAgICAgIHZhciBzdWJtaXR0ZXIgPSBldmVudC5uYXRpdmVFdmVudC5zdWJtaXR0ZXI7CiAgICAgICAgICAgICAgc3VibWl0KHN1Ym1pdHRlciB8fCBldmVudC5jdXJyZW50VGFyZ2V0LCB7CiAgICAgICAgICAgICAgICBtZXRob2Q6IG1ldGhvZCwKICAgICAgICAgICAgICAgIHJlcGxhY2U6IHJlcGxhY2UsCiAgICAgICAgICAgICAgICByZWxhdGl2ZTogcmVsYXRpdmUKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfTsKCiAgICAgICAgICAgIHJldHVybiAvKiNfX1BVUkVfXyovUmVhY3QuY3JlYXRlRWxlbWVudCgiZm9ybSIsIHJlYWN0X3JvdXRlcl9kb21fZGlzdF9leHRlbmRzKHsKICAgICAgICAgICAgICByZWY6IGZvcndhcmRlZFJlZiwKICAgICAgICAgICAgICBtZXRob2Q6IGZvcm1NZXRob2QsCiAgICAgICAgICAgICAgYWN0aW9uOiBmb3JtQWN0aW9uLAogICAgICAgICAgICAgIG9uU3VibWl0OiByZWxvYWREb2N1bWVudCA/IG9uU3VibWl0IDogc3VibWl0SGFuZGxlcgogICAgICAgICAgICB9LCBwcm9wcykpOwogICAgICAgICAgfSk7CgogICAgICAgICAgaWYgKGZhbHNlKSB7fQogICAgICAgICAgLyoqCiAgICAgICAgICAgKiBUaGlzIGNvbXBvbmVudCB3aWxsIGVtdWxhdGUgdGhlIGJyb3dzZXIncyBzY3JvbGwgcmVzdG9yYXRpb24gb24gbG9jYXRpb24KICAgICAgICAgICAqIGNoYW5nZXMuCiAgICAgICAgICAgKi8KCgogICAgICAgICAgZnVuY3Rpb24gU2Nyb2xsUmVzdG9yYXRpb24oX3JlZjcpIHsKICAgICAgICAgICAgdmFyCiAgICAgICAgICAgICAgZ2V0S2V5ID0KCiAgICAgICAgICAgICAgX3JlZjcuZ2V0S2V5LHN0b3JhZ2VLZXkgPSBfcmVmNy5zdG9yYWdlS2V5OwogICAgICAgICAgICB1c2VTY3JvbGxSZXN0b3JhdGlvbih7CiAgICAgICAgICAgICAgZ2V0S2V5OiBnZXRLZXksCiAgICAgICAgICAgICAgc3RvcmFnZUtleTogc3RvcmFnZUtleQogICAgICAgICAgICB9KTsKICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKGZhbHNlKSB7fSAvLyNlbmRyZWdpb24KICAgICAgICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCiAgICAgICAgICAvLyNyZWdpb24gSG9va3MKICAgICAgICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCgoKICAgICAgICAgIHZhciBkaXN0X0RhdGFSb3V0ZXJIb29rOwoKICAgICAgICAgIChmdW5jdGlvbiAoRGF0YVJvdXRlckhvb2spIHsKICAgICAgICAgICAgRGF0YVJvdXRlckhvb2tbIlVzZVNjcm9sbFJlc3RvcmF0aW9uIl0gPSAidXNlU2Nyb2xsUmVzdG9yYXRpb24iOwogICAgICAgICAgICBEYXRhUm91dGVySG9va1siVXNlU3VibWl0SW1wbCJdID0gInVzZVN1Ym1pdEltcGwiOwogICAgICAgICAgICBEYXRhUm91dGVySG9va1siVXNlRmV0Y2hlciJdID0gInVzZUZldGNoZXIiOwogICAgICAgICAgfSkoZGlzdF9EYXRhUm91dGVySG9vayB8fCAoZGlzdF9EYXRhUm91dGVySG9vayA9IHt9KSk7CgogICAgICAgICAgdmFyIGRpc3RfRGF0YVJvdXRlclN0YXRlSG9vazsKCiAgICAgICAgICAoZnVuY3Rpb24gKERhdGFSb3V0ZXJTdGF0ZUhvb2spIHsKICAgICAgICAgICAgRGF0YVJvdXRlclN0YXRlSG9va1siVXNlRmV0Y2hlcnMiXSA9ICJ1c2VGZXRjaGVycyI7CiAgICAgICAgICAgIERhdGFSb3V0ZXJTdGF0ZUhvb2tbIlVzZVNjcm9sbFJlc3RvcmF0aW9uIl0gPSAidXNlU2Nyb2xsUmVzdG9yYXRpb24iOwogICAgICAgICAgfSkoZGlzdF9EYXRhUm91dGVyU3RhdGVIb29rIHx8IChkaXN0X0RhdGFSb3V0ZXJTdGF0ZUhvb2sgPSB7fSkpOwoKICAgICAgICAgIGZ1bmN0aW9uIGRpc3RfZ2V0RGF0YVJvdXRlckNvbnNvbGVFcnJvcihob29rTmFtZSkgewogICAgICAgICAgICByZXR1cm4gaG9va05hbWUgKyAiIG11c3QgYmUgdXNlZCB3aXRoaW4gYSBkYXRhIHJvdXRlci4gIFNlZSBodHRwczovL3JlYWN0cm91dGVyLmNvbS9lbi9tYWluL3JvdXRlcnMvcGlja2luZy1hLXJvdXRlci4iOwogICAgICAgICAgfQoKICAgICAgICAgIGZ1bmN0aW9uIGRpc3RfdXNlRGF0YVJvdXRlckNvbnRleHQoaG9va05hbWUpIHsKICAgICAgICAgICAgdmFyIGN0eCA9IFJlYWN0LnVzZUNvbnRleHQoVU5TQUZFX0RhdGFSb3V0ZXJDb250ZXh0KTsKICAgICAgICAgICAgIWN0eCA/IGZhbHNlID8gMCA6IGludmFyaWFudChmYWxzZSkgOiB2b2lkIDA7CiAgICAgICAgICAgIHJldHVybiBjdHg7CiAgICAgICAgICB9CgogICAgICAgICAgZnVuY3Rpb24gZGlzdF91c2VEYXRhUm91dGVyU3RhdGUoaG9va05hbWUpIHsKICAgICAgICAgICAgdmFyIHN0YXRlID0gUmVhY3QudXNlQ29udGV4dChVTlNBRkVfRGF0YVJvdXRlclN0YXRlQ29udGV4dCk7CiAgICAgICAgICAgICFzdGF0ZSA/IGZhbHNlID8gMCA6IGludmFyaWFudChmYWxzZSkgOiB2b2lkIDA7CiAgICAgICAgICAgIHJldHVybiBzdGF0ZTsKICAgICAgICAgIH0KICAgICAgICAgIC8qKgogICAgICAgICAgICogSGFuZGxlcyB0aGUgY2xpY2sgYmVoYXZpb3IgZm9yIHJvdXRlciBgPExpbms+YCBjb21wb25lbnRzLiBUaGlzIGlzIHVzZWZ1bCBpZgogICAgICAgICAgICogeW91IG5lZWQgdG8gY3JlYXRlIGN1c3RvbSBgPExpbms+YCBjb21wb25lbnRzIHdpdGggdGhlIHNhbWUgY2xpY2sgYmVoYXZpb3Igd2UKICAgICAgICAgICAqIHVzZSBpbiBvdXIgZXhwb3J0ZWQgYDxMaW5rPmAuCiAgICAgICAgICAgKi8KCgogICAgICAgICAgZnVuY3Rpb24gdXNlTGlua0NsaWNrSGFuZGxlcih0bywgX3RlbXApIHsKICAgICAgICAgICAgdmFyIF9yZWYyOCA9CgoKCgoKICAgICAgICAgICAgICBfdGVtcCA9PT0gdm9pZCAwID8ge30gOiBfdGVtcCx0YXJnZXQgPSBfcmVmMjgudGFyZ2V0LHJlcGxhY2VQcm9wID0gX3JlZjI4LnJlcGxhY2Usc3RhdGUgPSBfcmVmMjguc3RhdGUscHJldmVudFNjcm9sbFJlc2V0ID0gX3JlZjI4LnByZXZlbnRTY3JvbGxSZXNldCxyZWxhdGl2ZSA9IF9yZWYyOC5yZWxhdGl2ZTsKICAgICAgICAgICAgdmFyIG5hdmlnYXRlID0gZGlzdF91c2VOYXZpZ2F0ZSgpOwogICAgICAgICAgICB2YXIgbG9jYXRpb24gPSBkaXN0X3VzZUxvY2F0aW9uKCk7CiAgICAgICAgICAgIHZhciBwYXRoID0gZGlzdF91c2VSZXNvbHZlZFBhdGgodG8sIHsKICAgICAgICAgICAgICByZWxhdGl2ZTogcmVsYXRpdmUKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIHJldHVybiByZWFjdC51c2VDYWxsYmFjaygoZXZlbnQpID0+IHsKICAgICAgICAgICAgICBpZiAoc2hvdWxkUHJvY2Vzc0xpbmtDbGljayhldmVudCwgdGFyZ2V0KSkgewogICAgICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTsgLy8gSWYgdGhlIFVSTCBoYXNuJ3QgY2hhbmdlZCwgYSByZWd1bGFyIDxhPiB3aWxsIGRvIGEgcmVwbGFjZSBpbnN0ZWFkIG9mCiAgICAgICAgICAgICAgICAvLyBhIHB1c2gsIHNvIGRvIHRoZSBzYW1lIGhlcmUgdW5sZXNzIHRoZSByZXBsYWNlIHByb3AgaXMgZXhwbGljaXRseSBzZXQKCiAgICAgICAgICAgICAgICB2YXIgcmVwbGFjZSA9IHJlcGxhY2VQcm9wICE9PSB1bmRlZmluZWQgPyByZXBsYWNlUHJvcCA6IHJvdXRlcl9jcmVhdGVQYXRoKGxvY2F0aW9uKSA9PT0gcm91dGVyX2NyZWF0ZVBhdGgocGF0aCk7CiAgICAgICAgICAgICAgICBuYXZpZ2F0ZSh0bywgewogICAgICAgICAgICAgICAgICByZXBsYWNlOiByZXBsYWNlLAogICAgICAgICAgICAgICAgICBzdGF0ZTogc3RhdGUsCiAgICAgICAgICAgICAgICAgIHByZXZlbnRTY3JvbGxSZXNldDogcHJldmVudFNjcm9sbFJlc2V0LAogICAgICAgICAgICAgICAgICByZWxhdGl2ZTogcmVsYXRpdmUKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwgW2xvY2F0aW9uLCBuYXZpZ2F0ZSwgcGF0aCwgcmVwbGFjZVByb3AsIHN0YXRlLCB0YXJnZXQsIHRvLCBwcmV2ZW50U2Nyb2xsUmVzZXQsIHJlbGF0aXZlXSk7CiAgICAgICAgICB9CiAgICAgICAgICAvKioKICAgICAgICAgICAqIEEgY29udmVuaWVudCB3cmFwcGVyIGZvciByZWFkaW5nIGFuZCB3cml0aW5nIHNlYXJjaCBwYXJhbWV0ZXJzIHZpYSB0aGUKICAgICAgICAgICAqIFVSTFNlYXJjaFBhcmFtcyBpbnRlcmZhY2UuCiAgICAgICAgICAgKi8KCiAgICAgICAgICBmdW5jdGlvbiB1c2VTZWFyY2hQYXJhbXMoZGVmYXVsdEluaXQpIHsKICAgICAgICAgICAgZmFsc2UgPyAwIDogdm9pZCAwOwogICAgICAgICAgICB2YXIgZGVmYXVsdFNlYXJjaFBhcmFtc1JlZiA9IFJlYWN0LnVzZVJlZihjcmVhdGVTZWFyY2hQYXJhbXMoZGVmYXVsdEluaXQpKTsKICAgICAgICAgICAgdmFyIGxvY2F0aW9uID0gdXNlTG9jYXRpb24oKTsKICAgICAgICAgICAgdmFyIHNlYXJjaFBhcmFtcyA9IFJlYWN0LnVzZU1lbW8oKCkgPT4gZ2V0U2VhcmNoUGFyYW1zRm9yTG9jYXRpb24obG9jYXRpb24uc2VhcmNoLCBkZWZhdWx0U2VhcmNoUGFyYW1zUmVmLmN1cnJlbnQpLCBbbG9jYXRpb24uc2VhcmNoXSk7CiAgICAgICAgICAgIHZhciBuYXZpZ2F0ZSA9IHVzZU5hdmlnYXRlKCk7CiAgICAgICAgICAgIHZhciBzZXRTZWFyY2hQYXJhbXMgPSBSZWFjdC51c2VDYWxsYmFjaygobmV4dEluaXQsIG5hdmlnYXRlT3B0aW9ucykgPT4gewogICAgICAgICAgICAgIHZhciBuZXdTZWFyY2hQYXJhbXMgPSBjcmVhdGVTZWFyY2hQYXJhbXModHlwZW9mIG5leHRJbml0ID09PSAiZnVuY3Rpb24iID8gbmV4dEluaXQoc2VhcmNoUGFyYW1zKSA6IG5leHRJbml0KTsKICAgICAgICAgICAgICBuYXZpZ2F0ZSgiPyIgKyBuZXdTZWFyY2hQYXJhbXMsIG5hdmlnYXRlT3B0aW9ucyk7CiAgICAgICAgICAgIH0sIFtuYXZpZ2F0ZSwgc2VhcmNoUGFyYW1zXSk7CiAgICAgICAgICAgIHJldHVybiBbc2VhcmNoUGFyYW1zLCBzZXRTZWFyY2hQYXJhbXNdOwogICAgICAgICAgfQogICAgICAgICAgLyoqCiAgICAgICAgICAgKiBSZXR1cm5zIGEgZnVuY3Rpb24gdGhhdCBtYXkgYmUgdXNlZCB0byBwcm9ncmFtbWF0aWNhbGx5IHN1Ym1pdCBhIGZvcm0gKG9yCiAgICAgICAgICAgKiBzb21lIGFyYml0cmFyeSBkYXRhKSB0byB0aGUgc2VydmVyLgogICAgICAgICAgICovCgogICAgICAgICAgZnVuY3Rpb24gdXNlU3VibWl0KCkgewogICAgICAgICAgICByZXR1cm4gdXNlU3VibWl0SW1wbCgpOwogICAgICAgICAgfQoKICAgICAgICAgIGZ1bmN0aW9uIHVzZVN1Ym1pdEltcGwoZmV0Y2hlcktleSwgcm91dGVJZCkgewogICAgICAgICAgICB2YXIgX2Rpc3RfdXNlRGF0YVJvdXRlckNvID0KCiAgICAgICAgICAgICAgZGlzdF91c2VEYXRhUm91dGVyQ29udGV4dChkaXN0X0RhdGFSb3V0ZXJIb29rLlVzZVN1Ym1pdEltcGwpLHJvdXRlciA9IF9kaXN0X3VzZURhdGFSb3V0ZXJDby5yb3V0ZXI7CiAgICAgICAgICAgIHZhciBkZWZhdWx0QWN0aW9uID0gdXNlRm9ybUFjdGlvbigpOwogICAgICAgICAgICByZXR1cm4gUmVhY3QudXNlQ2FsbGJhY2soZnVuY3Rpb24gKHRhcmdldCwgb3B0aW9ucykgewogICAgICAgICAgICAgIGlmIChvcHRpb25zID09PSB2b2lkIDApIHsKICAgICAgICAgICAgICAgIG9wdGlvbnMgPSB7fTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIGlmICh0eXBlb2YgZG9jdW1lbnQgPT09ICJ1bmRlZmluZWQiKSB7CiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIllvdSBhcmUgY2FsbGluZyBzdWJtaXQgZHVyaW5nIHRoZSBzZXJ2ZXIgcmVuZGVyLiAiICsgIlRyeSBjYWxsaW5nIHN1Ym1pdCB3aXRoaW4gYSBgdXNlRWZmZWN0YCBvciBjYWxsYmFjayBpbnN0ZWFkLiIpOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgdmFyIF9nZXRGb3JtU3VibWlzc2lvbkluZiA9CgoKCgogICAgICAgICAgICAgICAgZ2V0Rm9ybVN1Ym1pc3Npb25JbmZvKHRhcmdldCwgZGVmYXVsdEFjdGlvbiwgb3B0aW9ucyksbWV0aG9kID0gX2dldEZvcm1TdWJtaXNzaW9uSW5mLm1ldGhvZCxlbmNUeXBlID0gX2dldEZvcm1TdWJtaXNzaW9uSW5mLmVuY1R5cGUsZm9ybURhdGEgPSBfZ2V0Rm9ybVN1Ym1pc3Npb25JbmYuZm9ybURhdGEsdXJsID0gX2dldEZvcm1TdWJtaXNzaW9uSW5mLnVybDsKICAgICAgICAgICAgICB2YXIgaHJlZiA9IHVybC5wYXRobmFtZSArIHVybC5zZWFyY2g7CiAgICAgICAgICAgICAgdmFyIG9wdHMgPSB7CiAgICAgICAgICAgICAgICByZXBsYWNlOiBvcHRpb25zLnJlcGxhY2UsCiAgICAgICAgICAgICAgICBmb3JtRGF0YTogZm9ybURhdGEsCiAgICAgICAgICAgICAgICBmb3JtTWV0aG9kOiBtZXRob2QsCiAgICAgICAgICAgICAgICBmb3JtRW5jVHlwZTogZW5jVHlwZQogICAgICAgICAgICAgIH07CgogICAgICAgICAgICAgIGlmIChmZXRjaGVyS2V5KSB7CiAgICAgICAgICAgICAgICAhKHJvdXRlSWQgIT0gbnVsbCkgPyBmYWxzZSA/IDAgOiBpbnZhcmlhbnQoZmFsc2UpIDogdm9pZCAwOwogICAgICAgICAgICAgICAgcm91dGVyLmZldGNoKGZldGNoZXJLZXksIHJvdXRlSWQsIGhyZWYsIG9wdHMpOwogICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICByb3V0ZXIubmF2aWdhdGUoaHJlZiwgb3B0cyk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LCBbZGVmYXVsdEFjdGlvbiwgcm91dGVyLCBmZXRjaGVyS2V5LCByb3V0ZUlkXSk7CiAgICAgICAgICB9CgogICAgICAgICAgZnVuY3Rpb24gdXNlRm9ybUFjdGlvbihhY3Rpb24sIF90ZW1wMikgewogICAgICAgICAgICB2YXIgX3JlZjI5ID0KCiAgICAgICAgICAgICAgX3RlbXAyID09PSB2b2lkIDAgPyB7fSA6IF90ZW1wMixyZWxhdGl2ZSA9IF9yZWYyOS5yZWxhdGl2ZTsKICAgICAgICAgICAgdmFyIF9SZWFjdCR1c2VDb250ZXh0MiA9CgogICAgICAgICAgICAgIFJlYWN0LnVzZUNvbnRleHQoVU5TQUZFX05hdmlnYXRpb25Db250ZXh0KSxiYXNlbmFtZSA9IF9SZWFjdCR1c2VDb250ZXh0Mi5iYXNlbmFtZTsKICAgICAgICAgICAgdmFyIHJvdXRlQ29udGV4dCA9IFJlYWN0LnVzZUNvbnRleHQoVU5TQUZFX1JvdXRlQ29udGV4dCk7CiAgICAgICAgICAgICFyb3V0ZUNvbnRleHQgPyBmYWxzZSA/IDAgOiBpbnZhcmlhbnQoZmFsc2UpIDogdm9pZCAwOwogICAgICAgICAgICB2YXIgX3JvdXRlQ29udGV4dCRtYXRjaGVzID0gcm91dGVDb250ZXh0Lm1hdGNoZXMuc2xpY2UoLTEpLF9yb3V0ZUNvbnRleHQkbWF0Y2hlczIgPSBfc2xpY2VkVG9BcnJheTIoX3JvdXRlQ29udGV4dCRtYXRjaGVzLCAxKSxtYXRjaCA9IF9yb3V0ZUNvbnRleHQkbWF0Y2hlczJbMF07CiAgICAgICAgICAgIHZhciByZXNvbHZlZEFjdGlvbiA9IGFjdGlvbiAhPSBudWxsID8gYWN0aW9uIDogIi4iOyAvLyBTaGFsbG93IGNsb25lIHBhdGggc28gd2UgY2FuIG1vZGlmeSBpdCBiZWxvdywgb3RoZXJ3aXNlIHdlIG1vZGlmeSB0aGUKICAgICAgICAgICAgLy8gb2JqZWN0IHJlZmVyZW5jZWQgYnkgdXNlTWVtbyBpbnNpZGUgdXNlUmVzb2x2ZWRQYXRoCgogICAgICAgICAgICB2YXIgcGF0aCA9IHJlYWN0X3JvdXRlcl9kb21fZGlzdF9leHRlbmRzKHt9LCB1c2VSZXNvbHZlZFBhdGgocmVzb2x2ZWRBY3Rpb24sIHsKICAgICAgICAgICAgICByZWxhdGl2ZTogcmVsYXRpdmUKICAgICAgICAgICAgfSkpOyAvLyBQcmV2aW91c2x5IHdlIHNldCB0aGUgZGVmYXVsdCBhY3Rpb24gdG8gIi4iLiBUaGUgcHJvYmxlbSB3aXRoIHRoaXMgaXMgdGhhdAogICAgICAgICAgICAvLyBgdXNlUmVzb2x2ZWRQYXRoKCIuIilgIGV4Y2x1ZGVzIHNlYXJjaCBwYXJhbXMgYW5kIHRoZSBoYXNoIG9mIHRoZSByZXNvbHZlZAogICAgICAgICAgICAvLyBVUkwuIFRoaXMgaXMgdGhlIGludGVuZGVkIGJlaGF2aW9yIG9mIHdoZW4gIi4iIGlzIHNwZWNpZmljYWxseSBwcm92aWRlZCBhcwogICAgICAgICAgICAvLyB0aGUgZm9ybSBhY3Rpb24sIGJ1dCBpbmNvbnNpc3RlbnQgdy8gYnJvd3NlcnMgd2hlbiB0aGUgYWN0aW9uIGlzIG9taXR0ZWQuCiAgICAgICAgICAgIC8vIGh0dHBzOi8vZ2l0aHViLmNvbS9yZW1peC1ydW4vcmVtaXgvaXNzdWVzLzkyNwoKCiAgICAgICAgICAgIHZhciBsb2NhdGlvbiA9IHVzZUxvY2F0aW9uKCk7CgogICAgICAgICAgICBpZiAoYWN0aW9uID09IG51bGwpIHsKICAgICAgICAgICAgICAvLyBTYWZlIHRvIHdyaXRlIHRvIHRoZXNlIGRpcmVjdGx5IGhlcmUgc2luY2UgaWYgYWN0aW9uIHdhcyB1bmRlZmluZWQsIHdlCiAgICAgICAgICAgICAgLy8gd291bGQgaGF2ZSBjYWxsZWQgdXNlUmVzb2x2ZWRQYXRoKCIuIikgd2hpY2ggd2lsbCBuZXZlciBpbmNsdWRlIGEgc2VhcmNoCiAgICAgICAgICAgICAgLy8gb3IgaGFzaAogICAgICAgICAgICAgIHBhdGguc2VhcmNoID0gbG9jYXRpb24uc2VhcmNoOwogICAgICAgICAgICAgIHBhdGguaGFzaCA9IGxvY2F0aW9uLmhhc2g7IC8vIFdoZW4gZ3JhYmJpbmcgc2VhcmNoIHBhcmFtcyBmcm9tIHRoZSBVUkwsIHJlbW92ZSB0aGUgYXV0b21hdGljYWxseQogICAgICAgICAgICAgIC8vIGluc2VydGVkID9pbmRleCBwYXJhbSBzbyB3ZSBtYXRjaCB0aGUgdXNlUmVzb2x2ZWRQYXRoIHNlYXJjaCBiZWhhdmlvcgogICAgICAgICAgICAgIC8vIHdoaWNoIHdvdWxkIG5vdCBpbmNsdWRlID9pbmRleAoKICAgICAgICAgICAgICBpZiAobWF0Y2gucm91dGUuaW5kZXgpIHsKICAgICAgICAgICAgICAgIHZhciBwYXJhbXMgPSBuZXcgVVJMU2VhcmNoUGFyYW1zKHBhdGguc2VhcmNoKTsKICAgICAgICAgICAgICAgIHBhcmFtcy5kZWxldGUoImluZGV4Iik7CiAgICAgICAgICAgICAgICBwYXRoLnNlYXJjaCA9IHBhcmFtcy50b1N0cmluZygpID8gIj8iICsgcGFyYW1zLnRvU3RyaW5nKCkgOiAiIjsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmICgoIWFjdGlvbiB8fCBhY3Rpb24gPT09ICIuIikgJiYgbWF0Y2gucm91dGUuaW5kZXgpIHsKICAgICAgICAgICAgICBwYXRoLnNlYXJjaCA9IHBhdGguc2VhcmNoID8gcGF0aC5zZWFyY2gucmVwbGFjZSgvXlw/LywgIj9pbmRleCYiKSA6ICI/aW5kZXgiOwogICAgICAgICAgICB9IC8vIElmIHdlJ3JlIG9wZXJhdGluZyB3aXRoaW4gYSBiYXNlbmFtZSwgcHJlcGVuZCBpdCB0byB0aGUgcGF0aG5hbWUgcHJpb3IKICAgICAgICAgICAgLy8gdG8gY3JlYXRpbmcgdGhlIGZvcm0gYWN0aW9uLiAgSWYgdGhpcyBpcyBhIHJvb3QgbmF2aWdhdGlvbiwgdGhlbiBqdXN0IHVzZQogICAgICAgICAgICAvLyB0aGUgcmF3IGJhc2VuYW1lIHdoaWNoIGFsbG93cyB0aGUgYmFzZW5hbWUgdG8gaGF2ZSBmdWxsIGNvbnRyb2wgb3ZlciB0aGUKICAgICAgICAgICAgLy8gcHJlc2VuY2Ugb2YgYSB0cmFpbGluZyBzbGFzaCBvbiByb290IGFjdGlvbnMKCgogICAgICAgICAgICBpZiAoYmFzZW5hbWUgIT09ICIvIikgewogICAgICAgICAgICAgIHBhdGgucGF0aG5hbWUgPSBwYXRoLnBhdGhuYW1lID09PSAiLyIgPyBiYXNlbmFtZSA6IGpvaW5QYXRocyhbYmFzZW5hbWUsIHBhdGgucGF0aG5hbWVdKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuIGNyZWF0ZVBhdGgocGF0aCk7CiAgICAgICAgICB9CgogICAgICAgICAgZnVuY3Rpb24gY3JlYXRlRmV0Y2hlckZvcm0oZmV0Y2hlcktleSwgcm91dGVJZCkgewogICAgICAgICAgICB2YXIgRmV0Y2hlckZvcm0gPSAvKiNfX1BVUkVfXyovUmVhY3QuZm9yd2FyZFJlZigocHJvcHMsIHJlZikgPT4gewogICAgICAgICAgICAgIHJldHVybiAvKiNfX1BVUkVfXyovUmVhY3QuY3JlYXRlRWxlbWVudChGb3JtSW1wbCwgcmVhY3Rfcm91dGVyX2RvbV9kaXN0X2V4dGVuZHMoe30sIHByb3BzLCB7CiAgICAgICAgICAgICAgICByZWY6IHJlZiwKICAgICAgICAgICAgICAgIGZldGNoZXJLZXk6IGZldGNoZXJLZXksCiAgICAgICAgICAgICAgICByb3V0ZUlkOiByb3V0ZUlkCiAgICAgICAgICAgICAgfSkpOwogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIGlmIChmYWxzZSkge30KCiAgICAgICAgICAgIHJldHVybiBGZXRjaGVyRm9ybTsKICAgICAgICAgIH0KCiAgICAgICAgICB2YXIgZmV0Y2hlcklkID0gMDsKICAgICAgICAgIC8qKgogICAgICAgICAgICogSW50ZXJhY3RzIHdpdGggcm91dGUgbG9hZGVycyBhbmQgYWN0aW9ucyB3aXRob3V0IGNhdXNpbmcgYSBuYXZpZ2F0aW9uLiBHcmVhdAogICAgICAgICAgICogZm9yIGFueSBpbnRlcmFjdGlvbiB0aGF0IHN0YXlzIG9uIHRoZSBzYW1lIHBhZ2UuCiAgICAgICAgICAgKi8KCiAgICAgICAgICBmdW5jdGlvbiB1c2VGZXRjaGVyKCkgewogICAgICAgICAgICB2YXIgX3JvdXRlJG1hdGNoZXM7CgogICAgICAgICAgICB2YXIgX2Rpc3RfdXNlRGF0YVJvdXRlckNvMiA9CgogICAgICAgICAgICAgIGRpc3RfdXNlRGF0YVJvdXRlckNvbnRleHQoZGlzdF9EYXRhUm91dGVySG9vay5Vc2VGZXRjaGVyKSxyb3V0ZXIgPSBfZGlzdF91c2VEYXRhUm91dGVyQ28yLnJvdXRlcjsKICAgICAgICAgICAgdmFyIHJvdXRlID0gUmVhY3QudXNlQ29udGV4dChVTlNBRkVfUm91dGVDb250ZXh0KTsKICAgICAgICAgICAgIXJvdXRlID8gZmFsc2UgPyAwIDogaW52YXJpYW50KGZhbHNlKSA6IHZvaWQgMDsKICAgICAgICAgICAgdmFyIHJvdXRlSWQgPSAoX3JvdXRlJG1hdGNoZXMgPSByb3V0ZS5tYXRjaGVzW3JvdXRlLm1hdGNoZXMubGVuZ3RoIC0gMV0pID09IG51bGwgPyB2b2lkIDAgOiBfcm91dGUkbWF0Y2hlcy5yb3V0ZS5pZDsKICAgICAgICAgICAgIShyb3V0ZUlkICE9IG51bGwpID8gZmFsc2UgPyAwIDogaW52YXJpYW50KGZhbHNlKSA6IHZvaWQgMDsKICAgICAgICAgICAgdmFyIF9SZWFjdCR1c2VTdGF0ZTcgPSBSZWFjdC51c2VTdGF0ZSgoKSA9PiBTdHJpbmcoKytmZXRjaGVySWQpKSxfUmVhY3QkdXNlU3RhdGU4ID0gX3NsaWNlZFRvQXJyYXkyKF9SZWFjdCR1c2VTdGF0ZTcsIDEpLGZldGNoZXJLZXkgPSBfUmVhY3QkdXNlU3RhdGU4WzBdOwogICAgICAgICAgICB2YXIgX1JlYWN0JHVzZVN0YXRlOSA9IFJlYWN0LnVzZVN0YXRlKCgpID0+IHsKICAgICAgICAgICAgICAgICFyb3V0ZUlkID8gZmFsc2UgPyAwIDogaW52YXJpYW50KGZhbHNlKSA6IHZvaWQgMDsKICAgICAgICAgICAgICAgIHJldHVybiBjcmVhdGVGZXRjaGVyRm9ybShmZXRjaGVyS2V5LCByb3V0ZUlkKTsKICAgICAgICAgICAgICB9KSxfUmVhY3QkdXNlU3RhdGUxMCA9IF9zbGljZWRUb0FycmF5MihfUmVhY3QkdXNlU3RhdGU5LCAxKSxGb3JtID0gX1JlYWN0JHVzZVN0YXRlMTBbMF07CiAgICAgICAgICAgIHZhciBfUmVhY3QkdXNlU3RhdGUxMSA9IFJlYWN0LnVzZVN0YXRlKCgpID0+IChocmVmKSA9PiB7CiAgICAgICAgICAgICAgICAhcm91dGVyID8gZmFsc2UgPyAwIDogaW52YXJpYW50KGZhbHNlKSA6IHZvaWQgMDsKICAgICAgICAgICAgICAgICFyb3V0ZUlkID8gZmFsc2UgPyAwIDogaW52YXJpYW50KGZhbHNlKSA6IHZvaWQgMDsKICAgICAgICAgICAgICAgIHJvdXRlci5mZXRjaChmZXRjaGVyS2V5LCByb3V0ZUlkLCBocmVmKTsKICAgICAgICAgICAgICB9KSxfUmVhY3QkdXNlU3RhdGUxMiA9IF9zbGljZWRUb0FycmF5MihfUmVhY3QkdXNlU3RhdGUxMSwgMSksbG9hZCA9IF9SZWFjdCR1c2VTdGF0ZTEyWzBdOwogICAgICAgICAgICB2YXIgc3VibWl0ID0gdXNlU3VibWl0SW1wbChmZXRjaGVyS2V5LCByb3V0ZUlkKTsKICAgICAgICAgICAgdmFyIGZldGNoZXIgPSByb3V0ZXIuZ2V0RmV0Y2hlcihmZXRjaGVyS2V5KTsKICAgICAgICAgICAgdmFyIGZldGNoZXJXaXRoQ29tcG9uZW50cyA9IFJlYWN0LnVzZU1lbW8oKCkgPT4gcmVhY3Rfcm91dGVyX2RvbV9kaXN0X2V4dGVuZHMoewogICAgICAgICAgICAgIEZvcm06IEZvcm0sCiAgICAgICAgICAgICAgc3VibWl0OiBzdWJtaXQsCiAgICAgICAgICAgICAgbG9hZDogbG9hZAogICAgICAgICAgICB9LCBmZXRjaGVyKSwgW2ZldGNoZXIsIEZvcm0sIHN1Ym1pdCwgbG9hZF0pOwogICAgICAgICAgICBSZWFjdC51c2VFZmZlY3QoKCkgPT4gewogICAgICAgICAgICAgIC8vIElzIHRoaXMgYnVzdGVkIHdoZW4gdGhlIFJlYWN0IHRlYW0gZ2V0cyByZWFsIHdlaXJkIGFuZCBjYWxscyBlZmZlY3RzCiAgICAgICAgICAgICAgLy8gdHdpY2Ugb24gbW91bnQ/ICBXZSByZWFsbHkganVzdCBuZWVkIHRvIGdhcmJhZ2UgY29sbGVjdCBoZXJlIHdoZW4gdGhpcwogICAgICAgICAgICAgIC8vIGZldGNoZXIgaXMgbm8gbG9uZ2VyIGFyb3VuZC4KICAgICAgICAgICAgICByZXR1cm4gKCkgPT4gewogICAgICAgICAgICAgICAgaWYgKCFyb3V0ZXIpIHsKICAgICAgICAgICAgICAgICAgY29uc29sZS53YXJuKCJObyBmZXRjaGVyIGF2YWlsYWJsZSB0byBjbGVhbiB1cCBmcm9tIHVzZUZldGNoZXIoKSIpOwogICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgcm91dGVyLmRlbGV0ZUZldGNoZXIoZmV0Y2hlcktleSk7CiAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgfSwgW3JvdXRlciwgZmV0Y2hlcktleV0pOwogICAgICAgICAgICByZXR1cm4gZmV0Y2hlcldpdGhDb21wb25lbnRzOwogICAgICAgICAgfQogICAgICAgICAgLyoqCiAgICAgICAgICAgKiBQcm92aWRlcyBhbGwgZmV0Y2hlcnMgY3VycmVudGx5IG9uIHRoZSBwYWdlLiBVc2VmdWwgZm9yIGxheW91dHMgYW5kIHBhcmVudAogICAgICAgICAgICogcm91dGVzIHRoYXQgbmVlZCB0byBwcm92aWRlIHBlbmRpbmcvb3B0aW1pc3RpYyBVSSByZWdhcmRpbmcgdGhlIGZldGNoLgogICAgICAgICAgICovCgogICAgICAgICAgZnVuY3Rpb24gdXNlRmV0Y2hlcnMoKSB7CiAgICAgICAgICAgIHZhciBzdGF0ZSA9IGRpc3RfdXNlRGF0YVJvdXRlclN0YXRlKGRpc3RfRGF0YVJvdXRlclN0YXRlSG9vay5Vc2VGZXRjaGVycyk7CiAgICAgICAgICAgIHJldHVybiBfdG9Db25zdW1hYmxlQXJyYXkyKHN0YXRlLmZldGNoZXJzLnZhbHVlcygpKTsKICAgICAgICAgIH0KICAgICAgICAgIHZhciBTQ1JPTExfUkVTVE9SQVRJT05fU1RPUkFHRV9LRVkgPSAicmVhY3Qtcm91dGVyLXNjcm9sbC1wb3NpdGlvbnMiOwogICAgICAgICAgdmFyIHNhdmVkU2Nyb2xsUG9zaXRpb25zID0ge307CiAgICAgICAgICAvKioKICAgICAgICAgICAqIFdoZW4gcmVuZGVyZWQgaW5zaWRlIGEgUm91dGVyUHJvdmlkZXIsIHdpbGwgcmVzdG9yZSBzY3JvbGwgcG9zaXRpb25zIG9uIG5hdmlnYXRpb25zCiAgICAgICAgICAgKi8KCiAgICAgICAgICBmdW5jdGlvbiB1c2VTY3JvbGxSZXN0b3JhdGlvbihfdGVtcDMpIHsKICAgICAgICAgICAgdmFyIF9yZWYzMCA9CgoKICAgICAgICAgICAgICBfdGVtcDMgPT09IHZvaWQgMCA/IHt9IDogX3RlbXAzLGdldEtleSA9IF9yZWYzMC5nZXRLZXksc3RvcmFnZUtleSA9IF9yZWYzMC5zdG9yYWdlS2V5OwogICAgICAgICAgICB2YXIgX2Rpc3RfdXNlRGF0YVJvdXRlckNvMyA9CgogICAgICAgICAgICAgIGRpc3RfdXNlRGF0YVJvdXRlckNvbnRleHQoZGlzdF9EYXRhUm91dGVySG9vay5Vc2VTY3JvbGxSZXN0b3JhdGlvbikscm91dGVyID0gX2Rpc3RfdXNlRGF0YVJvdXRlckNvMy5yb3V0ZXI7CiAgICAgICAgICAgIHZhciBfZGlzdF91c2VEYXRhUm91dGVyU3QgPQoKCiAgICAgICAgICAgICAgZGlzdF91c2VEYXRhUm91dGVyU3RhdGUoZGlzdF9EYXRhUm91dGVyU3RhdGVIb29rLlVzZVNjcm9sbFJlc3RvcmF0aW9uKSxyZXN0b3JlU2Nyb2xsUG9zaXRpb24gPSBfZGlzdF91c2VEYXRhUm91dGVyU3QucmVzdG9yZVNjcm9sbFBvc2l0aW9uLHByZXZlbnRTY3JvbGxSZXNldCA9IF9kaXN0X3VzZURhdGFSb3V0ZXJTdC5wcmV2ZW50U2Nyb2xsUmVzZXQ7CiAgICAgICAgICAgIHZhciBsb2NhdGlvbiA9IHVzZUxvY2F0aW9uKCk7CiAgICAgICAgICAgIHZhciBtYXRjaGVzID0gdXNlTWF0Y2hlcygpOwogICAgICAgICAgICB2YXIgbmF2aWdhdGlvbiA9IHVzZU5hdmlnYXRpb24oKTsgLy8gVHJpZ2dlciBtYW51YWwgc2Nyb2xsIHJlc3RvcmF0aW9uIHdoaWxlIHdlJ3JlIGFjdGl2ZQoKICAgICAgICAgICAgUmVhY3QudXNlRWZmZWN0KCgpID0+IHsKICAgICAgICAgICAgICB3aW5kb3cuaGlzdG9yeS5zY3JvbGxSZXN0b3JhdGlvbiA9ICJtYW51YWwiOwogICAgICAgICAgICAgIHJldHVybiAoKSA9PiB7CiAgICAgICAgICAgICAgICB3aW5kb3cuaGlzdG9yeS5zY3JvbGxSZXN0b3JhdGlvbiA9ICJhdXRvIjsKICAgICAgICAgICAgICB9OwogICAgICAgICAgICB9LCBbXSk7IC8vIFNhdmUgcG9zaXRpb25zIG9uIHVubG9hZAoKICAgICAgICAgICAgdXNlQmVmb3JlVW5sb2FkKFJlYWN0LnVzZUNhbGxiYWNrKCgpID0+IHsKICAgICAgICAgICAgICBpZiAobmF2aWdhdGlvbi5zdGF0ZSA9PT0gImlkbGUiKSB7CiAgICAgICAgICAgICAgICB2YXIga2V5ID0gKGdldEtleSA/IGdldEtleShsb2NhdGlvbiwgbWF0Y2hlcykgOiBudWxsKSB8fCBsb2NhdGlvbi5rZXk7CiAgICAgICAgICAgICAgICBzYXZlZFNjcm9sbFBvc2l0aW9uc1trZXldID0gd2luZG93LnNjcm9sbFk7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBzZXNzaW9uU3RvcmFnZS5zZXRJdGVtKHN0b3JhZ2VLZXkgfHwgU0NST0xMX1JFU1RPUkFUSU9OX1NUT1JBR0VfS0VZLCBKU09OLnN0cmluZ2lmeShzYXZlZFNjcm9sbFBvc2l0aW9ucykpOwogICAgICAgICAgICAgIHdpbmRvdy5oaXN0b3J5LnNjcm9sbFJlc3RvcmF0aW9uID0gImF1dG8iOwogICAgICAgICAgICB9LCBbc3RvcmFnZUtleSwgZ2V0S2V5LCBuYXZpZ2F0aW9uLnN0YXRlLCBsb2NhdGlvbiwgbWF0Y2hlc10pKTsgLy8gUmVhZCBpbiBhbnkgc2F2ZWQgc2Nyb2xsIGxvY2F0aW9ucwoKICAgICAgICAgICAgUmVhY3QudXNlTGF5b3V0RWZmZWN0KCgpID0+IHsKICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgdmFyIHNlc3Npb25Qb3NpdGlvbnMgPSBzZXNzaW9uU3RvcmFnZS5nZXRJdGVtKHN0b3JhZ2VLZXkgfHwgU0NST0xMX1JFU1RPUkFUSU9OX1NUT1JBR0VfS0VZKTsKCiAgICAgICAgICAgICAgICBpZiAoc2Vzc2lvblBvc2l0aW9ucykgewogICAgICAgICAgICAgICAgICBzYXZlZFNjcm9sbFBvc2l0aW9ucyA9IEpTT04ucGFyc2Uoc2Vzc2lvblBvc2l0aW9ucyk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgICAgICAgICAgLy8gbm8tb3AsIHVzZSBkZWZhdWx0IGVtcHR5IG9iamVjdAogICAgICAgICAgICAgIH19LCBbc3RvcmFnZUtleV0pOyAvLyBFbmFibGUgc2Nyb2xsIHJlc3RvcmF0aW9uIGluIHRoZSByb3V0ZXIKCiAgICAgICAgICAgIFJlYWN0LnVzZUxheW91dEVmZmVjdCgoKSA9PiB7CiAgICAgICAgICAgICAgdmFyIGRpc2FibGVTY3JvbGxSZXN0b3JhdGlvbiA9IHJvdXRlciA9PSBudWxsID8gdm9pZCAwIDogcm91dGVyLmVuYWJsZVNjcm9sbFJlc3RvcmF0aW9uKHNhdmVkU2Nyb2xsUG9zaXRpb25zLCAoKSA9PiB3aW5kb3cuc2Nyb2xsWSwgZ2V0S2V5KTsKICAgICAgICAgICAgICByZXR1cm4gKCkgPT4gZGlzYWJsZVNjcm9sbFJlc3RvcmF0aW9uICYmIGRpc2FibGVTY3JvbGxSZXN0b3JhdGlvbigpOwogICAgICAgICAgICB9LCBbcm91dGVyLCBnZXRLZXldKTsgLy8gUmVzdG9yZSBzY3JvbGxpbmcgd2hlbiBzdGF0ZS5yZXN0b3JlU2Nyb2xsUG9zaXRpb24gY2hhbmdlcwoKICAgICAgICAgICAgUmVhY3QudXNlTGF5b3V0RWZmZWN0KCgpID0+IHsKICAgICAgICAgICAgICAvLyBFeHBsaWNpdCBmYWxzZSBtZWFucyBkb24ndCBkbyBhbnl0aGluZyAodXNlZCBmb3Igc3VibWlzc2lvbnMpCiAgICAgICAgICAgICAgaWYgKHJlc3RvcmVTY3JvbGxQb3NpdGlvbiA9PT0gZmFsc2UpIHsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICB9IC8vIGJlZW4gaGVyZSBiZWZvcmUsIHNjcm9sbCB0byBpdAoKCiAgICAgICAgICAgICAgaWYgKHR5cGVvZiByZXN0b3JlU2Nyb2xsUG9zaXRpb24gPT09ICJudW1iZXIiKSB7CiAgICAgICAgICAgICAgICB3aW5kb3cuc2Nyb2xsVG8oMCwgcmVzdG9yZVNjcm9sbFBvc2l0aW9uKTsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICB9IC8vIHRyeSB0byBzY3JvbGwgdG8gdGhlIGhhc2gKCgogICAgICAgICAgICAgIGlmIChsb2NhdGlvbi5oYXNoKSB7CiAgICAgICAgICAgICAgICB2YXIgZWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChsb2NhdGlvbi5oYXNoLnNsaWNlKDEpKTsKCiAgICAgICAgICAgICAgICBpZiAoZWwpIHsKICAgICAgICAgICAgICAgICAgZWwuc2Nyb2xsSW50b1ZpZXcoKTsKICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0gLy8gT3B0IG91dCBvZiBzY3JvbGwgcmVzZXQgaWYgdGhpcyBsaW5rIHJlcXVlc3RlZCBpdAoKCiAgICAgICAgICAgICAgaWYgKHByZXZlbnRTY3JvbGxSZXNldCA9PT0gdHJ1ZSkgewogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgIH0gLy8gb3RoZXJ3aXNlIGdvIHRvIHRoZSB0b3Agb24gbmV3IGxvY2F0aW9ucwoKCiAgICAgICAgICAgICAgd2luZG93LnNjcm9sbFRvKDAsIDApOwogICAgICAgICAgICB9LCBbbG9jYXRpb24sIHJlc3RvcmVTY3JvbGxQb3NpdGlvbiwgcHJldmVudFNjcm9sbFJlc2V0XSk7CiAgICAgICAgICB9CgogICAgICAgICAgZnVuY3Rpb24gdXNlQmVmb3JlVW5sb2FkKGNhbGxiYWNrKSB7CiAgICAgICAgICAgIFJlYWN0LnVzZUVmZmVjdCgoKSA9PiB7CiAgICAgICAgICAgICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoImJlZm9yZXVubG9hZCIsIGNhbGxiYWNrKTsKICAgICAgICAgICAgICByZXR1cm4gKCkgPT4gewogICAgICAgICAgICAgICAgd2luZG93LnJlbW92ZUV2ZW50TGlzdGVuZXIoImJlZm9yZXVubG9hZCIsIGNhbGxiYWNrKTsKICAgICAgICAgICAgICB9OwogICAgICAgICAgICB9LCBbY2FsbGJhY2tdKTsKICAgICAgICAgIH0gLy8jZW5kcmVnaW9uCiAgICAgICAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwogICAgICAgICAgLy8jcmVnaW9uIFV0aWxzCiAgICAgICAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwoKCiAgICAgICAgICBmdW5jdGlvbiBkaXN0X3dhcm5pbmcoY29uZCwgbWVzc2FnZSkgewogICAgICAgICAgICBpZiAoIWNvbmQpIHsKICAgICAgICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tY29uc29sZQogICAgICAgICAgICAgIGlmICh0eXBlb2YgY29uc29sZSAhPT0gInVuZGVmaW5lZCIpIGNvbnNvbGUud2FybihtZXNzYWdlKTsKCiAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIC8vIFdlbGNvbWUgdG8gZGVidWdnaW5nIFJlYWN0IFJvdXRlciEKICAgICAgICAgICAgICAgIC8vCiAgICAgICAgICAgICAgICAvLyBUaGlzIGVycm9yIGlzIHRocm93biBhcyBhIGNvbnZlbmllbmNlIHNvIHlvdSBjYW4gbW9yZSBlYXNpbHkKICAgICAgICAgICAgICAgIC8vIGZpbmQgdGhlIHNvdXJjZSBmb3IgYSB3YXJuaW5nIHRoYXQgYXBwZWFycyBpbiB0aGUgY29uc29sZSBieQogICAgICAgICAgICAgICAgLy8gZW5hYmxpbmcgInBhdXNlIG9uIGV4Y2VwdGlvbnMiIGluIHlvdXIgSmF2YVNjcmlwdCBkZWJ1Z2dlci4KICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihtZXNzYWdlKTsgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG5vLWVtcHR5CiAgICAgICAgICAgICAgfSBjYXRjaCAoZSkge30KICAgICAgICAgICAgfQogICAgICAgICAgfSAvLyNlbmRyZWdpb24KCgoKCiAgICAgICAgICA7IC8vIENPTkNBVEVOQVRFRCBNT0RVTEU6IC4vc3JjL3JlbGF5L2NvbXBvbmVudHMvTGF5b3V0LnRzeAoKCgoKICAgICAgICAgIHZhciBMYXlvdXQgPSBmdW5jdGlvbiBMYXlvdXQoX3JlZikge3ZhciBwYWdlcyA9IF9yZWYucGFnZXM7CiAgICAgICAgICAgIHZhciBvdXRsZXQgPSAvKiNfX1BVUkVfXyovCiAgICAgICAgICAgIHJlYWN0LmNyZWF0ZUVsZW1lbnQocmVhY3QuRnJhZ21lbnQsIG51bGwsIC8qI19fUFVSRV9fKi8KICAgICAgICAgICAgcmVhY3QuY3JlYXRlRWxlbWVudCgiZGl2IiwgeyBpZDogIm5vdGlmaWNhdGlvbnNDb250YWluZXIiIH0pLCAvKiNfX1BVUkVfXyovCiAgICAgICAgICAgIHJlYWN0LmNyZWF0ZUVsZW1lbnQoImRpdiIsIHsgaWQ6ICJyZWxheUNvbnRhaW5lciIgfSwgLyojX19QVVJFX18qLwogICAgICAgICAgICByZWFjdC5jcmVhdGVFbGVtZW50KE91dGxldCwgbnVsbCkpKTsKCgoKCiAgICAgICAgICAgIGlmIChwYWdlcy5sZW5ndGggPD0gMSkgewogICAgICAgICAgICAgIHJldHVybiBvdXRsZXQ7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybiAvKiNfX1BVUkVfXyovKAogICAgICAgICAgICAgIHJlYWN0LmNyZWF0ZUVsZW1lbnQocmVhY3QuRnJhZ21lbnQsIG51bGwsCiAgICAgICAgICAgICAgIiAiLCAvKiNfX1BVUkVfXyovCiAgICAgICAgICAgICAgcmVhY3QuY3JlYXRlRWxlbWVudCgibmF2IiwgbnVsbCwgLyojX19QVVJFX18qLwogICAgICAgICAgICAgIHJlYWN0LmNyZWF0ZUVsZW1lbnQoImRpdiIsIHsgY2xhc3NOYW1lOiAidG9wQmFyIiB9LAogICAgICAgICAgICAgICIgIiwKICAgICAgICAgICAgICBwYWdlcy5tYXAoZnVuY3Rpb24gKHAsIGluZGV4KSB7cmV0dXJuIC8qI19fUFVSRV9fKi8oCiAgICAgICAgICAgICAgICAgIHJlYWN0LmNyZWF0ZUVsZW1lbnQoImRpdiIsIHsga2V5OiBpbmRleCwgY2xhc3NOYW1lOiAidGFiRW50cnkiIH0sIC8qI19fUFVSRV9fKi8KICAgICAgICAgICAgICAgICAgcmVhY3QuY3JlYXRlRWxlbWVudChOYXZMaW5rLCB7IHRvOiAiLyIgKyBwLmZpbGUgfSwgcC5wYWdlKSwgIiAiKSk7fSkpKSwKCgoKICAgICAgICAgICAgICAiICIsCiAgICAgICAgICAgICAgb3V0bGV0KSk7CgoKICAgICAgICAgIH07CgogICAgICAgICAgLyogaGFybW9ueSBkZWZhdWx0IGV4cG9ydCAqL3ZhciBjb21wb25lbnRzX0xheW91dCA9IExheW91dDsKICAgICAgICAgIDsgLy8gQ09OQ0FURU5BVEVEIE1PRFVMRTogLi9zcmMvcmVsYXkvYXBpL0FwaVJlcXVlc3QudHN4CiAgICAgICAgICBmdW5jdGlvbiBfdHlwZW9mKG9iaikgeyJAYmFiZWwvaGVscGVycyAtIHR5cGVvZiI7cmV0dXJuIF90eXBlb2YgPSAiZnVuY3Rpb24iID09IHR5cGVvZiBTeW1ib2wgJiYgInN5bWJvbCIgPT0gdHlwZW9mIFN5bWJvbC5pdGVyYXRvciA/IGZ1bmN0aW9uIChvYmopIHtyZXR1cm4gdHlwZW9mIG9iajt9IDogZnVuY3Rpb24gKG9iaikge3JldHVybiBvYmogJiYgImZ1bmN0aW9uIiA9PSB0eXBlb2YgU3ltYm9sICYmIG9iai5jb25zdHJ1Y3RvciA9PT0gU3ltYm9sICYmIG9iaiAhPT0gU3ltYm9sLnByb3RvdHlwZSA/ICJzeW1ib2wiIDogdHlwZW9mIG9iajt9LCBfdHlwZW9mKG9iaik7fWZ1bmN0aW9uIF9yZWdlbmVyYXRvclJ1bnRpbWUoKSB7InVzZSBzdHJpY3QiOwogICAgICAgICAgICAvKiEgcmVnZW5lcmF0b3ItcnVudGltZSAtLSBDb3B5cmlnaHQgKGMpIDIwMTQtcHJlc2VudCwgRmFjZWJvb2ssIEluYy4gLS0gbGljZW5zZSAoTUlUKTogaHR0cHM6Ly9naXRodWIuY29tL2ZhY2Vib29rL3JlZ2VuZXJhdG9yL2Jsb2IvbWFpbi9MSUNFTlNFICovX3JlZ2VuZXJhdG9yUnVudGltZSA9IGZ1bmN0aW9uIF9yZWdlbmVyYXRvclJ1bnRpbWUoKSB7cmV0dXJuIGV4cG9ydHM7fTt2YXIgZXhwb3J0cyA9IHt9LE9wID0gT2JqZWN0LnByb3RvdHlwZSxoYXNPd24gPSBPcC5oYXNPd25Qcm9wZXJ0eSxkZWZpbmVQcm9wZXJ0eSA9IE9iamVjdC5kZWZpbmVQcm9wZXJ0eSB8fCBmdW5jdGlvbiAob2JqLCBrZXksIGRlc2MpIHtvYmpba2V5XSA9IGRlc2MudmFsdWU7fSwkU3ltYm9sID0gImZ1bmN0aW9uIiA9PSB0eXBlb2YgU3ltYm9sID8gU3ltYm9sIDoge30saXRlcmF0b3JTeW1ib2wgPSAkU3ltYm9sLml0ZXJhdG9yIHx8ICJAQGl0ZXJhdG9yIixhc3luY0l0ZXJhdG9yU3ltYm9sID0gJFN5bWJvbC5hc3luY0l0ZXJhdG9yIHx8ICJAQGFzeW5jSXRlcmF0b3IiLHRvU3RyaW5nVGFnU3ltYm9sID0gJFN5bWJvbC50b1N0cmluZ1RhZyB8fCAiQEB0b1N0cmluZ1RhZyI7ZnVuY3Rpb24gZGVmaW5lKG9iaiwga2V5LCB2YWx1ZSkge3JldHVybiBPYmplY3QuZGVmaW5lUHJvcGVydHkob2JqLCBrZXksIHsgdmFsdWU6IHZhbHVlLCBlbnVtZXJhYmxlOiAhMCwgY29uZmlndXJhYmxlOiAhMCwgd3JpdGFibGU6ICEwIH0pLCBvYmpba2V5XTt9dHJ5IHtkZWZpbmUoe30sICIiKTt9IGNhdGNoIChlcnIpIHtkZWZpbmUgPSBmdW5jdGlvbiBkZWZpbmUob2JqLCBrZXksIHZhbHVlKSB7cmV0dXJuIG9ialtrZXldID0gdmFsdWU7fTt9ZnVuY3Rpb24gd3JhcChpbm5lckZuLCBvdXRlckZuLCBzZWxmLCB0cnlMb2NzTGlzdCkge3ZhciBwcm90b0dlbmVyYXRvciA9IG91dGVyRm4gJiYgb3V0ZXJGbi5wcm90b3R5cGUgaW5zdGFuY2VvZiBHZW5lcmF0b3IgPyBvdXRlckZuIDogR2VuZXJhdG9yLGdlbmVyYXRvciA9IE9iamVjdC5jcmVhdGUocHJvdG9HZW5lcmF0b3IucHJvdG90eXBlKSxjb250ZXh0ID0gbmV3IENvbnRleHQodHJ5TG9jc0xpc3QgfHwgW10pO3JldHVybiBkZWZpbmVQcm9wZXJ0eShnZW5lcmF0b3IsICJfaW52b2tlIiwgeyB2YWx1ZTogbWFrZUludm9rZU1ldGhvZChpbm5lckZuLCBzZWxmLCBjb250ZXh0KSB9KSwgZ2VuZXJhdG9yO31mdW5jdGlvbiB0cnlDYXRjaChmbiwgb2JqLCBhcmcpIHt0cnkge3JldHVybiB7IHR5cGU6ICJub3JtYWwiLCBhcmc6IGZuLmNhbGwob2JqLCBhcmcpIH07fSBjYXRjaCAoZXJyKSB7cmV0dXJuIHsgdHlwZTogInRocm93IiwgYXJnOiBlcnIgfTt9fWV4cG9ydHMud3JhcCA9IHdyYXA7dmFyIENvbnRpbnVlU2VudGluZWwgPSB7fTtmdW5jdGlvbiBHZW5lcmF0b3IoKSB7fWZ1bmN0aW9uIEdlbmVyYXRvckZ1bmN0aW9uKCkge31mdW5jdGlvbiBHZW5lcmF0b3JGdW5jdGlvblByb3RvdHlwZSgpIHt9dmFyIEl0ZXJhdG9yUHJvdG90eXBlID0ge307ZGVmaW5lKEl0ZXJhdG9yUHJvdG90eXBlLCBpdGVyYXRvclN5bWJvbCwgZnVuY3Rpb24gKCkge3JldHVybiB0aGlzO30pO3ZhciBnZXRQcm90byA9IE9iamVjdC5nZXRQcm90b3R5cGVPZixOYXRpdmVJdGVyYXRvclByb3RvdHlwZSA9IGdldFByb3RvICYmIGdldFByb3RvKGdldFByb3RvKHZhbHVlcyhbXSkpKTtOYXRpdmVJdGVyYXRvclByb3RvdHlwZSAmJiBOYXRpdmVJdGVyYXRvclByb3RvdHlwZSAhPT0gT3AgJiYgaGFzT3duLmNhbGwoTmF0aXZlSXRlcmF0b3JQcm90b3R5cGUsIGl0ZXJhdG9yU3ltYm9sKSAmJiAoSXRlcmF0b3JQcm90b3R5cGUgPSBOYXRpdmVJdGVyYXRvclByb3RvdHlwZSk7dmFyIEdwID0gR2VuZXJhdG9yRnVuY3Rpb25Qcm90b3R5cGUucHJvdG90eXBlID0gR2VuZXJhdG9yLnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoSXRlcmF0b3JQcm90b3R5cGUpO2Z1bmN0aW9uIGRlZmluZUl0ZXJhdG9yTWV0aG9kcyhwcm90b3R5cGUpIHtbIm5leHQiLCAidGhyb3ciLCAicmV0dXJuIl0uZm9yRWFjaChmdW5jdGlvbiAobWV0aG9kKSB7ZGVmaW5lKHByb3RvdHlwZSwgbWV0aG9kLCBmdW5jdGlvbiAoYXJnKSB7cmV0dXJuIHRoaXMuX2ludm9rZShtZXRob2QsIGFyZyk7fSk7fSk7fWZ1bmN0aW9uIEFzeW5jSXRlcmF0b3IoZ2VuZXJhdG9yLCBQcm9taXNlSW1wbCkge2Z1bmN0aW9uIGludm9rZShtZXRob2QsIGFyZywgcmVzb2x2ZSwgcmVqZWN0KSB7dmFyIHJlY29yZCA9IHRyeUNhdGNoKGdlbmVyYXRvclttZXRob2RdLCBnZW5lcmF0b3IsIGFyZyk7aWYgKCJ0aHJvdyIgIT09IHJlY29yZC50eXBlKSB7dmFyIHJlc3VsdCA9IHJlY29yZC5hcmcsdmFsdWUgPSByZXN1bHQudmFsdWU7cmV0dXJuIHZhbHVlICYmICJvYmplY3QiID09IF90eXBlb2YodmFsdWUpICYmIGhhc093bi5jYWxsKHZhbHVlLCAiX19hd2FpdCIpID8gUHJvbWlzZUltcGwucmVzb2x2ZSh2YWx1ZS5fX2F3YWl0KS50aGVuKGZ1bmN0aW9uICh2YWx1ZSkge2ludm9rZSgibmV4dCIsIHZhbHVlLCByZXNvbHZlLCByZWplY3QpO30sIGZ1bmN0aW9uIChlcnIpIHtpbnZva2UoInRocm93IiwgZXJyLCByZXNvbHZlLCByZWplY3QpO30pIDogUHJvbWlzZUltcGwucmVzb2x2ZSh2YWx1ZSkudGhlbihmdW5jdGlvbiAodW53cmFwcGVkKSB7cmVzdWx0LnZhbHVlID0gdW53cmFwcGVkLCByZXNvbHZlKHJlc3VsdCk7fSwgZnVuY3Rpb24gKGVycm9yKSB7cmV0dXJuIGludm9rZSgidGhyb3ciLCBlcnJvciwgcmVzb2x2ZSwgcmVqZWN0KTt9KTt9cmVqZWN0KHJlY29yZC5hcmcpO312YXIgcHJldmlvdXNQcm9taXNlO2RlZmluZVByb3BlcnR5KHRoaXMsICJfaW52b2tlIiwgeyB2YWx1ZTogZnVuY3Rpb24gdmFsdWUobWV0aG9kLCBhcmcpIHtmdW5jdGlvbiBjYWxsSW52b2tlV2l0aE1ldGhvZEFuZEFyZygpIHtyZXR1cm4gbmV3IFByb21pc2VJbXBsKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtpbnZva2UobWV0aG9kLCBhcmcsIHJlc29sdmUsIHJlamVjdCk7fSk7fXJldHVybiBwcmV2aW91c1Byb21pc2UgPSBwcmV2aW91c1Byb21pc2UgPyBwcmV2aW91c1Byb21pc2UudGhlbihjYWxsSW52b2tlV2l0aE1ldGhvZEFuZEFyZywgY2FsbEludm9rZVdpdGhNZXRob2RBbmRBcmcpIDogY2FsbEludm9rZVdpdGhNZXRob2RBbmRBcmcoKTt9IH0pO31mdW5jdGlvbiBtYWtlSW52b2tlTWV0aG9kKGlubmVyRm4sIHNlbGYsIGNvbnRleHQpIHt2YXIgc3RhdGUgPSAic3VzcGVuZGVkU3RhcnQiO3JldHVybiBmdW5jdGlvbiAobWV0aG9kLCBhcmcpIHtpZiAoImV4ZWN1dGluZyIgPT09IHN0YXRlKSB0aHJvdyBuZXcgRXJyb3IoIkdlbmVyYXRvciBpcyBhbHJlYWR5IHJ1bm5pbmciKTtpZiAoImNvbXBsZXRlZCIgPT09IHN0YXRlKSB7aWYgKCJ0aHJvdyIgPT09IG1ldGhvZCkgdGhyb3cgYXJnO3JldHVybiBkb25lUmVzdWx0KCk7fWZvciAoY29udGV4dC5tZXRob2QgPSBtZXRob2QsIGNvbnRleHQuYXJnID0gYXJnOzspIHt2YXIgZGVsZWdhdGUgPSBjb250ZXh0LmRlbGVnYXRlO2lmIChkZWxlZ2F0ZSkge3ZhciBkZWxlZ2F0ZVJlc3VsdCA9IG1heWJlSW52b2tlRGVsZWdhdGUoZGVsZWdhdGUsIGNvbnRleHQpO2lmIChkZWxlZ2F0ZVJlc3VsdCkge2lmIChkZWxlZ2F0ZVJlc3VsdCA9PT0gQ29udGludWVTZW50aW5lbCkgY29udGludWU7cmV0dXJuIGRlbGVnYXRlUmVzdWx0O319aWYgKCJuZXh0IiA9PT0gY29udGV4dC5tZXRob2QpIGNvbnRleHQuc2VudCA9IGNvbnRleHQuX3NlbnQgPSBjb250ZXh0LmFyZztlbHNlIGlmICgidGhyb3ciID09PSBjb250ZXh0Lm1ldGhvZCkge2lmICgic3VzcGVuZGVkU3RhcnQiID09PSBzdGF0ZSkgdGhyb3cgc3RhdGUgPSAiY29tcGxldGVkIiwgY29udGV4dC5hcmc7Y29udGV4dC5kaXNwYXRjaEV4Y2VwdGlvbihjb250ZXh0LmFyZyk7fSBlbHNlICJyZXR1cm4iID09PSBjb250ZXh0Lm1ldGhvZCAmJiBjb250ZXh0LmFicnVwdCgicmV0dXJuIiwgY29udGV4dC5hcmcpO3N0YXRlID0gImV4ZWN1dGluZyI7dmFyIHJlY29yZCA9IHRyeUNhdGNoKGlubmVyRm4sIHNlbGYsIGNvbnRleHQpO2lmICgibm9ybWFsIiA9PT0gcmVjb3JkLnR5cGUpIHtpZiAoc3RhdGUgPSBjb250ZXh0LmRvbmUgPyAiY29tcGxldGVkIiA6ICJzdXNwZW5kZWRZaWVsZCIsIHJlY29yZC5hcmcgPT09IENvbnRpbnVlU2VudGluZWwpIGNvbnRpbnVlO3JldHVybiB7IHZhbHVlOiByZWNvcmQuYXJnLCBkb25lOiBjb250ZXh0LmRvbmUgfTt9InRocm93IiA9PT0gcmVjb3JkLnR5cGUgJiYgKHN0YXRlID0gImNvbXBsZXRlZCIsIGNvbnRleHQubWV0aG9kID0gInRocm93IiwgY29udGV4dC5hcmcgPSByZWNvcmQuYXJnKTt9fTt9ZnVuY3Rpb24gbWF5YmVJbnZva2VEZWxlZ2F0ZShkZWxlZ2F0ZSwgY29udGV4dCkge3ZhciBtZXRob2ROYW1lID0gY29udGV4dC5tZXRob2QsbWV0aG9kID0gZGVsZWdhdGUuaXRlcmF0b3JbbWV0aG9kTmFtZV07aWYgKHVuZGVmaW5lZCA9PT0gbWV0aG9kKSByZXR1cm4gY29udGV4dC5kZWxlZ2F0ZSA9IG51bGwsICJ0aHJvdyIgPT09IG1ldGhvZE5hbWUgJiYgZGVsZWdhdGUuaXRlcmF0b3JbInJldHVybiJdICYmIChjb250ZXh0Lm1ldGhvZCA9ICJyZXR1cm4iLCBjb250ZXh0LmFyZyA9IHVuZGVmaW5lZCwgbWF5YmVJbnZva2VEZWxlZ2F0ZShkZWxlZ2F0ZSwgY29udGV4dCksICJ0aHJvdyIgPT09IGNvbnRleHQubWV0aG9kKSB8fCAicmV0dXJuIiAhPT0gbWV0aG9kTmFtZSAmJiAoY29udGV4dC5tZXRob2QgPSAidGhyb3ciLCBjb250ZXh0LmFyZyA9IG5ldyBUeXBlRXJyb3IoIlRoZSBpdGVyYXRvciBkb2VzIG5vdCBwcm92aWRlIGEgJyIgKyBtZXRob2ROYW1lICsgIicgbWV0aG9kIikpLCBDb250aW51ZVNlbnRpbmVsO3ZhciByZWNvcmQgPSB0cnlDYXRjaChtZXRob2QsIGRlbGVnYXRlLml0ZXJhdG9yLCBjb250ZXh0LmFyZyk7aWYgKCJ0aHJvdyIgPT09IHJlY29yZC50eXBlKSByZXR1cm4gY29udGV4dC5tZXRob2QgPSAidGhyb3ciLCBjb250ZXh0LmFyZyA9IHJlY29yZC5hcmcsIGNvbnRleHQuZGVsZWdhdGUgPSBudWxsLCBDb250aW51ZVNlbnRpbmVsO3ZhciBpbmZvID0gcmVjb3JkLmFyZztyZXR1cm4gaW5mbyA/IGluZm8uZG9uZSA/IChjb250ZXh0W2RlbGVnYXRlLnJlc3VsdE5hbWVdID0gaW5mby52YWx1ZSwgY29udGV4dC5uZXh0ID0gZGVsZWdhdGUubmV4dExvYywgInJldHVybiIgIT09IGNvbnRleHQubWV0aG9kICYmIChjb250ZXh0Lm1ldGhvZCA9ICJuZXh0IiwgY29udGV4dC5hcmcgPSB1bmRlZmluZWQpLCBjb250ZXh0LmRlbGVnYXRlID0gbnVsbCwgQ29udGludWVTZW50aW5lbCkgOiBpbmZvIDogKGNvbnRleHQubWV0aG9kID0gInRocm93IiwgY29udGV4dC5hcmcgPSBuZXcgVHlwZUVycm9yKCJpdGVyYXRvciByZXN1bHQgaXMgbm90IGFuIG9iamVjdCIpLCBjb250ZXh0LmRlbGVnYXRlID0gbnVsbCwgQ29udGludWVTZW50aW5lbCk7fWZ1bmN0aW9uIHB1c2hUcnlFbnRyeShsb2NzKSB7dmFyIGVudHJ5ID0geyB0cnlMb2M6IGxvY3NbMF0gfTsxIGluIGxvY3MgJiYgKGVudHJ5LmNhdGNoTG9jID0gbG9jc1sxXSksIDIgaW4gbG9jcyAmJiAoZW50cnkuZmluYWxseUxvYyA9IGxvY3NbMl0sIGVudHJ5LmFmdGVyTG9jID0gbG9jc1szXSksIHRoaXMudHJ5RW50cmllcy5wdXNoKGVudHJ5KTt9ZnVuY3Rpb24gcmVzZXRUcnlFbnRyeShlbnRyeSkge3ZhciByZWNvcmQgPSBlbnRyeS5jb21wbGV0aW9uIHx8IHt9O3JlY29yZC50eXBlID0gIm5vcm1hbCIsIGRlbGV0ZSByZWNvcmQuYXJnLCBlbnRyeS5jb21wbGV0aW9uID0gcmVjb3JkO31mdW5jdGlvbiBDb250ZXh0KHRyeUxvY3NMaXN0KSB7dGhpcy50cnlFbnRyaWVzID0gW3sgdHJ5TG9jOiAicm9vdCIgfV0sIHRyeUxvY3NMaXN0LmZvckVhY2gocHVzaFRyeUVudHJ5LCB0aGlzKSwgdGhpcy5yZXNldCghMCk7fWZ1bmN0aW9uIHZhbHVlcyhpdGVyYWJsZSkge2lmIChpdGVyYWJsZSkge3ZhciBpdGVyYXRvck1ldGhvZCA9IGl0ZXJhYmxlW2l0ZXJhdG9yU3ltYm9sXTtpZiAoaXRlcmF0b3JNZXRob2QpIHJldHVybiBpdGVyYXRvck1ldGhvZC5jYWxsKGl0ZXJhYmxlKTtpZiAoImZ1bmN0aW9uIiA9PSB0eXBlb2YgaXRlcmFibGUubmV4dCkgcmV0dXJuIGl0ZXJhYmxlO2lmICghaXNOYU4oaXRlcmFibGUubGVuZ3RoKSkge3ZhciBpID0gLTEsbmV4dCA9IGZ1bmN0aW9uIG5leHQoKSB7Zm9yICg7ICsraSA8IGl0ZXJhYmxlLmxlbmd0aDspIHtpZiAoaGFzT3duLmNhbGwoaXRlcmFibGUsIGkpKSByZXR1cm4gbmV4dC52YWx1ZSA9IGl0ZXJhYmxlW2ldLCBuZXh0LmRvbmUgPSAhMSwgbmV4dDt9cmV0dXJuIG5leHQudmFsdWUgPSB1bmRlZmluZWQsIG5leHQuZG9uZSA9ICEwLCBuZXh0O307cmV0dXJuIG5leHQubmV4dCA9IG5leHQ7fX1yZXR1cm4geyBuZXh0OiBkb25lUmVzdWx0IH07fWZ1bmN0aW9uIGRvbmVSZXN1bHQoKSB7cmV0dXJuIHsgdmFsdWU6IHVuZGVmaW5lZCwgZG9uZTogITAgfTt9cmV0dXJuIEdlbmVyYXRvckZ1bmN0aW9uLnByb3RvdHlwZSA9IEdlbmVyYXRvckZ1bmN0aW9uUHJvdG90eXBlLCBkZWZpbmVQcm9wZXJ0eShHcCwgImNvbnN0cnVjdG9yIiwgeyB2YWx1ZTogR2VuZXJhdG9yRnVuY3Rpb25Qcm90b3R5cGUsIGNvbmZpZ3VyYWJsZTogITAgfSksIGRlZmluZVByb3BlcnR5KEdlbmVyYXRvckZ1bmN0aW9uUHJvdG90eXBlLCAiY29uc3RydWN0b3IiLCB7IHZhbHVlOiBHZW5lcmF0b3JGdW5jdGlvbiwgY29uZmlndXJhYmxlOiAhMCB9KSwgR2VuZXJhdG9yRnVuY3Rpb24uZGlzcGxheU5hbWUgPSBkZWZpbmUoR2VuZXJhdG9yRnVuY3Rpb25Qcm90b3R5cGUsIHRvU3RyaW5nVGFnU3ltYm9sLCAiR2VuZXJhdG9yRnVuY3Rpb24iKSwgZXhwb3J0cy5pc0dlbmVyYXRvckZ1bmN0aW9uID0gZnVuY3Rpb24gKGdlbkZ1bikge3ZhciBjdG9yID0gImZ1bmN0aW9uIiA9PSB0eXBlb2YgZ2VuRnVuICYmIGdlbkZ1bi5jb25zdHJ1Y3RvcjtyZXR1cm4gISFjdG9yICYmIChjdG9yID09PSBHZW5lcmF0b3JGdW5jdGlvbiB8fCAiR2VuZXJhdG9yRnVuY3Rpb24iID09PSAoY3Rvci5kaXNwbGF5TmFtZSB8fCBjdG9yLm5hbWUpKTt9LCBleHBvcnRzLm1hcmsgPSBmdW5jdGlvbiAoZ2VuRnVuKSB7cmV0dXJuIE9iamVjdC5zZXRQcm90b3R5cGVPZiA/IE9iamVjdC5zZXRQcm90b3R5cGVPZihnZW5GdW4sIEdlbmVyYXRvckZ1bmN0aW9uUHJvdG90eXBlKSA6IChnZW5GdW4uX19wcm90b19fID0gR2VuZXJhdG9yRnVuY3Rpb25Qcm90b3R5cGUsIGRlZmluZShnZW5GdW4sIHRvU3RyaW5nVGFnU3ltYm9sLCAiR2VuZXJhdG9yRnVuY3Rpb24iKSksIGdlbkZ1bi5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKEdwKSwgZ2VuRnVuO30sIGV4cG9ydHMuYXdyYXAgPSBmdW5jdGlvbiAoYXJnKSB7cmV0dXJuIHsgX19hd2FpdDogYXJnIH07fSwgZGVmaW5lSXRlcmF0b3JNZXRob2RzKEFzeW5jSXRlcmF0b3IucHJvdG90eXBlKSwgZGVmaW5lKEFzeW5jSXRlcmF0b3IucHJvdG90eXBlLCBhc3luY0l0ZXJhdG9yU3ltYm9sLCBmdW5jdGlvbiAoKSB7cmV0dXJuIHRoaXM7fSksIGV4cG9ydHMuQXN5bmNJdGVyYXRvciA9IEFzeW5jSXRlcmF0b3IsIGV4cG9ydHMuYXN5bmMgPSBmdW5jdGlvbiAoaW5uZXJGbiwgb3V0ZXJGbiwgc2VsZiwgdHJ5TG9jc0xpc3QsIFByb21pc2VJbXBsKSB7dm9pZCAwID09PSBQcm9taXNlSW1wbCAmJiAoUHJvbWlzZUltcGwgPSBQcm9taXNlKTt2YXIgaXRlciA9IG5ldyBBc3luY0l0ZXJhdG9yKHdyYXAoaW5uZXJGbiwgb3V0ZXJGbiwgc2VsZiwgdHJ5TG9jc0xpc3QpLCBQcm9taXNlSW1wbCk7cmV0dXJuIGV4cG9ydHMuaXNHZW5lcmF0b3JGdW5jdGlvbihvdXRlckZuKSA/IGl0ZXIgOiBpdGVyLm5leHQoKS50aGVuKGZ1bmN0aW9uIChyZXN1bHQpIHtyZXR1cm4gcmVzdWx0LmRvbmUgPyByZXN1bHQudmFsdWUgOiBpdGVyLm5leHQoKTt9KTt9LCBkZWZpbmVJdGVyYXRvck1ldGhvZHMoR3ApLCBkZWZpbmUoR3AsIHRvU3RyaW5nVGFnU3ltYm9sLCAiR2VuZXJhdG9yIiksIGRlZmluZShHcCwgaXRlcmF0b3JTeW1ib2wsIGZ1bmN0aW9uICgpIHtyZXR1cm4gdGhpczt9KSwgZGVmaW5lKEdwLCAidG9TdHJpbmciLCBmdW5jdGlvbiAoKSB7cmV0dXJuICJbb2JqZWN0IEdlbmVyYXRvcl0iO30pLCBleHBvcnRzLmtleXMgPSBmdW5jdGlvbiAodmFsKSB7dmFyIG9iamVjdCA9IE9iamVjdCh2YWwpLGtleXMgPSBbXTtmb3IgKHZhciBrZXkgaW4gb2JqZWN0KSB7a2V5cy5wdXNoKGtleSk7fXJldHVybiBrZXlzLnJldmVyc2UoKSwgZnVuY3Rpb24gbmV4dCgpIHtmb3IgKDsga2V5cy5sZW5ndGg7KSB7dmFyIGtleSA9IGtleXMucG9wKCk7aWYgKGtleSBpbiBvYmplY3QpIHJldHVybiBuZXh0LnZhbHVlID0ga2V5LCBuZXh0LmRvbmUgPSAhMSwgbmV4dDt9cmV0dXJuIG5leHQuZG9uZSA9ICEwLCBuZXh0O307fSwgZXhwb3J0cy52YWx1ZXMgPSB2YWx1ZXMsIENvbnRleHQucHJvdG90eXBlID0geyBjb25zdHJ1Y3RvcjogQ29udGV4dCwgcmVzZXQ6IGZ1bmN0aW9uIHJlc2V0KHNraXBUZW1wUmVzZXQpIHtpZiAodGhpcy5wcmV2ID0gMCwgdGhpcy5uZXh0ID0gMCwgdGhpcy5zZW50ID0gdGhpcy5fc2VudCA9IHVuZGVmaW5lZCwgdGhpcy5kb25lID0gITEsIHRoaXMuZGVsZWdhdGUgPSBudWxsLCB0aGlzLm1ldGhvZCA9ICJuZXh0IiwgdGhpcy5hcmcgPSB1bmRlZmluZWQsIHRoaXMudHJ5RW50cmllcy5mb3JFYWNoKHJlc2V0VHJ5RW50cnkpLCAhc2tpcFRlbXBSZXNldCkgZm9yICh2YXIgbmFtZSBpbiB0aGlzKSB7InQiID09PSBuYW1lLmNoYXJBdCgwKSAmJiBoYXNPd24uY2FsbCh0aGlzLCBuYW1lKSAmJiAhaXNOYU4oK25hbWUuc2xpY2UoMSkpICYmICh0aGlzW25hbWVdID0gdW5kZWZpbmVkKTt9fSwgc3RvcDogZnVuY3Rpb24gc3RvcCgpIHt0aGlzLmRvbmUgPSAhMDt2YXIgcm9vdFJlY29yZCA9IHRoaXMudHJ5RW50cmllc1swXS5jb21wbGV0aW9uO2lmICgidGhyb3ciID09PSByb290UmVjb3JkLnR5cGUpIHRocm93IHJvb3RSZWNvcmQuYXJnO3JldHVybiB0aGlzLnJ2YWw7fSwgZGlzcGF0Y2hFeGNlcHRpb246IGZ1bmN0aW9uIGRpc3BhdGNoRXhjZXB0aW9uKGV4Y2VwdGlvbikge2lmICh0aGlzLmRvbmUpIHRocm93IGV4Y2VwdGlvbjt2YXIgY29udGV4dCA9IHRoaXM7ZnVuY3Rpb24gaGFuZGxlKGxvYywgY2F1Z2h0KSB7cmV0dXJuIHJlY29yZC50eXBlID0gInRocm93IiwgcmVjb3JkLmFyZyA9IGV4Y2VwdGlvbiwgY29udGV4dC5uZXh0ID0gbG9jLCBjYXVnaHQgJiYgKGNvbnRleHQubWV0aG9kID0gIm5leHQiLCBjb250ZXh0LmFyZyA9IHVuZGVmaW5lZCksICEhY2F1Z2h0O31mb3IgKHZhciBpID0gdGhpcy50cnlFbnRyaWVzLmxlbmd0aCAtIDE7IGkgPj0gMDsgLS1pKSB7dmFyIGVudHJ5ID0gdGhpcy50cnlFbnRyaWVzW2ldLHJlY29yZCA9IGVudHJ5LmNvbXBsZXRpb247aWYgKCJyb290IiA9PT0gZW50cnkudHJ5TG9jKSByZXR1cm4gaGFuZGxlKCJlbmQiKTtpZiAoZW50cnkudHJ5TG9jIDw9IHRoaXMucHJldikge3ZhciBoYXNDYXRjaCA9IGhhc093bi5jYWxsKGVudHJ5LCAiY2F0Y2hMb2MiKSxoYXNGaW5hbGx5ID0gaGFzT3duLmNhbGwoZW50cnksICJmaW5hbGx5TG9jIik7aWYgKGhhc0NhdGNoICYmIGhhc0ZpbmFsbHkpIHtpZiAodGhpcy5wcmV2IDwgZW50cnkuY2F0Y2hMb2MpIHJldHVybiBoYW5kbGUoZW50cnkuY2F0Y2hMb2MsICEwKTtpZiAodGhpcy5wcmV2IDwgZW50cnkuZmluYWxseUxvYykgcmV0dXJuIGhhbmRsZShlbnRyeS5maW5hbGx5TG9jKTt9IGVsc2UgaWYgKGhhc0NhdGNoKSB7aWYgKHRoaXMucHJldiA8IGVudHJ5LmNhdGNoTG9jKSByZXR1cm4gaGFuZGxlKGVudHJ5LmNhdGNoTG9jLCAhMCk7fSBlbHNlIHtpZiAoIWhhc0ZpbmFsbHkpIHRocm93IG5ldyBFcnJvcigidHJ5IHN0YXRlbWVudCB3aXRob3V0IGNhdGNoIG9yIGZpbmFsbHkiKTtpZiAodGhpcy5wcmV2IDwgZW50cnkuZmluYWxseUxvYykgcmV0dXJuIGhhbmRsZShlbnRyeS5maW5hbGx5TG9jKTt9fX19LCBhYnJ1cHQ6IGZ1bmN0aW9uIGFicnVwdCh0eXBlLCBhcmcpIHtmb3IgKHZhciBpID0gdGhpcy50cnlFbnRyaWVzLmxlbmd0aCAtIDE7IGkgPj0gMDsgLS1pKSB7dmFyIGVudHJ5ID0gdGhpcy50cnlFbnRyaWVzW2ldO2lmIChlbnRyeS50cnlMb2MgPD0gdGhpcy5wcmV2ICYmIGhhc093bi5jYWxsKGVudHJ5LCAiZmluYWxseUxvYyIpICYmIHRoaXMucHJldiA8IGVudHJ5LmZpbmFsbHlMb2MpIHt2YXIgZmluYWxseUVudHJ5ID0gZW50cnk7YnJlYWs7fX1maW5hbGx5RW50cnkgJiYgKCJicmVhayIgPT09IHR5cGUgfHwgImNvbnRpbnVlIiA9PT0gdHlwZSkgJiYgZmluYWxseUVudHJ5LnRyeUxvYyA8PSBhcmcgJiYgYXJnIDw9IGZpbmFsbHlFbnRyeS5maW5hbGx5TG9jICYmIChmaW5hbGx5RW50cnkgPSBudWxsKTt2YXIgcmVjb3JkID0gZmluYWxseUVudHJ5ID8gZmluYWxseUVudHJ5LmNvbXBsZXRpb24gOiB7fTtyZXR1cm4gcmVjb3JkLnR5cGUgPSB0eXBlLCByZWNvcmQuYXJnID0gYXJnLCBmaW5hbGx5RW50cnkgPyAodGhpcy5tZXRob2QgPSAibmV4dCIsIHRoaXMubmV4dCA9IGZpbmFsbHlFbnRyeS5maW5hbGx5TG9jLCBDb250aW51ZVNlbnRpbmVsKSA6IHRoaXMuY29tcGxldGUocmVjb3JkKTt9LCBjb21wbGV0ZTogZnVuY3Rpb24gY29tcGxldGUocmVjb3JkLCBhZnRlckxvYykge2lmICgidGhyb3ciID09PSByZWNvcmQudHlwZSkgdGhyb3cgcmVjb3JkLmFyZztyZXR1cm4gImJyZWFrIiA9PT0gcmVjb3JkLnR5cGUgfHwgImNvbnRpbnVlIiA9PT0gcmVjb3JkLnR5cGUgPyB0aGlzLm5leHQgPSByZWNvcmQuYXJnIDogInJldHVybiIgPT09IHJlY29yZC50eXBlID8gKHRoaXMucnZhbCA9IHRoaXMuYXJnID0gcmVjb3JkLmFyZywgdGhpcy5tZXRob2QgPSAicmV0dXJuIiwgdGhpcy5uZXh0ID0gImVuZCIpIDogIm5vcm1hbCIgPT09IHJlY29yZC50eXBlICYmIGFmdGVyTG9jICYmICh0aGlzLm5leHQgPSBhZnRlckxvYyksIENvbnRpbnVlU2VudGluZWw7fSwgZmluaXNoOiBmdW5jdGlvbiBmaW5pc2goZmluYWxseUxvYykge2ZvciAodmFyIGkgPSB0aGlzLnRyeUVudHJpZXMubGVuZ3RoIC0gMTsgaSA+PSAwOyAtLWkpIHt2YXIgZW50cnkgPSB0aGlzLnRyeUVudHJpZXNbaV07aWYgKGVudHJ5LmZpbmFsbHlMb2MgPT09IGZpbmFsbHlMb2MpIHJldHVybiB0aGlzLmNvbXBsZXRlKGVudHJ5LmNvbXBsZXRpb24sIGVudHJ5LmFmdGVyTG9jKSwgcmVzZXRUcnlFbnRyeShlbnRyeSksIENvbnRpbnVlU2VudGluZWw7fX0sICJjYXRjaCI6IGZ1bmN0aW9uIF9jYXRjaCh0cnlMb2MpIHtmb3IgKHZhciBpID0gdGhpcy50cnlFbnRyaWVzLmxlbmd0aCAtIDE7IGkgPj0gMDsgLS1pKSB7dmFyIGVudHJ5ID0gdGhpcy50cnlFbnRyaWVzW2ldO2lmIChlbnRyeS50cnlMb2MgPT09IHRyeUxvYykge3ZhciByZWNvcmQgPSBlbnRyeS5jb21wbGV0aW9uO2lmICgidGhyb3ciID09PSByZWNvcmQudHlwZSkge3ZhciB0aHJvd24gPSByZWNvcmQuYXJnO3Jlc2V0VHJ5RW50cnkoZW50cnkpO31yZXR1cm4gdGhyb3duO319dGhyb3cgbmV3IEVycm9yKCJpbGxlZ2FsIGNhdGNoIGF0dGVtcHQiKTt9LCBkZWxlZ2F0ZVlpZWxkOiBmdW5jdGlvbiBkZWxlZ2F0ZVlpZWxkKGl0ZXJhYmxlLCByZXN1bHROYW1lLCBuZXh0TG9jKSB7cmV0dXJuIHRoaXMuZGVsZWdhdGUgPSB7IGl0ZXJhdG9yOiB2YWx1ZXMoaXRlcmFibGUpLCByZXN1bHROYW1lOiByZXN1bHROYW1lLCBuZXh0TG9jOiBuZXh0TG9jIH0sICJuZXh0IiA9PT0gdGhpcy5tZXRob2QgJiYgKHRoaXMuYXJnID0gdW5kZWZpbmVkKSwgQ29udGludWVTZW50aW5lbDt9IH0sIGV4cG9ydHM7fWZ1bmN0aW9uIGFzeW5jR2VuZXJhdG9yU3RlcChnZW4sIHJlc29sdmUsIHJlamVjdCwgX25leHQsIF90aHJvdywga2V5LCBhcmcpIHt0cnkge3ZhciBpbmZvID0gZ2VuW2tleV0oYXJnKTt2YXIgdmFsdWUgPSBpbmZvLnZhbHVlO30gY2F0Y2ggKGVycm9yKSB7cmVqZWN0KGVycm9yKTtyZXR1cm47fWlmIChpbmZvLmRvbmUpIHtyZXNvbHZlKHZhbHVlKTt9IGVsc2Uge1Byb21pc2UucmVzb2x2ZSh2YWx1ZSkudGhlbihfbmV4dCwgX3Rocm93KTt9fWZ1bmN0aW9uIF9hc3luY1RvR2VuZXJhdG9yKGZuKSB7cmV0dXJuIGZ1bmN0aW9uICgpIHt2YXIgc2VsZiA9IHRoaXMsYXJncyA9IGFyZ3VtZW50cztyZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge3ZhciBnZW4gPSBmbi5hcHBseShzZWxmLCBhcmdzKTtmdW5jdGlvbiBfbmV4dCh2YWx1ZSkge2FzeW5jR2VuZXJhdG9yU3RlcChnZW4sIHJlc29sdmUsIHJlamVjdCwgX25leHQsIF90aHJvdywgIm5leHQiLCB2YWx1ZSk7fWZ1bmN0aW9uIF90aHJvdyhlcnIpIHthc3luY0dlbmVyYXRvclN0ZXAoZ2VuLCByZXNvbHZlLCByZWplY3QsIF9uZXh0LCBfdGhyb3csICJ0aHJvdyIsIGVycik7fV9uZXh0KHVuZGVmaW5lZCk7fSk7fTt9CiAgICAgICAgICBmdW5jdGlvbiBhZGROb3RpZmljYXRpb24obm90aWZpY2F0aW9uKSB7CiAgICAgICAgICAgIHZhciBlbGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKTsKICAgICAgICAgICAgZWxlLmNsYXNzTmFtZSA9ICJub3RpZmljYXRpb24iOwogICAgICAgICAgICBlbGUuYWRkRXZlbnRMaXN0ZW5lcigiYW5pbWF0aW9uZW5kIiwgZnVuY3Rpb24gKCkge3JldHVybiBlbGUucmVtb3ZlKCk7fSk7CiAgICAgICAgICAgIGVsZS5pbm5lclRleHQgPSBub3RpZmljYXRpb247CgogICAgICAgICAgICB2YXIgY29udGFpbmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoIm5vdGlmaWNhdGlvbnNDb250YWluZXIiKTsKCiAgICAgICAgICAgIGlmICghY29udGFpbmVyKSB7CiAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CgogICAgICAgICAgICBjb250YWluZXIuYXBwZW5kQ2hpbGQoZWxlKTsKICAgICAgICAgIH0KCiAgICAgICAgICBmdW5jdGlvbiBzYXZlU2V0dGluZ3MoCiAgICAgICAgICBwcm9wZXJ0aWVzKQogICAgICAgICAgewogICAgICAgICAgICByZXR1cm4gc2V0UHJvcGVydGllcygKICAgICAgICAgICAgcHJvcGVydGllcy4KICAgICAgICAgICAgZmlsdGVyKGZ1bmN0aW9uIChwKSB7CiAgICAgICAgICAgICAgaWYgKHAucHJldmlvdXNWYWx1ZSA9PT0gcC52YWx1ZSkgewogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgcC5wcmV2aW91c1ZhbHVlID0gcC52YWx1ZTsKICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgfSkuCiAgICAgICAgICAgIG1hcChmdW5jdGlvbiAocHJvcCkge3JldHVybiBbcHJvcC5wcmVmZXJlbmNlLCBwcm9wLnZhbHVlLnRyaW0oKV07fSkpOwoKICAgICAgICAgIH0KCiAgICAgICAgICBmdW5jdGlvbiBzZXRQcm9wZXJ0aWVzKAogICAgICAgICAgcHJvcGVydGllcykKICAgICAgICAgIHsKICAgICAgICAgICAgcmV0dXJuIHJ1blJlbGF5KCJzZXRQcm9wZXJ0aWVzIiwgSlNPTi5zdHJpbmdpZnkocHJvcGVydGllcykpLnRoZW4oZnVuY3Rpb24gKHZhbCkge3JldHVybiAoCiAgICAgICAgICAgICAgICBKU09OLnBhcnNlKHZhbCkpO30pOwoKICAgICAgICAgIH1mdW5jdGlvbgoKICAgICAgICAgIHJ1blJlbGF5KF94LCBfeDIpIHtyZXR1cm4gX3J1blJlbGF5LmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7fWZ1bmN0aW9uIF9ydW5SZWxheSgpIHtfcnVuUmVsYXkgPSBfYXN5bmNUb0dlbmVyYXRvciggLyojX19QVVJFX18qL19yZWdlbmVyYXRvclJ1bnRpbWUoKS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUoZm9ybU5hbWUsIHBhcmFtKSB7cmV0dXJuIF9yZWdlbmVyYXRvclJ1bnRpbWUoKS53cmFwKGZ1bmN0aW9uIF9jYWxsZWUkKF9jb250ZXh0KSB7d2hpbGUgKDEpIHtzd2l0Y2ggKF9jb250ZXh0LnByZXYgPSBfY29udGV4dC5uZXh0KSB7Y2FzZSAwOnJldHVybiBfY29udGV4dC5hYnJ1cHQoInJldHVybiIsCiAgICAgICAgICAgICAgICAgICAgICBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSkgewogICAgICAgICAgICAgICAgICAgICAgICB2YXIgeGhyID0gbmV3IFhNTEh0dHBSZXF1ZXN0KCk7CiAgICAgICAgICAgICAgICAgICAgICAgIHhoci5yZXNwb25zZVR5cGUgPSAidGV4dCI7CiAgICAgICAgICAgICAgICAgICAgICAgIHhoci5vcGVuKCJQT1NUIiwgZG9jdW1lbnQubG9jYXRpb24uaHJlZiwgdHJ1ZSk7CiAgICAgICAgICAgICAgICAgICAgICAgIHhoci5zZXRSZXF1ZXN0SGVhZGVyKCJDb250ZW50LVR5cGUiLCAiYXBwbGljYXRpb24veC13d3ctZm9ybS11cmxlbmNvZGVkIik7CiAgICAgICAgICAgICAgICAgICAgICAgIHhoci5zZW5kKGZvcm1OYW1lICsgIj0iICsgZW5jb2RlVVJJQ29tcG9uZW50KHBhcmFtKSk7CiAgICAgICAgICAgICAgICAgICAgICAgIHhoci5vbnJlYWR5c3RhdGVjaGFuZ2UgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHhoci5yZWFkeVN0YXRlICE9IDQgfHwgeGhyLnN0YXR1cyAhPSAyMDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUoeGhyLnJlc3BvbnNlVGV4dCk7CiAgICAgICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgICAgICB9KSk7Y2FzZSAxOmNhc2UgImVuZCI6cmV0dXJuIF9jb250ZXh0LnN0b3AoKTt9fX0sIF9jYWxsZWUpO30pKTtyZXR1cm4gX3J1blJlbGF5LmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7fQogICAgICAgICAgOyAvLyBDT05DQVRFTkFURUQgTU9EVUxFOiAuL3NyYy9yZWxheS9hcGkvU2V0dGluZ1ZhbGlkYXRvci50c3gKICAgICAgICAgIGZ1bmN0aW9uIFNldHRpbmdWYWxpZGF0b3JfdHlwZW9mKG9iaikgeyJAYmFiZWwvaGVscGVycyAtIHR5cGVvZiI7cmV0dXJuIFNldHRpbmdWYWxpZGF0b3JfdHlwZW9mID0gImZ1bmN0aW9uIiA9PSB0eXBlb2YgU3ltYm9sICYmICJzeW1ib2wiID09IHR5cGVvZiBTeW1ib2wuaXRlcmF0b3IgPyBmdW5jdGlvbiAob2JqKSB7cmV0dXJuIHR5cGVvZiBvYmo7fSA6IGZ1bmN0aW9uIChvYmopIHtyZXR1cm4gb2JqICYmICJmdW5jdGlvbiIgPT0gdHlwZW9mIFN5bWJvbCAmJiBvYmouY29uc3RydWN0b3IgPT09IFN5bWJvbCAmJiBvYmogIT09IFN5bWJvbC5wcm90b3R5cGUgPyAic3ltYm9sIiA6IHR5cGVvZiBvYmo7fSwgU2V0dGluZ1ZhbGlkYXRvcl90eXBlb2Yob2JqKTt9ZnVuY3Rpb24gX3NsaWNlZFRvQXJyYXkoYXJyLCBpKSB7cmV0dXJuIF9hcnJheVdpdGhIb2xlcyhhcnIpIHx8IF9pdGVyYWJsZVRvQXJyYXlMaW1pdChhcnIsIGkpIHx8IF91bnN1cHBvcnRlZEl0ZXJhYmxlVG9BcnJheShhcnIsIGkpIHx8IF9ub25JdGVyYWJsZVJlc3QoKTt9ZnVuY3Rpb24gX25vbkl0ZXJhYmxlUmVzdCgpIHt0aHJvdyBuZXcgVHlwZUVycm9yKCJJbnZhbGlkIGF0dGVtcHQgdG8gZGVzdHJ1Y3R1cmUgbm9uLWl0ZXJhYmxlIGluc3RhbmNlLlxuSW4gb3JkZXIgdG8gYmUgaXRlcmFibGUsIG5vbi1hcnJheSBvYmplY3RzIG11c3QgaGF2ZSBhIFtTeW1ib2wuaXRlcmF0b3JdKCkgbWV0aG9kLiIpO31mdW5jdGlvbiBfaXRlcmFibGVUb0FycmF5TGltaXQoYXJyLCBpKSB7dmFyIF9pID0gbnVsbCA9PSBhcnIgPyBudWxsIDogInVuZGVmaW5lZCIgIT0gdHlwZW9mIFN5bWJvbCAmJiBhcnJbU3ltYm9sLml0ZXJhdG9yXSB8fCBhcnJbIkBAaXRlcmF0b3IiXTtpZiAobnVsbCAhPSBfaSkge3ZhciBfcyxfZSxfeCxfcixfYXJyID0gW10sX24gPSAhMCxfZCA9ICExO3RyeSB7aWYgKF94ID0gKF9pID0gX2kuY2FsbChhcnIpKS5uZXh0LCAwID09PSBpKSB7aWYgKE9iamVjdChfaSkgIT09IF9pKSByZXR1cm47X24gPSAhMTt9IGVsc2UgZm9yICg7ICEoX24gPSAoX3MgPSBfeC5jYWxsKF9pKSkuZG9uZSkgJiYgKF9hcnIucHVzaChfcy52YWx1ZSksIF9hcnIubGVuZ3RoICE9PSBpKTsgX24gPSAhMCkgezt9fSBjYXRjaCAoZXJyKSB7X2QgPSAhMCwgX2UgPSBlcnI7fSBmaW5hbGx5IHt0cnkge2lmICghX24gJiYgbnVsbCAhPSBfaVsicmV0dXJuIl0gJiYgKF9yID0gX2lbInJldHVybiJdKCksIE9iamVjdChfcikgIT09IF9yKSkgcmV0dXJuO30gZmluYWxseSB7aWYgKF9kKSB0aHJvdyBfZTt9fXJldHVybiBfYXJyO319ZnVuY3Rpb24gX2FycmF5V2l0aEhvbGVzKGFycikge2lmIChBcnJheS5pc0FycmF5KGFycikpIHJldHVybiBhcnI7fWZ1bmN0aW9uIF9jcmVhdGVGb3JPZkl0ZXJhdG9ySGVscGVyKG8sIGFsbG93QXJyYXlMaWtlKSB7dmFyIGl0ID0gdHlwZW9mIFN5bWJvbCAhPT0gInVuZGVmaW5lZCIgJiYgb1tTeW1ib2wuaXRlcmF0b3JdIHx8IG9bIkBAaXRlcmF0b3IiXTtpZiAoIWl0KSB7aWYgKEFycmF5LmlzQXJyYXkobykgfHwgKGl0ID0gX3Vuc3VwcG9ydGVkSXRlcmFibGVUb0FycmF5KG8pKSB8fCBhbGxvd0FycmF5TGlrZSAmJiBvICYmIHR5cGVvZiBvLmxlbmd0aCA9PT0gIm51bWJlciIpIHtpZiAoaXQpIG8gPSBpdDt2YXIgaSA9IDA7dmFyIEYgPSBmdW5jdGlvbiBGKCkge307cmV0dXJuIHsgczogRiwgbjogZnVuY3Rpb24gbigpIHtpZiAoaSA+PSBvLmxlbmd0aCkgcmV0dXJuIHsgZG9uZTogdHJ1ZSB9O3JldHVybiB7IGRvbmU6IGZhbHNlLCB2YWx1ZTogb1tpKytdIH07fSwgZTogZnVuY3Rpb24gZShfZTIpIHt0aHJvdyBfZTI7fSwgZjogRiB9O310aHJvdyBuZXcgVHlwZUVycm9yKCJJbnZhbGlkIGF0dGVtcHQgdG8gaXRlcmF0ZSBub24taXRlcmFibGUgaW5zdGFuY2UuXG5JbiBvcmRlciB0byBiZSBpdGVyYWJsZSwgbm9uLWFycmF5IG9iamVjdHMgbXVzdCBoYXZlIGEgW1N5bWJvbC5pdGVyYXRvcl0oKSBtZXRob2QuIik7fXZhciBub3JtYWxDb21wbGV0aW9uID0gdHJ1ZSxkaWRFcnIgPSBmYWxzZSxlcnI7cmV0dXJuIHsgczogZnVuY3Rpb24gcygpIHtpdCA9IGl0LmNhbGwobyk7fSwgbjogZnVuY3Rpb24gbigpIHt2YXIgc3RlcCA9IGl0Lm5leHQoKTtub3JtYWxDb21wbGV0aW9uID0gc3RlcC5kb25lO3JldHVybiBzdGVwO30sIGU6IGZ1bmN0aW9uIGUoX2UzKSB7ZGlkRXJyID0gdHJ1ZTtlcnIgPSBfZTM7fSwgZjogZnVuY3Rpb24gZigpIHt0cnkge2lmICghbm9ybWFsQ29tcGxldGlvbiAmJiBpdFsicmV0dXJuIl0gIT0gbnVsbCkgaXRbInJldHVybiJdKCk7fSBmaW5hbGx5IHtpZiAoZGlkRXJyKSB0aHJvdyBlcnI7fX0gfTt9ZnVuY3Rpb24gX3Vuc3VwcG9ydGVkSXRlcmFibGVUb0FycmF5KG8sIG1pbkxlbikge2lmICghbykgcmV0dXJuO2lmICh0eXBlb2YgbyA9PT0gInN0cmluZyIpIHJldHVybiBfYXJyYXlMaWtlVG9BcnJheShvLCBtaW5MZW4pO3ZhciBuID0gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKG8pLnNsaWNlKDgsIC0xKTtpZiAobiA9PT0gIk9iamVjdCIgJiYgby5jb25zdHJ1Y3RvcikgbiA9IG8uY29uc3RydWN0b3IubmFtZTtpZiAobiA9PT0gIk1hcCIgfHwgbiA9PT0gIlNldCIpIHJldHVybiBBcnJheS5mcm9tKG8pO2lmIChuID09PSAiQXJndW1lbnRzIiB8fCAvXig/OlVpfEkpbnQoPzo4fDE2fDMyKSg/OkNsYW1wZWQpP0FycmF5JC8udGVzdChuKSkgcmV0dXJuIF9hcnJheUxpa2VUb0FycmF5KG8sIG1pbkxlbik7fWZ1bmN0aW9uIF9hcnJheUxpa2VUb0FycmF5KGFyciwgbGVuKSB7aWYgKGxlbiA9PSBudWxsIHx8IGxlbiA+IGFyci5sZW5ndGgpIGxlbiA9IGFyci5sZW5ndGg7Zm9yICh2YXIgaSA9IDAsIGFycjIgPSBuZXcgQXJyYXkobGVuKTsgaSA8IGxlbjsgaSsrKSB7YXJyMltpXSA9IGFycltpXTt9cmV0dXJuIGFycjI7fWZ1bmN0aW9uIF9jbGFzc0NhbGxDaGVjayhpbnN0YW5jZSwgQ29uc3RydWN0b3IpIHtpZiAoIShpbnN0YW5jZSBpbnN0YW5jZW9mIENvbnN0cnVjdG9yKSkge3Rocm93IG5ldyBUeXBlRXJyb3IoIkNhbm5vdCBjYWxsIGEgY2xhc3MgYXMgYSBmdW5jdGlvbiIpO319ZnVuY3Rpb24gX2RlZmluZVByb3BlcnRpZXModGFyZ2V0LCBwcm9wcykge2ZvciAodmFyIGkgPSAwOyBpIDwgcHJvcHMubGVuZ3RoOyBpKyspIHt2YXIgZGVzY3JpcHRvciA9IHByb3BzW2ldO2Rlc2NyaXB0b3IuZW51bWVyYWJsZSA9IGRlc2NyaXB0b3IuZW51bWVyYWJsZSB8fCBmYWxzZTtkZXNjcmlwdG9yLmNvbmZpZ3VyYWJsZSA9IHRydWU7aWYgKCJ2YWx1ZSIgaW4gZGVzY3JpcHRvcikgZGVzY3JpcHRvci53cml0YWJsZSA9IHRydWU7T2JqZWN0LmRlZmluZVByb3BlcnR5KHRhcmdldCwgX3RvUHJvcGVydHlLZXkoZGVzY3JpcHRvci5rZXkpLCBkZXNjcmlwdG9yKTt9fWZ1bmN0aW9uIF9jcmVhdGVDbGFzcyhDb25zdHJ1Y3RvciwgcHJvdG9Qcm9wcywgc3RhdGljUHJvcHMpIHtpZiAocHJvdG9Qcm9wcykgX2RlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IucHJvdG90eXBlLCBwcm90b1Byb3BzKTtpZiAoc3RhdGljUHJvcHMpIF9kZWZpbmVQcm9wZXJ0aWVzKENvbnN0cnVjdG9yLCBzdGF0aWNQcm9wcyk7T2JqZWN0LmRlZmluZVByb3BlcnR5KENvbnN0cnVjdG9yLCAicHJvdG90eXBlIiwgeyB3cml0YWJsZTogZmFsc2UgfSk7cmV0dXJuIENvbnN0cnVjdG9yO31mdW5jdGlvbiBfZGVmaW5lUHJvcGVydHkob2JqLCBrZXksIHZhbHVlKSB7a2V5ID0gX3RvUHJvcGVydHlLZXkoa2V5KTtpZiAoa2V5IGluIG9iaikge09iamVjdC5kZWZpbmVQcm9wZXJ0eShvYmosIGtleSwgeyB2YWx1ZTogdmFsdWUsIGVudW1lcmFibGU6IHRydWUsIGNvbmZpZ3VyYWJsZTogdHJ1ZSwgd3JpdGFibGU6IHRydWUgfSk7fSBlbHNlIHtvYmpba2V5XSA9IHZhbHVlO31yZXR1cm4gb2JqO31mdW5jdGlvbiBfdG9Qcm9wZXJ0eUtleShhcmcpIHt2YXIga2V5ID0gX3RvUHJpbWl0aXZlKGFyZywgInN0cmluZyIpO3JldHVybiBTZXR0aW5nVmFsaWRhdG9yX3R5cGVvZihrZXkpID09PSAic3ltYm9sIiA/IGtleSA6IFN0cmluZyhrZXkpO31mdW5jdGlvbiBfdG9QcmltaXRpdmUoaW5wdXQsIGhpbnQpIHtpZiAoU2V0dGluZ1ZhbGlkYXRvcl90eXBlb2YoaW5wdXQpICE9PSAib2JqZWN0IiB8fCBpbnB1dCA9PT0gbnVsbCkgcmV0dXJuIGlucHV0O3ZhciBwcmltID0gaW5wdXRbU3ltYm9sLnRvUHJpbWl0aXZlXTtpZiAocHJpbSAhPT0gdW5kZWZpbmVkKSB7dmFyIHJlcyA9IHByaW0uY2FsbChpbnB1dCwgaGludCB8fCAiZGVmYXVsdCIpO2lmIChTZXR0aW5nVmFsaWRhdG9yX3R5cGVvZihyZXMpICE9PSAib2JqZWN0IikgcmV0dXJuIHJlczt0aHJvdyBuZXcgVHlwZUVycm9yKCJAQHRvUHJpbWl0aXZlIG11c3QgcmV0dXJuIGEgcHJpbWl0aXZlIHZhbHVlLiIpO31yZXR1cm4gKGhpbnQgPT09ICJzdHJpbmciID8gU3RyaW5nIDogTnVtYmVyKShpbnB1dCk7fXZhcgoKCiAgICAgICAgICBTZXR0aW5nVmFsaWRhdG9yID0gLyojX19QVVJFX18qL2Z1bmN0aW9uICgpIHtmdW5jdGlvbiBTZXR0aW5nVmFsaWRhdG9yKCkge19jbGFzc0NhbGxDaGVjayh0aGlzLCBTZXR0aW5nVmFsaWRhdG9yKTtfZGVmaW5lUHJvcGVydHkodGhpcywgInNldHRpbmdzIiwKICAgICAgICAgICAgICBbXSk7X2RlZmluZVByb3BlcnR5KHRoaXMsICJvYmplY3QiLAogICAgICAgICAgICAgIHt9KTt9X2NyZWF0ZUNsYXNzKFNldHRpbmdWYWxpZGF0b3IsIFt7IGtleTogImFkZFNldHRpbmciLCB2YWx1ZToKCiAgICAgICAgICAgICAgZnVuY3Rpb24gYWRkU2V0dGluZyhzZXR0aW5nLCBzZXRTdGF0ZSkgewogICAgICAgICAgICAgICAgdGhpcy5zZXR0aW5ncy5wdXNoKFtzZXR0aW5nLCBzZXRTdGF0ZV0pOwogICAgICAgICAgICAgIH0gfSwgeyBrZXk6ICJ1cGRhdGVTZXR0aW5nIiwgdmFsdWU6CgogICAgICAgICAgICAgIGZ1bmN0aW9uIHVwZGF0ZVNldHRpbmcoc2V0dGluZykgewogICAgICAgICAgICAgICAgdGhpcy5vYmplY3Rbc2V0dGluZy5wcmVmZXJlbmNlXSA9IHNldHRpbmcudmFsdWU7CiAgICAgICAgICAgICAgICB0aGlzLmRvVmFsaWRhdGVzKCk7CiAgICAgICAgICAgICAgfSB9LCB7IGtleTogInVwZGF0ZU9iamVjdCIsIHZhbHVlOgoKICAgICAgICAgICAgICBmdW5jdGlvbiB1cGRhdGVPYmplY3QoKSB7dmFyIF9pdGVyYXRvciA9IF9jcmVhdGVGb3JPZkl0ZXJhdG9ySGVscGVyKAogICAgICAgICAgICAgICAgICB0aGlzLnNldHRpbmdzKSxfc3RlcDt0cnkge2ZvciAoX2l0ZXJhdG9yLnMoKTsgIShfc3RlcCA9IF9pdGVyYXRvci5uKCkpLmRvbmU7KSB7dmFyIF9zdGVwJHZhbHVlID0gX3NsaWNlZFRvQXJyYXkoX3N0ZXAudmFsdWUsIDEpLHNldHRpbmcgPSBfc3RlcCR2YWx1ZVswXTsKICAgICAgICAgICAgICAgICAgICB0aGlzLm9iamVjdFtzZXR0aW5nLnByZWZlcmVuY2VdID0gc2V0dGluZy52YWx1ZTsKICAgICAgICAgICAgICAgICAgfX0gY2F0Y2ggKGVycikge19pdGVyYXRvci5lKGVycik7fSBmaW5hbGx5IHtfaXRlcmF0b3IuZigpO30KICAgICAgICAgICAgICB9IH0sIHsga2V5OiAiZG9WYWxpZGF0ZXMiLCB2YWx1ZToKCiAgICAgICAgICAgICAgZnVuY3Rpb24gZG9WYWxpZGF0ZXMoKSB7dmFyIF9pdGVyYXRvcjIgPSBfY3JlYXRlRm9yT2ZJdGVyYXRvckhlbHBlcigKICAgICAgICAgICAgICAgICAgdGhpcy5zZXR0aW5ncyksX3N0ZXAyO3RyeSB7Zm9yIChfaXRlcmF0b3IyLnMoKTsgIShfc3RlcDIgPSBfaXRlcmF0b3IyLm4oKSkuZG9uZTspIHt2YXIgX3N0ZXAyJHZhbHVlID0gX3NsaWNlZFRvQXJyYXkoX3N0ZXAyLnZhbHVlLCAyKSxzZXR0aW5nID0gX3N0ZXAyJHZhbHVlWzBdLHNldFZhbGlkID0gX3N0ZXAyJHZhbHVlWzFdOwogICAgICAgICAgICAgICAgICAgIHNldFZhbGlkKHRoaXMuaXNWYWxpZChzZXR0aW5nKSk7CiAgICAgICAgICAgICAgICAgIH19IGNhdGNoIChlcnIpIHtfaXRlcmF0b3IyLmUoZXJyKTt9IGZpbmFsbHkge19pdGVyYXRvcjIuZigpO30KICAgICAgICAgICAgICB9IH0sIHsga2V5OiAiaXNWYWxpZCIsIHZhbHVlOgoKICAgICAgICAgICAgICBmdW5jdGlvbiBpc1ZhbGlkKHNldHRpbmcpIHsKICAgICAgICAgICAgICAgIHJldHVybiAoCiAgICAgICAgICAgICAgICAgIHNldHRpbmcudmFsaWRhdGUgPT0gbnVsbCB8fCBzZXR0aW5nLnZhbGlkYXRlKHNldHRpbmcudmFsdWUsIHRoaXMub2JqZWN0KSk7CgogICAgICAgICAgICAgIH0gfV0pO3JldHVybiBTZXR0aW5nVmFsaWRhdG9yO30oKTsKCgogICAgICAgICAgLyogaGFybW9ueSBkZWZhdWx0IGV4cG9ydCAqL3ZhciBhcGlfU2V0dGluZ1ZhbGlkYXRvciA9IFNldHRpbmdWYWxpZGF0b3I7CiAgICAgICAgICA7IC8vIENPTkNBVEVOQVRFRCBNT0RVTEU6IC4vc3JjL3JlbGF5L2NvbXBvbmVudHMvSW50ZXJydXB0LnRzeAogICAgICAgICAgZnVuY3Rpb24gSW50ZXJydXB0X3R5cGVvZihvYmopIHsiQGJhYmVsL2hlbHBlcnMgLSB0eXBlb2YiO3JldHVybiBJbnRlcnJ1cHRfdHlwZW9mID0gImZ1bmN0aW9uIiA9PSB0eXBlb2YgU3ltYm9sICYmICJzeW1ib2wiID09IHR5cGVvZiBTeW1ib2wuaXRlcmF0b3IgPyBmdW5jdGlvbiAob2JqKSB7cmV0dXJuIHR5cGVvZiBvYmo7fSA6IGZ1bmN0aW9uIChvYmopIHtyZXR1cm4gb2JqICYmICJmdW5jdGlvbiIgPT0gdHlwZW9mIFN5bWJvbCAmJiBvYmouY29uc3RydWN0b3IgPT09IFN5bWJvbCAmJiBvYmogIT09IFN5bWJvbC5wcm90b3R5cGUgPyAic3ltYm9sIiA6IHR5cGVvZiBvYmo7fSwgSW50ZXJydXB0X3R5cGVvZihvYmopO31mdW5jdGlvbiBfdG9Db25zdW1hYmxlQXJyYXkoYXJyKSB7cmV0dXJuIF9hcnJheVdpdGhvdXRIb2xlcyhhcnIpIHx8IF9pdGVyYWJsZVRvQXJyYXkoYXJyKSB8fCBJbnRlcnJ1cHRfdW5zdXBwb3J0ZWRJdGVyYWJsZVRvQXJyYXkoYXJyKSB8fCBfbm9uSXRlcmFibGVTcHJlYWQoKTt9ZnVuY3Rpb24gX25vbkl0ZXJhYmxlU3ByZWFkKCkge3Rocm93IG5ldyBUeXBlRXJyb3IoIkludmFsaWQgYXR0ZW1wdCB0byBzcHJlYWQgbm9uLWl0ZXJhYmxlIGluc3RhbmNlLlxuSW4gb3JkZXIgdG8gYmUgaXRlcmFibGUsIG5vbi1hcnJheSBvYmplY3RzIG11c3QgaGF2ZSBhIFtTeW1ib2wuaXRlcmF0b3JdKCkgbWV0aG9kLiIpO31mdW5jdGlvbiBJbnRlcnJ1cHRfdW5zdXBwb3J0ZWRJdGVyYWJsZVRvQXJyYXkobywgbWluTGVuKSB7aWYgKCFvKSByZXR1cm47aWYgKHR5cGVvZiBvID09PSAic3RyaW5nIikgcmV0dXJuIEludGVycnVwdF9hcnJheUxpa2VUb0FycmF5KG8sIG1pbkxlbik7dmFyIG4gPSBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwobykuc2xpY2UoOCwgLTEpO2lmIChuID09PSAiT2JqZWN0IiAmJiBvLmNvbnN0cnVjdG9yKSBuID0gby5jb25zdHJ1Y3Rvci5uYW1lO2lmIChuID09PSAiTWFwIiB8fCBuID09PSAiU2V0IikgcmV0dXJuIEFycmF5LmZyb20obyk7aWYgKG4gPT09ICJBcmd1bWVudHMiIHx8IC9eKD86VWl8SSludCg/Ojh8MTZ8MzIpKD86Q2xhbXBlZCk/QXJyYXkkLy50ZXN0KG4pKSByZXR1cm4gSW50ZXJydXB0X2FycmF5TGlrZVRvQXJyYXkobywgbWluTGVuKTt9ZnVuY3Rpb24gX2l0ZXJhYmxlVG9BcnJheShpdGVyKSB7aWYgKHR5cGVvZiBTeW1ib2wgIT09ICJ1bmRlZmluZWQiICYmIGl0ZXJbU3ltYm9sLml0ZXJhdG9yXSAhPSBudWxsIHx8IGl0ZXJbIkBAaXRlcmF0b3IiXSAhPSBudWxsKSByZXR1cm4gQXJyYXkuZnJvbShpdGVyKTt9ZnVuY3Rpb24gX2FycmF5V2l0aG91dEhvbGVzKGFycikge2lmIChBcnJheS5pc0FycmF5KGFycikpIHJldHVybiBJbnRlcnJ1cHRfYXJyYXlMaWtlVG9BcnJheShhcnIpO31mdW5jdGlvbiBJbnRlcnJ1cHRfYXJyYXlMaWtlVG9BcnJheShhcnIsIGxlbikge2lmIChsZW4gPT0gbnVsbCB8fCBsZW4gPiBhcnIubGVuZ3RoKSBsZW4gPSBhcnIubGVuZ3RoO2ZvciAodmFyIGkgPSAwLCBhcnIyID0gbmV3IEFycmF5KGxlbik7IGkgPCBsZW47IGkrKykge2FycjJbaV0gPSBhcnJbaV07fXJldHVybiBhcnIyO31mdW5jdGlvbiBJbnRlcnJ1cHRfZGVmaW5lUHJvcGVydHkob2JqLCBrZXksIHZhbHVlKSB7a2V5ID0gSW50ZXJydXB0X3RvUHJvcGVydHlLZXkoa2V5KTtpZiAoa2V5IGluIG9iaikge09iamVjdC5kZWZpbmVQcm9wZXJ0eShvYmosIGtleSwgeyB2YWx1ZTogdmFsdWUsIGVudW1lcmFibGU6IHRydWUsIGNvbmZpZ3VyYWJsZTogdHJ1ZSwgd3JpdGFibGU6IHRydWUgfSk7fSBlbHNlIHtvYmpba2V5XSA9IHZhbHVlO31yZXR1cm4gb2JqO31mdW5jdGlvbiBJbnRlcnJ1cHRfdG9Qcm9wZXJ0eUtleShhcmcpIHt2YXIga2V5ID0gSW50ZXJydXB0X3RvUHJpbWl0aXZlKGFyZywgInN0cmluZyIpO3JldHVybiBJbnRlcnJ1cHRfdHlwZW9mKGtleSkgPT09ICJzeW1ib2wiID8ga2V5IDogU3RyaW5nKGtleSk7fWZ1bmN0aW9uIEludGVycnVwdF90b1ByaW1pdGl2ZShpbnB1dCwgaGludCkge2lmIChJbnRlcnJ1cHRfdHlwZW9mKGlucHV0KSAhPT0gIm9iamVjdCIgfHwgaW5wdXQgPT09IG51bGwpIHJldHVybiBpbnB1dDt2YXIgcHJpbSA9IGlucHV0W1N5bWJvbC50b1ByaW1pdGl2ZV07aWYgKHByaW0gIT09IHVuZGVmaW5lZCkge3ZhciByZXMgPSBwcmltLmNhbGwoaW5wdXQsIGhpbnQgfHwgImRlZmF1bHQiKTtpZiAoSW50ZXJydXB0X3R5cGVvZihyZXMpICE9PSAib2JqZWN0IikgcmV0dXJuIHJlczt0aHJvdyBuZXcgVHlwZUVycm9yKCJAQHRvUHJpbWl0aXZlIG11c3QgcmV0dXJuIGEgcHJpbWl0aXZlIHZhbHVlLiIpO31yZXR1cm4gKGhpbnQgPT09ICJzdHJpbmciID8gU3RyaW5nIDogTnVtYmVyKShpbnB1dCk7fQoKCgogICAgICAgICAgZnVuY3Rpb24gSW50ZXJydXB0KF9yZWYpIHt2YXIgYnV0dG9uID0gX3JlZi5idXR0b247CiAgICAgICAgICAgIHZhciBDU1NzdHJpbmcgPSBmdW5jdGlvbiBDU1NzdHJpbmcoc3RyaW5nKSB7CiAgICAgICAgICAgICAgdmFyIGNzc19qc29uID0gIntcIiIuY29uY2F0KHN0cmluZy4KICAgICAgICAgICAgICByZXBsYWNlKC87IC9nLCAnIiwgIicpLgogICAgICAgICAgICAgIHJlcGxhY2UoLzogL2csICciOiAiJykuCiAgICAgICAgICAgICAgcmVwbGFjZSgiOyIsICIiKSwgIlwifSIpOwoKICAgICAgICAgICAgICB2YXIgb2JqID0gSlNPTi5wYXJzZShjc3NfanNvbik7CgogICAgICAgICAgICAgIHZhciBrZXlWYWx1ZXMgPSBPYmplY3Qua2V5cyhvYmopLm1hcChmdW5jdGlvbiAoa2V5KSB7CiAgICAgICAgICAgICAgICB2YXIgY2FtZWxDYXNlZCA9IGtleS5yZXBsYWNlKC8tW2Etel0vZywgZnVuY3Rpb24gKGcpIHtyZXR1cm4gZ1sxXS50b1VwcGVyQ2FzZSgpO30pOwogICAgICAgICAgICAgICAgcmV0dXJuIEludGVycnVwdF9kZWZpbmVQcm9wZXJ0eSh7fSwgY2FtZWxDYXNlZCwgb2JqW2tleV0pOwogICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICByZXR1cm4gT2JqZWN0LmFzc2lnbi5hcHBseShPYmplY3QsIFt7fV0uY29uY2F0KF90b0NvbnN1bWFibGVBcnJheShrZXlWYWx1ZXMpKSk7CiAgICAgICAgICAgIH07CgogICAgICAgICAgICByZXR1cm4gLyojX19QVVJFX18qLygKICAgICAgICAgICAgICByZWFjdC5jcmVhdGVFbGVtZW50KCJpbnB1dCIsIHsKICAgICAgICAgICAgICAgIGNsYXNzTmFtZTogImludGVycnVwdCIsCiAgICAgICAgICAgICAgICBzdHlsZTogYnV0dG9uLmNzcyA/IENTU3N0cmluZyhidXR0b24uY3NzKSA6IG51bGwsCiAgICAgICAgICAgICAgICB0eXBlOiAic3VibWl0IiwKICAgICAgICAgICAgICAgIHZhbHVlOiBidXR0b24ubmFtZSwKICAgICAgICAgICAgICAgIG9uQ2xpY2s6IGZ1bmN0aW9uIG9uQ2xpY2soKSB7CiAgICAgICAgICAgICAgICAgIHNldFByb3BlcnRpZXMoCiAgICAgICAgICAgICAgICAgIGJ1dHRvbi5hY3Rpb25zLm1hcChmdW5jdGlvbiAoX3JlZjMpIHt2YXIgcHJlZmVyZW5jZSA9IF9yZWYzLnByZWZlcmVuY2UsdmFsdWUgPSBfcmVmMy52YWx1ZTtyZXR1cm4gW3ByZWZlcmVuY2UsIHZhbHVlXTt9KSkuCiAgICAgICAgICAgICAgICAgIHRoZW4oZnVuY3Rpb24gKCkge3JldHVybiBhZGROb3RpZmljYXRpb24oYnV0dG9uLm5vdGlmaWNhdGlvbiB8fCAiSW50ZXJydXB0ZWQhIik7fSk7CiAgICAgICAgICAgICAgICB9IH0pKTsKCgogICAgICAgICAgfQoKICAgICAgICAgIC8qIGhhcm1vbnkgZGVmYXVsdCBleHBvcnQgKi92YXIgY29tcG9uZW50c19JbnRlcnJ1cHQgPSBJbnRlcnJ1cHQ7CiAgICAgICAgICA7IC8vIENPTkNBVEVOQVRFRCBNT0RVTEU6IC4vc3JjL3JlbGF5L3R5cGVzL1R5cGVzLnRzeAoKCiAgICAgICAgICB2YXIgUmVsYXlDb21wb25lbnRUeXBlOyhmdW5jdGlvbiAoUmVsYXlDb21wb25lbnRUeXBlKSB7UmVsYXlDb21wb25lbnRUeXBlWyJCT09MRUFOIl0gPSAiYm9vbGVhbiI7UmVsYXlDb21wb25lbnRUeXBlWyJEUk9QRE9XTiJdID0gImRyb3Bkb3duIjtSZWxheUNvbXBvbmVudFR5cGVbIlNUUklORyJdID0gInN0cmluZyI7UmVsYXlDb21wb25lbnRUeXBlWyJIVE1MIl0gPSAiaHRtbCI7UmVsYXlDb21wb25lbnRUeXBlWyJJTlRFUlJVUFQiXSA9ICJpbnRlcnJ1cHQiO30pKFJlbGF5Q29tcG9uZW50VHlwZSB8fCAoUmVsYXlDb21wb25lbnRUeXBlID0ge30pKTsKICAgICAgICAgIDsgLy8gQ09OQ0FURU5BVEVEIE1PRFVMRTogLi9zcmMvcmVsYXkvY29tcG9uZW50cy9zZXR0aW5ncy9Cb29sZWFuSW5wdXQudHN4CiAgICAgICAgICBmdW5jdGlvbiBCb29sZWFuSW5wdXRfc2xpY2VkVG9BcnJheShhcnIsIGkpIHtyZXR1cm4gQm9vbGVhbklucHV0X2FycmF5V2l0aEhvbGVzKGFycikgfHwgQm9vbGVhbklucHV0X2l0ZXJhYmxlVG9BcnJheUxpbWl0KGFyciwgaSkgfHwgQm9vbGVhbklucHV0X3Vuc3VwcG9ydGVkSXRlcmFibGVUb0FycmF5KGFyciwgaSkgfHwgQm9vbGVhbklucHV0X25vbkl0ZXJhYmxlUmVzdCgpO31mdW5jdGlvbiBCb29sZWFuSW5wdXRfbm9uSXRlcmFibGVSZXN0KCkge3Rocm93IG5ldyBUeXBlRXJyb3IoIkludmFsaWQgYXR0ZW1wdCB0byBkZXN0cnVjdHVyZSBub24taXRlcmFibGUgaW5zdGFuY2UuXG5JbiBvcmRlciB0byBiZSBpdGVyYWJsZSwgbm9uLWFycmF5IG9iamVjdHMgbXVzdCBoYXZlIGEgW1N5bWJvbC5pdGVyYXRvcl0oKSBtZXRob2QuIik7fWZ1bmN0aW9uIEJvb2xlYW5JbnB1dF91bnN1cHBvcnRlZEl0ZXJhYmxlVG9BcnJheShvLCBtaW5MZW4pIHtpZiAoIW8pIHJldHVybjtpZiAodHlwZW9mIG8gPT09ICJzdHJpbmciKSByZXR1cm4gQm9vbGVhbklucHV0X2FycmF5TGlrZVRvQXJyYXkobywgbWluTGVuKTt2YXIgbiA9IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChvKS5zbGljZSg4LCAtMSk7aWYgKG4gPT09ICJPYmplY3QiICYmIG8uY29uc3RydWN0b3IpIG4gPSBvLmNvbnN0cnVjdG9yLm5hbWU7aWYgKG4gPT09ICJNYXAiIHx8IG4gPT09ICJTZXQiKSByZXR1cm4gQXJyYXkuZnJvbShvKTtpZiAobiA9PT0gIkFyZ3VtZW50cyIgfHwgL14oPzpVaXxJKW50KD86OHwxNnwzMikoPzpDbGFtcGVkKT9BcnJheSQvLnRlc3QobikpIHJldHVybiBCb29sZWFuSW5wdXRfYXJyYXlMaWtlVG9BcnJheShvLCBtaW5MZW4pO31mdW5jdGlvbiBCb29sZWFuSW5wdXRfYXJyYXlMaWtlVG9BcnJheShhcnIsIGxlbikge2lmIChsZW4gPT0gbnVsbCB8fCBsZW4gPiBhcnIubGVuZ3RoKSBsZW4gPSBhcnIubGVuZ3RoO2ZvciAodmFyIGkgPSAwLCBhcnIyID0gbmV3IEFycmF5KGxlbik7IGkgPCBsZW47IGkrKykge2FycjJbaV0gPSBhcnJbaV07fXJldHVybiBhcnIyO31mdW5jdGlvbiBCb29sZWFuSW5wdXRfaXRlcmFibGVUb0FycmF5TGltaXQoYXJyLCBpKSB7dmFyIF9pID0gbnVsbCA9PSBhcnIgPyBudWxsIDogInVuZGVmaW5lZCIgIT0gdHlwZW9mIFN5bWJvbCAmJiBhcnJbU3ltYm9sLml0ZXJhdG9yXSB8fCBhcnJbIkBAaXRlcmF0b3IiXTtpZiAobnVsbCAhPSBfaSkge3ZhciBfcyxfZSxfeCxfcixfYXJyID0gW10sX24gPSAhMCxfZCA9ICExO3RyeSB7aWYgKF94ID0gKF9pID0gX2kuY2FsbChhcnIpKS5uZXh0LCAwID09PSBpKSB7aWYgKE9iamVjdChfaSkgIT09IF9pKSByZXR1cm47X24gPSAhMTt9IGVsc2UgZm9yICg7ICEoX24gPSAoX3MgPSBfeC5jYWxsKF9pKSkuZG9uZSkgJiYgKF9hcnIucHVzaChfcy52YWx1ZSksIF9hcnIubGVuZ3RoICE9PSBpKTsgX24gPSAhMCkgezt9fSBjYXRjaCAoZXJyKSB7X2QgPSAhMCwgX2UgPSBlcnI7fSBmaW5hbGx5IHt0cnkge2lmICghX24gJiYgbnVsbCAhPSBfaVsicmV0dXJuIl0gJiYgKF9yID0gX2lbInJldHVybiJdKCksIE9iamVjdChfcikgIT09IF9yKSkgcmV0dXJuO30gZmluYWxseSB7aWYgKF9kKSB0aHJvdyBfZTt9fXJldHVybiBfYXJyO319ZnVuY3Rpb24gQm9vbGVhbklucHV0X2FycmF5V2l0aEhvbGVzKGFycikge2lmIChBcnJheS5pc0FycmF5KGFycikpIHJldHVybiBhcnI7fQoKCgogICAgICAgICAgZnVuY3Rpb24gQm9vbGVhbklucHV0KF9yZWYpIHt2YXIgYnV0dG9uID0gX3JlZi5idXR0b247CiAgICAgICAgICAgIHZhciBfdXNlU3RhdGUgPSAoMCwgcmVhY3QudXNlU3RhdGUpKGJ1dHRvbi52YWx1ZSA9PT0gInRydWUiKSxfdXNlU3RhdGUyID0gQm9vbGVhbklucHV0X3NsaWNlZFRvQXJyYXkoX3VzZVN0YXRlLCAyKSx2YWx1ZSA9IF91c2VTdGF0ZTJbMF0sc2V0VmFsdWUgPSBfdXNlU3RhdGUyWzFdOwoKICAgICAgICAgICAgcmV0dXJuIC8qI19fUFVSRV9fKi8oCiAgICAgICAgICAgICAgcmVhY3QuY3JlYXRlRWxlbWVudCgibGFiZWwiLCB7IGNsYXNzTmFtZTogImNoZWNrY29udGFpbmVyIiB9LCAvKiNfX1BVUkVfXyovCiAgICAgICAgICAgICAgcmVhY3QuY3JlYXRlRWxlbWVudCgiaW5wdXQiLCB7IHR5cGU6ICJoaWRkZW4iLCBuYW1lOiBidXR0b24ubmFtZSwgdmFsdWU6IGJ1dHRvbi52YWx1ZSB9KSwgLyojX19QVVJFX18qLwogICAgICAgICAgICAgIHJlYWN0LmNyZWF0ZUVsZW1lbnQoImRpdiIsIHsKICAgICAgICAgICAgICAgIGNsYXNzTmFtZTogInRvZ2dsZS10cmFjayIsCiAgICAgICAgICAgICAgICBvbkNsaWNrOiBmdW5jdGlvbiBvbkNsaWNrKCkgewogICAgICAgICAgICAgICAgICBzZXRWYWx1ZSghdmFsdWUpOwogICAgICAgICAgICAgICAgICBidXR0b24uc2V0VmFsdWUoKCF2YWx1ZSkudG9TdHJpbmcoKSk7CiAgICAgICAgICAgICAgICB9IH0sIC8qI19fUFVSRV9fKi8KCiAgICAgICAgICAgICAgcmVhY3QuY3JlYXRlRWxlbWVudCgic3BhbiIsIHsgY2xhc3NOYW1lOiAidG9nZ2xlLWluZGljYXRvciIgfSwgLyojX19QVVJFX18qLwogICAgICAgICAgICAgIHJlYWN0LmNyZWF0ZUVsZW1lbnQoInNwYW4iLCB7IGNsYXNzTmFtZTogImNoZWNrTWFyayIgfSwgLyojX19QVVJFX18qLwogICAgICAgICAgICAgIHJlYWN0LmNyZWF0ZUVsZW1lbnQoInN2ZyIsIHsKICAgICAgICAgICAgICAgIHZpZXdCb3g6ICIwIDAgMjQgMjQiLAogICAgICAgICAgICAgICAgaWQ6ICJnaHEtc3ZnLWNoZWNrIiwKICAgICAgICAgICAgICAgIHJvbGU6ICJwcmVzZW50YXRpb24iLAogICAgICAgICAgICAgICAgImFyaWEtaGlkZGVuIjogInRydWUiIH0sIC8qI19fUFVSRV9fKi8KCiAgICAgICAgICAgICAgcmVhY3QuY3JlYXRlRWxlbWVudCgicGF0aCIsIHsgZDogIk05Ljg2IDE4YTEgMSAwIDAxLS43My0uMzJsLTQuODYtNS4xN2ExLjAwMSAxLjAwMSAwIDAxMS40Ni0xLjM3bDQuMTIgNC4zOSA4LjQxLTkuMmExIDEgMCAxMTEuNDggMS4zNGwtOS4xNCAxMGExIDEgMCAwMS0uNzMuMzNoLS4wMXoiIH0pKSkpKSkpOwoKCgoKCgogICAgICAgICAgfQoKICAgICAgICAgIC8qCiAgICAgICAgICA8ZGl2CiAgICAgICAgICAgIGNsYXNzPSJjaGVja21hcmsiCiAgICAgICAgICAgIG9uQ2xpY2s9eygpID0+IHsKICAgICAgICAgICAgICBzZXRWYWx1ZSghdmFsdWUpOwogICAgICAgICAgICB9fQogICAgICAgICAgLz4KICAgICAgICAgICAqLwogICAgICAgICAgLyogaGFybW9ueSBkZWZhdWx0IGV4cG9ydCAqL3ZhciBzZXR0aW5nc19Cb29sZWFuSW5wdXQgPSBCb29sZWFuSW5wdXQ7CiAgICAgICAgICA7IC8vIENPTkNBVEVOQVRFRCBNT0RVTEU6IC4vc3JjL3JlbGF5L2NvbXBvbmVudHMvc2V0dGluZ3MvRHJvcGRvd25JbnB1dC50c3gKCgoKICAgICAgICAgIGZ1bmN0aW9uIERyb3Bkb3duSW5wdXQoX3JlZikge3ZhciBidXR0b24gPSBfcmVmLmJ1dHRvbjsKICAgICAgICAgICAgcmV0dXJuIC8qI19fUFVSRV9fKi8oCiAgICAgICAgICAgICAgcmVhY3QuY3JlYXRlRWxlbWVudCgic2VsZWN0IiwgewogICAgICAgICAgICAgICAgY2xhc3NOYW1lOiAiZHJvcGRvd25jb250YWluZXIiLAogICAgICAgICAgICAgICAgbmFtZTogYnV0dG9uLm5hbWUsCiAgICAgICAgICAgICAgICBkZWZhdWx0VmFsdWU6IGJ1dHRvbi52YWx1ZSwKICAgICAgICAgICAgICAgIG9uQ2hhbmdlOiBmdW5jdGlvbiBvbkNoYW5nZShlKSB7cmV0dXJuIGJ1dHRvbi5zZXRWYWx1ZShlLnRhcmdldC52YWx1ZSk7fSB9LAoKICAgICAgICAgICAgICBidXR0b24uZHJvcGRvd24ubWFwKGZ1bmN0aW9uIChvcHRpb24pIHsKICAgICAgICAgICAgICAgIHJldHVybiAvKiNfX1BVUkVfXyovKAogICAgICAgICAgICAgICAgICByZWFjdC5jcmVhdGVFbGVtZW50KCJvcHRpb24iLCB7IGtleTogb3B0aW9uLnZhbHVlLCB2YWx1ZTogb3B0aW9uLnZhbHVlIH0sCiAgICAgICAgICAgICAgICAgIG9wdGlvbi5kaXNwbGF5IHx8IG9wdGlvbi52YWx1ZSkpOwoKCiAgICAgICAgICAgICAgfSkpKTsKCgogICAgICAgICAgfQoKICAgICAgICAgIC8qIGhhcm1vbnkgZGVmYXVsdCBleHBvcnQgKi92YXIgc2V0dGluZ3NfRHJvcGRvd25JbnB1dCA9IERyb3Bkb3duSW5wdXQ7CiAgICAgICAgICA7IC8vIENPTkNBVEVOQVRFRCBNT0RVTEU6IC4vc3JjL3JlbGF5L2NvbXBvbmVudHMvc2V0dGluZ3MvU3RyaW5nSW5wdXQudHN4CgoKCiAgICAgICAgICBmdW5jdGlvbiBTdHJpbmdJbnB1dChfcmVmKSB7dmFyIGJ1dHRvbiA9IF9yZWYuYnV0dG9uOwogICAgICAgICAgICByZXR1cm4gLyojX19QVVJFX18qLygKICAgICAgICAgICAgICByZWFjdC5jcmVhdGVFbGVtZW50KCJpbnB1dCIsIHsKICAgICAgICAgICAgICAgIGNsYXNzTmFtZTogInN0cmluZ2NvbnRhaW5lciIsCiAgICAgICAgICAgICAgICBuYW1lOiBidXR0b24ubmFtZSwKICAgICAgICAgICAgICAgIGRlZmF1bHRWYWx1ZTogYnV0dG9uLnZhbHVlLAogICAgICAgICAgICAgICAgb25DaGFuZ2U6IGZ1bmN0aW9uIG9uQ2hhbmdlKGUpIHtyZXR1cm4gYnV0dG9uLnNldFZhbHVlKGUudGFyZ2V0LnZhbHVlKTt9IH0pKTsKCgogICAgICAgICAgfQoKICAgICAgICAgIC8qIGhhcm1vbnkgZGVmYXVsdCBleHBvcnQgKi92YXIgc2V0dGluZ3NfU3RyaW5nSW5wdXQgPSBTdHJpbmdJbnB1dDsKICAgICAgICAgIDsgLy8gQ09OQ0FURU5BVEVEIE1PRFVMRTogLi9zcmMvcmVsYXkvY29tcG9uZW50cy9zZXR0aW5ncy9TZXR0aW5nLnRzeAogICAgICAgICAgZnVuY3Rpb24gU2V0dGluZ19zbGljZWRUb0FycmF5KGFyciwgaSkge3JldHVybiBTZXR0aW5nX2FycmF5V2l0aEhvbGVzKGFycikgfHwgU2V0dGluZ19pdGVyYWJsZVRvQXJyYXlMaW1pdChhcnIsIGkpIHx8IFNldHRpbmdfdW5zdXBwb3J0ZWRJdGVyYWJsZVRvQXJyYXkoYXJyLCBpKSB8fCBTZXR0aW5nX25vbkl0ZXJhYmxlUmVzdCgpO31mdW5jdGlvbiBTZXR0aW5nX25vbkl0ZXJhYmxlUmVzdCgpIHt0aHJvdyBuZXcgVHlwZUVycm9yKCJJbnZhbGlkIGF0dGVtcHQgdG8gZGVzdHJ1Y3R1cmUgbm9uLWl0ZXJhYmxlIGluc3RhbmNlLlxuSW4gb3JkZXIgdG8gYmUgaXRlcmFibGUsIG5vbi1hcnJheSBvYmplY3RzIG11c3QgaGF2ZSBhIFtTeW1ib2wuaXRlcmF0b3JdKCkgbWV0aG9kLiIpO31mdW5jdGlvbiBTZXR0aW5nX3Vuc3VwcG9ydGVkSXRlcmFibGVUb0FycmF5KG8sIG1pbkxlbikge2lmICghbykgcmV0dXJuO2lmICh0eXBlb2YgbyA9PT0gInN0cmluZyIpIHJldHVybiBTZXR0aW5nX2FycmF5TGlrZVRvQXJyYXkobywgbWluTGVuKTt2YXIgbiA9IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChvKS5zbGljZSg4LCAtMSk7aWYgKG4gPT09ICJPYmplY3QiICYmIG8uY29uc3RydWN0b3IpIG4gPSBvLmNvbnN0cnVjdG9yLm5hbWU7aWYgKG4gPT09ICJNYXAiIHx8IG4gPT09ICJTZXQiKSByZXR1cm4gQXJyYXkuZnJvbShvKTtpZiAobiA9PT0gIkFyZ3VtZW50cyIgfHwgL14oPzpVaXxJKW50KD86OHwxNnwzMikoPzpDbGFtcGVkKT9BcnJheSQvLnRlc3QobikpIHJldHVybiBTZXR0aW5nX2FycmF5TGlrZVRvQXJyYXkobywgbWluTGVuKTt9ZnVuY3Rpb24gU2V0dGluZ19hcnJheUxpa2VUb0FycmF5KGFyciwgbGVuKSB7aWYgKGxlbiA9PSBudWxsIHx8IGxlbiA+IGFyci5sZW5ndGgpIGxlbiA9IGFyci5sZW5ndGg7Zm9yICh2YXIgaSA9IDAsIGFycjIgPSBuZXcgQXJyYXkobGVuKTsgaSA8IGxlbjsgaSsrKSB7YXJyMltpXSA9IGFycltpXTt9cmV0dXJuIGFycjI7fWZ1bmN0aW9uIFNldHRpbmdfaXRlcmFibGVUb0FycmF5TGltaXQoYXJyLCBpKSB7dmFyIF9pID0gbnVsbCA9PSBhcnIgPyBudWxsIDogInVuZGVmaW5lZCIgIT0gdHlwZW9mIFN5bWJvbCAmJiBhcnJbU3ltYm9sLml0ZXJhdG9yXSB8fCBhcnJbIkBAaXRlcmF0b3IiXTtpZiAobnVsbCAhPSBfaSkge3ZhciBfcyxfZSxfeCxfcixfYXJyID0gW10sX24gPSAhMCxfZCA9ICExO3RyeSB7aWYgKF94ID0gKF9pID0gX2kuY2FsbChhcnIpKS5uZXh0LCAwID09PSBpKSB7aWYgKE9iamVjdChfaSkgIT09IF9pKSByZXR1cm47X24gPSAhMTt9IGVsc2UgZm9yICg7ICEoX24gPSAoX3MgPSBfeC5jYWxsKF9pKSkuZG9uZSkgJiYgKF9hcnIucHVzaChfcy52YWx1ZSksIF9hcnIubGVuZ3RoICE9PSBpKTsgX24gPSAhMCkgezt9fSBjYXRjaCAoZXJyKSB7X2QgPSAhMCwgX2UgPSBlcnI7fSBmaW5hbGx5IHt0cnkge2lmICghX24gJiYgbnVsbCAhPSBfaVsicmV0dXJuIl0gJiYgKF9yID0gX2lbInJldHVybiJdKCksIE9iamVjdChfcikgIT09IF9yKSkgcmV0dXJuO30gZmluYWxseSB7aWYgKF9kKSB0aHJvdyBfZTt9fXJldHVybiBfYXJyO319ZnVuY3Rpb24gU2V0dGluZ19hcnJheVdpdGhIb2xlcyhhcnIpIHtpZiAoQXJyYXkuaXNBcnJheShhcnIpKSByZXR1cm4gYXJyO30KCgoKCgoKICAgICAgICAgIGZ1bmN0aW9uIFNldHRpbmcoX3JlZikKCgoKCgogICAgICAgICAge3ZhciBidXR0b24gPSBfcmVmLmJ1dHRvbix2YWxpZGF0b3IgPSBfcmVmLnZhbGlkYXRvcjsKICAgICAgICAgICAgdmFyIF91c2VTdGF0ZSA9ICgwLCByZWFjdC51c2VTdGF0ZSkodmFsaWRhdG9yLmlzVmFsaWQoYnV0dG9uKSksX3VzZVN0YXRlMiA9IFNldHRpbmdfc2xpY2VkVG9BcnJheShfdXNlU3RhdGUsIDIpLHZhbGlkID0gX3VzZVN0YXRlMlswXSxzZXRWYWxpZCA9IF91c2VTdGF0ZTJbMV07CgogICAgICAgICAgICBidXR0b24uc2V0VmFsdWUgPSBmdW5jdGlvbiAodmFsKSB7CiAgICAgICAgICAgICAgYnV0dG9uLnZhbHVlID0gdmFsOwogICAgICAgICAgICAgIHZhbGlkYXRvci51cGRhdGVTZXR0aW5nKGJ1dHRvbik7CiAgICAgICAgICAgIH07CgogICAgICAgICAgICB2YWxpZGF0b3IuYWRkU2V0dGluZyhidXR0b24sIHNldFZhbGlkKTsKCiAgICAgICAgICAgIHJldHVybiAvKiNfX1BVUkVfXyovKAogICAgICAgICAgICAgIHJlYWN0LmNyZWF0ZUVsZW1lbnQoInRyIiwgeyBjbGFzc05hbWU6ICJ1c2VyUHJlZmVyZW5jZSIsIGtleTogYnV0dG9uLnByZWZlcmVuY2UgfSwgLyojX19QVVJFX18qLwogICAgICAgICAgICAgIHJlYWN0LmNyZWF0ZUVsZW1lbnQoInRkIiwgeyBjbGFzc05hbWU6ICJzZXR0aW5nIiB9LAogICAgICAgICAgICAgIGJ1dHRvbi5uYW1lLCAvKiNfX1BVUkVfXyovCiAgICAgICAgICAgICAgcmVhY3QuY3JlYXRlRWxlbWVudCgiZGl2IiwgeyBjbGFzc05hbWU6ICJzZXR0aW5nTmFtZUhvdmVyIiB9LCBidXR0b24ucHJlZmVyZW5jZSkpLCAvKiNfX1BVUkVfXyovCgogICAgICAgICAgICAgIHJlYWN0LmNyZWF0ZUVsZW1lbnQoInRkIiwgeyBjbGFzc05hbWU6IHZhbGlkID8gInNldHRpbmdJbnB1dCIgOiAic2V0dGluZ0lucHV0IGludmFsaWQtc2V0dGluZyIgfSwKICAgICAgICAgICAgICBidXR0b24udHlwZSA9PT0gUmVsYXlDb21wb25lbnRUeXBlLkJPT0xFQU4gPyAvKiNfX1BVUkVfXyovCiAgICAgICAgICAgICAgcmVhY3QuY3JlYXRlRWxlbWVudChzZXR0aW5nc19Cb29sZWFuSW5wdXQsIHsgYnV0dG9uOiBidXR0b24gfSkgOgogICAgICAgICAgICAgIGJ1dHRvbi50eXBlID09PSBSZWxheUNvbXBvbmVudFR5cGUuRFJPUERPV04gPyAvKiNfX1BVUkVfXyovCiAgICAgICAgICAgICAgcmVhY3QuY3JlYXRlRWxlbWVudChzZXR0aW5nc19Ecm9wZG93bklucHV0LCB7IGJ1dHRvbjogYnV0dG9uIH0pIDogLyojX19QVVJFX18qLwoKICAgICAgICAgICAgICByZWFjdC5jcmVhdGVFbGVtZW50KHNldHRpbmdzX1N0cmluZ0lucHV0LCB7IGJ1dHRvbjogYnV0dG9uIH0pLAoKICAgICAgICAgICAgICBidXR0b24uaW52YWxpZFJlYXNvbiAhPSBudWxsID8gLyojX19QVVJFX18qLwogICAgICAgICAgICAgIHJlYWN0LmNyZWF0ZUVsZW1lbnQoImRpdiIsIHsgY2xhc3NOYW1lOiAiaW52YWxpZC1yZWFzb24iLCBoaWRkZW46IHZhbGlkIH0sIC8qI19fUFVSRV9fKi8KICAgICAgICAgICAgICByZWFjdC5jcmVhdGVFbGVtZW50KCJzbWFsbCIsIG51bGwsIGJ1dHRvbi5pbnZhbGlkUmVhc29uKSkgOiAvKiNfX1BVUkVfXyovCgoKICAgICAgICAgICAgICByZWFjdC5jcmVhdGVFbGVtZW50KHJlYWN0LkZyYWdtZW50LCBudWxsKSwgLyojX19QVVJFX18qLwoKCiAgICAgICAgICAgICAgcmVhY3QuY3JlYXRlRWxlbWVudCgiZGl2IiwgeyBjbGFzc05hbWU6ICJob3ZlckJveCIgfSwgLyojX19QVVJFX18qLwogICAgICAgICAgICAgIHJlYWN0LmNyZWF0ZUVsZW1lbnQoInNtYWxsIiwgeyBjbGFzc05hbWU6ICJzZXR0aW5nRGVmYXVsdEhvdmVyIiB9LAogICAgICAgICAgICAgIGJ1dHRvblsiZGVmYXVsdCJdICE9IG51bGwgPwogICAgICAgICAgICAgICJEZWZhdWx0OiAiICsgKAogICAgICAgICAgICAgIGJ1dHRvblsiZGVmYXVsdCJdID09ICIiID8gIjxFbXB0eT4iIDogYnV0dG9uWyJkZWZhdWx0Il0pIDoKICAgICAgICAgICAgICAiRGVmYXVsdCBub3Qgc2V0IikpKSwgLyojX19QVVJFX18qLwoKCgogICAgICAgICAgICAgIHJlYWN0LmNyZWF0ZUVsZW1lbnQoInRkIiwgbnVsbCwgYnV0dG9uLmRlc2NyaXB0aW9uKSkpOwoKCiAgICAgICAgICB9CgogICAgICAgICAgLyogaGFybW9ueSBkZWZhdWx0IGV4cG9ydCAqL3ZhciBzZXR0aW5nc19TZXR0aW5nID0gU2V0dGluZzsKICAgICAgICAgIDsgLy8gQ09OQ0FURU5BVEVEIE1PRFVMRTogLi9zcmMvcmVsYXkvcm91dGVzL1JlbGF5UGFnZS50c3gKICAgICAgICAgIGZ1bmN0aW9uIFJlbGF5UGFnZV9jcmVhdGVGb3JPZkl0ZXJhdG9ySGVscGVyKG8sIGFsbG93QXJyYXlMaWtlKSB7dmFyIGl0ID0gdHlwZW9mIFN5bWJvbCAhPT0gInVuZGVmaW5lZCIgJiYgb1tTeW1ib2wuaXRlcmF0b3JdIHx8IG9bIkBAaXRlcmF0b3IiXTtpZiAoIWl0KSB7aWYgKEFycmF5LmlzQXJyYXkobykgfHwgKGl0ID0gUmVsYXlQYWdlX3Vuc3VwcG9ydGVkSXRlcmFibGVUb0FycmF5KG8pKSB8fCBhbGxvd0FycmF5TGlrZSAmJiBvICYmIHR5cGVvZiBvLmxlbmd0aCA9PT0gIm51bWJlciIpIHtpZiAoaXQpIG8gPSBpdDt2YXIgaSA9IDA7dmFyIEYgPSBmdW5jdGlvbiBGKCkge307cmV0dXJuIHsgczogRiwgbjogZnVuY3Rpb24gbigpIHtpZiAoaSA+PSBvLmxlbmd0aCkgcmV0dXJuIHsgZG9uZTogdHJ1ZSB9O3JldHVybiB7IGRvbmU6IGZhbHNlLCB2YWx1ZTogb1tpKytdIH07fSwgZTogZnVuY3Rpb24gZShfZSkge3Rocm93IF9lO30sIGY6IEYgfTt9dGhyb3cgbmV3IFR5cGVFcnJvcigiSW52YWxpZCBhdHRlbXB0IHRvIGl0ZXJhdGUgbm9uLWl0ZXJhYmxlIGluc3RhbmNlLlxuSW4gb3JkZXIgdG8gYmUgaXRlcmFibGUsIG5vbi1hcnJheSBvYmplY3RzIG11c3QgaGF2ZSBhIFtTeW1ib2wuaXRlcmF0b3JdKCkgbWV0aG9kLiIpO312YXIgbm9ybWFsQ29tcGxldGlvbiA9IHRydWUsZGlkRXJyID0gZmFsc2UsZXJyO3JldHVybiB7IHM6IGZ1bmN0aW9uIHMoKSB7aXQgPSBpdC5jYWxsKG8pO30sIG46IGZ1bmN0aW9uIG4oKSB7dmFyIHN0ZXAgPSBpdC5uZXh0KCk7bm9ybWFsQ29tcGxldGlvbiA9IHN0ZXAuZG9uZTtyZXR1cm4gc3RlcDt9LCBlOiBmdW5jdGlvbiBlKF9lMikge2RpZEVyciA9IHRydWU7ZXJyID0gX2UyO30sIGY6IGZ1bmN0aW9uIGYoKSB7dHJ5IHtpZiAoIW5vcm1hbENvbXBsZXRpb24gJiYgaXRbInJldHVybiJdICE9IG51bGwpIGl0WyJyZXR1cm4iXSgpO30gZmluYWxseSB7aWYgKGRpZEVycikgdGhyb3cgZXJyO319IH07fWZ1bmN0aW9uIFJlbGF5UGFnZV91bnN1cHBvcnRlZEl0ZXJhYmxlVG9BcnJheShvLCBtaW5MZW4pIHtpZiAoIW8pIHJldHVybjtpZiAodHlwZW9mIG8gPT09ICJzdHJpbmciKSByZXR1cm4gUmVsYXlQYWdlX2FycmF5TGlrZVRvQXJyYXkobywgbWluTGVuKTt2YXIgbiA9IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChvKS5zbGljZSg4LCAtMSk7aWYgKG4gPT09ICJPYmplY3QiICYmIG8uY29uc3RydWN0b3IpIG4gPSBvLmNvbnN0cnVjdG9yLm5hbWU7aWYgKG4gPT09ICJNYXAiIHx8IG4gPT09ICJTZXQiKSByZXR1cm4gQXJyYXkuZnJvbShvKTtpZiAobiA9PT0gIkFyZ3VtZW50cyIgfHwgL14oPzpVaXxJKW50KD86OHwxNnwzMikoPzpDbGFtcGVkKT9BcnJheSQvLnRlc3QobikpIHJldHVybiBSZWxheVBhZ2VfYXJyYXlMaWtlVG9BcnJheShvLCBtaW5MZW4pO31mdW5jdGlvbiBSZWxheVBhZ2VfYXJyYXlMaWtlVG9BcnJheShhcnIsIGxlbikge2lmIChsZW4gPT0gbnVsbCB8fCBsZW4gPiBhcnIubGVuZ3RoKSBsZW4gPSBhcnIubGVuZ3RoO2ZvciAodmFyIGkgPSAwLCBhcnIyID0gbmV3IEFycmF5KGxlbik7IGkgPCBsZW47IGkrKykge2FycjJbaV0gPSBhcnJbaV07fXJldHVybiBhcnIyO30KCgoKCgoKICAgICAgICAgIGZ1bmN0aW9uIFJlbGF5UGFnZShfcmVmKSB7dmFyIHBhZ2UgPSBfcmVmLnBhZ2U7CiAgICAgICAgICAgIHZhciBncm91cHMgPSBbXTsKICAgICAgICAgICAgdmFyIGN1cnJlbnRHcm91cCA9IG51bGw7dmFyIF9pdGVyYXRvciA9IFJlbGF5UGFnZV9jcmVhdGVGb3JPZkl0ZXJhdG9ySGVscGVyKAoKICAgICAgICAgICAgICBwYWdlLmNvbXBvbmVudHMpLF9zdGVwO3RyeSB7Zm9yIChfaXRlcmF0b3IucygpOyAhKF9zdGVwID0gX2l0ZXJhdG9yLm4oKSkuZG9uZTspIHt2YXIgY29tcG9uZW50ID0gX3N0ZXAudmFsdWU7CiAgICAgICAgICAgICAgICBpZiAoCiAgICAgICAgICAgICAgICBjb21wb25lbnQudHlwZSA9PSBSZWxheUNvbXBvbmVudFR5cGUuSFRNTCB8fAogICAgICAgICAgICAgICAgY29tcG9uZW50LnR5cGUgPT0gUmVsYXlDb21wb25lbnRUeXBlLklOVEVSUlVQVCkKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgZ3JvdXBzLnB1c2goY29tcG9uZW50KTsKICAgICAgICAgICAgICAgICAgY3VycmVudEdyb3VwID0gbnVsbDsKICAgICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgaWYgKGN1cnJlbnRHcm91cCA9PSBudWxsKSB7CiAgICAgICAgICAgICAgICAgIGN1cnJlbnRHcm91cCA9IFtdOwogICAgICAgICAgICAgICAgICBncm91cHMucHVzaChjdXJyZW50R3JvdXApOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGN1cnJlbnRHcm91cC5wdXNoKGNvbXBvbmVudCk7CiAgICAgICAgICAgICAgfX0gY2F0Y2ggKGVycikge19pdGVyYXRvci5lKGVycik7fSBmaW5hbGx5IHtfaXRlcmF0b3IuZigpO30KCiAgICAgICAgICAgIHZhciBlbGVtZW50cyA9IFtdOwogICAgICAgICAgICB2YXIgdmFsaWRhdG9yID0gbmV3IGFwaV9TZXR0aW5nVmFsaWRhdG9yKCk7CgogICAgICAgICAgICBncm91cHMuZm9yRWFjaChmdW5jdGlvbiAoY29tcG9uZW50cykgewogICAgICAgICAgICAgIGlmIChjb21wb25lbnRzLnR5cGUgPT0gUmVsYXlDb21wb25lbnRUeXBlLkhUTUwpIHsKICAgICAgICAgICAgICAgIHZhciBodG1sID0gY29tcG9uZW50czsKCiAgICAgICAgICAgICAgICBpZiAoaHRtbC5kYXRhID09IG51bGwpIHsKICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGVsZW1lbnRzLnB1c2goIC8qI19fUFVSRV9fKi8KICAgICAgICAgICAgICAgIHJlYWN0LmNyZWF0ZUVsZW1lbnQoImRpdiIsIHsKICAgICAgICAgICAgICAgICAgZGFuZ2Vyb3VzbHlTZXRJbm5lckhUTUw6IHsKICAgICAgICAgICAgICAgICAgICBfX2h0bWw6IGNvbXBvbmVudHMuZGF0YQogICAgICAgICAgICAgICAgICB9IH0pKTsKCgogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgaWYgKGNvbXBvbmVudHMudHlwZSA9PSBSZWxheUNvbXBvbmVudFR5cGUuSU5URVJSVVBUKSB7CiAgICAgICAgICAgICAgICBlbGVtZW50cy5wdXNoKCAvKiNfX1BVUkVfXyovCiAgICAgICAgICAgICAgICByZWFjdC5jcmVhdGVFbGVtZW50KGNvbXBvbmVudHNfSW50ZXJydXB0LCB7IGJ1dHRvbjogY29tcG9uZW50cyB9KSk7CgogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgdmFyIGJ1dHRvbnMgPSBjb21wb25lbnRzOwoKICAgICAgICAgICAgICBlbGVtZW50cy5wdXNoKCAvKiNfX1BVUkVfXyovCiAgICAgICAgICAgICAgcmVhY3QuY3JlYXRlRWxlbWVudCgidGFibGUiLCBudWxsLCAvKiNfX1BVUkVfXyovCiAgICAgICAgICAgICAgcmVhY3QuY3JlYXRlRWxlbWVudCgidGJvZHkiLCBudWxsLAogICAgICAgICAgICAgIGJ1dHRvbnMubWFwKGZ1bmN0aW9uIChzZXR0aW5nLCBpbmRleCkge3JldHVybiAvKiNfX1BVUkVfXyovKAogICAgICAgICAgICAgICAgICByZWFjdC5jcmVhdGVFbGVtZW50KHNldHRpbmdzX1NldHRpbmcsIHsga2V5OiBpbmRleCwgYnV0dG9uOiBzZXR0aW5nLCB2YWxpZGF0b3I6IHZhbGlkYXRvciB9KSk7fSkpKSk7CgoKCgogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIHZhbGlkYXRvci51cGRhdGVPYmplY3QoKTsKCiAgICAgICAgICAgIC8vIElmIHdlIGhhdmUgbm8gc2V0dGluZ3MgaW4gd2hpY2ggd2UnZCBzYXZlIHN0dWZmLCBkb24ndCBib3RoZXIgcmVuZGVyaW5nIHNhdmUgYnV0dG9uCiAgICAgICAgICAgIGlmICgKICAgICAgICAgICAgcGFnZS5jb21wb25lbnRzLmZpbmQoZnVuY3Rpb24gKGMpIHtyZXR1cm4gYy5wcmVmZXJlbmNlICE9IG51bGw7fSkgPT0KICAgICAgICAgICAgbnVsbCkKICAgICAgICAgICAgewogICAgICAgICAgICAgIHJldHVybiAvKiNfX1BVUkVfXyovcmVhY3QuY3JlYXRlRWxlbWVudChyZWFjdC5GcmFnbWVudCwgbnVsbCwgZWxlbWVudHMpOwogICAgICAgICAgICB9CgogICAgICAgICAgICByZXR1cm4gLyojX19QVVJFX18qLygKICAgICAgICAgICAgICByZWFjdC5jcmVhdGVFbGVtZW50KHJlYWN0LkZyYWdtZW50LCBudWxsLAogICAgICAgICAgICAgICIgIiwKICAgICAgICAgICAgICBlbGVtZW50cywgIiAiLCAvKiNfX1BVUkVfXyovcmVhY3QuY3JlYXRlRWxlbWVudCgiYnIiLCBudWxsKSwgLyojX19QVVJFX18qLwogICAgICAgICAgICAgIHJlYWN0LmNyZWF0ZUVsZW1lbnQoImlucHV0IiwgewogICAgICAgICAgICAgICAgY2xhc3NOYW1lOiAic2F2ZSIsCiAgICAgICAgICAgICAgICBvbkNsaWNrOiBmdW5jdGlvbiBvbkNsaWNrKCkge3JldHVybiAoCiAgICAgICAgICAgICAgICAgICAgc2F2ZVNldHRpbmdzKAogICAgICAgICAgICAgICAgICAgIHBhZ2UuY29tcG9uZW50cy5maWx0ZXIoCiAgICAgICAgICAgICAgICAgICAgZnVuY3Rpb24gKGIpIHtyZXR1cm4gYi5wcmVmZXJlbmNlICE9IG51bGw7fSkpLgoKICAgICAgICAgICAgICAgICAgICB0aGVuKGZ1bmN0aW9uIChub3RpZnMpIHt2YXIgX2l0ZXJhdG9yMiA9IFJlbGF5UGFnZV9jcmVhdGVGb3JPZkl0ZXJhdG9ySGVscGVyKAogICAgICAgICAgICAgICAgICAgICAgICBub3RpZnMpLF9zdGVwMjt0cnkge2ZvciAoX2l0ZXJhdG9yMi5zKCk7ICEoX3N0ZXAyID0gX2l0ZXJhdG9yMi5uKCkpLmRvbmU7KSB7dmFyIG5vdGlmID0gX3N0ZXAyLnZhbHVlOwogICAgICAgICAgICAgICAgICAgICAgICAgIGFkZE5vdGlmaWNhdGlvbihub3RpZik7CiAgICAgICAgICAgICAgICAgICAgICAgIH19IGNhdGNoIChlcnIpIHtfaXRlcmF0b3IyLmUoZXJyKTt9IGZpbmFsbHkge19pdGVyYXRvcjIuZigpO30KICAgICAgICAgICAgICAgICAgICB9KSk7fSwKCiAgICAgICAgICAgICAgICB0eXBlOiAic3VibWl0IiwKICAgICAgICAgICAgICAgIHZhbHVlOiAiU2F2ZSBDaGFuZ2VzIiB9KSkpOwoKCgogICAgICAgICAgfQoKICAgICAgICAgIC8qIGhhcm1vbnkgZGVmYXVsdCBleHBvcnQgKi92YXIgcm91dGVzX1JlbGF5UGFnZSA9IFJlbGF5UGFnZTsKICAgICAgICAgIDsgLy8gQ09OQ0FURU5BVEVEIE1PRFVMRTogLi9zcmMvcmVsYXkvQXBwLnRzeAoKCgoKCgogICAgICAgICAgZnVuY3Rpb24gQXBwKF9yZWYpIHt2YXIgcGFnZXMgPSBfcmVmLnBhZ2VzOwogICAgICAgICAgICByZXR1cm4gLyojX19QVVJFX18qLygKICAgICAgICAgICAgICByZWFjdC5jcmVhdGVFbGVtZW50KE1lbW9yeVJvdXRlciwgbnVsbCwKICAgICAgICAgICAgICAiICIsIC8qI19fUFVSRV9fKi8KICAgICAgICAgICAgICByZWFjdC5jcmVhdGVFbGVtZW50KFJvdXRlcywgbnVsbCwKICAgICAgICAgICAgICAiICIsIC8qI19fUFVSRV9fKi8KICAgICAgICAgICAgICByZWFjdC5jcmVhdGVFbGVtZW50KFJvdXRlLCB7IGVsZW1lbnQ6IC8qI19fUFVSRV9fKi9yZWFjdC5jcmVhdGVFbGVtZW50KGNvbXBvbmVudHNfTGF5b3V0LCB7IHBhZ2VzOiBwYWdlcyB9KSB9LAogICAgICAgICAgICAgICIgIiwgLyojX19QVVJFX18qLwogICAgICAgICAgICAgIHJlYWN0LmNyZWF0ZUVsZW1lbnQoUm91dGUsIHsKICAgICAgICAgICAgICAgIHBhdGg6ICIvIiwKICAgICAgICAgICAgICAgIGVsZW1lbnQ6IC8qI19fUFVSRV9fKi9yZWFjdC5jcmVhdGVFbGVtZW50KE5hdmlnYXRlLCB7IHRvOiAiLyIgKyBwYWdlc1swXS5maWxlLCByZXBsYWNlOiB0cnVlIH0pIH0pLAogICAgICAgICAgICAgICIgIiwKICAgICAgICAgICAgICBwYWdlcy5tYXAoZnVuY3Rpb24gKHAsIGluZGV4KSB7CiAgICAgICAgICAgICAgICByZXR1cm4gLyojX19QVVJFX18qLygKICAgICAgICAgICAgICAgICAgcmVhY3QuY3JlYXRlRWxlbWVudChSb3V0ZSwgewogICAgICAgICAgICAgICAgICAgIGtleTogaW5kZXgsCiAgICAgICAgICAgICAgICAgICAgcGF0aDogIi8iICsgcC5maWxlLAogICAgICAgICAgICAgICAgICAgIGVsZW1lbnQ6IC8qI19fUFVSRV9fKi9yZWFjdC5jcmVhdGVFbGVtZW50KHJvdXRlc19SZWxheVBhZ2UsIHsgcGFnZTogcCB9KSB9KSk7CgoKICAgICAgICAgICAgICB9KSwgIiAiKSwKICAgICAgICAgICAgICAiICIpLAogICAgICAgICAgICAgICIgIikpOwoKCiAgICAgICAgICB9CgogICAgICAgICAgLyogaGFybW9ueSBkZWZhdWx0IGV4cG9ydCAqL3ZhciByZWxheV9BcHAgPSBBcHA7CgogICAgICAgICAgLyoqKi99LAoKICAgICAgICAvKioqLzQ0ODoKICAgICAgICAvKioqLyhfX3VudXNlZF93ZWJwYWNrX21vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgPT4gewoKICAgICAgICAgIC8qKgogICAgICAgICAgICogQGxpY2Vuc2UgUmVhY3QKICAgICAgICAgICAqIHJlYWN0LWRvbS5wcm9kdWN0aW9uLm1pbi5qcwogICAgICAgICAgICoKICAgICAgICAgICAqIENvcHlyaWdodCAoYykgRmFjZWJvb2ssIEluYy4gYW5kIGl0cyBhZmZpbGlhdGVzLgogICAgICAgICAgICoKICAgICAgICAgICAqIFRoaXMgc291cmNlIGNvZGUgaXMgbGljZW5zZWQgdW5kZXIgdGhlIE1JVCBsaWNlbnNlIGZvdW5kIGluIHRoZQogICAgICAgICAgICogTElDRU5TRSBmaWxlIGluIHRoZSByb290IGRpcmVjdG9yeSBvZiB0aGlzIHNvdXJjZSB0cmVlLgogICAgICAgICAgICovCiAgICAgICAgICAvKgogICAgICAgICAgIE1vZGVybml6ciAzLjAuMHByZSAoQ3VzdG9tIEJ1aWxkKSB8IE1JVAogICAgICAgICAgKi8KICAgICAgICAgIHZhciBhYSA9IF9fd2VicGFja19yZXF1aXJlX18oMjk0KSxjYSA9IF9fd2VicGFja19yZXF1aXJlX18oODQwKTtmdW5jdGlvbiBwKGEpIHtmb3IgKHZhciBiID0gImh0dHBzOi8vcmVhY3Rqcy5vcmcvZG9jcy9lcnJvci1kZWNvZGVyLmh0bWw/aW52YXJpYW50PSIgKyBhLCBjID0gMTsgYyA8IGFyZ3VtZW50cy5sZW5ndGg7IGMrKykge2IgKz0gIiZhcmdzW109IiArIGVuY29kZVVSSUNvbXBvbmVudChhcmd1bWVudHNbY10pO31yZXR1cm4gIk1pbmlmaWVkIFJlYWN0IGVycm9yICMiICsgYSArICI7IHZpc2l0ICIgKyBiICsgIiBmb3IgdGhlIGZ1bGwgbWVzc2FnZSBvciB1c2UgdGhlIG5vbi1taW5pZmllZCBkZXYgZW52aXJvbm1lbnQgZm9yIGZ1bGwgZXJyb3JzIGFuZCBhZGRpdGlvbmFsIGhlbHBmdWwgd2FybmluZ3MuIjt9dmFyIGRhID0gbmV3IFNldCgpLGVhID0ge307ZnVuY3Rpb24gZmEoYSwgYikge2hhKGEsIGIpO2hhKGEgKyAiQ2FwdHVyZSIsIGIpO30KICAgICAgICAgIGZ1bmN0aW9uIGhhKGEsIGIpIHtlYVthXSA9IGI7Zm9yIChhID0gMDsgYSA8IGIubGVuZ3RoOyBhKyspIHtkYS5hZGQoYlthXSk7fX0KICAgICAgICAgIHZhciBpYSA9ICEoInVuZGVmaW5lZCIgPT09IHR5cGVvZiB3aW5kb3cgfHwgInVuZGVmaW5lZCIgPT09IHR5cGVvZiB3aW5kb3cuZG9jdW1lbnQgfHwgInVuZGVmaW5lZCIgPT09IHR5cGVvZiB3aW5kb3cuZG9jdW1lbnQuY3JlYXRlRWxlbWVudCksamEgPSBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LGthID0gL15bOkEtWl9hLXpcdTAwQzAtXHUwMEQ2XHUwMEQ4LVx1MDBGNlx1MDBGOC1cdTAyRkZcdTAzNzAtXHUwMzdEXHUwMzdGLVx1MUZGRlx1MjAwQy1cdTIwMERcdTIwNzAtXHUyMThGXHUyQzAwLVx1MkZFRlx1MzAwMS1cdUQ3RkZcdUY5MDAtXHVGRENGXHVGREYwLVx1RkZGRF1bOkEtWl9hLXpcdTAwQzAtXHUwMEQ2XHUwMEQ4LVx1MDBGNlx1MDBGOC1cdTAyRkZcdTAzNzAtXHUwMzdEXHUwMzdGLVx1MUZGRlx1MjAwQy1cdTIwMERcdTIwNzAtXHUyMThGXHUyQzAwLVx1MkZFRlx1MzAwMS1cdUQ3RkZcdUY5MDAtXHVGRENGXHVGREYwLVx1RkZGRFwtLjAtOVx1MDBCN1x1MDMwMC1cdTAzNkZcdTIwM0YtXHUyMDQwXSokLyxsYSA9CiAgICAgICAgICAgIHt9LG1hID0ge307ZnVuY3Rpb24gb2EoYSkge2lmIChqYS5jYWxsKG1hLCBhKSkgcmV0dXJuICEwO2lmIChqYS5jYWxsKGxhLCBhKSkgcmV0dXJuICExO2lmIChrYS50ZXN0KGEpKSByZXR1cm4gbWFbYV0gPSAhMDtsYVthXSA9ICEwO3JldHVybiAhMTt9ZnVuY3Rpb24gcGEoYSwgYiwgYywgZCkge2lmIChudWxsICE9PSBjICYmIDAgPT09IGMudHlwZSkgcmV0dXJuICExO3N3aXRjaCAodHlwZW9mIGIpIHtjYXNlICJmdW5jdGlvbiI6Y2FzZSAic3ltYm9sIjpyZXR1cm4gITA7Y2FzZSAiYm9vbGVhbiI6aWYgKGQpIHJldHVybiAhMTtpZiAobnVsbCAhPT0gYykgcmV0dXJuICFjLmFjY2VwdHNCb29sZWFuczthID0gYS50b0xvd2VyQ2FzZSgpLnNsaWNlKDAsIDUpO3JldHVybiAiZGF0YS0iICE9PSBhICYmICJhcmlhLSIgIT09IGE7ZGVmYXVsdDpyZXR1cm4gITE7fX0KICAgICAgICAgIGZ1bmN0aW9uIHFhKGEsIGIsIGMsIGQpIHtpZiAobnVsbCA9PT0gYiB8fCAidW5kZWZpbmVkIiA9PT0gdHlwZW9mIGIgfHwgcGEoYSwgYiwgYywgZCkpIHJldHVybiAhMDtpZiAoZCkgcmV0dXJuICExO2lmIChudWxsICE9PSBjKSBzd2l0Y2ggKGMudHlwZSkge2Nhc2UgMzpyZXR1cm4gIWI7Y2FzZSA0OnJldHVybiAhMSA9PT0gYjtjYXNlIDU6cmV0dXJuIGlzTmFOKGIpO2Nhc2UgNjpyZXR1cm4gaXNOYU4oYikgfHwgMSA+IGI7fXJldHVybiAhMTt9ZnVuY3Rpb24gdihhLCBiLCBjLCBkLCBlLCBmLCBnKSB7dGhpcy5hY2NlcHRzQm9vbGVhbnMgPSAyID09PSBiIHx8IDMgPT09IGIgfHwgNCA9PT0gYjt0aGlzLmF0dHJpYnV0ZU5hbWUgPSBkO3RoaXMuYXR0cmlidXRlTmFtZXNwYWNlID0gZTt0aGlzLm11c3RVc2VQcm9wZXJ0eSA9IGM7dGhpcy5wcm9wZXJ0eU5hbWUgPSBhO3RoaXMudHlwZSA9IGI7dGhpcy5zYW5pdGl6ZVVSTCA9IGY7dGhpcy5yZW1vdmVFbXB0eVN0cmluZyA9IGc7fXZhciB6ID0ge307CiAgICAgICAgICAiY2hpbGRyZW4gZGFuZ2Vyb3VzbHlTZXRJbm5lckhUTUwgZGVmYXVsdFZhbHVlIGRlZmF1bHRDaGVja2VkIGlubmVySFRNTCBzdXBwcmVzc0NvbnRlbnRFZGl0YWJsZVdhcm5pbmcgc3VwcHJlc3NIeWRyYXRpb25XYXJuaW5nIHN0eWxlIi5zcGxpdCgiICIpLmZvckVhY2goZnVuY3Rpb24gKGEpIHt6W2FdID0gbmV3IHYoYSwgMCwgITEsIGEsIG51bGwsICExLCAhMSk7fSk7W1siYWNjZXB0Q2hhcnNldCIsICJhY2NlcHQtY2hhcnNldCJdLCBbImNsYXNzTmFtZSIsICJjbGFzcyJdLCBbImh0bWxGb3IiLCAiZm9yIl0sIFsiaHR0cEVxdWl2IiwgImh0dHAtZXF1aXYiXV0uZm9yRWFjaChmdW5jdGlvbiAoYSkge3ZhciBiID0gYVswXTt6W2JdID0gbmV3IHYoYiwgMSwgITEsIGFbMV0sIG51bGwsICExLCAhMSk7fSk7WyJjb250ZW50RWRpdGFibGUiLCAiZHJhZ2dhYmxlIiwgInNwZWxsQ2hlY2siLCAidmFsdWUiXS5mb3JFYWNoKGZ1bmN0aW9uIChhKSB7elthXSA9IG5ldyB2KGEsIDIsICExLCBhLnRvTG93ZXJDYXNlKCksIG51bGwsICExLCAhMSk7fSk7CiAgICAgICAgICBbImF1dG9SZXZlcnNlIiwgImV4dGVybmFsUmVzb3VyY2VzUmVxdWlyZWQiLCAiZm9jdXNhYmxlIiwgInByZXNlcnZlQWxwaGEiXS5mb3JFYWNoKGZ1bmN0aW9uIChhKSB7elthXSA9IG5ldyB2KGEsIDIsICExLCBhLCBudWxsLCAhMSwgITEpO30pOyJhbGxvd0Z1bGxTY3JlZW4gYXN5bmMgYXV0b0ZvY3VzIGF1dG9QbGF5IGNvbnRyb2xzIGRlZmF1bHQgZGVmZXIgZGlzYWJsZWQgZGlzYWJsZVBpY3R1cmVJblBpY3R1cmUgZGlzYWJsZVJlbW90ZVBsYXliYWNrIGZvcm1Ob1ZhbGlkYXRlIGhpZGRlbiBsb29wIG5vTW9kdWxlIG5vVmFsaWRhdGUgb3BlbiBwbGF5c0lubGluZSByZWFkT25seSByZXF1aXJlZCByZXZlcnNlZCBzY29wZWQgc2VhbWxlc3MgaXRlbVNjb3BlIi5zcGxpdCgiICIpLmZvckVhY2goZnVuY3Rpb24gKGEpIHt6W2FdID0gbmV3IHYoYSwgMywgITEsIGEudG9Mb3dlckNhc2UoKSwgbnVsbCwgITEsICExKTt9KTsKICAgICAgICAgIFsiY2hlY2tlZCIsICJtdWx0aXBsZSIsICJtdXRlZCIsICJzZWxlY3RlZCJdLmZvckVhY2goZnVuY3Rpb24gKGEpIHt6W2FdID0gbmV3IHYoYSwgMywgITAsIGEsIG51bGwsICExLCAhMSk7fSk7WyJjYXB0dXJlIiwgImRvd25sb2FkIl0uZm9yRWFjaChmdW5jdGlvbiAoYSkge3pbYV0gPSBuZXcgdihhLCA0LCAhMSwgYSwgbnVsbCwgITEsICExKTt9KTtbImNvbHMiLCAicm93cyIsICJzaXplIiwgInNwYW4iXS5mb3JFYWNoKGZ1bmN0aW9uIChhKSB7elthXSA9IG5ldyB2KGEsIDYsICExLCBhLCBudWxsLCAhMSwgITEpO30pO1sicm93U3BhbiIsICJzdGFydCJdLmZvckVhY2goZnVuY3Rpb24gKGEpIHt6W2FdID0gbmV3IHYoYSwgNSwgITEsIGEudG9Mb3dlckNhc2UoKSwgbnVsbCwgITEsICExKTt9KTt2YXIgcmEgPSAvW1wtOl0oW2Etel0pL2c7ZnVuY3Rpb24gc2EoYSkge3JldHVybiBhWzFdLnRvVXBwZXJDYXNlKCk7fQogICAgICAgICAgImFjY2VudC1oZWlnaHQgYWxpZ25tZW50LWJhc2VsaW5lIGFyYWJpYy1mb3JtIGJhc2VsaW5lLXNoaWZ0IGNhcC1oZWlnaHQgY2xpcC1wYXRoIGNsaXAtcnVsZSBjb2xvci1pbnRlcnBvbGF0aW9uIGNvbG9yLWludGVycG9sYXRpb24tZmlsdGVycyBjb2xvci1wcm9maWxlIGNvbG9yLXJlbmRlcmluZyBkb21pbmFudC1iYXNlbGluZSBlbmFibGUtYmFja2dyb3VuZCBmaWxsLW9wYWNpdHkgZmlsbC1ydWxlIGZsb29kLWNvbG9yIGZsb29kLW9wYWNpdHkgZm9udC1mYW1pbHkgZm9udC1zaXplIGZvbnQtc2l6ZS1hZGp1c3QgZm9udC1zdHJldGNoIGZvbnQtc3R5bGUgZm9udC12YXJpYW50IGZvbnQtd2VpZ2h0IGdseXBoLW5hbWUgZ2x5cGgtb3JpZW50YXRpb24taG9yaXpvbnRhbCBnbHlwaC1vcmllbnRhdGlvbi12ZXJ0aWNhbCBob3Jpei1hZHYteCBob3Jpei1vcmlnaW4teCBpbWFnZS1yZW5kZXJpbmcgbGV0dGVyLXNwYWNpbmcgbGlnaHRpbmctY29sb3IgbWFya2VyLWVuZCBtYXJrZXItbWlkIG1hcmtlci1zdGFydCBvdmVybGluZS1wb3NpdGlvbiBvdmVybGluZS10aGlja25lc3MgcGFpbnQtb3JkZXIgcGFub3NlLTEgcG9pbnRlci1ldmVudHMgcmVuZGVyaW5nLWludGVudCBzaGFwZS1yZW5kZXJpbmcgc3RvcC1jb2xvciBzdG9wLW9wYWNpdHkgc3RyaWtldGhyb3VnaC1wb3NpdGlvbiBzdHJpa2V0aHJvdWdoLXRoaWNrbmVzcyBzdHJva2UtZGFzaGFycmF5IHN0cm9rZS1kYXNob2Zmc2V0IHN0cm9rZS1saW5lY2FwIHN0cm9rZS1saW5lam9pbiBzdHJva2UtbWl0ZXJsaW1pdCBzdHJva2Utb3BhY2l0eSBzdHJva2Utd2lkdGggdGV4dC1hbmNob3IgdGV4dC1kZWNvcmF0aW9uIHRleHQtcmVuZGVyaW5nIHVuZGVybGluZS1wb3NpdGlvbiB1bmRlcmxpbmUtdGhpY2tuZXNzIHVuaWNvZGUtYmlkaSB1bmljb2RlLXJhbmdlIHVuaXRzLXBlci1lbSB2LWFscGhhYmV0aWMgdi1oYW5naW5nIHYtaWRlb2dyYXBoaWMgdi1tYXRoZW1hdGljYWwgdmVjdG9yLWVmZmVjdCB2ZXJ0LWFkdi15IHZlcnQtb3JpZ2luLXggdmVydC1vcmlnaW4teSB3b3JkLXNwYWNpbmcgd3JpdGluZy1tb2RlIHhtbG5zOnhsaW5rIHgtaGVpZ2h0Ii5zcGxpdCgiICIpLmZvckVhY2goZnVuY3Rpb24gKGEpIHt2YXIgYiA9IGEucmVwbGFjZShyYSwKICAgICAgICAgICAgc2EpO3pbYl0gPSBuZXcgdihiLCAxLCAhMSwgYSwgbnVsbCwgITEsICExKTt9KTsieGxpbms6YWN0dWF0ZSB4bGluazphcmNyb2xlIHhsaW5rOnJvbGUgeGxpbms6c2hvdyB4bGluazp0aXRsZSB4bGluazp0eXBlIi5zcGxpdCgiICIpLmZvckVhY2goZnVuY3Rpb24gKGEpIHt2YXIgYiA9IGEucmVwbGFjZShyYSwgc2EpO3pbYl0gPSBuZXcgdihiLCAxLCAhMSwgYSwgImh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiLCAhMSwgITEpO30pO1sieG1sOmJhc2UiLCAieG1sOmxhbmciLCAieG1sOnNwYWNlIl0uZm9yRWFjaChmdW5jdGlvbiAoYSkge3ZhciBiID0gYS5yZXBsYWNlKHJhLCBzYSk7eltiXSA9IG5ldyB2KGIsIDEsICExLCBhLCAiaHR0cDovL3d3dy53My5vcmcvWE1MLzE5OTgvbmFtZXNwYWNlIiwgITEsICExKTt9KTtbInRhYkluZGV4IiwgImNyb3NzT3JpZ2luIl0uZm9yRWFjaChmdW5jdGlvbiAoYSkge3pbYV0gPSBuZXcgdihhLCAxLCAhMSwgYS50b0xvd2VyQ2FzZSgpLCBudWxsLCAhMSwgITEpO30pOwogICAgICAgICAgei54bGlua0hyZWYgPSBuZXcgdigieGxpbmtIcmVmIiwgMSwgITEsICJ4bGluazpocmVmIiwgImh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiLCAhMCwgITEpO1sic3JjIiwgImhyZWYiLCAiYWN0aW9uIiwgImZvcm1BY3Rpb24iXS5mb3JFYWNoKGZ1bmN0aW9uIChhKSB7elthXSA9IG5ldyB2KGEsIDEsICExLCBhLnRvTG93ZXJDYXNlKCksIG51bGwsICEwLCAhMCk7fSk7CiAgICAgICAgICBmdW5jdGlvbiB0YShhLCBiLCBjLCBkKSB7dmFyIGUgPSB6Lmhhc093blByb3BlcnR5KGIpID8geltiXSA6IG51bGw7aWYgKG51bGwgIT09IGUgPyAwICE9PSBlLnR5cGUgOiBkIHx8ICEoMiA8IGIubGVuZ3RoKSB8fCAibyIgIT09IGJbMF0gJiYgIk8iICE9PSBiWzBdIHx8ICJuIiAhPT0gYlsxXSAmJiAiTiIgIT09IGJbMV0pIHFhKGIsIGMsIGUsIGQpICYmIChjID0gbnVsbCksIGQgfHwgbnVsbCA9PT0gZSA/IG9hKGIpICYmIChudWxsID09PSBjID8gYS5yZW1vdmVBdHRyaWJ1dGUoYikgOiBhLnNldEF0dHJpYnV0ZShiLCAiIiArIGMpKSA6IGUubXVzdFVzZVByb3BlcnR5ID8gYVtlLnByb3BlcnR5TmFtZV0gPSBudWxsID09PSBjID8gMyA9PT0gZS50eXBlID8gITEgOiAiIiA6IGMgOiAoYiA9IGUuYXR0cmlidXRlTmFtZSwgZCA9IGUuYXR0cmlidXRlTmFtZXNwYWNlLCBudWxsID09PSBjID8gYS5yZW1vdmVBdHRyaWJ1dGUoYikgOiAoZSA9IGUudHlwZSwgYyA9IDMgPT09IGUgfHwgNCA9PT0gZSAmJiAhMCA9PT0gYyA/ICIiIDogIiIgKyBjLCBkID8gYS5zZXRBdHRyaWJ1dGVOUyhkLCBiLCBjKSA6IGEuc2V0QXR0cmlidXRlKGIsIGMpKSk7fQogICAgICAgICAgdmFyIHVhID0gYWEuX19TRUNSRVRfSU5URVJOQUxTX0RPX05PVF9VU0VfT1JfWU9VX1dJTExfQkVfRklSRUQsdmEgPSBTeW1ib2wuZm9yKCJyZWFjdC5lbGVtZW50Iiksd2EgPSBTeW1ib2wuZm9yKCJyZWFjdC5wb3J0YWwiKSx5YSA9IFN5bWJvbC5mb3IoInJlYWN0LmZyYWdtZW50IiksemEgPSBTeW1ib2wuZm9yKCJyZWFjdC5zdHJpY3RfbW9kZSIpLEFhID0gU3ltYm9sLmZvcigicmVhY3QucHJvZmlsZXIiKSxCYSA9IFN5bWJvbC5mb3IoInJlYWN0LnByb3ZpZGVyIiksQ2EgPSBTeW1ib2wuZm9yKCJyZWFjdC5jb250ZXh0IiksRGEgPSBTeW1ib2wuZm9yKCJyZWFjdC5mb3J3YXJkX3JlZiIpLEVhID0gU3ltYm9sLmZvcigicmVhY3Quc3VzcGVuc2UiKSxGYSA9IFN5bWJvbC5mb3IoInJlYWN0LnN1c3BlbnNlX2xpc3QiKSxHYSA9IFN5bWJvbC5mb3IoInJlYWN0Lm1lbW8iKSxIYSA9IFN5bWJvbC5mb3IoInJlYWN0LmxhenkiKTtTeW1ib2wuZm9yKCJyZWFjdC5zY29wZSIpO1N5bWJvbC5mb3IoInJlYWN0LmRlYnVnX3RyYWNlX21vZGUiKTsKICAgICAgICAgIHZhciBJYSA9IFN5bWJvbC5mb3IoInJlYWN0Lm9mZnNjcmVlbiIpO1N5bWJvbC5mb3IoInJlYWN0LmxlZ2FjeV9oaWRkZW4iKTtTeW1ib2wuZm9yKCJyZWFjdC5jYWNoZSIpO1N5bWJvbC5mb3IoInJlYWN0LnRyYWNpbmdfbWFya2VyIik7dmFyIEphID0gU3ltYm9sLml0ZXJhdG9yO2Z1bmN0aW9uIEthKGEpIHtpZiAobnVsbCA9PT0gYSB8fCAib2JqZWN0IiAhPT0gdHlwZW9mIGEpIHJldHVybiBudWxsO2EgPSBKYSAmJiBhW0phXSB8fCBhWyJAQGl0ZXJhdG9yIl07cmV0dXJuICJmdW5jdGlvbiIgPT09IHR5cGVvZiBhID8gYSA6IG51bGw7fXZhciBBID0gT2JqZWN0LmFzc2lnbixMYTtmdW5jdGlvbiBNYShhKSB7aWYgKHZvaWQgMCA9PT0gTGEpIHRyeSB7dGhyb3cgRXJyb3IoKTt9IGNhdGNoIChjKSB7dmFyIGIgPSBjLnN0YWNrLnRyaW0oKS5tYXRjaCgvXG4oICooYXQgKT8pLyk7TGEgPSBiICYmIGJbMV0gfHwgIiI7fXJldHVybiAiXG4iICsgTGEgKyBhO312YXIgTmEgPSAhMTsKICAgICAgICAgIGZ1bmN0aW9uIE9hKGEsIGIpIHtpZiAoIWEgfHwgTmEpIHJldHVybiAiIjtOYSA9ICEwO3ZhciBjID0gRXJyb3IucHJlcGFyZVN0YWNrVHJhY2U7RXJyb3IucHJlcGFyZVN0YWNrVHJhY2UgPSB2b2lkIDA7dHJ5IHtpZiAoYikge2lmIChiID0gZnVuY3Rpb24gYigpIHt0aHJvdyBFcnJvcigpO30sIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShiLnByb3RvdHlwZSwgInByb3BzIiwgeyBzZXQ6IGZ1bmN0aW9uIHNldCgpIHt0aHJvdyBFcnJvcigpO30gfSksICJvYmplY3QiID09PSB0eXBlb2YgUmVmbGVjdCAmJiBSZWZsZWN0LmNvbnN0cnVjdCkge3RyeSB7UmVmbGVjdC5jb25zdHJ1Y3QoYiwgW10pO30gY2F0Y2ggKGwpIHt2YXIgZCA9IGw7fVJlZmxlY3QuY29uc3RydWN0KGEsIFtdLCBiKTt9IGVsc2Uge3RyeSB7Yi5jYWxsKCk7fSBjYXRjaCAobCkge2QgPSBsO31hLmNhbGwoYi5wcm90b3R5cGUpO319IGVsc2Uge3RyeSB7dGhyb3cgRXJyb3IoKTt9IGNhdGNoIChsKSB7ZCA9IGw7fWEoKTt9fSBjYXRjaCAobCkge2lmIChsICYmIGQgJiYgInN0cmluZyIgPT09IHR5cGVvZiBsLnN0YWNrKSB7Zm9yICh2YXIgZSA9IGwuc3RhY2suc3BsaXQoIlxuIiksCiAgICAgICAgICAgICAgICAgIGYgPSBkLnN0YWNrLnNwbGl0KCJcbiIpLCBnID0gZS5sZW5ndGggLSAxLCBoID0gZi5sZW5ndGggLSAxOyAxIDw9IGcgJiYgMCA8PSBoICYmIGVbZ10gIT09IGZbaF07KSB7aC0tO31mb3IgKDsgMSA8PSBnICYmIDAgPD0gaDsgZy0tLCBoLS0pIHtpZiAoZVtnXSAhPT0gZltoXSkge2lmICgxICE9PSBnIHx8IDEgIT09IGgpIHtkbyB7aWYgKGctLSwgaC0tLCAwID4gaCB8fCBlW2ddICE9PSBmW2hdKSB7dmFyIGsgPSAiXG4iICsgZVtnXS5yZXBsYWNlKCIgYXQgbmV3ICIsICIgYXQgIik7YS5kaXNwbGF5TmFtZSAmJiBrLmluY2x1ZGVzKCI8YW5vbnltb3VzPiIpICYmIChrID0gay5yZXBsYWNlKCI8YW5vbnltb3VzPiIsIGEuZGlzcGxheU5hbWUpKTtyZXR1cm4gazt9fSB3aGlsZSAoMSA8PSBnICYmIDAgPD0gaCk7fWJyZWFrO319fX0gZmluYWxseSB7TmEgPSAhMSwgRXJyb3IucHJlcGFyZVN0YWNrVHJhY2UgPSBjO31yZXR1cm4gKGEgPSBhID8gYS5kaXNwbGF5TmFtZSB8fCBhLm5hbWUgOiAiIikgPyBNYShhKSA6ICIiO30KICAgICAgICAgIGZ1bmN0aW9uIFBhKGEpIHtzd2l0Y2ggKGEudGFnKSB7Y2FzZSA1OnJldHVybiBNYShhLnR5cGUpO2Nhc2UgMTY6cmV0dXJuIE1hKCJMYXp5Iik7Y2FzZSAxMzpyZXR1cm4gTWEoIlN1c3BlbnNlIik7Y2FzZSAxOTpyZXR1cm4gTWEoIlN1c3BlbnNlTGlzdCIpO2Nhc2UgMDpjYXNlIDI6Y2FzZSAxNTpyZXR1cm4gYSA9IE9hKGEudHlwZSwgITEpLCBhO2Nhc2UgMTE6cmV0dXJuIGEgPSBPYShhLnR5cGUucmVuZGVyLCAhMSksIGE7Y2FzZSAxOnJldHVybiBhID0gT2EoYS50eXBlLCAhMCksIGE7ZGVmYXVsdDpyZXR1cm4gIiI7fX0KICAgICAgICAgIGZ1bmN0aW9uIFFhKGEpIHtpZiAobnVsbCA9PSBhKSByZXR1cm4gbnVsbDtpZiAoImZ1bmN0aW9uIiA9PT0gdHlwZW9mIGEpIHJldHVybiBhLmRpc3BsYXlOYW1lIHx8IGEubmFtZSB8fCBudWxsO2lmICgic3RyaW5nIiA9PT0gdHlwZW9mIGEpIHJldHVybiBhO3N3aXRjaCAoYSkge2Nhc2UgeWE6cmV0dXJuICJGcmFnbWVudCI7Y2FzZSB3YTpyZXR1cm4gIlBvcnRhbCI7Y2FzZSBBYTpyZXR1cm4gIlByb2ZpbGVyIjtjYXNlIHphOnJldHVybiAiU3RyaWN0TW9kZSI7Y2FzZSBFYTpyZXR1cm4gIlN1c3BlbnNlIjtjYXNlIEZhOnJldHVybiAiU3VzcGVuc2VMaXN0Ijt9aWYgKCJvYmplY3QiID09PSB0eXBlb2YgYSkgc3dpdGNoIChhLiQkdHlwZW9mKSB7Y2FzZSBDYTpyZXR1cm4gKGEuZGlzcGxheU5hbWUgfHwgIkNvbnRleHQiKSArICIuQ29uc3VtZXIiO2Nhc2UgQmE6cmV0dXJuIChhLl9jb250ZXh0LmRpc3BsYXlOYW1lIHx8ICJDb250ZXh0IikgKyAiLlByb3ZpZGVyIjtjYXNlIERhOnZhciBiID0gYS5yZW5kZXI7YSA9IGEuZGlzcGxheU5hbWU7YSB8fCAoYSA9IGIuZGlzcGxheU5hbWUgfHwKICAgICAgICAgICAgICAgIGIubmFtZSB8fCAiIiwgYSA9ICIiICE9PSBhID8gIkZvcndhcmRSZWYoIiArIGEgKyAiKSIgOiAiRm9yd2FyZFJlZiIpO3JldHVybiBhO2Nhc2UgR2E6cmV0dXJuIGIgPSBhLmRpc3BsYXlOYW1lIHx8IG51bGwsIG51bGwgIT09IGIgPyBiIDogUWEoYS50eXBlKSB8fCAiTWVtbyI7Y2FzZSBIYTpiID0gYS5fcGF5bG9hZDthID0gYS5faW5pdDt0cnkge3JldHVybiBRYShhKGIpKTt9IGNhdGNoIChjKSB7fX1yZXR1cm4gbnVsbDt9CiAgICAgICAgICBmdW5jdGlvbiBSYShhKSB7dmFyIGIgPSBhLnR5cGU7c3dpdGNoIChhLnRhZykge2Nhc2UgMjQ6cmV0dXJuICJDYWNoZSI7Y2FzZSA5OnJldHVybiAoYi5kaXNwbGF5TmFtZSB8fCAiQ29udGV4dCIpICsgIi5Db25zdW1lciI7Y2FzZSAxMDpyZXR1cm4gKGIuX2NvbnRleHQuZGlzcGxheU5hbWUgfHwgIkNvbnRleHQiKSArICIuUHJvdmlkZXIiO2Nhc2UgMTg6cmV0dXJuICJEZWh5ZHJhdGVkRnJhZ21lbnQiO2Nhc2UgMTE6cmV0dXJuIGEgPSBiLnJlbmRlciwgYSA9IGEuZGlzcGxheU5hbWUgfHwgYS5uYW1lIHx8ICIiLCBiLmRpc3BsYXlOYW1lIHx8ICgiIiAhPT0gYSA/ICJGb3J3YXJkUmVmKCIgKyBhICsgIikiIDogIkZvcndhcmRSZWYiKTtjYXNlIDc6cmV0dXJuICJGcmFnbWVudCI7Y2FzZSA1OnJldHVybiBiO2Nhc2UgNDpyZXR1cm4gIlBvcnRhbCI7Y2FzZSAzOnJldHVybiAiUm9vdCI7Y2FzZSA2OnJldHVybiAiVGV4dCI7Y2FzZSAxNjpyZXR1cm4gUWEoYik7Y2FzZSA4OnJldHVybiBiID09PSB6YSA/ICJTdHJpY3RNb2RlIiA6ICJNb2RlIjtjYXNlIDIyOnJldHVybiAiT2Zmc2NyZWVuIjsKICAgICAgICAgICAgICBjYXNlIDEyOnJldHVybiAiUHJvZmlsZXIiO2Nhc2UgMjE6cmV0dXJuICJTY29wZSI7Y2FzZSAxMzpyZXR1cm4gIlN1c3BlbnNlIjtjYXNlIDE5OnJldHVybiAiU3VzcGVuc2VMaXN0IjtjYXNlIDI1OnJldHVybiAiVHJhY2luZ01hcmtlciI7Y2FzZSAxOmNhc2UgMDpjYXNlIDE3OmNhc2UgMjpjYXNlIDE0OmNhc2UgMTU6aWYgKCJmdW5jdGlvbiIgPT09IHR5cGVvZiBiKSByZXR1cm4gYi5kaXNwbGF5TmFtZSB8fCBiLm5hbWUgfHwgbnVsbDtpZiAoInN0cmluZyIgPT09IHR5cGVvZiBiKSByZXR1cm4gYjt9cmV0dXJuIG51bGw7fWZ1bmN0aW9uIFNhKGEpIHtzd2l0Y2ggKHR5cGVvZiBhKSB7Y2FzZSAiYm9vbGVhbiI6Y2FzZSAibnVtYmVyIjpjYXNlICJzdHJpbmciOmNhc2UgInVuZGVmaW5lZCI6cmV0dXJuIGE7Y2FzZSAib2JqZWN0IjpyZXR1cm4gYTtkZWZhdWx0OnJldHVybiAiIjt9fQogICAgICAgICAgZnVuY3Rpb24gVGEoYSkge3ZhciBiID0gYS50eXBlO3JldHVybiAoYSA9IGEubm9kZU5hbWUpICYmICJpbnB1dCIgPT09IGEudG9Mb3dlckNhc2UoKSAmJiAoImNoZWNrYm94IiA9PT0gYiB8fCAicmFkaW8iID09PSBiKTt9CiAgICAgICAgICBmdW5jdGlvbiBVYShhKSB7dmFyIGIgPSBUYShhKSA/ICJjaGVja2VkIiA6ICJ2YWx1ZSIsYyA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IoYS5jb25zdHJ1Y3Rvci5wcm90b3R5cGUsIGIpLGQgPSAiIiArIGFbYl07aWYgKCFhLmhhc093blByb3BlcnR5KGIpICYmICJ1bmRlZmluZWQiICE9PSB0eXBlb2YgYyAmJiAiZnVuY3Rpb24iID09PSB0eXBlb2YgYy5nZXQgJiYgImZ1bmN0aW9uIiA9PT0gdHlwZW9mIGMuc2V0KSB7dmFyIGUgPSBjLmdldCxmID0gYy5zZXQ7T2JqZWN0LmRlZmluZVByb3BlcnR5KGEsIGIsIHsgY29uZmlndXJhYmxlOiAhMCwgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7cmV0dXJuIGUuY2FsbCh0aGlzKTt9LCBzZXQ6IGZ1bmN0aW9uIHNldChhKSB7ZCA9ICIiICsgYTtmLmNhbGwodGhpcywgYSk7fSB9KTtPYmplY3QuZGVmaW5lUHJvcGVydHkoYSwgYiwgeyBlbnVtZXJhYmxlOiBjLmVudW1lcmFibGUgfSk7cmV0dXJuIHsgZ2V0VmFsdWU6IGZ1bmN0aW9uIGdldFZhbHVlKCkge3JldHVybiBkO30sIHNldFZhbHVlOiBmdW5jdGlvbiBzZXRWYWx1ZShhKSB7ZCA9ICIiICsgYTt9LCBzdG9wVHJhY2tpbmc6IGZ1bmN0aW9uIHN0b3BUcmFja2luZygpIHthLl92YWx1ZVRyYWNrZXIgPQogICAgICAgICAgICAgICAgICBudWxsO2RlbGV0ZSBhW2JdO30gfTt9fWZ1bmN0aW9uIFZhKGEpIHthLl92YWx1ZVRyYWNrZXIgfHwgKGEuX3ZhbHVlVHJhY2tlciA9IFVhKGEpKTt9ZnVuY3Rpb24gV2EoYSkge2lmICghYSkgcmV0dXJuICExO3ZhciBiID0gYS5fdmFsdWVUcmFja2VyO2lmICghYikgcmV0dXJuICEwO3ZhciBjID0gYi5nZXRWYWx1ZSgpO3ZhciBkID0gIiI7YSAmJiAoZCA9IFRhKGEpID8gYS5jaGVja2VkID8gInRydWUiIDogImZhbHNlIiA6IGEudmFsdWUpO2EgPSBkO3JldHVybiBhICE9PSBjID8gKGIuc2V0VmFsdWUoYSksICEwKSA6ICExO31mdW5jdGlvbiBYYShhKSB7YSA9IGEgfHwgKCJ1bmRlZmluZWQiICE9PSB0eXBlb2YgZG9jdW1lbnQgPyBkb2N1bWVudCA6IHZvaWQgMCk7aWYgKCJ1bmRlZmluZWQiID09PSB0eXBlb2YgYSkgcmV0dXJuIG51bGw7dHJ5IHtyZXR1cm4gYS5hY3RpdmVFbGVtZW50IHx8IGEuYm9keTt9IGNhdGNoIChiKSB7cmV0dXJuIGEuYm9keTt9fQogICAgICAgICAgZnVuY3Rpb24gWWEoYSwgYikge3ZhciBjID0gYi5jaGVja2VkO3JldHVybiBBKHt9LCBiLCB7IGRlZmF1bHRDaGVja2VkOiB2b2lkIDAsIGRlZmF1bHRWYWx1ZTogdm9pZCAwLCB2YWx1ZTogdm9pZCAwLCBjaGVja2VkOiBudWxsICE9IGMgPyBjIDogYS5fd3JhcHBlclN0YXRlLmluaXRpYWxDaGVja2VkIH0pO31mdW5jdGlvbiBaYShhLCBiKSB7dmFyIGMgPSBudWxsID09IGIuZGVmYXVsdFZhbHVlID8gIiIgOiBiLmRlZmF1bHRWYWx1ZSxkID0gbnVsbCAhPSBiLmNoZWNrZWQgPyBiLmNoZWNrZWQgOiBiLmRlZmF1bHRDaGVja2VkO2MgPSBTYShudWxsICE9IGIudmFsdWUgPyBiLnZhbHVlIDogYyk7YS5fd3JhcHBlclN0YXRlID0geyBpbml0aWFsQ2hlY2tlZDogZCwgaW5pdGlhbFZhbHVlOiBjLCBjb250cm9sbGVkOiAiY2hlY2tib3giID09PSBiLnR5cGUgfHwgInJhZGlvIiA9PT0gYi50eXBlID8gbnVsbCAhPSBiLmNoZWNrZWQgOiBudWxsICE9IGIudmFsdWUgfTt9ZnVuY3Rpb24gYWIoYSwgYikge2IgPSBiLmNoZWNrZWQ7bnVsbCAhPSBiICYmIHRhKGEsICJjaGVja2VkIiwgYiwgITEpO30KICAgICAgICAgIGZ1bmN0aW9uIGJiKGEsIGIpIHthYihhLCBiKTt2YXIgYyA9IFNhKGIudmFsdWUpLGQgPSBiLnR5cGU7aWYgKG51bGwgIT0gYykge2lmICgibnVtYmVyIiA9PT0gZCkge2lmICgwID09PSBjICYmICIiID09PSBhLnZhbHVlIHx8IGEudmFsdWUgIT0gYykgYS52YWx1ZSA9ICIiICsgYzt9IGVsc2UgYS52YWx1ZSAhPT0gIiIgKyBjICYmIChhLnZhbHVlID0gIiIgKyBjKTt9IGVsc2UgaWYgKCJzdWJtaXQiID09PSBkIHx8ICJyZXNldCIgPT09IGQpIHthLnJlbW92ZUF0dHJpYnV0ZSgidmFsdWUiKTtyZXR1cm47fWIuaGFzT3duUHJvcGVydHkoInZhbHVlIikgPyBjYihhLCBiLnR5cGUsIGMpIDogYi5oYXNPd25Qcm9wZXJ0eSgiZGVmYXVsdFZhbHVlIikgJiYgY2IoYSwgYi50eXBlLCBTYShiLmRlZmF1bHRWYWx1ZSkpO251bGwgPT0gYi5jaGVja2VkICYmIG51bGwgIT0gYi5kZWZhdWx0Q2hlY2tlZCAmJiAoYS5kZWZhdWx0Q2hlY2tlZCA9ICEhYi5kZWZhdWx0Q2hlY2tlZCk7fQogICAgICAgICAgZnVuY3Rpb24gZGIoYSwgYiwgYykge2lmIChiLmhhc093blByb3BlcnR5KCJ2YWx1ZSIpIHx8IGIuaGFzT3duUHJvcGVydHkoImRlZmF1bHRWYWx1ZSIpKSB7dmFyIGQgPSBiLnR5cGU7aWYgKCEoInN1Ym1pdCIgIT09IGQgJiYgInJlc2V0IiAhPT0gZCB8fCB2b2lkIDAgIT09IGIudmFsdWUgJiYgbnVsbCAhPT0gYi52YWx1ZSkpIHJldHVybjtiID0gIiIgKyBhLl93cmFwcGVyU3RhdGUuaW5pdGlhbFZhbHVlO2MgfHwgYiA9PT0gYS52YWx1ZSB8fCAoYS52YWx1ZSA9IGIpO2EuZGVmYXVsdFZhbHVlID0gYjt9YyA9IGEubmFtZTsiIiAhPT0gYyAmJiAoYS5uYW1lID0gIiIpO2EuZGVmYXVsdENoZWNrZWQgPSAhIWEuX3dyYXBwZXJTdGF0ZS5pbml0aWFsQ2hlY2tlZDsiIiAhPT0gYyAmJiAoYS5uYW1lID0gYyk7fQogICAgICAgICAgZnVuY3Rpb24gY2IoYSwgYiwgYykge2lmICgibnVtYmVyIiAhPT0gYiB8fCBYYShhLm93bmVyRG9jdW1lbnQpICE9PSBhKSBudWxsID09IGMgPyBhLmRlZmF1bHRWYWx1ZSA9ICIiICsgYS5fd3JhcHBlclN0YXRlLmluaXRpYWxWYWx1ZSA6IGEuZGVmYXVsdFZhbHVlICE9PSAiIiArIGMgJiYgKGEuZGVmYXVsdFZhbHVlID0gIiIgKyBjKTt9dmFyIGViID0gQXJyYXkuaXNBcnJheTsKICAgICAgICAgIGZ1bmN0aW9uIGZiKGEsIGIsIGMsIGQpIHthID0gYS5vcHRpb25zO2lmIChiKSB7YiA9IHt9O2ZvciAodmFyIGUgPSAwOyBlIDwgYy5sZW5ndGg7IGUrKykge2JbIiQiICsgY1tlXV0gPSAhMDt9Zm9yIChjID0gMDsgYyA8IGEubGVuZ3RoOyBjKyspIHtlID0gYi5oYXNPd25Qcm9wZXJ0eSgiJCIgKyBhW2NdLnZhbHVlKSwgYVtjXS5zZWxlY3RlZCAhPT0gZSAmJiAoYVtjXS5zZWxlY3RlZCA9IGUpLCBlICYmIGQgJiYgKGFbY10uZGVmYXVsdFNlbGVjdGVkID0gITApO319IGVsc2Uge2MgPSAiIiArIFNhKGMpO2IgPSBudWxsO2ZvciAoZSA9IDA7IGUgPCBhLmxlbmd0aDsgZSsrKSB7aWYgKGFbZV0udmFsdWUgPT09IGMpIHthW2VdLnNlbGVjdGVkID0gITA7ZCAmJiAoYVtlXS5kZWZhdWx0U2VsZWN0ZWQgPSAhMCk7cmV0dXJuO31udWxsICE9PSBiIHx8IGFbZV0uZGlzYWJsZWQgfHwgKGIgPSBhW2VdKTt9bnVsbCAhPT0gYiAmJiAoYi5zZWxlY3RlZCA9ICEwKTt9fQogICAgICAgICAgZnVuY3Rpb24gZ2IoYSwgYikge2lmIChudWxsICE9IGIuZGFuZ2Vyb3VzbHlTZXRJbm5lckhUTUwpIHRocm93IEVycm9yKHAoOTEpKTtyZXR1cm4gQSh7fSwgYiwgeyB2YWx1ZTogdm9pZCAwLCBkZWZhdWx0VmFsdWU6IHZvaWQgMCwgY2hpbGRyZW46ICIiICsgYS5fd3JhcHBlclN0YXRlLmluaXRpYWxWYWx1ZSB9KTt9ZnVuY3Rpb24gaGIoYSwgYikge3ZhciBjID0gYi52YWx1ZTtpZiAobnVsbCA9PSBjKSB7YyA9IGIuY2hpbGRyZW47YiA9IGIuZGVmYXVsdFZhbHVlO2lmIChudWxsICE9IGMpIHtpZiAobnVsbCAhPSBiKSB0aHJvdyBFcnJvcihwKDkyKSk7aWYgKGViKGMpKSB7aWYgKDEgPCBjLmxlbmd0aCkgdGhyb3cgRXJyb3IocCg5MykpO2MgPSBjWzBdO31iID0gYzt9bnVsbCA9PSBiICYmIChiID0gIiIpO2MgPSBiO31hLl93cmFwcGVyU3RhdGUgPSB7IGluaXRpYWxWYWx1ZTogU2EoYykgfTt9CiAgICAgICAgICBmdW5jdGlvbiBpYihhLCBiKSB7dmFyIGMgPSBTYShiLnZhbHVlKSxkID0gU2EoYi5kZWZhdWx0VmFsdWUpO251bGwgIT0gYyAmJiAoYyA9ICIiICsgYywgYyAhPT0gYS52YWx1ZSAmJiAoYS52YWx1ZSA9IGMpLCBudWxsID09IGIuZGVmYXVsdFZhbHVlICYmIGEuZGVmYXVsdFZhbHVlICE9PSBjICYmIChhLmRlZmF1bHRWYWx1ZSA9IGMpKTtudWxsICE9IGQgJiYgKGEuZGVmYXVsdFZhbHVlID0gIiIgKyBkKTt9ZnVuY3Rpb24gamIoYSkge3ZhciBiID0gYS50ZXh0Q29udGVudDtiID09PSBhLl93cmFwcGVyU3RhdGUuaW5pdGlhbFZhbHVlICYmICIiICE9PSBiICYmIG51bGwgIT09IGIgJiYgKGEudmFsdWUgPSBiKTt9ZnVuY3Rpb24ga2IoYSkge3N3aXRjaCAoYSkge2Nhc2UgInN2ZyI6cmV0dXJuICJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI7Y2FzZSAibWF0aCI6cmV0dXJuICJodHRwOi8vd3d3LnczLm9yZy8xOTk4L01hdGgvTWF0aE1MIjtkZWZhdWx0OnJldHVybiAiaHR0cDovL3d3dy53My5vcmcvMTk5OS94aHRtbCI7fX0KICAgICAgICAgIGZ1bmN0aW9uIGxiKGEsIGIpIHtyZXR1cm4gbnVsbCA9PSBhIHx8ICJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hodG1sIiA9PT0gYSA/IGtiKGIpIDogImh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiA9PT0gYSAmJiAiZm9yZWlnbk9iamVjdCIgPT09IGIgPyAiaHR0cDovL3d3dy53My5vcmcvMTk5OS94aHRtbCIgOiBhO30KICAgICAgICAgIHZhciBtYixuYiA9IGZ1bmN0aW9uIChhKSB7cmV0dXJuICJ1bmRlZmluZWQiICE9PSB0eXBlb2YgTVNBcHAgJiYgTVNBcHAuZXhlY1Vuc2FmZUxvY2FsRnVuY3Rpb24gPyBmdW5jdGlvbiAoYiwgYywgZCwgZSkge01TQXBwLmV4ZWNVbnNhZmVMb2NhbEZ1bmN0aW9uKGZ1bmN0aW9uICgpIHtyZXR1cm4gYShiLCBjLCBkLCBlKTt9KTt9IDogYTt9KGZ1bmN0aW9uIChhLCBiKSB7aWYgKCJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgIT09IGEubmFtZXNwYWNlVVJJIHx8ICJpbm5lckhUTUwiIGluIGEpIGEuaW5uZXJIVE1MID0gYjtlbHNlIHttYiA9IG1iIHx8IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpO21iLmlubmVySFRNTCA9ICI8c3ZnPiIgKyBiLnZhbHVlT2YoKS50b1N0cmluZygpICsgIjwvc3ZnPiI7Zm9yIChiID0gbWIuZmlyc3RDaGlsZDsgYS5maXJzdENoaWxkOykge2EucmVtb3ZlQ2hpbGQoYS5maXJzdENoaWxkKTt9Zm9yICg7IGIuZmlyc3RDaGlsZDspIHthLmFwcGVuZENoaWxkKGIuZmlyc3RDaGlsZCk7fX19KTsKICAgICAgICAgIGZ1bmN0aW9uIG9iKGEsIGIpIHtpZiAoYikge3ZhciBjID0gYS5maXJzdENoaWxkO2lmIChjICYmIGMgPT09IGEubGFzdENoaWxkICYmIDMgPT09IGMubm9kZVR5cGUpIHtjLm5vZGVWYWx1ZSA9IGI7cmV0dXJuO319YS50ZXh0Q29udGVudCA9IGI7fQogICAgICAgICAgdmFyIHBiID0geyBhbmltYXRpb25JdGVyYXRpb25Db3VudDogITAsIGFzcGVjdFJhdGlvOiAhMCwgYm9yZGVySW1hZ2VPdXRzZXQ6ICEwLCBib3JkZXJJbWFnZVNsaWNlOiAhMCwgYm9yZGVySW1hZ2VXaWR0aDogITAsIGJveEZsZXg6ICEwLCBib3hGbGV4R3JvdXA6ICEwLCBib3hPcmRpbmFsR3JvdXA6ICEwLCBjb2x1bW5Db3VudDogITAsIGNvbHVtbnM6ICEwLCBmbGV4OiAhMCwgZmxleEdyb3c6ICEwLCBmbGV4UG9zaXRpdmU6ICEwLCBmbGV4U2hyaW5rOiAhMCwgZmxleE5lZ2F0aXZlOiAhMCwgZmxleE9yZGVyOiAhMCwgZ3JpZEFyZWE6ICEwLCBncmlkUm93OiAhMCwgZ3JpZFJvd0VuZDogITAsIGdyaWRSb3dTcGFuOiAhMCwgZ3JpZFJvd1N0YXJ0OiAhMCwgZ3JpZENvbHVtbjogITAsIGdyaWRDb2x1bW5FbmQ6ICEwLCBncmlkQ29sdW1uU3BhbjogITAsIGdyaWRDb2x1bW5TdGFydDogITAsIGZvbnRXZWlnaHQ6ICEwLCBsaW5lQ2xhbXA6ICEwLCBsaW5lSGVpZ2h0OiAhMCwgb3BhY2l0eTogITAsIG9yZGVyOiAhMCwgb3JwaGFuczogITAsIHRhYlNpemU6ICEwLCB3aWRvd3M6ICEwLCB6SW5kZXg6ICEwLAogICAgICAgICAgICAgIHpvb206ICEwLCBmaWxsT3BhY2l0eTogITAsIGZsb29kT3BhY2l0eTogITAsIHN0b3BPcGFjaXR5OiAhMCwgc3Ryb2tlRGFzaGFycmF5OiAhMCwgc3Ryb2tlRGFzaG9mZnNldDogITAsIHN0cm9rZU1pdGVybGltaXQ6ICEwLCBzdHJva2VPcGFjaXR5OiAhMCwgc3Ryb2tlV2lkdGg6ICEwIH0scWIgPSBbIldlYmtpdCIsICJtcyIsICJNb3oiLCAiTyJdO09iamVjdC5rZXlzKHBiKS5mb3JFYWNoKGZ1bmN0aW9uIChhKSB7cWIuZm9yRWFjaChmdW5jdGlvbiAoYikge2IgPSBiICsgYS5jaGFyQXQoMCkudG9VcHBlckNhc2UoKSArIGEuc3Vic3RyaW5nKDEpO3BiW2JdID0gcGJbYV07fSk7fSk7ZnVuY3Rpb24gcmIoYSwgYiwgYykge3JldHVybiBudWxsID09IGIgfHwgImJvb2xlYW4iID09PSB0eXBlb2YgYiB8fCAiIiA9PT0gYiA/ICIiIDogYyB8fCAibnVtYmVyIiAhPT0gdHlwZW9mIGIgfHwgMCA9PT0gYiB8fCBwYi5oYXNPd25Qcm9wZXJ0eShhKSAmJiBwYlthXSA/ICgiIiArIGIpLnRyaW0oKSA6IGIgKyAicHgiO30KICAgICAgICAgIGZ1bmN0aW9uIHNiKGEsIGIpIHthID0gYS5zdHlsZTtmb3IgKHZhciBjIGluIGIpIHtpZiAoYi5oYXNPd25Qcm9wZXJ0eShjKSkge3ZhciBkID0gMCA9PT0gYy5pbmRleE9mKCItLSIpLGUgPSByYihjLCBiW2NdLCBkKTsiZmxvYXQiID09PSBjICYmIChjID0gImNzc0Zsb2F0Iik7ZCA/IGEuc2V0UHJvcGVydHkoYywgZSkgOiBhW2NdID0gZTt9fX12YXIgdGIgPSBBKHsgbWVudWl0ZW06ICEwIH0sIHsgYXJlYTogITAsIGJhc2U6ICEwLCBicjogITAsIGNvbDogITAsIGVtYmVkOiAhMCwgaHI6ICEwLCBpbWc6ICEwLCBpbnB1dDogITAsIGtleWdlbjogITAsIGxpbms6ICEwLCBtZXRhOiAhMCwgcGFyYW06ICEwLCBzb3VyY2U6ICEwLCB0cmFjazogITAsIHdicjogITAgfSk7CiAgICAgICAgICBmdW5jdGlvbiB1YihhLCBiKSB7aWYgKGIpIHtpZiAodGJbYV0gJiYgKG51bGwgIT0gYi5jaGlsZHJlbiB8fCBudWxsICE9IGIuZGFuZ2Vyb3VzbHlTZXRJbm5lckhUTUwpKSB0aHJvdyBFcnJvcihwKDEzNywgYSkpO2lmIChudWxsICE9IGIuZGFuZ2Vyb3VzbHlTZXRJbm5lckhUTUwpIHtpZiAobnVsbCAhPSBiLmNoaWxkcmVuKSB0aHJvdyBFcnJvcihwKDYwKSk7aWYgKCJvYmplY3QiICE9PSB0eXBlb2YgYi5kYW5nZXJvdXNseVNldElubmVySFRNTCB8fCAhKCJfX2h0bWwiIGluIGIuZGFuZ2Vyb3VzbHlTZXRJbm5lckhUTUwpKSB0aHJvdyBFcnJvcihwKDYxKSk7fWlmIChudWxsICE9IGIuc3R5bGUgJiYgIm9iamVjdCIgIT09IHR5cGVvZiBiLnN0eWxlKSB0aHJvdyBFcnJvcihwKDYyKSk7fX0KICAgICAgICAgIGZ1bmN0aW9uIHZiKGEsIGIpIHtpZiAoLTEgPT09IGEuaW5kZXhPZigiLSIpKSByZXR1cm4gInN0cmluZyIgPT09IHR5cGVvZiBiLmlzO3N3aXRjaCAoYSkge2Nhc2UgImFubm90YXRpb24teG1sIjpjYXNlICJjb2xvci1wcm9maWxlIjpjYXNlICJmb250LWZhY2UiOmNhc2UgImZvbnQtZmFjZS1zcmMiOmNhc2UgImZvbnQtZmFjZS11cmkiOmNhc2UgImZvbnQtZmFjZS1mb3JtYXQiOmNhc2UgImZvbnQtZmFjZS1uYW1lIjpjYXNlICJtaXNzaW5nLWdseXBoIjpyZXR1cm4gITE7ZGVmYXVsdDpyZXR1cm4gITA7fX12YXIgd2IgPSBudWxsO2Z1bmN0aW9uIHhiKGEpIHthID0gYS50YXJnZXQgfHwgYS5zcmNFbGVtZW50IHx8IHdpbmRvdzthLmNvcnJlc3BvbmRpbmdVc2VFbGVtZW50ICYmIChhID0gYS5jb3JyZXNwb25kaW5nVXNlRWxlbWVudCk7cmV0dXJuIDMgPT09IGEubm9kZVR5cGUgPyBhLnBhcmVudE5vZGUgOiBhO312YXIgeWIgPSBudWxsLHpiID0gbnVsbCxBYiA9IG51bGw7CiAgICAgICAgICBmdW5jdGlvbiBCYihhKSB7aWYgKGEgPSBDYihhKSkge2lmICgiZnVuY3Rpb24iICE9PSB0eXBlb2YgeWIpIHRocm93IEVycm9yKHAoMjgwKSk7dmFyIGIgPSBhLnN0YXRlTm9kZTtiICYmIChiID0gRGIoYiksIHliKGEuc3RhdGVOb2RlLCBhLnR5cGUsIGIpKTt9fWZ1bmN0aW9uIEViKGEpIHt6YiA/IEFiID8gQWIucHVzaChhKSA6IEFiID0gW2FdIDogemIgPSBhO31mdW5jdGlvbiBGYigpIHtpZiAoemIpIHt2YXIgYSA9IHpiLGIgPSBBYjtBYiA9IHpiID0gbnVsbDtCYihhKTtpZiAoYikgZm9yIChhID0gMDsgYSA8IGIubGVuZ3RoOyBhKyspIHtCYihiW2FdKTt9fX1mdW5jdGlvbiBHYihhLCBiKSB7cmV0dXJuIGEoYik7fWZ1bmN0aW9uIEhiKCkge312YXIgSWIgPSAhMTtmdW5jdGlvbiBKYihhLCBiLCBjKSB7aWYgKEliKSByZXR1cm4gYShiLCBjKTtJYiA9ICEwO3RyeSB7cmV0dXJuIEdiKGEsIGIsIGMpO30gZmluYWxseSB7aWYgKEliID0gITEsIG51bGwgIT09IHpiIHx8IG51bGwgIT09IEFiKSBIYigpLCBGYigpO319CiAgICAgICAgICBmdW5jdGlvbiBLYihhLCBiKSB7dmFyIGMgPSBhLnN0YXRlTm9kZTtpZiAobnVsbCA9PT0gYykgcmV0dXJuIG51bGw7dmFyIGQgPSBEYihjKTtpZiAobnVsbCA9PT0gZCkgcmV0dXJuIG51bGw7YyA9IGRbYl07YTogc3dpdGNoIChiKSB7Y2FzZSAib25DbGljayI6Y2FzZSAib25DbGlja0NhcHR1cmUiOmNhc2UgIm9uRG91YmxlQ2xpY2siOmNhc2UgIm9uRG91YmxlQ2xpY2tDYXB0dXJlIjpjYXNlICJvbk1vdXNlRG93biI6Y2FzZSAib25Nb3VzZURvd25DYXB0dXJlIjpjYXNlICJvbk1vdXNlTW92ZSI6Y2FzZSAib25Nb3VzZU1vdmVDYXB0dXJlIjpjYXNlICJvbk1vdXNlVXAiOmNhc2UgIm9uTW91c2VVcENhcHR1cmUiOmNhc2UgIm9uTW91c2VFbnRlciI6KGQgPSAhZC5kaXNhYmxlZCkgfHwgKGEgPSBhLnR5cGUsIGQgPSAhKCJidXR0b24iID09PSBhIHx8ICJpbnB1dCIgPT09IGEgfHwgInNlbGVjdCIgPT09IGEgfHwgInRleHRhcmVhIiA9PT0gYSkpO2EgPSAhZDticmVhayBhO2RlZmF1bHQ6YSA9ICExO31pZiAoYSkgcmV0dXJuIG51bGw7aWYgKGMgJiYgImZ1bmN0aW9uIiAhPT0KICAgICAgICAgICAgdHlwZW9mIGMpIHRocm93IEVycm9yKHAoMjMxLCBiLCB0eXBlb2YgYykpO3JldHVybiBjO312YXIgTGIgPSAhMTtpZiAoaWEpIHRyeSB7dmFyIE1iID0ge307T2JqZWN0LmRlZmluZVByb3BlcnR5KE1iLCAicGFzc2l2ZSIsIHsgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7TGIgPSAhMDt9IH0pO3dpbmRvdy5hZGRFdmVudExpc3RlbmVyKCJ0ZXN0IiwgTWIsIE1iKTt3aW5kb3cucmVtb3ZlRXZlbnRMaXN0ZW5lcigidGVzdCIsIE1iLCBNYik7fSBjYXRjaCAoYSkge0xiID0gITE7fWZ1bmN0aW9uIE5iKGEsIGIsIGMsIGQsIGUsIGYsIGcsIGgsIGspIHt2YXIgbCA9IEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGFyZ3VtZW50cywgMyk7dHJ5IHtiLmFwcGx5KGMsIGwpO30gY2F0Y2ggKG0pIHt0aGlzLm9uRXJyb3IobSk7fX12YXIgT2IgPSAhMSxQYiA9IG51bGwsUWIgPSAhMSxSYiA9IG51bGwsU2IgPSB7IG9uRXJyb3I6IGZ1bmN0aW9uIG9uRXJyb3IoYSkge09iID0gITA7UGIgPSBhO30gfTtmdW5jdGlvbiBUYihhLCBiLCBjLCBkLCBlLCBmLCBnLCBoLCBrKSB7T2IgPSAhMTtQYiA9IG51bGw7TmIuYXBwbHkoU2IsIGFyZ3VtZW50cyk7fQogICAgICAgICAgZnVuY3Rpb24gVWIoYSwgYiwgYywgZCwgZSwgZiwgZywgaCwgaykge1RiLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7aWYgKE9iKSB7aWYgKE9iKSB7dmFyIGwgPSBQYjtPYiA9ICExO1BiID0gbnVsbDt9IGVsc2UgdGhyb3cgRXJyb3IocCgxOTgpKTtRYiB8fCAoUWIgPSAhMCwgUmIgPSBsKTt9fWZ1bmN0aW9uIFZiKGEpIHt2YXIgYiA9IGEsYyA9IGE7aWYgKGEuYWx0ZXJuYXRlKSBmb3IgKDsgYi5yZXR1cm47KSB7YiA9IGIucmV0dXJuO30gZWxzZSB7YSA9IGI7ZG8ge2IgPSBhLCAwICE9PSAoYi5mbGFncyAmIDQwOTgpICYmIChjID0gYi5yZXR1cm4pLCBhID0gYi5yZXR1cm47fSB3aGlsZSAoYSk7fXJldHVybiAzID09PSBiLnRhZyA/IGMgOiBudWxsO31mdW5jdGlvbiBXYihhKSB7aWYgKDEzID09PSBhLnRhZykge3ZhciBiID0gYS5tZW1vaXplZFN0YXRlO251bGwgPT09IGIgJiYgKGEgPSBhLmFsdGVybmF0ZSwgbnVsbCAhPT0gYSAmJiAoYiA9IGEubWVtb2l6ZWRTdGF0ZSkpO2lmIChudWxsICE9PSBiKSByZXR1cm4gYi5kZWh5ZHJhdGVkO31yZXR1cm4gbnVsbDt9ZnVuY3Rpb24gWGIoYSkge2lmIChWYihhKSAhPT0gYSkgdGhyb3cgRXJyb3IocCgxODgpKTt9CiAgICAgICAgICBmdW5jdGlvbiBZYihhKSB7dmFyIGIgPSBhLmFsdGVybmF0ZTtpZiAoIWIpIHtiID0gVmIoYSk7aWYgKG51bGwgPT09IGIpIHRocm93IEVycm9yKHAoMTg4KSk7cmV0dXJuIGIgIT09IGEgPyBudWxsIDogYTt9Zm9yICh2YXIgYyA9IGEsIGQgPSBiOzspIHt2YXIgZSA9IGMucmV0dXJuO2lmIChudWxsID09PSBlKSBicmVhazt2YXIgZiA9IGUuYWx0ZXJuYXRlO2lmIChudWxsID09PSBmKSB7ZCA9IGUucmV0dXJuO2lmIChudWxsICE9PSBkKSB7YyA9IGQ7Y29udGludWU7fWJyZWFrO31pZiAoZS5jaGlsZCA9PT0gZi5jaGlsZCkge2ZvciAoZiA9IGUuY2hpbGQ7IGY7KSB7aWYgKGYgPT09IGMpIHJldHVybiBYYihlKSwgYTtpZiAoZiA9PT0gZCkgcmV0dXJuIFhiKGUpLCBiO2YgPSBmLnNpYmxpbmc7fXRocm93IEVycm9yKHAoMTg4KSk7fWlmIChjLnJldHVybiAhPT0gZC5yZXR1cm4pIGMgPSBlLCBkID0gZjtlbHNlIHtmb3IgKHZhciBnID0gITEsIGggPSBlLmNoaWxkOyBoOykge2lmIChoID09PSBjKSB7ZyA9ICEwO2MgPSBlO2QgPSBmO2JyZWFrO31pZiAoaCA9PT0gZCkge2cgPSAhMDtkID0gZTtjID0gZjticmVhazt9aCA9IGguc2libGluZzt9aWYgKCFnKSB7Zm9yIChoID0gZi5jaGlsZDsgaDspIHtpZiAoaCA9PT0KICAgICAgICAgICAgICAgICAgICBjKSB7ZyA9ICEwO2MgPSBmO2QgPSBlO2JyZWFrO31pZiAoaCA9PT0gZCkge2cgPSAhMDtkID0gZjtjID0gZTticmVhazt9aCA9IGguc2libGluZzt9aWYgKCFnKSB0aHJvdyBFcnJvcihwKDE4OSkpO319aWYgKGMuYWx0ZXJuYXRlICE9PSBkKSB0aHJvdyBFcnJvcihwKDE5MCkpO31pZiAoMyAhPT0gYy50YWcpIHRocm93IEVycm9yKHAoMTg4KSk7cmV0dXJuIGMuc3RhdGVOb2RlLmN1cnJlbnQgPT09IGMgPyBhIDogYjt9ZnVuY3Rpb24gWmIoYSkge2EgPSBZYihhKTtyZXR1cm4gbnVsbCAhPT0gYSA/ICRiKGEpIDogbnVsbDt9ZnVuY3Rpb24gJGIoYSkge2lmICg1ID09PSBhLnRhZyB8fCA2ID09PSBhLnRhZykgcmV0dXJuIGE7Zm9yIChhID0gYS5jaGlsZDsgbnVsbCAhPT0gYTspIHt2YXIgYiA9ICRiKGEpO2lmIChudWxsICE9PSBiKSByZXR1cm4gYjthID0gYS5zaWJsaW5nO31yZXR1cm4gbnVsbDt9CiAgICAgICAgICB2YXIgYWMgPSBjYS51bnN0YWJsZV9zY2hlZHVsZUNhbGxiYWNrLGJjID0gY2EudW5zdGFibGVfY2FuY2VsQ2FsbGJhY2ssY2MgPSBjYS51bnN0YWJsZV9zaG91bGRZaWVsZCxkYyA9IGNhLnVuc3RhYmxlX3JlcXVlc3RQYWludCxCID0gY2EudW5zdGFibGVfbm93LGVjID0gY2EudW5zdGFibGVfZ2V0Q3VycmVudFByaW9yaXR5TGV2ZWwsZmMgPSBjYS51bnN0YWJsZV9JbW1lZGlhdGVQcmlvcml0eSxnYyA9IGNhLnVuc3RhYmxlX1VzZXJCbG9ja2luZ1ByaW9yaXR5LGhjID0gY2EudW5zdGFibGVfTm9ybWFsUHJpb3JpdHksaWMgPSBjYS51bnN0YWJsZV9Mb3dQcmlvcml0eSxqYyA9IGNhLnVuc3RhYmxlX0lkbGVQcmlvcml0eSxrYyA9IG51bGwsbGMgPSBudWxsO2Z1bmN0aW9uIG1jKGEpIHtpZiAobGMgJiYgImZ1bmN0aW9uIiA9PT0gdHlwZW9mIGxjLm9uQ29tbWl0RmliZXJSb290KSB0cnkge2xjLm9uQ29tbWl0RmliZXJSb290KGtjLCBhLCB2b2lkIDAsIDEyOCA9PT0gKGEuY3VycmVudC5mbGFncyAmIDEyOCkpO30gY2F0Y2ggKGIpIHt9fQogICAgICAgICAgdmFyIG9jID0gTWF0aC5jbHozMiA/IE1hdGguY2x6MzIgOiBuYyxwYyA9IE1hdGgubG9nLHFjID0gTWF0aC5MTjI7ZnVuY3Rpb24gbmMoYSkge2EgPj4+PSAwO3JldHVybiAwID09PSBhID8gMzIgOiAzMSAtIChwYyhhKSAvIHFjIHwgMCkgfCAwO312YXIgcmMgPSA2NCxzYyA9IDQxOTQzMDQ7CiAgICAgICAgICBmdW5jdGlvbiB0YyhhKSB7c3dpdGNoIChhICYgLWEpIHtjYXNlIDE6cmV0dXJuIDE7Y2FzZSAyOnJldHVybiAyO2Nhc2UgNDpyZXR1cm4gNDtjYXNlIDg6cmV0dXJuIDg7Y2FzZSAxNjpyZXR1cm4gMTY7Y2FzZSAzMjpyZXR1cm4gMzI7Y2FzZSA2NDpjYXNlIDEyODpjYXNlIDI1NjpjYXNlIDUxMjpjYXNlIDEwMjQ6Y2FzZSAyMDQ4OmNhc2UgNDA5NjpjYXNlIDgxOTI6Y2FzZSAxNjM4NDpjYXNlIDMyNzY4OmNhc2UgNjU1MzY6Y2FzZSAxMzEwNzI6Y2FzZSAyNjIxNDQ6Y2FzZSA1MjQyODg6Y2FzZSAxMDQ4NTc2OmNhc2UgMjA5NzE1MjpyZXR1cm4gYSAmIDQxOTQyNDA7Y2FzZSA0MTk0MzA0OmNhc2UgODM4ODYwODpjYXNlIDE2Nzc3MjE2OmNhc2UgMzM1NTQ0MzI6Y2FzZSA2NzEwODg2NDpyZXR1cm4gYSAmIDEzMDAyMzQyNDtjYXNlIDEzNDIxNzcyODpyZXR1cm4gMTM0MjE3NzI4O2Nhc2UgMjY4NDM1NDU2OnJldHVybiAyNjg0MzU0NTY7Y2FzZSA1MzY4NzA5MTI6cmV0dXJuIDUzNjg3MDkxMjtjYXNlIDEwNzM3NDE4MjQ6cmV0dXJuIDEwNzM3NDE4MjQ7CiAgICAgICAgICAgICAgZGVmYXVsdDpyZXR1cm4gYTt9fWZ1bmN0aW9uIHVjKGEsIGIpIHt2YXIgYyA9IGEucGVuZGluZ0xhbmVzO2lmICgwID09PSBjKSByZXR1cm4gMDt2YXIgZCA9IDAsZSA9IGEuc3VzcGVuZGVkTGFuZXMsZiA9IGEucGluZ2VkTGFuZXMsZyA9IGMgJiAyNjg0MzU0NTU7aWYgKDAgIT09IGcpIHt2YXIgaCA9IGcgJiB+ZTswICE9PSBoID8gZCA9IHRjKGgpIDogKGYgJj0gZywgMCAhPT0gZiAmJiAoZCA9IHRjKGYpKSk7fSBlbHNlIGcgPSBjICYgfmUsIDAgIT09IGcgPyBkID0gdGMoZykgOiAwICE9PSBmICYmIChkID0gdGMoZikpO2lmICgwID09PSBkKSByZXR1cm4gMDtpZiAoMCAhPT0gYiAmJiBiICE9PSBkICYmIDAgPT09IChiICYgZSkgJiYgKGUgPSBkICYgLWQsIGYgPSBiICYgLWIsIGUgPj0gZiB8fCAxNiA9PT0gZSAmJiAwICE9PSAoZiAmIDQxOTQyNDApKSkgcmV0dXJuIGI7MCAhPT0gKGQgJiA0KSAmJiAoZCB8PSBjICYgMTYpO2IgPSBhLmVudGFuZ2xlZExhbmVzO2lmICgwICE9PSBiKSBmb3IgKGEgPSBhLmVudGFuZ2xlbWVudHMsIGIgJj0gZDsgMCA8IGI7KSB7YyA9IDMxIC0gb2MoYiksIGUgPSAxIDw8IGMsIGQgfD0gYVtjXSwgYiAmPSB+ZTt9cmV0dXJuIGQ7fQogICAgICAgICAgZnVuY3Rpb24gdmMoYSwgYikge3N3aXRjaCAoYSkge2Nhc2UgMTpjYXNlIDI6Y2FzZSA0OnJldHVybiBiICsgMjUwO2Nhc2UgODpjYXNlIDE2OmNhc2UgMzI6Y2FzZSA2NDpjYXNlIDEyODpjYXNlIDI1NjpjYXNlIDUxMjpjYXNlIDEwMjQ6Y2FzZSAyMDQ4OmNhc2UgNDA5NjpjYXNlIDgxOTI6Y2FzZSAxNjM4NDpjYXNlIDMyNzY4OmNhc2UgNjU1MzY6Y2FzZSAxMzEwNzI6Y2FzZSAyNjIxNDQ6Y2FzZSA1MjQyODg6Y2FzZSAxMDQ4NTc2OmNhc2UgMjA5NzE1MjpyZXR1cm4gYiArIDVFMztjYXNlIDQxOTQzMDQ6Y2FzZSA4Mzg4NjA4OmNhc2UgMTY3NzcyMTY6Y2FzZSAzMzU1NDQzMjpjYXNlIDY3MTA4ODY0OnJldHVybiAtMTtjYXNlIDEzNDIxNzcyODpjYXNlIDI2ODQzNTQ1NjpjYXNlIDUzNjg3MDkxMjpjYXNlIDEwNzM3NDE4MjQ6cmV0dXJuIC0xO2RlZmF1bHQ6cmV0dXJuIC0xO319CiAgICAgICAgICBmdW5jdGlvbiB3YyhhLCBiKSB7Zm9yICh2YXIgYyA9IGEuc3VzcGVuZGVkTGFuZXMsIGQgPSBhLnBpbmdlZExhbmVzLCBlID0gYS5leHBpcmF0aW9uVGltZXMsIGYgPSBhLnBlbmRpbmdMYW5lczsgMCA8IGY7KSB7dmFyIGcgPSAzMSAtIG9jKGYpLGggPSAxIDw8IGcsayA9IGVbZ107aWYgKC0xID09PSBrKSB7aWYgKDAgPT09IChoICYgYykgfHwgMCAhPT0gKGggJiBkKSkgZVtnXSA9IHZjKGgsIGIpO30gZWxzZSBrIDw9IGIgJiYgKGEuZXhwaXJlZExhbmVzIHw9IGgpO2YgJj0gfmg7fX1mdW5jdGlvbiB4YyhhKSB7YSA9IGEucGVuZGluZ0xhbmVzICYgLTEwNzM3NDE4MjU7cmV0dXJuIDAgIT09IGEgPyBhIDogYSAmIDEwNzM3NDE4MjQgPyAxMDczNzQxODI0IDogMDt9ZnVuY3Rpb24geWMoKSB7dmFyIGEgPSByYztyYyA8PD0gMTswID09PSAocmMgJiA0MTk0MjQwKSAmJiAocmMgPSA2NCk7cmV0dXJuIGE7fWZ1bmN0aW9uIHpjKGEpIHtmb3IgKHZhciBiID0gW10sIGMgPSAwOyAzMSA+IGM7IGMrKykge2IucHVzaChhKTt9cmV0dXJuIGI7fQogICAgICAgICAgZnVuY3Rpb24gQWMoYSwgYiwgYykge2EucGVuZGluZ0xhbmVzIHw9IGI7NTM2ODcwOTEyICE9PSBiICYmIChhLnN1c3BlbmRlZExhbmVzID0gMCwgYS5waW5nZWRMYW5lcyA9IDApO2EgPSBhLmV2ZW50VGltZXM7YiA9IDMxIC0gb2MoYik7YVtiXSA9IGM7fWZ1bmN0aW9uIEJjKGEsIGIpIHt2YXIgYyA9IGEucGVuZGluZ0xhbmVzICYgfmI7YS5wZW5kaW5nTGFuZXMgPSBiO2Euc3VzcGVuZGVkTGFuZXMgPSAwO2EucGluZ2VkTGFuZXMgPSAwO2EuZXhwaXJlZExhbmVzICY9IGI7YS5tdXRhYmxlUmVhZExhbmVzICY9IGI7YS5lbnRhbmdsZWRMYW5lcyAmPSBiO2IgPSBhLmVudGFuZ2xlbWVudHM7dmFyIGQgPSBhLmV2ZW50VGltZXM7Zm9yIChhID0gYS5leHBpcmF0aW9uVGltZXM7IDAgPCBjOykge3ZhciBlID0gMzEgLSBvYyhjKSxmID0gMSA8PCBlO2JbZV0gPSAwO2RbZV0gPSAtMTthW2VdID0gLTE7YyAmPSB+Zjt9fQogICAgICAgICAgZnVuY3Rpb24gQ2MoYSwgYikge3ZhciBjID0gYS5lbnRhbmdsZWRMYW5lcyB8PSBiO2ZvciAoYSA9IGEuZW50YW5nbGVtZW50czsgYzspIHt2YXIgZCA9IDMxIC0gb2MoYyksZSA9IDEgPDwgZDtlICYgYiB8IGFbZF0gJiBiICYmIChhW2RdIHw9IGIpO2MgJj0gfmU7fX12YXIgQyA9IDA7ZnVuY3Rpb24gRGMoYSkge2EgJj0gLWE7cmV0dXJuIDEgPCBhID8gNCA8IGEgPyAwICE9PSAoYSAmIDI2ODQzNTQ1NSkgPyAxNiA6IDUzNjg3MDkxMiA6IDQgOiAxO312YXIgRWMsRmMsR2MsSGMsSWMsSmMgPSAhMSxLYyA9IFtdLExjID0gbnVsbCxNYyA9IG51bGwsTmMgPSBudWxsLE9jID0gbmV3IE1hcCgpLFBjID0gbmV3IE1hcCgpLFFjID0gW10sUmMgPSAibW91c2Vkb3duIG1vdXNldXAgdG91Y2hjYW5jZWwgdG91Y2hlbmQgdG91Y2hzdGFydCBhdXhjbGljayBkYmxjbGljayBwb2ludGVyY2FuY2VsIHBvaW50ZXJkb3duIHBvaW50ZXJ1cCBkcmFnZW5kIGRyYWdzdGFydCBkcm9wIGNvbXBvc2l0aW9uZW5kIGNvbXBvc2l0aW9uc3RhcnQga2V5ZG93biBrZXlwcmVzcyBrZXl1cCBpbnB1dCB0ZXh0SW5wdXQgY29weSBjdXQgcGFzdGUgY2xpY2sgY2hhbmdlIGNvbnRleHRtZW51IHJlc2V0IHN1Ym1pdCIuc3BsaXQoIiAiKTsKICAgICAgICAgIGZ1bmN0aW9uIFNjKGEsIGIpIHtzd2l0Y2ggKGEpIHtjYXNlICJmb2N1c2luIjpjYXNlICJmb2N1c291dCI6TGMgPSBudWxsO2JyZWFrO2Nhc2UgImRyYWdlbnRlciI6Y2FzZSAiZHJhZ2xlYXZlIjpNYyA9IG51bGw7YnJlYWs7Y2FzZSAibW91c2VvdmVyIjpjYXNlICJtb3VzZW91dCI6TmMgPSBudWxsO2JyZWFrO2Nhc2UgInBvaW50ZXJvdmVyIjpjYXNlICJwb2ludGVyb3V0IjpPYy5kZWxldGUoYi5wb2ludGVySWQpO2JyZWFrO2Nhc2UgImdvdHBvaW50ZXJjYXB0dXJlIjpjYXNlICJsb3N0cG9pbnRlcmNhcHR1cmUiOlBjLmRlbGV0ZShiLnBvaW50ZXJJZCk7fX0KICAgICAgICAgIGZ1bmN0aW9uIFRjKGEsIGIsIGMsIGQsIGUsIGYpIHtpZiAobnVsbCA9PT0gYSB8fCBhLm5hdGl2ZUV2ZW50ICE9PSBmKSByZXR1cm4gYSA9IHsgYmxvY2tlZE9uOiBiLCBkb21FdmVudE5hbWU6IGMsIGV2ZW50U3lzdGVtRmxhZ3M6IGQsIG5hdGl2ZUV2ZW50OiBmLCB0YXJnZXRDb250YWluZXJzOiBbZV0gfSwgbnVsbCAhPT0gYiAmJiAoYiA9IENiKGIpLCBudWxsICE9PSBiICYmIEZjKGIpKSwgYTthLmV2ZW50U3lzdGVtRmxhZ3MgfD0gZDtiID0gYS50YXJnZXRDb250YWluZXJzO251bGwgIT09IGUgJiYgLTEgPT09IGIuaW5kZXhPZihlKSAmJiBiLnB1c2goZSk7cmV0dXJuIGE7fQogICAgICAgICAgZnVuY3Rpb24gVWMoYSwgYiwgYywgZCwgZSkge3N3aXRjaCAoYikge2Nhc2UgImZvY3VzaW4iOnJldHVybiBMYyA9IFRjKExjLCBhLCBiLCBjLCBkLCBlKSwgITA7Y2FzZSAiZHJhZ2VudGVyIjpyZXR1cm4gTWMgPSBUYyhNYywgYSwgYiwgYywgZCwgZSksICEwO2Nhc2UgIm1vdXNlb3ZlciI6cmV0dXJuIE5jID0gVGMoTmMsIGEsIGIsIGMsIGQsIGUpLCAhMDtjYXNlICJwb2ludGVyb3ZlciI6dmFyIGYgPSBlLnBvaW50ZXJJZDtPYy5zZXQoZiwgVGMoT2MuZ2V0KGYpIHx8IG51bGwsIGEsIGIsIGMsIGQsIGUpKTtyZXR1cm4gITA7Y2FzZSAiZ290cG9pbnRlcmNhcHR1cmUiOnJldHVybiBmID0gZS5wb2ludGVySWQsIFBjLnNldChmLCBUYyhQYy5nZXQoZikgfHwgbnVsbCwgYSwgYiwgYywgZCwgZSkpLCAhMDt9cmV0dXJuICExO30KICAgICAgICAgIGZ1bmN0aW9uIFZjKGEpIHt2YXIgYiA9IFdjKGEudGFyZ2V0KTtpZiAobnVsbCAhPT0gYikge3ZhciBjID0gVmIoYik7aWYgKG51bGwgIT09IGMpIGlmIChiID0gYy50YWcsIDEzID09PSBiKSB7aWYgKGIgPSBXYihjKSwgbnVsbCAhPT0gYikge2EuYmxvY2tlZE9uID0gYjtJYyhhLnByaW9yaXR5LCBmdW5jdGlvbiAoKSB7R2MoYyk7fSk7cmV0dXJuO319IGVsc2UgaWYgKDMgPT09IGIgJiYgYy5zdGF0ZU5vZGUuY3VycmVudC5tZW1vaXplZFN0YXRlLmlzRGVoeWRyYXRlZCkge2EuYmxvY2tlZE9uID0gMyA9PT0gYy50YWcgPyBjLnN0YXRlTm9kZS5jb250YWluZXJJbmZvIDogbnVsbDtyZXR1cm47fX1hLmJsb2NrZWRPbiA9IG51bGw7fQogICAgICAgICAgZnVuY3Rpb24gWGMoYSkge2lmIChudWxsICE9PSBhLmJsb2NrZWRPbikgcmV0dXJuICExO2ZvciAodmFyIGIgPSBhLnRhcmdldENvbnRhaW5lcnM7IDAgPCBiLmxlbmd0aDspIHt2YXIgYyA9IFljKGEuZG9tRXZlbnROYW1lLCBhLmV2ZW50U3lzdGVtRmxhZ3MsIGJbMF0sIGEubmF0aXZlRXZlbnQpO2lmIChudWxsID09PSBjKSB7YyA9IGEubmF0aXZlRXZlbnQ7dmFyIGQgPSBuZXcgYy5jb25zdHJ1Y3RvcihjLnR5cGUsIGMpO3diID0gZDtjLnRhcmdldC5kaXNwYXRjaEV2ZW50KGQpO3diID0gbnVsbDt9IGVsc2UgcmV0dXJuIGIgPSBDYihjKSwgbnVsbCAhPT0gYiAmJiBGYyhiKSwgYS5ibG9ja2VkT24gPSBjLCAhMTtiLnNoaWZ0KCk7fXJldHVybiAhMDt9ZnVuY3Rpb24gWmMoYSwgYiwgYykge1hjKGEpICYmIGMuZGVsZXRlKGIpO31mdW5jdGlvbiAkYygpIHtKYyA9ICExO251bGwgIT09IExjICYmIFhjKExjKSAmJiAoTGMgPSBudWxsKTtudWxsICE9PSBNYyAmJiBYYyhNYykgJiYgKE1jID0gbnVsbCk7bnVsbCAhPT0gTmMgJiYgWGMoTmMpICYmIChOYyA9IG51bGwpO09jLmZvckVhY2goWmMpO1BjLmZvckVhY2goWmMpO30KICAgICAgICAgIGZ1bmN0aW9uIGFkKGEsIGIpIHthLmJsb2NrZWRPbiA9PT0gYiAmJiAoYS5ibG9ja2VkT24gPSBudWxsLCBKYyB8fCAoSmMgPSAhMCwgY2EudW5zdGFibGVfc2NoZWR1bGVDYWxsYmFjayhjYS51bnN0YWJsZV9Ob3JtYWxQcmlvcml0eSwgJGMpKSk7fQogICAgICAgICAgZnVuY3Rpb24gYmQoYSkge2Z1bmN0aW9uIGIoYikge3JldHVybiBhZChiLCBhKTt9aWYgKDAgPCBLYy5sZW5ndGgpIHthZChLY1swXSwgYSk7Zm9yICh2YXIgYyA9IDE7IGMgPCBLYy5sZW5ndGg7IGMrKykge3ZhciBkID0gS2NbY107ZC5ibG9ja2VkT24gPT09IGEgJiYgKGQuYmxvY2tlZE9uID0gbnVsbCk7fX1udWxsICE9PSBMYyAmJiBhZChMYywgYSk7bnVsbCAhPT0gTWMgJiYgYWQoTWMsIGEpO251bGwgIT09IE5jICYmIGFkKE5jLCBhKTtPYy5mb3JFYWNoKGIpO1BjLmZvckVhY2goYik7Zm9yIChjID0gMDsgYyA8IFFjLmxlbmd0aDsgYysrKSB7ZCA9IFFjW2NdLCBkLmJsb2NrZWRPbiA9PT0gYSAmJiAoZC5ibG9ja2VkT24gPSBudWxsKTt9Zm9yICg7IDAgPCBRYy5sZW5ndGggJiYgKGMgPSBRY1swXSwgbnVsbCA9PT0gYy5ibG9ja2VkT24pOykge1ZjKGMpLCBudWxsID09PSBjLmJsb2NrZWRPbiAmJiBRYy5zaGlmdCgpO319dmFyIGNkID0gdWEuUmVhY3RDdXJyZW50QmF0Y2hDb25maWcsZGQgPSAhMDsKICAgICAgICAgIGZ1bmN0aW9uIGVkKGEsIGIsIGMsIGQpIHt2YXIgZSA9IEMsZiA9IGNkLnRyYW5zaXRpb247Y2QudHJhbnNpdGlvbiA9IG51bGw7dHJ5IHtDID0gMSwgZmQoYSwgYiwgYywgZCk7fSBmaW5hbGx5IHtDID0gZSwgY2QudHJhbnNpdGlvbiA9IGY7fX1mdW5jdGlvbiBnZChhLCBiLCBjLCBkKSB7dmFyIGUgPSBDLGYgPSBjZC50cmFuc2l0aW9uO2NkLnRyYW5zaXRpb24gPSBudWxsO3RyeSB7QyA9IDQsIGZkKGEsIGIsIGMsIGQpO30gZmluYWxseSB7QyA9IGUsIGNkLnRyYW5zaXRpb24gPSBmO319CiAgICAgICAgICBmdW5jdGlvbiBmZChhLCBiLCBjLCBkKSB7aWYgKGRkKSB7dmFyIGUgPSBZYyhhLCBiLCBjLCBkKTtpZiAobnVsbCA9PT0gZSkgaGQoYSwgYiwgZCwgaWQsIGMpLCBTYyhhLCBkKTtlbHNlIGlmIChVYyhlLCBhLCBiLCBjLCBkKSkgZC5zdG9wUHJvcGFnYXRpb24oKTtlbHNlIGlmIChTYyhhLCBkKSwgYiAmIDQgJiYgLTEgPCBSYy5pbmRleE9mKGEpKSB7Zm9yICg7IG51bGwgIT09IGU7KSB7dmFyIGYgPSBDYihlKTtudWxsICE9PSBmICYmIEVjKGYpO2YgPSBZYyhhLCBiLCBjLCBkKTtudWxsID09PSBmICYmIGhkKGEsIGIsIGQsIGlkLCBjKTtpZiAoZiA9PT0gZSkgYnJlYWs7ZSA9IGY7fW51bGwgIT09IGUgJiYgZC5zdG9wUHJvcGFnYXRpb24oKTt9IGVsc2UgaGQoYSwgYiwgZCwgbnVsbCwgYyk7fX12YXIgaWQgPSBudWxsOwogICAgICAgICAgZnVuY3Rpb24gWWMoYSwgYiwgYywgZCkge2lkID0gbnVsbDthID0geGIoZCk7YSA9IFdjKGEpO2lmIChudWxsICE9PSBhKSBpZiAoYiA9IFZiKGEpLCBudWxsID09PSBiKSBhID0gbnVsbDtlbHNlIGlmIChjID0gYi50YWcsIDEzID09PSBjKSB7YSA9IFdiKGIpO2lmIChudWxsICE9PSBhKSByZXR1cm4gYTthID0gbnVsbDt9IGVsc2UgaWYgKDMgPT09IGMpIHtpZiAoYi5zdGF0ZU5vZGUuY3VycmVudC5tZW1vaXplZFN0YXRlLmlzRGVoeWRyYXRlZCkgcmV0dXJuIDMgPT09IGIudGFnID8gYi5zdGF0ZU5vZGUuY29udGFpbmVySW5mbyA6IG51bGw7YSA9IG51bGw7fSBlbHNlIGIgIT09IGEgJiYgKGEgPSBudWxsKTtpZCA9IGE7cmV0dXJuIG51bGw7fQogICAgICAgICAgZnVuY3Rpb24gamQoYSkge3N3aXRjaCAoYSkge2Nhc2UgImNhbmNlbCI6Y2FzZSAiY2xpY2siOmNhc2UgImNsb3NlIjpjYXNlICJjb250ZXh0bWVudSI6Y2FzZSAiY29weSI6Y2FzZSAiY3V0IjpjYXNlICJhdXhjbGljayI6Y2FzZSAiZGJsY2xpY2siOmNhc2UgImRyYWdlbmQiOmNhc2UgImRyYWdzdGFydCI6Y2FzZSAiZHJvcCI6Y2FzZSAiZm9jdXNpbiI6Y2FzZSAiZm9jdXNvdXQiOmNhc2UgImlucHV0IjpjYXNlICJpbnZhbGlkIjpjYXNlICJrZXlkb3duIjpjYXNlICJrZXlwcmVzcyI6Y2FzZSAia2V5dXAiOmNhc2UgIm1vdXNlZG93biI6Y2FzZSAibW91c2V1cCI6Y2FzZSAicGFzdGUiOmNhc2UgInBhdXNlIjpjYXNlICJwbGF5IjpjYXNlICJwb2ludGVyY2FuY2VsIjpjYXNlICJwb2ludGVyZG93biI6Y2FzZSAicG9pbnRlcnVwIjpjYXNlICJyYXRlY2hhbmdlIjpjYXNlICJyZXNldCI6Y2FzZSAicmVzaXplIjpjYXNlICJzZWVrZWQiOmNhc2UgInN1Ym1pdCI6Y2FzZSAidG91Y2hjYW5jZWwiOmNhc2UgInRvdWNoZW5kIjpjYXNlICJ0b3VjaHN0YXJ0IjpjYXNlICJ2b2x1bWVjaGFuZ2UiOmNhc2UgImNoYW5nZSI6Y2FzZSAic2VsZWN0aW9uY2hhbmdlIjpjYXNlICJ0ZXh0SW5wdXQiOmNhc2UgImNvbXBvc2l0aW9uc3RhcnQiOmNhc2UgImNvbXBvc2l0aW9uZW5kIjpjYXNlICJjb21wb3NpdGlvbnVwZGF0ZSI6Y2FzZSAiYmVmb3JlYmx1ciI6Y2FzZSAiYWZ0ZXJibHVyIjpjYXNlICJiZWZvcmVpbnB1dCI6Y2FzZSAiYmx1ciI6Y2FzZSAiZnVsbHNjcmVlbmNoYW5nZSI6Y2FzZSAiZm9jdXMiOmNhc2UgImhhc2hjaGFuZ2UiOmNhc2UgInBvcHN0YXRlIjpjYXNlICJzZWxlY3QiOmNhc2UgInNlbGVjdHN0YXJ0IjpyZXR1cm4gMTtjYXNlICJkcmFnIjpjYXNlICJkcmFnZW50ZXIiOmNhc2UgImRyYWdleGl0IjpjYXNlICJkcmFnbGVhdmUiOmNhc2UgImRyYWdvdmVyIjpjYXNlICJtb3VzZW1vdmUiOmNhc2UgIm1vdXNlb3V0IjpjYXNlICJtb3VzZW92ZXIiOmNhc2UgInBvaW50ZXJtb3ZlIjpjYXNlICJwb2ludGVyb3V0IjpjYXNlICJwb2ludGVyb3ZlciI6Y2FzZSAic2Nyb2xsIjpjYXNlICJ0b2dnbGUiOmNhc2UgInRvdWNobW92ZSI6Y2FzZSAid2hlZWwiOmNhc2UgIm1vdXNlZW50ZXIiOmNhc2UgIm1vdXNlbGVhdmUiOmNhc2UgInBvaW50ZXJlbnRlciI6Y2FzZSAicG9pbnRlcmxlYXZlIjpyZXR1cm4gNDsKICAgICAgICAgICAgICBjYXNlICJtZXNzYWdlIjpzd2l0Y2ggKGVjKCkpIHtjYXNlIGZjOnJldHVybiAxO2Nhc2UgZ2M6cmV0dXJuIDQ7Y2FzZSBoYzpjYXNlIGljOnJldHVybiAxNjtjYXNlIGpjOnJldHVybiA1MzY4NzA5MTI7ZGVmYXVsdDpyZXR1cm4gMTY7fWRlZmF1bHQ6cmV0dXJuIDE2O319dmFyIGtkID0gbnVsbCxsZCA9IG51bGwsbWQgPSBudWxsO2Z1bmN0aW9uIG5kKCkge2lmIChtZCkgcmV0dXJuIG1kO3ZhciBhLGIgPSBsZCxjID0gYi5sZW5ndGgsZCxlID0gInZhbHVlIiBpbiBrZCA/IGtkLnZhbHVlIDoga2QudGV4dENvbnRlbnQsZiA9IGUubGVuZ3RoO2ZvciAoYSA9IDA7IGEgPCBjICYmIGJbYV0gPT09IGVbYV07IGErKykgezt9dmFyIGcgPSBjIC0gYTtmb3IgKGQgPSAxOyBkIDw9IGcgJiYgYltjIC0gZF0gPT09IGVbZiAtIGRdOyBkKyspIHs7fXJldHVybiBtZCA9IGUuc2xpY2UoYSwgMSA8IGQgPyAxIC0gZCA6IHZvaWQgMCk7fQogICAgICAgICAgZnVuY3Rpb24gb2QoYSkge3ZhciBiID0gYS5rZXlDb2RlOyJjaGFyQ29kZSIgaW4gYSA/IChhID0gYS5jaGFyQ29kZSwgMCA9PT0gYSAmJiAxMyA9PT0gYiAmJiAoYSA9IDEzKSkgOiBhID0gYjsxMCA9PT0gYSAmJiAoYSA9IDEzKTtyZXR1cm4gMzIgPD0gYSB8fCAxMyA9PT0gYSA/IGEgOiAwO31mdW5jdGlvbiBwZCgpIHtyZXR1cm4gITA7fWZ1bmN0aW9uIHFkKCkge3JldHVybiAhMTt9CiAgICAgICAgICBmdW5jdGlvbiByZChhKSB7ZnVuY3Rpb24gYihiLCBkLCBlLCBmLCBnKSB7dGhpcy5fcmVhY3ROYW1lID0gYjt0aGlzLl90YXJnZXRJbnN0ID0gZTt0aGlzLnR5cGUgPSBkO3RoaXMubmF0aXZlRXZlbnQgPSBmO3RoaXMudGFyZ2V0ID0gZzt0aGlzLmN1cnJlbnRUYXJnZXQgPSBudWxsO2ZvciAodmFyIGMgaW4gYSkge2EuaGFzT3duUHJvcGVydHkoYykgJiYgKGIgPSBhW2NdLCB0aGlzW2NdID0gYiA/IGIoZikgOiBmW2NdKTt9dGhpcy5pc0RlZmF1bHRQcmV2ZW50ZWQgPSAobnVsbCAhPSBmLmRlZmF1bHRQcmV2ZW50ZWQgPyBmLmRlZmF1bHRQcmV2ZW50ZWQgOiAhMSA9PT0gZi5yZXR1cm5WYWx1ZSkgPyBwZCA6IHFkO3RoaXMuaXNQcm9wYWdhdGlvblN0b3BwZWQgPSBxZDtyZXR1cm4gdGhpczt9QShiLnByb3RvdHlwZSwgeyBwcmV2ZW50RGVmYXVsdDogZnVuY3Rpb24gcHJldmVudERlZmF1bHQoKSB7dGhpcy5kZWZhdWx0UHJldmVudGVkID0gITA7dmFyIGEgPSB0aGlzLm5hdGl2ZUV2ZW50O2EgJiYgKGEucHJldmVudERlZmF1bHQgPyBhLnByZXZlbnREZWZhdWx0KCkgOiAidW5rbm93biIgIT09IHR5cGVvZiBhLnJldHVyblZhbHVlICYmICgKICAgICAgICAgICAgICAgIGEucmV0dXJuVmFsdWUgPSAhMSksIHRoaXMuaXNEZWZhdWx0UHJldmVudGVkID0gcGQpO30sIHN0b3BQcm9wYWdhdGlvbjogZnVuY3Rpb24gc3RvcFByb3BhZ2F0aW9uKCkge3ZhciBhID0gdGhpcy5uYXRpdmVFdmVudDthICYmIChhLnN0b3BQcm9wYWdhdGlvbiA/IGEuc3RvcFByb3BhZ2F0aW9uKCkgOiAidW5rbm93biIgIT09IHR5cGVvZiBhLmNhbmNlbEJ1YmJsZSAmJiAoYS5jYW5jZWxCdWJibGUgPSAhMCksIHRoaXMuaXNQcm9wYWdhdGlvblN0b3BwZWQgPSBwZCk7fSwgcGVyc2lzdDogZnVuY3Rpb24gcGVyc2lzdCgpIHt9LCBpc1BlcnNpc3RlbnQ6IHBkIH0pO3JldHVybiBiO30KICAgICAgICAgIHZhciBzZCA9IHsgZXZlbnRQaGFzZTogMCwgYnViYmxlczogMCwgY2FuY2VsYWJsZTogMCwgdGltZVN0YW1wOiBmdW5jdGlvbiB0aW1lU3RhbXAoYSkge3JldHVybiBhLnRpbWVTdGFtcCB8fCBEYXRlLm5vdygpO30sIGRlZmF1bHRQcmV2ZW50ZWQ6IDAsIGlzVHJ1c3RlZDogMCB9LHRkID0gcmQoc2QpLHVkID0gQSh7fSwgc2QsIHsgdmlldzogMCwgZGV0YWlsOiAwIH0pLHZkID0gcmQodWQpLHdkLHhkLHlkLEFkID0gQSh7fSwgdWQsIHsgc2NyZWVuWDogMCwgc2NyZWVuWTogMCwgY2xpZW50WDogMCwgY2xpZW50WTogMCwgcGFnZVg6IDAsIHBhZ2VZOiAwLCBjdHJsS2V5OiAwLCBzaGlmdEtleTogMCwgYWx0S2V5OiAwLCBtZXRhS2V5OiAwLCBnZXRNb2RpZmllclN0YXRlOiB6ZCwgYnV0dG9uOiAwLCBidXR0b25zOiAwLCByZWxhdGVkVGFyZ2V0OiBmdW5jdGlvbiByZWxhdGVkVGFyZ2V0KGEpIHtyZXR1cm4gdm9pZCAwID09PSBhLnJlbGF0ZWRUYXJnZXQgPyBhLmZyb21FbGVtZW50ID09PSBhLnNyY0VsZW1lbnQgPyBhLnRvRWxlbWVudCA6IGEuZnJvbUVsZW1lbnQgOiBhLnJlbGF0ZWRUYXJnZXQ7fSwgbW92ZW1lbnRYOiBmdW5jdGlvbiBtb3ZlbWVudFgoYSkge2lmICgibW92ZW1lbnRYIiBpbgogICAgICAgICAgICAgICAgYSkgcmV0dXJuIGEubW92ZW1lbnRYO2EgIT09IHlkICYmICh5ZCAmJiAibW91c2Vtb3ZlIiA9PT0gYS50eXBlID8gKHdkID0gYS5zY3JlZW5YIC0geWQuc2NyZWVuWCwgeGQgPSBhLnNjcmVlblkgLSB5ZC5zY3JlZW5ZKSA6IHhkID0gd2QgPSAwLCB5ZCA9IGEpO3JldHVybiB3ZDt9LCBtb3ZlbWVudFk6IGZ1bmN0aW9uIG1vdmVtZW50WShhKSB7cmV0dXJuICJtb3ZlbWVudFkiIGluIGEgPyBhLm1vdmVtZW50WSA6IHhkO30gfSksQmQgPSByZChBZCksQ2QgPSBBKHt9LCBBZCwgeyBkYXRhVHJhbnNmZXI6IDAgfSksRGQgPSByZChDZCksRWQgPSBBKHt9LCB1ZCwgeyByZWxhdGVkVGFyZ2V0OiAwIH0pLEZkID0gcmQoRWQpLEdkID0gQSh7fSwgc2QsIHsgYW5pbWF0aW9uTmFtZTogMCwgZWxhcHNlZFRpbWU6IDAsIHBzZXVkb0VsZW1lbnQ6IDAgfSksSGQgPSByZChHZCksSWQgPSBBKHt9LCBzZCwgeyBjbGlwYm9hcmREYXRhOiBmdW5jdGlvbiBjbGlwYm9hcmREYXRhKGEpIHtyZXR1cm4gImNsaXBib2FyZERhdGEiIGluIGEgPyBhLmNsaXBib2FyZERhdGEgOiB3aW5kb3cuY2xpcGJvYXJkRGF0YTt9IH0pLEpkID0gcmQoSWQpLEtkID0gQSh7fSwgc2QsIHsgZGF0YTogMCB9KSxMZCA9IHJkKEtkKSxNZCA9IHsgRXNjOiAiRXNjYXBlIiwKICAgICAgICAgICAgICBTcGFjZWJhcjogIiAiLCBMZWZ0OiAiQXJyb3dMZWZ0IiwgVXA6ICJBcnJvd1VwIiwgUmlnaHQ6ICJBcnJvd1JpZ2h0IiwgRG93bjogIkFycm93RG93biIsIERlbDogIkRlbGV0ZSIsIFdpbjogIk9TIiwgTWVudTogIkNvbnRleHRNZW51IiwgQXBwczogIkNvbnRleHRNZW51IiwgU2Nyb2xsOiAiU2Nyb2xsTG9jayIsIE1velByaW50YWJsZUtleTogIlVuaWRlbnRpZmllZCIgfSxOZCA9IHsgODogIkJhY2tzcGFjZSIsIDk6ICJUYWIiLCAxMjogIkNsZWFyIiwgMTM6ICJFbnRlciIsIDE2OiAiU2hpZnQiLCAxNzogIkNvbnRyb2wiLCAxODogIkFsdCIsIDE5OiAiUGF1c2UiLCAyMDogIkNhcHNMb2NrIiwgMjc6ICJFc2NhcGUiLCAzMjogIiAiLCAzMzogIlBhZ2VVcCIsIDM0OiAiUGFnZURvd24iLCAzNTogIkVuZCIsIDM2OiAiSG9tZSIsIDM3OiAiQXJyb3dMZWZ0IiwgMzg6ICJBcnJvd1VwIiwgMzk6ICJBcnJvd1JpZ2h0IiwgNDA6ICJBcnJvd0Rvd24iLCA0NTogIkluc2VydCIsIDQ2OiAiRGVsZXRlIiwgMTEyOiAiRjEiLCAxMTM6ICJGMiIsIDExNDogIkYzIiwgMTE1OiAiRjQiLCAxMTY6ICJGNSIsIDExNzogIkY2IiwgMTE4OiAiRjciLAogICAgICAgICAgICAgIDExOTogIkY4IiwgMTIwOiAiRjkiLCAxMjE6ICJGMTAiLCAxMjI6ICJGMTEiLCAxMjM6ICJGMTIiLCAxNDQ6ICJOdW1Mb2NrIiwgMTQ1OiAiU2Nyb2xsTG9jayIsIDIyNDogIk1ldGEiIH0sT2QgPSB7IEFsdDogImFsdEtleSIsIENvbnRyb2w6ICJjdHJsS2V5IiwgTWV0YTogIm1ldGFLZXkiLCBTaGlmdDogInNoaWZ0S2V5IiB9O2Z1bmN0aW9uIFBkKGEpIHt2YXIgYiA9IHRoaXMubmF0aXZlRXZlbnQ7cmV0dXJuIGIuZ2V0TW9kaWZpZXJTdGF0ZSA/IGIuZ2V0TW9kaWZpZXJTdGF0ZShhKSA6IChhID0gT2RbYV0pID8gISFiW2FdIDogITE7fWZ1bmN0aW9uIHpkKCkge3JldHVybiBQZDt9CiAgICAgICAgICB2YXIgUWQgPSBBKHt9LCB1ZCwgeyBrZXk6IGZ1bmN0aW9uIGtleShhKSB7aWYgKGEua2V5KSB7dmFyIGIgPSBNZFthLmtleV0gfHwgYS5rZXk7aWYgKCJVbmlkZW50aWZpZWQiICE9PSBiKSByZXR1cm4gYjt9cmV0dXJuICJrZXlwcmVzcyIgPT09IGEudHlwZSA/IChhID0gb2QoYSksIDEzID09PSBhID8gIkVudGVyIiA6IFN0cmluZy5mcm9tQ2hhckNvZGUoYSkpIDogImtleWRvd24iID09PSBhLnR5cGUgfHwgImtleXVwIiA9PT0gYS50eXBlID8gTmRbYS5rZXlDb2RlXSB8fCAiVW5pZGVudGlmaWVkIiA6ICIiO30sIGNvZGU6IDAsIGxvY2F0aW9uOiAwLCBjdHJsS2V5OiAwLCBzaGlmdEtleTogMCwgYWx0S2V5OiAwLCBtZXRhS2V5OiAwLCByZXBlYXQ6IDAsIGxvY2FsZTogMCwgZ2V0TW9kaWZpZXJTdGF0ZTogemQsIGNoYXJDb2RlOiBmdW5jdGlvbiBjaGFyQ29kZShhKSB7cmV0dXJuICJrZXlwcmVzcyIgPT09IGEudHlwZSA/IG9kKGEpIDogMDt9LCBrZXlDb2RlOiBmdW5jdGlvbiBrZXlDb2RlKGEpIHtyZXR1cm4gImtleWRvd24iID09PSBhLnR5cGUgfHwgImtleXVwIiA9PT0gYS50eXBlID8gYS5rZXlDb2RlIDogMDt9LCB3aGljaDogZnVuY3Rpb24gd2hpY2goYSkge3JldHVybiAia2V5cHJlc3MiID09PQogICAgICAgICAgICAgICAgYS50eXBlID8gb2QoYSkgOiAia2V5ZG93biIgPT09IGEudHlwZSB8fCAia2V5dXAiID09PSBhLnR5cGUgPyBhLmtleUNvZGUgOiAwO30gfSksUmQgPSByZChRZCksU2QgPSBBKHt9LCBBZCwgeyBwb2ludGVySWQ6IDAsIHdpZHRoOiAwLCBoZWlnaHQ6IDAsIHByZXNzdXJlOiAwLCB0YW5nZW50aWFsUHJlc3N1cmU6IDAsIHRpbHRYOiAwLCB0aWx0WTogMCwgdHdpc3Q6IDAsIHBvaW50ZXJUeXBlOiAwLCBpc1ByaW1hcnk6IDAgfSksVGQgPSByZChTZCksVWQgPSBBKHt9LCB1ZCwgeyB0b3VjaGVzOiAwLCB0YXJnZXRUb3VjaGVzOiAwLCBjaGFuZ2VkVG91Y2hlczogMCwgYWx0S2V5OiAwLCBtZXRhS2V5OiAwLCBjdHJsS2V5OiAwLCBzaGlmdEtleTogMCwgZ2V0TW9kaWZpZXJTdGF0ZTogemQgfSksVmQgPSByZChVZCksV2QgPSBBKHt9LCBzZCwgeyBwcm9wZXJ0eU5hbWU6IDAsIGVsYXBzZWRUaW1lOiAwLCBwc2V1ZG9FbGVtZW50OiAwIH0pLFhkID0gcmQoV2QpLFlkID0gQSh7fSwgQWQsIHsgZGVsdGFYOiBmdW5jdGlvbiBkZWx0YVgoYSkge3JldHVybiAiZGVsdGFYIiBpbiBhID8gYS5kZWx0YVggOiAid2hlZWxEZWx0YVgiIGluIGEgPyAtYS53aGVlbERlbHRhWCA6IDA7fSwKICAgICAgICAgICAgICBkZWx0YVk6IGZ1bmN0aW9uIGRlbHRhWShhKSB7cmV0dXJuICJkZWx0YVkiIGluIGEgPyBhLmRlbHRhWSA6ICJ3aGVlbERlbHRhWSIgaW4gYSA/IC1hLndoZWVsRGVsdGFZIDogIndoZWVsRGVsdGEiIGluIGEgPyAtYS53aGVlbERlbHRhIDogMDt9LCBkZWx0YVo6IDAsIGRlbHRhTW9kZTogMCB9KSxaZCA9IHJkKFlkKSwkZCA9IFs5LCAxMywgMjcsIDMyXSxhZSA9IGlhICYmICJDb21wb3NpdGlvbkV2ZW50IiBpbiB3aW5kb3csYmUgPSBudWxsO2lhICYmICJkb2N1bWVudE1vZGUiIGluIGRvY3VtZW50ICYmIChiZSA9IGRvY3VtZW50LmRvY3VtZW50TW9kZSk7dmFyIGNlID0gaWEgJiYgIlRleHRFdmVudCIgaW4gd2luZG93ICYmICFiZSxkZSA9IGlhICYmICghYWUgfHwgYmUgJiYgOCA8IGJlICYmIDExID49IGJlKSxlZSA9IFN0cmluZy5mcm9tQ2hhckNvZGUoMzIpLGZlID0gITE7CiAgICAgICAgICBmdW5jdGlvbiBnZShhLCBiKSB7c3dpdGNoIChhKSB7Y2FzZSAia2V5dXAiOnJldHVybiAtMSAhPT0gJGQuaW5kZXhPZihiLmtleUNvZGUpO2Nhc2UgImtleWRvd24iOnJldHVybiAyMjkgIT09IGIua2V5Q29kZTtjYXNlICJrZXlwcmVzcyI6Y2FzZSAibW91c2Vkb3duIjpjYXNlICJmb2N1c291dCI6cmV0dXJuICEwO2RlZmF1bHQ6cmV0dXJuICExO319ZnVuY3Rpb24gaGUoYSkge2EgPSBhLmRldGFpbDtyZXR1cm4gIm9iamVjdCIgPT09IHR5cGVvZiBhICYmICJkYXRhIiBpbiBhID8gYS5kYXRhIDogbnVsbDt9dmFyIGllID0gITE7ZnVuY3Rpb24gamUoYSwgYikge3N3aXRjaCAoYSkge2Nhc2UgImNvbXBvc2l0aW9uZW5kIjpyZXR1cm4gaGUoYik7Y2FzZSAia2V5cHJlc3MiOmlmICgzMiAhPT0gYi53aGljaCkgcmV0dXJuIG51bGw7ZmUgPSAhMDtyZXR1cm4gZWU7Y2FzZSAidGV4dElucHV0IjpyZXR1cm4gYSA9IGIuZGF0YSwgYSA9PT0gZWUgJiYgZmUgPyBudWxsIDogYTtkZWZhdWx0OnJldHVybiBudWxsO319CiAgICAgICAgICBmdW5jdGlvbiBrZShhLCBiKSB7aWYgKGllKSByZXR1cm4gImNvbXBvc2l0aW9uZW5kIiA9PT0gYSB8fCAhYWUgJiYgZ2UoYSwgYikgPyAoYSA9IG5kKCksIG1kID0gbGQgPSBrZCA9IG51bGwsIGllID0gITEsIGEpIDogbnVsbDtzd2l0Y2ggKGEpIHtjYXNlICJwYXN0ZSI6cmV0dXJuIG51bGw7Y2FzZSAia2V5cHJlc3MiOmlmICghKGIuY3RybEtleSB8fCBiLmFsdEtleSB8fCBiLm1ldGFLZXkpIHx8IGIuY3RybEtleSAmJiBiLmFsdEtleSkge2lmIChiLmNoYXIgJiYgMSA8IGIuY2hhci5sZW5ndGgpIHJldHVybiBiLmNoYXI7aWYgKGIud2hpY2gpIHJldHVybiBTdHJpbmcuZnJvbUNoYXJDb2RlKGIud2hpY2gpO31yZXR1cm4gbnVsbDtjYXNlICJjb21wb3NpdGlvbmVuZCI6cmV0dXJuIGRlICYmICJrbyIgIT09IGIubG9jYWxlID8gbnVsbCA6IGIuZGF0YTtkZWZhdWx0OnJldHVybiBudWxsO319CiAgICAgICAgICB2YXIgbGUgPSB7IGNvbG9yOiAhMCwgZGF0ZTogITAsIGRhdGV0aW1lOiAhMCwgImRhdGV0aW1lLWxvY2FsIjogITAsIGVtYWlsOiAhMCwgbW9udGg6ICEwLCBudW1iZXI6ICEwLCBwYXNzd29yZDogITAsIHJhbmdlOiAhMCwgc2VhcmNoOiAhMCwgdGVsOiAhMCwgdGV4dDogITAsIHRpbWU6ICEwLCB1cmw6ICEwLCB3ZWVrOiAhMCB9O2Z1bmN0aW9uIG1lKGEpIHt2YXIgYiA9IGEgJiYgYS5ub2RlTmFtZSAmJiBhLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCk7cmV0dXJuICJpbnB1dCIgPT09IGIgPyAhIWxlW2EudHlwZV0gOiAidGV4dGFyZWEiID09PSBiID8gITAgOiAhMTt9ZnVuY3Rpb24gbmUoYSwgYiwgYywgZCkge0ViKGQpO2IgPSBvZShiLCAib25DaGFuZ2UiKTswIDwgYi5sZW5ndGggJiYgKGMgPSBuZXcgdGQoIm9uQ2hhbmdlIiwgImNoYW5nZSIsIG51bGwsIGMsIGQpLCBhLnB1c2goeyBldmVudDogYywgbGlzdGVuZXJzOiBiIH0pKTt9dmFyIHBlID0gbnVsbCxxZSA9IG51bGw7ZnVuY3Rpb24gcmUoYSkge3NlKGEsIDApO31mdW5jdGlvbiB0ZShhKSB7dmFyIGIgPSB1ZShhKTtpZiAoV2EoYikpIHJldHVybiBhO30KICAgICAgICAgIGZ1bmN0aW9uIHZlKGEsIGIpIHtpZiAoImNoYW5nZSIgPT09IGEpIHJldHVybiBiO312YXIgd2UgPSAhMTtpZiAoaWEpIHt2YXIgeGU7aWYgKGlhKSB7dmFyIHllID0gKCJvbmlucHV0IiBpbiBkb2N1bWVudCk7aWYgKCF5ZSkge3ZhciB6ZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpO3plLnNldEF0dHJpYnV0ZSgib25pbnB1dCIsICJyZXR1cm47Iik7eWUgPSAiZnVuY3Rpb24iID09PSB0eXBlb2YgemUub25pbnB1dDt9eGUgPSB5ZTt9IGVsc2UgeGUgPSAhMTt3ZSA9IHhlICYmICghZG9jdW1lbnQuZG9jdW1lbnRNb2RlIHx8IDkgPCBkb2N1bWVudC5kb2N1bWVudE1vZGUpO31mdW5jdGlvbiBBZSgpIHtwZSAmJiAocGUuZGV0YWNoRXZlbnQoIm9ucHJvcGVydHljaGFuZ2UiLCBCZSksIHFlID0gcGUgPSBudWxsKTt9ZnVuY3Rpb24gQmUoYSkge2lmICgidmFsdWUiID09PSBhLnByb3BlcnR5TmFtZSAmJiB0ZShxZSkpIHt2YXIgYiA9IFtdO25lKGIsIHFlLCBhLCB4YihhKSk7SmIocmUsIGIpO319CiAgICAgICAgICBmdW5jdGlvbiBDZShhLCBiLCBjKSB7ImZvY3VzaW4iID09PSBhID8gKEFlKCksIHBlID0gYiwgcWUgPSBjLCBwZS5hdHRhY2hFdmVudCgib25wcm9wZXJ0eWNoYW5nZSIsIEJlKSkgOiAiZm9jdXNvdXQiID09PSBhICYmIEFlKCk7fWZ1bmN0aW9uIERlKGEpIHtpZiAoInNlbGVjdGlvbmNoYW5nZSIgPT09IGEgfHwgImtleXVwIiA9PT0gYSB8fCAia2V5ZG93biIgPT09IGEpIHJldHVybiB0ZShxZSk7fWZ1bmN0aW9uIEVlKGEsIGIpIHtpZiAoImNsaWNrIiA9PT0gYSkgcmV0dXJuIHRlKGIpO31mdW5jdGlvbiBGZShhLCBiKSB7aWYgKCJpbnB1dCIgPT09IGEgfHwgImNoYW5nZSIgPT09IGEpIHJldHVybiB0ZShiKTt9ZnVuY3Rpb24gR2UoYSwgYikge3JldHVybiBhID09PSBiICYmICgwICE9PSBhIHx8IDEgLyBhID09PSAxIC8gYikgfHwgYSAhPT0gYSAmJiBiICE9PSBiO312YXIgSGUgPSAiZnVuY3Rpb24iID09PSB0eXBlb2YgT2JqZWN0LmlzID8gT2JqZWN0LmlzIDogR2U7CiAgICAgICAgICBmdW5jdGlvbiBJZShhLCBiKSB7aWYgKEhlKGEsIGIpKSByZXR1cm4gITA7aWYgKCJvYmplY3QiICE9PSB0eXBlb2YgYSB8fCBudWxsID09PSBhIHx8ICJvYmplY3QiICE9PSB0eXBlb2YgYiB8fCBudWxsID09PSBiKSByZXR1cm4gITE7dmFyIGMgPSBPYmplY3Qua2V5cyhhKSxkID0gT2JqZWN0LmtleXMoYik7aWYgKGMubGVuZ3RoICE9PSBkLmxlbmd0aCkgcmV0dXJuICExO2ZvciAoZCA9IDA7IGQgPCBjLmxlbmd0aDsgZCsrKSB7dmFyIGUgPSBjW2RdO2lmICghamEuY2FsbChiLCBlKSB8fCAhSGUoYVtlXSwgYltlXSkpIHJldHVybiAhMTt9cmV0dXJuICEwO31mdW5jdGlvbiBKZShhKSB7Zm9yICg7IGEgJiYgYS5maXJzdENoaWxkOykge2EgPSBhLmZpcnN0Q2hpbGQ7fXJldHVybiBhO30KICAgICAgICAgIGZ1bmN0aW9uIEtlKGEsIGIpIHt2YXIgYyA9IEplKGEpO2EgPSAwO2ZvciAodmFyIGQ7IGM7KSB7aWYgKDMgPT09IGMubm9kZVR5cGUpIHtkID0gYSArIGMudGV4dENvbnRlbnQubGVuZ3RoO2lmIChhIDw9IGIgJiYgZCA+PSBiKSByZXR1cm4geyBub2RlOiBjLCBvZmZzZXQ6IGIgLSBhIH07YSA9IGQ7fWE6IHtmb3IgKDsgYzspIHtpZiAoYy5uZXh0U2libGluZykge2MgPSBjLm5leHRTaWJsaW5nO2JyZWFrIGE7fWMgPSBjLnBhcmVudE5vZGU7fWMgPSB2b2lkIDA7fWMgPSBKZShjKTt9fWZ1bmN0aW9uIExlKGEsIGIpIHtyZXR1cm4gYSAmJiBiID8gYSA9PT0gYiA/ICEwIDogYSAmJiAzID09PSBhLm5vZGVUeXBlID8gITEgOiBiICYmIDMgPT09IGIubm9kZVR5cGUgPyBMZShhLCBiLnBhcmVudE5vZGUpIDogImNvbnRhaW5zIiBpbiBhID8gYS5jb250YWlucyhiKSA6IGEuY29tcGFyZURvY3VtZW50UG9zaXRpb24gPyAhIShhLmNvbXBhcmVEb2N1bWVudFBvc2l0aW9uKGIpICYgMTYpIDogITEgOiAhMTt9CiAgICAgICAgICBmdW5jdGlvbiBNZSgpIHtmb3IgKHZhciBhID0gd2luZG93LCBiID0gWGEoKTsgYiBpbnN0YW5jZW9mIGEuSFRNTElGcmFtZUVsZW1lbnQ7KSB7dHJ5IHt2YXIgYyA9ICJzdHJpbmciID09PSB0eXBlb2YgYi5jb250ZW50V2luZG93LmxvY2F0aW9uLmhyZWY7fSBjYXRjaCAoZCkge2MgPSAhMTt9aWYgKGMpIGEgPSBiLmNvbnRlbnRXaW5kb3c7ZWxzZSBicmVhaztiID0gWGEoYS5kb2N1bWVudCk7fXJldHVybiBiO31mdW5jdGlvbiBOZShhKSB7dmFyIGIgPSBhICYmIGEubm9kZU5hbWUgJiYgYS5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpO3JldHVybiBiICYmICgiaW5wdXQiID09PSBiICYmICgidGV4dCIgPT09IGEudHlwZSB8fCAic2VhcmNoIiA9PT0gYS50eXBlIHx8ICJ0ZWwiID09PSBhLnR5cGUgfHwgInVybCIgPT09IGEudHlwZSB8fCAicGFzc3dvcmQiID09PSBhLnR5cGUpIHx8ICJ0ZXh0YXJlYSIgPT09IGIgfHwgInRydWUiID09PSBhLmNvbnRlbnRFZGl0YWJsZSk7fQogICAgICAgICAgZnVuY3Rpb24gT2UoYSkge3ZhciBiID0gTWUoKSxjID0gYS5mb2N1c2VkRWxlbSxkID0gYS5zZWxlY3Rpb25SYW5nZTtpZiAoYiAhPT0gYyAmJiBjICYmIGMub3duZXJEb2N1bWVudCAmJiBMZShjLm93bmVyRG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LCBjKSkge2lmIChudWxsICE9PSBkICYmIE5lKGMpKSBpZiAoYiA9IGQuc3RhcnQsIGEgPSBkLmVuZCwgdm9pZCAwID09PSBhICYmIChhID0gYiksICJzZWxlY3Rpb25TdGFydCIgaW4gYykgYy5zZWxlY3Rpb25TdGFydCA9IGIsIGMuc2VsZWN0aW9uRW5kID0gTWF0aC5taW4oYSwgYy52YWx1ZS5sZW5ndGgpO2Vsc2UgaWYgKGEgPSAoYiA9IGMub3duZXJEb2N1bWVudCB8fCBkb2N1bWVudCkgJiYgYi5kZWZhdWx0VmlldyB8fCB3aW5kb3csIGEuZ2V0U2VsZWN0aW9uKSB7YSA9IGEuZ2V0U2VsZWN0aW9uKCk7dmFyIGUgPSBjLnRleHRDb250ZW50Lmxlbmd0aCxmID0gTWF0aC5taW4oZC5zdGFydCwgZSk7ZCA9IHZvaWQgMCA9PT0gZC5lbmQgPyBmIDogTWF0aC5taW4oZC5lbmQsIGUpOyFhLmV4dGVuZCAmJiBmID4gZCAmJiAoZSA9IGQsIGQgPSBmLCBmID0gZSk7ZSA9IEtlKGMsIGYpO3ZhciBnID0gS2UoYywKICAgICAgICAgICAgICAgIGQpO2UgJiYgZyAmJiAoMSAhPT0gYS5yYW5nZUNvdW50IHx8IGEuYW5jaG9yTm9kZSAhPT0gZS5ub2RlIHx8IGEuYW5jaG9yT2Zmc2V0ICE9PSBlLm9mZnNldCB8fCBhLmZvY3VzTm9kZSAhPT0gZy5ub2RlIHx8IGEuZm9jdXNPZmZzZXQgIT09IGcub2Zmc2V0KSAmJiAoYiA9IGIuY3JlYXRlUmFuZ2UoKSwgYi5zZXRTdGFydChlLm5vZGUsIGUub2Zmc2V0KSwgYS5yZW1vdmVBbGxSYW5nZXMoKSwgZiA+IGQgPyAoYS5hZGRSYW5nZShiKSwgYS5leHRlbmQoZy5ub2RlLCBnLm9mZnNldCkpIDogKGIuc2V0RW5kKGcubm9kZSwgZy5vZmZzZXQpLCBhLmFkZFJhbmdlKGIpKSk7fWIgPSBbXTtmb3IgKGEgPSBjOyBhID0gYS5wYXJlbnROb2RlOykgezEgPT09IGEubm9kZVR5cGUgJiYgYi5wdXNoKHsgZWxlbWVudDogYSwgbGVmdDogYS5zY3JvbGxMZWZ0LCB0b3A6IGEuc2Nyb2xsVG9wIH0pO30iZnVuY3Rpb24iID09PSB0eXBlb2YgYy5mb2N1cyAmJiBjLmZvY3VzKCk7Zm9yIChjID0gMDsgYyA8IGIubGVuZ3RoOyBjKyspIHthID0gYltjXSwgYS5lbGVtZW50LnNjcm9sbExlZnQgPSBhLmxlZnQsIGEuZWxlbWVudC5zY3JvbGxUb3AgPSBhLnRvcDt9fX0KICAgICAgICAgIHZhciBQZSA9IGlhICYmICJkb2N1bWVudE1vZGUiIGluIGRvY3VtZW50ICYmIDExID49IGRvY3VtZW50LmRvY3VtZW50TW9kZSxRZSA9IG51bGwsUmUgPSBudWxsLFNlID0gbnVsbCxUZSA9ICExOwogICAgICAgICAgZnVuY3Rpb24gVWUoYSwgYiwgYykge3ZhciBkID0gYy53aW5kb3cgPT09IGMgPyBjLmRvY3VtZW50IDogOSA9PT0gYy5ub2RlVHlwZSA/IGMgOiBjLm93bmVyRG9jdW1lbnQ7VGUgfHwgbnVsbCA9PSBRZSB8fCBRZSAhPT0gWGEoZCkgfHwgKGQgPSBRZSwgInNlbGVjdGlvblN0YXJ0IiBpbiBkICYmIE5lKGQpID8gZCA9IHsgc3RhcnQ6IGQuc2VsZWN0aW9uU3RhcnQsIGVuZDogZC5zZWxlY3Rpb25FbmQgfSA6IChkID0gKGQub3duZXJEb2N1bWVudCAmJiBkLm93bmVyRG9jdW1lbnQuZGVmYXVsdFZpZXcgfHwgd2luZG93KS5nZXRTZWxlY3Rpb24oKSwgZCA9IHsgYW5jaG9yTm9kZTogZC5hbmNob3JOb2RlLCBhbmNob3JPZmZzZXQ6IGQuYW5jaG9yT2Zmc2V0LCBmb2N1c05vZGU6IGQuZm9jdXNOb2RlLCBmb2N1c09mZnNldDogZC5mb2N1c09mZnNldCB9KSwgU2UgJiYgSWUoU2UsIGQpIHx8IChTZSA9IGQsIGQgPSBvZShSZSwgIm9uU2VsZWN0IiksIDAgPCBkLmxlbmd0aCAmJiAoYiA9IG5ldyB0ZCgib25TZWxlY3QiLCAic2VsZWN0IiwgbnVsbCwgYiwgYyksIGEucHVzaCh7IGV2ZW50OiBiLCBsaXN0ZW5lcnM6IGQgfSksIGIudGFyZ2V0ID0gUWUpKSk7fQogICAgICAgICAgZnVuY3Rpb24gVmUoYSwgYikge3ZhciBjID0ge307Y1thLnRvTG93ZXJDYXNlKCldID0gYi50b0xvd2VyQ2FzZSgpO2NbIldlYmtpdCIgKyBhXSA9ICJ3ZWJraXQiICsgYjtjWyJNb3oiICsgYV0gPSAibW96IiArIGI7cmV0dXJuIGM7fXZhciBXZSA9IHsgYW5pbWF0aW9uZW5kOiBWZSgiQW5pbWF0aW9uIiwgIkFuaW1hdGlvbkVuZCIpLCBhbmltYXRpb25pdGVyYXRpb246IFZlKCJBbmltYXRpb24iLCAiQW5pbWF0aW9uSXRlcmF0aW9uIiksIGFuaW1hdGlvbnN0YXJ0OiBWZSgiQW5pbWF0aW9uIiwgIkFuaW1hdGlvblN0YXJ0IiksIHRyYW5zaXRpb25lbmQ6IFZlKCJUcmFuc2l0aW9uIiwgIlRyYW5zaXRpb25FbmQiKSB9LFhlID0ge30sWWUgPSB7fTsKICAgICAgICAgIGlhICYmIChZZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpLnN0eWxlLCAiQW5pbWF0aW9uRXZlbnQiIGluIHdpbmRvdyB8fCAoZGVsZXRlIFdlLmFuaW1hdGlvbmVuZC5hbmltYXRpb24sIGRlbGV0ZSBXZS5hbmltYXRpb25pdGVyYXRpb24uYW5pbWF0aW9uLCBkZWxldGUgV2UuYW5pbWF0aW9uc3RhcnQuYW5pbWF0aW9uKSwgIlRyYW5zaXRpb25FdmVudCIgaW4gd2luZG93IHx8IGRlbGV0ZSBXZS50cmFuc2l0aW9uZW5kLnRyYW5zaXRpb24pO2Z1bmN0aW9uIFplKGEpIHtpZiAoWGVbYV0pIHJldHVybiBYZVthXTtpZiAoIVdlW2FdKSByZXR1cm4gYTt2YXIgYiA9IFdlW2FdLGM7Zm9yIChjIGluIGIpIHtpZiAoYi5oYXNPd25Qcm9wZXJ0eShjKSAmJiBjIGluIFllKSByZXR1cm4gWGVbYV0gPSBiW2NdO31yZXR1cm4gYTt9dmFyICRlID0gWmUoImFuaW1hdGlvbmVuZCIpLGFmID0gWmUoImFuaW1hdGlvbml0ZXJhdGlvbiIpLGJmID0gWmUoImFuaW1hdGlvbnN0YXJ0IiksY2YgPSBaZSgidHJhbnNpdGlvbmVuZCIpLGRmID0gbmV3IE1hcCgpLGVmID0gImFib3J0IGF1eENsaWNrIGNhbmNlbCBjYW5QbGF5IGNhblBsYXlUaHJvdWdoIGNsaWNrIGNsb3NlIGNvbnRleHRNZW51IGNvcHkgY3V0IGRyYWcgZHJhZ0VuZCBkcmFnRW50ZXIgZHJhZ0V4aXQgZHJhZ0xlYXZlIGRyYWdPdmVyIGRyYWdTdGFydCBkcm9wIGR1cmF0aW9uQ2hhbmdlIGVtcHRpZWQgZW5jcnlwdGVkIGVuZGVkIGVycm9yIGdvdFBvaW50ZXJDYXB0dXJlIGlucHV0IGludmFsaWQga2V5RG93biBrZXlQcmVzcyBrZXlVcCBsb2FkIGxvYWRlZERhdGEgbG9hZGVkTWV0YWRhdGEgbG9hZFN0YXJ0IGxvc3RQb2ludGVyQ2FwdHVyZSBtb3VzZURvd24gbW91c2VNb3ZlIG1vdXNlT3V0IG1vdXNlT3ZlciBtb3VzZVVwIHBhc3RlIHBhdXNlIHBsYXkgcGxheWluZyBwb2ludGVyQ2FuY2VsIHBvaW50ZXJEb3duIHBvaW50ZXJNb3ZlIHBvaW50ZXJPdXQgcG9pbnRlck92ZXIgcG9pbnRlclVwIHByb2dyZXNzIHJhdGVDaGFuZ2UgcmVzZXQgcmVzaXplIHNlZWtlZCBzZWVraW5nIHN0YWxsZWQgc3VibWl0IHN1c3BlbmQgdGltZVVwZGF0ZSB0b3VjaENhbmNlbCB0b3VjaEVuZCB0b3VjaFN0YXJ0IHZvbHVtZUNoYW5nZSBzY3JvbGwgdG9nZ2xlIHRvdWNoTW92ZSB3YWl0aW5nIHdoZWVsIi5zcGxpdCgiICIpOwogICAgICAgICAgZnVuY3Rpb24gZmYoYSwgYikge2RmLnNldChhLCBiKTtmYShiLCBbYV0pO31mb3IgKHZhciBnZiA9IDA7IGdmIDwgZWYubGVuZ3RoOyBnZisrKSB7dmFyIGhmID0gZWZbZ2ZdLGpmID0gaGYudG9Mb3dlckNhc2UoKSxrZiA9IGhmWzBdLnRvVXBwZXJDYXNlKCkgKyBoZi5zbGljZSgxKTtmZihqZiwgIm9uIiArIGtmKTt9ZmYoJGUsICJvbkFuaW1hdGlvbkVuZCIpO2ZmKGFmLCAib25BbmltYXRpb25JdGVyYXRpb24iKTtmZihiZiwgIm9uQW5pbWF0aW9uU3RhcnQiKTtmZigiZGJsY2xpY2siLCAib25Eb3VibGVDbGljayIpO2ZmKCJmb2N1c2luIiwgIm9uRm9jdXMiKTtmZigiZm9jdXNvdXQiLCAib25CbHVyIik7ZmYoY2YsICJvblRyYW5zaXRpb25FbmQiKTtoYSgib25Nb3VzZUVudGVyIiwgWyJtb3VzZW91dCIsICJtb3VzZW92ZXIiXSk7aGEoIm9uTW91c2VMZWF2ZSIsIFsibW91c2VvdXQiLCAibW91c2VvdmVyIl0pO2hhKCJvblBvaW50ZXJFbnRlciIsIFsicG9pbnRlcm91dCIsICJwb2ludGVyb3ZlciJdKTsKICAgICAgICAgIGhhKCJvblBvaW50ZXJMZWF2ZSIsIFsicG9pbnRlcm91dCIsICJwb2ludGVyb3ZlciJdKTtmYSgib25DaGFuZ2UiLCAiY2hhbmdlIGNsaWNrIGZvY3VzaW4gZm9jdXNvdXQgaW5wdXQga2V5ZG93biBrZXl1cCBzZWxlY3Rpb25jaGFuZ2UiLnNwbGl0KCIgIikpO2ZhKCJvblNlbGVjdCIsICJmb2N1c291dCBjb250ZXh0bWVudSBkcmFnZW5kIGZvY3VzaW4ga2V5ZG93biBrZXl1cCBtb3VzZWRvd24gbW91c2V1cCBzZWxlY3Rpb25jaGFuZ2UiLnNwbGl0KCIgIikpO2ZhKCJvbkJlZm9yZUlucHV0IiwgWyJjb21wb3NpdGlvbmVuZCIsICJrZXlwcmVzcyIsICJ0ZXh0SW5wdXQiLCAicGFzdGUiXSk7ZmEoIm9uQ29tcG9zaXRpb25FbmQiLCAiY29tcG9zaXRpb25lbmQgZm9jdXNvdXQga2V5ZG93biBrZXlwcmVzcyBrZXl1cCBtb3VzZWRvd24iLnNwbGl0KCIgIikpO2ZhKCJvbkNvbXBvc2l0aW9uU3RhcnQiLCAiY29tcG9zaXRpb25zdGFydCBmb2N1c291dCBrZXlkb3duIGtleXByZXNzIGtleXVwIG1vdXNlZG93biIuc3BsaXQoIiAiKSk7CiAgICAgICAgICBmYSgib25Db21wb3NpdGlvblVwZGF0ZSIsICJjb21wb3NpdGlvbnVwZGF0ZSBmb2N1c291dCBrZXlkb3duIGtleXByZXNzIGtleXVwIG1vdXNlZG93biIuc3BsaXQoIiAiKSk7dmFyIGxmID0gImFib3J0IGNhbnBsYXkgY2FucGxheXRocm91Z2ggZHVyYXRpb25jaGFuZ2UgZW1wdGllZCBlbmNyeXB0ZWQgZW5kZWQgZXJyb3IgbG9hZGVkZGF0YSBsb2FkZWRtZXRhZGF0YSBsb2Fkc3RhcnQgcGF1c2UgcGxheSBwbGF5aW5nIHByb2dyZXNzIHJhdGVjaGFuZ2UgcmVzaXplIHNlZWtlZCBzZWVraW5nIHN0YWxsZWQgc3VzcGVuZCB0aW1ldXBkYXRlIHZvbHVtZWNoYW5nZSB3YWl0aW5nIi5zcGxpdCgiICIpLG1mID0gbmV3IFNldCgiY2FuY2VsIGNsb3NlIGludmFsaWQgbG9hZCBzY3JvbGwgdG9nZ2xlIi5zcGxpdCgiICIpLmNvbmNhdChsZikpOwogICAgICAgICAgZnVuY3Rpb24gbmYoYSwgYiwgYykge3ZhciBkID0gYS50eXBlIHx8ICJ1bmtub3duLWV2ZW50IjthLmN1cnJlbnRUYXJnZXQgPSBjO1ViKGQsIGIsIHZvaWQgMCwgYSk7YS5jdXJyZW50VGFyZ2V0ID0gbnVsbDt9CiAgICAgICAgICBmdW5jdGlvbiBzZShhLCBiKSB7YiA9IDAgIT09IChiICYgNCk7Zm9yICh2YXIgYyA9IDA7IGMgPCBhLmxlbmd0aDsgYysrKSB7dmFyIGQgPSBhW2NdLGUgPSBkLmV2ZW50O2QgPSBkLmxpc3RlbmVyczthOiB7dmFyIGYgPSB2b2lkIDA7aWYgKGIpIGZvciAodmFyIGcgPSBkLmxlbmd0aCAtIDE7IDAgPD0gZzsgZy0tKSB7dmFyIGggPSBkW2ddLGsgPSBoLmluc3RhbmNlLGwgPSBoLmN1cnJlbnRUYXJnZXQ7aCA9IGgubGlzdGVuZXI7aWYgKGsgIT09IGYgJiYgZS5pc1Byb3BhZ2F0aW9uU3RvcHBlZCgpKSBicmVhayBhO25mKGUsIGgsIGwpO2YgPSBrO30gZWxzZSBmb3IgKGcgPSAwOyBnIDwgZC5sZW5ndGg7IGcrKykge2ggPSBkW2ddO2sgPSBoLmluc3RhbmNlO2wgPSBoLmN1cnJlbnRUYXJnZXQ7aCA9IGgubGlzdGVuZXI7aWYgKGsgIT09IGYgJiYgZS5pc1Byb3BhZ2F0aW9uU3RvcHBlZCgpKSBicmVhayBhO25mKGUsIGgsIGwpO2YgPSBrO319fWlmIChRYikgdGhyb3cgYSA9IFJiLCBRYiA9ICExLCBSYiA9IG51bGwsIGE7fQogICAgICAgICAgZnVuY3Rpb24gRChhLCBiKSB7dmFyIGMgPSBiW29mXTt2b2lkIDAgPT09IGMgJiYgKGMgPSBiW29mXSA9IG5ldyBTZXQoKSk7dmFyIGQgPSBhICsgIl9fYnViYmxlIjtjLmhhcyhkKSB8fCAocGYoYiwgYSwgMiwgITEpLCBjLmFkZChkKSk7fWZ1bmN0aW9uIHFmKGEsIGIsIGMpIHt2YXIgZCA9IDA7YiAmJiAoZCB8PSA0KTtwZihjLCBhLCBkLCBiKTt9dmFyIHJmID0gIl9yZWFjdExpc3RlbmluZyIgKyBNYXRoLnJhbmRvbSgpLnRvU3RyaW5nKDM2KS5zbGljZSgyKTtmdW5jdGlvbiBzZihhKSB7aWYgKCFhW3JmXSkge2FbcmZdID0gITA7ZGEuZm9yRWFjaChmdW5jdGlvbiAoYikgeyJzZWxlY3Rpb25jaGFuZ2UiICE9PSBiICYmIChtZi5oYXMoYikgfHwgcWYoYiwgITEsIGEpLCBxZihiLCAhMCwgYSkpO30pO3ZhciBiID0gOSA9PT0gYS5ub2RlVHlwZSA/IGEgOiBhLm93bmVyRG9jdW1lbnQ7bnVsbCA9PT0gYiB8fCBiW3JmXSB8fCAoYltyZl0gPSAhMCwgcWYoInNlbGVjdGlvbmNoYW5nZSIsICExLCBiKSk7fX0KICAgICAgICAgIGZ1bmN0aW9uIHBmKGEsIGIsIGMsIGQpIHtzd2l0Y2ggKGpkKGIpKSB7Y2FzZSAxOnZhciBlID0gZWQ7YnJlYWs7Y2FzZSA0OmUgPSBnZDticmVhaztkZWZhdWx0OmUgPSBmZDt9YyA9IGUuYmluZChudWxsLCBiLCBjLCBhKTtlID0gdm9pZCAwOyFMYiB8fCAidG91Y2hzdGFydCIgIT09IGIgJiYgInRvdWNobW92ZSIgIT09IGIgJiYgIndoZWVsIiAhPT0gYiB8fCAoZSA9ICEwKTtkID8gdm9pZCAwICE9PSBlID8gYS5hZGRFdmVudExpc3RlbmVyKGIsIGMsIHsgY2FwdHVyZTogITAsIHBhc3NpdmU6IGUgfSkgOiBhLmFkZEV2ZW50TGlzdGVuZXIoYiwgYywgITApIDogdm9pZCAwICE9PSBlID8gYS5hZGRFdmVudExpc3RlbmVyKGIsIGMsIHsgcGFzc2l2ZTogZSB9KSA6IGEuYWRkRXZlbnRMaXN0ZW5lcihiLCBjLCAhMSk7fQogICAgICAgICAgZnVuY3Rpb24gaGQoYSwgYiwgYywgZCwgZSkge3ZhciBmID0gZDtpZiAoMCA9PT0gKGIgJiAxKSAmJiAwID09PSAoYiAmIDIpICYmIG51bGwgIT09IGQpIGE6IGZvciAoOzspIHtpZiAobnVsbCA9PT0gZCkgcmV0dXJuO3ZhciBnID0gZC50YWc7aWYgKDMgPT09IGcgfHwgNCA9PT0gZykge3ZhciBoID0gZC5zdGF0ZU5vZGUuY29udGFpbmVySW5mbztpZiAoaCA9PT0gZSB8fCA4ID09PSBoLm5vZGVUeXBlICYmIGgucGFyZW50Tm9kZSA9PT0gZSkgYnJlYWs7aWYgKDQgPT09IGcpIGZvciAoZyA9IGQucmV0dXJuOyBudWxsICE9PSBnOykge3ZhciBrID0gZy50YWc7aWYgKDMgPT09IGsgfHwgNCA9PT0gaykgaWYgKGsgPSBnLnN0YXRlTm9kZS5jb250YWluZXJJbmZvLCBrID09PSBlIHx8IDggPT09IGsubm9kZVR5cGUgJiYgay5wYXJlbnROb2RlID09PSBlKSByZXR1cm47ZyA9IGcucmV0dXJuO31mb3IgKDsgbnVsbCAhPT0gaDspIHtnID0gV2MoaCk7aWYgKG51bGwgPT09IGcpIHJldHVybjtrID0gZy50YWc7aWYgKDUgPT09IGsgfHwgNiA9PT0gaykge2QgPSBmID0gZztjb250aW51ZSBhO31oID0gaC5wYXJlbnROb2RlO319ZCA9IGQucmV0dXJuO31KYihmdW5jdGlvbiAoKSB7dmFyIGQgPSBmLGUgPSB4YihjKSxnID0gW107CiAgICAgICAgICAgICAgYToge3ZhciBoID0gZGYuZ2V0KGEpO2lmICh2b2lkIDAgIT09IGgpIHt2YXIgayA9IHRkLG4gPSBhO3N3aXRjaCAoYSkge2Nhc2UgImtleXByZXNzIjppZiAoMCA9PT0gb2QoYykpIGJyZWFrIGE7Y2FzZSAia2V5ZG93biI6Y2FzZSAia2V5dXAiOmsgPSBSZDticmVhaztjYXNlICJmb2N1c2luIjpuID0gImZvY3VzIjtrID0gRmQ7YnJlYWs7Y2FzZSAiZm9jdXNvdXQiOm4gPSAiYmx1ciI7ayA9IEZkO2JyZWFrO2Nhc2UgImJlZm9yZWJsdXIiOmNhc2UgImFmdGVyYmx1ciI6ayA9IEZkO2JyZWFrO2Nhc2UgImNsaWNrIjppZiAoMiA9PT0gYy5idXR0b24pIGJyZWFrIGE7Y2FzZSAiYXV4Y2xpY2siOmNhc2UgImRibGNsaWNrIjpjYXNlICJtb3VzZWRvd24iOmNhc2UgIm1vdXNlbW92ZSI6Y2FzZSAibW91c2V1cCI6Y2FzZSAibW91c2VvdXQiOmNhc2UgIm1vdXNlb3ZlciI6Y2FzZSAiY29udGV4dG1lbnUiOmsgPSBCZDticmVhaztjYXNlICJkcmFnIjpjYXNlICJkcmFnZW5kIjpjYXNlICJkcmFnZW50ZXIiOmNhc2UgImRyYWdleGl0IjpjYXNlICJkcmFnbGVhdmUiOmNhc2UgImRyYWdvdmVyIjpjYXNlICJkcmFnc3RhcnQiOmNhc2UgImRyb3AiOmsgPQogICAgICAgICAgICAgICAgICAgICAgRGQ7YnJlYWs7Y2FzZSAidG91Y2hjYW5jZWwiOmNhc2UgInRvdWNoZW5kIjpjYXNlICJ0b3VjaG1vdmUiOmNhc2UgInRvdWNoc3RhcnQiOmsgPSBWZDticmVhaztjYXNlICRlOmNhc2UgYWY6Y2FzZSBiZjprID0gSGQ7YnJlYWs7Y2FzZSBjZjprID0gWGQ7YnJlYWs7Y2FzZSAic2Nyb2xsIjprID0gdmQ7YnJlYWs7Y2FzZSAid2hlZWwiOmsgPSBaZDticmVhaztjYXNlICJjb3B5IjpjYXNlICJjdXQiOmNhc2UgInBhc3RlIjprID0gSmQ7YnJlYWs7Y2FzZSAiZ290cG9pbnRlcmNhcHR1cmUiOmNhc2UgImxvc3Rwb2ludGVyY2FwdHVyZSI6Y2FzZSAicG9pbnRlcmNhbmNlbCI6Y2FzZSAicG9pbnRlcmRvd24iOmNhc2UgInBvaW50ZXJtb3ZlIjpjYXNlICJwb2ludGVyb3V0IjpjYXNlICJwb2ludGVyb3ZlciI6Y2FzZSAicG9pbnRlcnVwIjprID0gVGQ7fXZhciB0ID0gMCAhPT0gKGIgJiA0KSxKID0gIXQgJiYgInNjcm9sbCIgPT09IGEseCA9IHQgPyBudWxsICE9PSBoID8gaCArICJDYXB0dXJlIiA6IG51bGwgOiBoO3QgPSBbXTtmb3IgKHZhciB3ID0gZCwgdTsgbnVsbCAhPT0KICAgICAgICAgICAgICAgICAgdzspIHt1ID0gdzt2YXIgRiA9IHUuc3RhdGVOb2RlOzUgPT09IHUudGFnICYmIG51bGwgIT09IEYgJiYgKHUgPSBGLCBudWxsICE9PSB4ICYmIChGID0gS2IodywgeCksIG51bGwgIT0gRiAmJiB0LnB1c2godGYodywgRiwgdSkpKSk7aWYgKEopIGJyZWFrO3cgPSB3LnJldHVybjt9MCA8IHQubGVuZ3RoICYmIChoID0gbmV3IGsoaCwgbiwgbnVsbCwgYywgZSksIGcucHVzaCh7IGV2ZW50OiBoLCBsaXN0ZW5lcnM6IHQgfSkpO319aWYgKDAgPT09IChiICYgNykpIHthOiB7aCA9ICJtb3VzZW92ZXIiID09PSBhIHx8ICJwb2ludGVyb3ZlciIgPT09IGE7ayA9ICJtb3VzZW91dCIgPT09IGEgfHwgInBvaW50ZXJvdXQiID09PSBhO2lmIChoICYmIGMgIT09IHdiICYmIChuID0gYy5yZWxhdGVkVGFyZ2V0IHx8IGMuZnJvbUVsZW1lbnQpICYmIChXYyhuKSB8fCBuW3VmXSkpIGJyZWFrIGE7aWYgKGsgfHwgaCkge2ggPSBlLndpbmRvdyA9PT0gZSA/IGUgOiAoaCA9IGUub3duZXJEb2N1bWVudCkgPyBoLmRlZmF1bHRWaWV3IHx8IGgucGFyZW50V2luZG93IDogd2luZG93O2lmIChrKSB7aWYgKG4gPSBjLnJlbGF0ZWRUYXJnZXQgfHwgYy50b0VsZW1lbnQsIGsgPSBkLCBuID0gbiA/IFdjKG4pIDogbnVsbCwgbnVsbCAhPT0KICAgICAgICAgICAgICAgICAgICAgIG4gJiYgKEogPSBWYihuKSwgbiAhPT0gSiB8fCA1ICE9PSBuLnRhZyAmJiA2ICE9PSBuLnRhZykpIG4gPSBudWxsO30gZWxzZSBrID0gbnVsbCwgbiA9IGQ7aWYgKGsgIT09IG4pIHt0ID0gQmQ7RiA9ICJvbk1vdXNlTGVhdmUiO3ggPSAib25Nb3VzZUVudGVyIjt3ID0gIm1vdXNlIjtpZiAoInBvaW50ZXJvdXQiID09PSBhIHx8ICJwb2ludGVyb3ZlciIgPT09IGEpIHQgPSBUZCwgRiA9ICJvblBvaW50ZXJMZWF2ZSIsIHggPSAib25Qb2ludGVyRW50ZXIiLCB3ID0gInBvaW50ZXIiO0ogPSBudWxsID09IGsgPyBoIDogdWUoayk7dSA9IG51bGwgPT0gbiA/IGggOiB1ZShuKTtoID0gbmV3IHQoRiwgdyArICJsZWF2ZSIsIGssIGMsIGUpO2gudGFyZ2V0ID0gSjtoLnJlbGF0ZWRUYXJnZXQgPSB1O0YgPSBudWxsO1djKGUpID09PSBkICYmICh0ID0gbmV3IHQoeCwgdyArICJlbnRlciIsIG4sIGMsIGUpLCB0LnRhcmdldCA9IHUsIHQucmVsYXRlZFRhcmdldCA9IEosIEYgPSB0KTtKID0gRjtpZiAoayAmJiBuKSBiOiB7dCA9IGs7eCA9IG47dyA9IDA7Zm9yICh1ID0gdDsgdTsgdSA9IHZmKHUpKSB7dysrO311ID0gMDtmb3IgKEYgPSB4OyBGOyBGID0gdmYoRikpIHt1Kys7fWZvciAoOyAwIDwgdyAtIHU7KSB7dCA9IHZmKHQpLCB3LS07fWZvciAoOyAwIDwgdSAtIHc7KSB7eCA9CiAgICAgICAgICAgICAgICAgICAgICAgICAgdmYoeCksIHUtLTt9Zm9yICg7IHctLTspIHtpZiAodCA9PT0geCB8fCBudWxsICE9PSB4ICYmIHQgPT09IHguYWx0ZXJuYXRlKSBicmVhayBiO3QgPSB2Zih0KTt4ID0gdmYoeCk7fXQgPSBudWxsO30gZWxzZSB0ID0gbnVsbDtudWxsICE9PSBrICYmIHdmKGcsIGgsIGssIHQsICExKTtudWxsICE9PSBuICYmIG51bGwgIT09IEogJiYgd2YoZywgSiwgbiwgdCwgITApO319fWE6IHtoID0gZCA/IHVlKGQpIDogd2luZG93O2sgPSBoLm5vZGVOYW1lICYmIGgubm9kZU5hbWUudG9Mb3dlckNhc2UoKTtpZiAoInNlbGVjdCIgPT09IGsgfHwgImlucHV0IiA9PT0gayAmJiAiZmlsZSIgPT09IGgudHlwZSkgdmFyIG5hID0gdmU7ZWxzZSBpZiAobWUoaCkpIHtpZiAod2UpIG5hID0gRmU7ZWxzZSB7bmEgPSBEZTt2YXIgeGEgPSBDZTt9fSBlbHNlIChrID0gaC5ub2RlTmFtZSkgJiYgImlucHV0IiA9PT0gay50b0xvd2VyQ2FzZSgpICYmICgiY2hlY2tib3giID09PSBoLnR5cGUgfHwgInJhZGlvIiA9PT0gaC50eXBlKSAmJiAobmEgPSBFZSk7aWYgKG5hICYmIChuYSA9IG5hKGEsIGQpKSkge25lKGcsIG5hLCBjLCBlKTticmVhayBhO314YSAmJiB4YShhLCBoLCBkKTsiZm9jdXNvdXQiID09PSBhICYmICh4YSA9IGguX3dyYXBwZXJTdGF0ZSkgJiYKICAgICAgICAgICAgICAgICAgeGEuY29udHJvbGxlZCAmJiAibnVtYmVyIiA9PT0gaC50eXBlICYmIGNiKGgsICJudW1iZXIiLCBoLnZhbHVlKTt9eGEgPSBkID8gdWUoZCkgOiB3aW5kb3c7c3dpdGNoIChhKSB7Y2FzZSAiZm9jdXNpbiI6aWYgKG1lKHhhKSB8fCAidHJ1ZSIgPT09IHhhLmNvbnRlbnRFZGl0YWJsZSkgUWUgPSB4YSwgUmUgPSBkLCBTZSA9IG51bGw7YnJlYWs7Y2FzZSAiZm9jdXNvdXQiOlNlID0gUmUgPSBRZSA9IG51bGw7YnJlYWs7Y2FzZSAibW91c2Vkb3duIjpUZSA9ICEwO2JyZWFrO2Nhc2UgImNvbnRleHRtZW51IjpjYXNlICJtb3VzZXVwIjpjYXNlICJkcmFnZW5kIjpUZSA9ICExO1VlKGcsIGMsIGUpO2JyZWFrO2Nhc2UgInNlbGVjdGlvbmNoYW5nZSI6aWYgKFBlKSBicmVhaztjYXNlICJrZXlkb3duIjpjYXNlICJrZXl1cCI6VWUoZywgYywgZSk7fXZhciAkYTtpZiAoYWUpIGI6IHtzd2l0Y2ggKGEpIHtjYXNlICJjb21wb3NpdGlvbnN0YXJ0Ijp2YXIgYmEgPSAib25Db21wb3NpdGlvblN0YXJ0IjticmVhayBiO2Nhc2UgImNvbXBvc2l0aW9uZW5kIjpiYSA9ICJvbkNvbXBvc2l0aW9uRW5kIjsKICAgICAgICAgICAgICAgICAgICAgIGJyZWFrIGI7Y2FzZSAiY29tcG9zaXRpb251cGRhdGUiOmJhID0gIm9uQ29tcG9zaXRpb25VcGRhdGUiO2JyZWFrIGI7fWJhID0gdm9pZCAwO30gZWxzZSBpZSA/IGdlKGEsIGMpICYmIChiYSA9ICJvbkNvbXBvc2l0aW9uRW5kIikgOiAia2V5ZG93biIgPT09IGEgJiYgMjI5ID09PSBjLmtleUNvZGUgJiYgKGJhID0gIm9uQ29tcG9zaXRpb25TdGFydCIpO2JhICYmIChkZSAmJiAia28iICE9PSBjLmxvY2FsZSAmJiAoaWUgfHwgIm9uQ29tcG9zaXRpb25TdGFydCIgIT09IGJhID8gIm9uQ29tcG9zaXRpb25FbmQiID09PSBiYSAmJiBpZSAmJiAoJGEgPSBuZCgpKSA6IChrZCA9IGUsIGxkID0gInZhbHVlIiBpbiBrZCA/IGtkLnZhbHVlIDoga2QudGV4dENvbnRlbnQsIGllID0gITApKSwgeGEgPSBvZShkLCBiYSksIDAgPCB4YS5sZW5ndGggJiYgKGJhID0gbmV3IExkKGJhLCBhLCBudWxsLCBjLCBlKSwgZy5wdXNoKHsgZXZlbnQ6IGJhLCBsaXN0ZW5lcnM6IHhhIH0pLCAkYSA/IGJhLmRhdGEgPSAkYSA6ICgkYSA9IGhlKGMpLCBudWxsICE9PSAkYSAmJiAoYmEuZGF0YSA9ICRhKSkpKTtpZiAoJGEgPSBjZSA/IGplKGEsIGMpIDoga2UoYSwgYykpIGQgPSBvZShkLCAib25CZWZvcmVJbnB1dCIpLAogICAgICAgICAgICAgICAgMCA8IGQubGVuZ3RoICYmIChlID0gbmV3IExkKCJvbkJlZm9yZUlucHV0IiwgImJlZm9yZWlucHV0IiwgbnVsbCwgYywgZSksIGcucHVzaCh7IGV2ZW50OiBlLCBsaXN0ZW5lcnM6IGQgfSksIGUuZGF0YSA9ICRhKTt9c2UoZywgYik7fSk7fWZ1bmN0aW9uIHRmKGEsIGIsIGMpIHtyZXR1cm4geyBpbnN0YW5jZTogYSwgbGlzdGVuZXI6IGIsIGN1cnJlbnRUYXJnZXQ6IGMgfTt9ZnVuY3Rpb24gb2UoYSwgYikge2ZvciAodmFyIGMgPSBiICsgIkNhcHR1cmUiLCBkID0gW107IG51bGwgIT09IGE7KSB7dmFyIGUgPSBhLGYgPSBlLnN0YXRlTm9kZTs1ID09PSBlLnRhZyAmJiBudWxsICE9PSBmICYmIChlID0gZiwgZiA9IEtiKGEsIGMpLCBudWxsICE9IGYgJiYgZC51bnNoaWZ0KHRmKGEsIGYsIGUpKSwgZiA9IEtiKGEsIGIpLCBudWxsICE9IGYgJiYgZC5wdXNoKHRmKGEsIGYsIGUpKSk7YSA9IGEucmV0dXJuO31yZXR1cm4gZDt9ZnVuY3Rpb24gdmYoYSkge2lmIChudWxsID09PSBhKSByZXR1cm4gbnVsbDtkbyB7YSA9IGEucmV0dXJuO30gd2hpbGUgKGEgJiYgNSAhPT0gYS50YWcpO3JldHVybiBhID8gYSA6IG51bGw7fQogICAgICAgICAgZnVuY3Rpb24gd2YoYSwgYiwgYywgZCwgZSkge2ZvciAodmFyIGYgPSBiLl9yZWFjdE5hbWUsIGcgPSBbXTsgbnVsbCAhPT0gYyAmJiBjICE9PSBkOykge3ZhciBoID0gYyxrID0gaC5hbHRlcm5hdGUsbCA9IGguc3RhdGVOb2RlO2lmIChudWxsICE9PSBrICYmIGsgPT09IGQpIGJyZWFrOzUgPT09IGgudGFnICYmIG51bGwgIT09IGwgJiYgKGggPSBsLCBlID8gKGsgPSBLYihjLCBmKSwgbnVsbCAhPSBrICYmIGcudW5zaGlmdCh0ZihjLCBrLCBoKSkpIDogZSB8fCAoayA9IEtiKGMsIGYpLCBudWxsICE9IGsgJiYgZy5wdXNoKHRmKGMsIGssIGgpKSkpO2MgPSBjLnJldHVybjt9MCAhPT0gZy5sZW5ndGggJiYgYS5wdXNoKHsgZXZlbnQ6IGIsIGxpc3RlbmVyczogZyB9KTt9dmFyIHhmID0gL1xyXG4/L2cseWYgPSAvXHUwMDAwfFx1RkZGRC9nO2Z1bmN0aW9uIHpmKGEpIHtyZXR1cm4gKCJzdHJpbmciID09PSB0eXBlb2YgYSA/IGEgOiAiIiArIGEpLnJlcGxhY2UoeGYsICJcbiIpLnJlcGxhY2UoeWYsICIiKTt9ZnVuY3Rpb24gQWYoYSwgYiwgYykge2IgPSB6ZihiKTtpZiAoemYoYSkgIT09IGIgJiYgYykgdGhyb3cgRXJyb3IocCg0MjUpKTt9ZnVuY3Rpb24gQmYoKSB7fQogICAgICAgICAgdmFyIENmID0gbnVsbCxEZiA9IG51bGw7ZnVuY3Rpb24gRWYoYSwgYikge3JldHVybiAidGV4dGFyZWEiID09PSBhIHx8ICJub3NjcmlwdCIgPT09IGEgfHwgInN0cmluZyIgPT09IHR5cGVvZiBiLmNoaWxkcmVuIHx8ICJudW1iZXIiID09PSB0eXBlb2YgYi5jaGlsZHJlbiB8fCAib2JqZWN0IiA9PT0gdHlwZW9mIGIuZGFuZ2Vyb3VzbHlTZXRJbm5lckhUTUwgJiYgbnVsbCAhPT0gYi5kYW5nZXJvdXNseVNldElubmVySFRNTCAmJiBudWxsICE9IGIuZGFuZ2Vyb3VzbHlTZXRJbm5lckhUTUwuX19odG1sO30KICAgICAgICAgIHZhciBGZiA9ICJmdW5jdGlvbiIgPT09IHR5cGVvZiBzZXRUaW1lb3V0ID8gc2V0VGltZW91dCA6IHZvaWQgMCxHZiA9ICJmdW5jdGlvbiIgPT09IHR5cGVvZiBjbGVhclRpbWVvdXQgPyBjbGVhclRpbWVvdXQgOiB2b2lkIDAsSGYgPSAiZnVuY3Rpb24iID09PSB0eXBlb2YgUHJvbWlzZSA/IFByb21pc2UgOiB2b2lkIDAsSmYgPSAiZnVuY3Rpb24iID09PSB0eXBlb2YgcXVldWVNaWNyb3Rhc2sgPyBxdWV1ZU1pY3JvdGFzayA6ICJ1bmRlZmluZWQiICE9PSB0eXBlb2YgSGYgPyBmdW5jdGlvbiAoYSkge3JldHVybiBIZi5yZXNvbHZlKG51bGwpLnRoZW4oYSkuY2F0Y2goSWYpO30gOiBGZjtmdW5jdGlvbiBJZihhKSB7c2V0VGltZW91dChmdW5jdGlvbiAoKSB7dGhyb3cgYTt9KTt9CiAgICAgICAgICBmdW5jdGlvbiBLZihhLCBiKSB7dmFyIGMgPSBiLGQgPSAwO2RvIHt2YXIgZSA9IGMubmV4dFNpYmxpbmc7YS5yZW1vdmVDaGlsZChjKTtpZiAoZSAmJiA4ID09PSBlLm5vZGVUeXBlKSBpZiAoYyA9IGUuZGF0YSwgIi8kIiA9PT0gYykge2lmICgwID09PSBkKSB7YS5yZW1vdmVDaGlsZChlKTtiZChiKTtyZXR1cm47fWQtLTt9IGVsc2UgIiQiICE9PSBjICYmICIkPyIgIT09IGMgJiYgIiQhIiAhPT0gYyB8fCBkKys7YyA9IGU7fSB3aGlsZSAoYyk7YmQoYik7fWZ1bmN0aW9uIExmKGEpIHtmb3IgKDsgbnVsbCAhPSBhOyBhID0gYS5uZXh0U2libGluZykge3ZhciBiID0gYS5ub2RlVHlwZTtpZiAoMSA9PT0gYiB8fCAzID09PSBiKSBicmVhaztpZiAoOCA9PT0gYikge2IgPSBhLmRhdGE7aWYgKCIkIiA9PT0gYiB8fCAiJCEiID09PSBiIHx8ICIkPyIgPT09IGIpIGJyZWFrO2lmICgiLyQiID09PSBiKSByZXR1cm4gbnVsbDt9fXJldHVybiBhO30KICAgICAgICAgIGZ1bmN0aW9uIE1mKGEpIHthID0gYS5wcmV2aW91c1NpYmxpbmc7Zm9yICh2YXIgYiA9IDA7IGE7KSB7aWYgKDggPT09IGEubm9kZVR5cGUpIHt2YXIgYyA9IGEuZGF0YTtpZiAoIiQiID09PSBjIHx8ICIkISIgPT09IGMgfHwgIiQ/IiA9PT0gYykge2lmICgwID09PSBiKSByZXR1cm4gYTtiLS07fSBlbHNlICIvJCIgPT09IGMgJiYgYisrO31hID0gYS5wcmV2aW91c1NpYmxpbmc7fXJldHVybiBudWxsO312YXIgTmYgPSBNYXRoLnJhbmRvbSgpLnRvU3RyaW5nKDM2KS5zbGljZSgyKSxPZiA9ICJfX3JlYWN0RmliZXIkIiArIE5mLFBmID0gIl9fcmVhY3RQcm9wcyQiICsgTmYsdWYgPSAiX19yZWFjdENvbnRhaW5lciQiICsgTmYsb2YgPSAiX19yZWFjdEV2ZW50cyQiICsgTmYsUWYgPSAiX19yZWFjdExpc3RlbmVycyQiICsgTmYsUmYgPSAiX19yZWFjdEhhbmRsZXMkIiArIE5mOwogICAgICAgICAgZnVuY3Rpb24gV2MoYSkge3ZhciBiID0gYVtPZl07aWYgKGIpIHJldHVybiBiO2ZvciAodmFyIGMgPSBhLnBhcmVudE5vZGU7IGM7KSB7aWYgKGIgPSBjW3VmXSB8fCBjW09mXSkge2MgPSBiLmFsdGVybmF0ZTtpZiAobnVsbCAhPT0gYi5jaGlsZCB8fCBudWxsICE9PSBjICYmIG51bGwgIT09IGMuY2hpbGQpIGZvciAoYSA9IE1mKGEpOyBudWxsICE9PSBhOykge2lmIChjID0gYVtPZl0pIHJldHVybiBjO2EgPSBNZihhKTt9cmV0dXJuIGI7fWEgPSBjO2MgPSBhLnBhcmVudE5vZGU7fXJldHVybiBudWxsO31mdW5jdGlvbiBDYihhKSB7YSA9IGFbT2ZdIHx8IGFbdWZdO3JldHVybiAhYSB8fCA1ICE9PSBhLnRhZyAmJiA2ICE9PSBhLnRhZyAmJiAxMyAhPT0gYS50YWcgJiYgMyAhPT0gYS50YWcgPyBudWxsIDogYTt9ZnVuY3Rpb24gdWUoYSkge2lmICg1ID09PSBhLnRhZyB8fCA2ID09PSBhLnRhZykgcmV0dXJuIGEuc3RhdGVOb2RlO3Rocm93IEVycm9yKHAoMzMpKTt9ZnVuY3Rpb24gRGIoYSkge3JldHVybiBhW1BmXSB8fCBudWxsO312YXIgU2YgPSBbXSxUZiA9IC0xO2Z1bmN0aW9uIFVmKGEpIHtyZXR1cm4geyBjdXJyZW50OiBhIH07fQogICAgICAgICAgZnVuY3Rpb24gRShhKSB7MCA+IFRmIHx8IChhLmN1cnJlbnQgPSBTZltUZl0sIFNmW1RmXSA9IG51bGwsIFRmLS0pO31mdW5jdGlvbiBHKGEsIGIpIHtUZisrO1NmW1RmXSA9IGEuY3VycmVudDthLmN1cnJlbnQgPSBiO312YXIgVmYgPSB7fSxIID0gVWYoVmYpLFdmID0gVWYoITEpLFhmID0gVmY7ZnVuY3Rpb24gWWYoYSwgYikge3ZhciBjID0gYS50eXBlLmNvbnRleHRUeXBlcztpZiAoIWMpIHJldHVybiBWZjt2YXIgZCA9IGEuc3RhdGVOb2RlO2lmIChkICYmIGQuX19yZWFjdEludGVybmFsTWVtb2l6ZWRVbm1hc2tlZENoaWxkQ29udGV4dCA9PT0gYikgcmV0dXJuIGQuX19yZWFjdEludGVybmFsTWVtb2l6ZWRNYXNrZWRDaGlsZENvbnRleHQ7dmFyIGUgPSB7fSxmO2ZvciAoZiBpbiBjKSB7ZVtmXSA9IGJbZl07fWQgJiYgKGEgPSBhLnN0YXRlTm9kZSwgYS5fX3JlYWN0SW50ZXJuYWxNZW1vaXplZFVubWFza2VkQ2hpbGRDb250ZXh0ID0gYiwgYS5fX3JlYWN0SW50ZXJuYWxNZW1vaXplZE1hc2tlZENoaWxkQ29udGV4dCA9IGUpO3JldHVybiBlO30KICAgICAgICAgIGZ1bmN0aW9uIFpmKGEpIHthID0gYS5jaGlsZENvbnRleHRUeXBlcztyZXR1cm4gbnVsbCAhPT0gYSAmJiB2b2lkIDAgIT09IGE7fWZ1bmN0aW9uICRmKCkge0UoV2YpO0UoSCk7fWZ1bmN0aW9uIGFnKGEsIGIsIGMpIHtpZiAoSC5jdXJyZW50ICE9PSBWZikgdGhyb3cgRXJyb3IocCgxNjgpKTtHKEgsIGIpO0coV2YsIGMpO31mdW5jdGlvbiBiZyhhLCBiLCBjKSB7dmFyIGQgPSBhLnN0YXRlTm9kZTtiID0gYi5jaGlsZENvbnRleHRUeXBlcztpZiAoImZ1bmN0aW9uIiAhPT0gdHlwZW9mIGQuZ2V0Q2hpbGRDb250ZXh0KSByZXR1cm4gYztkID0gZC5nZXRDaGlsZENvbnRleHQoKTtmb3IgKHZhciBlIGluIGQpIHtpZiAoIShlIGluIGIpKSB0aHJvdyBFcnJvcihwKDEwOCwgUmEoYSkgfHwgIlVua25vd24iLCBlKSk7fXJldHVybiBBKHt9LCBjLCBkKTt9CiAgICAgICAgICBmdW5jdGlvbiBjZyhhKSB7YSA9IChhID0gYS5zdGF0ZU5vZGUpICYmIGEuX19yZWFjdEludGVybmFsTWVtb2l6ZWRNZXJnZWRDaGlsZENvbnRleHQgfHwgVmY7WGYgPSBILmN1cnJlbnQ7RyhILCBhKTtHKFdmLCBXZi5jdXJyZW50KTtyZXR1cm4gITA7fWZ1bmN0aW9uIGRnKGEsIGIsIGMpIHt2YXIgZCA9IGEuc3RhdGVOb2RlO2lmICghZCkgdGhyb3cgRXJyb3IocCgxNjkpKTtjID8gKGEgPSBiZyhhLCBiLCBYZiksIGQuX19yZWFjdEludGVybmFsTWVtb2l6ZWRNZXJnZWRDaGlsZENvbnRleHQgPSBhLCBFKFdmKSwgRShIKSwgRyhILCBhKSkgOiBFKFdmKTtHKFdmLCBjKTt9dmFyIGVnID0gbnVsbCxmZyA9ICExLGdnID0gITE7ZnVuY3Rpb24gaGcoYSkge251bGwgPT09IGVnID8gZWcgPSBbYV0gOiBlZy5wdXNoKGEpO31mdW5jdGlvbiBpZyhhKSB7ZmcgPSAhMDtoZyhhKTt9CiAgICAgICAgICBmdW5jdGlvbiBqZygpIHtpZiAoIWdnICYmIG51bGwgIT09IGVnKSB7Z2cgPSAhMDt2YXIgYSA9IDAsYiA9IEM7dHJ5IHt2YXIgYyA9IGVnO2ZvciAoQyA9IDE7IGEgPCBjLmxlbmd0aDsgYSsrKSB7dmFyIGQgPSBjW2FdO2RvIHtkID0gZCghMCk7fSB3aGlsZSAobnVsbCAhPT0gZCk7fWVnID0gbnVsbDtmZyA9ICExO30gY2F0Y2ggKGUpIHt0aHJvdyBudWxsICE9PSBlZyAmJiAoZWcgPSBlZy5zbGljZShhICsgMSkpLCBhYyhmYywgamcpLCBlO30gZmluYWxseSB7QyA9IGIsIGdnID0gITE7fX1yZXR1cm4gbnVsbDt9dmFyIGtnID0gW10sbGcgPSAwLG1nID0gbnVsbCxuZyA9IDAsb2cgPSBbXSxwZyA9IDAscWcgPSBudWxsLHJnID0gMSxzZyA9ICIiO2Z1bmN0aW9uIHRnKGEsIGIpIHtrZ1tsZysrXSA9IG5nO2tnW2xnKytdID0gbWc7bWcgPSBhO25nID0gYjt9CiAgICAgICAgICBmdW5jdGlvbiB1ZyhhLCBiLCBjKSB7b2dbcGcrK10gPSByZztvZ1twZysrXSA9IHNnO29nW3BnKytdID0gcWc7cWcgPSBhO3ZhciBkID0gcmc7YSA9IHNnO3ZhciBlID0gMzIgLSBvYyhkKSAtIDE7ZCAmPSB+KDEgPDwgZSk7YyArPSAxO3ZhciBmID0gMzIgLSBvYyhiKSArIGU7aWYgKDMwIDwgZikge3ZhciBnID0gZSAtIGUgJSA1O2YgPSAoZCAmICgxIDw8IGcpIC0gMSkudG9TdHJpbmcoMzIpO2QgPj49IGc7ZSAtPSBnO3JnID0gMSA8PCAzMiAtIG9jKGIpICsgZSB8IGMgPDwgZSB8IGQ7c2cgPSBmICsgYTt9IGVsc2UgcmcgPSAxIDw8IGYgfCBjIDw8IGUgfCBkLCBzZyA9IGE7fWZ1bmN0aW9uIHZnKGEpIHtudWxsICE9PSBhLnJldHVybiAmJiAodGcoYSwgMSksIHVnKGEsIDEsIDApKTt9ZnVuY3Rpb24gd2coYSkge2ZvciAoOyBhID09PSBtZzspIHttZyA9IGtnWy0tbGddLCBrZ1tsZ10gPSBudWxsLCBuZyA9IGtnWy0tbGddLCBrZ1tsZ10gPSBudWxsO31mb3IgKDsgYSA9PT0gcWc7KSB7cWcgPSBvZ1stLXBnXSwgb2dbcGddID0gbnVsbCwgc2cgPSBvZ1stLXBnXSwgb2dbcGddID0gbnVsbCwgcmcgPSBvZ1stLXBnXSwgb2dbcGddID0gbnVsbDt9fXZhciB4ZyA9IG51bGwseWcgPSBudWxsLEkgPSAhMSx6ZyA9IG51bGw7CiAgICAgICAgICBmdW5jdGlvbiBBZyhhLCBiKSB7dmFyIGMgPSBCZyg1LCBudWxsLCBudWxsLCAwKTtjLmVsZW1lbnRUeXBlID0gIkRFTEVURUQiO2Muc3RhdGVOb2RlID0gYjtjLnJldHVybiA9IGE7YiA9IGEuZGVsZXRpb25zO251bGwgPT09IGIgPyAoYS5kZWxldGlvbnMgPSBbY10sIGEuZmxhZ3MgfD0gMTYpIDogYi5wdXNoKGMpO30KICAgICAgICAgIGZ1bmN0aW9uIENnKGEsIGIpIHtzd2l0Y2ggKGEudGFnKSB7Y2FzZSA1OnZhciBjID0gYS50eXBlO2IgPSAxICE9PSBiLm5vZGVUeXBlIHx8IGMudG9Mb3dlckNhc2UoKSAhPT0gYi5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpID8gbnVsbCA6IGI7cmV0dXJuIG51bGwgIT09IGIgPyAoYS5zdGF0ZU5vZGUgPSBiLCB4ZyA9IGEsIHlnID0gTGYoYi5maXJzdENoaWxkKSwgITApIDogITE7Y2FzZSA2OnJldHVybiBiID0gIiIgPT09IGEucGVuZGluZ1Byb3BzIHx8IDMgIT09IGIubm9kZVR5cGUgPyBudWxsIDogYiwgbnVsbCAhPT0gYiA/IChhLnN0YXRlTm9kZSA9IGIsIHhnID0gYSwgeWcgPSBudWxsLCAhMCkgOiAhMTtjYXNlIDEzOnJldHVybiBiID0gOCAhPT0gYi5ub2RlVHlwZSA/IG51bGwgOiBiLCBudWxsICE9PSBiID8gKGMgPSBudWxsICE9PSBxZyA/IHsgaWQ6IHJnLCBvdmVyZmxvdzogc2cgfSA6IG51bGwsIGEubWVtb2l6ZWRTdGF0ZSA9IHsgZGVoeWRyYXRlZDogYiwgdHJlZUNvbnRleHQ6IGMsIHJldHJ5TGFuZTogMTA3Mzc0MTgyNCB9LCBjID0gQmcoMTgsIG51bGwsIG51bGwsIDApLCBjLnN0YXRlTm9kZSA9IGIsIGMucmV0dXJuID0gYSwgYS5jaGlsZCA9IGMsIHhnID0gYSwgeWcgPQogICAgICAgICAgICAgICAgbnVsbCwgITApIDogITE7ZGVmYXVsdDpyZXR1cm4gITE7fX1mdW5jdGlvbiBEZyhhKSB7cmV0dXJuIDAgIT09IChhLm1vZGUgJiAxKSAmJiAwID09PSAoYS5mbGFncyAmIDEyOCk7fWZ1bmN0aW9uIEVnKGEpIHtpZiAoSSkge3ZhciBiID0geWc7aWYgKGIpIHt2YXIgYyA9IGI7aWYgKCFDZyhhLCBiKSkge2lmIChEZyhhKSkgdGhyb3cgRXJyb3IocCg0MTgpKTtiID0gTGYoYy5uZXh0U2libGluZyk7dmFyIGQgPSB4ZztiICYmIENnKGEsIGIpID8gQWcoZCwgYykgOiAoYS5mbGFncyA9IGEuZmxhZ3MgJiAtNDA5NyB8IDIsIEkgPSAhMSwgeGcgPSBhKTt9fSBlbHNlIHtpZiAoRGcoYSkpIHRocm93IEVycm9yKHAoNDE4KSk7YS5mbGFncyA9IGEuZmxhZ3MgJiAtNDA5NyB8IDI7SSA9ICExO3hnID0gYTt9fX1mdW5jdGlvbiBGZyhhKSB7Zm9yIChhID0gYS5yZXR1cm47IG51bGwgIT09IGEgJiYgNSAhPT0gYS50YWcgJiYgMyAhPT0gYS50YWcgJiYgMTMgIT09IGEudGFnOykge2EgPSBhLnJldHVybjt9eGcgPSBhO30KICAgICAgICAgIGZ1bmN0aW9uIEdnKGEpIHtpZiAoYSAhPT0geGcpIHJldHVybiAhMTtpZiAoIUkpIHJldHVybiBGZyhhKSwgSSA9ICEwLCAhMTt2YXIgYjsoYiA9IDMgIT09IGEudGFnKSAmJiAhKGIgPSA1ICE9PSBhLnRhZykgJiYgKGIgPSBhLnR5cGUsIGIgPSAiaGVhZCIgIT09IGIgJiYgImJvZHkiICE9PSBiICYmICFFZihhLnR5cGUsIGEubWVtb2l6ZWRQcm9wcykpO2lmIChiICYmIChiID0geWcpKSB7aWYgKERnKGEpKSB0aHJvdyBIZygpLCBFcnJvcihwKDQxOCkpO2ZvciAoOyBiOykge0FnKGEsIGIpLCBiID0gTGYoYi5uZXh0U2libGluZyk7fX1GZyhhKTtpZiAoMTMgPT09IGEudGFnKSB7YSA9IGEubWVtb2l6ZWRTdGF0ZTthID0gbnVsbCAhPT0gYSA/IGEuZGVoeWRyYXRlZCA6IG51bGw7aWYgKCFhKSB0aHJvdyBFcnJvcihwKDMxNykpO2E6IHthID0gYS5uZXh0U2libGluZztmb3IgKGIgPSAwOyBhOykge2lmICg4ID09PSBhLm5vZGVUeXBlKSB7dmFyIGMgPSBhLmRhdGE7aWYgKCIvJCIgPT09IGMpIHtpZiAoMCA9PT0gYikge3lnID0gTGYoYS5uZXh0U2libGluZyk7YnJlYWsgYTt9Yi0tO30gZWxzZSAiJCIgIT09IGMgJiYgIiQhIiAhPT0gYyAmJiAiJD8iICE9PSBjIHx8IGIrKzt9YSA9IGEubmV4dFNpYmxpbmc7fXlnID0KICAgICAgICAgICAgICAgIG51bGw7fX0gZWxzZSB5ZyA9IHhnID8gTGYoYS5zdGF0ZU5vZGUubmV4dFNpYmxpbmcpIDogbnVsbDtyZXR1cm4gITA7fWZ1bmN0aW9uIEhnKCkge2ZvciAodmFyIGEgPSB5ZzsgYTspIHthID0gTGYoYS5uZXh0U2libGluZyk7fX1mdW5jdGlvbiBJZygpIHt5ZyA9IHhnID0gbnVsbDtJID0gITE7fWZ1bmN0aW9uIEpnKGEpIHtudWxsID09PSB6ZyA/IHpnID0gW2FdIDogemcucHVzaChhKTt9dmFyIEtnID0gdWEuUmVhY3RDdXJyZW50QmF0Y2hDb25maWc7ZnVuY3Rpb24gTGcoYSwgYikge2lmIChhICYmIGEuZGVmYXVsdFByb3BzKSB7YiA9IEEoe30sIGIpO2EgPSBhLmRlZmF1bHRQcm9wcztmb3IgKHZhciBjIGluIGEpIHt2b2lkIDAgPT09IGJbY10gJiYgKGJbY10gPSBhW2NdKTt9cmV0dXJuIGI7fXJldHVybiBiO312YXIgTWcgPSBVZihudWxsKSxOZyA9IG51bGwsT2cgPSBudWxsLFBnID0gbnVsbDtmdW5jdGlvbiBRZygpIHtQZyA9IE9nID0gTmcgPSBudWxsO31mdW5jdGlvbiBSZyhhKSB7dmFyIGIgPSBNZy5jdXJyZW50O0UoTWcpO2EuX2N1cnJlbnRWYWx1ZSA9IGI7fQogICAgICAgICAgZnVuY3Rpb24gU2coYSwgYiwgYykge2ZvciAoOyBudWxsICE9PSBhOykge3ZhciBkID0gYS5hbHRlcm5hdGU7KGEuY2hpbGRMYW5lcyAmIGIpICE9PSBiID8gKGEuY2hpbGRMYW5lcyB8PSBiLCBudWxsICE9PSBkICYmIChkLmNoaWxkTGFuZXMgfD0gYikpIDogbnVsbCAhPT0gZCAmJiAoZC5jaGlsZExhbmVzICYgYikgIT09IGIgJiYgKGQuY2hpbGRMYW5lcyB8PSBiKTtpZiAoYSA9PT0gYykgYnJlYWs7YSA9IGEucmV0dXJuO319ZnVuY3Rpb24gVGcoYSwgYikge05nID0gYTtQZyA9IE9nID0gbnVsbDthID0gYS5kZXBlbmRlbmNpZXM7bnVsbCAhPT0gYSAmJiBudWxsICE9PSBhLmZpcnN0Q29udGV4dCAmJiAoMCAhPT0gKGEubGFuZXMgJiBiKSAmJiAoVWcgPSAhMCksIGEuZmlyc3RDb250ZXh0ID0gbnVsbCk7fQogICAgICAgICAgZnVuY3Rpb24gVmcoYSkge3ZhciBiID0gYS5fY3VycmVudFZhbHVlO2lmIChQZyAhPT0gYSkgaWYgKGEgPSB7IGNvbnRleHQ6IGEsIG1lbW9pemVkVmFsdWU6IGIsIG5leHQ6IG51bGwgfSwgbnVsbCA9PT0gT2cpIHtpZiAobnVsbCA9PT0gTmcpIHRocm93IEVycm9yKHAoMzA4KSk7T2cgPSBhO05nLmRlcGVuZGVuY2llcyA9IHsgbGFuZXM6IDAsIGZpcnN0Q29udGV4dDogYSB9O30gZWxzZSBPZyA9IE9nLm5leHQgPSBhO3JldHVybiBiO312YXIgV2cgPSBudWxsO2Z1bmN0aW9uIFhnKGEpIHtudWxsID09PSBXZyA/IFdnID0gW2FdIDogV2cucHVzaChhKTt9ZnVuY3Rpb24gWWcoYSwgYiwgYywgZCkge3ZhciBlID0gYi5pbnRlcmxlYXZlZDtudWxsID09PSBlID8gKGMubmV4dCA9IGMsIFhnKGIpKSA6IChjLm5leHQgPSBlLm5leHQsIGUubmV4dCA9IGMpO2IuaW50ZXJsZWF2ZWQgPSBjO3JldHVybiBaZyhhLCBkKTt9CiAgICAgICAgICBmdW5jdGlvbiBaZyhhLCBiKSB7YS5sYW5lcyB8PSBiO3ZhciBjID0gYS5hbHRlcm5hdGU7bnVsbCAhPT0gYyAmJiAoYy5sYW5lcyB8PSBiKTtjID0gYTtmb3IgKGEgPSBhLnJldHVybjsgbnVsbCAhPT0gYTspIHthLmNoaWxkTGFuZXMgfD0gYiwgYyA9IGEuYWx0ZXJuYXRlLCBudWxsICE9PSBjICYmIChjLmNoaWxkTGFuZXMgfD0gYiksIGMgPSBhLCBhID0gYS5yZXR1cm47fXJldHVybiAzID09PSBjLnRhZyA/IGMuc3RhdGVOb2RlIDogbnVsbDt9dmFyICRnID0gITE7ZnVuY3Rpb24gYWgoYSkge2EudXBkYXRlUXVldWUgPSB7IGJhc2VTdGF0ZTogYS5tZW1vaXplZFN0YXRlLCBmaXJzdEJhc2VVcGRhdGU6IG51bGwsIGxhc3RCYXNlVXBkYXRlOiBudWxsLCBzaGFyZWQ6IHsgcGVuZGluZzogbnVsbCwgaW50ZXJsZWF2ZWQ6IG51bGwsIGxhbmVzOiAwIH0sIGVmZmVjdHM6IG51bGwgfTt9CiAgICAgICAgICBmdW5jdGlvbiBiaChhLCBiKSB7YSA9IGEudXBkYXRlUXVldWU7Yi51cGRhdGVRdWV1ZSA9PT0gYSAmJiAoYi51cGRhdGVRdWV1ZSA9IHsgYmFzZVN0YXRlOiBhLmJhc2VTdGF0ZSwgZmlyc3RCYXNlVXBkYXRlOiBhLmZpcnN0QmFzZVVwZGF0ZSwgbGFzdEJhc2VVcGRhdGU6IGEubGFzdEJhc2VVcGRhdGUsIHNoYXJlZDogYS5zaGFyZWQsIGVmZmVjdHM6IGEuZWZmZWN0cyB9KTt9ZnVuY3Rpb24gY2goYSwgYikge3JldHVybiB7IGV2ZW50VGltZTogYSwgbGFuZTogYiwgdGFnOiAwLCBwYXlsb2FkOiBudWxsLCBjYWxsYmFjazogbnVsbCwgbmV4dDogbnVsbCB9O30KICAgICAgICAgIGZ1bmN0aW9uIGRoKGEsIGIsIGMpIHt2YXIgZCA9IGEudXBkYXRlUXVldWU7aWYgKG51bGwgPT09IGQpIHJldHVybiBudWxsO2QgPSBkLnNoYXJlZDtpZiAoMCAhPT0gKEsgJiAyKSkge3ZhciBlID0gZC5wZW5kaW5nO251bGwgPT09IGUgPyBiLm5leHQgPSBiIDogKGIubmV4dCA9IGUubmV4dCwgZS5uZXh0ID0gYik7ZC5wZW5kaW5nID0gYjtyZXR1cm4gWmcoYSwgYyk7fWUgPSBkLmludGVybGVhdmVkO251bGwgPT09IGUgPyAoYi5uZXh0ID0gYiwgWGcoZCkpIDogKGIubmV4dCA9IGUubmV4dCwgZS5uZXh0ID0gYik7ZC5pbnRlcmxlYXZlZCA9IGI7cmV0dXJuIFpnKGEsIGMpO31mdW5jdGlvbiBlaChhLCBiLCBjKSB7YiA9IGIudXBkYXRlUXVldWU7aWYgKG51bGwgIT09IGIgJiYgKGIgPSBiLnNoYXJlZCwgMCAhPT0gKGMgJiA0MTk0MjQwKSkpIHt2YXIgZCA9IGIubGFuZXM7ZCAmPSBhLnBlbmRpbmdMYW5lcztjIHw9IGQ7Yi5sYW5lcyA9IGM7Q2MoYSwgYyk7fX0KICAgICAgICAgIGZ1bmN0aW9uIGZoKGEsIGIpIHt2YXIgYyA9IGEudXBkYXRlUXVldWUsZCA9IGEuYWx0ZXJuYXRlO2lmIChudWxsICE9PSBkICYmIChkID0gZC51cGRhdGVRdWV1ZSwgYyA9PT0gZCkpIHt2YXIgZSA9IG51bGwsZiA9IG51bGw7YyA9IGMuZmlyc3RCYXNlVXBkYXRlO2lmIChudWxsICE9PSBjKSB7ZG8ge3ZhciBnID0geyBldmVudFRpbWU6IGMuZXZlbnRUaW1lLCBsYW5lOiBjLmxhbmUsIHRhZzogYy50YWcsIHBheWxvYWQ6IGMucGF5bG9hZCwgY2FsbGJhY2s6IGMuY2FsbGJhY2ssIG5leHQ6IG51bGwgfTtudWxsID09PSBmID8gZSA9IGYgPSBnIDogZiA9IGYubmV4dCA9IGc7YyA9IGMubmV4dDt9IHdoaWxlIChudWxsICE9PSBjKTtudWxsID09PSBmID8gZSA9IGYgPSBiIDogZiA9IGYubmV4dCA9IGI7fSBlbHNlIGUgPSBmID0gYjtjID0geyBiYXNlU3RhdGU6IGQuYmFzZVN0YXRlLCBmaXJzdEJhc2VVcGRhdGU6IGUsIGxhc3RCYXNlVXBkYXRlOiBmLCBzaGFyZWQ6IGQuc2hhcmVkLCBlZmZlY3RzOiBkLmVmZmVjdHMgfTthLnVwZGF0ZVF1ZXVlID0gYztyZXR1cm47fWEgPSBjLmxhc3RCYXNlVXBkYXRlO251bGwgPT09IGEgPyBjLmZpcnN0QmFzZVVwZGF0ZSA9IGIgOiBhLm5leHQgPQogICAgICAgICAgICBiO2MubGFzdEJhc2VVcGRhdGUgPSBiO30KICAgICAgICAgIGZ1bmN0aW9uIGdoKGEsIGIsIGMsIGQpIHt2YXIgZSA9IGEudXBkYXRlUXVldWU7JGcgPSAhMTt2YXIgZiA9IGUuZmlyc3RCYXNlVXBkYXRlLGcgPSBlLmxhc3RCYXNlVXBkYXRlLGggPSBlLnNoYXJlZC5wZW5kaW5nO2lmIChudWxsICE9PSBoKSB7ZS5zaGFyZWQucGVuZGluZyA9IG51bGw7dmFyIGsgPSBoLGwgPSBrLm5leHQ7ay5uZXh0ID0gbnVsbDtudWxsID09PSBnID8gZiA9IGwgOiBnLm5leHQgPSBsO2cgPSBrO3ZhciBtID0gYS5hbHRlcm5hdGU7bnVsbCAhPT0gbSAmJiAobSA9IG0udXBkYXRlUXVldWUsIGggPSBtLmxhc3RCYXNlVXBkYXRlLCBoICE9PSBnICYmIChudWxsID09PSBoID8gbS5maXJzdEJhc2VVcGRhdGUgPSBsIDogaC5uZXh0ID0gbCwgbS5sYXN0QmFzZVVwZGF0ZSA9IGspKTt9aWYgKG51bGwgIT09IGYpIHt2YXIgcSA9IGUuYmFzZVN0YXRlO2cgPSAwO20gPSBsID0gayA9IG51bGw7aCA9IGY7ZG8ge3ZhciByID0gaC5sYW5lLHkgPSBoLmV2ZW50VGltZTtpZiAoKGQgJiByKSA9PT0gcikge251bGwgIT09IG0gJiYgKG0gPSBtLm5leHQgPSB7IGV2ZW50VGltZTogeSwgbGFuZTogMCwgdGFnOiBoLnRhZywgcGF5bG9hZDogaC5wYXlsb2FkLCBjYWxsYmFjazogaC5jYWxsYmFjaywKICAgICAgICAgICAgICAgICAgICBuZXh0OiBudWxsIH0pO2E6IHt2YXIgbiA9IGEsdCA9IGg7ciA9IGI7eSA9IGM7c3dpdGNoICh0LnRhZykge2Nhc2UgMTpuID0gdC5wYXlsb2FkO2lmICgiZnVuY3Rpb24iID09PSB0eXBlb2Ygbikge3EgPSBuLmNhbGwoeSwgcSwgcik7YnJlYWsgYTt9cSA9IG47YnJlYWsgYTtjYXNlIDM6bi5mbGFncyA9IG4uZmxhZ3MgJiAtNjU1MzcgfCAxMjg7Y2FzZSAwOm4gPSB0LnBheWxvYWQ7ciA9ICJmdW5jdGlvbiIgPT09IHR5cGVvZiBuID8gbi5jYWxsKHksIHEsIHIpIDogbjtpZiAobnVsbCA9PT0gciB8fCB2b2lkIDAgPT09IHIpIGJyZWFrIGE7cSA9IEEoe30sIHEsIHIpO2JyZWFrIGE7Y2FzZSAyOiRnID0gITA7fX1udWxsICE9PSBoLmNhbGxiYWNrICYmIDAgIT09IGgubGFuZSAmJiAoYS5mbGFncyB8PSA2NCwgciA9IGUuZWZmZWN0cywgbnVsbCA9PT0gciA/IGUuZWZmZWN0cyA9IFtoXSA6IHIucHVzaChoKSk7fSBlbHNlIHkgPSB7IGV2ZW50VGltZTogeSwgbGFuZTogciwgdGFnOiBoLnRhZywgcGF5bG9hZDogaC5wYXlsb2FkLCBjYWxsYmFjazogaC5jYWxsYmFjaywgbmV4dDogbnVsbCB9LCBudWxsID09PSBtID8gKGwgPSBtID0geSwgayA9IHEpIDogbSA9IG0ubmV4dCA9IHksIGcgfD0gcjsKICAgICAgICAgICAgICAgIGggPSBoLm5leHQ7aWYgKG51bGwgPT09IGgpIGlmIChoID0gZS5zaGFyZWQucGVuZGluZywgbnVsbCA9PT0gaCkgYnJlYWs7ZWxzZSByID0gaCwgaCA9IHIubmV4dCwgci5uZXh0ID0gbnVsbCwgZS5sYXN0QmFzZVVwZGF0ZSA9IHIsIGUuc2hhcmVkLnBlbmRpbmcgPSBudWxsO30gd2hpbGUgKDEpO251bGwgPT09IG0gJiYgKGsgPSBxKTtlLmJhc2VTdGF0ZSA9IGs7ZS5maXJzdEJhc2VVcGRhdGUgPSBsO2UubGFzdEJhc2VVcGRhdGUgPSBtO2IgPSBlLnNoYXJlZC5pbnRlcmxlYXZlZDtpZiAobnVsbCAhPT0gYikge2UgPSBiO2RvIHtnIHw9IGUubGFuZSwgZSA9IGUubmV4dDt9IHdoaWxlIChlICE9PSBiKTt9IGVsc2UgbnVsbCA9PT0gZiAmJiAoZS5zaGFyZWQubGFuZXMgPSAwKTtoaCB8PSBnO2EubGFuZXMgPSBnO2EubWVtb2l6ZWRTdGF0ZSA9IHE7fX0KICAgICAgICAgIGZ1bmN0aW9uIGloKGEsIGIsIGMpIHthID0gYi5lZmZlY3RzO2IuZWZmZWN0cyA9IG51bGw7aWYgKG51bGwgIT09IGEpIGZvciAoYiA9IDA7IGIgPCBhLmxlbmd0aDsgYisrKSB7dmFyIGQgPSBhW2JdLGUgPSBkLmNhbGxiYWNrO2lmIChudWxsICE9PSBlKSB7ZC5jYWxsYmFjayA9IG51bGw7ZCA9IGM7aWYgKCJmdW5jdGlvbiIgIT09IHR5cGVvZiBlKSB0aHJvdyBFcnJvcihwKDE5MSwgZSkpO2UuY2FsbChkKTt9fX12YXIgamggPSBuZXcgYWEuQ29tcG9uZW50KCkucmVmcztmdW5jdGlvbiBraChhLCBiLCBjLCBkKSB7YiA9IGEubWVtb2l6ZWRTdGF0ZTtjID0gYyhkLCBiKTtjID0gbnVsbCA9PT0gYyB8fCB2b2lkIDAgPT09IGMgPyBiIDogQSh7fSwgYiwgYyk7YS5tZW1vaXplZFN0YXRlID0gYzswID09PSBhLmxhbmVzICYmIChhLnVwZGF0ZVF1ZXVlLmJhc2VTdGF0ZSA9IGMpO30KICAgICAgICAgIHZhciBuaCA9IHsgaXNNb3VudGVkOiBmdW5jdGlvbiBpc01vdW50ZWQoYSkge3JldHVybiAoYSA9IGEuX3JlYWN0SW50ZXJuYWxzKSA/IFZiKGEpID09PSBhIDogITE7fSwgZW5xdWV1ZVNldFN0YXRlOiBmdW5jdGlvbiBlbnF1ZXVlU2V0U3RhdGUoYSwgYiwgYykge2EgPSBhLl9yZWFjdEludGVybmFsczt2YXIgZCA9IEwoKSxlID0gbGgoYSksZiA9IGNoKGQsIGUpO2YucGF5bG9hZCA9IGI7dm9pZCAwICE9PSBjICYmIG51bGwgIT09IGMgJiYgKGYuY2FsbGJhY2sgPSBjKTtiID0gZGgoYSwgZiwgZSk7bnVsbCAhPT0gYiAmJiAobWgoYiwgYSwgZSwgZCksIGVoKGIsIGEsIGUpKTt9LCBlbnF1ZXVlUmVwbGFjZVN0YXRlOiBmdW5jdGlvbiBlbnF1ZXVlUmVwbGFjZVN0YXRlKGEsIGIsIGMpIHthID0gYS5fcmVhY3RJbnRlcm5hbHM7dmFyIGQgPSBMKCksZSA9IGxoKGEpLGYgPSBjaChkLCBlKTtmLnRhZyA9IDE7Zi5wYXlsb2FkID0gYjt2b2lkIDAgIT09IGMgJiYgbnVsbCAhPT0gYyAmJiAoZi5jYWxsYmFjayA9IGMpO2IgPSBkaChhLCBmLCBlKTtudWxsICE9PSBiICYmIChtaChiLCBhLCBlLCBkKSwgZWgoYiwgYSwgZSkpO30sIGVucXVldWVGb3JjZVVwZGF0ZTogZnVuY3Rpb24gZW5xdWV1ZUZvcmNlVXBkYXRlKGEsIGIpIHthID0gYS5fcmVhY3RJbnRlcm5hbHM7dmFyIGMgPSBMKCksZCA9CiAgICAgICAgICAgICAgICBsaChhKSxlID0gY2goYywgZCk7ZS50YWcgPSAyO3ZvaWQgMCAhPT0gYiAmJiBudWxsICE9PSBiICYmIChlLmNhbGxiYWNrID0gYik7YiA9IGRoKGEsIGUsIGQpO251bGwgIT09IGIgJiYgKG1oKGIsIGEsIGQsIGMpLCBlaChiLCBhLCBkKSk7fSB9O2Z1bmN0aW9uIG9oKGEsIGIsIGMsIGQsIGUsIGYsIGcpIHthID0gYS5zdGF0ZU5vZGU7cmV0dXJuICJmdW5jdGlvbiIgPT09IHR5cGVvZiBhLnNob3VsZENvbXBvbmVudFVwZGF0ZSA/IGEuc2hvdWxkQ29tcG9uZW50VXBkYXRlKGQsIGYsIGcpIDogYi5wcm90b3R5cGUgJiYgYi5wcm90b3R5cGUuaXNQdXJlUmVhY3RDb21wb25lbnQgPyAhSWUoYywgZCkgfHwgIUllKGUsIGYpIDogITA7fQogICAgICAgICAgZnVuY3Rpb24gcGgoYSwgYiwgYykge3ZhciBkID0gITEsZSA9IFZmO3ZhciBmID0gYi5jb250ZXh0VHlwZTsib2JqZWN0IiA9PT0gdHlwZW9mIGYgJiYgbnVsbCAhPT0gZiA/IGYgPSBWZyhmKSA6IChlID0gWmYoYikgPyBYZiA6IEguY3VycmVudCwgZCA9IGIuY29udGV4dFR5cGVzLCBmID0gKGQgPSBudWxsICE9PSBkICYmIHZvaWQgMCAhPT0gZCkgPyBZZihhLCBlKSA6IFZmKTtiID0gbmV3IGIoYywgZik7YS5tZW1vaXplZFN0YXRlID0gbnVsbCAhPT0gYi5zdGF0ZSAmJiB2b2lkIDAgIT09IGIuc3RhdGUgPyBiLnN0YXRlIDogbnVsbDtiLnVwZGF0ZXIgPSBuaDthLnN0YXRlTm9kZSA9IGI7Yi5fcmVhY3RJbnRlcm5hbHMgPSBhO2QgJiYgKGEgPSBhLnN0YXRlTm9kZSwgYS5fX3JlYWN0SW50ZXJuYWxNZW1vaXplZFVubWFza2VkQ2hpbGRDb250ZXh0ID0gZSwgYS5fX3JlYWN0SW50ZXJuYWxNZW1vaXplZE1hc2tlZENoaWxkQ29udGV4dCA9IGYpO3JldHVybiBiO30KICAgICAgICAgIGZ1bmN0aW9uIHFoKGEsIGIsIGMsIGQpIHthID0gYi5zdGF0ZTsiZnVuY3Rpb24iID09PSB0eXBlb2YgYi5jb21wb25lbnRXaWxsUmVjZWl2ZVByb3BzICYmIGIuY29tcG9uZW50V2lsbFJlY2VpdmVQcm9wcyhjLCBkKTsiZnVuY3Rpb24iID09PSB0eXBlb2YgYi5VTlNBRkVfY29tcG9uZW50V2lsbFJlY2VpdmVQcm9wcyAmJiBiLlVOU0FGRV9jb21wb25lbnRXaWxsUmVjZWl2ZVByb3BzKGMsIGQpO2Iuc3RhdGUgIT09IGEgJiYgbmguZW5xdWV1ZVJlcGxhY2VTdGF0ZShiLCBiLnN0YXRlLCBudWxsKTt9CiAgICAgICAgICBmdW5jdGlvbiByaChhLCBiLCBjLCBkKSB7dmFyIGUgPSBhLnN0YXRlTm9kZTtlLnByb3BzID0gYztlLnN0YXRlID0gYS5tZW1vaXplZFN0YXRlO2UucmVmcyA9IGpoO2FoKGEpO3ZhciBmID0gYi5jb250ZXh0VHlwZTsib2JqZWN0IiA9PT0gdHlwZW9mIGYgJiYgbnVsbCAhPT0gZiA/IGUuY29udGV4dCA9IFZnKGYpIDogKGYgPSBaZihiKSA/IFhmIDogSC5jdXJyZW50LCBlLmNvbnRleHQgPSBZZihhLCBmKSk7ZS5zdGF0ZSA9IGEubWVtb2l6ZWRTdGF0ZTtmID0gYi5nZXREZXJpdmVkU3RhdGVGcm9tUHJvcHM7ImZ1bmN0aW9uIiA9PT0gdHlwZW9mIGYgJiYgKGtoKGEsIGIsIGYsIGMpLCBlLnN0YXRlID0gYS5tZW1vaXplZFN0YXRlKTsiZnVuY3Rpb24iID09PSB0eXBlb2YgYi5nZXREZXJpdmVkU3RhdGVGcm9tUHJvcHMgfHwgImZ1bmN0aW9uIiA9PT0gdHlwZW9mIGUuZ2V0U25hcHNob3RCZWZvcmVVcGRhdGUgfHwgImZ1bmN0aW9uIiAhPT0gdHlwZW9mIGUuVU5TQUZFX2NvbXBvbmVudFdpbGxNb3VudCAmJiAiZnVuY3Rpb24iICE9PSB0eXBlb2YgZS5jb21wb25lbnRXaWxsTW91bnQgfHwgKGIgPSBlLnN0YXRlLAogICAgICAgICAgICAiZnVuY3Rpb24iID09PSB0eXBlb2YgZS5jb21wb25lbnRXaWxsTW91bnQgJiYgZS5jb21wb25lbnRXaWxsTW91bnQoKSwgImZ1bmN0aW9uIiA9PT0gdHlwZW9mIGUuVU5TQUZFX2NvbXBvbmVudFdpbGxNb3VudCAmJiBlLlVOU0FGRV9jb21wb25lbnRXaWxsTW91bnQoKSwgYiAhPT0gZS5zdGF0ZSAmJiBuaC5lbnF1ZXVlUmVwbGFjZVN0YXRlKGUsIGUuc3RhdGUsIG51bGwpLCBnaChhLCBjLCBlLCBkKSwgZS5zdGF0ZSA9IGEubWVtb2l6ZWRTdGF0ZSk7ImZ1bmN0aW9uIiA9PT0gdHlwZW9mIGUuY29tcG9uZW50RGlkTW91bnQgJiYgKGEuZmxhZ3MgfD0gNDE5NDMwOCk7fQogICAgICAgICAgZnVuY3Rpb24gc2goYSwgYiwgYykge2EgPSBjLnJlZjtpZiAobnVsbCAhPT0gYSAmJiAiZnVuY3Rpb24iICE9PSB0eXBlb2YgYSAmJiAib2JqZWN0IiAhPT0gdHlwZW9mIGEpIHtpZiAoYy5fb3duZXIpIHtjID0gYy5fb3duZXI7aWYgKGMpIHtpZiAoMSAhPT0gYy50YWcpIHRocm93IEVycm9yKHAoMzA5KSk7dmFyIGQgPSBjLnN0YXRlTm9kZTt9aWYgKCFkKSB0aHJvdyBFcnJvcihwKDE0NywgYSkpO3ZhciBlID0gZCxmID0gIiIgKyBhO2lmIChudWxsICE9PSBiICYmIG51bGwgIT09IGIucmVmICYmICJmdW5jdGlvbiIgPT09IHR5cGVvZiBiLnJlZiAmJiBiLnJlZi5fc3RyaW5nUmVmID09PSBmKSByZXR1cm4gYi5yZWY7YiA9IGZ1bmN0aW9uIGIoYSkge3ZhciBiID0gZS5yZWZzO2IgPT09IGpoICYmIChiID0gZS5yZWZzID0ge30pO251bGwgPT09IGEgPyBkZWxldGUgYltmXSA6IGJbZl0gPSBhO307Yi5fc3RyaW5nUmVmID0gZjtyZXR1cm4gYjt9aWYgKCJzdHJpbmciICE9PSB0eXBlb2YgYSkgdGhyb3cgRXJyb3IocCgyODQpKTtpZiAoIWMuX293bmVyKSB0aHJvdyBFcnJvcihwKDI5MCwgYSkpO31yZXR1cm4gYTt9CiAgICAgICAgICBmdW5jdGlvbiB0aChhLCBiKSB7YSA9IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChiKTt0aHJvdyBFcnJvcihwKDMxLCAiW29iamVjdCBPYmplY3RdIiA9PT0gYSA/ICJvYmplY3Qgd2l0aCBrZXlzIHsiICsgT2JqZWN0LmtleXMoYikuam9pbigiLCAiKSArICJ9IiA6IGEpKTt9ZnVuY3Rpb24gdWgoYSkge3ZhciBiID0gYS5faW5pdDtyZXR1cm4gYihhLl9wYXlsb2FkKTt9CiAgICAgICAgICBmdW5jdGlvbiB2aChhKSB7ZnVuY3Rpb24gYihiLCBjKSB7aWYgKGEpIHt2YXIgZCA9IGIuZGVsZXRpb25zO251bGwgPT09IGQgPyAoYi5kZWxldGlvbnMgPSBbY10sIGIuZmxhZ3MgfD0gMTYpIDogZC5wdXNoKGMpO319ZnVuY3Rpb24gYyhjLCBkKSB7aWYgKCFhKSByZXR1cm4gbnVsbDtmb3IgKDsgbnVsbCAhPT0gZDspIHtiKGMsIGQpLCBkID0gZC5zaWJsaW5nO31yZXR1cm4gbnVsbDt9ZnVuY3Rpb24gZChhLCBiKSB7Zm9yIChhID0gbmV3IE1hcCgpOyBudWxsICE9PSBiOykge251bGwgIT09IGIua2V5ID8gYS5zZXQoYi5rZXksIGIpIDogYS5zZXQoYi5pbmRleCwgYiksIGIgPSBiLnNpYmxpbmc7fXJldHVybiBhO31mdW5jdGlvbiBlKGEsIGIpIHthID0gd2goYSwgYik7YS5pbmRleCA9IDA7YS5zaWJsaW5nID0gbnVsbDtyZXR1cm4gYTt9ZnVuY3Rpb24gZihiLCBjLCBkKSB7Yi5pbmRleCA9IGQ7aWYgKCFhKSByZXR1cm4gYi5mbGFncyB8PSAxMDQ4NTc2LCBjO2QgPSBiLmFsdGVybmF0ZTtpZiAobnVsbCAhPT0gZCkgcmV0dXJuIGQgPSBkLmluZGV4LCBkIDwgYyA/IChiLmZsYWdzIHw9IDIsIGMpIDogZDtiLmZsYWdzIHw9IDI7cmV0dXJuIGM7fWZ1bmN0aW9uIGcoYikge2EgJiYKICAgICAgICAgICAgICBudWxsID09PSBiLmFsdGVybmF0ZSAmJiAoYi5mbGFncyB8PSAyKTtyZXR1cm4gYjt9ZnVuY3Rpb24gaChhLCBiLCBjLCBkKSB7aWYgKG51bGwgPT09IGIgfHwgNiAhPT0gYi50YWcpIHJldHVybiBiID0geGgoYywgYS5tb2RlLCBkKSwgYi5yZXR1cm4gPSBhLCBiO2IgPSBlKGIsIGMpO2IucmV0dXJuID0gYTtyZXR1cm4gYjt9ZnVuY3Rpb24gayhhLCBiLCBjLCBkKSB7dmFyIGYgPSBjLnR5cGU7aWYgKGYgPT09IHlhKSByZXR1cm4gbShhLCBiLCBjLnByb3BzLmNoaWxkcmVuLCBkLCBjLmtleSk7aWYgKG51bGwgIT09IGIgJiYgKGIuZWxlbWVudFR5cGUgPT09IGYgfHwgIm9iamVjdCIgPT09IHR5cGVvZiBmICYmIG51bGwgIT09IGYgJiYgZi4kJHR5cGVvZiA9PT0gSGEgJiYgdWgoZikgPT09IGIudHlwZSkpIHJldHVybiBkID0gZShiLCBjLnByb3BzKSwgZC5yZWYgPSBzaChhLCBiLCBjKSwgZC5yZXR1cm4gPSBhLCBkO2QgPSB5aChjLnR5cGUsIGMua2V5LCBjLnByb3BzLCBudWxsLCBhLm1vZGUsIGQpO2QucmVmID0gc2goYSwgYiwgYyk7ZC5yZXR1cm4gPSBhO3JldHVybiBkO31mdW5jdGlvbiBsKGEsIGIsIGMsIGQpIHtpZiAobnVsbCA9PT0gYiB8fCA0ICE9PSBiLnRhZyB8fAogICAgICAgICAgICAgIGIuc3RhdGVOb2RlLmNvbnRhaW5lckluZm8gIT09IGMuY29udGFpbmVySW5mbyB8fCBiLnN0YXRlTm9kZS5pbXBsZW1lbnRhdGlvbiAhPT0gYy5pbXBsZW1lbnRhdGlvbikgcmV0dXJuIGIgPSB6aChjLCBhLm1vZGUsIGQpLCBiLnJldHVybiA9IGEsIGI7YiA9IGUoYiwgYy5jaGlsZHJlbiB8fCBbXSk7Yi5yZXR1cm4gPSBhO3JldHVybiBiO31mdW5jdGlvbiBtKGEsIGIsIGMsIGQsIGYpIHtpZiAobnVsbCA9PT0gYiB8fCA3ICE9PSBiLnRhZykgcmV0dXJuIGIgPSBBaChjLCBhLm1vZGUsIGQsIGYpLCBiLnJldHVybiA9IGEsIGI7YiA9IGUoYiwgYyk7Yi5yZXR1cm4gPSBhO3JldHVybiBiO31mdW5jdGlvbiBxKGEsIGIsIGMpIHtpZiAoInN0cmluZyIgPT09IHR5cGVvZiBiICYmICIiICE9PSBiIHx8ICJudW1iZXIiID09PSB0eXBlb2YgYikgcmV0dXJuIGIgPSB4aCgiIiArIGIsIGEubW9kZSwgYyksIGIucmV0dXJuID0gYSwgYjtpZiAoIm9iamVjdCIgPT09IHR5cGVvZiBiICYmIG51bGwgIT09IGIpIHtzd2l0Y2ggKGIuJCR0eXBlb2YpIHtjYXNlIHZhOnJldHVybiBjID0geWgoYi50eXBlLCBiLmtleSwgYi5wcm9wcywgbnVsbCwgYS5tb2RlLCBjKSwKICAgICAgICAgICAgICAgICAgICBjLnJlZiA9IHNoKGEsIG51bGwsIGIpLCBjLnJldHVybiA9IGEsIGM7Y2FzZSB3YTpyZXR1cm4gYiA9IHpoKGIsIGEubW9kZSwgYyksIGIucmV0dXJuID0gYSwgYjtjYXNlIEhhOnZhciBkID0gYi5faW5pdDtyZXR1cm4gcShhLCBkKGIuX3BheWxvYWQpLCBjKTt9aWYgKGViKGIpIHx8IEthKGIpKSByZXR1cm4gYiA9IEFoKGIsIGEubW9kZSwgYywgbnVsbCksIGIucmV0dXJuID0gYSwgYjt0aChhLCBiKTt9cmV0dXJuIG51bGw7fWZ1bmN0aW9uIHIoYSwgYiwgYywgZCkge3ZhciBlID0gbnVsbCAhPT0gYiA/IGIua2V5IDogbnVsbDtpZiAoInN0cmluZyIgPT09IHR5cGVvZiBjICYmICIiICE9PSBjIHx8ICJudW1iZXIiID09PSB0eXBlb2YgYykgcmV0dXJuIG51bGwgIT09IGUgPyBudWxsIDogaChhLCBiLCAiIiArIGMsIGQpO2lmICgib2JqZWN0IiA9PT0gdHlwZW9mIGMgJiYgbnVsbCAhPT0gYykge3N3aXRjaCAoYy4kJHR5cGVvZikge2Nhc2UgdmE6cmV0dXJuIGMua2V5ID09PSBlID8gayhhLCBiLCBjLCBkKSA6IG51bGw7Y2FzZSB3YTpyZXR1cm4gYy5rZXkgPT09IGUgPyBsKGEsIGIsIGMsIGQpIDogbnVsbDtjYXNlIEhhOnJldHVybiBlID0gYy5faW5pdCwgcihhLAogICAgICAgICAgICAgICAgICAgIGIsIGUoYy5fcGF5bG9hZCksIGQpO31pZiAoZWIoYykgfHwgS2EoYykpIHJldHVybiBudWxsICE9PSBlID8gbnVsbCA6IG0oYSwgYiwgYywgZCwgbnVsbCk7dGgoYSwgYyk7fXJldHVybiBudWxsO31mdW5jdGlvbiB5KGEsIGIsIGMsIGQsIGUpIHtpZiAoInN0cmluZyIgPT09IHR5cGVvZiBkICYmICIiICE9PSBkIHx8ICJudW1iZXIiID09PSB0eXBlb2YgZCkgcmV0dXJuIGEgPSBhLmdldChjKSB8fCBudWxsLCBoKGIsIGEsICIiICsgZCwgZSk7aWYgKCJvYmplY3QiID09PSB0eXBlb2YgZCAmJiBudWxsICE9PSBkKSB7c3dpdGNoIChkLiQkdHlwZW9mKSB7Y2FzZSB2YTpyZXR1cm4gYSA9IGEuZ2V0KG51bGwgPT09IGQua2V5ID8gYyA6IGQua2V5KSB8fCBudWxsLCBrKGIsIGEsIGQsIGUpO2Nhc2Ugd2E6cmV0dXJuIGEgPSBhLmdldChudWxsID09PSBkLmtleSA/IGMgOiBkLmtleSkgfHwgbnVsbCwgbChiLCBhLCBkLCBlKTtjYXNlIEhhOnZhciBmID0gZC5faW5pdDtyZXR1cm4geShhLCBiLCBjLCBmKGQuX3BheWxvYWQpLCBlKTt9aWYgKGViKGQpIHx8IEthKGQpKSByZXR1cm4gYSA9IGEuZ2V0KGMpIHx8IG51bGwsIG0oYiwgYSwgZCwgZSwgbnVsbCk7dGgoYiwgZCk7fXJldHVybiBudWxsO30KICAgICAgICAgICAgZnVuY3Rpb24gbihlLCBnLCBoLCBrKSB7Zm9yICh2YXIgbCA9IG51bGwsIG0gPSBudWxsLCB1ID0gZywgdyA9IGcgPSAwLCB4ID0gbnVsbDsgbnVsbCAhPT0gdSAmJiB3IDwgaC5sZW5ndGg7IHcrKykge3UuaW5kZXggPiB3ID8gKHggPSB1LCB1ID0gbnVsbCkgOiB4ID0gdS5zaWJsaW5nO3ZhciBuID0gcihlLCB1LCBoW3ddLCBrKTtpZiAobnVsbCA9PT0gbikge251bGwgPT09IHUgJiYgKHUgPSB4KTticmVhazt9YSAmJiB1ICYmIG51bGwgPT09IG4uYWx0ZXJuYXRlICYmIGIoZSwgdSk7ZyA9IGYobiwgZywgdyk7bnVsbCA9PT0gbSA/IGwgPSBuIDogbS5zaWJsaW5nID0gbjttID0gbjt1ID0geDt9aWYgKHcgPT09IGgubGVuZ3RoKSByZXR1cm4gYyhlLCB1KSwgSSAmJiB0ZyhlLCB3KSwgbDtpZiAobnVsbCA9PT0gdSkge2ZvciAoOyB3IDwgaC5sZW5ndGg7IHcrKykge3UgPSBxKGUsIGhbd10sIGspLCBudWxsICE9PSB1ICYmIChnID0gZih1LCBnLCB3KSwgbnVsbCA9PT0gbSA/IGwgPSB1IDogbS5zaWJsaW5nID0gdSwgbSA9IHUpO31JICYmIHRnKGUsIHcpO3JldHVybiBsO31mb3IgKHUgPSBkKGUsIHUpOyB3IDwgaC5sZW5ndGg7IHcrKykge3ggPSB5KHUsIGUsIHcsIGhbd10sIGspLCBudWxsICE9PSB4ICYmIChhICYmIG51bGwgIT09IHguYWx0ZXJuYXRlICYmIHUuZGVsZXRlKG51bGwgPT09CiAgICAgICAgICAgICAgICB4LmtleSA/IHcgOiB4LmtleSksIGcgPSBmKHgsIGcsIHcpLCBudWxsID09PSBtID8gbCA9IHggOiBtLnNpYmxpbmcgPSB4LCBtID0geCk7fWEgJiYgdS5mb3JFYWNoKGZ1bmN0aW9uIChhKSB7cmV0dXJuIGIoZSwgYSk7fSk7SSAmJiB0ZyhlLCB3KTtyZXR1cm4gbDt9ZnVuY3Rpb24gdChlLCBnLCBoLCBrKSB7dmFyIGwgPSBLYShoKTtpZiAoImZ1bmN0aW9uIiAhPT0gdHlwZW9mIGwpIHRocm93IEVycm9yKHAoMTUwKSk7aCA9IGwuY2FsbChoKTtpZiAobnVsbCA9PSBoKSB0aHJvdyBFcnJvcihwKDE1MSkpO2ZvciAodmFyIHUgPSBsID0gbnVsbCwgbSA9IGcsIHcgPSBnID0gMCwgeCA9IG51bGwsIG4gPSBoLm5leHQoKTsgbnVsbCAhPT0gbSAmJiAhbi5kb25lOyB3KyssIG4gPSBoLm5leHQoKSkge20uaW5kZXggPiB3ID8gKHggPSBtLCBtID0gbnVsbCkgOiB4ID0gbS5zaWJsaW5nO3ZhciB0ID0gcihlLCBtLCBuLnZhbHVlLCBrKTtpZiAobnVsbCA9PT0gdCkge251bGwgPT09IG0gJiYgKG0gPSB4KTticmVhazt9YSAmJiBtICYmIG51bGwgPT09IHQuYWx0ZXJuYXRlICYmIGIoZSwgbSk7ZyA9IGYodCwgZywgdyk7bnVsbCA9PT0gdSA/IGwgPSB0IDogdS5zaWJsaW5nID0gdDt1ID0gdDttID0geDt9aWYgKG4uZG9uZSkgcmV0dXJuIGMoZSwKICAgICAgICAgICAgICBtKSwgSSAmJiB0ZyhlLCB3KSwgbDtpZiAobnVsbCA9PT0gbSkge2ZvciAoOyAhbi5kb25lOyB3KyssIG4gPSBoLm5leHQoKSkge24gPSBxKGUsIG4udmFsdWUsIGspLCBudWxsICE9PSBuICYmIChnID0gZihuLCBnLCB3KSwgbnVsbCA9PT0gdSA/IGwgPSBuIDogdS5zaWJsaW5nID0gbiwgdSA9IG4pO31JICYmIHRnKGUsIHcpO3JldHVybiBsO31mb3IgKG0gPSBkKGUsIG0pOyAhbi5kb25lOyB3KyssIG4gPSBoLm5leHQoKSkge24gPSB5KG0sIGUsIHcsIG4udmFsdWUsIGspLCBudWxsICE9PSBuICYmIChhICYmIG51bGwgIT09IG4uYWx0ZXJuYXRlICYmIG0uZGVsZXRlKG51bGwgPT09IG4ua2V5ID8gdyA6IG4ua2V5KSwgZyA9IGYobiwgZywgdyksIG51bGwgPT09IHUgPyBsID0gbiA6IHUuc2libGluZyA9IG4sIHUgPSBuKTt9YSAmJiBtLmZvckVhY2goZnVuY3Rpb24gKGEpIHtyZXR1cm4gYihlLCBhKTt9KTtJICYmIHRnKGUsIHcpO3JldHVybiBsO31mdW5jdGlvbiBKKGEsIGQsIGYsIGgpIHsib2JqZWN0IiA9PT0gdHlwZW9mIGYgJiYgbnVsbCAhPT0gZiAmJiBmLnR5cGUgPT09IHlhICYmIG51bGwgPT09IGYua2V5ICYmIChmID0gZi5wcm9wcy5jaGlsZHJlbik7aWYgKCJvYmplY3QiID09PSB0eXBlb2YgZiAmJiBudWxsICE9PSBmKSB7c3dpdGNoIChmLiQkdHlwZW9mKSB7Y2FzZSB2YTphOiB7Zm9yICh2YXIgayA9CiAgICAgICAgICAgICAgICAgICAgICAgIGYua2V5LCBsID0gZDsgbnVsbCAhPT0gbDspIHtpZiAobC5rZXkgPT09IGspIHtrID0gZi50eXBlO2lmIChrID09PSB5YSkge2lmICg3ID09PSBsLnRhZykge2MoYSwgbC5zaWJsaW5nKTtkID0gZShsLCBmLnByb3BzLmNoaWxkcmVuKTtkLnJldHVybiA9IGE7YSA9IGQ7YnJlYWsgYTt9fSBlbHNlIGlmIChsLmVsZW1lbnRUeXBlID09PSBrIHx8ICJvYmplY3QiID09PSB0eXBlb2YgayAmJiBudWxsICE9PSBrICYmIGsuJCR0eXBlb2YgPT09IEhhICYmIHVoKGspID09PSBsLnR5cGUpIHtjKGEsIGwuc2libGluZyk7ZCA9IGUobCwgZi5wcm9wcyk7ZC5yZWYgPSBzaChhLCBsLCBmKTtkLnJldHVybiA9IGE7YSA9IGQ7YnJlYWsgYTt9YyhhLCBsKTticmVhazt9IGVsc2UgYihhLCBsKTtsID0gbC5zaWJsaW5nO31mLnR5cGUgPT09IHlhID8gKGQgPSBBaChmLnByb3BzLmNoaWxkcmVuLCBhLm1vZGUsIGgsIGYua2V5KSwgZC5yZXR1cm4gPSBhLCBhID0gZCkgOiAoaCA9IHloKGYudHlwZSwgZi5rZXksIGYucHJvcHMsIG51bGwsIGEubW9kZSwgaCksIGgucmVmID0gc2goYSwgZCwgZiksIGgucmV0dXJuID0gYSwgYSA9IGgpO31yZXR1cm4gZyhhKTtjYXNlIHdhOmE6IHtmb3IgKGwgPSBmLmtleTsgbnVsbCAhPT0KICAgICAgICAgICAgICAgICAgICAgIGQ7KSB7aWYgKGQua2V5ID09PSBsKSB7aWYgKDQgPT09IGQudGFnICYmIGQuc3RhdGVOb2RlLmNvbnRhaW5lckluZm8gPT09IGYuY29udGFpbmVySW5mbyAmJiBkLnN0YXRlTm9kZS5pbXBsZW1lbnRhdGlvbiA9PT0gZi5pbXBsZW1lbnRhdGlvbikge2MoYSwgZC5zaWJsaW5nKTtkID0gZShkLCBmLmNoaWxkcmVuIHx8IFtdKTtkLnJldHVybiA9IGE7YSA9IGQ7YnJlYWsgYTt9IGVsc2Uge2MoYSwgZCk7YnJlYWs7fX0gZWxzZSBiKGEsIGQpO2QgPSBkLnNpYmxpbmc7fWQgPSB6aChmLCBhLm1vZGUsIGgpO2QucmV0dXJuID0gYTthID0gZDt9cmV0dXJuIGcoYSk7Y2FzZSBIYTpyZXR1cm4gbCA9IGYuX2luaXQsIEooYSwgZCwgbChmLl9wYXlsb2FkKSwgaCk7fWlmIChlYihmKSkgcmV0dXJuIG4oYSwgZCwgZiwgaCk7aWYgKEthKGYpKSByZXR1cm4gdChhLCBkLCBmLCBoKTt0aChhLCBmKTt9cmV0dXJuICJzdHJpbmciID09PSB0eXBlb2YgZiAmJiAiIiAhPT0gZiB8fCAibnVtYmVyIiA9PT0gdHlwZW9mIGYgPyAoZiA9ICIiICsgZiwgbnVsbCAhPT0gZCAmJiA2ID09PSBkLnRhZyA/IChjKGEsIGQuc2libGluZyksIGQgPSBlKGQsIGYpLCBkLnJldHVybiA9IGEsIGEgPSBkKSA6ICgKICAgICAgICAgICAgICBjKGEsIGQpLCBkID0geGgoZiwgYS5tb2RlLCBoKSwgZC5yZXR1cm4gPSBhLCBhID0gZCksIGcoYSkpIDogYyhhLCBkKTt9cmV0dXJuIEo7fXZhciBCaCA9IHZoKCEwKSxDaCA9IHZoKCExKSxEaCA9IHt9LEVoID0gVWYoRGgpLEZoID0gVWYoRGgpLEdoID0gVWYoRGgpO2Z1bmN0aW9uIEhoKGEpIHtpZiAoYSA9PT0gRGgpIHRocm93IEVycm9yKHAoMTc0KSk7cmV0dXJuIGE7fWZ1bmN0aW9uIEloKGEsIGIpIHtHKEdoLCBiKTtHKEZoLCBhKTtHKEVoLCBEaCk7YSA9IGIubm9kZVR5cGU7c3dpdGNoIChhKSB7Y2FzZSA5OmNhc2UgMTE6YiA9IChiID0gYi5kb2N1bWVudEVsZW1lbnQpID8gYi5uYW1lc3BhY2VVUkkgOiBsYihudWxsLCAiIik7YnJlYWs7ZGVmYXVsdDphID0gOCA9PT0gYSA/IGIucGFyZW50Tm9kZSA6IGIsIGIgPSBhLm5hbWVzcGFjZVVSSSB8fCBudWxsLCBhID0gYS50YWdOYW1lLCBiID0gbGIoYiwgYSk7fUUoRWgpO0coRWgsIGIpO31mdW5jdGlvbiBKaCgpIHtFKEVoKTtFKEZoKTtFKEdoKTt9CiAgICAgICAgICBmdW5jdGlvbiBLaChhKSB7SGgoR2guY3VycmVudCk7dmFyIGIgPSBIaChFaC5jdXJyZW50KTt2YXIgYyA9IGxiKGIsIGEudHlwZSk7YiAhPT0gYyAmJiAoRyhGaCwgYSksIEcoRWgsIGMpKTt9ZnVuY3Rpb24gTGgoYSkge0ZoLmN1cnJlbnQgPT09IGEgJiYgKEUoRWgpLCBFKEZoKSk7fXZhciBNID0gVWYoMCk7CiAgICAgICAgICBmdW5jdGlvbiBNaChhKSB7Zm9yICh2YXIgYiA9IGE7IG51bGwgIT09IGI7KSB7aWYgKDEzID09PSBiLnRhZykge3ZhciBjID0gYi5tZW1vaXplZFN0YXRlO2lmIChudWxsICE9PSBjICYmIChjID0gYy5kZWh5ZHJhdGVkLCBudWxsID09PSBjIHx8ICIkPyIgPT09IGMuZGF0YSB8fCAiJCEiID09PSBjLmRhdGEpKSByZXR1cm4gYjt9IGVsc2UgaWYgKDE5ID09PSBiLnRhZyAmJiB2b2lkIDAgIT09IGIubWVtb2l6ZWRQcm9wcy5yZXZlYWxPcmRlcikge2lmICgwICE9PSAoYi5mbGFncyAmIDEyOCkpIHJldHVybiBiO30gZWxzZSBpZiAobnVsbCAhPT0gYi5jaGlsZCkge2IuY2hpbGQucmV0dXJuID0gYjtiID0gYi5jaGlsZDtjb250aW51ZTt9aWYgKGIgPT09IGEpIGJyZWFrO2ZvciAoOyBudWxsID09PSBiLnNpYmxpbmc7KSB7aWYgKG51bGwgPT09IGIucmV0dXJuIHx8IGIucmV0dXJuID09PSBhKSByZXR1cm4gbnVsbDtiID0gYi5yZXR1cm47fWIuc2libGluZy5yZXR1cm4gPSBiLnJldHVybjtiID0gYi5zaWJsaW5nO31yZXR1cm4gbnVsbDt9dmFyIE5oID0gW107CiAgICAgICAgICBmdW5jdGlvbiBPaCgpIHtmb3IgKHZhciBhID0gMDsgYSA8IE5oLmxlbmd0aDsgYSsrKSB7TmhbYV0uX3dvcmtJblByb2dyZXNzVmVyc2lvblByaW1hcnkgPSBudWxsO31OaC5sZW5ndGggPSAwO312YXIgUGggPSB1YS5SZWFjdEN1cnJlbnREaXNwYXRjaGVyLFFoID0gdWEuUmVhY3RDdXJyZW50QmF0Y2hDb25maWcsUmggPSAwLE4gPSBudWxsLE8gPSBudWxsLFAgPSBudWxsLFNoID0gITEsVGggPSAhMSxVaCA9IDAsVmggPSAwO2Z1bmN0aW9uIFEoKSB7dGhyb3cgRXJyb3IocCgzMjEpKTt9ZnVuY3Rpb24gV2goYSwgYikge2lmIChudWxsID09PSBiKSByZXR1cm4gITE7Zm9yICh2YXIgYyA9IDA7IGMgPCBiLmxlbmd0aCAmJiBjIDwgYS5sZW5ndGg7IGMrKykge2lmICghSGUoYVtjXSwgYltjXSkpIHJldHVybiAhMTt9cmV0dXJuICEwO30KICAgICAgICAgIGZ1bmN0aW9uIFhoKGEsIGIsIGMsIGQsIGUsIGYpIHtSaCA9IGY7TiA9IGI7Yi5tZW1vaXplZFN0YXRlID0gbnVsbDtiLnVwZGF0ZVF1ZXVlID0gbnVsbDtiLmxhbmVzID0gMDtQaC5jdXJyZW50ID0gbnVsbCA9PT0gYSB8fCBudWxsID09PSBhLm1lbW9pemVkU3RhdGUgPyBZaCA6IFpoO2EgPSBjKGQsIGUpO2lmIChUaCkge2YgPSAwO2RvIHtUaCA9ICExO1VoID0gMDtpZiAoMjUgPD0gZikgdGhyb3cgRXJyb3IocCgzMDEpKTtmICs9IDE7UCA9IE8gPSBudWxsO2IudXBkYXRlUXVldWUgPSBudWxsO1BoLmN1cnJlbnQgPSAkaDthID0gYyhkLCBlKTt9IHdoaWxlIChUaCk7fVBoLmN1cnJlbnQgPSBhaTtiID0gbnVsbCAhPT0gTyAmJiBudWxsICE9PSBPLm5leHQ7UmggPSAwO1AgPSBPID0gTiA9IG51bGw7U2ggPSAhMTtpZiAoYikgdGhyb3cgRXJyb3IocCgzMDApKTtyZXR1cm4gYTt9ZnVuY3Rpb24gYmkoKSB7dmFyIGEgPSAwICE9PSBVaDtVaCA9IDA7cmV0dXJuIGE7fQogICAgICAgICAgZnVuY3Rpb24gY2koKSB7dmFyIGEgPSB7IG1lbW9pemVkU3RhdGU6IG51bGwsIGJhc2VTdGF0ZTogbnVsbCwgYmFzZVF1ZXVlOiBudWxsLCBxdWV1ZTogbnVsbCwgbmV4dDogbnVsbCB9O251bGwgPT09IFAgPyBOLm1lbW9pemVkU3RhdGUgPSBQID0gYSA6IFAgPSBQLm5leHQgPSBhO3JldHVybiBQO31mdW5jdGlvbiBkaSgpIHtpZiAobnVsbCA9PT0gTykge3ZhciBhID0gTi5hbHRlcm5hdGU7YSA9IG51bGwgIT09IGEgPyBhLm1lbW9pemVkU3RhdGUgOiBudWxsO30gZWxzZSBhID0gTy5uZXh0O3ZhciBiID0gbnVsbCA9PT0gUCA/IE4ubWVtb2l6ZWRTdGF0ZSA6IFAubmV4dDtpZiAobnVsbCAhPT0gYikgUCA9IGIsIE8gPSBhO2Vsc2Uge2lmIChudWxsID09PSBhKSB0aHJvdyBFcnJvcihwKDMxMCkpO08gPSBhO2EgPSB7IG1lbW9pemVkU3RhdGU6IE8ubWVtb2l6ZWRTdGF0ZSwgYmFzZVN0YXRlOiBPLmJhc2VTdGF0ZSwgYmFzZVF1ZXVlOiBPLmJhc2VRdWV1ZSwgcXVldWU6IE8ucXVldWUsIG5leHQ6IG51bGwgfTtudWxsID09PSBQID8gTi5tZW1vaXplZFN0YXRlID0gUCA9IGEgOiBQID0gUC5uZXh0ID0gYTt9cmV0dXJuIFA7fQogICAgICAgICAgZnVuY3Rpb24gZWkoYSwgYikge3JldHVybiAiZnVuY3Rpb24iID09PSB0eXBlb2YgYiA/IGIoYSkgOiBiO30KICAgICAgICAgIGZ1bmN0aW9uIGZpKGEpIHt2YXIgYiA9IGRpKCksYyA9IGIucXVldWU7aWYgKG51bGwgPT09IGMpIHRocm93IEVycm9yKHAoMzExKSk7Yy5sYXN0UmVuZGVyZWRSZWR1Y2VyID0gYTt2YXIgZCA9IE8sZSA9IGQuYmFzZVF1ZXVlLGYgPSBjLnBlbmRpbmc7aWYgKG51bGwgIT09IGYpIHtpZiAobnVsbCAhPT0gZSkge3ZhciBnID0gZS5uZXh0O2UubmV4dCA9IGYubmV4dDtmLm5leHQgPSBnO31kLmJhc2VRdWV1ZSA9IGUgPSBmO2MucGVuZGluZyA9IG51bGw7fWlmIChudWxsICE9PSBlKSB7ZiA9IGUubmV4dDtkID0gZC5iYXNlU3RhdGU7dmFyIGggPSBnID0gbnVsbCxrID0gbnVsbCxsID0gZjtkbyB7dmFyIG0gPSBsLmxhbmU7aWYgKChSaCAmIG0pID09PSBtKSBudWxsICE9PSBrICYmIChrID0gay5uZXh0ID0geyBsYW5lOiAwLCBhY3Rpb246IGwuYWN0aW9uLCBoYXNFYWdlclN0YXRlOiBsLmhhc0VhZ2VyU3RhdGUsIGVhZ2VyU3RhdGU6IGwuZWFnZXJTdGF0ZSwgbmV4dDogbnVsbCB9KSwgZCA9IGwuaGFzRWFnZXJTdGF0ZSA/IGwuZWFnZXJTdGF0ZSA6IGEoZCwgbC5hY3Rpb24pO2Vsc2Uge3ZhciBxID0geyBsYW5lOiBtLCBhY3Rpb246IGwuYWN0aW9uLCBoYXNFYWdlclN0YXRlOiBsLmhhc0VhZ2VyU3RhdGUsCiAgICAgICAgICAgICAgICAgICAgZWFnZXJTdGF0ZTogbC5lYWdlclN0YXRlLCBuZXh0OiBudWxsIH07bnVsbCA9PT0gayA/IChoID0gayA9IHEsIGcgPSBkKSA6IGsgPSBrLm5leHQgPSBxO04ubGFuZXMgfD0gbTtoaCB8PSBtO31sID0gbC5uZXh0O30gd2hpbGUgKG51bGwgIT09IGwgJiYgbCAhPT0gZik7bnVsbCA9PT0gayA/IGcgPSBkIDogay5uZXh0ID0gaDtIZShkLCBiLm1lbW9pemVkU3RhdGUpIHx8IChVZyA9ICEwKTtiLm1lbW9pemVkU3RhdGUgPSBkO2IuYmFzZVN0YXRlID0gZztiLmJhc2VRdWV1ZSA9IGs7Yy5sYXN0UmVuZGVyZWRTdGF0ZSA9IGQ7fWEgPSBjLmludGVybGVhdmVkO2lmIChudWxsICE9PSBhKSB7ZSA9IGE7ZG8ge2YgPSBlLmxhbmUsIE4ubGFuZXMgfD0gZiwgaGggfD0gZiwgZSA9IGUubmV4dDt9IHdoaWxlIChlICE9PSBhKTt9IGVsc2UgbnVsbCA9PT0gZSAmJiAoYy5sYW5lcyA9IDApO3JldHVybiBbYi5tZW1vaXplZFN0YXRlLCBjLmRpc3BhdGNoXTt9CiAgICAgICAgICBmdW5jdGlvbiBnaShhKSB7dmFyIGIgPSBkaSgpLGMgPSBiLnF1ZXVlO2lmIChudWxsID09PSBjKSB0aHJvdyBFcnJvcihwKDMxMSkpO2MubGFzdFJlbmRlcmVkUmVkdWNlciA9IGE7dmFyIGQgPSBjLmRpc3BhdGNoLGUgPSBjLnBlbmRpbmcsZiA9IGIubWVtb2l6ZWRTdGF0ZTtpZiAobnVsbCAhPT0gZSkge2MucGVuZGluZyA9IG51bGw7dmFyIGcgPSBlID0gZS5uZXh0O2RvIHtmID0gYShmLCBnLmFjdGlvbiksIGcgPSBnLm5leHQ7fSB3aGlsZSAoZyAhPT0gZSk7SGUoZiwgYi5tZW1vaXplZFN0YXRlKSB8fCAoVWcgPSAhMCk7Yi5tZW1vaXplZFN0YXRlID0gZjtudWxsID09PSBiLmJhc2VRdWV1ZSAmJiAoYi5iYXNlU3RhdGUgPSBmKTtjLmxhc3RSZW5kZXJlZFN0YXRlID0gZjt9cmV0dXJuIFtmLCBkXTt9ZnVuY3Rpb24gaGkoKSB7fQogICAgICAgICAgZnVuY3Rpb24gaWkoYSwgYikge3ZhciBjID0gTixkID0gZGkoKSxlID0gYigpLGYgPSAhSGUoZC5tZW1vaXplZFN0YXRlLCBlKTtmICYmIChkLm1lbW9pemVkU3RhdGUgPSBlLCBVZyA9ICEwKTtkID0gZC5xdWV1ZTtqaShraS5iaW5kKG51bGwsIGMsIGQsIGEpLCBbYV0pO2lmIChkLmdldFNuYXBzaG90ICE9PSBiIHx8IGYgfHwgbnVsbCAhPT0gUCAmJiBQLm1lbW9pemVkU3RhdGUudGFnICYgMSkge2MuZmxhZ3MgfD0gMjA0ODtsaSg5LCBtaS5iaW5kKG51bGwsIGMsIGQsIGUsIGIpLCB2b2lkIDAsIG51bGwpO2lmIChudWxsID09PSBSKSB0aHJvdyBFcnJvcihwKDM0OSkpOzAgIT09IChSaCAmIDMwKSB8fCBuaShjLCBiLCBlKTt9cmV0dXJuIGU7fWZ1bmN0aW9uIG5pKGEsIGIsIGMpIHthLmZsYWdzIHw9IDE2Mzg0O2EgPSB7IGdldFNuYXBzaG90OiBiLCB2YWx1ZTogYyB9O2IgPSBOLnVwZGF0ZVF1ZXVlO251bGwgPT09IGIgPyAoYiA9IHsgbGFzdEVmZmVjdDogbnVsbCwgc3RvcmVzOiBudWxsIH0sIE4udXBkYXRlUXVldWUgPSBiLCBiLnN0b3JlcyA9IFthXSkgOiAoYyA9IGIuc3RvcmVzLCBudWxsID09PSBjID8gYi5zdG9yZXMgPSBbYV0gOiBjLnB1c2goYSkpO30KICAgICAgICAgIGZ1bmN0aW9uIG1pKGEsIGIsIGMsIGQpIHtiLnZhbHVlID0gYztiLmdldFNuYXBzaG90ID0gZDtvaShiKSAmJiBwaShhKTt9ZnVuY3Rpb24ga2koYSwgYiwgYykge3JldHVybiBjKGZ1bmN0aW9uICgpIHtvaShiKSAmJiBwaShhKTt9KTt9ZnVuY3Rpb24gb2koYSkge3ZhciBiID0gYS5nZXRTbmFwc2hvdDthID0gYS52YWx1ZTt0cnkge3ZhciBjID0gYigpO3JldHVybiAhSGUoYSwgYyk7fSBjYXRjaCAoZCkge3JldHVybiAhMDt9fWZ1bmN0aW9uIHBpKGEpIHt2YXIgYiA9IFpnKGEsIDEpO251bGwgIT09IGIgJiYgbWgoYiwgYSwgMSwgLTEpO30KICAgICAgICAgIGZ1bmN0aW9uIHFpKGEpIHt2YXIgYiA9IGNpKCk7ImZ1bmN0aW9uIiA9PT0gdHlwZW9mIGEgJiYgKGEgPSBhKCkpO2IubWVtb2l6ZWRTdGF0ZSA9IGIuYmFzZVN0YXRlID0gYTthID0geyBwZW5kaW5nOiBudWxsLCBpbnRlcmxlYXZlZDogbnVsbCwgbGFuZXM6IDAsIGRpc3BhdGNoOiBudWxsLCBsYXN0UmVuZGVyZWRSZWR1Y2VyOiBlaSwgbGFzdFJlbmRlcmVkU3RhdGU6IGEgfTtiLnF1ZXVlID0gYTthID0gYS5kaXNwYXRjaCA9IHJpLmJpbmQobnVsbCwgTiwgYSk7cmV0dXJuIFtiLm1lbW9pemVkU3RhdGUsIGFdO30KICAgICAgICAgIGZ1bmN0aW9uIGxpKGEsIGIsIGMsIGQpIHthID0geyB0YWc6IGEsIGNyZWF0ZTogYiwgZGVzdHJveTogYywgZGVwczogZCwgbmV4dDogbnVsbCB9O2IgPSBOLnVwZGF0ZVF1ZXVlO251bGwgPT09IGIgPyAoYiA9IHsgbGFzdEVmZmVjdDogbnVsbCwgc3RvcmVzOiBudWxsIH0sIE4udXBkYXRlUXVldWUgPSBiLCBiLmxhc3RFZmZlY3QgPSBhLm5leHQgPSBhKSA6IChjID0gYi5sYXN0RWZmZWN0LCBudWxsID09PSBjID8gYi5sYXN0RWZmZWN0ID0gYS5uZXh0ID0gYSA6IChkID0gYy5uZXh0LCBjLm5leHQgPSBhLCBhLm5leHQgPSBkLCBiLmxhc3RFZmZlY3QgPSBhKSk7cmV0dXJuIGE7fWZ1bmN0aW9uIHNpKCkge3JldHVybiBkaSgpLm1lbW9pemVkU3RhdGU7fWZ1bmN0aW9uIHRpKGEsIGIsIGMsIGQpIHt2YXIgZSA9IGNpKCk7Ti5mbGFncyB8PSBhO2UubWVtb2l6ZWRTdGF0ZSA9IGxpKDEgfCBiLCBjLCB2b2lkIDAsIHZvaWQgMCA9PT0gZCA/IG51bGwgOiBkKTt9CiAgICAgICAgICBmdW5jdGlvbiB1aShhLCBiLCBjLCBkKSB7dmFyIGUgPSBkaSgpO2QgPSB2b2lkIDAgPT09IGQgPyBudWxsIDogZDt2YXIgZiA9IHZvaWQgMDtpZiAobnVsbCAhPT0gTykge3ZhciBnID0gTy5tZW1vaXplZFN0YXRlO2YgPSBnLmRlc3Ryb3k7aWYgKG51bGwgIT09IGQgJiYgV2goZCwgZy5kZXBzKSkge2UubWVtb2l6ZWRTdGF0ZSA9IGxpKGIsIGMsIGYsIGQpO3JldHVybjt9fU4uZmxhZ3MgfD0gYTtlLm1lbW9pemVkU3RhdGUgPSBsaSgxIHwgYiwgYywgZiwgZCk7fWZ1bmN0aW9uIHZpKGEsIGIpIHtyZXR1cm4gdGkoODM5MDY1NiwgOCwgYSwgYik7fWZ1bmN0aW9uIGppKGEsIGIpIHtyZXR1cm4gdWkoMjA0OCwgOCwgYSwgYik7fWZ1bmN0aW9uIHdpKGEsIGIpIHtyZXR1cm4gdWkoNCwgMiwgYSwgYik7fWZ1bmN0aW9uIHhpKGEsIGIpIHtyZXR1cm4gdWkoNCwgNCwgYSwgYik7fQogICAgICAgICAgZnVuY3Rpb24geWkoYSwgYikge2lmICgiZnVuY3Rpb24iID09PSB0eXBlb2YgYikgcmV0dXJuIGEgPSBhKCksIGIoYSksIGZ1bmN0aW9uICgpIHtiKG51bGwpO307aWYgKG51bGwgIT09IGIgJiYgdm9pZCAwICE9PSBiKSByZXR1cm4gYSA9IGEoKSwgYi5jdXJyZW50ID0gYSwgZnVuY3Rpb24gKCkge2IuY3VycmVudCA9IG51bGw7fTt9ZnVuY3Rpb24gemkoYSwgYiwgYykge2MgPSBudWxsICE9PSBjICYmIHZvaWQgMCAhPT0gYyA/IGMuY29uY2F0KFthXSkgOiBudWxsO3JldHVybiB1aSg0LCA0LCB5aS5iaW5kKG51bGwsIGIsIGEpLCBjKTt9ZnVuY3Rpb24gQWkoKSB7fWZ1bmN0aW9uIEJpKGEsIGIpIHt2YXIgYyA9IGRpKCk7YiA9IHZvaWQgMCA9PT0gYiA/IG51bGwgOiBiO3ZhciBkID0gYy5tZW1vaXplZFN0YXRlO2lmIChudWxsICE9PSBkICYmIG51bGwgIT09IGIgJiYgV2goYiwgZFsxXSkpIHJldHVybiBkWzBdO2MubWVtb2l6ZWRTdGF0ZSA9IFthLCBiXTtyZXR1cm4gYTt9CiAgICAgICAgICBmdW5jdGlvbiBDaShhLCBiKSB7dmFyIGMgPSBkaSgpO2IgPSB2b2lkIDAgPT09IGIgPyBudWxsIDogYjt2YXIgZCA9IGMubWVtb2l6ZWRTdGF0ZTtpZiAobnVsbCAhPT0gZCAmJiBudWxsICE9PSBiICYmIFdoKGIsIGRbMV0pKSByZXR1cm4gZFswXTthID0gYSgpO2MubWVtb2l6ZWRTdGF0ZSA9IFthLCBiXTtyZXR1cm4gYTt9ZnVuY3Rpb24gRGkoYSwgYiwgYykge2lmICgwID09PSAoUmggJiAyMSkpIHJldHVybiBhLmJhc2VTdGF0ZSAmJiAoYS5iYXNlU3RhdGUgPSAhMSwgVWcgPSAhMCksIGEubWVtb2l6ZWRTdGF0ZSA9IGM7SGUoYywgYikgfHwgKGMgPSB5YygpLCBOLmxhbmVzIHw9IGMsIGhoIHw9IGMsIGEuYmFzZVN0YXRlID0gITApO3JldHVybiBiO31mdW5jdGlvbiBFaShhLCBiKSB7dmFyIGMgPSBDO0MgPSAwICE9PSBjICYmIDQgPiBjID8gYyA6IDQ7YSghMCk7dmFyIGQgPSBRaC50cmFuc2l0aW9uO1FoLnRyYW5zaXRpb24gPSB7fTt0cnkge2EoITEpLCBiKCk7fSBmaW5hbGx5IHtDID0gYywgUWgudHJhbnNpdGlvbiA9IGQ7fX1mdW5jdGlvbiBGaSgpIHtyZXR1cm4gZGkoKS5tZW1vaXplZFN0YXRlO30KICAgICAgICAgIGZ1bmN0aW9uIEdpKGEsIGIsIGMpIHt2YXIgZCA9IGxoKGEpO2MgPSB7IGxhbmU6IGQsIGFjdGlvbjogYywgaGFzRWFnZXJTdGF0ZTogITEsIGVhZ2VyU3RhdGU6IG51bGwsIG5leHQ6IG51bGwgfTtpZiAoSGkoYSkpIElpKGIsIGMpO2Vsc2UgaWYgKGMgPSBZZyhhLCBiLCBjLCBkKSwgbnVsbCAhPT0gYykge3ZhciBlID0gTCgpO21oKGMsIGEsIGQsIGUpO0ppKGMsIGIsIGQpO319CiAgICAgICAgICBmdW5jdGlvbiByaShhLCBiLCBjKSB7dmFyIGQgPSBsaChhKSxlID0geyBsYW5lOiBkLCBhY3Rpb246IGMsIGhhc0VhZ2VyU3RhdGU6ICExLCBlYWdlclN0YXRlOiBudWxsLCBuZXh0OiBudWxsIH07aWYgKEhpKGEpKSBJaShiLCBlKTtlbHNlIHt2YXIgZiA9IGEuYWx0ZXJuYXRlO2lmICgwID09PSBhLmxhbmVzICYmIChudWxsID09PSBmIHx8IDAgPT09IGYubGFuZXMpICYmIChmID0gYi5sYXN0UmVuZGVyZWRSZWR1Y2VyLCBudWxsICE9PSBmKSkgdHJ5IHt2YXIgZyA9IGIubGFzdFJlbmRlcmVkU3RhdGUsaCA9IGYoZywgYyk7ZS5oYXNFYWdlclN0YXRlID0gITA7ZS5lYWdlclN0YXRlID0gaDtpZiAoSGUoaCwgZykpIHt2YXIgayA9IGIuaW50ZXJsZWF2ZWQ7bnVsbCA9PT0gayA/IChlLm5leHQgPSBlLCBYZyhiKSkgOiAoZS5uZXh0ID0gay5uZXh0LCBrLm5leHQgPSBlKTtiLmludGVybGVhdmVkID0gZTtyZXR1cm47fX0gY2F0Y2ggKGwpIHt9IGZpbmFsbHkge31jID0gWWcoYSwgYiwgZSwgZCk7bnVsbCAhPT0gYyAmJiAoZSA9IEwoKSwgbWgoYywgYSwgZCwgZSksIEppKGMsIGIsIGQpKTt9fQogICAgICAgICAgZnVuY3Rpb24gSGkoYSkge3ZhciBiID0gYS5hbHRlcm5hdGU7cmV0dXJuIGEgPT09IE4gfHwgbnVsbCAhPT0gYiAmJiBiID09PSBOO31mdW5jdGlvbiBJaShhLCBiKSB7VGggPSBTaCA9ICEwO3ZhciBjID0gYS5wZW5kaW5nO251bGwgPT09IGMgPyBiLm5leHQgPSBiIDogKGIubmV4dCA9IGMubmV4dCwgYy5uZXh0ID0gYik7YS5wZW5kaW5nID0gYjt9ZnVuY3Rpb24gSmkoYSwgYiwgYykge2lmICgwICE9PSAoYyAmIDQxOTQyNDApKSB7dmFyIGQgPSBiLmxhbmVzO2QgJj0gYS5wZW5kaW5nTGFuZXM7YyB8PSBkO2IubGFuZXMgPSBjO0NjKGEsIGMpO319CiAgICAgICAgICB2YXIgYWkgPSB7IHJlYWRDb250ZXh0OiBWZywgdXNlQ2FsbGJhY2s6IFEsIHVzZUNvbnRleHQ6IFEsIHVzZUVmZmVjdDogUSwgdXNlSW1wZXJhdGl2ZUhhbmRsZTogUSwgdXNlSW5zZXJ0aW9uRWZmZWN0OiBRLCB1c2VMYXlvdXRFZmZlY3Q6IFEsIHVzZU1lbW86IFEsIHVzZVJlZHVjZXI6IFEsIHVzZVJlZjogUSwgdXNlU3RhdGU6IFEsIHVzZURlYnVnVmFsdWU6IFEsIHVzZURlZmVycmVkVmFsdWU6IFEsIHVzZVRyYW5zaXRpb246IFEsIHVzZU11dGFibGVTb3VyY2U6IFEsIHVzZVN5bmNFeHRlcm5hbFN0b3JlOiBRLCB1c2VJZDogUSwgdW5zdGFibGVfaXNOZXdSZWNvbmNpbGVyOiAhMSB9LFloID0geyByZWFkQ29udGV4dDogVmcsIHVzZUNhbGxiYWNrOiBmdW5jdGlvbiB1c2VDYWxsYmFjayhhLCBiKSB7Y2koKS5tZW1vaXplZFN0YXRlID0gW2EsIHZvaWQgMCA9PT0gYiA/IG51bGwgOiBiXTtyZXR1cm4gYTt9LCB1c2VDb250ZXh0OiBWZywgdXNlRWZmZWN0OiB2aSwgdXNlSW1wZXJhdGl2ZUhhbmRsZTogZnVuY3Rpb24gdXNlSW1wZXJhdGl2ZUhhbmRsZShhLCBiLCBjKSB7YyA9IG51bGwgIT09IGMgJiYgdm9pZCAwICE9PSBjID8gYy5jb25jYXQoW2FdKSA6IG51bGw7cmV0dXJuIHRpKDQxOTQzMDgsCiAgICAgICAgICAgICAgICA0LCB5aS5iaW5kKG51bGwsIGIsIGEpLCBjKTt9LCB1c2VMYXlvdXRFZmZlY3Q6IGZ1bmN0aW9uIHVzZUxheW91dEVmZmVjdChhLCBiKSB7cmV0dXJuIHRpKDQxOTQzMDgsIDQsIGEsIGIpO30sIHVzZUluc2VydGlvbkVmZmVjdDogZnVuY3Rpb24gdXNlSW5zZXJ0aW9uRWZmZWN0KGEsIGIpIHtyZXR1cm4gdGkoNCwgMiwgYSwgYik7fSwgdXNlTWVtbzogZnVuY3Rpb24gdXNlTWVtbyhhLCBiKSB7dmFyIGMgPSBjaSgpO2IgPSB2b2lkIDAgPT09IGIgPyBudWxsIDogYjthID0gYSgpO2MubWVtb2l6ZWRTdGF0ZSA9IFthLCBiXTtyZXR1cm4gYTt9LCB1c2VSZWR1Y2VyOiBmdW5jdGlvbiB1c2VSZWR1Y2VyKGEsIGIsIGMpIHt2YXIgZCA9IGNpKCk7YiA9IHZvaWQgMCAhPT0gYyA/IGMoYikgOiBiO2QubWVtb2l6ZWRTdGF0ZSA9IGQuYmFzZVN0YXRlID0gYjthID0geyBwZW5kaW5nOiBudWxsLCBpbnRlcmxlYXZlZDogbnVsbCwgbGFuZXM6IDAsIGRpc3BhdGNoOiBudWxsLCBsYXN0UmVuZGVyZWRSZWR1Y2VyOiBhLCBsYXN0UmVuZGVyZWRTdGF0ZTogYiB9O2QucXVldWUgPSBhO2EgPSBhLmRpc3BhdGNoID0gR2kuYmluZChudWxsLCBOLCBhKTtyZXR1cm4gW2QubWVtb2l6ZWRTdGF0ZSwgYV07fSwgdXNlUmVmOiBmdW5jdGlvbiB1c2VSZWYoYSkge3ZhciBiID0KICAgICAgICAgICAgICAgIGNpKCk7YSA9IHsgY3VycmVudDogYSB9O3JldHVybiBiLm1lbW9pemVkU3RhdGUgPSBhO30sIHVzZVN0YXRlOiBxaSwgdXNlRGVidWdWYWx1ZTogQWksIHVzZURlZmVycmVkVmFsdWU6IGZ1bmN0aW9uIHVzZURlZmVycmVkVmFsdWUoYSkge3JldHVybiBjaSgpLm1lbW9pemVkU3RhdGUgPSBhO30sIHVzZVRyYW5zaXRpb246IGZ1bmN0aW9uIHVzZVRyYW5zaXRpb24oKSB7dmFyIGEgPSBxaSghMSksYiA9IGFbMF07YSA9IEVpLmJpbmQobnVsbCwgYVsxXSk7Y2koKS5tZW1vaXplZFN0YXRlID0gYTtyZXR1cm4gW2IsIGFdO30sIHVzZU11dGFibGVTb3VyY2U6IGZ1bmN0aW9uIHVzZU11dGFibGVTb3VyY2UoKSB7fSwgdXNlU3luY0V4dGVybmFsU3RvcmU6IGZ1bmN0aW9uIHVzZVN5bmNFeHRlcm5hbFN0b3JlKGEsIGIsIGMpIHt2YXIgZCA9IE4sZSA9IGNpKCk7aWYgKEkpIHtpZiAodm9pZCAwID09PSBjKSB0aHJvdyBFcnJvcihwKDQwNykpO2MgPSBjKCk7fSBlbHNlIHtjID0gYigpO2lmIChudWxsID09PSBSKSB0aHJvdyBFcnJvcihwKDM0OSkpOzAgIT09IChSaCAmIDMwKSB8fCBuaShkLCBiLCBjKTt9ZS5tZW1vaXplZFN0YXRlID0gYzt2YXIgZiA9IHsgdmFsdWU6IGMsIGdldFNuYXBzaG90OiBiIH07ZS5xdWV1ZSA9IGY7dmkoa2kuYmluZChudWxsLCBkLAogICAgICAgICAgICAgICAgZiwgYSksIFthXSk7ZC5mbGFncyB8PSAyMDQ4O2xpKDksIG1pLmJpbmQobnVsbCwgZCwgZiwgYywgYiksIHZvaWQgMCwgbnVsbCk7cmV0dXJuIGM7fSwgdXNlSWQ6IGZ1bmN0aW9uIHVzZUlkKCkge3ZhciBhID0gY2koKSxiID0gUi5pZGVudGlmaWVyUHJlZml4O2lmIChJKSB7dmFyIGMgPSBzZzt2YXIgZCA9IHJnO2MgPSAoZCAmIH4oMSA8PCAzMiAtIG9jKGQpIC0gMSkpLnRvU3RyaW5nKDMyKSArIGM7YiA9ICI6IiArIGIgKyAiUiIgKyBjO2MgPSBVaCsrOzAgPCBjICYmIChiICs9ICJIIiArIGMudG9TdHJpbmcoMzIpKTtiICs9ICI6Ijt9IGVsc2UgYyA9IFZoKyssIGIgPSAiOiIgKyBiICsgInIiICsgYy50b1N0cmluZygzMikgKyAiOiI7cmV0dXJuIGEubWVtb2l6ZWRTdGF0ZSA9IGI7fSwgdW5zdGFibGVfaXNOZXdSZWNvbmNpbGVyOiAhMSB9LFpoID0geyByZWFkQ29udGV4dDogVmcsIHVzZUNhbGxiYWNrOiBCaSwgdXNlQ29udGV4dDogVmcsIHVzZUVmZmVjdDogamksIHVzZUltcGVyYXRpdmVIYW5kbGU6IHppLCB1c2VJbnNlcnRpb25FZmZlY3Q6IHdpLCB1c2VMYXlvdXRFZmZlY3Q6IHhpLCB1c2VNZW1vOiBDaSwgdXNlUmVkdWNlcjogZmksIHVzZVJlZjogc2ksIHVzZVN0YXRlOiBmdW5jdGlvbiB1c2VTdGF0ZSgpIHtyZXR1cm4gZmkoZWkpO30sCiAgICAgICAgICAgICAgdXNlRGVidWdWYWx1ZTogQWksIHVzZURlZmVycmVkVmFsdWU6IGZ1bmN0aW9uIHVzZURlZmVycmVkVmFsdWUoYSkge3ZhciBiID0gZGkoKTtyZXR1cm4gRGkoYiwgTy5tZW1vaXplZFN0YXRlLCBhKTt9LCB1c2VUcmFuc2l0aW9uOiBmdW5jdGlvbiB1c2VUcmFuc2l0aW9uKCkge3ZhciBhID0gZmkoZWkpWzBdLGIgPSBkaSgpLm1lbW9pemVkU3RhdGU7cmV0dXJuIFthLCBiXTt9LCB1c2VNdXRhYmxlU291cmNlOiBoaSwgdXNlU3luY0V4dGVybmFsU3RvcmU6IGlpLCB1c2VJZDogRmksIHVuc3RhYmxlX2lzTmV3UmVjb25jaWxlcjogITEgfSwkaCA9IHsgcmVhZENvbnRleHQ6IFZnLCB1c2VDYWxsYmFjazogQmksIHVzZUNvbnRleHQ6IFZnLCB1c2VFZmZlY3Q6IGppLCB1c2VJbXBlcmF0aXZlSGFuZGxlOiB6aSwgdXNlSW5zZXJ0aW9uRWZmZWN0OiB3aSwgdXNlTGF5b3V0RWZmZWN0OiB4aSwgdXNlTWVtbzogQ2ksIHVzZVJlZHVjZXI6IGdpLCB1c2VSZWY6IHNpLCB1c2VTdGF0ZTogZnVuY3Rpb24gdXNlU3RhdGUoKSB7cmV0dXJuIGdpKGVpKTt9LCB1c2VEZWJ1Z1ZhbHVlOiBBaSwgdXNlRGVmZXJyZWRWYWx1ZTogZnVuY3Rpb24gdXNlRGVmZXJyZWRWYWx1ZShhKSB7dmFyIGIgPSBkaSgpO3JldHVybiBudWxsID09PQogICAgICAgICAgICAgICAgTyA/IGIubWVtb2l6ZWRTdGF0ZSA9IGEgOiBEaShiLCBPLm1lbW9pemVkU3RhdGUsIGEpO30sIHVzZVRyYW5zaXRpb246IGZ1bmN0aW9uIHVzZVRyYW5zaXRpb24oKSB7dmFyIGEgPSBnaShlaSlbMF0sYiA9IGRpKCkubWVtb2l6ZWRTdGF0ZTtyZXR1cm4gW2EsIGJdO30sIHVzZU11dGFibGVTb3VyY2U6IGhpLCB1c2VTeW5jRXh0ZXJuYWxTdG9yZTogaWksIHVzZUlkOiBGaSwgdW5zdGFibGVfaXNOZXdSZWNvbmNpbGVyOiAhMSB9O2Z1bmN0aW9uIEtpKGEsIGIpIHt0cnkge3ZhciBjID0gIiIsZCA9IGI7ZG8ge2MgKz0gUGEoZCksIGQgPSBkLnJldHVybjt9IHdoaWxlIChkKTt2YXIgZSA9IGM7fSBjYXRjaCAoZikge2UgPSAiXG5FcnJvciBnZW5lcmF0aW5nIHN0YWNrOiAiICsgZi5tZXNzYWdlICsgIlxuIiArIGYuc3RhY2s7fXJldHVybiB7IHZhbHVlOiBhLCBzb3VyY2U6IGIsIHN0YWNrOiBlLCBkaWdlc3Q6IG51bGwgfTt9ZnVuY3Rpb24gTGkoYSwgYiwgYykge3JldHVybiB7IHZhbHVlOiBhLCBzb3VyY2U6IG51bGwsIHN0YWNrOiBudWxsICE9IGMgPyBjIDogbnVsbCwgZGlnZXN0OiBudWxsICE9IGIgPyBiIDogbnVsbCB9O30KICAgICAgICAgIGZ1bmN0aW9uIE1pKGEsIGIpIHt0cnkge2NvbnNvbGUuZXJyb3IoYi52YWx1ZSk7fSBjYXRjaCAoYykge3NldFRpbWVvdXQoZnVuY3Rpb24gKCkge3Rocm93IGM7fSk7fX12YXIgTmkgPSAiZnVuY3Rpb24iID09PSB0eXBlb2YgV2Vha01hcCA/IFdlYWtNYXAgOiBNYXA7ZnVuY3Rpb24gT2koYSwgYiwgYykge2MgPSBjaCgtMSwgYyk7Yy50YWcgPSAzO2MucGF5bG9hZCA9IHsgZWxlbWVudDogbnVsbCB9O3ZhciBkID0gYi52YWx1ZTtjLmNhbGxiYWNrID0gZnVuY3Rpb24gKCkge1BpIHx8IChQaSA9ICEwLCBRaSA9IGQpO01pKGEsIGIpO307cmV0dXJuIGM7fQogICAgICAgICAgZnVuY3Rpb24gUmkoYSwgYiwgYykge2MgPSBjaCgtMSwgYyk7Yy50YWcgPSAzO3ZhciBkID0gYS50eXBlLmdldERlcml2ZWRTdGF0ZUZyb21FcnJvcjtpZiAoImZ1bmN0aW9uIiA9PT0gdHlwZW9mIGQpIHt2YXIgZSA9IGIudmFsdWU7Yy5wYXlsb2FkID0gZnVuY3Rpb24gKCkge3JldHVybiBkKGUpO307Yy5jYWxsYmFjayA9IGZ1bmN0aW9uICgpIHtNaShhLCBiKTt9O312YXIgZiA9IGEuc3RhdGVOb2RlO251bGwgIT09IGYgJiYgImZ1bmN0aW9uIiA9PT0gdHlwZW9mIGYuY29tcG9uZW50RGlkQ2F0Y2ggJiYgKGMuY2FsbGJhY2sgPSBmdW5jdGlvbiAoKSB7TWkoYSwgYik7ImZ1bmN0aW9uIiAhPT0gdHlwZW9mIGQgJiYgKG51bGwgPT09IFNpID8gU2kgPSBuZXcgU2V0KFt0aGlzXSkgOiBTaS5hZGQodGhpcykpO3ZhciBjID0gYi5zdGFjazt0aGlzLmNvbXBvbmVudERpZENhdGNoKGIudmFsdWUsIHsgY29tcG9uZW50U3RhY2s6IG51bGwgIT09IGMgPyBjIDogIiIgfSk7fSk7cmV0dXJuIGM7fQogICAgICAgICAgZnVuY3Rpb24gVGkoYSwgYiwgYykge3ZhciBkID0gYS5waW5nQ2FjaGU7aWYgKG51bGwgPT09IGQpIHtkID0gYS5waW5nQ2FjaGUgPSBuZXcgTmkoKTt2YXIgZSA9IG5ldyBTZXQoKTtkLnNldChiLCBlKTt9IGVsc2UgZSA9IGQuZ2V0KGIpLCB2b2lkIDAgPT09IGUgJiYgKGUgPSBuZXcgU2V0KCksIGQuc2V0KGIsIGUpKTtlLmhhcyhjKSB8fCAoZS5hZGQoYyksIGEgPSBVaS5iaW5kKG51bGwsIGEsIGIsIGMpLCBiLnRoZW4oYSwgYSkpO31mdW5jdGlvbiBWaShhKSB7ZG8ge3ZhciBiO2lmIChiID0gMTMgPT09IGEudGFnKSBiID0gYS5tZW1vaXplZFN0YXRlLCBiID0gbnVsbCAhPT0gYiA/IG51bGwgIT09IGIuZGVoeWRyYXRlZCA/ICEwIDogITEgOiAhMDtpZiAoYikgcmV0dXJuIGE7YSA9IGEucmV0dXJuO30gd2hpbGUgKG51bGwgIT09IGEpO3JldHVybiBudWxsO30KICAgICAgICAgIGZ1bmN0aW9uIFdpKGEsIGIsIGMsIGQsIGUpIHtpZiAoMCA9PT0gKGEubW9kZSAmIDEpKSByZXR1cm4gYSA9PT0gYiA/IGEuZmxhZ3MgfD0gNjU1MzYgOiAoYS5mbGFncyB8PSAxMjgsIGMuZmxhZ3MgfD0gMTMxMDcyLCBjLmZsYWdzICY9IC01MjgwNSwgMSA9PT0gYy50YWcgJiYgKG51bGwgPT09IGMuYWx0ZXJuYXRlID8gYy50YWcgPSAxNyA6IChiID0gY2goLTEsIDEpLCBiLnRhZyA9IDIsIGRoKGMsIGIsIDEpKSksIGMubGFuZXMgfD0gMSksIGE7YS5mbGFncyB8PSA2NTUzNjthLmxhbmVzID0gZTtyZXR1cm4gYTt9dmFyIFhpID0gdWEuUmVhY3RDdXJyZW50T3duZXIsVWcgPSAhMTtmdW5jdGlvbiBZaShhLCBiLCBjLCBkKSB7Yi5jaGlsZCA9IG51bGwgPT09IGEgPyBDaChiLCBudWxsLCBjLCBkKSA6IEJoKGIsIGEuY2hpbGQsIGMsIGQpO30KICAgICAgICAgIGZ1bmN0aW9uIFppKGEsIGIsIGMsIGQsIGUpIHtjID0gYy5yZW5kZXI7dmFyIGYgPSBiLnJlZjtUZyhiLCBlKTtkID0gWGgoYSwgYiwgYywgZCwgZiwgZSk7YyA9IGJpKCk7aWYgKG51bGwgIT09IGEgJiYgIVVnKSByZXR1cm4gYi51cGRhdGVRdWV1ZSA9IGEudXBkYXRlUXVldWUsIGIuZmxhZ3MgJj0gLTIwNTMsIGEubGFuZXMgJj0gfmUsICRpKGEsIGIsIGUpO0kgJiYgYyAmJiB2ZyhiKTtiLmZsYWdzIHw9IDE7WWkoYSwgYiwgZCwgZSk7cmV0dXJuIGIuY2hpbGQ7fQogICAgICAgICAgZnVuY3Rpb24gYWooYSwgYiwgYywgZCwgZSkge2lmIChudWxsID09PSBhKSB7dmFyIGYgPSBjLnR5cGU7aWYgKCJmdW5jdGlvbiIgPT09IHR5cGVvZiBmICYmICFiaihmKSAmJiB2b2lkIDAgPT09IGYuZGVmYXVsdFByb3BzICYmIG51bGwgPT09IGMuY29tcGFyZSAmJiB2b2lkIDAgPT09IGMuZGVmYXVsdFByb3BzKSByZXR1cm4gYi50YWcgPSAxNSwgYi50eXBlID0gZiwgY2ooYSwgYiwgZiwgZCwgZSk7YSA9IHloKGMudHlwZSwgbnVsbCwgZCwgYiwgYi5tb2RlLCBlKTthLnJlZiA9IGIucmVmO2EucmV0dXJuID0gYjtyZXR1cm4gYi5jaGlsZCA9IGE7fWYgPSBhLmNoaWxkO2lmICgwID09PSAoYS5sYW5lcyAmIGUpKSB7dmFyIGcgPSBmLm1lbW9pemVkUHJvcHM7YyA9IGMuY29tcGFyZTtjID0gbnVsbCAhPT0gYyA/IGMgOiBJZTtpZiAoYyhnLCBkKSAmJiBhLnJlZiA9PT0gYi5yZWYpIHJldHVybiAkaShhLCBiLCBlKTt9Yi5mbGFncyB8PSAxO2EgPSB3aChmLCBkKTthLnJlZiA9IGIucmVmO2EucmV0dXJuID0gYjtyZXR1cm4gYi5jaGlsZCA9IGE7fQogICAgICAgICAgZnVuY3Rpb24gY2ooYSwgYiwgYywgZCwgZSkge2lmIChudWxsICE9PSBhKSB7dmFyIGYgPSBhLm1lbW9pemVkUHJvcHM7aWYgKEllKGYsIGQpICYmIGEucmVmID09PSBiLnJlZikgaWYgKFVnID0gITEsIGIucGVuZGluZ1Byb3BzID0gZCA9IGYsIDAgIT09IChhLmxhbmVzICYgZSkpIDAgIT09IChhLmZsYWdzICYgMTMxMDcyKSAmJiAoVWcgPSAhMCk7ZWxzZSByZXR1cm4gYi5sYW5lcyA9IGEubGFuZXMsICRpKGEsIGIsIGUpO31yZXR1cm4gZGooYSwgYiwgYywgZCwgZSk7fQogICAgICAgICAgZnVuY3Rpb24gZWooYSwgYiwgYykge3ZhciBkID0gYi5wZW5kaW5nUHJvcHMsZSA9IGQuY2hpbGRyZW4sZiA9IG51bGwgIT09IGEgPyBhLm1lbW9pemVkU3RhdGUgOiBudWxsO2lmICgiaGlkZGVuIiA9PT0gZC5tb2RlKSB7aWYgKDAgPT09IChiLm1vZGUgJiAxKSkgYi5tZW1vaXplZFN0YXRlID0geyBiYXNlTGFuZXM6IDAsIGNhY2hlUG9vbDogbnVsbCwgdHJhbnNpdGlvbnM6IG51bGwgfSwgRyhmaiwgZ2opLCBnaiB8PSBjO2Vsc2Uge2lmICgwID09PSAoYyAmIDEwNzM3NDE4MjQpKSByZXR1cm4gYSA9IG51bGwgIT09IGYgPyBmLmJhc2VMYW5lcyB8IGMgOiBjLCBiLmxhbmVzID0gYi5jaGlsZExhbmVzID0gMTA3Mzc0MTgyNCwgYi5tZW1vaXplZFN0YXRlID0geyBiYXNlTGFuZXM6IGEsIGNhY2hlUG9vbDogbnVsbCwgdHJhbnNpdGlvbnM6IG51bGwgfSwgYi51cGRhdGVRdWV1ZSA9IG51bGwsIEcoZmosIGdqKSwgZ2ogfD0gYSwgbnVsbDtiLm1lbW9pemVkU3RhdGUgPSB7IGJhc2VMYW5lczogMCwgY2FjaGVQb29sOiBudWxsLCB0cmFuc2l0aW9uczogbnVsbCB9O2QgPSBudWxsICE9PSBmID8gZi5iYXNlTGFuZXMgOiBjO0coZmosIGdqKTtnaiB8PSBkO319IGVsc2UgbnVsbCAhPT0KICAgICAgICAgICAgZiA/IChkID0gZi5iYXNlTGFuZXMgfCBjLCBiLm1lbW9pemVkU3RhdGUgPSBudWxsKSA6IGQgPSBjLCBHKGZqLCBnaiksIGdqIHw9IGQ7WWkoYSwgYiwgZSwgYyk7cmV0dXJuIGIuY2hpbGQ7fWZ1bmN0aW9uIGhqKGEsIGIpIHt2YXIgYyA9IGIucmVmO2lmIChudWxsID09PSBhICYmIG51bGwgIT09IGMgfHwgbnVsbCAhPT0gYSAmJiBhLnJlZiAhPT0gYykgYi5mbGFncyB8PSA1MTIsIGIuZmxhZ3MgfD0gMjA5NzE1Mjt9ZnVuY3Rpb24gZGooYSwgYiwgYywgZCwgZSkge3ZhciBmID0gWmYoYykgPyBYZiA6IEguY3VycmVudDtmID0gWWYoYiwgZik7VGcoYiwgZSk7YyA9IFhoKGEsIGIsIGMsIGQsIGYsIGUpO2QgPSBiaSgpO2lmIChudWxsICE9PSBhICYmICFVZykgcmV0dXJuIGIudXBkYXRlUXVldWUgPSBhLnVwZGF0ZVF1ZXVlLCBiLmZsYWdzICY9IC0yMDUzLCBhLmxhbmVzICY9IH5lLCAkaShhLCBiLCBlKTtJICYmIGQgJiYgdmcoYik7Yi5mbGFncyB8PSAxO1lpKGEsIGIsIGMsIGUpO3JldHVybiBiLmNoaWxkO30KICAgICAgICAgIGZ1bmN0aW9uIGlqKGEsIGIsIGMsIGQsIGUpIHtpZiAoWmYoYykpIHt2YXIgZiA9ICEwO2NnKGIpO30gZWxzZSBmID0gITE7VGcoYiwgZSk7aWYgKG51bGwgPT09IGIuc3RhdGVOb2RlKSBqaihhLCBiKSwgcGgoYiwgYywgZCksIHJoKGIsIGMsIGQsIGUpLCBkID0gITA7ZWxzZSBpZiAobnVsbCA9PT0gYSkge3ZhciBnID0gYi5zdGF0ZU5vZGUsaCA9IGIubWVtb2l6ZWRQcm9wcztnLnByb3BzID0gaDt2YXIgayA9IGcuY29udGV4dCxsID0gYy5jb250ZXh0VHlwZTsib2JqZWN0IiA9PT0gdHlwZW9mIGwgJiYgbnVsbCAhPT0gbCA/IGwgPSBWZyhsKSA6IChsID0gWmYoYykgPyBYZiA6IEguY3VycmVudCwgbCA9IFlmKGIsIGwpKTt2YXIgbSA9IGMuZ2V0RGVyaXZlZFN0YXRlRnJvbVByb3BzLHEgPSAiZnVuY3Rpb24iID09PSB0eXBlb2YgbSB8fCAiZnVuY3Rpb24iID09PSB0eXBlb2YgZy5nZXRTbmFwc2hvdEJlZm9yZVVwZGF0ZTtxIHx8ICJmdW5jdGlvbiIgIT09IHR5cGVvZiBnLlVOU0FGRV9jb21wb25lbnRXaWxsUmVjZWl2ZVByb3BzICYmICJmdW5jdGlvbiIgIT09IHR5cGVvZiBnLmNvbXBvbmVudFdpbGxSZWNlaXZlUHJvcHMgfHwKICAgICAgICAgICAgICAoaCAhPT0gZCB8fCBrICE9PSBsKSAmJiBxaChiLCBnLCBkLCBsKTskZyA9ICExO3ZhciByID0gYi5tZW1vaXplZFN0YXRlO2cuc3RhdGUgPSByO2doKGIsIGQsIGcsIGUpO2sgPSBiLm1lbW9pemVkU3RhdGU7aCAhPT0gZCB8fCByICE9PSBrIHx8IFdmLmN1cnJlbnQgfHwgJGcgPyAoImZ1bmN0aW9uIiA9PT0gdHlwZW9mIG0gJiYgKGtoKGIsIGMsIG0sIGQpLCBrID0gYi5tZW1vaXplZFN0YXRlKSwgKGggPSAkZyB8fCBvaChiLCBjLCBoLCBkLCByLCBrLCBsKSkgPyAocSB8fCAiZnVuY3Rpb24iICE9PSB0eXBlb2YgZy5VTlNBRkVfY29tcG9uZW50V2lsbE1vdW50ICYmICJmdW5jdGlvbiIgIT09IHR5cGVvZiBnLmNvbXBvbmVudFdpbGxNb3VudCB8fCAoImZ1bmN0aW9uIiA9PT0gdHlwZW9mIGcuY29tcG9uZW50V2lsbE1vdW50ICYmIGcuY29tcG9uZW50V2lsbE1vdW50KCksICJmdW5jdGlvbiIgPT09IHR5cGVvZiBnLlVOU0FGRV9jb21wb25lbnRXaWxsTW91bnQgJiYgZy5VTlNBRkVfY29tcG9uZW50V2lsbE1vdW50KCkpLCAiZnVuY3Rpb24iID09PSB0eXBlb2YgZy5jb21wb25lbnREaWRNb3VudCAmJiAoYi5mbGFncyB8PSA0MTk0MzA4KSkgOiAoCiAgICAgICAgICAgICAgImZ1bmN0aW9uIiA9PT0gdHlwZW9mIGcuY29tcG9uZW50RGlkTW91bnQgJiYgKGIuZmxhZ3MgfD0gNDE5NDMwOCksIGIubWVtb2l6ZWRQcm9wcyA9IGQsIGIubWVtb2l6ZWRTdGF0ZSA9IGspLCBnLnByb3BzID0gZCwgZy5zdGF0ZSA9IGssIGcuY29udGV4dCA9IGwsIGQgPSBoKSA6ICgiZnVuY3Rpb24iID09PSB0eXBlb2YgZy5jb21wb25lbnREaWRNb3VudCAmJiAoYi5mbGFncyB8PSA0MTk0MzA4KSwgZCA9ICExKTt9IGVsc2Uge2cgPSBiLnN0YXRlTm9kZTtiaChhLCBiKTtoID0gYi5tZW1vaXplZFByb3BzO2wgPSBiLnR5cGUgPT09IGIuZWxlbWVudFR5cGUgPyBoIDogTGcoYi50eXBlLCBoKTtnLnByb3BzID0gbDtxID0gYi5wZW5kaW5nUHJvcHM7ciA9IGcuY29udGV4dDtrID0gYy5jb250ZXh0VHlwZTsib2JqZWN0IiA9PT0gdHlwZW9mIGsgJiYgbnVsbCAhPT0gayA/IGsgPSBWZyhrKSA6IChrID0gWmYoYykgPyBYZiA6IEguY3VycmVudCwgayA9IFlmKGIsIGspKTt2YXIgeSA9IGMuZ2V0RGVyaXZlZFN0YXRlRnJvbVByb3BzOyhtID0gImZ1bmN0aW9uIiA9PT0gdHlwZW9mIHkgfHwgImZ1bmN0aW9uIiA9PT0gdHlwZW9mIGcuZ2V0U25hcHNob3RCZWZvcmVVcGRhdGUpIHx8CiAgICAgICAgICAgICAgImZ1bmN0aW9uIiAhPT0gdHlwZW9mIGcuVU5TQUZFX2NvbXBvbmVudFdpbGxSZWNlaXZlUHJvcHMgJiYgImZ1bmN0aW9uIiAhPT0gdHlwZW9mIGcuY29tcG9uZW50V2lsbFJlY2VpdmVQcm9wcyB8fCAoaCAhPT0gcSB8fCByICE9PSBrKSAmJiBxaChiLCBnLCBkLCBrKTskZyA9ICExO3IgPSBiLm1lbW9pemVkU3RhdGU7Zy5zdGF0ZSA9IHI7Z2goYiwgZCwgZywgZSk7dmFyIG4gPSBiLm1lbW9pemVkU3RhdGU7aCAhPT0gcSB8fCByICE9PSBuIHx8IFdmLmN1cnJlbnQgfHwgJGcgPyAoImZ1bmN0aW9uIiA9PT0gdHlwZW9mIHkgJiYgKGtoKGIsIGMsIHksIGQpLCBuID0gYi5tZW1vaXplZFN0YXRlKSwgKGwgPSAkZyB8fCBvaChiLCBjLCBsLCBkLCByLCBuLCBrKSB8fCAhMSkgPyAobSB8fCAiZnVuY3Rpb24iICE9PSB0eXBlb2YgZy5VTlNBRkVfY29tcG9uZW50V2lsbFVwZGF0ZSAmJiAiZnVuY3Rpb24iICE9PSB0eXBlb2YgZy5jb21wb25lbnRXaWxsVXBkYXRlIHx8ICgiZnVuY3Rpb24iID09PSB0eXBlb2YgZy5jb21wb25lbnRXaWxsVXBkYXRlICYmIGcuY29tcG9uZW50V2lsbFVwZGF0ZShkLCBuLCBrKSwgImZ1bmN0aW9uIiA9PT0gdHlwZW9mIGcuVU5TQUZFX2NvbXBvbmVudFdpbGxVcGRhdGUgJiYKICAgICAgICAgICAgICBnLlVOU0FGRV9jb21wb25lbnRXaWxsVXBkYXRlKGQsIG4sIGspKSwgImZ1bmN0aW9uIiA9PT0gdHlwZW9mIGcuY29tcG9uZW50RGlkVXBkYXRlICYmIChiLmZsYWdzIHw9IDQpLCAiZnVuY3Rpb24iID09PSB0eXBlb2YgZy5nZXRTbmFwc2hvdEJlZm9yZVVwZGF0ZSAmJiAoYi5mbGFncyB8PSAxMDI0KSkgOiAoImZ1bmN0aW9uIiAhPT0gdHlwZW9mIGcuY29tcG9uZW50RGlkVXBkYXRlIHx8IGggPT09IGEubWVtb2l6ZWRQcm9wcyAmJiByID09PSBhLm1lbW9pemVkU3RhdGUgfHwgKGIuZmxhZ3MgfD0gNCksICJmdW5jdGlvbiIgIT09IHR5cGVvZiBnLmdldFNuYXBzaG90QmVmb3JlVXBkYXRlIHx8IGggPT09IGEubWVtb2l6ZWRQcm9wcyAmJiByID09PSBhLm1lbW9pemVkU3RhdGUgfHwgKGIuZmxhZ3MgfD0gMTAyNCksIGIubWVtb2l6ZWRQcm9wcyA9IGQsIGIubWVtb2l6ZWRTdGF0ZSA9IG4pLCBnLnByb3BzID0gZCwgZy5zdGF0ZSA9IG4sIGcuY29udGV4dCA9IGssIGQgPSBsKSA6ICgiZnVuY3Rpb24iICE9PSB0eXBlb2YgZy5jb21wb25lbnREaWRVcGRhdGUgfHwgaCA9PT0gYS5tZW1vaXplZFByb3BzICYmIHIgPT09CiAgICAgICAgICAgICAgYS5tZW1vaXplZFN0YXRlIHx8IChiLmZsYWdzIHw9IDQpLCAiZnVuY3Rpb24iICE9PSB0eXBlb2YgZy5nZXRTbmFwc2hvdEJlZm9yZVVwZGF0ZSB8fCBoID09PSBhLm1lbW9pemVkUHJvcHMgJiYgciA9PT0gYS5tZW1vaXplZFN0YXRlIHx8IChiLmZsYWdzIHw9IDEwMjQpLCBkID0gITEpO31yZXR1cm4ga2ooYSwgYiwgYywgZCwgZiwgZSk7fQogICAgICAgICAgZnVuY3Rpb24ga2ooYSwgYiwgYywgZCwgZSwgZikge2hqKGEsIGIpO3ZhciBnID0gMCAhPT0gKGIuZmxhZ3MgJiAxMjgpO2lmICghZCAmJiAhZykgcmV0dXJuIGUgJiYgZGcoYiwgYywgITEpLCAkaShhLCBiLCBmKTtkID0gYi5zdGF0ZU5vZGU7WGkuY3VycmVudCA9IGI7dmFyIGggPSBnICYmICJmdW5jdGlvbiIgIT09IHR5cGVvZiBjLmdldERlcml2ZWRTdGF0ZUZyb21FcnJvciA/IG51bGwgOiBkLnJlbmRlcigpO2IuZmxhZ3MgfD0gMTtudWxsICE9PSBhICYmIGcgPyAoYi5jaGlsZCA9IEJoKGIsIGEuY2hpbGQsIG51bGwsIGYpLCBiLmNoaWxkID0gQmgoYiwgbnVsbCwgaCwgZikpIDogWWkoYSwgYiwgaCwgZik7Yi5tZW1vaXplZFN0YXRlID0gZC5zdGF0ZTtlICYmIGRnKGIsIGMsICEwKTtyZXR1cm4gYi5jaGlsZDt9ZnVuY3Rpb24gbGooYSkge3ZhciBiID0gYS5zdGF0ZU5vZGU7Yi5wZW5kaW5nQ29udGV4dCA/IGFnKGEsIGIucGVuZGluZ0NvbnRleHQsIGIucGVuZGluZ0NvbnRleHQgIT09IGIuY29udGV4dCkgOiBiLmNvbnRleHQgJiYgYWcoYSwgYi5jb250ZXh0LCAhMSk7SWgoYSwgYi5jb250YWluZXJJbmZvKTt9CiAgICAgICAgICBmdW5jdGlvbiBtaihhLCBiLCBjLCBkLCBlKSB7SWcoKTtKZyhlKTtiLmZsYWdzIHw9IDI1NjtZaShhLCBiLCBjLCBkKTtyZXR1cm4gYi5jaGlsZDt9dmFyIG5qID0geyBkZWh5ZHJhdGVkOiBudWxsLCB0cmVlQ29udGV4dDogbnVsbCwgcmV0cnlMYW5lOiAwIH07ZnVuY3Rpb24gb2ooYSkge3JldHVybiB7IGJhc2VMYW5lczogYSwgY2FjaGVQb29sOiBudWxsLCB0cmFuc2l0aW9uczogbnVsbCB9O30KICAgICAgICAgIGZ1bmN0aW9uIHBqKGEsIGIsIGMpIHt2YXIgZCA9IGIucGVuZGluZ1Byb3BzLGUgPSBNLmN1cnJlbnQsZiA9ICExLGcgPSAwICE9PSAoYi5mbGFncyAmIDEyOCksaDsoaCA9IGcpIHx8IChoID0gbnVsbCAhPT0gYSAmJiBudWxsID09PSBhLm1lbW9pemVkU3RhdGUgPyAhMSA6IDAgIT09IChlICYgMikpO2lmIChoKSBmID0gITAsIGIuZmxhZ3MgJj0gLTEyOTtlbHNlIGlmIChudWxsID09PSBhIHx8IG51bGwgIT09IGEubWVtb2l6ZWRTdGF0ZSkgZSB8PSAxO0coTSwgZSAmIDEpO2lmIChudWxsID09PSBhKSB7RWcoYik7YSA9IGIubWVtb2l6ZWRTdGF0ZTtpZiAobnVsbCAhPT0gYSAmJiAoYSA9IGEuZGVoeWRyYXRlZCwgbnVsbCAhPT0gYSkpIHJldHVybiAwID09PSAoYi5tb2RlICYgMSkgPyBiLmxhbmVzID0gMSA6ICIkISIgPT09IGEuZGF0YSA/IGIubGFuZXMgPSA4IDogYi5sYW5lcyA9IDEwNzM3NDE4MjQsIG51bGw7ZyA9IGQuY2hpbGRyZW47YSA9IGQuZmFsbGJhY2s7cmV0dXJuIGYgPyAoZCA9IGIubW9kZSwgZiA9IGIuY2hpbGQsIGcgPSB7IG1vZGU6ICJoaWRkZW4iLCBjaGlsZHJlbjogZyB9LCAwID09PSAoZCAmIDEpICYmIG51bGwgIT09IGYgPyAoZi5jaGlsZExhbmVzID0gMCwgZi5wZW5kaW5nUHJvcHMgPQogICAgICAgICAgICAgIGcpIDogZiA9IHFqKGcsIGQsIDAsIG51bGwpLCBhID0gQWgoYSwgZCwgYywgbnVsbCksIGYucmV0dXJuID0gYiwgYS5yZXR1cm4gPSBiLCBmLnNpYmxpbmcgPSBhLCBiLmNoaWxkID0gZiwgYi5jaGlsZC5tZW1vaXplZFN0YXRlID0gb2ooYyksIGIubWVtb2l6ZWRTdGF0ZSA9IG5qLCBhKSA6IHJqKGIsIGcpO31lID0gYS5tZW1vaXplZFN0YXRlO2lmIChudWxsICE9PSBlICYmIChoID0gZS5kZWh5ZHJhdGVkLCBudWxsICE9PSBoKSkgcmV0dXJuIHNqKGEsIGIsIGcsIGQsIGgsIGUsIGMpO2lmIChmKSB7ZiA9IGQuZmFsbGJhY2s7ZyA9IGIubW9kZTtlID0gYS5jaGlsZDtoID0gZS5zaWJsaW5nO3ZhciBrID0geyBtb2RlOiAiaGlkZGVuIiwgY2hpbGRyZW46IGQuY2hpbGRyZW4gfTswID09PSAoZyAmIDEpICYmIGIuY2hpbGQgIT09IGUgPyAoZCA9IGIuY2hpbGQsIGQuY2hpbGRMYW5lcyA9IDAsIGQucGVuZGluZ1Byb3BzID0gaywgYi5kZWxldGlvbnMgPSBudWxsKSA6IChkID0gd2goZSwgayksIGQuc3VidHJlZUZsYWdzID0gZS5zdWJ0cmVlRmxhZ3MgJiAxNDY4MDA2NCk7bnVsbCAhPT0gaCA/IGYgPSB3aChoLCBmKSA6IChmID0gQWgoZiwgZywgYywgbnVsbCksIGYuZmxhZ3MgfD0gMik7Zi5yZXR1cm4gPQogICAgICAgICAgICAgIGI7ZC5yZXR1cm4gPSBiO2Quc2libGluZyA9IGY7Yi5jaGlsZCA9IGQ7ZCA9IGY7ZiA9IGIuY2hpbGQ7ZyA9IGEuY2hpbGQubWVtb2l6ZWRTdGF0ZTtnID0gbnVsbCA9PT0gZyA/IG9qKGMpIDogeyBiYXNlTGFuZXM6IGcuYmFzZUxhbmVzIHwgYywgY2FjaGVQb29sOiBudWxsLCB0cmFuc2l0aW9uczogZy50cmFuc2l0aW9ucyB9O2YubWVtb2l6ZWRTdGF0ZSA9IGc7Zi5jaGlsZExhbmVzID0gYS5jaGlsZExhbmVzICYgfmM7Yi5tZW1vaXplZFN0YXRlID0gbmo7cmV0dXJuIGQ7fWYgPSBhLmNoaWxkO2EgPSBmLnNpYmxpbmc7ZCA9IHdoKGYsIHsgbW9kZTogInZpc2libGUiLCBjaGlsZHJlbjogZC5jaGlsZHJlbiB9KTswID09PSAoYi5tb2RlICYgMSkgJiYgKGQubGFuZXMgPSBjKTtkLnJldHVybiA9IGI7ZC5zaWJsaW5nID0gbnVsbDtudWxsICE9PSBhICYmIChjID0gYi5kZWxldGlvbnMsIG51bGwgPT09IGMgPyAoYi5kZWxldGlvbnMgPSBbYV0sIGIuZmxhZ3MgfD0gMTYpIDogYy5wdXNoKGEpKTtiLmNoaWxkID0gZDtiLm1lbW9pemVkU3RhdGUgPSBudWxsO3JldHVybiBkO30KICAgICAgICAgIGZ1bmN0aW9uIHJqKGEsIGIpIHtiID0gcWooeyBtb2RlOiAidmlzaWJsZSIsIGNoaWxkcmVuOiBiIH0sIGEubW9kZSwgMCwgbnVsbCk7Yi5yZXR1cm4gPSBhO3JldHVybiBhLmNoaWxkID0gYjt9ZnVuY3Rpb24gdGooYSwgYiwgYywgZCkge251bGwgIT09IGQgJiYgSmcoZCk7QmgoYiwgYS5jaGlsZCwgbnVsbCwgYyk7YSA9IHJqKGIsIGIucGVuZGluZ1Byb3BzLmNoaWxkcmVuKTthLmZsYWdzIHw9IDI7Yi5tZW1vaXplZFN0YXRlID0gbnVsbDtyZXR1cm4gYTt9CiAgICAgICAgICBmdW5jdGlvbiBzaihhLCBiLCBjLCBkLCBlLCBmLCBnKSB7aWYgKGMpIHtpZiAoYi5mbGFncyAmIDI1NikgcmV0dXJuIGIuZmxhZ3MgJj0gLTI1NywgZCA9IExpKEVycm9yKHAoNDIyKSkpLCB0aihhLCBiLCBnLCBkKTtpZiAobnVsbCAhPT0gYi5tZW1vaXplZFN0YXRlKSByZXR1cm4gYi5jaGlsZCA9IGEuY2hpbGQsIGIuZmxhZ3MgfD0gMTI4LCBudWxsO2YgPSBkLmZhbGxiYWNrO2UgPSBiLm1vZGU7ZCA9IHFqKHsgbW9kZTogInZpc2libGUiLCBjaGlsZHJlbjogZC5jaGlsZHJlbiB9LCBlLCAwLCBudWxsKTtmID0gQWgoZiwgZSwgZywgbnVsbCk7Zi5mbGFncyB8PSAyO2QucmV0dXJuID0gYjtmLnJldHVybiA9IGI7ZC5zaWJsaW5nID0gZjtiLmNoaWxkID0gZDswICE9PSAoYi5tb2RlICYgMSkgJiYgQmgoYiwgYS5jaGlsZCwgbnVsbCwgZyk7Yi5jaGlsZC5tZW1vaXplZFN0YXRlID0gb2ooZyk7Yi5tZW1vaXplZFN0YXRlID0gbmo7cmV0dXJuIGY7fWlmICgwID09PSAoYi5tb2RlICYgMSkpIHJldHVybiB0aihhLCBiLCBnLCBudWxsKTtpZiAoIiQhIiA9PT0gZS5kYXRhKSB7ZCA9IGUubmV4dFNpYmxpbmcgJiYgZS5uZXh0U2libGluZy5kYXRhc2V0OwogICAgICAgICAgICAgIGlmIChkKSB2YXIgaCA9IGQuZGdzdDtkID0gaDtmID0gRXJyb3IocCg0MTkpKTtkID0gTGkoZiwgZCwgdm9pZCAwKTtyZXR1cm4gdGooYSwgYiwgZywgZCk7fWggPSAwICE9PSAoZyAmIGEuY2hpbGRMYW5lcyk7aWYgKFVnIHx8IGgpIHtkID0gUjtpZiAobnVsbCAhPT0gZCkge3N3aXRjaCAoZyAmIC1nKSB7Y2FzZSA0OmUgPSAyO2JyZWFrO2Nhc2UgMTY6ZSA9IDg7YnJlYWs7Y2FzZSA2NDpjYXNlIDEyODpjYXNlIDI1NjpjYXNlIDUxMjpjYXNlIDEwMjQ6Y2FzZSAyMDQ4OmNhc2UgNDA5NjpjYXNlIDgxOTI6Y2FzZSAxNjM4NDpjYXNlIDMyNzY4OmNhc2UgNjU1MzY6Y2FzZSAxMzEwNzI6Y2FzZSAyNjIxNDQ6Y2FzZSA1MjQyODg6Y2FzZSAxMDQ4NTc2OmNhc2UgMjA5NzE1MjpjYXNlIDQxOTQzMDQ6Y2FzZSA4Mzg4NjA4OmNhc2UgMTY3NzcyMTY6Y2FzZSAzMzU1NDQzMjpjYXNlIDY3MTA4ODY0OmUgPSAzMjticmVhaztjYXNlIDUzNjg3MDkxMjplID0gMjY4NDM1NDU2O2JyZWFrO2RlZmF1bHQ6ZSA9IDA7fWUgPSAwICE9PSAoZSAmIChkLnN1c3BlbmRlZExhbmVzIHwgZykpID8gMCA6IGU7CiAgICAgICAgICAgICAgICAwICE9PSBlICYmIGUgIT09IGYucmV0cnlMYW5lICYmIChmLnJldHJ5TGFuZSA9IGUsIFpnKGEsIGUpLCBtaChkLCBhLCBlLCAtMSkpO311aigpO2QgPSBMaShFcnJvcihwKDQyMSkpKTtyZXR1cm4gdGooYSwgYiwgZywgZCk7fWlmICgiJD8iID09PSBlLmRhdGEpIHJldHVybiBiLmZsYWdzIHw9IDEyOCwgYi5jaGlsZCA9IGEuY2hpbGQsIGIgPSB2ai5iaW5kKG51bGwsIGEpLCBlLl9yZWFjdFJldHJ5ID0gYiwgbnVsbDthID0gZi50cmVlQ29udGV4dDt5ZyA9IExmKGUubmV4dFNpYmxpbmcpO3hnID0gYjtJID0gITA7emcgPSBudWxsO251bGwgIT09IGEgJiYgKG9nW3BnKytdID0gcmcsIG9nW3BnKytdID0gc2csIG9nW3BnKytdID0gcWcsIHJnID0gYS5pZCwgc2cgPSBhLm92ZXJmbG93LCBxZyA9IGIpO2IgPSByaihiLCBkLmNoaWxkcmVuKTtiLmZsYWdzIHw9IDQwOTY7cmV0dXJuIGI7fWZ1bmN0aW9uIHdqKGEsIGIsIGMpIHthLmxhbmVzIHw9IGI7dmFyIGQgPSBhLmFsdGVybmF0ZTtudWxsICE9PSBkICYmIChkLmxhbmVzIHw9IGIpO1NnKGEucmV0dXJuLCBiLCBjKTt9CiAgICAgICAgICBmdW5jdGlvbiB4aihhLCBiLCBjLCBkLCBlKSB7dmFyIGYgPSBhLm1lbW9pemVkU3RhdGU7bnVsbCA9PT0gZiA/IGEubWVtb2l6ZWRTdGF0ZSA9IHsgaXNCYWNrd2FyZHM6IGIsIHJlbmRlcmluZzogbnVsbCwgcmVuZGVyaW5nU3RhcnRUaW1lOiAwLCBsYXN0OiBkLCB0YWlsOiBjLCB0YWlsTW9kZTogZSB9IDogKGYuaXNCYWNrd2FyZHMgPSBiLCBmLnJlbmRlcmluZyA9IG51bGwsIGYucmVuZGVyaW5nU3RhcnRUaW1lID0gMCwgZi5sYXN0ID0gZCwgZi50YWlsID0gYywgZi50YWlsTW9kZSA9IGUpO30KICAgICAgICAgIGZ1bmN0aW9uIHlqKGEsIGIsIGMpIHt2YXIgZCA9IGIucGVuZGluZ1Byb3BzLGUgPSBkLnJldmVhbE9yZGVyLGYgPSBkLnRhaWw7WWkoYSwgYiwgZC5jaGlsZHJlbiwgYyk7ZCA9IE0uY3VycmVudDtpZiAoMCAhPT0gKGQgJiAyKSkgZCA9IGQgJiAxIHwgMiwgYi5mbGFncyB8PSAxMjg7ZWxzZSB7aWYgKG51bGwgIT09IGEgJiYgMCAhPT0gKGEuZmxhZ3MgJiAxMjgpKSBhOiBmb3IgKGEgPSBiLmNoaWxkOyBudWxsICE9PSBhOykge2lmICgxMyA9PT0gYS50YWcpIG51bGwgIT09IGEubWVtb2l6ZWRTdGF0ZSAmJiB3aihhLCBjLCBiKTtlbHNlIGlmICgxOSA9PT0gYS50YWcpIHdqKGEsIGMsIGIpO2Vsc2UgaWYgKG51bGwgIT09IGEuY2hpbGQpIHthLmNoaWxkLnJldHVybiA9IGE7YSA9IGEuY2hpbGQ7Y29udGludWU7fWlmIChhID09PSBiKSBicmVhayBhO2ZvciAoOyBudWxsID09PSBhLnNpYmxpbmc7KSB7aWYgKG51bGwgPT09IGEucmV0dXJuIHx8IGEucmV0dXJuID09PSBiKSBicmVhayBhO2EgPSBhLnJldHVybjt9YS5zaWJsaW5nLnJldHVybiA9IGEucmV0dXJuO2EgPSBhLnNpYmxpbmc7fWQgJj0gMTt9RyhNLCBkKTtpZiAoMCA9PT0gKGIubW9kZSAmIDEpKSBiLm1lbW9pemVkU3RhdGUgPQogICAgICAgICAgICBudWxsO2Vsc2Ugc3dpdGNoIChlKSB7Y2FzZSAiZm9yd2FyZHMiOmMgPSBiLmNoaWxkO2ZvciAoZSA9IG51bGw7IG51bGwgIT09IGM7KSB7YSA9IGMuYWx0ZXJuYXRlLCBudWxsICE9PSBhICYmIG51bGwgPT09IE1oKGEpICYmIChlID0gYyksIGMgPSBjLnNpYmxpbmc7fWMgPSBlO251bGwgPT09IGMgPyAoZSA9IGIuY2hpbGQsIGIuY2hpbGQgPSBudWxsKSA6IChlID0gYy5zaWJsaW5nLCBjLnNpYmxpbmcgPSBudWxsKTt4aihiLCAhMSwgZSwgYywgZik7YnJlYWs7Y2FzZSAiYmFja3dhcmRzIjpjID0gbnVsbDtlID0gYi5jaGlsZDtmb3IgKGIuY2hpbGQgPSBudWxsOyBudWxsICE9PSBlOykge2EgPSBlLmFsdGVybmF0ZTtpZiAobnVsbCAhPT0gYSAmJiBudWxsID09PSBNaChhKSkge2IuY2hpbGQgPSBlO2JyZWFrO31hID0gZS5zaWJsaW5nO2Uuc2libGluZyA9IGM7YyA9IGU7ZSA9IGE7fXhqKGIsICEwLCBjLCBudWxsLCBmKTticmVhaztjYXNlICJ0b2dldGhlciI6eGooYiwgITEsIG51bGwsIG51bGwsIHZvaWQgMCk7YnJlYWs7ZGVmYXVsdDpiLm1lbW9pemVkU3RhdGUgPSBudWxsO31yZXR1cm4gYi5jaGlsZDt9CiAgICAgICAgICBmdW5jdGlvbiBqaihhLCBiKSB7MCA9PT0gKGIubW9kZSAmIDEpICYmIG51bGwgIT09IGEgJiYgKGEuYWx0ZXJuYXRlID0gbnVsbCwgYi5hbHRlcm5hdGUgPSBudWxsLCBiLmZsYWdzIHw9IDIpO31mdW5jdGlvbiAkaShhLCBiLCBjKSB7bnVsbCAhPT0gYSAmJiAoYi5kZXBlbmRlbmNpZXMgPSBhLmRlcGVuZGVuY2llcyk7aGggfD0gYi5sYW5lcztpZiAoMCA9PT0gKGMgJiBiLmNoaWxkTGFuZXMpKSByZXR1cm4gbnVsbDtpZiAobnVsbCAhPT0gYSAmJiBiLmNoaWxkICE9PSBhLmNoaWxkKSB0aHJvdyBFcnJvcihwKDE1MykpO2lmIChudWxsICE9PSBiLmNoaWxkKSB7YSA9IGIuY2hpbGQ7YyA9IHdoKGEsIGEucGVuZGluZ1Byb3BzKTtiLmNoaWxkID0gYztmb3IgKGMucmV0dXJuID0gYjsgbnVsbCAhPT0gYS5zaWJsaW5nOykge2EgPSBhLnNpYmxpbmcsIGMgPSBjLnNpYmxpbmcgPSB3aChhLCBhLnBlbmRpbmdQcm9wcyksIGMucmV0dXJuID0gYjt9Yy5zaWJsaW5nID0gbnVsbDt9cmV0dXJuIGIuY2hpbGQ7fQogICAgICAgICAgZnVuY3Rpb24gemooYSwgYiwgYykge3N3aXRjaCAoYi50YWcpIHtjYXNlIDM6bGooYik7SWcoKTticmVhaztjYXNlIDU6S2goYik7YnJlYWs7Y2FzZSAxOlpmKGIudHlwZSkgJiYgY2coYik7YnJlYWs7Y2FzZSA0OkloKGIsIGIuc3RhdGVOb2RlLmNvbnRhaW5lckluZm8pO2JyZWFrO2Nhc2UgMTA6dmFyIGQgPSBiLnR5cGUuX2NvbnRleHQsZSA9IGIubWVtb2l6ZWRQcm9wcy52YWx1ZTtHKE1nLCBkLl9jdXJyZW50VmFsdWUpO2QuX2N1cnJlbnRWYWx1ZSA9IGU7YnJlYWs7Y2FzZSAxMzpkID0gYi5tZW1vaXplZFN0YXRlO2lmIChudWxsICE9PSBkKSB7aWYgKG51bGwgIT09IGQuZGVoeWRyYXRlZCkgcmV0dXJuIEcoTSwgTS5jdXJyZW50ICYgMSksIGIuZmxhZ3MgfD0gMTI4LCBudWxsO2lmICgwICE9PSAoYyAmIGIuY2hpbGQuY2hpbGRMYW5lcykpIHJldHVybiBwaihhLCBiLCBjKTtHKE0sIE0uY3VycmVudCAmIDEpO2EgPSAkaShhLCBiLCBjKTtyZXR1cm4gbnVsbCAhPT0gYSA/IGEuc2libGluZyA6IG51bGw7fUcoTSwgTS5jdXJyZW50ICYgMSk7YnJlYWs7Y2FzZSAxOTpkID0gMCAhPT0gKGMgJgogICAgICAgICAgICAgICAgYi5jaGlsZExhbmVzKTtpZiAoMCAhPT0gKGEuZmxhZ3MgJiAxMjgpKSB7aWYgKGQpIHJldHVybiB5aihhLCBiLCBjKTtiLmZsYWdzIHw9IDEyODt9ZSA9IGIubWVtb2l6ZWRTdGF0ZTtudWxsICE9PSBlICYmIChlLnJlbmRlcmluZyA9IG51bGwsIGUudGFpbCA9IG51bGwsIGUubGFzdEVmZmVjdCA9IG51bGwpO0coTSwgTS5jdXJyZW50KTtpZiAoZCkgYnJlYWs7ZWxzZSByZXR1cm4gbnVsbDtjYXNlIDIyOmNhc2UgMjM6cmV0dXJuIGIubGFuZXMgPSAwLCBlaihhLCBiLCBjKTt9cmV0dXJuICRpKGEsIGIsIGMpO312YXIgQWosIEJqLCBDaiwgRGo7CiAgICAgICAgICBBaiA9IGZ1bmN0aW9uIEFqKGEsIGIpIHtmb3IgKHZhciBjID0gYi5jaGlsZDsgbnVsbCAhPT0gYzspIHtpZiAoNSA9PT0gYy50YWcgfHwgNiA9PT0gYy50YWcpIGEuYXBwZW5kQ2hpbGQoYy5zdGF0ZU5vZGUpO2Vsc2UgaWYgKDQgIT09IGMudGFnICYmIG51bGwgIT09IGMuY2hpbGQpIHtjLmNoaWxkLnJldHVybiA9IGM7YyA9IGMuY2hpbGQ7Y29udGludWU7fWlmIChjID09PSBiKSBicmVhaztmb3IgKDsgbnVsbCA9PT0gYy5zaWJsaW5nOykge2lmIChudWxsID09PSBjLnJldHVybiB8fCBjLnJldHVybiA9PT0gYikgcmV0dXJuO2MgPSBjLnJldHVybjt9Yy5zaWJsaW5nLnJldHVybiA9IGMucmV0dXJuO2MgPSBjLnNpYmxpbmc7fX07QmogPSBmdW5jdGlvbiBCaigpIHt9OwogICAgICAgICAgQ2ogPSBmdW5jdGlvbiBDaihhLCBiLCBjLCBkKSB7dmFyIGUgPSBhLm1lbW9pemVkUHJvcHM7aWYgKGUgIT09IGQpIHthID0gYi5zdGF0ZU5vZGU7SGgoRWguY3VycmVudCk7dmFyIGYgPSBudWxsO3N3aXRjaCAoYykge2Nhc2UgImlucHV0IjplID0gWWEoYSwgZSk7ZCA9IFlhKGEsIGQpO2YgPSBbXTticmVhaztjYXNlICJzZWxlY3QiOmUgPSBBKHt9LCBlLCB7IHZhbHVlOiB2b2lkIDAgfSk7ZCA9IEEoe30sIGQsIHsgdmFsdWU6IHZvaWQgMCB9KTtmID0gW107YnJlYWs7Y2FzZSAidGV4dGFyZWEiOmUgPSBnYihhLCBlKTtkID0gZ2IoYSwgZCk7ZiA9IFtdO2JyZWFrO2RlZmF1bHQ6ImZ1bmN0aW9uIiAhPT0gdHlwZW9mIGUub25DbGljayAmJiAiZnVuY3Rpb24iID09PSB0eXBlb2YgZC5vbkNsaWNrICYmIChhLm9uY2xpY2sgPSBCZik7fXViKGMsIGQpO3ZhciBnO2MgPSBudWxsO2ZvciAobCBpbiBlKSB7aWYgKCFkLmhhc093blByb3BlcnR5KGwpICYmIGUuaGFzT3duUHJvcGVydHkobCkgJiYgbnVsbCAhPSBlW2xdKSBpZiAoInN0eWxlIiA9PT0gbCkge3ZhciBoID0gZVtsXTtmb3IgKGcgaW4gaCkge2guaGFzT3duUHJvcGVydHkoZykgJiYgKAogICAgICAgICAgICAgICAgICAgIGMgfHwgKGMgPSB7fSksIGNbZ10gPSAiIik7fX0gZWxzZSAiZGFuZ2Vyb3VzbHlTZXRJbm5lckhUTUwiICE9PSBsICYmICJjaGlsZHJlbiIgIT09IGwgJiYgInN1cHByZXNzQ29udGVudEVkaXRhYmxlV2FybmluZyIgIT09IGwgJiYgInN1cHByZXNzSHlkcmF0aW9uV2FybmluZyIgIT09IGwgJiYgImF1dG9Gb2N1cyIgIT09IGwgJiYgKGVhLmhhc093blByb3BlcnR5KGwpID8gZiB8fCAoZiA9IFtdKSA6IChmID0gZiB8fCBbXSkucHVzaChsLCBudWxsKSk7fWZvciAobCBpbiBkKSB7dmFyIGsgPSBkW2xdO2ggPSBudWxsICE9IGUgPyBlW2xdIDogdm9pZCAwO2lmIChkLmhhc093blByb3BlcnR5KGwpICYmIGsgIT09IGggJiYgKG51bGwgIT0gayB8fCBudWxsICE9IGgpKSBpZiAoInN0eWxlIiA9PT0gbCkge2lmIChoKSB7Zm9yIChnIGluIGgpIHshaC5oYXNPd25Qcm9wZXJ0eShnKSB8fCBrICYmIGsuaGFzT3duUHJvcGVydHkoZykgfHwgKGMgfHwgKGMgPSB7fSksIGNbZ10gPSAiIik7fWZvciAoZyBpbiBrKSB7ay5oYXNPd25Qcm9wZXJ0eShnKSAmJiBoW2ddICE9PSBrW2ddICYmIChjIHx8IChjID0ge30pLCBjW2ddID0ga1tnXSk7fX0gZWxzZSBjIHx8IChmIHx8IChmID0gW10pLCBmLnB1c2gobCwKICAgICAgICAgICAgICAgICAgYykpLCBjID0gazt9IGVsc2UgImRhbmdlcm91c2x5U2V0SW5uZXJIVE1MIiA9PT0gbCA/IChrID0gayA/IGsuX19odG1sIDogdm9pZCAwLCBoID0gaCA/IGguX19odG1sIDogdm9pZCAwLCBudWxsICE9IGsgJiYgaCAhPT0gayAmJiAoZiA9IGYgfHwgW10pLnB1c2gobCwgaykpIDogImNoaWxkcmVuIiA9PT0gbCA/ICJzdHJpbmciICE9PSB0eXBlb2YgayAmJiAibnVtYmVyIiAhPT0gdHlwZW9mIGsgfHwgKGYgPSBmIHx8IFtdKS5wdXNoKGwsICIiICsgaykgOiAic3VwcHJlc3NDb250ZW50RWRpdGFibGVXYXJuaW5nIiAhPT0gbCAmJiAic3VwcHJlc3NIeWRyYXRpb25XYXJuaW5nIiAhPT0gbCAmJiAoZWEuaGFzT3duUHJvcGVydHkobCkgPyAobnVsbCAhPSBrICYmICJvblNjcm9sbCIgPT09IGwgJiYgRCgic2Nyb2xsIiwgYSksIGYgfHwgaCA9PT0gayB8fCAoZiA9IFtdKSkgOiAoZiA9IGYgfHwgW10pLnB1c2gobCwgaykpO31jICYmIChmID0gZiB8fCBbXSkucHVzaCgic3R5bGUiLCBjKTt2YXIgbCA9IGY7aWYgKGIudXBkYXRlUXVldWUgPSBsKSBiLmZsYWdzIHw9IDQ7fX07RGogPSBmdW5jdGlvbiBEaihhLCBiLCBjLCBkKSB7YyAhPT0gZCAmJiAoYi5mbGFncyB8PSA0KTt9OwogICAgICAgICAgZnVuY3Rpb24gRWooYSwgYikge2lmICghSSkgc3dpdGNoIChhLnRhaWxNb2RlKSB7Y2FzZSAiaGlkZGVuIjpiID0gYS50YWlsO2ZvciAodmFyIGMgPSBudWxsOyBudWxsICE9PSBiOykge251bGwgIT09IGIuYWx0ZXJuYXRlICYmIChjID0gYiksIGIgPSBiLnNpYmxpbmc7fW51bGwgPT09IGMgPyBhLnRhaWwgPSBudWxsIDogYy5zaWJsaW5nID0gbnVsbDticmVhaztjYXNlICJjb2xsYXBzZWQiOmMgPSBhLnRhaWw7Zm9yICh2YXIgZCA9IG51bGw7IG51bGwgIT09IGM7KSB7bnVsbCAhPT0gYy5hbHRlcm5hdGUgJiYgKGQgPSBjKSwgYyA9IGMuc2libGluZzt9bnVsbCA9PT0gZCA/IGIgfHwgbnVsbCA9PT0gYS50YWlsID8gYS50YWlsID0gbnVsbCA6IGEudGFpbC5zaWJsaW5nID0gbnVsbCA6IGQuc2libGluZyA9IG51bGw7fX0KICAgICAgICAgIGZ1bmN0aW9uIFMoYSkge3ZhciBiID0gbnVsbCAhPT0gYS5hbHRlcm5hdGUgJiYgYS5hbHRlcm5hdGUuY2hpbGQgPT09IGEuY2hpbGQsYyA9IDAsZCA9IDA7aWYgKGIpIGZvciAodmFyIGUgPSBhLmNoaWxkOyBudWxsICE9PSBlOykge2MgfD0gZS5sYW5lcyB8IGUuY2hpbGRMYW5lcywgZCB8PSBlLnN1YnRyZWVGbGFncyAmIDE0NjgwMDY0LCBkIHw9IGUuZmxhZ3MgJiAxNDY4MDA2NCwgZS5yZXR1cm4gPSBhLCBlID0gZS5zaWJsaW5nO30gZWxzZSBmb3IgKGUgPSBhLmNoaWxkOyBudWxsICE9PSBlOykge2MgfD0gZS5sYW5lcyB8IGUuY2hpbGRMYW5lcywgZCB8PSBlLnN1YnRyZWVGbGFncywgZCB8PSBlLmZsYWdzLCBlLnJldHVybiA9IGEsIGUgPSBlLnNpYmxpbmc7fWEuc3VidHJlZUZsYWdzIHw9IGQ7YS5jaGlsZExhbmVzID0gYztyZXR1cm4gYjt9CiAgICAgICAgICBmdW5jdGlvbiBGaihhLCBiLCBjKSB7dmFyIGQgPSBiLnBlbmRpbmdQcm9wczt3ZyhiKTtzd2l0Y2ggKGIudGFnKSB7Y2FzZSAyOmNhc2UgMTY6Y2FzZSAxNTpjYXNlIDA6Y2FzZSAxMTpjYXNlIDc6Y2FzZSA4OmNhc2UgMTI6Y2FzZSA5OmNhc2UgMTQ6cmV0dXJuIFMoYiksIG51bGw7Y2FzZSAxOnJldHVybiBaZihiLnR5cGUpICYmICRmKCksIFMoYiksIG51bGw7Y2FzZSAzOmQgPSBiLnN0YXRlTm9kZTtKaCgpO0UoV2YpO0UoSCk7T2goKTtkLnBlbmRpbmdDb250ZXh0ICYmIChkLmNvbnRleHQgPSBkLnBlbmRpbmdDb250ZXh0LCBkLnBlbmRpbmdDb250ZXh0ID0gbnVsbCk7aWYgKG51bGwgPT09IGEgfHwgbnVsbCA9PT0gYS5jaGlsZCkgR2coYikgPyBiLmZsYWdzIHw9IDQgOiBudWxsID09PSBhIHx8IGEubWVtb2l6ZWRTdGF0ZS5pc0RlaHlkcmF0ZWQgJiYgMCA9PT0gKGIuZmxhZ3MgJiAyNTYpIHx8IChiLmZsYWdzIHw9IDEwMjQsIG51bGwgIT09IHpnICYmIChHaih6ZyksIHpnID0gbnVsbCkpO0JqKGEsIGIpO1MoYik7cmV0dXJuIG51bGw7Y2FzZSA1OkxoKGIpO3ZhciBlID0gSGgoR2guY3VycmVudCk7CiAgICAgICAgICAgICAgICBjID0gYi50eXBlO2lmIChudWxsICE9PSBhICYmIG51bGwgIT0gYi5zdGF0ZU5vZGUpIENqKGEsIGIsIGMsIGQsIGUpLCBhLnJlZiAhPT0gYi5yZWYgJiYgKGIuZmxhZ3MgfD0gNTEyLCBiLmZsYWdzIHw9IDIwOTcxNTIpO2Vsc2Uge2lmICghZCkge2lmIChudWxsID09PSBiLnN0YXRlTm9kZSkgdGhyb3cgRXJyb3IocCgxNjYpKTtTKGIpO3JldHVybiBudWxsO31hID0gSGgoRWguY3VycmVudCk7aWYgKEdnKGIpKSB7ZCA9IGIuc3RhdGVOb2RlO2MgPSBiLnR5cGU7dmFyIGYgPSBiLm1lbW9pemVkUHJvcHM7ZFtPZl0gPSBiO2RbUGZdID0gZjthID0gMCAhPT0gKGIubW9kZSAmIDEpO3N3aXRjaCAoYykge2Nhc2UgImRpYWxvZyI6RCgiY2FuY2VsIiwgZCk7RCgiY2xvc2UiLCBkKTticmVhaztjYXNlICJpZnJhbWUiOmNhc2UgIm9iamVjdCI6Y2FzZSAiZW1iZWQiOkQoImxvYWQiLCBkKTticmVhaztjYXNlICJ2aWRlbyI6Y2FzZSAiYXVkaW8iOmZvciAoZSA9IDA7IGUgPCBsZi5sZW5ndGg7IGUrKykge0QobGZbZV0sIGQpO31icmVhaztjYXNlICJzb3VyY2UiOkQoImVycm9yIiwgZCk7YnJlYWs7Y2FzZSAiaW1nIjpjYXNlICJpbWFnZSI6Y2FzZSAibGluayI6RCgiZXJyb3IiLAogICAgICAgICAgICAgICAgICAgICAgICBkKTtEKCJsb2FkIiwgZCk7YnJlYWs7Y2FzZSAiZGV0YWlscyI6RCgidG9nZ2xlIiwgZCk7YnJlYWs7Y2FzZSAiaW5wdXQiOlphKGQsIGYpO0QoImludmFsaWQiLCBkKTticmVhaztjYXNlICJzZWxlY3QiOmQuX3dyYXBwZXJTdGF0ZSA9IHsgd2FzTXVsdGlwbGU6ICEhZi5tdWx0aXBsZSB9O0QoImludmFsaWQiLCBkKTticmVhaztjYXNlICJ0ZXh0YXJlYSI6aGIoZCwgZiksIEQoImludmFsaWQiLCBkKTt9dWIoYywgZik7ZSA9IG51bGw7Zm9yICh2YXIgZyBpbiBmKSB7aWYgKGYuaGFzT3duUHJvcGVydHkoZykpIHt2YXIgaCA9IGZbZ107ImNoaWxkcmVuIiA9PT0gZyA/ICJzdHJpbmciID09PSB0eXBlb2YgaCA/IGQudGV4dENvbnRlbnQgIT09IGggJiYgKCEwICE9PSBmLnN1cHByZXNzSHlkcmF0aW9uV2FybmluZyAmJiBBZihkLnRleHRDb250ZW50LCBoLCBhKSwgZSA9IFsiY2hpbGRyZW4iLCBoXSkgOiAibnVtYmVyIiA9PT0gdHlwZW9mIGggJiYgZC50ZXh0Q29udGVudCAhPT0gIiIgKyBoICYmICghMCAhPT0gZi5zdXBwcmVzc0h5ZHJhdGlvbldhcm5pbmcgJiYgQWYoZC50ZXh0Q29udGVudCwKICAgICAgICAgICAgICAgICAgICAgICAgaCwgYSksIGUgPSBbImNoaWxkcmVuIiwgIiIgKyBoXSkgOiBlYS5oYXNPd25Qcm9wZXJ0eShnKSAmJiBudWxsICE9IGggJiYgIm9uU2Nyb2xsIiA9PT0gZyAmJiBEKCJzY3JvbGwiLCBkKTt9fXN3aXRjaCAoYykge2Nhc2UgImlucHV0IjpWYShkKTtkYihkLCBmLCAhMCk7YnJlYWs7Y2FzZSAidGV4dGFyZWEiOlZhKGQpO2piKGQpO2JyZWFrO2Nhc2UgInNlbGVjdCI6Y2FzZSAib3B0aW9uIjpicmVhaztkZWZhdWx0OiJmdW5jdGlvbiIgPT09IHR5cGVvZiBmLm9uQ2xpY2sgJiYgKGQub25jbGljayA9IEJmKTt9ZCA9IGU7Yi51cGRhdGVRdWV1ZSA9IGQ7bnVsbCAhPT0gZCAmJiAoYi5mbGFncyB8PSA0KTt9IGVsc2Uge2cgPSA5ID09PSBlLm5vZGVUeXBlID8gZSA6IGUub3duZXJEb2N1bWVudDsiaHR0cDovL3d3dy53My5vcmcvMTk5OS94aHRtbCIgPT09IGEgJiYgKGEgPSBrYihjKSk7Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGh0bWwiID09PSBhID8gInNjcmlwdCIgPT09IGMgPyAoYSA9IGcuY3JlYXRlRWxlbWVudCgiZGl2IiksIGEuaW5uZXJIVE1MID0gIjxzY3JpcHQ+XHgzYy9zY3JpcHQ+IiwgYSA9IGEucmVtb3ZlQ2hpbGQoYS5maXJzdENoaWxkKSkgOgogICAgICAgICAgICAgICAgICAgICJzdHJpbmciID09PSB0eXBlb2YgZC5pcyA/IGEgPSBnLmNyZWF0ZUVsZW1lbnQoYywgeyBpczogZC5pcyB9KSA6IChhID0gZy5jcmVhdGVFbGVtZW50KGMpLCAic2VsZWN0IiA9PT0gYyAmJiAoZyA9IGEsIGQubXVsdGlwbGUgPyBnLm11bHRpcGxlID0gITAgOiBkLnNpemUgJiYgKGcuc2l6ZSA9IGQuc2l6ZSkpKSA6IGEgPSBnLmNyZWF0ZUVsZW1lbnROUyhhLCBjKTthW09mXSA9IGI7YVtQZl0gPSBkO0FqKGEsIGIsICExLCAhMSk7Yi5zdGF0ZU5vZGUgPSBhO2E6IHtnID0gdmIoYywgZCk7c3dpdGNoIChjKSB7Y2FzZSAiZGlhbG9nIjpEKCJjYW5jZWwiLCBhKTtEKCJjbG9zZSIsIGEpO2UgPSBkO2JyZWFrO2Nhc2UgImlmcmFtZSI6Y2FzZSAib2JqZWN0IjpjYXNlICJlbWJlZCI6RCgibG9hZCIsIGEpO2UgPSBkO2JyZWFrO2Nhc2UgInZpZGVvIjpjYXNlICJhdWRpbyI6Zm9yIChlID0gMDsgZSA8IGxmLmxlbmd0aDsgZSsrKSB7RChsZltlXSwgYSk7fWUgPSBkO2JyZWFrO2Nhc2UgInNvdXJjZSI6RCgiZXJyb3IiLCBhKTtlID0gZDticmVhaztjYXNlICJpbWciOmNhc2UgImltYWdlIjpjYXNlICJsaW5rIjpEKCJlcnJvciIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgYSk7RCgibG9hZCIsIGEpO2UgPSBkO2JyZWFrO2Nhc2UgImRldGFpbHMiOkQoInRvZ2dsZSIsIGEpO2UgPSBkO2JyZWFrO2Nhc2UgImlucHV0IjpaYShhLCBkKTtlID0gWWEoYSwgZCk7RCgiaW52YWxpZCIsIGEpO2JyZWFrO2Nhc2UgIm9wdGlvbiI6ZSA9IGQ7YnJlYWs7Y2FzZSAic2VsZWN0IjphLl93cmFwcGVyU3RhdGUgPSB7IHdhc011bHRpcGxlOiAhIWQubXVsdGlwbGUgfTtlID0gQSh7fSwgZCwgeyB2YWx1ZTogdm9pZCAwIH0pO0QoImludmFsaWQiLCBhKTticmVhaztjYXNlICJ0ZXh0YXJlYSI6aGIoYSwgZCk7ZSA9IGdiKGEsIGQpO0QoImludmFsaWQiLCBhKTticmVhaztkZWZhdWx0OmUgPSBkO311YihjLCBlKTtoID0gZTtmb3IgKGYgaW4gaCkge2lmIChoLmhhc093blByb3BlcnR5KGYpKSB7dmFyIGsgPSBoW2ZdOyJzdHlsZSIgPT09IGYgPyBzYihhLCBrKSA6ICJkYW5nZXJvdXNseVNldElubmVySFRNTCIgPT09IGYgPyAoayA9IGsgPyBrLl9faHRtbCA6IHZvaWQgMCwgbnVsbCAhPSBrICYmIG5iKGEsIGspKSA6ICJjaGlsZHJlbiIgPT09IGYgPyAic3RyaW5nIiA9PT0gdHlwZW9mIGsgPyAoInRleHRhcmVhIiAhPT0KICAgICAgICAgICAgICAgICAgICAgICAgICBjIHx8ICIiICE9PSBrKSAmJiBvYihhLCBrKSA6ICJudW1iZXIiID09PSB0eXBlb2YgayAmJiBvYihhLCAiIiArIGspIDogInN1cHByZXNzQ29udGVudEVkaXRhYmxlV2FybmluZyIgIT09IGYgJiYgInN1cHByZXNzSHlkcmF0aW9uV2FybmluZyIgIT09IGYgJiYgImF1dG9Gb2N1cyIgIT09IGYgJiYgKGVhLmhhc093blByb3BlcnR5KGYpID8gbnVsbCAhPSBrICYmICJvblNjcm9sbCIgPT09IGYgJiYgRCgic2Nyb2xsIiwgYSkgOiBudWxsICE9IGsgJiYgdGEoYSwgZiwgaywgZykpO319c3dpdGNoIChjKSB7Y2FzZSAiaW5wdXQiOlZhKGEpO2RiKGEsIGQsICExKTticmVhaztjYXNlICJ0ZXh0YXJlYSI6VmEoYSk7amIoYSk7YnJlYWs7Y2FzZSAib3B0aW9uIjpudWxsICE9IGQudmFsdWUgJiYgYS5zZXRBdHRyaWJ1dGUoInZhbHVlIiwgIiIgKyBTYShkLnZhbHVlKSk7YnJlYWs7Y2FzZSAic2VsZWN0IjphLm11bHRpcGxlID0gISFkLm11bHRpcGxlO2YgPSBkLnZhbHVlO251bGwgIT0gZiA/IGZiKGEsICEhZC5tdWx0aXBsZSwgZiwgITEpIDogbnVsbCAhPSBkLmRlZmF1bHRWYWx1ZSAmJiBmYihhLCAhIWQubXVsdGlwbGUsIGQuZGVmYXVsdFZhbHVlLAogICAgICAgICAgICAgICAgICAgICAgICAgICEwKTticmVhaztkZWZhdWx0OiJmdW5jdGlvbiIgPT09IHR5cGVvZiBlLm9uQ2xpY2sgJiYgKGEub25jbGljayA9IEJmKTt9c3dpdGNoIChjKSB7Y2FzZSAiYnV0dG9uIjpjYXNlICJpbnB1dCI6Y2FzZSAic2VsZWN0IjpjYXNlICJ0ZXh0YXJlYSI6ZCA9ICEhZC5hdXRvRm9jdXM7YnJlYWsgYTtjYXNlICJpbWciOmQgPSAhMDticmVhayBhO2RlZmF1bHQ6ZCA9ICExO319ZCAmJiAoYi5mbGFncyB8PSA0KTt9bnVsbCAhPT0gYi5yZWYgJiYgKGIuZmxhZ3MgfD0gNTEyLCBiLmZsYWdzIHw9IDIwOTcxNTIpO31TKGIpO3JldHVybiBudWxsO2Nhc2UgNjppZiAoYSAmJiBudWxsICE9IGIuc3RhdGVOb2RlKSBEaihhLCBiLCBhLm1lbW9pemVkUHJvcHMsIGQpO2Vsc2Uge2lmICgic3RyaW5nIiAhPT0gdHlwZW9mIGQgJiYgbnVsbCA9PT0gYi5zdGF0ZU5vZGUpIHRocm93IEVycm9yKHAoMTY2KSk7YyA9IEhoKEdoLmN1cnJlbnQpO0hoKEVoLmN1cnJlbnQpO2lmIChHZyhiKSkge2QgPSBiLnN0YXRlTm9kZTtjID0gYi5tZW1vaXplZFByb3BzO2RbT2ZdID0gYjtpZiAoZiA9IGQubm9kZVZhbHVlICE9PSBjKSBpZiAoYSA9CiAgICAgICAgICAgICAgICAgICAgeGcsIG51bGwgIT09IGEpIHN3aXRjaCAoYS50YWcpIHtjYXNlIDM6QWYoZC5ub2RlVmFsdWUsIGMsIDAgIT09IChhLm1vZGUgJiAxKSk7YnJlYWs7Y2FzZSA1OiEwICE9PSBhLm1lbW9pemVkUHJvcHMuc3VwcHJlc3NIeWRyYXRpb25XYXJuaW5nICYmIEFmKGQubm9kZVZhbHVlLCBjLCAwICE9PSAoYS5tb2RlICYgMSkpO31mICYmIChiLmZsYWdzIHw9IDQpO30gZWxzZSBkID0gKDkgPT09IGMubm9kZVR5cGUgPyBjIDogYy5vd25lckRvY3VtZW50KS5jcmVhdGVUZXh0Tm9kZShkKSwgZFtPZl0gPSBiLCBiLnN0YXRlTm9kZSA9IGQ7fVMoYik7cmV0dXJuIG51bGw7Y2FzZSAxMzpFKE0pO2QgPSBiLm1lbW9pemVkU3RhdGU7aWYgKG51bGwgPT09IGEgfHwgbnVsbCAhPT0gYS5tZW1vaXplZFN0YXRlICYmIG51bGwgIT09IGEubWVtb2l6ZWRTdGF0ZS5kZWh5ZHJhdGVkKSB7aWYgKEkgJiYgbnVsbCAhPT0geWcgJiYgMCAhPT0gKGIubW9kZSAmIDEpICYmIDAgPT09IChiLmZsYWdzICYgMTI4KSkgSGcoKSwgSWcoKSwgYi5mbGFncyB8PSA5ODU2MCwgZiA9ICExO2Vsc2UgaWYgKGYgPSBHZyhiKSwgbnVsbCAhPT0gZCAmJiBudWxsICE9PSBkLmRlaHlkcmF0ZWQpIHtpZiAobnVsbCA9PT0KICAgICAgICAgICAgICAgICAgICBhKSB7aWYgKCFmKSB0aHJvdyBFcnJvcihwKDMxOCkpO2YgPSBiLm1lbW9pemVkU3RhdGU7ZiA9IG51bGwgIT09IGYgPyBmLmRlaHlkcmF0ZWQgOiBudWxsO2lmICghZikgdGhyb3cgRXJyb3IocCgzMTcpKTtmW09mXSA9IGI7fSBlbHNlIElnKCksIDAgPT09IChiLmZsYWdzICYgMTI4KSAmJiAoYi5tZW1vaXplZFN0YXRlID0gbnVsbCksIGIuZmxhZ3MgfD0gNDtTKGIpO2YgPSAhMTt9IGVsc2UgbnVsbCAhPT0gemcgJiYgKEdqKHpnKSwgemcgPSBudWxsKSwgZiA9ICEwO2lmICghZikgcmV0dXJuIGIuZmxhZ3MgJiA2NTUzNiA/IGIgOiBudWxsO31pZiAoMCAhPT0gKGIuZmxhZ3MgJiAxMjgpKSByZXR1cm4gYi5sYW5lcyA9IGMsIGI7ZCA9IG51bGwgIT09IGQ7ZCAhPT0gKG51bGwgIT09IGEgJiYgbnVsbCAhPT0gYS5tZW1vaXplZFN0YXRlKSAmJiBkICYmIChiLmNoaWxkLmZsYWdzIHw9IDgxOTIsIDAgIT09IChiLm1vZGUgJiAxKSAmJiAobnVsbCA9PT0gYSB8fCAwICE9PSAoTS5jdXJyZW50ICYgMSkgPyAwID09PSBUICYmIChUID0gMykgOiB1aigpKSk7bnVsbCAhPT0gYi51cGRhdGVRdWV1ZSAmJiAoYi5mbGFncyB8PSA0KTtTKGIpO3JldHVybiBudWxsO2Nhc2UgNDpyZXR1cm4gSmgoKSwKICAgICAgICAgICAgICAgIEJqKGEsIGIpLCBudWxsID09PSBhICYmIHNmKGIuc3RhdGVOb2RlLmNvbnRhaW5lckluZm8pLCBTKGIpLCBudWxsO2Nhc2UgMTA6cmV0dXJuIFJnKGIudHlwZS5fY29udGV4dCksIFMoYiksIG51bGw7Y2FzZSAxNzpyZXR1cm4gWmYoYi50eXBlKSAmJiAkZigpLCBTKGIpLCBudWxsO2Nhc2UgMTk6RShNKTtmID0gYi5tZW1vaXplZFN0YXRlO2lmIChudWxsID09PSBmKSByZXR1cm4gUyhiKSwgbnVsbDtkID0gMCAhPT0gKGIuZmxhZ3MgJiAxMjgpO2cgPSBmLnJlbmRlcmluZztpZiAobnVsbCA9PT0gZykge2lmIChkKSBFaihmLCAhMSk7ZWxzZSB7aWYgKDAgIT09IFQgfHwgbnVsbCAhPT0gYSAmJiAwICE9PSAoYS5mbGFncyAmIDEyOCkpIGZvciAoYSA9IGIuY2hpbGQ7IG51bGwgIT09IGE7KSB7ZyA9IE1oKGEpO2lmIChudWxsICE9PSBnKSB7Yi5mbGFncyB8PSAxMjg7RWooZiwgITEpO2QgPSBnLnVwZGF0ZVF1ZXVlO251bGwgIT09IGQgJiYgKGIudXBkYXRlUXVldWUgPSBkLCBiLmZsYWdzIHw9IDQpO2Iuc3VidHJlZUZsYWdzID0gMDtkID0gYztmb3IgKGMgPSBiLmNoaWxkOyBudWxsICE9PSBjOykge2YgPSBjLCBhID0gZCwgZi5mbGFncyAmPSAxNDY4MDA2NiwKICAgICAgICAgICAgICAgICAgICAgICAgICBnID0gZi5hbHRlcm5hdGUsIG51bGwgPT09IGcgPyAoZi5jaGlsZExhbmVzID0gMCwgZi5sYW5lcyA9IGEsIGYuY2hpbGQgPSBudWxsLCBmLnN1YnRyZWVGbGFncyA9IDAsIGYubWVtb2l6ZWRQcm9wcyA9IG51bGwsIGYubWVtb2l6ZWRTdGF0ZSA9IG51bGwsIGYudXBkYXRlUXVldWUgPSBudWxsLCBmLmRlcGVuZGVuY2llcyA9IG51bGwsIGYuc3RhdGVOb2RlID0gbnVsbCkgOiAoZi5jaGlsZExhbmVzID0gZy5jaGlsZExhbmVzLCBmLmxhbmVzID0gZy5sYW5lcywgZi5jaGlsZCA9IGcuY2hpbGQsIGYuc3VidHJlZUZsYWdzID0gMCwgZi5kZWxldGlvbnMgPSBudWxsLCBmLm1lbW9pemVkUHJvcHMgPSBnLm1lbW9pemVkUHJvcHMsIGYubWVtb2l6ZWRTdGF0ZSA9IGcubWVtb2l6ZWRTdGF0ZSwgZi51cGRhdGVRdWV1ZSA9IGcudXBkYXRlUXVldWUsIGYudHlwZSA9IGcudHlwZSwgYSA9IGcuZGVwZW5kZW5jaWVzLCBmLmRlcGVuZGVuY2llcyA9IG51bGwgPT09IGEgPyBudWxsIDogeyBsYW5lczogYS5sYW5lcywgZmlyc3RDb250ZXh0OiBhLmZpcnN0Q29udGV4dCB9KSwgYyA9IGMuc2libGluZzt9RyhNLCBNLmN1cnJlbnQgJiAxIHwgMik7cmV0dXJuIGIuY2hpbGQ7fWEgPQogICAgICAgICAgICAgICAgICAgICAgYS5zaWJsaW5nO31udWxsICE9PSBmLnRhaWwgJiYgQigpID4gSGogJiYgKGIuZmxhZ3MgfD0gMTI4LCBkID0gITAsIEVqKGYsICExKSwgYi5sYW5lcyA9IDQxOTQzMDQpO319IGVsc2Uge2lmICghZCkgaWYgKGEgPSBNaChnKSwgbnVsbCAhPT0gYSkge2lmIChiLmZsYWdzIHw9IDEyOCwgZCA9ICEwLCBjID0gYS51cGRhdGVRdWV1ZSwgbnVsbCAhPT0gYyAmJiAoYi51cGRhdGVRdWV1ZSA9IGMsIGIuZmxhZ3MgfD0gNCksIEVqKGYsICEwKSwgbnVsbCA9PT0gZi50YWlsICYmICJoaWRkZW4iID09PSBmLnRhaWxNb2RlICYmICFnLmFsdGVybmF0ZSAmJiAhSSkgcmV0dXJuIFMoYiksIG51bGw7fSBlbHNlIDIgKiBCKCkgLSBmLnJlbmRlcmluZ1N0YXJ0VGltZSA+IEhqICYmIDEwNzM3NDE4MjQgIT09IGMgJiYgKGIuZmxhZ3MgfD0gMTI4LCBkID0gITAsIEVqKGYsICExKSwgYi5sYW5lcyA9IDQxOTQzMDQpO2YuaXNCYWNrd2FyZHMgPyAoZy5zaWJsaW5nID0gYi5jaGlsZCwgYi5jaGlsZCA9IGcpIDogKGMgPSBmLmxhc3QsIG51bGwgIT09IGMgPyBjLnNpYmxpbmcgPSBnIDogYi5jaGlsZCA9IGcsIGYubGFzdCA9IGcpO31pZiAobnVsbCAhPT0gZi50YWlsKSByZXR1cm4gYiA9IGYudGFpbCwgZi5yZW5kZXJpbmcgPQogICAgICAgICAgICAgICAgYiwgZi50YWlsID0gYi5zaWJsaW5nLCBmLnJlbmRlcmluZ1N0YXJ0VGltZSA9IEIoKSwgYi5zaWJsaW5nID0gbnVsbCwgYyA9IE0uY3VycmVudCwgRyhNLCBkID8gYyAmIDEgfCAyIDogYyAmIDEpLCBiO1MoYik7cmV0dXJuIG51bGw7Y2FzZSAyMjpjYXNlIDIzOnJldHVybiBJaigpLCBkID0gbnVsbCAhPT0gYi5tZW1vaXplZFN0YXRlLCBudWxsICE9PSBhICYmIG51bGwgIT09IGEubWVtb2l6ZWRTdGF0ZSAhPT0gZCAmJiAoYi5mbGFncyB8PSA4MTkyKSwgZCAmJiAwICE9PSAoYi5tb2RlICYgMSkgPyAwICE9PSAoZ2ogJiAxMDczNzQxODI0KSAmJiAoUyhiKSwgYi5zdWJ0cmVlRmxhZ3MgJiA2ICYmIChiLmZsYWdzIHw9IDgxOTIpKSA6IFMoYiksIG51bGw7Y2FzZSAyNDpyZXR1cm4gbnVsbDtjYXNlIDI1OnJldHVybiBudWxsO310aHJvdyBFcnJvcihwKDE1NiwgYi50YWcpKTt9CiAgICAgICAgICBmdW5jdGlvbiBKaihhLCBiKSB7d2coYik7c3dpdGNoIChiLnRhZykge2Nhc2UgMTpyZXR1cm4gWmYoYi50eXBlKSAmJiAkZigpLCBhID0gYi5mbGFncywgYSAmIDY1NTM2ID8gKGIuZmxhZ3MgPSBhICYgLTY1NTM3IHwgMTI4LCBiKSA6IG51bGw7Y2FzZSAzOnJldHVybiBKaCgpLCBFKFdmKSwgRShIKSwgT2goKSwgYSA9IGIuZmxhZ3MsIDAgIT09IChhICYgNjU1MzYpICYmIDAgPT09IChhICYgMTI4KSA/IChiLmZsYWdzID0gYSAmIC02NTUzNyB8IDEyOCwgYikgOiBudWxsO2Nhc2UgNTpyZXR1cm4gTGgoYiksIG51bGw7Y2FzZSAxMzpFKE0pO2EgPSBiLm1lbW9pemVkU3RhdGU7aWYgKG51bGwgIT09IGEgJiYgbnVsbCAhPT0gYS5kZWh5ZHJhdGVkKSB7aWYgKG51bGwgPT09IGIuYWx0ZXJuYXRlKSB0aHJvdyBFcnJvcihwKDM0MCkpO0lnKCk7fWEgPSBiLmZsYWdzO3JldHVybiBhICYgNjU1MzYgPyAoYi5mbGFncyA9IGEgJiAtNjU1MzcgfCAxMjgsIGIpIDogbnVsbDtjYXNlIDE5OnJldHVybiBFKE0pLCBudWxsO2Nhc2UgNDpyZXR1cm4gSmgoKSwgbnVsbDtjYXNlIDEwOnJldHVybiBSZyhiLnR5cGUuX2NvbnRleHQpLCBudWxsO2Nhc2UgMjI6Y2FzZSAyMzpyZXR1cm4gSWooKSwKICAgICAgICAgICAgICAgIG51bGw7Y2FzZSAyNDpyZXR1cm4gbnVsbDtkZWZhdWx0OnJldHVybiBudWxsO319dmFyIEtqID0gITEsVSA9ICExLExqID0gImZ1bmN0aW9uIiA9PT0gdHlwZW9mIFdlYWtTZXQgPyBXZWFrU2V0IDogU2V0LFYgPSBudWxsO2Z1bmN0aW9uIE1qKGEsIGIpIHt2YXIgYyA9IGEucmVmO2lmIChudWxsICE9PSBjKSBpZiAoImZ1bmN0aW9uIiA9PT0gdHlwZW9mIGMpIHRyeSB7YyhudWxsKTt9IGNhdGNoIChkKSB7VyhhLCBiLCBkKTt9IGVsc2UgYy5jdXJyZW50ID0gbnVsbDt9ZnVuY3Rpb24gTmooYSwgYiwgYykge3RyeSB7YygpO30gY2F0Y2ggKGQpIHtXKGEsIGIsIGQpO319dmFyIE9qID0gITE7CiAgICAgICAgICBmdW5jdGlvbiBQaihhLCBiKSB7Q2YgPSBkZDthID0gTWUoKTtpZiAoTmUoYSkpIHtpZiAoInNlbGVjdGlvblN0YXJ0IiBpbiBhKSB2YXIgYyA9IHsgc3RhcnQ6IGEuc2VsZWN0aW9uU3RhcnQsIGVuZDogYS5zZWxlY3Rpb25FbmQgfTtlbHNlIGE6IHtjID0gKGMgPSBhLm93bmVyRG9jdW1lbnQpICYmIGMuZGVmYXVsdFZpZXcgfHwgd2luZG93O3ZhciBkID0gYy5nZXRTZWxlY3Rpb24gJiYgYy5nZXRTZWxlY3Rpb24oKTtpZiAoZCAmJiAwICE9PSBkLnJhbmdlQ291bnQpIHtjID0gZC5hbmNob3JOb2RlO3ZhciBlID0gZC5hbmNob3JPZmZzZXQsZiA9IGQuZm9jdXNOb2RlO2QgPSBkLmZvY3VzT2Zmc2V0O3RyeSB7Yy5ub2RlVHlwZSwgZi5ub2RlVHlwZTt9IGNhdGNoIChGKSB7YyA9IG51bGw7YnJlYWsgYTt9dmFyIGcgPSAwLGggPSAtMSxrID0gLTEsbCA9IDAsbSA9IDAscSA9IGEsciA9IG51bGw7YjogZm9yICg7Oykge2ZvciAodmFyIHk7Oykge3EgIT09IGMgfHwgMCAhPT0gZSAmJiAzICE9PSBxLm5vZGVUeXBlIHx8IChoID0gZyArIGUpO3EgIT09IGYgfHwgMCAhPT0gZCAmJiAzICE9PSBxLm5vZGVUeXBlIHx8IChrID0gZyArIGQpOzMgPT09IHEubm9kZVR5cGUgJiYgKGcgKz0KICAgICAgICAgICAgICAgICAgICAgIHEubm9kZVZhbHVlLmxlbmd0aCk7aWYgKG51bGwgPT09ICh5ID0gcS5maXJzdENoaWxkKSkgYnJlYWs7ciA9IHE7cSA9IHk7fWZvciAoOzspIHtpZiAocSA9PT0gYSkgYnJlYWsgYjtyID09PSBjICYmICsrbCA9PT0gZSAmJiAoaCA9IGcpO3IgPT09IGYgJiYgKyttID09PSBkICYmIChrID0gZyk7aWYgKG51bGwgIT09ICh5ID0gcS5uZXh0U2libGluZykpIGJyZWFrO3EgPSByO3IgPSBxLnBhcmVudE5vZGU7fXEgPSB5O31jID0gLTEgPT09IGggfHwgLTEgPT09IGsgPyBudWxsIDogeyBzdGFydDogaCwgZW5kOiBrIH07fSBlbHNlIGMgPSBudWxsO31jID0gYyB8fCB7IHN0YXJ0OiAwLCBlbmQ6IDAgfTt9IGVsc2UgYyA9IG51bGw7RGYgPSB7IGZvY3VzZWRFbGVtOiBhLCBzZWxlY3Rpb25SYW5nZTogYyB9O2RkID0gITE7Zm9yIChWID0gYjsgbnVsbCAhPT0gVjspIHtpZiAoYiA9IFYsIGEgPSBiLmNoaWxkLCAwICE9PSAoYi5zdWJ0cmVlRmxhZ3MgJiAxMDI4KSAmJiBudWxsICE9PSBhKSBhLnJldHVybiA9IGIsIFYgPSBhO2Vsc2UgZm9yICg7IG51bGwgIT09IFY7KSB7YiA9IFY7dHJ5IHt2YXIgbiA9IGIuYWx0ZXJuYXRlO2lmICgwICE9PSAoYi5mbGFncyAmIDEwMjQpKSBzd2l0Y2ggKGIudGFnKSB7Y2FzZSAwOmNhc2UgMTE6Y2FzZSAxNTpicmVhazsKICAgICAgICAgICAgICAgICAgICBjYXNlIDE6aWYgKG51bGwgIT09IG4pIHt2YXIgdCA9IG4ubWVtb2l6ZWRQcm9wcyxKID0gbi5tZW1vaXplZFN0YXRlLHggPSBiLnN0YXRlTm9kZSx3ID0geC5nZXRTbmFwc2hvdEJlZm9yZVVwZGF0ZShiLmVsZW1lbnRUeXBlID09PSBiLnR5cGUgPyB0IDogTGcoYi50eXBlLCB0KSwgSik7eC5fX3JlYWN0SW50ZXJuYWxTbmFwc2hvdEJlZm9yZVVwZGF0ZSA9IHc7fWJyZWFrO2Nhc2UgMzp2YXIgdSA9IGIuc3RhdGVOb2RlLmNvbnRhaW5lckluZm87MSA9PT0gdS5ub2RlVHlwZSA/IHUudGV4dENvbnRlbnQgPSAiIiA6IDkgPT09IHUubm9kZVR5cGUgJiYgdS5kb2N1bWVudEVsZW1lbnQgJiYgdS5yZW1vdmVDaGlsZCh1LmRvY3VtZW50RWxlbWVudCk7YnJlYWs7Y2FzZSA1OmNhc2UgNjpjYXNlIDQ6Y2FzZSAxNzpicmVhaztkZWZhdWx0OnRocm93IEVycm9yKHAoMTYzKSk7fX0gY2F0Y2ggKEYpIHtXKGIsIGIucmV0dXJuLCBGKTt9YSA9IGIuc2libGluZztpZiAobnVsbCAhPT0gYSkge2EucmV0dXJuID0gYi5yZXR1cm47ViA9IGE7YnJlYWs7fVYgPSBiLnJldHVybjt9fW4gPSBPajtPaiA9ICExO3JldHVybiBuO30KICAgICAgICAgIGZ1bmN0aW9uIFFqKGEsIGIsIGMpIHt2YXIgZCA9IGIudXBkYXRlUXVldWU7ZCA9IG51bGwgIT09IGQgPyBkLmxhc3RFZmZlY3QgOiBudWxsO2lmIChudWxsICE9PSBkKSB7dmFyIGUgPSBkID0gZC5uZXh0O2RvIHtpZiAoKGUudGFnICYgYSkgPT09IGEpIHt2YXIgZiA9IGUuZGVzdHJveTtlLmRlc3Ryb3kgPSB2b2lkIDA7dm9pZCAwICE9PSBmICYmIE5qKGIsIGMsIGYpO31lID0gZS5uZXh0O30gd2hpbGUgKGUgIT09IGQpO319ZnVuY3Rpb24gUmooYSwgYikge2IgPSBiLnVwZGF0ZVF1ZXVlO2IgPSBudWxsICE9PSBiID8gYi5sYXN0RWZmZWN0IDogbnVsbDtpZiAobnVsbCAhPT0gYikge3ZhciBjID0gYiA9IGIubmV4dDtkbyB7aWYgKChjLnRhZyAmIGEpID09PSBhKSB7dmFyIGQgPSBjLmNyZWF0ZTtjLmRlc3Ryb3kgPSBkKCk7fWMgPSBjLm5leHQ7fSB3aGlsZSAoYyAhPT0gYik7fX1mdW5jdGlvbiBTaihhKSB7dmFyIGIgPSBhLnJlZjtpZiAobnVsbCAhPT0gYikge3ZhciBjID0gYS5zdGF0ZU5vZGU7c3dpdGNoIChhLnRhZykge2Nhc2UgNTphID0gYzticmVhaztkZWZhdWx0OmEgPSBjO30iZnVuY3Rpb24iID09PSB0eXBlb2YgYiA/IGIoYSkgOiBiLmN1cnJlbnQgPSBhO319CiAgICAgICAgICBmdW5jdGlvbiBUaihhKSB7dmFyIGIgPSBhLmFsdGVybmF0ZTtudWxsICE9PSBiICYmIChhLmFsdGVybmF0ZSA9IG51bGwsIFRqKGIpKTthLmNoaWxkID0gbnVsbDthLmRlbGV0aW9ucyA9IG51bGw7YS5zaWJsaW5nID0gbnVsbDs1ID09PSBhLnRhZyAmJiAoYiA9IGEuc3RhdGVOb2RlLCBudWxsICE9PSBiICYmIChkZWxldGUgYltPZl0sIGRlbGV0ZSBiW1BmXSwgZGVsZXRlIGJbb2ZdLCBkZWxldGUgYltRZl0sIGRlbGV0ZSBiW1JmXSkpO2Euc3RhdGVOb2RlID0gbnVsbDthLnJldHVybiA9IG51bGw7YS5kZXBlbmRlbmNpZXMgPSBudWxsO2EubWVtb2l6ZWRQcm9wcyA9IG51bGw7YS5tZW1vaXplZFN0YXRlID0gbnVsbDthLnBlbmRpbmdQcm9wcyA9IG51bGw7YS5zdGF0ZU5vZGUgPSBudWxsO2EudXBkYXRlUXVldWUgPSBudWxsO31mdW5jdGlvbiBVaihhKSB7cmV0dXJuIDUgPT09IGEudGFnIHx8IDMgPT09IGEudGFnIHx8IDQgPT09IGEudGFnO30KICAgICAgICAgIGZ1bmN0aW9uIFZqKGEpIHthOiBmb3IgKDs7KSB7Zm9yICg7IG51bGwgPT09IGEuc2libGluZzspIHtpZiAobnVsbCA9PT0gYS5yZXR1cm4gfHwgVWooYS5yZXR1cm4pKSByZXR1cm4gbnVsbDthID0gYS5yZXR1cm47fWEuc2libGluZy5yZXR1cm4gPSBhLnJldHVybjtmb3IgKGEgPSBhLnNpYmxpbmc7IDUgIT09IGEudGFnICYmIDYgIT09IGEudGFnICYmIDE4ICE9PSBhLnRhZzspIHtpZiAoYS5mbGFncyAmIDIpIGNvbnRpbnVlIGE7aWYgKG51bGwgPT09IGEuY2hpbGQgfHwgNCA9PT0gYS50YWcpIGNvbnRpbnVlIGE7ZWxzZSBhLmNoaWxkLnJldHVybiA9IGEsIGEgPSBhLmNoaWxkO31pZiAoIShhLmZsYWdzICYgMikpIHJldHVybiBhLnN0YXRlTm9kZTt9fQogICAgICAgICAgZnVuY3Rpb24gV2ooYSwgYiwgYykge3ZhciBkID0gYS50YWc7aWYgKDUgPT09IGQgfHwgNiA9PT0gZCkgYSA9IGEuc3RhdGVOb2RlLCBiID8gOCA9PT0gYy5ub2RlVHlwZSA/IGMucGFyZW50Tm9kZS5pbnNlcnRCZWZvcmUoYSwgYikgOiBjLmluc2VydEJlZm9yZShhLCBiKSA6ICg4ID09PSBjLm5vZGVUeXBlID8gKGIgPSBjLnBhcmVudE5vZGUsIGIuaW5zZXJ0QmVmb3JlKGEsIGMpKSA6IChiID0gYywgYi5hcHBlbmRDaGlsZChhKSksIGMgPSBjLl9yZWFjdFJvb3RDb250YWluZXIsIG51bGwgIT09IGMgJiYgdm9pZCAwICE9PSBjIHx8IG51bGwgIT09IGIub25jbGljayB8fCAoYi5vbmNsaWNrID0gQmYpKTtlbHNlIGlmICg0ICE9PSBkICYmIChhID0gYS5jaGlsZCwgbnVsbCAhPT0gYSkpIGZvciAoV2ooYSwgYiwgYyksIGEgPSBhLnNpYmxpbmc7IG51bGwgIT09IGE7KSB7V2ooYSwgYiwgYyksIGEgPSBhLnNpYmxpbmc7fX0KICAgICAgICAgIGZ1bmN0aW9uIFhqKGEsIGIsIGMpIHt2YXIgZCA9IGEudGFnO2lmICg1ID09PSBkIHx8IDYgPT09IGQpIGEgPSBhLnN0YXRlTm9kZSwgYiA/IGMuaW5zZXJ0QmVmb3JlKGEsIGIpIDogYy5hcHBlbmRDaGlsZChhKTtlbHNlIGlmICg0ICE9PSBkICYmIChhID0gYS5jaGlsZCwgbnVsbCAhPT0gYSkpIGZvciAoWGooYSwgYiwgYyksIGEgPSBhLnNpYmxpbmc7IG51bGwgIT09IGE7KSB7WGooYSwgYiwgYyksIGEgPSBhLnNpYmxpbmc7fX12YXIgWCA9IG51bGwsWWogPSAhMTtmdW5jdGlvbiBaaihhLCBiLCBjKSB7Zm9yIChjID0gYy5jaGlsZDsgbnVsbCAhPT0gYzspIHthayhhLCBiLCBjKSwgYyA9IGMuc2libGluZzt9fQogICAgICAgICAgZnVuY3Rpb24gYWsoYSwgYiwgYykge2lmIChsYyAmJiAiZnVuY3Rpb24iID09PSB0eXBlb2YgbGMub25Db21taXRGaWJlclVubW91bnQpIHRyeSB7bGMub25Db21taXRGaWJlclVubW91bnQoa2MsIGMpO30gY2F0Y2ggKGgpIHt9c3dpdGNoIChjLnRhZykge2Nhc2UgNTpVIHx8IE1qKGMsIGIpO2Nhc2UgNjp2YXIgZCA9IFgsZSA9IFlqO1ggPSBudWxsO1pqKGEsIGIsIGMpO1ggPSBkO1lqID0gZTtudWxsICE9PSBYICYmIChZaiA/IChhID0gWCwgYyA9IGMuc3RhdGVOb2RlLCA4ID09PSBhLm5vZGVUeXBlID8gYS5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKGMpIDogYS5yZW1vdmVDaGlsZChjKSkgOiBYLnJlbW92ZUNoaWxkKGMuc3RhdGVOb2RlKSk7YnJlYWs7Y2FzZSAxODpudWxsICE9PSBYICYmIChZaiA/IChhID0gWCwgYyA9IGMuc3RhdGVOb2RlLCA4ID09PSBhLm5vZGVUeXBlID8gS2YoYS5wYXJlbnROb2RlLCBjKSA6IDEgPT09IGEubm9kZVR5cGUgJiYgS2YoYSwgYyksIGJkKGEpKSA6IEtmKFgsIGMuc3RhdGVOb2RlKSk7YnJlYWs7Y2FzZSA0OmQgPSBYO2UgPSBZajtYID0gYy5zdGF0ZU5vZGUuY29udGFpbmVySW5mbztZaiA9ICEwOwogICAgICAgICAgICAgICAgWmooYSwgYiwgYyk7WCA9IGQ7WWogPSBlO2JyZWFrO2Nhc2UgMDpjYXNlIDExOmNhc2UgMTQ6Y2FzZSAxNTppZiAoIVUgJiYgKGQgPSBjLnVwZGF0ZVF1ZXVlLCBudWxsICE9PSBkICYmIChkID0gZC5sYXN0RWZmZWN0LCBudWxsICE9PSBkKSkpIHtlID0gZCA9IGQubmV4dDtkbyB7dmFyIGYgPSBlLGcgPSBmLmRlc3Ryb3k7ZiA9IGYudGFnO3ZvaWQgMCAhPT0gZyAmJiAoMCAhPT0gKGYgJiAyKSA/IE5qKGMsIGIsIGcpIDogMCAhPT0gKGYgJiA0KSAmJiBOaihjLCBiLCBnKSk7ZSA9IGUubmV4dDt9IHdoaWxlIChlICE9PSBkKTt9WmooYSwgYiwgYyk7YnJlYWs7Y2FzZSAxOmlmICghVSAmJiAoTWooYywgYiksIGQgPSBjLnN0YXRlTm9kZSwgImZ1bmN0aW9uIiA9PT0gdHlwZW9mIGQuY29tcG9uZW50V2lsbFVubW91bnQpKSB0cnkge2QucHJvcHMgPSBjLm1lbW9pemVkUHJvcHMsIGQuc3RhdGUgPSBjLm1lbW9pemVkU3RhdGUsIGQuY29tcG9uZW50V2lsbFVubW91bnQoKTt9IGNhdGNoIChoKSB7VyhjLCBiLCBoKTt9WmooYSwgYiwgYyk7YnJlYWs7Y2FzZSAyMTpaaihhLCBiLCBjKTticmVhaztjYXNlIDIyOmMubW9kZSAmIDEgPyAoVSA9IChkID0gVSkgfHwgbnVsbCAhPT0KICAgICAgICAgICAgICAgIGMubWVtb2l6ZWRTdGF0ZSwgWmooYSwgYiwgYyksIFUgPSBkKSA6IFpqKGEsIGIsIGMpO2JyZWFrO2RlZmF1bHQ6WmooYSwgYiwgYyk7fX1mdW5jdGlvbiBiayhhKSB7dmFyIGIgPSBhLnVwZGF0ZVF1ZXVlO2lmIChudWxsICE9PSBiKSB7YS51cGRhdGVRdWV1ZSA9IG51bGw7dmFyIGMgPSBhLnN0YXRlTm9kZTtudWxsID09PSBjICYmIChjID0gYS5zdGF0ZU5vZGUgPSBuZXcgTGooKSk7Yi5mb3JFYWNoKGZ1bmN0aW9uIChiKSB7dmFyIGQgPSBjay5iaW5kKG51bGwsIGEsIGIpO2MuaGFzKGIpIHx8IChjLmFkZChiKSwgYi50aGVuKGQsIGQpKTt9KTt9fQogICAgICAgICAgZnVuY3Rpb24gZGsoYSwgYikge3ZhciBjID0gYi5kZWxldGlvbnM7aWYgKG51bGwgIT09IGMpIGZvciAodmFyIGQgPSAwOyBkIDwgYy5sZW5ndGg7IGQrKykge3ZhciBlID0gY1tkXTt0cnkge3ZhciBmID0gYSxnID0gYixoID0gZzthOiBmb3IgKDsgbnVsbCAhPT0gaDspIHtzd2l0Y2ggKGgudGFnKSB7Y2FzZSA1OlggPSBoLnN0YXRlTm9kZTtZaiA9ICExO2JyZWFrIGE7Y2FzZSAzOlggPSBoLnN0YXRlTm9kZS5jb250YWluZXJJbmZvO1lqID0gITA7YnJlYWsgYTtjYXNlIDQ6WCA9IGguc3RhdGVOb2RlLmNvbnRhaW5lckluZm87WWogPSAhMDticmVhayBhO31oID0gaC5yZXR1cm47fWlmIChudWxsID09PSBYKSB0aHJvdyBFcnJvcihwKDE2MCkpO2FrKGYsIGcsIGUpO1ggPSBudWxsO1lqID0gITE7dmFyIGsgPSBlLmFsdGVybmF0ZTtudWxsICE9PSBrICYmIChrLnJldHVybiA9IG51bGwpO2UucmV0dXJuID0gbnVsbDt9IGNhdGNoIChsKSB7VyhlLCBiLCBsKTt9fWlmIChiLnN1YnRyZWVGbGFncyAmIDEyODU0KSBmb3IgKGIgPSBiLmNoaWxkOyBudWxsICE9PSBiOykge2VrKGIsIGEpLCBiID0gYi5zaWJsaW5nO319CiAgICAgICAgICBmdW5jdGlvbiBlayhhLCBiKSB7dmFyIGMgPSBhLmFsdGVybmF0ZSxkID0gYS5mbGFncztzd2l0Y2ggKGEudGFnKSB7Y2FzZSAwOmNhc2UgMTE6Y2FzZSAxNDpjYXNlIDE1OmRrKGIsIGEpO2ZrKGEpO2lmIChkICYgNCkge3RyeSB7UWooMywgYSwgYS5yZXR1cm4pLCBSaigzLCBhKTt9IGNhdGNoICh0KSB7VyhhLCBhLnJldHVybiwgdCk7fXRyeSB7UWooNSwgYSwgYS5yZXR1cm4pO30gY2F0Y2ggKHQpIHtXKGEsIGEucmV0dXJuLCB0KTt9fWJyZWFrO2Nhc2UgMTpkayhiLCBhKTtmayhhKTtkICYgNTEyICYmIG51bGwgIT09IGMgJiYgTWooYywgYy5yZXR1cm4pO2JyZWFrO2Nhc2UgNTpkayhiLCBhKTtmayhhKTtkICYgNTEyICYmIG51bGwgIT09IGMgJiYgTWooYywgYy5yZXR1cm4pO2lmIChhLmZsYWdzICYgMzIpIHt2YXIgZSA9IGEuc3RhdGVOb2RlO3RyeSB7b2IoZSwgIiIpO30gY2F0Y2ggKHQpIHtXKGEsIGEucmV0dXJuLCB0KTt9fWlmIChkICYgNCAmJiAoZSA9IGEuc3RhdGVOb2RlLCBudWxsICE9IGUpKSB7dmFyIGYgPSBhLm1lbW9pemVkUHJvcHMsZyA9IG51bGwgIT09IGMgPyBjLm1lbW9pemVkUHJvcHMgOiBmLGggPSBhLnR5cGUsayA9IGEudXBkYXRlUXVldWU7CiAgICAgICAgICAgICAgICAgIGEudXBkYXRlUXVldWUgPSBudWxsO2lmIChudWxsICE9PSBrKSB0cnkgeyJpbnB1dCIgPT09IGggJiYgInJhZGlvIiA9PT0gZi50eXBlICYmIG51bGwgIT0gZi5uYW1lICYmIGFiKGUsIGYpO3ZiKGgsIGcpO3ZhciBsID0gdmIoaCwgZik7Zm9yIChnID0gMDsgZyA8IGsubGVuZ3RoOyBnICs9IDIpIHt2YXIgbSA9IGtbZ10scSA9IGtbZyArIDFdOyJzdHlsZSIgPT09IG0gPyBzYihlLCBxKSA6ICJkYW5nZXJvdXNseVNldElubmVySFRNTCIgPT09IG0gPyBuYihlLCBxKSA6ICJjaGlsZHJlbiIgPT09IG0gPyBvYihlLCBxKSA6IHRhKGUsIG0sIHEsIGwpO31zd2l0Y2ggKGgpIHtjYXNlICJpbnB1dCI6YmIoZSwgZik7YnJlYWs7Y2FzZSAidGV4dGFyZWEiOmliKGUsIGYpO2JyZWFrO2Nhc2UgInNlbGVjdCI6dmFyIHIgPSBlLl93cmFwcGVyU3RhdGUud2FzTXVsdGlwbGU7ZS5fd3JhcHBlclN0YXRlLndhc011bHRpcGxlID0gISFmLm11bHRpcGxlO3ZhciB5ID0gZi52YWx1ZTtudWxsICE9IHkgPyBmYihlLCAhIWYubXVsdGlwbGUsIHksICExKSA6IHIgIT09ICEhZi5tdWx0aXBsZSAmJiAobnVsbCAhPSBmLmRlZmF1bHRWYWx1ZSA/IGZiKGUsICEhZi5tdWx0aXBsZSwKICAgICAgICAgICAgICAgICAgICAgICAgZi5kZWZhdWx0VmFsdWUsICEwKSA6IGZiKGUsICEhZi5tdWx0aXBsZSwgZi5tdWx0aXBsZSA/IFtdIDogIiIsICExKSk7fWVbUGZdID0gZjt9IGNhdGNoICh0KSB7VyhhLCBhLnJldHVybiwgdCk7fX1icmVhaztjYXNlIDY6ZGsoYiwgYSk7ZmsoYSk7aWYgKGQgJiA0KSB7aWYgKG51bGwgPT09IGEuc3RhdGVOb2RlKSB0aHJvdyBFcnJvcihwKDE2MikpO2UgPSBhLnN0YXRlTm9kZTtmID0gYS5tZW1vaXplZFByb3BzO3RyeSB7ZS5ub2RlVmFsdWUgPSBmO30gY2F0Y2ggKHQpIHtXKGEsIGEucmV0dXJuLCB0KTt9fWJyZWFrO2Nhc2UgMzpkayhiLCBhKTtmayhhKTtpZiAoZCAmIDQgJiYgbnVsbCAhPT0gYyAmJiBjLm1lbW9pemVkU3RhdGUuaXNEZWh5ZHJhdGVkKSB0cnkge2JkKGIuY29udGFpbmVySW5mbyk7fSBjYXRjaCAodCkge1coYSwgYS5yZXR1cm4sIHQpO31icmVhaztjYXNlIDQ6ZGsoYiwgYSk7ZmsoYSk7YnJlYWs7Y2FzZSAxMzpkayhiLCBhKTtmayhhKTtlID0gYS5jaGlsZDtlLmZsYWdzICYgODE5MiAmJiAoZiA9IG51bGwgIT09IGUubWVtb2l6ZWRTdGF0ZSwgZS5zdGF0ZU5vZGUuaXNIaWRkZW4gPSBmLCAhZiB8fAogICAgICAgICAgICAgICAgbnVsbCAhPT0gZS5hbHRlcm5hdGUgJiYgbnVsbCAhPT0gZS5hbHRlcm5hdGUubWVtb2l6ZWRTdGF0ZSB8fCAoZ2sgPSBCKCkpKTtkICYgNCAmJiBiayhhKTticmVhaztjYXNlIDIyOm0gPSBudWxsICE9PSBjICYmIG51bGwgIT09IGMubWVtb2l6ZWRTdGF0ZTthLm1vZGUgJiAxID8gKFUgPSAobCA9IFUpIHx8IG0sIGRrKGIsIGEpLCBVID0gbCkgOiBkayhiLCBhKTtmayhhKTtpZiAoZCAmIDgxOTIpIHtsID0gbnVsbCAhPT0gYS5tZW1vaXplZFN0YXRlO2lmICgoYS5zdGF0ZU5vZGUuaXNIaWRkZW4gPSBsKSAmJiAhbSAmJiAwICE9PSAoYS5tb2RlICYgMSkpIGZvciAoViA9IGEsIG0gPSBhLmNoaWxkOyBudWxsICE9PSBtOykge2ZvciAocSA9IFYgPSBtOyBudWxsICE9PSBWOykge3IgPSBWO3kgPSByLmNoaWxkO3N3aXRjaCAoci50YWcpIHtjYXNlIDA6Y2FzZSAxMTpjYXNlIDE0OmNhc2UgMTU6UWooNCwgciwgci5yZXR1cm4pO2JyZWFrO2Nhc2UgMTpNaihyLCByLnJldHVybik7dmFyIG4gPSByLnN0YXRlTm9kZTtpZiAoImZ1bmN0aW9uIiA9PT0gdHlwZW9mIG4uY29tcG9uZW50V2lsbFVubW91bnQpIHtkID0gcjtjID0gci5yZXR1cm47dHJ5IHtiID0gZCwgbi5wcm9wcyA9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGIubWVtb2l6ZWRQcm9wcywgbi5zdGF0ZSA9IGIubWVtb2l6ZWRTdGF0ZSwgbi5jb21wb25lbnRXaWxsVW5tb3VudCgpO30gY2F0Y2ggKHQpIHtXKGQsIGMsIHQpO319YnJlYWs7Y2FzZSA1Ok1qKHIsIHIucmV0dXJuKTticmVhaztjYXNlIDIyOmlmIChudWxsICE9PSByLm1lbW9pemVkU3RhdGUpIHtoayhxKTtjb250aW51ZTt9fW51bGwgIT09IHkgPyAoeS5yZXR1cm4gPSByLCBWID0geSkgOiBoayhxKTt9bSA9IG0uc2libGluZzt9YTogZm9yIChtID0gbnVsbCwgcSA9IGE7Oykge2lmICg1ID09PSBxLnRhZykge2lmIChudWxsID09PSBtKSB7bSA9IHE7dHJ5IHtlID0gcS5zdGF0ZU5vZGUsIGwgPyAoZiA9IGUuc3R5bGUsICJmdW5jdGlvbiIgPT09IHR5cGVvZiBmLnNldFByb3BlcnR5ID8gZi5zZXRQcm9wZXJ0eSgiZGlzcGxheSIsICJub25lIiwgImltcG9ydGFudCIpIDogZi5kaXNwbGF5ID0gIm5vbmUiKSA6IChoID0gcS5zdGF0ZU5vZGUsIGsgPSBxLm1lbW9pemVkUHJvcHMuc3R5bGUsIGcgPSB2b2lkIDAgIT09IGsgJiYgbnVsbCAhPT0gayAmJiBrLmhhc093blByb3BlcnR5KCJkaXNwbGF5IikgPyBrLmRpc3BsYXkgOiBudWxsLCBoLnN0eWxlLmRpc3BsYXkgPQogICAgICAgICAgICAgICAgICAgICAgICAgIHJiKCJkaXNwbGF5IiwgZykpO30gY2F0Y2ggKHQpIHtXKGEsIGEucmV0dXJuLCB0KTt9fX0gZWxzZSBpZiAoNiA9PT0gcS50YWcpIHtpZiAobnVsbCA9PT0gbSkgdHJ5IHtxLnN0YXRlTm9kZS5ub2RlVmFsdWUgPSBsID8gIiIgOiBxLm1lbW9pemVkUHJvcHM7fSBjYXRjaCAodCkge1coYSwgYS5yZXR1cm4sIHQpO319IGVsc2UgaWYgKCgyMiAhPT0gcS50YWcgJiYgMjMgIT09IHEudGFnIHx8IG51bGwgPT09IHEubWVtb2l6ZWRTdGF0ZSB8fCBxID09PSBhKSAmJiBudWxsICE9PSBxLmNoaWxkKSB7cS5jaGlsZC5yZXR1cm4gPSBxO3EgPSBxLmNoaWxkO2NvbnRpbnVlO31pZiAocSA9PT0gYSkgYnJlYWsgYTtmb3IgKDsgbnVsbCA9PT0gcS5zaWJsaW5nOykge2lmIChudWxsID09PSBxLnJldHVybiB8fCBxLnJldHVybiA9PT0gYSkgYnJlYWsgYTttID09PSBxICYmIChtID0gbnVsbCk7cSA9IHEucmV0dXJuO31tID09PSBxICYmIChtID0gbnVsbCk7cS5zaWJsaW5nLnJldHVybiA9IHEucmV0dXJuO3EgPSBxLnNpYmxpbmc7fX1icmVhaztjYXNlIDE5OmRrKGIsIGEpO2ZrKGEpO2QgJiA0ICYmIGJrKGEpO2JyZWFrO2Nhc2UgMjE6YnJlYWs7ZGVmYXVsdDpkayhiLAogICAgICAgICAgICAgICAgYSksIGZrKGEpO319ZnVuY3Rpb24gZmsoYSkge3ZhciBiID0gYS5mbGFncztpZiAoYiAmIDIpIHt0cnkge2E6IHtmb3IgKHZhciBjID0gYS5yZXR1cm47IG51bGwgIT09IGM7KSB7aWYgKFVqKGMpKSB7dmFyIGQgPSBjO2JyZWFrIGE7fWMgPSBjLnJldHVybjt9dGhyb3cgRXJyb3IocCgxNjApKTt9c3dpdGNoIChkLnRhZykge2Nhc2UgNTp2YXIgZSA9IGQuc3RhdGVOb2RlO2QuZmxhZ3MgJiAzMiAmJiAob2IoZSwgIiIpLCBkLmZsYWdzICY9IC0zMyk7dmFyIGYgPSBWaihhKTtYaihhLCBmLCBlKTticmVhaztjYXNlIDM6Y2FzZSA0OnZhciBnID0gZC5zdGF0ZU5vZGUuY29udGFpbmVySW5mbyxoID0gVmooYSk7V2ooYSwgaCwgZyk7YnJlYWs7ZGVmYXVsdDp0aHJvdyBFcnJvcihwKDE2MSkpO319IGNhdGNoIChrKSB7VyhhLCBhLnJldHVybiwgayk7fWEuZmxhZ3MgJj0gLTM7fWIgJiA0MDk2ICYmIChhLmZsYWdzICY9IC00MDk3KTt9ZnVuY3Rpb24gaWsoYSwgYiwgYykge1YgPSBhO2prKGEsIGIsIGMpO30KICAgICAgICAgIGZ1bmN0aW9uIGprKGEsIGIsIGMpIHtmb3IgKHZhciBkID0gMCAhPT0gKGEubW9kZSAmIDEpOyBudWxsICE9PSBWOykge3ZhciBlID0gVixmID0gZS5jaGlsZDtpZiAoMjIgPT09IGUudGFnICYmIGQpIHt2YXIgZyA9IG51bGwgIT09IGUubWVtb2l6ZWRTdGF0ZSB8fCBLajtpZiAoIWcpIHt2YXIgaCA9IGUuYWx0ZXJuYXRlLGsgPSBudWxsICE9PSBoICYmIG51bGwgIT09IGgubWVtb2l6ZWRTdGF0ZSB8fCBVO2ggPSBLajt2YXIgbCA9IFU7S2ogPSBnO2lmICgoVSA9IGspICYmICFsKSBmb3IgKFYgPSBlOyBudWxsICE9PSBWOykge2cgPSBWLCBrID0gZy5jaGlsZCwgMjIgPT09IGcudGFnICYmIG51bGwgIT09IGcubWVtb2l6ZWRTdGF0ZSA/IGtrKGUpIDogbnVsbCAhPT0gayA/IChrLnJldHVybiA9IGcsIFYgPSBrKSA6IGtrKGUpO31mb3IgKDsgbnVsbCAhPT0gZjspIHtWID0gZiwgamsoZiwgYiwgYyksIGYgPSBmLnNpYmxpbmc7fVYgPSBlO0tqID0gaDtVID0gbDt9bGsoYSwgYiwgYyk7fSBlbHNlIDAgIT09IChlLnN1YnRyZWVGbGFncyAmIDg3NzIpICYmIG51bGwgIT09IGYgPyAoZi5yZXR1cm4gPSBlLCBWID0gZikgOiBsayhhLCBiLCBjKTt9fQogICAgICAgICAgZnVuY3Rpb24gbGsoYSkge2ZvciAoOyBudWxsICE9PSBWOykge3ZhciBiID0gVjtpZiAoMCAhPT0gKGIuZmxhZ3MgJiA4NzcyKSkge3ZhciBjID0gYi5hbHRlcm5hdGU7dHJ5IHtpZiAoMCAhPT0gKGIuZmxhZ3MgJiA4NzcyKSkgc3dpdGNoIChiLnRhZykge2Nhc2UgMDpjYXNlIDExOmNhc2UgMTU6VSB8fCBSaig1LCBiKTticmVhaztjYXNlIDE6dmFyIGQgPSBiLnN0YXRlTm9kZTtpZiAoYi5mbGFncyAmIDQgJiYgIVUpIGlmIChudWxsID09PSBjKSBkLmNvbXBvbmVudERpZE1vdW50KCk7ZWxzZSB7dmFyIGUgPSBiLmVsZW1lbnRUeXBlID09PSBiLnR5cGUgPyBjLm1lbW9pemVkUHJvcHMgOiBMZyhiLnR5cGUsIGMubWVtb2l6ZWRQcm9wcyk7ZC5jb21wb25lbnREaWRVcGRhdGUoZSwgYy5tZW1vaXplZFN0YXRlLCBkLl9fcmVhY3RJbnRlcm5hbFNuYXBzaG90QmVmb3JlVXBkYXRlKTt9dmFyIGYgPSBiLnVwZGF0ZVF1ZXVlO251bGwgIT09IGYgJiYgaWgoYiwgZiwgZCk7YnJlYWs7Y2FzZSAzOnZhciBnID0gYi51cGRhdGVRdWV1ZTtpZiAobnVsbCAhPT0gZykge2MgPSBudWxsO2lmIChudWxsICE9PSBiLmNoaWxkKSBzd2l0Y2ggKGIuY2hpbGQudGFnKSB7Y2FzZSA1OmMgPQogICAgICAgICAgICAgICAgICAgICAgICAgICAgYi5jaGlsZC5zdGF0ZU5vZGU7YnJlYWs7Y2FzZSAxOmMgPSBiLmNoaWxkLnN0YXRlTm9kZTt9aWgoYiwgZywgYyk7fWJyZWFrO2Nhc2UgNTp2YXIgaCA9IGIuc3RhdGVOb2RlO2lmIChudWxsID09PSBjICYmIGIuZmxhZ3MgJiA0KSB7YyA9IGg7dmFyIGsgPSBiLm1lbW9pemVkUHJvcHM7c3dpdGNoIChiLnR5cGUpIHtjYXNlICJidXR0b24iOmNhc2UgImlucHV0IjpjYXNlICJzZWxlY3QiOmNhc2UgInRleHRhcmVhIjprLmF1dG9Gb2N1cyAmJiBjLmZvY3VzKCk7YnJlYWs7Y2FzZSAiaW1nIjprLnNyYyAmJiAoYy5zcmMgPSBrLnNyYyk7fX1icmVhaztjYXNlIDY6YnJlYWs7Y2FzZSA0OmJyZWFrO2Nhc2UgMTI6YnJlYWs7Y2FzZSAxMzppZiAobnVsbCA9PT0gYi5tZW1vaXplZFN0YXRlKSB7dmFyIGwgPSBiLmFsdGVybmF0ZTtpZiAobnVsbCAhPT0gbCkge3ZhciBtID0gbC5tZW1vaXplZFN0YXRlO2lmIChudWxsICE9PSBtKSB7dmFyIHEgPSBtLmRlaHlkcmF0ZWQ7bnVsbCAhPT0gcSAmJiBiZChxKTt9fX1icmVhaztjYXNlIDE5OmNhc2UgMTc6Y2FzZSAyMTpjYXNlIDIyOmNhc2UgMjM6Y2FzZSAyNTpicmVhazsKICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OnRocm93IEVycm9yKHAoMTYzKSk7fVUgfHwgYi5mbGFncyAmIDUxMiAmJiBTaihiKTt9IGNhdGNoIChyKSB7VyhiLCBiLnJldHVybiwgcik7fX1pZiAoYiA9PT0gYSkge1YgPSBudWxsO2JyZWFrO31jID0gYi5zaWJsaW5nO2lmIChudWxsICE9PSBjKSB7Yy5yZXR1cm4gPSBiLnJldHVybjtWID0gYzticmVhazt9ViA9IGIucmV0dXJuO319ZnVuY3Rpb24gaGsoYSkge2ZvciAoOyBudWxsICE9PSBWOykge3ZhciBiID0gVjtpZiAoYiA9PT0gYSkge1YgPSBudWxsO2JyZWFrO312YXIgYyA9IGIuc2libGluZztpZiAobnVsbCAhPT0gYykge2MucmV0dXJuID0gYi5yZXR1cm47ViA9IGM7YnJlYWs7fVYgPSBiLnJldHVybjt9fQogICAgICAgICAgZnVuY3Rpb24ga2soYSkge2ZvciAoOyBudWxsICE9PSBWOykge3ZhciBiID0gVjt0cnkge3N3aXRjaCAoYi50YWcpIHtjYXNlIDA6Y2FzZSAxMTpjYXNlIDE1OnZhciBjID0gYi5yZXR1cm47dHJ5IHtSaig0LCBiKTt9IGNhdGNoIChrKSB7VyhiLCBjLCBrKTt9YnJlYWs7Y2FzZSAxOnZhciBkID0gYi5zdGF0ZU5vZGU7aWYgKCJmdW5jdGlvbiIgPT09IHR5cGVvZiBkLmNvbXBvbmVudERpZE1vdW50KSB7dmFyIGUgPSBiLnJldHVybjt0cnkge2QuY29tcG9uZW50RGlkTW91bnQoKTt9IGNhdGNoIChrKSB7VyhiLCBlLCBrKTt9fXZhciBmID0gYi5yZXR1cm47dHJ5IHtTaihiKTt9IGNhdGNoIChrKSB7VyhiLCBmLCBrKTt9YnJlYWs7Y2FzZSA1OnZhciBnID0gYi5yZXR1cm47dHJ5IHtTaihiKTt9IGNhdGNoIChrKSB7VyhiLCBnLCBrKTt9fX0gY2F0Y2ggKGspIHtXKGIsIGIucmV0dXJuLCBrKTt9aWYgKGIgPT09IGEpIHtWID0gbnVsbDticmVhazt9dmFyIGggPSBiLnNpYmxpbmc7aWYgKG51bGwgIT09IGgpIHtoLnJldHVybiA9IGIucmV0dXJuO1YgPSBoO2JyZWFrO31WID0gYi5yZXR1cm47fX0KICAgICAgICAgIHZhciBtayA9IE1hdGguY2VpbCxuayA9IHVhLlJlYWN0Q3VycmVudERpc3BhdGNoZXIsb2sgPSB1YS5SZWFjdEN1cnJlbnRPd25lcixwayA9IHVhLlJlYWN0Q3VycmVudEJhdGNoQ29uZmlnLEsgPSAwLFIgPSBudWxsLFkgPSBudWxsLFogPSAwLGdqID0gMCxmaiA9IFVmKDApLFQgPSAwLHFrID0gbnVsbCxoaCA9IDAscmsgPSAwLHNrID0gMCx0ayA9IG51bGwsdWsgPSBudWxsLGdrID0gMCxIaiA9IEluZmluaXR5LHZrID0gbnVsbCxQaSA9ICExLFFpID0gbnVsbCxTaSA9IG51bGwsd2sgPSAhMSx4ayA9IG51bGwseWsgPSAwLHprID0gMCxBayA9IG51bGwsQmsgPSAtMSxDayA9IDA7ZnVuY3Rpb24gTCgpIHtyZXR1cm4gMCAhPT0gKEsgJiA2KSA/IEIoKSA6IC0xICE9PSBCayA/IEJrIDogQmsgPSBCKCk7fQogICAgICAgICAgZnVuY3Rpb24gbGgoYSkge2lmICgwID09PSAoYS5tb2RlICYgMSkpIHJldHVybiAxO2lmICgwICE9PSAoSyAmIDIpICYmIDAgIT09IFopIHJldHVybiBaICYgLVo7aWYgKG51bGwgIT09IEtnLnRyYW5zaXRpb24pIHJldHVybiAwID09PSBDayAmJiAoQ2sgPSB5YygpKSwgQ2s7YSA9IEM7aWYgKDAgIT09IGEpIHJldHVybiBhO2EgPSB3aW5kb3cuZXZlbnQ7YSA9IHZvaWQgMCA9PT0gYSA/IDE2IDogamQoYS50eXBlKTtyZXR1cm4gYTt9ZnVuY3Rpb24gbWgoYSwgYiwgYywgZCkge2lmICg1MCA8IHprKSB0aHJvdyB6ayA9IDAsIEFrID0gbnVsbCwgRXJyb3IocCgxODUpKTtBYyhhLCBjLCBkKTtpZiAoMCA9PT0gKEsgJiAyKSB8fCBhICE9PSBSKSBhID09PSBSICYmICgwID09PSAoSyAmIDIpICYmIChyayB8PSBjKSwgNCA9PT0gVCAmJiBEayhhLCBaKSksIEVrKGEsIGQpLCAxID09PSBjICYmIDAgPT09IEsgJiYgMCA9PT0gKGIubW9kZSAmIDEpICYmIChIaiA9IEIoKSArIDUwMCwgZmcgJiYgamcoKSk7fQogICAgICAgICAgZnVuY3Rpb24gRWsoYSwgYikge3ZhciBjID0gYS5jYWxsYmFja05vZGU7d2MoYSwgYik7dmFyIGQgPSB1YyhhLCBhID09PSBSID8gWiA6IDApO2lmICgwID09PSBkKSBudWxsICE9PSBjICYmIGJjKGMpLCBhLmNhbGxiYWNrTm9kZSA9IG51bGwsIGEuY2FsbGJhY2tQcmlvcml0eSA9IDA7ZWxzZSBpZiAoYiA9IGQgJiAtZCwgYS5jYWxsYmFja1ByaW9yaXR5ICE9PSBiKSB7bnVsbCAhPSBjICYmIGJjKGMpO2lmICgxID09PSBiKSAwID09PSBhLnRhZyA/IGlnKEZrLmJpbmQobnVsbCwgYSkpIDogaGcoRmsuYmluZChudWxsLCBhKSksIEpmKGZ1bmN0aW9uICgpIHswID09PSAoSyAmIDYpICYmIGpnKCk7fSksIGMgPSBudWxsO2Vsc2Uge3N3aXRjaCAoRGMoZCkpIHtjYXNlIDE6YyA9IGZjO2JyZWFrO2Nhc2UgNDpjID0gZ2M7YnJlYWs7Y2FzZSAxNjpjID0gaGM7YnJlYWs7Y2FzZSA1MzY4NzA5MTI6YyA9IGpjO2JyZWFrO2RlZmF1bHQ6YyA9IGhjO31jID0gR2soYywgSGsuYmluZChudWxsLCBhKSk7fWEuY2FsbGJhY2tQcmlvcml0eSA9IGI7YS5jYWxsYmFja05vZGUgPSBjO319CiAgICAgICAgICBmdW5jdGlvbiBIayhhLCBiKSB7QmsgPSAtMTtDayA9IDA7aWYgKDAgIT09IChLICYgNikpIHRocm93IEVycm9yKHAoMzI3KSk7dmFyIGMgPSBhLmNhbGxiYWNrTm9kZTtpZiAoSWsoKSAmJiBhLmNhbGxiYWNrTm9kZSAhPT0gYykgcmV0dXJuIG51bGw7dmFyIGQgPSB1YyhhLCBhID09PSBSID8gWiA6IDApO2lmICgwID09PSBkKSByZXR1cm4gbnVsbDtpZiAoMCAhPT0gKGQgJiAzMCkgfHwgMCAhPT0gKGQgJiBhLmV4cGlyZWRMYW5lcykgfHwgYikgYiA9IEprKGEsIGQpO2Vsc2Uge2IgPSBkO3ZhciBlID0gSztLIHw9IDI7dmFyIGYgPSBLaygpO2lmIChSICE9PSBhIHx8IFogIT09IGIpIHZrID0gbnVsbCwgSGogPSBCKCkgKyA1MDAsIExrKGEsIGIpO2RvIHt0cnkge01rKCk7YnJlYWs7fSBjYXRjaCAoaCkge05rKGEsIGgpO319IHdoaWxlICgxKTtRZygpO25rLmN1cnJlbnQgPSBmO0sgPSBlO251bGwgIT09IFkgPyBiID0gMCA6IChSID0gbnVsbCwgWiA9IDAsIGIgPSBUKTt9aWYgKDAgIT09IGIpIHsyID09PSBiICYmIChlID0geGMoYSksIDAgIT09IGUgJiYgKGQgPSBlLCBiID0gT2soYSwgZSkpKTtpZiAoMSA9PT0gYikgdGhyb3cgYyA9IHFrLCBMayhhLCAwKSwgRGsoYSwgZCksIEVrKGEsIEIoKSksIGM7aWYgKDYgPT09IGIpIERrKGEsIGQpO2Vsc2UKICAgICAgICAgICAgICB7ZSA9IGEuY3VycmVudC5hbHRlcm5hdGU7aWYgKDAgPT09IChkICYgMzApICYmICFQayhlKSAmJiAoYiA9IEprKGEsIGQpLCAyID09PSBiICYmIChmID0geGMoYSksIDAgIT09IGYgJiYgKGQgPSBmLCBiID0gT2soYSwgZikpKSwgMSA9PT0gYikpIHRocm93IGMgPSBxaywgTGsoYSwgMCksIERrKGEsIGQpLCBFayhhLCBCKCkpLCBjO2EuZmluaXNoZWRXb3JrID0gZTthLmZpbmlzaGVkTGFuZXMgPSBkO3N3aXRjaCAoYikge2Nhc2UgMDpjYXNlIDE6dGhyb3cgRXJyb3IocCgzNDUpKTtjYXNlIDI6UWsoYSwgdWssIHZrKTticmVhaztjYXNlIDM6RGsoYSwgZCk7aWYgKChkICYgMTMwMDIzNDI0KSA9PT0gZCAmJiAoYiA9IGdrICsgNTAwIC0gQigpLCAxMCA8IGIpKSB7aWYgKDAgIT09IHVjKGEsIDApKSBicmVhaztlID0gYS5zdXNwZW5kZWRMYW5lcztpZiAoKGUgJiBkKSAhPT0gZCkge0woKTthLnBpbmdlZExhbmVzIHw9IGEuc3VzcGVuZGVkTGFuZXMgJiBlO2JyZWFrO31hLnRpbWVvdXRIYW5kbGUgPSBGZihRay5iaW5kKG51bGwsIGEsIHVrLCB2ayksIGIpO2JyZWFrO31RayhhLCB1aywgdmspO2JyZWFrO2Nhc2UgNDpEayhhLCBkKTtpZiAoKGQgJiA0MTk0MjQwKSA9PT0KICAgICAgICAgICAgICAgICAgICBkKSBicmVhaztiID0gYS5ldmVudFRpbWVzO2ZvciAoZSA9IC0xOyAwIDwgZDspIHt2YXIgZyA9IDMxIC0gb2MoZCk7ZiA9IDEgPDwgZztnID0gYltnXTtnID4gZSAmJiAoZSA9IGcpO2QgJj0gfmY7fWQgPSBlO2QgPSBCKCkgLSBkO2QgPSAoMTIwID4gZCA/IDEyMCA6IDQ4MCA+IGQgPyA0ODAgOiAxMDgwID4gZCA/IDEwODAgOiAxOTIwID4gZCA/IDE5MjAgOiAzRTMgPiBkID8gM0UzIDogNDMyMCA+IGQgPyA0MzIwIDogMTk2MCAqIG1rKGQgLyAxOTYwKSkgLSBkO2lmICgxMCA8IGQpIHthLnRpbWVvdXRIYW5kbGUgPSBGZihRay5iaW5kKG51bGwsIGEsIHVrLCB2ayksIGQpO2JyZWFrO31RayhhLCB1aywgdmspO2JyZWFrO2Nhc2UgNTpRayhhLCB1aywgdmspO2JyZWFrO2RlZmF1bHQ6dGhyb3cgRXJyb3IocCgzMjkpKTt9fX1FayhhLCBCKCkpO3JldHVybiBhLmNhbGxiYWNrTm9kZSA9PT0gYyA/IEhrLmJpbmQobnVsbCwgYSkgOiBudWxsO30KICAgICAgICAgIGZ1bmN0aW9uIE9rKGEsIGIpIHt2YXIgYyA9IHRrO2EuY3VycmVudC5tZW1vaXplZFN0YXRlLmlzRGVoeWRyYXRlZCAmJiAoTGsoYSwgYikuZmxhZ3MgfD0gMjU2KTthID0gSmsoYSwgYik7MiAhPT0gYSAmJiAoYiA9IHVrLCB1ayA9IGMsIG51bGwgIT09IGIgJiYgR2ooYikpO3JldHVybiBhO31mdW5jdGlvbiBHaihhKSB7bnVsbCA9PT0gdWsgPyB1ayA9IGEgOiB1ay5wdXNoLmFwcGx5KHVrLCBhKTt9CiAgICAgICAgICBmdW5jdGlvbiBQayhhKSB7Zm9yICh2YXIgYiA9IGE7Oykge2lmIChiLmZsYWdzICYgMTYzODQpIHt2YXIgYyA9IGIudXBkYXRlUXVldWU7aWYgKG51bGwgIT09IGMgJiYgKGMgPSBjLnN0b3JlcywgbnVsbCAhPT0gYykpIGZvciAodmFyIGQgPSAwOyBkIDwgYy5sZW5ndGg7IGQrKykge3ZhciBlID0gY1tkXSxmID0gZS5nZXRTbmFwc2hvdDtlID0gZS52YWx1ZTt0cnkge2lmICghSGUoZigpLCBlKSkgcmV0dXJuICExO30gY2F0Y2ggKGcpIHtyZXR1cm4gITE7fX19YyA9IGIuY2hpbGQ7aWYgKGIuc3VidHJlZUZsYWdzICYgMTYzODQgJiYgbnVsbCAhPT0gYykgYy5yZXR1cm4gPSBiLCBiID0gYztlbHNlIHtpZiAoYiA9PT0gYSkgYnJlYWs7Zm9yICg7IG51bGwgPT09IGIuc2libGluZzspIHtpZiAobnVsbCA9PT0gYi5yZXR1cm4gfHwgYi5yZXR1cm4gPT09IGEpIHJldHVybiAhMDtiID0gYi5yZXR1cm47fWIuc2libGluZy5yZXR1cm4gPSBiLnJldHVybjtiID0gYi5zaWJsaW5nO319cmV0dXJuICEwO30KICAgICAgICAgIGZ1bmN0aW9uIERrKGEsIGIpIHtiICY9IH5zaztiICY9IH5yazthLnN1c3BlbmRlZExhbmVzIHw9IGI7YS5waW5nZWRMYW5lcyAmPSB+Yjtmb3IgKGEgPSBhLmV4cGlyYXRpb25UaW1lczsgMCA8IGI7KSB7dmFyIGMgPSAzMSAtIG9jKGIpLGQgPSAxIDw8IGM7YVtjXSA9IC0xO2IgJj0gfmQ7fX1mdW5jdGlvbiBGayhhKSB7aWYgKDAgIT09IChLICYgNikpIHRocm93IEVycm9yKHAoMzI3KSk7SWsoKTt2YXIgYiA9IHVjKGEsIDApO2lmICgwID09PSAoYiAmIDEpKSByZXR1cm4gRWsoYSwgQigpKSwgbnVsbDt2YXIgYyA9IEprKGEsIGIpO2lmICgwICE9PSBhLnRhZyAmJiAyID09PSBjKSB7dmFyIGQgPSB4YyhhKTswICE9PSBkICYmIChiID0gZCwgYyA9IE9rKGEsIGQpKTt9aWYgKDEgPT09IGMpIHRocm93IGMgPSBxaywgTGsoYSwgMCksIERrKGEsIGIpLCBFayhhLCBCKCkpLCBjO2lmICg2ID09PSBjKSB0aHJvdyBFcnJvcihwKDM0NSkpO2EuZmluaXNoZWRXb3JrID0gYS5jdXJyZW50LmFsdGVybmF0ZTthLmZpbmlzaGVkTGFuZXMgPSBiO1FrKGEsIHVrLCB2ayk7RWsoYSwgQigpKTtyZXR1cm4gbnVsbDt9CiAgICAgICAgICBmdW5jdGlvbiBSayhhLCBiKSB7dmFyIGMgPSBLO0sgfD0gMTt0cnkge3JldHVybiBhKGIpO30gZmluYWxseSB7SyA9IGMsIDAgPT09IEsgJiYgKEhqID0gQigpICsgNTAwLCBmZyAmJiBqZygpKTt9fWZ1bmN0aW9uIFNrKGEpIHtudWxsICE9PSB4ayAmJiAwID09PSB4ay50YWcgJiYgMCA9PT0gKEsgJiA2KSAmJiBJaygpO3ZhciBiID0gSztLIHw9IDE7dmFyIGMgPSBway50cmFuc2l0aW9uLGQgPSBDO3RyeSB7aWYgKHBrLnRyYW5zaXRpb24gPSBudWxsLCBDID0gMSwgYSkgcmV0dXJuIGEoKTt9IGZpbmFsbHkge0MgPSBkLCBway50cmFuc2l0aW9uID0gYywgSyA9IGIsIDAgPT09IChLICYgNikgJiYgamcoKTt9fWZ1bmN0aW9uIElqKCkge2dqID0gZmouY3VycmVudDtFKGZqKTt9CiAgICAgICAgICBmdW5jdGlvbiBMayhhLCBiKSB7YS5maW5pc2hlZFdvcmsgPSBudWxsO2EuZmluaXNoZWRMYW5lcyA9IDA7dmFyIGMgPSBhLnRpbWVvdXRIYW5kbGU7LTEgIT09IGMgJiYgKGEudGltZW91dEhhbmRsZSA9IC0xLCBHZihjKSk7aWYgKG51bGwgIT09IFkpIGZvciAoYyA9IFkucmV0dXJuOyBudWxsICE9PSBjOykge3ZhciBkID0gYzt3ZyhkKTtzd2l0Y2ggKGQudGFnKSB7Y2FzZSAxOmQgPSBkLnR5cGUuY2hpbGRDb250ZXh0VHlwZXM7bnVsbCAhPT0gZCAmJiB2b2lkIDAgIT09IGQgJiYgJGYoKTticmVhaztjYXNlIDM6SmgoKTtFKFdmKTtFKEgpO09oKCk7YnJlYWs7Y2FzZSA1OkxoKGQpO2JyZWFrO2Nhc2UgNDpKaCgpO2JyZWFrO2Nhc2UgMTM6RShNKTticmVhaztjYXNlIDE5OkUoTSk7YnJlYWs7Y2FzZSAxMDpSZyhkLnR5cGUuX2NvbnRleHQpO2JyZWFrO2Nhc2UgMjI6Y2FzZSAyMzpJaigpO31jID0gYy5yZXR1cm47fVIgPSBhO1kgPSBhID0gd2goYS5jdXJyZW50LCBudWxsKTtaID0gZ2ogPSBiO1QgPSAwO3FrID0gbnVsbDtzayA9IHJrID0gaGggPSAwO3VrID0gdGsgPSBudWxsO2lmIChudWxsICE9PSBXZykge2ZvciAoYiA9CiAgICAgICAgICAgICAgMDsgYiA8IFdnLmxlbmd0aDsgYisrKSB7aWYgKGMgPSBXZ1tiXSwgZCA9IGMuaW50ZXJsZWF2ZWQsIG51bGwgIT09IGQpIHtjLmludGVybGVhdmVkID0gbnVsbDt2YXIgZSA9IGQubmV4dCxmID0gYy5wZW5kaW5nO2lmIChudWxsICE9PSBmKSB7dmFyIGcgPSBmLm5leHQ7Zi5uZXh0ID0gZTtkLm5leHQgPSBnO31jLnBlbmRpbmcgPSBkO319V2cgPSBudWxsO31yZXR1cm4gYTt9CiAgICAgICAgICBmdW5jdGlvbiBOayhhLCBiKSB7ZG8ge3ZhciBjID0gWTt0cnkge1FnKCk7UGguY3VycmVudCA9IGFpO2lmIChTaCkge2ZvciAodmFyIGQgPSBOLm1lbW9pemVkU3RhdGU7IG51bGwgIT09IGQ7KSB7dmFyIGUgPSBkLnF1ZXVlO251bGwgIT09IGUgJiYgKGUucGVuZGluZyA9IG51bGwpO2QgPSBkLm5leHQ7fVNoID0gITE7fVJoID0gMDtQID0gTyA9IE4gPSBudWxsO1RoID0gITE7VWggPSAwO29rLmN1cnJlbnQgPSBudWxsO2lmIChudWxsID09PSBjIHx8IG51bGwgPT09IGMucmV0dXJuKSB7VCA9IDE7cWsgPSBiO1kgPSBudWxsO2JyZWFrO31hOiB7dmFyIGYgPSBhLGcgPSBjLnJldHVybixoID0gYyxrID0gYjtiID0gWjtoLmZsYWdzIHw9IDMyNzY4O2lmIChudWxsICE9PSBrICYmICJvYmplY3QiID09PSB0eXBlb2YgayAmJiAiZnVuY3Rpb24iID09PSB0eXBlb2Ygay50aGVuKSB7dmFyIGwgPSBrLG0gPSBoLHEgPSBtLnRhZztpZiAoMCA9PT0gKG0ubW9kZSAmIDEpICYmICgwID09PSBxIHx8IDExID09PSBxIHx8IDE1ID09PSBxKSkge3ZhciByID0gbS5hbHRlcm5hdGU7ciA/IChtLnVwZGF0ZVF1ZXVlID0gci51cGRhdGVRdWV1ZSwgbS5tZW1vaXplZFN0YXRlID0gci5tZW1vaXplZFN0YXRlLAogICAgICAgICAgICAgICAgICAgICAgbS5sYW5lcyA9IHIubGFuZXMpIDogKG0udXBkYXRlUXVldWUgPSBudWxsLCBtLm1lbW9pemVkU3RhdGUgPSBudWxsKTt9dmFyIHkgPSBWaShnKTtpZiAobnVsbCAhPT0geSkge3kuZmxhZ3MgJj0gLTI1NztXaSh5LCBnLCBoLCBmLCBiKTt5Lm1vZGUgJiAxICYmIFRpKGYsIGwsIGIpO2IgPSB5O2sgPSBsO3ZhciBuID0gYi51cGRhdGVRdWV1ZTtpZiAobnVsbCA9PT0gbikge3ZhciB0ID0gbmV3IFNldCgpO3QuYWRkKGspO2IudXBkYXRlUXVldWUgPSB0O30gZWxzZSBuLmFkZChrKTticmVhayBhO30gZWxzZSB7aWYgKDAgPT09IChiICYgMSkpIHtUaShmLCBsLCBiKTt1aigpO2JyZWFrIGE7fWsgPSBFcnJvcihwKDQyNikpO319IGVsc2UgaWYgKEkgJiYgaC5tb2RlICYgMSkge3ZhciBKID0gVmkoZyk7aWYgKG51bGwgIT09IEopIHswID09PSAoSi5mbGFncyAmIDY1NTM2KSAmJiAoSi5mbGFncyB8PSAyNTYpO1dpKEosIGcsIGgsIGYsIGIpO0pnKEtpKGssIGgpKTticmVhayBhO319ZiA9IGsgPSBLaShrLCBoKTs0ICE9PSBUICYmIChUID0gMik7bnVsbCA9PT0gdGsgPyB0ayA9IFtmXSA6IHRrLnB1c2goZik7ZiA9IGc7ZG8ge3N3aXRjaCAoZi50YWcpIHtjYXNlIDM6Zi5mbGFncyB8PSA2NTUzNjsKICAgICAgICAgICAgICAgICAgICAgICAgYiAmPSAtYjtmLmxhbmVzIHw9IGI7dmFyIHggPSBPaShmLCBrLCBiKTtmaChmLCB4KTticmVhayBhO2Nhc2UgMTpoID0gazt2YXIgdyA9IGYudHlwZSx1ID0gZi5zdGF0ZU5vZGU7aWYgKDAgPT09IChmLmZsYWdzICYgMTI4KSAmJiAoImZ1bmN0aW9uIiA9PT0gdHlwZW9mIHcuZ2V0RGVyaXZlZFN0YXRlRnJvbUVycm9yIHx8IG51bGwgIT09IHUgJiYgImZ1bmN0aW9uIiA9PT0gdHlwZW9mIHUuY29tcG9uZW50RGlkQ2F0Y2ggJiYgKG51bGwgPT09IFNpIHx8ICFTaS5oYXModSkpKSkge2YuZmxhZ3MgfD0gNjU1MzY7YiAmPSAtYjtmLmxhbmVzIHw9IGI7dmFyIEYgPSBSaShmLCBoLCBiKTtmaChmLCBGKTticmVhayBhO319ZiA9IGYucmV0dXJuO30gd2hpbGUgKG51bGwgIT09IGYpO31UayhjKTt9IGNhdGNoIChuYSkge2IgPSBuYTtZID09PSBjICYmIG51bGwgIT09IGMgJiYgKFkgPSBjID0gYy5yZXR1cm4pO2NvbnRpbnVlO31icmVhazt9IHdoaWxlICgxKTt9ZnVuY3Rpb24gS2soKSB7dmFyIGEgPSBuay5jdXJyZW50O25rLmN1cnJlbnQgPSBhaTtyZXR1cm4gbnVsbCA9PT0gYSA/IGFpIDogYTt9CiAgICAgICAgICBmdW5jdGlvbiB1aigpIHtpZiAoMCA9PT0gVCB8fCAzID09PSBUIHx8IDIgPT09IFQpIFQgPSA0O251bGwgPT09IFIgfHwgMCA9PT0gKGhoICYgMjY4NDM1NDU1KSAmJiAwID09PSAocmsgJiAyNjg0MzU0NTUpIHx8IERrKFIsIFopO31mdW5jdGlvbiBKayhhLCBiKSB7dmFyIGMgPSBLO0sgfD0gMjt2YXIgZCA9IEtrKCk7aWYgKFIgIT09IGEgfHwgWiAhPT0gYikgdmsgPSBudWxsLCBMayhhLCBiKTtkbyB7dHJ5IHtVaygpO2JyZWFrO30gY2F0Y2ggKGUpIHtOayhhLCBlKTt9fSB3aGlsZSAoMSk7UWcoKTtLID0gYztuay5jdXJyZW50ID0gZDtpZiAobnVsbCAhPT0gWSkgdGhyb3cgRXJyb3IocCgyNjEpKTtSID0gbnVsbDtaID0gMDtyZXR1cm4gVDt9ZnVuY3Rpb24gVWsoKSB7Zm9yICg7IG51bGwgIT09IFk7KSB7VmsoWSk7fX1mdW5jdGlvbiBNaygpIHtmb3IgKDsgbnVsbCAhPT0gWSAmJiAhY2MoKTspIHtWayhZKTt9fWZ1bmN0aW9uIFZrKGEpIHt2YXIgYiA9IFdrKGEuYWx0ZXJuYXRlLCBhLCBnaik7YS5tZW1vaXplZFByb3BzID0gYS5wZW5kaW5nUHJvcHM7bnVsbCA9PT0gYiA/IFRrKGEpIDogWSA9IGI7b2suY3VycmVudCA9IG51bGw7fQogICAgICAgICAgZnVuY3Rpb24gVGsoYSkge3ZhciBiID0gYTtkbyB7dmFyIGMgPSBiLmFsdGVybmF0ZTthID0gYi5yZXR1cm47aWYgKDAgPT09IChiLmZsYWdzICYgMzI3NjgpKSB7aWYgKGMgPSBGaihjLCBiLCBnaiksIG51bGwgIT09IGMpIHtZID0gYztyZXR1cm47fX0gZWxzZSB7YyA9IEpqKGMsIGIpO2lmIChudWxsICE9PSBjKSB7Yy5mbGFncyAmPSAzMjc2NztZID0gYztyZXR1cm47fWlmIChudWxsICE9PSBhKSBhLmZsYWdzIHw9IDMyNzY4LCBhLnN1YnRyZWVGbGFncyA9IDAsIGEuZGVsZXRpb25zID0gbnVsbDtlbHNlIHtUID0gNjtZID0gbnVsbDtyZXR1cm47fX1iID0gYi5zaWJsaW5nO2lmIChudWxsICE9PSBiKSB7WSA9IGI7cmV0dXJuO31ZID0gYiA9IGE7fSB3aGlsZSAobnVsbCAhPT0gYik7MCA9PT0gVCAmJiAoVCA9IDUpO31mdW5jdGlvbiBRayhhLCBiLCBjKSB7dmFyIGQgPSBDLGUgPSBway50cmFuc2l0aW9uO3RyeSB7cGsudHJhbnNpdGlvbiA9IG51bGwsIEMgPSAxLCBYayhhLCBiLCBjLCBkKTt9IGZpbmFsbHkge3BrLnRyYW5zaXRpb24gPSBlLCBDID0gZDt9cmV0dXJuIG51bGw7fQogICAgICAgICAgZnVuY3Rpb24gWGsoYSwgYiwgYywgZCkge2RvIHtJaygpO30gd2hpbGUgKG51bGwgIT09IHhrKTtpZiAoMCAhPT0gKEsgJiA2KSkgdGhyb3cgRXJyb3IocCgzMjcpKTtjID0gYS5maW5pc2hlZFdvcms7dmFyIGUgPSBhLmZpbmlzaGVkTGFuZXM7aWYgKG51bGwgPT09IGMpIHJldHVybiBudWxsO2EuZmluaXNoZWRXb3JrID0gbnVsbDthLmZpbmlzaGVkTGFuZXMgPSAwO2lmIChjID09PSBhLmN1cnJlbnQpIHRocm93IEVycm9yKHAoMTc3KSk7YS5jYWxsYmFja05vZGUgPSBudWxsO2EuY2FsbGJhY2tQcmlvcml0eSA9IDA7dmFyIGYgPSBjLmxhbmVzIHwgYy5jaGlsZExhbmVzO0JjKGEsIGYpO2EgPT09IFIgJiYgKFkgPSBSID0gbnVsbCwgWiA9IDApOzAgPT09IChjLnN1YnRyZWVGbGFncyAmIDIwNjQpICYmIDAgPT09IChjLmZsYWdzICYgMjA2NCkgfHwgd2sgfHwgKHdrID0gITAsIEdrKGhjLCBmdW5jdGlvbiAoKSB7SWsoKTtyZXR1cm4gbnVsbDt9KSk7ZiA9IDAgIT09IChjLmZsYWdzICYgMTU5OTApO2lmICgwICE9PSAoYy5zdWJ0cmVlRmxhZ3MgJiAxNTk5MCkgfHwgZikge2YgPSBway50cmFuc2l0aW9uO3BrLnRyYW5zaXRpb24gPSBudWxsOwogICAgICAgICAgICAgIHZhciBnID0gQztDID0gMTt2YXIgaCA9IEs7SyB8PSA0O29rLmN1cnJlbnQgPSBudWxsO1BqKGEsIGMpO2VrKGMsIGEpO09lKERmKTtkZCA9ICEhQ2Y7RGYgPSBDZiA9IG51bGw7YS5jdXJyZW50ID0gYztpayhjLCBhLCBlKTtkYygpO0sgPSBoO0MgPSBnO3BrLnRyYW5zaXRpb24gPSBmO30gZWxzZSBhLmN1cnJlbnQgPSBjO3drICYmICh3ayA9ICExLCB4ayA9IGEsIHlrID0gZSk7ZiA9IGEucGVuZGluZ0xhbmVzOzAgPT09IGYgJiYgKFNpID0gbnVsbCk7bWMoYy5zdGF0ZU5vZGUsIGQpO0VrKGEsIEIoKSk7aWYgKG51bGwgIT09IGIpIGZvciAoZCA9IGEub25SZWNvdmVyYWJsZUVycm9yLCBjID0gMDsgYyA8IGIubGVuZ3RoOyBjKyspIHtlID0gYltjXSwgZChlLnZhbHVlLCB7IGNvbXBvbmVudFN0YWNrOiBlLnN0YWNrLCBkaWdlc3Q6IGUuZGlnZXN0IH0pO31pZiAoUGkpIHRocm93IFBpID0gITEsIGEgPSBRaSwgUWkgPSBudWxsLCBhOzAgIT09ICh5ayAmIDEpICYmIDAgIT09IGEudGFnICYmIElrKCk7ZiA9IGEucGVuZGluZ0xhbmVzOzAgIT09IChmICYgMSkgPyBhID09PSBBayA/IHprKysgOiAoemsgPSAwLCBBayA9IGEpIDogemsgPSAwO2pnKCk7cmV0dXJuIG51bGw7fQogICAgICAgICAgZnVuY3Rpb24gSWsoKSB7aWYgKG51bGwgIT09IHhrKSB7dmFyIGEgPSBEYyh5ayksYiA9IHBrLnRyYW5zaXRpb24sYyA9IEM7dHJ5IHtway50cmFuc2l0aW9uID0gbnVsbDtDID0gMTYgPiBhID8gMTYgOiBhO2lmIChudWxsID09PSB4aykgdmFyIGQgPSAhMTtlbHNlIHthID0geGs7eGsgPSBudWxsO3lrID0gMDtpZiAoMCAhPT0gKEsgJiA2KSkgdGhyb3cgRXJyb3IocCgzMzEpKTt2YXIgZSA9IEs7SyB8PSA0O2ZvciAoViA9IGEuY3VycmVudDsgbnVsbCAhPT0gVjspIHt2YXIgZiA9IFYsZyA9IGYuY2hpbGQ7aWYgKDAgIT09IChWLmZsYWdzICYgMTYpKSB7dmFyIGggPSBmLmRlbGV0aW9ucztpZiAobnVsbCAhPT0gaCkge2ZvciAodmFyIGsgPSAwOyBrIDwgaC5sZW5ndGg7IGsrKykge3ZhciBsID0gaFtrXTtmb3IgKFYgPSBsOyBudWxsICE9PSBWOykge3ZhciBtID0gVjtzd2l0Y2ggKG0udGFnKSB7Y2FzZSAwOmNhc2UgMTE6Y2FzZSAxNTpRaig4LCBtLCBmKTt9dmFyIHEgPSBtLmNoaWxkO2lmIChudWxsICE9PSBxKSBxLnJldHVybiA9IG0sIFYgPSBxO2Vsc2UgZm9yICg7IG51bGwgIT09IFY7KSB7bSA9IFY7dmFyIHIgPSBtLnNpYmxpbmcseSA9IG0ucmV0dXJuO1RqKG0pO2lmIChtID09PQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsKSB7ViA9IG51bGw7YnJlYWs7fWlmIChudWxsICE9PSByKSB7ci5yZXR1cm4gPSB5O1YgPSByO2JyZWFrO31WID0geTt9fX12YXIgbiA9IGYuYWx0ZXJuYXRlO2lmIChudWxsICE9PSBuKSB7dmFyIHQgPSBuLmNoaWxkO2lmIChudWxsICE9PSB0KSB7bi5jaGlsZCA9IG51bGw7ZG8ge3ZhciBKID0gdC5zaWJsaW5nO3Quc2libGluZyA9IG51bGw7dCA9IEo7fSB3aGlsZSAobnVsbCAhPT0gdCk7fX1WID0gZjt9fWlmICgwICE9PSAoZi5zdWJ0cmVlRmxhZ3MgJiAyMDY0KSAmJiBudWxsICE9PSBnKSBnLnJldHVybiA9IGYsIFYgPSBnO2Vsc2UgYjogZm9yICg7IG51bGwgIT09IFY7KSB7ZiA9IFY7aWYgKDAgIT09IChmLmZsYWdzICYgMjA0OCkpIHN3aXRjaCAoZi50YWcpIHtjYXNlIDA6Y2FzZSAxMTpjYXNlIDE1OlFqKDksIGYsIGYucmV0dXJuKTt9dmFyIHggPSBmLnNpYmxpbmc7aWYgKG51bGwgIT09IHgpIHt4LnJldHVybiA9IGYucmV0dXJuO1YgPSB4O2JyZWFrIGI7fVYgPSBmLnJldHVybjt9fXZhciB3ID0gYS5jdXJyZW50O2ZvciAoViA9IHc7IG51bGwgIT09IFY7KSB7ZyA9IFY7dmFyIHUgPSBnLmNoaWxkO2lmICgwICE9PSAoZy5zdWJ0cmVlRmxhZ3MgJiAyMDY0KSAmJiBudWxsICE9PQogICAgICAgICAgICAgICAgICAgIHUpIHUucmV0dXJuID0gZywgViA9IHU7ZWxzZSBiOiBmb3IgKGcgPSB3OyBudWxsICE9PSBWOykge2ggPSBWO2lmICgwICE9PSAoaC5mbGFncyAmIDIwNDgpKSB0cnkge3N3aXRjaCAoaC50YWcpIHtjYXNlIDA6Y2FzZSAxMTpjYXNlIDE1OlJqKDksIGgpO319IGNhdGNoIChuYSkge1coaCwgaC5yZXR1cm4sIG5hKTt9aWYgKGggPT09IGcpIHtWID0gbnVsbDticmVhayBiO312YXIgRiA9IGguc2libGluZztpZiAobnVsbCAhPT0gRikge0YucmV0dXJuID0gaC5yZXR1cm47ViA9IEY7YnJlYWsgYjt9ViA9IGgucmV0dXJuO319SyA9IGU7amcoKTtpZiAobGMgJiYgImZ1bmN0aW9uIiA9PT0gdHlwZW9mIGxjLm9uUG9zdENvbW1pdEZpYmVyUm9vdCkgdHJ5IHtsYy5vblBvc3RDb21taXRGaWJlclJvb3Qoa2MsIGEpO30gY2F0Y2ggKG5hKSB7fWQgPSAhMDt9cmV0dXJuIGQ7fSBmaW5hbGx5IHtDID0gYywgcGsudHJhbnNpdGlvbiA9IGI7fX1yZXR1cm4gITE7fWZ1bmN0aW9uIFlrKGEsIGIsIGMpIHtiID0gS2koYywgYik7YiA9IE9pKGEsIGIsIDEpO2EgPSBkaChhLCBiLCAxKTtiID0gTCgpO251bGwgIT09IGEgJiYgKEFjKGEsIDEsIGIpLCBFayhhLCBiKSk7fQogICAgICAgICAgZnVuY3Rpb24gVyhhLCBiLCBjKSB7aWYgKDMgPT09IGEudGFnKSBZayhhLCBhLCBjKTtlbHNlIGZvciAoOyBudWxsICE9PSBiOykge2lmICgzID09PSBiLnRhZykge1lrKGIsIGEsIGMpO2JyZWFrO30gZWxzZSBpZiAoMSA9PT0gYi50YWcpIHt2YXIgZCA9IGIuc3RhdGVOb2RlO2lmICgiZnVuY3Rpb24iID09PSB0eXBlb2YgYi50eXBlLmdldERlcml2ZWRTdGF0ZUZyb21FcnJvciB8fCAiZnVuY3Rpb24iID09PSB0eXBlb2YgZC5jb21wb25lbnREaWRDYXRjaCAmJiAobnVsbCA9PT0gU2kgfHwgIVNpLmhhcyhkKSkpIHthID0gS2koYywgYSk7YSA9IFJpKGIsIGEsIDEpO2IgPSBkaChiLCBhLCAxKTthID0gTCgpO251bGwgIT09IGIgJiYgKEFjKGIsIDEsIGEpLCBFayhiLCBhKSk7YnJlYWs7fX1iID0gYi5yZXR1cm47fX0KICAgICAgICAgIGZ1bmN0aW9uIFVpKGEsIGIsIGMpIHt2YXIgZCA9IGEucGluZ0NhY2hlO251bGwgIT09IGQgJiYgZC5kZWxldGUoYik7YiA9IEwoKTthLnBpbmdlZExhbmVzIHw9IGEuc3VzcGVuZGVkTGFuZXMgJiBjO1IgPT09IGEgJiYgKFogJiBjKSA9PT0gYyAmJiAoNCA9PT0gVCB8fCAzID09PSBUICYmIChaICYgMTMwMDIzNDI0KSA9PT0gWiAmJiA1MDAgPiBCKCkgLSBnayA/IExrKGEsIDApIDogc2sgfD0gYyk7RWsoYSwgYik7fWZ1bmN0aW9uIFprKGEsIGIpIHswID09PSBiICYmICgwID09PSAoYS5tb2RlICYgMSkgPyBiID0gMSA6IChiID0gc2MsIHNjIDw8PSAxLCAwID09PSAoc2MgJiAxMzAwMjM0MjQpICYmIChzYyA9IDQxOTQzMDQpKSk7dmFyIGMgPSBMKCk7YSA9IFpnKGEsIGIpO251bGwgIT09IGEgJiYgKEFjKGEsIGIsIGMpLCBFayhhLCBjKSk7fWZ1bmN0aW9uIHZqKGEpIHt2YXIgYiA9IGEubWVtb2l6ZWRTdGF0ZSxjID0gMDtudWxsICE9PSBiICYmIChjID0gYi5yZXRyeUxhbmUpO1prKGEsIGMpO30KICAgICAgICAgIGZ1bmN0aW9uIGNrKGEsIGIpIHt2YXIgYyA9IDA7c3dpdGNoIChhLnRhZykge2Nhc2UgMTM6dmFyIGQgPSBhLnN0YXRlTm9kZTt2YXIgZSA9IGEubWVtb2l6ZWRTdGF0ZTtudWxsICE9PSBlICYmIChjID0gZS5yZXRyeUxhbmUpO2JyZWFrO2Nhc2UgMTk6ZCA9IGEuc3RhdGVOb2RlO2JyZWFrO2RlZmF1bHQ6dGhyb3cgRXJyb3IocCgzMTQpKTt9bnVsbCAhPT0gZCAmJiBkLmRlbGV0ZShiKTtaayhhLCBjKTt9dmFyIFdrOwogICAgICAgICAgV2sgPSBmdW5jdGlvbiBXayhhLCBiLCBjKSB7aWYgKG51bGwgIT09IGEpIHtpZiAoYS5tZW1vaXplZFByb3BzICE9PSBiLnBlbmRpbmdQcm9wcyB8fCBXZi5jdXJyZW50KSBVZyA9ICEwO2Vsc2Uge2lmICgwID09PSAoYS5sYW5lcyAmIGMpICYmIDAgPT09IChiLmZsYWdzICYgMTI4KSkgcmV0dXJuIFVnID0gITEsIHpqKGEsIGIsIGMpO1VnID0gMCAhPT0gKGEuZmxhZ3MgJiAxMzEwNzIpID8gITAgOiAhMTt9fSBlbHNlIFVnID0gITEsIEkgJiYgMCAhPT0gKGIuZmxhZ3MgJiAxMDQ4NTc2KSAmJiB1ZyhiLCBuZywgYi5pbmRleCk7Yi5sYW5lcyA9IDA7c3dpdGNoIChiLnRhZykge2Nhc2UgMjp2YXIgZCA9IGIudHlwZTtqaihhLCBiKTthID0gYi5wZW5kaW5nUHJvcHM7dmFyIGUgPSBZZihiLCBILmN1cnJlbnQpO1RnKGIsIGMpO2UgPSBYaChudWxsLCBiLCBkLCBhLCBlLCBjKTt2YXIgZiA9IGJpKCk7Yi5mbGFncyB8PSAxOyJvYmplY3QiID09PSB0eXBlb2YgZSAmJiBudWxsICE9PSBlICYmICJmdW5jdGlvbiIgPT09IHR5cGVvZiBlLnJlbmRlciAmJiB2b2lkIDAgPT09IGUuJCR0eXBlb2YgPyAoYi50YWcgPSAxLCBiLm1lbW9pemVkU3RhdGUgPSBudWxsLCBiLnVwZGF0ZVF1ZXVlID0KICAgICAgICAgICAgICAgIG51bGwsIFpmKGQpID8gKGYgPSAhMCwgY2coYikpIDogZiA9ICExLCBiLm1lbW9pemVkU3RhdGUgPSBudWxsICE9PSBlLnN0YXRlICYmIHZvaWQgMCAhPT0gZS5zdGF0ZSA/IGUuc3RhdGUgOiBudWxsLCBhaChiKSwgZS51cGRhdGVyID0gbmgsIGIuc3RhdGVOb2RlID0gZSwgZS5fcmVhY3RJbnRlcm5hbHMgPSBiLCByaChiLCBkLCBhLCBjKSwgYiA9IGtqKG51bGwsIGIsIGQsICEwLCBmLCBjKSkgOiAoYi50YWcgPSAwLCBJICYmIGYgJiYgdmcoYiksIFlpKG51bGwsIGIsIGUsIGMpLCBiID0gYi5jaGlsZCk7cmV0dXJuIGI7Y2FzZSAxNjpkID0gYi5lbGVtZW50VHlwZTthOiB7amooYSwgYik7YSA9IGIucGVuZGluZ1Byb3BzO2UgPSBkLl9pbml0O2QgPSBlKGQuX3BheWxvYWQpO2IudHlwZSA9IGQ7ZSA9IGIudGFnID0gJGsoZCk7YSA9IExnKGQsIGEpO3N3aXRjaCAoZSkge2Nhc2UgMDpiID0gZGoobnVsbCwgYiwgZCwgYSwgYyk7YnJlYWsgYTtjYXNlIDE6YiA9IGlqKG51bGwsIGIsIGQsIGEsIGMpO2JyZWFrIGE7Y2FzZSAxMTpiID0gWmkobnVsbCwgYiwgZCwgYSwgYyk7YnJlYWsgYTtjYXNlIDE0OmIgPSBhaihudWxsLCBiLCBkLCBMZyhkLnR5cGUsIGEpLCBjKTticmVhayBhO310aHJvdyBFcnJvcihwKDMwNiwKICAgICAgICAgICAgICAgICAgZCwgIiIpKTt9cmV0dXJuIGI7Y2FzZSAwOnJldHVybiBkID0gYi50eXBlLCBlID0gYi5wZW5kaW5nUHJvcHMsIGUgPSBiLmVsZW1lbnRUeXBlID09PSBkID8gZSA6IExnKGQsIGUpLCBkaihhLCBiLCBkLCBlLCBjKTtjYXNlIDE6cmV0dXJuIGQgPSBiLnR5cGUsIGUgPSBiLnBlbmRpbmdQcm9wcywgZSA9IGIuZWxlbWVudFR5cGUgPT09IGQgPyBlIDogTGcoZCwgZSksIGlqKGEsIGIsIGQsIGUsIGMpO2Nhc2UgMzphOiB7bGooYik7aWYgKG51bGwgPT09IGEpIHRocm93IEVycm9yKHAoMzg3KSk7ZCA9IGIucGVuZGluZ1Byb3BzO2YgPSBiLm1lbW9pemVkU3RhdGU7ZSA9IGYuZWxlbWVudDtiaChhLCBiKTtnaChiLCBkLCBudWxsLCBjKTt2YXIgZyA9IGIubWVtb2l6ZWRTdGF0ZTtkID0gZy5lbGVtZW50O2lmIChmLmlzRGVoeWRyYXRlZCkge2lmIChmID0geyBlbGVtZW50OiBkLCBpc0RlaHlkcmF0ZWQ6ICExLCBjYWNoZTogZy5jYWNoZSwgcGVuZGluZ1N1c3BlbnNlQm91bmRhcmllczogZy5wZW5kaW5nU3VzcGVuc2VCb3VuZGFyaWVzLCB0cmFuc2l0aW9uczogZy50cmFuc2l0aW9ucyB9LCBiLnVwZGF0ZVF1ZXVlLmJhc2VTdGF0ZSA9CiAgICAgICAgICAgICAgICAgICAgZiwgYi5tZW1vaXplZFN0YXRlID0gZiwgYi5mbGFncyAmIDI1Nikge2UgPSBLaShFcnJvcihwKDQyMykpLCBiKTtiID0gbWooYSwgYiwgZCwgYywgZSk7YnJlYWsgYTt9IGVsc2UgaWYgKGQgIT09IGUpIHtlID0gS2koRXJyb3IocCg0MjQpKSwgYik7YiA9IG1qKGEsIGIsIGQsIGMsIGUpO2JyZWFrIGE7fSBlbHNlIGZvciAoeWcgPSBMZihiLnN0YXRlTm9kZS5jb250YWluZXJJbmZvLmZpcnN0Q2hpbGQpLCB4ZyA9IGIsIEkgPSAhMCwgemcgPSBudWxsLCBjID0gQ2goYiwgbnVsbCwgZCwgYyksIGIuY2hpbGQgPSBjOyBjOykge2MuZmxhZ3MgPSBjLmZsYWdzICYgLTMgfCA0MDk2LCBjID0gYy5zaWJsaW5nO319IGVsc2Uge0lnKCk7aWYgKGQgPT09IGUpIHtiID0gJGkoYSwgYiwgYyk7YnJlYWsgYTt9WWkoYSwgYiwgZCwgYyk7fWIgPSBiLmNoaWxkO31yZXR1cm4gYjtjYXNlIDU6cmV0dXJuIEtoKGIpLCBudWxsID09PSBhICYmIEVnKGIpLCBkID0gYi50eXBlLCBlID0gYi5wZW5kaW5nUHJvcHMsIGYgPSBudWxsICE9PSBhID8gYS5tZW1vaXplZFByb3BzIDogbnVsbCwgZyA9IGUuY2hpbGRyZW4sIEVmKGQsIGUpID8gZyA9IG51bGwgOiBudWxsICE9PSBmICYmIEVmKGQsIGYpICYmIChiLmZsYWdzIHw9IDMyKSwKICAgICAgICAgICAgICAgIGhqKGEsIGIpLCBZaShhLCBiLCBnLCBjKSwgYi5jaGlsZDtjYXNlIDY6cmV0dXJuIG51bGwgPT09IGEgJiYgRWcoYiksIG51bGw7Y2FzZSAxMzpyZXR1cm4gcGooYSwgYiwgYyk7Y2FzZSA0OnJldHVybiBJaChiLCBiLnN0YXRlTm9kZS5jb250YWluZXJJbmZvKSwgZCA9IGIucGVuZGluZ1Byb3BzLCBudWxsID09PSBhID8gYi5jaGlsZCA9IEJoKGIsIG51bGwsIGQsIGMpIDogWWkoYSwgYiwgZCwgYyksIGIuY2hpbGQ7Y2FzZSAxMTpyZXR1cm4gZCA9IGIudHlwZSwgZSA9IGIucGVuZGluZ1Byb3BzLCBlID0gYi5lbGVtZW50VHlwZSA9PT0gZCA/IGUgOiBMZyhkLCBlKSwgWmkoYSwgYiwgZCwgZSwgYyk7Y2FzZSA3OnJldHVybiBZaShhLCBiLCBiLnBlbmRpbmdQcm9wcywgYyksIGIuY2hpbGQ7Y2FzZSA4OnJldHVybiBZaShhLCBiLCBiLnBlbmRpbmdQcm9wcy5jaGlsZHJlbiwgYyksIGIuY2hpbGQ7Y2FzZSAxMjpyZXR1cm4gWWkoYSwgYiwgYi5wZW5kaW5nUHJvcHMuY2hpbGRyZW4sIGMpLCBiLmNoaWxkO2Nhc2UgMTA6YToge2QgPSBiLnR5cGUuX2NvbnRleHQ7ZSA9IGIucGVuZGluZ1Byb3BzO2YgPSBiLm1lbW9pemVkUHJvcHM7CiAgICAgICAgICAgICAgICAgIGcgPSBlLnZhbHVlO0coTWcsIGQuX2N1cnJlbnRWYWx1ZSk7ZC5fY3VycmVudFZhbHVlID0gZztpZiAobnVsbCAhPT0gZikgaWYgKEhlKGYudmFsdWUsIGcpKSB7aWYgKGYuY2hpbGRyZW4gPT09IGUuY2hpbGRyZW4gJiYgIVdmLmN1cnJlbnQpIHtiID0gJGkoYSwgYiwgYyk7YnJlYWsgYTt9fSBlbHNlIGZvciAoZiA9IGIuY2hpbGQsIG51bGwgIT09IGYgJiYgKGYucmV0dXJuID0gYik7IG51bGwgIT09IGY7KSB7dmFyIGggPSBmLmRlcGVuZGVuY2llcztpZiAobnVsbCAhPT0gaCkge2cgPSBmLmNoaWxkO2ZvciAodmFyIGsgPSBoLmZpcnN0Q29udGV4dDsgbnVsbCAhPT0gazspIHtpZiAoay5jb250ZXh0ID09PSBkKSB7aWYgKDEgPT09IGYudGFnKSB7ayA9IGNoKC0xLCBjICYgLWMpO2sudGFnID0gMjt2YXIgbCA9IGYudXBkYXRlUXVldWU7aWYgKG51bGwgIT09IGwpIHtsID0gbC5zaGFyZWQ7dmFyIG0gPSBsLnBlbmRpbmc7bnVsbCA9PT0gbSA/IGsubmV4dCA9IGsgOiAoay5uZXh0ID0gbS5uZXh0LCBtLm5leHQgPSBrKTtsLnBlbmRpbmcgPSBrO319Zi5sYW5lcyB8PSBjO2sgPSBmLmFsdGVybmF0ZTtudWxsICE9PSBrICYmIChrLmxhbmVzIHw9IGMpO1NnKGYucmV0dXJuLAogICAgICAgICAgICAgICAgICAgICAgICAgIGMsIGIpO2gubGFuZXMgfD0gYzticmVhazt9ayA9IGsubmV4dDt9fSBlbHNlIGlmICgxMCA9PT0gZi50YWcpIGcgPSBmLnR5cGUgPT09IGIudHlwZSA/IG51bGwgOiBmLmNoaWxkO2Vsc2UgaWYgKDE4ID09PSBmLnRhZykge2cgPSBmLnJldHVybjtpZiAobnVsbCA9PT0gZykgdGhyb3cgRXJyb3IocCgzNDEpKTtnLmxhbmVzIHw9IGM7aCA9IGcuYWx0ZXJuYXRlO251bGwgIT09IGggJiYgKGgubGFuZXMgfD0gYyk7U2coZywgYywgYik7ZyA9IGYuc2libGluZzt9IGVsc2UgZyA9IGYuY2hpbGQ7aWYgKG51bGwgIT09IGcpIGcucmV0dXJuID0gZjtlbHNlIGZvciAoZyA9IGY7IG51bGwgIT09IGc7KSB7aWYgKGcgPT09IGIpIHtnID0gbnVsbDticmVhazt9ZiA9IGcuc2libGluZztpZiAobnVsbCAhPT0gZikge2YucmV0dXJuID0gZy5yZXR1cm47ZyA9IGY7YnJlYWs7fWcgPSBnLnJldHVybjt9ZiA9IGc7fVlpKGEsIGIsIGUuY2hpbGRyZW4sIGMpO2IgPSBiLmNoaWxkO31yZXR1cm4gYjtjYXNlIDk6cmV0dXJuIGUgPSBiLnR5cGUsIGQgPSBiLnBlbmRpbmdQcm9wcy5jaGlsZHJlbiwgVGcoYiwgYyksIGUgPSBWZyhlKSwgZCA9IGQoZSksIGIuZmxhZ3MgfD0gMSwgWWkoYSwgYiwgZCwgYyksCiAgICAgICAgICAgICAgICBiLmNoaWxkO2Nhc2UgMTQ6cmV0dXJuIGQgPSBiLnR5cGUsIGUgPSBMZyhkLCBiLnBlbmRpbmdQcm9wcyksIGUgPSBMZyhkLnR5cGUsIGUpLCBhaihhLCBiLCBkLCBlLCBjKTtjYXNlIDE1OnJldHVybiBjaihhLCBiLCBiLnR5cGUsIGIucGVuZGluZ1Byb3BzLCBjKTtjYXNlIDE3OnJldHVybiBkID0gYi50eXBlLCBlID0gYi5wZW5kaW5nUHJvcHMsIGUgPSBiLmVsZW1lbnRUeXBlID09PSBkID8gZSA6IExnKGQsIGUpLCBqaihhLCBiKSwgYi50YWcgPSAxLCBaZihkKSA/IChhID0gITAsIGNnKGIpKSA6IGEgPSAhMSwgVGcoYiwgYyksIHBoKGIsIGQsIGUpLCByaChiLCBkLCBlLCBjKSwga2oobnVsbCwgYiwgZCwgITAsIGEsIGMpO2Nhc2UgMTk6cmV0dXJuIHlqKGEsIGIsIGMpO2Nhc2UgMjI6cmV0dXJuIGVqKGEsIGIsIGMpO310aHJvdyBFcnJvcihwKDE1NiwgYi50YWcpKTt9O2Z1bmN0aW9uIEdrKGEsIGIpIHtyZXR1cm4gYWMoYSwgYik7fQogICAgICAgICAgZnVuY3Rpb24gYWwoYSwgYiwgYywgZCkge3RoaXMudGFnID0gYTt0aGlzLmtleSA9IGM7dGhpcy5zaWJsaW5nID0gdGhpcy5jaGlsZCA9IHRoaXMucmV0dXJuID0gdGhpcy5zdGF0ZU5vZGUgPSB0aGlzLnR5cGUgPSB0aGlzLmVsZW1lbnRUeXBlID0gbnVsbDt0aGlzLmluZGV4ID0gMDt0aGlzLnJlZiA9IG51bGw7dGhpcy5wZW5kaW5nUHJvcHMgPSBiO3RoaXMuZGVwZW5kZW5jaWVzID0gdGhpcy5tZW1vaXplZFN0YXRlID0gdGhpcy51cGRhdGVRdWV1ZSA9IHRoaXMubWVtb2l6ZWRQcm9wcyA9IG51bGw7dGhpcy5tb2RlID0gZDt0aGlzLnN1YnRyZWVGbGFncyA9IHRoaXMuZmxhZ3MgPSAwO3RoaXMuZGVsZXRpb25zID0gbnVsbDt0aGlzLmNoaWxkTGFuZXMgPSB0aGlzLmxhbmVzID0gMDt0aGlzLmFsdGVybmF0ZSA9IG51bGw7fWZ1bmN0aW9uIEJnKGEsIGIsIGMsIGQpIHtyZXR1cm4gbmV3IGFsKGEsIGIsIGMsIGQpO31mdW5jdGlvbiBiaihhKSB7YSA9IGEucHJvdG90eXBlO3JldHVybiAhKCFhIHx8ICFhLmlzUmVhY3RDb21wb25lbnQpO30KICAgICAgICAgIGZ1bmN0aW9uICRrKGEpIHtpZiAoImZ1bmN0aW9uIiA9PT0gdHlwZW9mIGEpIHJldHVybiBiaihhKSA/IDEgOiAwO2lmICh2b2lkIDAgIT09IGEgJiYgbnVsbCAhPT0gYSkge2EgPSBhLiQkdHlwZW9mO2lmIChhID09PSBEYSkgcmV0dXJuIDExO2lmIChhID09PSBHYSkgcmV0dXJuIDE0O31yZXR1cm4gMjt9CiAgICAgICAgICBmdW5jdGlvbiB3aChhLCBiKSB7dmFyIGMgPSBhLmFsdGVybmF0ZTtudWxsID09PSBjID8gKGMgPSBCZyhhLnRhZywgYiwgYS5rZXksIGEubW9kZSksIGMuZWxlbWVudFR5cGUgPSBhLmVsZW1lbnRUeXBlLCBjLnR5cGUgPSBhLnR5cGUsIGMuc3RhdGVOb2RlID0gYS5zdGF0ZU5vZGUsIGMuYWx0ZXJuYXRlID0gYSwgYS5hbHRlcm5hdGUgPSBjKSA6IChjLnBlbmRpbmdQcm9wcyA9IGIsIGMudHlwZSA9IGEudHlwZSwgYy5mbGFncyA9IDAsIGMuc3VidHJlZUZsYWdzID0gMCwgYy5kZWxldGlvbnMgPSBudWxsKTtjLmZsYWdzID0gYS5mbGFncyAmIDE0NjgwMDY0O2MuY2hpbGRMYW5lcyA9IGEuY2hpbGRMYW5lcztjLmxhbmVzID0gYS5sYW5lcztjLmNoaWxkID0gYS5jaGlsZDtjLm1lbW9pemVkUHJvcHMgPSBhLm1lbW9pemVkUHJvcHM7Yy5tZW1vaXplZFN0YXRlID0gYS5tZW1vaXplZFN0YXRlO2MudXBkYXRlUXVldWUgPSBhLnVwZGF0ZVF1ZXVlO2IgPSBhLmRlcGVuZGVuY2llcztjLmRlcGVuZGVuY2llcyA9IG51bGwgPT09IGIgPyBudWxsIDogeyBsYW5lczogYi5sYW5lcywgZmlyc3RDb250ZXh0OiBiLmZpcnN0Q29udGV4dCB9OwogICAgICAgICAgICBjLnNpYmxpbmcgPSBhLnNpYmxpbmc7Yy5pbmRleCA9IGEuaW5kZXg7Yy5yZWYgPSBhLnJlZjtyZXR1cm4gYzt9CiAgICAgICAgICBmdW5jdGlvbiB5aChhLCBiLCBjLCBkLCBlLCBmKSB7dmFyIGcgPSAyO2QgPSBhO2lmICgiZnVuY3Rpb24iID09PSB0eXBlb2YgYSkgYmooYSkgJiYgKGcgPSAxKTtlbHNlIGlmICgic3RyaW5nIiA9PT0gdHlwZW9mIGEpIGcgPSA1O2Vsc2UgYTogc3dpdGNoIChhKSB7Y2FzZSB5YTpyZXR1cm4gQWgoYy5jaGlsZHJlbiwgZSwgZiwgYik7Y2FzZSB6YTpnID0gODtlIHw9IDg7YnJlYWs7Y2FzZSBBYTpyZXR1cm4gYSA9IEJnKDEyLCBjLCBiLCBlIHwgMiksIGEuZWxlbWVudFR5cGUgPSBBYSwgYS5sYW5lcyA9IGYsIGE7Y2FzZSBFYTpyZXR1cm4gYSA9IEJnKDEzLCBjLCBiLCBlKSwgYS5lbGVtZW50VHlwZSA9IEVhLCBhLmxhbmVzID0gZiwgYTtjYXNlIEZhOnJldHVybiBhID0gQmcoMTksIGMsIGIsIGUpLCBhLmVsZW1lbnRUeXBlID0gRmEsIGEubGFuZXMgPSBmLCBhO2Nhc2UgSWE6cmV0dXJuIHFqKGMsIGUsIGYsIGIpO2RlZmF1bHQ6aWYgKCJvYmplY3QiID09PSB0eXBlb2YgYSAmJiBudWxsICE9PSBhKSBzd2l0Y2ggKGEuJCR0eXBlb2YpIHtjYXNlIEJhOmcgPSAxMDticmVhayBhO2Nhc2UgQ2E6ZyA9IDk7YnJlYWsgYTtjYXNlIERhOmcgPSAxMTsKICAgICAgICAgICAgICAgICAgICBicmVhayBhO2Nhc2UgR2E6ZyA9IDE0O2JyZWFrIGE7Y2FzZSBIYTpnID0gMTY7ZCA9IG51bGw7YnJlYWsgYTt9dGhyb3cgRXJyb3IocCgxMzAsIG51bGwgPT0gYSA/IGEgOiB0eXBlb2YgYSwgIiIpKTt9YiA9IEJnKGcsIGMsIGIsIGUpO2IuZWxlbWVudFR5cGUgPSBhO2IudHlwZSA9IGQ7Yi5sYW5lcyA9IGY7cmV0dXJuIGI7fWZ1bmN0aW9uIEFoKGEsIGIsIGMsIGQpIHthID0gQmcoNywgYSwgZCwgYik7YS5sYW5lcyA9IGM7cmV0dXJuIGE7fWZ1bmN0aW9uIHFqKGEsIGIsIGMsIGQpIHthID0gQmcoMjIsIGEsIGQsIGIpO2EuZWxlbWVudFR5cGUgPSBJYTthLmxhbmVzID0gYzthLnN0YXRlTm9kZSA9IHsgaXNIaWRkZW46ICExIH07cmV0dXJuIGE7fWZ1bmN0aW9uIHhoKGEsIGIsIGMpIHthID0gQmcoNiwgYSwgbnVsbCwgYik7YS5sYW5lcyA9IGM7cmV0dXJuIGE7fQogICAgICAgICAgZnVuY3Rpb24gemgoYSwgYiwgYykge2IgPSBCZyg0LCBudWxsICE9PSBhLmNoaWxkcmVuID8gYS5jaGlsZHJlbiA6IFtdLCBhLmtleSwgYik7Yi5sYW5lcyA9IGM7Yi5zdGF0ZU5vZGUgPSB7IGNvbnRhaW5lckluZm86IGEuY29udGFpbmVySW5mbywgcGVuZGluZ0NoaWxkcmVuOiBudWxsLCBpbXBsZW1lbnRhdGlvbjogYS5pbXBsZW1lbnRhdGlvbiB9O3JldHVybiBiO30KICAgICAgICAgIGZ1bmN0aW9uIGJsKGEsIGIsIGMsIGQsIGUpIHt0aGlzLnRhZyA9IGI7dGhpcy5jb250YWluZXJJbmZvID0gYTt0aGlzLmZpbmlzaGVkV29yayA9IHRoaXMucGluZ0NhY2hlID0gdGhpcy5jdXJyZW50ID0gdGhpcy5wZW5kaW5nQ2hpbGRyZW4gPSBudWxsO3RoaXMudGltZW91dEhhbmRsZSA9IC0xO3RoaXMuY2FsbGJhY2tOb2RlID0gdGhpcy5wZW5kaW5nQ29udGV4dCA9IHRoaXMuY29udGV4dCA9IG51bGw7dGhpcy5jYWxsYmFja1ByaW9yaXR5ID0gMDt0aGlzLmV2ZW50VGltZXMgPSB6YygwKTt0aGlzLmV4cGlyYXRpb25UaW1lcyA9IHpjKC0xKTt0aGlzLmVudGFuZ2xlZExhbmVzID0gdGhpcy5maW5pc2hlZExhbmVzID0gdGhpcy5tdXRhYmxlUmVhZExhbmVzID0gdGhpcy5leHBpcmVkTGFuZXMgPSB0aGlzLnBpbmdlZExhbmVzID0gdGhpcy5zdXNwZW5kZWRMYW5lcyA9IHRoaXMucGVuZGluZ0xhbmVzID0gMDt0aGlzLmVudGFuZ2xlbWVudHMgPSB6YygwKTt0aGlzLmlkZW50aWZpZXJQcmVmaXggPSBkO3RoaXMub25SZWNvdmVyYWJsZUVycm9yID0gZTt0aGlzLm11dGFibGVTb3VyY2VFYWdlckh5ZHJhdGlvbkRhdGEgPQogICAgICAgICAgICBudWxsO31mdW5jdGlvbiBjbChhLCBiLCBjLCBkLCBlLCBmLCBnLCBoLCBrKSB7YSA9IG5ldyBibChhLCBiLCBjLCBoLCBrKTsxID09PSBiID8gKGIgPSAxLCAhMCA9PT0gZiAmJiAoYiB8PSA4KSkgOiBiID0gMDtmID0gQmcoMywgbnVsbCwgbnVsbCwgYik7YS5jdXJyZW50ID0gZjtmLnN0YXRlTm9kZSA9IGE7Zi5tZW1vaXplZFN0YXRlID0geyBlbGVtZW50OiBkLCBpc0RlaHlkcmF0ZWQ6IGMsIGNhY2hlOiBudWxsLCB0cmFuc2l0aW9uczogbnVsbCwgcGVuZGluZ1N1c3BlbnNlQm91bmRhcmllczogbnVsbCB9O2FoKGYpO3JldHVybiBhO31mdW5jdGlvbiBkbChhLCBiLCBjKSB7dmFyIGQgPSAzIDwgYXJndW1lbnRzLmxlbmd0aCAmJiB2b2lkIDAgIT09IGFyZ3VtZW50c1szXSA/IGFyZ3VtZW50c1szXSA6IG51bGw7cmV0dXJuIHsgJCR0eXBlb2Y6IHdhLCBrZXk6IG51bGwgPT0gZCA/IG51bGwgOiAiIiArIGQsIGNoaWxkcmVuOiBhLCBjb250YWluZXJJbmZvOiBiLCBpbXBsZW1lbnRhdGlvbjogYyB9O30KICAgICAgICAgIGZ1bmN0aW9uIGVsKGEpIHtpZiAoIWEpIHJldHVybiBWZjthID0gYS5fcmVhY3RJbnRlcm5hbHM7YToge2lmIChWYihhKSAhPT0gYSB8fCAxICE9PSBhLnRhZykgdGhyb3cgRXJyb3IocCgxNzApKTt2YXIgYiA9IGE7ZG8ge3N3aXRjaCAoYi50YWcpIHtjYXNlIDM6YiA9IGIuc3RhdGVOb2RlLmNvbnRleHQ7YnJlYWsgYTtjYXNlIDE6aWYgKFpmKGIudHlwZSkpIHtiID0gYi5zdGF0ZU5vZGUuX19yZWFjdEludGVybmFsTWVtb2l6ZWRNZXJnZWRDaGlsZENvbnRleHQ7YnJlYWsgYTt9fWIgPSBiLnJldHVybjt9IHdoaWxlIChudWxsICE9PSBiKTt0aHJvdyBFcnJvcihwKDE3MSkpO31pZiAoMSA9PT0gYS50YWcpIHt2YXIgYyA9IGEudHlwZTtpZiAoWmYoYykpIHJldHVybiBiZyhhLCBjLCBiKTt9cmV0dXJuIGI7fQogICAgICAgICAgZnVuY3Rpb24gZmwoYSwgYiwgYywgZCwgZSwgZiwgZywgaCwgaykge2EgPSBjbChjLCBkLCAhMCwgYSwgZSwgZiwgZywgaCwgayk7YS5jb250ZXh0ID0gZWwobnVsbCk7YyA9IGEuY3VycmVudDtkID0gTCgpO2UgPSBsaChjKTtmID0gY2goZCwgZSk7Zi5jYWxsYmFjayA9IHZvaWQgMCAhPT0gYiAmJiBudWxsICE9PSBiID8gYiA6IG51bGw7ZGgoYywgZiwgZSk7YS5jdXJyZW50LmxhbmVzID0gZTtBYyhhLCBlLCBkKTtFayhhLCBkKTtyZXR1cm4gYTt9ZnVuY3Rpb24gZ2woYSwgYiwgYywgZCkge3ZhciBlID0gYi5jdXJyZW50LGYgPSBMKCksZyA9IGxoKGUpO2MgPSBlbChjKTtudWxsID09PSBiLmNvbnRleHQgPyBiLmNvbnRleHQgPSBjIDogYi5wZW5kaW5nQ29udGV4dCA9IGM7YiA9IGNoKGYsIGcpO2IucGF5bG9hZCA9IHsgZWxlbWVudDogYSB9O2QgPSB2b2lkIDAgPT09IGQgPyBudWxsIDogZDtudWxsICE9PSBkICYmIChiLmNhbGxiYWNrID0gZCk7YSA9IGRoKGUsIGIsIGcpO251bGwgIT09IGEgJiYgKG1oKGEsIGUsIGcsIGYpLCBlaChhLCBlLCBnKSk7cmV0dXJuIGc7fQogICAgICAgICAgZnVuY3Rpb24gaGwoYSkge2EgPSBhLmN1cnJlbnQ7aWYgKCFhLmNoaWxkKSByZXR1cm4gbnVsbDtzd2l0Y2ggKGEuY2hpbGQudGFnKSB7Y2FzZSA1OnJldHVybiBhLmNoaWxkLnN0YXRlTm9kZTtkZWZhdWx0OnJldHVybiBhLmNoaWxkLnN0YXRlTm9kZTt9fWZ1bmN0aW9uIGlsKGEsIGIpIHthID0gYS5tZW1vaXplZFN0YXRlO2lmIChudWxsICE9PSBhICYmIG51bGwgIT09IGEuZGVoeWRyYXRlZCkge3ZhciBjID0gYS5yZXRyeUxhbmU7YS5yZXRyeUxhbmUgPSAwICE9PSBjICYmIGMgPCBiID8gYyA6IGI7fX1mdW5jdGlvbiBqbChhLCBiKSB7aWwoYSwgYik7KGEgPSBhLmFsdGVybmF0ZSkgJiYgaWwoYSwgYik7fWZ1bmN0aW9uIGtsKCkge3JldHVybiBudWxsO312YXIgbGwgPSAiZnVuY3Rpb24iID09PSB0eXBlb2YgcmVwb3J0RXJyb3IgPyByZXBvcnRFcnJvciA6IGZ1bmN0aW9uIChhKSB7Y29uc29sZS5lcnJvcihhKTt9O2Z1bmN0aW9uIG1sKGEpIHt0aGlzLl9pbnRlcm5hbFJvb3QgPSBhO30KICAgICAgICAgIG5sLnByb3RvdHlwZS5yZW5kZXIgPSBtbC5wcm90b3R5cGUucmVuZGVyID0gZnVuY3Rpb24gKGEpIHt2YXIgYiA9IHRoaXMuX2ludGVybmFsUm9vdDtpZiAobnVsbCA9PT0gYikgdGhyb3cgRXJyb3IocCg0MDkpKTtnbChhLCBiLCBudWxsLCBudWxsKTt9O25sLnByb3RvdHlwZS51bm1vdW50ID0gbWwucHJvdG90eXBlLnVubW91bnQgPSBmdW5jdGlvbiAoKSB7dmFyIGEgPSB0aGlzLl9pbnRlcm5hbFJvb3Q7aWYgKG51bGwgIT09IGEpIHt0aGlzLl9pbnRlcm5hbFJvb3QgPSBudWxsO3ZhciBiID0gYS5jb250YWluZXJJbmZvO1NrKGZ1bmN0aW9uICgpIHtnbChudWxsLCBhLCBudWxsLCBudWxsKTt9KTtiW3VmXSA9IG51bGw7fX07ZnVuY3Rpb24gbmwoYSkge3RoaXMuX2ludGVybmFsUm9vdCA9IGE7fQogICAgICAgICAgbmwucHJvdG90eXBlLnVuc3RhYmxlX3NjaGVkdWxlSHlkcmF0aW9uID0gZnVuY3Rpb24gKGEpIHtpZiAoYSkge3ZhciBiID0gSGMoKTthID0geyBibG9ja2VkT246IG51bGwsIHRhcmdldDogYSwgcHJpb3JpdHk6IGIgfTtmb3IgKHZhciBjID0gMDsgYyA8IFFjLmxlbmd0aCAmJiAwICE9PSBiICYmIGIgPCBRY1tjXS5wcmlvcml0eTsgYysrKSB7O31RYy5zcGxpY2UoYywgMCwgYSk7MCA9PT0gYyAmJiBWYyhhKTt9fTtmdW5jdGlvbiBvbChhKSB7cmV0dXJuICEoIWEgfHwgMSAhPT0gYS5ub2RlVHlwZSAmJiA5ICE9PSBhLm5vZGVUeXBlICYmIDExICE9PSBhLm5vZGVUeXBlKTt9ZnVuY3Rpb24gcGwoYSkge3JldHVybiAhKCFhIHx8IDEgIT09IGEubm9kZVR5cGUgJiYgOSAhPT0gYS5ub2RlVHlwZSAmJiAxMSAhPT0gYS5ub2RlVHlwZSAmJiAoOCAhPT0gYS5ub2RlVHlwZSB8fCAiIHJlYWN0LW1vdW50LXBvaW50LXVuc3RhYmxlICIgIT09IGEubm9kZVZhbHVlKSk7fWZ1bmN0aW9uIHFsKCkge30KICAgICAgICAgIGZ1bmN0aW9uIHJsKGEsIGIsIGMsIGQsIGUpIHtpZiAoZSkge2lmICgiZnVuY3Rpb24iID09PSB0eXBlb2YgZCkge3ZhciBmID0gZDtkID0gZnVuY3Rpb24gZCgpIHt2YXIgYSA9IGhsKGcpO2YuY2FsbChhKTt9O312YXIgZyA9IGZsKGIsIGQsIGEsIDAsIG51bGwsICExLCAhMSwgIiIsIHFsKTthLl9yZWFjdFJvb3RDb250YWluZXIgPSBnO2FbdWZdID0gZy5jdXJyZW50O3NmKDggPT09IGEubm9kZVR5cGUgPyBhLnBhcmVudE5vZGUgOiBhKTtTaygpO3JldHVybiBnO31mb3IgKDsgZSA9IGEubGFzdENoaWxkOykge2EucmVtb3ZlQ2hpbGQoZSk7fWlmICgiZnVuY3Rpb24iID09PSB0eXBlb2YgZCkge3ZhciBoID0gZDtkID0gZnVuY3Rpb24gZCgpIHt2YXIgYSA9IGhsKGspO2guY2FsbChhKTt9O312YXIgayA9IGNsKGEsIDAsICExLCBudWxsLCBudWxsLCAhMSwgITEsICIiLCBxbCk7YS5fcmVhY3RSb290Q29udGFpbmVyID0gazthW3VmXSA9IGsuY3VycmVudDtzZig4ID09PSBhLm5vZGVUeXBlID8gYS5wYXJlbnROb2RlIDogYSk7U2soZnVuY3Rpb24gKCkge2dsKGIsIGssIGMsIGQpO30pO3JldHVybiBrO30KICAgICAgICAgIGZ1bmN0aW9uIHNsKGEsIGIsIGMsIGQsIGUpIHt2YXIgZiA9IGMuX3JlYWN0Um9vdENvbnRhaW5lcjtpZiAoZikge3ZhciBnID0gZjtpZiAoImZ1bmN0aW9uIiA9PT0gdHlwZW9mIGUpIHt2YXIgaCA9IGU7ZSA9IGZ1bmN0aW9uIGUoKSB7dmFyIGEgPSBobChnKTtoLmNhbGwoYSk7fTt9Z2woYiwgZywgYSwgZSk7fSBlbHNlIGcgPSBybChjLCBiLCBhLCBlLCBkKTtyZXR1cm4gaGwoZyk7fUVjID0gZnVuY3Rpb24gRWMoYSkge3N3aXRjaCAoYS50YWcpIHtjYXNlIDM6dmFyIGIgPSBhLnN0YXRlTm9kZTtpZiAoYi5jdXJyZW50Lm1lbW9pemVkU3RhdGUuaXNEZWh5ZHJhdGVkKSB7dmFyIGMgPSB0YyhiLnBlbmRpbmdMYW5lcyk7MCAhPT0gYyAmJiAoQ2MoYiwgYyB8IDEpLCBFayhiLCBCKCkpLCAwID09PSAoSyAmIDYpICYmIChIaiA9IEIoKSArIDUwMCwgamcoKSkpO31icmVhaztjYXNlIDEzOlNrKGZ1bmN0aW9uICgpIHt2YXIgYiA9IFpnKGEsIDEpO2lmIChudWxsICE9PSBiKSB7dmFyIGMgPSBMKCk7bWgoYiwgYSwgMSwgYyk7fX0pLCBqbChhLCAxKTt9fTsKICAgICAgICAgIEZjID0gZnVuY3Rpb24gRmMoYSkge2lmICgxMyA9PT0gYS50YWcpIHt2YXIgYiA9IFpnKGEsIDEzNDIxNzcyOCk7aWYgKG51bGwgIT09IGIpIHt2YXIgYyA9IEwoKTttaChiLCBhLCAxMzQyMTc3MjgsIGMpO31qbChhLCAxMzQyMTc3MjgpO319O0djID0gZnVuY3Rpb24gR2MoYSkge2lmICgxMyA9PT0gYS50YWcpIHt2YXIgYiA9IGxoKGEpLGMgPSBaZyhhLCBiKTtpZiAobnVsbCAhPT0gYykge3ZhciBkID0gTCgpO21oKGMsIGEsIGIsIGQpO31qbChhLCBiKTt9fTtIYyA9IGZ1bmN0aW9uIEhjKCkge3JldHVybiBDO307SWMgPSBmdW5jdGlvbiBJYyhhLCBiKSB7dmFyIGMgPSBDO3RyeSB7cmV0dXJuIEMgPSBhLCBiKCk7fSBmaW5hbGx5IHtDID0gYzt9fTsKICAgICAgICAgIHliID0gZnVuY3Rpb24geWIoYSwgYiwgYykge3N3aXRjaCAoYikge2Nhc2UgImlucHV0IjpiYihhLCBjKTtiID0gYy5uYW1lO2lmICgicmFkaW8iID09PSBjLnR5cGUgJiYgbnVsbCAhPSBiKSB7Zm9yIChjID0gYTsgYy5wYXJlbnROb2RlOykge2MgPSBjLnBhcmVudE5vZGU7fWMgPSBjLnF1ZXJ5U2VsZWN0b3JBbGwoImlucHV0W25hbWU9IiArIEpTT04uc3RyaW5naWZ5KCIiICsgYikgKyAnXVt0eXBlPSJyYWRpbyJdJyk7Zm9yIChiID0gMDsgYiA8IGMubGVuZ3RoOyBiKyspIHt2YXIgZCA9IGNbYl07aWYgKGQgIT09IGEgJiYgZC5mb3JtID09PSBhLmZvcm0pIHt2YXIgZSA9IERiKGQpO2lmICghZSkgdGhyb3cgRXJyb3IocCg5MCkpO1dhKGQpO2JiKGQsIGUpO319fWJyZWFrO2Nhc2UgInRleHRhcmVhIjppYihhLCBjKTticmVhaztjYXNlICJzZWxlY3QiOmIgPSBjLnZhbHVlLCBudWxsICE9IGIgJiYgZmIoYSwgISFjLm11bHRpcGxlLCBiLCAhMSk7fX07R2IgPSBSaztIYiA9IFNrOwogICAgICAgICAgdmFyIHRsID0geyB1c2luZ0NsaWVudEVudHJ5UG9pbnQ6ICExLCBFdmVudHM6IFtDYiwgdWUsIERiLCBFYiwgRmIsIFJrXSB9LHVsID0geyBmaW5kRmliZXJCeUhvc3RJbnN0YW5jZTogV2MsIGJ1bmRsZVR5cGU6IDAsIHZlcnNpb246ICIxOC4yLjAiLCByZW5kZXJlclBhY2thZ2VOYW1lOiAicmVhY3QtZG9tIiB9OwogICAgICAgICAgdmFyIHZsID0geyBidW5kbGVUeXBlOiB1bC5idW5kbGVUeXBlLCB2ZXJzaW9uOiB1bC52ZXJzaW9uLCByZW5kZXJlclBhY2thZ2VOYW1lOiB1bC5yZW5kZXJlclBhY2thZ2VOYW1lLCByZW5kZXJlckNvbmZpZzogdWwucmVuZGVyZXJDb25maWcsIG92ZXJyaWRlSG9va1N0YXRlOiBudWxsLCBvdmVycmlkZUhvb2tTdGF0ZURlbGV0ZVBhdGg6IG51bGwsIG92ZXJyaWRlSG9va1N0YXRlUmVuYW1lUGF0aDogbnVsbCwgb3ZlcnJpZGVQcm9wczogbnVsbCwgb3ZlcnJpZGVQcm9wc0RlbGV0ZVBhdGg6IG51bGwsIG92ZXJyaWRlUHJvcHNSZW5hbWVQYXRoOiBudWxsLCBzZXRFcnJvckhhbmRsZXI6IG51bGwsIHNldFN1c3BlbnNlSGFuZGxlcjogbnVsbCwgc2NoZWR1bGVVcGRhdGU6IG51bGwsIGN1cnJlbnREaXNwYXRjaGVyUmVmOiB1YS5SZWFjdEN1cnJlbnREaXNwYXRjaGVyLCBmaW5kSG9zdEluc3RhbmNlQnlGaWJlcjogZnVuY3Rpb24gZmluZEhvc3RJbnN0YW5jZUJ5RmliZXIoYSkge2EgPSBaYihhKTtyZXR1cm4gbnVsbCA9PT0gYSA/IG51bGwgOiBhLnN0YXRlTm9kZTt9LCBmaW5kRmliZXJCeUhvc3RJbnN0YW5jZTogdWwuZmluZEZpYmVyQnlIb3N0SW5zdGFuY2UgfHwKICAgICAgICAgICAga2wsIGZpbmRIb3N0SW5zdGFuY2VzRm9yUmVmcmVzaDogbnVsbCwgc2NoZWR1bGVSZWZyZXNoOiBudWxsLCBzY2hlZHVsZVJvb3Q6IG51bGwsIHNldFJlZnJlc2hIYW5kbGVyOiBudWxsLCBnZXRDdXJyZW50RmliZXI6IG51bGwsIHJlY29uY2lsZXJWZXJzaW9uOiAiMTguMi4wLW5leHQtOWUzYjc3MmI4LTIwMjIwNjA4IiB9O2lmICgidW5kZWZpbmVkIiAhPT0gdHlwZW9mIF9fUkVBQ1RfREVWVE9PTFNfR0xPQkFMX0hPT0tfXykge3ZhciB3bCA9IF9fUkVBQ1RfREVWVE9PTFNfR0xPQkFMX0hPT0tfXztpZiAoIXdsLmlzRGlzYWJsZWQgJiYgd2wuc3VwcG9ydHNGaWJlcikgdHJ5IHtrYyA9IHdsLmluamVjdCh2bCksIGxjID0gd2w7fSBjYXRjaCAoYSkge319ZXhwb3J0cy5fX1NFQ1JFVF9JTlRFUk5BTFNfRE9fTk9UX1VTRV9PUl9ZT1VfV0lMTF9CRV9GSVJFRCA9IHRsOwogICAgICAgICAgZXhwb3J0cy5jcmVhdGVQb3J0YWwgPSBmdW5jdGlvbiAoYSwgYikge3ZhciBjID0gMiA8IGFyZ3VtZW50cy5sZW5ndGggJiYgdm9pZCAwICE9PSBhcmd1bWVudHNbMl0gPyBhcmd1bWVudHNbMl0gOiBudWxsO2lmICghb2woYikpIHRocm93IEVycm9yKHAoMjAwKSk7cmV0dXJuIGRsKGEsIGIsIG51bGwsIGMpO307ZXhwb3J0cy5jcmVhdGVSb290ID0gZnVuY3Rpb24gKGEsIGIpIHtpZiAoIW9sKGEpKSB0aHJvdyBFcnJvcihwKDI5OSkpO3ZhciBjID0gITEsZCA9ICIiLGUgPSBsbDtudWxsICE9PSBiICYmIHZvaWQgMCAhPT0gYiAmJiAoITAgPT09IGIudW5zdGFibGVfc3RyaWN0TW9kZSAmJiAoYyA9ICEwKSwgdm9pZCAwICE9PSBiLmlkZW50aWZpZXJQcmVmaXggJiYgKGQgPSBiLmlkZW50aWZpZXJQcmVmaXgpLCB2b2lkIDAgIT09IGIub25SZWNvdmVyYWJsZUVycm9yICYmIChlID0gYi5vblJlY292ZXJhYmxlRXJyb3IpKTtiID0gY2woYSwgMSwgITEsIG51bGwsIG51bGwsIGMsICExLCBkLCBlKTthW3VmXSA9IGIuY3VycmVudDtzZig4ID09PSBhLm5vZGVUeXBlID8gYS5wYXJlbnROb2RlIDogYSk7cmV0dXJuIG5ldyBtbChiKTt9OwogICAgICAgICAgZXhwb3J0cy5maW5kRE9NTm9kZSA9IGZ1bmN0aW9uIChhKSB7aWYgKG51bGwgPT0gYSkgcmV0dXJuIG51bGw7aWYgKDEgPT09IGEubm9kZVR5cGUpIHJldHVybiBhO3ZhciBiID0gYS5fcmVhY3RJbnRlcm5hbHM7aWYgKHZvaWQgMCA9PT0gYikge2lmICgiZnVuY3Rpb24iID09PSB0eXBlb2YgYS5yZW5kZXIpIHRocm93IEVycm9yKHAoMTg4KSk7YSA9IE9iamVjdC5rZXlzKGEpLmpvaW4oIiwiKTt0aHJvdyBFcnJvcihwKDI2OCwgYSkpO31hID0gWmIoYik7YSA9IG51bGwgPT09IGEgPyBudWxsIDogYS5zdGF0ZU5vZGU7cmV0dXJuIGE7fTtleHBvcnRzLmZsdXNoU3luYyA9IGZ1bmN0aW9uIChhKSB7cmV0dXJuIFNrKGEpO307ZXhwb3J0cy5oeWRyYXRlID0gZnVuY3Rpb24gKGEsIGIsIGMpIHtpZiAoIXBsKGIpKSB0aHJvdyBFcnJvcihwKDIwMCkpO3JldHVybiBzbChudWxsLCBhLCBiLCAhMCwgYyk7fTsKICAgICAgICAgIGV4cG9ydHMuaHlkcmF0ZVJvb3QgPSBmdW5jdGlvbiAoYSwgYiwgYykge2lmICghb2woYSkpIHRocm93IEVycm9yKHAoNDA1KSk7dmFyIGQgPSBudWxsICE9IGMgJiYgYy5oeWRyYXRlZFNvdXJjZXMgfHwgbnVsbCxlID0gITEsZiA9ICIiLGcgPSBsbDtudWxsICE9PSBjICYmIHZvaWQgMCAhPT0gYyAmJiAoITAgPT09IGMudW5zdGFibGVfc3RyaWN0TW9kZSAmJiAoZSA9ICEwKSwgdm9pZCAwICE9PSBjLmlkZW50aWZpZXJQcmVmaXggJiYgKGYgPSBjLmlkZW50aWZpZXJQcmVmaXgpLCB2b2lkIDAgIT09IGMub25SZWNvdmVyYWJsZUVycm9yICYmIChnID0gYy5vblJlY292ZXJhYmxlRXJyb3IpKTtiID0gZmwoYiwgbnVsbCwgYSwgMSwgbnVsbCAhPSBjID8gYyA6IG51bGwsIGUsICExLCBmLCBnKTthW3VmXSA9IGIuY3VycmVudDtzZihhKTtpZiAoZCkgZm9yIChhID0gMDsgYSA8IGQubGVuZ3RoOyBhKyspIHtjID0gZFthXSwgZSA9IGMuX2dldFZlcnNpb24sIGUgPSBlKGMuX3NvdXJjZSksIG51bGwgPT0gYi5tdXRhYmxlU291cmNlRWFnZXJIeWRyYXRpb25EYXRhID8gYi5tdXRhYmxlU291cmNlRWFnZXJIeWRyYXRpb25EYXRhID0gW2MsIGVdIDogYi5tdXRhYmxlU291cmNlRWFnZXJIeWRyYXRpb25EYXRhLnB1c2goYywKICAgICAgICAgICAgICBlKTt9cmV0dXJuIG5ldyBubChiKTt9O2V4cG9ydHMucmVuZGVyID0gZnVuY3Rpb24gKGEsIGIsIGMpIHtpZiAoIXBsKGIpKSB0aHJvdyBFcnJvcihwKDIwMCkpO3JldHVybiBzbChudWxsLCBhLCBiLCAhMSwgYyk7fTtleHBvcnRzLnVubW91bnRDb21wb25lbnRBdE5vZGUgPSBmdW5jdGlvbiAoYSkge2lmICghcGwoYSkpIHRocm93IEVycm9yKHAoNDApKTtyZXR1cm4gYS5fcmVhY3RSb290Q29udGFpbmVyID8gKFNrKGZ1bmN0aW9uICgpIHtzbChudWxsLCBudWxsLCBhLCAhMSwgZnVuY3Rpb24gKCkge2EuX3JlYWN0Um9vdENvbnRhaW5lciA9IG51bGw7YVt1Zl0gPSBudWxsO30pO30pLCAhMCkgOiAhMTt9O2V4cG9ydHMudW5zdGFibGVfYmF0Y2hlZFVwZGF0ZXMgPSBSazsKICAgICAgICAgIGV4cG9ydHMudW5zdGFibGVfcmVuZGVyU3VidHJlZUludG9Db250YWluZXIgPSBmdW5jdGlvbiAoYSwgYiwgYywgZCkge2lmICghcGwoYykpIHRocm93IEVycm9yKHAoMjAwKSk7aWYgKG51bGwgPT0gYSB8fCB2b2lkIDAgPT09IGEuX3JlYWN0SW50ZXJuYWxzKSB0aHJvdyBFcnJvcihwKDM4KSk7cmV0dXJuIHNsKGEsIGIsIGMsICExLCBkKTt9O2V4cG9ydHMudmVyc2lvbiA9ICIxOC4yLjAtbmV4dC05ZTNiNzcyYjgtMjAyMjA2MDgiOwoKCiAgICAgICAgICAvKioqL30sCgogICAgICAgIC8qKiovNzQ1OgogICAgICAgIC8qKiovKF9fdW51c2VkX3dlYnBhY2tfbW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSA9PiB7CgogICAgICAgICAgdmFyIF9fd2VicGFja191bnVzZWRfZXhwb3J0X187CgoKICAgICAgICAgIHZhciBtID0gX193ZWJwYWNrX3JlcXVpcmVfXyg5MzUpOwogICAgICAgICAgaWYgKHRydWUpIHsKICAgICAgICAgICAgZXhwb3J0cy5zID0gbS5jcmVhdGVSb290OwogICAgICAgICAgICBfX3dlYnBhY2tfdW51c2VkX2V4cG9ydF9fID0gbS5oeWRyYXRlUm9vdDsKICAgICAgICAgIH0gZWxzZSB7dmFyIGk7fQoKCiAgICAgICAgICAvKioqL30sCgogICAgICAgIC8qKiovOTM1OgogICAgICAgIC8qKiovKG1vZHVsZSwgX191bnVzZWRfd2VicGFja19leHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSA9PiB7CgoKCiAgICAgICAgICBmdW5jdGlvbiBjaGVja0RDRSgpIHsKICAgICAgICAgICAgLyogZ2xvYmFsIF9fUkVBQ1RfREVWVE9PTFNfR0xPQkFMX0hPT0tfXyAqLwogICAgICAgICAgICBpZiAoCiAgICAgICAgICAgIHR5cGVvZiBfX1JFQUNUX0RFVlRPT0xTX0dMT0JBTF9IT09LX18gPT09ICd1bmRlZmluZWQnIHx8CiAgICAgICAgICAgIHR5cGVvZiBfX1JFQUNUX0RFVlRPT0xTX0dMT0JBTF9IT09LX18uY2hlY2tEQ0UgIT09ICdmdW5jdGlvbicpCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKGZhbHNlKSB7fQogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgIC8vIFZlcmlmeSB0aGF0IHRoZSBjb2RlIGFib3ZlIGhhcyBiZWVuIGRlYWQgY29kZSBlbGltaW5hdGVkIChEQ0UnZCkuCiAgICAgICAgICAgICAgX19SRUFDVF9ERVZUT09MU19HTE9CQUxfSE9PS19fLmNoZWNrRENFKGNoZWNrRENFKTsKICAgICAgICAgICAgfSBjYXRjaCAoZXJyKSB7CiAgICAgICAgICAgICAgLy8gRGV2VG9vbHMgc2hvdWxkbid0IGNyYXNoIFJlYWN0LCBubyBtYXR0ZXIgd2hhdC4KICAgICAgICAgICAgICAvLyBXZSBzaG91bGQgc3RpbGwgcmVwb3J0IGluIGNhc2Ugd2UgYnJlYWsgdGhpcyBjb2RlLgogICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQoKICAgICAgICAgIGlmICh0cnVlKSB7CiAgICAgICAgICAgIC8vIERDRSBjaGVjayBzaG91bGQgaGFwcGVuIGJlZm9yZSBSZWFjdERPTSBidW5kbGUgZXhlY3V0ZXMgc28gdGhhdAogICAgICAgICAgICAvLyBEZXZUb29scyBjYW4gcmVwb3J0IGJhZCBtaW5pZmljYXRpb24gZHVyaW5nIGluamVjdGlvbi4KICAgICAgICAgICAgY2hlY2tEQ0UoKTsKICAgICAgICAgICAgbW9kdWxlLmV4cG9ydHMgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDQ0OCk7CiAgICAgICAgICB9IGVsc2Uge30KCgogICAgICAgICAgLyoqKi99LAoKICAgICAgICAvKioqLzQwODoKICAgICAgICAvKioqLyhfX3VudXNlZF93ZWJwYWNrX21vZHVsZSwgZXhwb3J0cykgPT4gewoKICAgICAgICAgIC8qKgogICAgICAgICAgICogQGxpY2Vuc2UgUmVhY3QKICAgICAgICAgICAqIHJlYWN0LnByb2R1Y3Rpb24ubWluLmpzCiAgICAgICAgICAgKgogICAgICAgICAgICogQ29weXJpZ2h0IChjKSBGYWNlYm9vaywgSW5jLiBhbmQgaXRzIGFmZmlsaWF0ZXMuCiAgICAgICAgICAgKgogICAgICAgICAgICogVGhpcyBzb3VyY2UgY29kZSBpcyBsaWNlbnNlZCB1bmRlciB0aGUgTUlUIGxpY2Vuc2UgZm91bmQgaW4gdGhlCiAgICAgICAgICAgKiBMSUNFTlNFIGZpbGUgaW4gdGhlIHJvb3QgZGlyZWN0b3J5IG9mIHRoaXMgc291cmNlIHRyZWUuCiAgICAgICAgICAgKi8KICAgICAgICAgIHZhciBsID0gU3ltYm9sLmZvcigicmVhY3QuZWxlbWVudCIpLG4gPSBTeW1ib2wuZm9yKCJyZWFjdC5wb3J0YWwiKSxwID0gU3ltYm9sLmZvcigicmVhY3QuZnJhZ21lbnQiKSxxID0gU3ltYm9sLmZvcigicmVhY3Quc3RyaWN0X21vZGUiKSxyID0gU3ltYm9sLmZvcigicmVhY3QucHJvZmlsZXIiKSx0ID0gU3ltYm9sLmZvcigicmVhY3QucHJvdmlkZXIiKSx1ID0gU3ltYm9sLmZvcigicmVhY3QuY29udGV4dCIpLHYgPSBTeW1ib2wuZm9yKCJyZWFjdC5mb3J3YXJkX3JlZiIpLHcgPSBTeW1ib2wuZm9yKCJyZWFjdC5zdXNwZW5zZSIpLHggPSBTeW1ib2wuZm9yKCJyZWFjdC5tZW1vIikseSA9IFN5bWJvbC5mb3IoInJlYWN0LmxhenkiKSx6ID0gU3ltYm9sLml0ZXJhdG9yO2Z1bmN0aW9uIEEoYSkge2lmIChudWxsID09PSBhIHx8ICJvYmplY3QiICE9PSB0eXBlb2YgYSkgcmV0dXJuIG51bGw7YSA9IHogJiYgYVt6XSB8fCBhWyJAQGl0ZXJhdG9yIl07cmV0dXJuICJmdW5jdGlvbiIgPT09IHR5cGVvZiBhID8gYSA6IG51bGw7fQogICAgICAgICAgdmFyIEIgPSB7IGlzTW91bnRlZDogZnVuY3Rpb24gaXNNb3VudGVkKCkge3JldHVybiAhMTt9LCBlbnF1ZXVlRm9yY2VVcGRhdGU6IGZ1bmN0aW9uIGVucXVldWVGb3JjZVVwZGF0ZSgpIHt9LCBlbnF1ZXVlUmVwbGFjZVN0YXRlOiBmdW5jdGlvbiBlbnF1ZXVlUmVwbGFjZVN0YXRlKCkge30sIGVucXVldWVTZXRTdGF0ZTogZnVuY3Rpb24gZW5xdWV1ZVNldFN0YXRlKCkge30gfSxDID0gT2JqZWN0LmFzc2lnbixEID0ge307ZnVuY3Rpb24gRShhLCBiLCBlKSB7dGhpcy5wcm9wcyA9IGE7dGhpcy5jb250ZXh0ID0gYjt0aGlzLnJlZnMgPSBEO3RoaXMudXBkYXRlciA9IGUgfHwgQjt9RS5wcm90b3R5cGUuaXNSZWFjdENvbXBvbmVudCA9IHt9OwogICAgICAgICAgRS5wcm90b3R5cGUuc2V0U3RhdGUgPSBmdW5jdGlvbiAoYSwgYikge2lmICgib2JqZWN0IiAhPT0gdHlwZW9mIGEgJiYgImZ1bmN0aW9uIiAhPT0gdHlwZW9mIGEgJiYgbnVsbCAhPSBhKSB0aHJvdyBFcnJvcigic2V0U3RhdGUoLi4uKTogdGFrZXMgYW4gb2JqZWN0IG9mIHN0YXRlIHZhcmlhYmxlcyB0byB1cGRhdGUgb3IgYSBmdW5jdGlvbiB3aGljaCByZXR1cm5zIGFuIG9iamVjdCBvZiBzdGF0ZSB2YXJpYWJsZXMuIik7dGhpcy51cGRhdGVyLmVucXVldWVTZXRTdGF0ZSh0aGlzLCBhLCBiLCAic2V0U3RhdGUiKTt9O0UucHJvdG90eXBlLmZvcmNlVXBkYXRlID0gZnVuY3Rpb24gKGEpIHt0aGlzLnVwZGF0ZXIuZW5xdWV1ZUZvcmNlVXBkYXRlKHRoaXMsIGEsICJmb3JjZVVwZGF0ZSIpO307ZnVuY3Rpb24gRigpIHt9Ri5wcm90b3R5cGUgPSBFLnByb3RvdHlwZTtmdW5jdGlvbiBHKGEsIGIsIGUpIHt0aGlzLnByb3BzID0gYTt0aGlzLmNvbnRleHQgPSBiO3RoaXMucmVmcyA9IEQ7dGhpcy51cGRhdGVyID0gZSB8fCBCO312YXIgSCA9IEcucHJvdG90eXBlID0gbmV3IEYoKTsKICAgICAgICAgIEguY29uc3RydWN0b3IgPSBHO0MoSCwgRS5wcm90b3R5cGUpO0guaXNQdXJlUmVhY3RDb21wb25lbnQgPSAhMDt2YXIgSSA9IEFycmF5LmlzQXJyYXksSiA9IE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHksSyA9IHsgY3VycmVudDogbnVsbCB9LEwgPSB7IGtleTogITAsIHJlZjogITAsIF9fc2VsZjogITAsIF9fc291cmNlOiAhMCB9OwogICAgICAgICAgZnVuY3Rpb24gTShhLCBiLCBlKSB7dmFyIGQsYyA9IHt9LGsgPSBudWxsLGggPSBudWxsO2lmIChudWxsICE9IGIpIGZvciAoZCBpbiB2b2lkIDAgIT09IGIucmVmICYmIChoID0gYi5yZWYpLCB2b2lkIDAgIT09IGIua2V5ICYmIChrID0gIiIgKyBiLmtleSksIGIpIHtKLmNhbGwoYiwgZCkgJiYgIUwuaGFzT3duUHJvcGVydHkoZCkgJiYgKGNbZF0gPSBiW2RdKTt9dmFyIGcgPSBhcmd1bWVudHMubGVuZ3RoIC0gMjtpZiAoMSA9PT0gZykgYy5jaGlsZHJlbiA9IGU7ZWxzZSBpZiAoMSA8IGcpIHtmb3IgKHZhciBmID0gQXJyYXkoZyksIG0gPSAwOyBtIDwgZzsgbSsrKSB7ZlttXSA9IGFyZ3VtZW50c1ttICsgMl07fWMuY2hpbGRyZW4gPSBmO31pZiAoYSAmJiBhLmRlZmF1bHRQcm9wcykgZm9yIChkIGluIGcgPSBhLmRlZmF1bHRQcm9wcywgZykge3ZvaWQgMCA9PT0gY1tkXSAmJiAoY1tkXSA9IGdbZF0pO31yZXR1cm4geyAkJHR5cGVvZjogbCwgdHlwZTogYSwga2V5OiBrLCByZWY6IGgsIHByb3BzOiBjLCBfb3duZXI6IEsuY3VycmVudCB9O30KICAgICAgICAgIGZ1bmN0aW9uIE4oYSwgYikge3JldHVybiB7ICQkdHlwZW9mOiBsLCB0eXBlOiBhLnR5cGUsIGtleTogYiwgcmVmOiBhLnJlZiwgcHJvcHM6IGEucHJvcHMsIF9vd25lcjogYS5fb3duZXIgfTt9ZnVuY3Rpb24gTyhhKSB7cmV0dXJuICJvYmplY3QiID09PSB0eXBlb2YgYSAmJiBudWxsICE9PSBhICYmIGEuJCR0eXBlb2YgPT09IGw7fWZ1bmN0aW9uIGVzY2FwZShhKSB7dmFyIGIgPSB7ICI9IjogIj0wIiwgIjoiOiAiPTIiIH07cmV0dXJuICIkIiArIGEucmVwbGFjZSgvWz06XS9nLCBmdW5jdGlvbiAoYSkge3JldHVybiBiW2FdO30pO312YXIgUCA9IC9cLysvZztmdW5jdGlvbiBRKGEsIGIpIHtyZXR1cm4gIm9iamVjdCIgPT09IHR5cGVvZiBhICYmIG51bGwgIT09IGEgJiYgbnVsbCAhPSBhLmtleSA/IGVzY2FwZSgiIiArIGEua2V5KSA6IGIudG9TdHJpbmcoMzYpO30KICAgICAgICAgIGZ1bmN0aW9uIFIoYSwgYiwgZSwgZCwgYykge3ZhciBrID0gdHlwZW9mIGE7aWYgKCJ1bmRlZmluZWQiID09PSBrIHx8ICJib29sZWFuIiA9PT0gaykgYSA9IG51bGw7dmFyIGggPSAhMTtpZiAobnVsbCA9PT0gYSkgaCA9ICEwO2Vsc2Ugc3dpdGNoIChrKSB7Y2FzZSAic3RyaW5nIjpjYXNlICJudW1iZXIiOmggPSAhMDticmVhaztjYXNlICJvYmplY3QiOnN3aXRjaCAoYS4kJHR5cGVvZikge2Nhc2UgbDpjYXNlIG46aCA9ICEwO319aWYgKGgpIHJldHVybiBoID0gYSwgYyA9IGMoaCksIGEgPSAiIiA9PT0gZCA/ICIuIiArIFEoaCwgMCkgOiBkLCBJKGMpID8gKGUgPSAiIiwgbnVsbCAhPSBhICYmIChlID0gYS5yZXBsYWNlKFAsICIkJi8iKSArICIvIiksIFIoYywgYiwgZSwgIiIsIGZ1bmN0aW9uIChhKSB7cmV0dXJuIGE7fSkpIDogbnVsbCAhPSBjICYmIChPKGMpICYmIChjID0gTihjLCBlICsgKCFjLmtleSB8fCBoICYmIGgua2V5ID09PSBjLmtleSA/ICIiIDogKCIiICsgYy5rZXkpLnJlcGxhY2UoUCwgIiQmLyIpICsgIi8iKSArIGEpKSwgYi5wdXNoKGMpKSwgMTtoID0gMDtkID0gIiIgPT09IGQgPyAiLiIgOiBkICsgIjoiO2lmIChJKGEpKSBmb3IgKHZhciBnID0gMDsgZyA8IGEubGVuZ3RoOyBnKyspIHtrID0KICAgICAgICAgICAgICBhW2ddO3ZhciBmID0gZCArIFEoaywgZyk7aCArPSBSKGssIGIsIGUsIGYsIGMpO30gZWxzZSBpZiAoZiA9IEEoYSksICJmdW5jdGlvbiIgPT09IHR5cGVvZiBmKSBmb3IgKGEgPSBmLmNhbGwoYSksIGcgPSAwOyAhKGsgPSBhLm5leHQoKSkuZG9uZTspIHtrID0gay52YWx1ZSwgZiA9IGQgKyBRKGssIGcrKyksIGggKz0gUihrLCBiLCBlLCBmLCBjKTt9IGVsc2UgaWYgKCJvYmplY3QiID09PSBrKSB0aHJvdyBiID0gU3RyaW5nKGEpLCBFcnJvcigiT2JqZWN0cyBhcmUgbm90IHZhbGlkIGFzIGEgUmVhY3QgY2hpbGQgKGZvdW5kOiAiICsgKCJbb2JqZWN0IE9iamVjdF0iID09PSBiID8gIm9iamVjdCB3aXRoIGtleXMgeyIgKyBPYmplY3Qua2V5cyhhKS5qb2luKCIsICIpICsgIn0iIDogYikgKyAiKS4gSWYgeW91IG1lYW50IHRvIHJlbmRlciBhIGNvbGxlY3Rpb24gb2YgY2hpbGRyZW4sIHVzZSBhbiBhcnJheSBpbnN0ZWFkLiIpO3JldHVybiBoO30KICAgICAgICAgIGZ1bmN0aW9uIFMoYSwgYiwgZSkge2lmIChudWxsID09IGEpIHJldHVybiBhO3ZhciBkID0gW10sYyA9IDA7UihhLCBkLCAiIiwgIiIsIGZ1bmN0aW9uIChhKSB7cmV0dXJuIGIuY2FsbChlLCBhLCBjKyspO30pO3JldHVybiBkO31mdW5jdGlvbiBUKGEpIHtpZiAoLTEgPT09IGEuX3N0YXR1cykge3ZhciBiID0gYS5fcmVzdWx0O2IgPSBiKCk7Yi50aGVuKGZ1bmN0aW9uIChiKSB7aWYgKDAgPT09IGEuX3N0YXR1cyB8fCAtMSA9PT0gYS5fc3RhdHVzKSBhLl9zdGF0dXMgPSAxLCBhLl9yZXN1bHQgPSBiO30sIGZ1bmN0aW9uIChiKSB7aWYgKDAgPT09IGEuX3N0YXR1cyB8fCAtMSA9PT0gYS5fc3RhdHVzKSBhLl9zdGF0dXMgPSAyLCBhLl9yZXN1bHQgPSBiO30pOy0xID09PSBhLl9zdGF0dXMgJiYgKGEuX3N0YXR1cyA9IDAsIGEuX3Jlc3VsdCA9IGIpO31pZiAoMSA9PT0gYS5fc3RhdHVzKSByZXR1cm4gYS5fcmVzdWx0LmRlZmF1bHQ7dGhyb3cgYS5fcmVzdWx0O30KICAgICAgICAgIHZhciBVID0geyBjdXJyZW50OiBudWxsIH0sViA9IHsgdHJhbnNpdGlvbjogbnVsbCB9LFcgPSB7IFJlYWN0Q3VycmVudERpc3BhdGNoZXI6IFUsIFJlYWN0Q3VycmVudEJhdGNoQ29uZmlnOiBWLCBSZWFjdEN1cnJlbnRPd25lcjogSyB9O2V4cG9ydHMuQ2hpbGRyZW4gPSB7IG1hcDogUywgZm9yRWFjaDogZnVuY3Rpb24gZm9yRWFjaChhLCBiLCBlKSB7UyhhLCBmdW5jdGlvbiAoKSB7Yi5hcHBseSh0aGlzLCBhcmd1bWVudHMpO30sIGUpO30sIGNvdW50OiBmdW5jdGlvbiBjb3VudChhKSB7dmFyIGIgPSAwO1MoYSwgZnVuY3Rpb24gKCkge2IrKzt9KTtyZXR1cm4gYjt9LCB0b0FycmF5OiBmdW5jdGlvbiB0b0FycmF5KGEpIHtyZXR1cm4gUyhhLCBmdW5jdGlvbiAoYSkge3JldHVybiBhO30pIHx8IFtdO30sIG9ubHk6IGZ1bmN0aW9uIG9ubHkoYSkge2lmICghTyhhKSkgdGhyb3cgRXJyb3IoIlJlYWN0LkNoaWxkcmVuLm9ubHkgZXhwZWN0ZWQgdG8gcmVjZWl2ZSBhIHNpbmdsZSBSZWFjdCBlbGVtZW50IGNoaWxkLiIpO3JldHVybiBhO30gfTtleHBvcnRzLkNvbXBvbmVudCA9IEU7ZXhwb3J0cy5GcmFnbWVudCA9IHA7CiAgICAgICAgICBleHBvcnRzLlByb2ZpbGVyID0gcjtleHBvcnRzLlB1cmVDb21wb25lbnQgPSBHO2V4cG9ydHMuU3RyaWN0TW9kZSA9IHE7ZXhwb3J0cy5TdXNwZW5zZSA9IHc7ZXhwb3J0cy5fX1NFQ1JFVF9JTlRFUk5BTFNfRE9fTk9UX1VTRV9PUl9ZT1VfV0lMTF9CRV9GSVJFRCA9IFc7CiAgICAgICAgICBleHBvcnRzLmNsb25lRWxlbWVudCA9IGZ1bmN0aW9uIChhLCBiLCBlKSB7aWYgKG51bGwgPT09IGEgfHwgdm9pZCAwID09PSBhKSB0aHJvdyBFcnJvcigiUmVhY3QuY2xvbmVFbGVtZW50KC4uLik6IFRoZSBhcmd1bWVudCBtdXN0IGJlIGEgUmVhY3QgZWxlbWVudCwgYnV0IHlvdSBwYXNzZWQgIiArIGEgKyAiLiIpO3ZhciBkID0gQyh7fSwgYS5wcm9wcyksYyA9IGEua2V5LGsgPSBhLnJlZixoID0gYS5fb3duZXI7aWYgKG51bGwgIT0gYikge3ZvaWQgMCAhPT0gYi5yZWYgJiYgKGsgPSBiLnJlZiwgaCA9IEsuY3VycmVudCk7dm9pZCAwICE9PSBiLmtleSAmJiAoYyA9ICIiICsgYi5rZXkpO2lmIChhLnR5cGUgJiYgYS50eXBlLmRlZmF1bHRQcm9wcykgdmFyIGcgPSBhLnR5cGUuZGVmYXVsdFByb3BzO2ZvciAoZiBpbiBiKSB7Si5jYWxsKGIsIGYpICYmICFMLmhhc093blByb3BlcnR5KGYpICYmIChkW2ZdID0gdm9pZCAwID09PSBiW2ZdICYmIHZvaWQgMCAhPT0gZyA/IGdbZl0gOiBiW2ZdKTt9fXZhciBmID0gYXJndW1lbnRzLmxlbmd0aCAtIDI7aWYgKDEgPT09IGYpIGQuY2hpbGRyZW4gPSBlO2Vsc2UgaWYgKDEgPCBmKSB7ZyA9IEFycmF5KGYpOwogICAgICAgICAgICAgIGZvciAodmFyIG0gPSAwOyBtIDwgZjsgbSsrKSB7Z1ttXSA9IGFyZ3VtZW50c1ttICsgMl07fWQuY2hpbGRyZW4gPSBnO31yZXR1cm4geyAkJHR5cGVvZjogbCwgdHlwZTogYS50eXBlLCBrZXk6IGMsIHJlZjogaywgcHJvcHM6IGQsIF9vd25lcjogaCB9O307ZXhwb3J0cy5jcmVhdGVDb250ZXh0ID0gZnVuY3Rpb24gKGEpIHthID0geyAkJHR5cGVvZjogdSwgX2N1cnJlbnRWYWx1ZTogYSwgX2N1cnJlbnRWYWx1ZTI6IGEsIF90aHJlYWRDb3VudDogMCwgUHJvdmlkZXI6IG51bGwsIENvbnN1bWVyOiBudWxsLCBfZGVmYXVsdFZhbHVlOiBudWxsLCBfZ2xvYmFsTmFtZTogbnVsbCB9O2EuUHJvdmlkZXIgPSB7ICQkdHlwZW9mOiB0LCBfY29udGV4dDogYSB9O3JldHVybiBhLkNvbnN1bWVyID0gYTt9O2V4cG9ydHMuY3JlYXRlRWxlbWVudCA9IE07ZXhwb3J0cy5jcmVhdGVGYWN0b3J5ID0gZnVuY3Rpb24gKGEpIHt2YXIgYiA9IE0uYmluZChudWxsLCBhKTtiLnR5cGUgPSBhO3JldHVybiBiO307ZXhwb3J0cy5jcmVhdGVSZWYgPSBmdW5jdGlvbiAoKSB7cmV0dXJuIHsgY3VycmVudDogbnVsbCB9O307CiAgICAgICAgICBleHBvcnRzLmZvcndhcmRSZWYgPSBmdW5jdGlvbiAoYSkge3JldHVybiB7ICQkdHlwZW9mOiB2LCByZW5kZXI6IGEgfTt9O2V4cG9ydHMuaXNWYWxpZEVsZW1lbnQgPSBPO2V4cG9ydHMubGF6eSA9IGZ1bmN0aW9uIChhKSB7cmV0dXJuIHsgJCR0eXBlb2Y6IHksIF9wYXlsb2FkOiB7IF9zdGF0dXM6IC0xLCBfcmVzdWx0OiBhIH0sIF9pbml0OiBUIH07fTtleHBvcnRzLm1lbW8gPSBmdW5jdGlvbiAoYSwgYikge3JldHVybiB7ICQkdHlwZW9mOiB4LCB0eXBlOiBhLCBjb21wYXJlOiB2b2lkIDAgPT09IGIgPyBudWxsIDogYiB9O307ZXhwb3J0cy5zdGFydFRyYW5zaXRpb24gPSBmdW5jdGlvbiAoYSkge3ZhciBiID0gVi50cmFuc2l0aW9uO1YudHJhbnNpdGlvbiA9IHt9O3RyeSB7YSgpO30gZmluYWxseSB7Vi50cmFuc2l0aW9uID0gYjt9fTtleHBvcnRzLnVuc3RhYmxlX2FjdCA9IGZ1bmN0aW9uICgpIHt0aHJvdyBFcnJvcigiYWN0KC4uLikgaXMgbm90IHN1cHBvcnRlZCBpbiBwcm9kdWN0aW9uIGJ1aWxkcyBvZiBSZWFjdC4iKTt9OwogICAgICAgICAgZXhwb3J0cy51c2VDYWxsYmFjayA9IGZ1bmN0aW9uIChhLCBiKSB7cmV0dXJuIFUuY3VycmVudC51c2VDYWxsYmFjayhhLCBiKTt9O2V4cG9ydHMudXNlQ29udGV4dCA9IGZ1bmN0aW9uIChhKSB7cmV0dXJuIFUuY3VycmVudC51c2VDb250ZXh0KGEpO307ZXhwb3J0cy51c2VEZWJ1Z1ZhbHVlID0gZnVuY3Rpb24gKCkge307ZXhwb3J0cy51c2VEZWZlcnJlZFZhbHVlID0gZnVuY3Rpb24gKGEpIHtyZXR1cm4gVS5jdXJyZW50LnVzZURlZmVycmVkVmFsdWUoYSk7fTtleHBvcnRzLnVzZUVmZmVjdCA9IGZ1bmN0aW9uIChhLCBiKSB7cmV0dXJuIFUuY3VycmVudC51c2VFZmZlY3QoYSwgYik7fTtleHBvcnRzLnVzZUlkID0gZnVuY3Rpb24gKCkge3JldHVybiBVLmN1cnJlbnQudXNlSWQoKTt9O2V4cG9ydHMudXNlSW1wZXJhdGl2ZUhhbmRsZSA9IGZ1bmN0aW9uIChhLCBiLCBlKSB7cmV0dXJuIFUuY3VycmVudC51c2VJbXBlcmF0aXZlSGFuZGxlKGEsIGIsIGUpO307CiAgICAgICAgICBleHBvcnRzLnVzZUluc2VydGlvbkVmZmVjdCA9IGZ1bmN0aW9uIChhLCBiKSB7cmV0dXJuIFUuY3VycmVudC51c2VJbnNlcnRpb25FZmZlY3QoYSwgYik7fTtleHBvcnRzLnVzZUxheW91dEVmZmVjdCA9IGZ1bmN0aW9uIChhLCBiKSB7cmV0dXJuIFUuY3VycmVudC51c2VMYXlvdXRFZmZlY3QoYSwgYik7fTtleHBvcnRzLnVzZU1lbW8gPSBmdW5jdGlvbiAoYSwgYikge3JldHVybiBVLmN1cnJlbnQudXNlTWVtbyhhLCBiKTt9O2V4cG9ydHMudXNlUmVkdWNlciA9IGZ1bmN0aW9uIChhLCBiLCBlKSB7cmV0dXJuIFUuY3VycmVudC51c2VSZWR1Y2VyKGEsIGIsIGUpO307ZXhwb3J0cy51c2VSZWYgPSBmdW5jdGlvbiAoYSkge3JldHVybiBVLmN1cnJlbnQudXNlUmVmKGEpO307ZXhwb3J0cy51c2VTdGF0ZSA9IGZ1bmN0aW9uIChhKSB7cmV0dXJuIFUuY3VycmVudC51c2VTdGF0ZShhKTt9O2V4cG9ydHMudXNlU3luY0V4dGVybmFsU3RvcmUgPSBmdW5jdGlvbiAoYSwgYiwgZSkge3JldHVybiBVLmN1cnJlbnQudXNlU3luY0V4dGVybmFsU3RvcmUoYSwgYiwgZSk7fTsKICAgICAgICAgIGV4cG9ydHMudXNlVHJhbnNpdGlvbiA9IGZ1bmN0aW9uICgpIHtyZXR1cm4gVS5jdXJyZW50LnVzZVRyYW5zaXRpb24oKTt9O2V4cG9ydHMudmVyc2lvbiA9ICIxOC4yLjAiOwoKCiAgICAgICAgICAvKioqL30sCgogICAgICAgIC8qKiovMjk0OgogICAgICAgIC8qKiovKG1vZHVsZSwgX191bnVzZWRfd2VicGFja19leHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSA9PiB7CgoKCiAgICAgICAgICBpZiAodHJ1ZSkgewogICAgICAgICAgICBtb2R1bGUuZXhwb3J0cyA9IF9fd2VicGFja19yZXF1aXJlX18oNDA4KTsKICAgICAgICAgIH0gZWxzZSB7fQoKCiAgICAgICAgICAvKioqL30sCgogICAgICAgIC8qKiovNTM6CiAgICAgICAgLyoqKi8oX191bnVzZWRfd2VicGFja19tb2R1bGUsIGV4cG9ydHMpID0+IHsKCiAgICAgICAgICAvKioKICAgICAgICAgICAqIEBsaWNlbnNlIFJlYWN0CiAgICAgICAgICAgKiBzY2hlZHVsZXIucHJvZHVjdGlvbi5taW4uanMKICAgICAgICAgICAqCiAgICAgICAgICAgKiBDb3B5cmlnaHQgKGMpIEZhY2Vib29rLCBJbmMuIGFuZCBpdHMgYWZmaWxpYXRlcy4KICAgICAgICAgICAqCiAgICAgICAgICAgKiBUaGlzIHNvdXJjZSBjb2RlIGlzIGxpY2Vuc2VkIHVuZGVyIHRoZSBNSVQgbGljZW5zZSBmb3VuZCBpbiB0aGUKICAgICAgICAgICAqIExJQ0VOU0UgZmlsZSBpbiB0aGUgcm9vdCBkaXJlY3Rvcnkgb2YgdGhpcyBzb3VyY2UgdHJlZS4KICAgICAgICAgICAqLwogICAgICAgICAgZnVuY3Rpb24gZihhLCBiKSB7dmFyIGMgPSBhLmxlbmd0aDthLnB1c2goYik7YTogZm9yICg7IDAgPCBjOykge3ZhciBkID0gYyAtIDEgPj4+IDEsZSA9IGFbZF07aWYgKDAgPCBnKGUsIGIpKSBhW2RdID0gYiwgYVtjXSA9IGUsIGMgPSBkO2Vsc2UgYnJlYWsgYTt9fWZ1bmN0aW9uIGgoYSkge3JldHVybiAwID09PSBhLmxlbmd0aCA/IG51bGwgOiBhWzBdO31mdW5jdGlvbiBrKGEpIHtpZiAoMCA9PT0gYS5sZW5ndGgpIHJldHVybiBudWxsO3ZhciBiID0gYVswXSxjID0gYS5wb3AoKTtpZiAoYyAhPT0gYikge2FbMF0gPSBjO2E6IGZvciAodmFyIGQgPSAwLCBlID0gYS5sZW5ndGgsIHcgPSBlID4+PiAxOyBkIDwgdzspIHt2YXIgbSA9IDIgKiAoZCArIDEpIC0gMSxDID0gYVttXSxuID0gbSArIDEseCA9IGFbbl07aWYgKDAgPiBnKEMsIGMpKSBuIDwgZSAmJiAwID4gZyh4LCBDKSA/IChhW2RdID0geCwgYVtuXSA9IGMsIGQgPSBuKSA6IChhW2RdID0gQywgYVttXSA9IGMsIGQgPSBtKTtlbHNlIGlmIChuIDwgZSAmJiAwID4gZyh4LCBjKSkgYVtkXSA9IHgsIGFbbl0gPSBjLCBkID0gbjtlbHNlIGJyZWFrIGE7fX1yZXR1cm4gYjt9CiAgICAgICAgICBmdW5jdGlvbiBnKGEsIGIpIHt2YXIgYyA9IGEuc29ydEluZGV4IC0gYi5zb3J0SW5kZXg7cmV0dXJuIDAgIT09IGMgPyBjIDogYS5pZCAtIGIuaWQ7fWlmICgib2JqZWN0IiA9PT0gdHlwZW9mIHBlcmZvcm1hbmNlICYmICJmdW5jdGlvbiIgPT09IHR5cGVvZiBwZXJmb3JtYW5jZS5ub3cpIHt2YXIgbCA9IHBlcmZvcm1hbmNlO2V4cG9ydHMudW5zdGFibGVfbm93ID0gZnVuY3Rpb24gKCkge3JldHVybiBsLm5vdygpO307fSBlbHNlIHt2YXIgcCA9IERhdGUscSA9IHAubm93KCk7ZXhwb3J0cy51bnN0YWJsZV9ub3cgPSBmdW5jdGlvbiAoKSB7cmV0dXJuIHAubm93KCkgLSBxO307fXZhciByID0gW10sdCA9IFtdLHUgPSAxLHYgPSBudWxsLHkgPSAzLHogPSAhMSxBID0gITEsQiA9ICExLEQgPSAiZnVuY3Rpb24iID09PSB0eXBlb2Ygc2V0VGltZW91dCA/IHNldFRpbWVvdXQgOiBudWxsLEUgPSAiZnVuY3Rpb24iID09PSB0eXBlb2YgY2xlYXJUaW1lb3V0ID8gY2xlYXJUaW1lb3V0IDogbnVsbCxGID0gInVuZGVmaW5lZCIgIT09IHR5cGVvZiBzZXRJbW1lZGlhdGUgPyBzZXRJbW1lZGlhdGUgOiBudWxsOwogICAgICAgICAgInVuZGVmaW5lZCIgIT09IHR5cGVvZiBuYXZpZ2F0b3IgJiYgdm9pZCAwICE9PSBuYXZpZ2F0b3Iuc2NoZWR1bGluZyAmJiB2b2lkIDAgIT09IG5hdmlnYXRvci5zY2hlZHVsaW5nLmlzSW5wdXRQZW5kaW5nICYmIG5hdmlnYXRvci5zY2hlZHVsaW5nLmlzSW5wdXRQZW5kaW5nLmJpbmQobmF2aWdhdG9yLnNjaGVkdWxpbmcpO2Z1bmN0aW9uIEcoYSkge2ZvciAodmFyIGIgPSBoKHQpOyBudWxsICE9PSBiOykge2lmIChudWxsID09PSBiLmNhbGxiYWNrKSBrKHQpO2Vsc2UgaWYgKGIuc3RhcnRUaW1lIDw9IGEpIGsodCksIGIuc29ydEluZGV4ID0gYi5leHBpcmF0aW9uVGltZSwgZihyLCBiKTtlbHNlIGJyZWFrO2IgPSBoKHQpO319ZnVuY3Rpb24gSChhKSB7QiA9ICExO0coYSk7aWYgKCFBKSBpZiAobnVsbCAhPT0gaChyKSkgQSA9ICEwLCBJKEopO2Vsc2Uge3ZhciBiID0gaCh0KTtudWxsICE9PSBiICYmIEsoSCwgYi5zdGFydFRpbWUgLSBhKTt9fQogICAgICAgICAgZnVuY3Rpb24gSihhLCBiKSB7QSA9ICExO0IgJiYgKEIgPSAhMSwgRShMKSwgTCA9IC0xKTt6ID0gITA7dmFyIGMgPSB5O3RyeSB7RyhiKTtmb3IgKHYgPSBoKHIpOyBudWxsICE9PSB2ICYmICghKHYuZXhwaXJhdGlvblRpbWUgPiBiKSB8fCBhICYmICFNKCkpOykge3ZhciBkID0gdi5jYWxsYmFjaztpZiAoImZ1bmN0aW9uIiA9PT0gdHlwZW9mIGQpIHt2LmNhbGxiYWNrID0gbnVsbDt5ID0gdi5wcmlvcml0eUxldmVsO3ZhciBlID0gZCh2LmV4cGlyYXRpb25UaW1lIDw9IGIpO2IgPSBleHBvcnRzLnVuc3RhYmxlX25vdygpOyJmdW5jdGlvbiIgPT09IHR5cGVvZiBlID8gdi5jYWxsYmFjayA9IGUgOiB2ID09PSBoKHIpICYmIGsocik7RyhiKTt9IGVsc2UgayhyKTt2ID0gaChyKTt9aWYgKG51bGwgIT09IHYpIHZhciB3ID0gITA7ZWxzZSB7dmFyIG0gPSBoKHQpO251bGwgIT09IG0gJiYgSyhILCBtLnN0YXJ0VGltZSAtIGIpO3cgPSAhMTt9cmV0dXJuIHc7fSBmaW5hbGx5IHt2ID0gbnVsbCwgeSA9IGMsIHogPSAhMTt9fXZhciBOID0gITEsTyA9IG51bGwsTCA9IC0xLFAgPSA1LFEgPSAtMTsKICAgICAgICAgIGZ1bmN0aW9uIE0oKSB7cmV0dXJuIGV4cG9ydHMudW5zdGFibGVfbm93KCkgLSBRIDwgUCA/ICExIDogITA7fWZ1bmN0aW9uIFIoKSB7aWYgKG51bGwgIT09IE8pIHt2YXIgYSA9IGV4cG9ydHMudW5zdGFibGVfbm93KCk7USA9IGE7dmFyIGIgPSAhMDt0cnkge2IgPSBPKCEwLCBhKTt9IGZpbmFsbHkge2IgPyBTKCkgOiAoTiA9ICExLCBPID0gbnVsbCk7fX0gZWxzZSBOID0gITE7fXZhciBTO2lmICgiZnVuY3Rpb24iID09PSB0eXBlb2YgRikgUyA9IGZ1bmN0aW9uIFMoKSB7RihSKTt9O2Vsc2UgaWYgKCJ1bmRlZmluZWQiICE9PSB0eXBlb2YgTWVzc2FnZUNoYW5uZWwpIHt2YXIgVCA9IG5ldyBNZXNzYWdlQ2hhbm5lbCgpLFUgPSBULnBvcnQyO1QucG9ydDEub25tZXNzYWdlID0gUjtTID0gZnVuY3Rpb24gUygpIHtVLnBvc3RNZXNzYWdlKG51bGwpO307fSBlbHNlIFMgPSBmdW5jdGlvbiBTKCkge0QoUiwgMCk7fTtmdW5jdGlvbiBJKGEpIHtPID0gYTtOIHx8IChOID0gITAsIFMoKSk7fWZ1bmN0aW9uIEsoYSwgYikge0wgPSBEKGZ1bmN0aW9uICgpIHthKGV4cG9ydHMudW5zdGFibGVfbm93KCkpO30sIGIpO30KICAgICAgICAgIGV4cG9ydHMudW5zdGFibGVfSWRsZVByaW9yaXR5ID0gNTtleHBvcnRzLnVuc3RhYmxlX0ltbWVkaWF0ZVByaW9yaXR5ID0gMTtleHBvcnRzLnVuc3RhYmxlX0xvd1ByaW9yaXR5ID0gNDtleHBvcnRzLnVuc3RhYmxlX05vcm1hbFByaW9yaXR5ID0gMztleHBvcnRzLnVuc3RhYmxlX1Byb2ZpbGluZyA9IG51bGw7ZXhwb3J0cy51bnN0YWJsZV9Vc2VyQmxvY2tpbmdQcmlvcml0eSA9IDI7ZXhwb3J0cy51bnN0YWJsZV9jYW5jZWxDYWxsYmFjayA9IGZ1bmN0aW9uIChhKSB7YS5jYWxsYmFjayA9IG51bGw7fTtleHBvcnRzLnVuc3RhYmxlX2NvbnRpbnVlRXhlY3V0aW9uID0gZnVuY3Rpb24gKCkge0EgfHwgeiB8fCAoQSA9ICEwLCBJKEopKTt9OwogICAgICAgICAgZXhwb3J0cy51bnN0YWJsZV9mb3JjZUZyYW1lUmF0ZSA9IGZ1bmN0aW9uIChhKSB7MCA+IGEgfHwgMTI1IDwgYSA/IGNvbnNvbGUuZXJyb3IoImZvcmNlRnJhbWVSYXRlIHRha2VzIGEgcG9zaXRpdmUgaW50IGJldHdlZW4gMCBhbmQgMTI1LCBmb3JjaW5nIGZyYW1lIHJhdGVzIGhpZ2hlciB0aGFuIDEyNSBmcHMgaXMgbm90IHN1cHBvcnRlZCIpIDogUCA9IDAgPCBhID8gTWF0aC5mbG9vcigxRTMgLyBhKSA6IDU7fTtleHBvcnRzLnVuc3RhYmxlX2dldEN1cnJlbnRQcmlvcml0eUxldmVsID0gZnVuY3Rpb24gKCkge3JldHVybiB5O307ZXhwb3J0cy51bnN0YWJsZV9nZXRGaXJzdENhbGxiYWNrTm9kZSA9IGZ1bmN0aW9uICgpIHtyZXR1cm4gaChyKTt9O2V4cG9ydHMudW5zdGFibGVfbmV4dCA9IGZ1bmN0aW9uIChhKSB7c3dpdGNoICh5KSB7Y2FzZSAxOmNhc2UgMjpjYXNlIDM6dmFyIGIgPSAzO2JyZWFrO2RlZmF1bHQ6YiA9IHk7fXZhciBjID0geTt5ID0gYjt0cnkge3JldHVybiBhKCk7fSBmaW5hbGx5IHt5ID0gYzt9fTtleHBvcnRzLnVuc3RhYmxlX3BhdXNlRXhlY3V0aW9uID0gZnVuY3Rpb24gKCkge307CiAgICAgICAgICBleHBvcnRzLnVuc3RhYmxlX3JlcXVlc3RQYWludCA9IGZ1bmN0aW9uICgpIHt9O2V4cG9ydHMudW5zdGFibGVfcnVuV2l0aFByaW9yaXR5ID0gZnVuY3Rpb24gKGEsIGIpIHtzd2l0Y2ggKGEpIHtjYXNlIDE6Y2FzZSAyOmNhc2UgMzpjYXNlIDQ6Y2FzZSA1OmJyZWFrO2RlZmF1bHQ6YSA9IDM7fXZhciBjID0geTt5ID0gYTt0cnkge3JldHVybiBiKCk7fSBmaW5hbGx5IHt5ID0gYzt9fTsKICAgICAgICAgIGV4cG9ydHMudW5zdGFibGVfc2NoZWR1bGVDYWxsYmFjayA9IGZ1bmN0aW9uIChhLCBiLCBjKSB7dmFyIGQgPSBleHBvcnRzLnVuc3RhYmxlX25vdygpOyJvYmplY3QiID09PSB0eXBlb2YgYyAmJiBudWxsICE9PSBjID8gKGMgPSBjLmRlbGF5LCBjID0gIm51bWJlciIgPT09IHR5cGVvZiBjICYmIDAgPCBjID8gZCArIGMgOiBkKSA6IGMgPSBkO3N3aXRjaCAoYSkge2Nhc2UgMTp2YXIgZSA9IC0xO2JyZWFrO2Nhc2UgMjplID0gMjUwO2JyZWFrO2Nhc2UgNTplID0gMTA3Mzc0MTgyMzticmVhaztjYXNlIDQ6ZSA9IDFFNDticmVhaztkZWZhdWx0OmUgPSA1RTM7fWUgPSBjICsgZTthID0geyBpZDogdSsrLCBjYWxsYmFjazogYiwgcHJpb3JpdHlMZXZlbDogYSwgc3RhcnRUaW1lOiBjLCBleHBpcmF0aW9uVGltZTogZSwgc29ydEluZGV4OiAtMSB9O2MgPiBkID8gKGEuc29ydEluZGV4ID0gYywgZih0LCBhKSwgbnVsbCA9PT0gaChyKSAmJiBhID09PSBoKHQpICYmIChCID8gKEUoTCksIEwgPSAtMSkgOiBCID0gITAsIEsoSCwgYyAtIGQpKSkgOiAoYS5zb3J0SW5kZXggPSBlLCBmKHIsIGEpLCBBIHx8IHogfHwgKEEgPSAhMCwgSShKKSkpO3JldHVybiBhO307CiAgICAgICAgICBleHBvcnRzLnVuc3RhYmxlX3Nob3VsZFlpZWxkID0gTTtleHBvcnRzLnVuc3RhYmxlX3dyYXBDYWxsYmFjayA9IGZ1bmN0aW9uIChhKSB7dmFyIGIgPSB5O3JldHVybiBmdW5jdGlvbiAoKSB7dmFyIGMgPSB5O3kgPSBiO3RyeSB7cmV0dXJuIGEuYXBwbHkodGhpcywgYXJndW1lbnRzKTt9IGZpbmFsbHkge3kgPSBjO319O307CgoKICAgICAgICAgIC8qKiovfSwKCiAgICAgICAgLyoqKi84NDA6CiAgICAgICAgLyoqKi8obW9kdWxlLCBfX3VudXNlZF93ZWJwYWNrX2V4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pID0+IHsKCgoKICAgICAgICAgIGlmICh0cnVlKSB7CiAgICAgICAgICAgIG1vZHVsZS5leHBvcnRzID0gX193ZWJwYWNrX3JlcXVpcmVfXyg1Myk7CiAgICAgICAgICB9IGVsc2Uge30KCgogICAgICAgICAgLyoqKi99CgogICAgICAgIC8qKioqKiovIH07CiAgICAgIC8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovCiAgICAgIC8qKioqKiovIC8vIFRoZSBtb2R1bGUgY2FjaGUKICAgICAgLyoqKioqKi92YXIgX193ZWJwYWNrX21vZHVsZV9jYWNoZV9fID0ge307CiAgICAgIC8qKioqKiovCiAgICAgIC8qKioqKiovIC8vIFRoZSByZXF1aXJlIGZ1bmN0aW9uCiAgICAgIC8qKioqKiovZnVuY3Rpb24gX193ZWJwYWNrX3JlcXVpcmVfXyhtb2R1bGVJZCkgewogICAgICAgIC8qKioqKiovIC8vIENoZWNrIGlmIG1vZHVsZSBpcyBpbiBjYWNoZQogICAgICAgIC8qKioqKiovdmFyIGNhY2hlZE1vZHVsZSA9IF9fd2VicGFja19tb2R1bGVfY2FjaGVfX1ttb2R1bGVJZF07CiAgICAgICAgLyoqKioqKi9pZiAoY2FjaGVkTW9kdWxlICE9PSB1bmRlZmluZWQpIHsKICAgICAgICAgIC8qKioqKiovcmV0dXJuIGNhY2hlZE1vZHVsZS5leHBvcnRzOwogICAgICAgICAgLyoqKioqKi99CiAgICAgICAgLyoqKioqKi8gLy8gQ3JlYXRlIGEgbmV3IG1vZHVsZSAoYW5kIHB1dCBpdCBpbnRvIHRoZSBjYWNoZSkKICAgICAgICAvKioqKioqL3ZhciBtb2R1bGUgPSBfX3dlYnBhY2tfbW9kdWxlX2NhY2hlX19bbW9kdWxlSWRdID0gewogICAgICAgICAgLyoqKioqKi8gLy8gbm8gbW9kdWxlLmlkIG5lZWRlZAogICAgICAgICAgLyoqKioqKi8gLy8gbm8gbW9kdWxlLmxvYWRlZCBuZWVkZWQKICAgICAgICAgIC8qKioqKiovZXhwb3J0czoge30KICAgICAgICAgIC8qKioqKiovIH07CiAgICAgICAgLyoqKioqKi8KICAgICAgICAvKioqKioqLyAvLyBFeGVjdXRlIHRoZSBtb2R1bGUgZnVuY3Rpb24KICAgICAgICAvKioqKioqL19fd2VicGFja19tb2R1bGVzX19bbW9kdWxlSWRdKG1vZHVsZSwgbW9kdWxlLmV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pOwogICAgICAgIC8qKioqKiovCiAgICAgICAgLyoqKioqKi8gLy8gUmV0dXJuIHRoZSBleHBvcnRzIG9mIHRoZSBtb2R1bGUKICAgICAgICAvKioqKioqL3JldHVybiBtb2R1bGUuZXhwb3J0czsKICAgICAgICAvKioqKioqL30KICAgICAgLyoqKioqKi8KICAgICAgLyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi8KICAgICAgLyoqKioqKi8gLyogd2VicGFjay9ydW50aW1lL2NyZWF0ZSBmYWtlIG5hbWVzcGFjZSBvYmplY3QgKi8KICAgICAgLyoqKioqKi8oKCkgPT4gewogICAgICAgIC8qKioqKiovdmFyIGdldFByb3RvID0gT2JqZWN0LmdldFByb3RvdHlwZU9mID8gKG9iaikgPT4gT2JqZWN0LmdldFByb3RvdHlwZU9mKG9iaikgOiAob2JqKSA9PiBvYmouX19wcm90b19fOwogICAgICAgIC8qKioqKiovdmFyIGxlYWZQcm90b3R5cGVzOwogICAgICAgIC8qKioqKiovIC8vIGNyZWF0ZSBhIGZha2UgbmFtZXNwYWNlIG9iamVjdAogICAgICAgIC8qKioqKiovIC8vIG1vZGUgJiAxOiB2YWx1ZSBpcyBhIG1vZHVsZSBpZCwgcmVxdWlyZSBpdAogICAgICAgIC8qKioqKiovIC8vIG1vZGUgJiAyOiBtZXJnZSBhbGwgcHJvcGVydGllcyBvZiB2YWx1ZSBpbnRvIHRoZSBucwogICAgICAgIC8qKioqKiovIC8vIG1vZGUgJiA0OiByZXR1cm4gdmFsdWUgd2hlbiBhbHJlYWR5IG5zIG9iamVjdAogICAgICAgIC8qKioqKiovIC8vIG1vZGUgJiAxNjogcmV0dXJuIHZhbHVlIHdoZW4gaXQncyBQcm9taXNlLWxpa2UKICAgICAgICAvKioqKioqLyAvLyBtb2RlICYgOHwxOiBiZWhhdmUgbGlrZSByZXF1aXJlCiAgICAgICAgLyoqKioqKi9fX3dlYnBhY2tfcmVxdWlyZV9fLnQgPSBmdW5jdGlvbiAodmFsdWUsIG1vZGUpIHsKICAgICAgICAgIC8qKioqKiovaWYgKG1vZGUgJiAxKSB2YWx1ZSA9IHRoaXModmFsdWUpOwogICAgICAgICAgLyoqKioqKi9pZiAobW9kZSAmIDgpIHJldHVybiB2YWx1ZTsKICAgICAgICAgIC8qKioqKiovaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ29iamVjdCcgJiYgdmFsdWUpIHsKICAgICAgICAgICAgLyoqKioqKi9pZiAobW9kZSAmIDQgJiYgdmFsdWUuX19lc01vZHVsZSkgcmV0dXJuIHZhbHVlOwogICAgICAgICAgICAvKioqKioqL2lmIChtb2RlICYgMTYgJiYgdHlwZW9mIHZhbHVlLnRoZW4gPT09ICdmdW5jdGlvbicpIHJldHVybiB2YWx1ZTsKICAgICAgICAgICAgLyoqKioqKi99CiAgICAgICAgICAvKioqKioqL3ZhciBucyA9IE9iamVjdC5jcmVhdGUobnVsbCk7CiAgICAgICAgICAvKioqKioqL19fd2VicGFja19yZXF1aXJlX18ucihucyk7CiAgICAgICAgICAvKioqKioqL3ZhciBkZWYgPSB7fTsKICAgICAgICAgIC8qKioqKiovbGVhZlByb3RvdHlwZXMgPSBsZWFmUHJvdG90eXBlcyB8fCBbbnVsbCwgZ2V0UHJvdG8oe30pLCBnZXRQcm90byhbXSksIGdldFByb3RvKGdldFByb3RvKV07CiAgICAgICAgICAvKioqKioqL2ZvciAodmFyIGN1cnJlbnQgPSBtb2RlICYgMiAmJiB2YWx1ZTsgdHlwZW9mIGN1cnJlbnQgPT0gJ29iamVjdCcgJiYgIX5sZWFmUHJvdG90eXBlcy5pbmRleE9mKGN1cnJlbnQpOyBjdXJyZW50ID0gZ2V0UHJvdG8oY3VycmVudCkpIHsKICAgICAgICAgICAgLyoqKioqKi9PYmplY3QuZ2V0T3duUHJvcGVydHlOYW1lcyhjdXJyZW50KS5mb3JFYWNoKChrZXkpID0+IGRlZltrZXldID0gKCkgPT4gdmFsdWVba2V5XSk7CiAgICAgICAgICAgIC8qKioqKiovfQogICAgICAgICAgLyoqKioqKi9kZWZbJ2RlZmF1bHQnXSA9ICgpID0+IHZhbHVlOwogICAgICAgICAgLyoqKioqKi9fX3dlYnBhY2tfcmVxdWlyZV9fLmQobnMsIGRlZik7CiAgICAgICAgICAvKioqKioqL3JldHVybiBuczsKICAgICAgICAgIC8qKioqKiovfTsKICAgICAgICAvKioqKioqL30pKCk7CiAgICAgIC8qKioqKiovCiAgICAgIC8qKioqKiovIC8qIHdlYnBhY2svcnVudGltZS9kZWZpbmUgcHJvcGVydHkgZ2V0dGVycyAqLwogICAgICAvKioqKioqLygoKSA9PiB7CiAgICAgICAgLyoqKioqKi8gLy8gZGVmaW5lIGdldHRlciBmdW5jdGlvbnMgZm9yIGhhcm1vbnkgZXhwb3J0cwogICAgICAgIC8qKioqKiovX193ZWJwYWNrX3JlcXVpcmVfXy5kID0gKGV4cG9ydHMsIGRlZmluaXRpb24pID0+IHsKICAgICAgICAgIC8qKioqKiovZm9yICh2YXIga2V5IGluIGRlZmluaXRpb24pIHsKICAgICAgICAgICAgLyoqKioqKi9pZiAoX193ZWJwYWNrX3JlcXVpcmVfXy5vKGRlZmluaXRpb24sIGtleSkgJiYgIV9fd2VicGFja19yZXF1aXJlX18ubyhleHBvcnRzLCBrZXkpKSB7CiAgICAgICAgICAgICAgLyoqKioqKi9PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywga2V5LCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZGVmaW5pdGlvbltrZXldIH0pOwogICAgICAgICAgICAgIC8qKioqKiovfQogICAgICAgICAgICAvKioqKioqL30KICAgICAgICAgIC8qKioqKiovfTsKICAgICAgICAvKioqKioqL30pKCk7CiAgICAgIC8qKioqKiovCiAgICAgIC8qKioqKiovIC8qIHdlYnBhY2svcnVudGltZS9oYXNPd25Qcm9wZXJ0eSBzaG9ydGhhbmQgKi8KICAgICAgLyoqKioqKi8oKCkgPT4gewogICAgICAgIC8qKioqKiovX193ZWJwYWNrX3JlcXVpcmVfXy5vID0gKG9iaiwgcHJvcCkgPT4gT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG9iaiwgcHJvcCk7CiAgICAgICAgLyoqKioqKi99KSgpOwogICAgICAvKioqKioqLwogICAgICAvKioqKioqLyAvKiB3ZWJwYWNrL3J1bnRpbWUvbWFrZSBuYW1lc3BhY2Ugb2JqZWN0ICovCiAgICAgIC8qKioqKiovKCgpID0+IHsKICAgICAgICAvKioqKioqLyAvLyBkZWZpbmUgX19lc01vZHVsZSBvbiBleHBvcnRzCiAgICAgICAgLyoqKioqKi9fX3dlYnBhY2tfcmVxdWlyZV9fLnIgPSAoZXhwb3J0cykgPT4gewogICAgICAgICAgLyoqKioqKi9pZiAodHlwZW9mIFN5bWJvbCAhPT0gJ3VuZGVmaW5lZCcgJiYgU3ltYm9sLnRvU3RyaW5nVGFnKSB7CiAgICAgICAgICAgIC8qKioqKiovT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFN5bWJvbC50b1N0cmluZ1RhZywgeyB2YWx1ZTogJ01vZHVsZScgfSk7CiAgICAgICAgICAgIC8qKioqKiovfQogICAgICAgICAgLyoqKioqKi9PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgJ19fZXNNb2R1bGUnLCB7IHZhbHVlOiB0cnVlIH0pOwogICAgICAgICAgLyoqKioqKi99OwogICAgICAgIC8qKioqKiovfSkoKTsKICAgICAgLyoqKioqKi8KICAgICAgLyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi8KICAgICAgdmFyIF9fd2VicGFja19leHBvcnRzX18gPSB7fTsKICAgICAgLy8gVGhpcyBlbnRyeSBuZWVkIHRvIGJlIHdyYXBwZWQgaW4gYW4gSUlGRSBiZWNhdXNlIGl0IG5lZWQgdG8gYmUgaXNvbGF0ZWQgYWdhaW5zdCBvdGhlciBtb2R1bGVzIGluIHRoZSBjaHVuay4KICAgICAgKCgpID0+IHsKICAgICAgICBfX3dlYnBhY2tfcmVxdWlyZV9fLnIoX193ZWJwYWNrX2V4cG9ydHNfXyk7CiAgICAgICAgLyogaGFybW9ueSBpbXBvcnQgKi92YXIgX0FwcF9fV0VCUEFDS19JTVBPUlRFRF9NT0RVTEVfMF9fID0gX193ZWJwYWNrX3JlcXVpcmVfXygyNDIpOwogICAgICAgIC8qIGhhcm1vbnkgaW1wb3J0ICovdmFyIHJlYWN0X2RvbV9jbGllbnRfX1dFQlBBQ0tfSU1QT1JURURfTU9EVUxFXzFfXyA9IF9fd2VicGFja19yZXF1aXJlX18oNzQ1KTsKICAgICAgICAvKiBoYXJtb255IGltcG9ydCAqL3ZhciByZWFjdF9fV0VCUEFDS19JTVBPUlRFRF9NT0RVTEVfMl9fID0gX193ZWJwYWNrX3JlcXVpcmVfXygyOTQpOwogICAgICAgIGZ1bmN0aW9uIF9jcmVhdGVGb3JPZkl0ZXJhdG9ySGVscGVyKG8sIGFsbG93QXJyYXlMaWtlKSB7dmFyIGl0ID0gdHlwZW9mIFN5bWJvbCAhPT0gInVuZGVmaW5lZCIgJiYgb1tTeW1ib2wuaXRlcmF0b3JdIHx8IG9bIkBAaXRlcmF0b3IiXTtpZiAoIWl0KSB7aWYgKEFycmF5LmlzQXJyYXkobykgfHwgKGl0ID0gX3Vuc3VwcG9ydGVkSXRlcmFibGVUb0FycmF5KG8pKSB8fCBhbGxvd0FycmF5TGlrZSAmJiBvICYmIHR5cGVvZiBvLmxlbmd0aCA9PT0gIm51bWJlciIpIHtpZiAoaXQpIG8gPSBpdDt2YXIgaSA9IDA7dmFyIEYgPSBmdW5jdGlvbiBGKCkge307cmV0dXJuIHsgczogRiwgbjogZnVuY3Rpb24gbigpIHtpZiAoaSA+PSBvLmxlbmd0aCkgcmV0dXJuIHsgZG9uZTogdHJ1ZSB9O3JldHVybiB7IGRvbmU6IGZhbHNlLCB2YWx1ZTogb1tpKytdIH07fSwgZTogZnVuY3Rpb24gZShfZSkge3Rocm93IF9lO30sIGY6IEYgfTt9dGhyb3cgbmV3IFR5cGVFcnJvcigiSW52YWxpZCBhdHRlbXB0IHRvIGl0ZXJhdGUgbm9uLWl0ZXJhYmxlIGluc3RhbmNlLlxuSW4gb3JkZXIgdG8gYmUgaXRlcmFibGUsIG5vbi1hcnJheSBvYmplY3RzIG11c3QgaGF2ZSBhIFtTeW1ib2wuaXRlcmF0b3JdKCkgbWV0aG9kLiIpO312YXIgbm9ybWFsQ29tcGxldGlvbiA9IHRydWUsZGlkRXJyID0gZmFsc2UsZXJyO3JldHVybiB7IHM6IGZ1bmN0aW9uIHMoKSB7aXQgPSBpdC5jYWxsKG8pO30sIG46IGZ1bmN0aW9uIG4oKSB7dmFyIHN0ZXAgPSBpdC5uZXh0KCk7bm9ybWFsQ29tcGxldGlvbiA9IHN0ZXAuZG9uZTtyZXR1cm4gc3RlcDt9LCBlOiBmdW5jdGlvbiBlKF9lMikge2RpZEVyciA9IHRydWU7ZXJyID0gX2UyO30sIGY6IGZ1bmN0aW9uIGYoKSB7dHJ5IHtpZiAoIW5vcm1hbENvbXBsZXRpb24gJiYgaXRbInJldHVybiJdICE9IG51bGwpIGl0WyJyZXR1cm4iXSgpO30gZmluYWxseSB7aWYgKGRpZEVycikgdGhyb3cgZXJyO319IH07fWZ1bmN0aW9uIF91bnN1cHBvcnRlZEl0ZXJhYmxlVG9BcnJheShvLCBtaW5MZW4pIHtpZiAoIW8pIHJldHVybjtpZiAodHlwZW9mIG8gPT09ICJzdHJpbmciKSByZXR1cm4gX2FycmF5TGlrZVRvQXJyYXkobywgbWluTGVuKTt2YXIgbiA9IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChvKS5zbGljZSg4LCAtMSk7aWYgKG4gPT09ICJPYmplY3QiICYmIG8uY29uc3RydWN0b3IpIG4gPSBvLmNvbnN0cnVjdG9yLm5hbWU7aWYgKG4gPT09ICJNYXAiIHx8IG4gPT09ICJTZXQiKSByZXR1cm4gQXJyYXkuZnJvbShvKTtpZiAobiA9PT0gIkFyZ3VtZW50cyIgfHwgL14oPzpVaXxJKW50KD86OHwxNnwzMikoPzpDbGFtcGVkKT9BcnJheSQvLnRlc3QobikpIHJldHVybiBfYXJyYXlMaWtlVG9BcnJheShvLCBtaW5MZW4pO31mdW5jdGlvbiBfYXJyYXlMaWtlVG9BcnJheShhcnIsIGxlbikge2lmIChsZW4gPT0gbnVsbCB8fCBsZW4gPiBhcnIubGVuZ3RoKSBsZW4gPSBhcnIubGVuZ3RoO2ZvciAodmFyIGkgPSAwLCBhcnIyID0gbmV3IEFycmF5KGxlbik7IGkgPCBsZW47IGkrKykge2FycjJbaV0gPSBhcnJbaV07fXJldHVybiBhcnIyO30KCgoKCgogICAgICAgIGdldERhdGEoZnVuY3Rpb24gKHBhZ2VzKSB7dmFyIF9pdGVyYXRvciA9IF9jcmVhdGVGb3JPZkl0ZXJhdG9ySGVscGVyKAogICAgICAgICAgICBwYWdlcyksX3N0ZXA7dHJ5IHtmb3IgKF9pdGVyYXRvci5zKCk7ICEoX3N0ZXAgPSBfaXRlcmF0b3IubigpKS5kb25lOykge3ZhciBwYWdlID0gX3N0ZXAudmFsdWU7CiAgICAgICAgICAgICAgZm9yICh2YXIgX2kgPSAwLCBfYXJyID0gcGFnZS5jb21wb25lbnRzOyBfaSA8IF9hcnIubGVuZ3RoOyBfaSsrKSB7dmFyIGNvbXBvbmVudCA9IF9hcnJbX2ldOwogICAgICAgICAgICAgICAgY29tcG9uZW50LnByZXZpb3VzVmFsdWUgPSBjb21wb25lbnQudmFsdWU7CgogICAgICAgICAgICAgICAgaWYgKGNvbXBvbmVudC52YWxpZGF0ZSAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICAgIGNvbXBvbmVudC52YWxpZGF0ZSA9IGV2YWwoY29tcG9uZW50LnZhbGlkYXRlKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH19IGNhdGNoIChlcnIpIHtfaXRlcmF0b3IuZShlcnIpO30gZmluYWxseSB7X2l0ZXJhdG9yLmYoKTt9CgogICAgICAgICAgdmFyIGNvbnRhaW5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJyb290Iik7CiAgICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25vLW5vbi1udWxsLWFzc2VydGlvbgogICAgICAgICAgdmFyIHJvb3QgPSAoMCwgcmVhY3RfZG9tX2NsaWVudF9fV0VCUEFDS19JTVBPUlRFRF9NT0RVTEVfMV9fIC8qIC5jcmVhdGVSb290ICovLnMpKGNvbnRhaW5lcik7CiAgICAgICAgICByb290LnJlbmRlciggLyojX19QVVJFX18qL3JlYWN0X19XRUJQQUNLX0lNUE9SVEVEX01PRFVMRV8yX18uY3JlYXRlRWxlbWVudChfQXBwX19XRUJQQUNLX0lNUE9SVEVEX01PRFVMRV8wX18gLyogWyJkZWZhdWx0Il0gKi8uWiwgeyBwYWdlczogcGFnZXMgfSkpOwogICAgICAgIH0pOwogICAgICB9KSgpOwoKICAgICAgLyoqKioqKi9yZXR1cm4gX193ZWJwYWNrX2V4cG9ydHNfXzsKICAgICAgLyoqKioqKi99KSgpKTsKCn0pOw==";

/***/ }),

/***/ 171:
/***/ ((module) => {

module.exports = "#relayContainer{margin:1rem;font-family:Arial,Helvetica,sans-serif}#notificationsContainer{pointer-events:none;position:fixed;top:5%;left:70%;transform:translateX(-50%);z-index:999}img{display:block;margin:auto}input.stringcontainer{background-color:#fff;border-radius:5px;border:1px solid #121943;height:24px;margin:auto;display:flex;padding-left:5px}input.interrupt{width:100%;border-color:darkred;background-color:#f1948a;color:darkred;margin:10px 0px;cursor:pointer}input.interrupt:hover{background-color:#f5867a}input.interrupt:active{background-color:#f77163}input.save,input.interrupt{margin:auto;display:block;font-size:x-large;padding:5px 25px;border-radius:10px}.notification{border:3px solid #00529b;background-color:#bde5f8;width:fit-content;margin-right:auto;margin-left:auto;border-radius:40px;color:#00529b;padding:7px 60px;animation:2s fadeOut 5s 1 forwards;cursor:default;pointer-events:auto}@keyframes fadeOut{0%{opacity:1}99%{height:100%}100%{opacity:0;height:0}}td{padding:.5rem}.toggle{align-items:center;border-radius:100px;display:flex;font-weight:700;margin-bottom:16px}.toggle:last-of-type{margin:0}.toggle__input{clip:rect(0 0 0 0);clip-path:inset(50%);height:1px;overflow:hidden;position:absolute;white-space:nowrap;width:1px}.toggle__input:not([disabled]):active+.toggle-track,.toggle__input:not([disabled]):focus+.toggle-track{border:1px solid rgba(0,0,0,0);box-shadow:0px 0px 0px 2px #121943}.toggle__input:disabled+.toggle-track{cursor:not-allowed;opacity:.7}.toggle-track{background:#fff;border:1px solid #5a72b5;border-radius:100px;cursor:pointer;display:flex;height:30px;margin:auto;position:relative;width:60px}.toggle-indicator{align-items:center;background:#121943;border-radius:24px;bottom:2px;display:flex;height:24px;justify-content:center;left:2px;outline:solid 2px rgba(0,0,0,0);position:absolute;transition:.4s;width:24px}.checkMark{fill:#fff;height:20px;width:20px;opacity:0;transition:opacity .4s ease-in-out}.dropdowncontainer{padding:8px 16px;border:1px solid rgba(0,0,0,0);border-color:#000}input[value=true]+.toggle-track .toggle-indicator{background:#121943;transform:translateX(30px)}input[value=true]+.toggle-track .toggle-indicator .checkMark{opacity:1;transition:opacity .4s ease-in-out}@media screen and (-ms-high-contrast: active){.toggle-track{border-radius:0;background-color:red}}.topBar{display:flex}.tabEntry{margin-right:10px;border-radius:10px;background-color:#333}.tabEntry a{display:block;color:#fff;text-align:center;padding:6px;text-decoration:none}.tabEntry a[aria-current=page]{background-color:#00529b;border-radius:10px}.tabEntry a:hover[aria-current=page]{background-color:#002c53;border-radius:10px}.tabEntry a:hover{background-color:#111;border-radius:10px}.setting{position:relative}.setting .settingNameHover{visibility:hidden;background-color:#cacaca;color:#000;text-align:center;border-radius:6px;border-color:#000;position:absolute;z-index:1}.setting:hover .settingNameHover{visibility:visible;padding:5px;margin-left:15px}.hoverBox{position:relative;white-space:nowrap}.settingInput .settingDefaultHover{visibility:hidden;color:#666;position:absolute;z-index:1;left:50%;transform:translateX(-50%)}.settingInput:hover .settingDefaultHover{visibility:visible}.invalid-setting input,.invalid-setting select,.invalid-setting .toggle-track{background:pink !important}.invalid-reason{text-align:center}.invalid-reason small{padding:0px 5px;border-radius:10px;color:red}\n";

/***/ }),

/***/ 530:
/***/ ((module) => {

module.exports = require("kolmafia");

/***/ })

/******/ 	});
/************************************************************************/
/******/ 	// The module cache
/******/ 	var __webpack_module_cache__ = {};
/******/ 	
/******/ 	// The require function
/******/ 	function __webpack_require__(moduleId) {
/******/ 		// Check if module is in cache
/******/ 		var cachedModule = __webpack_module_cache__[moduleId];
/******/ 		if (cachedModule !== undefined) {
/******/ 			return cachedModule.exports;
/******/ 		}
/******/ 		// Create a new module (and put it into the cache)
/******/ 		var module = __webpack_module_cache__[moduleId] = {
/******/ 			// no module.id needed
/******/ 			// no module.loaded needed
/******/ 			exports: {}
/******/ 		};
/******/ 	
/******/ 		// Execute the module function
/******/ 		__webpack_modules__[moduleId](module, module.exports, __webpack_require__);
/******/ 	
/******/ 		// Return the exports of the module
/******/ 		return module.exports;
/******/ 	}
/******/ 	
/************************************************************************/
/******/ 	/* webpack/runtime/compat get default export */
/******/ 	(() => {
/******/ 		// getDefaultExport function for compatibility with non-harmony modules
/******/ 		__webpack_require__.n = (module) => {
/******/ 			var getter = module && module.__esModule ?
/******/ 				() => (module['default']) :
/******/ 				() => (module);
/******/ 			__webpack_require__.d(getter, { a: getter });
/******/ 			return getter;
/******/ 		};
/******/ 	})();
/******/ 	
/******/ 	/* webpack/runtime/define property getters */
/******/ 	(() => {
/******/ 		// define getter functions for harmony exports
/******/ 		__webpack_require__.d = (exports, definition) => {
/******/ 			for(var key in definition) {
/******/ 				if(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {
/******/ 					Object.defineProperty(exports, key, { enumerable: true, get: definition[key] });
/******/ 				}
/******/ 			}
/******/ 		};
/******/ 	})();
/******/ 	
/******/ 	/* webpack/runtime/hasOwnProperty shorthand */
/******/ 	(() => {
/******/ 		__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))
/******/ 	})();
/******/ 	
/******/ 	/* webpack/runtime/make namespace object */
/******/ 	(() => {
/******/ 		// define __esModule on exports
/******/ 		__webpack_require__.r = (exports) => {
/******/ 			if(typeof Symbol !== 'undefined' && Symbol.toStringTag) {
/******/ 				Object.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });
/******/ 			}
/******/ 			Object.defineProperty(exports, '__esModule', { value: true });
/******/ 		};
/******/ 	})();
/******/ 	
/************************************************************************/
var __webpack_exports__ = {};
// This entry need to be wrapped in an IIFE because it need to be isolated against other modules in the chunk.
(() => {
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "main": () => (/* binding */ main)
/* harmony export */ });
/* harmony import */ var kolmafia__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(530);
/* harmony import */ var kolmafia__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(kolmafia__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var _RelayUtils__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(616);
function _createForOfIteratorHelper(o, allowArrayLike) {var it = typeof Symbol !== "undefined" && o[Symbol.iterator] || o["@@iterator"];if (!it) {if (Array.isArray(o) || (it = _unsupportedIterableToArray(o)) || allowArrayLike && o && typeof o.length === "number") {if (it) o = it;var i = 0;var F = function F() {};return { s: F, n: function n() {if (i >= o.length) return { done: true };return { done: false, value: o[i++] };}, e: function e(_e) {throw _e;}, f: F };}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");}var normalCompletion = true,didErr = false,err;return { s: function s() {it = it.call(o);}, n: function n() {var step = it.next();normalCompletion = step.done;return step;}, e: function e(_e2) {didErr = true;err = _e2;}, f: function f() {try {if (!normalCompletion && it.return != null) it.return();} finally {if (didErr) throw err;}} };}function _unsupportedIterableToArray(o, minLen) {if (!o) return;if (typeof o === "string") return _arrayLikeToArray(o, minLen);var n = Object.prototype.toString.call(o).slice(8, -1);if (n === "Object" && o.constructor) n = o.constructor.name;if (n === "Map" || n === "Set") return Array.from(o);if (n === "Arguments" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen);}function _arrayLikeToArray(arr, len) {if (len == null || len > arr.length) len = arr.length;for (var i = 0, arr2 = new Array(len); i < len; i++) {arr2[i] = arr[i];}return arr2;}



function main() {for (var _len = arguments.length, pagesToLoad = new Array(_len), _key = 0; _key < _len; _key++) {pagesToLoad[_key] = arguments[_key];}
  if ((0,_RelayUtils__WEBPACK_IMPORTED_MODULE_1__/* .handleApiRequest */ .SU)()) {
    return;
  }

  if (pagesToLoad.length == 0) {
    // Find any 'page' or 'pages' parameters
    pagesToLoad = ((0,kolmafia__WEBPACK_IMPORTED_MODULE_0__.formFields)()["page"] || (0,kolmafia__WEBPACK_IMPORTED_MODULE_0__.formFields)()["pages"] || "").
    split(",").
    filter((s) => s.length > 0);
  }

  var pages = [];
  var extraHtml;

  if (pagesToLoad.length > 0) {
    var cssFile;var _iterator = _createForOfIteratorHelper(
      pagesToLoad),_step;try {for (_iterator.s(); !(_step = _iterator.n()).done;) {var pageName = _step.value;
        try {
          var page = null;

          // If the parameter is a string, then try to load from file
          if (typeof pageName == "string") {
            cssFile = (0,_RelayUtils__WEBPACK_IMPORTED_MODULE_1__/* .parseCssFromFile */ .$p)(pageName);
            page = (0,_RelayUtils__WEBPACK_IMPORTED_MODULE_1__/* .parsePageFromFile */ .jU)(pageName);
          } else {
            page = pageName;
          }

          if (page == null) {
            continue;
          }

          // Assume at this point it must be a RelayPage
          pages.push(page);

          if (cssFile == null) {
            continue;
          }

          if (extraHtml == null) {
            extraHtml = { cssFiles: [] };
          }

          extraHtml.cssFiles.push(cssFile);
        } catch (e) {
          (0,kolmafia__WEBPACK_IMPORTED_MODULE_0__.write)(
          "<h2>An error occured while trying to load " + (
          typeof pageName == "string" ?
          (0,_RelayUtils__WEBPACK_IMPORTED_MODULE_1__/* .getPagePath */ .mn)(pageName) + ", is your json properly formatted?" :
          "a relay page") +
          "</h2>");


          if (e) {
            (0,kolmafia__WEBPACK_IMPORTED_MODULE_0__.write)("<br>");
            (0,kolmafia__WEBPACK_IMPORTED_MODULE_0__.write)(e);

            if (e.stack) {
              for (var _i = 0, _arr = e.stack.split("\n"); _i < _arr.length; _i++) {var s = _arr[_i];
                while (s.match(/\t|\r/)) {
                  s = s.replace(/\t|\r/, "");
                }

                (0,kolmafia__WEBPACK_IMPORTED_MODULE_0__.write)("<br>");
                (0,kolmafia__WEBPACK_IMPORTED_MODULE_0__.write)(s);
              }
            }
          }
          return;
        }
      }} catch (err) {_iterator.e(err);} finally {_iterator.f();}
  }

  if (pages.length == 0) {
    (0,kolmafia__WEBPACK_IMPORTED_MODULE_0__.write)(
    "<h3>The relay script could not find any pages to load, either invalid/missing pages were provided or nothing was.</h3>");

    return;
  }

  (0,kolmafia__WEBPACK_IMPORTED_MODULE_0__.write)((0,_RelayUtils__WEBPACK_IMPORTED_MODULE_1__/* .generateHTML */ .ar)(pages, extraHtml));
}
})();

var __webpack_export_target__ = exports;
for(var i in __webpack_exports__) __webpack_export_target__[i] = __webpack_exports__[i];
if(__webpack_exports__.__esModule) Object.defineProperty(__webpack_export_target__, "__esModule", { value: true });
/******/ })()
;