/******/ (() => { // webpackBootstrap
/******/ 	"use strict";
/******/ 	var __webpack_modules__ = ({

/***/ 616:
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "$p": () => (/* binding */ parseCssFromFile),
/* harmony export */   "ar": () => (/* binding */ generateHTML),
/* harmony export */   "jU": () => (/* binding */ parsePageFromFile),
/* harmony export */   "k7": () => (/* binding */ handledApiRequest)
/* harmony export */ });
/* unused harmony exports validateComponents, parsePageFromJson */
/* harmony import */ var kolmafia__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(530);
/* harmony import */ var kolmafia__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(kolmafia__WEBPACK_IMPORTED_MODULE_0__);
function _slicedToArray(arr, i) {return _arrayWithHoles(arr) || _iterableToArrayLimit(arr, i) || _unsupportedIterableToArray(arr, i) || _nonIterableRest();}function _nonIterableRest() {throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");}function _iterableToArrayLimit(arr, i) {var _i = arr == null ? null : typeof Symbol !== "undefined" && arr[Symbol.iterator] || arr["@@iterator"];if (_i == null) return;var _arr = [];var _n = true;var _d = false;var _s, _e;try {for (_i = _i.call(arr); !(_n = (_s = _i.next()).done); _n = true) {_arr.push(_s.value);if (i && _arr.length === i) break;}} catch (err) {_d = true;_e = err;} finally {try {if (!_n && _i["return"] != null) _i["return"]();} finally {if (_d) throw _e;}}return _arr;}function _arrayWithHoles(arr) {if (Array.isArray(arr)) return arr;}function _toConsumableArray(arr) {return _arrayWithoutHoles(arr) || _iterableToArray(arr) || _unsupportedIterableToArray(arr) || _nonIterableSpread();}function _nonIterableSpread() {throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");}function _iterableToArray(iter) {if (typeof Symbol !== "undefined" && iter[Symbol.iterator] != null || iter["@@iterator"] != null) return Array.from(iter);}function _arrayWithoutHoles(arr) {if (Array.isArray(arr)) return _arrayLikeToArray(arr);}function _createForOfIteratorHelper(o, allowArrayLike) {var it = typeof Symbol !== "undefined" && o[Symbol.iterator] || o["@@iterator"];if (!it) {if (Array.isArray(o) || (it = _unsupportedIterableToArray(o)) || allowArrayLike && o && typeof o.length === "number") {if (it) o = it;var i = 0;var F = function F() {};return { s: F, n: function n() {if (i >= o.length) return { done: true };return { done: false, value: o[i++] };}, e: function e(_e2) {throw _e2;}, f: F };}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");}var normalCompletion = true,didErr = false,err;return { s: function s() {it = it.call(o);}, n: function n() {var step = it.next();normalCompletion = step.done;return step;}, e: function e(_e3) {didErr = true;err = _e3;}, f: function f() {try {if (!normalCompletion && it.return != null) it.return();} finally {if (didErr) throw err;}} };}function _unsupportedIterableToArray(o, minLen) {if (!o) return;if (typeof o === "string") return _arrayLikeToArray(o, minLen);var n = Object.prototype.toString.call(o).slice(8, -1);if (n === "Object" && o.constructor) n = o.constructor.name;if (n === "Map" || n === "Set") return Array.from(o);if (n === "Arguments" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen);}function _arrayLikeToArray(arr, len) {if (len == null || len > arr.length) len = arr.length;for (var i = 0, arr2 = new Array(len); i < len; i++) {arr2[i] = arr[i];}return arr2;}








function handledApiRequest() {
  var fields = (0,kolmafia__WEBPACK_IMPORTED_MODULE_0__.formFields)();

  if (fields["api"] == null) {
    return false;
  }
  var returns = eval(fields["api"]) || "";
  // We include the ' ' because otherwise the browser doesn't like an empty page
  (0,kolmafia__WEBPACK_IMPORTED_MODULE_0__.write)(returns + (returns ? "" : " "));

  return true;
}

function validateComponents(components) {var _iterator = _createForOfIteratorHelper(
    components),_step;try {for (_iterator.s(); !(_step = _iterator.n()).done;) {var _button$name;var component = _step.value;
      var button = component;

      if (button.preference == null) {
        continue;
      }

      button.name = (_button$name = button.name) !== null && _button$name !== void 0 ? _button$name : button.preference;

      if (button.validate != null) {
        try {
          eval(button.validate);
        } catch (e) {
          (0,kolmafia__WEBPACK_IMPORTED_MODULE_0__.print)("Unable to load ".concat(button.name, "'s validator '").concat(button.validate, "'"));
          button.validate = null;
        }
      }

      if (button.value != null) {
        continue;
      }

      var val = void 0;

      if ((0,kolmafia__WEBPACK_IMPORTED_MODULE_0__.propertyExists)(button.preference)) {
        val = (0,kolmafia__WEBPACK_IMPORTED_MODULE_0__.getProperty)(button.preference);
      } else if (button.default != null) {
        val = button.default;
      } else {
        if (button.type == "dropdown") {
          val = button.dropdown[0].value;
        } else if (button.type == "boolean") {
          val = "true";
        } else {
          val = "";
        }
      }

      button.value = val;
    }} catch (err) {_iterator.e(err);} finally {_iterator.f();}
}

function generateHTML(
pages,
extraHtml)
{
  pages = pages.filter((p) => p != null);var _iterator2 = _createForOfIteratorHelper(

    pages),_step2;try {for (_iterator2.s(); !(_step2 = _iterator2.n()).done;) {var page = _step2.value;
      validateComponents(page.components);
    }} catch (err) {_iterator2.e(err);} finally {_iterator2.f();}

  var buffer = [];

  var cssFiles = [];

  if (extraHtml && extraHtml.cssFiles) {
    cssFiles.push.apply(cssFiles, _toConsumableArray(extraHtml.cssFiles));
  }

  buffer.push("<head>");

  cssFiles.forEach((s) => {
    buffer.push("<link rel=\"stylesheet\" src=\"".concat(s, "\">"));
  });

  buffer.push("<style>");
  buffer.push("".concat(__webpack_require__(171)));

  if (extraHtml && extraHtml.css) {
    buffer.push(extraHtml.css);
  }

  buffer.push("</style>");

  buffer.push("</head>");

  buffer.push('<div id="root"></div>');

  buffer.push("<script>");

  // add script that react calls when loaded to get kol data
  buffer.push("let getData = function(callback) {callback(".concat(
  JSON.stringify(pages), ")}"));


  // close notifications when they are clicked on
  buffer.push("document.onclick = (e) => {\n    if(e.target.classList.contains('notification')) e.target.remove();\n  }");



  buffer.push("</script>");

  // include react script
  buffer.push("<script src=\"".concat(
  __webpack_require__(832), "\"></script>"));


  return buffer.join("\n");
}

/**
 * Parses from relay/shared_relay/pages/ if no slashes are in the name, otherwise expects a valid json file
 */
function parsePageFromFile(file) {
  var fileName = file.includes("/") ?
  file :
  "relay/shared_relay/pages/" + file + ".json";

  if (!fileName.endsWith(".json") && (0,kolmafia__WEBPACK_IMPORTED_MODULE_0__.fileToBuffer)(fileName).length == 0) {
    fileName += ".json";
  }

  var data = (0,kolmafia__WEBPACK_IMPORTED_MODULE_0__.fileToBuffer)(fileName);

  return parsePageFromJson(file, data);
}

function parseCssFromFile(file) {
  var fileName = file.includes("/") ?
  file :
  "shared_relay/pages/" + file + ".css";

  if (!fileName.endsWith(".css")) {
    fileName += ".css";
  }

  var data = (0,kolmafia__WEBPACK_IMPORTED_MODULE_0__.fileToBuffer)(fileName);

  if (data.length == 0) {
    return null;
  }

  return fileName;
}

function parsePageFromJson(id, jsonData) {
  if (jsonData.length == 0) {
    return null;
  }

  var subpage = JSON.parse(jsonData);

  subpage.file = id;

  for (var _i = 0, _arr = subpage.components; _i < _arr.length; _i++) {var _button$dropdown;var button = _arr[_i];
    if (button.type != "dropdown") {
      continue;
    }

    if (button.dropdown == null) {
      button.dropdown = [];
    } else if (typeof button.dropdown[0] == "string") {
      button.dropdown = button.dropdown.map((s) => {
        return {
          display: s,
          value: s
        };
      });
    }

    if (button.dropdownFiller == null) {
      continue;
    }

    var data =
    eval(button.dropdownFiller).
    map((_ref) => {var _ref2 = _slicedToArray(_ref, 2),display = _ref2[0],value = _ref2[1];
      return {
        display: display,
        value: value
      };
    });

    (_button$dropdown = button.dropdown).push.apply(_button$dropdown, _toConsumableArray(data));
  }

  return subpage;
}

/***/ }),

/***/ 832:
/***/ ((module) => {

module.exports = "data:application/javascript;base64,ZnVuY3Rpb24gX2NyZWF0ZUZvck9mSXRlcmF0b3JIZWxwZXIyKG8sIGFsbG93QXJyYXlMaWtlKSB7dmFyIGl0ID0gdHlwZW9mIFN5bWJvbCAhPT0gInVuZGVmaW5lZCIgJiYgb1tTeW1ib2wuaXRlcmF0b3JdIHx8IG9bIkBAaXRlcmF0b3IiXTtpZiAoIWl0KSB7aWYgKEFycmF5LmlzQXJyYXkobykgfHwgKGl0ID0gX3Vuc3VwcG9ydGVkSXRlcmFibGVUb0FycmF5MihvKSkgfHwgYWxsb3dBcnJheUxpa2UgJiYgbyAmJiB0eXBlb2Ygby5sZW5ndGggPT09ICJudW1iZXIiKSB7aWYgKGl0KSBvID0gaXQ7dmFyIGkgPSAwO3ZhciBGID0gZnVuY3Rpb24gRigpIHt9O3JldHVybiB7IHM6IEYsIG46IGZ1bmN0aW9uIG4oKSB7aWYgKGkgPj0gby5sZW5ndGgpIHJldHVybiB7IGRvbmU6IHRydWUgfTtyZXR1cm4geyBkb25lOiBmYWxzZSwgdmFsdWU6IG9baSsrXSB9O30sIGU6IGZ1bmN0aW9uIGUoX2U0KSB7dGhyb3cgX2U0O30sIGY6IEYgfTt9dGhyb3cgbmV3IFR5cGVFcnJvcigiSW52YWxpZCBhdHRlbXB0IHRvIGl0ZXJhdGUgbm9uLWl0ZXJhYmxlIGluc3RhbmNlLlxuSW4gb3JkZXIgdG8gYmUgaXRlcmFibGUsIG5vbi1hcnJheSBvYmplY3RzIG11c3QgaGF2ZSBhIFtTeW1ib2wuaXRlcmF0b3JdKCkgbWV0aG9kLiIpO312YXIgbm9ybWFsQ29tcGxldGlvbiA9IHRydWUsZGlkRXJyID0gZmFsc2UsZXJyO3JldHVybiB7IHM6IGZ1bmN0aW9uIHMoKSB7aXQgPSBpdC5jYWxsKG8pO30sIG46IGZ1bmN0aW9uIG4oKSB7dmFyIHN0ZXAgPSBpdC5uZXh0KCk7bm9ybWFsQ29tcGxldGlvbiA9IHN0ZXAuZG9uZTtyZXR1cm4gc3RlcDt9LCBlOiBmdW5jdGlvbiBlKF9lNSkge2RpZEVyciA9IHRydWU7ZXJyID0gX2U1O30sIGY6IGZ1bmN0aW9uIGYoKSB7dHJ5IHtpZiAoIW5vcm1hbENvbXBsZXRpb24gJiYgaXQucmV0dXJuICE9IG51bGwpIGl0LnJldHVybigpO30gZmluYWxseSB7aWYgKGRpZEVycikgdGhyb3cgZXJyO319IH07fWZ1bmN0aW9uIF9yZWdlbmVyYXRvclJ1bnRpbWUyKCkgeyJ1c2Ugc3RyaWN0IjsKLyohIHJlZ2VuZXJhdG9yLXJ1bnRpbWUgLS0gQ29weXJpZ2h0IChjKSAyMDE0LXByZXNlbnQsIEZhY2Vib29rLCBJbmMuIC0tIGxpY2Vuc2UgKE1JVCk6IGh0dHBzOi8vZ2l0aHViLmNvbS9mYWNlYm9vay9yZWdlbmVyYXRvci9ibG9iL21haW4vTElDRU5TRSAqL19yZWdlbmVyYXRvclJ1bnRpbWUyID0gZnVuY3Rpb24gX3JlZ2VuZXJhdG9yUnVudGltZTIoKSB7cmV0dXJuIGV4cG9ydHM7fTt2YXIgZXhwb3J0cyA9IHt9LE9wID0gT2JqZWN0LnByb3RvdHlwZSxoYXNPd24gPSBPcC5oYXNPd25Qcm9wZXJ0eSxkZWZpbmVQcm9wZXJ0eSA9IE9iamVjdC5kZWZpbmVQcm9wZXJ0eSB8fCBmdW5jdGlvbiAob2JqLCBrZXksIGRlc2MpIHtvYmpba2V5XSA9IGRlc2MudmFsdWU7fSwkU3ltYm9sID0gImZ1bmN0aW9uIiA9PSB0eXBlb2YgU3ltYm9sID8gU3ltYm9sIDoge30saXRlcmF0b3JTeW1ib2wgPSAkU3ltYm9sLml0ZXJhdG9yIHx8ICJAQGl0ZXJhdG9yIixhc3luY0l0ZXJhdG9yU3ltYm9sID0gJFN5bWJvbC5hc3luY0l0ZXJhdG9yIHx8ICJAQGFzeW5jSXRlcmF0b3IiLHRvU3RyaW5nVGFnU3ltYm9sID0gJFN5bWJvbC50b1N0cmluZ1RhZyB8fCAiQEB0b1N0cmluZ1RhZyI7ZnVuY3Rpb24gZGVmaW5lKG9iaiwga2V5LCB2YWx1ZSkge3JldHVybiBPYmplY3QuZGVmaW5lUHJvcGVydHkob2JqLCBrZXksIHsgdmFsdWU6IHZhbHVlLCBlbnVtZXJhYmxlOiAhMCwgY29uZmlndXJhYmxlOiAhMCwgd3JpdGFibGU6ICEwIH0pLCBvYmpba2V5XTt9dHJ5IHtkZWZpbmUoe30sICIiKTt9IGNhdGNoIChlcnIpIHtkZWZpbmUgPSBmdW5jdGlvbiBkZWZpbmUob2JqLCBrZXksIHZhbHVlKSB7cmV0dXJuIG9ialtrZXldID0gdmFsdWU7fTt9ZnVuY3Rpb24gd3JhcChpbm5lckZuLCBvdXRlckZuLCBzZWxmLCB0cnlMb2NzTGlzdCkge3ZhciBwcm90b0dlbmVyYXRvciA9IG91dGVyRm4gJiYgb3V0ZXJGbi5wcm90b3R5cGUgaW5zdGFuY2VvZiBHZW5lcmF0b3IgPyBvdXRlckZuIDogR2VuZXJhdG9yLGdlbmVyYXRvciA9IE9iamVjdC5jcmVhdGUocHJvdG9HZW5lcmF0b3IucHJvdG90eXBlKSxjb250ZXh0ID0gbmV3IENvbnRleHQodHJ5TG9jc0xpc3QgfHwgW10pO3JldHVybiBkZWZpbmVQcm9wZXJ0eShnZW5lcmF0b3IsICJfaW52b2tlIiwgeyB2YWx1ZTogbWFrZUludm9rZU1ldGhvZChpbm5lckZuLCBzZWxmLCBjb250ZXh0KSB9KSwgZ2VuZXJhdG9yO31mdW5jdGlvbiB0cnlDYXRjaChmbiwgb2JqLCBhcmcpIHt0cnkge3JldHVybiB7IHR5cGU6ICJub3JtYWwiLCBhcmc6IGZuLmNhbGwob2JqLCBhcmcpIH07fSBjYXRjaCAoZXJyKSB7cmV0dXJuIHsgdHlwZTogInRocm93IiwgYXJnOiBlcnIgfTt9fWV4cG9ydHMud3JhcCA9IHdyYXA7dmFyIENvbnRpbnVlU2VudGluZWwgPSB7fTtmdW5jdGlvbiBHZW5lcmF0b3IoKSB7fWZ1bmN0aW9uIEdlbmVyYXRvckZ1bmN0aW9uKCkge31mdW5jdGlvbiBHZW5lcmF0b3JGdW5jdGlvblByb3RvdHlwZSgpIHt9dmFyIEl0ZXJhdG9yUHJvdG90eXBlID0ge307ZGVmaW5lKEl0ZXJhdG9yUHJvdG90eXBlLCBpdGVyYXRvclN5bWJvbCwgZnVuY3Rpb24gKCkge3JldHVybiB0aGlzO30pO3ZhciBnZXRQcm90byA9IE9iamVjdC5nZXRQcm90b3R5cGVPZixOYXRpdmVJdGVyYXRvclByb3RvdHlwZSA9IGdldFByb3RvICYmIGdldFByb3RvKGdldFByb3RvKHZhbHVlcyhbXSkpKTtOYXRpdmVJdGVyYXRvclByb3RvdHlwZSAmJiBOYXRpdmVJdGVyYXRvclByb3RvdHlwZSAhPT0gT3AgJiYgaGFzT3duLmNhbGwoTmF0aXZlSXRlcmF0b3JQcm90b3R5cGUsIGl0ZXJhdG9yU3ltYm9sKSAmJiAoSXRlcmF0b3JQcm90b3R5cGUgPSBOYXRpdmVJdGVyYXRvclByb3RvdHlwZSk7dmFyIEdwID0gR2VuZXJhdG9yRnVuY3Rpb25Qcm90b3R5cGUucHJvdG90eXBlID0gR2VuZXJhdG9yLnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoSXRlcmF0b3JQcm90b3R5cGUpO2Z1bmN0aW9uIGRlZmluZUl0ZXJhdG9yTWV0aG9kcyhwcm90b3R5cGUpIHtbIm5leHQiLCAidGhyb3ciLCAicmV0dXJuIl0uZm9yRWFjaChmdW5jdGlvbiAobWV0aG9kKSB7ZGVmaW5lKHByb3RvdHlwZSwgbWV0aG9kLCBmdW5jdGlvbiAoYXJnKSB7cmV0dXJuIHRoaXMuX2ludm9rZShtZXRob2QsIGFyZyk7fSk7fSk7fWZ1bmN0aW9uIEFzeW5jSXRlcmF0b3IoZ2VuZXJhdG9yLCBQcm9taXNlSW1wbCkge2Z1bmN0aW9uIGludm9rZShtZXRob2QsIGFyZywgcmVzb2x2ZSwgcmVqZWN0KSB7dmFyIHJlY29yZCA9IHRyeUNhdGNoKGdlbmVyYXRvclttZXRob2RdLCBnZW5lcmF0b3IsIGFyZyk7aWYgKCJ0aHJvdyIgIT09IHJlY29yZC50eXBlKSB7dmFyIHJlc3VsdCA9IHJlY29yZC5hcmcsdmFsdWUgPSByZXN1bHQudmFsdWU7cmV0dXJuIHZhbHVlICYmICJvYmplY3QiID09IHR5cGVvZiB2YWx1ZSAmJiBoYXNPd24uY2FsbCh2YWx1ZSwgIl9fYXdhaXQiKSA/IFByb21pc2VJbXBsLnJlc29sdmUodmFsdWUuX19hd2FpdCkudGhlbihmdW5jdGlvbiAodmFsdWUpIHtpbnZva2UoIm5leHQiLCB2YWx1ZSwgcmVzb2x2ZSwgcmVqZWN0KTt9LCBmdW5jdGlvbiAoZXJyKSB7aW52b2tlKCJ0aHJvdyIsIGVyciwgcmVzb2x2ZSwgcmVqZWN0KTt9KSA6IFByb21pc2VJbXBsLnJlc29sdmUodmFsdWUpLnRoZW4oZnVuY3Rpb24gKHVud3JhcHBlZCkge3Jlc3VsdC52YWx1ZSA9IHVud3JhcHBlZCwgcmVzb2x2ZShyZXN1bHQpO30sIGZ1bmN0aW9uIChlcnJvcikge3JldHVybiBpbnZva2UoInRocm93IiwgZXJyb3IsIHJlc29sdmUsIHJlamVjdCk7fSk7fXJlamVjdChyZWNvcmQuYXJnKTt9dmFyIHByZXZpb3VzUHJvbWlzZTtkZWZpbmVQcm9wZXJ0eSh0aGlzLCAiX2ludm9rZSIsIHsgdmFsdWU6IGZ1bmN0aW9uIHZhbHVlKG1ldGhvZCwgYXJnKSB7ZnVuY3Rpb24gY2FsbEludm9rZVdpdGhNZXRob2RBbmRBcmcoKSB7cmV0dXJuIG5ldyBQcm9taXNlSW1wbChmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7aW52b2tlKG1ldGhvZCwgYXJnLCByZXNvbHZlLCByZWplY3QpO30pO31yZXR1cm4gcHJldmlvdXNQcm9taXNlID0gcHJldmlvdXNQcm9taXNlID8gcHJldmlvdXNQcm9taXNlLnRoZW4oY2FsbEludm9rZVdpdGhNZXRob2RBbmRBcmcsIGNhbGxJbnZva2VXaXRoTWV0aG9kQW5kQXJnKSA6IGNhbGxJbnZva2VXaXRoTWV0aG9kQW5kQXJnKCk7fSB9KTt9ZnVuY3Rpb24gbWFrZUludm9rZU1ldGhvZChpbm5lckZuLCBzZWxmLCBjb250ZXh0KSB7dmFyIHN0YXRlID0gInN1c3BlbmRlZFN0YXJ0IjtyZXR1cm4gZnVuY3Rpb24gKG1ldGhvZCwgYXJnKSB7aWYgKCJleGVjdXRpbmciID09PSBzdGF0ZSkgdGhyb3cgbmV3IEVycm9yKCJHZW5lcmF0b3IgaXMgYWxyZWFkeSBydW5uaW5nIik7aWYgKCJjb21wbGV0ZWQiID09PSBzdGF0ZSkge2lmICgidGhyb3ciID09PSBtZXRob2QpIHRocm93IGFyZztyZXR1cm4gZG9uZVJlc3VsdCgpO31mb3IgKGNvbnRleHQubWV0aG9kID0gbWV0aG9kLCBjb250ZXh0LmFyZyA9IGFyZzs7KSB7dmFyIGRlbGVnYXRlID0gY29udGV4dC5kZWxlZ2F0ZTtpZiAoZGVsZWdhdGUpIHt2YXIgZGVsZWdhdGVSZXN1bHQgPSBtYXliZUludm9rZURlbGVnYXRlKGRlbGVnYXRlLCBjb250ZXh0KTtpZiAoZGVsZWdhdGVSZXN1bHQpIHtpZiAoZGVsZWdhdGVSZXN1bHQgPT09IENvbnRpbnVlU2VudGluZWwpIGNvbnRpbnVlO3JldHVybiBkZWxlZ2F0ZVJlc3VsdDt9fWlmICgibmV4dCIgPT09IGNvbnRleHQubWV0aG9kKSBjb250ZXh0LnNlbnQgPSBjb250ZXh0Ll9zZW50ID0gY29udGV4dC5hcmc7ZWxzZSBpZiAoInRocm93IiA9PT0gY29udGV4dC5tZXRob2QpIHtpZiAoInN1c3BlbmRlZFN0YXJ0IiA9PT0gc3RhdGUpIHRocm93IHN0YXRlID0gImNvbXBsZXRlZCIsIGNvbnRleHQuYXJnO2NvbnRleHQuZGlzcGF0Y2hFeGNlcHRpb24oY29udGV4dC5hcmcpO30gZWxzZSAicmV0dXJuIiA9PT0gY29udGV4dC5tZXRob2QgJiYgY29udGV4dC5hYnJ1cHQoInJldHVybiIsIGNvbnRleHQuYXJnKTtzdGF0ZSA9ICJleGVjdXRpbmciO3ZhciByZWNvcmQgPSB0cnlDYXRjaChpbm5lckZuLCBzZWxmLCBjb250ZXh0KTtpZiAoIm5vcm1hbCIgPT09IHJlY29yZC50eXBlKSB7aWYgKHN0YXRlID0gY29udGV4dC5kb25lID8gImNvbXBsZXRlZCIgOiAic3VzcGVuZGVkWWllbGQiLCByZWNvcmQuYXJnID09PSBDb250aW51ZVNlbnRpbmVsKSBjb250aW51ZTtyZXR1cm4geyB2YWx1ZTogcmVjb3JkLmFyZywgZG9uZTogY29udGV4dC5kb25lIH07fSJ0aHJvdyIgPT09IHJlY29yZC50eXBlICYmIChzdGF0ZSA9ICJjb21wbGV0ZWQiLCBjb250ZXh0Lm1ldGhvZCA9ICJ0aHJvdyIsIGNvbnRleHQuYXJnID0gcmVjb3JkLmFyZyk7fX07fWZ1bmN0aW9uIG1heWJlSW52b2tlRGVsZWdhdGUoZGVsZWdhdGUsIGNvbnRleHQpIHt2YXIgbWV0aG9kID0gZGVsZWdhdGUuaXRlcmF0b3JbY29udGV4dC5tZXRob2RdO2lmICh1bmRlZmluZWQgPT09IG1ldGhvZCkge2lmIChjb250ZXh0LmRlbGVnYXRlID0gbnVsbCwgInRocm93IiA9PT0gY29udGV4dC5tZXRob2QpIHtpZiAoZGVsZWdhdGUuaXRlcmF0b3IucmV0dXJuICYmIChjb250ZXh0Lm1ldGhvZCA9ICJyZXR1cm4iLCBjb250ZXh0LmFyZyA9IHVuZGVmaW5lZCwgbWF5YmVJbnZva2VEZWxlZ2F0ZShkZWxlZ2F0ZSwgY29udGV4dCksICJ0aHJvdyIgPT09IGNvbnRleHQubWV0aG9kKSkgcmV0dXJuIENvbnRpbnVlU2VudGluZWw7Y29udGV4dC5tZXRob2QgPSAidGhyb3ciLCBjb250ZXh0LmFyZyA9IG5ldyBUeXBlRXJyb3IoIlRoZSBpdGVyYXRvciBkb2VzIG5vdCBwcm92aWRlIGEgJ3Rocm93JyBtZXRob2QiKTt9cmV0dXJuIENvbnRpbnVlU2VudGluZWw7fXZhciByZWNvcmQgPSB0cnlDYXRjaChtZXRob2QsIGRlbGVnYXRlLml0ZXJhdG9yLCBjb250ZXh0LmFyZyk7aWYgKCJ0aHJvdyIgPT09IHJlY29yZC50eXBlKSByZXR1cm4gY29udGV4dC5tZXRob2QgPSAidGhyb3ciLCBjb250ZXh0LmFyZyA9IHJlY29yZC5hcmcsIGNvbnRleHQuZGVsZWdhdGUgPSBudWxsLCBDb250aW51ZVNlbnRpbmVsO3ZhciBpbmZvID0gcmVjb3JkLmFyZztyZXR1cm4gaW5mbyA/IGluZm8uZG9uZSA/IChjb250ZXh0W2RlbGVnYXRlLnJlc3VsdE5hbWVdID0gaW5mby52YWx1ZSwgY29udGV4dC5uZXh0ID0gZGVsZWdhdGUubmV4dExvYywgInJldHVybiIgIT09IGNvbnRleHQubWV0aG9kICYmIChjb250ZXh0Lm1ldGhvZCA9ICJuZXh0IiwgY29udGV4dC5hcmcgPSB1bmRlZmluZWQpLCBjb250ZXh0LmRlbGVnYXRlID0gbnVsbCwgQ29udGludWVTZW50aW5lbCkgOiBpbmZvIDogKGNvbnRleHQubWV0aG9kID0gInRocm93IiwgY29udGV4dC5hcmcgPSBuZXcgVHlwZUVycm9yKCJpdGVyYXRvciByZXN1bHQgaXMgbm90IGFuIG9iamVjdCIpLCBjb250ZXh0LmRlbGVnYXRlID0gbnVsbCwgQ29udGludWVTZW50aW5lbCk7fWZ1bmN0aW9uIHB1c2hUcnlFbnRyeShsb2NzKSB7dmFyIGVudHJ5ID0geyB0cnlMb2M6IGxvY3NbMF0gfTsxIGluIGxvY3MgJiYgKGVudHJ5LmNhdGNoTG9jID0gbG9jc1sxXSksIDIgaW4gbG9jcyAmJiAoZW50cnkuZmluYWxseUxvYyA9IGxvY3NbMl0sIGVudHJ5LmFmdGVyTG9jID0gbG9jc1szXSksIHRoaXMudHJ5RW50cmllcy5wdXNoKGVudHJ5KTt9ZnVuY3Rpb24gcmVzZXRUcnlFbnRyeShlbnRyeSkge3ZhciByZWNvcmQgPSBlbnRyeS5jb21wbGV0aW9uIHx8IHt9O3JlY29yZC50eXBlID0gIm5vcm1hbCIsIGRlbGV0ZSByZWNvcmQuYXJnLCBlbnRyeS5jb21wbGV0aW9uID0gcmVjb3JkO31mdW5jdGlvbiBDb250ZXh0KHRyeUxvY3NMaXN0KSB7dGhpcy50cnlFbnRyaWVzID0gW3sgdHJ5TG9jOiAicm9vdCIgfV0sIHRyeUxvY3NMaXN0LmZvckVhY2gocHVzaFRyeUVudHJ5LCB0aGlzKSwgdGhpcy5yZXNldCghMCk7fWZ1bmN0aW9uIHZhbHVlcyhpdGVyYWJsZSkge2lmIChpdGVyYWJsZSkge3ZhciBpdGVyYXRvck1ldGhvZCA9IGl0ZXJhYmxlW2l0ZXJhdG9yU3ltYm9sXTtpZiAoaXRlcmF0b3JNZXRob2QpIHJldHVybiBpdGVyYXRvck1ldGhvZC5jYWxsKGl0ZXJhYmxlKTtpZiAoImZ1bmN0aW9uIiA9PSB0eXBlb2YgaXRlcmFibGUubmV4dCkgcmV0dXJuIGl0ZXJhYmxlO2lmICghaXNOYU4oaXRlcmFibGUubGVuZ3RoKSkge3ZhciBpID0gLTEsbmV4dCA9IGZ1bmN0aW9uIG5leHQoKSB7Zm9yICg7ICsraSA8IGl0ZXJhYmxlLmxlbmd0aDspIHtpZiAoaGFzT3duLmNhbGwoaXRlcmFibGUsIGkpKSByZXR1cm4gbmV4dC52YWx1ZSA9IGl0ZXJhYmxlW2ldLCBuZXh0LmRvbmUgPSAhMSwgbmV4dDt9cmV0dXJuIG5leHQudmFsdWUgPSB1bmRlZmluZWQsIG5leHQuZG9uZSA9ICEwLCBuZXh0O307cmV0dXJuIG5leHQubmV4dCA9IG5leHQ7fX1yZXR1cm4geyBuZXh0OiBkb25lUmVzdWx0IH07fWZ1bmN0aW9uIGRvbmVSZXN1bHQoKSB7cmV0dXJuIHsgdmFsdWU6IHVuZGVmaW5lZCwgZG9uZTogITAgfTt9cmV0dXJuIEdlbmVyYXRvckZ1bmN0aW9uLnByb3RvdHlwZSA9IEdlbmVyYXRvckZ1bmN0aW9uUHJvdG90eXBlLCBkZWZpbmVQcm9wZXJ0eShHcCwgImNvbnN0cnVjdG9yIiwgeyB2YWx1ZTogR2VuZXJhdG9yRnVuY3Rpb25Qcm90b3R5cGUsIGNvbmZpZ3VyYWJsZTogITAgfSksIGRlZmluZVByb3BlcnR5KEdlbmVyYXRvckZ1bmN0aW9uUHJvdG90eXBlLCAiY29uc3RydWN0b3IiLCB7IHZhbHVlOiBHZW5lcmF0b3JGdW5jdGlvbiwgY29uZmlndXJhYmxlOiAhMCB9KSwgR2VuZXJhdG9yRnVuY3Rpb24uZGlzcGxheU5hbWUgPSBkZWZpbmUoR2VuZXJhdG9yRnVuY3Rpb25Qcm90b3R5cGUsIHRvU3RyaW5nVGFnU3ltYm9sLCAiR2VuZXJhdG9yRnVuY3Rpb24iKSwgZXhwb3J0cy5pc0dlbmVyYXRvckZ1bmN0aW9uID0gZnVuY3Rpb24gKGdlbkZ1bikge3ZhciBjdG9yID0gImZ1bmN0aW9uIiA9PSB0eXBlb2YgZ2VuRnVuICYmIGdlbkZ1bi5jb25zdHJ1Y3RvcjtyZXR1cm4gISFjdG9yICYmIChjdG9yID09PSBHZW5lcmF0b3JGdW5jdGlvbiB8fCAiR2VuZXJhdG9yRnVuY3Rpb24iID09PSAoY3Rvci5kaXNwbGF5TmFtZSB8fCBjdG9yLm5hbWUpKTt9LCBleHBvcnRzLm1hcmsgPSBmdW5jdGlvbiAoZ2VuRnVuKSB7cmV0dXJuIE9iamVjdC5zZXRQcm90b3R5cGVPZiA/IE9iamVjdC5zZXRQcm90b3R5cGVPZihnZW5GdW4sIEdlbmVyYXRvckZ1bmN0aW9uUHJvdG90eXBlKSA6IChnZW5GdW4uX19wcm90b19fID0gR2VuZXJhdG9yRnVuY3Rpb25Qcm90b3R5cGUsIGRlZmluZShnZW5GdW4sIHRvU3RyaW5nVGFnU3ltYm9sLCAiR2VuZXJhdG9yRnVuY3Rpb24iKSksIGdlbkZ1bi5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKEdwKSwgZ2VuRnVuO30sIGV4cG9ydHMuYXdyYXAgPSBmdW5jdGlvbiAoYXJnKSB7cmV0dXJuIHsgX19hd2FpdDogYXJnIH07fSwgZGVmaW5lSXRlcmF0b3JNZXRob2RzKEFzeW5jSXRlcmF0b3IucHJvdG90eXBlKSwgZGVmaW5lKEFzeW5jSXRlcmF0b3IucHJvdG90eXBlLCBhc3luY0l0ZXJhdG9yU3ltYm9sLCBmdW5jdGlvbiAoKSB7cmV0dXJuIHRoaXM7fSksIGV4cG9ydHMuQXN5bmNJdGVyYXRvciA9IEFzeW5jSXRlcmF0b3IsIGV4cG9ydHMuYXN5bmMgPSBmdW5jdGlvbiAoaW5uZXJGbiwgb3V0ZXJGbiwgc2VsZiwgdHJ5TG9jc0xpc3QsIFByb21pc2VJbXBsKSB7dm9pZCAwID09PSBQcm9taXNlSW1wbCAmJiAoUHJvbWlzZUltcGwgPSBQcm9taXNlKTt2YXIgaXRlciA9IG5ldyBBc3luY0l0ZXJhdG9yKHdyYXAoaW5uZXJGbiwgb3V0ZXJGbiwgc2VsZiwgdHJ5TG9jc0xpc3QpLCBQcm9taXNlSW1wbCk7cmV0dXJuIGV4cG9ydHMuaXNHZW5lcmF0b3JGdW5jdGlvbihvdXRlckZuKSA/IGl0ZXIgOiBpdGVyLm5leHQoKS50aGVuKGZ1bmN0aW9uIChyZXN1bHQpIHtyZXR1cm4gcmVzdWx0LmRvbmUgPyByZXN1bHQudmFsdWUgOiBpdGVyLm5leHQoKTt9KTt9LCBkZWZpbmVJdGVyYXRvck1ldGhvZHMoR3ApLCBkZWZpbmUoR3AsIHRvU3RyaW5nVGFnU3ltYm9sLCAiR2VuZXJhdG9yIiksIGRlZmluZShHcCwgaXRlcmF0b3JTeW1ib2wsIGZ1bmN0aW9uICgpIHtyZXR1cm4gdGhpczt9KSwgZGVmaW5lKEdwLCAidG9TdHJpbmciLCBmdW5jdGlvbiAoKSB7cmV0dXJuICJbb2JqZWN0IEdlbmVyYXRvcl0iO30pLCBleHBvcnRzLmtleXMgPSBmdW5jdGlvbiAodmFsKSB7dmFyIG9iamVjdCA9IE9iamVjdCh2YWwpLGtleXMgPSBbXTtmb3IgKHZhciBrZXkgaW4gb2JqZWN0KSB7a2V5cy5wdXNoKGtleSk7fXJldHVybiBrZXlzLnJldmVyc2UoKSwgZnVuY3Rpb24gbmV4dCgpIHtmb3IgKDsga2V5cy5sZW5ndGg7KSB7dmFyIGtleSA9IGtleXMucG9wKCk7aWYgKGtleSBpbiBvYmplY3QpIHJldHVybiBuZXh0LnZhbHVlID0ga2V5LCBuZXh0LmRvbmUgPSAhMSwgbmV4dDt9cmV0dXJuIG5leHQuZG9uZSA9ICEwLCBuZXh0O307fSwgZXhwb3J0cy52YWx1ZXMgPSB2YWx1ZXMsIENvbnRleHQucHJvdG90eXBlID0geyBjb25zdHJ1Y3RvcjogQ29udGV4dCwgcmVzZXQ6IGZ1bmN0aW9uIHJlc2V0KHNraXBUZW1wUmVzZXQpIHtpZiAodGhpcy5wcmV2ID0gMCwgdGhpcy5uZXh0ID0gMCwgdGhpcy5zZW50ID0gdGhpcy5fc2VudCA9IHVuZGVmaW5lZCwgdGhpcy5kb25lID0gITEsIHRoaXMuZGVsZWdhdGUgPSBudWxsLCB0aGlzLm1ldGhvZCA9ICJuZXh0IiwgdGhpcy5hcmcgPSB1bmRlZmluZWQsIHRoaXMudHJ5RW50cmllcy5mb3JFYWNoKHJlc2V0VHJ5RW50cnkpLCAhc2tpcFRlbXBSZXNldCkgZm9yICh2YXIgbmFtZSBpbiB0aGlzKSB7InQiID09PSBuYW1lLmNoYXJBdCgwKSAmJiBoYXNPd24uY2FsbCh0aGlzLCBuYW1lKSAmJiAhaXNOYU4oK25hbWUuc2xpY2UoMSkpICYmICh0aGlzW25hbWVdID0gdW5kZWZpbmVkKTt9fSwgc3RvcDogZnVuY3Rpb24gc3RvcCgpIHt0aGlzLmRvbmUgPSAhMDt2YXIgcm9vdFJlY29yZCA9IHRoaXMudHJ5RW50cmllc1swXS5jb21wbGV0aW9uO2lmICgidGhyb3ciID09PSByb290UmVjb3JkLnR5cGUpIHRocm93IHJvb3RSZWNvcmQuYXJnO3JldHVybiB0aGlzLnJ2YWw7fSwgZGlzcGF0Y2hFeGNlcHRpb246IGZ1bmN0aW9uIGRpc3BhdGNoRXhjZXB0aW9uKGV4Y2VwdGlvbikge2lmICh0aGlzLmRvbmUpIHRocm93IGV4Y2VwdGlvbjt2YXIgY29udGV4dCA9IHRoaXM7ZnVuY3Rpb24gaGFuZGxlKGxvYywgY2F1Z2h0KSB7cmV0dXJuIHJlY29yZC50eXBlID0gInRocm93IiwgcmVjb3JkLmFyZyA9IGV4Y2VwdGlvbiwgY29udGV4dC5uZXh0ID0gbG9jLCBjYXVnaHQgJiYgKGNvbnRleHQubWV0aG9kID0gIm5leHQiLCBjb250ZXh0LmFyZyA9IHVuZGVmaW5lZCksICEhY2F1Z2h0O31mb3IgKHZhciBpID0gdGhpcy50cnlFbnRyaWVzLmxlbmd0aCAtIDE7IGkgPj0gMDsgLS1pKSB7dmFyIGVudHJ5ID0gdGhpcy50cnlFbnRyaWVzW2ldLHJlY29yZCA9IGVudHJ5LmNvbXBsZXRpb247aWYgKCJyb290IiA9PT0gZW50cnkudHJ5TG9jKSByZXR1cm4gaGFuZGxlKCJlbmQiKTtpZiAoZW50cnkudHJ5TG9jIDw9IHRoaXMucHJldikge3ZhciBoYXNDYXRjaCA9IGhhc093bi5jYWxsKGVudHJ5LCAiY2F0Y2hMb2MiKSxoYXNGaW5hbGx5ID0gaGFzT3duLmNhbGwoZW50cnksICJmaW5hbGx5TG9jIik7aWYgKGhhc0NhdGNoICYmIGhhc0ZpbmFsbHkpIHtpZiAodGhpcy5wcmV2IDwgZW50cnkuY2F0Y2hMb2MpIHJldHVybiBoYW5kbGUoZW50cnkuY2F0Y2hMb2MsICEwKTtpZiAodGhpcy5wcmV2IDwgZW50cnkuZmluYWxseUxvYykgcmV0dXJuIGhhbmRsZShlbnRyeS5maW5hbGx5TG9jKTt9IGVsc2UgaWYgKGhhc0NhdGNoKSB7aWYgKHRoaXMucHJldiA8IGVudHJ5LmNhdGNoTG9jKSByZXR1cm4gaGFuZGxlKGVudHJ5LmNhdGNoTG9jLCAhMCk7fSBlbHNlIHtpZiAoIWhhc0ZpbmFsbHkpIHRocm93IG5ldyBFcnJvcigidHJ5IHN0YXRlbWVudCB3aXRob3V0IGNhdGNoIG9yIGZpbmFsbHkiKTtpZiAodGhpcy5wcmV2IDwgZW50cnkuZmluYWxseUxvYykgcmV0dXJuIGhhbmRsZShlbnRyeS5maW5hbGx5TG9jKTt9fX19LCBhYnJ1cHQ6IGZ1bmN0aW9uIGFicnVwdCh0eXBlLCBhcmcpIHtmb3IgKHZhciBpID0gdGhpcy50cnlFbnRyaWVzLmxlbmd0aCAtIDE7IGkgPj0gMDsgLS1pKSB7dmFyIGVudHJ5ID0gdGhpcy50cnlFbnRyaWVzW2ldO2lmIChlbnRyeS50cnlMb2MgPD0gdGhpcy5wcmV2ICYmIGhhc093bi5jYWxsKGVudHJ5LCAiZmluYWxseUxvYyIpICYmIHRoaXMucHJldiA8IGVudHJ5LmZpbmFsbHlMb2MpIHt2YXIgZmluYWxseUVudHJ5ID0gZW50cnk7YnJlYWs7fX1maW5hbGx5RW50cnkgJiYgKCJicmVhayIgPT09IHR5cGUgfHwgImNvbnRpbnVlIiA9PT0gdHlwZSkgJiYgZmluYWxseUVudHJ5LnRyeUxvYyA8PSBhcmcgJiYgYXJnIDw9IGZpbmFsbHlFbnRyeS5maW5hbGx5TG9jICYmIChmaW5hbGx5RW50cnkgPSBudWxsKTt2YXIgcmVjb3JkID0gZmluYWxseUVudHJ5ID8gZmluYWxseUVudHJ5LmNvbXBsZXRpb24gOiB7fTtyZXR1cm4gcmVjb3JkLnR5cGUgPSB0eXBlLCByZWNvcmQuYXJnID0gYXJnLCBmaW5hbGx5RW50cnkgPyAodGhpcy5tZXRob2QgPSAibmV4dCIsIHRoaXMubmV4dCA9IGZpbmFsbHlFbnRyeS5maW5hbGx5TG9jLCBDb250aW51ZVNlbnRpbmVsKSA6IHRoaXMuY29tcGxldGUocmVjb3JkKTt9LCBjb21wbGV0ZTogZnVuY3Rpb24gY29tcGxldGUocmVjb3JkLCBhZnRlckxvYykge2lmICgidGhyb3ciID09PSByZWNvcmQudHlwZSkgdGhyb3cgcmVjb3JkLmFyZztyZXR1cm4gImJyZWFrIiA9PT0gcmVjb3JkLnR5cGUgfHwgImNvbnRpbnVlIiA9PT0gcmVjb3JkLnR5cGUgPyB0aGlzLm5leHQgPSByZWNvcmQuYXJnIDogInJldHVybiIgPT09IHJlY29yZC50eXBlID8gKHRoaXMucnZhbCA9IHRoaXMuYXJnID0gcmVjb3JkLmFyZywgdGhpcy5tZXRob2QgPSAicmV0dXJuIiwgdGhpcy5uZXh0ID0gImVuZCIpIDogIm5vcm1hbCIgPT09IHJlY29yZC50eXBlICYmIGFmdGVyTG9jICYmICh0aGlzLm5leHQgPSBhZnRlckxvYyksIENvbnRpbnVlU2VudGluZWw7fSwgZmluaXNoOiBmdW5jdGlvbiBmaW5pc2goZmluYWxseUxvYykge2ZvciAodmFyIGkgPSB0aGlzLnRyeUVudHJpZXMubGVuZ3RoIC0gMTsgaSA+PSAwOyAtLWkpIHt2YXIgZW50cnkgPSB0aGlzLnRyeUVudHJpZXNbaV07aWYgKGVudHJ5LmZpbmFsbHlMb2MgPT09IGZpbmFsbHlMb2MpIHJldHVybiB0aGlzLmNvbXBsZXRlKGVudHJ5LmNvbXBsZXRpb24sIGVudHJ5LmFmdGVyTG9jKSwgcmVzZXRUcnlFbnRyeShlbnRyeSksIENvbnRpbnVlU2VudGluZWw7fX0sIGNhdGNoOiBmdW5jdGlvbiBfY2F0Y2godHJ5TG9jKSB7Zm9yICh2YXIgaSA9IHRoaXMudHJ5RW50cmllcy5sZW5ndGggLSAxOyBpID49IDA7IC0taSkge3ZhciBlbnRyeSA9IHRoaXMudHJ5RW50cmllc1tpXTtpZiAoZW50cnkudHJ5TG9jID09PSB0cnlMb2MpIHt2YXIgcmVjb3JkID0gZW50cnkuY29tcGxldGlvbjtpZiAoInRocm93IiA9PT0gcmVjb3JkLnR5cGUpIHt2YXIgdGhyb3duID0gcmVjb3JkLmFyZztyZXNldFRyeUVudHJ5KGVudHJ5KTt9cmV0dXJuIHRocm93bjt9fXRocm93IG5ldyBFcnJvcigiaWxsZWdhbCBjYXRjaCBhdHRlbXB0Iik7fSwgZGVsZWdhdGVZaWVsZDogZnVuY3Rpb24gZGVsZWdhdGVZaWVsZChpdGVyYWJsZSwgcmVzdWx0TmFtZSwgbmV4dExvYykge3JldHVybiB0aGlzLmRlbGVnYXRlID0geyBpdGVyYXRvcjogdmFsdWVzKGl0ZXJhYmxlKSwgcmVzdWx0TmFtZTogcmVzdWx0TmFtZSwgbmV4dExvYzogbmV4dExvYyB9LCAibmV4dCIgPT09IHRoaXMubWV0aG9kICYmICh0aGlzLmFyZyA9IHVuZGVmaW5lZCksIENvbnRpbnVlU2VudGluZWw7fSB9LCBleHBvcnRzO31mdW5jdGlvbiBhc3luY0dlbmVyYXRvclN0ZXAoZ2VuLCByZXNvbHZlLCByZWplY3QsIF9uZXh0LCBfdGhyb3csIGtleSwgYXJnKSB7dHJ5IHt2YXIgaW5mbyA9IGdlbltrZXldKGFyZyk7dmFyIHZhbHVlID0gaW5mby52YWx1ZTt9IGNhdGNoIChlcnJvcikge3JlamVjdChlcnJvcik7cmV0dXJuO31pZiAoaW5mby5kb25lKSB7cmVzb2x2ZSh2YWx1ZSk7fSBlbHNlIHtQcm9taXNlLnJlc29sdmUodmFsdWUpLnRoZW4oX25leHQsIF90aHJvdyk7fX1mdW5jdGlvbiBfYXN5bmNUb0dlbmVyYXRvcjIoZm4pIHtyZXR1cm4gZnVuY3Rpb24gKCkge3ZhciBzZWxmID0gdGhpcyxhcmdzID0gYXJndW1lbnRzO3JldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7dmFyIGdlbiA9IGZuLmFwcGx5KHNlbGYsIGFyZ3MpO2Z1bmN0aW9uIF9uZXh0KHZhbHVlKSB7YXN5bmNHZW5lcmF0b3JTdGVwKGdlbiwgcmVzb2x2ZSwgcmVqZWN0LCBfbmV4dCwgX3Rocm93LCAibmV4dCIsIHZhbHVlKTt9ZnVuY3Rpb24gX3Rocm93KGVycikge2FzeW5jR2VuZXJhdG9yU3RlcChnZW4sIHJlc29sdmUsIHJlamVjdCwgX25leHQsIF90aHJvdywgInRocm93IiwgZXJyKTt9X25leHQodW5kZWZpbmVkKTt9KTt9O31mdW5jdGlvbiBfZGVmaW5lUHJvcGVydHkyKG9iaiwga2V5LCB2YWx1ZSkge2lmIChrZXkgaW4gb2JqKSB7T2JqZWN0LmRlZmluZVByb3BlcnR5KG9iaiwga2V5LCB7IHZhbHVlOiB2YWx1ZSwgZW51bWVyYWJsZTogdHJ1ZSwgY29uZmlndXJhYmxlOiB0cnVlLCB3cml0YWJsZTogdHJ1ZSB9KTt9IGVsc2Uge29ialtrZXldID0gdmFsdWU7fXJldHVybiBvYmo7fWZ1bmN0aW9uIF9kZWZpbmVQcm9wZXJ0aWVzKHRhcmdldCwgcHJvcHMpIHtmb3IgKHZhciBpID0gMDsgaSA8IHByb3BzLmxlbmd0aDsgaSsrKSB7dmFyIGRlc2NyaXB0b3IgPSBwcm9wc1tpXTtkZXNjcmlwdG9yLmVudW1lcmFibGUgPSBkZXNjcmlwdG9yLmVudW1lcmFibGUgfHwgZmFsc2U7ZGVzY3JpcHRvci5jb25maWd1cmFibGUgPSB0cnVlO2lmICgidmFsdWUiIGluIGRlc2NyaXB0b3IpIGRlc2NyaXB0b3Iud3JpdGFibGUgPSB0cnVlO09iamVjdC5kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGRlc2NyaXB0b3Iua2V5LCBkZXNjcmlwdG9yKTt9fWZ1bmN0aW9uIF9jcmVhdGVDbGFzczIoQ29uc3RydWN0b3IsIHByb3RvUHJvcHMsIHN0YXRpY1Byb3BzKSB7aWYgKHByb3RvUHJvcHMpIF9kZWZpbmVQcm9wZXJ0aWVzKENvbnN0cnVjdG9yLnByb3RvdHlwZSwgcHJvdG9Qcm9wcyk7aWYgKHN0YXRpY1Byb3BzKSBfZGVmaW5lUHJvcGVydGllcyhDb25zdHJ1Y3Rvciwgc3RhdGljUHJvcHMpO09iamVjdC5kZWZpbmVQcm9wZXJ0eShDb25zdHJ1Y3RvciwgInByb3RvdHlwZSIsIHsgd3JpdGFibGU6IGZhbHNlIH0pO3JldHVybiBDb25zdHJ1Y3Rvcjt9ZnVuY3Rpb24gX2NsYXNzQ2FsbENoZWNrMihpbnN0YW5jZSwgQ29uc3RydWN0b3IpIHtpZiAoIShpbnN0YW5jZSBpbnN0YW5jZW9mIENvbnN0cnVjdG9yKSkge3Rocm93IG5ldyBUeXBlRXJyb3IoIkNhbm5vdCBjYWxsIGEgY2xhc3MgYXMgYSBmdW5jdGlvbiIpO319ZnVuY3Rpb24gX2luaGVyaXRzKHN1YkNsYXNzLCBzdXBlckNsYXNzKSB7aWYgKHR5cGVvZiBzdXBlckNsYXNzICE9PSAiZnVuY3Rpb24iICYmIHN1cGVyQ2xhc3MgIT09IG51bGwpIHt0aHJvdyBuZXcgVHlwZUVycm9yKCJTdXBlciBleHByZXNzaW9uIG11c3QgZWl0aGVyIGJlIG51bGwgb3IgYSBmdW5jdGlvbiIpO31zdWJDbGFzcy5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKHN1cGVyQ2xhc3MgJiYgc3VwZXJDbGFzcy5wcm90b3R5cGUsIHsgY29uc3RydWN0b3I6IHsgdmFsdWU6IHN1YkNsYXNzLCB3cml0YWJsZTogdHJ1ZSwgY29uZmlndXJhYmxlOiB0cnVlIH0gfSk7T2JqZWN0LmRlZmluZVByb3BlcnR5KHN1YkNsYXNzLCAicHJvdG90eXBlIiwgeyB3cml0YWJsZTogZmFsc2UgfSk7aWYgKHN1cGVyQ2xhc3MpIF9zZXRQcm90b3R5cGVPZihzdWJDbGFzcywgc3VwZXJDbGFzcyk7fWZ1bmN0aW9uIF9jcmVhdGVTdXBlcihEZXJpdmVkKSB7dmFyIGhhc05hdGl2ZVJlZmxlY3RDb25zdHJ1Y3QgPSBfaXNOYXRpdmVSZWZsZWN0Q29uc3RydWN0KCk7cmV0dXJuIGZ1bmN0aW9uIF9jcmVhdGVTdXBlckludGVybmFsKCkge3ZhciBTdXBlciA9IF9nZXRQcm90b3R5cGVPZihEZXJpdmVkKSxyZXN1bHQ7aWYgKGhhc05hdGl2ZVJlZmxlY3RDb25zdHJ1Y3QpIHt2YXIgTmV3VGFyZ2V0ID0gX2dldFByb3RvdHlwZU9mKHRoaXMpLmNvbnN0cnVjdG9yO3Jlc3VsdCA9IFJlZmxlY3QuY29uc3RydWN0KFN1cGVyLCBhcmd1bWVudHMsIE5ld1RhcmdldCk7fSBlbHNlIHtyZXN1bHQgPSBTdXBlci5hcHBseSh0aGlzLCBhcmd1bWVudHMpO31yZXR1cm4gX3Bvc3NpYmxlQ29uc3RydWN0b3JSZXR1cm4odGhpcywgcmVzdWx0KTt9O31mdW5jdGlvbiBfcG9zc2libGVDb25zdHJ1Y3RvclJldHVybihzZWxmLCBjYWxsKSB7aWYgKGNhbGwgJiYgKHR5cGVvZiBjYWxsID09PSAib2JqZWN0IiB8fCB0eXBlb2YgY2FsbCA9PT0gImZ1bmN0aW9uIikpIHtyZXR1cm4gY2FsbDt9IGVsc2UgaWYgKGNhbGwgIT09IHZvaWQgMCkge3Rocm93IG5ldyBUeXBlRXJyb3IoIkRlcml2ZWQgY29uc3RydWN0b3JzIG1heSBvbmx5IHJldHVybiBvYmplY3Qgb3IgdW5kZWZpbmVkIik7fXJldHVybiBfYXNzZXJ0VGhpc0luaXRpYWxpemVkKHNlbGYpO31mdW5jdGlvbiBfYXNzZXJ0VGhpc0luaXRpYWxpemVkKHNlbGYpIHtpZiAoc2VsZiA9PT0gdm9pZCAwKSB7dGhyb3cgbmV3IFJlZmVyZW5jZUVycm9yKCJ0aGlzIGhhc24ndCBiZWVuIGluaXRpYWxpc2VkIC0gc3VwZXIoKSBoYXNuJ3QgYmVlbiBjYWxsZWQiKTt9cmV0dXJuIHNlbGY7fWZ1bmN0aW9uIF93cmFwTmF0aXZlU3VwZXIoQ2xhc3MpIHt2YXIgX2NhY2hlID0gdHlwZW9mIE1hcCA9PT0gImZ1bmN0aW9uIiA/IG5ldyBNYXAoKSA6IHVuZGVmaW5lZDtfd3JhcE5hdGl2ZVN1cGVyID0gZnVuY3Rpb24gX3dyYXBOYXRpdmVTdXBlcihDbGFzcykge2lmIChDbGFzcyA9PT0gbnVsbCB8fCAhX2lzTmF0aXZlRnVuY3Rpb24oQ2xhc3MpKSByZXR1cm4gQ2xhc3M7aWYgKHR5cGVvZiBDbGFzcyAhPT0gImZ1bmN0aW9uIikge3Rocm93IG5ldyBUeXBlRXJyb3IoIlN1cGVyIGV4cHJlc3Npb24gbXVzdCBlaXRoZXIgYmUgbnVsbCBvciBhIGZ1bmN0aW9uIik7fWlmICh0eXBlb2YgX2NhY2hlICE9PSAidW5kZWZpbmVkIikge2lmIChfY2FjaGUuaGFzKENsYXNzKSkgcmV0dXJuIF9jYWNoZS5nZXQoQ2xhc3MpO19jYWNoZS5zZXQoQ2xhc3MsIFdyYXBwZXIpO31mdW5jdGlvbiBXcmFwcGVyKCkge3JldHVybiBfY29uc3RydWN0KENsYXNzLCBhcmd1bWVudHMsIF9nZXRQcm90b3R5cGVPZih0aGlzKS5jb25zdHJ1Y3Rvcik7fVdyYXBwZXIucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZShDbGFzcy5wcm90b3R5cGUsIHsgY29uc3RydWN0b3I6IHsgdmFsdWU6IFdyYXBwZXIsIGVudW1lcmFibGU6IGZhbHNlLCB3cml0YWJsZTogdHJ1ZSwgY29uZmlndXJhYmxlOiB0cnVlIH0gfSk7cmV0dXJuIF9zZXRQcm90b3R5cGVPZihXcmFwcGVyLCBDbGFzcyk7fTtyZXR1cm4gX3dyYXBOYXRpdmVTdXBlcihDbGFzcyk7fWZ1bmN0aW9uIF9jb25zdHJ1Y3QoUGFyZW50LCBhcmdzLCBDbGFzcykge2lmIChfaXNOYXRpdmVSZWZsZWN0Q29uc3RydWN0KCkpIHtfY29uc3RydWN0ID0gUmVmbGVjdC5jb25zdHJ1Y3QuYmluZCgpO30gZWxzZSB7X2NvbnN0cnVjdCA9IGZ1bmN0aW9uIF9jb25zdHJ1Y3QoUGFyZW50LCBhcmdzLCBDbGFzcykge3ZhciBhID0gW251bGxdO2EucHVzaC5hcHBseShhLCBhcmdzKTt2YXIgQ29uc3RydWN0b3IgPSBGdW5jdGlvbi5iaW5kLmFwcGx5KFBhcmVudCwgYSk7dmFyIGluc3RhbmNlID0gbmV3IENvbnN0cnVjdG9yKCk7aWYgKENsYXNzKSBfc2V0UHJvdG90eXBlT2YoaW5zdGFuY2UsIENsYXNzLnByb3RvdHlwZSk7cmV0dXJuIGluc3RhbmNlO307fXJldHVybiBfY29uc3RydWN0LmFwcGx5KG51bGwsIGFyZ3VtZW50cyk7fWZ1bmN0aW9uIF9pc05hdGl2ZVJlZmxlY3RDb25zdHJ1Y3QoKSB7aWYgKHR5cGVvZiBSZWZsZWN0ID09PSAidW5kZWZpbmVkIiB8fCAhUmVmbGVjdC5jb25zdHJ1Y3QpIHJldHVybiBmYWxzZTtpZiAoUmVmbGVjdC5jb25zdHJ1Y3Quc2hhbSkgcmV0dXJuIGZhbHNlO2lmICh0eXBlb2YgUHJveHkgPT09ICJmdW5jdGlvbiIpIHJldHVybiB0cnVlO3RyeSB7Qm9vbGVhbi5wcm90b3R5cGUudmFsdWVPZi5jYWxsKFJlZmxlY3QuY29uc3RydWN0KEJvb2xlYW4sIFtdLCBmdW5jdGlvbiAoKSB7fSkpO3JldHVybiB0cnVlO30gY2F0Y2ggKGUpIHtyZXR1cm4gZmFsc2U7fX1mdW5jdGlvbiBfaXNOYXRpdmVGdW5jdGlvbihmbikge3JldHVybiBGdW5jdGlvbi50b1N0cmluZy5jYWxsKGZuKS5pbmRleE9mKCJbbmF0aXZlIGNvZGVdIikgIT09IC0xO31mdW5jdGlvbiBfc2V0UHJvdG90eXBlT2YobywgcCkge19zZXRQcm90b3R5cGVPZiA9IE9iamVjdC5zZXRQcm90b3R5cGVPZiA/IE9iamVjdC5zZXRQcm90b3R5cGVPZi5iaW5kKCkgOiBmdW5jdGlvbiBfc2V0UHJvdG90eXBlT2YobywgcCkge28uX19wcm90b19fID0gcDtyZXR1cm4gbzt9O3JldHVybiBfc2V0UHJvdG90eXBlT2YobywgcCk7fWZ1bmN0aW9uIF9nZXRQcm90b3R5cGVPZihvKSB7X2dldFByb3RvdHlwZU9mID0gT2JqZWN0LnNldFByb3RvdHlwZU9mID8gT2JqZWN0LmdldFByb3RvdHlwZU9mLmJpbmQoKSA6IGZ1bmN0aW9uIF9nZXRQcm90b3R5cGVPZihvKSB7cmV0dXJuIG8uX19wcm90b19fIHx8IE9iamVjdC5nZXRQcm90b3R5cGVPZihvKTt9O3JldHVybiBfZ2V0UHJvdG90eXBlT2Yobyk7fWZ1bmN0aW9uIF9zbGljZWRUb0FycmF5MihhcnIsIGkpIHtyZXR1cm4gX2FycmF5V2l0aEhvbGVzMihhcnIpIHx8IF9pdGVyYWJsZVRvQXJyYXlMaW1pdDIoYXJyLCBpKSB8fCBfdW5zdXBwb3J0ZWRJdGVyYWJsZVRvQXJyYXkyKGFyciwgaSkgfHwgX25vbkl0ZXJhYmxlUmVzdDIoKTt9ZnVuY3Rpb24gX25vbkl0ZXJhYmxlUmVzdDIoKSB7dGhyb3cgbmV3IFR5cGVFcnJvcigiSW52YWxpZCBhdHRlbXB0IHRvIGRlc3RydWN0dXJlIG5vbi1pdGVyYWJsZSBpbnN0YW5jZS5cbkluIG9yZGVyIHRvIGJlIGl0ZXJhYmxlLCBub24tYXJyYXkgb2JqZWN0cyBtdXN0IGhhdmUgYSBbU3ltYm9sLml0ZXJhdG9yXSgpIG1ldGhvZC4iKTt9ZnVuY3Rpb24gX2l0ZXJhYmxlVG9BcnJheUxpbWl0MihhcnIsIGkpIHt2YXIgX2kgPSBhcnIgPT0gbnVsbCA/IG51bGwgOiB0eXBlb2YgU3ltYm9sICE9PSAidW5kZWZpbmVkIiAmJiBhcnJbU3ltYm9sLml0ZXJhdG9yXSB8fCBhcnJbIkBAaXRlcmF0b3IiXTtpZiAoX2kgPT0gbnVsbCkgcmV0dXJuO3ZhciBfYXJyID0gW107dmFyIF9uID0gdHJ1ZTt2YXIgX2QgPSBmYWxzZTt2YXIgX3MsIF9lO3RyeSB7Zm9yIChfaSA9IF9pLmNhbGwoYXJyKTsgIShfbiA9IChfcyA9IF9pLm5leHQoKSkuZG9uZSk7IF9uID0gdHJ1ZSkge19hcnIucHVzaChfcy52YWx1ZSk7aWYgKGkgJiYgX2Fyci5sZW5ndGggPT09IGkpIGJyZWFrO319IGNhdGNoIChlcnIpIHtfZCA9IHRydWU7X2UgPSBlcnI7fSBmaW5hbGx5IHt0cnkge2lmICghX24gJiYgX2lbInJldHVybiJdICE9IG51bGwpIF9pWyJyZXR1cm4iXSgpO30gZmluYWxseSB7aWYgKF9kKSB0aHJvdyBfZTt9fXJldHVybiBfYXJyO31mdW5jdGlvbiBfYXJyYXlXaXRoSG9sZXMyKGFycikge2lmIChBcnJheS5pc0FycmF5KGFycikpIHJldHVybiBhcnI7fWZ1bmN0aW9uIF90b0NvbnN1bWFibGVBcnJheTIoYXJyKSB7cmV0dXJuIF9hcnJheVdpdGhvdXRIb2xlczIoYXJyKSB8fCBfaXRlcmFibGVUb0FycmF5MihhcnIpIHx8IF91bnN1cHBvcnRlZEl0ZXJhYmxlVG9BcnJheTIoYXJyKSB8fCBfbm9uSXRlcmFibGVTcHJlYWQyKCk7fWZ1bmN0aW9uIF9ub25JdGVyYWJsZVNwcmVhZDIoKSB7dGhyb3cgbmV3IFR5cGVFcnJvcigiSW52YWxpZCBhdHRlbXB0IHRvIHNwcmVhZCBub24taXRlcmFibGUgaW5zdGFuY2UuXG5JbiBvcmRlciB0byBiZSBpdGVyYWJsZSwgbm9uLWFycmF5IG9iamVjdHMgbXVzdCBoYXZlIGEgW1N5bWJvbC5pdGVyYXRvcl0oKSBtZXRob2QuIik7fWZ1bmN0aW9uIF91bnN1cHBvcnRlZEl0ZXJhYmxlVG9BcnJheTIobywgbWluTGVuKSB7aWYgKCFvKSByZXR1cm47aWYgKHR5cGVvZiBvID09PSAic3RyaW5nIikgcmV0dXJuIF9hcnJheUxpa2VUb0FycmF5MihvLCBtaW5MZW4pO3ZhciBuID0gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKG8pLnNsaWNlKDgsIC0xKTtpZiAobiA9PT0gIk9iamVjdCIgJiYgby5jb25zdHJ1Y3RvcikgbiA9IG8uY29uc3RydWN0b3IubmFtZTtpZiAobiA9PT0gIk1hcCIgfHwgbiA9PT0gIlNldCIpIHJldHVybiBBcnJheS5mcm9tKG8pO2lmIChuID09PSAiQXJndW1lbnRzIiB8fCAvXig/OlVpfEkpbnQoPzo4fDE2fDMyKSg/OkNsYW1wZWQpP0FycmF5JC8udGVzdChuKSkgcmV0dXJuIF9hcnJheUxpa2VUb0FycmF5MihvLCBtaW5MZW4pO31mdW5jdGlvbiBfaXRlcmFibGVUb0FycmF5MihpdGVyKSB7aWYgKHR5cGVvZiBTeW1ib2wgIT09ICJ1bmRlZmluZWQiICYmIGl0ZXJbU3ltYm9sLml0ZXJhdG9yXSAhPSBudWxsIHx8IGl0ZXJbIkBAaXRlcmF0b3IiXSAhPSBudWxsKSByZXR1cm4gQXJyYXkuZnJvbShpdGVyKTt9ZnVuY3Rpb24gX2FycmF5V2l0aG91dEhvbGVzMihhcnIpIHtpZiAoQXJyYXkuaXNBcnJheShhcnIpKSByZXR1cm4gX2FycmF5TGlrZVRvQXJyYXkyKGFycik7fWZ1bmN0aW9uIF9hcnJheUxpa2VUb0FycmF5MihhcnIsIGxlbikge2lmIChsZW4gPT0gbnVsbCB8fCBsZW4gPiBhcnIubGVuZ3RoKSBsZW4gPSBhcnIubGVuZ3RoO2ZvciAodmFyIGkgPSAwLCBhcnIyID0gbmV3IEFycmF5KGxlbik7IGkgPCBsZW47IGkrKykge2FycjJbaV0gPSBhcnJbaV07fXJldHVybiBhcnIyO30oZnVuY3Rpb24gd2VicGFja1VuaXZlcnNhbE1vZHVsZURlZmluaXRpb24ocm9vdCwgZmFjdG9yeSkge2lmICh0eXBlb2YgZXhwb3J0cyA9PT0gJ29iamVjdCcgJiYgdHlwZW9mIG1vZHVsZSA9PT0gJ29iamVjdCcpCiAgbW9kdWxlLmV4cG9ydHMgPSBmYWN0b3J5KCk7ZWxzZQogIGlmICh0eXBlb2YgZGVmaW5lID09PSAnZnVuY3Rpb24nICYmIGRlZmluZS5hbWQpCiAgZGVmaW5lKFtdLCBmYWN0b3J5KTtlbHNlCiAgewogICAgdmFyIGEgPSBmYWN0b3J5KCk7CiAgICBmb3IgKHZhciBpIGluIGEpIHsodHlwZW9mIGV4cG9ydHMgPT09ICdvYmplY3QnID8gZXhwb3J0cyA6IHJvb3QpW2ldID0gYVtpXTt9CiAgfQp9KShzZWxmLCAoKSA9PiB7CiAgcmV0dXJuICgvKioqKioqLygoKSA9PiB7Ly8gd2VicGFja0Jvb3RzdHJhcAogICAgICAvKioqKioqLyJ1c2Ugc3RyaWN0IjsKICAgICAgLyoqKioqKi92YXIgX193ZWJwYWNrX21vZHVsZXNfXyA9IHsKCiAgICAgICAgLyoqKi8yNDI6CiAgICAgICAgLyoqKi8oX191bnVzZWRfd2VicGFja19tb2R1bGUsIF9fd2VicGFja19leHBvcnRzX18sIF9fd2VicGFja19yZXF1aXJlX18pID0+IHsKCgogICAgICAgICAgLy8gRVhQT1JUUwogICAgICAgICAgX193ZWJwYWNrX3JlcXVpcmVfXy5kKF9fd2VicGFja19leHBvcnRzX18sIHsKICAgICAgICAgICAgIloiOiAoKSA9PiAvKiBiaW5kaW5nICovcmVsYXlfQXBwCiAgICAgICAgICB9KTsKCiAgICAgICAgICA7IC8vIENPTkNBVEVOQVRFRCBNT0RVTEU6IC4vbm9kZV9tb2R1bGVzL0ByZW1peC1ydW4vcm91dGVyL2Rpc3Qvcm91dGVyLmpzCiAgICAgICAgICAvKioKICAgICAgICAgICAqIEByZW1peC1ydW4vcm91dGVyIHYxLjAuMwogICAgICAgICAgICoKICAgICAgICAgICAqIENvcHlyaWdodCAoYykgUmVtaXggU29mdHdhcmUgSW5jLgogICAgICAgICAgICoKICAgICAgICAgICAqIFRoaXMgc291cmNlIGNvZGUgaXMgbGljZW5zZWQgdW5kZXIgdGhlIE1JVCBsaWNlbnNlIGZvdW5kIGluIHRoZQogICAgICAgICAgICogTElDRU5TRS5tZCBmaWxlIGluIHRoZSByb290IGRpcmVjdG9yeSBvZiB0aGlzIHNvdXJjZSB0cmVlLgogICAgICAgICAgICoKICAgICAgICAgICAqIEBsaWNlbnNlIE1JVAogICAgICAgICAgICovCiAgICAgICAgICBmdW5jdGlvbiBfZXh0ZW5kcygpIHsKICAgICAgICAgICAgX2V4dGVuZHMgPSBPYmplY3QuYXNzaWduID8gT2JqZWN0LmFzc2lnbi5iaW5kKCkgOiBmdW5jdGlvbiAodGFyZ2V0KSB7CiAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDE7IGkgPCBhcmd1bWVudHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICAgIHZhciBzb3VyY2UgPSBhcmd1bWVudHNbaV07CgogICAgICAgICAgICAgICAgZm9yICh2YXIga2V5IGluIHNvdXJjZSkgewogICAgICAgICAgICAgICAgICBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKHNvdXJjZSwga2V5KSkgewogICAgICAgICAgICAgICAgICAgIHRhcmdldFtrZXldID0gc291cmNlW2tleV07CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIHJldHVybiB0YXJnZXQ7CiAgICAgICAgICAgIH07CiAgICAgICAgICAgIHJldHVybiBfZXh0ZW5kcy5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICAgICAgfQoKICAgICAgICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCiAgICAgICAgICAvLyNyZWdpb24gVHlwZXMgYW5kIENvbnN0YW50cwogICAgICAgICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KCiAgICAgICAgICAvKioKICAgICAgICAgICAqIEFjdGlvbnMgcmVwcmVzZW50IHRoZSB0eXBlIG9mIGNoYW5nZSB0byBhIGxvY2F0aW9uIHZhbHVlLgogICAgICAgICAgICovCiAgICAgICAgICB2YXIgQWN0aW9uOwoKICAgICAgICAgIChmdW5jdGlvbiAoQWN0aW9uKSB7CiAgICAgICAgICAgIC8qKgogICAgICAgICAgICAgKiBBIFBPUCBpbmRpY2F0ZXMgYSBjaGFuZ2UgdG8gYW4gYXJiaXRyYXJ5IGluZGV4IGluIHRoZSBoaXN0b3J5IHN0YWNrLCBzdWNoCiAgICAgICAgICAgICAqIGFzIGEgYmFjayBvciBmb3J3YXJkIG5hdmlnYXRpb24uIEl0IGRvZXMgbm90IGRlc2NyaWJlIHRoZSBkaXJlY3Rpb24gb2YgdGhlCiAgICAgICAgICAgICAqIG5hdmlnYXRpb24sIG9ubHkgdGhhdCB0aGUgY3VycmVudCBpbmRleCBjaGFuZ2VkLgogICAgICAgICAgICAgKgogICAgICAgICAgICAgKiBOb3RlOiBUaGlzIGlzIHRoZSBkZWZhdWx0IGFjdGlvbiBmb3IgbmV3bHkgY3JlYXRlZCBoaXN0b3J5IG9iamVjdHMuCiAgICAgICAgICAgICAqLwogICAgICAgICAgICBBY3Rpb25bIlBvcCJdID0gIlBPUCI7CiAgICAgICAgICAgIC8qKgogICAgICAgICAgICAgKiBBIFBVU0ggaW5kaWNhdGVzIGEgbmV3IGVudHJ5IGJlaW5nIGFkZGVkIHRvIHRoZSBoaXN0b3J5IHN0YWNrLCBzdWNoIGFzIHdoZW4KICAgICAgICAgICAgICogYSBsaW5rIGlzIGNsaWNrZWQgYW5kIGEgbmV3IHBhZ2UgbG9hZHMuIFdoZW4gdGhpcyBoYXBwZW5zLCBhbGwgc3Vic2VxdWVudAogICAgICAgICAgICAgKiBlbnRyaWVzIGluIHRoZSBzdGFjayBhcmUgbG9zdC4KICAgICAgICAgICAgICovCgogICAgICAgICAgICBBY3Rpb25bIlB1c2giXSA9ICJQVVNIIjsKICAgICAgICAgICAgLyoqCiAgICAgICAgICAgICAqIEEgUkVQTEFDRSBpbmRpY2F0ZXMgdGhlIGVudHJ5IGF0IHRoZSBjdXJyZW50IGluZGV4IGluIHRoZSBoaXN0b3J5IHN0YWNrCiAgICAgICAgICAgICAqIGJlaW5nIHJlcGxhY2VkIGJ5IGEgbmV3IG9uZS4KICAgICAgICAgICAgICovCgogICAgICAgICAgICBBY3Rpb25bIlJlcGxhY2UiXSA9ICJSRVBMQUNFIjsKICAgICAgICAgIH0pKEFjdGlvbiB8fCAoQWN0aW9uID0ge30pKTsKCiAgICAgICAgICB2YXIgUG9wU3RhdGVFdmVudFR5cGUgPSAicG9wc3RhdGUiOwogICAgICAgICAgLyoqCiAgICAgICAgICAgKiBNZW1vcnkgaGlzdG9yeSBzdG9yZXMgdGhlIGN1cnJlbnQgbG9jYXRpb24gaW4gbWVtb3J5LiBJdCBpcyBkZXNpZ25lZCBmb3IgdXNlCiAgICAgICAgICAgKiBpbiBzdGF0ZWZ1bCBub24tYnJvd3NlciBlbnZpcm9ubWVudHMgbGlrZSB0ZXN0cyBhbmQgUmVhY3QgTmF0aXZlLgogICAgICAgICAgICovCgogICAgICAgICAgZnVuY3Rpb24gcm91dGVyX2NyZWF0ZU1lbW9yeUhpc3Rvcnkob3B0aW9ucykgewogICAgICAgICAgICBpZiAob3B0aW9ucyA9PT0gdm9pZCAwKSB7CiAgICAgICAgICAgICAgb3B0aW9ucyA9IHt9OwogICAgICAgICAgICB9CgogICAgICAgICAgICB2YXIgX29wdGlvbnMgPQoKCgogICAgICAgICAgICAgIG9wdGlvbnMsX29wdGlvbnMkaW5pdGlhbEVudHJpID0gX29wdGlvbnMuaW5pdGlhbEVudHJpZXMsaW5pdGlhbEVudHJpZXMgPSBfb3B0aW9ucyRpbml0aWFsRW50cmkgPT09IHZvaWQgMCA/IFsiLyJdIDogX29wdGlvbnMkaW5pdGlhbEVudHJpLGluaXRpYWxJbmRleCA9IF9vcHRpb25zLmluaXRpYWxJbmRleCxfb3B0aW9ucyR2NUNvbXBhdCA9IF9vcHRpb25zLnY1Q29tcGF0LHY1Q29tcGF0ID0gX29wdGlvbnMkdjVDb21wYXQgPT09IHZvaWQgMCA/IGZhbHNlIDogX29wdGlvbnMkdjVDb21wYXQ7CiAgICAgICAgICAgIHZhciBlbnRyaWVzOyAvLyBEZWNsYXJlIHNvIHdlIGNhbiBhY2Nlc3MgZnJvbSBjcmVhdGVNZW1vcnlMb2NhdGlvbgoKICAgICAgICAgICAgZW50cmllcyA9IGluaXRpYWxFbnRyaWVzLm1hcCgoZW50cnksIGluZGV4KSA9PiBjcmVhdGVNZW1vcnlMb2NhdGlvbihlbnRyeSwgdHlwZW9mIGVudHJ5ID09PSAic3RyaW5nIiA/IG51bGwgOiBlbnRyeS5zdGF0ZSwgaW5kZXggPT09IDAgPyAiZGVmYXVsdCIgOiB1bmRlZmluZWQpKTsKICAgICAgICAgICAgdmFyIGluZGV4ID0gY2xhbXBJbmRleChpbml0aWFsSW5kZXggPT0gbnVsbCA/IGVudHJpZXMubGVuZ3RoIC0gMSA6IGluaXRpYWxJbmRleCk7CiAgICAgICAgICAgIHZhciBhY3Rpb24gPSBBY3Rpb24uUG9wOwogICAgICAgICAgICB2YXIgbGlzdGVuZXIgPSBudWxsOwoKICAgICAgICAgICAgZnVuY3Rpb24gY2xhbXBJbmRleChuKSB7CiAgICAgICAgICAgICAgcmV0dXJuIE1hdGgubWluKE1hdGgubWF4KG4sIDApLCBlbnRyaWVzLmxlbmd0aCAtIDEpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBmdW5jdGlvbiBnZXRDdXJyZW50TG9jYXRpb24oKSB7CiAgICAgICAgICAgICAgcmV0dXJuIGVudHJpZXNbaW5kZXhdOwogICAgICAgICAgICB9CgogICAgICAgICAgICBmdW5jdGlvbiBjcmVhdGVNZW1vcnlMb2NhdGlvbih0bywgc3RhdGUsIGtleSkgewogICAgICAgICAgICAgIGlmIChzdGF0ZSA9PT0gdm9pZCAwKSB7CiAgICAgICAgICAgICAgICBzdGF0ZSA9IG51bGw7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICB2YXIgbG9jYXRpb24gPSBjcmVhdGVMb2NhdGlvbihlbnRyaWVzID8gZ2V0Q3VycmVudExvY2F0aW9uKCkucGF0aG5hbWUgOiAiLyIsIHRvLCBzdGF0ZSwga2V5KTsKICAgICAgICAgICAgICB3YXJuaW5nJDEobG9jYXRpb24ucGF0aG5hbWUuY2hhckF0KDApID09PSAiLyIsICJyZWxhdGl2ZSBwYXRobmFtZXMgYXJlIG5vdCBzdXBwb3J0ZWQgaW4gbWVtb3J5IGhpc3Rvcnk6ICIgKyBKU09OLnN0cmluZ2lmeSh0bykpOwogICAgICAgICAgICAgIHJldHVybiBsb2NhdGlvbjsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdmFyIGhpc3RvcnkgPSB7CiAgICAgICAgICAgICAgZ2V0IGluZGV4KCkgewogICAgICAgICAgICAgICAgcmV0dXJuIGluZGV4OwogICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgIGdldCBhY3Rpb24oKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gYWN0aW9uOwogICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgIGdldCBsb2NhdGlvbigpIHsKICAgICAgICAgICAgICAgIHJldHVybiBnZXRDdXJyZW50TG9jYXRpb24oKTsKICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICBjcmVhdGVIcmVmOiBmdW5jdGlvbiBjcmVhdGVIcmVmKHRvKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdHlwZW9mIHRvID09PSAic3RyaW5nIiA/IHRvIDogcm91dGVyX2NyZWF0ZVBhdGgodG8pOwogICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgIGVuY29kZUxvY2F0aW9uOiBmdW5jdGlvbiBlbmNvZGVMb2NhdGlvbihsb2NhdGlvbikgewogICAgICAgICAgICAgICAgcmV0dXJuIGxvY2F0aW9uOwogICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgIHB1c2g6IGZ1bmN0aW9uIHB1c2godG8sIHN0YXRlKSB7CiAgICAgICAgICAgICAgICBhY3Rpb24gPSBBY3Rpb24uUHVzaDsKICAgICAgICAgICAgICAgIHZhciBuZXh0TG9jYXRpb24gPSBjcmVhdGVNZW1vcnlMb2NhdGlvbih0bywgc3RhdGUpOwogICAgICAgICAgICAgICAgaW5kZXggKz0gMTsKICAgICAgICAgICAgICAgIGVudHJpZXMuc3BsaWNlKGluZGV4LCBlbnRyaWVzLmxlbmd0aCwgbmV4dExvY2F0aW9uKTsKCiAgICAgICAgICAgICAgICBpZiAodjVDb21wYXQgJiYgbGlzdGVuZXIpIHsKICAgICAgICAgICAgICAgICAgbGlzdGVuZXIoewogICAgICAgICAgICAgICAgICAgIGFjdGlvbjogYWN0aW9uLAogICAgICAgICAgICAgICAgICAgIGxvY2F0aW9uOiBuZXh0TG9jYXRpb24KICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgcmVwbGFjZTogZnVuY3Rpb24gcmVwbGFjZSh0bywgc3RhdGUpIHsKICAgICAgICAgICAgICAgIGFjdGlvbiA9IEFjdGlvbi5SZXBsYWNlOwogICAgICAgICAgICAgICAgdmFyIG5leHRMb2NhdGlvbiA9IGNyZWF0ZU1lbW9yeUxvY2F0aW9uKHRvLCBzdGF0ZSk7CiAgICAgICAgICAgICAgICBlbnRyaWVzW2luZGV4XSA9IG5leHRMb2NhdGlvbjsKCiAgICAgICAgICAgICAgICBpZiAodjVDb21wYXQgJiYgbGlzdGVuZXIpIHsKICAgICAgICAgICAgICAgICAgbGlzdGVuZXIoewogICAgICAgICAgICAgICAgICAgIGFjdGlvbjogYWN0aW9uLAogICAgICAgICAgICAgICAgICAgIGxvY2F0aW9uOiBuZXh0TG9jYXRpb24KICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgZ286IGZ1bmN0aW9uIGdvKGRlbHRhKSB7CiAgICAgICAgICAgICAgICBhY3Rpb24gPSBBY3Rpb24uUG9wOwogICAgICAgICAgICAgICAgaW5kZXggPSBjbGFtcEluZGV4KGluZGV4ICsgZGVsdGEpOwoKICAgICAgICAgICAgICAgIGlmIChsaXN0ZW5lcikgewogICAgICAgICAgICAgICAgICBsaXN0ZW5lcih7CiAgICAgICAgICAgICAgICAgICAgYWN0aW9uOiBhY3Rpb24sCiAgICAgICAgICAgICAgICAgICAgbG9jYXRpb246IGdldEN1cnJlbnRMb2NhdGlvbigpCiAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgIGxpc3RlbjogZnVuY3Rpb24gbGlzdGVuKGZuKSB7CiAgICAgICAgICAgICAgICBsaXN0ZW5lciA9IGZuOwogICAgICAgICAgICAgICAgcmV0dXJuICgpID0+IHsKICAgICAgICAgICAgICAgICAgbGlzdGVuZXIgPSBudWxsOwogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICB9OwogICAgICAgICAgICByZXR1cm4gaGlzdG9yeTsKICAgICAgICAgIH0KICAgICAgICAgIC8qKgogICAgICAgICAgICogQnJvd3NlciBoaXN0b3J5IHN0b3JlcyB0aGUgbG9jYXRpb24gaW4gcmVndWxhciBVUkxzLiBUaGlzIGlzIHRoZSBzdGFuZGFyZCBmb3IKICAgICAgICAgICAqIG1vc3Qgd2ViIGFwcHMsIGJ1dCBpdCByZXF1aXJlcyBzb21lIGNvbmZpZ3VyYXRpb24gb24gdGhlIHNlcnZlciB0byBlbnN1cmUgeW91CiAgICAgICAgICAgKiBzZXJ2ZSB0aGUgc2FtZSBhcHAgYXQgbXVsdGlwbGUgVVJMcy4KICAgICAgICAgICAqCiAgICAgICAgICAgKiBAc2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9yZW1peC1ydW4vaGlzdG9yeS90cmVlL21haW4vZG9jcy9hcGktcmVmZXJlbmNlLm1kI2NyZWF0ZWJyb3dzZXJoaXN0b3J5CiAgICAgICAgICAgKi8KCiAgICAgICAgICBmdW5jdGlvbiByb3V0ZXJfY3JlYXRlQnJvd3Nlckhpc3Rvcnkob3B0aW9ucykgewogICAgICAgICAgICBpZiAob3B0aW9ucyA9PT0gdm9pZCAwKSB7CiAgICAgICAgICAgICAgb3B0aW9ucyA9IHt9OwogICAgICAgICAgICB9CgogICAgICAgICAgICBmdW5jdGlvbiBjcmVhdGVCcm93c2VyTG9jYXRpb24od2luZG93LCBnbG9iYWxIaXN0b3J5KSB7CiAgICAgICAgICAgICAgdmFyIF93aW5kb3ckbG9jYXRpb24gPQoKCgogICAgICAgICAgICAgICAgd2luZG93LmxvY2F0aW9uLHBhdGhuYW1lID0gX3dpbmRvdyRsb2NhdGlvbi5wYXRobmFtZSxzZWFyY2ggPSBfd2luZG93JGxvY2F0aW9uLnNlYXJjaCxoYXNoID0gX3dpbmRvdyRsb2NhdGlvbi5oYXNoOwogICAgICAgICAgICAgIHJldHVybiBjcmVhdGVMb2NhdGlvbigiIiwgewogICAgICAgICAgICAgICAgcGF0aG5hbWU6IHBhdGhuYW1lLAogICAgICAgICAgICAgICAgc2VhcmNoOiBzZWFyY2gsCiAgICAgICAgICAgICAgICBoYXNoOiBoYXNoCiAgICAgICAgICAgICAgfSwgLy8gc3RhdGUgZGVmYXVsdHMgdG8gYG51bGxgIGJlY2F1c2UgYHdpbmRvdy5oaXN0b3J5LnN0YXRlYCBkb2VzCiAgICAgICAgICAgICAgZ2xvYmFsSGlzdG9yeS5zdGF0ZSAmJiBnbG9iYWxIaXN0b3J5LnN0YXRlLnVzciB8fCBudWxsLCBnbG9iYWxIaXN0b3J5LnN0YXRlICYmIGdsb2JhbEhpc3Rvcnkuc3RhdGUua2V5IHx8ICJkZWZhdWx0Iik7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGZ1bmN0aW9uIGNyZWF0ZUJyb3dzZXJIcmVmKHdpbmRvdywgdG8pIHsKICAgICAgICAgICAgICByZXR1cm4gdHlwZW9mIHRvID09PSAic3RyaW5nIiA/IHRvIDogcm91dGVyX2NyZWF0ZVBhdGgodG8pOwogICAgICAgICAgICB9CgogICAgICAgICAgICByZXR1cm4gZ2V0VXJsQmFzZWRIaXN0b3J5KGNyZWF0ZUJyb3dzZXJMb2NhdGlvbiwgY3JlYXRlQnJvd3NlckhyZWYsIG51bGwsIG9wdGlvbnMpOwogICAgICAgICAgfQogICAgICAgICAgLyoqCiAgICAgICAgICAgKiBIYXNoIGhpc3Rvcnkgc3RvcmVzIHRoZSBsb2NhdGlvbiBpbiB3aW5kb3cubG9jYXRpb24uaGFzaC4gVGhpcyBtYWtlcyBpdCBpZGVhbAogICAgICAgICAgICogZm9yIHNpdHVhdGlvbnMgd2hlcmUgeW91IGRvbid0IHdhbnQgdG8gc2VuZCB0aGUgbG9jYXRpb24gdG8gdGhlIHNlcnZlciBmb3IKICAgICAgICAgICAqIHNvbWUgcmVhc29uLCBlaXRoZXIgYmVjYXVzZSB5b3UgZG8gY2Fubm90IGNvbmZpZ3VyZSBpdCBvciB0aGUgVVJMIHNwYWNlIGlzCiAgICAgICAgICAgKiByZXNlcnZlZCBmb3Igc29tZXRoaW5nIGVsc2UuCiAgICAgICAgICAgKgogICAgICAgICAgICogQHNlZSBodHRwczovL2dpdGh1Yi5jb20vcmVtaXgtcnVuL2hpc3RvcnkvdHJlZS9tYWluL2RvY3MvYXBpLXJlZmVyZW5jZS5tZCNjcmVhdGVoYXNoaGlzdG9yeQogICAgICAgICAgICovCgogICAgICAgICAgZnVuY3Rpb24gcm91dGVyX2NyZWF0ZUhhc2hIaXN0b3J5KG9wdGlvbnMpIHsKICAgICAgICAgICAgaWYgKG9wdGlvbnMgPT09IHZvaWQgMCkgewogICAgICAgICAgICAgIG9wdGlvbnMgPSB7fTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgZnVuY3Rpb24gY3JlYXRlSGFzaExvY2F0aW9uKHdpbmRvdywgZ2xvYmFsSGlzdG9yeSkgewogICAgICAgICAgICAgIHZhciBfcGFyc2VQYXRoID0KCgoKICAgICAgICAgICAgICAgIHBhcnNlUGF0aCh3aW5kb3cubG9jYXRpb24uaGFzaC5zdWJzdHIoMSkpLF9wYXJzZVBhdGgkcGF0aG5hbWUgPSBfcGFyc2VQYXRoLnBhdGhuYW1lLHBhdGhuYW1lID0gX3BhcnNlUGF0aCRwYXRobmFtZSA9PT0gdm9pZCAwID8gIi8iIDogX3BhcnNlUGF0aCRwYXRobmFtZSxfcGFyc2VQYXRoJHNlYXJjaCA9IF9wYXJzZVBhdGguc2VhcmNoLHNlYXJjaCA9IF9wYXJzZVBhdGgkc2VhcmNoID09PSB2b2lkIDAgPyAiIiA6IF9wYXJzZVBhdGgkc2VhcmNoLF9wYXJzZVBhdGgkaGFzaCA9IF9wYXJzZVBhdGguaGFzaCxoYXNoID0gX3BhcnNlUGF0aCRoYXNoID09PSB2b2lkIDAgPyAiIiA6IF9wYXJzZVBhdGgkaGFzaDsKICAgICAgICAgICAgICByZXR1cm4gY3JlYXRlTG9jYXRpb24oIiIsIHsKICAgICAgICAgICAgICAgIHBhdGhuYW1lOiBwYXRobmFtZSwKICAgICAgICAgICAgICAgIHNlYXJjaDogc2VhcmNoLAogICAgICAgICAgICAgICAgaGFzaDogaGFzaAogICAgICAgICAgICAgIH0sIC8vIHN0YXRlIGRlZmF1bHRzIHRvIGBudWxsYCBiZWNhdXNlIGB3aW5kb3cuaGlzdG9yeS5zdGF0ZWAgZG9lcwogICAgICAgICAgICAgIGdsb2JhbEhpc3Rvcnkuc3RhdGUgJiYgZ2xvYmFsSGlzdG9yeS5zdGF0ZS51c3IgfHwgbnVsbCwgZ2xvYmFsSGlzdG9yeS5zdGF0ZSAmJiBnbG9iYWxIaXN0b3J5LnN0YXRlLmtleSB8fCAiZGVmYXVsdCIpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBmdW5jdGlvbiBjcmVhdGVIYXNoSHJlZih3aW5kb3csIHRvKSB7CiAgICAgICAgICAgICAgdmFyIGJhc2UgPSB3aW5kb3cuZG9jdW1lbnQucXVlcnlTZWxlY3RvcigiYmFzZSIpOwogICAgICAgICAgICAgIHZhciBocmVmID0gIiI7CgogICAgICAgICAgICAgIGlmIChiYXNlICYmIGJhc2UuZ2V0QXR0cmlidXRlKCJocmVmIikpIHsKICAgICAgICAgICAgICAgIHZhciB1cmwgPSB3aW5kb3cubG9jYXRpb24uaHJlZjsKICAgICAgICAgICAgICAgIHZhciBoYXNoSW5kZXggPSB1cmwuaW5kZXhPZigiIyIpOwogICAgICAgICAgICAgICAgaHJlZiA9IGhhc2hJbmRleCA9PT0gLTEgPyB1cmwgOiB1cmwuc2xpY2UoMCwgaGFzaEluZGV4KTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIHJldHVybiBocmVmICsgIiMiICsgKHR5cGVvZiB0byA9PT0gInN0cmluZyIgPyB0byA6IHJvdXRlcl9jcmVhdGVQYXRoKHRvKSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGZ1bmN0aW9uIHZhbGlkYXRlSGFzaExvY2F0aW9uKGxvY2F0aW9uLCB0bykgewogICAgICAgICAgICAgIHdhcm5pbmckMShsb2NhdGlvbi5wYXRobmFtZS5jaGFyQXQoMCkgPT09ICIvIiwgInJlbGF0aXZlIHBhdGhuYW1lcyBhcmUgbm90IHN1cHBvcnRlZCBpbiBoYXNoIGhpc3RvcnkucHVzaCgiICsgSlNPTi5zdHJpbmdpZnkodG8pICsgIikiKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuIGdldFVybEJhc2VkSGlzdG9yeShjcmVhdGVIYXNoTG9jYXRpb24sIGNyZWF0ZUhhc2hIcmVmLCB2YWxpZGF0ZUhhc2hMb2NhdGlvbiwgb3B0aW9ucyk7CiAgICAgICAgICB9IC8vI2VuZHJlZ2lvbgogICAgICAgICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KICAgICAgICAgIC8vI3JlZ2lvbiBVVElMUwogICAgICAgICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KCiAgICAgICAgICBmdW5jdGlvbiB3YXJuaW5nJDEoY29uZCwgbWVzc2FnZSkgewogICAgICAgICAgICBpZiAoIWNvbmQpIHsKICAgICAgICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tY29uc29sZQogICAgICAgICAgICAgIGlmICh0eXBlb2YgY29uc29sZSAhPT0gInVuZGVmaW5lZCIpIGNvbnNvbGUud2FybihtZXNzYWdlKTsKCiAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIC8vIFdlbGNvbWUgdG8gZGVidWdnaW5nIGhpc3RvcnkhCiAgICAgICAgICAgICAgICAvLwogICAgICAgICAgICAgICAgLy8gVGhpcyBlcnJvciBpcyB0aHJvd24gYXMgYSBjb252ZW5pZW5jZSBzbyB5b3UgY2FuIG1vcmUgZWFzaWx5CiAgICAgICAgICAgICAgICAvLyBmaW5kIHRoZSBzb3VyY2UgZm9yIGEgd2FybmluZyB0aGF0IGFwcGVhcnMgaW4gdGhlIGNvbnNvbGUgYnkKICAgICAgICAgICAgICAgIC8vIGVuYWJsaW5nICJwYXVzZSBvbiBleGNlcHRpb25zIiBpbiB5b3VyIEphdmFTY3JpcHQgZGVidWdnZXIuCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IobWVzc2FnZSk7IC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBuby1lbXB0eQogICAgICAgICAgICAgIH0gY2F0Y2ggKGUpIHt9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KCiAgICAgICAgICBmdW5jdGlvbiBjcmVhdGVLZXkoKSB7CiAgICAgICAgICAgIHJldHVybiBNYXRoLnJhbmRvbSgpLnRvU3RyaW5nKDM2KS5zdWJzdHIoMiwgOCk7CiAgICAgICAgICB9CiAgICAgICAgICAvKioKICAgICAgICAgICAqIEZvciBicm93c2VyLWJhc2VkIGhpc3Rvcmllcywgd2UgY29tYmluZSB0aGUgc3RhdGUgYW5kIGtleSBpbnRvIGFuIG9iamVjdAogICAgICAgICAgICovCgoKICAgICAgICAgIGZ1bmN0aW9uIGdldEhpc3RvcnlTdGF0ZShsb2NhdGlvbikgewogICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgIHVzcjogbG9jYXRpb24uc3RhdGUsCiAgICAgICAgICAgICAga2V5OiBsb2NhdGlvbi5rZXkKICAgICAgICAgICAgfTsKICAgICAgICAgIH0KICAgICAgICAgIC8qKgogICAgICAgICAgICogQ3JlYXRlcyBhIExvY2F0aW9uIG9iamVjdCB3aXRoIGEgdW5pcXVlIGtleSBmcm9tIHRoZSBnaXZlbiBQYXRoCiAgICAgICAgICAgKi8KCgogICAgICAgICAgZnVuY3Rpb24gY3JlYXRlTG9jYXRpb24oY3VycmVudCwgdG8sIHN0YXRlLCBrZXkpIHsKICAgICAgICAgICAgaWYgKHN0YXRlID09PSB2b2lkIDApIHsKICAgICAgICAgICAgICBzdGF0ZSA9IG51bGw7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHZhciBsb2NhdGlvbiA9IF9leHRlbmRzKHsKICAgICAgICAgICAgICBwYXRobmFtZTogdHlwZW9mIGN1cnJlbnQgPT09ICJzdHJpbmciID8gY3VycmVudCA6IGN1cnJlbnQucGF0aG5hbWUsCiAgICAgICAgICAgICAgc2VhcmNoOiAiIiwKICAgICAgICAgICAgICBoYXNoOiAiIgogICAgICAgICAgICB9LCB0eXBlb2YgdG8gPT09ICJzdHJpbmciID8gcGFyc2VQYXRoKHRvKSA6IHRvLCB7CiAgICAgICAgICAgICAgc3RhdGU6IHN0YXRlLAogICAgICAgICAgICAgIC8vIFRPRE86IFRoaXMgY291bGQgYmUgY2xlYW5lZCB1cC4gIHB1c2gvcmVwbGFjZSBzaG91bGQgcHJvYmFibHkganVzdCB0YWtlCiAgICAgICAgICAgICAgLy8gZnVsbCBMb2NhdGlvbnMgbm93IGFuZCBhdm9pZCB0aGUgbmVlZCB0byBydW4gdGhyb3VnaCB0aGlzIGZsb3cgYXQgYWxsCiAgICAgICAgICAgICAgLy8gQnV0IHRoYXQncyBhIHByZXR0eSBiaWcgcmVmYWN0b3IgdG8gdGhlIGN1cnJlbnQgdGVzdCBzdWl0ZSBzbyBnb2luZyB0bwogICAgICAgICAgICAgIC8vIGtlZXAgYXMgaXMgZm9yIHRoZSB0aW1lIGJlaW5nIGFuZCBqdXN0IGxldCBhbnkgaW5jb21pbmcga2V5cyB0YWtlIHByZWNlZGVuY2UKICAgICAgICAgICAgICBrZXk6IHRvICYmIHRvLmtleSB8fCBrZXkgfHwgY3JlYXRlS2V5KCkKICAgICAgICAgICAgfSk7CgogICAgICAgICAgICByZXR1cm4gbG9jYXRpb247CiAgICAgICAgICB9CiAgICAgICAgICAvKioKICAgICAgICAgICAqIENyZWF0ZXMgYSBzdHJpbmcgVVJMIHBhdGggZnJvbSB0aGUgZ2l2ZW4gcGF0aG5hbWUsIHNlYXJjaCwgYW5kIGhhc2ggY29tcG9uZW50cy4KICAgICAgICAgICAqLwoKICAgICAgICAgIGZ1bmN0aW9uIHJvdXRlcl9jcmVhdGVQYXRoKF9yZWYpIHsKICAgICAgICAgICAgdmFyIF9yZWYkcGF0aG5hbWUgPQoKCgogICAgICAgICAgICAgIF9yZWYucGF0aG5hbWUscGF0aG5hbWUgPSBfcmVmJHBhdGhuYW1lID09PSB2b2lkIDAgPyAiLyIgOiBfcmVmJHBhdGhuYW1lLF9yZWYkc2VhcmNoID0gX3JlZi5zZWFyY2gsc2VhcmNoID0gX3JlZiRzZWFyY2ggPT09IHZvaWQgMCA/ICIiIDogX3JlZiRzZWFyY2gsX3JlZiRoYXNoID0gX3JlZi5oYXNoLGhhc2ggPSBfcmVmJGhhc2ggPT09IHZvaWQgMCA/ICIiIDogX3JlZiRoYXNoOwogICAgICAgICAgICBpZiAoc2VhcmNoICYmIHNlYXJjaCAhPT0gIj8iKSBwYXRobmFtZSArPSBzZWFyY2guY2hhckF0KDApID09PSAiPyIgPyBzZWFyY2ggOiAiPyIgKyBzZWFyY2g7CiAgICAgICAgICAgIGlmIChoYXNoICYmIGhhc2ggIT09ICIjIikgcGF0aG5hbWUgKz0gaGFzaC5jaGFyQXQoMCkgPT09ICIjIiA/IGhhc2ggOiAiIyIgKyBoYXNoOwogICAgICAgICAgICByZXR1cm4gcGF0aG5hbWU7CiAgICAgICAgICB9CiAgICAgICAgICAvKioKICAgICAgICAgICAqIFBhcnNlcyBhIHN0cmluZyBVUkwgcGF0aCBpbnRvIGl0cyBzZXBhcmF0ZSBwYXRobmFtZSwgc2VhcmNoLCBhbmQgaGFzaCBjb21wb25lbnRzLgogICAgICAgICAgICovCgogICAgICAgICAgZnVuY3Rpb24gcGFyc2VQYXRoKHBhdGgpIHsKICAgICAgICAgICAgdmFyIHBhcnNlZFBhdGggPSB7fTsKCiAgICAgICAgICAgIGlmIChwYXRoKSB7CiAgICAgICAgICAgICAgdmFyIGhhc2hJbmRleCA9IHBhdGguaW5kZXhPZigiIyIpOwoKICAgICAgICAgICAgICBpZiAoaGFzaEluZGV4ID49IDApIHsKICAgICAgICAgICAgICAgIHBhcnNlZFBhdGguaGFzaCA9IHBhdGguc3Vic3RyKGhhc2hJbmRleCk7CiAgICAgICAgICAgICAgICBwYXRoID0gcGF0aC5zdWJzdHIoMCwgaGFzaEluZGV4KTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIHZhciBzZWFyY2hJbmRleCA9IHBhdGguaW5kZXhPZigiPyIpOwoKICAgICAgICAgICAgICBpZiAoc2VhcmNoSW5kZXggPj0gMCkgewogICAgICAgICAgICAgICAgcGFyc2VkUGF0aC5zZWFyY2ggPSBwYXRoLnN1YnN0cihzZWFyY2hJbmRleCk7CiAgICAgICAgICAgICAgICBwYXRoID0gcGF0aC5zdWJzdHIoMCwgc2VhcmNoSW5kZXgpOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgaWYgKHBhdGgpIHsKICAgICAgICAgICAgICAgIHBhcnNlZFBhdGgucGF0aG5hbWUgPSBwYXRoOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuIHBhcnNlZFBhdGg7CiAgICAgICAgICB9CiAgICAgICAgICBmdW5jdGlvbiBjcmVhdGVVUkwobG9jYXRpb24pIHsKICAgICAgICAgICAgLy8gd2luZG93LmxvY2F0aW9uLm9yaWdpbiBpcyAibnVsbCIgKHRoZSBsaXRlcmFsIHN0cmluZyB2YWx1ZSkgaW4gRmlyZWZveAogICAgICAgICAgICAvLyB1bmRlciBjZXJ0YWluIGNvbmRpdGlvbnMsIG5vdGFibHkgd2hlbiBzZXJ2aW5nIGZyb20gYSBsb2NhbCBIVE1MIGZpbGUKICAgICAgICAgICAgLy8gU2VlIGh0dHBzOi8vYnVnemlsbGEubW96aWxsYS5vcmcvc2hvd19idWcuY2dpP2lkPTg3ODI5NwogICAgICAgICAgICB2YXIgYmFzZSA9IHR5cGVvZiB3aW5kb3cgIT09ICJ1bmRlZmluZWQiICYmIHR5cGVvZiB3aW5kb3cubG9jYXRpb24gIT09ICJ1bmRlZmluZWQiICYmIHdpbmRvdy5sb2NhdGlvbi5vcmlnaW4gIT09ICJudWxsIiA/IHdpbmRvdy5sb2NhdGlvbi5vcmlnaW4gOiAidW5rbm93bjovL3Vua25vd24iOwogICAgICAgICAgICB2YXIgaHJlZiA9IHR5cGVvZiBsb2NhdGlvbiA9PT0gInN0cmluZyIgPyBsb2NhdGlvbiA6IHJvdXRlcl9jcmVhdGVQYXRoKGxvY2F0aW9uKTsKICAgICAgICAgICAgcmV0dXJuIG5ldyBVUkwoaHJlZiwgYmFzZSk7CiAgICAgICAgICB9CgogICAgICAgICAgZnVuY3Rpb24gZ2V0VXJsQmFzZWRIaXN0b3J5KGdldExvY2F0aW9uLCBfY3JlYXRlSHJlZiwgdmFsaWRhdGVMb2NhdGlvbiwgb3B0aW9ucykgewogICAgICAgICAgICBpZiAob3B0aW9ucyA9PT0gdm9pZCAwKSB7CiAgICAgICAgICAgICAgb3B0aW9ucyA9IHt9OwogICAgICAgICAgICB9CgogICAgICAgICAgICB2YXIgX29wdGlvbnMyID0KCgogICAgICAgICAgICAgIG9wdGlvbnMsX29wdGlvbnMyJHdpbmRvdyA9IF9vcHRpb25zMi53aW5kb3csd2luZG93ID0gX29wdGlvbnMyJHdpbmRvdyA9PT0gdm9pZCAwID8gZG9jdW1lbnQuZGVmYXVsdFZpZXcgOiBfb3B0aW9uczIkd2luZG93LF9vcHRpb25zMiR2NUNvbXBhdCA9IF9vcHRpb25zMi52NUNvbXBhdCx2NUNvbXBhdCA9IF9vcHRpb25zMiR2NUNvbXBhdCA9PT0gdm9pZCAwID8gZmFsc2UgOiBfb3B0aW9uczIkdjVDb21wYXQ7CiAgICAgICAgICAgIHZhciBnbG9iYWxIaXN0b3J5ID0gd2luZG93Lmhpc3Rvcnk7CiAgICAgICAgICAgIHZhciBhY3Rpb24gPSBBY3Rpb24uUG9wOwogICAgICAgICAgICB2YXIgbGlzdGVuZXIgPSBudWxsOwoKICAgICAgICAgICAgZnVuY3Rpb24gaGFuZGxlUG9wKCkgewogICAgICAgICAgICAgIGFjdGlvbiA9IEFjdGlvbi5Qb3A7CgogICAgICAgICAgICAgIGlmIChsaXN0ZW5lcikgewogICAgICAgICAgICAgICAgbGlzdGVuZXIoewogICAgICAgICAgICAgICAgICBhY3Rpb246IGFjdGlvbiwKICAgICAgICAgICAgICAgICAgbG9jYXRpb246IGhpc3RvcnkubG9jYXRpb24KICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgZnVuY3Rpb24gcHVzaCh0bywgc3RhdGUpIHsKICAgICAgICAgICAgICBhY3Rpb24gPSBBY3Rpb24uUHVzaDsKICAgICAgICAgICAgICB2YXIgbG9jYXRpb24gPSBjcmVhdGVMb2NhdGlvbihoaXN0b3J5LmxvY2F0aW9uLCB0bywgc3RhdGUpOwogICAgICAgICAgICAgIGlmICh2YWxpZGF0ZUxvY2F0aW9uKSB2YWxpZGF0ZUxvY2F0aW9uKGxvY2F0aW9uLCB0byk7CiAgICAgICAgICAgICAgdmFyIGhpc3RvcnlTdGF0ZSA9IGdldEhpc3RvcnlTdGF0ZShsb2NhdGlvbik7CiAgICAgICAgICAgICAgdmFyIHVybCA9IGhpc3RvcnkuY3JlYXRlSHJlZihsb2NhdGlvbik7IC8vIHRyeS4uLmNhdGNoIGJlY2F1c2UgaU9TIGxpbWl0cyB1cyB0byAxMDAgcHVzaFN0YXRlIGNhbGxzIDovCgogICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICBnbG9iYWxIaXN0b3J5LnB1c2hTdGF0ZShoaXN0b3J5U3RhdGUsICIiLCB1cmwpOwogICAgICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgICAgICAgICAvLyBUaGV5IGFyZSBnb2luZyB0byBsb3NlIHN0YXRlIGhlcmUsIGJ1dCB0aGVyZSBpcyBubyByZWFsCiAgICAgICAgICAgICAgICAvLyB3YXkgdG8gd2FybiB0aGVtIGFib3V0IGl0IHNpbmNlIHRoZSBwYWdlIHdpbGwgcmVmcmVzaC4uLgogICAgICAgICAgICAgICAgd2luZG93LmxvY2F0aW9uLmFzc2lnbih1cmwpOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgaWYgKHY1Q29tcGF0ICYmIGxpc3RlbmVyKSB7CiAgICAgICAgICAgICAgICBsaXN0ZW5lcih7CiAgICAgICAgICAgICAgICAgIGFjdGlvbjogYWN0aW9uLAogICAgICAgICAgICAgICAgICBsb2NhdGlvbjogaGlzdG9yeS5sb2NhdGlvbgogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICBmdW5jdGlvbiByZXBsYWNlKHRvLCBzdGF0ZSkgewogICAgICAgICAgICAgIGFjdGlvbiA9IEFjdGlvbi5SZXBsYWNlOwogICAgICAgICAgICAgIHZhciBsb2NhdGlvbiA9IGNyZWF0ZUxvY2F0aW9uKGhpc3RvcnkubG9jYXRpb24sIHRvLCBzdGF0ZSk7CiAgICAgICAgICAgICAgaWYgKHZhbGlkYXRlTG9jYXRpb24pIHZhbGlkYXRlTG9jYXRpb24obG9jYXRpb24sIHRvKTsKICAgICAgICAgICAgICB2YXIgaGlzdG9yeVN0YXRlID0gZ2V0SGlzdG9yeVN0YXRlKGxvY2F0aW9uKTsKICAgICAgICAgICAgICB2YXIgdXJsID0gaGlzdG9yeS5jcmVhdGVIcmVmKGxvY2F0aW9uKTsKICAgICAgICAgICAgICBnbG9iYWxIaXN0b3J5LnJlcGxhY2VTdGF0ZShoaXN0b3J5U3RhdGUsICIiLCB1cmwpOwoKICAgICAgICAgICAgICBpZiAodjVDb21wYXQgJiYgbGlzdGVuZXIpIHsKICAgICAgICAgICAgICAgIGxpc3RlbmVyKHsKICAgICAgICAgICAgICAgICAgYWN0aW9uOiBhY3Rpb24sCiAgICAgICAgICAgICAgICAgIGxvY2F0aW9uOiBoaXN0b3J5LmxvY2F0aW9uCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHZhciBoaXN0b3J5ID0gewogICAgICAgICAgICAgIGdldCBhY3Rpb24oKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gYWN0aW9uOwogICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgIGdldCBsb2NhdGlvbigpIHsKICAgICAgICAgICAgICAgIHJldHVybiBnZXRMb2NhdGlvbih3aW5kb3csIGdsb2JhbEhpc3RvcnkpOwogICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgIGxpc3RlbjogZnVuY3Rpb24gbGlzdGVuKGZuKSB7CiAgICAgICAgICAgICAgICBpZiAobGlzdGVuZXIpIHsKICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJBIGhpc3Rvcnkgb25seSBhY2NlcHRzIG9uZSBhY3RpdmUgbGlzdGVuZXIiKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcihQb3BTdGF0ZUV2ZW50VHlwZSwgaGFuZGxlUG9wKTsKICAgICAgICAgICAgICAgIGxpc3RlbmVyID0gZm47CiAgICAgICAgICAgICAgICByZXR1cm4gKCkgPT4gewogICAgICAgICAgICAgICAgICB3aW5kb3cucmVtb3ZlRXZlbnRMaXN0ZW5lcihQb3BTdGF0ZUV2ZW50VHlwZSwgaGFuZGxlUG9wKTsKICAgICAgICAgICAgICAgICAgbGlzdGVuZXIgPSBudWxsOwogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICBjcmVhdGVIcmVmOiBmdW5jdGlvbiBjcmVhdGVIcmVmKHRvKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gX2NyZWF0ZUhyZWYod2luZG93LCB0byk7CiAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgZW5jb2RlTG9jYXRpb246IGZ1bmN0aW9uIGVuY29kZUxvY2F0aW9uKGxvY2F0aW9uKSB7CiAgICAgICAgICAgICAgICAvLyBFbmNvZGUgYSBMb2NhdGlvbiB0aGUgc2FtZSB3YXkgd2luZG93LmxvY2F0aW9uIHdvdWxkCiAgICAgICAgICAgICAgICB2YXIgdXJsID0gY3JlYXRlVVJMKHJvdXRlcl9jcmVhdGVQYXRoKGxvY2F0aW9uKSk7CiAgICAgICAgICAgICAgICByZXR1cm4gX2V4dGVuZHMoe30sIGxvY2F0aW9uLCB7CiAgICAgICAgICAgICAgICAgIHBhdGhuYW1lOiB1cmwucGF0aG5hbWUsCiAgICAgICAgICAgICAgICAgIHNlYXJjaDogdXJsLnNlYXJjaCwKICAgICAgICAgICAgICAgICAgaGFzaDogdXJsLmhhc2gKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgIHB1c2g6IHB1c2gsCiAgICAgICAgICAgICAgcmVwbGFjZTogcmVwbGFjZSwKCiAgICAgICAgICAgICAgZ286IGZ1bmN0aW9uIGdvKG4pIHsKICAgICAgICAgICAgICAgIHJldHVybiBnbG9iYWxIaXN0b3J5LmdvKG4pOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgIH07CiAgICAgICAgICAgIHJldHVybiBoaXN0b3J5OwogICAgICAgICAgfSAvLyNlbmRyZWdpb24KCiAgICAgICAgICB2YXIgUmVzdWx0VHlwZTsKCiAgICAgICAgICAoZnVuY3Rpb24gKFJlc3VsdFR5cGUpIHsKICAgICAgICAgICAgUmVzdWx0VHlwZVsiZGF0YSJdID0gImRhdGEiOwogICAgICAgICAgICBSZXN1bHRUeXBlWyJkZWZlcnJlZCJdID0gImRlZmVycmVkIjsKICAgICAgICAgICAgUmVzdWx0VHlwZVsicmVkaXJlY3QiXSA9ICJyZWRpcmVjdCI7CiAgICAgICAgICAgIFJlc3VsdFR5cGVbImVycm9yIl0gPSAiZXJyb3IiOwogICAgICAgICAgfSkoUmVzdWx0VHlwZSB8fCAoUmVzdWx0VHlwZSA9IHt9KSk7CgogICAgICAgICAgZnVuY3Rpb24gaXNJbmRleFJvdXRlKHJvdXRlKSB7CiAgICAgICAgICAgIHJldHVybiByb3V0ZS5pbmRleCA9PT0gdHJ1ZTsKICAgICAgICAgIH0gLy8gV2FsayB0aGUgcm91dGUgdHJlZSBnZW5lcmF0aW5nIHVuaXF1ZSBJRHMgd2hlcmUgbmVjZXNzYXJ5IHNvIHdlIGFyZSB3b3JraW5nCiAgICAgICAgICAvLyBzb2xlbHkgd2l0aCBBZ25vc3RpY0RhdGFSb3V0ZU9iamVjdCdzIHdpdGhpbiB0aGUgUm91dGVyCgoKICAgICAgICAgIGZ1bmN0aW9uIGNvbnZlcnRSb3V0ZXNUb0RhdGFSb3V0ZXMocm91dGVzLCBwYXJlbnRQYXRoLCBhbGxJZHMpIHsKICAgICAgICAgICAgaWYgKHBhcmVudFBhdGggPT09IHZvaWQgMCkgewogICAgICAgICAgICAgIHBhcmVudFBhdGggPSBbXTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKGFsbElkcyA9PT0gdm9pZCAwKSB7CiAgICAgICAgICAgICAgYWxsSWRzID0gbmV3IFNldCgpOwogICAgICAgICAgICB9CgogICAgICAgICAgICByZXR1cm4gcm91dGVzLm1hcCgocm91dGUsIGluZGV4KSA9PiB7CiAgICAgICAgICAgICAgdmFyIHRyZWVQYXRoID0gW10uY29uY2F0KF90b0NvbnN1bWFibGVBcnJheTIocGFyZW50UGF0aCksIFtpbmRleF0pOwogICAgICAgICAgICAgIHZhciBpZCA9IHR5cGVvZiByb3V0ZS5pZCA9PT0gInN0cmluZyIgPyByb3V0ZS5pZCA6IHRyZWVQYXRoLmpvaW4oIi0iKTsKICAgICAgICAgICAgICByb3V0ZXJfaW52YXJpYW50KHJvdXRlLmluZGV4ICE9PSB0cnVlIHx8ICFyb3V0ZS5jaGlsZHJlbiwgIkNhbm5vdCBzcGVjaWZ5IGNoaWxkcmVuIG9uIGFuIGluZGV4IHJvdXRlIik7CiAgICAgICAgICAgICAgcm91dGVyX2ludmFyaWFudCghYWxsSWRzLmhhcyhpZCksICJGb3VuZCBhIHJvdXRlIGlkIGNvbGxpc2lvbiBvbiBpZCBcIiIgKyBpZCArICJcIi4gIFJvdXRlICIgKyAiaWQncyBtdXN0IGJlIGdsb2JhbGx5IHVuaXF1ZSB3aXRoaW4gRGF0YSBSb3V0ZXIgdXNhZ2VzIik7CiAgICAgICAgICAgICAgYWxsSWRzLmFkZChpZCk7CgogICAgICAgICAgICAgIGlmIChpc0luZGV4Um91dGUocm91dGUpKSB7CiAgICAgICAgICAgICAgICB2YXIgaW5kZXhSb3V0ZSA9IF9leHRlbmRzKHt9LCByb3V0ZSwgewogICAgICAgICAgICAgICAgICBpZDogaWQKICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICAgIHJldHVybiBpbmRleFJvdXRlOwogICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICB2YXIgcGF0aE9yTGF5b3V0Um91dGUgPSBfZXh0ZW5kcyh7fSwgcm91dGUsIHsKICAgICAgICAgICAgICAgICAgaWQ6IGlkLAogICAgICAgICAgICAgICAgICBjaGlsZHJlbjogcm91dGUuY2hpbGRyZW4gPyBjb252ZXJ0Um91dGVzVG9EYXRhUm91dGVzKHJvdXRlLmNoaWxkcmVuLCB0cmVlUGF0aCwgYWxsSWRzKSA6IHVuZGVmaW5lZAogICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgICAgcmV0dXJuIHBhdGhPckxheW91dFJvdXRlOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgICB9CiAgICAgICAgICAvKioKICAgICAgICAgICAqIE1hdGNoZXMgdGhlIGdpdmVuIHJvdXRlcyB0byBhIGxvY2F0aW9uIGFuZCByZXR1cm5zIHRoZSBtYXRjaCBkYXRhLgogICAgICAgICAgICoKICAgICAgICAgICAqIEBzZWUgaHR0cHM6Ly9yZWFjdHJvdXRlci5jb20vZG9jcy9lbi92Ni91dGlscy9tYXRjaC1yb3V0ZXMKICAgICAgICAgICAqLwoKICAgICAgICAgIGZ1bmN0aW9uIG1hdGNoUm91dGVzKHJvdXRlcywgbG9jYXRpb25BcmcsIGJhc2VuYW1lKSB7CiAgICAgICAgICAgIGlmIChiYXNlbmFtZSA9PT0gdm9pZCAwKSB7CiAgICAgICAgICAgICAgYmFzZW5hbWUgPSAiLyI7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHZhciBsb2NhdGlvbiA9IHR5cGVvZiBsb2NhdGlvbkFyZyA9PT0gInN0cmluZyIgPyBwYXJzZVBhdGgobG9jYXRpb25BcmcpIDogbG9jYXRpb25Bcmc7CiAgICAgICAgICAgIHZhciBwYXRobmFtZSA9IHN0cmlwQmFzZW5hbWUobG9jYXRpb24ucGF0aG5hbWUgfHwgIi8iLCBiYXNlbmFtZSk7CgogICAgICAgICAgICBpZiAocGF0aG5hbWUgPT0gbnVsbCkgewogICAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgICAgICB9CgogICAgICAgICAgICB2YXIgYnJhbmNoZXMgPSBmbGF0dGVuUm91dGVzKHJvdXRlcyk7CiAgICAgICAgICAgIHJhbmtSb3V0ZUJyYW5jaGVzKGJyYW5jaGVzKTsKICAgICAgICAgICAgdmFyIG1hdGNoZXMgPSBudWxsOwoKICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IG1hdGNoZXMgPT0gbnVsbCAmJiBpIDwgYnJhbmNoZXMubGVuZ3RoOyArK2kpIHsKICAgICAgICAgICAgICBtYXRjaGVzID0gbWF0Y2hSb3V0ZUJyYW5jaChicmFuY2hlc1tpXSwgLy8gSW5jb21pbmcgcGF0aG5hbWVzIGFyZSBnZW5lcmFsbHkgZW5jb2RlZCBmcm9tIGVpdGhlciB3aW5kb3cubG9jYXRpb24KICAgICAgICAgICAgICAvLyBvciBmcm9tIHJvdXRlci5uYXZpZ2F0ZSwgYnV0IHdlIHdhbnQgdG8gbWF0Y2ggYWdhaW5zdCB0aGUgdW5lbmNvZGVkCiAgICAgICAgICAgICAgLy8gcGF0aHMgaW4gdGhlIHJvdXRlIGRlZmluaXRpb25zLiAgTWVtb3J5IHJvdXRlciBsb2NhdGlvbnMgd29uJ3QgYmUKICAgICAgICAgICAgICAvLyBlbmNvZGVkIGhlcmUgYnV0IHRoZXJlIGFsc28gc2hvdWxkbid0IGJlIGFueXRoaW5nIHRvIGRlY29kZSBzbyB0aGlzCiAgICAgICAgICAgICAgLy8gc2hvdWxkIGJlIGEgc2FmZSBvcGVyYXRpb24uICBUaGlzIGF2b2lkcyBuZWVkaW5nIG1hdGNoUm91dGVzIHRvIGJlCiAgICAgICAgICAgICAgLy8gaGlzdG9yeS1hd2FyZS4KICAgICAgICAgICAgICBzYWZlbHlEZWNvZGVVUkkocGF0aG5hbWUpKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuIG1hdGNoZXM7CiAgICAgICAgICB9CgogICAgICAgICAgZnVuY3Rpb24gZmxhdHRlblJvdXRlcyhyb3V0ZXMsIGJyYW5jaGVzLCBwYXJlbnRzTWV0YSwgcGFyZW50UGF0aCkgewogICAgICAgICAgICBpZiAoYnJhbmNoZXMgPT09IHZvaWQgMCkgewogICAgICAgICAgICAgIGJyYW5jaGVzID0gW107CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChwYXJlbnRzTWV0YSA9PT0gdm9pZCAwKSB7CiAgICAgICAgICAgICAgcGFyZW50c01ldGEgPSBbXTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKHBhcmVudFBhdGggPT09IHZvaWQgMCkgewogICAgICAgICAgICAgIHBhcmVudFBhdGggPSAiIjsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcm91dGVzLmZvckVhY2goKHJvdXRlLCBpbmRleCkgPT4gewogICAgICAgICAgICAgIHZhciBtZXRhID0gewogICAgICAgICAgICAgICAgcmVsYXRpdmVQYXRoOiByb3V0ZS5wYXRoIHx8ICIiLAogICAgICAgICAgICAgICAgY2FzZVNlbnNpdGl2ZTogcm91dGUuY2FzZVNlbnNpdGl2ZSA9PT0gdHJ1ZSwKICAgICAgICAgICAgICAgIGNoaWxkcmVuSW5kZXg6IGluZGV4LAogICAgICAgICAgICAgICAgcm91dGU6IHJvdXRlCiAgICAgICAgICAgICAgfTsKCiAgICAgICAgICAgICAgaWYgKG1ldGEucmVsYXRpdmVQYXRoLnN0YXJ0c1dpdGgoIi8iKSkgewogICAgICAgICAgICAgICAgcm91dGVyX2ludmFyaWFudChtZXRhLnJlbGF0aXZlUGF0aC5zdGFydHNXaXRoKHBhcmVudFBhdGgpLCAiQWJzb2x1dGUgcm91dGUgcGF0aCBcIiIgKyBtZXRhLnJlbGF0aXZlUGF0aCArICJcIiBuZXN0ZWQgdW5kZXIgcGF0aCAiICsgKCJcIiIgKyBwYXJlbnRQYXRoICsgIlwiIGlzIG5vdCB2YWxpZC4gQW4gYWJzb2x1dGUgY2hpbGQgcm91dGUgcGF0aCAiKSArICJtdXN0IHN0YXJ0IHdpdGggdGhlIGNvbWJpbmVkIHBhdGggb2YgYWxsIGl0cyBwYXJlbnQgcm91dGVzLiIpOwogICAgICAgICAgICAgICAgbWV0YS5yZWxhdGl2ZVBhdGggPSBtZXRhLnJlbGF0aXZlUGF0aC5zbGljZShwYXJlbnRQYXRoLmxlbmd0aCk7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICB2YXIgcGF0aCA9IHJvdXRlcl9qb2luUGF0aHMoW3BhcmVudFBhdGgsIG1ldGEucmVsYXRpdmVQYXRoXSk7CiAgICAgICAgICAgICAgdmFyIHJvdXRlc01ldGEgPSBwYXJlbnRzTWV0YS5jb25jYXQobWV0YSk7IC8vIEFkZCB0aGUgY2hpbGRyZW4gYmVmb3JlIGFkZGluZyB0aGlzIHJvdXRlIHRvIHRoZSBhcnJheSBzbyB3ZSB0cmF2ZXJzZSB0aGUKICAgICAgICAgICAgICAvLyByb3V0ZSB0cmVlIGRlcHRoLWZpcnN0IGFuZCBjaGlsZCByb3V0ZXMgYXBwZWFyIGJlZm9yZSB0aGVpciBwYXJlbnRzIGluCiAgICAgICAgICAgICAgLy8gdGhlICJmbGF0dGVuZWQiIHZlcnNpb24uCgogICAgICAgICAgICAgIGlmIChyb3V0ZS5jaGlsZHJlbiAmJiByb3V0ZS5jaGlsZHJlbi5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgICAgICByb3V0ZXJfaW52YXJpYW50KCAvLyBPdXIgdHlwZXMga25vdyBiZXR0ZXIsIGJ1dCBydW50aW1lIEpTIG1heSBub3QhCiAgICAgICAgICAgICAgICAvLyBAdHMtZXhwZWN0LWVycm9yCiAgICAgICAgICAgICAgICByb3V0ZS5pbmRleCAhPT0gdHJ1ZSwgIkluZGV4IHJvdXRlcyBtdXN0IG5vdCBoYXZlIGNoaWxkIHJvdXRlcy4gUGxlYXNlIHJlbW92ZSAiICsgKCJhbGwgY2hpbGQgcm91dGVzIGZyb20gcm91dGUgcGF0aCBcIiIgKyBwYXRoICsgIlwiLiIpKTsKICAgICAgICAgICAgICAgIGZsYXR0ZW5Sb3V0ZXMocm91dGUuY2hpbGRyZW4sIGJyYW5jaGVzLCByb3V0ZXNNZXRhLCBwYXRoKTsKICAgICAgICAgICAgICB9IC8vIFJvdXRlcyB3aXRob3V0IGEgcGF0aCBzaG91bGRuJ3QgZXZlciBtYXRjaCBieSB0aGVtc2VsdmVzIHVubGVzcyB0aGV5IGFyZQogICAgICAgICAgICAgIC8vIGluZGV4IHJvdXRlcywgc28gZG9uJ3QgYWRkIHRoZW0gdG8gdGhlIGxpc3Qgb2YgcG9zc2libGUgYnJhbmNoZXMuCgoKICAgICAgICAgICAgICBpZiAocm91dGUucGF0aCA9PSBudWxsICYmICFyb3V0ZS5pbmRleCkgewogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgYnJhbmNoZXMucHVzaCh7CiAgICAgICAgICAgICAgICBwYXRoOiBwYXRoLAogICAgICAgICAgICAgICAgc2NvcmU6IGNvbXB1dGVTY29yZShwYXRoLCByb3V0ZS5pbmRleCksCiAgICAgICAgICAgICAgICByb3V0ZXNNZXRhOiByb3V0ZXNNZXRhCiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICByZXR1cm4gYnJhbmNoZXM7CiAgICAgICAgICB9CgogICAgICAgICAgZnVuY3Rpb24gcmFua1JvdXRlQnJhbmNoZXMoYnJhbmNoZXMpIHsKICAgICAgICAgICAgYnJhbmNoZXMuc29ydCgoYSwgYikgPT4gYS5zY29yZSAhPT0gYi5zY29yZSA/IGIuc2NvcmUgLSBhLnNjb3JlIC8vIEhpZ2hlciBzY29yZSBmaXJzdAogICAgICAgICAgICA6IGNvbXBhcmVJbmRleGVzKGEucm91dGVzTWV0YS5tYXAoKG1ldGEpID0+IG1ldGEuY2hpbGRyZW5JbmRleCksIGIucm91dGVzTWV0YS5tYXAoKG1ldGEpID0+IG1ldGEuY2hpbGRyZW5JbmRleCkpKTsKICAgICAgICAgIH0KCiAgICAgICAgICB2YXIgcGFyYW1SZSA9IC9eOlx3KyQvOwogICAgICAgICAgdmFyIGR5bmFtaWNTZWdtZW50VmFsdWUgPSAzOwogICAgICAgICAgdmFyIGluZGV4Um91dGVWYWx1ZSA9IDI7CiAgICAgICAgICB2YXIgZW1wdHlTZWdtZW50VmFsdWUgPSAxOwogICAgICAgICAgdmFyIHN0YXRpY1NlZ21lbnRWYWx1ZSA9IDEwOwogICAgICAgICAgdmFyIHNwbGF0UGVuYWx0eSA9IC0yOwoKICAgICAgICAgIHZhciBpc1NwbGF0ID0gKHMpID0+IHMgPT09ICIqIjsKCiAgICAgICAgICBmdW5jdGlvbiBjb21wdXRlU2NvcmUocGF0aCwgaW5kZXgpIHsKICAgICAgICAgICAgdmFyIHNlZ21lbnRzID0gcGF0aC5zcGxpdCgiLyIpOwogICAgICAgICAgICB2YXIgaW5pdGlhbFNjb3JlID0gc2VnbWVudHMubGVuZ3RoOwoKICAgICAgICAgICAgaWYgKHNlZ21lbnRzLnNvbWUoaXNTcGxhdCkpIHsKICAgICAgICAgICAgICBpbml0aWFsU2NvcmUgKz0gc3BsYXRQZW5hbHR5OwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoaW5kZXgpIHsKICAgICAgICAgICAgICBpbml0aWFsU2NvcmUgKz0gaW5kZXhSb3V0ZVZhbHVlOwogICAgICAgICAgICB9CgogICAgICAgICAgICByZXR1cm4gc2VnbWVudHMuZmlsdGVyKChzKSA9PiAhaXNTcGxhdChzKSkucmVkdWNlKChzY29yZSwgc2VnbWVudCkgPT4gc2NvcmUgKyAocGFyYW1SZS50ZXN0KHNlZ21lbnQpID8gZHluYW1pY1NlZ21lbnRWYWx1ZSA6IHNlZ21lbnQgPT09ICIiID8gZW1wdHlTZWdtZW50VmFsdWUgOiBzdGF0aWNTZWdtZW50VmFsdWUpLCBpbml0aWFsU2NvcmUpOwogICAgICAgICAgfQoKICAgICAgICAgIGZ1bmN0aW9uIGNvbXBhcmVJbmRleGVzKGEsIGIpIHsKICAgICAgICAgICAgdmFyIHNpYmxpbmdzID0gYS5sZW5ndGggPT09IGIubGVuZ3RoICYmIGEuc2xpY2UoMCwgLTEpLmV2ZXJ5KChuLCBpKSA9PiBuID09PSBiW2ldKTsKICAgICAgICAgICAgcmV0dXJuIHNpYmxpbmdzID8gLy8gSWYgdHdvIHJvdXRlcyBhcmUgc2libGluZ3MsIHdlIHNob3VsZCB0cnkgdG8gbWF0Y2ggdGhlIGVhcmxpZXIgc2libGluZwogICAgICAgICAgICAvLyBmaXJzdC4gVGhpcyBhbGxvd3MgcGVvcGxlIHRvIGhhdmUgZmluZS1ncmFpbmVkIGNvbnRyb2wgb3ZlciB0aGUgbWF0Y2hpbmcKICAgICAgICAgICAgLy8gYmVoYXZpb3IgYnkgc2ltcGx5IHB1dHRpbmcgcm91dGVzIHdpdGggaWRlbnRpY2FsIHBhdGhzIGluIHRoZSBvcmRlciB0aGV5CiAgICAgICAgICAgIC8vIHdhbnQgdGhlbSB0cmllZC4KICAgICAgICAgICAgYVthLmxlbmd0aCAtIDFdIC0gYltiLmxlbmd0aCAtIDFdIDogLy8gT3RoZXJ3aXNlLCBpdCBkb2Vzbid0IHJlYWxseSBtYWtlIHNlbnNlIHRvIHJhbmsgbm9uLXNpYmxpbmdzIGJ5IGluZGV4LAogICAgICAgICAgICAvLyBzbyB0aGV5IHNvcnQgZXF1YWxseS4KICAgICAgICAgICAgMDsKICAgICAgICAgIH0KCiAgICAgICAgICBmdW5jdGlvbiBtYXRjaFJvdXRlQnJhbmNoKGJyYW5jaCwgcGF0aG5hbWUpIHsKICAgICAgICAgICAgdmFyCiAgICAgICAgICAgIHJvdXRlc01ldGEgPQogICAgICAgICAgICBicmFuY2gucm91dGVzTWV0YTsKICAgICAgICAgICAgdmFyIG1hdGNoZWRQYXJhbXMgPSB7fTsKICAgICAgICAgICAgdmFyIG1hdGNoZWRQYXRobmFtZSA9ICIvIjsKICAgICAgICAgICAgdmFyIG1hdGNoZXMgPSBbXTsKCiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgcm91dGVzTWV0YS5sZW5ndGg7ICsraSkgewogICAgICAgICAgICAgIHZhciBtZXRhID0gcm91dGVzTWV0YVtpXTsKICAgICAgICAgICAgICB2YXIgZW5kID0gaSA9PT0gcm91dGVzTWV0YS5sZW5ndGggLSAxOwogICAgICAgICAgICAgIHZhciByZW1haW5pbmdQYXRobmFtZSA9IG1hdGNoZWRQYXRobmFtZSA9PT0gIi8iID8gcGF0aG5hbWUgOiBwYXRobmFtZS5zbGljZShtYXRjaGVkUGF0aG5hbWUubGVuZ3RoKSB8fCAiLyI7CiAgICAgICAgICAgICAgdmFyIG1hdGNoID0gcm91dGVyX21hdGNoUGF0aCh7CiAgICAgICAgICAgICAgICBwYXRoOiBtZXRhLnJlbGF0aXZlUGF0aCwKICAgICAgICAgICAgICAgIGNhc2VTZW5zaXRpdmU6IG1ldGEuY2FzZVNlbnNpdGl2ZSwKICAgICAgICAgICAgICAgIGVuZDogZW5kCiAgICAgICAgICAgICAgfSwgcmVtYWluaW5nUGF0aG5hbWUpOwogICAgICAgICAgICAgIGlmICghbWF0Y2gpIHJldHVybiBudWxsOwogICAgICAgICAgICAgIE9iamVjdC5hc3NpZ24obWF0Y2hlZFBhcmFtcywgbWF0Y2gucGFyYW1zKTsKICAgICAgICAgICAgICB2YXIgcm91dGUgPSBtZXRhLnJvdXRlOwogICAgICAgICAgICAgIG1hdGNoZXMucHVzaCh7CiAgICAgICAgICAgICAgICAvLyBUT0RPOiBDYW4gdGhpcyBhcyBiZSBhdm9pZGVkPwogICAgICAgICAgICAgICAgcGFyYW1zOiBtYXRjaGVkUGFyYW1zLAogICAgICAgICAgICAgICAgcGF0aG5hbWU6IHJvdXRlcl9qb2luUGF0aHMoW21hdGNoZWRQYXRobmFtZSwgbWF0Y2gucGF0aG5hbWVdKSwKICAgICAgICAgICAgICAgIHBhdGhuYW1lQmFzZTogbm9ybWFsaXplUGF0aG5hbWUocm91dGVyX2pvaW5QYXRocyhbbWF0Y2hlZFBhdGhuYW1lLCBtYXRjaC5wYXRobmFtZUJhc2VdKSksCiAgICAgICAgICAgICAgICByb3V0ZTogcm91dGUKICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgaWYgKG1hdGNoLnBhdGhuYW1lQmFzZSAhPT0gIi8iKSB7CiAgICAgICAgICAgICAgICBtYXRjaGVkUGF0aG5hbWUgPSByb3V0ZXJfam9pblBhdGhzKFttYXRjaGVkUGF0aG5hbWUsIG1hdGNoLnBhdGhuYW1lQmFzZV0pOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuIG1hdGNoZXM7CiAgICAgICAgICB9CiAgICAgICAgICAvKioKICAgICAgICAgICAqIFJldHVybnMgYSBwYXRoIHdpdGggcGFyYW1zIGludGVycG9sYXRlZC4KICAgICAgICAgICAqCiAgICAgICAgICAgKiBAc2VlIGh0dHBzOi8vcmVhY3Ryb3V0ZXIuY29tL2RvY3MvZW4vdjYvdXRpbHMvZ2VuZXJhdGUtcGF0aAogICAgICAgICAgICovCgoKICAgICAgICAgIGZ1bmN0aW9uIGdlbmVyYXRlUGF0aChwYXRoLCBwYXJhbXMpIHsKICAgICAgICAgICAgaWYgKHBhcmFtcyA9PT0gdm9pZCAwKSB7CiAgICAgICAgICAgICAgcGFyYW1zID0ge307CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybiBwYXRoLnJlcGxhY2UoLzooXHcrKS9nLCAoXywga2V5KSA9PiB7CiAgICAgICAgICAgICAgcm91dGVyX2ludmFyaWFudChwYXJhbXNba2V5XSAhPSBudWxsLCAiTWlzc2luZyBcIjoiICsga2V5ICsgIlwiIHBhcmFtIik7CiAgICAgICAgICAgICAgcmV0dXJuIHBhcmFtc1trZXldOwogICAgICAgICAgICB9KS5yZXBsYWNlKC8oXC8/KVwqLywgKF8sIHByZWZpeCwgX18sIHN0cikgPT4gewogICAgICAgICAgICAgIHZhciBzdGFyID0gIioiOwoKICAgICAgICAgICAgICBpZiAocGFyYW1zW3N0YXJdID09IG51bGwpIHsKICAgICAgICAgICAgICAgIC8vIElmIG5vIHNwbGF0IHdhcyBwcm92aWRlZCwgdHJpbSB0aGUgdHJhaWxpbmcgc2xhc2ggX3VubGVzc18gaXQncwogICAgICAgICAgICAgICAgLy8gdGhlIGVudGlyZSBwYXRoCiAgICAgICAgICAgICAgICByZXR1cm4gc3RyID09PSAiLyoiID8gIi8iIDogIiI7CiAgICAgICAgICAgICAgfSAvLyBBcHBseSB0aGUgc3BsYXQKCgogICAgICAgICAgICAgIHJldHVybiAiIiArIHByZWZpeCArIHBhcmFtc1tzdGFyXTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9CiAgICAgICAgICAvKioKICAgICAgICAgICAqIFBlcmZvcm1zIHBhdHRlcm4gbWF0Y2hpbmcgb24gYSBVUkwgcGF0aG5hbWUgYW5kIHJldHVybnMgaW5mb3JtYXRpb24gYWJvdXQKICAgICAgICAgICAqIHRoZSBtYXRjaC4KICAgICAgICAgICAqCiAgICAgICAgICAgKiBAc2VlIGh0dHBzOi8vcmVhY3Ryb3V0ZXIuY29tL2RvY3MvZW4vdjYvdXRpbHMvbWF0Y2gtcGF0aAogICAgICAgICAgICovCgogICAgICAgICAgZnVuY3Rpb24gcm91dGVyX21hdGNoUGF0aChwYXR0ZXJuLCBwYXRobmFtZSkgewogICAgICAgICAgICBpZiAodHlwZW9mIHBhdHRlcm4gPT09ICJzdHJpbmciKSB7CiAgICAgICAgICAgICAgcGF0dGVybiA9IHsKICAgICAgICAgICAgICAgIHBhdGg6IHBhdHRlcm4sCiAgICAgICAgICAgICAgICBjYXNlU2Vuc2l0aXZlOiBmYWxzZSwKICAgICAgICAgICAgICAgIGVuZDogdHJ1ZQogICAgICAgICAgICAgIH07CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHZhciBfY29tcGlsZVBhdGggPSBjb21waWxlUGF0aChwYXR0ZXJuLnBhdGgsIHBhdHRlcm4uY2FzZVNlbnNpdGl2ZSwgcGF0dGVybi5lbmQpLF9jb21waWxlUGF0aDIgPSBfc2xpY2VkVG9BcnJheTIoX2NvbXBpbGVQYXRoLCAyKSxtYXRjaGVyID0gX2NvbXBpbGVQYXRoMlswXSxwYXJhbU5hbWVzID0gX2NvbXBpbGVQYXRoMlsxXTsKICAgICAgICAgICAgdmFyIG1hdGNoID0gcGF0aG5hbWUubWF0Y2gobWF0Y2hlcik7CiAgICAgICAgICAgIGlmICghbWF0Y2gpIHJldHVybiBudWxsOwogICAgICAgICAgICB2YXIgbWF0Y2hlZFBhdGhuYW1lID0gbWF0Y2hbMF07CiAgICAgICAgICAgIHZhciBwYXRobmFtZUJhc2UgPSBtYXRjaGVkUGF0aG5hbWUucmVwbGFjZSgvKC4pXC8rJC8sICIkMSIpOwogICAgICAgICAgICB2YXIgY2FwdHVyZUdyb3VwcyA9IG1hdGNoLnNsaWNlKDEpOwogICAgICAgICAgICB2YXIgcGFyYW1zID0gcGFyYW1OYW1lcy5yZWR1Y2UoKG1lbW8sIHBhcmFtTmFtZSwgaW5kZXgpID0+IHsKICAgICAgICAgICAgICAvLyBXZSBuZWVkIHRvIGNvbXB1dGUgdGhlIHBhdGhuYW1lQmFzZSBoZXJlIHVzaW5nIHRoZSByYXcgc3BsYXQgdmFsdWUKICAgICAgICAgICAgICAvLyBpbnN0ZWFkIG9mIHVzaW5nIHBhcmFtc1siKiJdIGxhdGVyIGJlY2F1c2UgaXQgd2lsbCBiZSBkZWNvZGVkIHRoZW4KICAgICAgICAgICAgICBpZiAocGFyYW1OYW1lID09PSAiKiIpIHsKICAgICAgICAgICAgICAgIHZhciBzcGxhdFZhbHVlID0gY2FwdHVyZUdyb3Vwc1tpbmRleF0gfHwgIiI7CiAgICAgICAgICAgICAgICBwYXRobmFtZUJhc2UgPSBtYXRjaGVkUGF0aG5hbWUuc2xpY2UoMCwgbWF0Y2hlZFBhdGhuYW1lLmxlbmd0aCAtIHNwbGF0VmFsdWUubGVuZ3RoKS5yZXBsYWNlKC8oLilcLyskLywgIiQxIik7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBtZW1vW3BhcmFtTmFtZV0gPSBzYWZlbHlEZWNvZGVVUklDb21wb25lbnQoY2FwdHVyZUdyb3Vwc1tpbmRleF0gfHwgIiIsIHBhcmFtTmFtZSk7CiAgICAgICAgICAgICAgcmV0dXJuIG1lbW87CiAgICAgICAgICAgIH0sIHt9KTsKICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICBwYXJhbXM6IHBhcmFtcywKICAgICAgICAgICAgICBwYXRobmFtZTogbWF0Y2hlZFBhdGhuYW1lLAogICAgICAgICAgICAgIHBhdGhuYW1lQmFzZTogcGF0aG5hbWVCYXNlLAogICAgICAgICAgICAgIHBhdHRlcm46IHBhdHRlcm4KICAgICAgICAgICAgfTsKICAgICAgICAgIH0KCiAgICAgICAgICBmdW5jdGlvbiBjb21waWxlUGF0aChwYXRoLCBjYXNlU2Vuc2l0aXZlLCBlbmQpIHsKICAgICAgICAgICAgaWYgKGNhc2VTZW5zaXRpdmUgPT09IHZvaWQgMCkgewogICAgICAgICAgICAgIGNhc2VTZW5zaXRpdmUgPSBmYWxzZTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKGVuZCA9PT0gdm9pZCAwKSB7CiAgICAgICAgICAgICAgZW5kID0gdHJ1ZTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgd2FybmluZyhwYXRoID09PSAiKiIgfHwgIXBhdGguZW5kc1dpdGgoIioiKSB8fCBwYXRoLmVuZHNXaXRoKCIvKiIpLCAiUm91dGUgcGF0aCBcIiIgKyBwYXRoICsgIlwiIHdpbGwgYmUgdHJlYXRlZCBhcyBpZiBpdCB3ZXJlICIgKyAoIlwiIiArIHBhdGgucmVwbGFjZSgvXCokLywgIi8qIikgKyAiXCIgYmVjYXVzZSB0aGUgYCpgIGNoYXJhY3RlciBtdXN0ICIpICsgImFsd2F5cyBmb2xsb3cgYSBgL2AgaW4gdGhlIHBhdHRlcm4uIFRvIGdldCByaWQgb2YgdGhpcyB3YXJuaW5nLCAiICsgKCJwbGVhc2UgY2hhbmdlIHRoZSByb3V0ZSBwYXRoIHRvIFwiIiArIHBhdGgucmVwbGFjZSgvXCokLywgIi8qIikgKyAiXCIuIikpOwogICAgICAgICAgICB2YXIgcGFyYW1OYW1lcyA9IFtdOwogICAgICAgICAgICB2YXIgcmVnZXhwU291cmNlID0gIl4iICsgcGF0aC5yZXBsYWNlKC9cLypcKj8kLywgIiIpIC8vIElnbm9yZSB0cmFpbGluZyAvIGFuZCAvKiwgd2UnbGwgaGFuZGxlIGl0IGJlbG93CiAgICAgICAgICAgIC5yZXBsYWNlKC9eXC8qLywgIi8iKSAvLyBNYWtlIHN1cmUgaXQgaGFzIGEgbGVhZGluZyAvCiAgICAgICAgICAgIC5yZXBsYWNlKC9bXFwuKiteJD97fXwoKVtcXV0vZywgIlxcJCYiKSAvLyBFc2NhcGUgc3BlY2lhbCByZWdleCBjaGFycwogICAgICAgICAgICAucmVwbGFjZSgvOihcdyspL2csIChfLCBwYXJhbU5hbWUpID0+IHsKICAgICAgICAgICAgICBwYXJhbU5hbWVzLnB1c2gocGFyYW1OYW1lKTsKICAgICAgICAgICAgICByZXR1cm4gIihbXlxcL10rKSI7CiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgaWYgKHBhdGguZW5kc1dpdGgoIioiKSkgewogICAgICAgICAgICAgIHBhcmFtTmFtZXMucHVzaCgiKiIpOwogICAgICAgICAgICAgIHJlZ2V4cFNvdXJjZSArPSBwYXRoID09PSAiKiIgfHwgcGF0aCA9PT0gIi8qIiA/ICIoLiopJCIgLy8gQWxyZWFkeSBtYXRjaGVkIHRoZSBpbml0aWFsIC8sIGp1c3QgbWF0Y2ggdGhlIHJlc3QKICAgICAgICAgICAgICA6ICIoPzpcXC8oLispfFxcLyopJCI7IC8vIERvbid0IGluY2x1ZGUgdGhlIC8gaW4gcGFyYW1zWyIqIl0KICAgICAgICAgICAgfSBlbHNlIGlmIChlbmQpIHsKICAgICAgICAgICAgICAvLyBXaGVuIG1hdGNoaW5nIHRvIHRoZSBlbmQsIGlnbm9yZSB0cmFpbGluZyBzbGFzaGVzCiAgICAgICAgICAgICAgcmVnZXhwU291cmNlICs9ICJcXC8qJCI7CiAgICAgICAgICAgIH0gZWxzZSBpZiAocGF0aCAhPT0gIiIgJiYgcGF0aCAhPT0gIi8iKSB7CiAgICAgICAgICAgICAgLy8gSWYgb3VyIHBhdGggaXMgbm9uLWVtcHR5IGFuZCBjb250YWlucyBhbnl0aGluZyBiZXlvbmQgYW4gaW5pdGlhbCBzbGFzaCwKICAgICAgICAgICAgICAvLyB0aGVuIHdlIGhhdmUgX3NvbWVfIGZvcm0gb2YgcGF0aCBpbiBvdXIgcmVnZXggc28gd2Ugc2hvdWxkIGV4cGVjdCB0bwogICAgICAgICAgICAgIC8vIG1hdGNoIG9ubHkgaWYgd2UgZmluZCB0aGUgZW5kIG9mIHRoaXMgcGF0aCBzZWdtZW50LiAgTG9vayBmb3IgYW4gb3B0aW9uYWwKICAgICAgICAgICAgICAvLyBub24tY2FwdHVyZWQgdHJhaWxpbmcgc2xhc2ggKHRvIG1hdGNoIGEgcG9ydGlvbiBvZiB0aGUgVVJMKSBvciB0aGUgZW5kCiAgICAgICAgICAgICAgLy8gb2YgdGhlIHBhdGggKGlmIHdlJ3ZlIG1hdGNoZWQgdG8gdGhlIGVuZCkuICBXZSB1c2VkIHRvIGRvIHRoaXMgd2l0aCBhCiAgICAgICAgICAgICAgLy8gd29yZCBib3VuZGFyeSBidXQgdGhhdCBnaXZlcyBmYWxzZSBwb3NpdGl2ZXMgb24gcm91dGVzIGxpa2UKICAgICAgICAgICAgICAvLyAvdXNlci1wcmVmZXJlbmNlcyBzaW5jZSBgLWAgY291bnRzIGFzIGEgd29yZCBib3VuZGFyeS4KICAgICAgICAgICAgICByZWdleHBTb3VyY2UgKz0gIig/Oig/PVxcL3wkKSkiOwogICAgICAgICAgICB9IGVsc2UgOwoKICAgICAgICAgICAgdmFyIG1hdGNoZXIgPSBuZXcgUmVnRXhwKHJlZ2V4cFNvdXJjZSwgY2FzZVNlbnNpdGl2ZSA/IHVuZGVmaW5lZCA6ICJpIik7CiAgICAgICAgICAgIHJldHVybiBbbWF0Y2hlciwgcGFyYW1OYW1lc107CiAgICAgICAgICB9CgogICAgICAgICAgZnVuY3Rpb24gc2FmZWx5RGVjb2RlVVJJKHZhbHVlKSB7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgcmV0dXJuIGRlY29kZVVSSSh2YWx1ZSk7CiAgICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgICAgICAgd2FybmluZyhmYWxzZSwgIlRoZSBVUkwgcGF0aCBcIiIgKyB2YWx1ZSArICJcIiBjb3VsZCBub3QgYmUgZGVjb2RlZCBiZWNhdXNlIGl0IGlzIGlzIGEgIiArICJtYWxmb3JtZWQgVVJMIHNlZ21lbnQuIFRoaXMgaXMgcHJvYmFibHkgZHVlIHRvIGEgYmFkIHBlcmNlbnQgIiArICgiZW5jb2RpbmcgKCIgKyBlcnJvciArICIpLiIpKTsKICAgICAgICAgICAgICByZXR1cm4gdmFsdWU7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KCiAgICAgICAgICBmdW5jdGlvbiBzYWZlbHlEZWNvZGVVUklDb21wb25lbnQodmFsdWUsIHBhcmFtTmFtZSkgewogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgIHJldHVybiBkZWNvZGVVUklDb21wb25lbnQodmFsdWUpOwogICAgICAgICAgICB9IGNhdGNoIChlcnJvcikgewogICAgICAgICAgICAgIHdhcm5pbmcoZmFsc2UsICJUaGUgdmFsdWUgZm9yIHRoZSBVUkwgcGFyYW0gXCIiICsgcGFyYW1OYW1lICsgIlwiIHdpbGwgbm90IGJlIGRlY29kZWQgYmVjYXVzZSIgKyAoIiB0aGUgc3RyaW5nIFwiIiArIHZhbHVlICsgIlwiIGlzIGEgbWFsZm9ybWVkIFVSTCBzZWdtZW50LiBUaGlzIGlzIHByb2JhYmx5IikgKyAoIiBkdWUgdG8gYSBiYWQgcGVyY2VudCBlbmNvZGluZyAoIiArIGVycm9yICsgIikuIikpOwogICAgICAgICAgICAgIHJldHVybiB2YWx1ZTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgLyoqCiAgICAgICAgICAgKiBAcHJpdmF0ZQogICAgICAgICAgICovCgoKICAgICAgICAgIGZ1bmN0aW9uIHN0cmlwQmFzZW5hbWUocGF0aG5hbWUsIGJhc2VuYW1lKSB7CiAgICAgICAgICAgIGlmIChiYXNlbmFtZSA9PT0gIi8iKSByZXR1cm4gcGF0aG5hbWU7CgogICAgICAgICAgICBpZiAoIXBhdGhuYW1lLnRvTG93ZXJDYXNlKCkuc3RhcnRzV2l0aChiYXNlbmFtZS50b0xvd2VyQ2FzZSgpKSkgewogICAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgICAgICB9IC8vIFdlIHdhbnQgdG8gbGVhdmUgdHJhaWxpbmcgc2xhc2ggYmVoYXZpb3IgaW4gdGhlIHVzZXIncyBjb250cm9sLCBzbyBpZiB0aGV5CiAgICAgICAgICAgIC8vIHNwZWNpZnkgYSBiYXNlbmFtZSB3aXRoIGEgdHJhaWxpbmcgc2xhc2gsIHdlIHNob3VsZCBzdXBwb3J0IGl0CgoKICAgICAgICAgICAgdmFyIHN0YXJ0SW5kZXggPSBiYXNlbmFtZS5lbmRzV2l0aCgiLyIpID8gYmFzZW5hbWUubGVuZ3RoIC0gMSA6IGJhc2VuYW1lLmxlbmd0aDsKICAgICAgICAgICAgdmFyIG5leHRDaGFyID0gcGF0aG5hbWUuY2hhckF0KHN0YXJ0SW5kZXgpOwoKICAgICAgICAgICAgaWYgKG5leHRDaGFyICYmIG5leHRDaGFyICE9PSAiLyIpIHsKICAgICAgICAgICAgICAvLyBwYXRobmFtZSBkb2VzIG5vdCBzdGFydCB3aXRoIGJhc2VuYW1lLwogICAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgICAgICB9CgogICAgICAgICAgICByZXR1cm4gcGF0aG5hbWUuc2xpY2Uoc3RhcnRJbmRleCkgfHwgIi8iOwogICAgICAgICAgfQogICAgICAgICAgZnVuY3Rpb24gcm91dGVyX2ludmFyaWFudCh2YWx1ZSwgbWVzc2FnZSkgewogICAgICAgICAgICBpZiAodmFsdWUgPT09IGZhbHNlIHx8IHZhbHVlID09PSBudWxsIHx8IHR5cGVvZiB2YWx1ZSA9PT0gInVuZGVmaW5lZCIpIHsKICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IobWVzc2FnZSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIC8qKgogICAgICAgICAgICogQHByaXZhdGUKICAgICAgICAgICAqLwoKICAgICAgICAgIGZ1bmN0aW9uIHdhcm5pbmcoY29uZCwgbWVzc2FnZSkgewogICAgICAgICAgICBpZiAoIWNvbmQpIHsKICAgICAgICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tY29uc29sZQogICAgICAgICAgICAgIGlmICh0eXBlb2YgY29uc29sZSAhPT0gInVuZGVmaW5lZCIpIGNvbnNvbGUud2FybihtZXNzYWdlKTsKCiAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIC8vIFdlbGNvbWUgdG8gZGVidWdnaW5nIFJlYWN0IFJvdXRlciEKICAgICAgICAgICAgICAgIC8vCiAgICAgICAgICAgICAgICAvLyBUaGlzIGVycm9yIGlzIHRocm93biBhcyBhIGNvbnZlbmllbmNlIHNvIHlvdSBjYW4gbW9yZSBlYXNpbHkKICAgICAgICAgICAgICAgIC8vIGZpbmQgdGhlIHNvdXJjZSBmb3IgYSB3YXJuaW5nIHRoYXQgYXBwZWFycyBpbiB0aGUgY29uc29sZSBieQogICAgICAgICAgICAgICAgLy8gZW5hYmxpbmcgInBhdXNlIG9uIGV4Y2VwdGlvbnMiIGluIHlvdXIgSmF2YVNjcmlwdCBkZWJ1Z2dlci4KICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihtZXNzYWdlKTsgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG5vLWVtcHR5CiAgICAgICAgICAgICAgfSBjYXRjaCAoZSkge30KICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgLyoqCiAgICAgICAgICAgKiBSZXR1cm5zIGEgcmVzb2x2ZWQgcGF0aCBvYmplY3QgcmVsYXRpdmUgdG8gdGhlIGdpdmVuIHBhdGhuYW1lLgogICAgICAgICAgICoKICAgICAgICAgICAqIEBzZWUgaHR0cHM6Ly9yZWFjdHJvdXRlci5jb20vZG9jcy9lbi92Ni91dGlscy9yZXNvbHZlLXBhdGgKICAgICAgICAgICAqLwoKICAgICAgICAgIGZ1bmN0aW9uIHJlc29sdmVQYXRoKHRvLCBmcm9tUGF0aG5hbWUpIHsKICAgICAgICAgICAgaWYgKGZyb21QYXRobmFtZSA9PT0gdm9pZCAwKSB7CiAgICAgICAgICAgICAgZnJvbVBhdGhuYW1lID0gIi8iOwogICAgICAgICAgICB9CgogICAgICAgICAgICB2YXIgX3JlZjExID0KCgoKICAgICAgICAgICAgICB0eXBlb2YgdG8gPT09ICJzdHJpbmciID8gcGFyc2VQYXRoKHRvKSA6IHRvLHRvUGF0aG5hbWUgPSBfcmVmMTEucGF0aG5hbWUsX3JlZjExJHNlYXJjaCA9IF9yZWYxMS5zZWFyY2gsc2VhcmNoID0gX3JlZjExJHNlYXJjaCA9PT0gdm9pZCAwID8gIiIgOiBfcmVmMTEkc2VhcmNoLF9yZWYxMSRoYXNoID0gX3JlZjExLmhhc2gsaGFzaCA9IF9yZWYxMSRoYXNoID09PSB2b2lkIDAgPyAiIiA6IF9yZWYxMSRoYXNoOwogICAgICAgICAgICB2YXIgcGF0aG5hbWUgPSB0b1BhdGhuYW1lID8gdG9QYXRobmFtZS5zdGFydHNXaXRoKCIvIikgPyB0b1BhdGhuYW1lIDogcmVzb2x2ZVBhdGhuYW1lKHRvUGF0aG5hbWUsIGZyb21QYXRobmFtZSkgOiBmcm9tUGF0aG5hbWU7CiAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgcGF0aG5hbWU6IHBhdGhuYW1lLAogICAgICAgICAgICAgIHNlYXJjaDogbm9ybWFsaXplU2VhcmNoKHNlYXJjaCksCiAgICAgICAgICAgICAgaGFzaDogbm9ybWFsaXplSGFzaChoYXNoKQogICAgICAgICAgICB9OwogICAgICAgICAgfQoKICAgICAgICAgIGZ1bmN0aW9uIHJlc29sdmVQYXRobmFtZShyZWxhdGl2ZVBhdGgsIGZyb21QYXRobmFtZSkgewogICAgICAgICAgICB2YXIgc2VnbWVudHMgPSBmcm9tUGF0aG5hbWUucmVwbGFjZSgvXC8rJC8sICIiKS5zcGxpdCgiLyIpOwogICAgICAgICAgICB2YXIgcmVsYXRpdmVTZWdtZW50cyA9IHJlbGF0aXZlUGF0aC5zcGxpdCgiLyIpOwogICAgICAgICAgICByZWxhdGl2ZVNlZ21lbnRzLmZvckVhY2goKHNlZ21lbnQpID0+IHsKICAgICAgICAgICAgICBpZiAoc2VnbWVudCA9PT0gIi4uIikgewogICAgICAgICAgICAgICAgLy8gS2VlcCB0aGUgcm9vdCAiIiBzZWdtZW50IHNvIHRoZSBwYXRobmFtZSBzdGFydHMgYXQgLwogICAgICAgICAgICAgICAgaWYgKHNlZ21lbnRzLmxlbmd0aCA+IDEpIHNlZ21lbnRzLnBvcCgpOwogICAgICAgICAgICAgIH0gZWxzZSBpZiAoc2VnbWVudCAhPT0gIi4iKSB7CiAgICAgICAgICAgICAgICBzZWdtZW50cy5wdXNoKHNlZ21lbnQpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIHJldHVybiBzZWdtZW50cy5sZW5ndGggPiAxID8gc2VnbWVudHMuam9pbigiLyIpIDogIi8iOwogICAgICAgICAgfQoKICAgICAgICAgIGZ1bmN0aW9uIGdldEludmFsaWRQYXRoRXJyb3IoY2hhciwgZmllbGQsIGRlc3QsIHBhdGgpIHsKICAgICAgICAgICAgcmV0dXJuICJDYW5ub3QgaW5jbHVkZSBhICciICsgY2hhciArICInIGNoYXJhY3RlciBpbiBhIG1hbnVhbGx5IHNwZWNpZmllZCAiICsgKCJgdG8uIiArIGZpZWxkICsgImAgZmllbGQgWyIgKyBKU09OLnN0cmluZ2lmeShwYXRoKSArICJdLiAgUGxlYXNlIHNlcGFyYXRlIGl0IG91dCB0byB0aGUgIikgKyAoImB0by4iICsgZGVzdCArICJgIGZpZWxkLiBBbHRlcm5hdGl2ZWx5IHlvdSBtYXkgcHJvdmlkZSB0aGUgZnVsbCBwYXRoIGFzICIpICsgImEgc3RyaW5nIGluIDxMaW5rIHRvPVwiLi4uXCI+IGFuZCB0aGUgcm91dGVyIHdpbGwgcGFyc2UgaXQgZm9yIHlvdS4iOwogICAgICAgICAgfQogICAgICAgICAgLyoqCiAgICAgICAgICAgKiBAcHJpdmF0ZQogICAgICAgICAgICoKICAgICAgICAgICAqIFdoZW4gcHJvY2Vzc2luZyByZWxhdGl2ZSBuYXZpZ2F0aW9uIHdlIHdhbnQgdG8gaWdub3JlIGFuY2VzdG9yIHJvdXRlcyB0aGF0CiAgICAgICAgICAgKiBkbyBub3QgY29udHJpYnV0ZSB0byB0aGUgcGF0aCwgc3VjaCB0aGF0IGluZGV4L3BhdGhsZXNzIGxheW91dCByb3V0ZXMgZG9uJ3QKICAgICAgICAgICAqIGludGVyZmVyZS4KICAgICAgICAgICAqCiAgICAgICAgICAgKiBGb3IgZXhhbXBsZSwgd2hlbiBtb3ZpbmcgYSByb3V0ZSBlbGVtZW50IGludG8gYW4gaW5kZXggcm91dGUgYW5kL29yIGEKICAgICAgICAgICAqIHBhdGhsZXNzIGxheW91dCByb3V0ZSwgcmVsYXRpdmUgbGluayBiZWhhdmlvciBjb250YWluZWQgd2l0aGluIHNob3VsZCBzdGF5CiAgICAgICAgICAgKiB0aGUgc2FtZS4gIEJvdGggb2YgdGhlIGZvbGxvd2luZyBleGFtcGxlcyBzaG91bGQgbGluayBiYWNrIHRvIHRoZSByb290OgogICAgICAgICAgICoKICAgICAgICAgICAqICAgPFJvdXRlIHBhdGg9Ii8iPgogICAgICAgICAgICogICAgIDxSb3V0ZSBwYXRoPSJhY2NvdW50cyIgZWxlbWVudD17PExpbmsgdG89Ii4uIn0+CiAgICAgICAgICAgKiAgIDwvUm91dGU+CiAgICAgICAgICAgKgogICAgICAgICAgICogICA8Um91dGUgcGF0aD0iLyI+CiAgICAgICAgICAgKiAgICAgPFJvdXRlIHBhdGg9ImFjY291bnRzIj4KICAgICAgICAgICAqICAgICAgIDxSb3V0ZSBlbGVtZW50PXs8QWNjb3VudHNMYXlvdXQgLz59PiAgICAgICAvLyA8LS0gRG9lcyBub3QgY29udHJpYnV0ZQogICAgICAgICAgICogICAgICAgICA8Um91dGUgaW5kZXggZWxlbWVudD17PExpbmsgdG89Ii4uIn0gLz4gIC8vIDwtLSBEb2VzIG5vdCBjb250cmlidXRlCiAgICAgICAgICAgKiAgICAgICA8L1JvdXRlCiAgICAgICAgICAgKiAgICAgPC9Sb3V0ZT4KICAgICAgICAgICAqICAgPC9Sb3V0ZT4KICAgICAgICAgICAqLwoKCiAgICAgICAgICBmdW5jdGlvbiBnZXRQYXRoQ29udHJpYnV0aW5nTWF0Y2hlcyhtYXRjaGVzKSB7CiAgICAgICAgICAgIHJldHVybiBtYXRjaGVzLmZpbHRlcigobWF0Y2gsIGluZGV4KSA9PiBpbmRleCA9PT0gMCB8fCBtYXRjaC5yb3V0ZS5wYXRoICYmIG1hdGNoLnJvdXRlLnBhdGgubGVuZ3RoID4gMCk7CiAgICAgICAgICB9CiAgICAgICAgICAvKioKICAgICAgICAgICAqIEBwcml2YXRlCiAgICAgICAgICAgKi8KCiAgICAgICAgICBmdW5jdGlvbiByZXNvbHZlVG8odG9BcmcsIHJvdXRlUGF0aG5hbWVzLCBsb2NhdGlvblBhdGhuYW1lLCBpc1BhdGhSZWxhdGl2ZSkgewogICAgICAgICAgICBpZiAoaXNQYXRoUmVsYXRpdmUgPT09IHZvaWQgMCkgewogICAgICAgICAgICAgIGlzUGF0aFJlbGF0aXZlID0gZmFsc2U7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHZhciB0bzsKCiAgICAgICAgICAgIGlmICh0eXBlb2YgdG9BcmcgPT09ICJzdHJpbmciKSB7CiAgICAgICAgICAgICAgdG8gPSBwYXJzZVBhdGgodG9BcmcpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIHRvID0gX2V4dGVuZHMoe30sIHRvQXJnKTsKICAgICAgICAgICAgICByb3V0ZXJfaW52YXJpYW50KCF0by5wYXRobmFtZSB8fCAhdG8ucGF0aG5hbWUuaW5jbHVkZXMoIj8iKSwgZ2V0SW52YWxpZFBhdGhFcnJvcigiPyIsICJwYXRobmFtZSIsICJzZWFyY2giLCB0bykpOwogICAgICAgICAgICAgIHJvdXRlcl9pbnZhcmlhbnQoIXRvLnBhdGhuYW1lIHx8ICF0by5wYXRobmFtZS5pbmNsdWRlcygiIyIpLCBnZXRJbnZhbGlkUGF0aEVycm9yKCIjIiwgInBhdGhuYW1lIiwgImhhc2giLCB0bykpOwogICAgICAgICAgICAgIHJvdXRlcl9pbnZhcmlhbnQoIXRvLnNlYXJjaCB8fCAhdG8uc2VhcmNoLmluY2x1ZGVzKCIjIiksIGdldEludmFsaWRQYXRoRXJyb3IoIiMiLCAic2VhcmNoIiwgImhhc2giLCB0bykpOwogICAgICAgICAgICB9CgogICAgICAgICAgICB2YXIgaXNFbXB0eVBhdGggPSB0b0FyZyA9PT0gIiIgfHwgdG8ucGF0aG5hbWUgPT09ICIiOwogICAgICAgICAgICB2YXIgdG9QYXRobmFtZSA9IGlzRW1wdHlQYXRoID8gIi8iIDogdG8ucGF0aG5hbWU7CiAgICAgICAgICAgIHZhciBmcm9tOyAvLyBSb3V0aW5nIGlzIHJlbGF0aXZlIHRvIHRoZSBjdXJyZW50IHBhdGhuYW1lIGlmIGV4cGxpY2l0bHkgcmVxdWVzdGVkLgogICAgICAgICAgICAvLwogICAgICAgICAgICAvLyBJZiBhIHBhdGhuYW1lIGlzIGV4cGxpY2l0bHkgcHJvdmlkZWQgaW4gYHRvYCwgaXQgc2hvdWxkIGJlIHJlbGF0aXZlIHRvIHRoZQogICAgICAgICAgICAvLyByb3V0ZSBjb250ZXh0LiBUaGlzIGlzIGV4cGxhaW5lZCBpbiBgTm90ZSBvbiBgPExpbmsgdG8+YCB2YWx1ZXNgIGluIG91cgogICAgICAgICAgICAvLyBtaWdyYXRpb24gZ3VpZGUgZnJvbSB2NSBhcyBhIG1lYW5zIG9mIGRpc2FtYmlndWF0aW9uIGJldHdlZW4gYHRvYCB2YWx1ZXMKICAgICAgICAgICAgLy8gdGhhdCBiZWdpbiB3aXRoIGAvYCBhbmQgdGhvc2UgdGhhdCBkbyBub3QuIEhvd2V2ZXIsIHRoaXMgaXMgcHJvYmxlbWF0aWMgZm9yCiAgICAgICAgICAgIC8vIGB0b2AgdmFsdWVzIHRoYXQgZG8gbm90IHByb3ZpZGUgYSBwYXRobmFtZS4gYHRvYCBjYW4gc2ltcGx5IGJlIGEgc2VhcmNoIG9yCiAgICAgICAgICAgIC8vIGhhc2ggc3RyaW5nLCBpbiB3aGljaCBjYXNlIHdlIHNob3VsZCBhc3N1bWUgdGhhdCB0aGUgbmF2aWdhdGlvbiBpcyByZWxhdGl2ZQogICAgICAgICAgICAvLyB0byB0aGUgY3VycmVudCBsb2NhdGlvbidzIHBhdGhuYW1lIGFuZCAqbm90KiB0aGUgcm91dGUgcGF0aG5hbWUuCgogICAgICAgICAgICBpZiAoaXNQYXRoUmVsYXRpdmUgfHwgdG9QYXRobmFtZSA9PSBudWxsKSB7CiAgICAgICAgICAgICAgZnJvbSA9IGxvY2F0aW9uUGF0aG5hbWU7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgdmFyIHJvdXRlUGF0aG5hbWVJbmRleCA9IHJvdXRlUGF0aG5hbWVzLmxlbmd0aCAtIDE7CgogICAgICAgICAgICAgIGlmICh0b1BhdGhuYW1lLnN0YXJ0c1dpdGgoIi4uIikpIHsKICAgICAgICAgICAgICAgIHZhciB0b1NlZ21lbnRzID0gdG9QYXRobmFtZS5zcGxpdCgiLyIpOyAvLyBFYWNoIGxlYWRpbmcgLi4gc2VnbWVudCBtZWFucyAiZ28gdXAgb25lIHJvdXRlIiBpbnN0ZWFkIG9mICJnbyB1cCBvbmUKICAgICAgICAgICAgICAgIC8vIFVSTCBzZWdtZW50Ii4gIFRoaXMgaXMgYSBrZXkgZGlmZmVyZW5jZSBmcm9tIGhvdyA8YSBocmVmPiB3b3JrcyBhbmQgYQogICAgICAgICAgICAgICAgLy8gbWFqb3IgcmVhc29uIHdlIGNhbGwgdGhpcyBhICJ0byIgdmFsdWUgaW5zdGVhZCBvZiBhICJocmVmIi4KCiAgICAgICAgICAgICAgICB3aGlsZSAodG9TZWdtZW50c1swXSA9PT0gIi4uIikgewogICAgICAgICAgICAgICAgICB0b1NlZ21lbnRzLnNoaWZ0KCk7CiAgICAgICAgICAgICAgICAgIHJvdXRlUGF0aG5hbWVJbmRleCAtPSAxOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHRvLnBhdGhuYW1lID0gdG9TZWdtZW50cy5qb2luKCIvIik7CiAgICAgICAgICAgICAgfSAvLyBJZiB0aGVyZSBhcmUgbW9yZSAiLi4iIHNlZ21lbnRzIHRoYW4gcGFyZW50IHJvdXRlcywgcmVzb2x2ZSByZWxhdGl2ZSB0bwogICAgICAgICAgICAgIC8vIHRoZSByb290IC8gVVJMLgoKCiAgICAgICAgICAgICAgZnJvbSA9IHJvdXRlUGF0aG5hbWVJbmRleCA+PSAwID8gcm91dGVQYXRobmFtZXNbcm91dGVQYXRobmFtZUluZGV4XSA6ICIvIjsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdmFyIHBhdGggPSByZXNvbHZlUGF0aCh0bywgZnJvbSk7IC8vIEVuc3VyZSB0aGUgcGF0aG5hbWUgaGFzIGEgdHJhaWxpbmcgc2xhc2ggaWYgdGhlIG9yaWdpbmFsICJ0byIgaGFkIG9uZQoKICAgICAgICAgICAgdmFyIGhhc0V4cGxpY2l0VHJhaWxpbmdTbGFzaCA9IHRvUGF0aG5hbWUgJiYgdG9QYXRobmFtZSAhPT0gIi8iICYmIHRvUGF0aG5hbWUuZW5kc1dpdGgoIi8iKTsgLy8gT3IgaWYgdGhpcyB3YXMgYSBsaW5rIHRvIHRoZSBjdXJyZW50IHBhdGggd2hpY2ggaGFzIGEgdHJhaWxpbmcgc2xhc2gKCiAgICAgICAgICAgIHZhciBoYXNDdXJyZW50VHJhaWxpbmdTbGFzaCA9IChpc0VtcHR5UGF0aCB8fCB0b1BhdGhuYW1lID09PSAiLiIpICYmIGxvY2F0aW9uUGF0aG5hbWUuZW5kc1dpdGgoIi8iKTsKCiAgICAgICAgICAgIGlmICghcGF0aC5wYXRobmFtZS5lbmRzV2l0aCgiLyIpICYmIChoYXNFeHBsaWNpdFRyYWlsaW5nU2xhc2ggfHwgaGFzQ3VycmVudFRyYWlsaW5nU2xhc2gpKSB7CiAgICAgICAgICAgICAgcGF0aC5wYXRobmFtZSArPSAiLyI7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybiBwYXRoOwogICAgICAgICAgfQogICAgICAgICAgLyoqCiAgICAgICAgICAgKiBAcHJpdmF0ZQogICAgICAgICAgICovCgogICAgICAgICAgZnVuY3Rpb24gZ2V0VG9QYXRobmFtZSh0bykgewogICAgICAgICAgICAvLyBFbXB0eSBzdHJpbmdzIHNob3VsZCBiZSB0cmVhdGVkIHRoZSBzYW1lIGFzIC8gcGF0aHMKICAgICAgICAgICAgcmV0dXJuIHRvID09PSAiIiB8fCB0by5wYXRobmFtZSA9PT0gIiIgPyAiLyIgOiB0eXBlb2YgdG8gPT09ICJzdHJpbmciID8gcGFyc2VQYXRoKHRvKS5wYXRobmFtZSA6IHRvLnBhdGhuYW1lOwogICAgICAgICAgfQogICAgICAgICAgLyoqCiAgICAgICAgICAgKiBAcHJpdmF0ZQogICAgICAgICAgICovCgogICAgICAgICAgdmFyIHJvdXRlcl9qb2luUGF0aHMgPSAocGF0aHMpID0+IHBhdGhzLmpvaW4oIi8iKS5yZXBsYWNlKC9cL1wvKy9nLCAiLyIpOwogICAgICAgICAgLyoqCiAgICAgICAgICAgKiBAcHJpdmF0ZQogICAgICAgICAgICovCgogICAgICAgICAgdmFyIG5vcm1hbGl6ZVBhdGhuYW1lID0gKHBhdGhuYW1lKSA9PiBwYXRobmFtZS5yZXBsYWNlKC9cLyskLywgIiIpLnJlcGxhY2UoL15cLyovLCAiLyIpOwogICAgICAgICAgLyoqCiAgICAgICAgICAgKiBAcHJpdmF0ZQogICAgICAgICAgICovCgogICAgICAgICAgdmFyIG5vcm1hbGl6ZVNlYXJjaCA9IChzZWFyY2gpID0+ICFzZWFyY2ggfHwgc2VhcmNoID09PSAiPyIgPyAiIiA6IHNlYXJjaC5zdGFydHNXaXRoKCI/IikgPyBzZWFyY2ggOiAiPyIgKyBzZWFyY2g7CiAgICAgICAgICAvKioKICAgICAgICAgICAqIEBwcml2YXRlCiAgICAgICAgICAgKi8KCiAgICAgICAgICB2YXIgbm9ybWFsaXplSGFzaCA9IChoYXNoKSA9PiAhaGFzaCB8fCBoYXNoID09PSAiIyIgPyAiIiA6IGhhc2guc3RhcnRzV2l0aCgiIyIpID8gaGFzaCA6ICIjIiArIGhhc2g7CiAgICAgICAgICAvKioKICAgICAgICAgICAqIFRoaXMgaXMgYSBzaG9ydGN1dCBmb3IgY3JlYXRpbmcgYGFwcGxpY2F0aW9uL2pzb25gIHJlc3BvbnNlcy4gQ29udmVydHMgYGRhdGFgCiAgICAgICAgICAgKiB0byBKU09OIGFuZCBzZXRzIHRoZSBgQ29udGVudC1UeXBlYCBoZWFkZXIuCiAgICAgICAgICAgKi8KCiAgICAgICAgICB2YXIganNvbiA9IGZ1bmN0aW9uIGpzb24oZGF0YSwgaW5pdCkgewogICAgICAgICAgICBpZiAoaW5pdCA9PT0gdm9pZCAwKSB7CiAgICAgICAgICAgICAgaW5pdCA9IHt9OwogICAgICAgICAgICB9CgogICAgICAgICAgICB2YXIgcmVzcG9uc2VJbml0ID0gdHlwZW9mIGluaXQgPT09ICJudW1iZXIiID8gewogICAgICAgICAgICAgIHN0YXR1czogaW5pdAogICAgICAgICAgICB9IDogaW5pdDsKICAgICAgICAgICAgdmFyIGhlYWRlcnMgPSBuZXcgSGVhZGVycyhyZXNwb25zZUluaXQuaGVhZGVycyk7CgogICAgICAgICAgICBpZiAoIWhlYWRlcnMuaGFzKCJDb250ZW50LVR5cGUiKSkgewogICAgICAgICAgICAgIGhlYWRlcnMuc2V0KCJDb250ZW50LVR5cGUiLCAiYXBwbGljYXRpb24vanNvbjsgY2hhcnNldD11dGYtOCIpOwogICAgICAgICAgICB9CgogICAgICAgICAgICByZXR1cm4gbmV3IFJlc3BvbnNlKEpTT04uc3RyaW5naWZ5KGRhdGEpLCBfZXh0ZW5kcyh7fSwgcmVzcG9uc2VJbml0LCB7CiAgICAgICAgICAgICAgaGVhZGVyczogaGVhZGVycwogICAgICAgICAgICB9KSk7CiAgICAgICAgICB9O3ZhcgogICAgICAgICAgcm91dGVyX0Fib3J0ZWREZWZlcnJlZEVycm9yID0gLyojX19QVVJFX18qL2Z1bmN0aW9uIChfRXJyb3IpIHtfaW5oZXJpdHMocm91dGVyX0Fib3J0ZWREZWZlcnJlZEVycm9yLCBfRXJyb3IpO3ZhciBfc3VwZXIgPSBfY3JlYXRlU3VwZXIocm91dGVyX0Fib3J0ZWREZWZlcnJlZEVycm9yKTtmdW5jdGlvbiByb3V0ZXJfQWJvcnRlZERlZmVycmVkRXJyb3IoKSB7X2NsYXNzQ2FsbENoZWNrMih0aGlzLCByb3V0ZXJfQWJvcnRlZERlZmVycmVkRXJyb3IpO3JldHVybiBfc3VwZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKTt9cmV0dXJuIF9jcmVhdGVDbGFzczIocm91dGVyX0Fib3J0ZWREZWZlcnJlZEVycm9yKTt9KCAvKiNfX1BVUkVfXyovX3dyYXBOYXRpdmVTdXBlcihFcnJvcikpO3ZhcgogICAgICAgICAgRGVmZXJyZWREYXRhID0gLyojX19QVVJFX18qL2Z1bmN0aW9uICgpIHsKICAgICAgICAgICAgZnVuY3Rpb24gRGVmZXJyZWREYXRhKGRhdGEpIHtfY2xhc3NDYWxsQ2hlY2syKHRoaXMsIERlZmVycmVkRGF0YSk7CiAgICAgICAgICAgICAgdGhpcy5wZW5kaW5nS2V5cyA9IG5ldyBTZXQoKTsKICAgICAgICAgICAgICB0aGlzLnN1YnNjcmliZXIgPSB1bmRlZmluZWQ7CiAgICAgICAgICAgICAgcm91dGVyX2ludmFyaWFudChkYXRhICYmIHR5cGVvZiBkYXRhID09PSAib2JqZWN0IiAmJiAhQXJyYXkuaXNBcnJheShkYXRhKSwgImRlZmVyKCkgb25seSBhY2NlcHRzIHBsYWluIG9iamVjdHMiKTsgLy8gU2V0IHVwIGFuIEFib3J0Q29udHJvbGxlciArIFByb21pc2Ugd2UgY2FuIHJhY2UgYWdhaW5zdCB0byBleGl0IGVhcmx5CiAgICAgICAgICAgICAgLy8gY2FuY2VsbGF0aW9uCgogICAgICAgICAgICAgIHZhciByZWplY3Q7CiAgICAgICAgICAgICAgdGhpcy5hYm9ydFByb21pc2UgPSBuZXcgUHJvbWlzZSgoXywgcikgPT4gcmVqZWN0ID0gcik7CiAgICAgICAgICAgICAgdGhpcy5jb250cm9sbGVyID0gbmV3IEFib3J0Q29udHJvbGxlcigpOwoKICAgICAgICAgICAgICB2YXIgb25BYm9ydCA9ICgpID0+IHJlamVjdChuZXcgcm91dGVyX0Fib3J0ZWREZWZlcnJlZEVycm9yKCJEZWZlcnJlZCBkYXRhIGFib3J0ZWQiKSk7CgogICAgICAgICAgICAgIHRoaXMudW5saXN0ZW5BYm9ydFNpZ25hbCA9ICgpID0+IHRoaXMuY29udHJvbGxlci5zaWduYWwucmVtb3ZlRXZlbnRMaXN0ZW5lcigiYWJvcnQiLCBvbkFib3J0KTsKCiAgICAgICAgICAgICAgdGhpcy5jb250cm9sbGVyLnNpZ25hbC5hZGRFdmVudExpc3RlbmVyKCJhYm9ydCIsIG9uQWJvcnQpOwogICAgICAgICAgICAgIHRoaXMuZGF0YSA9IE9iamVjdC5lbnRyaWVzKGRhdGEpLnJlZHVjZSgoYWNjLCBfcmVmKSA9PiB7CiAgICAgICAgICAgICAgICB2YXIgX3JlZjEyID0gX3NsaWNlZFRvQXJyYXkyKF9yZWYsIDIpLGtleSA9IF9yZWYxMlswXSx2YWx1ZSA9IF9yZWYxMlsxXTsKICAgICAgICAgICAgICAgIHJldHVybiBPYmplY3QuYXNzaWduKGFjYywgX2RlZmluZVByb3BlcnR5Mih7fSwKICAgICAgICAgICAgICAgIGtleSwgdGhpcy50cmFja1Byb21pc2Uoa2V5LCB2YWx1ZSkpKTsKCiAgICAgICAgICAgICAgfSwge30pOwogICAgICAgICAgICB9X2NyZWF0ZUNsYXNzMihEZWZlcnJlZERhdGEsIFt7IGtleTogInRyYWNrUHJvbWlzZSIsIHZhbHVlOgoKICAgICAgICAgICAgICBmdW5jdGlvbiB0cmFja1Byb21pc2Uoa2V5LCB2YWx1ZSkgewogICAgICAgICAgICAgICAgaWYgKCEodmFsdWUgaW5zdGFuY2VvZiBQcm9taXNlKSkgewogICAgICAgICAgICAgICAgICByZXR1cm4gdmFsdWU7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgdGhpcy5wZW5kaW5nS2V5cy5hZGQoa2V5KTsgLy8gV2Ugc3RvcmUgYSBsaXR0bGUgd3JhcHBlciBwcm9taXNlIHRoYXQgd2lsbCBiZSBleHRlbmRlZCB3aXRoCiAgICAgICAgICAgICAgICAvLyBfZGF0YS9fZXJyb3IgcHJvcHMgdXBvbiByZXNvbHZlL3JlamVjdAoKICAgICAgICAgICAgICAgIHZhciBwcm9taXNlID0gUHJvbWlzZS5yYWNlKFt2YWx1ZSwgdGhpcy5hYm9ydFByb21pc2VdKS50aGVuKChkYXRhKSA9PiB0aGlzLm9uU2V0dGxlKHByb21pc2UsIGtleSwgbnVsbCwgZGF0YSksIChlcnJvcikgPT4gdGhpcy5vblNldHRsZShwcm9taXNlLCBrZXksIGVycm9yKSk7IC8vIFJlZ2lzdGVyIHJlamVjdGlvbiBsaXN0ZW5lcnMgdG8gYXZvaWQgdW5jYXVnaHQgcHJvbWlzZSByZWplY3Rpb25zIG9uCiAgICAgICAgICAgICAgICAvLyBlcnJvcnMgb3IgYWJvcnRlZCBkZWZlcnJlZCB2YWx1ZXMKCiAgICAgICAgICAgICAgICBwcm9taXNlLmNhdGNoKCgpID0+IHt9KTsKICAgICAgICAgICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShwcm9taXNlLCAiX3RyYWNrZWQiLCB7CiAgICAgICAgICAgICAgICAgIGdldDogKCkgPT4gdHJ1ZQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICByZXR1cm4gcHJvbWlzZTsKICAgICAgICAgICAgICB9IH0sIHsga2V5OiAib25TZXR0bGUiLCB2YWx1ZToKCiAgICAgICAgICAgICAgZnVuY3Rpb24gb25TZXR0bGUocHJvbWlzZSwga2V5LCBlcnJvciwgZGF0YSkgewogICAgICAgICAgICAgICAgaWYgKHRoaXMuY29udHJvbGxlci5zaWduYWwuYWJvcnRlZCAmJiBlcnJvciBpbnN0YW5jZW9mIHJvdXRlcl9BYm9ydGVkRGVmZXJyZWRFcnJvcikgewogICAgICAgICAgICAgICAgICB0aGlzLnVubGlzdGVuQWJvcnRTaWduYWwoKTsKICAgICAgICAgICAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHByb21pc2UsICJfZXJyb3IiLCB7CiAgICAgICAgICAgICAgICAgICAgZ2V0OiAoKSA9PiBlcnJvcgogICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KGVycm9yKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICB0aGlzLnBlbmRpbmdLZXlzLmRlbGV0ZShrZXkpOwoKICAgICAgICAgICAgICAgIGlmICh0aGlzLmRvbmUpIHsKICAgICAgICAgICAgICAgICAgLy8gTm90aGluZyBsZWZ0IHRvIGFib3J0IQogICAgICAgICAgICAgICAgICB0aGlzLnVubGlzdGVuQWJvcnRTaWduYWwoKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICB2YXIgc3Vic2NyaWJlciA9IHRoaXMuc3Vic2NyaWJlcjsKCiAgICAgICAgICAgICAgICBpZiAoZXJyb3IpIHsKICAgICAgICAgICAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHByb21pc2UsICJfZXJyb3IiLCB7CiAgICAgICAgICAgICAgICAgICAgZ2V0OiAoKSA9PiBlcnJvcgogICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgc3Vic2NyaWJlciAmJiBzdWJzY3JpYmVyKGZhbHNlKTsKICAgICAgICAgICAgICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KGVycm9yKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkocHJvbWlzZSwgIl9kYXRhIiwgewogICAgICAgICAgICAgICAgICBnZXQ6ICgpID0+IGRhdGEKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgc3Vic2NyaWJlciAmJiBzdWJzY3JpYmVyKGZhbHNlKTsKICAgICAgICAgICAgICAgIHJldHVybiBkYXRhOwogICAgICAgICAgICAgIH0gfSwgeyBrZXk6ICJzdWJzY3JpYmUiLCB2YWx1ZToKCiAgICAgICAgICAgICAgZnVuY3Rpb24gc3Vic2NyaWJlKGZuKSB7CiAgICAgICAgICAgICAgICB0aGlzLnN1YnNjcmliZXIgPSBmbjsKICAgICAgICAgICAgICB9IH0sIHsga2V5OiAiY2FuY2VsIiwgdmFsdWU6CgogICAgICAgICAgICAgIGZ1bmN0aW9uIGNhbmNlbCgpIHsKICAgICAgICAgICAgICAgIHRoaXMuY29udHJvbGxlci5hYm9ydCgpOwogICAgICAgICAgICAgICAgdGhpcy5wZW5kaW5nS2V5cy5mb3JFYWNoKCh2LCBrKSA9PiB0aGlzLnBlbmRpbmdLZXlzLmRlbGV0ZShrKSk7CiAgICAgICAgICAgICAgICB2YXIgc3Vic2NyaWJlciA9IHRoaXMuc3Vic2NyaWJlcjsKICAgICAgICAgICAgICAgIHN1YnNjcmliZXIgJiYgc3Vic2NyaWJlcih0cnVlKTsKICAgICAgICAgICAgICB9IH0sIHsga2V5OiAicmVzb2x2ZURhdGEiLCB2YWx1ZTogZnVuY3Rpb24gKCkge3ZhciBfcmVzb2x2ZURhdGEgPSBfYXN5bmNUb0dlbmVyYXRvcjIoIC8qI19fUFVSRV9fKi9fcmVnZW5lcmF0b3JSdW50aW1lMigpLm1hcmsoCgogICAgICAgICAgICAgICAgZnVuY3Rpb24gX2NhbGxlZTQoc2lnbmFsKSB7dmFyIGFib3J0ZWQsIG9uQWJvcnQ7cmV0dXJuIF9yZWdlbmVyYXRvclJ1bnRpbWUyKCkud3JhcChmdW5jdGlvbiBfY2FsbGVlNCQoX2NvbnRleHQ0KSB7d2hpbGUgKDEpIHtzd2l0Y2ggKF9jb250ZXh0NC5wcmV2ID0gX2NvbnRleHQ0Lm5leHQpIHtjYXNlIDA6CiAgICAgICAgICAgICAgICAgICAgICAgICAgYWJvcnRlZCA9IGZhbHNlO2lmICgKCiAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5kb25lKSB7X2NvbnRleHQ0Lm5leHQgPSA3O2JyZWFrO30KICAgICAgICAgICAgICAgICAgICAgICAgICBvbkFib3J0ID0gKCkgPT4gdGhpcy5jYW5jZWwoKTsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgc2lnbmFsLmFkZEV2ZW50TGlzdGVuZXIoImFib3J0Iiwgb25BYm9ydCk7X2NvbnRleHQ0Lm5leHQgPSA2O3JldHVybiAoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnN1YnNjcmliZSgoYWJvcnRlZCkgPT4gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNpZ25hbC5yZW1vdmVFdmVudExpc3RlbmVyKCJhYm9ydCIsIG9uQWJvcnQpOwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoYWJvcnRlZCB8fCB0aGlzLmRvbmUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUoYWJvcnRlZCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pKTtjYXNlIDY6YWJvcnRlZCA9IF9jb250ZXh0NC5zZW50O2Nhc2UgNzpyZXR1cm4gX2NvbnRleHQ0LmFicnVwdCgicmV0dXJuIiwKCgogICAgICAgICAgICAgICAgICAgICAgICAgIGFib3J0ZWQpO2Nhc2UgODpjYXNlICJlbmQiOnJldHVybiBfY29udGV4dDQuc3RvcCgpO319fSwgX2NhbGxlZTQsIHRoaXMpO30pKTtmdW5jdGlvbiByZXNvbHZlRGF0YShfeDUpIHtyZXR1cm4gX3Jlc29sdmVEYXRhLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7fXJldHVybiByZXNvbHZlRGF0YTt9KCkgfSwgeyBrZXk6ICJkb25lIiwgZ2V0OgoKCiAgICAgICAgICAgICAgZnVuY3Rpb24gZ2V0KCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMucGVuZGluZ0tleXMuc2l6ZSA9PT0gMDsKICAgICAgICAgICAgICB9IH0sIHsga2V5OiAidW53cmFwcGVkRGF0YSIsIGdldDoKCiAgICAgICAgICAgICAgZnVuY3Rpb24gZ2V0KCkgewogICAgICAgICAgICAgICAgcm91dGVyX2ludmFyaWFudCh0aGlzLmRhdGEgIT09IG51bGwgJiYgdGhpcy5kb25lLCAiQ2FuIG9ubHkgdW53cmFwIGRhdGEgb24gaW5pdGlhbGl6ZWQgYW5kIHNldHRsZWQgZGVmZXJyZWRzIik7CiAgICAgICAgICAgICAgICByZXR1cm4gT2JqZWN0LmVudHJpZXModGhpcy5kYXRhKS5yZWR1Y2UoKGFjYywgX3JlZjIpID0+IHsKICAgICAgICAgICAgICAgICAgdmFyIF9yZWYxMyA9IF9zbGljZWRUb0FycmF5MihfcmVmMiwgMiksa2V5ID0gX3JlZjEzWzBdLHZhbHVlID0gX3JlZjEzWzFdOwogICAgICAgICAgICAgICAgICByZXR1cm4gT2JqZWN0LmFzc2lnbihhY2MsIF9kZWZpbmVQcm9wZXJ0eTIoe30sCiAgICAgICAgICAgICAgICAgIGtleSwgdW53cmFwVHJhY2tlZFByb21pc2UodmFsdWUpKSk7CgogICAgICAgICAgICAgICAgfSwge30pOwogICAgICAgICAgICAgIH0gfV0pO3JldHVybiBEZWZlcnJlZERhdGE7fSgpOwoKCgogICAgICAgICAgZnVuY3Rpb24gaXNUcmFja2VkUHJvbWlzZSh2YWx1ZSkgewogICAgICAgICAgICByZXR1cm4gdmFsdWUgaW5zdGFuY2VvZiBQcm9taXNlICYmIHZhbHVlLl90cmFja2VkID09PSB0cnVlOwogICAgICAgICAgfQoKICAgICAgICAgIGZ1bmN0aW9uIHVud3JhcFRyYWNrZWRQcm9taXNlKHZhbHVlKSB7CiAgICAgICAgICAgIGlmICghaXNUcmFja2VkUHJvbWlzZSh2YWx1ZSkpIHsKICAgICAgICAgICAgICByZXR1cm4gdmFsdWU7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmICh2YWx1ZS5fZXJyb3IpIHsKICAgICAgICAgICAgICB0aHJvdyB2YWx1ZS5fZXJyb3I7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybiB2YWx1ZS5fZGF0YTsKICAgICAgICAgIH0KCiAgICAgICAgICBmdW5jdGlvbiBkZWZlcihkYXRhKSB7CiAgICAgICAgICAgIHJldHVybiBuZXcgRGVmZXJyZWREYXRhKGRhdGEpOwogICAgICAgICAgfQogICAgICAgICAgLyoqCiAgICAgICAgICAgKiBBIHJlZGlyZWN0IHJlc3BvbnNlLiBTZXRzIHRoZSBzdGF0dXMgY29kZSBhbmQgdGhlIGBMb2NhdGlvbmAgaGVhZGVyLgogICAgICAgICAgICogRGVmYXVsdHMgdG8gIjMwMiBGb3VuZCIuCiAgICAgICAgICAgKi8KCiAgICAgICAgICB2YXIgcmVkaXJlY3QgPSBmdW5jdGlvbiByZWRpcmVjdCh1cmwsIGluaXQpIHsKICAgICAgICAgICAgaWYgKGluaXQgPT09IHZvaWQgMCkgewogICAgICAgICAgICAgIGluaXQgPSAzMDI7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHZhciByZXNwb25zZUluaXQgPSBpbml0OwoKICAgICAgICAgICAgaWYgKHR5cGVvZiByZXNwb25zZUluaXQgPT09ICJudW1iZXIiKSB7CiAgICAgICAgICAgICAgcmVzcG9uc2VJbml0ID0gewogICAgICAgICAgICAgICAgc3RhdHVzOiByZXNwb25zZUluaXQKICAgICAgICAgICAgICB9OwogICAgICAgICAgICB9IGVsc2UgaWYgKHR5cGVvZiByZXNwb25zZUluaXQuc3RhdHVzID09PSAidW5kZWZpbmVkIikgewogICAgICAgICAgICAgIHJlc3BvbnNlSW5pdC5zdGF0dXMgPSAzMDI7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHZhciBoZWFkZXJzID0gbmV3IEhlYWRlcnMocmVzcG9uc2VJbml0LmhlYWRlcnMpOwogICAgICAgICAgICBoZWFkZXJzLnNldCgiTG9jYXRpb24iLCB1cmwpOwogICAgICAgICAgICByZXR1cm4gbmV3IFJlc3BvbnNlKG51bGwsIF9leHRlbmRzKHt9LCByZXNwb25zZUluaXQsIHsKICAgICAgICAgICAgICBoZWFkZXJzOiBoZWFkZXJzCiAgICAgICAgICAgIH0pKTsKICAgICAgICAgIH07CiAgICAgICAgICAvKioKICAgICAgICAgICAqIEBwcml2YXRlCiAgICAgICAgICAgKiBVdGlsaXR5IGNsYXNzIHdlIHVzZSB0byBob2xkIGF1dG8tdW53cmFwcGVkIDR4eC81eHggUmVzcG9uc2UgYm9kaWVzCiAgICAgICAgICAgKi92YXIKCiAgICAgICAgICBFcnJvclJlc3BvbnNlID0gLyojX19QVVJFX18qL19jcmVhdGVDbGFzczIoCiAgICAgICAgICBmdW5jdGlvbiBFcnJvclJlc3BvbnNlKHN0YXR1cywgc3RhdHVzVGV4dCwgZGF0YSkge19jbGFzc0NhbGxDaGVjazIodGhpcywgRXJyb3JSZXNwb25zZSk7CiAgICAgICAgICAgIHRoaXMuc3RhdHVzID0gc3RhdHVzOwogICAgICAgICAgICB0aGlzLnN0YXR1c1RleHQgPSBzdGF0dXNUZXh0IHx8ICIiOwogICAgICAgICAgICB0aGlzLmRhdGEgPSBkYXRhOwogICAgICAgICAgfSk7CgoKICAgICAgICAgIC8qKgogICAgICAgICAgICogQ2hlY2sgaWYgdGhlIGdpdmVuIGVycm9yIGlzIGFuIEVycm9yUmVzcG9uc2UgZ2VuZXJhdGVkIGZyb20gYSA0eHgvNXh4CiAgICAgICAgICAgKiBSZXNwb25zZSB0aHJvdyBmcm9tIGFuIGFjdGlvbi9sb2FkZXIKICAgICAgICAgICAqLwoKICAgICAgICAgIGZ1bmN0aW9uIGlzUm91dGVFcnJvclJlc3BvbnNlKGUpIHsKICAgICAgICAgICAgcmV0dXJuIGUgaW5zdGFuY2VvZiBFcnJvclJlc3BvbnNlOwogICAgICAgICAgfQoKICAgICAgICAgIHZhciBJRExFX05BVklHQVRJT04gPSB7CiAgICAgICAgICAgIHN0YXRlOiAiaWRsZSIsCiAgICAgICAgICAgIGxvY2F0aW9uOiB1bmRlZmluZWQsCiAgICAgICAgICAgIGZvcm1NZXRob2Q6IHVuZGVmaW5lZCwKICAgICAgICAgICAgZm9ybUFjdGlvbjogdW5kZWZpbmVkLAogICAgICAgICAgICBmb3JtRW5jVHlwZTogdW5kZWZpbmVkLAogICAgICAgICAgICBmb3JtRGF0YTogdW5kZWZpbmVkCiAgICAgICAgICB9OwogICAgICAgICAgdmFyIElETEVfRkVUQ0hFUiA9IHsKICAgICAgICAgICAgc3RhdGU6ICJpZGxlIiwKICAgICAgICAgICAgZGF0YTogdW5kZWZpbmVkLAogICAgICAgICAgICBmb3JtTWV0aG9kOiB1bmRlZmluZWQsCiAgICAgICAgICAgIGZvcm1BY3Rpb246IHVuZGVmaW5lZCwKICAgICAgICAgICAgZm9ybUVuY1R5cGU6IHVuZGVmaW5lZCwKICAgICAgICAgICAgZm9ybURhdGE6IHVuZGVmaW5lZAogICAgICAgICAgfTsKICAgICAgICAgIHZhciBpc0Jyb3dzZXIgPSB0eXBlb2Ygd2luZG93ICE9PSAidW5kZWZpbmVkIiAmJiB0eXBlb2Ygd2luZG93LmRvY3VtZW50ICE9PSAidW5kZWZpbmVkIiAmJiB0eXBlb2Ygd2luZG93LmRvY3VtZW50LmNyZWF0ZUVsZW1lbnQgIT09ICJ1bmRlZmluZWQiOwogICAgICAgICAgdmFyIGlzU2VydmVyID0gIWlzQnJvd3NlcjsgLy8jZW5kcmVnaW9uCiAgICAgICAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwogICAgICAgICAgLy8jcmVnaW9uIGNyZWF0ZVJvdXRlcgogICAgICAgICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KCiAgICAgICAgICAvKioKICAgICAgICAgICAqIENyZWF0ZSBhIHJvdXRlciBhbmQgbGlzdGVuIHRvIGhpc3RvcnkgUE9QIG5hdmlnYXRpb25zCiAgICAgICAgICAgKi8KCiAgICAgICAgICBmdW5jdGlvbiByb3V0ZXJfY3JlYXRlUm91dGVyKGluaXQpIHsKICAgICAgICAgICAgcm91dGVyX2ludmFyaWFudChpbml0LnJvdXRlcy5sZW5ndGggPiAwLCAiWW91IG11c3QgcHJvdmlkZSBhIG5vbi1lbXB0eSByb3V0ZXMgYXJyYXkgdG8gY3JlYXRlUm91dGVyIik7CiAgICAgICAgICAgIHZhciBkYXRhUm91dGVzID0gY29udmVydFJvdXRlc1RvRGF0YVJvdXRlcyhpbml0LnJvdXRlcyk7IC8vIENsZWFudXAgZnVuY3Rpb24gZm9yIGhpc3RvcnkKCiAgICAgICAgICAgIHZhciB1bmxpc3Rlbkhpc3RvcnkgPSBudWxsOyAvLyBFeHRlcm5hbGx5LXByb3ZpZGVkIGZ1bmN0aW9ucyB0byBjYWxsIG9uIGFsbCBzdGF0ZSBjaGFuZ2VzCgogICAgICAgICAgICB2YXIgc3Vic2NyaWJlcnMgPSBuZXcgU2V0KCk7IC8vIEV4dGVybmFsbHktcHJvdmlkZWQgb2JqZWN0IHRvIGhvbGQgc2Nyb2xsIHJlc3RvcmF0aW9uIGxvY2F0aW9ucyBkdXJpbmcgcm91dGluZwoKICAgICAgICAgICAgdmFyIHNhdmVkU2Nyb2xsUG9zaXRpb25zID0gbnVsbDsgLy8gRXh0ZXJuYWxseS1wcm92aWRlZCBmdW5jdGlvbiB0byBnZXQgc2Nyb2xsIHJlc3RvcmF0aW9uIGtleXMKCiAgICAgICAgICAgIHZhciBnZXRTY3JvbGxSZXN0b3JhdGlvbktleSA9IG51bGw7IC8vIEV4dGVybmFsbHktcHJvdmlkZWQgZnVuY3Rpb24gdG8gZ2V0IGN1cnJlbnQgc2Nyb2xsIHBvc2l0aW9uCgogICAgICAgICAgICB2YXIgZ2V0U2Nyb2xsUG9zaXRpb24gPSBudWxsOyAvLyBPbmUtdGltZSBmbGFnIHRvIGNvbnRyb2wgdGhlIGluaXRpYWwgaHlkcmF0aW9uIHNjcm9sbCByZXN0b3JhdGlvbi4gIEJlY2F1c2UKICAgICAgICAgICAgLy8gd2UgZG9uJ3QgZ2V0IHRoZSBzYXZlZCBwb3NpdGlvbnMgZnJvbSA8U2Nyb2xsUmVzdG9yYXRpb24gLz4gdW50aWwgX2FmdGVyXwogICAgICAgICAgICAvLyB0aGUgaW5pdGlhbCByZW5kZXIsIHdlIG5lZWQgdG8gbWFudWFsbHkgdHJpZ2dlciBhIHNlcGFyYXRlIHVwZGF0ZVN0YXRlIHRvCiAgICAgICAgICAgIC8vIHNlbmQgYWxvbmcgdGhlIHJlc3RvcmVTY3JvbGxQb3NpdGlvbgoKICAgICAgICAgICAgdmFyIGluaXRpYWxTY3JvbGxSZXN0b3JlZCA9IGZhbHNlOwogICAgICAgICAgICB2YXIgaW5pdGlhbE1hdGNoZXMgPSBtYXRjaFJvdXRlcyhkYXRhUm91dGVzLCBpbml0Lmhpc3RvcnkubG9jYXRpb24sIGluaXQuYmFzZW5hbWUpOwogICAgICAgICAgICB2YXIgaW5pdGlhbEVycm9ycyA9IG51bGw7CgogICAgICAgICAgICBpZiAoaW5pdGlhbE1hdGNoZXMgPT0gbnVsbCkgewogICAgICAgICAgICAgIC8vIElmIHdlIGRvIG5vdCBtYXRjaCBhIHVzZXItcHJvdmlkZWQtcm91dGUsIGZhbGwgYmFjayB0byB0aGUgcm9vdAogICAgICAgICAgICAgIC8vIHRvIGFsbG93IHRoZSBlcnJvciBib3VuZGFyeSB0byB0YWtlIG92ZXIKICAgICAgICAgICAgICB2YXIgX2dldE5vdEZvdW5kTWF0Y2hlcyA9CgoKCiAgICAgICAgICAgICAgICBnZXROb3RGb3VuZE1hdGNoZXMoZGF0YVJvdXRlcyksbWF0Y2hlcyA9IF9nZXROb3RGb3VuZE1hdGNoZXMubWF0Y2hlcyxyb3V0ZSA9IF9nZXROb3RGb3VuZE1hdGNoZXMucm91dGUsZXJyb3IgPSBfZ2V0Tm90Rm91bmRNYXRjaGVzLmVycm9yOwogICAgICAgICAgICAgIGluaXRpYWxNYXRjaGVzID0gbWF0Y2hlczsKICAgICAgICAgICAgICBpbml0aWFsRXJyb3JzID0gX2RlZmluZVByb3BlcnR5Mih7fSwKICAgICAgICAgICAgICByb3V0ZS5pZCwgZXJyb3IpOwoKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdmFyIGluaXRpYWxpemVkID0gIWluaXRpYWxNYXRjaGVzLnNvbWUoKG0pID0+IG0ucm91dGUubG9hZGVyKSB8fCBpbml0Lmh5ZHJhdGlvbkRhdGEgIT0gbnVsbDsKICAgICAgICAgICAgdmFyIHJvdXRlcjsKICAgICAgICAgICAgdmFyIHN0YXRlID0gewogICAgICAgICAgICAgIGhpc3RvcnlBY3Rpb246IGluaXQuaGlzdG9yeS5hY3Rpb24sCiAgICAgICAgICAgICAgbG9jYXRpb246IGluaXQuaGlzdG9yeS5sb2NhdGlvbiwKICAgICAgICAgICAgICBtYXRjaGVzOiBpbml0aWFsTWF0Y2hlcywKICAgICAgICAgICAgICBpbml0aWFsaXplZDogaW5pdGlhbGl6ZWQsCiAgICAgICAgICAgICAgbmF2aWdhdGlvbjogSURMRV9OQVZJR0FUSU9OLAogICAgICAgICAgICAgIHJlc3RvcmVTY3JvbGxQb3NpdGlvbjogbnVsbCwKICAgICAgICAgICAgICBwcmV2ZW50U2Nyb2xsUmVzZXQ6IGZhbHNlLAogICAgICAgICAgICAgIHJldmFsaWRhdGlvbjogImlkbGUiLAogICAgICAgICAgICAgIGxvYWRlckRhdGE6IGluaXQuaHlkcmF0aW9uRGF0YSAmJiBpbml0Lmh5ZHJhdGlvbkRhdGEubG9hZGVyRGF0YSB8fCB7fSwKICAgICAgICAgICAgICBhY3Rpb25EYXRhOiBpbml0Lmh5ZHJhdGlvbkRhdGEgJiYgaW5pdC5oeWRyYXRpb25EYXRhLmFjdGlvbkRhdGEgfHwgbnVsbCwKICAgICAgICAgICAgICBlcnJvcnM6IGluaXQuaHlkcmF0aW9uRGF0YSAmJiBpbml0Lmh5ZHJhdGlvbkRhdGEuZXJyb3JzIHx8IGluaXRpYWxFcnJvcnMsCiAgICAgICAgICAgICAgZmV0Y2hlcnM6IG5ldyBNYXAoKQogICAgICAgICAgICB9OyAvLyAtLSBTdGF0ZWZ1bCBpbnRlcm5hbCB2YXJpYWJsZXMgdG8gbWFuYWdlIG5hdmlnYXRpb25zIC0tCiAgICAgICAgICAgIC8vIEN1cnJlbnQgbmF2aWdhdGlvbiBpbiBwcm9ncmVzcyAodG8gYmUgY29tbWl0dGVkIGluIGNvbXBsZXRlTmF2aWdhdGlvbikKCiAgICAgICAgICAgIHZhciBwZW5kaW5nQWN0aW9uID0gQWN0aW9uLlBvcDsgLy8gU2hvdWxkIHRoZSBjdXJyZW50IG5hdmlnYXRpb24gcHJldmVudCB0aGUgc2Nyb2xsIHJlc2V0IGlmIHNjcm9sbCBjYW5ub3QKICAgICAgICAgICAgLy8gYmUgcmVzdG9yZWQ/CgogICAgICAgICAgICB2YXIgcGVuZGluZ1ByZXZlbnRTY3JvbGxSZXNldCA9IGZhbHNlOyAvLyBBYm9ydENvbnRyb2xsZXIgZm9yIHRoZSBhY3RpdmUgbmF2aWdhdGlvbgoKICAgICAgICAgICAgdmFyIHBlbmRpbmdOYXZpZ2F0aW9uQ29udHJvbGxlcjsgLy8gV2UgdXNlIHRoaXMgdG8gYXZvaWQgdG91Y2hpbmcgaGlzdG9yeSBpbiBjb21wbGV0ZU5hdmlnYXRpb24gaWYgYQogICAgICAgICAgICAvLyByZXZhbGlkYXRpb24gaXMgZW50aXJlbHkgdW5pbnRlcnJ1cHRlZAoKICAgICAgICAgICAgdmFyIGlzVW5pbnRlcnJ1cHRlZFJldmFsaWRhdGlvbiA9IGZhbHNlOyAvLyBVc2UgdGhpcyBpbnRlcm5hbCBmbGFnIHRvIGZvcmNlIHJldmFsaWRhdGlvbiBvZiBhbGwgbG9hZGVyczoKICAgICAgICAgICAgLy8gIC0gc3VibWlzc2lvbnMgKGNvbXBsZXRlZCBvciBpbnRlcnJ1cHRlZCkKICAgICAgICAgICAgLy8gIC0gdXNlUmV2YWxpZGF0ZSgpCiAgICAgICAgICAgIC8vICAtIFgtUmVtaXgtUmV2YWxpZGF0ZSAoZnJvbSByZWRpcmVjdCkKCiAgICAgICAgICAgIHZhciBpc1JldmFsaWRhdGlvblJlcXVpcmVkID0gZmFsc2U7IC8vIFVzZSB0aGlzIGludGVybmFsIGFycmF5IHRvIGNhcHR1cmUgcm91dGVzIHRoYXQgcmVxdWlyZSByZXZhbGlkYXRpb24gZHVlCiAgICAgICAgICAgIC8vIHRvIGEgY2FuY2VsbGVkIGRlZmVycmVkIG9uIGFjdGlvbiBzdWJtaXNzaW9uCgogICAgICAgICAgICB2YXIgY2FuY2VsbGVkRGVmZXJyZWRSb3V0ZXMgPSBbXTsgLy8gVXNlIHRoaXMgaW50ZXJuYWwgYXJyYXkgdG8gY2FwdHVyZSBmZXRjaGVyIGxvYWRzIHRoYXQgd2VyZSBjYW5jZWxsZWQgYnkgYW4KICAgICAgICAgICAgLy8gYWN0aW9uIG5hdmlnYXRpb24gYW5kIHJlcXVpcmUgcmV2YWxpZGF0aW9uCgogICAgICAgICAgICB2YXIgY2FuY2VsbGVkRmV0Y2hlckxvYWRzID0gW107IC8vIEFib3J0Q29udHJvbGxlcnMgZm9yIGFueSBpbi1mbGlnaHQgZmV0Y2hlcnMKCiAgICAgICAgICAgIHZhciBmZXRjaENvbnRyb2xsZXJzID0gbmV3IE1hcCgpOyAvLyBUcmFjayBsb2FkcyBiYXNlZCBvbiB0aGUgb3JkZXIgaW4gd2hpY2ggdGhleSBzdGFydGVkCgogICAgICAgICAgICB2YXIgaW5jcmVtZW50aW5nTG9hZElkID0gMDsgLy8gVHJhY2sgdGhlIG91dHN0YW5kaW5nIHBlbmRpbmcgbmF2aWdhdGlvbiBkYXRhIGxvYWQgdG8gYmUgY29tcGFyZWQgYWdhaW5zdAogICAgICAgICAgICAvLyB0aGUgZ2xvYmFsbHkgaW5jcmVtZW50aW5nIGxvYWQgd2hlbiBhIGZldGNoZXIgbG9hZCBsYW5kcyBhZnRlciBhIGNvbXBsZXRlZAogICAgICAgICAgICAvLyBuYXZpZ2F0aW9uCgogICAgICAgICAgICB2YXIgcGVuZGluZ05hdmlnYXRpb25Mb2FkSWQgPSAtMTsgLy8gRmV0Y2hlcnMgdGhhdCB0cmlnZ2VyZWQgZGF0YSByZWxvYWRzIGFzIGEgcmVzdWx0IG9mIHRoZWlyIGFjdGlvbnMKCiAgICAgICAgICAgIHZhciBmZXRjaFJlbG9hZElkcyA9IG5ldyBNYXAoKTsgLy8gRmV0Y2hlcnMgdGhhdCB0cmlnZ2VyZWQgcmVkaXJlY3QgbmF2aWdhdGlvbnMgZnJvbSB0aGVpciBhY3Rpb25zCgogICAgICAgICAgICB2YXIgZmV0Y2hSZWRpcmVjdElkcyA9IG5ldyBTZXQoKTsgLy8gTW9zdCByZWNlbnQgaHJlZi9tYXRjaCBmb3IgZmV0Y2hlci5sb2FkIGNhbGxzIGZvciBmZXRjaGVycwoKICAgICAgICAgICAgdmFyIGZldGNoTG9hZE1hdGNoZXMgPSBuZXcgTWFwKCk7IC8vIFN0b3JlIERlZmVycmVkRGF0YSBpbnN0YW5jZXMgZm9yIGFjdGl2ZSByb3V0ZSBtYXRjaGVzLiAgV2hlbiBhCiAgICAgICAgICAgIC8vIHJvdXRlIGxvYWRlciByZXR1cm5zIGRlZmVyKCkgd2Ugc3RpY2sgb25lIGluIGhlcmUuICBUaGVuLCB3aGVuIGEgbmVzdGVkCiAgICAgICAgICAgIC8vIHByb21pc2UgcmVzb2x2ZXMgd2UgdXBkYXRlIGxvYWRlckRhdGEuICBJZiBhIG5ldyBuYXZpZ2F0aW9uIHN0YXJ0cyB3ZQogICAgICAgICAgICAvLyBjYW5jZWwgYWN0aXZlIGRlZmVycmVkcyBmb3IgZWxpbWluYXRlZCByb3V0ZXMuCgogICAgICAgICAgICB2YXIgYWN0aXZlRGVmZXJyZWRzID0gbmV3IE1hcCgpOyAvLyBJbml0aWFsaXplIHRoZSByb3V0ZXIsIGFsbCBzaWRlIGVmZmVjdHMgc2hvdWxkIGJlIGtpY2tlZCBvZmYgZnJvbSBoZXJlLgogICAgICAgICAgICAvLyBJbXBsZW1lbnRlZCBhcyBhIEZsdWVudCBBUEkgZm9yIGVhc2Ugb2Y6CiAgICAgICAgICAgIC8vICAgbGV0IHJvdXRlciA9IGNyZWF0ZVJvdXRlcihpbml0KS5pbml0aWFsaXplKCk7CgogICAgICAgICAgICBmdW5jdGlvbiBpbml0aWFsaXplKCkgewogICAgICAgICAgICAgIC8vIElmIGhpc3RvcnkgaW5mb3JtcyB1cyBvZiBhIFBPUCBuYXZpZ2F0aW9uLCBzdGFydCB0aGUgbmF2aWdhdGlvbiBidXQgZG8gbm90IHVwZGF0ZQogICAgICAgICAgICAgIC8vIHN0YXRlLiAgV2UnbGwgdXBkYXRlIG91ciBvd24gc3RhdGUgb25jZSB0aGUgbmF2aWdhdGlvbiBjb21wbGV0ZXMKICAgICAgICAgICAgICB1bmxpc3Rlbkhpc3RvcnkgPSBpbml0Lmhpc3RvcnkubGlzdGVuKChfcmVmKSA9PiB7CiAgICAgICAgICAgICAgICB2YXIKICAgICAgICAgICAgICAgICAgaGlzdG9yeUFjdGlvbiA9CgogICAgICAgICAgICAgICAgICBfcmVmLmFjdGlvbixsb2NhdGlvbiA9IF9yZWYubG9jYXRpb247CiAgICAgICAgICAgICAgICByZXR1cm4gc3RhcnROYXZpZ2F0aW9uKGhpc3RvcnlBY3Rpb24sIGxvY2F0aW9uKTsKICAgICAgICAgICAgICB9KTsgLy8gS2ljayBvZmYgaW5pdGlhbCBkYXRhIGxvYWQgaWYgbmVlZGVkLiAgVXNlIFBvcCB0byBhdm9pZCBtb2RpZnlpbmcgaGlzdG9yeQoKICAgICAgICAgICAgICBpZiAoIXN0YXRlLmluaXRpYWxpemVkKSB7CiAgICAgICAgICAgICAgICBzdGFydE5hdmlnYXRpb24oQWN0aW9uLlBvcCwgc3RhdGUubG9jYXRpb24pOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgcmV0dXJuIHJvdXRlcjsKICAgICAgICAgICAgfSAvLyBDbGVhbiB1cCBhIHJvdXRlciBhbmQgaXQncyBzaWRlIGVmZmVjdHMKCgogICAgICAgICAgICBmdW5jdGlvbiBkaXNwb3NlKCkgewogICAgICAgICAgICAgIGlmICh1bmxpc3Rlbkhpc3RvcnkpIHsKICAgICAgICAgICAgICAgIHVubGlzdGVuSGlzdG9yeSgpOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgc3Vic2NyaWJlcnMuY2xlYXIoKTsKICAgICAgICAgICAgICBwZW5kaW5nTmF2aWdhdGlvbkNvbnRyb2xsZXIgJiYgcGVuZGluZ05hdmlnYXRpb25Db250cm9sbGVyLmFib3J0KCk7CiAgICAgICAgICAgICAgc3RhdGUuZmV0Y2hlcnMuZm9yRWFjaCgoXywga2V5KSA9PiBkZWxldGVGZXRjaGVyKGtleSkpOwogICAgICAgICAgICB9IC8vIFN1YnNjcmliZSB0byBzdGF0ZSB1cGRhdGVzIGZvciB0aGUgcm91dGVyCgoKICAgICAgICAgICAgZnVuY3Rpb24gc3Vic2NyaWJlKGZuKSB7CiAgICAgICAgICAgICAgc3Vic2NyaWJlcnMuYWRkKGZuKTsKICAgICAgICAgICAgICByZXR1cm4gKCkgPT4gc3Vic2NyaWJlcnMuZGVsZXRlKGZuKTsKICAgICAgICAgICAgfSAvLyBVcGRhdGUgb3VyIHN0YXRlIGFuZCBub3RpZnkgdGhlIGNhbGxpbmcgY29udGV4dCBvZiB0aGUgY2hhbmdlCgoKICAgICAgICAgICAgZnVuY3Rpb24gdXBkYXRlU3RhdGUobmV3U3RhdGUpIHsKICAgICAgICAgICAgICBzdGF0ZSA9IF9leHRlbmRzKHt9LCBzdGF0ZSwgbmV3U3RhdGUpOwogICAgICAgICAgICAgIHN1YnNjcmliZXJzLmZvckVhY2goKHN1YnNjcmliZXIpID0+IHN1YnNjcmliZXIoc3RhdGUpKTsKICAgICAgICAgICAgfSAvLyBDb21wbGV0ZSBhIG5hdmlnYXRpb24gcmV0dXJuaW5nIHRoZSBzdGF0ZS5uYXZpZ2F0aW9uIGJhY2sgdG8gdGhlIElETEVfTkFWSUdBVElPTgogICAgICAgICAgICAvLyBhbmQgc2V0dGluZyBzdGF0ZS5baGlzdG9yeUFjdGlvbi9sb2NhdGlvbi9tYXRjaGVzXSB0byB0aGUgbmV3IHJvdXRlLgogICAgICAgICAgICAvLyAtIExvY2F0aW9uIGlzIGEgcmVxdWlyZWQgcGFyYW0KICAgICAgICAgICAgLy8gLSBOYXZpZ2F0aW9uIHdpbGwgYWx3YXlzIGJlIHNldCB0byBJRExFX05BVklHQVRJT04KICAgICAgICAgICAgLy8gLSBDYW4gcGFzcyBhbnkgb3RoZXIgc3RhdGUgaW4gbmV3U3RhdGUKCgogICAgICAgICAgICBmdW5jdGlvbiBjb21wbGV0ZU5hdmlnYXRpb24obG9jYXRpb24sIG5ld1N0YXRlKSB7CiAgICAgICAgICAgICAgdmFyIF9zdGF0ZSRuYXZpZ2F0aW9uJGZvcjsKCiAgICAgICAgICAgICAgLy8gRGVkdWNlIGlmIHdlJ3JlIGluIGEgbG9hZGluZy9hY3Rpb25SZWxvYWQgc3RhdGU6CiAgICAgICAgICAgICAgLy8gLSBXZSBoYXZlIGNvbW1pdHRlZCBhY3Rpb25EYXRhIGluIHRoZSBzdG9yZQogICAgICAgICAgICAgIC8vIC0gVGhlIGN1cnJlbnQgbmF2aWdhdGlvbiB3YXMgYSBzdWJtaXNzaW9uCiAgICAgICAgICAgICAgLy8gLSBXZSdyZSBwYXN0IHRoZSBzdWJtaXR0aW5nIHN0YXRlIGFuZCBpbnRvIHRoZSBsb2FkaW5nIHN0YXRlCiAgICAgICAgICAgICAgLy8gLSBUaGUgbG9jYXRpb24gd2UndmUgZmluaXNoZWQgbG9hZGluZyBpcyBkaWZmZXJlbnQgZnJvbSB0aGUgc3VibWlzc2lvbgogICAgICAgICAgICAgIC8vICAgbG9jYXRpb24sIGluZGljYXRpbmcgd2UgcmVkaXJlY3RlZCBmcm9tIHRoZSBhY3Rpb24gKGF2b2lkcyBmYWxzZQogICAgICAgICAgICAgIC8vICAgcG9zaXRpdmVzIGZvciBsb2FkaW5nL3N1Ym1pc3Npb25SZWRpcmVjdCB3aGVuIGFjdGlvbkRhdGEgcmV0dXJuZWQKICAgICAgICAgICAgICAvLyAgIG9uIGEgcHJpb3Igc3VibWlzc2lvbikKICAgICAgICAgICAgICB2YXIgaXNBY3Rpb25SZWxvYWQgPSBzdGF0ZS5hY3Rpb25EYXRhICE9IG51bGwgJiYgc3RhdGUubmF2aWdhdGlvbi5mb3JtTWV0aG9kICE9IG51bGwgJiYgc3RhdGUubmF2aWdhdGlvbi5zdGF0ZSA9PT0gImxvYWRpbmciICYmICgoX3N0YXRlJG5hdmlnYXRpb24kZm9yID0gc3RhdGUubmF2aWdhdGlvbi5mb3JtQWN0aW9uKSA9PSBudWxsID8gdm9pZCAwIDogX3N0YXRlJG5hdmlnYXRpb24kZm9yLnNwbGl0KCI/IilbMF0pID09PSBsb2NhdGlvbi5wYXRobmFtZTsgLy8gQWx3YXlzIHByZXNlcnZlIGFueSBleGlzdGluZyBsb2FkZXJEYXRhIGZyb20gcmUtdXNlZCByb3V0ZXMKCiAgICAgICAgICAgICAgdmFyIG5ld0xvYWRlckRhdGEgPSBuZXdTdGF0ZS5sb2FkZXJEYXRhID8gewogICAgICAgICAgICAgICAgbG9hZGVyRGF0YTogbWVyZ2VMb2FkZXJEYXRhKHN0YXRlLmxvYWRlckRhdGEsIG5ld1N0YXRlLmxvYWRlckRhdGEsIG5ld1N0YXRlLm1hdGNoZXMgfHwgW10pCiAgICAgICAgICAgICAgfSA6IHt9OwogICAgICAgICAgICAgIHVwZGF0ZVN0YXRlKF9leHRlbmRzKHt9LCBpc0FjdGlvblJlbG9hZCA/IHt9IDogewogICAgICAgICAgICAgICAgYWN0aW9uRGF0YTogbnVsbAogICAgICAgICAgICAgIH0sIG5ld1N0YXRlLCBuZXdMb2FkZXJEYXRhLCB7CiAgICAgICAgICAgICAgICBoaXN0b3J5QWN0aW9uOiBwZW5kaW5nQWN0aW9uLAogICAgICAgICAgICAgICAgbG9jYXRpb246IGxvY2F0aW9uLAogICAgICAgICAgICAgICAgaW5pdGlhbGl6ZWQ6IHRydWUsCiAgICAgICAgICAgICAgICBuYXZpZ2F0aW9uOiBJRExFX05BVklHQVRJT04sCiAgICAgICAgICAgICAgICByZXZhbGlkYXRpb246ICJpZGxlIiwKICAgICAgICAgICAgICAgIC8vIERvbid0IHJlc3RvcmUgb24gc3VibWlzc2lvbiBuYXZpZ2F0aW9ucwogICAgICAgICAgICAgICAgcmVzdG9yZVNjcm9sbFBvc2l0aW9uOiBzdGF0ZS5uYXZpZ2F0aW9uLmZvcm1EYXRhID8gZmFsc2UgOiBnZXRTYXZlZFNjcm9sbFBvc2l0aW9uKGxvY2F0aW9uLCBuZXdTdGF0ZS5tYXRjaGVzIHx8IHN0YXRlLm1hdGNoZXMpLAogICAgICAgICAgICAgICAgcHJldmVudFNjcm9sbFJlc2V0OiBwZW5kaW5nUHJldmVudFNjcm9sbFJlc2V0CiAgICAgICAgICAgICAgfSkpOwoKICAgICAgICAgICAgICBpZiAoaXNVbmludGVycnVwdGVkUmV2YWxpZGF0aW9uKSA7ZWxzZSBpZiAocGVuZGluZ0FjdGlvbiA9PT0gQWN0aW9uLlBvcCkgO2Vsc2UgaWYgKHBlbmRpbmdBY3Rpb24gPT09IEFjdGlvbi5QdXNoKSB7CiAgICAgICAgICAgICAgICBpbml0Lmhpc3RvcnkucHVzaChsb2NhdGlvbiwgbG9jYXRpb24uc3RhdGUpOwogICAgICAgICAgICAgIH0gZWxzZSBpZiAocGVuZGluZ0FjdGlvbiA9PT0gQWN0aW9uLlJlcGxhY2UpIHsKICAgICAgICAgICAgICAgIGluaXQuaGlzdG9yeS5yZXBsYWNlKGxvY2F0aW9uLCBsb2NhdGlvbi5zdGF0ZSk7CiAgICAgICAgICAgICAgfSAvLyBSZXNldCBzdGF0ZWZ1bCBuYXZpZ2F0aW9uIHZhcnMKCgogICAgICAgICAgICAgIHBlbmRpbmdBY3Rpb24gPSBBY3Rpb24uUG9wOwogICAgICAgICAgICAgIHBlbmRpbmdQcmV2ZW50U2Nyb2xsUmVzZXQgPSBmYWxzZTsKICAgICAgICAgICAgICBpc1VuaW50ZXJydXB0ZWRSZXZhbGlkYXRpb24gPSBmYWxzZTsKICAgICAgICAgICAgICBpc1JldmFsaWRhdGlvblJlcXVpcmVkID0gZmFsc2U7CiAgICAgICAgICAgICAgY2FuY2VsbGVkRGVmZXJyZWRSb3V0ZXMgPSBbXTsKICAgICAgICAgICAgICBjYW5jZWxsZWRGZXRjaGVyTG9hZHMgPSBbXTsKICAgICAgICAgICAgfSAvLyBUcmlnZ2VyIGEgbmF2aWdhdGlvbiBldmVudCwgd2hpY2ggY2FuIGVpdGhlciBiZSBhIG51bWVyaWNhbCBQT1Agb3IgYSBQVVNICiAgICAgICAgICAgIC8vIHJlcGxhY2Ugd2l0aCBhbiBvcHRpb25hbCBzdWJtaXNzaW9uCiAgICAgICAgICAgIGZ1bmN0aW9uCgogICAgICAgICAgICBuYXZpZ2F0ZShfeDYsIF94Nykge3JldHVybiBfbmF2aWdhdGUuYXBwbHkodGhpcywgYXJndW1lbnRzKTt9CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCiAgICAgICAgICAgIC8vIFJldmFsaWRhdGUgYWxsIGN1cnJlbnQgbG9hZGVycy4gIElmIGEgbmF2aWdhdGlvbiBpcyBpbiBwcm9ncmVzcyBvciBpZiB0aGlzCiAgICAgICAgICAgIC8vIGlzIGludGVycnVwdGVkIGJ5IGEgbmF2aWdhdGlvbiwgYWxsb3cgdGhpcyB0byAic3VjY2VlZCIgYnkgY2FsbGluZyBhbGwKICAgICAgICAgICAgLy8gbG9hZGVycyBkdXJpbmcgdGhlIG5leHQgbG9hZGVyIHJvdW5kCiAgICAgICAgICAgIGZ1bmN0aW9uIF9uYXZpZ2F0ZSgpIHtfbmF2aWdhdGUgPSBfYXN5bmNUb0dlbmVyYXRvcjIoIC8qI19fUFVSRV9fKi9fcmVnZW5lcmF0b3JSdW50aW1lMigpLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTUodG8sIG9wdHMpIHt2YXIgX25vcm1hbGl6ZU5hdmlnYXRlT3B0MiwgcGF0aCwgc3VibWlzc2lvbiwgZXJyb3IsIGxvY2F0aW9uLCBoaXN0b3J5QWN0aW9uLCBwcmV2ZW50U2Nyb2xsUmVzZXQ7cmV0dXJuIF9yZWdlbmVyYXRvclJ1bnRpbWUyKCkud3JhcChmdW5jdGlvbiBfY2FsbGVlNSQoX2NvbnRleHQ1KSB7d2hpbGUgKDEpIHtzd2l0Y2ggKF9jb250ZXh0NS5wcmV2ID0gX2NvbnRleHQ1Lm5leHQpIHtjYXNlIDA6aWYgKCEodHlwZW9mIHRvID09PSAibnVtYmVyIikpIHtfY29udGV4dDUubmV4dCA9IDM7YnJlYWs7fWluaXQuaGlzdG9yeS5nbyh0byk7cmV0dXJuIF9jb250ZXh0NS5hYnJ1cHQoInJldHVybiIpO2Nhc2UgMzpfbm9ybWFsaXplTmF2aWdhdGVPcHQyID0gbm9ybWFsaXplTmF2aWdhdGVPcHRpb25zKHRvLCBvcHRzKSwgcGF0aCA9IF9ub3JtYWxpemVOYXZpZ2F0ZU9wdDIucGF0aCwgc3VibWlzc2lvbiA9IF9ub3JtYWxpemVOYXZpZ2F0ZU9wdDIuc3VibWlzc2lvbiwgZXJyb3IgPSBfbm9ybWFsaXplTmF2aWdhdGVPcHQyLmVycm9yO2xvY2F0aW9uID0gY3JlYXRlTG9jYXRpb24oc3RhdGUubG9jYXRpb24sIHBhdGgsIG9wdHMgJiYgb3B0cy5zdGF0ZSk7IC8vIFdoZW4gdXNpbmcgbmF2aWdhdGUgYXMgYSBQVVNIL1JFUExBQ0Ugd2UgYXJlbid0IHJlYWRpbmcgYW4gYWxyZWFkeS1lbmNvZGVkCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFVSTCBmcm9tIHdpbmRvdy5sb2NhdGlvbiwgc28gd2UgbmVlZCB0byBlbmNvZGUgaXQgaGVyZSBzbyB0aGUgYmVoYXZpb3IKICAgICAgICAgICAgICAgICAgICAgICAgLy8gcmVtYWlucyB0aGUgc2FtZSBhcyBQT1AgYW5kIG5vbi1kYXRhLXJvdXRlciB1c2FnZXMuICBuZXcgVVJMKCkgZG9lcyBhbGwKICAgICAgICAgICAgICAgICAgICAgICAgLy8gdGhlIHNhbWUgZW5jb2Rpbmcgd2UnZCBnZXQgZnJvbSBhIGhpc3RvcnkucHVzaFN0YXRlL3dpbmRvdy5sb2NhdGlvbiByZWFkCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIHdpdGhvdXQgaGF2aW5nIHRvIHRvdWNoIGhpc3RvcnkKICAgICAgICAgICAgICAgICAgICAgICAgbG9jYXRpb24gPSBpbml0Lmhpc3RvcnkuZW5jb2RlTG9jYXRpb24obG9jYXRpb24pO2hpc3RvcnlBY3Rpb24gPSAob3B0cyAmJiBvcHRzLnJlcGxhY2UpID09PSB0cnVlIHx8IHN1Ym1pc3Npb24gIT0gbnVsbCA/IEFjdGlvbi5SZXBsYWNlIDogQWN0aW9uLlB1c2g7cHJldmVudFNjcm9sbFJlc2V0ID0gb3B0cyAmJiAicHJldmVudFNjcm9sbFJlc2V0IiBpbiBvcHRzID8gb3B0cy5wcmV2ZW50U2Nyb2xsUmVzZXQgPT09IHRydWUgOiB1bmRlZmluZWQ7X2NvbnRleHQ1Lm5leHQgPSAxMDtyZXR1cm4gc3RhcnROYXZpZ2F0aW9uKGhpc3RvcnlBY3Rpb24sIGxvY2F0aW9uLCB7IHN1Ym1pc3Npb246IHN1Ym1pc3Npb24sIC8vIFNlbmQgdGhyb3VnaCB0aGUgZm9ybURhdGEgc2VyaWFsaXphdGlvbiBlcnJvciBpZiB3ZSBoYXZlIG9uZSBzbyB3ZSBjYW4KICAgICAgICAgICAgICAgICAgICAgICAgICAvLyByZW5kZXIgYXQgdGhlIHJpZ2h0IGVycm9yIGJvdW5kYXJ5IGFmdGVyIHdlIG1hdGNoIHJvdXRlcwogICAgICAgICAgICAgICAgICAgICAgICAgIHBlbmRpbmdFcnJvcjogZXJyb3IsIHByZXZlbnRTY3JvbGxSZXNldDogcHJldmVudFNjcm9sbFJlc2V0LCByZXBsYWNlOiBvcHRzICYmIG9wdHMucmVwbGFjZSB9KTtjYXNlIDEwOnJldHVybiBfY29udGV4dDUuYWJydXB0KCJyZXR1cm4iLCBfY29udGV4dDUuc2VudCk7Y2FzZSAxMTpjYXNlICJlbmQiOnJldHVybiBfY29udGV4dDUuc3RvcCgpO319fSwgX2NhbGxlZTUpO30pKTtyZXR1cm4gX25hdmlnYXRlLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7fWZ1bmN0aW9uIHJldmFsaWRhdGUoKSB7aW50ZXJydXB0QWN0aXZlTG9hZHMoKTt1cGRhdGVTdGF0ZSh7IHJldmFsaWRhdGlvbjogImxvYWRpbmciIH0pOyAvLyBJZiB3ZSdyZSBjdXJyZW50bHkgc3VibWl0dGluZyBhbiBhY3Rpb24sIHdlIGRvbid0IG5lZWQgdG8gc3RhcnQgYSBuZXcKICAgICAgICAgICAgICAvLyBuYXZpZ2F0aW9uLCB3ZSdsbCBqdXN0IGxldCB0aGUgZm9sbG93IHVwIGxvYWRlciBleGVjdXRpb24gY2FsbCBhbGwgbG9hZGVycwogICAgICAgICAgICAgIGlmIChzdGF0ZS5uYXZpZ2F0aW9uLnN0YXRlID09PSAic3VibWl0dGluZyIpIHsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICB9IC8vIElmIHdlJ3JlIGN1cnJlbnRseSBpbiBhbiBpZGxlIHN0YXRlLCBzdGFydCBhIG5ldyBuYXZpZ2F0aW9uIGZvciB0aGUgY3VycmVudAogICAgICAgICAgICAgIC8vIGFjdGlvbi9sb2NhdGlvbiBhbmQgbWFyayBpdCBhcyB1bmludGVycnVwdGVkLCB3aGljaCB3aWxsIHNraXAgdGhlIGhpc3RvcnkKICAgICAgICAgICAgICAvLyB1cGRhdGUgaW4gY29tcGxldGVOYXZpZ2F0aW9uCgoKICAgICAgICAgICAgICBpZiAoc3RhdGUubmF2aWdhdGlvbi5zdGF0ZSA9PT0gImlkbGUiKSB7CiAgICAgICAgICAgICAgICBzdGFydE5hdmlnYXRpb24oc3RhdGUuaGlzdG9yeUFjdGlvbiwgc3RhdGUubG9jYXRpb24sIHsKICAgICAgICAgICAgICAgICAgc3RhcnRVbmludGVycnVwdGVkUmV2YWxpZGF0aW9uOiB0cnVlCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICB9IC8vIE90aGVyd2lzZSwgaWYgd2UncmUgY3VycmVudGx5IGluIGEgbG9hZGluZyBzdGF0ZSwganVzdCBzdGFydCBhIG5ldwogICAgICAgICAgICAgIC8vIG5hdmlnYXRpb24gdG8gdGhlIG5hdmlnYXRpb24ubG9jYXRpb24gYnV0IGRvIG5vdCB0cmlnZ2VyIGFuIHVuaW50ZXJydXB0ZWQKICAgICAgICAgICAgICAvLyByZXZhbGlkYXRpb24gc28gdGhhdCBoaXN0b3J5IGNvcnJlY3RseSB1cGRhdGVzIG9uY2UgdGhlIG5hdmlnYXRpb24gY29tcGxldGVzCgoKICAgICAgICAgICAgICBzdGFydE5hdmlnYXRpb24ocGVuZGluZ0FjdGlvbiB8fCBzdGF0ZS5oaXN0b3J5QWN0aW9uLCBzdGF0ZS5uYXZpZ2F0aW9uLmxvY2F0aW9uLCB7CiAgICAgICAgICAgICAgICBvdmVycmlkZU5hdmlnYXRpb246IHN0YXRlLm5hdmlnYXRpb24KICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSAvLyBTdGFydCBhIG5hdmlnYXRpb24gdG8gdGhlIGdpdmVuIGFjdGlvbi9sb2NhdGlvbi4gIENhbiBvcHRpb25hbGx5IHByb3ZpZGUgYQogICAgICAgICAgICAvLyBvdmVycmlkZU5hdmlnYXRpb24gd2hpY2ggd2lsbCBvdmVycmlkZSB0aGUgbm9ybWFsTG9hZCBpbiB0aGUgY2FzZSBvZiBhIHJlZGlyZWN0CiAgICAgICAgICAgIC8vIG5hdmlnYXRpb24KICAgICAgICAgICAgZnVuY3Rpb24KCiAgICAgICAgICAgIHN0YXJ0TmF2aWdhdGlvbihfeDgsIF94OSwgX3gxMCkge3JldHVybiBfc3RhcnROYXZpZ2F0aW9uLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7fQoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCiAgICAgICAgICAgIC8vIENhbGwgdGhlIGFjdGlvbiBtYXRjaGVkIGJ5IHRoZSBsZWFmIHJvdXRlIGZvciB0aGlzIG5hdmlnYXRpb24gYW5kIGhhbmRsZQogICAgICAgICAgICAvLyByZWRpcmVjdHMvZXJyb3JzCiAgICAgICAgICAgIGZ1bmN0aW9uIF9zdGFydE5hdmlnYXRpb24oKSB7X3N0YXJ0TmF2aWdhdGlvbiA9IF9hc3luY1RvR2VuZXJhdG9yMiggLyojX19QVVJFX18qL19yZWdlbmVyYXRvclJ1bnRpbWUyKCkubWFyayhmdW5jdGlvbiBfY2FsbGVlNihoaXN0b3J5QWN0aW9uLCBsb2NhdGlvbiwgb3B0cykge3ZhciBsb2FkaW5nTmF2aWdhdGlvbiwgbWF0Y2hlcywgX2dldE5vdEZvdW5kTWF0Y2hlczIsIG5vdEZvdW5kTWF0Y2hlcywgX3JvdXRlLCBfZXJyb3IsIHJlcXVlc3QsIHBlbmRpbmdBY3Rpb25EYXRhLCBwZW5kaW5nRXJyb3IsIGFjdGlvbk91dHB1dCwgbmF2aWdhdGlvbiwgX3lpZWxkJGhhbmRsZUxvYWRlcnMsIHNob3J0Q2lyY3VpdGVkLCBsb2FkZXJEYXRhLCBlcnJvcnM7cmV0dXJuIF9yZWdlbmVyYXRvclJ1bnRpbWUyKCkud3JhcChmdW5jdGlvbiBfY2FsbGVlNiQoX2NvbnRleHQ2KSB7d2hpbGUgKDEpIHtzd2l0Y2ggKF9jb250ZXh0Ni5wcmV2ID0gX2NvbnRleHQ2Lm5leHQpIHtjYXNlIDA6IC8vIEFib3J0IGFueSBpbi1wcm9ncmVzcyBuYXZpZ2F0aW9ucyBhbmQgc3RhcnQgYSBuZXcgb25lLiBVbnNldCBhbnkgb25nb2luZwogICAgICAgICAgICAgICAgICAgICAgICAvLyB1bmludGVycnVwdGVkIHJldmFsaWRhdGlvbnMgdW5sZXNzIHRvbGQgb3RoZXJ3aXNlLCBzaW5jZSB3ZSB3YW50IHRoaXMKICAgICAgICAgICAgICAgICAgICAgICAgLy8gbmV3IG5hdmlnYXRpb24gdG8gdXBkYXRlIGhpc3Rvcnkgbm9ybWFsbHkKICAgICAgICAgICAgICAgICAgICAgICAgcGVuZGluZ05hdmlnYXRpb25Db250cm9sbGVyICYmIHBlbmRpbmdOYXZpZ2F0aW9uQ29udHJvbGxlci5hYm9ydCgpO3BlbmRpbmdOYXZpZ2F0aW9uQ29udHJvbGxlciA9IG51bGw7cGVuZGluZ0FjdGlvbiA9IGhpc3RvcnlBY3Rpb247aXNVbmludGVycnVwdGVkUmV2YWxpZGF0aW9uID0gKG9wdHMgJiYgb3B0cy5zdGFydFVuaW50ZXJydXB0ZWRSZXZhbGlkYXRpb24pID09PSB0cnVlOyAvLyBTYXZlIHRoZSBjdXJyZW50IHNjcm9sbCBwb3NpdGlvbiBldmVyeSB0aW1lIHdlIHN0YXJ0IGEgbmV3IG5hdmlnYXRpb24sCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIGFuZCB0cmFjayB3aGV0aGVyIHdlIHNob3VsZCByZXNldCBzY3JvbGwgb24gY29tcGxldGlvbgogICAgICAgICAgICAgICAgICAgICAgICBzYXZlU2Nyb2xsUG9zaXRpb24oc3RhdGUubG9jYXRpb24sIHN0YXRlLm1hdGNoZXMpO3BlbmRpbmdQcmV2ZW50U2Nyb2xsUmVzZXQgPSAob3B0cyAmJiBvcHRzLnByZXZlbnRTY3JvbGxSZXNldCkgPT09IHRydWU7bG9hZGluZ05hdmlnYXRpb24gPSBvcHRzICYmIG9wdHMub3ZlcnJpZGVOYXZpZ2F0aW9uO21hdGNoZXMgPSBtYXRjaFJvdXRlcyhkYXRhUm91dGVzLCBsb2NhdGlvbiwgaW5pdC5iYXNlbmFtZSk7IC8vIFNob3J0IGNpcmN1aXQgd2l0aCBhIDQwNCBvbiB0aGUgcm9vdCBlcnJvciBib3VuZGFyeSBpZiB3ZSBtYXRjaCBub3RoaW5nCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChtYXRjaGVzKSB7X2NvbnRleHQ2Lm5leHQgPSAxMzticmVhazt9X2dldE5vdEZvdW5kTWF0Y2hlczIgPSBnZXROb3RGb3VuZE1hdGNoZXMoZGF0YVJvdXRlcyksIG5vdEZvdW5kTWF0Y2hlcyA9IF9nZXROb3RGb3VuZE1hdGNoZXMyLm1hdGNoZXMsIF9yb3V0ZSA9IF9nZXROb3RGb3VuZE1hdGNoZXMyLnJvdXRlLCBfZXJyb3IgPSBfZ2V0Tm90Rm91bmRNYXRjaGVzMi5lcnJvcjsgLy8gQ2FuY2VsIGFsbCBwZW5kaW5nIGRlZmVycmVkIG9uIDQwNHMgc2luY2Ugd2UgZG9uJ3Qga2VlcCBhbnkgcm91dGVzCiAgICAgICAgICAgICAgICAgICAgICAgIGNhbmNlbEFjdGl2ZURlZmVycmVkcygpO2NvbXBsZXRlTmF2aWdhdGlvbihsb2NhdGlvbiwgeyBtYXRjaGVzOiBub3RGb3VuZE1hdGNoZXMsIGxvYWRlckRhdGE6IHt9LCBlcnJvcnM6IF9kZWZpbmVQcm9wZXJ0eTIoe30sIF9yb3V0ZS5pZCwgX2Vycm9yKSB9KTtyZXR1cm4gX2NvbnRleHQ2LmFicnVwdCgicmV0dXJuIik7Y2FzZSAxMzppZiAoIWlzSGFzaENoYW5nZU9ubHkoc3RhdGUubG9jYXRpb24sIGxvY2F0aW9uKSkge19jb250ZXh0Ni5uZXh0ID0gMTY7YnJlYWs7fWNvbXBsZXRlTmF2aWdhdGlvbihsb2NhdGlvbiwgeyBtYXRjaGVzOiBtYXRjaGVzIH0pO3JldHVybiBfY29udGV4dDYuYWJydXB0KCJyZXR1cm4iKTtjYXNlIDE2OiAvLyBDcmVhdGUgYSBjb250cm9sbGVyL1JlcXVlc3QgZm9yIHRoaXMgbmF2aWdhdGlvbgogICAgICAgICAgICAgICAgICAgICAgICBwZW5kaW5nTmF2aWdhdGlvbkNvbnRyb2xsZXIgPSBuZXcgQWJvcnRDb250cm9sbGVyKCk7cmVxdWVzdCA9IGNyZWF0ZVJlcXVlc3QobG9jYXRpb24sIHBlbmRpbmdOYXZpZ2F0aW9uQ29udHJvbGxlci5zaWduYWwsIG9wdHMgJiYgb3B0cy5zdWJtaXNzaW9uKTtpZiAoIShvcHRzICYmIG9wdHMucGVuZGluZ0Vycm9yKSkge19jb250ZXh0Ni5uZXh0ID0gMjI7YnJlYWs7fSAvLyBJZiB3ZSBoYXZlIGEgcGVuZGluZ0Vycm9yLCBpdCBtZWFucyB0aGUgdXNlciBhdHRlbXB0ZWQgYSBHRVQgc3VibWlzc2lvbgogICAgICAgICAgICAgICAgICAgICAgICAvLyB3aXRoIGJpbmFyeSBGb3JtRGF0YSBzbyBhc3NpZ24gaGVyZSBhbmQgc2tpcCB0byBoYW5kbGVMb2FkZXJzLiAgVGhhdAogICAgICAgICAgICAgICAgICAgICAgICAvLyB3YXkgd2UgaGFuZGxlIGNhbGxpbmcgbG9hZGVycyBhYm92ZSB0aGUgYm91bmRhcnkgZXRjLiAgSXQncyBub3QgcmVhbGx5CiAgICAgICAgICAgICAgICAgICAgICAgIC8vIGRpZmZlcmVudCBmcm9tIGFuIGFjdGlvbkVycm9yIGluIHRoYXQgc2Vuc2UuCiAgICAgICAgICAgICAgICAgICAgICAgIHBlbmRpbmdFcnJvciA9IF9kZWZpbmVQcm9wZXJ0eTIoe30sIGZpbmROZWFyZXN0Qm91bmRhcnkobWF0Y2hlcykucm91dGUuaWQsIG9wdHMucGVuZGluZ0Vycm9yKTtfY29udGV4dDYubmV4dCA9IDMyO2JyZWFrO2Nhc2UgMjI6aWYgKCEob3B0cyAmJiBvcHRzLnN1Ym1pc3Npb24pKSB7X2NvbnRleHQ2Lm5leHQgPSAzMjticmVhazt9X2NvbnRleHQ2Lm5leHQgPSAyNTtyZXR1cm4gaGFuZGxlQWN0aW9uKHJlcXVlc3QsIGxvY2F0aW9uLCBvcHRzLnN1Ym1pc3Npb24sIG1hdGNoZXMsIHsgcmVwbGFjZTogb3B0cy5yZXBsYWNlIH0pO2Nhc2UgMjU6YWN0aW9uT3V0cHV0ID0gX2NvbnRleHQ2LnNlbnQ7aWYgKCFhY3Rpb25PdXRwdXQuc2hvcnRDaXJjdWl0ZWQpIHtfY29udGV4dDYubmV4dCA9IDI4O2JyZWFrO31yZXR1cm4gX2NvbnRleHQ2LmFicnVwdCgicmV0dXJuIik7Y2FzZSAyODpwZW5kaW5nQWN0aW9uRGF0YSA9IGFjdGlvbk91dHB1dC5wZW5kaW5nQWN0aW9uRGF0YTtwZW5kaW5nRXJyb3IgPSBhY3Rpb25PdXRwdXQucGVuZGluZ0FjdGlvbkVycm9yO25hdmlnYXRpb24gPSBfZXh0ZW5kcyh7IHN0YXRlOiAibG9hZGluZyIsIGxvY2F0aW9uOiBsb2NhdGlvbiB9LCBvcHRzLnN1Ym1pc3Npb24pO2xvYWRpbmdOYXZpZ2F0aW9uID0gbmF2aWdhdGlvbjtjYXNlIDMyOl9jb250ZXh0Ni5uZXh0ID0gMzQ7cmV0dXJuIGhhbmRsZUxvYWRlcnMocmVxdWVzdCwgbG9jYXRpb24sIG1hdGNoZXMsIGxvYWRpbmdOYXZpZ2F0aW9uLCBvcHRzICYmIG9wdHMuc3VibWlzc2lvbiwgb3B0cyAmJiBvcHRzLnJlcGxhY2UsIHBlbmRpbmdBY3Rpb25EYXRhLCBwZW5kaW5nRXJyb3IpO2Nhc2UgMzQ6X3lpZWxkJGhhbmRsZUxvYWRlcnMgPSBfY29udGV4dDYuc2VudDtzaG9ydENpcmN1aXRlZCA9IF95aWVsZCRoYW5kbGVMb2FkZXJzLnNob3J0Q2lyY3VpdGVkO2xvYWRlckRhdGEgPSBfeWllbGQkaGFuZGxlTG9hZGVycy5sb2FkZXJEYXRhO2Vycm9ycyA9IF95aWVsZCRoYW5kbGVMb2FkZXJzLmVycm9ycztpZiAoIXNob3J0Q2lyY3VpdGVkKSB7X2NvbnRleHQ2Lm5leHQgPSA0MDticmVhazt9cmV0dXJuIF9jb250ZXh0Ni5hYnJ1cHQoInJldHVybiIpO2Nhc2UgNDA6IC8vIENsZWFuIHVwIG5vdyB0aGF0IHRoZSBhY3Rpb24vbG9hZGVycyBoYXZlIGNvbXBsZXRlZC4gIERvbid0IGNsZWFuIHVwIGlmCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIHdlIHNob3J0IGNpcmN1aXRlZCBiZWNhdXNlIHBlbmRpbmdOYXZpZ2F0aW9uQ29udHJvbGxlciB3aWxsIGhhdmUgYWxyZWFkeQogICAgICAgICAgICAgICAgICAgICAgICAvLyBiZWVuIGFzc2lnbmVkIHRvIGEgbmV3IGNvbnRyb2xsZXIgZm9yIHRoZSBuZXh0IG5hdmlnYXRpb24KICAgICAgICAgICAgICAgICAgICAgICAgcGVuZGluZ05hdmlnYXRpb25Db250cm9sbGVyID0gbnVsbDtjb21wbGV0ZU5hdmlnYXRpb24obG9jYXRpb24sIHsgbWF0Y2hlczogbWF0Y2hlcywgbG9hZGVyRGF0YTogbG9hZGVyRGF0YSwgZXJyb3JzOiBlcnJvcnMgfSk7Y2FzZSA0MjpjYXNlICJlbmQiOnJldHVybiBfY29udGV4dDYuc3RvcCgpO319fSwgX2NhbGxlZTYpO30pKTtyZXR1cm4gX3N0YXJ0TmF2aWdhdGlvbi5hcHBseSh0aGlzLCBhcmd1bWVudHMpO31mdW5jdGlvbiBoYW5kbGVBY3Rpb24oX3gxMSwgX3gxMiwgX3gxMywgX3gxNCwgX3gxNSkge3JldHVybiBfaGFuZGxlQWN0aW9uLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7fQoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCiAgICAgICAgICAgIC8vIENhbGwgYWxsIGFwcGxpY2FibGUgbG9hZGVycyBmb3IgdGhlIGdpdmVuIG1hdGNoZXMsIGhhbmRsaW5nIHJlZGlyZWN0cywKICAgICAgICAgICAgLy8gZXJyb3JzLCBldGMuCiAgICAgICAgICAgIGZ1bmN0aW9uIF9oYW5kbGVBY3Rpb24oKSB7X2hhbmRsZUFjdGlvbiA9IF9hc3luY1RvR2VuZXJhdG9yMiggLyojX19QVVJFX18qL19yZWdlbmVyYXRvclJ1bnRpbWUyKCkubWFyayhmdW5jdGlvbiBfY2FsbGVlNyhyZXF1ZXN0LCBsb2NhdGlvbiwgc3VibWlzc2lvbiwgbWF0Y2hlcywgb3B0cykge3ZhciBuYXZpZ2F0aW9uLCByZXN1bHQsIGFjdGlvbk1hdGNoLCByZWRpcmVjdE5hdmlnYXRpb24sIGJvdW5kYXJ5TWF0Y2g7cmV0dXJuIF9yZWdlbmVyYXRvclJ1bnRpbWUyKCkud3JhcChmdW5jdGlvbiBfY2FsbGVlNyQoX2NvbnRleHQ3KSB7d2hpbGUgKDEpIHtzd2l0Y2ggKF9jb250ZXh0Ny5wcmV2ID0gX2NvbnRleHQ3Lm5leHQpIHtjYXNlIDA6aW50ZXJydXB0QWN0aXZlTG9hZHMoKTsgLy8gUHV0IHVzIGluIGEgc3VibWl0dGluZyBzdGF0ZQogICAgICAgICAgICAgICAgICAgICAgICBuYXZpZ2F0aW9uID0gX2V4dGVuZHMoeyBzdGF0ZTogInN1Ym1pdHRpbmciLCBsb2NhdGlvbjogbG9jYXRpb24gfSwgc3VibWlzc2lvbik7dXBkYXRlU3RhdGUoeyBuYXZpZ2F0aW9uOiBuYXZpZ2F0aW9uIH0pOyAvLyBDYWxsIG91ciBhY3Rpb24gYW5kIGdldCB0aGUgcmVzdWx0CiAgICAgICAgICAgICAgICAgICAgICAgIGFjdGlvbk1hdGNoID0gZ2V0VGFyZ2V0TWF0Y2gobWF0Y2hlcywgbG9jYXRpb24pO2lmIChhY3Rpb25NYXRjaC5yb3V0ZS5hY3Rpb24pIHtfY29udGV4dDcubmV4dCA9IDg7YnJlYWs7fXJlc3VsdCA9IGdldE1ldGhvZE5vdEFsbG93ZWRSZXN1bHQobG9jYXRpb24pO19jb250ZXh0Ny5uZXh0ID0gMTM7YnJlYWs7Y2FzZSA4Ol9jb250ZXh0Ny5uZXh0ID0gMTA7cmV0dXJuIGNhbGxMb2FkZXJPckFjdGlvbigiYWN0aW9uIiwgcmVxdWVzdCwgYWN0aW9uTWF0Y2gsIG1hdGNoZXMsIHJvdXRlci5iYXNlbmFtZSk7Y2FzZSAxMDpyZXN1bHQgPSBfY29udGV4dDcuc2VudDtpZiAoIXJlcXVlc3Quc2lnbmFsLmFib3J0ZWQpIHtfY29udGV4dDcubmV4dCA9IDEzO2JyZWFrO31yZXR1cm4gX2NvbnRleHQ3LmFicnVwdCgicmV0dXJuIiwgeyBzaG9ydENpcmN1aXRlZDogdHJ1ZSB9KTtjYXNlIDEzOmlmICghaXNSZWRpcmVjdFJlc3VsdChyZXN1bHQpKSB7X2NvbnRleHQ3Lm5leHQgPSAxODticmVhazt9cmVkaXJlY3ROYXZpZ2F0aW9uID0gX2V4dGVuZHMoeyBzdGF0ZTogImxvYWRpbmciLCBsb2NhdGlvbjogY3JlYXRlTG9jYXRpb24oc3RhdGUubG9jYXRpb24sIHJlc3VsdC5sb2NhdGlvbikgfSwgc3VibWlzc2lvbik7X2NvbnRleHQ3Lm5leHQgPSAxNztyZXR1cm4gc3RhcnRSZWRpcmVjdE5hdmlnYXRpb24ocmVzdWx0LCByZWRpcmVjdE5hdmlnYXRpb24sIG9wdHMgJiYgb3B0cy5yZXBsYWNlKTtjYXNlIDE3OnJldHVybiBfY29udGV4dDcuYWJydXB0KCJyZXR1cm4iLCB7IHNob3J0Q2lyY3VpdGVkOiB0cnVlIH0pO2Nhc2UgMTg6aWYgKCFpc0Vycm9yUmVzdWx0KHJlc3VsdCkpIHtfY29udGV4dDcubmV4dCA9IDIyO2JyZWFrO30gLy8gU3RvcmUgb2ZmIHRoZSBwZW5kaW5nIGVycm9yIC0gd2UgdXNlIGl0IHRvIGRldGVybWluZSB3aGljaCBsb2FkZXJzCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIHRvIGNhbGwgYW5kIHdpbGwgY29tbWl0IGl0IHdoZW4gd2UgY29tcGxldGUgdGhlIG5hdmlnYXRpb24KICAgICAgICAgICAgICAgICAgICAgICAgYm91bmRhcnlNYXRjaCA9IGZpbmROZWFyZXN0Qm91bmRhcnkobWF0Y2hlcywgYWN0aW9uTWF0Y2gucm91dGUuaWQpOyAvLyBCeSBkZWZhdWx0LCBhbGwgc3VibWlzc2lvbnMgYXJlIFJFUExBQ0UgbmF2aWdhdGlvbnMsIGJ1dCBpZiB0aGUKICAgICAgICAgICAgICAgICAgICAgICAgLy8gYWN0aW9uIHRocmV3IGFuIGVycm9yIHRoYXQnbGwgYmUgcmVuZGVyZWQgaW4gYW4gZXJyb3JFbGVtZW50LCB3ZSBmYWxsCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIGJhY2sgdG8gUFVTSCBzbyB0aGF0IHRoZSB1c2VyIGNhbiB1c2UgdGhlIGJhY2sgYnV0dG9uIHRvIGdldCBiYWNrIHRvCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIHRoZSBwcmUtc3VibWlzc2lvbiBmb3JtIGxvY2F0aW9uIHRvIHRyeSBhZ2FpbgogICAgICAgICAgICAgICAgICAgICAgICBpZiAoKG9wdHMgJiYgb3B0cy5yZXBsYWNlKSAhPT0gdHJ1ZSkge3BlbmRpbmdBY3Rpb24gPSBBY3Rpb24uUHVzaDt9cmV0dXJuIF9jb250ZXh0Ny5hYnJ1cHQoInJldHVybiIsIHsgcGVuZGluZ0FjdGlvbkVycm9yOiBfZGVmaW5lUHJvcGVydHkyKHt9LCBib3VuZGFyeU1hdGNoLnJvdXRlLmlkLCByZXN1bHQuZXJyb3IpIH0pO2Nhc2UgMjI6aWYgKCFpc0RlZmVycmVkUmVzdWx0KHJlc3VsdCkpIHtfY29udGV4dDcubmV4dCA9IDI0O2JyZWFrO310aHJvdyBuZXcgRXJyb3IoImRlZmVyKCkgaXMgbm90IHN1cHBvcnRlZCBpbiBhY3Rpb25zIik7Y2FzZSAyNDpyZXR1cm4gX2NvbnRleHQ3LmFicnVwdCgicmV0dXJuIiwgeyBwZW5kaW5nQWN0aW9uRGF0YTogX2RlZmluZVByb3BlcnR5Mih7fSwgYWN0aW9uTWF0Y2gucm91dGUuaWQsIHJlc3VsdC5kYXRhKSB9KTtjYXNlIDI1OmNhc2UgImVuZCI6cmV0dXJuIF9jb250ZXh0Ny5zdG9wKCk7fX19LCBfY2FsbGVlNyk7fSkpO3JldHVybiBfaGFuZGxlQWN0aW9uLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7fWZ1bmN0aW9uIGhhbmRsZUxvYWRlcnMoX3gxNiwgX3gxNywgX3gxOCwgX3gxOSwgX3gyMCwgX3gyMSwgX3gyMiwgX3gyMykge3JldHVybiBfaGFuZGxlTG9hZGVycy5hcHBseSh0aGlzLCBhcmd1bWVudHMpO31mdW5jdGlvbiBfaGFuZGxlTG9hZGVycygpIHtfaGFuZGxlTG9hZGVycyA9IF9hc3luY1RvR2VuZXJhdG9yMiggLyojX19QVVJFX18qL19yZWdlbmVyYXRvclJ1bnRpbWUyKCkubWFyayhmdW5jdGlvbiBfY2FsbGVlOChyZXF1ZXN0LCBsb2NhdGlvbiwgbWF0Y2hlcywgb3ZlcnJpZGVOYXZpZ2F0aW9uLCBzdWJtaXNzaW9uLCByZXBsYWNlLCBwZW5kaW5nQWN0aW9uRGF0YSwgcGVuZGluZ0Vycm9yKSB7dmFyIGxvYWRpbmdOYXZpZ2F0aW9uLCBuYXZpZ2F0aW9uLCBfZ2V0TWF0Y2hlc1RvTG9hZCwgX2dldE1hdGNoZXNUb0xvYWQyLCBtYXRjaGVzVG9Mb2FkLCByZXZhbGlkYXRpbmdGZXRjaGVycywgX3lpZWxkJGNhbGxMb2FkZXJzQW5kLCByZXN1bHRzLCBsb2FkZXJSZXN1bHRzLCBmZXRjaGVyUmVzdWx0cywgcmVkaXJlY3QsIHJlZGlyZWN0TmF2aWdhdGlvbiwgX3Byb2Nlc3NMb2FkZXJEYXRhLCBsb2FkZXJEYXRhLCBlcnJvcnMsIGRpZEFib3J0RmV0Y2hMb2FkcztyZXR1cm4gX3JlZ2VuZXJhdG9yUnVudGltZTIoKS53cmFwKGZ1bmN0aW9uIF9jYWxsZWU4JChfY29udGV4dDgpIHt3aGlsZSAoMSkge3N3aXRjaCAoX2NvbnRleHQ4LnByZXYgPSBfY29udGV4dDgubmV4dCkge2Nhc2UgMDogLy8gRmlndXJlIG91dCB0aGUgcmlnaHQgbmF2aWdhdGlvbiB3ZSB3YW50IHRvIHVzZSBmb3IgZGF0YSBsb2FkaW5nCiAgICAgICAgICAgICAgICAgICAgICAgIGxvYWRpbmdOYXZpZ2F0aW9uID0gb3ZlcnJpZGVOYXZpZ2F0aW9uO2lmICghbG9hZGluZ05hdmlnYXRpb24pIHtuYXZpZ2F0aW9uID0geyBzdGF0ZTogImxvYWRpbmciLCBsb2NhdGlvbjogbG9jYXRpb24sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3JtTWV0aG9kOiB1bmRlZmluZWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3JtQWN0aW9uOiB1bmRlZmluZWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3JtRW5jVHlwZTogdW5kZWZpbmVkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9ybURhdGE6IHVuZGVmaW5lZAogICAgICAgICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgICAgICAgICAgbG9hZGluZ05hdmlnYXRpb24gPSBuYXZpZ2F0aW9uOwogICAgICAgICAgICAgICAgICAgICAgICB9X2dldE1hdGNoZXNUb0xvYWQgPQoKICAgICAgICAgICAgICAgICAgICAgICAgZ2V0TWF0Y2hlc1RvTG9hZChzdGF0ZSwgbWF0Y2hlcywgc3VibWlzc2lvbiwgbG9jYXRpb24sIGlzUmV2YWxpZGF0aW9uUmVxdWlyZWQsIGNhbmNlbGxlZERlZmVycmVkUm91dGVzLCBjYW5jZWxsZWRGZXRjaGVyTG9hZHMsIHBlbmRpbmdBY3Rpb25EYXRhLCBwZW5kaW5nRXJyb3IsIGZldGNoTG9hZE1hdGNoZXMpLCBfZ2V0TWF0Y2hlc1RvTG9hZDIgPSBfc2xpY2VkVG9BcnJheTIoX2dldE1hdGNoZXNUb0xvYWQsIDIpLCBtYXRjaGVzVG9Mb2FkID0gX2dldE1hdGNoZXNUb0xvYWQyWzBdLCByZXZhbGlkYXRpbmdGZXRjaGVycyA9IF9nZXRNYXRjaGVzVG9Mb2FkMlsxXTsgLy8gQ2FuY2VsIHBlbmRpbmcgZGVmZXJyZWRzIGZvciBuby1sb25nZXItbWF0Y2hlZCByb3V0ZXMgb3Igcm91dGVzIHdlJ3JlCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIGFib3V0IHRvIHJlbG9hZC4gIE5vdGUgdGhhdCBpZiB0aGlzIGlzIGFuIGFjdGlvbiByZWxvYWQgd2Ugd291bGQgaGF2ZQogICAgICAgICAgICAgICAgICAgICAgICAvLyBhbHJlYWR5IGNhbmNlbGxlZCBhbGwgcGVuZGluZyBkZWZlcnJlZHMgc28gdGhpcyB3b3VsZCBiZSBhIG5vLW9wCgogICAgICAgICAgICAgICAgICAgICAgICBjYW5jZWxBY3RpdmVEZWZlcnJlZHMoKHJvdXRlSWQpID0+ICEobWF0Y2hlcyAmJiBtYXRjaGVzLnNvbWUoKG0pID0+IG0ucm91dGUuaWQgPT09IHJvdXRlSWQpKSB8fCBtYXRjaGVzVG9Mb2FkICYmIG1hdGNoZXNUb0xvYWQuc29tZSgobSkgPT4gbS5yb3V0ZS5pZCA9PT0gcm91dGVJZCkpOyAvLyBTaG9ydCBjaXJjdWl0IGlmIHdlIGhhdmUgbm8gbG9hZGVycyB0byBydW4KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCEoCiAgICAgICAgICAgICAgICAgICAgICAgIG1hdGNoZXNUb0xvYWQubGVuZ3RoID09PSAwICYmIHJldmFsaWRhdGluZ0ZldGNoZXJzLmxlbmd0aCA9PT0gMCkpIHtfY29udGV4dDgubmV4dCA9IDc7YnJlYWs7fQogICAgICAgICAgICAgICAgICAgICAgICBjb21wbGV0ZU5hdmlnYXRpb24obG9jYXRpb24sIHsKICAgICAgICAgICAgICAgICAgICAgICAgICBtYXRjaGVzOiBtYXRjaGVzLAogICAgICAgICAgICAgICAgICAgICAgICAgIGxvYWRlckRhdGE6IG1lcmdlTG9hZGVyRGF0YShzdGF0ZS5sb2FkZXJEYXRhLCB7fSwgbWF0Y2hlcyksCiAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gQ29tbWl0IHBlbmRpbmcgZXJyb3IgaWYgd2UncmUgc2hvcnQgY2lyY3VpdGluZwogICAgICAgICAgICAgICAgICAgICAgICAgIGVycm9yczogcGVuZGluZ0Vycm9yIHx8IG51bGwsCiAgICAgICAgICAgICAgICAgICAgICAgICAgYWN0aW9uRGF0YTogcGVuZGluZ0FjdGlvbkRhdGEgfHwgbnVsbAogICAgICAgICAgICAgICAgICAgICAgICB9KTtyZXR1cm4gX2NvbnRleHQ4LmFicnVwdCgicmV0dXJuIiwKICAgICAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICAgIHNob3J0Q2lyY3VpdGVkOiB0cnVlCiAgICAgICAgICAgICAgICAgICAgICAgIH0pO2Nhc2UgNzoKICAgICAgICAgICAgICAgICAgICAgICAgLy8gSWYgdGhpcyBpcyBhbiB1bmludGVycnVwdGVkIHJldmFsaWRhdGlvbiwgd2UgcmVtYWluIGluIG91ciBjdXJyZW50IGlkbGUKICAgICAgICAgICAgICAgICAgICAgICAgLy8gc3RhdGUuICBJZiBub3QsIHdlIG5lZWQgdG8gc3dpdGNoIHRvIG91ciBsb2FkaW5nIHN0YXRlIGFuZCBsb2FkIGRhdGEsCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIHByZXNlcnZpbmcgYW55IG5ldyBhY3Rpb24gZGF0YSBvciBleGlzdGluZyBhY3Rpb24gZGF0YSAoaW4gdGhlIGNhc2Ugb2YKICAgICAgICAgICAgICAgICAgICAgICAgLy8gYSByZXZhbGlkYXRpb24gaW50ZXJydXB0aW5nIGFuIGFjdGlvblJlbG9hZCkKCgogICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWlzVW5pbnRlcnJ1cHRlZFJldmFsaWRhdGlvbikgewogICAgICAgICAgICAgICAgICAgICAgICAgIHJldmFsaWRhdGluZ0ZldGNoZXJzLmZvckVhY2goKF9yZWYyKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgX3JlZjE0ID0gX3NsaWNlZFRvQXJyYXkyKF9yZWYyLCAxKSxrZXkgPSBfcmVmMTRbMF07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgZmV0Y2hlciA9IHN0YXRlLmZldGNoZXJzLmdldChrZXkpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHJldmFsaWRhdGluZ0ZldGNoZXIgPSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YXRlOiAibG9hZGluZyIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGE6IGZldGNoZXIgJiYgZmV0Y2hlci5kYXRhLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3JtTWV0aG9kOiB1bmRlZmluZWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvcm1BY3Rpb246IHVuZGVmaW5lZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9ybUVuY1R5cGU6IHVuZGVmaW5lZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9ybURhdGE6IHVuZGVmaW5lZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YXRlLmZldGNoZXJzLnNldChrZXksIHJldmFsaWRhdGluZ0ZldGNoZXIpOwogICAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICAgIHVwZGF0ZVN0YXRlKF9leHRlbmRzKHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5hdmlnYXRpb246IGxvYWRpbmdOYXZpZ2F0aW9uLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgYWN0aW9uRGF0YTogcGVuZGluZ0FjdGlvbkRhdGEgfHwgc3RhdGUuYWN0aW9uRGF0YSB8fCBudWxsCiAgICAgICAgICAgICAgICAgICAgICAgICAgfSwgcmV2YWxpZGF0aW5nRmV0Y2hlcnMubGVuZ3RoID4gMCA/IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZldGNoZXJzOiBuZXcgTWFwKHN0YXRlLmZldGNoZXJzKQogICAgICAgICAgICAgICAgICAgICAgICAgIH0gOiB7fSkpOwogICAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgICBwZW5kaW5nTmF2aWdhdGlvbkxvYWRJZCA9ICsraW5jcmVtZW50aW5nTG9hZElkOwogICAgICAgICAgICAgICAgICAgICAgICByZXZhbGlkYXRpbmdGZXRjaGVycy5mb3JFYWNoKChfcmVmMykgPT4gewogICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBfcmVmMTUgPSBfc2xpY2VkVG9BcnJheTIoX3JlZjMsIDEpLGtleSA9IF9yZWYxNVswXTsKICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmV0Y2hDb250cm9sbGVycy5zZXQoa2V5LCBwZW5kaW5nTmF2aWdhdGlvbkNvbnRyb2xsZXIpOwogICAgICAgICAgICAgICAgICAgICAgICB9KTtfY29udGV4dDgubmV4dCA9IDEyO3JldHVybiAoCgoKCgogICAgICAgICAgICAgICAgICAgICAgICAgIGNhbGxMb2FkZXJzQW5kTWF5YmVSZXNvbHZlRGF0YShzdGF0ZS5tYXRjaGVzLCBtYXRjaGVzLCBtYXRjaGVzVG9Mb2FkLCByZXZhbGlkYXRpbmdGZXRjaGVycywgcmVxdWVzdCkpO2Nhc2UgMTI6X3lpZWxkJGNhbGxMb2FkZXJzQW5kID0gX2NvbnRleHQ4LnNlbnQ7cmVzdWx0cyA9IF95aWVsZCRjYWxsTG9hZGVyc0FuZC5yZXN1bHRzO2xvYWRlclJlc3VsdHMgPSBfeWllbGQkY2FsbExvYWRlcnNBbmQubG9hZGVyUmVzdWx0cztmZXRjaGVyUmVzdWx0cyA9IF95aWVsZCRjYWxsTG9hZGVyc0FuZC5mZXRjaGVyUmVzdWx0cztpZiAoIQoKICAgICAgICAgICAgICAgICAgICAgICAgcmVxdWVzdC5zaWduYWwuYWJvcnRlZCkge19jb250ZXh0OC5uZXh0ID0gMTg7YnJlYWs7fXJldHVybiBfY29udGV4dDguYWJydXB0KCJyZXR1cm4iLAogICAgICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgc2hvcnRDaXJjdWl0ZWQ6IHRydWUKICAgICAgICAgICAgICAgICAgICAgICAgfSk7Y2FzZSAxODoKICAgICAgICAgICAgICAgICAgICAgICAgLy8gQ2xlYW4gdXAgX2FmdGVyXyBsb2FkZXJzIGhhdmUgY29tcGxldGVkLiAgRG9uJ3QgY2xlYW4gdXAgaWYgd2Ugc2hvcnQKICAgICAgICAgICAgICAgICAgICAgICAgLy8gY2lyY3VpdGVkIGJlY2F1c2UgZmV0Y2hDb250cm9sbGVycyB3b3VsZCBoYXZlIGJlZW4gYWJvcnRlZCBhbmQKICAgICAgICAgICAgICAgICAgICAgICAgLy8gcmVhc3NpZ25lZCB0byBuZXcgY29udHJvbGxlcnMgZm9yIHRoZSBuZXh0IG5hdmlnYXRpb24KCgogICAgICAgICAgICAgICAgICAgICAgICByZXZhbGlkYXRpbmdGZXRjaGVycy5mb3JFYWNoKChfcmVmNCkgPT4gewogICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBfcmVmMTYgPSBfc2xpY2VkVG9BcnJheTIoX3JlZjQsIDEpLGtleSA9IF9yZWYxNlswXTsKICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmV0Y2hDb250cm9sbGVycy5kZWxldGUoa2V5KTsKICAgICAgICAgICAgICAgICAgICAgICAgfSk7IC8vIElmIGFueSBsb2FkZXJzIHJldHVybmVkIGEgcmVkaXJlY3QgUmVzcG9uc2UsIHN0YXJ0IGEgbmV3IFJFUExBQ0UgbmF2aWdhdGlvbgoKICAgICAgICAgICAgICAgICAgICAgICAgcmVkaXJlY3QgPSBmaW5kUmVkaXJlY3QocmVzdWx0cyk7aWYgKCEKCiAgICAgICAgICAgICAgICAgICAgICAgIHJlZGlyZWN0KSB7X2NvbnRleHQ4Lm5leHQgPSAyNTticmVhazt9CiAgICAgICAgICAgICAgICAgICAgICAgIHJlZGlyZWN0TmF2aWdhdGlvbiA9IGdldExvYWRlclJlZGlyZWN0KHN0YXRlLCByZWRpcmVjdCk7X2NvbnRleHQ4Lm5leHQgPSAyNDtyZXR1cm4gKAogICAgICAgICAgICAgICAgICAgICAgICAgIHN0YXJ0UmVkaXJlY3ROYXZpZ2F0aW9uKHJlZGlyZWN0LCByZWRpcmVjdE5hdmlnYXRpb24sIHJlcGxhY2UpKTtjYXNlIDI0OnJldHVybiBfY29udGV4dDguYWJydXB0KCJyZXR1cm4iLAogICAgICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgc2hvcnRDaXJjdWl0ZWQ6IHRydWUKICAgICAgICAgICAgICAgICAgICAgICAgfSk7Y2FzZSAyNToKICAgICAgICAgICAgICAgICAgICAgICAgLy8gUHJvY2VzcyBhbmQgY29tbWl0IG91dHB1dCBmcm9tIGxvYWRlcnMKICAgICAgICAgICAgICAgICAgICAgICAgX3Byb2Nlc3NMb2FkZXJEYXRhID0KCgoKCiAgICAgICAgICAgICAgICAgICAgICAgIHByb2Nlc3NMb2FkZXJEYXRhKHN0YXRlLCBtYXRjaGVzLCBtYXRjaGVzVG9Mb2FkLCBsb2FkZXJSZXN1bHRzLCBwZW5kaW5nRXJyb3IsIHJldmFsaWRhdGluZ0ZldGNoZXJzLCBmZXRjaGVyUmVzdWx0cywgYWN0aXZlRGVmZXJyZWRzKSwgbG9hZGVyRGF0YSA9IF9wcm9jZXNzTG9hZGVyRGF0YS5sb2FkZXJEYXRhLCBlcnJvcnMgPSBfcHJvY2Vzc0xvYWRlckRhdGEuZXJyb3JzOyAvLyBXaXJlIHVwIHN1YnNjcmliZXJzIHRvIHVwZGF0ZSBsb2FkZXJEYXRhIGFzIHByb21pc2VzIHNldHRsZQoKICAgICAgICAgICAgICAgICAgICAgICAgYWN0aXZlRGVmZXJyZWRzLmZvckVhY2goKGRlZmVycmVkRGF0YSwgcm91dGVJZCkgPT4gewogICAgICAgICAgICAgICAgICAgICAgICAgIGRlZmVycmVkRGF0YS5zdWJzY3JpYmUoKGFib3J0ZWQpID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIE5vdGU6IE5vIG5lZWQgdG8gdXBkYXRlU3RhdGUgaGVyZSBzaW5jZSB0aGUgVHJhY2tlZFByb21pc2Ugb24KICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGxvYWRlckRhdGEgaXMgc3RhYmxlIGFjcm9zcyByZXNvbHZlL3JlamVjdAogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gUmVtb3ZlIHRoaXMgaW5zdGFuY2UgaWYgd2Ugd2VyZSBhYm9ydGVkIG9yIGlmIHByb21pc2VzIGhhdmUgc2V0dGxlZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGFib3J0ZWQgfHwgZGVmZXJyZWREYXRhLmRvbmUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYWN0aXZlRGVmZXJyZWRzLmRlbGV0ZShyb3V0ZUlkKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgIG1hcmtGZXRjaFJlZGlyZWN0c0RvbmUoKTsKICAgICAgICAgICAgICAgICAgICAgICAgZGlkQWJvcnRGZXRjaExvYWRzID0gYWJvcnRTdGFsZUZldGNoTG9hZHMocGVuZGluZ05hdmlnYXRpb25Mb2FkSWQpO3JldHVybiBfY29udGV4dDguYWJydXB0KCJyZXR1cm4iLAogICAgICAgICAgICAgICAgICAgICAgICBfZXh0ZW5kcyh7CiAgICAgICAgICAgICAgICAgICAgICAgICAgbG9hZGVyRGF0YTogbG9hZGVyRGF0YSwKICAgICAgICAgICAgICAgICAgICAgICAgICBlcnJvcnM6IGVycm9ycwogICAgICAgICAgICAgICAgICAgICAgICB9LCBkaWRBYm9ydEZldGNoTG9hZHMgfHwgcmV2YWxpZGF0aW5nRmV0Y2hlcnMubGVuZ3RoID4gMCA/IHsKICAgICAgICAgICAgICAgICAgICAgICAgICBmZXRjaGVyczogbmV3IE1hcChzdGF0ZS5mZXRjaGVycykKICAgICAgICAgICAgICAgICAgICAgICAgfSA6IHt9KSk7Y2FzZSAzMDpjYXNlICJlbmQiOnJldHVybiBfY29udGV4dDguc3RvcCgpO319fSwgX2NhbGxlZTgpO30pKTtyZXR1cm4gX2hhbmRsZUxvYWRlcnMuYXBwbHkodGhpcywgYXJndW1lbnRzKTt9CgoKICAgICAgICAgICAgZnVuY3Rpb24gZ2V0RmV0Y2hlcihrZXkpIHsKICAgICAgICAgICAgICByZXR1cm4gc3RhdGUuZmV0Y2hlcnMuZ2V0KGtleSkgfHwgSURMRV9GRVRDSEVSOwogICAgICAgICAgICB9IC8vIFRyaWdnZXIgYSBmZXRjaGVyIGxvYWQvc3VibWl0IGZvciB0aGUgZ2l2ZW4gZmV0Y2hlciBrZXkKCgogICAgICAgICAgICBmdW5jdGlvbiBmZXRjaChrZXksIHJvdXRlSWQsIGhyZWYsIG9wdHMpIHsKICAgICAgICAgICAgICBpZiAoaXNTZXJ2ZXIpIHsKICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigicm91dGVyLmZldGNoKCkgd2FzIGNhbGxlZCBkdXJpbmcgdGhlIHNlcnZlciByZW5kZXIsIGJ1dCBpdCBzaG91bGRuJ3QgYmUuICIgKyAiWW91IGFyZSBsaWtlbHkgY2FsbGluZyBhIHVzZUZldGNoZXIoKSBtZXRob2QgaW4gdGhlIGJvZHkgb2YgeW91ciBjb21wb25lbnQuICIgKyAiVHJ5IG1vdmluZyBpdCB0byBhIHVzZUVmZmVjdCBvciBhIGNhbGxiYWNrLiIpOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgaWYgKGZldGNoQ29udHJvbGxlcnMuaGFzKGtleSkpIGFib3J0RmV0Y2hlcihrZXkpOwogICAgICAgICAgICAgIHZhciBtYXRjaGVzID0gbWF0Y2hSb3V0ZXMoZGF0YVJvdXRlcywgaHJlZiwgaW5pdC5iYXNlbmFtZSk7CgogICAgICAgICAgICAgIGlmICghbWF0Y2hlcykgewogICAgICAgICAgICAgICAgc2V0RmV0Y2hlckVycm9yKGtleSwgcm91dGVJZCwgbmV3IEVycm9yUmVzcG9uc2UoNDA0LCAiTm90IEZvdW5kIiwgbnVsbCkpOwogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgdmFyIF9ub3JtYWxpemVOYXZpZ2F0ZU9wdCA9CgoKICAgICAgICAgICAgICAgIG5vcm1hbGl6ZU5hdmlnYXRlT3B0aW9ucyhocmVmLCBvcHRzLCB0cnVlKSxwYXRoID0gX25vcm1hbGl6ZU5hdmlnYXRlT3B0LnBhdGgsc3VibWlzc2lvbiA9IF9ub3JtYWxpemVOYXZpZ2F0ZU9wdC5zdWJtaXNzaW9uOwogICAgICAgICAgICAgIHZhciBtYXRjaCA9IGdldFRhcmdldE1hdGNoKG1hdGNoZXMsIHBhdGgpOwoKICAgICAgICAgICAgICBpZiAoc3VibWlzc2lvbikgewogICAgICAgICAgICAgICAgaGFuZGxlRmV0Y2hlckFjdGlvbihrZXksIHJvdXRlSWQsIHBhdGgsIG1hdGNoLCBtYXRjaGVzLCBzdWJtaXNzaW9uKTsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICB9IC8vIFN0b3JlIG9mZiB0aGUgbWF0Y2ggc28gd2UgY2FuIGNhbGwgaXQncyBzaG91bGRSZXZhbGlkYXRlIG9uIHN1YnNlcXVlbnQKICAgICAgICAgICAgICAvLyByZXZhbGlkYXRpb25zCgoKICAgICAgICAgICAgICBmZXRjaExvYWRNYXRjaGVzLnNldChrZXksIFtwYXRoLCBtYXRjaCwgbWF0Y2hlc10pOwogICAgICAgICAgICAgIGhhbmRsZUZldGNoZXJMb2FkZXIoa2V5LCByb3V0ZUlkLCBwYXRoLCBtYXRjaCwgbWF0Y2hlcyk7CiAgICAgICAgICAgIH0gLy8gQ2FsbCB0aGUgYWN0aW9uIGZvciB0aGUgbWF0Y2hlZCBmZXRjaGVyLnN1Ym1pdCgpLCBhbmQgdGhlbiBoYW5kbGUgcmVkaXJlY3RzLAogICAgICAgICAgICAvLyBlcnJvcnMsIGFuZCByZXZhbGlkYXRpb24KICAgICAgICAgICAgZnVuY3Rpb24KCiAgICAgICAgICAgIGhhbmRsZUZldGNoZXJBY3Rpb24oX3gyNCwgX3gyNSwgX3gyNiwgX3gyNywgX3gyOCwgX3gyOSkge3JldHVybiBfaGFuZGxlRmV0Y2hlckFjdGlvbi5hcHBseSh0aGlzLCBhcmd1bWVudHMpO30KCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgogICAgICAgICAgICAvLyBDYWxsIHRoZSBtYXRjaGVkIGxvYWRlciBmb3IgZmV0Y2hlci5sb2FkKCksIGhhbmRsaW5nIHJlZGlyZWN0cywgZXJyb3JzLCBldGMuCiAgICAgICAgICAgIGZ1bmN0aW9uIF9oYW5kbGVGZXRjaGVyQWN0aW9uKCkge19oYW5kbGVGZXRjaGVyQWN0aW9uID0gX2FzeW5jVG9HZW5lcmF0b3IyKCAvKiNfX1BVUkVfXyovX3JlZ2VuZXJhdG9yUnVudGltZTIoKS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWU5KGtleSwgcm91dGVJZCwgcGF0aCwgbWF0Y2gsIHJlcXVlc3RNYXRjaGVzLCBzdWJtaXNzaW9uKSB7dmFyIF9nZXRNZXRob2ROb3RBbGxvd2VkUiwgX2Vycm9yMiwgZXhpc3RpbmdGZXRjaGVyLCBmZXRjaGVyLCBhYm9ydENvbnRyb2xsZXIsIGZldGNoUmVxdWVzdCwgYWN0aW9uUmVzdWx0LCBsb2FkaW5nRmV0Y2hlciwgcmVkaXJlY3ROYXZpZ2F0aW9uLCBuZXh0TG9jYXRpb24sIHJldmFsaWRhdGlvblJlcXVlc3QsIG1hdGNoZXMsIGxvYWRJZCwgbG9hZEZldGNoZXIsIF9nZXRNYXRjaGVzVG9Mb2FkMywgX2dldE1hdGNoZXNUb0xvYWQ0LCBtYXRjaGVzVG9Mb2FkLCByZXZhbGlkYXRpbmdGZXRjaGVycywgX3lpZWxkJGNhbGxMb2FkZXJzQW5kMiwgcmVzdWx0cywgbG9hZGVyUmVzdWx0cywgZmV0Y2hlclJlc3VsdHMsIHJlZGlyZWN0LCBfcHJvY2Vzc0xvYWRlckRhdGEyLCBsb2FkZXJEYXRhLCBlcnJvcnMsIGRvbmVGZXRjaGVyLCBkaWRBYm9ydEZldGNoTG9hZHM7cmV0dXJuIF9yZWdlbmVyYXRvclJ1bnRpbWUyKCkud3JhcChmdW5jdGlvbiBfY2FsbGVlOSQoX2NvbnRleHQ5KSB7d2hpbGUgKDEpIHtzd2l0Y2ggKF9jb250ZXh0OS5wcmV2ID0gX2NvbnRleHQ5Lm5leHQpIHtjYXNlIDA6aW50ZXJydXB0QWN0aXZlTG9hZHMoKTtmZXRjaExvYWRNYXRjaGVzLmRlbGV0ZShrZXkpO2lmIChtYXRjaC5yb3V0ZS5hY3Rpb24pIHtfY29udGV4dDkubmV4dCA9IDY7YnJlYWs7fV9nZXRNZXRob2ROb3RBbGxvd2VkUiA9IGdldE1ldGhvZE5vdEFsbG93ZWRSZXN1bHQocGF0aCksIF9lcnJvcjIgPSBfZ2V0TWV0aG9kTm90QWxsb3dlZFIuZXJyb3I7c2V0RmV0Y2hlckVycm9yKGtleSwgcm91dGVJZCwgX2Vycm9yMik7cmV0dXJuIF9jb250ZXh0OS5hYnJ1cHQoInJldHVybiIpO2Nhc2UgNjogLy8gUHV0IHRoaXMgZmV0Y2hlciBpbnRvIGl0J3Mgc3VibWl0dGluZyBzdGF0ZQogICAgICAgICAgICAgICAgICAgICAgICBleGlzdGluZ0ZldGNoZXIgPSBzdGF0ZS5mZXRjaGVycy5nZXQoa2V5KTtmZXRjaGVyID0gX2V4dGVuZHMoeyBzdGF0ZTogInN1Ym1pdHRpbmciIH0sIHN1Ym1pc3Npb24sIHsgZGF0YTogZXhpc3RpbmdGZXRjaGVyICYmIGV4aXN0aW5nRmV0Y2hlci5kYXRhIH0pO3N0YXRlLmZldGNoZXJzLnNldChrZXksIGZldGNoZXIpO3VwZGF0ZVN0YXRlKHsgZmV0Y2hlcnM6IG5ldyBNYXAoc3RhdGUuZmV0Y2hlcnMpIH0pOyAvLyBDYWxsIHRoZSBhY3Rpb24gZm9yIHRoZSBmZXRjaGVyCiAgICAgICAgICAgICAgICAgICAgICAgIGFib3J0Q29udHJvbGxlciA9IG5ldyBBYm9ydENvbnRyb2xsZXIoKTtmZXRjaFJlcXVlc3QgPSBjcmVhdGVSZXF1ZXN0KHBhdGgsIGFib3J0Q29udHJvbGxlci5zaWduYWwsIHN1Ym1pc3Npb24pO2ZldGNoQ29udHJvbGxlcnMuc2V0KGtleSwgYWJvcnRDb250cm9sbGVyKTtfY29udGV4dDkubmV4dCA9IDE1O3JldHVybiBjYWxsTG9hZGVyT3JBY3Rpb24oImFjdGlvbiIsIGZldGNoUmVxdWVzdCwgbWF0Y2gsIHJlcXVlc3RNYXRjaGVzLCByb3V0ZXIuYmFzZW5hbWUpO2Nhc2UgMTU6YWN0aW9uUmVzdWx0ID0gX2NvbnRleHQ5LnNlbnQ7aWYgKCFmZXRjaFJlcXVlc3Quc2lnbmFsLmFib3J0ZWQpIHtfY29udGV4dDkubmV4dCA9IDE5O2JyZWFrO30gLy8gV2UgY2FuIGRlbGV0ZSB0aGlzIHNvIGxvbmcgYXMgd2Ugd2VyZW4ndCBhYm9ydGVkIGJ5IG91IG91ciBvd24gZmV0Y2hlcgogICAgICAgICAgICAgICAgICAgICAgICAvLyByZS1zdWJtaXQgd2hpY2ggd291bGQgaGF2ZSBwdXQgX25ld18gY29udHJvbGxlciBpcyBpbiBmZXRjaENvbnRyb2xsZXJzCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChmZXRjaENvbnRyb2xsZXJzLmdldChrZXkpID09PSBhYm9ydENvbnRyb2xsZXIpIHtmZXRjaENvbnRyb2xsZXJzLmRlbGV0ZShrZXkpO31yZXR1cm4gX2NvbnRleHQ5LmFicnVwdCgicmV0dXJuIik7Y2FzZSAxOTppZiAoIWlzUmVkaXJlY3RSZXN1bHQoYWN0aW9uUmVzdWx0KSkge19jb250ZXh0OS5uZXh0ID0gMjk7YnJlYWs7fWZldGNoQ29udHJvbGxlcnMuZGVsZXRlKGtleSk7ZmV0Y2hSZWRpcmVjdElkcy5hZGQoa2V5KTtsb2FkaW5nRmV0Y2hlciA9IF9leHRlbmRzKHsgc3RhdGU6ICJsb2FkaW5nIiB9LCBzdWJtaXNzaW9uLCB7IGRhdGE6IHVuZGVmaW5lZCB9KTtzdGF0ZS5mZXRjaGVycy5zZXQoa2V5LCBsb2FkaW5nRmV0Y2hlcik7dXBkYXRlU3RhdGUoeyBmZXRjaGVyczogbmV3IE1hcChzdGF0ZS5mZXRjaGVycykgfSk7cmVkaXJlY3ROYXZpZ2F0aW9uID0gX2V4dGVuZHMoeyBzdGF0ZTogImxvYWRpbmciLCBsb2NhdGlvbjogY3JlYXRlTG9jYXRpb24oc3RhdGUubG9jYXRpb24sIGFjdGlvblJlc3VsdC5sb2NhdGlvbikgfSwgc3VibWlzc2lvbik7X2NvbnRleHQ5Lm5leHQgPSAyODtyZXR1cm4gc3RhcnRSZWRpcmVjdE5hdmlnYXRpb24oYWN0aW9uUmVzdWx0LCByZWRpcmVjdE5hdmlnYXRpb24pO2Nhc2UgMjg6cmV0dXJuIF9jb250ZXh0OS5hYnJ1cHQoInJldHVybiIpO2Nhc2UgMjk6aWYgKCFpc0Vycm9yUmVzdWx0KGFjdGlvblJlc3VsdCkpIHtfY29udGV4dDkubmV4dCA9IDMyO2JyZWFrO31zZXRGZXRjaGVyRXJyb3Ioa2V5LCByb3V0ZUlkLCBhY3Rpb25SZXN1bHQuZXJyb3IpO3JldHVybiBfY29udGV4dDkuYWJydXB0KCJyZXR1cm4iKTtjYXNlIDMyOmlmIChpc0RlZmVycmVkUmVzdWx0KGFjdGlvblJlc3VsdCkpIHtyb3V0ZXJfaW52YXJpYW50KGZhbHNlLCAiZGVmZXIoKSBpcyBub3Qgc3VwcG9ydGVkIGluIGFjdGlvbnMiKTt9IC8vIFN0YXJ0IHRoZSBkYXRhIGxvYWQgZm9yIGN1cnJlbnQgbWF0Y2hlcywgb3IgdGhlIG5leHQgbG9jYXRpb24gaWYgd2UncmUKICAgICAgICAgICAgICAgICAgICAgICAgLy8gaW4gdGhlIG1pZGRsZSBvZiBhIG5hdmlnYXRpb24KICAgICAgICAgICAgICAgICAgICAgICAgbmV4dExvY2F0aW9uID0gc3RhdGUubmF2aWdhdGlvbi5sb2NhdGlvbiB8fCBzdGF0ZS5sb2NhdGlvbjtyZXZhbGlkYXRpb25SZXF1ZXN0ID0gY3JlYXRlUmVxdWVzdChuZXh0TG9jYXRpb24sIGFib3J0Q29udHJvbGxlci5zaWduYWwpO21hdGNoZXMgPSBzdGF0ZS5uYXZpZ2F0aW9uLnN0YXRlICE9PSAiaWRsZSIgPyBtYXRjaFJvdXRlcyhkYXRhUm91dGVzLCBzdGF0ZS5uYXZpZ2F0aW9uLmxvY2F0aW9uLCBpbml0LmJhc2VuYW1lKSA6IHN0YXRlLm1hdGNoZXM7cm91dGVyX2ludmFyaWFudChtYXRjaGVzLCAiRGlkbid0IGZpbmQgYW55IG1hdGNoZXMgYWZ0ZXIgZmV0Y2hlciBhY3Rpb24iKTtsb2FkSWQgPSArK2luY3JlbWVudGluZ0xvYWRJZDtmZXRjaFJlbG9hZElkcy5zZXQoa2V5LCBsb2FkSWQpO2xvYWRGZXRjaGVyID0gX2V4dGVuZHMoeyBzdGF0ZTogImxvYWRpbmciLCBkYXRhOiBhY3Rpb25SZXN1bHQuZGF0YSB9LCBzdWJtaXNzaW9uKTtzdGF0ZS5mZXRjaGVycy5zZXQoa2V5LCBsb2FkRmV0Y2hlcik7X2dldE1hdGNoZXNUb0xvYWQzID0gZ2V0TWF0Y2hlc1RvTG9hZChzdGF0ZSwgbWF0Y2hlcywgc3VibWlzc2lvbiwgbmV4dExvY2F0aW9uLCBpc1JldmFsaWRhdGlvblJlcXVpcmVkLCBjYW5jZWxsZWREZWZlcnJlZFJvdXRlcywgY2FuY2VsbGVkRmV0Y2hlckxvYWRzLCBfZGVmaW5lUHJvcGVydHkyKHt9LCBtYXRjaC5yb3V0ZS5pZCwgYWN0aW9uUmVzdWx0LmRhdGEpLCB1bmRlZmluZWQsIC8vIE5vIG5lZWQgdG8gc2VuZCB0aHJvdWdoIGVycm9ycyBzaW5jZSB3ZSBzaG9ydCBjaXJjdWl0IGFib3ZlCiAgICAgICAgICAgICAgICAgICAgICAgIGZldGNoTG9hZE1hdGNoZXMpLCBfZ2V0TWF0Y2hlc1RvTG9hZDQgPSBfc2xpY2VkVG9BcnJheTIoX2dldE1hdGNoZXNUb0xvYWQzLCAyKSwgbWF0Y2hlc1RvTG9hZCA9IF9nZXRNYXRjaGVzVG9Mb2FkNFswXSwgcmV2YWxpZGF0aW5nRmV0Y2hlcnMgPSBfZ2V0TWF0Y2hlc1RvTG9hZDRbMV07IC8vIFB1dCBhbGwgcmV2YWxpZGF0aW5nIGZldGNoZXJzIGludG8gdGhlIGxvYWRpbmcgc3RhdGUsIGV4Y2VwdCBmb3IgdGhlCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIGN1cnJlbnQgZmV0Y2hlciB3aGljaCB3ZSB3YW50IHRvIGtlZXAgaW4gaXQncyBjdXJyZW50IGxvYWRpbmcgc3RhdGUgd2hpY2gKICAgICAgICAgICAgICAgICAgICAgICAgLy8gY29udGFpbnMgaXQncyBhY3Rpb24gc3VibWlzc2lvbiBpbmZvICsgYWN0aW9uIGRhdGEKICAgICAgICAgICAgICAgICAgICAgICAgcmV2YWxpZGF0aW5nRmV0Y2hlcnMuZmlsdGVyKChfcmVmNSkgPT4ge3ZhciBfcmVmMTcgPSBfc2xpY2VkVG9BcnJheTIoX3JlZjUsIDEpLHN0YWxlS2V5ID0gX3JlZjE3WzBdO3JldHVybiBzdGFsZUtleSAhPT0ga2V5O30pLmZvckVhY2goKF9yZWY2KSA9PiB7dmFyIF9yZWYxOCA9IF9zbGljZWRUb0FycmF5MihfcmVmNiwgMSksc3RhbGVLZXkgPSBfcmVmMThbMF07dmFyIGV4aXN0aW5nRmV0Y2hlciA9IHN0YXRlLmZldGNoZXJzLmdldChzdGFsZUtleSk7dmFyIHJldmFsaWRhdGluZ0ZldGNoZXIgPSB7IHN0YXRlOiAibG9hZGluZyIsIGRhdGE6IGV4aXN0aW5nRmV0Y2hlciAmJiBleGlzdGluZ0ZldGNoZXIuZGF0YSwgZm9ybU1ldGhvZDogdW5kZWZpbmVkLCBmb3JtQWN0aW9uOiB1bmRlZmluZWQsIGZvcm1FbmNUeXBlOiB1bmRlZmluZWQsIGZvcm1EYXRhOiB1bmRlZmluZWQgfTtzdGF0ZS5mZXRjaGVycy5zZXQoc3RhbGVLZXksIHJldmFsaWRhdGluZ0ZldGNoZXIpO2ZldGNoQ29udHJvbGxlcnMuc2V0KHN0YWxlS2V5LCBhYm9ydENvbnRyb2xsZXIpO30pO3VwZGF0ZVN0YXRlKHsgZmV0Y2hlcnM6IG5ldyBNYXAoc3RhdGUuZmV0Y2hlcnMpIH0pO19jb250ZXh0OS5uZXh0ID0gNDY7cmV0dXJuIGNhbGxMb2FkZXJzQW5kTWF5YmVSZXNvbHZlRGF0YShzdGF0ZS5tYXRjaGVzLCBtYXRjaGVzLCBtYXRjaGVzVG9Mb2FkLCByZXZhbGlkYXRpbmdGZXRjaGVycywgcmV2YWxpZGF0aW9uUmVxdWVzdCk7Y2FzZSA0NjpfeWllbGQkY2FsbExvYWRlcnNBbmQyID0gX2NvbnRleHQ5LnNlbnQ7cmVzdWx0cyA9IF95aWVsZCRjYWxsTG9hZGVyc0FuZDIucmVzdWx0cztsb2FkZXJSZXN1bHRzID0gX3lpZWxkJGNhbGxMb2FkZXJzQW5kMi5sb2FkZXJSZXN1bHRzO2ZldGNoZXJSZXN1bHRzID0gX3lpZWxkJGNhbGxMb2FkZXJzQW5kMi5mZXRjaGVyUmVzdWx0cztpZiAoIWFib3J0Q29udHJvbGxlci5zaWduYWwuYWJvcnRlZCkge19jb250ZXh0OS5uZXh0ID0gNTI7YnJlYWs7fXJldHVybiBfY29udGV4dDkuYWJydXB0KCJyZXR1cm4iKTtjYXNlIDUyOmZldGNoUmVsb2FkSWRzLmRlbGV0ZShrZXkpO2ZldGNoQ29udHJvbGxlcnMuZGVsZXRlKGtleSk7cmV2YWxpZGF0aW5nRmV0Y2hlcnMuZm9yRWFjaCgoX3JlZjcpID0+IHt2YXIgX3JlZjE5ID0gX3NsaWNlZFRvQXJyYXkyKF9yZWY3LCAxKSxzdGFsZUtleSA9IF9yZWYxOVswXTtyZXR1cm4gZmV0Y2hDb250cm9sbGVycy5kZWxldGUoc3RhbGVLZXkpO30pO3JlZGlyZWN0ID0gZmluZFJlZGlyZWN0KHJlc3VsdHMpO2lmICghcmVkaXJlY3QpIHtfY29udGV4dDkubmV4dCA9IDYxO2JyZWFrO31yZWRpcmVjdE5hdmlnYXRpb24gPSBnZXRMb2FkZXJSZWRpcmVjdChzdGF0ZSwgcmVkaXJlY3QpO19jb250ZXh0OS5uZXh0ID0gNjA7cmV0dXJuIHN0YXJ0UmVkaXJlY3ROYXZpZ2F0aW9uKHJlZGlyZWN0LCByZWRpcmVjdE5hdmlnYXRpb24pO2Nhc2UgNjA6cmV0dXJuIF9jb250ZXh0OS5hYnJ1cHQoInJldHVybiIpO2Nhc2UgNjE6IC8vIFByb2Nlc3MgYW5kIGNvbW1pdCBvdXRwdXQgZnJvbSBsb2FkZXJzCiAgICAgICAgICAgICAgICAgICAgICAgIF9wcm9jZXNzTG9hZGVyRGF0YTIgPSBwcm9jZXNzTG9hZGVyRGF0YShzdGF0ZSwgc3RhdGUubWF0Y2hlcywgbWF0Y2hlc1RvTG9hZCwgbG9hZGVyUmVzdWx0cywgdW5kZWZpbmVkLCByZXZhbGlkYXRpbmdGZXRjaGVycywgZmV0Y2hlclJlc3VsdHMsIGFjdGl2ZURlZmVycmVkcyksIGxvYWRlckRhdGEgPSBfcHJvY2Vzc0xvYWRlckRhdGEyLmxvYWRlckRhdGEsIGVycm9ycyA9IF9wcm9jZXNzTG9hZGVyRGF0YTIuZXJyb3JzO2RvbmVGZXRjaGVyID0geyBzdGF0ZTogImlkbGUiLCBkYXRhOiBhY3Rpb25SZXN1bHQuZGF0YSwgZm9ybU1ldGhvZDogdW5kZWZpbmVkLCBmb3JtQWN0aW9uOiB1bmRlZmluZWQsIGZvcm1FbmNUeXBlOiB1bmRlZmluZWQsIGZvcm1EYXRhOiB1bmRlZmluZWQgfTtzdGF0ZS5mZXRjaGVycy5zZXQoa2V5LCBkb25lRmV0Y2hlcik7ZGlkQWJvcnRGZXRjaExvYWRzID0gYWJvcnRTdGFsZUZldGNoTG9hZHMobG9hZElkKTsgLy8gSWYgd2UgYXJlIGN1cnJlbnRseSBpbiBhIG5hdmlnYXRpb24gbG9hZGluZyBzdGF0ZSBhbmQgdGhpcyBmZXRjaGVyIGlzCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIG1vcmUgcmVjZW50IHRoYW4gdGhlIG5hdmlnYXRpb24sIHdlIHdhbnQgdGhlIG5ld2VyIGRhdGEgc28gYWJvcnQgdGhlCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIG5hdmlnYXRpb24gYW5kIGNvbXBsZXRlIGl0IHdpdGggdGhlIGZldGNoZXIgZGF0YQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoc3RhdGUubmF2aWdhdGlvbi5zdGF0ZSA9PT0gImxvYWRpbmciICYmIGxvYWRJZCA+IHBlbmRpbmdOYXZpZ2F0aW9uTG9hZElkKSB7cm91dGVyX2ludmFyaWFudChwZW5kaW5nQWN0aW9uLCAiRXhwZWN0ZWQgcGVuZGluZyBhY3Rpb24iKTtwZW5kaW5nTmF2aWdhdGlvbkNvbnRyb2xsZXIgJiYgcGVuZGluZ05hdmlnYXRpb25Db250cm9sbGVyLmFib3J0KCk7Y29tcGxldGVOYXZpZ2F0aW9uKHN0YXRlLm5hdmlnYXRpb24ubG9jYXRpb24sIHsgbWF0Y2hlczogbWF0Y2hlcywgbG9hZGVyRGF0YTogbG9hZGVyRGF0YSwgZXJyb3JzOiBlcnJvcnMsIGZldGNoZXJzOiBuZXcgTWFwKHN0YXRlLmZldGNoZXJzKSB9KTt9IGVsc2Ugey8vIG90aGVyd2lzZSBqdXN0IHVwZGF0ZSB3aXRoIHRoZSBmZXRjaGVyIGRhdGEsIHByZXNlcnZpbmcgYW55IGV4aXN0aW5nCiAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gbG9hZGVyRGF0YSBmb3IgbG9hZGVycyB0aGF0IGRpZCBub3QgbmVlZCB0byByZWxvYWQuICBXZSBoYXZlIHRvCiAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gbWFudWFsbHkgbWVyZ2UgaGVyZSBzaW5jZSB3ZSBhcmVuJ3QgZ29pbmcgdGhyb3VnaCBjb21wbGV0ZU5hdmlnYXRpb24KICAgICAgICAgICAgICAgICAgICAgICAgICB1cGRhdGVTdGF0ZShfZXh0ZW5kcyh7IGVycm9yczogZXJyb3JzLCBsb2FkZXJEYXRhOiBtZXJnZUxvYWRlckRhdGEoc3RhdGUubG9hZGVyRGF0YSwgbG9hZGVyRGF0YSwgbWF0Y2hlcykgfSwgZGlkQWJvcnRGZXRjaExvYWRzID8geyBmZXRjaGVyczogbmV3IE1hcChzdGF0ZS5mZXRjaGVycykgfSA6IHt9KSk7aXNSZXZhbGlkYXRpb25SZXF1aXJlZCA9IGZhbHNlO31jYXNlIDY2OmNhc2UgImVuZCI6cmV0dXJuIF9jb250ZXh0OS5zdG9wKCk7fX19LCBfY2FsbGVlOSk7fSkpO3JldHVybiBfaGFuZGxlRmV0Y2hlckFjdGlvbi5hcHBseSh0aGlzLCBhcmd1bWVudHMpO31mdW5jdGlvbiBoYW5kbGVGZXRjaGVyTG9hZGVyKF94MzAsIF94MzEsIF94MzIsIF94MzMsIF94MzQpIHtyZXR1cm4gX2hhbmRsZUZldGNoZXJMb2FkZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKTt9CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCiAgICAgICAgICAgIC8qKgogICAgICAgICAgICAgKiBVdGlsaXR5IGZ1bmN0aW9uIHRvIGhhbmRsZSByZWRpcmVjdHMgcmV0dXJuZWQgZnJvbSBhbiBhY3Rpb24gb3IgbG9hZGVyLgogICAgICAgICAgICAgKiBOb3JtYWxseSwgYSByZWRpcmVjdCAicmVwbGFjZXMiIHRoZSBuYXZpZ2F0aW9uIHRoYXQgdHJpZ2dlcmVkIGl0LiAgU28sIGZvcgogICAgICAgICAgICAgKiBleGFtcGxlOgogICAgICAgICAgICAgKgogICAgICAgICAgICAgKiAgLSB1c2VyIGlzIG9uIC9hCiAgICAgICAgICAgICAqICAtIHVzZXIgY2xpY2tzIGEgbGluayB0byAvYgogICAgICAgICAgICAgKiAgLSBsb2FkZXIgZm9yIC9iIHJlZGlyZWN0cyB0byAvYwogICAgICAgICAgICAgKgogICAgICAgICAgICAgKiBJbiBhIG5vbi1KUyBhcHAgdGhlIGJyb3dzZXIgd291bGQgdHJhY2sgdGhlIGluLWZsaWdodCBuYXZpZ2F0aW9uIHRvIC9iIGFuZAogICAgICAgICAgICAgKiB0aGVuIHJlcGxhY2UgaXQgd2l0aCAvYyB3aGVuIGl0IGVuY291bnRlcmVkIHRoZSByZWRpcmVjdCByZXNwb25zZS4gIEluCiAgICAgICAgICAgICAqIHRoZSBlbmQgaXQgd291bGQgb25seSBldmVyIHVwZGF0ZSB0aGUgVVJMIGJhciB3aXRoIC9jLgogICAgICAgICAgICAgKgogICAgICAgICAgICAgKiBJbiBjbGllbnQtc2lkZSByb3V0aW5nIHVzaW5nIHB1c2hTdGF0ZS9yZXBsYWNlU3RhdGUsIHdlIGFpbSB0byBlbXVsYXRlCiAgICAgICAgICAgICAqIHRoaXMgYmVoYXZpb3IgYW5kIHdlIGFsc28gZG8gbm90IHVwZGF0ZSBoaXN0b3J5IHVudGlsIHRoZSBlbmQgb2YgdGhlCiAgICAgICAgICAgICAqIG5hdmlnYXRpb24gKGluY2x1ZGluZyBwcm9jZXNzZWQgcmVkaXJlY3RzKS4gIFRoaXMgbWVhbnMgdGhhdCB3ZSBuZXZlcgogICAgICAgICAgICAgKiBhY3R1YWxseSB0b3VjaCBoaXN0b3J5IHVudGlsIHdlJ3ZlIHByb2Nlc3NlZCByZWRpcmVjdHMsIHNvIHdlIGp1c3QgdXNlCiAgICAgICAgICAgICAqIHRoZSBoaXN0b3J5IGFjdGlvbiBmcm9tIHRoZSBvcmlnaW5hbCBuYXZpZ2F0aW9uIChQVVNIIG9yIFJFUExBQ0UpLgogICAgICAgICAgICAgKi9mdW5jdGlvbiBfaGFuZGxlRmV0Y2hlckxvYWRlcigpIHtfaGFuZGxlRmV0Y2hlckxvYWRlciA9IF9hc3luY1RvR2VuZXJhdG9yMiggLyojX19QVVJFX18qL19yZWdlbmVyYXRvclJ1bnRpbWUyKCkubWFyayhmdW5jdGlvbiBfY2FsbGVlMTAoa2V5LCByb3V0ZUlkLCBwYXRoLCBtYXRjaCwgbWF0Y2hlcykge3ZhciBleGlzdGluZ0ZldGNoZXIsIGxvYWRpbmdGZXRjaGVyLCBhYm9ydENvbnRyb2xsZXIsIGZldGNoUmVxdWVzdCwgcmVzdWx0LCByZWRpcmVjdE5hdmlnYXRpb24sIGJvdW5kYXJ5TWF0Y2gsIGRvbmVGZXRjaGVyO3JldHVybiBfcmVnZW5lcmF0b3JSdW50aW1lMigpLndyYXAoZnVuY3Rpb24gX2NhbGxlZTEwJChfY29udGV4dDEwKSB7d2hpbGUgKDEpIHtzd2l0Y2ggKF9jb250ZXh0MTAucHJldiA9IF9jb250ZXh0MTAubmV4dCkge2Nhc2UgMDpleGlzdGluZ0ZldGNoZXIgPSBzdGF0ZS5mZXRjaGVycy5nZXQoa2V5KTsgLy8gUHV0IHRoaXMgZmV0Y2hlciBpbnRvIGl0J3MgbG9hZGluZyBzdGF0ZQogICAgICAgICAgICAgICAgICAgICAgICBsb2FkaW5nRmV0Y2hlciA9IHsgc3RhdGU6ICJsb2FkaW5nIiwgZm9ybU1ldGhvZDogdW5kZWZpbmVkLCBmb3JtQWN0aW9uOiB1bmRlZmluZWQsIGZvcm1FbmNUeXBlOiB1bmRlZmluZWQsIGZvcm1EYXRhOiB1bmRlZmluZWQsIGRhdGE6IGV4aXN0aW5nRmV0Y2hlciAmJiBleGlzdGluZ0ZldGNoZXIuZGF0YSB9O3N0YXRlLmZldGNoZXJzLnNldChrZXksIGxvYWRpbmdGZXRjaGVyKTt1cGRhdGVTdGF0ZSh7IGZldGNoZXJzOiBuZXcgTWFwKHN0YXRlLmZldGNoZXJzKSB9KTsgLy8gQ2FsbCB0aGUgbG9hZGVyIGZvciB0aGlzIGZldGNoZXIgcm91dGUgbWF0Y2gKICAgICAgICAgICAgICAgICAgICAgICAgYWJvcnRDb250cm9sbGVyID0gbmV3IEFib3J0Q29udHJvbGxlcigpO2ZldGNoUmVxdWVzdCA9IGNyZWF0ZVJlcXVlc3QocGF0aCwgYWJvcnRDb250cm9sbGVyLnNpZ25hbCk7ZmV0Y2hDb250cm9sbGVycy5zZXQoa2V5LCBhYm9ydENvbnRyb2xsZXIpO19jb250ZXh0MTAubmV4dCA9IDk7cmV0dXJuIGNhbGxMb2FkZXJPckFjdGlvbigibG9hZGVyIiwgZmV0Y2hSZXF1ZXN0LCBtYXRjaCwgbWF0Y2hlcywgcm91dGVyLmJhc2VuYW1lKTtjYXNlIDk6cmVzdWx0ID0gX2NvbnRleHQxMC5zZW50O2lmICghaXNEZWZlcnJlZFJlc3VsdChyZXN1bHQpKSB7X2NvbnRleHQxMC5uZXh0ID0gMTc7YnJlYWs7fV9jb250ZXh0MTAubmV4dCA9IDEzO3JldHVybiByZXNvbHZlRGVmZXJyZWREYXRhKHJlc3VsdCwgZmV0Y2hSZXF1ZXN0LnNpZ25hbCwgdHJ1ZSk7Y2FzZSAxMzpfY29udGV4dDEwLnQwID0gX2NvbnRleHQxMC5zZW50O2lmIChfY29udGV4dDEwLnQwKSB7X2NvbnRleHQxMC5uZXh0ID0gMTY7YnJlYWs7fV9jb250ZXh0MTAudDAgPSByZXN1bHQ7Y2FzZSAxNjpyZXN1bHQgPSBfY29udGV4dDEwLnQwO2Nhc2UgMTc6IC8vIFdlIGNhbiBkZWxldGUgdGhpcyBzbyBsb25nIGFzIHdlIHdlcmVuJ3QgYWJvcnRlZCBieSBvdSBvdXIgb3duIGZldGNoZXIKICAgICAgICAgICAgICAgICAgICAgICAgLy8gcmUtbG9hZCB3aGljaCB3b3VsZCBoYXZlIHB1dCBfbmV3XyBjb250cm9sbGVyIGlzIGluIGZldGNoQ29udHJvbGxlcnMKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGZldGNoQ29udHJvbGxlcnMuZ2V0KGtleSkgPT09IGFib3J0Q29udHJvbGxlcikge2ZldGNoQ29udHJvbGxlcnMuZGVsZXRlKGtleSk7fWlmICghZmV0Y2hSZXF1ZXN0LnNpZ25hbC5hYm9ydGVkKSB7X2NvbnRleHQxMC5uZXh0ID0gMjA7YnJlYWs7fXJldHVybiBfY29udGV4dDEwLmFicnVwdCgicmV0dXJuIik7Y2FzZSAyMDppZiAoIWlzUmVkaXJlY3RSZXN1bHQocmVzdWx0KSkge19jb250ZXh0MTAubmV4dCA9IDI1O2JyZWFrO31yZWRpcmVjdE5hdmlnYXRpb24gPSBnZXRMb2FkZXJSZWRpcmVjdChzdGF0ZSwgcmVzdWx0KTtfY29udGV4dDEwLm5leHQgPSAyNDtyZXR1cm4gc3RhcnRSZWRpcmVjdE5hdmlnYXRpb24ocmVzdWx0LCByZWRpcmVjdE5hdmlnYXRpb24pO2Nhc2UgMjQ6cmV0dXJuIF9jb250ZXh0MTAuYWJydXB0KCJyZXR1cm4iKTtjYXNlIDI1OmlmICghaXNFcnJvclJlc3VsdChyZXN1bHQpKSB7X2NvbnRleHQxMC5uZXh0ID0gMzA7YnJlYWs7fWJvdW5kYXJ5TWF0Y2ggPSBmaW5kTmVhcmVzdEJvdW5kYXJ5KHN0YXRlLm1hdGNoZXMsIHJvdXRlSWQpO3N0YXRlLmZldGNoZXJzLmRlbGV0ZShrZXkpOyAvLyBUT0RPOiBJbiByZW1peCwgdGhpcyB3b3VsZCByZXNldCB0byBJRExFX05BVklHQVRJT04gaWYgaXQgd2FzIGEgY2F0Y2ggLQogICAgICAgICAgICAgICAgICAgICAgICAvLyBkbyB3ZSBuZWVkIHRvIGJlaGF2ZSBhbnkgZGlmZmVyZW50bHkgd2l0aCBvdXIgbm9uLXJlZGlyZWN0IGVycm9ycz8KICAgICAgICAgICAgICAgICAgICAgICAgLy8gV2hhdCBpZiBpdCB3YXMgYSBub24tcmVkaXJlY3QgUmVzcG9uc2U/CiAgICAgICAgICAgICAgICAgICAgICAgIHVwZGF0ZVN0YXRlKHsgZmV0Y2hlcnM6IG5ldyBNYXAoc3RhdGUuZmV0Y2hlcnMpLCBlcnJvcnM6IF9kZWZpbmVQcm9wZXJ0eTIoe30sIGJvdW5kYXJ5TWF0Y2gucm91dGUuaWQsIHJlc3VsdC5lcnJvcikgfSk7cmV0dXJuIF9jb250ZXh0MTAuYWJydXB0KCJyZXR1cm4iKTtjYXNlIDMwOnJvdXRlcl9pbnZhcmlhbnQoIWlzRGVmZXJyZWRSZXN1bHQocmVzdWx0KSwgIlVuaGFuZGxlZCBmZXRjaGVyIGRlZmVycmVkIGRhdGEiKTsgLy8gUHV0IHRoZSBmZXRjaGVyIGJhY2sgaW50byBhbiBpZGxlIHN0YXRlCiAgICAgICAgICAgICAgICAgICAgICAgIGRvbmVGZXRjaGVyID0geyBzdGF0ZTogImlkbGUiLCBkYXRhOiByZXN1bHQuZGF0YSwgZm9ybU1ldGhvZDogdW5kZWZpbmVkLCBmb3JtQWN0aW9uOiB1bmRlZmluZWQsIGZvcm1FbmNUeXBlOiB1bmRlZmluZWQsIGZvcm1EYXRhOiB1bmRlZmluZWQgfTtzdGF0ZS5mZXRjaGVycy5zZXQoa2V5LCBkb25lRmV0Y2hlcik7dXBkYXRlU3RhdGUoeyBmZXRjaGVyczogbmV3IE1hcChzdGF0ZS5mZXRjaGVycykgfSk7Y2FzZSAzNDpjYXNlICJlbmQiOnJldHVybiBfY29udGV4dDEwLnN0b3AoKTt9fX0sIF9jYWxsZWUxMCk7fSkpO3JldHVybiBfaGFuZGxlRmV0Y2hlckxvYWRlci5hcHBseSh0aGlzLCBhcmd1bWVudHMpO31mdW5jdGlvbiBzdGFydFJlZGlyZWN0TmF2aWdhdGlvbihfeDM1LCBfeDM2LCBfeDM3KSB7cmV0dXJuIF9zdGFydFJlZGlyZWN0TmF2aWdhdGlvbi5hcHBseSh0aGlzLCBhcmd1bWVudHMpO31mdW5jdGlvbiBfc3RhcnRSZWRpcmVjdE5hdmlnYXRpb24oKSB7X3N0YXJ0UmVkaXJlY3ROYXZpZ2F0aW9uID0gX2FzeW5jVG9HZW5lcmF0b3IyKCAvKiNfX1BVUkVfXyovX3JlZ2VuZXJhdG9yUnVudGltZTIoKS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUxMShyZWRpcmVjdCwgbmF2aWdhdGlvbiwgcmVwbGFjZSkge3ZhciByZWRpcmVjdEhpc3RvcnlBY3Rpb247cmV0dXJuIF9yZWdlbmVyYXRvclJ1bnRpbWUyKCkud3JhcChmdW5jdGlvbiBfY2FsbGVlMTEkKF9jb250ZXh0MTEpIHt3aGlsZSAoMSkge3N3aXRjaCAoX2NvbnRleHQxMS5wcmV2ID0gX2NvbnRleHQxMS5uZXh0KSB7Y2FzZSAwOmlmIChyZWRpcmVjdC5yZXZhbGlkYXRlKSB7aXNSZXZhbGlkYXRpb25SZXF1aXJlZCA9IHRydWU7fXJvdXRlcl9pbnZhcmlhbnQobmF2aWdhdGlvbi5sb2NhdGlvbiwgIkV4cGVjdGVkIGEgbG9jYXRpb24gb24gdGhlIHJlZGlyZWN0IG5hdmlnYXRpb24iKTsgLy8gVGhlcmUncyBubyBuZWVkIHRvIGFib3J0IG9uIHJlZGlyZWN0cywgc2luY2Ugd2UgZG9uJ3QgZGV0ZWN0IHRoZQogICAgICAgICAgICAgICAgICAgICAgICAvLyByZWRpcmVjdCB1bnRpbCB0aGUgYWN0aW9uL2xvYWRlcnMgaGF2ZSBzZXR0bGVkCgogICAgICAgICAgICAgICAgICAgICAgICBwZW5kaW5nTmF2aWdhdGlvbkNvbnRyb2xsZXIgPSBudWxsOwogICAgICAgICAgICAgICAgICAgICAgICByZWRpcmVjdEhpc3RvcnlBY3Rpb24gPSByZXBsYWNlID09PSB0cnVlID8gQWN0aW9uLlJlcGxhY2UgOiBBY3Rpb24uUHVzaDtfY29udGV4dDExLm5leHQgPSA2O3JldHVybiAoCiAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhcnROYXZpZ2F0aW9uKHJlZGlyZWN0SGlzdG9yeUFjdGlvbiwgbmF2aWdhdGlvbi5sb2NhdGlvbiwgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgb3ZlcnJpZGVOYXZpZ2F0aW9uOiBuYXZpZ2F0aW9uCiAgICAgICAgICAgICAgICAgICAgICAgICAgfSkpO2Nhc2UgNjpjYXNlICJlbmQiOnJldHVybiBfY29udGV4dDExLnN0b3AoKTt9fX0sIF9jYWxsZWUxMSk7fSkpO3JldHVybiBfc3RhcnRSZWRpcmVjdE5hdmlnYXRpb24uYXBwbHkodGhpcywgYXJndW1lbnRzKTt9ZnVuY3Rpb24KCgogICAgICAgICAgICBjYWxsTG9hZGVyc0FuZE1heWJlUmVzb2x2ZURhdGEoX3gzOCwgX3gzOSwgX3g0MCwgX3g0MSwgX3g0Mikge3JldHVybiBfY2FsbExvYWRlcnNBbmRNYXliZVJlc29sdmVEYXRhLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7fWZ1bmN0aW9uIF9jYWxsTG9hZGVyc0FuZE1heWJlUmVzb2x2ZURhdGEoKSB7X2NhbGxMb2FkZXJzQW5kTWF5YmVSZXNvbHZlRGF0YSA9IF9hc3luY1RvR2VuZXJhdG9yMiggLyojX19QVVJFX18qL19yZWdlbmVyYXRvclJ1bnRpbWUyKCkubWFyayhmdW5jdGlvbiBfY2FsbGVlMTIoY3VycmVudE1hdGNoZXMsIG1hdGNoZXMsIG1hdGNoZXNUb0xvYWQsIGZldGNoZXJzVG9Mb2FkLCByZXF1ZXN0KSB7dmFyIHJlc3VsdHMsIGxvYWRlclJlc3VsdHMsIGZldGNoZXJSZXN1bHRzO3JldHVybiBfcmVnZW5lcmF0b3JSdW50aW1lMigpLndyYXAoZnVuY3Rpb24gX2NhbGxlZTEyJChfY29udGV4dDEyKSB7d2hpbGUgKDEpIHtzd2l0Y2ggKF9jb250ZXh0MTIucHJldiA9IF9jb250ZXh0MTIubmV4dCkge2Nhc2UgMDpfY29udGV4dDEyLm5leHQgPSAyO3JldHVybiAoCgoKCiAgICAgICAgICAgICAgICAgICAgICAgICAgUHJvbWlzZS5hbGwoW10uY29uY2F0KF90b0NvbnN1bWFibGVBcnJheTIobWF0Y2hlc1RvTG9hZC5tYXAoKG1hdGNoKSA9PiBjYWxsTG9hZGVyT3JBY3Rpb24oImxvYWRlciIsIHJlcXVlc3QsIG1hdGNoLCBtYXRjaGVzLCByb3V0ZXIuYmFzZW5hbWUpKSksIF90b0NvbnN1bWFibGVBcnJheTIoZmV0Y2hlcnNUb0xvYWQubWFwKChfcmVmOCkgPT4gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIF9yZWYyMCA9IF9zbGljZWRUb0FycmF5MihfcmVmOCwgNCksaHJlZiA9IF9yZWYyMFsxXSxtYXRjaCA9IF9yZWYyMFsyXSxmZXRjaE1hdGNoZXMgPSBfcmVmMjBbM107CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gY2FsbExvYWRlck9yQWN0aW9uKCJsb2FkZXIiLCBjcmVhdGVSZXF1ZXN0KGhyZWYsIHJlcXVlc3Quc2lnbmFsKSwgbWF0Y2gsIGZldGNoTWF0Y2hlcywgcm91dGVyLmJhc2VuYW1lKTsKICAgICAgICAgICAgICAgICAgICAgICAgICB9KSkpKSk7Y2FzZSAyOnJlc3VsdHMgPSBfY29udGV4dDEyLnNlbnQ7CiAgICAgICAgICAgICAgICAgICAgICAgIGxvYWRlclJlc3VsdHMgPSByZXN1bHRzLnNsaWNlKDAsIG1hdGNoZXNUb0xvYWQubGVuZ3RoKTsKICAgICAgICAgICAgICAgICAgICAgICAgZmV0Y2hlclJlc3VsdHMgPSByZXN1bHRzLnNsaWNlKG1hdGNoZXNUb0xvYWQubGVuZ3RoKTtfY29udGV4dDEyLm5leHQgPSA3O3JldHVybiAoCiAgICAgICAgICAgICAgICAgICAgICAgICAgUHJvbWlzZS5hbGwoW3Jlc29sdmVEZWZlcnJlZFJlc3VsdHMoY3VycmVudE1hdGNoZXMsIG1hdGNoZXNUb0xvYWQsIGxvYWRlclJlc3VsdHMsIHJlcXVlc3Quc2lnbmFsLCBmYWxzZSwgc3RhdGUubG9hZGVyRGF0YSksIHJlc29sdmVEZWZlcnJlZFJlc3VsdHMoY3VycmVudE1hdGNoZXMsIGZldGNoZXJzVG9Mb2FkLm1hcCgoX3JlZjkpID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBfcmVmMjEgPSBfc2xpY2VkVG9BcnJheTIoX3JlZjksIDMpLG1hdGNoID0gX3JlZjIxWzJdOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG1hdGNoOwogICAgICAgICAgICAgICAgICAgICAgICAgIH0pLCBmZXRjaGVyUmVzdWx0cywgcmVxdWVzdC5zaWduYWwsIHRydWUpXSkpO2Nhc2UgNzpyZXR1cm4gX2NvbnRleHQxMi5hYnJ1cHQoInJldHVybiIsCiAgICAgICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgICByZXN1bHRzOiByZXN1bHRzLAogICAgICAgICAgICAgICAgICAgICAgICAgIGxvYWRlclJlc3VsdHM6IGxvYWRlclJlc3VsdHMsCiAgICAgICAgICAgICAgICAgICAgICAgICAgZmV0Y2hlclJlc3VsdHM6IGZldGNoZXJSZXN1bHRzCiAgICAgICAgICAgICAgICAgICAgICAgIH0pO2Nhc2UgODpjYXNlICJlbmQiOnJldHVybiBfY29udGV4dDEyLnN0b3AoKTt9fX0sIF9jYWxsZWUxMik7fSkpO3JldHVybiBfY2FsbExvYWRlcnNBbmRNYXliZVJlc29sdmVEYXRhLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7fQoKCiAgICAgICAgICAgIGZ1bmN0aW9uIGludGVycnVwdEFjdGl2ZUxvYWRzKCkge3ZhciBfY2FuY2VsbGVkRGVmZXJyZWRSb3U7CiAgICAgICAgICAgICAgLy8gRXZlcnkgaW50ZXJydXB0aW9uIHRyaWdnZXJzIGEgcmV2YWxpZGF0aW9uCiAgICAgICAgICAgICAgaXNSZXZhbGlkYXRpb25SZXF1aXJlZCA9IHRydWU7IC8vIENhbmNlbCBwZW5kaW5nIHJvdXRlLWxldmVsIGRlZmVycmVkcyBhbmQgbWFyayBjYW5jZWxsZWQgcm91dGVzIGZvcgogICAgICAgICAgICAgIC8vIHJldmFsaWRhdGlvbgoKICAgICAgICAgICAgICAoX2NhbmNlbGxlZERlZmVycmVkUm91ID0gY2FuY2VsbGVkRGVmZXJyZWRSb3V0ZXMpLnB1c2guYXBwbHkoX2NhbmNlbGxlZERlZmVycmVkUm91LCBfdG9Db25zdW1hYmxlQXJyYXkyKGNhbmNlbEFjdGl2ZURlZmVycmVkcygpKSk7IC8vIEFib3J0IGluLWZsaWdodCBmZXRjaGVyIGxvYWRzCgogICAgICAgICAgICAgIGZldGNoTG9hZE1hdGNoZXMuZm9yRWFjaCgoXywga2V5KSA9PiB7CiAgICAgICAgICAgICAgICBpZiAoZmV0Y2hDb250cm9sbGVycy5oYXMoa2V5KSkgewogICAgICAgICAgICAgICAgICBjYW5jZWxsZWRGZXRjaGVyTG9hZHMucHVzaChrZXkpOwogICAgICAgICAgICAgICAgICBhYm9ydEZldGNoZXIoa2V5KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgZnVuY3Rpb24gc2V0RmV0Y2hlckVycm9yKGtleSwgcm91dGVJZCwgZXJyb3IpIHsKICAgICAgICAgICAgICB2YXIgYm91bmRhcnlNYXRjaCA9IGZpbmROZWFyZXN0Qm91bmRhcnkoc3RhdGUubWF0Y2hlcywgcm91dGVJZCk7CiAgICAgICAgICAgICAgZGVsZXRlRmV0Y2hlcihrZXkpOwogICAgICAgICAgICAgIHVwZGF0ZVN0YXRlKHsKICAgICAgICAgICAgICAgIGVycm9yczogX2RlZmluZVByb3BlcnR5Mih7fSwKICAgICAgICAgICAgICAgIGJvdW5kYXJ5TWF0Y2gucm91dGUuaWQsIGVycm9yKSwKCiAgICAgICAgICAgICAgICBmZXRjaGVyczogbmV3IE1hcChzdGF0ZS5mZXRjaGVycykKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgZnVuY3Rpb24gZGVsZXRlRmV0Y2hlcihrZXkpIHsKICAgICAgICAgICAgICBpZiAoZmV0Y2hDb250cm9sbGVycy5oYXMoa2V5KSkgYWJvcnRGZXRjaGVyKGtleSk7CiAgICAgICAgICAgICAgZmV0Y2hMb2FkTWF0Y2hlcy5kZWxldGUoa2V5KTsKICAgICAgICAgICAgICBmZXRjaFJlbG9hZElkcy5kZWxldGUoa2V5KTsKICAgICAgICAgICAgICBmZXRjaFJlZGlyZWN0SWRzLmRlbGV0ZShrZXkpOwogICAgICAgICAgICAgIHN0YXRlLmZldGNoZXJzLmRlbGV0ZShrZXkpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBmdW5jdGlvbiBhYm9ydEZldGNoZXIoa2V5KSB7CiAgICAgICAgICAgICAgdmFyIGNvbnRyb2xsZXIgPSBmZXRjaENvbnRyb2xsZXJzLmdldChrZXkpOwogICAgICAgICAgICAgIHJvdXRlcl9pbnZhcmlhbnQoY29udHJvbGxlciwgIkV4cGVjdGVkIGZldGNoIGNvbnRyb2xsZXI6ICIgKyBrZXkpOwogICAgICAgICAgICAgIGNvbnRyb2xsZXIuYWJvcnQoKTsKICAgICAgICAgICAgICBmZXRjaENvbnRyb2xsZXJzLmRlbGV0ZShrZXkpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBmdW5jdGlvbiBtYXJrRmV0Y2hlcnNEb25lKGtleXMpIHt2YXIgX2l0ZXJhdG9yMyA9IF9jcmVhdGVGb3JPZkl0ZXJhdG9ySGVscGVyMigKICAgICAgICAgICAgICAgIGtleXMpLF9zdGVwMzt0cnkge2ZvciAoX2l0ZXJhdG9yMy5zKCk7ICEoX3N0ZXAzID0gX2l0ZXJhdG9yMy5uKCkpLmRvbmU7KSB7dmFyIGtleSA9IF9zdGVwMy52YWx1ZTsKICAgICAgICAgICAgICAgICAgdmFyIGZldGNoZXIgPSBnZXRGZXRjaGVyKGtleSk7CiAgICAgICAgICAgICAgICAgIHZhciBkb25lRmV0Y2hlciA9IHsKICAgICAgICAgICAgICAgICAgICBzdGF0ZTogImlkbGUiLAogICAgICAgICAgICAgICAgICAgIGRhdGE6IGZldGNoZXIuZGF0YSwKICAgICAgICAgICAgICAgICAgICBmb3JtTWV0aG9kOiB1bmRlZmluZWQsCiAgICAgICAgICAgICAgICAgICAgZm9ybUFjdGlvbjogdW5kZWZpbmVkLAogICAgICAgICAgICAgICAgICAgIGZvcm1FbmNUeXBlOiB1bmRlZmluZWQsCiAgICAgICAgICAgICAgICAgICAgZm9ybURhdGE6IHVuZGVmaW5lZAogICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgICBzdGF0ZS5mZXRjaGVycy5zZXQoa2V5LCBkb25lRmV0Y2hlcik7CiAgICAgICAgICAgICAgICB9fSBjYXRjaCAoZXJyKSB7X2l0ZXJhdG9yMy5lKGVycik7fSBmaW5hbGx5IHtfaXRlcmF0b3IzLmYoKTt9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGZ1bmN0aW9uIG1hcmtGZXRjaFJlZGlyZWN0c0RvbmUoKSB7CiAgICAgICAgICAgICAgdmFyIGRvbmVLZXlzID0gW107dmFyIF9pdGVyYXRvcjQgPSBfY3JlYXRlRm9yT2ZJdGVyYXRvckhlbHBlcjIoCgogICAgICAgICAgICAgICAgZmV0Y2hSZWRpcmVjdElkcyksX3N0ZXA0O3RyeSB7Zm9yIChfaXRlcmF0b3I0LnMoKTsgIShfc3RlcDQgPSBfaXRlcmF0b3I0Lm4oKSkuZG9uZTspIHt2YXIga2V5ID0gX3N0ZXA0LnZhbHVlOwogICAgICAgICAgICAgICAgICB2YXIgZmV0Y2hlciA9IHN0YXRlLmZldGNoZXJzLmdldChrZXkpOwogICAgICAgICAgICAgICAgICByb3V0ZXJfaW52YXJpYW50KGZldGNoZXIsICJFeHBlY3RlZCBmZXRjaGVyOiAiICsga2V5KTsKCiAgICAgICAgICAgICAgICAgIGlmIChmZXRjaGVyLnN0YXRlID09PSAibG9hZGluZyIpIHsKICAgICAgICAgICAgICAgICAgICBmZXRjaFJlZGlyZWN0SWRzLmRlbGV0ZShrZXkpOwogICAgICAgICAgICAgICAgICAgIGRvbmVLZXlzLnB1c2goa2V5KTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfX0gY2F0Y2ggKGVycikge19pdGVyYXRvcjQuZShlcnIpO30gZmluYWxseSB7X2l0ZXJhdG9yNC5mKCk7fQoKICAgICAgICAgICAgICBtYXJrRmV0Y2hlcnNEb25lKGRvbmVLZXlzKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgZnVuY3Rpb24gYWJvcnRTdGFsZUZldGNoTG9hZHMobGFuZGVkSWQpIHsKICAgICAgICAgICAgICB2YXIgeWVldGVkS2V5cyA9IFtdO3ZhciBfaXRlcmF0b3I1ID0gX2NyZWF0ZUZvck9mSXRlcmF0b3JIZWxwZXIyKAoKICAgICAgICAgICAgICAgIGZldGNoUmVsb2FkSWRzKSxfc3RlcDU7dHJ5IHtmb3IgKF9pdGVyYXRvcjUucygpOyAhKF9zdGVwNSA9IF9pdGVyYXRvcjUubigpKS5kb25lOykge3ZhciBfc3RlcDUkdmFsdWUgPSBfc2xpY2VkVG9BcnJheTIoX3N0ZXA1LnZhbHVlLCAyKSxrZXkgPSBfc3RlcDUkdmFsdWVbMF0saWQgPSBfc3RlcDUkdmFsdWVbMV07CiAgICAgICAgICAgICAgICAgIGlmIChpZCA8IGxhbmRlZElkKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIGZldGNoZXIgPSBzdGF0ZS5mZXRjaGVycy5nZXQoa2V5KTsKICAgICAgICAgICAgICAgICAgICByb3V0ZXJfaW52YXJpYW50KGZldGNoZXIsICJFeHBlY3RlZCBmZXRjaGVyOiAiICsga2V5KTsKCiAgICAgICAgICAgICAgICAgICAgaWYgKGZldGNoZXIuc3RhdGUgPT09ICJsb2FkaW5nIikgewogICAgICAgICAgICAgICAgICAgICAgYWJvcnRGZXRjaGVyKGtleSk7CiAgICAgICAgICAgICAgICAgICAgICBmZXRjaFJlbG9hZElkcy5kZWxldGUoa2V5KTsKICAgICAgICAgICAgICAgICAgICAgIHllZXRlZEtleXMucHVzaChrZXkpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfX0gY2F0Y2ggKGVycikge19pdGVyYXRvcjUuZShlcnIpO30gZmluYWxseSB7X2l0ZXJhdG9yNS5mKCk7fQoKICAgICAgICAgICAgICBtYXJrRmV0Y2hlcnNEb25lKHllZXRlZEtleXMpOwogICAgICAgICAgICAgIHJldHVybiB5ZWV0ZWRLZXlzLmxlbmd0aCA+IDA7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGZ1bmN0aW9uIGNhbmNlbEFjdGl2ZURlZmVycmVkcyhwcmVkaWNhdGUpIHsKICAgICAgICAgICAgICB2YXIgY2FuY2VsbGVkUm91dGVJZHMgPSBbXTsKICAgICAgICAgICAgICBhY3RpdmVEZWZlcnJlZHMuZm9yRWFjaCgoZGZkLCByb3V0ZUlkKSA9PiB7CiAgICAgICAgICAgICAgICBpZiAoIXByZWRpY2F0ZSB8fCBwcmVkaWNhdGUocm91dGVJZCkpIHsKICAgICAgICAgICAgICAgICAgLy8gQ2FuY2VsIHRoZSBkZWZlcnJlZCAtIGJ1dCBkbyBub3QgcmVtb3ZlIGZyb20gYWN0aXZlRGVmZXJyZWRzIGhlcmUgLQogICAgICAgICAgICAgICAgICAvLyB3ZSByZWx5IG9uIHRoZSBzdWJzY3JpYmVycyB0byBkbyB0aGF0IHNvIG91ciB0ZXN0cyBjYW4gYXNzZXJ0IHByb3BlcgogICAgICAgICAgICAgICAgICAvLyBjbGVhbnVwIHZpYSBfaW50ZXJuYWxBY3RpdmVEZWZlcnJlZHMKICAgICAgICAgICAgICAgICAgZGZkLmNhbmNlbCgpOwogICAgICAgICAgICAgICAgICBjYW5jZWxsZWRSb3V0ZUlkcy5wdXNoKHJvdXRlSWQpOwogICAgICAgICAgICAgICAgICBhY3RpdmVEZWZlcnJlZHMuZGVsZXRlKHJvdXRlSWQpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgIHJldHVybiBjYW5jZWxsZWRSb3V0ZUlkczsKICAgICAgICAgICAgfSAvLyBPcHQgaW4gdG8gY2FwdHVyaW5nIGFuZCByZXBvcnRpbmcgc2Nyb2xsIHBvc2l0aW9ucyBkdXJpbmcgbmF2aWdhdGlvbnMsCiAgICAgICAgICAgIC8vIHVzZWQgYnkgdGhlIDxTY3JvbGxSZXN0b3JhdGlvbj4gY29tcG9uZW50CgoKICAgICAgICAgICAgZnVuY3Rpb24gZW5hYmxlU2Nyb2xsUmVzdG9yYXRpb24ocG9zaXRpb25zLCBnZXRQb3NpdGlvbiwgZ2V0S2V5KSB7CiAgICAgICAgICAgICAgc2F2ZWRTY3JvbGxQb3NpdGlvbnMgPSBwb3NpdGlvbnM7CiAgICAgICAgICAgICAgZ2V0U2Nyb2xsUG9zaXRpb24gPSBnZXRQb3NpdGlvbjsKCiAgICAgICAgICAgICAgZ2V0U2Nyb2xsUmVzdG9yYXRpb25LZXkgPSBnZXRLZXkgfHwgKChsb2NhdGlvbikgPT4gbG9jYXRpb24ua2V5KTsgLy8gUGVyZm9ybSBpbml0aWFsIGh5ZHJhdGlvbiBzY3JvbGwgcmVzdG9yYXRpb24sIHNpbmNlIHdlIG1pc3MgdGhlIGJvYXQgb24KICAgICAgICAgICAgICAvLyB0aGUgaW5pdGlhbCB1cGRhdGVTdGF0ZSgpIGJlY2F1c2Ugd2UndmUgbm90IHlldCByZW5kZXJlZCA8U2Nyb2xsUmVzdG9yYXRpb24vPgogICAgICAgICAgICAgIC8vIGFuZCB0aGVyZWZvcmUgaGF2ZSBubyBzYXZlZFNjcm9sbFBvc2l0aW9ucyBhdmFpbGFibGUKCgogICAgICAgICAgICAgIGlmICghaW5pdGlhbFNjcm9sbFJlc3RvcmVkICYmIHN0YXRlLm5hdmlnYXRpb24gPT09IElETEVfTkFWSUdBVElPTikgewogICAgICAgICAgICAgICAgaW5pdGlhbFNjcm9sbFJlc3RvcmVkID0gdHJ1ZTsKICAgICAgICAgICAgICAgIHZhciB5ID0gZ2V0U2F2ZWRTY3JvbGxQb3NpdGlvbihzdGF0ZS5sb2NhdGlvbiwgc3RhdGUubWF0Y2hlcyk7CgogICAgICAgICAgICAgICAgaWYgKHkgIT0gbnVsbCkgewogICAgICAgICAgICAgICAgICB1cGRhdGVTdGF0ZSh7CiAgICAgICAgICAgICAgICAgICAgcmVzdG9yZVNjcm9sbFBvc2l0aW9uOiB5CiAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgcmV0dXJuICgpID0+IHsKICAgICAgICAgICAgICAgIHNhdmVkU2Nyb2xsUG9zaXRpb25zID0gbnVsbDsKICAgICAgICAgICAgICAgIGdldFNjcm9sbFBvc2l0aW9uID0gbnVsbDsKICAgICAgICAgICAgICAgIGdldFNjcm9sbFJlc3RvcmF0aW9uS2V5ID0gbnVsbDsKICAgICAgICAgICAgICB9OwogICAgICAgICAgICB9CgogICAgICAgICAgICBmdW5jdGlvbiBzYXZlU2Nyb2xsUG9zaXRpb24obG9jYXRpb24sIG1hdGNoZXMpIHsKICAgICAgICAgICAgICBpZiAoc2F2ZWRTY3JvbGxQb3NpdGlvbnMgJiYgZ2V0U2Nyb2xsUmVzdG9yYXRpb25LZXkgJiYgZ2V0U2Nyb2xsUG9zaXRpb24pIHsKICAgICAgICAgICAgICAgIHZhciB1c2VyTWF0Y2hlcyA9IG1hdGNoZXMubWFwKChtKSA9PiBjcmVhdGVVc2VNYXRjaGVzTWF0Y2gobSwgc3RhdGUubG9hZGVyRGF0YSkpOwogICAgICAgICAgICAgICAgdmFyIGtleSA9IGdldFNjcm9sbFJlc3RvcmF0aW9uS2V5KGxvY2F0aW9uLCB1c2VyTWF0Y2hlcykgfHwgbG9jYXRpb24ua2V5OwogICAgICAgICAgICAgICAgc2F2ZWRTY3JvbGxQb3NpdGlvbnNba2V5XSA9IGdldFNjcm9sbFBvc2l0aW9uKCk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICBmdW5jdGlvbiBnZXRTYXZlZFNjcm9sbFBvc2l0aW9uKGxvY2F0aW9uLCBtYXRjaGVzKSB7CiAgICAgICAgICAgICAgaWYgKHNhdmVkU2Nyb2xsUG9zaXRpb25zICYmIGdldFNjcm9sbFJlc3RvcmF0aW9uS2V5ICYmIGdldFNjcm9sbFBvc2l0aW9uKSB7CiAgICAgICAgICAgICAgICB2YXIgdXNlck1hdGNoZXMgPSBtYXRjaGVzLm1hcCgobSkgPT4gY3JlYXRlVXNlTWF0Y2hlc01hdGNoKG0sIHN0YXRlLmxvYWRlckRhdGEpKTsKICAgICAgICAgICAgICAgIHZhciBrZXkgPSBnZXRTY3JvbGxSZXN0b3JhdGlvbktleShsb2NhdGlvbiwgdXNlck1hdGNoZXMpIHx8IGxvY2F0aW9uLmtleTsKICAgICAgICAgICAgICAgIHZhciB5ID0gc2F2ZWRTY3JvbGxQb3NpdGlvbnNba2V5XTsKCiAgICAgICAgICAgICAgICBpZiAodHlwZW9mIHkgPT09ICJudW1iZXIiKSB7CiAgICAgICAgICAgICAgICAgIHJldHVybiB5OwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJvdXRlciA9IHsKICAgICAgICAgICAgICBnZXQgYmFzZW5hbWUoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gaW5pdC5iYXNlbmFtZTsKICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICBnZXQgc3RhdGUoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gc3RhdGU7CiAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgZ2V0IHJvdXRlcygpIHsKICAgICAgICAgICAgICAgIHJldHVybiBkYXRhUm91dGVzOwogICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgIGluaXRpYWxpemU6IGluaXRpYWxpemUsCiAgICAgICAgICAgICAgc3Vic2NyaWJlOiBzdWJzY3JpYmUsCiAgICAgICAgICAgICAgZW5hYmxlU2Nyb2xsUmVzdG9yYXRpb246IGVuYWJsZVNjcm9sbFJlc3RvcmF0aW9uLAogICAgICAgICAgICAgIG5hdmlnYXRlOiBuYXZpZ2F0ZSwKICAgICAgICAgICAgICBmZXRjaDogZmV0Y2gsCiAgICAgICAgICAgICAgcmV2YWxpZGF0ZTogcmV2YWxpZGF0ZSwKICAgICAgICAgICAgICAvLyBQYXNzdGhyb3VnaCB0byBoaXN0b3J5LWF3YXJlIGNyZWF0ZUhyZWYgdXNlZCBieSB1c2VIcmVmIHNvIHdlIGdldCBwcm9wZXIKICAgICAgICAgICAgICAvLyBoYXNoLWF3YXJlIFVSTHMgaW4gRE9NIHBhdGhzCiAgICAgICAgICAgICAgY3JlYXRlSHJlZjogKHRvKSA9PiBpbml0Lmhpc3RvcnkuY3JlYXRlSHJlZih0byksCiAgICAgICAgICAgICAgZ2V0RmV0Y2hlcjogZ2V0RmV0Y2hlciwKICAgICAgICAgICAgICBkZWxldGVGZXRjaGVyOiBkZWxldGVGZXRjaGVyLAogICAgICAgICAgICAgIGRpc3Bvc2U6IGRpc3Bvc2UsCiAgICAgICAgICAgICAgX2ludGVybmFsRmV0Y2hDb250cm9sbGVyczogZmV0Y2hDb250cm9sbGVycywKICAgICAgICAgICAgICBfaW50ZXJuYWxBY3RpdmVEZWZlcnJlZHM6IGFjdGl2ZURlZmVycmVkcwogICAgICAgICAgICB9OwogICAgICAgICAgICByZXR1cm4gcm91dGVyOwogICAgICAgICAgfSAvLyNlbmRyZWdpb24KICAgICAgICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCiAgICAgICAgICAvLyNyZWdpb24gY3JlYXRlU3RhdGljSGFuZGxlcgogICAgICAgICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KCiAgICAgICAgICB2YXIgdmFsaWRBY3Rpb25NZXRob2RzID0gbmV3IFNldChbIlBPU1QiLCAiUFVUIiwgIlBBVENIIiwgIkRFTEVURSJdKTsKICAgICAgICAgIHZhciB2YWxpZFJlcXVlc3RNZXRob2RzID0gbmV3IFNldChbIkdFVCIsICJIRUFEIl0uY29uY2F0KF90b0NvbnN1bWFibGVBcnJheTIodmFsaWRBY3Rpb25NZXRob2RzKSkpOwogICAgICAgICAgZnVuY3Rpb24gdW5zdGFibGVfY3JlYXRlU3RhdGljSGFuZGxlcihyb3V0ZXMpIHsKICAgICAgICAgICAgcm91dGVyX2ludmFyaWFudChyb3V0ZXMubGVuZ3RoID4gMCwgIllvdSBtdXN0IHByb3ZpZGUgYSBub24tZW1wdHkgcm91dGVzIGFycmF5IHRvIHVuc3RhYmxlX2NyZWF0ZVN0YXRpY0hhbmRsZXIiKTsKICAgICAgICAgICAgdmFyIGRhdGFSb3V0ZXMgPSBjb252ZXJ0Um91dGVzVG9EYXRhUm91dGVzKHJvdXRlcyk7CiAgICAgICAgICAgIC8qKgogICAgICAgICAgICAgKiBUaGUgcXVlcnkoKSBtZXRob2QgaXMgaW50ZW5kZWQgZm9yIGRvY3VtZW50IHJlcXVlc3RzLCBpbiB3aGljaCB3ZSB3YW50IHRvCiAgICAgICAgICAgICAqIGNhbGwgYW4gb3B0aW9uYWwgYWN0aW9uIGFuZCBwb3RlbnRpYWxseSBtdWx0aXBsZSBsb2FkZXJzIGZvciBhbGwgbmVzdGVkCiAgICAgICAgICAgICAqIHJvdXRlcy4gIEl0IHJldHVybnMgYSBTdGF0aWNIYW5kbGVyQ29udGV4dCBvYmplY3QsIHdoaWNoIGlzIHZlcnkgc2ltaWxhcgogICAgICAgICAgICAgKiB0byB0aGUgcm91dGVyIHN0YXRlIChsb2NhdGlvbiwgbG9hZGVyRGF0YSwgYWN0aW9uRGF0YSwgZXJyb3JzLCBldGMuKSBhbmQKICAgICAgICAgICAgICogYWxzbyBhZGRzIFNTUi1zcGVjaWZpYyBpbmZvcm1hdGlvbiBzdWNoIGFzIHRoZSBzdGF0dXNDb2RlIGFuZCBoZWFkZXJzCiAgICAgICAgICAgICAqIGZyb20gYWN0aW9uL2xvYWRlcnMgUmVzcG9uc2VzLgogICAgICAgICAgICAgKgogICAgICAgICAgICAgKiBJdCBfc2hvdWxkXyBuZXZlciB0aHJvdyBhbmQgc2hvdWxkIHJlcG9ydCBhbGwgZXJyb3JzIHRocm91Z2ggdGhlCiAgICAgICAgICAgICAqIHJldHVybmVkIGNvbnRleHQuZXJyb3JzIG9iamVjdCwgcHJvcGVybHkgYXNzb2NpYXRpbmcgZXJyb3JzIHRvIHRoZWlyIGVycm9yCiAgICAgICAgICAgICAqIGJvdW5kYXJ5LiAgQWRkaXRpb25hbGx5LCBpdCB0cmFja3MgX2RlZXBlc3RSZW5kZXJlZEJvdW5kYXJ5SWQgd2hpY2ggY2FuIGJlCiAgICAgICAgICAgICAqIHVzZWQgdG8gZW11bGF0ZSBSZWFjdCBlcnJvciBib3VuZGFyaWVzIGR1cmluZyBTU3IgYnkgcGVyZm9ybWluZyBhIHNlY29uZAogICAgICAgICAgICAgKiBwYXNzIG9ubHkgZG93biB0byB0aGUgYm91bmRhcnlJZC4KICAgICAgICAgICAgICoKICAgICAgICAgICAgICogVGhlIG9uZSBleGNlcHRpb24gd2hlcmUgd2UgZG8gbm90IHJldHVybiBhIFN0YXRpY0hhbmRsZXJDb250ZXh0IGlzIHdoZW4gYQogICAgICAgICAgICAgKiByZWRpcmVjdCByZXNwb25zZSBpcyByZXR1cm5lZCBvciB0aHJvd24gZnJvbSBhbnkgYWN0aW9uL2xvYWRlci4gIFdlCiAgICAgICAgICAgICAqIHByb3BhZ2F0ZSB0aGF0IG91dCBhbmQgcmV0dXJuIHRoZSByYXcgUmVzcG9uc2Ugc28gdGhlIEhUVFAgc2VydmVyIGNhbgogICAgICAgICAgICAgKiByZXR1cm4gaXQgZGlyZWN0bHkuCiAgICAgICAgICAgICAqL2Z1bmN0aW9uCgogICAgICAgICAgICBxdWVyeShfeDQzKSB7cmV0dXJuIF9xdWVyeS5hcHBseSh0aGlzLCBhcmd1bWVudHMpO30KCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCiAgICAgICAgICAgIC8qKgogICAgICAgICAgICAgKiBUaGUgcXVlcnlSb3V0ZSgpIG1ldGhvZCBpcyBpbnRlbmRlZCBmb3IgdGFyZ2V0ZWQgcm91dGUgcmVxdWVzdHMsIGVpdGhlcgogICAgICAgICAgICAgKiBmb3IgZmV0Y2ggP19kYXRhIHJlcXVlc3RzIG9yIHJlc291cmNlIHJvdXRlIHJlcXVlc3RzLiAgSW4gdGhpcyBjYXNlLCB3ZQogICAgICAgICAgICAgKiBhcmUgb25seSBldmVyIGNhbGxpbmcgYSBzaW5nbGUgYWN0aW9uIG9yIGxvYWRlciwgYW5kIHdlIGFyZSByZXR1cm5pbmcgdGhlCiAgICAgICAgICAgICAqIHJldHVybmVkIHZhbHVlIGRpcmVjdGx5LiAgSW4gbW9zdCBjYXNlcywgdGhpcyB3aWxsIGJlIGEgUmVzcG9uc2UgcmV0dXJuZWQKICAgICAgICAgICAgICogZnJvbSB0aGUgYWN0aW9uL2xvYWRlciwgYnV0IGl0IG1heSBiZSBhIHByaW1pdGl2ZSBvciBvdGhlciB2YWx1ZSBhcyB3ZWxsIC0KICAgICAgICAgICAgICogYW5kIGluIHN1Y2ggY2FzZXMgdGhlIGNhbGxpbmcgY29udGV4dCBzaG91bGQgaGFuZGxlIHRoYXQgYWNjb3JkaW5nbHkuCiAgICAgICAgICAgICAqCiAgICAgICAgICAgICAqIFdlIGRvIHJlc3BlY3QgdGhlIHRocm93L3JldHVybiBkaWZmZXJlbnRpYXRpb24sIHNvIGlmIGFuIGFjdGlvbi9sb2FkZXIKICAgICAgICAgICAgICogdGhyb3dzLCB0aGVuIHRoaXMgbWV0aG9kIHdpbGwgdGhyb3cgdGhlIHZhbHVlLiAgVGhpcyBpcyBpbXBvcnRhbnQgc28gd2UKICAgICAgICAgICAgICogY2FuIGRvIHByb3BlciBib3VuZGFyeSBpZGVudGlmaWNhdGlvbiBpbiBSZW1peCB3aGVyZSBhIHRocm93biBSZXNwb25zZQogICAgICAgICAgICAgKiBtdXN0IGdvIHRvIHRoZSBDYXRjaCBCb3VuZGFyeSBidXQgYSByZXR1cm5lZCBSZXNwb25zZSBpcyBoYXBweS1wYXRoLgogICAgICAgICAgICAgKgogICAgICAgICAgICAgKiBPbmUgdGhpbmcgdG8gbm90ZSBpcyB0aGF0IGFueSBSb3V0ZXItaW5pdGlhdGVkIHRocm93biBSZXNwb25zZSAoc3VjaCBhcyBhCiAgICAgICAgICAgICAqIDQwNCBvciA0MDUpIHdpbGwgaGF2ZSBhIGN1c3RvbSBYLVJlbWl4LVJvdXRlci1FcnJvcjogInllcyIgaGVhZGVyIG9uIGl0CiAgICAgICAgICAgICAqIGluIG9yZGVyIHRvIGRpZmZlcmVudGlhdGUgZnJvbSByZXNwb25zZXMgdGhyb3duIGZyb20gdXNlciBhY3Rpb25zL2xvYWRlcnMuCiAgICAgICAgICAgICAqL2Z1bmN0aW9uIF9xdWVyeSgpIHtfcXVlcnkgPSBfYXN5bmNUb0dlbmVyYXRvcjIoIC8qI19fUFVSRV9fKi9fcmVnZW5lcmF0b3JSdW50aW1lMigpLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTEzKHJlcXVlc3QpIHt2YXIgdXJsLCBsb2NhdGlvbiwgbWF0Y2hlcywgX2dldE1ldGhvZE5vdEFsbG93ZWRNLCBtZXRob2ROb3RBbGxvd2VkTWF0Y2hlcywgcm91dGUsIGVycm9yLCBfZ2V0Tm90Rm91bmRNYXRjaGVzMywgbm90Rm91bmRNYXRjaGVzLCBfcm91dGUyLCBfZXJyb3IzLCByZXN1bHQ7cmV0dXJuIF9yZWdlbmVyYXRvclJ1bnRpbWUyKCkud3JhcChmdW5jdGlvbiBfY2FsbGVlMTMkKF9jb250ZXh0MTMpIHt3aGlsZSAoMSkge3N3aXRjaCAoX2NvbnRleHQxMy5wcmV2ID0gX2NvbnRleHQxMy5uZXh0KSB7Y2FzZSAwOnVybCA9IG5ldyBVUkwocmVxdWVzdC51cmwpO2xvY2F0aW9uID0gY3JlYXRlTG9jYXRpb24oIiIsIHJvdXRlcl9jcmVhdGVQYXRoKHVybCksIG51bGwsICJkZWZhdWx0Iik7bWF0Y2hlcyA9IG1hdGNoUm91dGVzKGRhdGFSb3V0ZXMsIGxvY2F0aW9uKTtpZiAodmFsaWRSZXF1ZXN0TWV0aG9kcy5oYXMocmVxdWVzdC5tZXRob2QpKSB7X2NvbnRleHQxMy5uZXh0ID0gODticmVhazt9X2dldE1ldGhvZE5vdEFsbG93ZWRNID0gZ2V0TWV0aG9kTm90QWxsb3dlZE1hdGNoZXMoZGF0YVJvdXRlcyksIG1ldGhvZE5vdEFsbG93ZWRNYXRjaGVzID0gX2dldE1ldGhvZE5vdEFsbG93ZWRNLm1hdGNoZXMsIHJvdXRlID0gX2dldE1ldGhvZE5vdEFsbG93ZWRNLnJvdXRlLCBlcnJvciA9IF9nZXRNZXRob2ROb3RBbGxvd2VkTS5lcnJvcjtyZXR1cm4gX2NvbnRleHQxMy5hYnJ1cHQoInJldHVybiIsIHsgbG9jYXRpb246IGxvY2F0aW9uLCBtYXRjaGVzOiBtZXRob2ROb3RBbGxvd2VkTWF0Y2hlcywgbG9hZGVyRGF0YToge30sIGFjdGlvbkRhdGE6IG51bGwsIGVycm9yczogX2RlZmluZVByb3BlcnR5Mih7fSwgcm91dGUuaWQsIGVycm9yKSwgc3RhdHVzQ29kZTogZXJyb3Iuc3RhdHVzLCBsb2FkZXJIZWFkZXJzOiB7fSwgYWN0aW9uSGVhZGVyczoge30gfSk7Y2FzZSA4OmlmIChtYXRjaGVzKSB7X2NvbnRleHQxMy5uZXh0ID0gMTE7YnJlYWs7fV9nZXROb3RGb3VuZE1hdGNoZXMzID0gZ2V0Tm90Rm91bmRNYXRjaGVzKGRhdGFSb3V0ZXMpLCBub3RGb3VuZE1hdGNoZXMgPSBfZ2V0Tm90Rm91bmRNYXRjaGVzMy5tYXRjaGVzLCBfcm91dGUyID0gX2dldE5vdEZvdW5kTWF0Y2hlczMucm91dGUsIF9lcnJvcjMgPSBfZ2V0Tm90Rm91bmRNYXRjaGVzMy5lcnJvcjtyZXR1cm4gX2NvbnRleHQxMy5hYnJ1cHQoInJldHVybiIsIHsgbG9jYXRpb246IGxvY2F0aW9uLCBtYXRjaGVzOiBub3RGb3VuZE1hdGNoZXMsIGxvYWRlckRhdGE6IHt9LCBhY3Rpb25EYXRhOiBudWxsLCBlcnJvcnM6IF9kZWZpbmVQcm9wZXJ0eTIoe30sIF9yb3V0ZTIuaWQsIF9lcnJvcjMpLCBzdGF0dXNDb2RlOiBfZXJyb3IzLnN0YXR1cywgbG9hZGVySGVhZGVyczoge30sIGFjdGlvbkhlYWRlcnM6IHt9IH0pO2Nhc2UgMTE6X2NvbnRleHQxMy5uZXh0ID0gMTM7cmV0dXJuIHF1ZXJ5SW1wbChyZXF1ZXN0LCBsb2NhdGlvbiwgbWF0Y2hlcyk7Y2FzZSAxMzpyZXN1bHQgPSBfY29udGV4dDEzLnNlbnQ7aWYgKCEocmVzdWx0IGluc3RhbmNlb2YgUmVzcG9uc2UpKSB7X2NvbnRleHQxMy5uZXh0ID0gMTY7YnJlYWs7fXJldHVybiBfY29udGV4dDEzLmFicnVwdCgicmV0dXJuIiwgcmVzdWx0KTtjYXNlIDE2OnJldHVybiBfY29udGV4dDEzLmFicnVwdCgicmV0dXJuIiwgX2V4dGVuZHMoeyBsb2NhdGlvbjogbG9jYXRpb24gfSwgcmVzdWx0KSk7Y2FzZSAxNzpjYXNlICJlbmQiOnJldHVybiBfY29udGV4dDEzLnN0b3AoKTt9fX0sIF9jYWxsZWUxMyk7fSkpO3JldHVybiBfcXVlcnkuYXBwbHkodGhpcywgYXJndW1lbnRzKTt9ZnVuY3Rpb24KCgogICAgICAgICAgICBxdWVyeVJvdXRlKF94NDQsIF94NDUpIHtyZXR1cm4gX3F1ZXJ5Um91dGUuYXBwbHkodGhpcywgYXJndW1lbnRzKTt9ZnVuY3Rpb24gX3F1ZXJ5Um91dGUoKSB7X3F1ZXJ5Um91dGUgPSBfYXN5bmNUb0dlbmVyYXRvcjIoIC8qI19fUFVSRV9fKi9fcmVnZW5lcmF0b3JSdW50aW1lMigpLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTE0KHJlcXVlc3QsIHJvdXRlSWQpIHt2YXIgdXJsLCBsb2NhdGlvbiwgbWF0Y2hlcywgbWF0Y2gsIHJlc3VsdCwgZXJyb3IsIHJvdXRlRGF0YTtyZXR1cm4gX3JlZ2VuZXJhdG9yUnVudGltZTIoKS53cmFwKGZ1bmN0aW9uIF9jYWxsZWUxNCQoX2NvbnRleHQxNCkge3doaWxlICgxKSB7c3dpdGNoIChfY29udGV4dDE0LnByZXYgPSBfY29udGV4dDE0Lm5leHQpIHtjYXNlIDA6CiAgICAgICAgICAgICAgICAgICAgICAgIHVybCA9IG5ldyBVUkwocmVxdWVzdC51cmwpOwogICAgICAgICAgICAgICAgICAgICAgICBsb2NhdGlvbiA9IGNyZWF0ZUxvY2F0aW9uKCIiLCByb3V0ZXJfY3JlYXRlUGF0aCh1cmwpLCBudWxsLCAiZGVmYXVsdCIpOwogICAgICAgICAgICAgICAgICAgICAgICBtYXRjaGVzID0gbWF0Y2hSb3V0ZXMoZGF0YVJvdXRlcywgbG9jYXRpb24pO2lmICgKCiAgICAgICAgICAgICAgICAgICAgICAgIHZhbGlkUmVxdWVzdE1ldGhvZHMuaGFzKHJlcXVlc3QubWV0aG9kKSkge19jb250ZXh0MTQubmV4dCA9IDc7YnJlYWs7fXRocm93ICgKICAgICAgICAgICAgICAgICAgICAgICAgICBjcmVhdGVSb3V0ZXJFcnJvclJlc3BvbnNlKG51bGwsIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YXR1czogNDA1LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhdHVzVGV4dDogIk1ldGhvZCBOb3QgQWxsb3dlZCIKICAgICAgICAgICAgICAgICAgICAgICAgICB9KSk7Y2FzZSA3OmlmICgKICAgICAgICAgICAgICAgICAgICAgICAgbWF0Y2hlcykge19jb250ZXh0MTQubmV4dCA9IDk7YnJlYWs7fXRocm93ICgKICAgICAgICAgICAgICAgICAgICAgICAgICBjcmVhdGVSb3V0ZXJFcnJvclJlc3BvbnNlKG51bGwsIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YXR1czogNDA0LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhdHVzVGV4dDogIk5vdCBGb3VuZCIKICAgICAgICAgICAgICAgICAgICAgICAgICB9KSk7Y2FzZSA5OgoKCiAgICAgICAgICAgICAgICAgICAgICAgIG1hdGNoID0gcm91dGVJZCA/IG1hdGNoZXMuZmluZCgobSkgPT4gbS5yb3V0ZS5pZCA9PT0gcm91dGVJZCkgOiBnZXRUYXJnZXRNYXRjaChtYXRjaGVzLCBsb2NhdGlvbik7aWYgKAoKICAgICAgICAgICAgICAgICAgICAgICAgbWF0Y2gpIHtfY29udGV4dDE0Lm5leHQgPSAxMjticmVhazt9dGhyb3cgKAogICAgICAgICAgICAgICAgICAgICAgICAgIGNyZWF0ZVJvdXRlckVycm9yUmVzcG9uc2UobnVsbCwgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhdHVzOiA0MDQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGF0dXNUZXh0OiAiTm90IEZvdW5kIgogICAgICAgICAgICAgICAgICAgICAgICAgIH0pKTtjYXNlIDEyOl9jb250ZXh0MTQubmV4dCA9IDE0O3JldHVybiAoCgoKICAgICAgICAgICAgICAgICAgICAgICAgICBxdWVyeUltcGwocmVxdWVzdCwgbG9jYXRpb24sIG1hdGNoZXMsIG1hdGNoKSk7Y2FzZSAxNDpyZXN1bHQgPSBfY29udGV4dDE0LnNlbnQ7aWYgKCEoCgogICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQgaW5zdGFuY2VvZiBSZXNwb25zZSkpIHtfY29udGV4dDE0Lm5leHQgPSAxNzticmVhazt9cmV0dXJuIF9jb250ZXh0MTQuYWJydXB0KCJyZXR1cm4iLAogICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQpO2Nhc2UgMTc6CgoKICAgICAgICAgICAgICAgICAgICAgICAgZXJyb3IgPSByZXN1bHQuZXJyb3JzID8gT2JqZWN0LnZhbHVlcyhyZXN1bHQuZXJyb3JzKVswXSA6IHVuZGVmaW5lZDtpZiAoISgKCiAgICAgICAgICAgICAgICAgICAgICAgIGVycm9yICE9PSB1bmRlZmluZWQpKSB7X2NvbnRleHQxNC5uZXh0ID0gMjA7YnJlYWs7fXRocm93ICgKCgoKCiAgICAgICAgICAgICAgICAgICAgICAgICAgZXJyb3IpO2Nhc2UgMjA6CiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFBpY2sgb2ZmIHRoZSByaWdodCBzdGF0ZSB2YWx1ZSB0byByZXR1cm4KCgogICAgICAgICAgICAgICAgICAgICAgICByb3V0ZURhdGEgPSBbcmVzdWx0LmFjdGlvbkRhdGEsIHJlc3VsdC5sb2FkZXJEYXRhXS5maW5kKCh2KSA9PiB2KTtyZXR1cm4gX2NvbnRleHQxNC5hYnJ1cHQoInJldHVybiIsCiAgICAgICAgICAgICAgICAgICAgICAgIE9iamVjdC52YWx1ZXMocm91dGVEYXRhIHx8IHt9KVswXSk7Y2FzZSAyMjpjYXNlICJlbmQiOnJldHVybiBfY29udGV4dDE0LnN0b3AoKTt9fX0sIF9jYWxsZWUxNCk7fSkpO3JldHVybiBfcXVlcnlSb3V0ZS5hcHBseSh0aGlzLCBhcmd1bWVudHMpO31mdW5jdGlvbgoKCiAgICAgICAgICAgIHF1ZXJ5SW1wbChfeDQ2LCBfeDQ3LCBfeDQ4LCBfeDQ5KSB7cmV0dXJuIF9xdWVyeUltcGwuYXBwbHkodGhpcywgYXJndW1lbnRzKTt9ZnVuY3Rpb24gX3F1ZXJ5SW1wbCgpIHtfcXVlcnlJbXBsID0gX2FzeW5jVG9HZW5lcmF0b3IyKCAvKiNfX1BVUkVfXyovX3JlZ2VuZXJhdG9yUnVudGltZTIoKS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUxNShyZXF1ZXN0LCBsb2NhdGlvbiwgbWF0Y2hlcywgcm91dGVNYXRjaCkge3ZhciBfcmVzdWx0LCByZXN1bHQ7cmV0dXJuIF9yZWdlbmVyYXRvclJ1bnRpbWUyKCkud3JhcChmdW5jdGlvbiBfY2FsbGVlMTUkKF9jb250ZXh0MTUpIHt3aGlsZSAoMSkge3N3aXRjaCAoX2NvbnRleHQxNS5wcmV2ID0gX2NvbnRleHQxNS5uZXh0KSB7Y2FzZSAwOgogICAgICAgICAgICAgICAgICAgICAgICByb3V0ZXJfaW52YXJpYW50KHJlcXVlc3Quc2lnbmFsLCAicXVlcnkoKS9xdWVyeVJvdXRlKCkgcmVxdWVzdHMgbXVzdCBjb250YWluIGFuIEFib3J0Q29udHJvbGxlciBzaWduYWwiKTtfY29udGV4dDE1LnByZXYgPSAxO2lmICghCgoKICAgICAgICAgICAgICAgICAgICAgICAgdmFsaWRBY3Rpb25NZXRob2RzLmhhcyhyZXF1ZXN0Lm1ldGhvZCkpIHtfY29udGV4dDE1Lm5leHQgPSA3O2JyZWFrO31fY29udGV4dDE1Lm5leHQgPSA1O3JldHVybiAoCiAgICAgICAgICAgICAgICAgICAgICAgICAgc3VibWl0KHJlcXVlc3QsIG1hdGNoZXMsIHJvdXRlTWF0Y2ggfHwgZ2V0VGFyZ2V0TWF0Y2gobWF0Y2hlcywgbG9jYXRpb24pLCByb3V0ZU1hdGNoICE9IG51bGwpKTtjYXNlIDU6X3Jlc3VsdCA9IF9jb250ZXh0MTUuc2VudDtyZXR1cm4gX2NvbnRleHQxNS5hYnJ1cHQoInJldHVybiIsCiAgICAgICAgICAgICAgICAgICAgICAgIF9yZXN1bHQpO2Nhc2UgNzpfY29udGV4dDE1Lm5leHQgPSA5O3JldHVybiAoCgoKICAgICAgICAgICAgICAgICAgICAgICAgICBsb2FkUm91dGVEYXRhKHJlcXVlc3QsIG1hdGNoZXMsIHJvdXRlTWF0Y2gpKTtjYXNlIDk6cmVzdWx0ID0gX2NvbnRleHQxNS5zZW50O3JldHVybiBfY29udGV4dDE1LmFicnVwdCgicmV0dXJuIiwKICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0IGluc3RhbmNlb2YgUmVzcG9uc2UgPyByZXN1bHQgOiBfZXh0ZW5kcyh7fSwgcmVzdWx0LCB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgYWN0aW9uRGF0YTogbnVsbCwKICAgICAgICAgICAgICAgICAgICAgICAgICBhY3Rpb25IZWFkZXJzOiB7fQogICAgICAgICAgICAgICAgICAgICAgICB9KSk7Y2FzZSAxMzpfY29udGV4dDE1LnByZXYgPSAxMztfY29udGV4dDE1LnQwID0gX2NvbnRleHQxNVsiY2F0Y2giXSgxKTtpZiAoIQoKCgoKICAgICAgICAgICAgICAgICAgICAgICAgaXNRdWVyeVJvdXRlUmVzcG9uc2UoX2NvbnRleHQxNS50MCkpIHtfY29udGV4dDE1Lm5leHQgPSAxOTticmVhazt9aWYgKCEoCiAgICAgICAgICAgICAgICAgICAgICAgIF9jb250ZXh0MTUudDAudHlwZSA9PT0gUmVzdWx0VHlwZS5lcnJvciAmJiAhaXNSZWRpcmVjdFJlc3BvbnNlKF9jb250ZXh0MTUudDAucmVzcG9uc2UpKSkge19jb250ZXh0MTUubmV4dCA9IDE4O2JyZWFrO310aHJvdyAoCiAgICAgICAgICAgICAgICAgICAgICAgICAgX2NvbnRleHQxNS50MC5yZXNwb25zZSk7Y2FzZSAxODpyZXR1cm4gX2NvbnRleHQxNS5hYnJ1cHQoInJldHVybiIsCgoKICAgICAgICAgICAgICAgICAgICAgICAgX2NvbnRleHQxNS50MC5yZXNwb25zZSk7Y2FzZSAxOTppZiAoIQoKCgoKICAgICAgICAgICAgICAgICAgICAgICAgaXNSZWRpcmVjdFJlc3BvbnNlKF9jb250ZXh0MTUudDApKSB7X2NvbnRleHQxNS5uZXh0ID0gMjE7YnJlYWs7fXJldHVybiBfY29udGV4dDE1LmFicnVwdCgicmV0dXJuIiwgX2NvbnRleHQxNS50MCk7Y2FzZSAyMTp0aHJvdyBfY29udGV4dDE1LnQwO2Nhc2UgMjI6Y2FzZSAiZW5kIjpyZXR1cm4gX2NvbnRleHQxNS5zdG9wKCk7fX19LCBfY2FsbGVlMTUsIG51bGwsIFtbMSwgMTNdXSk7fSkpO3JldHVybiBfcXVlcnlJbXBsLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7fWZ1bmN0aW9uCgoKCgoKCgogICAgICAgICAgICBzdWJtaXQoX3g1MCwgX3g1MSwgX3g1MiwgX3g1Mykge3JldHVybiBfc3VibWl0LmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7fWZ1bmN0aW9uIF9zdWJtaXQoKSB7X3N1Ym1pdCA9IF9hc3luY1RvR2VuZXJhdG9yMiggLyojX19QVVJFX18qL19yZWdlbmVyYXRvclJ1bnRpbWUyKCkubWFyayhmdW5jdGlvbiBfY2FsbGVlMTYocmVxdWVzdCwgbWF0Y2hlcywgYWN0aW9uTWF0Y2gsIGlzUm91dGVSZXF1ZXN0KSB7dmFyIHJlc3VsdCwgbWV0aG9kLCBib3VuZGFyeU1hdGNoLCBfYm91bmRhcnlNYXRjaCwgX2NvbnRleHQxNiwgY29udGV4dDtyZXR1cm4gX3JlZ2VuZXJhdG9yUnVudGltZTIoKS53cmFwKGZ1bmN0aW9uIF9jYWxsZWUxNiQoX2NvbnRleHQxNykge3doaWxlICgxKSB7c3dpdGNoIChfY29udGV4dDE3LnByZXYgPSBfY29udGV4dDE3Lm5leHQpIHtjYXNlIDA6aWYgKAoKCiAgICAgICAgICAgICAgICAgICAgICAgIGFjdGlvbk1hdGNoLnJvdXRlLmFjdGlvbikge19jb250ZXh0MTcubmV4dCA9IDY7YnJlYWs7fWlmICghCiAgICAgICAgICAgICAgICAgICAgICAgIGlzUm91dGVSZXF1ZXN0KSB7X2NvbnRleHQxNy5uZXh0ID0gMzticmVhazt9dGhyb3cgKAogICAgICAgICAgICAgICAgICAgICAgICAgIGNyZWF0ZVJvdXRlckVycm9yUmVzcG9uc2UobnVsbCwgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhdHVzOiA0MDUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGF0dXNUZXh0OiAiTWV0aG9kIE5vdCBBbGxvd2VkIgogICAgICAgICAgICAgICAgICAgICAgICAgIH0pKTtjYXNlIDM6CgoKICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0ID0gZ2V0TWV0aG9kTm90QWxsb3dlZFJlc3VsdChyZXF1ZXN0LnVybCk7X2NvbnRleHQxNy5uZXh0ID0gMTI7YnJlYWs7Y2FzZSA2Ol9jb250ZXh0MTcubmV4dCA9IDg7cmV0dXJuICgKCiAgICAgICAgICAgICAgICAgICAgICAgICAgY2FsbExvYWRlck9yQWN0aW9uKCJhY3Rpb24iLCByZXF1ZXN0LCBhY3Rpb25NYXRjaCwgbWF0Y2hlcywgdW5kZWZpbmVkLCAvLyBCYXNlbmFtZSBub3QgY3VycmVudGx5IHN1cHBvcnRlZCBpbiBzdGF0aWMgaGFuZGxlcnMKICAgICAgICAgICAgICAgICAgICAgICAgICB0cnVlLCBpc1JvdXRlUmVxdWVzdCkpO2Nhc2UgODpyZXN1bHQgPSBfY29udGV4dDE3LnNlbnQ7aWYgKCEKCiAgICAgICAgICAgICAgICAgICAgICAgIHJlcXVlc3Quc2lnbmFsLmFib3J0ZWQpIHtfY29udGV4dDE3Lm5leHQgPSAxMjticmVhazt9CiAgICAgICAgICAgICAgICAgICAgICAgIG1ldGhvZCA9IGlzUm91dGVSZXF1ZXN0ID8gInF1ZXJ5Um91dGUiIDogInF1ZXJ5Ijt0aHJvdyAoCiAgICAgICAgICAgICAgICAgICAgICAgICAgbmV3IEVycm9yKG1ldGhvZCArICIoKSBjYWxsIGFib3J0ZWQiKSk7Y2FzZSAxMjppZiAoIQoKCgogICAgICAgICAgICAgICAgICAgICAgICBpc1JlZGlyZWN0UmVzdWx0KHJlc3VsdCkpIHtfY29udGV4dDE3Lm5leHQgPSAxNDticmVhazt9dGhyb3cgKAoKCgoKICAgICAgICAgICAgICAgICAgICAgICAgICBuZXcgUmVzcG9uc2UobnVsbCwgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhdHVzOiByZXN1bHQuc3RhdHVzLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgaGVhZGVyczogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBMb2NhdGlvbjogcmVzdWx0LmxvY2F0aW9uCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgfSkpO2Nhc2UgMTQ6aWYgKCEKCgogICAgICAgICAgICAgICAgICAgICAgICBpc0RlZmVycmVkUmVzdWx0KHJlc3VsdCkpIHtfY29udGV4dDE3Lm5leHQgPSAxNjticmVhazt9dGhyb3cgKAogICAgICAgICAgICAgICAgICAgICAgICAgIG5ldyBFcnJvcigiZGVmZXIoKSBpcyBub3Qgc3VwcG9ydGVkIGluIGFjdGlvbnMiKSk7Y2FzZSAxNjppZiAoIQoKCiAgICAgICAgICAgICAgICAgICAgICAgIGlzUm91dGVSZXF1ZXN0KSB7X2NvbnRleHQxNy5uZXh0ID0gMjE7YnJlYWs7fWlmICghCgoKICAgICAgICAgICAgICAgICAgICAgICAgaXNFcnJvclJlc3VsdChyZXN1bHQpKSB7X2NvbnRleHQxNy5uZXh0ID0gMjA7YnJlYWs7fQogICAgICAgICAgICAgICAgICAgICAgICBib3VuZGFyeU1hdGNoID0gZmluZE5lYXJlc3RCb3VuZGFyeShtYXRjaGVzLCBhY3Rpb25NYXRjaC5yb3V0ZS5pZCk7cmV0dXJuIF9jb250ZXh0MTcuYWJydXB0KCJyZXR1cm4iLAogICAgICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgbWF0Y2hlczogW2FjdGlvbk1hdGNoXSwKICAgICAgICAgICAgICAgICAgICAgICAgICBsb2FkZXJEYXRhOiB7fSwKICAgICAgICAgICAgICAgICAgICAgICAgICBhY3Rpb25EYXRhOiBudWxsLAogICAgICAgICAgICAgICAgICAgICAgICAgIGVycm9yczogX2RlZmluZVByb3BlcnR5Mih7fSwKICAgICAgICAgICAgICAgICAgICAgICAgICBib3VuZGFyeU1hdGNoLnJvdXRlLmlkLCByZXN1bHQuZXJyb3IpLAoKICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBOb3RlOiBzdGF0dXNDb2RlICsgaGVhZGVycyBhcmUgdW51c2VkIGhlcmUgc2luY2UgcXVlcnlSb3V0ZSB3aWxsCiAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gcmV0dXJuIHRoZSByYXcgUmVzcG9uc2Ugb3IgdmFsdWUKICAgICAgICAgICAgICAgICAgICAgICAgICBzdGF0dXNDb2RlOiA1MDAsCiAgICAgICAgICAgICAgICAgICAgICAgICAgbG9hZGVySGVhZGVyczoge30sCiAgICAgICAgICAgICAgICAgICAgICAgICAgYWN0aW9uSGVhZGVyczoge30KICAgICAgICAgICAgICAgICAgICAgICAgfSk7Y2FzZSAyMDpyZXR1cm4gX2NvbnRleHQxNy5hYnJ1cHQoInJldHVybiIsCgoKICAgICAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICAgIG1hdGNoZXM6IFthY3Rpb25NYXRjaF0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgbG9hZGVyRGF0YToge30sCiAgICAgICAgICAgICAgICAgICAgICAgICAgYWN0aW9uRGF0YTogX2RlZmluZVByb3BlcnR5Mih7fSwKICAgICAgICAgICAgICAgICAgICAgICAgICBhY3Rpb25NYXRjaC5yb3V0ZS5pZCwgcmVzdWx0LmRhdGEpLAoKICAgICAgICAgICAgICAgICAgICAgICAgICBlcnJvcnM6IG51bGwsCiAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gTm90ZTogc3RhdHVzQ29kZSArIGhlYWRlcnMgYXJlIHVudXNlZCBoZXJlIHNpbmNlIHF1ZXJ5Um91dGUgd2lsbAogICAgICAgICAgICAgICAgICAgICAgICAgIC8vIHJldHVybiB0aGUgcmF3IFJlc3BvbnNlIG9yIHZhbHVlCiAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhdHVzQ29kZTogMjAwLAogICAgICAgICAgICAgICAgICAgICAgICAgIGxvYWRlckhlYWRlcnM6IHt9LAogICAgICAgICAgICAgICAgICAgICAgICAgIGFjdGlvbkhlYWRlcnM6IHt9CiAgICAgICAgICAgICAgICAgICAgICAgIH0pO2Nhc2UgMjE6aWYgKCEKCgogICAgICAgICAgICAgICAgICAgICAgICBpc0Vycm9yUmVzdWx0KHJlc3VsdCkpIHtfY29udGV4dDE3Lm5leHQgPSAyNzticmVhazt9CiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFN0b3JlIG9mZiB0aGUgcGVuZGluZyBlcnJvciAtIHdlIHVzZSBpdCB0byBkZXRlcm1pbmUgd2hpY2ggbG9hZGVycwogICAgICAgICAgICAgICAgICAgICAgICAvLyB0byBjYWxsIGFuZCB3aWxsIGNvbW1pdCBpdCB3aGVuIHdlIGNvbXBsZXRlIHRoZSBuYXZpZ2F0aW9uCiAgICAgICAgICAgICAgICAgICAgICAgIF9ib3VuZGFyeU1hdGNoID0gZmluZE5lYXJlc3RCb3VuZGFyeShtYXRjaGVzLCBhY3Rpb25NYXRjaC5yb3V0ZS5pZCk7X2NvbnRleHQxNy5uZXh0ID0gMjU7cmV0dXJuICgKICAgICAgICAgICAgICAgICAgICAgICAgICBsb2FkUm91dGVEYXRhKHJlcXVlc3QsIG1hdGNoZXMsIHVuZGVmaW5lZCwgX2RlZmluZVByb3BlcnR5Mih7fSwKICAgICAgICAgICAgICAgICAgICAgICAgICBfYm91bmRhcnlNYXRjaC5yb3V0ZS5pZCwgcmVzdWx0LmVycm9yKSkpO2Nhc2UgMjU6X2NvbnRleHQxNiA9IF9jb250ZXh0MTcuc2VudDtyZXR1cm4gX2NvbnRleHQxNy5hYnJ1cHQoInJldHVybiIsCgoKICAgICAgICAgICAgICAgICAgICAgICAgX2V4dGVuZHMoe30sIF9jb250ZXh0MTYsIHsKICAgICAgICAgICAgICAgICAgICAgICAgICBzdGF0dXNDb2RlOiBpc1JvdXRlRXJyb3JSZXNwb25zZShyZXN1bHQuZXJyb3IpID8gcmVzdWx0LmVycm9yLnN0YXR1cyA6IDUwMCwKICAgICAgICAgICAgICAgICAgICAgICAgICBhY3Rpb25EYXRhOiBudWxsLAogICAgICAgICAgICAgICAgICAgICAgICAgIGFjdGlvbkhlYWRlcnM6IF9leHRlbmRzKHt9LCByZXN1bHQuaGVhZGVycyA/IF9kZWZpbmVQcm9wZXJ0eTIoe30sCiAgICAgICAgICAgICAgICAgICAgICAgICAgYWN0aW9uTWF0Y2gucm91dGUuaWQsIHJlc3VsdC5oZWFkZXJzKSA6CiAgICAgICAgICAgICAgICAgICAgICAgICAge30pCiAgICAgICAgICAgICAgICAgICAgICAgIH0pKTtjYXNlIDI3Ol9jb250ZXh0MTcubmV4dCA9IDI5O3JldHVybiAoCgoKICAgICAgICAgICAgICAgICAgICAgICAgICBsb2FkUm91dGVEYXRhKHJlcXVlc3QsIG1hdGNoZXMpKTtjYXNlIDI5OmNvbnRleHQgPSBfY29udGV4dDE3LnNlbnQ7cmV0dXJuIF9jb250ZXh0MTcuYWJydXB0KCJyZXR1cm4iLAogICAgICAgICAgICAgICAgICAgICAgICBfZXh0ZW5kcyh7fSwgY29udGV4dCwgcmVzdWx0LnN0YXR1c0NvZGUgPyB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhdHVzQ29kZTogcmVzdWx0LnN0YXR1c0NvZGUKICAgICAgICAgICAgICAgICAgICAgICAgfSA6IHt9LCB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgYWN0aW9uRGF0YTogX2RlZmluZVByb3BlcnR5Mih7fSwKICAgICAgICAgICAgICAgICAgICAgICAgICBhY3Rpb25NYXRjaC5yb3V0ZS5pZCwgcmVzdWx0LmRhdGEpLAoKICAgICAgICAgICAgICAgICAgICAgICAgICBhY3Rpb25IZWFkZXJzOiBfZXh0ZW5kcyh7fSwgcmVzdWx0LmhlYWRlcnMgPyBfZGVmaW5lUHJvcGVydHkyKHt9LAogICAgICAgICAgICAgICAgICAgICAgICAgIGFjdGlvbk1hdGNoLnJvdXRlLmlkLCByZXN1bHQuaGVhZGVycykgOgogICAgICAgICAgICAgICAgICAgICAgICAgIHt9KQogICAgICAgICAgICAgICAgICAgICAgICB9KSk7Y2FzZSAzMTpjYXNlICJlbmQiOnJldHVybiBfY29udGV4dDE3LnN0b3AoKTt9fX0sIF9jYWxsZWUxNik7fSkpO3JldHVybiBfc3VibWl0LmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7fWZ1bmN0aW9uCgoKICAgICAgICAgICAgbG9hZFJvdXRlRGF0YShfeDU0LCBfeDU1LCBfeDU2LCBfeDU3KSB7cmV0dXJuIF9sb2FkUm91dGVEYXRhLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7fWZ1bmN0aW9uIF9sb2FkUm91dGVEYXRhKCkge19sb2FkUm91dGVEYXRhID0gX2FzeW5jVG9HZW5lcmF0b3IyKCAvKiNfX1BVUkVfXyovX3JlZ2VuZXJhdG9yUnVudGltZTIoKS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUxNyhyZXF1ZXN0LCBtYXRjaGVzLCByb3V0ZU1hdGNoLCBwZW5kaW5nQWN0aW9uRXJyb3IpIHt2YXIgaXNSb3V0ZVJlcXVlc3QsIHJlcXVlc3RNYXRjaGVzLCBtYXRjaGVzVG9Mb2FkLCByZXN1bHRzLCBtZXRob2QsIGNvbnRleHQ7cmV0dXJuIF9yZWdlbmVyYXRvclJ1bnRpbWUyKCkud3JhcChmdW5jdGlvbiBfY2FsbGVlMTckKF9jb250ZXh0MTgpIHt3aGlsZSAoMSkge3N3aXRjaCAoX2NvbnRleHQxOC5wcmV2ID0gX2NvbnRleHQxOC5uZXh0KSB7Y2FzZSAwOgogICAgICAgICAgICAgICAgICAgICAgICBpc1JvdXRlUmVxdWVzdCA9IHJvdXRlTWF0Y2ggIT0gbnVsbDsKICAgICAgICAgICAgICAgICAgICAgICAgcmVxdWVzdE1hdGNoZXMgPSByb3V0ZU1hdGNoID8gW3JvdXRlTWF0Y2hdIDogZ2V0TG9hZGVyTWF0Y2hlc1VudGlsQm91bmRhcnkobWF0Y2hlcywgT2JqZWN0LmtleXMocGVuZGluZ0FjdGlvbkVycm9yIHx8IHt9KVswXSk7CiAgICAgICAgICAgICAgICAgICAgICAgIG1hdGNoZXNUb0xvYWQgPSByZXF1ZXN0TWF0Y2hlcy5maWx0ZXIoKG0pID0+IG0ucm91dGUubG9hZGVyKTsgLy8gU2hvcnQgY2lyY3VpdCBpZiB3ZSBoYXZlIG5vIGxvYWRlcnMgdG8gcnVuCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghKAogICAgICAgICAgICAgICAgICAgICAgICBtYXRjaGVzVG9Mb2FkLmxlbmd0aCA9PT0gMCkpIHtfY29udGV4dDE4Lm5leHQgPSA1O2JyZWFrO31yZXR1cm4gX2NvbnRleHQxOC5hYnJ1cHQoInJldHVybiIsCiAgICAgICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgICBtYXRjaGVzOiBtYXRjaGVzLAogICAgICAgICAgICAgICAgICAgICAgICAgIGxvYWRlckRhdGE6IHt9LAogICAgICAgICAgICAgICAgICAgICAgICAgIGVycm9yczogcGVuZGluZ0FjdGlvbkVycm9yIHx8IG51bGwsCiAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhdHVzQ29kZTogMjAwLAogICAgICAgICAgICAgICAgICAgICAgICAgIGxvYWRlckhlYWRlcnM6IHt9CiAgICAgICAgICAgICAgICAgICAgICAgIH0pO2Nhc2UgNTpfY29udGV4dDE4Lm5leHQgPSA3O3JldHVybiAoCgoKICAgICAgICAgICAgICAgICAgICAgICAgICBQcm9taXNlLmFsbChfdG9Db25zdW1hYmxlQXJyYXkyKG1hdGNoZXNUb0xvYWQubWFwKChtYXRjaCkgPT4gY2FsbExvYWRlck9yQWN0aW9uKCJsb2FkZXIiLCByZXF1ZXN0LCBtYXRjaCwgbWF0Y2hlcywgdW5kZWZpbmVkLCAvLyBCYXNlbmFtZSBub3QgY3VycmVudGx5IHN1cHBvcnRlZCBpbiBzdGF0aWMgaGFuZGxlcnMKICAgICAgICAgICAgICAgICAgICAgICAgICB0cnVlLCBpc1JvdXRlUmVxdWVzdCkpKSkpO2Nhc2UgNzpyZXN1bHRzID0gX2NvbnRleHQxOC5zZW50O2lmICghCgogICAgICAgICAgICAgICAgICAgICAgICByZXF1ZXN0LnNpZ25hbC5hYm9ydGVkKSB7X2NvbnRleHQxOC5uZXh0ID0gMTE7YnJlYWs7fQogICAgICAgICAgICAgICAgICAgICAgICBtZXRob2QgPSBpc1JvdXRlUmVxdWVzdCA/ICJxdWVyeVJvdXRlIiA6ICJxdWVyeSI7dGhyb3cgKAogICAgICAgICAgICAgICAgICAgICAgICAgIG5ldyBFcnJvcihtZXRob2QgKyAiKCkgY2FsbCBhYm9ydGVkIikpO2Nhc2UgMTE6CiAgICAgICAgICAgICAgICAgICAgICAgIC8vIENhbid0IGRvIGFueXRoaW5nIHdpdGggdGhlc2Ugd2l0aG91dCB0aGUgUmVtaXggc2lkZSBvZiB0aGluZ3MsIHNvIGp1c3QKICAgICAgICAgICAgICAgICAgICAgICAgLy8gY2FuY2VsIHRoZW0gZm9yIG5vdwoKCiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdHMuZm9yRWFjaCgocmVzdWx0KSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGlzRGVmZXJyZWRSZXN1bHQocmVzdWx0KSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0LmRlZmVycmVkRGF0YS5jYW5jZWwoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0pOyAvLyBQcm9jZXNzIGFuZCBjb21taXQgb3V0cHV0IGZyb20gbG9hZGVycwoKICAgICAgICAgICAgICAgICAgICAgICAgY29udGV4dCA9IHByb2Nlc3NSb3V0ZUxvYWRlckRhdGEobWF0Y2hlcywgbWF0Y2hlc1RvTG9hZCwgcmVzdWx0cywgcGVuZGluZ0FjdGlvbkVycm9yKTtyZXR1cm4gX2NvbnRleHQxOC5hYnJ1cHQoInJldHVybiIsCiAgICAgICAgICAgICAgICAgICAgICAgIF9leHRlbmRzKHt9LCBjb250ZXh0LCB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgbWF0Y2hlczogbWF0Y2hlcwogICAgICAgICAgICAgICAgICAgICAgICB9KSk7Y2FzZSAxNDpjYXNlICJlbmQiOnJldHVybiBfY29udGV4dDE4LnN0b3AoKTt9fX0sIF9jYWxsZWUxNyk7fSkpO3JldHVybiBfbG9hZFJvdXRlRGF0YS5hcHBseSh0aGlzLCBhcmd1bWVudHMpO30KCgogICAgICAgICAgICBmdW5jdGlvbiBjcmVhdGVSb3V0ZXJFcnJvclJlc3BvbnNlKGJvZHksIGluaXQpIHsKICAgICAgICAgICAgICByZXR1cm4gbmV3IFJlc3BvbnNlKGJvZHksIF9leHRlbmRzKHt9LCBpbml0LCB7CiAgICAgICAgICAgICAgICBoZWFkZXJzOiBfZXh0ZW5kcyh7fSwgaW5pdC5oZWFkZXJzLCB7CiAgICAgICAgICAgICAgICAgICJYLVJlbWl4LVJvdXRlci1FcnJvciI6ICJ5ZXMiCiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgIH0pKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICBkYXRhUm91dGVzOiBkYXRhUm91dGVzLAogICAgICAgICAgICAgIHF1ZXJ5OiBxdWVyeSwKICAgICAgICAgICAgICBxdWVyeVJvdXRlOiBxdWVyeVJvdXRlCiAgICAgICAgICAgIH07CiAgICAgICAgICB9IC8vI2VuZHJlZ2lvbgogICAgICAgICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KICAgICAgICAgIC8vI3JlZ2lvbiBIZWxwZXJzCiAgICAgICAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwoKICAgICAgICAgIC8qKgogICAgICAgICAgICogR2l2ZW4gYW4gZXhpc3RpbmcgU3RhdGljSGFuZGxlckNvbnRleHQgYW5kIGFuIGVycm9yIHRocm93biBhdCByZW5kZXIgdGltZSwKICAgICAgICAgICAqIHByb3ZpZGUgYW4gdXBkYXRlZCBTdGF0aWNIYW5kbGVyQ29udGV4dCBzdWl0YWJsZSBmb3IgYSBzZWNvbmQgU1NSIHJlbmRlcgogICAgICAgICAgICovCgogICAgICAgICAgZnVuY3Rpb24gZ2V0U3RhdGljQ29udGV4dEZyb21FcnJvcihyb3V0ZXMsIGNvbnRleHQsIGVycm9yKSB7CiAgICAgICAgICAgIHZhciBuZXdDb250ZXh0ID0gX2V4dGVuZHMoe30sIGNvbnRleHQsIHsKICAgICAgICAgICAgICBzdGF0dXNDb2RlOiA1MDAsCiAgICAgICAgICAgICAgZXJyb3JzOiBfZGVmaW5lUHJvcGVydHkyKHt9LAogICAgICAgICAgICAgIGNvbnRleHQuX2RlZXBlc3RSZW5kZXJlZEJvdW5kYXJ5SWQgfHwgcm91dGVzWzBdLmlkLCBlcnJvcikKCiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgcmV0dXJuIG5ld0NvbnRleHQ7CiAgICAgICAgICB9IC8vIE5vcm1hbGl6ZSBuYXZpZ2F0aW9uIG9wdGlvbnMgYnkgY29udmVydGluZyBmb3JtTWV0aG9kPUdFVCBmb3JtRGF0YSBvYmplY3RzIHRvCiAgICAgICAgICAvLyBVUkxTZWFyY2hQYXJhbXMgc28gdGhleSBiZWhhdmUgaWRlbnRpY2FsbHkgdG8gbGlua3Mgd2l0aCBxdWVyeSBwYXJhbXMKCiAgICAgICAgICBmdW5jdGlvbiBub3JtYWxpemVOYXZpZ2F0ZU9wdGlvbnModG8sIG9wdHMsIGlzRmV0Y2hlcikgewogICAgICAgICAgICBpZiAoaXNGZXRjaGVyID09PSB2b2lkIDApIHsKICAgICAgICAgICAgICBpc0ZldGNoZXIgPSBmYWxzZTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdmFyIHBhdGggPSB0eXBlb2YgdG8gPT09ICJzdHJpbmciID8gdG8gOiByb3V0ZXJfY3JlYXRlUGF0aCh0byk7IC8vIFJldHVybiBsb2NhdGlvbiB2ZXJiYXRpbSBvbiBub24tc3VibWlzc2lvbiBuYXZpZ2F0aW9ucwoKICAgICAgICAgICAgaWYgKCFvcHRzIHx8ICEoImZvcm1NZXRob2QiIGluIG9wdHMpICYmICEoImZvcm1EYXRhIiBpbiBvcHRzKSkgewogICAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICBwYXRoOiBwYXRoCiAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgfSAvLyBDcmVhdGUgYSBTdWJtaXNzaW9uIG9uIG5vbi1HRVQgbmF2aWdhdGlvbnMKCgogICAgICAgICAgICBpZiAob3B0cy5mb3JtTWV0aG9kICE9IG51bGwgJiYgb3B0cy5mb3JtTWV0aG9kICE9PSAiZ2V0IikgewogICAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICBwYXRoOiBwYXRoLAogICAgICAgICAgICAgICAgc3VibWlzc2lvbjogewogICAgICAgICAgICAgICAgICBmb3JtTWV0aG9kOiBvcHRzLmZvcm1NZXRob2QsCiAgICAgICAgICAgICAgICAgIGZvcm1BY3Rpb246IHN0cmlwSGFzaEZyb21QYXRoKHBhdGgpLAogICAgICAgICAgICAgICAgICBmb3JtRW5jVHlwZTogb3B0cyAmJiBvcHRzLmZvcm1FbmNUeXBlIHx8ICJhcHBsaWNhdGlvbi94LXd3dy1mb3JtLXVybGVuY29kZWQiLAogICAgICAgICAgICAgICAgICBmb3JtRGF0YTogb3B0cy5mb3JtRGF0YQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH07CiAgICAgICAgICAgIH0gLy8gTm8gZm9ybURhdGEgdG8gZmxhdHRlbiBmb3IgR0VUIHN1Ym1pc3Npb24KCgogICAgICAgICAgICBpZiAoIW9wdHMuZm9ybURhdGEpIHsKICAgICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgcGF0aDogcGF0aAogICAgICAgICAgICAgIH07CiAgICAgICAgICAgIH0gLy8gRmxhdHRlbiBzdWJtaXNzaW9uIG9udG8gVVJMU2VhcmNoUGFyYW1zIGZvciBHRVQgc3VibWlzc2lvbnMKCgogICAgICAgICAgICB2YXIgcGFyc2VkUGF0aCA9IHBhcnNlUGF0aChwYXRoKTsKCiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgdmFyIHNlYXJjaFBhcmFtcyA9IGNvbnZlcnRGb3JtRGF0YVRvU2VhcmNoUGFyYW1zKG9wdHMuZm9ybURhdGEpOyAvLyBTaW5jZSBmZXRjaGVyIEdFVCBzdWJtaXNzaW9ucyBvbmx5IHJ1biBhIHNpbmdsZSBsb2FkZXIgKGFzIG9wcG9zZWQgdG8KICAgICAgICAgICAgICAvLyBuYXZpZ2F0aW9uIEdFVCBzdWJtaXNzaW9ucyB3aGljaCBydW4gYWxsIGxvYWRlcnMpLCB3ZSBuZWVkIHRvIHByZXNlcnZlCiAgICAgICAgICAgICAgLy8gYW55IGluY29taW5nID9pbmRleCBwYXJhbXMKCiAgICAgICAgICAgICAgaWYgKGlzRmV0Y2hlciAmJiBwYXJzZWRQYXRoLnNlYXJjaCAmJiBoYXNOYWtlZEluZGV4UXVlcnkocGFyc2VkUGF0aC5zZWFyY2gpKSB7CiAgICAgICAgICAgICAgICBzZWFyY2hQYXJhbXMuYXBwZW5kKCJpbmRleCIsICIiKTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIHBhcnNlZFBhdGguc2VhcmNoID0gIj8iICsgc2VhcmNoUGFyYW1zOwogICAgICAgICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgIHBhdGg6IHBhdGgsCiAgICAgICAgICAgICAgICBlcnJvcjogbmV3IEVycm9yUmVzcG9uc2UoNDAwLCAiQmFkIFJlcXVlc3QiLCAiQ2Fubm90IHN1Ym1pdCBiaW5hcnkgZm9ybSBkYXRhIHVzaW5nIEdFVCIpCiAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICBwYXRoOiByb3V0ZXJfY3JlYXRlUGF0aChwYXJzZWRQYXRoKQogICAgICAgICAgICB9OwogICAgICAgICAgfQoKICAgICAgICAgIGZ1bmN0aW9uIGdldExvYWRlclJlZGlyZWN0KHN0YXRlLCByZWRpcmVjdCkgewogICAgICAgICAgICB2YXIgX3N0YXRlJG5hdmlnYXRpb24gPQoKCgoKICAgICAgICAgICAgICBzdGF0ZS5uYXZpZ2F0aW9uLGZvcm1NZXRob2QgPSBfc3RhdGUkbmF2aWdhdGlvbi5mb3JtTWV0aG9kLGZvcm1BY3Rpb24gPSBfc3RhdGUkbmF2aWdhdGlvbi5mb3JtQWN0aW9uLGZvcm1FbmNUeXBlID0gX3N0YXRlJG5hdmlnYXRpb24uZm9ybUVuY1R5cGUsZm9ybURhdGEgPSBfc3RhdGUkbmF2aWdhdGlvbi5mb3JtRGF0YTsKICAgICAgICAgICAgdmFyIG5hdmlnYXRpb24gPSB7CiAgICAgICAgICAgICAgc3RhdGU6ICJsb2FkaW5nIiwKICAgICAgICAgICAgICBsb2NhdGlvbjogY3JlYXRlTG9jYXRpb24oc3RhdGUubG9jYXRpb24sIHJlZGlyZWN0LmxvY2F0aW9uKSwKICAgICAgICAgICAgICBmb3JtTWV0aG9kOiBmb3JtTWV0aG9kIHx8IHVuZGVmaW5lZCwKICAgICAgICAgICAgICBmb3JtQWN0aW9uOiBmb3JtQWN0aW9uIHx8IHVuZGVmaW5lZCwKICAgICAgICAgICAgICBmb3JtRW5jVHlwZTogZm9ybUVuY1R5cGUgfHwgdW5kZWZpbmVkLAogICAgICAgICAgICAgIGZvcm1EYXRhOiBmb3JtRGF0YSB8fCB1bmRlZmluZWQKICAgICAgICAgICAgfTsKICAgICAgICAgICAgcmV0dXJuIG5hdmlnYXRpb247CiAgICAgICAgICB9IC8vIEZpbHRlciBvdXQgYWxsIHJvdXRlcyBiZWxvdyBhbnkgY2F1Z2h0IGVycm9yIGFzIHRoZXkgYXJlbid0IGdvaW5nIHRvCiAgICAgICAgICAvLyByZW5kZXIgc28gd2UgZG9uJ3QgbmVlZCB0byBsb2FkIHRoZW0KCgogICAgICAgICAgZnVuY3Rpb24gZ2V0TG9hZGVyTWF0Y2hlc1VudGlsQm91bmRhcnkobWF0Y2hlcywgYm91bmRhcnlJZCkgewogICAgICAgICAgICB2YXIgYm91bmRhcnlNYXRjaGVzID0gbWF0Y2hlczsKCiAgICAgICAgICAgIGlmIChib3VuZGFyeUlkKSB7CiAgICAgICAgICAgICAgdmFyIGluZGV4ID0gbWF0Y2hlcy5maW5kSW5kZXgoKG0pID0+IG0ucm91dGUuaWQgPT09IGJvdW5kYXJ5SWQpOwoKICAgICAgICAgICAgICBpZiAoaW5kZXggPj0gMCkgewogICAgICAgICAgICAgICAgYm91bmRhcnlNYXRjaGVzID0gbWF0Y2hlcy5zbGljZSgwLCBpbmRleCk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICByZXR1cm4gYm91bmRhcnlNYXRjaGVzOwogICAgICAgICAgfQoKICAgICAgICAgIGZ1bmN0aW9uIGdldE1hdGNoZXNUb0xvYWQoc3RhdGUsIG1hdGNoZXMsIHN1Ym1pc3Npb24sIGxvY2F0aW9uLCBpc1JldmFsaWRhdGlvblJlcXVpcmVkLCBjYW5jZWxsZWREZWZlcnJlZFJvdXRlcywgY2FuY2VsbGVkRmV0Y2hlckxvYWRzLCBwZW5kaW5nQWN0aW9uRGF0YSwgcGVuZGluZ0Vycm9yLCBmZXRjaExvYWRNYXRjaGVzKSB7CiAgICAgICAgICAgIHZhciBhY3Rpb25SZXN1bHQgPSBwZW5kaW5nRXJyb3IgPyBPYmplY3QudmFsdWVzKHBlbmRpbmdFcnJvcilbMF0gOiBwZW5kaW5nQWN0aW9uRGF0YSA/IE9iamVjdC52YWx1ZXMocGVuZGluZ0FjdGlvbkRhdGEpWzBdIDogbnVsbDsgLy8gUGljayBuYXZpZ2F0aW9uIG1hdGNoZXMgdGhhdCBhcmUgbmV0LW5ldyBvciBxdWFsaWZ5IGZvciByZXZhbGlkYXRpb24KCiAgICAgICAgICAgIHZhciBib3VuZGFyeUlkID0gcGVuZGluZ0Vycm9yID8gT2JqZWN0LmtleXMocGVuZGluZ0Vycm9yKVswXSA6IHVuZGVmaW5lZDsKICAgICAgICAgICAgdmFyIGJvdW5kYXJ5TWF0Y2hlcyA9IGdldExvYWRlck1hdGNoZXNVbnRpbEJvdW5kYXJ5KG1hdGNoZXMsIGJvdW5kYXJ5SWQpOwogICAgICAgICAgICB2YXIgbmF2aWdhdGlvbk1hdGNoZXMgPSBib3VuZGFyeU1hdGNoZXMuZmlsdGVyKChtYXRjaCwgaW5kZXgpID0+IG1hdGNoLnJvdXRlLmxvYWRlciAhPSBudWxsICYmIChpc05ld0xvYWRlcihzdGF0ZS5sb2FkZXJEYXRhLCBzdGF0ZS5tYXRjaGVzW2luZGV4XSwgbWF0Y2gpIHx8IC8vIElmIHRoaXMgcm91dGUgaGFkIGEgcGVuZGluZyBkZWZlcnJlZCBjYW5jZWxsZWQgaXQgbXVzdCBiZSByZXZhbGlkYXRlZAogICAgICAgICAgICBjYW5jZWxsZWREZWZlcnJlZFJvdXRlcy5zb21lKChpZCkgPT4gaWQgPT09IG1hdGNoLnJvdXRlLmlkKSB8fCBzaG91bGRSZXZhbGlkYXRlTG9hZGVyKHN0YXRlLmxvY2F0aW9uLCBzdGF0ZS5tYXRjaGVzW2luZGV4XSwgc3VibWlzc2lvbiwgbG9jYXRpb24sIG1hdGNoLCBpc1JldmFsaWRhdGlvblJlcXVpcmVkLCBhY3Rpb25SZXN1bHQpKSk7IC8vIFBpY2sgZmV0Y2hlci5sb2FkcyB0aGF0IG5lZWQgdG8gYmUgcmV2YWxpZGF0ZWQKCiAgICAgICAgICAgIHZhciByZXZhbGlkYXRpbmdGZXRjaGVycyA9IFtdOwogICAgICAgICAgICBmZXRjaExvYWRNYXRjaGVzICYmIGZldGNoTG9hZE1hdGNoZXMuZm9yRWFjaCgoX3JlZjEwLCBrZXkpID0+IHsKICAgICAgICAgICAgICB2YXIgX3JlZjI0ID0gX3NsaWNlZFRvQXJyYXkyKF9yZWYxMCwgMyksaHJlZiA9IF9yZWYyNFswXSxtYXRjaCA9IF9yZWYyNFsxXSxmZXRjaE1hdGNoZXMgPSBfcmVmMjRbMl07CgogICAgICAgICAgICAgIC8vIFRoaXMgZmV0Y2hlciB3YXMgY2FuY2VsbGVkIGZyb20gYSBwcmlvciBhY3Rpb24gc3VibWlzc2lvbiAtIGZvcmNlIHJlbG9hZAogICAgICAgICAgICAgIGlmIChjYW5jZWxsZWRGZXRjaGVyTG9hZHMuaW5jbHVkZXMoa2V5KSkgewogICAgICAgICAgICAgICAgcmV2YWxpZGF0aW5nRmV0Y2hlcnMucHVzaChba2V5LCBocmVmLCBtYXRjaCwgZmV0Y2hNYXRjaGVzXSk7CiAgICAgICAgICAgICAgfSBlbHNlIGlmIChpc1JldmFsaWRhdGlvblJlcXVpcmVkKSB7CiAgICAgICAgICAgICAgICB2YXIgc2hvdWxkUmV2YWxpZGF0ZSA9IHNob3VsZFJldmFsaWRhdGVMb2FkZXIoaHJlZiwgbWF0Y2gsIHN1Ym1pc3Npb24sIGhyZWYsIG1hdGNoLCBpc1JldmFsaWRhdGlvblJlcXVpcmVkLCBhY3Rpb25SZXN1bHQpOwoKICAgICAgICAgICAgICAgIGlmIChzaG91bGRSZXZhbGlkYXRlKSB7CiAgICAgICAgICAgICAgICAgIHJldmFsaWRhdGluZ0ZldGNoZXJzLnB1c2goW2tleSwgaHJlZiwgbWF0Y2gsIGZldGNoTWF0Y2hlc10pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIHJldHVybiBbbmF2aWdhdGlvbk1hdGNoZXMsIHJldmFsaWRhdGluZ0ZldGNoZXJzXTsKICAgICAgICAgIH0KCiAgICAgICAgICBmdW5jdGlvbiBpc05ld0xvYWRlcihjdXJyZW50TG9hZGVyRGF0YSwgY3VycmVudE1hdGNoLCBtYXRjaCkgewogICAgICAgICAgICB2YXIgaXNOZXcgPSAvLyBbYV0gLT4gW2EsIGJdCiAgICAgICAgICAgICFjdXJyZW50TWF0Y2ggfHwgLy8gW2EsIGJdIC0+IFthLCBjXQogICAgICAgICAgICBtYXRjaC5yb3V0ZS5pZCAhPT0gY3VycmVudE1hdGNoLnJvdXRlLmlkOyAvLyBIYW5kbGUgdGhlIGNhc2UgdGhhdCB3ZSBkb24ndCBoYXZlIGRhdGEgZm9yIGEgcmUtdXNlZCByb3V0ZSwgcG90ZW50aWFsbHkKICAgICAgICAgICAgLy8gZnJvbSBhIHByaW9yIGVycm9yIG9yIGZyb20gYSBjYW5jZWxsZWQgcGVuZGluZyBkZWZlcnJlZAoKICAgICAgICAgICAgdmFyIGlzTWlzc2luZ0RhdGEgPSBjdXJyZW50TG9hZGVyRGF0YVttYXRjaC5yb3V0ZS5pZF0gPT09IHVuZGVmaW5lZDsgLy8gQWx3YXlzIGxvYWQgaWYgdGhpcyBpcyBhIG5ldC1uZXcgcm91dGUgb3Igd2UgZG9uJ3QgeWV0IGhhdmUgZGF0YQoKICAgICAgICAgICAgcmV0dXJuIGlzTmV3IHx8IGlzTWlzc2luZ0RhdGE7CiAgICAgICAgICB9CgogICAgICAgICAgZnVuY3Rpb24gaXNOZXdSb3V0ZUluc3RhbmNlKGN1cnJlbnRNYXRjaCwgbWF0Y2gpIHsKICAgICAgICAgICAgdmFyIGN1cnJlbnRQYXRoID0gY3VycmVudE1hdGNoLnJvdXRlLnBhdGg7CiAgICAgICAgICAgIHJldHVybiAoLy8gcGFyYW0gY2hhbmdlIGZvciB0aGlzIG1hdGNoLCAvdXNlcnMvMTIzIC0+IC91c2Vycy80NTYKICAgICAgICAgICAgICBjdXJyZW50TWF0Y2gucGF0aG5hbWUgIT09IG1hdGNoLnBhdGhuYW1lIHx8IC8vIHNwbGF0IHBhcmFtIGNoYW5nZWQsIHdoaWNoIGlzIG5vdCBwcmVzZW50IGluIG1hdGNoLnBhdGgKICAgICAgICAgICAgICAvLyBlLmcuIC9maWxlcy9pbWFnZXMvYXZhdGFyLmpwZyAtPiBmaWxlcy9maW5hbmNlcy54bHMKICAgICAgICAgICAgICBjdXJyZW50UGF0aCAmJiBjdXJyZW50UGF0aC5lbmRzV2l0aCgiKiIpICYmIGN1cnJlbnRNYXRjaC5wYXJhbXNbIioiXSAhPT0gbWF0Y2gucGFyYW1zWyIqIl0pOwoKICAgICAgICAgIH0KCiAgICAgICAgICBmdW5jdGlvbiBzaG91bGRSZXZhbGlkYXRlTG9hZGVyKGN1cnJlbnRMb2NhdGlvbiwgY3VycmVudE1hdGNoLCBzdWJtaXNzaW9uLCBsb2NhdGlvbiwgbWF0Y2gsIGlzUmV2YWxpZGF0aW9uUmVxdWlyZWQsIGFjdGlvblJlc3VsdCkgewogICAgICAgICAgICB2YXIgY3VycmVudFVybCA9IGNyZWF0ZVVSTChjdXJyZW50TG9jYXRpb24pOwogICAgICAgICAgICB2YXIgY3VycmVudFBhcmFtcyA9IGN1cnJlbnRNYXRjaC5wYXJhbXM7CiAgICAgICAgICAgIHZhciBuZXh0VXJsID0gY3JlYXRlVVJMKGxvY2F0aW9uKTsKICAgICAgICAgICAgdmFyIG5leHRQYXJhbXMgPSBtYXRjaC5wYXJhbXM7IC8vIFRoaXMgaXMgdGhlIGRlZmF1bHQgaW1wbGVtZW50YXRpb24gYXMgdG8gd2hlbiB3ZSByZXZhbGlkYXRlLiAgSWYgdGhlIHJvdXRlCiAgICAgICAgICAgIC8vIHByb3ZpZGVzIGl0J3Mgb3duIGltcGxlbWVudGF0aW9uLCB0aGVuIHdlIGdpdmUgdGhlbSBmdWxsIGNvbnRyb2wgYnV0CiAgICAgICAgICAgIC8vIHByb3ZpZGUgdGhpcyB2YWx1ZSBzbyB0aGV5IGNhbiBsZXZlcmFnZSBpdCBpZiBuZWVkZWQgYWZ0ZXIgdGhleSBjaGVjawogICAgICAgICAgICAvLyB0aGVpciBvd24gc3BlY2lmaWMgdXNlIGNhc2VzCiAgICAgICAgICAgIC8vIE5vdGUgdGhhdCBmZXRjaGVycyBhbHdheXMgcHJvdmlkZSB0aGUgc2FtZSBjdXJyZW50L25leHQgbG9jYXRpb25zIHNvIHRoZQogICAgICAgICAgICAvLyBVUkwtYmFzZWQgY2hlY2tzIGhlcmUgZG9uJ3QgYXBwbHkgdG8gZmV0Y2hlciBzaG91bGRSZXZhbGlkYXRlIGNhbGxzCgogICAgICAgICAgICB2YXIgZGVmYXVsdFNob3VsZFJldmFsaWRhdGUgPSBpc05ld1JvdXRlSW5zdGFuY2UoY3VycmVudE1hdGNoLCBtYXRjaCkgfHwgLy8gQ2xpY2tlZCB0aGUgc2FtZSBsaW5rLCByZXN1Ym1pdHRlZCBhIEdFVCBmb3JtCiAgICAgICAgICAgIGN1cnJlbnRVcmwudG9TdHJpbmcoKSA9PT0gbmV4dFVybC50b1N0cmluZygpIHx8IC8vIFNlYXJjaCBwYXJhbXMgYWZmZWN0IGFsbCBsb2FkZXJzCiAgICAgICAgICAgIGN1cnJlbnRVcmwuc2VhcmNoICE9PSBuZXh0VXJsLnNlYXJjaCB8fCAvLyBGb3JjZWQgcmV2YWxpZGF0aW9uIGR1ZSB0byBzdWJtaXNzaW9uLCB1c2VSZXZhbGlkYXRlLCBvciBYLVJlbWl4LVJldmFsaWRhdGUKICAgICAgICAgICAgaXNSZXZhbGlkYXRpb25SZXF1aXJlZDsKCiAgICAgICAgICAgIGlmIChtYXRjaC5yb3V0ZS5zaG91bGRSZXZhbGlkYXRlKSB7CiAgICAgICAgICAgICAgdmFyIHJvdXRlQ2hvaWNlID0gbWF0Y2gucm91dGUuc2hvdWxkUmV2YWxpZGF0ZShfZXh0ZW5kcyh7CiAgICAgICAgICAgICAgICBjdXJyZW50VXJsOiBjdXJyZW50VXJsLAogICAgICAgICAgICAgICAgY3VycmVudFBhcmFtczogY3VycmVudFBhcmFtcywKICAgICAgICAgICAgICAgIG5leHRVcmw6IG5leHRVcmwsCiAgICAgICAgICAgICAgICBuZXh0UGFyYW1zOiBuZXh0UGFyYW1zCiAgICAgICAgICAgICAgfSwgc3VibWlzc2lvbiwgewogICAgICAgICAgICAgICAgYWN0aW9uUmVzdWx0OiBhY3Rpb25SZXN1bHQsCiAgICAgICAgICAgICAgICBkZWZhdWx0U2hvdWxkUmV2YWxpZGF0ZTogZGVmYXVsdFNob3VsZFJldmFsaWRhdGUKICAgICAgICAgICAgICB9KSk7CgogICAgICAgICAgICAgIGlmICh0eXBlb2Ygcm91dGVDaG9pY2UgPT09ICJib29sZWFuIikgewogICAgICAgICAgICAgICAgcmV0dXJuIHJvdXRlQ2hvaWNlOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuIGRlZmF1bHRTaG91bGRSZXZhbGlkYXRlOwogICAgICAgICAgfWZ1bmN0aW9uCgogICAgICAgICAgY2FsbExvYWRlck9yQWN0aW9uKF94NTgsIF94NTksIF94NjAsIF94NjEsIF94NjIsIF94NjMsIF94NjQpIHtyZXR1cm4gX2NhbGxMb2FkZXJPckFjdGlvbi5hcHBseSh0aGlzLCBhcmd1bWVudHMpO31mdW5jdGlvbiBfY2FsbExvYWRlck9yQWN0aW9uKCkge19jYWxsTG9hZGVyT3JBY3Rpb24gPSBfYXN5bmNUb0dlbmVyYXRvcjIoIC8qI19fUFVSRV9fKi9fcmVnZW5lcmF0b3JSdW50aW1lMigpLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTE4KHR5cGUsIHJlcXVlc3QsIG1hdGNoLCBtYXRjaGVzLCBiYXNlbmFtZSwgaXNTdGF0aWNSZXF1ZXN0LCBpc1JvdXRlUmVxdWVzdCkge3ZhciByZXN1bHRUeXBlLCByZXN1bHQsIHJlamVjdCwgYWJvcnRQcm9taXNlLCBvblJlamVjdCwgaGFuZGxlciwgc3RhdHVzLCBsb2NhdGlvbiwgYWN0aXZlTWF0Y2hlcywgcm91dGVQYXRobmFtZXMsIHJlcXVlc3RQYXRoLCByZXNvbHZlZExvY2F0aW9uLCBwYXRoLCBkYXRhLCBjb250ZW50VHlwZTtyZXR1cm4gX3JlZ2VuZXJhdG9yUnVudGltZTIoKS53cmFwKGZ1bmN0aW9uIF9jYWxsZWUxOCQoX2NvbnRleHQxOSkge3doaWxlICgxKSB7c3dpdGNoIChfY29udGV4dDE5LnByZXYgPSBfY29udGV4dDE5Lm5leHQpIHtjYXNlIDA6CiAgICAgICAgICAgICAgICAgICAgICBpZiAoaXNTdGF0aWNSZXF1ZXN0ID09PSB2b2lkIDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgaXNTdGF0aWNSZXF1ZXN0ID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgICAgaWYgKGlzUm91dGVSZXF1ZXN0ID09PSB2b2lkIDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgaXNSb3V0ZVJlcXVlc3QgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgICAgIH0KCgoKCgogICAgICAgICAgICAgICAgICAgICAgYWJvcnRQcm9taXNlID0gbmV3IFByb21pc2UoKF8sIHIpID0+IHJlamVjdCA9IHIpOwoKICAgICAgICAgICAgICAgICAgICAgIG9uUmVqZWN0ID0gKCkgPT4gcmVqZWN0KCk7CgogICAgICAgICAgICAgICAgICAgICAgcmVxdWVzdC5zaWduYWwuYWRkRXZlbnRMaXN0ZW5lcigiYWJvcnQiLCBvblJlamVjdCk7X2NvbnRleHQxOS5wcmV2ID0gNTsKCgogICAgICAgICAgICAgICAgICAgICAgaGFuZGxlciA9IG1hdGNoLnJvdXRlW3R5cGVdOwogICAgICAgICAgICAgICAgICAgICAgcm91dGVyX2ludmFyaWFudChoYW5kbGVyLCAiQ291bGQgbm90IGZpbmQgdGhlICIgKyB0eXBlICsgIiB0byBydW4gb24gdGhlIFwiIiArIG1hdGNoLnJvdXRlLmlkICsgIlwiIHJvdXRlIik7X2NvbnRleHQxOS5uZXh0ID0gMTA7cmV0dXJuICgKICAgICAgICAgICAgICAgICAgICAgICAgUHJvbWlzZS5yYWNlKFtoYW5kbGVyKHsKICAgICAgICAgICAgICAgICAgICAgICAgICByZXF1ZXN0OiByZXF1ZXN0LAogICAgICAgICAgICAgICAgICAgICAgICAgIHBhcmFtczogbWF0Y2gucGFyYW1zCiAgICAgICAgICAgICAgICAgICAgICAgIH0pLCBhYm9ydFByb21pc2VdKSk7Y2FzZSAxMDpyZXN1bHQgPSBfY29udGV4dDE5LnNlbnQ7X2NvbnRleHQxOS5uZXh0ID0gMTc7YnJlYWs7Y2FzZSAxMzpfY29udGV4dDE5LnByZXYgPSAxMztfY29udGV4dDE5LnQwID0gX2NvbnRleHQxOVsiY2F0Y2giXSg1KTsKCiAgICAgICAgICAgICAgICAgICAgICByZXN1bHRUeXBlID0gUmVzdWx0VHlwZS5lcnJvcjsKICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdCA9IF9jb250ZXh0MTkudDA7Y2FzZSAxNzpfY29udGV4dDE5LnByZXYgPSAxNzsKCiAgICAgICAgICAgICAgICAgICAgICByZXF1ZXN0LnNpZ25hbC5yZW1vdmVFdmVudExpc3RlbmVyKCJhYm9ydCIsIG9uUmVqZWN0KTtyZXR1cm4gX2NvbnRleHQxOS5maW5pc2goMTcpO2Nhc2UgMjA6aWYgKCEoCgoKICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdCBpbnN0YW5jZW9mIFJlc3BvbnNlKSkge19jb250ZXh0MTkubmV4dCA9IDUxO2JyZWFrO30KICAgICAgICAgICAgICAgICAgICAgIHN0YXR1cyA9IHJlc3VsdC5zdGF0dXM7IC8vIFByb2Nlc3MgcmVkaXJlY3RzCiAgICAgICAgICAgICAgICAgICAgICBpZiAoISgKICAgICAgICAgICAgICAgICAgICAgIHN0YXR1cyA+PSAzMDAgJiYgc3RhdHVzIDw9IDM5OSkpIHtfY29udGV4dDE5Lm5leHQgPSAzNjticmVhazt9CiAgICAgICAgICAgICAgICAgICAgICBsb2NhdGlvbiA9IHJlc3VsdC5oZWFkZXJzLmdldCgiTG9jYXRpb24iKTsKICAgICAgICAgICAgICAgICAgICAgIHJvdXRlcl9pbnZhcmlhbnQobG9jYXRpb24sICJSZWRpcmVjdHMgcmV0dXJuZWQvdGhyb3duIGZyb20gbG9hZGVycy9hY3Rpb25zIG11c3QgaGF2ZSBhIExvY2F0aW9uIGhlYWRlciIpOyAvLyBTdXBwb3J0IHJlbGF0aXZlIHJvdXRpbmcgaW4gcmVkaXJlY3RzCgogICAgICAgICAgICAgICAgICAgICAgYWN0aXZlTWF0Y2hlcyA9IG1hdGNoZXMuc2xpY2UoMCwgbWF0Y2hlcy5pbmRleE9mKG1hdGNoKSArIDEpOwogICAgICAgICAgICAgICAgICAgICAgcm91dGVQYXRobmFtZXMgPSBnZXRQYXRoQ29udHJpYnV0aW5nTWF0Y2hlcyhhY3RpdmVNYXRjaGVzKS5tYXAoKG1hdGNoKSA9PiBtYXRjaC5wYXRobmFtZUJhc2UpOwogICAgICAgICAgICAgICAgICAgICAgcmVxdWVzdFBhdGggPSBjcmVhdGVVUkwocmVxdWVzdC51cmwpLnBhdGhuYW1lOwogICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZWRMb2NhdGlvbiA9IHJlc29sdmVUbyhsb2NhdGlvbiwgcm91dGVQYXRobmFtZXMsIHJlcXVlc3RQYXRoKTsKICAgICAgICAgICAgICAgICAgICAgIHJvdXRlcl9pbnZhcmlhbnQocm91dGVyX2NyZWF0ZVBhdGgocmVzb2x2ZWRMb2NhdGlvbiksICJVbmFibGUgdG8gcmVzb2x2ZSByZWRpcmVjdCBsb2NhdGlvbjogIiArIHJlc3VsdC5oZWFkZXJzLmdldCgiTG9jYXRpb24iKSk7IC8vIFByZXBlbmQgdGhlIGJhc2VuYW1lIHRvIHRoZSByZWRpcmVjdCBsb2NhdGlvbiBpZiB3ZSBoYXZlIG9uZQoKICAgICAgICAgICAgICAgICAgICAgIGlmIChiYXNlbmFtZSkgewogICAgICAgICAgICAgICAgICAgICAgICBwYXRoID0gcmVzb2x2ZWRMb2NhdGlvbi5wYXRobmFtZTsKICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZWRMb2NhdGlvbi5wYXRobmFtZSA9IHBhdGggPT09ICIvIiA/IGJhc2VuYW1lIDogcm91dGVyX2pvaW5QYXRocyhbYmFzZW5hbWUsIHBhdGhdKTsKICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICBsb2NhdGlvbiA9IHJvdXRlcl9jcmVhdGVQYXRoKHJlc29sdmVkTG9jYXRpb24pOyAvLyBEb24ndCBwcm9jZXNzIHJlZGlyZWN0cyBpbiB0aGUgcm91dGVyIGR1cmluZyBzdGF0aWMgcmVxdWVzdHMgcmVxdWVzdHMuCiAgICAgICAgICAgICAgICAgICAgICAvLyBJbnN0ZWFkLCB0aHJvdyB0aGUgUmVzcG9uc2UgYW5kIGxldCB0aGUgc2VydmVyIGhhbmRsZSBpdCB3aXRoIGFuIEhUVFAKICAgICAgICAgICAgICAgICAgICAgIC8vIHJlZGlyZWN0LiAgV2UgYWxzbyB1cGRhdGUgdGhlIExvY2F0aW9uIGhlYWRlciBpbiBwbGFjZSBpbiB0aGlzIGZsb3cgc28KICAgICAgICAgICAgICAgICAgICAgIC8vIGJhc2VuYW1lIGFuZCByZWxhdGl2ZSByb3V0aW5nIGlzIHRha2VuIGludG8gYWNjb3VudAogICAgICAgICAgICAgICAgICAgICAgaWYgKCEKICAgICAgICAgICAgICAgICAgICAgIGlzU3RhdGljUmVxdWVzdCkge19jb250ZXh0MTkubmV4dCA9IDM1O2JyZWFrO30KICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdC5oZWFkZXJzLnNldCgiTG9jYXRpb24iLCBsb2NhdGlvbik7dGhyb3cgKAogICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQpO2Nhc2UgMzU6cmV0dXJuIF9jb250ZXh0MTkuYWJydXB0KCJyZXR1cm4iLAoKCiAgICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6IFJlc3VsdFR5cGUucmVkaXJlY3QsCiAgICAgICAgICAgICAgICAgICAgICAgIHN0YXR1czogc3RhdHVzLAogICAgICAgICAgICAgICAgICAgICAgICBsb2NhdGlvbjogbG9jYXRpb24sCiAgICAgICAgICAgICAgICAgICAgICAgIHJldmFsaWRhdGU6IHJlc3VsdC5oZWFkZXJzLmdldCgiWC1SZW1peC1SZXZhbGlkYXRlIikgIT09IG51bGwKICAgICAgICAgICAgICAgICAgICAgIH0pO2Nhc2UgMzY6aWYgKCEKCgoKCgogICAgICAgICAgICAgICAgICAgICAgaXNSb3V0ZVJlcXVlc3QpIHtfY29udGV4dDE5Lm5leHQgPSAzODticmVhazt9dGhyb3cgKAoKICAgICAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6IHJlc3VsdFR5cGUgfHwgUmVzdWx0VHlwZS5kYXRhLAogICAgICAgICAgICAgICAgICAgICAgICAgIHJlc3BvbnNlOiByZXN1bHQKICAgICAgICAgICAgICAgICAgICAgICAgfSk7Y2FzZSAzODoKCgoKICAgICAgICAgICAgICAgICAgICAgIGNvbnRlbnRUeXBlID0gcmVzdWx0LmhlYWRlcnMuZ2V0KCJDb250ZW50LVR5cGUiKTtpZiAoISgKCiAgICAgICAgICAgICAgICAgICAgICBjb250ZW50VHlwZSAmJiBjb250ZW50VHlwZS5zdGFydHNXaXRoKCJhcHBsaWNhdGlvbi9qc29uIikpKSB7X2NvbnRleHQxOS5uZXh0ID0gNDU7YnJlYWs7fV9jb250ZXh0MTkubmV4dCA9IDQyO3JldHVybiAoCiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdC5qc29uKCkpO2Nhc2UgNDI6ZGF0YSA9IF9jb250ZXh0MTkuc2VudDtfY29udGV4dDE5Lm5leHQgPSA0ODticmVhaztjYXNlIDQ1Ol9jb250ZXh0MTkubmV4dCA9IDQ3O3JldHVybiAoCgogICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQudGV4dCgpKTtjYXNlIDQ3OmRhdGEgPSBfY29udGV4dDE5LnNlbnQ7Y2FzZSA0ODppZiAoISgKCgogICAgICAgICAgICAgICAgICAgICAgcmVzdWx0VHlwZSA9PT0gUmVzdWx0VHlwZS5lcnJvcikpIHtfY29udGV4dDE5Lm5leHQgPSA1MDticmVhazt9cmV0dXJuIF9jb250ZXh0MTkuYWJydXB0KCJyZXR1cm4iLAogICAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiByZXN1bHRUeXBlLAogICAgICAgICAgICAgICAgICAgICAgICBlcnJvcjogbmV3IEVycm9yUmVzcG9uc2Uoc3RhdHVzLCByZXN1bHQuc3RhdHVzVGV4dCwgZGF0YSksCiAgICAgICAgICAgICAgICAgICAgICAgIGhlYWRlcnM6IHJlc3VsdC5oZWFkZXJzCiAgICAgICAgICAgICAgICAgICAgICB9KTtjYXNlIDUwOnJldHVybiBfY29udGV4dDE5LmFicnVwdCgicmV0dXJuIiwKCgogICAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiBSZXN1bHRUeXBlLmRhdGEsCiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGE6IGRhdGEsCiAgICAgICAgICAgICAgICAgICAgICAgIHN0YXR1c0NvZGU6IHJlc3VsdC5zdGF0dXMsCiAgICAgICAgICAgICAgICAgICAgICAgIGhlYWRlcnM6IHJlc3VsdC5oZWFkZXJzCiAgICAgICAgICAgICAgICAgICAgICB9KTtjYXNlIDUxOmlmICghKAoKCiAgICAgICAgICAgICAgICAgICAgICByZXN1bHRUeXBlID09PSBSZXN1bHRUeXBlLmVycm9yKSkge19jb250ZXh0MTkubmV4dCA9IDUzO2JyZWFrO31yZXR1cm4gX2NvbnRleHQxOS5hYnJ1cHQoInJldHVybiIsCiAgICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6IHJlc3VsdFR5cGUsCiAgICAgICAgICAgICAgICAgICAgICAgIGVycm9yOiByZXN1bHQKICAgICAgICAgICAgICAgICAgICAgIH0pO2Nhc2UgNTM6aWYgKCEoCgoKICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdCBpbnN0YW5jZW9mIERlZmVycmVkRGF0YSkpIHtfY29udGV4dDE5Lm5leHQgPSA1NTticmVhazt9cmV0dXJuIF9jb250ZXh0MTkuYWJydXB0KCJyZXR1cm4iLAogICAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiBSZXN1bHRUeXBlLmRlZmVycmVkLAogICAgICAgICAgICAgICAgICAgICAgICBkZWZlcnJlZERhdGE6IHJlc3VsdAogICAgICAgICAgICAgICAgICAgICAgfSk7Y2FzZSA1NTpyZXR1cm4gX2NvbnRleHQxOS5hYnJ1cHQoInJldHVybiIsCgoKICAgICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogUmVzdWx0VHlwZS5kYXRhLAogICAgICAgICAgICAgICAgICAgICAgICBkYXRhOiByZXN1bHQKICAgICAgICAgICAgICAgICAgICAgIH0pO2Nhc2UgNTY6Y2FzZSAiZW5kIjpyZXR1cm4gX2NvbnRleHQxOS5zdG9wKCk7fX19LCBfY2FsbGVlMTgsIG51bGwsIFtbNSwgMTMsIDE3LCAyMF1dKTt9KSk7cmV0dXJuIF9jYWxsTG9hZGVyT3JBY3Rpb24uYXBwbHkodGhpcywgYXJndW1lbnRzKTt9CgoKICAgICAgICAgIGZ1bmN0aW9uIGNyZWF0ZVJlcXVlc3QobG9jYXRpb24sIHNpZ25hbCwgc3VibWlzc2lvbikgewogICAgICAgICAgICB2YXIgdXJsID0gY3JlYXRlVVJMKHN0cmlwSGFzaEZyb21QYXRoKGxvY2F0aW9uKSkudG9TdHJpbmcoKTsKICAgICAgICAgICAgdmFyIGluaXQgPSB7CiAgICAgICAgICAgICAgc2lnbmFsOiBzaWduYWwKICAgICAgICAgICAgfTsKCiAgICAgICAgICAgIGlmIChzdWJtaXNzaW9uKSB7CiAgICAgICAgICAgICAgdmFyCiAgICAgICAgICAgICAgICBmb3JtTWV0aG9kID0KCgogICAgICAgICAgICAgICAgc3VibWlzc2lvbi5mb3JtTWV0aG9kLGZvcm1FbmNUeXBlID0gc3VibWlzc2lvbi5mb3JtRW5jVHlwZSxmb3JtRGF0YSA9IHN1Ym1pc3Npb24uZm9ybURhdGE7CiAgICAgICAgICAgICAgaW5pdC5tZXRob2QgPSBmb3JtTWV0aG9kLnRvVXBwZXJDYXNlKCk7CiAgICAgICAgICAgICAgaW5pdC5ib2R5ID0gZm9ybUVuY1R5cGUgPT09ICJhcHBsaWNhdGlvbi94LXd3dy1mb3JtLXVybGVuY29kZWQiID8gY29udmVydEZvcm1EYXRhVG9TZWFyY2hQYXJhbXMoZm9ybURhdGEpIDogZm9ybURhdGE7CiAgICAgICAgICAgIH0gLy8gQ29udGVudC1UeXBlIGlzIGluZmVycmVkIChodHRwczovL2ZldGNoLnNwZWMud2hhdHdnLm9yZy8jZG9tLXJlcXVlc3QpCgoKICAgICAgICAgICAgcmV0dXJuIG5ldyBSZXF1ZXN0KHVybCwgaW5pdCk7CiAgICAgICAgICB9CgogICAgICAgICAgZnVuY3Rpb24gY29udmVydEZvcm1EYXRhVG9TZWFyY2hQYXJhbXMoZm9ybURhdGEpIHsKICAgICAgICAgICAgdmFyIHNlYXJjaFBhcmFtcyA9IG5ldyBVUkxTZWFyY2hQYXJhbXMoKTt2YXIgX2l0ZXJhdG9yNiA9IF9jcmVhdGVGb3JPZkl0ZXJhdG9ySGVscGVyMigKCiAgICAgICAgICAgICAgZm9ybURhdGEuZW50cmllcygpKSxfc3RlcDY7dHJ5IHtmb3IgKF9pdGVyYXRvcjYucygpOyAhKF9zdGVwNiA9IF9pdGVyYXRvcjYubigpKS5kb25lOykge3ZhciBfc3RlcDYkdmFsdWUgPSBfc2xpY2VkVG9BcnJheTIoX3N0ZXA2LnZhbHVlLCAyKSxrZXkgPSBfc3RlcDYkdmFsdWVbMF0sdmFsdWUgPSBfc3RlcDYkdmFsdWVbMV07CiAgICAgICAgICAgICAgICByb3V0ZXJfaW52YXJpYW50KHR5cGVvZiB2YWx1ZSA9PT0gInN0cmluZyIsICdGaWxlIGlucHV0cyBhcmUgbm90IHN1cHBvcnRlZCB3aXRoIGVuY1R5cGUgImFwcGxpY2F0aW9uL3gtd3d3LWZvcm0tdXJsZW5jb2RlZCIsICcgKyAncGxlYXNlIHVzZSAibXVsdGlwYXJ0L2Zvcm0tZGF0YSIgaW5zdGVhZC4nKTsKICAgICAgICAgICAgICAgIHNlYXJjaFBhcmFtcy5hcHBlbmQoa2V5LCB2YWx1ZSk7CiAgICAgICAgICAgICAgfX0gY2F0Y2ggKGVycikge19pdGVyYXRvcjYuZShlcnIpO30gZmluYWxseSB7X2l0ZXJhdG9yNi5mKCk7fQoKICAgICAgICAgICAgcmV0dXJuIHNlYXJjaFBhcmFtczsKICAgICAgICAgIH0KCiAgICAgICAgICBmdW5jdGlvbiBwcm9jZXNzUm91dGVMb2FkZXJEYXRhKG1hdGNoZXMsIG1hdGNoZXNUb0xvYWQsIHJlc3VsdHMsIHBlbmRpbmdFcnJvciwgYWN0aXZlRGVmZXJyZWRzKSB7CiAgICAgICAgICAgIC8vIEZpbGwgaW4gbG9hZGVyRGF0YS9lcnJvcnMgZnJvbSBvdXIgbG9hZGVycwogICAgICAgICAgICB2YXIgbG9hZGVyRGF0YSA9IHt9OwogICAgICAgICAgICB2YXIgZXJyb3JzID0gbnVsbDsKICAgICAgICAgICAgdmFyIHN0YXR1c0NvZGU7CiAgICAgICAgICAgIHZhciBmb3VuZEVycm9yID0gZmFsc2U7CiAgICAgICAgICAgIHZhciBsb2FkZXJIZWFkZXJzID0ge307IC8vIFByb2Nlc3MgbG9hZGVyIHJlc3VsdHMgaW50byBzdGF0ZS5sb2FkZXJEYXRhL3N0YXRlLmVycm9ycwoKICAgICAgICAgICAgcmVzdWx0cy5mb3JFYWNoKChyZXN1bHQsIGluZGV4KSA9PiB7CiAgICAgICAgICAgICAgdmFyIGlkID0gbWF0Y2hlc1RvTG9hZFtpbmRleF0ucm91dGUuaWQ7CiAgICAgICAgICAgICAgcm91dGVyX2ludmFyaWFudCghaXNSZWRpcmVjdFJlc3VsdChyZXN1bHQpLCAiQ2Fubm90IGhhbmRsZSByZWRpcmVjdCByZXN1bHRzIGluIHByb2Nlc3NMb2FkZXJEYXRhIik7CgogICAgICAgICAgICAgIGlmIChpc0Vycm9yUmVzdWx0KHJlc3VsdCkpIHsKICAgICAgICAgICAgICAgIC8vIExvb2sgdXB3YXJkcyBmcm9tIHRoZSBtYXRjaGVkIHJvdXRlIGZvciB0aGUgY2xvc2VzdCBhbmNlc3RvcgogICAgICAgICAgICAgICAgLy8gZXJyb3IgYm91bmRhcnksIGRlZmF1bHRpbmcgdG8gdGhlIHJvb3QgbWF0Y2gKICAgICAgICAgICAgICAgIHZhciBib3VuZGFyeU1hdGNoID0gZmluZE5lYXJlc3RCb3VuZGFyeShtYXRjaGVzLCBpZCk7CiAgICAgICAgICAgICAgICB2YXIgZXJyb3IgPSByZXN1bHQuZXJyb3I7IC8vIElmIHdlIGhhdmUgYSBwZW5kaW5nIGFjdGlvbiBlcnJvciwgd2UgcmVwb3J0IGl0IGF0IHRoZSBoaWdoZXN0LXJvdXRlCiAgICAgICAgICAgICAgICAvLyB0aGF0IHRocm93cyBhIGxvYWRlciBlcnJvciwgYW5kIHRoZW4gY2xlYXIgaXQgb3V0IHRvIGluZGljYXRlIHRoYXQKICAgICAgICAgICAgICAgIC8vIGl0IHdhcyBjb25zdW1lZAoKICAgICAgICAgICAgICAgIGlmIChwZW5kaW5nRXJyb3IpIHsKICAgICAgICAgICAgICAgICAgZXJyb3IgPSBPYmplY3QudmFsdWVzKHBlbmRpbmdFcnJvcilbMF07CiAgICAgICAgICAgICAgICAgIHBlbmRpbmdFcnJvciA9IHVuZGVmaW5lZDsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBlcnJvcnMgPSBPYmplY3QuYXNzaWduKGVycm9ycyB8fCB7fSwgX2RlZmluZVByb3BlcnR5Mih7fSwKICAgICAgICAgICAgICAgIGJvdW5kYXJ5TWF0Y2gucm91dGUuaWQsIGVycm9yKSk7CiAgICAgICAgICAgICAgICAvLyBPbmNlIHdlIGZpbmQgb3VyIGZpcnN0IChoaWdoZXN0KSBlcnJvciwgd2Ugc2V0IHRoZSBzdGF0dXMgY29kZSBhbmQKICAgICAgICAgICAgICAgIC8vIHByZXZlbnQgZGVlcGVyIHN0YXR1cyBjb2RlcyBmcm9tIG92ZXJyaWRpbmcKCiAgICAgICAgICAgICAgICBpZiAoIWZvdW5kRXJyb3IpIHsKICAgICAgICAgICAgICAgICAgZm91bmRFcnJvciA9IHRydWU7CiAgICAgICAgICAgICAgICAgIHN0YXR1c0NvZGUgPSBpc1JvdXRlRXJyb3JSZXNwb25zZShyZXN1bHQuZXJyb3IpID8gcmVzdWx0LmVycm9yLnN0YXR1cyA6IDUwMDsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBpZiAocmVzdWx0LmhlYWRlcnMpIHsKICAgICAgICAgICAgICAgICAgbG9hZGVySGVhZGVyc1tpZF0gPSByZXN1bHQuaGVhZGVyczsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9IGVsc2UgaWYgKGlzRGVmZXJyZWRSZXN1bHQocmVzdWx0KSkgewogICAgICAgICAgICAgICAgYWN0aXZlRGVmZXJyZWRzICYmIGFjdGl2ZURlZmVycmVkcy5zZXQoaWQsIHJlc3VsdC5kZWZlcnJlZERhdGEpOwogICAgICAgICAgICAgICAgbG9hZGVyRGF0YVtpZF0gPSByZXN1bHQuZGVmZXJyZWREYXRhLmRhdGE7IC8vIFRPRE86IEFkZCBzdGF0dXNDb2RlL2hlYWRlcnMgb25jZSB3ZSB3aXJlIHVwIHN0cmVhbWluZyBpbiBSZW1peAogICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBsb2FkZXJEYXRhW2lkXSA9IHJlc3VsdC5kYXRhOyAvLyBFcnJvciBzdGF0dXMgY29kZXMgYWx3YXlzIG92ZXJyaWRlIHN1Y2Nlc3Mgc3RhdHVzIGNvZGVzLCBidXQgaWYgYWxsCiAgICAgICAgICAgICAgICAvLyBsb2FkZXJzIGFyZSBzdWNjZXNzZnVsIHdlIHRha2UgdGhlIGRlZXBlc3Qgc3RhdHVzIGNvZGUuCgogICAgICAgICAgICAgICAgaWYgKHJlc3VsdC5zdGF0dXNDb2RlICE9IG51bGwgJiYgcmVzdWx0LnN0YXR1c0NvZGUgIT09IDIwMCAmJiAhZm91bmRFcnJvcikgewogICAgICAgICAgICAgICAgICBzdGF0dXNDb2RlID0gcmVzdWx0LnN0YXR1c0NvZGU7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgaWYgKHJlc3VsdC5oZWFkZXJzKSB7CiAgICAgICAgICAgICAgICAgIGxvYWRlckhlYWRlcnNbaWRdID0gcmVzdWx0LmhlYWRlcnM7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsgLy8gSWYgd2UgZGlkbid0IGNvbnN1bWUgdGhlIHBlbmRpbmcgYWN0aW9uIGVycm9yIChpLmUuLCBhbGwgbG9hZGVycwogICAgICAgICAgICAvLyByZXNvbHZlZCksIHRoZW4gY29uc3VtZSBpdCBoZXJlCgogICAgICAgICAgICBpZiAocGVuZGluZ0Vycm9yKSB7CiAgICAgICAgICAgICAgZXJyb3JzID0gcGVuZGluZ0Vycm9yOwogICAgICAgICAgICB9CgogICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgIGxvYWRlckRhdGE6IGxvYWRlckRhdGEsCiAgICAgICAgICAgICAgZXJyb3JzOiBlcnJvcnMsCiAgICAgICAgICAgICAgc3RhdHVzQ29kZTogc3RhdHVzQ29kZSB8fCAyMDAsCiAgICAgICAgICAgICAgbG9hZGVySGVhZGVyczogbG9hZGVySGVhZGVycwogICAgICAgICAgICB9OwogICAgICAgICAgfQoKICAgICAgICAgIGZ1bmN0aW9uIHByb2Nlc3NMb2FkZXJEYXRhKHN0YXRlLCBtYXRjaGVzLCBtYXRjaGVzVG9Mb2FkLCByZXN1bHRzLCBwZW5kaW5nRXJyb3IsIHJldmFsaWRhdGluZ0ZldGNoZXJzLCBmZXRjaGVyUmVzdWx0cywgYWN0aXZlRGVmZXJyZWRzKSB7CiAgICAgICAgICAgIHZhciBfcHJvY2Vzc1JvdXRlTG9hZGVyRGEgPQoKCiAgICAgICAgICAgICAgcHJvY2Vzc1JvdXRlTG9hZGVyRGF0YShtYXRjaGVzLCBtYXRjaGVzVG9Mb2FkLCByZXN1bHRzLCBwZW5kaW5nRXJyb3IsIGFjdGl2ZURlZmVycmVkcyksbG9hZGVyRGF0YSA9IF9wcm9jZXNzUm91dGVMb2FkZXJEYS5sb2FkZXJEYXRhLGVycm9ycyA9IF9wcm9jZXNzUm91dGVMb2FkZXJEYS5lcnJvcnM7IC8vIFByb2Nlc3MgcmVzdWx0cyBmcm9tIG91ciByZXZhbGlkYXRpbmcgZmV0Y2hlcnMKCiAgICAgICAgICAgIGZvciAodmFyIGluZGV4ID0gMDsgaW5kZXggPCByZXZhbGlkYXRpbmdGZXRjaGVycy5sZW5ndGg7IGluZGV4KyspIHsKICAgICAgICAgICAgICB2YXIgX3JldmFsaWRhdGluZ0ZldGNoZXJzID0gX3NsaWNlZFRvQXJyYXkyKHJldmFsaWRhdGluZ0ZldGNoZXJzW2luZGV4XSwgMyksa2V5ID0gX3JldmFsaWRhdGluZ0ZldGNoZXJzWzBdLG1hdGNoID0gX3JldmFsaWRhdGluZ0ZldGNoZXJzWzJdOwogICAgICAgICAgICAgIHJvdXRlcl9pbnZhcmlhbnQoZmV0Y2hlclJlc3VsdHMgIT09IHVuZGVmaW5lZCAmJiBmZXRjaGVyUmVzdWx0c1tpbmRleF0gIT09IHVuZGVmaW5lZCwgIkRpZCBub3QgZmluZCBjb3JyZXNwb25kaW5nIGZldGNoZXIgcmVzdWx0Iik7CiAgICAgICAgICAgICAgdmFyIHJlc3VsdCA9IGZldGNoZXJSZXN1bHRzW2luZGV4XTsgLy8gUHJvY2VzcyBmZXRjaGVyIG5vbi1yZWRpcmVjdCBlcnJvcnMKCiAgICAgICAgICAgICAgaWYgKGlzRXJyb3JSZXN1bHQocmVzdWx0KSkgewogICAgICAgICAgICAgICAgdmFyIGJvdW5kYXJ5TWF0Y2ggPSBmaW5kTmVhcmVzdEJvdW5kYXJ5KHN0YXRlLm1hdGNoZXMsIG1hdGNoLnJvdXRlLmlkKTsKCiAgICAgICAgICAgICAgICBpZiAoIShlcnJvcnMgJiYgZXJyb3JzW2JvdW5kYXJ5TWF0Y2gucm91dGUuaWRdKSkgewogICAgICAgICAgICAgICAgICBlcnJvcnMgPSBfZXh0ZW5kcyh7fSwgZXJyb3JzLCBfZGVmaW5lUHJvcGVydHkyKHt9LAogICAgICAgICAgICAgICAgICBib3VuZGFyeU1hdGNoLnJvdXRlLmlkLCByZXN1bHQuZXJyb3IpKTsKCiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgc3RhdGUuZmV0Y2hlcnMuZGVsZXRlKGtleSk7CiAgICAgICAgICAgICAgfSBlbHNlIGlmIChpc1JlZGlyZWN0UmVzdWx0KHJlc3VsdCkpIHsKICAgICAgICAgICAgICAgIC8vIFNob3VsZCBuZXZlciBnZXQgaGVyZSwgcmVkaXJlY3RzIHNob3VsZCBnZXQgcHJvY2Vzc2VkIGFib3ZlLCBidXQgd2UKICAgICAgICAgICAgICAgIC8vIGtlZXAgdGhpcyB0byB0eXBlIG5hcnJvdyB0byBhIHN1Y2Nlc3MgcmVzdWx0IGluIHRoZSBlbHNlCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIlVuaGFuZGxlZCBmZXRjaGVyIHJldmFsaWRhdGlvbiByZWRpcmVjdCIpOwogICAgICAgICAgICAgIH0gZWxzZSBpZiAoaXNEZWZlcnJlZFJlc3VsdChyZXN1bHQpKSB7CiAgICAgICAgICAgICAgICAvLyBTaG91bGQgbmV2ZXIgZ2V0IGhlcmUsIGRlZmVycmVkIGRhdGEgc2hvdWxkIGJlIGF3YWl0ZWQgZm9yIGZldGNoZXJzCiAgICAgICAgICAgICAgICAvLyBpbiByZXNvbHZlRGVmZXJyZWRSZXN1bHRzCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIlVuaGFuZGxlZCBmZXRjaGVyIGRlZmVycmVkIGRhdGEiKTsKICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgdmFyIGRvbmVGZXRjaGVyID0gewogICAgICAgICAgICAgICAgICBzdGF0ZTogImlkbGUiLAogICAgICAgICAgICAgICAgICBkYXRhOiByZXN1bHQuZGF0YSwKICAgICAgICAgICAgICAgICAgZm9ybU1ldGhvZDogdW5kZWZpbmVkLAogICAgICAgICAgICAgICAgICBmb3JtQWN0aW9uOiB1bmRlZmluZWQsCiAgICAgICAgICAgICAgICAgIGZvcm1FbmNUeXBlOiB1bmRlZmluZWQsCiAgICAgICAgICAgICAgICAgIGZvcm1EYXRhOiB1bmRlZmluZWQKICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICBzdGF0ZS5mZXRjaGVycy5zZXQoa2V5LCBkb25lRmV0Y2hlcik7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgIGxvYWRlckRhdGE6IGxvYWRlckRhdGEsCiAgICAgICAgICAgICAgZXJyb3JzOiBlcnJvcnMKICAgICAgICAgICAgfTsKICAgICAgICAgIH0KCiAgICAgICAgICBmdW5jdGlvbiBtZXJnZUxvYWRlckRhdGEobG9hZGVyRGF0YSwgbmV3TG9hZGVyRGF0YSwgbWF0Y2hlcykgewogICAgICAgICAgICB2YXIgbWVyZ2VkTG9hZGVyRGF0YSA9IF9leHRlbmRzKHt9LCBuZXdMb2FkZXJEYXRhKTsKCiAgICAgICAgICAgIG1hdGNoZXMuZm9yRWFjaCgobWF0Y2gpID0+IHsKICAgICAgICAgICAgICB2YXIgaWQgPSBtYXRjaC5yb3V0ZS5pZDsKCiAgICAgICAgICAgICAgaWYgKG5ld0xvYWRlckRhdGFbaWRdID09PSB1bmRlZmluZWQgJiYgbG9hZGVyRGF0YVtpZF0gIT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICAgICAgbWVyZ2VkTG9hZGVyRGF0YVtpZF0gPSBsb2FkZXJEYXRhW2lkXTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICByZXR1cm4gbWVyZ2VkTG9hZGVyRGF0YTsKICAgICAgICAgIH0gLy8gRmluZCB0aGUgbmVhcmVzdCBlcnJvciBib3VuZGFyeSwgbG9va2luZyB1cHdhcmRzIGZyb20gdGhlIGxlYWYgcm91dGUgKG9yIHRoZQogICAgICAgICAgLy8gcm91dGUgc3BlY2lmaWVkIGJ5IHJvdXRlSWQpIGZvciB0aGUgY2xvc2VzdCBhbmNlc3RvciBlcnJvciBib3VuZGFyeSwKICAgICAgICAgIC8vIGRlZmF1bHRpbmcgdG8gdGhlIHJvb3QgbWF0Y2gKCgogICAgICAgICAgZnVuY3Rpb24gZmluZE5lYXJlc3RCb3VuZGFyeShtYXRjaGVzLCByb3V0ZUlkKSB7CiAgICAgICAgICAgIHZhciBlbGlnaWJsZU1hdGNoZXMgPSByb3V0ZUlkID8gbWF0Y2hlcy5zbGljZSgwLCBtYXRjaGVzLmZpbmRJbmRleCgobSkgPT4gbS5yb3V0ZS5pZCA9PT0gcm91dGVJZCkgKyAxKSA6IF90b0NvbnN1bWFibGVBcnJheTIobWF0Y2hlcyk7CiAgICAgICAgICAgIHJldHVybiBlbGlnaWJsZU1hdGNoZXMucmV2ZXJzZSgpLmZpbmQoKG0pID0+IG0ucm91dGUuaGFzRXJyb3JCb3VuZGFyeSA9PT0gdHJ1ZSkgfHwgbWF0Y2hlc1swXTsKICAgICAgICAgIH0KCiAgICAgICAgICBmdW5jdGlvbiBnZXRTaG9ydENpcmN1aXRNYXRjaGVzKHJvdXRlcywgc3RhdHVzLCBzdGF0dXNUZXh0KSB7CiAgICAgICAgICAgIC8vIFByZWZlciBhIHJvb3QgbGF5b3V0IHJvdXRlIGlmIHByZXNlbnQsIG90aGVyd2lzZSBzaGltIGluIGEgcm91dGUgb2JqZWN0CiAgICAgICAgICAgIHZhciByb3V0ZSA9IHJvdXRlcy5maW5kKChyKSA9PiByLmluZGV4IHx8ICFyLnBhdGggfHwgci5wYXRoID09PSAiLyIpIHx8IHsKICAgICAgICAgICAgICBpZDogIl9fc2hpbS0iICsgc3RhdHVzICsgIi1yb3V0ZV9fIgogICAgICAgICAgICB9OwogICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgIG1hdGNoZXM6IFt7CiAgICAgICAgICAgICAgICBwYXJhbXM6IHt9LAogICAgICAgICAgICAgICAgcGF0aG5hbWU6ICIiLAogICAgICAgICAgICAgICAgcGF0aG5hbWVCYXNlOiAiIiwKICAgICAgICAgICAgICAgIHJvdXRlOiByb3V0ZQogICAgICAgICAgICAgIH1dLAogICAgICAgICAgICAgIHJvdXRlOiByb3V0ZSwKICAgICAgICAgICAgICBlcnJvcjogbmV3IEVycm9yUmVzcG9uc2Uoc3RhdHVzLCBzdGF0dXNUZXh0LCBudWxsKQogICAgICAgICAgICB9OwogICAgICAgICAgfQoKICAgICAgICAgIGZ1bmN0aW9uIGdldE5vdEZvdW5kTWF0Y2hlcyhyb3V0ZXMpIHsKICAgICAgICAgICAgcmV0dXJuIGdldFNob3J0Q2lyY3VpdE1hdGNoZXMocm91dGVzLCA0MDQsICJOb3QgRm91bmQiKTsKICAgICAgICAgIH0KCiAgICAgICAgICBmdW5jdGlvbiBnZXRNZXRob2ROb3RBbGxvd2VkTWF0Y2hlcyhyb3V0ZXMpIHsKICAgICAgICAgICAgcmV0dXJuIGdldFNob3J0Q2lyY3VpdE1hdGNoZXMocm91dGVzLCA0MDUsICJNZXRob2QgTm90IEFsbG93ZWQiKTsKICAgICAgICAgIH0KCiAgICAgICAgICBmdW5jdGlvbiBnZXRNZXRob2ROb3RBbGxvd2VkUmVzdWx0KHBhdGgpIHsKICAgICAgICAgICAgdmFyIGhyZWYgPSB0eXBlb2YgcGF0aCA9PT0gInN0cmluZyIgPyBwYXRoIDogcm91dGVyX2NyZWF0ZVBhdGgocGF0aCk7CiAgICAgICAgICAgIGNvbnNvbGUud2FybigiWW91J3JlIHRyeWluZyB0byBzdWJtaXQgdG8gYSByb3V0ZSB0aGF0IGRvZXMgbm90IGhhdmUgYW4gYWN0aW9uLiAgVG8gIiArICJmaXggdGhpcywgcGxlYXNlIGFkZCBhbiBgYWN0aW9uYCBmdW5jdGlvbiB0byB0aGUgcm91dGUgZm9yICIgKyAoIlsiICsgaHJlZiArICJdIikpOwogICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgIHR5cGU6IFJlc3VsdFR5cGUuZXJyb3IsCiAgICAgICAgICAgICAgZXJyb3I6IG5ldyBFcnJvclJlc3BvbnNlKDQwNSwgIk1ldGhvZCBOb3QgQWxsb3dlZCIsICIiKQogICAgICAgICAgICB9OwogICAgICAgICAgfSAvLyBGaW5kIGFueSByZXR1cm5lZCByZWRpcmVjdCBlcnJvcnMsIHN0YXJ0aW5nIGZyb20gdGhlIGxvd2VzdCBtYXRjaAoKCiAgICAgICAgICBmdW5jdGlvbiBmaW5kUmVkaXJlY3QocmVzdWx0cykgewogICAgICAgICAgICBmb3IgKHZhciBpID0gcmVzdWx0cy5sZW5ndGggLSAxOyBpID49IDA7IGktLSkgewogICAgICAgICAgICAgIHZhciByZXN1bHQgPSByZXN1bHRzW2ldOwoKICAgICAgICAgICAgICBpZiAoaXNSZWRpcmVjdFJlc3VsdChyZXN1bHQpKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gcmVzdWx0OwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfQoKICAgICAgICAgIGZ1bmN0aW9uIHN0cmlwSGFzaEZyb21QYXRoKHBhdGgpIHsKICAgICAgICAgICAgdmFyIHBhcnNlZFBhdGggPSB0eXBlb2YgcGF0aCA9PT0gInN0cmluZyIgPyBwYXJzZVBhdGgocGF0aCkgOiBwYXRoOwogICAgICAgICAgICByZXR1cm4gcm91dGVyX2NyZWF0ZVBhdGgoX2V4dGVuZHMoe30sIHBhcnNlZFBhdGgsIHsKICAgICAgICAgICAgICBoYXNoOiAiIgogICAgICAgICAgICB9KSk7CiAgICAgICAgICB9CgogICAgICAgICAgZnVuY3Rpb24gaXNIYXNoQ2hhbmdlT25seShhLCBiKSB7CiAgICAgICAgICAgIHJldHVybiBhLnBhdGhuYW1lID09PSBiLnBhdGhuYW1lICYmIGEuc2VhcmNoID09PSBiLnNlYXJjaCAmJiBhLmhhc2ggIT09IGIuaGFzaDsKICAgICAgICAgIH0KCiAgICAgICAgICBmdW5jdGlvbiBpc0RlZmVycmVkUmVzdWx0KHJlc3VsdCkgewogICAgICAgICAgICByZXR1cm4gcmVzdWx0LnR5cGUgPT09IFJlc3VsdFR5cGUuZGVmZXJyZWQ7CiAgICAgICAgICB9CgogICAgICAgICAgZnVuY3Rpb24gaXNFcnJvclJlc3VsdChyZXN1bHQpIHsKICAgICAgICAgICAgcmV0dXJuIHJlc3VsdC50eXBlID09PSBSZXN1bHRUeXBlLmVycm9yOwogICAgICAgICAgfQoKICAgICAgICAgIGZ1bmN0aW9uIGlzUmVkaXJlY3RSZXN1bHQocmVzdWx0KSB7CiAgICAgICAgICAgIHJldHVybiAocmVzdWx0ICYmIHJlc3VsdC50eXBlKSA9PT0gUmVzdWx0VHlwZS5yZWRpcmVjdDsKICAgICAgICAgIH0KCiAgICAgICAgICBmdW5jdGlvbiBpc1JlZGlyZWN0UmVzcG9uc2UocmVzdWx0KSB7CiAgICAgICAgICAgIGlmICghKHJlc3VsdCBpbnN0YW5jZW9mIFJlc3BvbnNlKSkgewogICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdmFyIHN0YXR1cyA9IHJlc3VsdC5zdGF0dXM7CiAgICAgICAgICAgIHZhciBsb2NhdGlvbiA9IHJlc3VsdC5oZWFkZXJzLmdldCgiTG9jYXRpb24iKTsKICAgICAgICAgICAgcmV0dXJuIHN0YXR1cyA+PSAzMDAgJiYgc3RhdHVzIDw9IDM5OSAmJiBsb2NhdGlvbiAhPSBudWxsOwogICAgICAgICAgfQoKICAgICAgICAgIGZ1bmN0aW9uIGlzUXVlcnlSb3V0ZVJlc3BvbnNlKG9iaikgewogICAgICAgICAgICByZXR1cm4gb2JqICYmIG9iai5yZXNwb25zZSBpbnN0YW5jZW9mIFJlc3BvbnNlICYmIChvYmoudHlwZSA9PT0gUmVzdWx0VHlwZS5kYXRhIHx8IFJlc3VsdFR5cGUuZXJyb3IpOwogICAgICAgICAgfWZ1bmN0aW9uCgogICAgICAgICAgcmVzb2x2ZURlZmVycmVkUmVzdWx0cyhfeDY1LCBfeDY2LCBfeDY3LCBfeDY4LCBfeDY5LCBfeDcwKSB7cmV0dXJuIF9yZXNvbHZlRGVmZXJyZWRSZXN1bHRzLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7fWZ1bmN0aW9uIF9yZXNvbHZlRGVmZXJyZWRSZXN1bHRzKCkge19yZXNvbHZlRGVmZXJyZWRSZXN1bHRzID0gX2FzeW5jVG9HZW5lcmF0b3IyKCAvKiNfX1BVUkVfXyovX3JlZ2VuZXJhdG9yUnVudGltZTIoKS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUxOShjdXJyZW50TWF0Y2hlcywgbWF0Y2hlc1RvTG9hZCwgcmVzdWx0cywgc2lnbmFsLCBpc0ZldGNoZXIsIGN1cnJlbnRMb2FkZXJEYXRhKSB7dmFyIF9sb29wMiwgaW5kZXg7cmV0dXJuIF9yZWdlbmVyYXRvclJ1bnRpbWUyKCkud3JhcChmdW5jdGlvbiBfY2FsbGVlMTkkKF9jb250ZXh0MjEpIHt3aGlsZSAoMSkge3N3aXRjaCAoX2NvbnRleHQyMS5wcmV2ID0gX2NvbnRleHQyMS5uZXh0KSB7Y2FzZSAwOl9sb29wMiA9IC8qI19fUFVSRV9fKi9fcmVnZW5lcmF0b3JSdW50aW1lMigpLm1hcmsoZnVuY3Rpb24gX2xvb3AyKAogICAgICAgICAgICAgICAgICAgICAgaW5kZXgpIHt2YXIgcmVzdWx0LCBtYXRjaCwgY3VycmVudE1hdGNoLCBpc1JldmFsaWRhdGluZ0xvYWRlcjtyZXR1cm4gX3JlZ2VuZXJhdG9yUnVudGltZTIoKS53cmFwKGZ1bmN0aW9uIF9sb29wMiQoX2NvbnRleHQyMCkge3doaWxlICgxKSB7c3dpdGNoIChfY29udGV4dDIwLnByZXYgPSBfY29udGV4dDIwLm5leHQpIHtjYXNlIDA6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0ID0gcmVzdWx0c1tpbmRleF07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbWF0Y2ggPSBtYXRjaGVzVG9Mb2FkW2luZGV4XTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50TWF0Y2ggPSBjdXJyZW50TWF0Y2hlcy5maW5kKChtKSA9PiBtLnJvdXRlLmlkID09PSBtYXRjaC5yb3V0ZS5pZCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaXNSZXZhbGlkYXRpbmdMb2FkZXIgPSBjdXJyZW50TWF0Y2ggIT0gbnVsbCAmJiAhaXNOZXdSb3V0ZUluc3RhbmNlKGN1cnJlbnRNYXRjaCwgbWF0Y2gpICYmIChjdXJyZW50TG9hZGVyRGF0YSAmJiBjdXJyZW50TG9hZGVyRGF0YVttYXRjaC5yb3V0ZS5pZF0pICE9PSB1bmRlZmluZWQ7aWYgKCEoCgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlzRGVmZXJyZWRSZXN1bHQocmVzdWx0KSAmJiAoaXNGZXRjaGVyIHx8IGlzUmV2YWxpZGF0aW5nTG9hZGVyKSkpIHtfY29udGV4dDIwLm5leHQgPSA3O2JyZWFrO31fY29udGV4dDIwLm5leHQgPSA3O3JldHVybiAoCgoKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlRGVmZXJyZWREYXRhKHJlc3VsdCwgc2lnbmFsLCBpc0ZldGNoZXIpLnRoZW4oKHJlc3VsdCkgPT4gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocmVzdWx0KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0c1tpbmRleF0gPSByZXN1bHQgfHwgcmVzdWx0c1tpbmRleF07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pKTtjYXNlIDc6Y2FzZSAiZW5kIjpyZXR1cm4gX2NvbnRleHQyMC5zdG9wKCk7fX19LCBfbG9vcDIpO30pO2luZGV4ID0gMDtjYXNlIDI6aWYgKCEoaW5kZXggPCByZXN1bHRzLmxlbmd0aCkpIHtfY29udGV4dDIxLm5leHQgPSA3O2JyZWFrO31yZXR1cm4gX2NvbnRleHQyMS5kZWxlZ2F0ZVlpZWxkKF9sb29wMihpbmRleCksICJ0MCIsIDQpO2Nhc2UgNDppbmRleCsrO19jb250ZXh0MjEubmV4dCA9IDI7YnJlYWs7Y2FzZSA3OmNhc2UgImVuZCI6cmV0dXJuIF9jb250ZXh0MjEuc3RvcCgpO319fSwgX2NhbGxlZTE5KTt9KSk7cmV0dXJuIF9yZXNvbHZlRGVmZXJyZWRSZXN1bHRzLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7fWZ1bmN0aW9uCgoKCgogICAgICAgICAgcmVzb2x2ZURlZmVycmVkRGF0YShfeDcxLCBfeDcyLCBfeDczKSB7cmV0dXJuIF9yZXNvbHZlRGVmZXJyZWREYXRhLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7fWZ1bmN0aW9uIF9yZXNvbHZlRGVmZXJyZWREYXRhKCkge19yZXNvbHZlRGVmZXJyZWREYXRhID0gX2FzeW5jVG9HZW5lcmF0b3IyKCAvKiNfX1BVUkVfXyovX3JlZ2VuZXJhdG9yUnVudGltZTIoKS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUyMChyZXN1bHQsIHNpZ25hbCwgdW53cmFwKSB7dmFyIGFib3J0ZWQ7cmV0dXJuIF9yZWdlbmVyYXRvclJ1bnRpbWUyKCkud3JhcChmdW5jdGlvbiBfY2FsbGVlMjAkKF9jb250ZXh0MjIpIHt3aGlsZSAoMSkge3N3aXRjaCAoX2NvbnRleHQyMi5wcmV2ID0gX2NvbnRleHQyMi5uZXh0KSB7Y2FzZSAwOgogICAgICAgICAgICAgICAgICAgICAgaWYgKHVud3JhcCA9PT0gdm9pZCAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHVud3JhcCA9IGZhbHNlOwogICAgICAgICAgICAgICAgICAgICAgfV9jb250ZXh0MjIubmV4dCA9IDM7cmV0dXJuICgKCiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdC5kZWZlcnJlZERhdGEucmVzb2x2ZURhdGEoc2lnbmFsKSk7Y2FzZSAzOmFib3J0ZWQgPSBfY29udGV4dDIyLnNlbnQ7aWYgKCEKCiAgICAgICAgICAgICAgICAgICAgICBhYm9ydGVkKSB7X2NvbnRleHQyMi5uZXh0ID0gNjticmVhazt9cmV0dXJuIF9jb250ZXh0MjIuYWJydXB0KCJyZXR1cm4iKTtjYXNlIDY6aWYgKCEKCgoKICAgICAgICAgICAgICAgICAgICAgIHVud3JhcCkge19jb250ZXh0MjIubmV4dCA9IDE0O2JyZWFrO31fY29udGV4dDIyLnByZXYgPSA3O3JldHVybiBfY29udGV4dDIyLmFicnVwdCgicmV0dXJuIiwKCiAgICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6IFJlc3VsdFR5cGUuZGF0YSwKICAgICAgICAgICAgICAgICAgICAgICAgZGF0YTogcmVzdWx0LmRlZmVycmVkRGF0YS51bndyYXBwZWREYXRhCiAgICAgICAgICAgICAgICAgICAgICB9KTtjYXNlIDExOl9jb250ZXh0MjIucHJldiA9IDExO19jb250ZXh0MjIudDAgPSBfY29udGV4dDIyWyJjYXRjaCJdKDcpO3JldHVybiBfY29udGV4dDIyLmFicnVwdCgicmV0dXJuIiwKCgogICAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiBSZXN1bHRUeXBlLmVycm9yLAogICAgICAgICAgICAgICAgICAgICAgICBlcnJvcjogX2NvbnRleHQyMi50MAogICAgICAgICAgICAgICAgICAgICAgfSk7Y2FzZSAxNDpyZXR1cm4gX2NvbnRleHQyMi5hYnJ1cHQoInJldHVybiIsCgoKCiAgICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6IFJlc3VsdFR5cGUuZGF0YSwKICAgICAgICAgICAgICAgICAgICAgICAgZGF0YTogcmVzdWx0LmRlZmVycmVkRGF0YS5kYXRhCiAgICAgICAgICAgICAgICAgICAgICB9KTtjYXNlIDE1OmNhc2UgImVuZCI6cmV0dXJuIF9jb250ZXh0MjIuc3RvcCgpO319fSwgX2NhbGxlZTIwLCBudWxsLCBbWzcsIDExXV0pO30pKTtyZXR1cm4gX3Jlc29sdmVEZWZlcnJlZERhdGEuYXBwbHkodGhpcywgYXJndW1lbnRzKTt9CgoKICAgICAgICAgIGZ1bmN0aW9uIGhhc05ha2VkSW5kZXhRdWVyeShzZWFyY2gpIHsKICAgICAgICAgICAgcmV0dXJuIG5ldyBVUkxTZWFyY2hQYXJhbXMoc2VhcmNoKS5nZXRBbGwoImluZGV4Iikuc29tZSgodikgPT4gdiA9PT0gIiIpOwogICAgICAgICAgfSAvLyBOb3RlOiBUaGlzIHNob3VsZCBtYXRjaCB0aGUgZm9ybWF0IGV4cG9ydGVkIGJ5IHVzZU1hdGNoZXMsIHNvIGlmIHlvdSBjaGFuZ2UKICAgICAgICAgIC8vIHRoaXMgcGxlYXNlIGFsc28gY2hhbmdlIHRoYXQgOikgIEV2ZW50dWFsbHkgd2UnbGwgRFJZIHRoaXMgdXAKCgogICAgICAgICAgZnVuY3Rpb24gY3JlYXRlVXNlTWF0Y2hlc01hdGNoKG1hdGNoLCBsb2FkZXJEYXRhKSB7CiAgICAgICAgICAgIHZhcgogICAgICAgICAgICAgIHJvdXRlID0KCgogICAgICAgICAgICAgIG1hdGNoLnJvdXRlLHBhdGhuYW1lID0gbWF0Y2gucGF0aG5hbWUscGFyYW1zID0gbWF0Y2gucGFyYW1zOwogICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgIGlkOiByb3V0ZS5pZCwKICAgICAgICAgICAgICBwYXRobmFtZTogcGF0aG5hbWUsCiAgICAgICAgICAgICAgcGFyYW1zOiBwYXJhbXMsCiAgICAgICAgICAgICAgZGF0YTogbG9hZGVyRGF0YVtyb3V0ZS5pZF0sCiAgICAgICAgICAgICAgaGFuZGxlOiByb3V0ZS5oYW5kbGUKICAgICAgICAgICAgfTsKICAgICAgICAgIH0KCiAgICAgICAgICBmdW5jdGlvbiBnZXRUYXJnZXRNYXRjaChtYXRjaGVzLCBsb2NhdGlvbikgewogICAgICAgICAgICB2YXIgc2VhcmNoID0gdHlwZW9mIGxvY2F0aW9uID09PSAic3RyaW5nIiA/IHBhcnNlUGF0aChsb2NhdGlvbikuc2VhcmNoIDogbG9jYXRpb24uc2VhcmNoOwoKICAgICAgICAgICAgaWYgKG1hdGNoZXNbbWF0Y2hlcy5sZW5ndGggLSAxXS5yb3V0ZS5pbmRleCAmJiBoYXNOYWtlZEluZGV4UXVlcnkoc2VhcmNoIHx8ICIiKSkgewogICAgICAgICAgICAgIC8vIFJldHVybiB0aGUgbGVhZiBpbmRleCByb3V0ZSB3aGVuIGluZGV4IGlzIHByZXNlbnQKICAgICAgICAgICAgICByZXR1cm4gbWF0Y2hlc1ttYXRjaGVzLmxlbmd0aCAtIDFdOwogICAgICAgICAgICB9IC8vIE90aGVyd2lzZSBncmFiIHRoZSBkZWVwZXN0ICJwYXRoIGNvbnRyaWJ1dGluZyIgbWF0Y2ggKGlnbm9yaW5nIGluZGV4IGFuZAogICAgICAgICAgICAvLyBwYXRobGVzcyBsYXlvdXQgcm91dGVzKQoKCiAgICAgICAgICAgIHZhciBwYXRoTWF0Y2hlcyA9IGdldFBhdGhDb250cmlidXRpbmdNYXRjaGVzKG1hdGNoZXMpOwogICAgICAgICAgICByZXR1cm4gcGF0aE1hdGNoZXNbcGF0aE1hdGNoZXMubGVuZ3RoIC0gMV07CiAgICAgICAgICB9IC8vI2VuZHJlZ2lvbgoKCgoKICAgICAgICAgIC8vIEVYVEVSTkFMIE1PRFVMRTogLi9ub2RlX21vZHVsZXMvcmVhY3QvaW5kZXguanMKICAgICAgICAgIHZhciByZWFjdCA9IF9fd2VicGFja19yZXF1aXJlX18oMjk0KTsKICAgICAgICAgIHZhciByZWFjdF9uYW1lc3BhY2VPYmplY3QgPSAvKiNfX1BVUkVfXyovX193ZWJwYWNrX3JlcXVpcmVfXy50KHJlYWN0LCAyKTsKICAgICAgICAgIDsgLy8gQ09OQ0FURU5BVEVEIE1PRFVMRTogLi9ub2RlX21vZHVsZXMvcmVhY3Qtcm91dGVyL2Rpc3QvaW5kZXguanMKICAgICAgICAgIC8qKgogICAgICAgICAgICogUmVhY3QgUm91dGVyIHY2LjQuMwogICAgICAgICAgICoKICAgICAgICAgICAqIENvcHlyaWdodCAoYykgUmVtaXggU29mdHdhcmUgSW5jLgogICAgICAgICAgICoKICAgICAgICAgICAqIFRoaXMgc291cmNlIGNvZGUgaXMgbGljZW5zZWQgdW5kZXIgdGhlIE1JVCBsaWNlbnNlIGZvdW5kIGluIHRoZQogICAgICAgICAgICogTElDRU5TRS5tZCBmaWxlIGluIHRoZSByb290IGRpcmVjdG9yeSBvZiB0aGlzIHNvdXJjZSB0cmVlLgogICAgICAgICAgICoKICAgICAgICAgICAqIEBsaWNlbnNlIE1JVAogICAgICAgICAgICovCgoKCgogICAgICAgICAgZnVuY3Rpb24gZGlzdF9leHRlbmRzKCkgewogICAgICAgICAgICBkaXN0X2V4dGVuZHMgPSBPYmplY3QuYXNzaWduID8gT2JqZWN0LmFzc2lnbi5iaW5kKCkgOiBmdW5jdGlvbiAodGFyZ2V0KSB7CiAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDE7IGkgPCBhcmd1bWVudHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICAgIHZhciBzb3VyY2UgPSBhcmd1bWVudHNbaV07CgogICAgICAgICAgICAgICAgZm9yICh2YXIga2V5IGluIHNvdXJjZSkgewogICAgICAgICAgICAgICAgICBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKHNvdXJjZSwga2V5KSkgewogICAgICAgICAgICAgICAgICAgIHRhcmdldFtrZXldID0gc291cmNlW2tleV07CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIHJldHVybiB0YXJnZXQ7CiAgICAgICAgICAgIH07CiAgICAgICAgICAgIHJldHVybiBkaXN0X2V4dGVuZHMuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgICAgIH0KCiAgICAgICAgICAvKioKICAgICAgICAgICAqIENvcHlyaWdodCAoYykgRmFjZWJvb2ssIEluYy4gYW5kIGl0cyBhZmZpbGlhdGVzLgogICAgICAgICAgICoKICAgICAgICAgICAqIFRoaXMgc291cmNlIGNvZGUgaXMgbGljZW5zZWQgdW5kZXIgdGhlIE1JVCBsaWNlbnNlIGZvdW5kIGluIHRoZQogICAgICAgICAgICogTElDRU5TRSBmaWxlIGluIHRoZSByb290IGRpcmVjdG9yeSBvZiB0aGlzIHNvdXJjZSB0cmVlLgogICAgICAgICAgICovCiAgICAgICAgICAvKioKICAgICAgICAgICAqIGlubGluZWQgT2JqZWN0LmlzIHBvbHlmaWxsIHRvIGF2b2lkIHJlcXVpcmluZyBjb25zdW1lcnMgc2hpcCB0aGVpciBvd24KICAgICAgICAgICAqIGh0dHBzOi8vZGV2ZWxvcGVyLm1vemlsbGEub3JnL2VuLVVTL2RvY3MvV2ViL0phdmFTY3JpcHQvUmVmZXJlbmNlL0dsb2JhbF9PYmplY3RzL09iamVjdC9pcwogICAgICAgICAgICovCgogICAgICAgICAgZnVuY3Rpb24gaXNQb2x5ZmlsbCh4LCB5KSB7CiAgICAgICAgICAgIHJldHVybiB4ID09PSB5ICYmICh4ICE9PSAwIHx8IDEgLyB4ID09PSAxIC8geSkgfHwgeCAhPT0geCAmJiB5ICE9PSB5IC8vIGVzbGludC1kaXNhYmxlLWxpbmUgbm8tc2VsZi1jb21wYXJlCiAgICAgICAgICAgIDsKICAgICAgICAgIH0KCiAgICAgICAgICB2YXIgaXMgPSB0eXBlb2YgT2JqZWN0LmlzID09PSAiZnVuY3Rpb24iID8gT2JqZWN0LmlzIDogaXNQb2x5ZmlsbDsgLy8gSW50ZW50aW9uYWxseSBub3QgdXNpbmcgbmFtZWQgaW1wb3J0cyBiZWNhdXNlIFJvbGx1cCB1c2VzIGR5bmFtaWMKICAgICAgICAgIC8vIGRpc3BhdGNoIGZvciBDb21tb25KUyBpbnRlcm9wIG5hbWVkIGltcG9ydHMuCgogICAgICAgICAgdmFyCiAgICAgICAgICAgIHVzZVN0YXRlID0KCgoKICAgICAgICAgICAgcmVhY3RfbmFtZXNwYWNlT2JqZWN0LnVzZVN0YXRlLHVzZUVmZmVjdCA9IHJlYWN0X25hbWVzcGFjZU9iamVjdC51c2VFZmZlY3QsdXNlTGF5b3V0RWZmZWN0ID0gcmVhY3RfbmFtZXNwYWNlT2JqZWN0LnVzZUxheW91dEVmZmVjdCx1c2VEZWJ1Z1ZhbHVlID0gcmVhY3RfbmFtZXNwYWNlT2JqZWN0LnVzZURlYnVnVmFsdWU7CiAgICAgICAgICB2YXIgZGlkV2Fybk9sZDE4QWxwaGEgPSBmYWxzZTsKICAgICAgICAgIHZhciBkaWRXYXJuVW5jYWNoZWRHZXRTbmFwc2hvdCA9IGZhbHNlOyAvLyBEaXNjbGFpbWVyOiBUaGlzIHNoaW0gYnJlYWtzIG1hbnkgb2YgdGhlIHJ1bGVzIG9mIFJlYWN0LCBhbmQgb25seSB3b3JrcwogICAgICAgICAgLy8gYmVjYXVzZSBvZiBhIHZlcnkgcGFydGljdWxhciBzZXQgb2YgaW1wbGVtZW50YXRpb24gZGV0YWlscyBhbmQgYXNzdW1wdGlvbnMKICAgICAgICAgIC8vIC0tIGNoYW5nZSBhbnkgb25lIG9mIHRoZW0gYW5kIGl0IHdpbGwgYnJlYWsuIFRoZSBtb3N0IGltcG9ydGFudCBhc3N1bXB0aW9uCiAgICAgICAgICAvLyBpcyB0aGF0IHVwZGF0ZXMgYXJlIGFsd2F5cyBzeW5jaHJvbm91cywgYmVjYXVzZSBjb25jdXJyZW50IHJlbmRlcmluZyBpcwogICAgICAgICAgLy8gb25seSBhdmFpbGFibGUgaW4gdmVyc2lvbnMgb2YgUmVhY3QgdGhhdCBhbHNvIGhhdmUgYSBidWlsdC1pbgogICAgICAgICAgLy8gdXNlU3luY0V4dGVybmFsU3RvcmUgQVBJLiBBbmQgd2Ugb25seSB1c2UgdGhpcyBzaGltIHdoZW4gdGhlIGJ1aWx0LWluIEFQSQogICAgICAgICAgLy8gZG9lcyBub3QgZXhpc3QuCiAgICAgICAgICAvLwogICAgICAgICAgLy8gRG8gbm90IGFzc3VtZSB0aGF0IHRoZSBjbGV2ZXIgaGFja3MgdXNlZCBieSB0aGlzIGhvb2sgYWxzbyB3b3JrIGluIGdlbmVyYWwuCiAgICAgICAgICAvLyBUaGUgcG9pbnQgb2YgdGhpcyBzaGltIGlzIHRvIHJlcGxhY2UgdGhlIG5lZWQgZm9yIGhhY2tzIGJ5IG90aGVyIGxpYnJhcmllcy4KCiAgICAgICAgICBmdW5jdGlvbiB1c2VTeW5jRXh0ZXJuYWxTdG9yZSQyKHN1YnNjcmliZSwgZ2V0U25hcHNob3QsIC8vIE5vdGU6IFRoZSBzaGltIGRvZXMgbm90IHVzZSBnZXRTZXJ2ZXJTbmFwc2hvdCwgYmVjYXVzZSBwcmUtMTggdmVyc2lvbnMgb2YKICAgICAgICAgIC8vIFJlYWN0IGRvIG5vdCBleHBvc2UgYSB3YXkgdG8gY2hlY2sgaWYgd2UncmUgaHlkcmF0aW5nLiBTbyB1c2VycyBvZiB0aGUgc2hpbQogICAgICAgICAgLy8gd2lsbCBuZWVkIHRvIHRyYWNrIHRoYXQgdGhlbXNlbHZlcyBhbmQgcmV0dXJuIHRoZSBjb3JyZWN0IHZhbHVlCiAgICAgICAgICAvLyBmcm9tIGBnZXRTbmFwc2hvdGAuCiAgICAgICAgICBnZXRTZXJ2ZXJTbmFwc2hvdCkgewogICAgICAgICAgICBpZiAoZmFsc2UpIHt9IC8vIFJlYWQgdGhlIGN1cnJlbnQgc25hcHNob3QgZnJvbSB0aGUgc3RvcmUgb24gZXZlcnkgcmVuZGVyLiBBZ2FpbiwgdGhpcwogICAgICAgICAgICAvLyBicmVha3MgdGhlIHJ1bGVzIG9mIFJlYWN0LCBhbmQgb25seSB3b3JrcyBoZXJlIGJlY2F1c2Ugb2Ygc3BlY2lmaWMKICAgICAgICAgICAgLy8gaW1wbGVtZW50YXRpb24gZGV0YWlscywgbW9zdCBpbXBvcnRhbnRseSB0aGF0IHVwZGF0ZXMgYXJlCiAgICAgICAgICAgIC8vIGFsd2F5cyBzeW5jaHJvbm91cy4KCgogICAgICAgICAgICB2YXIgdmFsdWUgPSBnZXRTbmFwc2hvdCgpOwoKICAgICAgICAgICAgaWYgKGZhbHNlKSB7fSAvLyBCZWNhdXNlIHVwZGF0ZXMgYXJlIHN5bmNocm9ub3VzLCB3ZSBkb24ndCBxdWV1ZSB0aGVtLiBJbnN0ZWFkIHdlIGZvcmNlIGEKICAgICAgICAgICAgLy8gcmUtcmVuZGVyIHdoZW5ldmVyIHRoZSBzdWJzY3JpYmVkIHN0YXRlIGNoYW5nZXMgYnkgdXBkYXRpbmcgYW4gc29tZQogICAgICAgICAgICAvLyBhcmJpdHJhcnkgdXNlU3RhdGUgaG9vay4gVGhlbiwgZHVyaW5nIHJlbmRlciwgd2UgY2FsbCBnZXRTbmFwc2hvdCB0byByZWFkCiAgICAgICAgICAgIC8vIHRoZSBjdXJyZW50IHZhbHVlLgogICAgICAgICAgICAvLwogICAgICAgICAgICAvLyBCZWNhdXNlIHdlIGRvbid0IGFjdHVhbGx5IHVzZSB0aGUgc3RhdGUgcmV0dXJuZWQgYnkgdGhlIHVzZVN0YXRlIGhvb2ssIHdlCiAgICAgICAgICAgIC8vIGNhbiBzYXZlIGEgYml0IG9mIG1lbW9yeSBieSBzdG9yaW5nIG90aGVyIHN0dWZmIGluIHRoYXQgc2xvdC4KICAgICAgICAgICAgLy8KICAgICAgICAgICAgLy8gVG8gaW1wbGVtZW50IHRoZSBlYXJseSBiYWlsb3V0LCB3ZSBuZWVkIHRvIHRyYWNrIHNvbWUgdGhpbmdzIG9uIGEgbXV0YWJsZQogICAgICAgICAgICAvLyBvYmplY3QuIFVzdWFsbHksIHdlIHdvdWxkIHB1dCB0aGF0IGluIGEgdXNlUmVmIGhvb2ssIGJ1dCB3ZSBjYW4gc3Rhc2ggaXQgaW4KICAgICAgICAgICAgLy8gb3VyIHVzZVN0YXRlIGhvb2sgaW5zdGVhZC4KICAgICAgICAgICAgLy8KICAgICAgICAgICAgLy8gVG8gZm9yY2UgYSByZS1yZW5kZXIsIHdlIGNhbGwgZm9yY2VVcGRhdGUoe2luc3R9KS4gVGhhdCB3b3JrcyBiZWNhdXNlIHRoZQogICAgICAgICAgICAvLyBuZXcgb2JqZWN0IGFsd2F5cyBmYWlscyBhbiBlcXVhbGl0eSBjaGVjay4KCgogICAgICAgICAgICB2YXIgX3VzZVN0YXRlMyA9CgogICAgICAgICAgICAgIHVzZVN0YXRlKHsKICAgICAgICAgICAgICAgIGluc3Q6IHsKICAgICAgICAgICAgICAgICAgdmFsdWU6IHZhbHVlLAogICAgICAgICAgICAgICAgICBnZXRTbmFwc2hvdDogZ2V0U25hcHNob3QKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9KSxfdXNlU3RhdGU0ID0gX3NsaWNlZFRvQXJyYXkyKF91c2VTdGF0ZTMsIDIpLGluc3QgPSBfdXNlU3RhdGU0WzBdLmluc3QsZm9yY2VVcGRhdGUgPSBfdXNlU3RhdGU0WzFdOyAvLyBUcmFjayB0aGUgbGF0ZXN0IGdldFNuYXBzaG90IGZ1bmN0aW9uIHdpdGggYSByZWYuIFRoaXMgbmVlZHMgdG8gYmUgdXBkYXRlZAogICAgICAgICAgICAvLyBpbiB0aGUgbGF5b3V0IHBoYXNlIHNvIHdlIGNhbiBhY2Nlc3MgaXQgZHVyaW5nIHRoZSB0ZWFyaW5nIGNoZWNrIHRoYXQKICAgICAgICAgICAgLy8gaGFwcGVucyBvbiBzdWJzY3JpYmUuCgogICAgICAgICAgICB1c2VMYXlvdXRFZmZlY3QoKCkgPT4gewogICAgICAgICAgICAgIGluc3QudmFsdWUgPSB2YWx1ZTsKICAgICAgICAgICAgICBpbnN0LmdldFNuYXBzaG90ID0gZ2V0U25hcHNob3Q7IC8vIFdoZW5ldmVyIGdldFNuYXBzaG90IG9yIHN1YnNjcmliZSBjaGFuZ2VzLCB3ZSBuZWVkIHRvIGNoZWNrIGluIHRoZQogICAgICAgICAgICAgIC8vIGNvbW1pdCBwaGFzZSBpZiB0aGVyZSB3YXMgYW4gaW50ZXJsZWF2ZWQgbXV0YXRpb24uIEluIGNvbmN1cnJlbnQgbW9kZQogICAgICAgICAgICAgIC8vIHRoaXMgY2FuIGhhcHBlbiBhbGwgdGhlIHRpbWUsIGJ1dCBldmVuIGluIHN5bmNocm9ub3VzIG1vZGUsIGFuIGVhcmxpZXIKICAgICAgICAgICAgICAvLyBlZmZlY3QgbWF5IGhhdmUgbXV0YXRlZCB0aGUgc3RvcmUuCgogICAgICAgICAgICAgIGlmIChjaGVja0lmU25hcHNob3RDaGFuZ2VkKGluc3QpKSB7CiAgICAgICAgICAgICAgICAvLyBGb3JjZSBhIHJlLXJlbmRlci4KICAgICAgICAgICAgICAgIGZvcmNlVXBkYXRlKHsKICAgICAgICAgICAgICAgICAgaW5zdDogaW5zdAogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgfSAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgcmVhY3QtaG9va3MvZXhoYXVzdGl2ZS1kZXBzCgogICAgICAgICAgICB9LCBbc3Vic2NyaWJlLCB2YWx1ZSwgZ2V0U25hcHNob3RdKTsKICAgICAgICAgICAgdXNlRWZmZWN0KCgpID0+IHsKICAgICAgICAgICAgICAvLyBDaGVjayBmb3IgY2hhbmdlcyByaWdodCBiZWZvcmUgc3Vic2NyaWJpbmcuIFN1YnNlcXVlbnQgY2hhbmdlcyB3aWxsIGJlCiAgICAgICAgICAgICAgLy8gZGV0ZWN0ZWQgaW4gdGhlIHN1YnNjcmlwdGlvbiBoYW5kbGVyLgogICAgICAgICAgICAgIGlmIChjaGVja0lmU25hcHNob3RDaGFuZ2VkKGluc3QpKSB7CiAgICAgICAgICAgICAgICAvLyBGb3JjZSBhIHJlLXJlbmRlci4KICAgICAgICAgICAgICAgIGZvcmNlVXBkYXRlKHsKICAgICAgICAgICAgICAgICAgaW5zdDogaW5zdAogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICB2YXIgaGFuZGxlU3RvcmVDaGFuZ2UgPSAoKSA9PiB7CiAgICAgICAgICAgICAgICAvLyBUT0RPOiBCZWNhdXNlIHRoZXJlIGlzIG5vIGNyb3NzLXJlbmRlcmVyIEFQSSBmb3IgYmF0Y2hpbmcgdXBkYXRlcywgaXQncwogICAgICAgICAgICAgICAgLy8gdXAgdG8gdGhlIGNvbnN1bWVyIG9mIHRoaXMgbGlicmFyeSB0byB3cmFwIHRoZWlyIHN1YnNjcmlwdGlvbiBldmVudAogICAgICAgICAgICAgICAgLy8gd2l0aCB1bnN0YWJsZV9iYXRjaGVkVXBkYXRlcy4gU2hvdWxkIHdlIHRyeSB0byBkZXRlY3Qgd2hlbiB0aGlzIGlzbid0CiAgICAgICAgICAgICAgICAvLyB0aGUgY2FzZSBhbmQgcHJpbnQgYSB3YXJuaW5nIGluIGRldmVsb3BtZW50PwogICAgICAgICAgICAgICAgLy8gVGhlIHN0b3JlIGNoYW5nZWQuIENoZWNrIGlmIHRoZSBzbmFwc2hvdCBjaGFuZ2VkIHNpbmNlIHRoZSBsYXN0IHRpbWUgd2UKICAgICAgICAgICAgICAgIC8vIHJlYWQgZnJvbSB0aGUgc3RvcmUuCiAgICAgICAgICAgICAgICBpZiAoY2hlY2tJZlNuYXBzaG90Q2hhbmdlZChpbnN0KSkgewogICAgICAgICAgICAgICAgICAvLyBGb3JjZSBhIHJlLXJlbmRlci4KICAgICAgICAgICAgICAgICAgZm9yY2VVcGRhdGUoewogICAgICAgICAgICAgICAgICAgIGluc3Q6IGluc3QKICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfTsgLy8gU3Vic2NyaWJlIHRvIHRoZSBzdG9yZSBhbmQgcmV0dXJuIGEgY2xlYW4tdXAgZnVuY3Rpb24uCgoKICAgICAgICAgICAgICByZXR1cm4gc3Vic2NyaWJlKGhhbmRsZVN0b3JlQ2hhbmdlKTsgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIHJlYWN0LWhvb2tzL2V4aGF1c3RpdmUtZGVwcwogICAgICAgICAgICB9LCBbc3Vic2NyaWJlXSk7CiAgICAgICAgICAgIHVzZURlYnVnVmFsdWUodmFsdWUpOwogICAgICAgICAgICByZXR1cm4gdmFsdWU7CiAgICAgICAgICB9CgogICAgICAgICAgZnVuY3Rpb24gY2hlY2tJZlNuYXBzaG90Q2hhbmdlZChpbnN0KSB7CiAgICAgICAgICAgIHZhciBsYXRlc3RHZXRTbmFwc2hvdCA9IGluc3QuZ2V0U25hcHNob3Q7CiAgICAgICAgICAgIHZhciBwcmV2VmFsdWUgPSBpbnN0LnZhbHVlOwoKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICB2YXIgbmV4dFZhbHVlID0gbGF0ZXN0R2V0U25hcHNob3QoKTsKICAgICAgICAgICAgICByZXR1cm4gIWlzKHByZXZWYWx1ZSwgbmV4dFZhbHVlKTsKICAgICAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgfQogICAgICAgICAgfQoKICAgICAgICAgIC8qKgogICAgICAgICAgICogQ29weXJpZ2h0IChjKSBGYWNlYm9vaywgSW5jLiBhbmQgaXRzIGFmZmlsaWF0ZXMuCiAgICAgICAgICAgKgogICAgICAgICAgICogVGhpcyBzb3VyY2UgY29kZSBpcyBsaWNlbnNlZCB1bmRlciB0aGUgTUlUIGxpY2Vuc2UgZm91bmQgaW4gdGhlCiAgICAgICAgICAgKiBMSUNFTlNFIGZpbGUgaW4gdGhlIHJvb3QgZGlyZWN0b3J5IG9mIHRoaXMgc291cmNlIHRyZWUuCiAgICAgICAgICAgKgogICAgICAgICAgICogQGZsb3cKICAgICAgICAgICAqLwogICAgICAgICAgZnVuY3Rpb24gdXNlU3luY0V4dGVybmFsU3RvcmUkMShzdWJzY3JpYmUsIGdldFNuYXBzaG90LCBnZXRTZXJ2ZXJTbmFwc2hvdCkgewogICAgICAgICAgICAvLyBOb3RlOiBUaGUgc2hpbSBkb2VzIG5vdCB1c2UgZ2V0U2VydmVyU25hcHNob3QsIGJlY2F1c2UgcHJlLTE4IHZlcnNpb25zIG9mCiAgICAgICAgICAgIC8vIFJlYWN0IGRvIG5vdCBleHBvc2UgYSB3YXkgdG8gY2hlY2sgaWYgd2UncmUgaHlkcmF0aW5nLiBTbyB1c2VycyBvZiB0aGUgc2hpbQogICAgICAgICAgICAvLyB3aWxsIG5lZWQgdG8gdHJhY2sgdGhhdCB0aGVtc2VsdmVzIGFuZCByZXR1cm4gdGhlIGNvcnJlY3QgdmFsdWUKICAgICAgICAgICAgLy8gZnJvbSBgZ2V0U25hcHNob3RgLgogICAgICAgICAgICByZXR1cm4gZ2V0U25hcHNob3QoKTsKICAgICAgICAgIH0KCiAgICAgICAgICAvKioKICAgICAgICAgICAqIElubGluZWQgaW50byB0aGUgcmVhY3Qtcm91dGVyIHJlcG8gc2luY2UgdXNlLXN5bmMtZXh0ZXJuYWwtc3RvcmUgZG9lcyBub3QKICAgICAgICAgICAqIHByb3ZpZGUgYSBVTUQtY29tcGF0aWJsZSBwYWNrYWdlLCBzbyB3ZSBuZWVkIHRoaXMgdG8gYmUgYWJsZSB0byBkaXN0cmlidXRlCiAgICAgICAgICAgKiBVTUQgcmVhY3Qtcm91dGVyIGJ1bmRsZXMKICAgICAgICAgICAqLwogICAgICAgICAgdmFyIGNhblVzZURPTSA9ICEhKHR5cGVvZiB3aW5kb3cgIT09ICJ1bmRlZmluZWQiICYmIHR5cGVvZiB3aW5kb3cuZG9jdW1lbnQgIT09ICJ1bmRlZmluZWQiICYmIHR5cGVvZiB3aW5kb3cuZG9jdW1lbnQuY3JlYXRlRWxlbWVudCAhPT0gInVuZGVmaW5lZCIpOwogICAgICAgICAgdmFyIGlzU2VydmVyRW52aXJvbm1lbnQgPSAhY2FuVXNlRE9NOwogICAgICAgICAgdmFyIHNoaW0gPSBpc1NlcnZlckVudmlyb25tZW50ID8gdXNlU3luY0V4dGVybmFsU3RvcmUkMSA6IHVzZVN5bmNFeHRlcm5hbFN0b3JlJDI7CiAgICAgICAgICB2YXIgdXNlU3luY0V4dGVybmFsU3RvcmUgPSB0cnVlID8gKChtb2R1bGUpID0+IG1vZHVsZS51c2VTeW5jRXh0ZXJuYWxTdG9yZSkocmVhY3RfbmFtZXNwYWNlT2JqZWN0KSA6IHNoaW07CgogICAgICAgICAgLy8gQ29udGV4dHMgZm9yIGRhdGEgcm91dGVycwogICAgICAgICAgdmFyIERhdGFTdGF0aWNSb3V0ZXJDb250ZXh0ID0gLyojX19QVVJFX18qL3JlYWN0LmNyZWF0ZUNvbnRleHQobnVsbCk7CgogICAgICAgICAgaWYgKGZhbHNlKSB7fQoKICAgICAgICAgIHZhciBEYXRhUm91dGVyQ29udGV4dCA9IC8qI19fUFVSRV9fKi9yZWFjdC5jcmVhdGVDb250ZXh0KG51bGwpOwoKICAgICAgICAgIGlmIChmYWxzZSkge30KCiAgICAgICAgICB2YXIgRGF0YVJvdXRlclN0YXRlQ29udGV4dCA9IC8qI19fUFVSRV9fKi9yZWFjdC5jcmVhdGVDb250ZXh0KG51bGwpOwoKICAgICAgICAgIGlmIChmYWxzZSkge30KCiAgICAgICAgICB2YXIgQXdhaXRDb250ZXh0ID0gLyojX19QVVJFX18qLyAvKiB1bnVzZWQgcHVyZSBleHByZXNzaW9uIG9yIHN1cGVyICovbnVsbCAmJiBSZWFjdC5jcmVhdGVDb250ZXh0KG51bGwpOwoKICAgICAgICAgIGlmIChmYWxzZSkge30KCiAgICAgICAgICB2YXIgTmF2aWdhdGlvbkNvbnRleHQgPSAvKiNfX1BVUkVfXyovcmVhY3QuY3JlYXRlQ29udGV4dChudWxsKTsKCiAgICAgICAgICBpZiAoZmFsc2UpIHt9CgogICAgICAgICAgdmFyIExvY2F0aW9uQ29udGV4dCA9IC8qI19fUFVSRV9fKi9yZWFjdC5jcmVhdGVDb250ZXh0KG51bGwpOwoKICAgICAgICAgIGlmIChmYWxzZSkge30KCiAgICAgICAgICB2YXIgUm91dGVDb250ZXh0ID0gLyojX19QVVJFX18qL3JlYWN0LmNyZWF0ZUNvbnRleHQoewogICAgICAgICAgICBvdXRsZXQ6IG51bGwsCiAgICAgICAgICAgIG1hdGNoZXM6IFtdCiAgICAgICAgICB9KTsKCiAgICAgICAgICBpZiAoZmFsc2UpIHt9CgogICAgICAgICAgdmFyIFJvdXRlRXJyb3JDb250ZXh0ID0gLyojX19QVVJFX18qL3JlYWN0LmNyZWF0ZUNvbnRleHQobnVsbCk7CgogICAgICAgICAgaWYgKGZhbHNlKSB7fQoKICAgICAgICAgIC8qKgogICAgICAgICAgICogUmV0dXJucyB0aGUgZnVsbCBocmVmIGZvciB0aGUgZ2l2ZW4gInRvIiB2YWx1ZS4gVGhpcyBpcyB1c2VmdWwgZm9yIGJ1aWxkaW5nCiAgICAgICAgICAgKiBjdXN0b20gbGlua3MgdGhhdCBhcmUgYWxzbyBhY2Nlc3NpYmxlIGFuZCBwcmVzZXJ2ZSByaWdodC1jbGljayBiZWhhdmlvci4KICAgICAgICAgICAqCiAgICAgICAgICAgKiBAc2VlIGh0dHBzOi8vcmVhY3Ryb3V0ZXIuY29tL2RvY3MvZW4vdjYvaG9va3MvdXNlLWhyZWYKICAgICAgICAgICAqLwoKICAgICAgICAgIGZ1bmN0aW9uIHVzZUhyZWYodG8sIF90ZW1wKSB7CiAgICAgICAgICAgIHZhciBfcmVmMjUgPQoKICAgICAgICAgICAgICBfdGVtcCA9PT0gdm9pZCAwID8ge30gOiBfdGVtcCxyZWxhdGl2ZSA9IF9yZWYyNS5yZWxhdGl2ZTsKICAgICAgICAgICAgIXVzZUluUm91dGVyQ29udGV4dCgpID8gZmFsc2UgPyAwIDogcm91dGVyX2ludmFyaWFudChmYWxzZSkgOiB2b2lkIDA7CiAgICAgICAgICAgIHZhciBfcmVhY3QkdXNlQ29udGV4dCA9CgoKICAgICAgICAgICAgICByZWFjdC51c2VDb250ZXh0KE5hdmlnYXRpb25Db250ZXh0KSxiYXNlbmFtZSA9IF9yZWFjdCR1c2VDb250ZXh0LmJhc2VuYW1lLG5hdmlnYXRvciA9IF9yZWFjdCR1c2VDb250ZXh0Lm5hdmlnYXRvcjsKICAgICAgICAgICAgdmFyIF9kaXN0X3VzZVJlc29sdmVkUGF0aCA9CgoKCiAgICAgICAgICAgICAgZGlzdF91c2VSZXNvbHZlZFBhdGgodG8sIHsKICAgICAgICAgICAgICAgIHJlbGF0aXZlOiByZWxhdGl2ZQogICAgICAgICAgICAgIH0pLGhhc2ggPSBfZGlzdF91c2VSZXNvbHZlZFBhdGguaGFzaCxwYXRobmFtZSA9IF9kaXN0X3VzZVJlc29sdmVkUGF0aC5wYXRobmFtZSxzZWFyY2ggPSBfZGlzdF91c2VSZXNvbHZlZFBhdGguc2VhcmNoOwogICAgICAgICAgICB2YXIgam9pbmVkUGF0aG5hbWUgPSBwYXRobmFtZTsgLy8gSWYgd2UncmUgb3BlcmF0aW5nIHdpdGhpbiBhIGJhc2VuYW1lLCBwcmVwZW5kIGl0IHRvIHRoZSBwYXRobmFtZSBwcmlvcgogICAgICAgICAgICAvLyB0byBjcmVhdGluZyB0aGUgaHJlZi4gIElmIHRoaXMgaXMgYSByb290IG5hdmlnYXRpb24sIHRoZW4ganVzdCB1c2UgdGhlIHJhdwogICAgICAgICAgICAvLyBiYXNlbmFtZSB3aGljaCBhbGxvd3MgdGhlIGJhc2VuYW1lIHRvIGhhdmUgZnVsbCBjb250cm9sIG92ZXIgdGhlIHByZXNlbmNlCiAgICAgICAgICAgIC8vIG9mIGEgdHJhaWxpbmcgc2xhc2ggb24gcm9vdCBsaW5rcwoKICAgICAgICAgICAgaWYgKGJhc2VuYW1lICE9PSAiLyIpIHsKICAgICAgICAgICAgICBqb2luZWRQYXRobmFtZSA9IHBhdGhuYW1lID09PSAiLyIgPyBiYXNlbmFtZSA6IHJvdXRlcl9qb2luUGF0aHMoW2Jhc2VuYW1lLCBwYXRobmFtZV0pOwogICAgICAgICAgICB9CgogICAgICAgICAgICByZXR1cm4gbmF2aWdhdG9yLmNyZWF0ZUhyZWYoewogICAgICAgICAgICAgIHBhdGhuYW1lOiBqb2luZWRQYXRobmFtZSwKICAgICAgICAgICAgICBzZWFyY2g6IHNlYXJjaCwKICAgICAgICAgICAgICBoYXNoOiBoYXNoCiAgICAgICAgICAgIH0pOwogICAgICAgICAgfQogICAgICAgICAgLyoqCiAgICAgICAgICAgKiBSZXR1cm5zIHRydWUgaWYgdGhpcyBjb21wb25lbnQgaXMgYSBkZXNjZW5kYW50IG9mIGEgPFJvdXRlcj4uCiAgICAgICAgICAgKgogICAgICAgICAgICogQHNlZSBodHRwczovL3JlYWN0cm91dGVyLmNvbS9kb2NzL2VuL3Y2L2hvb2tzL3VzZS1pbi1yb3V0ZXItY29udGV4dAogICAgICAgICAgICovCgogICAgICAgICAgZnVuY3Rpb24gdXNlSW5Sb3V0ZXJDb250ZXh0KCkgewogICAgICAgICAgICByZXR1cm4gcmVhY3QudXNlQ29udGV4dChMb2NhdGlvbkNvbnRleHQpICE9IG51bGw7CiAgICAgICAgICB9CiAgICAgICAgICAvKioKICAgICAgICAgICAqIFJldHVybnMgdGhlIGN1cnJlbnQgbG9jYXRpb24gb2JqZWN0LCB3aGljaCByZXByZXNlbnRzIHRoZSBjdXJyZW50IFVSTCBpbiB3ZWIKICAgICAgICAgICAqIGJyb3dzZXJzLgogICAgICAgICAgICoKICAgICAgICAgICAqIE5vdGU6IElmIHlvdSdyZSB1c2luZyB0aGlzIGl0IG1heSBtZWFuIHlvdSdyZSBkb2luZyBzb21lIG9mIHlvdXIgb3duCiAgICAgICAgICAgKiAicm91dGluZyIgaW4geW91ciBhcHAsIGFuZCB3ZSdkIGxpa2UgdG8ga25vdyB3aGF0IHlvdXIgdXNlIGNhc2UgaXMuIFdlIG1heQogICAgICAgICAgICogYmUgYWJsZSB0byBwcm92aWRlIHNvbWV0aGluZyBoaWdoZXItbGV2ZWwgdG8gYmV0dGVyIHN1aXQgeW91ciBuZWVkcy4KICAgICAgICAgICAqCiAgICAgICAgICAgKiBAc2VlIGh0dHBzOi8vcmVhY3Ryb3V0ZXIuY29tL2RvY3MvZW4vdjYvaG9va3MvdXNlLWxvY2F0aW9uCiAgICAgICAgICAgKi8KCiAgICAgICAgICBmdW5jdGlvbiBkaXN0X3VzZUxvY2F0aW9uKCkgewogICAgICAgICAgICAhdXNlSW5Sb3V0ZXJDb250ZXh0KCkgPyBmYWxzZSA/IDAgOiByb3V0ZXJfaW52YXJpYW50KGZhbHNlKSA6IHZvaWQgMDsKICAgICAgICAgICAgcmV0dXJuIHJlYWN0LnVzZUNvbnRleHQoTG9jYXRpb25Db250ZXh0KS5sb2NhdGlvbjsKICAgICAgICAgIH0KICAgICAgICAgIC8qKgogICAgICAgICAgICogUmV0dXJucyB0aGUgY3VycmVudCBuYXZpZ2F0aW9uIGFjdGlvbiB3aGljaCBkZXNjcmliZXMgaG93IHRoZSByb3V0ZXIgY2FtZSB0bwogICAgICAgICAgICogdGhlIGN1cnJlbnQgbG9jYXRpb24sIGVpdGhlciBieSBhIHBvcCwgcHVzaCwgb3IgcmVwbGFjZSBvbiB0aGUgaGlzdG9yeSBzdGFjay4KICAgICAgICAgICAqCiAgICAgICAgICAgKiBAc2VlIGh0dHBzOi8vcmVhY3Ryb3V0ZXIuY29tL2RvY3MvZW4vdjYvaG9va3MvdXNlLW5hdmlnYXRpb24tdHlwZQogICAgICAgICAgICovCgogICAgICAgICAgZnVuY3Rpb24gdXNlTmF2aWdhdGlvblR5cGUoKSB7CiAgICAgICAgICAgIHJldHVybiBSZWFjdC51c2VDb250ZXh0KExvY2F0aW9uQ29udGV4dCkubmF2aWdhdGlvblR5cGU7CiAgICAgICAgICB9CiAgICAgICAgICAvKioKICAgICAgICAgICAqIFJldHVybnMgdHJ1ZSBpZiB0aGUgVVJMIGZvciB0aGUgZ2l2ZW4gInRvIiB2YWx1ZSBtYXRjaGVzIHRoZSBjdXJyZW50IFVSTC4KICAgICAgICAgICAqIFRoaXMgaXMgdXNlZnVsIGZvciBjb21wb25lbnRzIHRoYXQgbmVlZCB0byBrbm93ICJhY3RpdmUiIHN0YXRlLCBlLmcuCiAgICAgICAgICAgKiA8TmF2TGluaz4uCiAgICAgICAgICAgKgogICAgICAgICAgICogQHNlZSBodHRwczovL3JlYWN0cm91dGVyLmNvbS9kb2NzL2VuL3Y2L2hvb2tzL3VzZS1tYXRjaAogICAgICAgICAgICovCgogICAgICAgICAgZnVuY3Rpb24gdXNlTWF0Y2gocGF0dGVybikgewogICAgICAgICAgICAhdXNlSW5Sb3V0ZXJDb250ZXh0KCkgPyBmYWxzZSA/IDAgOiBpbnZhcmlhbnQoZmFsc2UpIDogdm9pZCAwOwogICAgICAgICAgICB2YXIgX2Rpc3RfdXNlTG9jYXRpb24gPQoKICAgICAgICAgICAgICBkaXN0X3VzZUxvY2F0aW9uKCkscGF0aG5hbWUgPSBfZGlzdF91c2VMb2NhdGlvbi5wYXRobmFtZTsKICAgICAgICAgICAgcmV0dXJuIFJlYWN0LnVzZU1lbW8oKCkgPT4gbWF0Y2hQYXRoKHBhdHRlcm4sIHBhdGhuYW1lKSwgW3BhdGhuYW1lLCBwYXR0ZXJuXSk7CiAgICAgICAgICB9CiAgICAgICAgICAvKioKICAgICAgICAgICAqIFRoZSBpbnRlcmZhY2UgZm9yIHRoZSBuYXZpZ2F0ZSgpIGZ1bmN0aW9uIHJldHVybmVkIGZyb20gdXNlTmF2aWdhdGUoKS4KICAgICAgICAgICAqLwoKICAgICAgICAgIC8qKgogICAgICAgICAgICogUmV0dXJucyBhbiBpbXBlcmF0aXZlIG1ldGhvZCBmb3IgY2hhbmdpbmcgdGhlIGxvY2F0aW9uLiBVc2VkIGJ5IDxMaW5rPnMsIGJ1dAogICAgICAgICAgICogbWF5IGFsc28gYmUgdXNlZCBieSBvdGhlciBlbGVtZW50cyB0byBjaGFuZ2UgdGhlIGxvY2F0aW9uLgogICAgICAgICAgICoKICAgICAgICAgICAqIEBzZWUgaHR0cHM6Ly9yZWFjdHJvdXRlci5jb20vZG9jcy9lbi92Ni9ob29rcy91c2UtbmF2aWdhdGUKICAgICAgICAgICAqLwogICAgICAgICAgZnVuY3Rpb24gZGlzdF91c2VOYXZpZ2F0ZSgpIHsKICAgICAgICAgICAgIXVzZUluUm91dGVyQ29udGV4dCgpID8gZmFsc2UgPyAwIDogcm91dGVyX2ludmFyaWFudChmYWxzZSkgOiB2b2lkIDA7CiAgICAgICAgICAgIHZhciBfcmVhY3QkdXNlQ29udGV4dDIgPQoKCiAgICAgICAgICAgICAgcmVhY3QudXNlQ29udGV4dChOYXZpZ2F0aW9uQ29udGV4dCksYmFzZW5hbWUgPSBfcmVhY3QkdXNlQ29udGV4dDIuYmFzZW5hbWUsbmF2aWdhdG9yID0gX3JlYWN0JHVzZUNvbnRleHQyLm5hdmlnYXRvcjsKICAgICAgICAgICAgdmFyIF9yZWFjdCR1c2VDb250ZXh0MyA9CgogICAgICAgICAgICAgIHJlYWN0LnVzZUNvbnRleHQoUm91dGVDb250ZXh0KSxtYXRjaGVzID0gX3JlYWN0JHVzZUNvbnRleHQzLm1hdGNoZXM7CiAgICAgICAgICAgIHZhciBfZGlzdF91c2VMb2NhdGlvbjIgPQoKICAgICAgICAgICAgICBkaXN0X3VzZUxvY2F0aW9uKCksbG9jYXRpb25QYXRobmFtZSA9IF9kaXN0X3VzZUxvY2F0aW9uMi5wYXRobmFtZTsKICAgICAgICAgICAgdmFyIHJvdXRlUGF0aG5hbWVzSnNvbiA9IEpTT04uc3RyaW5naWZ5KGdldFBhdGhDb250cmlidXRpbmdNYXRjaGVzKG1hdGNoZXMpLm1hcCgobWF0Y2gpID0+IG1hdGNoLnBhdGhuYW1lQmFzZSkpOwogICAgICAgICAgICB2YXIgYWN0aXZlUmVmID0gcmVhY3QudXNlUmVmKGZhbHNlKTsKICAgICAgICAgICAgcmVhY3QudXNlRWZmZWN0KCgpID0+IHsKICAgICAgICAgICAgICBhY3RpdmVSZWYuY3VycmVudCA9IHRydWU7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICB2YXIgbmF2aWdhdGUgPSByZWFjdC51c2VDYWxsYmFjayhmdW5jdGlvbiAodG8sIG9wdGlvbnMpIHsKICAgICAgICAgICAgICBpZiAob3B0aW9ucyA9PT0gdm9pZCAwKSB7CiAgICAgICAgICAgICAgICBvcHRpb25zID0ge307CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBmYWxzZSA/IDAgOiB2b2lkIDA7CiAgICAgICAgICAgICAgaWYgKCFhY3RpdmVSZWYuY3VycmVudCkgcmV0dXJuOwoKICAgICAgICAgICAgICBpZiAodHlwZW9mIHRvID09PSAibnVtYmVyIikgewogICAgICAgICAgICAgICAgbmF2aWdhdG9yLmdvKHRvKTsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIHZhciBwYXRoID0gcmVzb2x2ZVRvKHRvLCBKU09OLnBhcnNlKHJvdXRlUGF0aG5hbWVzSnNvbiksIGxvY2F0aW9uUGF0aG5hbWUsIG9wdGlvbnMucmVsYXRpdmUgPT09ICJwYXRoIik7IC8vIElmIHdlJ3JlIG9wZXJhdGluZyB3aXRoaW4gYSBiYXNlbmFtZSwgcHJlcGVuZCBpdCB0byB0aGUgcGF0aG5hbWUgcHJpb3IKICAgICAgICAgICAgICAvLyB0byBoYW5kaW5nIG9mZiB0byBoaXN0b3J5LiAgSWYgdGhpcyBpcyBhIHJvb3QgbmF2aWdhdGlvbiwgdGhlbiB3ZQogICAgICAgICAgICAgIC8vIG5hdmlnYXRlIHRvIHRoZSByYXcgYmFzZW5hbWUgd2hpY2ggYWxsb3dzIHRoZSBiYXNlbmFtZSB0byBoYXZlIGZ1bGwKICAgICAgICAgICAgICAvLyBjb250cm9sIG92ZXIgdGhlIHByZXNlbmNlIG9mIGEgdHJhaWxpbmcgc2xhc2ggb24gcm9vdCBsaW5rcwoKICAgICAgICAgICAgICBpZiAoYmFzZW5hbWUgIT09ICIvIikgewogICAgICAgICAgICAgICAgcGF0aC5wYXRobmFtZSA9IHBhdGgucGF0aG5hbWUgPT09ICIvIiA/IGJhc2VuYW1lIDogcm91dGVyX2pvaW5QYXRocyhbYmFzZW5hbWUsIHBhdGgucGF0aG5hbWVdKTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICghIW9wdGlvbnMucmVwbGFjZSA/IG5hdmlnYXRvci5yZXBsYWNlIDogbmF2aWdhdG9yLnB1c2gpKHBhdGgsIG9wdGlvbnMuc3RhdGUsIG9wdGlvbnMpOwogICAgICAgICAgICB9LCBbYmFzZW5hbWUsIG5hdmlnYXRvciwgcm91dGVQYXRobmFtZXNKc29uLCBsb2NhdGlvblBhdGhuYW1lXSk7CiAgICAgICAgICAgIHJldHVybiBuYXZpZ2F0ZTsKICAgICAgICAgIH0KICAgICAgICAgIHZhciBPdXRsZXRDb250ZXh0ID0gLyojX19QVVJFX18qL3JlYWN0LmNyZWF0ZUNvbnRleHQobnVsbCk7CiAgICAgICAgICAvKioKICAgICAgICAgICAqIFJldHVybnMgdGhlIGNvbnRleHQgKGlmIHByb3ZpZGVkKSBmb3IgdGhlIGNoaWxkIHJvdXRlIGF0IHRoaXMgbGV2ZWwgb2YgdGhlIHJvdXRlCiAgICAgICAgICAgKiBoaWVyYXJjaHkuCiAgICAgICAgICAgKiBAc2VlIGh0dHBzOi8vcmVhY3Ryb3V0ZXIuY29tL2RvY3MvZW4vdjYvaG9va3MvdXNlLW91dGxldC1jb250ZXh0CiAgICAgICAgICAgKi8KCiAgICAgICAgICBmdW5jdGlvbiB1c2VPdXRsZXRDb250ZXh0KCkgewogICAgICAgICAgICByZXR1cm4gUmVhY3QudXNlQ29udGV4dChPdXRsZXRDb250ZXh0KTsKICAgICAgICAgIH0KICAgICAgICAgIC8qKgogICAgICAgICAgICogUmV0dXJucyB0aGUgZWxlbWVudCBmb3IgdGhlIGNoaWxkIHJvdXRlIGF0IHRoaXMgbGV2ZWwgb2YgdGhlIHJvdXRlCiAgICAgICAgICAgKiBoaWVyYXJjaHkuIFVzZWQgaW50ZXJuYWxseSBieSA8T3V0bGV0PiB0byByZW5kZXIgY2hpbGQgcm91dGVzLgogICAgICAgICAgICoKICAgICAgICAgICAqIEBzZWUgaHR0cHM6Ly9yZWFjdHJvdXRlci5jb20vZG9jcy9lbi92Ni9ob29rcy91c2Utb3V0bGV0CiAgICAgICAgICAgKi8KCiAgICAgICAgICBmdW5jdGlvbiB1c2VPdXRsZXQoY29udGV4dCkgewogICAgICAgICAgICB2YXIgb3V0bGV0ID0gcmVhY3QudXNlQ29udGV4dChSb3V0ZUNvbnRleHQpLm91dGxldDsKCiAgICAgICAgICAgIGlmIChvdXRsZXQpIHsKICAgICAgICAgICAgICByZXR1cm4gLyojX19QVVJFX18qL3JlYWN0LmNyZWF0ZUVsZW1lbnQoT3V0bGV0Q29udGV4dC5Qcm92aWRlciwgewogICAgICAgICAgICAgICAgdmFsdWU6IGNvbnRleHQKICAgICAgICAgICAgICB9LCBvdXRsZXQpOwogICAgICAgICAgICB9CgogICAgICAgICAgICByZXR1cm4gb3V0bGV0OwogICAgICAgICAgfQogICAgICAgICAgLyoqCiAgICAgICAgICAgKiBSZXR1cm5zIGFuIG9iamVjdCBvZiBrZXkvdmFsdWUgcGFpcnMgb2YgdGhlIGR5bmFtaWMgcGFyYW1zIGZyb20gdGhlIGN1cnJlbnQKICAgICAgICAgICAqIFVSTCB0aGF0IHdlcmUgbWF0Y2hlZCBieSB0aGUgcm91dGUgcGF0aC4KICAgICAgICAgICAqCiAgICAgICAgICAgKiBAc2VlIGh0dHBzOi8vcmVhY3Ryb3V0ZXIuY29tL2RvY3MvZW4vdjYvaG9va3MvdXNlLXBhcmFtcwogICAgICAgICAgICovCgogICAgICAgICAgZnVuY3Rpb24gdXNlUGFyYW1zKCkgewogICAgICAgICAgICB2YXIgX1JlYWN0JHVzZUNvbnRleHQgPQoKICAgICAgICAgICAgICBSZWFjdC51c2VDb250ZXh0KFJvdXRlQ29udGV4dCksbWF0Y2hlcyA9IF9SZWFjdCR1c2VDb250ZXh0Lm1hdGNoZXM7CiAgICAgICAgICAgIHZhciByb3V0ZU1hdGNoID0gbWF0Y2hlc1ttYXRjaGVzLmxlbmd0aCAtIDFdOwogICAgICAgICAgICByZXR1cm4gcm91dGVNYXRjaCA/IHJvdXRlTWF0Y2gucGFyYW1zIDoge307CiAgICAgICAgICB9CiAgICAgICAgICAvKioKICAgICAgICAgICAqIFJlc29sdmVzIHRoZSBwYXRobmFtZSBvZiB0aGUgZ2l2ZW4gYHRvYCB2YWx1ZSBhZ2FpbnN0IHRoZSBjdXJyZW50IGxvY2F0aW9uLgogICAgICAgICAgICoKICAgICAgICAgICAqIEBzZWUgaHR0cHM6Ly9yZWFjdHJvdXRlci5jb20vZG9jcy9lbi92Ni9ob29rcy91c2UtcmVzb2x2ZWQtcGF0aAogICAgICAgICAgICovCgogICAgICAgICAgZnVuY3Rpb24gZGlzdF91c2VSZXNvbHZlZFBhdGgodG8sIF90ZW1wMikgewogICAgICAgICAgICB2YXIgX3JlZjI2ID0KCiAgICAgICAgICAgICAgX3RlbXAyID09PSB2b2lkIDAgPyB7fSA6IF90ZW1wMixyZWxhdGl2ZSA9IF9yZWYyNi5yZWxhdGl2ZTsKICAgICAgICAgICAgdmFyIF9yZWFjdCR1c2VDb250ZXh0NCA9CgogICAgICAgICAgICAgIHJlYWN0LnVzZUNvbnRleHQoUm91dGVDb250ZXh0KSxtYXRjaGVzID0gX3JlYWN0JHVzZUNvbnRleHQ0Lm1hdGNoZXM7CiAgICAgICAgICAgIHZhciBfZGlzdF91c2VMb2NhdGlvbjMgPQoKICAgICAgICAgICAgICBkaXN0X3VzZUxvY2F0aW9uKCksbG9jYXRpb25QYXRobmFtZSA9IF9kaXN0X3VzZUxvY2F0aW9uMy5wYXRobmFtZTsKICAgICAgICAgICAgdmFyIHJvdXRlUGF0aG5hbWVzSnNvbiA9IEpTT04uc3RyaW5naWZ5KGdldFBhdGhDb250cmlidXRpbmdNYXRjaGVzKG1hdGNoZXMpLm1hcCgobWF0Y2gpID0+IG1hdGNoLnBhdGhuYW1lQmFzZSkpOwogICAgICAgICAgICByZXR1cm4gcmVhY3QudXNlTWVtbygoKSA9PiByZXNvbHZlVG8odG8sIEpTT04ucGFyc2Uocm91dGVQYXRobmFtZXNKc29uKSwgbG9jYXRpb25QYXRobmFtZSwgcmVsYXRpdmUgPT09ICJwYXRoIiksIFt0bywgcm91dGVQYXRobmFtZXNKc29uLCBsb2NhdGlvblBhdGhuYW1lLCByZWxhdGl2ZV0pOwogICAgICAgICAgfQogICAgICAgICAgLyoqCiAgICAgICAgICAgKiBSZXR1cm5zIHRoZSBlbGVtZW50IG9mIHRoZSByb3V0ZSB0aGF0IG1hdGNoZWQgdGhlIGN1cnJlbnQgbG9jYXRpb24sIHByZXBhcmVkCiAgICAgICAgICAgKiB3aXRoIHRoZSBjb3JyZWN0IGNvbnRleHQgdG8gcmVuZGVyIHRoZSByZW1haW5kZXIgb2YgdGhlIHJvdXRlIHRyZWUuIFJvdXRlCiAgICAgICAgICAgKiBlbGVtZW50cyBpbiB0aGUgdHJlZSBtdXN0IHJlbmRlciBhbiA8T3V0bGV0PiB0byByZW5kZXIgdGhlaXIgY2hpbGQgcm91dGUncwogICAgICAgICAgICogZWxlbWVudC4KICAgICAgICAgICAqCiAgICAgICAgICAgKiBAc2VlIGh0dHBzOi8vcmVhY3Ryb3V0ZXIuY29tL2RvY3MvZW4vdjYvaG9va3MvdXNlLXJvdXRlcwogICAgICAgICAgICovCgogICAgICAgICAgZnVuY3Rpb24gdXNlUm91dGVzKHJvdXRlcywgbG9jYXRpb25BcmcpIHsKICAgICAgICAgICAgIXVzZUluUm91dGVyQ29udGV4dCgpID8gZmFsc2UgPyAwIDogcm91dGVyX2ludmFyaWFudChmYWxzZSkgOiB2b2lkIDA7CiAgICAgICAgICAgIHZhciBkYXRhUm91dGVyU3RhdGVDb250ZXh0ID0gcmVhY3QudXNlQ29udGV4dChEYXRhUm91dGVyU3RhdGVDb250ZXh0KTsKICAgICAgICAgICAgdmFyIF9yZWFjdCR1c2VDb250ZXh0NSA9CgogICAgICAgICAgICAgIHJlYWN0LnVzZUNvbnRleHQoUm91dGVDb250ZXh0KSxwYXJlbnRNYXRjaGVzID0gX3JlYWN0JHVzZUNvbnRleHQ1Lm1hdGNoZXM7CiAgICAgICAgICAgIHZhciByb3V0ZU1hdGNoID0gcGFyZW50TWF0Y2hlc1twYXJlbnRNYXRjaGVzLmxlbmd0aCAtIDFdOwogICAgICAgICAgICB2YXIgcGFyZW50UGFyYW1zID0gcm91dGVNYXRjaCA/IHJvdXRlTWF0Y2gucGFyYW1zIDoge307CiAgICAgICAgICAgIHZhciBwYXJlbnRQYXRobmFtZSA9IHJvdXRlTWF0Y2ggPyByb3V0ZU1hdGNoLnBhdGhuYW1lIDogIi8iOwogICAgICAgICAgICB2YXIgcGFyZW50UGF0aG5hbWVCYXNlID0gcm91dGVNYXRjaCA/IHJvdXRlTWF0Y2gucGF0aG5hbWVCYXNlIDogIi8iOwogICAgICAgICAgICB2YXIgcGFyZW50Um91dGUgPSByb3V0ZU1hdGNoICYmIHJvdXRlTWF0Y2gucm91dGU7CgogICAgICAgICAgICBpZiAoZmFsc2UpIHt9CgogICAgICAgICAgICB2YXIgbG9jYXRpb25Gcm9tQ29udGV4dCA9IGRpc3RfdXNlTG9jYXRpb24oKTsKICAgICAgICAgICAgdmFyIGxvY2F0aW9uOwoKICAgICAgICAgICAgaWYgKGxvY2F0aW9uQXJnKSB7CiAgICAgICAgICAgICAgdmFyIF9wYXJzZWRMb2NhdGlvbkFyZyRwYTsKCiAgICAgICAgICAgICAgdmFyIHBhcnNlZExvY2F0aW9uQXJnID0gdHlwZW9mIGxvY2F0aW9uQXJnID09PSAic3RyaW5nIiA/IHBhcnNlUGF0aChsb2NhdGlvbkFyZykgOiBsb2NhdGlvbkFyZzsKICAgICAgICAgICAgICAhKHBhcmVudFBhdGhuYW1lQmFzZSA9PT0gIi8iIHx8ICgoX3BhcnNlZExvY2F0aW9uQXJnJHBhID0gcGFyc2VkTG9jYXRpb25BcmcucGF0aG5hbWUpID09IG51bGwgPyB2b2lkIDAgOiBfcGFyc2VkTG9jYXRpb25BcmckcGEuc3RhcnRzV2l0aChwYXJlbnRQYXRobmFtZUJhc2UpKSkgPyBmYWxzZSA/IDAgOiByb3V0ZXJfaW52YXJpYW50KGZhbHNlKSA6IHZvaWQgMDsKICAgICAgICAgICAgICBsb2NhdGlvbiA9IHBhcnNlZExvY2F0aW9uQXJnOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIGxvY2F0aW9uID0gbG9jYXRpb25Gcm9tQ29udGV4dDsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdmFyIHBhdGhuYW1lID0gbG9jYXRpb24ucGF0aG5hbWUgfHwgIi8iOwogICAgICAgICAgICB2YXIgcmVtYWluaW5nUGF0aG5hbWUgPSBwYXJlbnRQYXRobmFtZUJhc2UgPT09ICIvIiA/IHBhdGhuYW1lIDogcGF0aG5hbWUuc2xpY2UocGFyZW50UGF0aG5hbWVCYXNlLmxlbmd0aCkgfHwgIi8iOwogICAgICAgICAgICB2YXIgbWF0Y2hlcyA9IG1hdGNoUm91dGVzKHJvdXRlcywgewogICAgICAgICAgICAgIHBhdGhuYW1lOiByZW1haW5pbmdQYXRobmFtZQogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIGlmIChmYWxzZSkge30KCiAgICAgICAgICAgIHZhciByZW5kZXJlZE1hdGNoZXMgPSBfcmVuZGVyTWF0Y2hlcyhtYXRjaGVzICYmIG1hdGNoZXMubWFwKChtYXRjaCkgPT4gT2JqZWN0LmFzc2lnbih7fSwgbWF0Y2gsIHsKICAgICAgICAgICAgICBwYXJhbXM6IE9iamVjdC5hc3NpZ24oe30sIHBhcmVudFBhcmFtcywgbWF0Y2gucGFyYW1zKSwKICAgICAgICAgICAgICBwYXRobmFtZTogcm91dGVyX2pvaW5QYXRocyhbcGFyZW50UGF0aG5hbWVCYXNlLCBtYXRjaC5wYXRobmFtZV0pLAogICAgICAgICAgICAgIHBhdGhuYW1lQmFzZTogbWF0Y2gucGF0aG5hbWVCYXNlID09PSAiLyIgPyBwYXJlbnRQYXRobmFtZUJhc2UgOiByb3V0ZXJfam9pblBhdGhzKFtwYXJlbnRQYXRobmFtZUJhc2UsIG1hdGNoLnBhdGhuYW1lQmFzZV0pCiAgICAgICAgICAgIH0pKSwgcGFyZW50TWF0Y2hlcywgZGF0YVJvdXRlclN0YXRlQ29udGV4dCB8fCB1bmRlZmluZWQpOyAvLyBXaGVuIGEgdXNlciBwYXNzZXMgaW4gYSBgbG9jYXRpb25BcmdgLCB0aGUgYXNzb2NpYXRlZCByb3V0ZXMgbmVlZCB0bwogICAgICAgICAgICAvLyBiZSB3cmFwcGVkIGluIGEgbmV3IGBMb2NhdGlvbkNvbnRleHQuUHJvdmlkZXJgIGluIG9yZGVyIGZvciBgdXNlTG9jYXRpb25gCiAgICAgICAgICAgIC8vIHRvIHVzZSB0aGUgc2NvcGVkIGxvY2F0aW9uIGluc3RlYWQgb2YgdGhlIGdsb2JhbCBsb2NhdGlvbi4KCgogICAgICAgICAgICBpZiAobG9jYXRpb25BcmcgJiYgcmVuZGVyZWRNYXRjaGVzKSB7CiAgICAgICAgICAgICAgcmV0dXJuIC8qI19fUFVSRV9fKi9yZWFjdC5jcmVhdGVFbGVtZW50KExvY2F0aW9uQ29udGV4dC5Qcm92aWRlciwgewogICAgICAgICAgICAgICAgdmFsdWU6IHsKICAgICAgICAgICAgICAgICAgbG9jYXRpb246IGRpc3RfZXh0ZW5kcyh7CiAgICAgICAgICAgICAgICAgICAgcGF0aG5hbWU6ICIvIiwKICAgICAgICAgICAgICAgICAgICBzZWFyY2g6ICIiLAogICAgICAgICAgICAgICAgICAgIGhhc2g6ICIiLAogICAgICAgICAgICAgICAgICAgIHN0YXRlOiBudWxsLAogICAgICAgICAgICAgICAgICAgIGtleTogImRlZmF1bHQiCiAgICAgICAgICAgICAgICAgIH0sIGxvY2F0aW9uKSwKICAgICAgICAgICAgICAgICAgbmF2aWdhdGlvblR5cGU6IEFjdGlvbi5Qb3AKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9LCByZW5kZXJlZE1hdGNoZXMpOwogICAgICAgICAgICB9CgogICAgICAgICAgICByZXR1cm4gcmVuZGVyZWRNYXRjaGVzOwogICAgICAgICAgfQoKICAgICAgICAgIGZ1bmN0aW9uIERlZmF1bHRFcnJvckVsZW1lbnQoKSB7CiAgICAgICAgICAgIHZhciBlcnJvciA9IHVzZVJvdXRlRXJyb3IoKTsKICAgICAgICAgICAgdmFyIG1lc3NhZ2UgPSBpc1JvdXRlRXJyb3JSZXNwb25zZShlcnJvcikgPyBlcnJvci5zdGF0dXMgKyAiICIgKyBlcnJvci5zdGF0dXNUZXh0IDogZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiBKU09OLnN0cmluZ2lmeShlcnJvcik7CiAgICAgICAgICAgIHZhciBzdGFjayA9IGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5zdGFjayA6IG51bGw7CiAgICAgICAgICAgIHZhciBsaWdodGdyZXkgPSAicmdiYSgyMDAsMjAwLDIwMCwgMC41KSI7CiAgICAgICAgICAgIHZhciBwcmVTdHlsZXMgPSB7CiAgICAgICAgICAgICAgcGFkZGluZzogIjAuNXJlbSIsCiAgICAgICAgICAgICAgYmFja2dyb3VuZENvbG9yOiBsaWdodGdyZXkKICAgICAgICAgICAgfTsKICAgICAgICAgICAgdmFyIGNvZGVTdHlsZXMgPSB7CiAgICAgICAgICAgICAgcGFkZGluZzogIjJweCA0cHgiLAogICAgICAgICAgICAgIGJhY2tncm91bmRDb2xvcjogbGlnaHRncmV5CiAgICAgICAgICAgIH07CiAgICAgICAgICAgIHJldHVybiAvKiNfX1BVUkVfXyovcmVhY3QuY3JlYXRlRWxlbWVudChyZWFjdC5GcmFnbWVudCwgbnVsbCwgLyojX19QVVJFX18qL3JlYWN0LmNyZWF0ZUVsZW1lbnQoImgyIiwgbnVsbCwgIlVuaGFuZGxlZCBUaHJvd24gRXJyb3IhIiksIC8qI19fUFVSRV9fKi9yZWFjdC5jcmVhdGVFbGVtZW50KCJoMyIsIHsKICAgICAgICAgICAgICBzdHlsZTogewogICAgICAgICAgICAgICAgZm9udFN0eWxlOiAiaXRhbGljIgogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwgbWVzc2FnZSksIHN0YWNrID8gLyojX19QVVJFX18qL3JlYWN0LmNyZWF0ZUVsZW1lbnQoInByZSIsIHsKICAgICAgICAgICAgICBzdHlsZTogcHJlU3R5bGVzCiAgICAgICAgICAgIH0sIHN0YWNrKSA6IG51bGwsIC8qI19fUFVSRV9fKi9yZWFjdC5jcmVhdGVFbGVtZW50KCJwIiwgbnVsbCwgIlx1RDgzRFx1RENCRiBIZXkgZGV2ZWxvcGVyIFx1RDgzRFx1REM0QiIpLCAvKiNfX1BVUkVfXyovcmVhY3QuY3JlYXRlRWxlbWVudCgicCIsIG51bGwsICJZb3UgY2FuIHByb3ZpZGUgYSB3YXkgYmV0dGVyIFVYIHRoYW4gdGhpcyB3aGVuIHlvdXIgYXBwIHRocm93cyBlcnJvcnMgYnkgcHJvdmlkaW5nIHlvdXIgb3duXHhBMCIsIC8qI19fUFVSRV9fKi9yZWFjdC5jcmVhdGVFbGVtZW50KCJjb2RlIiwgewogICAgICAgICAgICAgIHN0eWxlOiBjb2RlU3R5bGVzCiAgICAgICAgICAgIH0sICJlcnJvckVsZW1lbnQiKSwgIiBwcm9wcyBvblx4QTAiLCAvKiNfX1BVUkVfXyovcmVhY3QuY3JlYXRlRWxlbWVudCgiY29kZSIsIHsKICAgICAgICAgICAgICBzdHlsZTogY29kZVN0eWxlcwogICAgICAgICAgICB9LCAiPFJvdXRlPiIpKSk7CiAgICAgICAgICB9dmFyCgogICAgICAgICAgUmVuZGVyRXJyb3JCb3VuZGFyeSA9IC8qI19fUFVSRV9fKi9mdW5jdGlvbiAoX3JlYWN0JENvbXBvbmVudCkge19pbmhlcml0cyhSZW5kZXJFcnJvckJvdW5kYXJ5LCBfcmVhY3QkQ29tcG9uZW50KTt2YXIgX3N1cGVyMiA9IF9jcmVhdGVTdXBlcihSZW5kZXJFcnJvckJvdW5kYXJ5KTsKICAgICAgICAgICAgZnVuY3Rpb24gUmVuZGVyRXJyb3JCb3VuZGFyeShwcm9wcykge3ZhciBfdGhpcztfY2xhc3NDYWxsQ2hlY2syKHRoaXMsIFJlbmRlckVycm9yQm91bmRhcnkpOwogICAgICAgICAgICAgIF90aGlzID0gX3N1cGVyMi5jYWxsKHRoaXMsIHByb3BzKTsKICAgICAgICAgICAgICBfdGhpcy5zdGF0ZSA9IHsKICAgICAgICAgICAgICAgIGxvY2F0aW9uOiBwcm9wcy5sb2NhdGlvbiwKICAgICAgICAgICAgICAgIGVycm9yOiBwcm9wcy5lcnJvcgogICAgICAgICAgICAgIH07cmV0dXJuIF90aGlzOwogICAgICAgICAgICB9X2NyZWF0ZUNsYXNzMihSZW5kZXJFcnJvckJvdW5kYXJ5LCBbeyBrZXk6ICJjb21wb25lbnREaWRDYXRjaCIsIHZhbHVlOgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgogICAgICAgICAgICAgIGZ1bmN0aW9uIGNvbXBvbmVudERpZENhdGNoKGVycm9yLCBlcnJvckluZm8pIHsKICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoIlJlYWN0IFJvdXRlciBjYXVnaHQgdGhlIGZvbGxvd2luZyBlcnJvciBkdXJpbmcgcmVuZGVyIiwgZXJyb3IsIGVycm9ySW5mbyk7CiAgICAgICAgICAgICAgfSB9LCB7IGtleTogInJlbmRlciIsIHZhbHVlOgoKICAgICAgICAgICAgICBmdW5jdGlvbiByZW5kZXIoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5zdGF0ZS5lcnJvciA/IC8qI19fUFVSRV9fKi9yZWFjdC5jcmVhdGVFbGVtZW50KFJvdXRlRXJyb3JDb250ZXh0LlByb3ZpZGVyLCB7CiAgICAgICAgICAgICAgICAgIHZhbHVlOiB0aGlzLnN0YXRlLmVycm9yLAogICAgICAgICAgICAgICAgICBjaGlsZHJlbjogdGhpcy5wcm9wcy5jb21wb25lbnQKICAgICAgICAgICAgICAgIH0pIDogdGhpcy5wcm9wcy5jaGlsZHJlbjsKICAgICAgICAgICAgICB9IH1dLCBbeyBrZXk6ICJnZXREZXJpdmVkU3RhdGVGcm9tRXJyb3IiLCB2YWx1ZTogZnVuY3Rpb24gZ2V0RGVyaXZlZFN0YXRlRnJvbUVycm9yKGVycm9yKSB7cmV0dXJuIHsgZXJyb3I6IGVycm9yIH07fSB9LCB7IGtleTogImdldERlcml2ZWRTdGF0ZUZyb21Qcm9wcyIsIHZhbHVlOiBmdW5jdGlvbiBnZXREZXJpdmVkU3RhdGVGcm9tUHJvcHMocHJvcHMsIHN0YXRlKSB7Ly8gV2hlbiB3ZSBnZXQgaW50byBhbiBlcnJvciBzdGF0ZSwgdGhlIHVzZXIgd2lsbCBsaWtlbHkgY2xpY2sgImJhY2siIHRvIHRoZQogICAgICAgICAgICAgICAgLy8gcHJldmlvdXMgcGFnZSB0aGF0IGRpZG4ndCBoYXZlIGFuIGVycm9yLiBCZWNhdXNlIHRoaXMgd3JhcHMgdGhlIGVudGlyZQogICAgICAgICAgICAgICAgLy8gYXBwbGljYXRpb24sIHRoYXQgd2lsbCBoYXZlIG5vIGVmZmVjdC0tdGhlIGVycm9yIHBhZ2UgY29udGludWVzIHRvIGRpc3BsYXkuCiAgICAgICAgICAgICAgICAvLyBUaGlzIGdpdmVzIHVzIGEgbWVjaGFuaXNtIHRvIHJlY292ZXIgZnJvbSB0aGUgZXJyb3Igd2hlbiB0aGUgbG9jYXRpb24gY2hhbmdlcy4KICAgICAgICAgICAgICAgIC8vCiAgICAgICAgICAgICAgICAvLyBXaGV0aGVyIHdlJ3JlIGluIGFuIGVycm9yIHN0YXRlIG9yIG5vdCwgd2UgdXBkYXRlIHRoZSBsb2NhdGlvbiBpbiBzdGF0ZQogICAgICAgICAgICAgICAgLy8gc28gdGhhdCB3aGVuIHdlIGFyZSBpbiBhbiBlcnJvciBzdGF0ZSwgaXQgZ2V0cyByZXNldCB3aGVuIGEgbmV3IGxvY2F0aW9uCiAgICAgICAgICAgICAgICAvLyBjb21lcyBpbiBhbmQgdGhlIHVzZXIgcmVjb3ZlcnMgZnJvbSB0aGUgZXJyb3IuCiAgICAgICAgICAgICAgICBpZiAoc3RhdGUubG9jYXRpb24gIT09IHByb3BzLmxvY2F0aW9uKSB7cmV0dXJuIHsgZXJyb3I6IHByb3BzLmVycm9yLCBsb2NhdGlvbjogcHJvcHMubG9jYXRpb24gfTt9IC8vIElmIHdlJ3JlIG5vdCBjaGFuZ2luZyBsb2NhdGlvbnMsIHByZXNlcnZlIHRoZSBsb2NhdGlvbiBidXQgc3RpbGwgc3VyZmFjZQogICAgICAgICAgICAgICAgLy8gYW55IG5ldyBlcnJvcnMgdGhhdCBtYXkgY29tZSB0aHJvdWdoLiBXZSByZXRhaW4gdGhlIGV4aXN0aW5nIGVycm9yLCB3ZSBkbwogICAgICAgICAgICAgICAgLy8gdGhpcyBiZWNhdXNlIHRoZSBlcnJvciBwcm92aWRlZCBmcm9tIHRoZSBhcHAgc3RhdGUgbWF5IGJlIGNsZWFyZWQgd2l0aG91dAogICAgICAgICAgICAgICAgLy8gdGhlIGxvY2F0aW9uIGNoYW5naW5nLgogICAgICAgICAgICAgICAgcmV0dXJuIHsgZXJyb3I6IHByb3BzLmVycm9yIHx8IHN0YXRlLmVycm9yLCBsb2NhdGlvbjogc3RhdGUubG9jYXRpb24gfTt9IH1dKTtyZXR1cm4gUmVuZGVyRXJyb3JCb3VuZGFyeTt9KHJlYWN0LkNvbXBvbmVudCk7ZnVuY3Rpb24gUmVuZGVyZWRSb3V0ZShfcmVmKSB7dmFyIHJvdXRlQ29udGV4dCA9IF9yZWYucm91dGVDb250ZXh0LG1hdGNoID0gX3JlZi5tYXRjaCxjaGlsZHJlbiA9IF9yZWYuY2hpbGRyZW47dmFyIGRhdGFTdGF0aWNSb3V0ZXJDb250ZXh0ID0gcmVhY3QudXNlQ29udGV4dChEYXRhU3RhdGljUm91dGVyQ29udGV4dCk7IC8vIFRyYWNrIGhvdyBkZWVwIHdlIGdvdCBpbiBvdXIgcmVuZGVyIHBhc3MgdG8gZW11bGF0ZSBTU1IgY29tcG9uZW50RGlkQ2F0Y2gKICAgICAgICAgICAgLy8gaW4gYSBEYXRhU3RhdGljUm91dGVyCiAgICAgICAgICAgIGlmIChkYXRhU3RhdGljUm91dGVyQ29udGV4dCAmJiBtYXRjaC5yb3V0ZS5lcnJvckVsZW1lbnQpIHtkYXRhU3RhdGljUm91dGVyQ29udGV4dC5fZGVlcGVzdFJlbmRlcmVkQm91bmRhcnlJZCA9IG1hdGNoLnJvdXRlLmlkOwogICAgICAgICAgICB9CgogICAgICAgICAgICByZXR1cm4gLyojX19QVVJFX18qL3JlYWN0LmNyZWF0ZUVsZW1lbnQoUm91dGVDb250ZXh0LlByb3ZpZGVyLCB7CiAgICAgICAgICAgICAgdmFsdWU6IHJvdXRlQ29udGV4dAogICAgICAgICAgICB9LCBjaGlsZHJlbik7CiAgICAgICAgICB9CgogICAgICAgICAgZnVuY3Rpb24gX3JlbmRlck1hdGNoZXMobWF0Y2hlcywgcGFyZW50TWF0Y2hlcywgZGF0YVJvdXRlclN0YXRlKSB7CiAgICAgICAgICAgIGlmIChwYXJlbnRNYXRjaGVzID09PSB2b2lkIDApIHsKICAgICAgICAgICAgICBwYXJlbnRNYXRjaGVzID0gW107CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChtYXRjaGVzID09IG51bGwpIHsKICAgICAgICAgICAgICBpZiAoZGF0YVJvdXRlclN0YXRlICE9IG51bGwgJiYgZGF0YVJvdXRlclN0YXRlLmVycm9ycykgewogICAgICAgICAgICAgICAgLy8gRG9uJ3QgYmFpbCBpZiB3ZSBoYXZlIGRhdGEgcm91dGVyIGVycm9ycyBzbyB3ZSBjYW4gcmVuZGVyIHRoZW0gaW4gdGhlCiAgICAgICAgICAgICAgICAvLyBib3VuZGFyeS4gIFVzZSB0aGUgcHJlLW1hdGNoZWQgKG9yIHNoaW1tZWQpIG1hdGNoZXMKICAgICAgICAgICAgICAgIG1hdGNoZXMgPSBkYXRhUm91dGVyU3RhdGUubWF0Y2hlczsKICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICB2YXIgcmVuZGVyZWRNYXRjaGVzID0gbWF0Y2hlczsgLy8gSWYgd2UgaGF2ZSBkYXRhIGVycm9ycywgdHJpbSBtYXRjaGVzIHRvIHRoZSBoaWdoZXN0IGVycm9yIGJvdW5kYXJ5CgogICAgICAgICAgICB2YXIgZXJyb3JzID0gZGF0YVJvdXRlclN0YXRlID09IG51bGwgPyB2b2lkIDAgOiBkYXRhUm91dGVyU3RhdGUuZXJyb3JzOwoKICAgICAgICAgICAgaWYgKGVycm9ycyAhPSBudWxsKSB7CiAgICAgICAgICAgICAgdmFyIGVycm9ySW5kZXggPSByZW5kZXJlZE1hdGNoZXMuZmluZEluZGV4KChtKSA9PiBtLnJvdXRlLmlkICYmIChlcnJvcnMgPT0gbnVsbCA/IHZvaWQgMCA6IGVycm9yc1ttLnJvdXRlLmlkXSkpOwogICAgICAgICAgICAgICEoZXJyb3JJbmRleCA+PSAwKSA/IGZhbHNlID8gMCA6IHJvdXRlcl9pbnZhcmlhbnQoZmFsc2UpIDogdm9pZCAwOwogICAgICAgICAgICAgIHJlbmRlcmVkTWF0Y2hlcyA9IHJlbmRlcmVkTWF0Y2hlcy5zbGljZSgwLCBNYXRoLm1pbihyZW5kZXJlZE1hdGNoZXMubGVuZ3RoLCBlcnJvckluZGV4ICsgMSkpOwogICAgICAgICAgICB9CgogICAgICAgICAgICByZXR1cm4gcmVuZGVyZWRNYXRjaGVzLnJlZHVjZVJpZ2h0KChvdXRsZXQsIG1hdGNoLCBpbmRleCkgPT4gewogICAgICAgICAgICAgIHZhciBlcnJvciA9IG1hdGNoLnJvdXRlLmlkID8gZXJyb3JzID09IG51bGwgPyB2b2lkIDAgOiBlcnJvcnNbbWF0Y2gucm91dGUuaWRdIDogbnVsbDsgLy8gT25seSBkYXRhIHJvdXRlcnMgaGFuZGxlIGVycm9ycwoKICAgICAgICAgICAgICB2YXIgZXJyb3JFbGVtZW50ID0gZGF0YVJvdXRlclN0YXRlID8gbWF0Y2gucm91dGUuZXJyb3JFbGVtZW50IHx8IC8qI19fUFVSRV9fKi9yZWFjdC5jcmVhdGVFbGVtZW50KERlZmF1bHRFcnJvckVsZW1lbnQsIG51bGwpIDogbnVsbDsKCiAgICAgICAgICAgICAgdmFyIGdldENoaWxkcmVuID0gKCkgPT4gLyojX19QVVJFX18qL3JlYWN0LmNyZWF0ZUVsZW1lbnQoUmVuZGVyZWRSb3V0ZSwgewogICAgICAgICAgICAgICAgbWF0Y2g6IG1hdGNoLAogICAgICAgICAgICAgICAgcm91dGVDb250ZXh0OiB7CiAgICAgICAgICAgICAgICAgIG91dGxldDogb3V0bGV0LAogICAgICAgICAgICAgICAgICBtYXRjaGVzOiBwYXJlbnRNYXRjaGVzLmNvbmNhdChyZW5kZXJlZE1hdGNoZXMuc2xpY2UoMCwgaW5kZXggKyAxKSkKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9LCBlcnJvciA/IGVycm9yRWxlbWVudCA6IG1hdGNoLnJvdXRlLmVsZW1lbnQgIT09IHVuZGVmaW5lZCA/IG1hdGNoLnJvdXRlLmVsZW1lbnQgOiBvdXRsZXQpOyAvLyBPbmx5IHdyYXAgaW4gYW4gZXJyb3IgYm91bmRhcnkgd2l0aGluIGRhdGEgcm91dGVyIHVzYWdlcyB3aGVuIHdlIGhhdmUgYW4KICAgICAgICAgICAgICAvLyBlcnJvckVsZW1lbnQgb24gdGhpcyByb3V0ZS4gIE90aGVyd2lzZSBsZXQgaXQgYnViYmxlIHVwIHRvIGFuIGFuY2VzdG9yCiAgICAgICAgICAgICAgLy8gZXJyb3JFbGVtZW50CgoKICAgICAgICAgICAgICByZXR1cm4gZGF0YVJvdXRlclN0YXRlICYmIChtYXRjaC5yb3V0ZS5lcnJvckVsZW1lbnQgfHwgaW5kZXggPT09IDApID8gLyojX19QVVJFX18qL3JlYWN0LmNyZWF0ZUVsZW1lbnQoUmVuZGVyRXJyb3JCb3VuZGFyeSwgewogICAgICAgICAgICAgICAgbG9jYXRpb246IGRhdGFSb3V0ZXJTdGF0ZS5sb2NhdGlvbiwKICAgICAgICAgICAgICAgIGNvbXBvbmVudDogZXJyb3JFbGVtZW50LAogICAgICAgICAgICAgICAgZXJyb3I6IGVycm9yLAogICAgICAgICAgICAgICAgY2hpbGRyZW46IGdldENoaWxkcmVuKCkKICAgICAgICAgICAgICB9KSA6IGdldENoaWxkcmVuKCk7CiAgICAgICAgICAgIH0sIG51bGwpOwogICAgICAgICAgfQogICAgICAgICAgdmFyIERhdGFSb3V0ZXJIb29rOwoKICAgICAgICAgIChmdW5jdGlvbiAoRGF0YVJvdXRlckhvb2spIHsKICAgICAgICAgICAgRGF0YVJvdXRlckhvb2tbIlVzZVJldmFsaWRhdG9yIl0gPSAidXNlUmV2YWxpZGF0b3IiOwogICAgICAgICAgfSkoRGF0YVJvdXRlckhvb2sgfHwgKERhdGFSb3V0ZXJIb29rID0ge30pKTsKCiAgICAgICAgICB2YXIgRGF0YVJvdXRlclN0YXRlSG9vazsKCiAgICAgICAgICAoZnVuY3Rpb24gKERhdGFSb3V0ZXJTdGF0ZUhvb2spIHsKICAgICAgICAgICAgRGF0YVJvdXRlclN0YXRlSG9va1siVXNlTG9hZGVyRGF0YSJdID0gInVzZUxvYWRlckRhdGEiOwogICAgICAgICAgICBEYXRhUm91dGVyU3RhdGVIb29rWyJVc2VBY3Rpb25EYXRhIl0gPSAidXNlQWN0aW9uRGF0YSI7CiAgICAgICAgICAgIERhdGFSb3V0ZXJTdGF0ZUhvb2tbIlVzZVJvdXRlRXJyb3IiXSA9ICJ1c2VSb3V0ZUVycm9yIjsKICAgICAgICAgICAgRGF0YVJvdXRlclN0YXRlSG9va1siVXNlTmF2aWdhdGlvbiJdID0gInVzZU5hdmlnYXRpb24iOwogICAgICAgICAgICBEYXRhUm91dGVyU3RhdGVIb29rWyJVc2VSb3V0ZUxvYWRlckRhdGEiXSA9ICJ1c2VSb3V0ZUxvYWRlckRhdGEiOwogICAgICAgICAgICBEYXRhUm91dGVyU3RhdGVIb29rWyJVc2VNYXRjaGVzIl0gPSAidXNlTWF0Y2hlcyI7CiAgICAgICAgICAgIERhdGFSb3V0ZXJTdGF0ZUhvb2tbIlVzZVJldmFsaWRhdG9yIl0gPSAidXNlUmV2YWxpZGF0b3IiOwogICAgICAgICAgfSkoRGF0YVJvdXRlclN0YXRlSG9vayB8fCAoRGF0YVJvdXRlclN0YXRlSG9vayA9IHt9KSk7CgogICAgICAgICAgZnVuY3Rpb24gZ2V0RGF0YVJvdXRlckNvbnNvbGVFcnJvcihob29rTmFtZSkgewogICAgICAgICAgICByZXR1cm4gaG9va05hbWUgKyAiIG11c3QgYmUgdXNlZCB3aXRoaW4gYSBkYXRhIHJvdXRlci4gIFNlZSBodHRwczovL3JlYWN0cm91dGVyLmNvbS9lbi9tYWluL3JvdXRlcnMvcGlja2luZy1hLXJvdXRlci4iOwogICAgICAgICAgfQoKICAgICAgICAgIGZ1bmN0aW9uIHVzZURhdGFSb3V0ZXJDb250ZXh0KGhvb2tOYW1lKSB7CiAgICAgICAgICAgIHZhciBjdHggPSBSZWFjdC51c2VDb250ZXh0KERhdGFSb3V0ZXJDb250ZXh0KTsKICAgICAgICAgICAgIWN0eCA/IGZhbHNlID8gMCA6IGludmFyaWFudChmYWxzZSkgOiB2b2lkIDA7CiAgICAgICAgICAgIHJldHVybiBjdHg7CiAgICAgICAgICB9CgogICAgICAgICAgZnVuY3Rpb24gdXNlRGF0YVJvdXRlclN0YXRlKGhvb2tOYW1lKSB7CiAgICAgICAgICAgIHZhciBzdGF0ZSA9IHJlYWN0LnVzZUNvbnRleHQoRGF0YVJvdXRlclN0YXRlQ29udGV4dCk7CiAgICAgICAgICAgICFzdGF0ZSA/IGZhbHNlID8gMCA6IHJvdXRlcl9pbnZhcmlhbnQoZmFsc2UpIDogdm9pZCAwOwogICAgICAgICAgICByZXR1cm4gc3RhdGU7CiAgICAgICAgICB9CiAgICAgICAgICAvKioKICAgICAgICAgICAqIFJldHVybnMgdGhlIGN1cnJlbnQgbmF2aWdhdGlvbiwgZGVmYXVsdGluZyB0byBhbiAiaWRsZSIgbmF2aWdhdGlvbiB3aGVuCiAgICAgICAgICAgKiBubyBuYXZpZ2F0aW9uIGlzIGluIHByb2dyZXNzCiAgICAgICAgICAgKi8KCgogICAgICAgICAgZnVuY3Rpb24gZGlzdF91c2VOYXZpZ2F0aW9uKCkgewogICAgICAgICAgICB2YXIgc3RhdGUgPSB1c2VEYXRhUm91dGVyU3RhdGUoRGF0YVJvdXRlclN0YXRlSG9vay5Vc2VOYXZpZ2F0aW9uKTsKICAgICAgICAgICAgcmV0dXJuIHN0YXRlLm5hdmlnYXRpb247CiAgICAgICAgICB9CiAgICAgICAgICAvKioKICAgICAgICAgICAqIFJldHVybnMgYSByZXZhbGlkYXRlIGZ1bmN0aW9uIGZvciBtYW51YWxseSB0cmlnZ2VyaW5nIHJldmFsaWRhdGlvbiwgYXMgd2VsbAogICAgICAgICAgICogYXMgdGhlIGN1cnJlbnQgc3RhdGUgb2YgYW55IG1hbnVhbCByZXZhbGlkYXRpb25zCiAgICAgICAgICAgKi8KCiAgICAgICAgICBmdW5jdGlvbiB1c2VSZXZhbGlkYXRvcigpIHsKICAgICAgICAgICAgdmFyIGRhdGFSb3V0ZXJDb250ZXh0ID0gdXNlRGF0YVJvdXRlckNvbnRleHQoRGF0YVJvdXRlckhvb2suVXNlUmV2YWxpZGF0b3IpOwogICAgICAgICAgICB2YXIgc3RhdGUgPSB1c2VEYXRhUm91dGVyU3RhdGUoRGF0YVJvdXRlclN0YXRlSG9vay5Vc2VSZXZhbGlkYXRvcik7CiAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgcmV2YWxpZGF0ZTogZGF0YVJvdXRlckNvbnRleHQucm91dGVyLnJldmFsaWRhdGUsCiAgICAgICAgICAgICAgc3RhdGU6IHN0YXRlLnJldmFsaWRhdGlvbgogICAgICAgICAgICB9OwogICAgICAgICAgfQogICAgICAgICAgLyoqCiAgICAgICAgICAgKiBSZXR1cm5zIHRoZSBhY3RpdmUgcm91dGUgbWF0Y2hlcywgdXNlZnVsIGZvciBhY2Nlc3NpbmcgbG9hZGVyRGF0YSBmb3IKICAgICAgICAgICAqIHBhcmVudC9jaGlsZCByb3V0ZXMgb3IgdGhlIHJvdXRlICJoYW5kbGUiIHByb3BlcnR5CiAgICAgICAgICAgKi8KCiAgICAgICAgICBmdW5jdGlvbiBkaXN0X3VzZU1hdGNoZXMoKSB7CiAgICAgICAgICAgIHZhciBfdXNlRGF0YVJvdXRlclN0YXRlID0KCgogICAgICAgICAgICAgIHVzZURhdGFSb3V0ZXJTdGF0ZShEYXRhUm91dGVyU3RhdGVIb29rLlVzZU1hdGNoZXMpLG1hdGNoZXMgPSBfdXNlRGF0YVJvdXRlclN0YXRlLm1hdGNoZXMsbG9hZGVyRGF0YSA9IF91c2VEYXRhUm91dGVyU3RhdGUubG9hZGVyRGF0YTsKICAgICAgICAgICAgcmV0dXJuIFJlYWN0LnVzZU1lbW8oKCkgPT4gbWF0Y2hlcy5tYXAoKG1hdGNoKSA9PiB7CiAgICAgICAgICAgICAgdmFyCiAgICAgICAgICAgICAgICBwYXRobmFtZSA9CgogICAgICAgICAgICAgICAgbWF0Y2gucGF0aG5hbWUscGFyYW1zID0gbWF0Y2gucGFyYW1zOyAvLyBOb3RlOiBUaGlzIHN0cnVjdHVyZSBtYXRjaGVzIHRoYXQgY3JlYXRlZCBieSBjcmVhdGVVc2VNYXRjaGVzTWF0Y2gKICAgICAgICAgICAgICAvLyBpbiB0aGUgQHJlbWl4LXJ1bi9yb3V0ZXIgLCBzbyBpZiB5b3UgY2hhbmdlIHRoaXMgcGxlYXNlIGFsc28gY2hhbmdlCiAgICAgICAgICAgICAgLy8gdGhhdCA6KSAgRXZlbnR1YWxseSB3ZSdsbCBEUlkgdGhpcyB1cAoKICAgICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgaWQ6IG1hdGNoLnJvdXRlLmlkLAogICAgICAgICAgICAgICAgcGF0aG5hbWU6IHBhdGhuYW1lLAogICAgICAgICAgICAgICAgcGFyYW1zOiBwYXJhbXMsCiAgICAgICAgICAgICAgICBkYXRhOiBsb2FkZXJEYXRhW21hdGNoLnJvdXRlLmlkXSwKICAgICAgICAgICAgICAgIGhhbmRsZTogbWF0Y2gucm91dGUuaGFuZGxlCiAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgfSksIFttYXRjaGVzLCBsb2FkZXJEYXRhXSk7CiAgICAgICAgICB9CiAgICAgICAgICAvKioKICAgICAgICAgICAqIFJldHVybnMgdGhlIGxvYWRlciBkYXRhIGZvciB0aGUgbmVhcmVzdCBhbmNlc3RvciBSb3V0ZSBsb2FkZXIKICAgICAgICAgICAqLwoKICAgICAgICAgIGZ1bmN0aW9uIHVzZUxvYWRlckRhdGEoKSB7CiAgICAgICAgICAgIHZhciBzdGF0ZSA9IHVzZURhdGFSb3V0ZXJTdGF0ZShEYXRhUm91dGVyU3RhdGVIb29rLlVzZUxvYWRlckRhdGEpOwogICAgICAgICAgICB2YXIgcm91dGUgPSBSZWFjdC51c2VDb250ZXh0KFJvdXRlQ29udGV4dCk7CiAgICAgICAgICAgICFyb3V0ZSA/IGZhbHNlID8gMCA6IGludmFyaWFudChmYWxzZSkgOiB2b2lkIDA7CiAgICAgICAgICAgIHZhciB0aGlzUm91dGUgPSByb3V0ZS5tYXRjaGVzW3JvdXRlLm1hdGNoZXMubGVuZ3RoIC0gMV07CiAgICAgICAgICAgICF0aGlzUm91dGUucm91dGUuaWQgPyBmYWxzZSA/IDAgOiBpbnZhcmlhbnQoZmFsc2UpIDogdm9pZCAwOwogICAgICAgICAgICByZXR1cm4gc3RhdGUubG9hZGVyRGF0YVt0aGlzUm91dGUucm91dGUuaWRdOwogICAgICAgICAgfQogICAgICAgICAgLyoqCiAgICAgICAgICAgKiBSZXR1cm5zIHRoZSBsb2FkZXJEYXRhIGZvciB0aGUgZ2l2ZW4gcm91dGVJZAogICAgICAgICAgICovCgogICAgICAgICAgZnVuY3Rpb24gdXNlUm91dGVMb2FkZXJEYXRhKHJvdXRlSWQpIHsKICAgICAgICAgICAgdmFyIHN0YXRlID0gdXNlRGF0YVJvdXRlclN0YXRlKERhdGFSb3V0ZXJTdGF0ZUhvb2suVXNlUm91dGVMb2FkZXJEYXRhKTsKICAgICAgICAgICAgcmV0dXJuIHN0YXRlLmxvYWRlckRhdGFbcm91dGVJZF07CiAgICAgICAgICB9CiAgICAgICAgICAvKioKICAgICAgICAgICAqIFJldHVybnMgdGhlIGFjdGlvbiBkYXRhIGZvciB0aGUgbmVhcmVzdCBhbmNlc3RvciBSb3V0ZSBhY3Rpb24KICAgICAgICAgICAqLwoKICAgICAgICAgIGZ1bmN0aW9uIHVzZUFjdGlvbkRhdGEoKSB7CiAgICAgICAgICAgIHZhciBzdGF0ZSA9IHVzZURhdGFSb3V0ZXJTdGF0ZShEYXRhUm91dGVyU3RhdGVIb29rLlVzZUFjdGlvbkRhdGEpOwogICAgICAgICAgICB2YXIgcm91dGUgPSBSZWFjdC51c2VDb250ZXh0KFJvdXRlQ29udGV4dCk7CiAgICAgICAgICAgICFyb3V0ZSA/IGZhbHNlID8gMCA6IGludmFyaWFudChmYWxzZSkgOiB2b2lkIDA7CiAgICAgICAgICAgIHJldHVybiBPYmplY3QudmFsdWVzKChzdGF0ZSA9PSBudWxsID8gdm9pZCAwIDogc3RhdGUuYWN0aW9uRGF0YSkgfHwge30pWzBdOwogICAgICAgICAgfQogICAgICAgICAgLyoqCiAgICAgICAgICAgKiBSZXR1cm5zIHRoZSBuZWFyZXN0IGFuY2VzdG9yIFJvdXRlIGVycm9yLCB3aGljaCBjb3VsZCBiZSBhIGxvYWRlci9hY3Rpb24KICAgICAgICAgICAqIGVycm9yIG9yIGEgcmVuZGVyIGVycm9yLiAgVGhpcyBpcyBpbnRlbmRlZCB0byBiZSBjYWxsZWQgZnJvbSB5b3VyCiAgICAgICAgICAgKiBlcnJvckVsZW1lbnQgdG8gZGlzcGxheSBhIHByb3BlciBlcnJvciBtZXNzYWdlLgogICAgICAgICAgICovCgogICAgICAgICAgZnVuY3Rpb24gdXNlUm91dGVFcnJvcigpIHsKICAgICAgICAgICAgdmFyIF9zdGF0ZSRlcnJvcnM7CgogICAgICAgICAgICB2YXIgZXJyb3IgPSByZWFjdC51c2VDb250ZXh0KFJvdXRlRXJyb3JDb250ZXh0KTsKICAgICAgICAgICAgdmFyIHN0YXRlID0gdXNlRGF0YVJvdXRlclN0YXRlKERhdGFSb3V0ZXJTdGF0ZUhvb2suVXNlUm91dGVFcnJvcik7CiAgICAgICAgICAgIHZhciByb3V0ZSA9IHJlYWN0LnVzZUNvbnRleHQoUm91dGVDb250ZXh0KTsKICAgICAgICAgICAgdmFyIHRoaXNSb3V0ZSA9IHJvdXRlLm1hdGNoZXNbcm91dGUubWF0Y2hlcy5sZW5ndGggLSAxXTsgLy8gSWYgdGhpcyB3YXMgYSByZW5kZXIgZXJyb3IsIHdlIHB1dCBpdCBpbiBhIFJvdXRlRXJyb3IgY29udGV4dCBpbnNpZGUKICAgICAgICAgICAgLy8gb2YgUmVuZGVyRXJyb3JCb3VuZGFyeQoKICAgICAgICAgICAgaWYgKGVycm9yKSB7CiAgICAgICAgICAgICAgcmV0dXJuIGVycm9yOwogICAgICAgICAgICB9CgogICAgICAgICAgICAhcm91dGUgPyBmYWxzZSA/IDAgOiByb3V0ZXJfaW52YXJpYW50KGZhbHNlKSA6IHZvaWQgMDsKICAgICAgICAgICAgIXRoaXNSb3V0ZS5yb3V0ZS5pZCA/IGZhbHNlID8gMCA6IHJvdXRlcl9pbnZhcmlhbnQoZmFsc2UpIDogdm9pZCAwOyAvLyBPdGhlcndpc2UgbG9vayBmb3IgZXJyb3JzIGZyb20gb3VyIGRhdGEgcm91dGVyIHN0YXRlCgogICAgICAgICAgICByZXR1cm4gKF9zdGF0ZSRlcnJvcnMgPSBzdGF0ZS5lcnJvcnMpID09IG51bGwgPyB2b2lkIDAgOiBfc3RhdGUkZXJyb3JzW3RoaXNSb3V0ZS5yb3V0ZS5pZF07CiAgICAgICAgICB9CiAgICAgICAgICAvKioKICAgICAgICAgICAqIFJldHVybnMgdGhlIGhhcHB5LXBhdGggZGF0YSBmcm9tIHRoZSBuZWFyZXN0IGFuY2VzdG9yIDxBd2FpdCAvPiB2YWx1ZQogICAgICAgICAgICovCgogICAgICAgICAgZnVuY3Rpb24gdXNlQXN5bmNWYWx1ZSgpIHsKICAgICAgICAgICAgdmFyIHZhbHVlID0gUmVhY3QudXNlQ29udGV4dChBd2FpdENvbnRleHQpOwogICAgICAgICAgICByZXR1cm4gdmFsdWUgPT0gbnVsbCA/IHZvaWQgMCA6IHZhbHVlLl9kYXRhOwogICAgICAgICAgfQogICAgICAgICAgLyoqCiAgICAgICAgICAgKiBSZXR1cm5zIHRoZSBlcnJvciBmcm9tIHRoZSBuZWFyZXN0IGFuY2VzdG9yIDxBd2FpdCAvPiB2YWx1ZQogICAgICAgICAgICovCgogICAgICAgICAgZnVuY3Rpb24gdXNlQXN5bmNFcnJvcigpIHsKICAgICAgICAgICAgdmFyIHZhbHVlID0gUmVhY3QudXNlQ29udGV4dChBd2FpdENvbnRleHQpOwogICAgICAgICAgICByZXR1cm4gdmFsdWUgPT0gbnVsbCA/IHZvaWQgMCA6IHZhbHVlLl9lcnJvcjsKICAgICAgICAgIH0KICAgICAgICAgIHZhciBhbHJlYWR5V2FybmVkID0ge307CgogICAgICAgICAgZnVuY3Rpb24gd2FybmluZ09uY2Uoa2V5LCBjb25kLCBtZXNzYWdlKSB7CiAgICAgICAgICAgIGlmICghY29uZCAmJiAhYWxyZWFkeVdhcm5lZFtrZXldKSB7CiAgICAgICAgICAgICAgYWxyZWFkeVdhcm5lZFtrZXldID0gdHJ1ZTsKICAgICAgICAgICAgICBmYWxzZSA/IDAgOiB2b2lkIDA7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KCiAgICAgICAgICAvKioKICAgICAgICAgICAqIEdpdmVuIGEgUmVtaXggUm91dGVyIGluc3RhbmNlLCByZW5kZXIgdGhlIGFwcHJvcHJpYXRlIFVJCiAgICAgICAgICAgKi8KICAgICAgICAgIGZ1bmN0aW9uIFJvdXRlclByb3ZpZGVyKF9yZWYpIHsKICAgICAgICAgICAgdmFyCiAgICAgICAgICAgICAgZmFsbGJhY2tFbGVtZW50ID0KCiAgICAgICAgICAgICAgX3JlZi5mYWxsYmFja0VsZW1lbnQscm91dGVyID0gX3JlZi5yb3V0ZXI7CiAgICAgICAgICAgIC8vIFN5bmMgcm91dGVyIHN0YXRlIHRvIG91ciBjb21wb25lbnQgc3RhdGUgdG8gZm9yY2UgcmUtcmVuZGVycwogICAgICAgICAgICB2YXIgc3RhdGUgPSB1c2VTeW5jRXh0ZXJuYWxTdG9yZShyb3V0ZXIuc3Vic2NyaWJlLCAoKSA9PiByb3V0ZXIuc3RhdGUsIC8vIFdlIGhhdmUgdG8gcHJvdmlkZSB0aGlzIHNvIFJlYWN0QDE4IGRvZXNuJ3QgY29tcGxhaW4gZHVyaW5nIGh5ZHJhdGlvbiwKICAgICAgICAgICAgLy8gYnV0IHdlIHBhc3Mgb3VyIHNlcmlhbGl6ZWQgaHlkcmF0aW9uIGRhdGEgaW50byB0aGUgcm91dGVyIHNvIHN0YXRlIGhlcmUKICAgICAgICAgICAgLy8gaXMgYWxyZWFkeSBzeW5jZWQgd2l0aCB3aGF0IHRoZSBzZXJ2ZXIgc2F3CiAgICAgICAgICAgICgpID0+IHJvdXRlci5zdGF0ZSk7CiAgICAgICAgICAgIHZhciBuYXZpZ2F0b3IgPSBSZWFjdC51c2VNZW1vKCgpID0+IHsKICAgICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgY3JlYXRlSHJlZjogcm91dGVyLmNyZWF0ZUhyZWYsCiAgICAgICAgICAgICAgICBnbzogKG4pID0+IHJvdXRlci5uYXZpZ2F0ZShuKSwKICAgICAgICAgICAgICAgIHB1c2g6ICh0bywgc3RhdGUsIG9wdHMpID0+IHJvdXRlci5uYXZpZ2F0ZSh0bywgewogICAgICAgICAgICAgICAgICBzdGF0ZTogc3RhdGUsCiAgICAgICAgICAgICAgICAgIHByZXZlbnRTY3JvbGxSZXNldDogb3B0cyA9PSBudWxsID8gdm9pZCAwIDogb3B0cy5wcmV2ZW50U2Nyb2xsUmVzZXQKICAgICAgICAgICAgICAgIH0pLAogICAgICAgICAgICAgICAgcmVwbGFjZTogKHRvLCBzdGF0ZSwgb3B0cykgPT4gcm91dGVyLm5hdmlnYXRlKHRvLCB7CiAgICAgICAgICAgICAgICAgIHJlcGxhY2U6IHRydWUsCiAgICAgICAgICAgICAgICAgIHN0YXRlOiBzdGF0ZSwKICAgICAgICAgICAgICAgICAgcHJldmVudFNjcm9sbFJlc2V0OiBvcHRzID09IG51bGwgPyB2b2lkIDAgOiBvcHRzLnByZXZlbnRTY3JvbGxSZXNldAogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICB9OwogICAgICAgICAgICB9LCBbcm91dGVyXSk7CiAgICAgICAgICAgIHZhciBiYXNlbmFtZSA9IHJvdXRlci5iYXNlbmFtZSB8fCAiLyI7CiAgICAgICAgICAgIHJldHVybiAvKiNfX1BVUkVfXyovUmVhY3QuY3JlYXRlRWxlbWVudChEYXRhUm91dGVyQ29udGV4dC5Qcm92aWRlciwgewogICAgICAgICAgICAgIHZhbHVlOiB7CiAgICAgICAgICAgICAgICByb3V0ZXI6IHJvdXRlciwKICAgICAgICAgICAgICAgIG5hdmlnYXRvcjogbmF2aWdhdG9yLAogICAgICAgICAgICAgICAgc3RhdGljOiBmYWxzZSwKICAgICAgICAgICAgICAgIC8vIERvIHdlIG5lZWQgdGhpcz8KICAgICAgICAgICAgICAgIGJhc2VuYW1lOiBiYXNlbmFtZQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwgLyojX19QVVJFX18qL1JlYWN0LmNyZWF0ZUVsZW1lbnQoRGF0YVJvdXRlclN0YXRlQ29udGV4dC5Qcm92aWRlciwgewogICAgICAgICAgICAgIHZhbHVlOiBzdGF0ZQogICAgICAgICAgICB9LCAvKiNfX1BVUkVfXyovUmVhY3QuY3JlYXRlRWxlbWVudChkaXN0X1JvdXRlciwgewogICAgICAgICAgICAgIGJhc2VuYW1lOiByb3V0ZXIuYmFzZW5hbWUsCiAgICAgICAgICAgICAgbG9jYXRpb246IHJvdXRlci5zdGF0ZS5sb2NhdGlvbiwKICAgICAgICAgICAgICBuYXZpZ2F0aW9uVHlwZTogcm91dGVyLnN0YXRlLmhpc3RvcnlBY3Rpb24sCiAgICAgICAgICAgICAgbmF2aWdhdG9yOiBuYXZpZ2F0b3IKICAgICAgICAgICAgfSwgcm91dGVyLnN0YXRlLmluaXRpYWxpemVkID8gLyojX19QVVJFX18qL1JlYWN0LmNyZWF0ZUVsZW1lbnQoUm91dGVzLCBudWxsKSA6IGZhbGxiYWNrRWxlbWVudCkpKTsKICAgICAgICAgIH0KCiAgICAgICAgICAvKioKICAgICAgICAgICAqIEEgPFJvdXRlcj4gdGhhdCBzdG9yZXMgYWxsIGVudHJpZXMgaW4gbWVtb3J5LgogICAgICAgICAgICoKICAgICAgICAgICAqIEBzZWUgaHR0cHM6Ly9yZWFjdHJvdXRlci5jb20vZG9jcy9lbi92Ni9yb3V0ZXJzL21lbW9yeS1yb3V0ZXIKICAgICAgICAgICAqLwogICAgICAgICAgZnVuY3Rpb24gTWVtb3J5Um91dGVyKF9yZWYyKSB7CiAgICAgICAgICAgIHZhcgogICAgICAgICAgICAgIGJhc2VuYW1lID0KCgoKICAgICAgICAgICAgICBfcmVmMi5iYXNlbmFtZSxjaGlsZHJlbiA9IF9yZWYyLmNoaWxkcmVuLGluaXRpYWxFbnRyaWVzID0gX3JlZjIuaW5pdGlhbEVudHJpZXMsaW5pdGlhbEluZGV4ID0gX3JlZjIuaW5pdGlhbEluZGV4OwogICAgICAgICAgICB2YXIgaGlzdG9yeVJlZiA9IHJlYWN0LnVzZVJlZigpOwoKICAgICAgICAgICAgaWYgKGhpc3RvcnlSZWYuY3VycmVudCA9PSBudWxsKSB7CiAgICAgICAgICAgICAgaGlzdG9yeVJlZi5jdXJyZW50ID0gcm91dGVyX2NyZWF0ZU1lbW9yeUhpc3RvcnkoewogICAgICAgICAgICAgICAgaW5pdGlhbEVudHJpZXM6IGluaXRpYWxFbnRyaWVzLAogICAgICAgICAgICAgICAgaW5pdGlhbEluZGV4OiBpbml0aWFsSW5kZXgsCiAgICAgICAgICAgICAgICB2NUNvbXBhdDogdHJ1ZQogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CgogICAgICAgICAgICB2YXIgaGlzdG9yeSA9IGhpc3RvcnlSZWYuY3VycmVudDsKICAgICAgICAgICAgdmFyIF9yZWFjdCR1c2VTdGF0ZSA9IHJlYWN0LnVzZVN0YXRlKHsKICAgICAgICAgICAgICAgIGFjdGlvbjogaGlzdG9yeS5hY3Rpb24sCiAgICAgICAgICAgICAgICBsb2NhdGlvbjogaGlzdG9yeS5sb2NhdGlvbgogICAgICAgICAgICAgIH0pLF9yZWFjdCR1c2VTdGF0ZTIgPSBfc2xpY2VkVG9BcnJheTIoX3JlYWN0JHVzZVN0YXRlLCAyKSxzdGF0ZSA9IF9yZWFjdCR1c2VTdGF0ZTJbMF0sc2V0U3RhdGUgPSBfcmVhY3QkdXNlU3RhdGUyWzFdOwogICAgICAgICAgICByZWFjdC51c2VMYXlvdXRFZmZlY3QoKCkgPT4gaGlzdG9yeS5saXN0ZW4oc2V0U3RhdGUpLCBbaGlzdG9yeV0pOwogICAgICAgICAgICByZXR1cm4gLyojX19QVVJFX18qL3JlYWN0LmNyZWF0ZUVsZW1lbnQoZGlzdF9Sb3V0ZXIsIHsKICAgICAgICAgICAgICBiYXNlbmFtZTogYmFzZW5hbWUsCiAgICAgICAgICAgICAgY2hpbGRyZW46IGNoaWxkcmVuLAogICAgICAgICAgICAgIGxvY2F0aW9uOiBzdGF0ZS5sb2NhdGlvbiwKICAgICAgICAgICAgICBuYXZpZ2F0aW9uVHlwZTogc3RhdGUuYWN0aW9uLAogICAgICAgICAgICAgIG5hdmlnYXRvcjogaGlzdG9yeQogICAgICAgICAgICB9KTsKICAgICAgICAgIH0KCiAgICAgICAgICAvKioKICAgICAgICAgICAqIENoYW5nZXMgdGhlIGN1cnJlbnQgbG9jYXRpb24uCiAgICAgICAgICAgKgogICAgICAgICAgICogTm90ZTogVGhpcyBBUEkgaXMgbW9zdGx5IHVzZWZ1bCBpbiBSZWFjdC5Db21wb25lbnQgc3ViY2xhc3NlcyB0aGF0IGFyZSBub3QKICAgICAgICAgICAqIGFibGUgdG8gdXNlIGhvb2tzLiBJbiBmdW5jdGlvbmFsIGNvbXBvbmVudHMsIHdlIHJlY29tbWVuZCB5b3UgdXNlIHRoZQogICAgICAgICAgICogYHVzZU5hdmlnYXRlYCBob29rIGluc3RlYWQuCiAgICAgICAgICAgKgogICAgICAgICAgICogQHNlZSBodHRwczovL3JlYWN0cm91dGVyLmNvbS9kb2NzL2VuL3Y2L2NvbXBvbmVudHMvbmF2aWdhdGUKICAgICAgICAgICAqLwogICAgICAgICAgZnVuY3Rpb24gTmF2aWdhdGUoX3JlZjMpIHsKICAgICAgICAgICAgdmFyCiAgICAgICAgICAgICAgdG8gPQoKCgogICAgICAgICAgICAgIF9yZWYzLnRvLHJlcGxhY2UgPSBfcmVmMy5yZXBsYWNlLHN0YXRlID0gX3JlZjMuc3RhdGUscmVsYXRpdmUgPSBfcmVmMy5yZWxhdGl2ZTsKICAgICAgICAgICAgIXVzZUluUm91dGVyQ29udGV4dCgpID8gZmFsc2UgPyAwIDogcm91dGVyX2ludmFyaWFudChmYWxzZSkgOiB2b2lkIDA7CiAgICAgICAgICAgIGZhbHNlID8gMCA6IHZvaWQgMDsKICAgICAgICAgICAgdmFyIGRhdGFSb3V0ZXJTdGF0ZSA9IHJlYWN0LnVzZUNvbnRleHQoRGF0YVJvdXRlclN0YXRlQ29udGV4dCk7CiAgICAgICAgICAgIHZhciBuYXZpZ2F0ZSA9IGRpc3RfdXNlTmF2aWdhdGUoKTsKICAgICAgICAgICAgcmVhY3QudXNlRWZmZWN0KCgpID0+IHsKICAgICAgICAgICAgICAvLyBBdm9pZCBraWNraW5nIG9mZiBtdWx0aXBsZSBuYXZpZ2F0aW9ucyBpZiB3ZSdyZSBpbiB0aGUgbWlkZGxlIG9mIGEKICAgICAgICAgICAgICAvLyBkYXRhLXJvdXRlciBuYXZpZ2F0aW9uLCBzaW5jZSBjb21wb25lbnRzIGdldCByZS1yZW5kZXJlZCB3aGVuIHdlIGVudGVyCiAgICAgICAgICAgICAgLy8gYSBzdWJtaXR0aW5nL2xvYWRpbmcgc3RhdGUKICAgICAgICAgICAgICBpZiAoZGF0YVJvdXRlclN0YXRlICYmIGRhdGFSb3V0ZXJTdGF0ZS5uYXZpZ2F0aW9uLnN0YXRlICE9PSAiaWRsZSIpIHsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIG5hdmlnYXRlKHRvLCB7CiAgICAgICAgICAgICAgICByZXBsYWNlOiByZXBsYWNlLAogICAgICAgICAgICAgICAgc3RhdGU6IHN0YXRlLAogICAgICAgICAgICAgICAgcmVsYXRpdmU6IHJlbGF0aXZlCiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICAgIH0KCiAgICAgICAgICAvKioKICAgICAgICAgICAqIFJlbmRlcnMgdGhlIGNoaWxkIHJvdXRlJ3MgZWxlbWVudCwgaWYgdGhlcmUgaXMgb25lLgogICAgICAgICAgICoKICAgICAgICAgICAqIEBzZWUgaHR0cHM6Ly9yZWFjdHJvdXRlci5jb20vZG9jcy9lbi92Ni9jb21wb25lbnRzL291dGxldAogICAgICAgICAgICovCiAgICAgICAgICBmdW5jdGlvbiBPdXRsZXQocHJvcHMpIHsKICAgICAgICAgICAgcmV0dXJuIHVzZU91dGxldChwcm9wcy5jb250ZXh0KTsKICAgICAgICAgIH0KCiAgICAgICAgICAvKioKICAgICAgICAgICAqIERlY2xhcmVzIGFuIGVsZW1lbnQgdGhhdCBzaG91bGQgYmUgcmVuZGVyZWQgYXQgYSBjZXJ0YWluIFVSTCBwYXRoLgogICAgICAgICAgICoKICAgICAgICAgICAqIEBzZWUgaHR0cHM6Ly9yZWFjdHJvdXRlci5jb20vZG9jcy9lbi92Ni9jb21wb25lbnRzL3JvdXRlCiAgICAgICAgICAgKi8KICAgICAgICAgIGZ1bmN0aW9uIFJvdXRlKF9wcm9wcykgewogICAgICAgICAgICBmYWxzZSA/IDAgOiByb3V0ZXJfaW52YXJpYW50KGZhbHNlKTsKICAgICAgICAgIH0KCiAgICAgICAgICAvKioKICAgICAgICAgICAqIFByb3ZpZGVzIGxvY2F0aW9uIGNvbnRleHQgZm9yIHRoZSByZXN0IG9mIHRoZSBhcHAuCiAgICAgICAgICAgKgogICAgICAgICAgICogTm90ZTogWW91IHVzdWFsbHkgd29uJ3QgcmVuZGVyIGEgPFJvdXRlcj4gZGlyZWN0bHkuIEluc3RlYWQsIHlvdSdsbCByZW5kZXIgYQogICAgICAgICAgICogcm91dGVyIHRoYXQgaXMgbW9yZSBzcGVjaWZpYyB0byB5b3VyIGVudmlyb25tZW50IHN1Y2ggYXMgYSA8QnJvd3NlclJvdXRlcj4KICAgICAgICAgICAqIGluIHdlYiBicm93c2VycyBvciBhIDxTdGF0aWNSb3V0ZXI+IGZvciBzZXJ2ZXIgcmVuZGVyaW5nLgogICAgICAgICAgICoKICAgICAgICAgICAqIEBzZWUgaHR0cHM6Ly9yZWFjdHJvdXRlci5jb20vZG9jcy9lbi92Ni9yb3V0ZXJzL3JvdXRlcgogICAgICAgICAgICovCiAgICAgICAgICBmdW5jdGlvbiBkaXN0X1JvdXRlcihfcmVmNCkgewogICAgICAgICAgICB2YXIgX3JlZjQkYmFzZW5hbWUgPQoKCgoKCgogICAgICAgICAgICAgIF9yZWY0LmJhc2VuYW1lLGJhc2VuYW1lUHJvcCA9IF9yZWY0JGJhc2VuYW1lID09PSB2b2lkIDAgPyAiLyIgOiBfcmVmNCRiYXNlbmFtZSxfcmVmNCRjaGlsZHJlbiA9IF9yZWY0LmNoaWxkcmVuLGNoaWxkcmVuID0gX3JlZjQkY2hpbGRyZW4gPT09IHZvaWQgMCA/IG51bGwgOiBfcmVmNCRjaGlsZHJlbixsb2NhdGlvblByb3AgPSBfcmVmNC5sb2NhdGlvbixfcmVmNCRuYXZpZ2F0aW9uVHlwZSA9IF9yZWY0Lm5hdmlnYXRpb25UeXBlLG5hdmlnYXRpb25UeXBlID0gX3JlZjQkbmF2aWdhdGlvblR5cGUgPT09IHZvaWQgMCA/IEFjdGlvbi5Qb3AgOiBfcmVmNCRuYXZpZ2F0aW9uVHlwZSxuYXZpZ2F0b3IgPSBfcmVmNC5uYXZpZ2F0b3IsX3JlZjQkc3RhdGljID0gX3JlZjQuc3RhdGljLHN0YXRpY1Byb3AgPSBfcmVmNCRzdGF0aWMgPT09IHZvaWQgMCA/IGZhbHNlIDogX3JlZjQkc3RhdGljOwogICAgICAgICAgICAhIXVzZUluUm91dGVyQ29udGV4dCgpID8gZmFsc2UgPyAwIDogcm91dGVyX2ludmFyaWFudChmYWxzZSkgOiB2b2lkIDA7IC8vIFByZXNlcnZlIHRyYWlsaW5nIHNsYXNoZXMgb24gYmFzZW5hbWUsIHNvIHdlIGNhbiBsZXQgdGhlIHVzZXIgY29udHJvbAogICAgICAgICAgICAvLyB0aGUgZW5mb3JjZW1lbnQgb2YgdHJhaWxpbmcgc2xhc2hlcyB0aHJvdWdob3V0IHRoZSBhcHAKCiAgICAgICAgICAgIHZhciBiYXNlbmFtZSA9IGJhc2VuYW1lUHJvcC5yZXBsYWNlKC9eXC8qLywgIi8iKTsKICAgICAgICAgICAgdmFyIG5hdmlnYXRpb25Db250ZXh0ID0gcmVhY3QudXNlTWVtbygoKSA9PiAoewogICAgICAgICAgICAgIGJhc2VuYW1lOiBiYXNlbmFtZSwKICAgICAgICAgICAgICBuYXZpZ2F0b3I6IG5hdmlnYXRvciwKICAgICAgICAgICAgICBzdGF0aWM6IHN0YXRpY1Byb3AKICAgICAgICAgICAgfSksIFtiYXNlbmFtZSwgbmF2aWdhdG9yLCBzdGF0aWNQcm9wXSk7CgogICAgICAgICAgICBpZiAodHlwZW9mIGxvY2F0aW9uUHJvcCA9PT0gInN0cmluZyIpIHsKICAgICAgICAgICAgICBsb2NhdGlvblByb3AgPSBwYXJzZVBhdGgobG9jYXRpb25Qcm9wKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdmFyIF9sb2NhdGlvblByb3AgPQoKCgoKCiAgICAgICAgICAgICAgbG9jYXRpb25Qcm9wLF9sb2NhdGlvblByb3AkcGF0aG5hbSA9IF9sb2NhdGlvblByb3AucGF0aG5hbWUscGF0aG5hbWUgPSBfbG9jYXRpb25Qcm9wJHBhdGhuYW0gPT09IHZvaWQgMCA/ICIvIiA6IF9sb2NhdGlvblByb3AkcGF0aG5hbSxfbG9jYXRpb25Qcm9wJHNlYXJjaCA9IF9sb2NhdGlvblByb3Auc2VhcmNoLHNlYXJjaCA9IF9sb2NhdGlvblByb3Akc2VhcmNoID09PSB2b2lkIDAgPyAiIiA6IF9sb2NhdGlvblByb3Akc2VhcmNoLF9sb2NhdGlvblByb3AkaGFzaCA9IF9sb2NhdGlvblByb3AuaGFzaCxoYXNoID0gX2xvY2F0aW9uUHJvcCRoYXNoID09PSB2b2lkIDAgPyAiIiA6IF9sb2NhdGlvblByb3AkaGFzaCxfbG9jYXRpb25Qcm9wJHN0YXRlID0gX2xvY2F0aW9uUHJvcC5zdGF0ZSxzdGF0ZSA9IF9sb2NhdGlvblByb3Akc3RhdGUgPT09IHZvaWQgMCA/IG51bGwgOiBfbG9jYXRpb25Qcm9wJHN0YXRlLF9sb2NhdGlvblByb3Aka2V5ID0gX2xvY2F0aW9uUHJvcC5rZXksa2V5ID0gX2xvY2F0aW9uUHJvcCRrZXkgPT09IHZvaWQgMCA/ICJkZWZhdWx0IiA6IF9sb2NhdGlvblByb3Aka2V5OwogICAgICAgICAgICB2YXIgbG9jYXRpb24gPSByZWFjdC51c2VNZW1vKCgpID0+IHsKICAgICAgICAgICAgICB2YXIgdHJhaWxpbmdQYXRobmFtZSA9IHN0cmlwQmFzZW5hbWUocGF0aG5hbWUsIGJhc2VuYW1lKTsKCiAgICAgICAgICAgICAgaWYgKHRyYWlsaW5nUGF0aG5hbWUgPT0gbnVsbCkgewogICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgcGF0aG5hbWU6IHRyYWlsaW5nUGF0aG5hbWUsCiAgICAgICAgICAgICAgICBzZWFyY2g6IHNlYXJjaCwKICAgICAgICAgICAgICAgIGhhc2g6IGhhc2gsCiAgICAgICAgICAgICAgICBzdGF0ZTogc3RhdGUsCiAgICAgICAgICAgICAgICBrZXk6IGtleQogICAgICAgICAgICAgIH07CiAgICAgICAgICAgIH0sIFtiYXNlbmFtZSwgcGF0aG5hbWUsIHNlYXJjaCwgaGFzaCwgc3RhdGUsIGtleV0pOwogICAgICAgICAgICBmYWxzZSA/IDAgOiB2b2lkIDA7CgogICAgICAgICAgICBpZiAobG9jYXRpb24gPT0gbnVsbCkgewogICAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgICAgICB9CgogICAgICAgICAgICByZXR1cm4gLyojX19QVVJFX18qL3JlYWN0LmNyZWF0ZUVsZW1lbnQoTmF2aWdhdGlvbkNvbnRleHQuUHJvdmlkZXIsIHsKICAgICAgICAgICAgICB2YWx1ZTogbmF2aWdhdGlvbkNvbnRleHQKICAgICAgICAgICAgfSwgLyojX19QVVJFX18qL3JlYWN0LmNyZWF0ZUVsZW1lbnQoTG9jYXRpb25Db250ZXh0LlByb3ZpZGVyLCB7CiAgICAgICAgICAgICAgY2hpbGRyZW46IGNoaWxkcmVuLAogICAgICAgICAgICAgIHZhbHVlOiB7CiAgICAgICAgICAgICAgICBsb2NhdGlvbjogbG9jYXRpb24sCiAgICAgICAgICAgICAgICBuYXZpZ2F0aW9uVHlwZTogbmF2aWdhdGlvblR5cGUKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pKTsKICAgICAgICAgIH0KCiAgICAgICAgICAvKioKICAgICAgICAgICAqIEEgY29udGFpbmVyIGZvciBhIG5lc3RlZCB0cmVlIG9mIDxSb3V0ZT4gZWxlbWVudHMgdGhhdCByZW5kZXJzIHRoZSBicmFuY2gKICAgICAgICAgICAqIHRoYXQgYmVzdCBtYXRjaGVzIHRoZSBjdXJyZW50IGxvY2F0aW9uLgogICAgICAgICAgICoKICAgICAgICAgICAqIEBzZWUgaHR0cHM6Ly9yZWFjdHJvdXRlci5jb20vZG9jcy9lbi92Ni9jb21wb25lbnRzL3JvdXRlcwogICAgICAgICAgICovCiAgICAgICAgICBmdW5jdGlvbiBSb3V0ZXMoX3JlZjUpIHsKICAgICAgICAgICAgdmFyCiAgICAgICAgICAgICAgY2hpbGRyZW4gPQoKICAgICAgICAgICAgICBfcmVmNS5jaGlsZHJlbixsb2NhdGlvbiA9IF9yZWY1LmxvY2F0aW9uOwogICAgICAgICAgICB2YXIgZGF0YVJvdXRlckNvbnRleHQgPSByZWFjdC51c2VDb250ZXh0KERhdGFSb3V0ZXJDb250ZXh0KTsgLy8gV2hlbiBpbiBhIERhdGFSb3V0ZXJDb250ZXh0IF93aXRob3V0XyBjaGlsZHJlbiwgd2UgdXNlIHRoZSByb3V0ZXIgcm91dGVzCiAgICAgICAgICAgIC8vIGRpcmVjdGx5LiAgSWYgd2UgaGF2ZSBjaGlsZHJlbiwgdGhlbiB3ZSdyZSBpbiBhIGRlc2NlbmRhbnQgdHJlZSBhbmQgd2UKICAgICAgICAgICAgLy8gbmVlZCB0byB1c2UgY2hpbGQgcm91dGVzLgoKICAgICAgICAgICAgdmFyIHJvdXRlcyA9IGRhdGFSb3V0ZXJDb250ZXh0ICYmICFjaGlsZHJlbiA/IGRhdGFSb3V0ZXJDb250ZXh0LnJvdXRlci5yb3V0ZXMgOiBjcmVhdGVSb3V0ZXNGcm9tQ2hpbGRyZW4oY2hpbGRyZW4pOwogICAgICAgICAgICByZXR1cm4gdXNlUm91dGVzKHJvdXRlcywgbG9jYXRpb24pOwogICAgICAgICAgfQoKICAgICAgICAgIC8qKgogICAgICAgICAgICogQ29tcG9uZW50IHRvIHVzZSBmb3IgcmVuZGVyaW5nIGxhemlseSBsb2FkZWQgZGF0YSBmcm9tIHJldHVybmluZyBkZWZlcigpCiAgICAgICAgICAgKiBpbiBhIGxvYWRlciBmdW5jdGlvbgogICAgICAgICAgICovCiAgICAgICAgICBmdW5jdGlvbiBBd2FpdChfcmVmNikgewogICAgICAgICAgICB2YXIKICAgICAgICAgICAgICBjaGlsZHJlbiA9CgoKICAgICAgICAgICAgICBfcmVmNi5jaGlsZHJlbixlcnJvckVsZW1lbnQgPSBfcmVmNi5lcnJvckVsZW1lbnQscmVzb2x2ZSA9IF9yZWY2LnJlc29sdmU7CiAgICAgICAgICAgIHJldHVybiAvKiNfX1BVUkVfXyovUmVhY3QuY3JlYXRlRWxlbWVudChBd2FpdEVycm9yQm91bmRhcnksIHsKICAgICAgICAgICAgICByZXNvbHZlOiByZXNvbHZlLAogICAgICAgICAgICAgIGVycm9yRWxlbWVudDogZXJyb3JFbGVtZW50CiAgICAgICAgICAgIH0sIC8qI19fUFVSRV9fKi9SZWFjdC5jcmVhdGVFbGVtZW50KFJlc29sdmVBd2FpdCwgbnVsbCwgY2hpbGRyZW4pKTsKICAgICAgICAgIH0KICAgICAgICAgIHZhciBBd2FpdFJlbmRlclN0YXR1czsKCiAgICAgICAgICAoZnVuY3Rpb24gKEF3YWl0UmVuZGVyU3RhdHVzKSB7CiAgICAgICAgICAgIEF3YWl0UmVuZGVyU3RhdHVzW0F3YWl0UmVuZGVyU3RhdHVzWyJwZW5kaW5nIl0gPSAwXSA9ICJwZW5kaW5nIjsKICAgICAgICAgICAgQXdhaXRSZW5kZXJTdGF0dXNbQXdhaXRSZW5kZXJTdGF0dXNbInN1Y2Nlc3MiXSA9IDFdID0gInN1Y2Nlc3MiOwogICAgICAgICAgICBBd2FpdFJlbmRlclN0YXR1c1tBd2FpdFJlbmRlclN0YXR1c1siZXJyb3IiXSA9IDJdID0gImVycm9yIjsKICAgICAgICAgIH0pKEF3YWl0UmVuZGVyU3RhdHVzIHx8IChBd2FpdFJlbmRlclN0YXR1cyA9IHt9KSk7CgogICAgICAgICAgdmFyIG5ldmVyU2V0dGxlZFByb21pc2UgPSBuZXcgUHJvbWlzZSgoKSA9PiB7fSk7dmFyCgogICAgICAgICAgQXdhaXRFcnJvckJvdW5kYXJ5ID0gLyojX19QVVJFX18qL2Z1bmN0aW9uIChfcmVhY3QkQ29tcG9uZW50Mikge19pbmhlcml0cyhBd2FpdEVycm9yQm91bmRhcnksIF9yZWFjdCRDb21wb25lbnQyKTt2YXIgX3N1cGVyMyA9IF9jcmVhdGVTdXBlcihBd2FpdEVycm9yQm91bmRhcnkpOwogICAgICAgICAgICBmdW5jdGlvbiBBd2FpdEVycm9yQm91bmRhcnkocHJvcHMpIHt2YXIgX3RoaXMyO19jbGFzc0NhbGxDaGVjazIodGhpcywgQXdhaXRFcnJvckJvdW5kYXJ5KTsKICAgICAgICAgICAgICBfdGhpczIgPSBfc3VwZXIzLmNhbGwodGhpcywgcHJvcHMpOwogICAgICAgICAgICAgIF90aGlzMi5zdGF0ZSA9IHsKICAgICAgICAgICAgICAgIGVycm9yOiBudWxsCiAgICAgICAgICAgICAgfTtyZXR1cm4gX3RoaXMyOwogICAgICAgICAgICB9X2NyZWF0ZUNsYXNzMihBd2FpdEVycm9yQm91bmRhcnksIFt7IGtleTogImNvbXBvbmVudERpZENhdGNoIiwgdmFsdWU6CgoKCgoKCgogICAgICAgICAgICAgIGZ1bmN0aW9uIGNvbXBvbmVudERpZENhdGNoKGVycm9yLCBlcnJvckluZm8pIHsKICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoIjxBd2FpdD4gY2F1Z2h0IHRoZSBmb2xsb3dpbmcgZXJyb3IgZHVyaW5nIHJlbmRlciIsIGVycm9yLCBlcnJvckluZm8pOwogICAgICAgICAgICAgIH0gfSwgeyBrZXk6ICJyZW5kZXIiLCB2YWx1ZToKCiAgICAgICAgICAgICAgZnVuY3Rpb24gcmVuZGVyKCkgewogICAgICAgICAgICAgICAgdmFyIF90aGlzJHByb3BzID0KCgoKICAgICAgICAgICAgICAgICAgdGhpcy5wcm9wcyxjaGlsZHJlbiA9IF90aGlzJHByb3BzLmNoaWxkcmVuLGVycm9yRWxlbWVudCA9IF90aGlzJHByb3BzLmVycm9yRWxlbWVudCxyZXNvbHZlID0gX3RoaXMkcHJvcHMucmVzb2x2ZTsKICAgICAgICAgICAgICAgIHZhciBwcm9taXNlID0gbnVsbDsKICAgICAgICAgICAgICAgIHZhciBzdGF0dXMgPSBBd2FpdFJlbmRlclN0YXR1cy5wZW5kaW5nOwoKICAgICAgICAgICAgICAgIGlmICghKHJlc29sdmUgaW5zdGFuY2VvZiBQcm9taXNlKSkgewogICAgICAgICAgICAgICAgICAvLyBEaWRuJ3QgZ2V0IGEgcHJvbWlzZSAtIHByb3ZpZGUgYXMgYSByZXNvbHZlZCBwcm9taXNlCiAgICAgICAgICAgICAgICAgIHN0YXR1cyA9IEF3YWl0UmVuZGVyU3RhdHVzLnN1Y2Nlc3M7CiAgICAgICAgICAgICAgICAgIHByb21pc2UgPSBQcm9taXNlLnJlc29sdmUoKTsKICAgICAgICAgICAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHByb21pc2UsICJfdHJhY2tlZCIsIHsKICAgICAgICAgICAgICAgICAgICBnZXQ6ICgpID0+IHRydWUKICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShwcm9taXNlLCAiX2RhdGEiLCB7CiAgICAgICAgICAgICAgICAgICAgZ2V0OiAoKSA9PiByZXNvbHZlCiAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfSBlbHNlIGlmICh0aGlzLnN0YXRlLmVycm9yKSB7CiAgICAgICAgICAgICAgICAgIC8vIENhdWdodCBhIHJlbmRlciBlcnJvciwgcHJvdmlkZSBpdCBhcyBhIHJlamVjdGVkIHByb21pc2UKICAgICAgICAgICAgICAgICAgc3RhdHVzID0gQXdhaXRSZW5kZXJTdGF0dXMuZXJyb3I7CiAgICAgICAgICAgICAgICAgIHZhciByZW5kZXJFcnJvciA9IHRoaXMuc3RhdGUuZXJyb3I7CiAgICAgICAgICAgICAgICAgIHByb21pc2UgPSBQcm9taXNlLnJlamVjdCgpLmNhdGNoKCgpID0+IHt9KTsgLy8gQXZvaWQgdW5oYW5kbGVkIHJlamVjdGlvbiB3YXJuaW5ncwoKICAgICAgICAgICAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHByb21pc2UsICJfdHJhY2tlZCIsIHsKICAgICAgICAgICAgICAgICAgICBnZXQ6ICgpID0+IHRydWUKICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShwcm9taXNlLCAiX2Vycm9yIiwgewogICAgICAgICAgICAgICAgICAgIGdldDogKCkgPT4gcmVuZGVyRXJyb3IKICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHJlc29sdmUuX3RyYWNrZWQpIHsKICAgICAgICAgICAgICAgICAgLy8gQWxyZWFkeSB0cmFja2VkIHByb21pc2UgLSBjaGVjayBjb250ZW50cwogICAgICAgICAgICAgICAgICBwcm9taXNlID0gcmVzb2x2ZTsKICAgICAgICAgICAgICAgICAgc3RhdHVzID0gcHJvbWlzZS5fZXJyb3IgIT09IHVuZGVmaW5lZCA/IEF3YWl0UmVuZGVyU3RhdHVzLmVycm9yIDogcHJvbWlzZS5fZGF0YSAhPT0gdW5kZWZpbmVkID8gQXdhaXRSZW5kZXJTdGF0dXMuc3VjY2VzcyA6IEF3YWl0UmVuZGVyU3RhdHVzLnBlbmRpbmc7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAvLyBSYXcgKHVudHJhY2tlZCkgcHJvbWlzZSAtIHRyYWNrIGl0CiAgICAgICAgICAgICAgICAgIHN0YXR1cyA9IEF3YWl0UmVuZGVyU3RhdHVzLnBlbmRpbmc7CiAgICAgICAgICAgICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShyZXNvbHZlLCAiX3RyYWNrZWQiLCB7CiAgICAgICAgICAgICAgICAgICAgZ2V0OiAoKSA9PiB0cnVlCiAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICBwcm9taXNlID0gcmVzb2x2ZS50aGVuKChkYXRhKSA9PiBPYmplY3QuZGVmaW5lUHJvcGVydHkocmVzb2x2ZSwgIl9kYXRhIiwgewogICAgICAgICAgICAgICAgICAgIGdldDogKCkgPT4gZGF0YQogICAgICAgICAgICAgICAgICB9KSwgKGVycm9yKSA9PiBPYmplY3QuZGVmaW5lUHJvcGVydHkocmVzb2x2ZSwgIl9lcnJvciIsIHsKICAgICAgICAgICAgICAgICAgICBnZXQ6ICgpID0+IGVycm9yCiAgICAgICAgICAgICAgICAgIH0pKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBpZiAoc3RhdHVzID09PSBBd2FpdFJlbmRlclN0YXR1cy5lcnJvciAmJiBwcm9taXNlLl9lcnJvciBpbnN0YW5jZW9mIEFib3J0ZWREZWZlcnJlZEVycm9yKSB7CiAgICAgICAgICAgICAgICAgIC8vIEZyZWV6ZSB0aGUgVUkgYnkgdGhyb3dpbmcgYSBuZXZlciByZXNvbHZlZCBwcm9taXNlCiAgICAgICAgICAgICAgICAgIHRocm93IG5ldmVyU2V0dGxlZFByb21pc2U7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgaWYgKHN0YXR1cyA9PT0gQXdhaXRSZW5kZXJTdGF0dXMuZXJyb3IgJiYgIWVycm9yRWxlbWVudCkgewogICAgICAgICAgICAgICAgICAvLyBObyBlcnJvckVsZW1lbnQsIHRocm93IHRvIHRoZSBuZWFyZXN0IHJvdXRlLWxldmVsIGVycm9yIGJvdW5kYXJ5CiAgICAgICAgICAgICAgICAgIHRocm93IHByb21pc2UuX2Vycm9yOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGlmIChzdGF0dXMgPT09IEF3YWl0UmVuZGVyU3RhdHVzLmVycm9yKSB7CiAgICAgICAgICAgICAgICAgIC8vIFJlbmRlciB2aWEgb3VyIGVycm9yRWxlbWVudAogICAgICAgICAgICAgICAgICByZXR1cm4gLyojX19QVVJFX18qL1JlYWN0LmNyZWF0ZUVsZW1lbnQoQXdhaXRDb250ZXh0LlByb3ZpZGVyLCB7CiAgICAgICAgICAgICAgICAgICAgdmFsdWU6IHByb21pc2UsCiAgICAgICAgICAgICAgICAgICAgY2hpbGRyZW46IGVycm9yRWxlbWVudAogICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBpZiAoc3RhdHVzID09PSBBd2FpdFJlbmRlclN0YXR1cy5zdWNjZXNzKSB7CiAgICAgICAgICAgICAgICAgIC8vIFJlbmRlciBjaGlsZHJlbiB3aXRoIHJlc29sdmVkIHZhbHVlCiAgICAgICAgICAgICAgICAgIHJldHVybiAvKiNfX1BVUkVfXyovUmVhY3QuY3JlYXRlRWxlbWVudChBd2FpdENvbnRleHQuUHJvdmlkZXIsIHsKICAgICAgICAgICAgICAgICAgICB2YWx1ZTogcHJvbWlzZSwKICAgICAgICAgICAgICAgICAgICBjaGlsZHJlbjogY2hpbGRyZW4KICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9IC8vIFRocm93IHRvIHRoZSBzdXNwZW5zZSBib3VuZGFyeQoKCiAgICAgICAgICAgICAgICB0aHJvdyBwcm9taXNlOwogICAgICAgICAgICAgIH0gfV0sIFt7IGtleTogImdldERlcml2ZWRTdGF0ZUZyb21FcnJvciIsIHZhbHVlOiBmdW5jdGlvbiBnZXREZXJpdmVkU3RhdGVGcm9tRXJyb3IoZXJyb3IpIHtyZXR1cm4geyBlcnJvcjogZXJyb3IgfTt9IH1dKTtyZXR1cm4gQXdhaXRFcnJvckJvdW5kYXJ5O30ocmVhY3QuQ29tcG9uZW50KTsKCgogICAgICAgICAgLyoqCiAgICAgICAgICAgKiBAcHJpdmF0ZQogICAgICAgICAgICogSW5kaXJlY3Rpb24gdG8gbGV2ZXJhZ2UgdXNlQXN5bmNWYWx1ZSBmb3IgYSByZW5kZXItcHJvcCBBUEkgb24gPEF3YWl0PgogICAgICAgICAgICovCgoKICAgICAgICAgIGZ1bmN0aW9uIFJlc29sdmVBd2FpdChfcmVmNykgewogICAgICAgICAgICB2YXIKICAgICAgICAgICAgY2hpbGRyZW4gPQogICAgICAgICAgICBfcmVmNy5jaGlsZHJlbjsKICAgICAgICAgICAgdmFyIGRhdGEgPSB1c2VBc3luY1ZhbHVlKCk7CgogICAgICAgICAgICBpZiAodHlwZW9mIGNoaWxkcmVuID09PSAiZnVuY3Rpb24iKSB7CiAgICAgICAgICAgICAgcmV0dXJuIGNoaWxkcmVuKGRhdGEpOwogICAgICAgICAgICB9CgogICAgICAgICAgICByZXR1cm4gLyojX19QVVJFX18qL1JlYWN0LmNyZWF0ZUVsZW1lbnQoUmVhY3QuRnJhZ21lbnQsIG51bGwsIGNoaWxkcmVuKTsKICAgICAgICAgIH0gLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwogICAgICAgICAgLy8gVVRJTFMKICAgICAgICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KCiAgICAgICAgICAvKioKICAgICAgICAgICAqIENyZWF0ZXMgYSByb3V0ZSBjb25maWcgZnJvbSBhIFJlYWN0ICJjaGlsZHJlbiIgb2JqZWN0LCB3aGljaCBpcyB1c3VhbGx5CiAgICAgICAgICAgKiBlaXRoZXIgYSBgPFJvdXRlPmAgZWxlbWVudCBvciBhbiBhcnJheSBvZiB0aGVtLiBVc2VkIGludGVybmFsbHkgYnkKICAgICAgICAgICAqIGA8Um91dGVzPmAgdG8gY3JlYXRlIGEgcm91dGUgY29uZmlnIGZyb20gaXRzIGNoaWxkcmVuLgogICAgICAgICAgICoKICAgICAgICAgICAqIEBzZWUgaHR0cHM6Ly9yZWFjdHJvdXRlci5jb20vZG9jcy9lbi92Ni91dGlscy9jcmVhdGUtcm91dGVzLWZyb20tY2hpbGRyZW4KICAgICAgICAgICAqLwoKCiAgICAgICAgICBmdW5jdGlvbiBjcmVhdGVSb3V0ZXNGcm9tQ2hpbGRyZW4oY2hpbGRyZW4sIHBhcmVudFBhdGgpIHsKICAgICAgICAgICAgaWYgKHBhcmVudFBhdGggPT09IHZvaWQgMCkgewogICAgICAgICAgICAgIHBhcmVudFBhdGggPSBbXTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdmFyIHJvdXRlcyA9IFtdOwogICAgICAgICAgICByZWFjdC5DaGlsZHJlbi5mb3JFYWNoKGNoaWxkcmVuLCAoZWxlbWVudCwgaW5kZXgpID0+IHsKICAgICAgICAgICAgICBpZiAoISAvKiNfX1BVUkVfXyovcmVhY3QuaXNWYWxpZEVsZW1lbnQoZWxlbWVudCkpIHsKICAgICAgICAgICAgICAgIC8vIElnbm9yZSBub24tZWxlbWVudHMuIFRoaXMgYWxsb3dzIHBlb3BsZSB0byBtb3JlIGVhc2lseSBpbmxpbmUKICAgICAgICAgICAgICAgIC8vIGNvbmRpdGlvbmFscyBpbiB0aGVpciByb3V0ZSBjb25maWcuCiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBpZiAoZWxlbWVudC50eXBlID09PSByZWFjdC5GcmFnbWVudCkgewogICAgICAgICAgICAgICAgLy8gVHJhbnNwYXJlbnRseSBzdXBwb3J0IFJlYWN0LkZyYWdtZW50IGFuZCBpdHMgY2hpbGRyZW4uCiAgICAgICAgICAgICAgICByb3V0ZXMucHVzaC5hcHBseShyb3V0ZXMsIGNyZWF0ZVJvdXRlc0Zyb21DaGlsZHJlbihlbGVtZW50LnByb3BzLmNoaWxkcmVuLCBwYXJlbnRQYXRoKSk7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAhKGVsZW1lbnQudHlwZSA9PT0gUm91dGUpID8gZmFsc2UgPyAwIDogcm91dGVyX2ludmFyaWFudChmYWxzZSkgOiB2b2lkIDA7CiAgICAgICAgICAgICAgISghZWxlbWVudC5wcm9wcy5pbmRleCB8fCAhZWxlbWVudC5wcm9wcy5jaGlsZHJlbikgPyBmYWxzZSA/IDAgOiByb3V0ZXJfaW52YXJpYW50KGZhbHNlKSA6IHZvaWQgMDsKICAgICAgICAgICAgICB2YXIgdHJlZVBhdGggPSBbXS5jb25jYXQoX3RvQ29uc3VtYWJsZUFycmF5MihwYXJlbnRQYXRoKSwgW2luZGV4XSk7CiAgICAgICAgICAgICAgdmFyIHJvdXRlID0gewogICAgICAgICAgICAgICAgaWQ6IGVsZW1lbnQucHJvcHMuaWQgfHwgdHJlZVBhdGguam9pbigiLSIpLAogICAgICAgICAgICAgICAgY2FzZVNlbnNpdGl2ZTogZWxlbWVudC5wcm9wcy5jYXNlU2Vuc2l0aXZlLAogICAgICAgICAgICAgICAgZWxlbWVudDogZWxlbWVudC5wcm9wcy5lbGVtZW50LAogICAgICAgICAgICAgICAgaW5kZXg6IGVsZW1lbnQucHJvcHMuaW5kZXgsCiAgICAgICAgICAgICAgICBwYXRoOiBlbGVtZW50LnByb3BzLnBhdGgsCiAgICAgICAgICAgICAgICBsb2FkZXI6IGVsZW1lbnQucHJvcHMubG9hZGVyLAogICAgICAgICAgICAgICAgYWN0aW9uOiBlbGVtZW50LnByb3BzLmFjdGlvbiwKICAgICAgICAgICAgICAgIGVycm9yRWxlbWVudDogZWxlbWVudC5wcm9wcy5lcnJvckVsZW1lbnQsCiAgICAgICAgICAgICAgICBoYXNFcnJvckJvdW5kYXJ5OiBlbGVtZW50LnByb3BzLmVycm9yRWxlbWVudCAhPSBudWxsLAogICAgICAgICAgICAgICAgc2hvdWxkUmV2YWxpZGF0ZTogZWxlbWVudC5wcm9wcy5zaG91bGRSZXZhbGlkYXRlLAogICAgICAgICAgICAgICAgaGFuZGxlOiBlbGVtZW50LnByb3BzLmhhbmRsZQogICAgICAgICAgICAgIH07CgogICAgICAgICAgICAgIGlmIChlbGVtZW50LnByb3BzLmNoaWxkcmVuKSB7CiAgICAgICAgICAgICAgICByb3V0ZS5jaGlsZHJlbiA9IGNyZWF0ZVJvdXRlc0Zyb21DaGlsZHJlbihlbGVtZW50LnByb3BzLmNoaWxkcmVuLCB0cmVlUGF0aCk7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICByb3V0ZXMucHVzaChyb3V0ZSk7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICByZXR1cm4gcm91dGVzOwogICAgICAgICAgfQogICAgICAgICAgLyoqCiAgICAgICAgICAgKiBSZW5kZXJzIHRoZSByZXN1bHQgb2YgYG1hdGNoUm91dGVzKClgIGludG8gYSBSZWFjdCBlbGVtZW50LgogICAgICAgICAgICovCgogICAgICAgICAgZnVuY3Rpb24gcmVuZGVyTWF0Y2hlcyhtYXRjaGVzKSB7CiAgICAgICAgICAgIHJldHVybiBfcmVuZGVyTWF0Y2hlcyhtYXRjaGVzKTsKICAgICAgICAgIH0KICAgICAgICAgIC8qKgogICAgICAgICAgICogQHByaXZhdGUKICAgICAgICAgICAqIFdhbGsgdGhlIHJvdXRlIHRyZWUgYW5kIGFkZCBoYXNFcnJvckJvdW5kYXJ5IGlmIGl0J3Mgbm90IHByb3ZpZGVkLCBzbyB0aGF0CiAgICAgICAgICAgKiB1c2VycyBwcm92aWRpbmcgbWFudWFsIHJvdXRlIGFycmF5cyBjYW4ganVzdCBzcGVjaWZ5IGVycm9yRWxlbWVudAogICAgICAgICAgICovCgogICAgICAgICAgZnVuY3Rpb24gZW5oYW5jZU1hbnVhbFJvdXRlT2JqZWN0cyhyb3V0ZXMpIHsKICAgICAgICAgICAgcmV0dXJuIHJvdXRlcy5tYXAoKHJvdXRlKSA9PiB7CiAgICAgICAgICAgICAgdmFyIHJvdXRlQ2xvbmUgPSBkaXN0X2V4dGVuZHMoe30sIHJvdXRlKTsKCiAgICAgICAgICAgICAgaWYgKHJvdXRlQ2xvbmUuaGFzRXJyb3JCb3VuZGFyeSA9PSBudWxsKSB7CiAgICAgICAgICAgICAgICByb3V0ZUNsb25lLmhhc0Vycm9yQm91bmRhcnkgPSByb3V0ZUNsb25lLmVycm9yRWxlbWVudCAhPSBudWxsOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgaWYgKHJvdXRlQ2xvbmUuY2hpbGRyZW4pIHsKICAgICAgICAgICAgICAgIHJvdXRlQ2xvbmUuY2hpbGRyZW4gPSBlbmhhbmNlTWFudWFsUm91dGVPYmplY3RzKHJvdXRlQ2xvbmUuY2hpbGRyZW4pOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgcmV0dXJuIHJvdXRlQ2xvbmU7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfQoKICAgICAgICAgIGZ1bmN0aW9uIGNyZWF0ZU1lbW9yeVJvdXRlcihyb3V0ZXMsIG9wdHMpIHsKICAgICAgICAgICAgcmV0dXJuIGNyZWF0ZVJvdXRlcih7CiAgICAgICAgICAgICAgYmFzZW5hbWU6IG9wdHMgPT0gbnVsbCA/IHZvaWQgMCA6IG9wdHMuYmFzZW5hbWUsCiAgICAgICAgICAgICAgaGlzdG9yeTogY3JlYXRlTWVtb3J5SGlzdG9yeSh7CiAgICAgICAgICAgICAgICBpbml0aWFsRW50cmllczogb3B0cyA9PSBudWxsID8gdm9pZCAwIDogb3B0cy5pbml0aWFsRW50cmllcywKICAgICAgICAgICAgICAgIGluaXRpYWxJbmRleDogb3B0cyA9PSBudWxsID8gdm9pZCAwIDogb3B0cy5pbml0aWFsSW5kZXgKICAgICAgICAgICAgICB9KSwKICAgICAgICAgICAgICBoeWRyYXRpb25EYXRhOiBvcHRzID09IG51bGwgPyB2b2lkIDAgOiBvcHRzLmh5ZHJhdGlvbkRhdGEsCiAgICAgICAgICAgICAgcm91dGVzOiBlbmhhbmNlTWFudWFsUm91dGVPYmplY3RzKHJvdXRlcykKICAgICAgICAgICAgfSkuaW5pdGlhbGl6ZSgpOwogICAgICAgICAgfSAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCgoKCgogICAgICAgICAgOyAvLyBDT05DQVRFTkFURUQgTU9EVUxFOiAuL25vZGVfbW9kdWxlcy9yZWFjdC1yb3V0ZXItZG9tL2Rpc3QvaW5kZXguanMKICAgICAgICAgIC8qKgogICAgICAgICAgICogUmVhY3QgUm91dGVyIERPTSB2Ni40LjMKICAgICAgICAgICAqCiAgICAgICAgICAgKiBDb3B5cmlnaHQgKGMpIFJlbWl4IFNvZnR3YXJlIEluYy4KICAgICAgICAgICAqCiAgICAgICAgICAgKiBUaGlzIHNvdXJjZSBjb2RlIGlzIGxpY2Vuc2VkIHVuZGVyIHRoZSBNSVQgbGljZW5zZSBmb3VuZCBpbiB0aGUKICAgICAgICAgICAqIExJQ0VOU0UubWQgZmlsZSBpbiB0aGUgcm9vdCBkaXJlY3Rvcnkgb2YgdGhpcyBzb3VyY2UgdHJlZS4KICAgICAgICAgICAqCiAgICAgICAgICAgKiBAbGljZW5zZSBNSVQKICAgICAgICAgICAqLwoKCgoKCiAgICAgICAgICBmdW5jdGlvbiByZWFjdF9yb3V0ZXJfZG9tX2Rpc3RfZXh0ZW5kcygpIHsKICAgICAgICAgICAgcmVhY3Rfcm91dGVyX2RvbV9kaXN0X2V4dGVuZHMgPSBPYmplY3QuYXNzaWduID8gT2JqZWN0LmFzc2lnbi5iaW5kKCkgOiBmdW5jdGlvbiAodGFyZ2V0KSB7CiAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDE7IGkgPCBhcmd1bWVudHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICAgIHZhciBzb3VyY2UgPSBhcmd1bWVudHNbaV07CgogICAgICAgICAgICAgICAgZm9yICh2YXIga2V5IGluIHNvdXJjZSkgewogICAgICAgICAgICAgICAgICBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKHNvdXJjZSwga2V5KSkgewogICAgICAgICAgICAgICAgICAgIHRhcmdldFtrZXldID0gc291cmNlW2tleV07CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIHJldHVybiB0YXJnZXQ7CiAgICAgICAgICAgIH07CiAgICAgICAgICAgIHJldHVybiByZWFjdF9yb3V0ZXJfZG9tX2Rpc3RfZXh0ZW5kcy5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICAgICAgfQoKICAgICAgICAgIGZ1bmN0aW9uIF9vYmplY3RXaXRob3V0UHJvcGVydGllc0xvb3NlKHNvdXJjZSwgZXhjbHVkZWQpIHsKICAgICAgICAgICAgaWYgKHNvdXJjZSA9PSBudWxsKSByZXR1cm4ge307CiAgICAgICAgICAgIHZhciB0YXJnZXQgPSB7fTsKICAgICAgICAgICAgdmFyIHNvdXJjZUtleXMgPSBPYmplY3Qua2V5cyhzb3VyY2UpOwogICAgICAgICAgICB2YXIga2V5LCBpOwoKICAgICAgICAgICAgZm9yIChpID0gMDsgaSA8IHNvdXJjZUtleXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICBrZXkgPSBzb3VyY2VLZXlzW2ldOwogICAgICAgICAgICAgIGlmIChleGNsdWRlZC5pbmRleE9mKGtleSkgPj0gMCkgY29udGludWU7CiAgICAgICAgICAgICAgdGFyZ2V0W2tleV0gPSBzb3VyY2Vba2V5XTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuIHRhcmdldDsKICAgICAgICAgIH0KCiAgICAgICAgICB2YXIgZGVmYXVsdE1ldGhvZCA9ICJnZXQiOwogICAgICAgICAgdmFyIGRlZmF1bHRFbmNUeXBlID0gImFwcGxpY2F0aW9uL3gtd3d3LWZvcm0tdXJsZW5jb2RlZCI7CiAgICAgICAgICBmdW5jdGlvbiBpc0h0bWxFbGVtZW50KG9iamVjdCkgewogICAgICAgICAgICByZXR1cm4gb2JqZWN0ICE9IG51bGwgJiYgdHlwZW9mIG9iamVjdC50YWdOYW1lID09PSAic3RyaW5nIjsKICAgICAgICAgIH0KICAgICAgICAgIGZ1bmN0aW9uIGlzQnV0dG9uRWxlbWVudChvYmplY3QpIHsKICAgICAgICAgICAgcmV0dXJuIGlzSHRtbEVsZW1lbnQob2JqZWN0KSAmJiBvYmplY3QudGFnTmFtZS50b0xvd2VyQ2FzZSgpID09PSAiYnV0dG9uIjsKICAgICAgICAgIH0KICAgICAgICAgIGZ1bmN0aW9uIGlzRm9ybUVsZW1lbnQob2JqZWN0KSB7CiAgICAgICAgICAgIHJldHVybiBpc0h0bWxFbGVtZW50KG9iamVjdCkgJiYgb2JqZWN0LnRhZ05hbWUudG9Mb3dlckNhc2UoKSA9PT0gImZvcm0iOwogICAgICAgICAgfQogICAgICAgICAgZnVuY3Rpb24gaXNJbnB1dEVsZW1lbnQob2JqZWN0KSB7CiAgICAgICAgICAgIHJldHVybiBpc0h0bWxFbGVtZW50KG9iamVjdCkgJiYgb2JqZWN0LnRhZ05hbWUudG9Mb3dlckNhc2UoKSA9PT0gImlucHV0IjsKICAgICAgICAgIH0KCiAgICAgICAgICBmdW5jdGlvbiBpc01vZGlmaWVkRXZlbnQoZXZlbnQpIHsKICAgICAgICAgICAgcmV0dXJuICEhKGV2ZW50Lm1ldGFLZXkgfHwgZXZlbnQuYWx0S2V5IHx8IGV2ZW50LmN0cmxLZXkgfHwgZXZlbnQuc2hpZnRLZXkpOwogICAgICAgICAgfQoKICAgICAgICAgIGZ1bmN0aW9uIHNob3VsZFByb2Nlc3NMaW5rQ2xpY2soZXZlbnQsIHRhcmdldCkgewogICAgICAgICAgICByZXR1cm4gZXZlbnQuYnV0dG9uID09PSAwICYmICggLy8gSWdub3JlIGV2ZXJ5dGhpbmcgYnV0IGxlZnQgY2xpY2tzCiAgICAgICAgICAgICF0YXJnZXQgfHwgdGFyZ2V0ID09PSAiX3NlbGYiKSAmJiAvLyBMZXQgYnJvd3NlciBoYW5kbGUgInRhcmdldD1fYmxhbmsiIGV0Yy4KICAgICAgICAgICAgIWlzTW9kaWZpZWRFdmVudChldmVudCkgLy8gSWdub3JlIGNsaWNrcyB3aXRoIG1vZGlmaWVyIGtleXMKICAgICAgICAgICAgOwogICAgICAgICAgfQogICAgICAgICAgLyoqCiAgICAgICAgICAgKiBDcmVhdGVzIGEgVVJMU2VhcmNoUGFyYW1zIG9iamVjdCB1c2luZyB0aGUgZ2l2ZW4gaW5pdGlhbGl6ZXIuCiAgICAgICAgICAgKgogICAgICAgICAgICogVGhpcyBpcyBpZGVudGljYWwgdG8gYG5ldyBVUkxTZWFyY2hQYXJhbXMoaW5pdClgIGV4Y2VwdCBpdCBhbHNvCiAgICAgICAgICAgKiBzdXBwb3J0cyBhcnJheXMgYXMgdmFsdWVzIGluIHRoZSBvYmplY3QgZm9ybSBvZiB0aGUgaW5pdGlhbGl6ZXIKICAgICAgICAgICAqIGluc3RlYWQgb2YganVzdCBzdHJpbmdzLiBUaGlzIGlzIGNvbnZlbmllbnQgd2hlbiB5b3UgbmVlZCBtdWx0aXBsZQogICAgICAgICAgICogdmFsdWVzIGZvciBhIGdpdmVuIGtleSwgYnV0IGRvbid0IHdhbnQgdG8gdXNlIGFuIGFycmF5IGluaXRpYWxpemVyLgogICAgICAgICAgICoKICAgICAgICAgICAqIEZvciBleGFtcGxlLCBpbnN0ZWFkIG9mOgogICAgICAgICAgICoKICAgICAgICAgICAqICAgbGV0IHNlYXJjaFBhcmFtcyA9IG5ldyBVUkxTZWFyY2hQYXJhbXMoWwogICAgICAgICAgICogICAgIFsnc29ydCcsICduYW1lJ10sCiAgICAgICAgICAgKiAgICAgWydzb3J0JywgJ3ByaWNlJ10KICAgICAgICAgICAqICAgXSk7CiAgICAgICAgICAgKgogICAgICAgICAgICogeW91IGNhbiBkbzoKICAgICAgICAgICAqCiAgICAgICAgICAgKiAgIGxldCBzZWFyY2hQYXJhbXMgPSBjcmVhdGVTZWFyY2hQYXJhbXMoewogICAgICAgICAgICogICAgIHNvcnQ6IFsnbmFtZScsICdwcmljZSddCiAgICAgICAgICAgKiAgIH0pOwogICAgICAgICAgICovCgogICAgICAgICAgZnVuY3Rpb24gY3JlYXRlU2VhcmNoUGFyYW1zKGluaXQpIHsKICAgICAgICAgICAgaWYgKGluaXQgPT09IHZvaWQgMCkgewogICAgICAgICAgICAgIGluaXQgPSAiIjsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuIG5ldyBVUkxTZWFyY2hQYXJhbXModHlwZW9mIGluaXQgPT09ICJzdHJpbmciIHx8IEFycmF5LmlzQXJyYXkoaW5pdCkgfHwgaW5pdCBpbnN0YW5jZW9mIFVSTFNlYXJjaFBhcmFtcyA/IGluaXQgOiBPYmplY3Qua2V5cyhpbml0KS5yZWR1Y2UoKG1lbW8sIGtleSkgPT4gewogICAgICAgICAgICAgIHZhciB2YWx1ZSA9IGluaXRba2V5XTsKICAgICAgICAgICAgICByZXR1cm4gbWVtby5jb25jYXQoQXJyYXkuaXNBcnJheSh2YWx1ZSkgPyB2YWx1ZS5tYXAoKHYpID0+IFtrZXksIHZdKSA6IFtba2V5LCB2YWx1ZV1dKTsKICAgICAgICAgICAgfSwgW10pKTsKICAgICAgICAgIH0KICAgICAgICAgIGZ1bmN0aW9uIGdldFNlYXJjaFBhcmFtc0ZvckxvY2F0aW9uKGxvY2F0aW9uU2VhcmNoLCBkZWZhdWx0U2VhcmNoUGFyYW1zKSB7CiAgICAgICAgICAgIHZhciBzZWFyY2hQYXJhbXMgPSBjcmVhdGVTZWFyY2hQYXJhbXMobG9jYXRpb25TZWFyY2gpO3ZhciBfaXRlcmF0b3I3ID0gX2NyZWF0ZUZvck9mSXRlcmF0b3JIZWxwZXIyKAoKICAgICAgICAgICAgICBkZWZhdWx0U2VhcmNoUGFyYW1zLmtleXMoKSksX3N0ZXA3O3RyeSB7dmFyIF9sb29wID0gZnVuY3Rpb24gX2xvb3AoKSB7dmFyIGtleSA9IF9zdGVwNy52YWx1ZTsKICAgICAgICAgICAgICAgIGlmICghc2VhcmNoUGFyYW1zLmhhcyhrZXkpKSB7CiAgICAgICAgICAgICAgICAgIGRlZmF1bHRTZWFyY2hQYXJhbXMuZ2V0QWxsKGtleSkuZm9yRWFjaCgodmFsdWUpID0+IHsKICAgICAgICAgICAgICAgICAgICBzZWFyY2hQYXJhbXMuYXBwZW5kKGtleSwgdmFsdWUpOwogICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH19O2ZvciAoX2l0ZXJhdG9yNy5zKCk7ICEoX3N0ZXA3ID0gX2l0ZXJhdG9yNy5uKCkpLmRvbmU7KSB7X2xvb3AoKTsKICAgICAgICAgICAgICB9fSBjYXRjaCAoZXJyKSB7X2l0ZXJhdG9yNy5lKGVycik7fSBmaW5hbGx5IHtfaXRlcmF0b3I3LmYoKTt9CgogICAgICAgICAgICByZXR1cm4gc2VhcmNoUGFyYW1zOwogICAgICAgICAgfQogICAgICAgICAgZnVuY3Rpb24gZ2V0Rm9ybVN1Ym1pc3Npb25JbmZvKHRhcmdldCwgZGVmYXVsdEFjdGlvbiwgb3B0aW9ucykgewogICAgICAgICAgICB2YXIgbWV0aG9kOwogICAgICAgICAgICB2YXIgYWN0aW9uOwogICAgICAgICAgICB2YXIgZW5jVHlwZTsKICAgICAgICAgICAgdmFyIGZvcm1EYXRhOwoKICAgICAgICAgICAgaWYgKGlzRm9ybUVsZW1lbnQodGFyZ2V0KSkgewogICAgICAgICAgICAgIHZhciBzdWJtaXNzaW9uVHJpZ2dlciA9IG9wdGlvbnMuc3VibWlzc2lvblRyaWdnZXI7CiAgICAgICAgICAgICAgbWV0aG9kID0gb3B0aW9ucy5tZXRob2QgfHwgdGFyZ2V0LmdldEF0dHJpYnV0ZSgibWV0aG9kIikgfHwgZGVmYXVsdE1ldGhvZDsKICAgICAgICAgICAgICBhY3Rpb24gPSBvcHRpb25zLmFjdGlvbiB8fCB0YXJnZXQuZ2V0QXR0cmlidXRlKCJhY3Rpb24iKSB8fCBkZWZhdWx0QWN0aW9uOwogICAgICAgICAgICAgIGVuY1R5cGUgPSBvcHRpb25zLmVuY1R5cGUgfHwgdGFyZ2V0LmdldEF0dHJpYnV0ZSgiZW5jdHlwZSIpIHx8IGRlZmF1bHRFbmNUeXBlOwogICAgICAgICAgICAgIGZvcm1EYXRhID0gbmV3IEZvcm1EYXRhKHRhcmdldCk7CgogICAgICAgICAgICAgIGlmIChzdWJtaXNzaW9uVHJpZ2dlciAmJiBzdWJtaXNzaW9uVHJpZ2dlci5uYW1lKSB7CiAgICAgICAgICAgICAgICBmb3JtRGF0YS5hcHBlbmQoc3VibWlzc2lvblRyaWdnZXIubmFtZSwgc3VibWlzc2lvblRyaWdnZXIudmFsdWUpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBlbHNlIGlmIChpc0J1dHRvbkVsZW1lbnQodGFyZ2V0KSB8fCBpc0lucHV0RWxlbWVudCh0YXJnZXQpICYmICh0YXJnZXQudHlwZSA9PT0gInN1Ym1pdCIgfHwgdGFyZ2V0LnR5cGUgPT09ICJpbWFnZSIpKSB7CiAgICAgICAgICAgICAgdmFyIGZvcm0gPSB0YXJnZXQuZm9ybTsKCiAgICAgICAgICAgICAgaWYgKGZvcm0gPT0gbnVsbCkgewogICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJDYW5ub3Qgc3VibWl0IGEgPGJ1dHRvbj4gb3IgPGlucHV0IHR5cGU9XCJzdWJtaXRcIj4gd2l0aG91dCBhIDxmb3JtPiIpOwogICAgICAgICAgICAgIH0gLy8gPGJ1dHRvbj4vPGlucHV0IHR5cGU9InN1Ym1pdCI+IG1heSBvdmVycmlkZSBhdHRyaWJ1dGVzIG9mIDxmb3JtPgoKCiAgICAgICAgICAgICAgbWV0aG9kID0gb3B0aW9ucy5tZXRob2QgfHwgdGFyZ2V0LmdldEF0dHJpYnV0ZSgiZm9ybW1ldGhvZCIpIHx8IGZvcm0uZ2V0QXR0cmlidXRlKCJtZXRob2QiKSB8fCBkZWZhdWx0TWV0aG9kOwogICAgICAgICAgICAgIGFjdGlvbiA9IG9wdGlvbnMuYWN0aW9uIHx8IHRhcmdldC5nZXRBdHRyaWJ1dGUoImZvcm1hY3Rpb24iKSB8fCBmb3JtLmdldEF0dHJpYnV0ZSgiYWN0aW9uIikgfHwgZGVmYXVsdEFjdGlvbjsKICAgICAgICAgICAgICBlbmNUeXBlID0gb3B0aW9ucy5lbmNUeXBlIHx8IHRhcmdldC5nZXRBdHRyaWJ1dGUoImZvcm1lbmN0eXBlIikgfHwgZm9ybS5nZXRBdHRyaWJ1dGUoImVuY3R5cGUiKSB8fCBkZWZhdWx0RW5jVHlwZTsKICAgICAgICAgICAgICBmb3JtRGF0YSA9IG5ldyBGb3JtRGF0YShmb3JtKTsgLy8gSW5jbHVkZSBuYW1lICsgdmFsdWUgZnJvbSBhIDxidXR0b24+LCBhcHBlbmRpbmcgaW4gY2FzZSB0aGUgYnV0dG9uIG5hbWUKICAgICAgICAgICAgICAvLyBtYXRjaGVzIGFuIGV4aXN0aW5nIGlucHV0IG5hbWUKCiAgICAgICAgICAgICAgaWYgKHRhcmdldC5uYW1lKSB7CiAgICAgICAgICAgICAgICBmb3JtRGF0YS5hcHBlbmQodGFyZ2V0Lm5hbWUsIHRhcmdldC52YWx1ZSk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2UgaWYgKGlzSHRtbEVsZW1lbnQodGFyZ2V0KSkgewogICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiQ2Fubm90IHN1Ym1pdCBlbGVtZW50IHRoYXQgaXMgbm90IDxmb3JtPiwgPGJ1dHRvbj4sIG9yICIgKyAiPGlucHV0IHR5cGU9XCJzdWJtaXR8aW1hZ2VcIj4iKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICBtZXRob2QgPSBvcHRpb25zLm1ldGhvZCB8fCBkZWZhdWx0TWV0aG9kOwogICAgICAgICAgICAgIGFjdGlvbiA9IG9wdGlvbnMuYWN0aW9uIHx8IGRlZmF1bHRBY3Rpb247CiAgICAgICAgICAgICAgZW5jVHlwZSA9IG9wdGlvbnMuZW5jVHlwZSB8fCBkZWZhdWx0RW5jVHlwZTsKCiAgICAgICAgICAgICAgaWYgKHRhcmdldCBpbnN0YW5jZW9mIEZvcm1EYXRhKSB7CiAgICAgICAgICAgICAgICBmb3JtRGF0YSA9IHRhcmdldDsKICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgZm9ybURhdGEgPSBuZXcgRm9ybURhdGEoKTsKCiAgICAgICAgICAgICAgICBpZiAodGFyZ2V0IGluc3RhbmNlb2YgVVJMU2VhcmNoUGFyYW1zKSB7dmFyIF9pdGVyYXRvcjggPSBfY3JlYXRlRm9yT2ZJdGVyYXRvckhlbHBlcjIoCiAgICAgICAgICAgICAgICAgICAgdGFyZ2V0KSxfc3RlcDg7dHJ5IHtmb3IgKF9pdGVyYXRvcjgucygpOyAhKF9zdGVwOCA9IF9pdGVyYXRvcjgubigpKS5kb25lOykge3ZhciBfc3RlcDgkdmFsdWUgPSBfc2xpY2VkVG9BcnJheTIoX3N0ZXA4LnZhbHVlLCAyKSxuYW1lID0gX3N0ZXA4JHZhbHVlWzBdLHZhbHVlID0gX3N0ZXA4JHZhbHVlWzFdOwogICAgICAgICAgICAgICAgICAgICAgZm9ybURhdGEuYXBwZW5kKG5hbWUsIHZhbHVlKTsKICAgICAgICAgICAgICAgICAgICB9fSBjYXRjaCAoZXJyKSB7X2l0ZXJhdG9yOC5lKGVycik7fSBmaW5hbGx5IHtfaXRlcmF0b3I4LmYoKTt9CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHRhcmdldCAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICAgIGZvciAodmFyIF9pMiA9IDAsIF9PYmplY3Qka2V5cyA9IE9iamVjdC5rZXlzKHRhcmdldCk7IF9pMiA8IF9PYmplY3Qka2V5cy5sZW5ndGg7IF9pMisrKSB7dmFyIF9uYW1lID0gX09iamVjdCRrZXlzW19pMl07CiAgICAgICAgICAgICAgICAgICAgZm9ybURhdGEuYXBwZW5kKF9uYW1lLCB0YXJnZXRbX25hbWVdKTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgdmFyIF93aW5kb3ckbG9jYXRpb24yID0KCgogICAgICAgICAgICAgIHdpbmRvdy5sb2NhdGlvbixwcm90b2NvbCA9IF93aW5kb3ckbG9jYXRpb24yLnByb3RvY29sLGhvc3QgPSBfd2luZG93JGxvY2F0aW9uMi5ob3N0OwogICAgICAgICAgICB2YXIgdXJsID0gbmV3IFVSTChhY3Rpb24sIHByb3RvY29sICsgIi8vIiArIGhvc3QpOwogICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgIHVybDogdXJsLAogICAgICAgICAgICAgIG1ldGhvZDogbWV0aG9kLAogICAgICAgICAgICAgIGVuY1R5cGU6IGVuY1R5cGUsCiAgICAgICAgICAgICAgZm9ybURhdGE6IGZvcm1EYXRhCiAgICAgICAgICAgIH07CiAgICAgICAgICB9CgogICAgICAgICAgdmFyIF9leGNsdWRlZCA9IFsib25DbGljayIsICJyZWxhdGl2ZSIsICJyZWxvYWREb2N1bWVudCIsICJyZXBsYWNlIiwgInN0YXRlIiwgInRhcmdldCIsICJ0byIsICJwcmV2ZW50U2Nyb2xsUmVzZXQiXSwKICAgICAgICAgICAgX2V4Y2x1ZGVkMiA9IFsiYXJpYS1jdXJyZW50IiwgImNhc2VTZW5zaXRpdmUiLCAiY2xhc3NOYW1lIiwgImVuZCIsICJzdHlsZSIsICJ0byIsICJjaGlsZHJlbiJdLAogICAgICAgICAgICBfZXhjbHVkZWQzID0gLyogdW51c2VkIHB1cmUgZXhwcmVzc2lvbiBvciBzdXBlciAqL251bGwgJiYgWyJyZWxvYWREb2N1bWVudCIsICJyZXBsYWNlIiwgIm1ldGhvZCIsICJhY3Rpb24iLCAib25TdWJtaXQiLCAiZmV0Y2hlcktleSIsICJyb3V0ZUlkIiwgInJlbGF0aXZlIl07CiAgICAgICAgICAvLyNyZWdpb24gUm91dGVycwogICAgICAgICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KCiAgICAgICAgICBmdW5jdGlvbiBjcmVhdGVCcm93c2VyUm91dGVyKHJvdXRlcywgb3B0cykgewogICAgICAgICAgICB2YXIgX3dpbmRvdzsKCiAgICAgICAgICAgIHJldHVybiBjcmVhdGVSb3V0ZXIoewogICAgICAgICAgICAgIGJhc2VuYW1lOiBvcHRzID09IG51bGwgPyB2b2lkIDAgOiBvcHRzLmJhc2VuYW1lLAogICAgICAgICAgICAgIGhpc3Rvcnk6IGNyZWF0ZUJyb3dzZXJIaXN0b3J5KHsKICAgICAgICAgICAgICAgIHdpbmRvdzogb3B0cyA9PSBudWxsID8gdm9pZCAwIDogb3B0cy53aW5kb3cKICAgICAgICAgICAgICB9KSwKICAgICAgICAgICAgICBoeWRyYXRpb25EYXRhOiAob3B0cyA9PSBudWxsID8gdm9pZCAwIDogb3B0cy5oeWRyYXRpb25EYXRhKSB8fCAoKF93aW5kb3cgPSB3aW5kb3cpID09IG51bGwgPyB2b2lkIDAgOiBfd2luZG93Ll9fc3RhdGljUm91dGVySHlkcmF0aW9uRGF0YSksCiAgICAgICAgICAgICAgcm91dGVzOiBVTlNBRkVfZW5oYW5jZU1hbnVhbFJvdXRlT2JqZWN0cyhyb3V0ZXMpCiAgICAgICAgICAgIH0pLmluaXRpYWxpemUoKTsKICAgICAgICAgIH0KICAgICAgICAgIGZ1bmN0aW9uIGNyZWF0ZUhhc2hSb3V0ZXIocm91dGVzLCBvcHRzKSB7CiAgICAgICAgICAgIHZhciBfd2luZG93MjsKCiAgICAgICAgICAgIHJldHVybiBjcmVhdGVSb3V0ZXIoewogICAgICAgICAgICAgIGJhc2VuYW1lOiBvcHRzID09IG51bGwgPyB2b2lkIDAgOiBvcHRzLmJhc2VuYW1lLAogICAgICAgICAgICAgIGhpc3Rvcnk6IGNyZWF0ZUhhc2hIaXN0b3J5KHsKICAgICAgICAgICAgICAgIHdpbmRvdzogb3B0cyA9PSBudWxsID8gdm9pZCAwIDogb3B0cy53aW5kb3cKICAgICAgICAgICAgICB9KSwKICAgICAgICAgICAgICBoeWRyYXRpb25EYXRhOiAob3B0cyA9PSBudWxsID8gdm9pZCAwIDogb3B0cy5oeWRyYXRpb25EYXRhKSB8fCAoKF93aW5kb3cyID0gd2luZG93KSA9PSBudWxsID8gdm9pZCAwIDogX3dpbmRvdzIuX19zdGF0aWNSb3V0ZXJIeWRyYXRpb25EYXRhKSwKICAgICAgICAgICAgICByb3V0ZXM6IFVOU0FGRV9lbmhhbmNlTWFudWFsUm91dGVPYmplY3RzKHJvdXRlcykKICAgICAgICAgICAgfSkuaW5pdGlhbGl6ZSgpOwogICAgICAgICAgfQogICAgICAgICAgLyoqCiAgICAgICAgICAgKiBBIGA8Um91dGVyPmAgZm9yIHVzZSBpbiB3ZWIgYnJvd3NlcnMuIFByb3ZpZGVzIHRoZSBjbGVhbmVzdCBVUkxzLgogICAgICAgICAgICovCgogICAgICAgICAgZnVuY3Rpb24gQnJvd3NlclJvdXRlcihfcmVmKSB7CiAgICAgICAgICAgIHZhcgogICAgICAgICAgICAgIGJhc2VuYW1lID0KCgogICAgICAgICAgICAgIF9yZWYuYmFzZW5hbWUsY2hpbGRyZW4gPSBfcmVmLmNoaWxkcmVuLHdpbmRvdyA9IF9yZWYud2luZG93OwogICAgICAgICAgICB2YXIgaGlzdG9yeVJlZiA9IFJlYWN0LnVzZVJlZigpOwoKICAgICAgICAgICAgaWYgKGhpc3RvcnlSZWYuY3VycmVudCA9PSBudWxsKSB7CiAgICAgICAgICAgICAgaGlzdG9yeVJlZi5jdXJyZW50ID0gY3JlYXRlQnJvd3Nlckhpc3RvcnkoewogICAgICAgICAgICAgICAgd2luZG93OiB3aW5kb3csCiAgICAgICAgICAgICAgICB2NUNvbXBhdDogdHJ1ZQogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CgogICAgICAgICAgICB2YXIgaGlzdG9yeSA9IGhpc3RvcnlSZWYuY3VycmVudDsKICAgICAgICAgICAgdmFyIF9SZWFjdCR1c2VTdGF0ZSA9IFJlYWN0LnVzZVN0YXRlKHsKICAgICAgICAgICAgICAgIGFjdGlvbjogaGlzdG9yeS5hY3Rpb24sCiAgICAgICAgICAgICAgICBsb2NhdGlvbjogaGlzdG9yeS5sb2NhdGlvbgogICAgICAgICAgICAgIH0pLF9SZWFjdCR1c2VTdGF0ZTIgPSBfc2xpY2VkVG9BcnJheTIoX1JlYWN0JHVzZVN0YXRlLCAyKSxzdGF0ZSA9IF9SZWFjdCR1c2VTdGF0ZTJbMF0sc2V0U3RhdGUgPSBfUmVhY3QkdXNlU3RhdGUyWzFdOwogICAgICAgICAgICBSZWFjdC51c2VMYXlvdXRFZmZlY3QoKCkgPT4gaGlzdG9yeS5saXN0ZW4oc2V0U3RhdGUpLCBbaGlzdG9yeV0pOwogICAgICAgICAgICByZXR1cm4gLyojX19QVVJFX18qL1JlYWN0LmNyZWF0ZUVsZW1lbnQoUm91dGVyLCB7CiAgICAgICAgICAgICAgYmFzZW5hbWU6IGJhc2VuYW1lLAogICAgICAgICAgICAgIGNoaWxkcmVuOiBjaGlsZHJlbiwKICAgICAgICAgICAgICBsb2NhdGlvbjogc3RhdGUubG9jYXRpb24sCiAgICAgICAgICAgICAgbmF2aWdhdGlvblR5cGU6IHN0YXRlLmFjdGlvbiwKICAgICAgICAgICAgICBuYXZpZ2F0b3I6IGhpc3RvcnkKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9CiAgICAgICAgICAvKioKICAgICAgICAgICAqIEEgYDxSb3V0ZXI+YCBmb3IgdXNlIGluIHdlYiBicm93c2Vycy4gU3RvcmVzIHRoZSBsb2NhdGlvbiBpbiB0aGUgaGFzaAogICAgICAgICAgICogcG9ydGlvbiBvZiB0aGUgVVJMIHNvIGl0IGlzIG5vdCBzZW50IHRvIHRoZSBzZXJ2ZXIuCiAgICAgICAgICAgKi8KCiAgICAgICAgICBmdW5jdGlvbiBIYXNoUm91dGVyKF9yZWYyKSB7CiAgICAgICAgICAgIHZhcgogICAgICAgICAgICAgIGJhc2VuYW1lID0KCgogICAgICAgICAgICAgIF9yZWYyLmJhc2VuYW1lLGNoaWxkcmVuID0gX3JlZjIuY2hpbGRyZW4sd2luZG93ID0gX3JlZjIud2luZG93OwogICAgICAgICAgICB2YXIgaGlzdG9yeVJlZiA9IFJlYWN0LnVzZVJlZigpOwoKICAgICAgICAgICAgaWYgKGhpc3RvcnlSZWYuY3VycmVudCA9PSBudWxsKSB7CiAgICAgICAgICAgICAgaGlzdG9yeVJlZi5jdXJyZW50ID0gY3JlYXRlSGFzaEhpc3RvcnkoewogICAgICAgICAgICAgICAgd2luZG93OiB3aW5kb3csCiAgICAgICAgICAgICAgICB2NUNvbXBhdDogdHJ1ZQogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CgogICAgICAgICAgICB2YXIgaGlzdG9yeSA9IGhpc3RvcnlSZWYuY3VycmVudDsKICAgICAgICAgICAgdmFyIF9SZWFjdCR1c2VTdGF0ZTMgPSBSZWFjdC51c2VTdGF0ZSh7CiAgICAgICAgICAgICAgICBhY3Rpb246IGhpc3RvcnkuYWN0aW9uLAogICAgICAgICAgICAgICAgbG9jYXRpb246IGhpc3RvcnkubG9jYXRpb24KICAgICAgICAgICAgICB9KSxfUmVhY3QkdXNlU3RhdGU0ID0gX3NsaWNlZFRvQXJyYXkyKF9SZWFjdCR1c2VTdGF0ZTMsIDIpLHN0YXRlID0gX1JlYWN0JHVzZVN0YXRlNFswXSxzZXRTdGF0ZSA9IF9SZWFjdCR1c2VTdGF0ZTRbMV07CiAgICAgICAgICAgIFJlYWN0LnVzZUxheW91dEVmZmVjdCgoKSA9PiBoaXN0b3J5Lmxpc3RlbihzZXRTdGF0ZSksIFtoaXN0b3J5XSk7CiAgICAgICAgICAgIHJldHVybiAvKiNfX1BVUkVfXyovUmVhY3QuY3JlYXRlRWxlbWVudChSb3V0ZXIsIHsKICAgICAgICAgICAgICBiYXNlbmFtZTogYmFzZW5hbWUsCiAgICAgICAgICAgICAgY2hpbGRyZW46IGNoaWxkcmVuLAogICAgICAgICAgICAgIGxvY2F0aW9uOiBzdGF0ZS5sb2NhdGlvbiwKICAgICAgICAgICAgICBuYXZpZ2F0aW9uVHlwZTogc3RhdGUuYWN0aW9uLAogICAgICAgICAgICAgIG5hdmlnYXRvcjogaGlzdG9yeQogICAgICAgICAgICB9KTsKICAgICAgICAgIH0KICAgICAgICAgIC8qKgogICAgICAgICAgICogQSBgPFJvdXRlcj5gIHRoYXQgYWNjZXB0cyBhIHByZS1pbnN0YW50aWF0ZWQgaGlzdG9yeSBvYmplY3QuIEl0J3MgaW1wb3J0YW50CiAgICAgICAgICAgKiB0byBub3RlIHRoYXQgdXNpbmcgeW91ciBvd24gaGlzdG9yeSBvYmplY3QgaXMgaGlnaGx5IGRpc2NvdXJhZ2VkIGFuZCBtYXkgYWRkCiAgICAgICAgICAgKiB0d28gdmVyc2lvbnMgb2YgdGhlIGhpc3RvcnkgbGlicmFyeSB0byB5b3VyIGJ1bmRsZXMgdW5sZXNzIHlvdSB1c2UgdGhlIHNhbWUKICAgICAgICAgICAqIHZlcnNpb24gb2YgdGhlIGhpc3RvcnkgbGlicmFyeSB0aGF0IFJlYWN0IFJvdXRlciB1c2VzIGludGVybmFsbHkuCiAgICAgICAgICAgKi8KCiAgICAgICAgICBmdW5jdGlvbiBIaXN0b3J5Um91dGVyKF9yZWYzKSB7CiAgICAgICAgICAgIHZhcgogICAgICAgICAgICAgIGJhc2VuYW1lID0KCgogICAgICAgICAgICAgIF9yZWYzLmJhc2VuYW1lLGNoaWxkcmVuID0gX3JlZjMuY2hpbGRyZW4saGlzdG9yeSA9IF9yZWYzLmhpc3Rvcnk7CiAgICAgICAgICAgIHZhciBfUmVhY3QkdXNlU3RhdGU1ID0gUmVhY3QudXNlU3RhdGUoewogICAgICAgICAgICAgICAgYWN0aW9uOiBoaXN0b3J5LmFjdGlvbiwKICAgICAgICAgICAgICAgIGxvY2F0aW9uOiBoaXN0b3J5LmxvY2F0aW9uCiAgICAgICAgICAgICAgfSksX1JlYWN0JHVzZVN0YXRlNiA9IF9zbGljZWRUb0FycmF5MihfUmVhY3QkdXNlU3RhdGU1LCAyKSxzdGF0ZSA9IF9SZWFjdCR1c2VTdGF0ZTZbMF0sc2V0U3RhdGUgPSBfUmVhY3QkdXNlU3RhdGU2WzFdOwogICAgICAgICAgICBSZWFjdC51c2VMYXlvdXRFZmZlY3QoKCkgPT4gaGlzdG9yeS5saXN0ZW4oc2V0U3RhdGUpLCBbaGlzdG9yeV0pOwogICAgICAgICAgICByZXR1cm4gLyojX19QVVJFX18qL1JlYWN0LmNyZWF0ZUVsZW1lbnQoUm91dGVyLCB7CiAgICAgICAgICAgICAgYmFzZW5hbWU6IGJhc2VuYW1lLAogICAgICAgICAgICAgIGNoaWxkcmVuOiBjaGlsZHJlbiwKICAgICAgICAgICAgICBsb2NhdGlvbjogc3RhdGUubG9jYXRpb24sCiAgICAgICAgICAgICAgbmF2aWdhdGlvblR5cGU6IHN0YXRlLmFjdGlvbiwKICAgICAgICAgICAgICBuYXZpZ2F0b3I6IGhpc3RvcnkKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKGZhbHNlKSB7fQogICAgICAgICAgLyoqCiAgICAgICAgICAgKiBUaGUgcHVibGljIEFQSSBmb3IgcmVuZGVyaW5nIGEgaGlzdG9yeS1hd2FyZSA8YT4uCiAgICAgICAgICAgKi8KCiAgICAgICAgICB2YXIgTGluayA9IC8qI19fUFVSRV9fKi9yZWFjdC5mb3J3YXJkUmVmKGZ1bmN0aW9uIExpbmtXaXRoUmVmKF9yZWY0LCByZWYpIHsKICAgICAgICAgICAgdmFyCiAgICAgICAgICAgICAgb25DbGljayA9CgoKCgoKCgogICAgICAgICAgICAgIF9yZWY0Lm9uQ2xpY2sscmVsYXRpdmUgPSBfcmVmNC5yZWxhdGl2ZSxyZWxvYWREb2N1bWVudCA9IF9yZWY0LnJlbG9hZERvY3VtZW50LHJlcGxhY2UgPSBfcmVmNC5yZXBsYWNlLHN0YXRlID0gX3JlZjQuc3RhdGUsdGFyZ2V0ID0gX3JlZjQudGFyZ2V0LHRvID0gX3JlZjQudG8scHJldmVudFNjcm9sbFJlc2V0ID0gX3JlZjQucHJldmVudFNjcm9sbFJlc2V0LAogICAgICAgICAgICAgIHJlc3QgPSBfb2JqZWN0V2l0aG91dFByb3BlcnRpZXNMb29zZShfcmVmNCwgX2V4Y2x1ZGVkKTsKCiAgICAgICAgICAgIHZhciBocmVmID0gdXNlSHJlZih0bywgewogICAgICAgICAgICAgIHJlbGF0aXZlOiByZWxhdGl2ZQogICAgICAgICAgICB9KTsKICAgICAgICAgICAgdmFyIGludGVybmFsT25DbGljayA9IHVzZUxpbmtDbGlja0hhbmRsZXIodG8sIHsKICAgICAgICAgICAgICByZXBsYWNlOiByZXBsYWNlLAogICAgICAgICAgICAgIHN0YXRlOiBzdGF0ZSwKICAgICAgICAgICAgICB0YXJnZXQ6IHRhcmdldCwKICAgICAgICAgICAgICBwcmV2ZW50U2Nyb2xsUmVzZXQ6IHByZXZlbnRTY3JvbGxSZXNldCwKICAgICAgICAgICAgICByZWxhdGl2ZTogcmVsYXRpdmUKICAgICAgICAgICAgfSk7CgogICAgICAgICAgICBmdW5jdGlvbiBoYW5kbGVDbGljayhldmVudCkgewogICAgICAgICAgICAgIGlmIChvbkNsaWNrKSBvbkNsaWNrKGV2ZW50KTsKCiAgICAgICAgICAgICAgaWYgKCFldmVudC5kZWZhdWx0UHJldmVudGVkKSB7CiAgICAgICAgICAgICAgICBpbnRlcm5hbE9uQ2xpY2soZXZlbnQpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuICgKICAgICAgICAgICAgICAvKiNfX1BVUkVfXyovCiAgICAgICAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIGpzeC1hMTF5L2FuY2hvci1oYXMtY29udGVudAogICAgICAgICAgICAgIHJlYWN0LmNyZWF0ZUVsZW1lbnQoImEiLCByZWFjdF9yb3V0ZXJfZG9tX2Rpc3RfZXh0ZW5kcyh7fSwgcmVzdCwgewogICAgICAgICAgICAgICAgaHJlZjogaHJlZiwKICAgICAgICAgICAgICAgIG9uQ2xpY2s6IHJlbG9hZERvY3VtZW50ID8gb25DbGljayA6IGhhbmRsZUNsaWNrLAogICAgICAgICAgICAgICAgcmVmOiByZWYsCiAgICAgICAgICAgICAgICB0YXJnZXQ6IHRhcmdldAogICAgICAgICAgICAgIH0pKSk7CgogICAgICAgICAgfSk7CgogICAgICAgICAgaWYgKGZhbHNlKSB7fQogICAgICAgICAgLyoqCiAgICAgICAgICAgKiBBIDxMaW5rPiB3cmFwcGVyIHRoYXQga25vd3MgaWYgaXQncyAiYWN0aXZlIiBvciBub3QuCiAgICAgICAgICAgKi8KCgogICAgICAgICAgdmFyIE5hdkxpbmsgPSAvKiNfX1BVUkVfXyovcmVhY3QuZm9yd2FyZFJlZihmdW5jdGlvbiBOYXZMaW5rV2l0aFJlZihfcmVmNSwgcmVmKSB7CiAgICAgICAgICAgIHZhciBfcmVmNSRhcmlhQ3VycmVudCA9CgoKCgoKCgogICAgICAgICAgICAgIF9yZWY1WyJhcmlhLWN1cnJlbnQiXSxhcmlhQ3VycmVudFByb3AgPSBfcmVmNSRhcmlhQ3VycmVudCA9PT0gdm9pZCAwID8gInBhZ2UiIDogX3JlZjUkYXJpYUN1cnJlbnQsX3JlZjUkY2FzZVNlbnNpdGl2ZSA9IF9yZWY1LmNhc2VTZW5zaXRpdmUsY2FzZVNlbnNpdGl2ZSA9IF9yZWY1JGNhc2VTZW5zaXRpdmUgPT09IHZvaWQgMCA/IGZhbHNlIDogX3JlZjUkY2FzZVNlbnNpdGl2ZSxfcmVmNSRjbGFzc05hbWUgPSBfcmVmNS5jbGFzc05hbWUsY2xhc3NOYW1lUHJvcCA9IF9yZWY1JGNsYXNzTmFtZSA9PT0gdm9pZCAwID8gIiIgOiBfcmVmNSRjbGFzc05hbWUsX3JlZjUkZW5kID0gX3JlZjUuZW5kLGVuZCA9IF9yZWY1JGVuZCA9PT0gdm9pZCAwID8gZmFsc2UgOiBfcmVmNSRlbmQsc3R5bGVQcm9wID0gX3JlZjUuc3R5bGUsdG8gPSBfcmVmNS50byxjaGlsZHJlbiA9IF9yZWY1LmNoaWxkcmVuLAogICAgICAgICAgICAgIHJlc3QgPSBfb2JqZWN0V2l0aG91dFByb3BlcnRpZXNMb29zZShfcmVmNSwgX2V4Y2x1ZGVkMik7CgogICAgICAgICAgICB2YXIgcGF0aCA9IGRpc3RfdXNlUmVzb2x2ZWRQYXRoKHRvLCB7CiAgICAgICAgICAgICAgcmVsYXRpdmU6IHJlc3QucmVsYXRpdmUKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIHZhciBsb2NhdGlvbiA9IGRpc3RfdXNlTG9jYXRpb24oKTsKICAgICAgICAgICAgdmFyIHJvdXRlclN0YXRlID0gcmVhY3QudXNlQ29udGV4dChEYXRhUm91dGVyU3RhdGVDb250ZXh0KTsKICAgICAgICAgICAgdmFyIHRvUGF0aG5hbWUgPSBwYXRoLnBhdGhuYW1lOwogICAgICAgICAgICB2YXIgbG9jYXRpb25QYXRobmFtZSA9IGxvY2F0aW9uLnBhdGhuYW1lOwogICAgICAgICAgICB2YXIgbmV4dExvY2F0aW9uUGF0aG5hbWUgPSByb3V0ZXJTdGF0ZSAmJiByb3V0ZXJTdGF0ZS5uYXZpZ2F0aW9uICYmIHJvdXRlclN0YXRlLm5hdmlnYXRpb24ubG9jYXRpb24gPyByb3V0ZXJTdGF0ZS5uYXZpZ2F0aW9uLmxvY2F0aW9uLnBhdGhuYW1lIDogbnVsbDsKCiAgICAgICAgICAgIGlmICghY2FzZVNlbnNpdGl2ZSkgewogICAgICAgICAgICAgIGxvY2F0aW9uUGF0aG5hbWUgPSBsb2NhdGlvblBhdGhuYW1lLnRvTG93ZXJDYXNlKCk7CiAgICAgICAgICAgICAgbmV4dExvY2F0aW9uUGF0aG5hbWUgPSBuZXh0TG9jYXRpb25QYXRobmFtZSA/IG5leHRMb2NhdGlvblBhdGhuYW1lLnRvTG93ZXJDYXNlKCkgOiBudWxsOwogICAgICAgICAgICAgIHRvUGF0aG5hbWUgPSB0b1BhdGhuYW1lLnRvTG93ZXJDYXNlKCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHZhciBpc0FjdGl2ZSA9IGxvY2F0aW9uUGF0aG5hbWUgPT09IHRvUGF0aG5hbWUgfHwgIWVuZCAmJiBsb2NhdGlvblBhdGhuYW1lLnN0YXJ0c1dpdGgodG9QYXRobmFtZSkgJiYgbG9jYXRpb25QYXRobmFtZS5jaGFyQXQodG9QYXRobmFtZS5sZW5ndGgpID09PSAiLyI7CiAgICAgICAgICAgIHZhciBpc1BlbmRpbmcgPSBuZXh0TG9jYXRpb25QYXRobmFtZSAhPSBudWxsICYmIChuZXh0TG9jYXRpb25QYXRobmFtZSA9PT0gdG9QYXRobmFtZSB8fCAhZW5kICYmIG5leHRMb2NhdGlvblBhdGhuYW1lLnN0YXJ0c1dpdGgodG9QYXRobmFtZSkgJiYgbmV4dExvY2F0aW9uUGF0aG5hbWUuY2hhckF0KHRvUGF0aG5hbWUubGVuZ3RoKSA9PT0gIi8iKTsKICAgICAgICAgICAgdmFyIGFyaWFDdXJyZW50ID0gaXNBY3RpdmUgPyBhcmlhQ3VycmVudFByb3AgOiB1bmRlZmluZWQ7CiAgICAgICAgICAgIHZhciBjbGFzc05hbWU7CgogICAgICAgICAgICBpZiAodHlwZW9mIGNsYXNzTmFtZVByb3AgPT09ICJmdW5jdGlvbiIpIHsKICAgICAgICAgICAgICBjbGFzc05hbWUgPSBjbGFzc05hbWVQcm9wKHsKICAgICAgICAgICAgICAgIGlzQWN0aXZlOiBpc0FjdGl2ZSwKICAgICAgICAgICAgICAgIGlzUGVuZGluZzogaXNQZW5kaW5nCiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgLy8gSWYgdGhlIGNsYXNzTmFtZSBwcm9wIGlzIG5vdCBhIGZ1bmN0aW9uLCB3ZSB1c2UgYSBkZWZhdWx0IGBhY3RpdmVgCiAgICAgICAgICAgICAgLy8gY2xhc3MgZm9yIDxOYXZMaW5rIC8+cyB0aGF0IGFyZSBhY3RpdmUuIEluIHY1IGBhY3RpdmVgIHdhcyB0aGUgZGVmYXVsdAogICAgICAgICAgICAgIC8vIHZhbHVlIGZvciBgYWN0aXZlQ2xhc3NOYW1lYCwgYnV0IHdlIGFyZSByZW1vdmluZyB0aGF0IEFQSSBhbmQgY2FuIHN0aWxsCiAgICAgICAgICAgICAgLy8gdXNlIHRoZSBvbGQgZGVmYXVsdCBiZWhhdmlvciBmb3IgYSBjbGVhbmVyIHVwZ3JhZGUgcGF0aCBhbmQga2VlcCB0aGUKICAgICAgICAgICAgICAvLyBzaW1wbGUgc3R5bGluZyBydWxlcyB3b3JraW5nIGFzIHRoZXkgY3VycmVudGx5IGRvLgogICAgICAgICAgICAgIGNsYXNzTmFtZSA9IFtjbGFzc05hbWVQcm9wLCBpc0FjdGl2ZSA/ICJhY3RpdmUiIDogbnVsbCwgaXNQZW5kaW5nID8gInBlbmRpbmciIDogbnVsbF0uZmlsdGVyKEJvb2xlYW4pLmpvaW4oIiAiKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdmFyIHN0eWxlID0gdHlwZW9mIHN0eWxlUHJvcCA9PT0gImZ1bmN0aW9uIiA/IHN0eWxlUHJvcCh7CiAgICAgICAgICAgICAgaXNBY3RpdmU6IGlzQWN0aXZlLAogICAgICAgICAgICAgIGlzUGVuZGluZzogaXNQZW5kaW5nCiAgICAgICAgICAgIH0pIDogc3R5bGVQcm9wOwogICAgICAgICAgICByZXR1cm4gLyojX19QVVJFX18qL3JlYWN0LmNyZWF0ZUVsZW1lbnQoTGluaywgcmVhY3Rfcm91dGVyX2RvbV9kaXN0X2V4dGVuZHMoe30sIHJlc3QsIHsKICAgICAgICAgICAgICAiYXJpYS1jdXJyZW50IjogYXJpYUN1cnJlbnQsCiAgICAgICAgICAgICAgY2xhc3NOYW1lOiBjbGFzc05hbWUsCiAgICAgICAgICAgICAgcmVmOiByZWYsCiAgICAgICAgICAgICAgc3R5bGU6IHN0eWxlLAogICAgICAgICAgICAgIHRvOiB0bwogICAgICAgICAgICB9KSwgdHlwZW9mIGNoaWxkcmVuID09PSAiZnVuY3Rpb24iID8gY2hpbGRyZW4oewogICAgICAgICAgICAgIGlzQWN0aXZlOiBpc0FjdGl2ZSwKICAgICAgICAgICAgICBpc1BlbmRpbmc6IGlzUGVuZGluZwogICAgICAgICAgICB9KSA6IGNoaWxkcmVuKTsKICAgICAgICAgIH0pOwoKICAgICAgICAgIGlmIChmYWxzZSkge30KICAgICAgICAgIC8qKgogICAgICAgICAgICogQSBgQHJlbWl4LXJ1bi9yb3V0ZXJgLWF3YXJlIGA8Zm9ybT5gLiBJdCBiZWhhdmVzIGxpa2UgYSBub3JtYWwgZm9ybSBleGNlcHQKICAgICAgICAgICAqIHRoYXQgdGhlIGludGVyYWN0aW9uIHdpdGggdGhlIHNlcnZlciBpcyB3aXRoIGBmZXRjaGAgaW5zdGVhZCBvZiBuZXcgZG9jdW1lbnQKICAgICAgICAgICAqIHJlcXVlc3RzLCBhbGxvd2luZyBjb21wb25lbnRzIHRvIGFkZCBuaWNlciBVWCB0byB0aGUgcGFnZSBhcyB0aGUgZm9ybSBpcwogICAgICAgICAgICogc3VibWl0dGVkIGFuZCByZXR1cm5zIHdpdGggZGF0YS4KICAgICAgICAgICAqLwoKCiAgICAgICAgICB2YXIgRm9ybSA9IC8qI19fUFVSRV9fKi8gLyogdW51c2VkIHB1cmUgZXhwcmVzc2lvbiBvciBzdXBlciAqL251bGwgJiYgUmVhY3QuZm9yd2FyZFJlZigocHJvcHMsIHJlZikgPT4gewogICAgICAgICAgICByZXR1cm4gLyojX19QVVJFX18qL1JlYWN0LmNyZWF0ZUVsZW1lbnQoRm9ybUltcGwsIHJlYWN0X3JvdXRlcl9kb21fZGlzdF9leHRlbmRzKHt9LCBwcm9wcywgewogICAgICAgICAgICAgIHJlZjogcmVmCiAgICAgICAgICAgIH0pKTsKICAgICAgICAgIH0pOwoKICAgICAgICAgIGlmIChmYWxzZSkge30KCiAgICAgICAgICB2YXIgRm9ybUltcGwgPSAvKiNfX1BVUkVfXyovIC8qIHVudXNlZCBwdXJlIGV4cHJlc3Npb24gb3Igc3VwZXIgKi9udWxsICYmIFJlYWN0LmZvcndhcmRSZWYoKF9yZWY2LCBmb3J3YXJkZWRSZWYpID0+IHsKICAgICAgICAgICAgdmFyCiAgICAgICAgICAgICAgcmVsb2FkRG9jdW1lbnQgPQoKCgoKCgoKICAgICAgICAgICAgICBfcmVmNi5yZWxvYWREb2N1bWVudCxyZXBsYWNlID0gX3JlZjYucmVwbGFjZSxfcmVmNiRtZXRob2QgPSBfcmVmNi5tZXRob2QsbWV0aG9kID0gX3JlZjYkbWV0aG9kID09PSB2b2lkIDAgPyBkZWZhdWx0TWV0aG9kIDogX3JlZjYkbWV0aG9kLGFjdGlvbiA9IF9yZWY2LmFjdGlvbixvblN1Ym1pdCA9IF9yZWY2Lm9uU3VibWl0LGZldGNoZXJLZXkgPSBfcmVmNi5mZXRjaGVyS2V5LHJvdXRlSWQgPSBfcmVmNi5yb3V0ZUlkLHJlbGF0aXZlID0gX3JlZjYucmVsYXRpdmUsCiAgICAgICAgICAgICAgcHJvcHMgPSBfb2JqZWN0V2l0aG91dFByb3BlcnRpZXNMb29zZShfcmVmNiwgX2V4Y2x1ZGVkMyk7CgogICAgICAgICAgICB2YXIgc3VibWl0ID0gdXNlU3VibWl0SW1wbChmZXRjaGVyS2V5LCByb3V0ZUlkKTsKICAgICAgICAgICAgdmFyIGZvcm1NZXRob2QgPSBtZXRob2QudG9Mb3dlckNhc2UoKSA9PT0gImdldCIgPyAiZ2V0IiA6ICJwb3N0IjsKICAgICAgICAgICAgdmFyIGZvcm1BY3Rpb24gPSB1c2VGb3JtQWN0aW9uKGFjdGlvbiwgewogICAgICAgICAgICAgIHJlbGF0aXZlOiByZWxhdGl2ZQogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIHZhciBzdWJtaXRIYW5kbGVyID0gKGV2ZW50KSA9PiB7CiAgICAgICAgICAgICAgb25TdWJtaXQgJiYgb25TdWJtaXQoZXZlbnQpOwogICAgICAgICAgICAgIGlmIChldmVudC5kZWZhdWx0UHJldmVudGVkKSByZXR1cm47CiAgICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTsKICAgICAgICAgICAgICB2YXIgc3VibWl0dGVyID0gZXZlbnQubmF0aXZlRXZlbnQuc3VibWl0dGVyOwogICAgICAgICAgICAgIHN1Ym1pdChzdWJtaXR0ZXIgfHwgZXZlbnQuY3VycmVudFRhcmdldCwgewogICAgICAgICAgICAgICAgbWV0aG9kOiBtZXRob2QsCiAgICAgICAgICAgICAgICByZXBsYWNlOiByZXBsYWNlLAogICAgICAgICAgICAgICAgcmVsYXRpdmU6IHJlbGF0aXZlCiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH07CgogICAgICAgICAgICByZXR1cm4gLyojX19QVVJFX18qL1JlYWN0LmNyZWF0ZUVsZW1lbnQoImZvcm0iLCByZWFjdF9yb3V0ZXJfZG9tX2Rpc3RfZXh0ZW5kcyh7CiAgICAgICAgICAgICAgcmVmOiBmb3J3YXJkZWRSZWYsCiAgICAgICAgICAgICAgbWV0aG9kOiBmb3JtTWV0aG9kLAogICAgICAgICAgICAgIGFjdGlvbjogZm9ybUFjdGlvbiwKICAgICAgICAgICAgICBvblN1Ym1pdDogcmVsb2FkRG9jdW1lbnQgPyBvblN1Ym1pdCA6IHN1Ym1pdEhhbmRsZXIKICAgICAgICAgICAgfSwgcHJvcHMpKTsKICAgICAgICAgIH0pOwoKICAgICAgICAgIGlmIChmYWxzZSkge30KICAgICAgICAgIC8qKgogICAgICAgICAgICogVGhpcyBjb21wb25lbnQgd2lsbCBlbXVsYXRlIHRoZSBicm93c2VyJ3Mgc2Nyb2xsIHJlc3RvcmF0aW9uIG9uIGxvY2F0aW9uCiAgICAgICAgICAgKiBjaGFuZ2VzLgogICAgICAgICAgICovCgoKICAgICAgICAgIGZ1bmN0aW9uIFNjcm9sbFJlc3RvcmF0aW9uKF9yZWY3KSB7CiAgICAgICAgICAgIHZhcgogICAgICAgICAgICAgIGdldEtleSA9CgogICAgICAgICAgICAgIF9yZWY3LmdldEtleSxzdG9yYWdlS2V5ID0gX3JlZjcuc3RvcmFnZUtleTsKICAgICAgICAgICAgdXNlU2Nyb2xsUmVzdG9yYXRpb24oewogICAgICAgICAgICAgIGdldEtleTogZ2V0S2V5LAogICAgICAgICAgICAgIHN0b3JhZ2VLZXk6IHN0b3JhZ2VLZXkKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgICAgfQoKICAgICAgICAgIGlmIChmYWxzZSkge30gLy8jZW5kcmVnaW9uCiAgICAgICAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwogICAgICAgICAgLy8jcmVnaW9uIEhvb2tzCiAgICAgICAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwoKCiAgICAgICAgICB2YXIgZGlzdF9EYXRhUm91dGVySG9vazsKCiAgICAgICAgICAoZnVuY3Rpb24gKERhdGFSb3V0ZXJIb29rKSB7CiAgICAgICAgICAgIERhdGFSb3V0ZXJIb29rWyJVc2VTY3JvbGxSZXN0b3JhdGlvbiJdID0gInVzZVNjcm9sbFJlc3RvcmF0aW9uIjsKICAgICAgICAgICAgRGF0YVJvdXRlckhvb2tbIlVzZVN1Ym1pdEltcGwiXSA9ICJ1c2VTdWJtaXRJbXBsIjsKICAgICAgICAgICAgRGF0YVJvdXRlckhvb2tbIlVzZUZldGNoZXIiXSA9ICJ1c2VGZXRjaGVyIjsKICAgICAgICAgIH0pKGRpc3RfRGF0YVJvdXRlckhvb2sgfHwgKGRpc3RfRGF0YVJvdXRlckhvb2sgPSB7fSkpOwoKICAgICAgICAgIHZhciBkaXN0X0RhdGFSb3V0ZXJTdGF0ZUhvb2s7CgogICAgICAgICAgKGZ1bmN0aW9uIChEYXRhUm91dGVyU3RhdGVIb29rKSB7CiAgICAgICAgICAgIERhdGFSb3V0ZXJTdGF0ZUhvb2tbIlVzZUZldGNoZXJzIl0gPSAidXNlRmV0Y2hlcnMiOwogICAgICAgICAgICBEYXRhUm91dGVyU3RhdGVIb29rWyJVc2VTY3JvbGxSZXN0b3JhdGlvbiJdID0gInVzZVNjcm9sbFJlc3RvcmF0aW9uIjsKICAgICAgICAgIH0pKGRpc3RfRGF0YVJvdXRlclN0YXRlSG9vayB8fCAoZGlzdF9EYXRhUm91dGVyU3RhdGVIb29rID0ge30pKTsKCiAgICAgICAgICBmdW5jdGlvbiBkaXN0X2dldERhdGFSb3V0ZXJDb25zb2xlRXJyb3IoaG9va05hbWUpIHsKICAgICAgICAgICAgcmV0dXJuIGhvb2tOYW1lICsgIiBtdXN0IGJlIHVzZWQgd2l0aGluIGEgZGF0YSByb3V0ZXIuICBTZWUgaHR0cHM6Ly9yZWFjdHJvdXRlci5jb20vZW4vbWFpbi9yb3V0ZXJzL3BpY2tpbmctYS1yb3V0ZXIuIjsKICAgICAgICAgIH0KCiAgICAgICAgICBmdW5jdGlvbiBkaXN0X3VzZURhdGFSb3V0ZXJDb250ZXh0KGhvb2tOYW1lKSB7CiAgICAgICAgICAgIHZhciBjdHggPSBSZWFjdC51c2VDb250ZXh0KFVOU0FGRV9EYXRhUm91dGVyQ29udGV4dCk7CiAgICAgICAgICAgICFjdHggPyBmYWxzZSA/IDAgOiBpbnZhcmlhbnQoZmFsc2UpIDogdm9pZCAwOwogICAgICAgICAgICByZXR1cm4gY3R4OwogICAgICAgICAgfQoKICAgICAgICAgIGZ1bmN0aW9uIGRpc3RfdXNlRGF0YVJvdXRlclN0YXRlKGhvb2tOYW1lKSB7CiAgICAgICAgICAgIHZhciBzdGF0ZSA9IFJlYWN0LnVzZUNvbnRleHQoVU5TQUZFX0RhdGFSb3V0ZXJTdGF0ZUNvbnRleHQpOwogICAgICAgICAgICAhc3RhdGUgPyBmYWxzZSA/IDAgOiBpbnZhcmlhbnQoZmFsc2UpIDogdm9pZCAwOwogICAgICAgICAgICByZXR1cm4gc3RhdGU7CiAgICAgICAgICB9CiAgICAgICAgICAvKioKICAgICAgICAgICAqIEhhbmRsZXMgdGhlIGNsaWNrIGJlaGF2aW9yIGZvciByb3V0ZXIgYDxMaW5rPmAgY29tcG9uZW50cy4gVGhpcyBpcyB1c2VmdWwgaWYKICAgICAgICAgICAqIHlvdSBuZWVkIHRvIGNyZWF0ZSBjdXN0b20gYDxMaW5rPmAgY29tcG9uZW50cyB3aXRoIHRoZSBzYW1lIGNsaWNrIGJlaGF2aW9yIHdlCiAgICAgICAgICAgKiB1c2UgaW4gb3VyIGV4cG9ydGVkIGA8TGluaz5gLgogICAgICAgICAgICovCgoKICAgICAgICAgIGZ1bmN0aW9uIHVzZUxpbmtDbGlja0hhbmRsZXIodG8sIF90ZW1wKSB7CiAgICAgICAgICAgIHZhciBfcmVmMjcgPQoKCgoKCiAgICAgICAgICAgICAgX3RlbXAgPT09IHZvaWQgMCA/IHt9IDogX3RlbXAsdGFyZ2V0ID0gX3JlZjI3LnRhcmdldCxyZXBsYWNlUHJvcCA9IF9yZWYyNy5yZXBsYWNlLHN0YXRlID0gX3JlZjI3LnN0YXRlLHByZXZlbnRTY3JvbGxSZXNldCA9IF9yZWYyNy5wcmV2ZW50U2Nyb2xsUmVzZXQscmVsYXRpdmUgPSBfcmVmMjcucmVsYXRpdmU7CiAgICAgICAgICAgIHZhciBuYXZpZ2F0ZSA9IGRpc3RfdXNlTmF2aWdhdGUoKTsKICAgICAgICAgICAgdmFyIGxvY2F0aW9uID0gZGlzdF91c2VMb2NhdGlvbigpOwogICAgICAgICAgICB2YXIgcGF0aCA9IGRpc3RfdXNlUmVzb2x2ZWRQYXRoKHRvLCB7CiAgICAgICAgICAgICAgcmVsYXRpdmU6IHJlbGF0aXZlCiAgICAgICAgICAgIH0pOwogICAgICAgICAgICByZXR1cm4gcmVhY3QudXNlQ2FsbGJhY2soKGV2ZW50KSA9PiB7CiAgICAgICAgICAgICAgaWYgKHNob3VsZFByb2Nlc3NMaW5rQ2xpY2soZXZlbnQsIHRhcmdldCkpIHsKICAgICAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7IC8vIElmIHRoZSBVUkwgaGFzbid0IGNoYW5nZWQsIGEgcmVndWxhciA8YT4gd2lsbCBkbyBhIHJlcGxhY2UgaW5zdGVhZCBvZgogICAgICAgICAgICAgICAgLy8gYSBwdXNoLCBzbyBkbyB0aGUgc2FtZSBoZXJlIHVubGVzcyB0aGUgcmVwbGFjZSBwcm9wIGlzIGV4cGxpY2l0bHkgc2V0CgogICAgICAgICAgICAgICAgdmFyIHJlcGxhY2UgPSByZXBsYWNlUHJvcCAhPT0gdW5kZWZpbmVkID8gcmVwbGFjZVByb3AgOiByb3V0ZXJfY3JlYXRlUGF0aChsb2NhdGlvbikgPT09IHJvdXRlcl9jcmVhdGVQYXRoKHBhdGgpOwogICAgICAgICAgICAgICAgbmF2aWdhdGUodG8sIHsKICAgICAgICAgICAgICAgICAgcmVwbGFjZTogcmVwbGFjZSwKICAgICAgICAgICAgICAgICAgc3RhdGU6IHN0YXRlLAogICAgICAgICAgICAgICAgICBwcmV2ZW50U2Nyb2xsUmVzZXQ6IHByZXZlbnRTY3JvbGxSZXNldCwKICAgICAgICAgICAgICAgICAgcmVsYXRpdmU6IHJlbGF0aXZlCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sIFtsb2NhdGlvbiwgbmF2aWdhdGUsIHBhdGgsIHJlcGxhY2VQcm9wLCBzdGF0ZSwgdGFyZ2V0LCB0bywgcHJldmVudFNjcm9sbFJlc2V0LCByZWxhdGl2ZV0pOwogICAgICAgICAgfQogICAgICAgICAgLyoqCiAgICAgICAgICAgKiBBIGNvbnZlbmllbnQgd3JhcHBlciBmb3IgcmVhZGluZyBhbmQgd3JpdGluZyBzZWFyY2ggcGFyYW1ldGVycyB2aWEgdGhlCiAgICAgICAgICAgKiBVUkxTZWFyY2hQYXJhbXMgaW50ZXJmYWNlLgogICAgICAgICAgICovCgogICAgICAgICAgZnVuY3Rpb24gdXNlU2VhcmNoUGFyYW1zKGRlZmF1bHRJbml0KSB7CiAgICAgICAgICAgIGZhbHNlID8gMCA6IHZvaWQgMDsKICAgICAgICAgICAgdmFyIGRlZmF1bHRTZWFyY2hQYXJhbXNSZWYgPSBSZWFjdC51c2VSZWYoY3JlYXRlU2VhcmNoUGFyYW1zKGRlZmF1bHRJbml0KSk7CiAgICAgICAgICAgIHZhciBsb2NhdGlvbiA9IHVzZUxvY2F0aW9uKCk7CiAgICAgICAgICAgIHZhciBzZWFyY2hQYXJhbXMgPSBSZWFjdC51c2VNZW1vKCgpID0+IGdldFNlYXJjaFBhcmFtc0ZvckxvY2F0aW9uKGxvY2F0aW9uLnNlYXJjaCwgZGVmYXVsdFNlYXJjaFBhcmFtc1JlZi5jdXJyZW50KSwgW2xvY2F0aW9uLnNlYXJjaF0pOwogICAgICAgICAgICB2YXIgbmF2aWdhdGUgPSB1c2VOYXZpZ2F0ZSgpOwogICAgICAgICAgICB2YXIgc2V0U2VhcmNoUGFyYW1zID0gUmVhY3QudXNlQ2FsbGJhY2soKG5leHRJbml0LCBuYXZpZ2F0ZU9wdGlvbnMpID0+IHsKICAgICAgICAgICAgICB2YXIgbmV3U2VhcmNoUGFyYW1zID0gY3JlYXRlU2VhcmNoUGFyYW1zKHR5cGVvZiBuZXh0SW5pdCA9PT0gImZ1bmN0aW9uIiA/IG5leHRJbml0KHNlYXJjaFBhcmFtcykgOiBuZXh0SW5pdCk7CiAgICAgICAgICAgICAgbmF2aWdhdGUoIj8iICsgbmV3U2VhcmNoUGFyYW1zLCBuYXZpZ2F0ZU9wdGlvbnMpOwogICAgICAgICAgICB9LCBbbmF2aWdhdGUsIHNlYXJjaFBhcmFtc10pOwogICAgICAgICAgICByZXR1cm4gW3NlYXJjaFBhcmFtcywgc2V0U2VhcmNoUGFyYW1zXTsKICAgICAgICAgIH0KICAgICAgICAgIC8qKgogICAgICAgICAgICogUmV0dXJucyBhIGZ1bmN0aW9uIHRoYXQgbWF5IGJlIHVzZWQgdG8gcHJvZ3JhbW1hdGljYWxseSBzdWJtaXQgYSBmb3JtIChvcgogICAgICAgICAgICogc29tZSBhcmJpdHJhcnkgZGF0YSkgdG8gdGhlIHNlcnZlci4KICAgICAgICAgICAqLwoKICAgICAgICAgIGZ1bmN0aW9uIHVzZVN1Ym1pdCgpIHsKICAgICAgICAgICAgcmV0dXJuIHVzZVN1Ym1pdEltcGwoKTsKICAgICAgICAgIH0KCiAgICAgICAgICBmdW5jdGlvbiB1c2VTdWJtaXRJbXBsKGZldGNoZXJLZXksIHJvdXRlSWQpIHsKICAgICAgICAgICAgdmFyIF9kaXN0X3VzZURhdGFSb3V0ZXJDbyA9CgogICAgICAgICAgICAgIGRpc3RfdXNlRGF0YVJvdXRlckNvbnRleHQoZGlzdF9EYXRhUm91dGVySG9vay5Vc2VTdWJtaXRJbXBsKSxyb3V0ZXIgPSBfZGlzdF91c2VEYXRhUm91dGVyQ28ucm91dGVyOwogICAgICAgICAgICB2YXIgZGVmYXVsdEFjdGlvbiA9IHVzZUZvcm1BY3Rpb24oKTsKICAgICAgICAgICAgcmV0dXJuIFJlYWN0LnVzZUNhbGxiYWNrKGZ1bmN0aW9uICh0YXJnZXQsIG9wdGlvbnMpIHsKICAgICAgICAgICAgICBpZiAob3B0aW9ucyA9PT0gdm9pZCAwKSB7CiAgICAgICAgICAgICAgICBvcHRpb25zID0ge307CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBpZiAodHlwZW9mIGRvY3VtZW50ID09PSAidW5kZWZpbmVkIikgewogICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJZb3UgYXJlIGNhbGxpbmcgc3VibWl0IGR1cmluZyB0aGUgc2VydmVyIHJlbmRlci4gIiArICJUcnkgY2FsbGluZyBzdWJtaXQgd2l0aGluIGEgYHVzZUVmZmVjdGAgb3IgY2FsbGJhY2sgaW5zdGVhZC4iKTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIHZhciBfZ2V0Rm9ybVN1Ym1pc3Npb25JbmYgPQoKCgoKICAgICAgICAgICAgICAgIGdldEZvcm1TdWJtaXNzaW9uSW5mbyh0YXJnZXQsIGRlZmF1bHRBY3Rpb24sIG9wdGlvbnMpLG1ldGhvZCA9IF9nZXRGb3JtU3VibWlzc2lvbkluZi5tZXRob2QsZW5jVHlwZSA9IF9nZXRGb3JtU3VibWlzc2lvbkluZi5lbmNUeXBlLGZvcm1EYXRhID0gX2dldEZvcm1TdWJtaXNzaW9uSW5mLmZvcm1EYXRhLHVybCA9IF9nZXRGb3JtU3VibWlzc2lvbkluZi51cmw7CiAgICAgICAgICAgICAgdmFyIGhyZWYgPSB1cmwucGF0aG5hbWUgKyB1cmwuc2VhcmNoOwogICAgICAgICAgICAgIHZhciBvcHRzID0gewogICAgICAgICAgICAgICAgcmVwbGFjZTogb3B0aW9ucy5yZXBsYWNlLAogICAgICAgICAgICAgICAgZm9ybURhdGE6IGZvcm1EYXRhLAogICAgICAgICAgICAgICAgZm9ybU1ldGhvZDogbWV0aG9kLAogICAgICAgICAgICAgICAgZm9ybUVuY1R5cGU6IGVuY1R5cGUKICAgICAgICAgICAgICB9OwoKICAgICAgICAgICAgICBpZiAoZmV0Y2hlcktleSkgewogICAgICAgICAgICAgICAgIShyb3V0ZUlkICE9IG51bGwpID8gZmFsc2UgPyAwIDogaW52YXJpYW50KGZhbHNlKSA6IHZvaWQgMDsKICAgICAgICAgICAgICAgIHJvdXRlci5mZXRjaChmZXRjaGVyS2V5LCByb3V0ZUlkLCBocmVmLCBvcHRzKTsKICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgcm91dGVyLm5hdmlnYXRlKGhyZWYsIG9wdHMpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwgW2RlZmF1bHRBY3Rpb24sIHJvdXRlciwgZmV0Y2hlcktleSwgcm91dGVJZF0pOwogICAgICAgICAgfQoKICAgICAgICAgIGZ1bmN0aW9uIHVzZUZvcm1BY3Rpb24oYWN0aW9uLCBfdGVtcDIpIHsKICAgICAgICAgICAgdmFyIF9yZWYyOCA9CgogICAgICAgICAgICAgIF90ZW1wMiA9PT0gdm9pZCAwID8ge30gOiBfdGVtcDIscmVsYXRpdmUgPSBfcmVmMjgucmVsYXRpdmU7CiAgICAgICAgICAgIHZhciBfUmVhY3QkdXNlQ29udGV4dDIgPQoKICAgICAgICAgICAgICBSZWFjdC51c2VDb250ZXh0KFVOU0FGRV9OYXZpZ2F0aW9uQ29udGV4dCksYmFzZW5hbWUgPSBfUmVhY3QkdXNlQ29udGV4dDIuYmFzZW5hbWU7CiAgICAgICAgICAgIHZhciByb3V0ZUNvbnRleHQgPSBSZWFjdC51c2VDb250ZXh0KFVOU0FGRV9Sb3V0ZUNvbnRleHQpOwogICAgICAgICAgICAhcm91dGVDb250ZXh0ID8gZmFsc2UgPyAwIDogaW52YXJpYW50KGZhbHNlKSA6IHZvaWQgMDsKICAgICAgICAgICAgdmFyIF9yb3V0ZUNvbnRleHQkbWF0Y2hlcyA9IHJvdXRlQ29udGV4dC5tYXRjaGVzLnNsaWNlKC0xKSxfcm91dGVDb250ZXh0JG1hdGNoZXMyID0gX3NsaWNlZFRvQXJyYXkyKF9yb3V0ZUNvbnRleHQkbWF0Y2hlcywgMSksbWF0Y2ggPSBfcm91dGVDb250ZXh0JG1hdGNoZXMyWzBdOwogICAgICAgICAgICB2YXIgcmVzb2x2ZWRBY3Rpb24gPSBhY3Rpb24gIT0gbnVsbCA/IGFjdGlvbiA6ICIuIjsgLy8gU2hhbGxvdyBjbG9uZSBwYXRoIHNvIHdlIGNhbiBtb2RpZnkgaXQgYmVsb3csIG90aGVyd2lzZSB3ZSBtb2RpZnkgdGhlCiAgICAgICAgICAgIC8vIG9iamVjdCByZWZlcmVuY2VkIGJ5IHVzZU1lbW8gaW5zaWRlIHVzZVJlc29sdmVkUGF0aAoKICAgICAgICAgICAgdmFyIHBhdGggPSByZWFjdF9yb3V0ZXJfZG9tX2Rpc3RfZXh0ZW5kcyh7fSwgdXNlUmVzb2x2ZWRQYXRoKHJlc29sdmVkQWN0aW9uLCB7CiAgICAgICAgICAgICAgcmVsYXRpdmU6IHJlbGF0aXZlCiAgICAgICAgICAgIH0pKTsgLy8gUHJldmlvdXNseSB3ZSBzZXQgdGhlIGRlZmF1bHQgYWN0aW9uIHRvICIuIi4gVGhlIHByb2JsZW0gd2l0aCB0aGlzIGlzIHRoYXQKICAgICAgICAgICAgLy8gYHVzZVJlc29sdmVkUGF0aCgiLiIpYCBleGNsdWRlcyBzZWFyY2ggcGFyYW1zIGFuZCB0aGUgaGFzaCBvZiB0aGUgcmVzb2x2ZWQKICAgICAgICAgICAgLy8gVVJMLiBUaGlzIGlzIHRoZSBpbnRlbmRlZCBiZWhhdmlvciBvZiB3aGVuICIuIiBpcyBzcGVjaWZpY2FsbHkgcHJvdmlkZWQgYXMKICAgICAgICAgICAgLy8gdGhlIGZvcm0gYWN0aW9uLCBidXQgaW5jb25zaXN0ZW50IHcvIGJyb3dzZXJzIHdoZW4gdGhlIGFjdGlvbiBpcyBvbWl0dGVkLgogICAgICAgICAgICAvLyBodHRwczovL2dpdGh1Yi5jb20vcmVtaXgtcnVuL3JlbWl4L2lzc3Vlcy85MjcKCgogICAgICAgICAgICB2YXIgbG9jYXRpb24gPSB1c2VMb2NhdGlvbigpOwoKICAgICAgICAgICAgaWYgKGFjdGlvbiA9PSBudWxsKSB7CiAgICAgICAgICAgICAgLy8gU2FmZSB0byB3cml0ZSB0byB0aGVzZSBkaXJlY3RseSBoZXJlIHNpbmNlIGlmIGFjdGlvbiB3YXMgdW5kZWZpbmVkLCB3ZQogICAgICAgICAgICAgIC8vIHdvdWxkIGhhdmUgY2FsbGVkIHVzZVJlc29sdmVkUGF0aCgiLiIpIHdoaWNoIHdpbGwgbmV2ZXIgaW5jbHVkZSBhIHNlYXJjaAogICAgICAgICAgICAgIC8vIG9yIGhhc2gKICAgICAgICAgICAgICBwYXRoLnNlYXJjaCA9IGxvY2F0aW9uLnNlYXJjaDsKICAgICAgICAgICAgICBwYXRoLmhhc2ggPSBsb2NhdGlvbi5oYXNoOyAvLyBXaGVuIGdyYWJiaW5nIHNlYXJjaCBwYXJhbXMgZnJvbSB0aGUgVVJMLCByZW1vdmUgdGhlIGF1dG9tYXRpY2FsbHkKICAgICAgICAgICAgICAvLyBpbnNlcnRlZCA/aW5kZXggcGFyYW0gc28gd2UgbWF0Y2ggdGhlIHVzZVJlc29sdmVkUGF0aCBzZWFyY2ggYmVoYXZpb3IKICAgICAgICAgICAgICAvLyB3aGljaCB3b3VsZCBub3QgaW5jbHVkZSA/aW5kZXgKCiAgICAgICAgICAgICAgaWYgKG1hdGNoLnJvdXRlLmluZGV4KSB7CiAgICAgICAgICAgICAgICB2YXIgcGFyYW1zID0gbmV3IFVSTFNlYXJjaFBhcmFtcyhwYXRoLnNlYXJjaCk7CiAgICAgICAgICAgICAgICBwYXJhbXMuZGVsZXRlKCJpbmRleCIpOwogICAgICAgICAgICAgICAgcGF0aC5zZWFyY2ggPSBwYXJhbXMudG9TdHJpbmcoKSA/ICI/IiArIHBhcmFtcy50b1N0cmluZygpIDogIiI7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoKCFhY3Rpb24gfHwgYWN0aW9uID09PSAiLiIpICYmIG1hdGNoLnJvdXRlLmluZGV4KSB7CiAgICAgICAgICAgICAgcGF0aC5zZWFyY2ggPSBwYXRoLnNlYXJjaCA/IHBhdGguc2VhcmNoLnJlcGxhY2UoL15cPy8sICI/aW5kZXgmIikgOiAiP2luZGV4IjsKICAgICAgICAgICAgfSAvLyBJZiB3ZSdyZSBvcGVyYXRpbmcgd2l0aGluIGEgYmFzZW5hbWUsIHByZXBlbmQgaXQgdG8gdGhlIHBhdGhuYW1lIHByaW9yCiAgICAgICAgICAgIC8vIHRvIGNyZWF0aW5nIHRoZSBmb3JtIGFjdGlvbi4gIElmIHRoaXMgaXMgYSByb290IG5hdmlnYXRpb24sIHRoZW4ganVzdCB1c2UKICAgICAgICAgICAgLy8gdGhlIHJhdyBiYXNlbmFtZSB3aGljaCBhbGxvd3MgdGhlIGJhc2VuYW1lIHRvIGhhdmUgZnVsbCBjb250cm9sIG92ZXIgdGhlCiAgICAgICAgICAgIC8vIHByZXNlbmNlIG9mIGEgdHJhaWxpbmcgc2xhc2ggb24gcm9vdCBhY3Rpb25zCgoKICAgICAgICAgICAgaWYgKGJhc2VuYW1lICE9PSAiLyIpIHsKICAgICAgICAgICAgICBwYXRoLnBhdGhuYW1lID0gcGF0aC5wYXRobmFtZSA9PT0gIi8iID8gYmFzZW5hbWUgOiBqb2luUGF0aHMoW2Jhc2VuYW1lLCBwYXRoLnBhdGhuYW1lXSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybiBjcmVhdGVQYXRoKHBhdGgpOwogICAgICAgICAgfQoKICAgICAgICAgIGZ1bmN0aW9uIGNyZWF0ZUZldGNoZXJGb3JtKGZldGNoZXJLZXksIHJvdXRlSWQpIHsKICAgICAgICAgICAgdmFyIEZldGNoZXJGb3JtID0gLyojX19QVVJFX18qL1JlYWN0LmZvcndhcmRSZWYoKHByb3BzLCByZWYpID0+IHsKICAgICAgICAgICAgICByZXR1cm4gLyojX19QVVJFX18qL1JlYWN0LmNyZWF0ZUVsZW1lbnQoRm9ybUltcGwsIHJlYWN0X3JvdXRlcl9kb21fZGlzdF9leHRlbmRzKHt9LCBwcm9wcywgewogICAgICAgICAgICAgICAgcmVmOiByZWYsCiAgICAgICAgICAgICAgICBmZXRjaGVyS2V5OiBmZXRjaGVyS2V5LAogICAgICAgICAgICAgICAgcm91dGVJZDogcm91dGVJZAogICAgICAgICAgICAgIH0pKTsKICAgICAgICAgICAgfSk7CgogICAgICAgICAgICBpZiAoZmFsc2UpIHt9CgogICAgICAgICAgICByZXR1cm4gRmV0Y2hlckZvcm07CiAgICAgICAgICB9CgogICAgICAgICAgdmFyIGZldGNoZXJJZCA9IDA7CiAgICAgICAgICAvKioKICAgICAgICAgICAqIEludGVyYWN0cyB3aXRoIHJvdXRlIGxvYWRlcnMgYW5kIGFjdGlvbnMgd2l0aG91dCBjYXVzaW5nIGEgbmF2aWdhdGlvbi4gR3JlYXQKICAgICAgICAgICAqIGZvciBhbnkgaW50ZXJhY3Rpb24gdGhhdCBzdGF5cyBvbiB0aGUgc2FtZSBwYWdlLgogICAgICAgICAgICovCgogICAgICAgICAgZnVuY3Rpb24gdXNlRmV0Y2hlcigpIHsKICAgICAgICAgICAgdmFyIF9yb3V0ZSRtYXRjaGVzOwoKICAgICAgICAgICAgdmFyIF9kaXN0X3VzZURhdGFSb3V0ZXJDbzIgPQoKICAgICAgICAgICAgICBkaXN0X3VzZURhdGFSb3V0ZXJDb250ZXh0KGRpc3RfRGF0YVJvdXRlckhvb2suVXNlRmV0Y2hlcikscm91dGVyID0gX2Rpc3RfdXNlRGF0YVJvdXRlckNvMi5yb3V0ZXI7CiAgICAgICAgICAgIHZhciByb3V0ZSA9IFJlYWN0LnVzZUNvbnRleHQoVU5TQUZFX1JvdXRlQ29udGV4dCk7CiAgICAgICAgICAgICFyb3V0ZSA/IGZhbHNlID8gMCA6IGludmFyaWFudChmYWxzZSkgOiB2b2lkIDA7CiAgICAgICAgICAgIHZhciByb3V0ZUlkID0gKF9yb3V0ZSRtYXRjaGVzID0gcm91dGUubWF0Y2hlc1tyb3V0ZS5tYXRjaGVzLmxlbmd0aCAtIDFdKSA9PSBudWxsID8gdm9pZCAwIDogX3JvdXRlJG1hdGNoZXMucm91dGUuaWQ7CiAgICAgICAgICAgICEocm91dGVJZCAhPSBudWxsKSA/IGZhbHNlID8gMCA6IGludmFyaWFudChmYWxzZSkgOiB2b2lkIDA7CiAgICAgICAgICAgIHZhciBfUmVhY3QkdXNlU3RhdGU3ID0gUmVhY3QudXNlU3RhdGUoKCkgPT4gU3RyaW5nKCsrZmV0Y2hlcklkKSksX1JlYWN0JHVzZVN0YXRlOCA9IF9zbGljZWRUb0FycmF5MihfUmVhY3QkdXNlU3RhdGU3LCAxKSxmZXRjaGVyS2V5ID0gX1JlYWN0JHVzZVN0YXRlOFswXTsKICAgICAgICAgICAgdmFyIF9SZWFjdCR1c2VTdGF0ZTkgPSBSZWFjdC51c2VTdGF0ZSgoKSA9PiB7CiAgICAgICAgICAgICAgICAhcm91dGVJZCA/IGZhbHNlID8gMCA6IGludmFyaWFudChmYWxzZSkgOiB2b2lkIDA7CiAgICAgICAgICAgICAgICByZXR1cm4gY3JlYXRlRmV0Y2hlckZvcm0oZmV0Y2hlcktleSwgcm91dGVJZCk7CiAgICAgICAgICAgICAgfSksX1JlYWN0JHVzZVN0YXRlMTAgPSBfc2xpY2VkVG9BcnJheTIoX1JlYWN0JHVzZVN0YXRlOSwgMSksRm9ybSA9IF9SZWFjdCR1c2VTdGF0ZTEwWzBdOwogICAgICAgICAgICB2YXIgX1JlYWN0JHVzZVN0YXRlMTEgPSBSZWFjdC51c2VTdGF0ZSgoKSA9PiAoaHJlZikgPT4gewogICAgICAgICAgICAgICAgIXJvdXRlciA/IGZhbHNlID8gMCA6IGludmFyaWFudChmYWxzZSkgOiB2b2lkIDA7CiAgICAgICAgICAgICAgICAhcm91dGVJZCA/IGZhbHNlID8gMCA6IGludmFyaWFudChmYWxzZSkgOiB2b2lkIDA7CiAgICAgICAgICAgICAgICByb3V0ZXIuZmV0Y2goZmV0Y2hlcktleSwgcm91dGVJZCwgaHJlZik7CiAgICAgICAgICAgICAgfSksX1JlYWN0JHVzZVN0YXRlMTIgPSBfc2xpY2VkVG9BcnJheTIoX1JlYWN0JHVzZVN0YXRlMTEsIDEpLGxvYWQgPSBfUmVhY3QkdXNlU3RhdGUxMlswXTsKICAgICAgICAgICAgdmFyIHN1Ym1pdCA9IHVzZVN1Ym1pdEltcGwoZmV0Y2hlcktleSwgcm91dGVJZCk7CiAgICAgICAgICAgIHZhciBmZXRjaGVyID0gcm91dGVyLmdldEZldGNoZXIoZmV0Y2hlcktleSk7CiAgICAgICAgICAgIHZhciBmZXRjaGVyV2l0aENvbXBvbmVudHMgPSBSZWFjdC51c2VNZW1vKCgpID0+IHJlYWN0X3JvdXRlcl9kb21fZGlzdF9leHRlbmRzKHsKICAgICAgICAgICAgICBGb3JtOiBGb3JtLAogICAgICAgICAgICAgIHN1Ym1pdDogc3VibWl0LAogICAgICAgICAgICAgIGxvYWQ6IGxvYWQKICAgICAgICAgICAgfSwgZmV0Y2hlciksIFtmZXRjaGVyLCBGb3JtLCBzdWJtaXQsIGxvYWRdKTsKICAgICAgICAgICAgUmVhY3QudXNlRWZmZWN0KCgpID0+IHsKICAgICAgICAgICAgICAvLyBJcyB0aGlzIGJ1c3RlZCB3aGVuIHRoZSBSZWFjdCB0ZWFtIGdldHMgcmVhbCB3ZWlyZCBhbmQgY2FsbHMgZWZmZWN0cwogICAgICAgICAgICAgIC8vIHR3aWNlIG9uIG1vdW50PyAgV2UgcmVhbGx5IGp1c3QgbmVlZCB0byBnYXJiYWdlIGNvbGxlY3QgaGVyZSB3aGVuIHRoaXMKICAgICAgICAgICAgICAvLyBmZXRjaGVyIGlzIG5vIGxvbmdlciBhcm91bmQuCiAgICAgICAgICAgICAgcmV0dXJuICgpID0+IHsKICAgICAgICAgICAgICAgIGlmICghcm91dGVyKSB7CiAgICAgICAgICAgICAgICAgIGNvbnNvbGUud2FybigiTm8gZmV0Y2hlciBhdmFpbGFibGUgdG8gY2xlYW4gdXAgZnJvbSB1c2VGZXRjaGVyKCkiKTsKICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHJvdXRlci5kZWxldGVGZXRjaGVyKGZldGNoZXJLZXkpOwogICAgICAgICAgICAgIH07CiAgICAgICAgICAgIH0sIFtyb3V0ZXIsIGZldGNoZXJLZXldKTsKICAgICAgICAgICAgcmV0dXJuIGZldGNoZXJXaXRoQ29tcG9uZW50czsKICAgICAgICAgIH0KICAgICAgICAgIC8qKgogICAgICAgICAgICogUHJvdmlkZXMgYWxsIGZldGNoZXJzIGN1cnJlbnRseSBvbiB0aGUgcGFnZS4gVXNlZnVsIGZvciBsYXlvdXRzIGFuZCBwYXJlbnQKICAgICAgICAgICAqIHJvdXRlcyB0aGF0IG5lZWQgdG8gcHJvdmlkZSBwZW5kaW5nL29wdGltaXN0aWMgVUkgcmVnYXJkaW5nIHRoZSBmZXRjaC4KICAgICAgICAgICAqLwoKICAgICAgICAgIGZ1bmN0aW9uIHVzZUZldGNoZXJzKCkgewogICAgICAgICAgICB2YXIgc3RhdGUgPSBkaXN0X3VzZURhdGFSb3V0ZXJTdGF0ZShkaXN0X0RhdGFSb3V0ZXJTdGF0ZUhvb2suVXNlRmV0Y2hlcnMpOwogICAgICAgICAgICByZXR1cm4gX3RvQ29uc3VtYWJsZUFycmF5MihzdGF0ZS5mZXRjaGVycy52YWx1ZXMoKSk7CiAgICAgICAgICB9CiAgICAgICAgICB2YXIgU0NST0xMX1JFU1RPUkFUSU9OX1NUT1JBR0VfS0VZID0gInJlYWN0LXJvdXRlci1zY3JvbGwtcG9zaXRpb25zIjsKICAgICAgICAgIHZhciBzYXZlZFNjcm9sbFBvc2l0aW9ucyA9IHt9OwogICAgICAgICAgLyoqCiAgICAgICAgICAgKiBXaGVuIHJlbmRlcmVkIGluc2lkZSBhIFJvdXRlclByb3ZpZGVyLCB3aWxsIHJlc3RvcmUgc2Nyb2xsIHBvc2l0aW9ucyBvbiBuYXZpZ2F0aW9ucwogICAgICAgICAgICovCgogICAgICAgICAgZnVuY3Rpb24gdXNlU2Nyb2xsUmVzdG9yYXRpb24oX3RlbXAzKSB7CiAgICAgICAgICAgIHZhciBfcmVmMjkgPQoKCiAgICAgICAgICAgICAgX3RlbXAzID09PSB2b2lkIDAgPyB7fSA6IF90ZW1wMyxnZXRLZXkgPSBfcmVmMjkuZ2V0S2V5LHN0b3JhZ2VLZXkgPSBfcmVmMjkuc3RvcmFnZUtleTsKICAgICAgICAgICAgdmFyIF9kaXN0X3VzZURhdGFSb3V0ZXJDbzMgPQoKICAgICAgICAgICAgICBkaXN0X3VzZURhdGFSb3V0ZXJDb250ZXh0KGRpc3RfRGF0YVJvdXRlckhvb2suVXNlU2Nyb2xsUmVzdG9yYXRpb24pLHJvdXRlciA9IF9kaXN0X3VzZURhdGFSb3V0ZXJDbzMucm91dGVyOwogICAgICAgICAgICB2YXIgX2Rpc3RfdXNlRGF0YVJvdXRlclN0ID0KCgogICAgICAgICAgICAgIGRpc3RfdXNlRGF0YVJvdXRlclN0YXRlKGRpc3RfRGF0YVJvdXRlclN0YXRlSG9vay5Vc2VTY3JvbGxSZXN0b3JhdGlvbikscmVzdG9yZVNjcm9sbFBvc2l0aW9uID0gX2Rpc3RfdXNlRGF0YVJvdXRlclN0LnJlc3RvcmVTY3JvbGxQb3NpdGlvbixwcmV2ZW50U2Nyb2xsUmVzZXQgPSBfZGlzdF91c2VEYXRhUm91dGVyU3QucHJldmVudFNjcm9sbFJlc2V0OwogICAgICAgICAgICB2YXIgbG9jYXRpb24gPSB1c2VMb2NhdGlvbigpOwogICAgICAgICAgICB2YXIgbWF0Y2hlcyA9IHVzZU1hdGNoZXMoKTsKICAgICAgICAgICAgdmFyIG5hdmlnYXRpb24gPSB1c2VOYXZpZ2F0aW9uKCk7IC8vIFRyaWdnZXIgbWFudWFsIHNjcm9sbCByZXN0b3JhdGlvbiB3aGlsZSB3ZSdyZSBhY3RpdmUKCiAgICAgICAgICAgIFJlYWN0LnVzZUVmZmVjdCgoKSA9PiB7CiAgICAgICAgICAgICAgd2luZG93Lmhpc3Rvcnkuc2Nyb2xsUmVzdG9yYXRpb24gPSAibWFudWFsIjsKICAgICAgICAgICAgICByZXR1cm4gKCkgPT4gewogICAgICAgICAgICAgICAgd2luZG93Lmhpc3Rvcnkuc2Nyb2xsUmVzdG9yYXRpb24gPSAiYXV0byI7CiAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgfSwgW10pOyAvLyBTYXZlIHBvc2l0aW9ucyBvbiB1bmxvYWQKCiAgICAgICAgICAgIHVzZUJlZm9yZVVubG9hZChSZWFjdC51c2VDYWxsYmFjaygoKSA9PiB7CiAgICAgICAgICAgICAgaWYgKG5hdmlnYXRpb24uc3RhdGUgPT09ICJpZGxlIikgewogICAgICAgICAgICAgICAgdmFyIGtleSA9IChnZXRLZXkgPyBnZXRLZXkobG9jYXRpb24sIG1hdGNoZXMpIDogbnVsbCkgfHwgbG9jYXRpb24ua2V5OwogICAgICAgICAgICAgICAgc2F2ZWRTY3JvbGxQb3NpdGlvbnNba2V5XSA9IHdpbmRvdy5zY3JvbGxZOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgc2Vzc2lvblN0b3JhZ2Uuc2V0SXRlbShzdG9yYWdlS2V5IHx8IFNDUk9MTF9SRVNUT1JBVElPTl9TVE9SQUdFX0tFWSwgSlNPTi5zdHJpbmdpZnkoc2F2ZWRTY3JvbGxQb3NpdGlvbnMpKTsKICAgICAgICAgICAgICB3aW5kb3cuaGlzdG9yeS5zY3JvbGxSZXN0b3JhdGlvbiA9ICJhdXRvIjsKICAgICAgICAgICAgfSwgW3N0b3JhZ2VLZXksIGdldEtleSwgbmF2aWdhdGlvbi5zdGF0ZSwgbG9jYXRpb24sIG1hdGNoZXNdKSk7IC8vIFJlYWQgaW4gYW55IHNhdmVkIHNjcm9sbCBsb2NhdGlvbnMKCiAgICAgICAgICAgIFJlYWN0LnVzZUxheW91dEVmZmVjdCgoKSA9PiB7CiAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIHZhciBzZXNzaW9uUG9zaXRpb25zID0gc2Vzc2lvblN0b3JhZ2UuZ2V0SXRlbShzdG9yYWdlS2V5IHx8IFNDUk9MTF9SRVNUT1JBVElPTl9TVE9SQUdFX0tFWSk7CgogICAgICAgICAgICAgICAgaWYgKHNlc3Npb25Qb3NpdGlvbnMpIHsKICAgICAgICAgICAgICAgICAgc2F2ZWRTY3JvbGxQb3NpdGlvbnMgPSBKU09OLnBhcnNlKHNlc3Npb25Qb3NpdGlvbnMpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICAgICAgICAgIC8vIG5vLW9wLCB1c2UgZGVmYXVsdCBlbXB0eSBvYmplY3QKICAgICAgICAgICAgICB9fSwgW3N0b3JhZ2VLZXldKTsgLy8gRW5hYmxlIHNjcm9sbCByZXN0b3JhdGlvbiBpbiB0aGUgcm91dGVyCgogICAgICAgICAgICBSZWFjdC51c2VMYXlvdXRFZmZlY3QoKCkgPT4gewogICAgICAgICAgICAgIHZhciBkaXNhYmxlU2Nyb2xsUmVzdG9yYXRpb24gPSByb3V0ZXIgPT0gbnVsbCA/IHZvaWQgMCA6IHJvdXRlci5lbmFibGVTY3JvbGxSZXN0b3JhdGlvbihzYXZlZFNjcm9sbFBvc2l0aW9ucywgKCkgPT4gd2luZG93LnNjcm9sbFksIGdldEtleSk7CiAgICAgICAgICAgICAgcmV0dXJuICgpID0+IGRpc2FibGVTY3JvbGxSZXN0b3JhdGlvbiAmJiBkaXNhYmxlU2Nyb2xsUmVzdG9yYXRpb24oKTsKICAgICAgICAgICAgfSwgW3JvdXRlciwgZ2V0S2V5XSk7IC8vIFJlc3RvcmUgc2Nyb2xsaW5nIHdoZW4gc3RhdGUucmVzdG9yZVNjcm9sbFBvc2l0aW9uIGNoYW5nZXMKCiAgICAgICAgICAgIFJlYWN0LnVzZUxheW91dEVmZmVjdCgoKSA9PiB7CiAgICAgICAgICAgICAgLy8gRXhwbGljaXQgZmFsc2UgbWVhbnMgZG9uJ3QgZG8gYW55dGhpbmcgKHVzZWQgZm9yIHN1Ym1pc3Npb25zKQogICAgICAgICAgICAgIGlmIChyZXN0b3JlU2Nyb2xsUG9zaXRpb24gPT09IGZhbHNlKSB7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgfSAvLyBiZWVuIGhlcmUgYmVmb3JlLCBzY3JvbGwgdG8gaXQKCgogICAgICAgICAgICAgIGlmICh0eXBlb2YgcmVzdG9yZVNjcm9sbFBvc2l0aW9uID09PSAibnVtYmVyIikgewogICAgICAgICAgICAgICAgd2luZG93LnNjcm9sbFRvKDAsIHJlc3RvcmVTY3JvbGxQb3NpdGlvbik7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgfSAvLyB0cnkgdG8gc2Nyb2xsIHRvIHRoZSBoYXNoCgoKICAgICAgICAgICAgICBpZiAobG9jYXRpb24uaGFzaCkgewogICAgICAgICAgICAgICAgdmFyIGVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQobG9jYXRpb24uaGFzaC5zbGljZSgxKSk7CgogICAgICAgICAgICAgICAgaWYgKGVsKSB7CiAgICAgICAgICAgICAgICAgIGVsLnNjcm9sbEludG9WaWV3KCk7CiAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9IC8vIE9wdCBvdXQgb2Ygc2Nyb2xsIHJlc2V0IGlmIHRoaXMgbGluayByZXF1ZXN0ZWQgaXQKCgogICAgICAgICAgICAgIGlmIChwcmV2ZW50U2Nyb2xsUmVzZXQgPT09IHRydWUpIHsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICB9IC8vIG90aGVyd2lzZSBnbyB0byB0aGUgdG9wIG9uIG5ldyBsb2NhdGlvbnMKCgogICAgICAgICAgICAgIHdpbmRvdy5zY3JvbGxUbygwLCAwKTsKICAgICAgICAgICAgfSwgW2xvY2F0aW9uLCByZXN0b3JlU2Nyb2xsUG9zaXRpb24sIHByZXZlbnRTY3JvbGxSZXNldF0pOwogICAgICAgICAgfQoKICAgICAgICAgIGZ1bmN0aW9uIHVzZUJlZm9yZVVubG9hZChjYWxsYmFjaykgewogICAgICAgICAgICBSZWFjdC51c2VFZmZlY3QoKCkgPT4gewogICAgICAgICAgICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCJiZWZvcmV1bmxvYWQiLCBjYWxsYmFjayk7CiAgICAgICAgICAgICAgcmV0dXJuICgpID0+IHsKICAgICAgICAgICAgICAgIHdpbmRvdy5yZW1vdmVFdmVudExpc3RlbmVyKCJiZWZvcmV1bmxvYWQiLCBjYWxsYmFjayk7CiAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgfSwgW2NhbGxiYWNrXSk7CiAgICAgICAgICB9IC8vI2VuZHJlZ2lvbgogICAgICAgICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KICAgICAgICAgIC8vI3JlZ2lvbiBVdGlscwogICAgICAgICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KCgogICAgICAgICAgZnVuY3Rpb24gZGlzdF93YXJuaW5nKGNvbmQsIG1lc3NhZ2UpIHsKICAgICAgICAgICAgaWYgKCFjb25kKSB7CiAgICAgICAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG5vLWNvbnNvbGUKICAgICAgICAgICAgICBpZiAodHlwZW9mIGNvbnNvbGUgIT09ICJ1bmRlZmluZWQiKSBjb25zb2xlLndhcm4obWVzc2FnZSk7CgogICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAvLyBXZWxjb21lIHRvIGRlYnVnZ2luZyBSZWFjdCBSb3V0ZXIhCiAgICAgICAgICAgICAgICAvLwogICAgICAgICAgICAgICAgLy8gVGhpcyBlcnJvciBpcyB0aHJvd24gYXMgYSBjb252ZW5pZW5jZSBzbyB5b3UgY2FuIG1vcmUgZWFzaWx5CiAgICAgICAgICAgICAgICAvLyBmaW5kIHRoZSBzb3VyY2UgZm9yIGEgd2FybmluZyB0aGF0IGFwcGVhcnMgaW4gdGhlIGNvbnNvbGUgYnkKICAgICAgICAgICAgICAgIC8vIGVuYWJsaW5nICJwYXVzZSBvbiBleGNlcHRpb25zIiBpbiB5b3VyIEphdmFTY3JpcHQgZGVidWdnZXIuCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IobWVzc2FnZSk7IC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBuby1lbXB0eQogICAgICAgICAgICAgIH0gY2F0Y2ggKGUpIHt9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0gLy8jZW5kcmVnaW9uCgoKCgogICAgICAgICAgOyAvLyBDT05DQVRFTkFURUQgTU9EVUxFOiAuL3NyYy9yZWxheS9jb21wb25lbnRzL0xheW91dC50c3gKCgoKCiAgICAgICAgICB2YXIgTGF5b3V0ID0gZnVuY3Rpb24gTGF5b3V0KF9yZWYpIHt2YXIgcGFnZXMgPSBfcmVmLnBhZ2VzOwogICAgICAgICAgICB2YXIgb3V0bGV0ID0gLyojX19QVVJFX18qLwogICAgICAgICAgICByZWFjdC5jcmVhdGVFbGVtZW50KHJlYWN0LkZyYWdtZW50LCBudWxsLCAvKiNfX1BVUkVfXyovCiAgICAgICAgICAgIHJlYWN0LmNyZWF0ZUVsZW1lbnQoImRpdiIsIHsgaWQ6ICJub3RpZmljYXRpb25zQ29udGFpbmVyIiB9KSwgLyojX19QVVJFX18qLwogICAgICAgICAgICByZWFjdC5jcmVhdGVFbGVtZW50KCJkaXYiLCB7IGlkOiAicmVsYXlDb250YWluZXIiIH0sIC8qI19fUFVSRV9fKi8KICAgICAgICAgICAgcmVhY3QuY3JlYXRlRWxlbWVudChPdXRsZXQsIG51bGwpKSk7CgoKCgogICAgICAgICAgICBpZiAocGFnZXMubGVuZ3RoIDw9IDEpIHsKICAgICAgICAgICAgICByZXR1cm4gb3V0bGV0OwogICAgICAgICAgICB9CgogICAgICAgICAgICByZXR1cm4gLyojX19QVVJFX18qLygKICAgICAgICAgICAgICByZWFjdC5jcmVhdGVFbGVtZW50KHJlYWN0LkZyYWdtZW50LCBudWxsLAogICAgICAgICAgICAgICIgIiwgLyojX19QVVJFX18qLwogICAgICAgICAgICAgIHJlYWN0LmNyZWF0ZUVsZW1lbnQoIm5hdiIsIG51bGwsIC8qI19fUFVSRV9fKi8KICAgICAgICAgICAgICByZWFjdC5jcmVhdGVFbGVtZW50KCJkaXYiLCB7IGNsYXNzTmFtZTogInRvcEJhciIgfSwKICAgICAgICAgICAgICAiICIsCiAgICAgICAgICAgICAgcGFnZXMubWFwKGZ1bmN0aW9uIChwLCBpbmRleCkge3JldHVybiAvKiNfX1BVUkVfXyovKAogICAgICAgICAgICAgICAgICByZWFjdC5jcmVhdGVFbGVtZW50KCJkaXYiLCB7IGtleTogaW5kZXgsIGNsYXNzTmFtZTogInRhYkVudHJ5IiB9LCAvKiNfX1BVUkVfXyovCiAgICAgICAgICAgICAgICAgIHJlYWN0LmNyZWF0ZUVsZW1lbnQoTmF2TGluaywgeyB0bzogIi8iICsgcC5maWxlIH0sIHAucGFnZSksICIgIikpO30pKSksCgoKCiAgICAgICAgICAgICAgIiAiLAogICAgICAgICAgICAgIG91dGxldCkpOwoKCiAgICAgICAgICB9OwoKICAgICAgICAgIC8qIGhhcm1vbnkgZGVmYXVsdCBleHBvcnQgKi92YXIgY29tcG9uZW50c19MYXlvdXQgPSBMYXlvdXQ7CiAgICAgICAgICA7IC8vIENPTkNBVEVOQVRFRCBNT0RVTEU6IC4vc3JjL3JlbGF5L2FwaS9BcGlSZXF1ZXN0LnRzeAogICAgICAgICAgZnVuY3Rpb24gX3R5cGVvZihvYmopIHsiQGJhYmVsL2hlbHBlcnMgLSB0eXBlb2YiO3JldHVybiBfdHlwZW9mID0gImZ1bmN0aW9uIiA9PSB0eXBlb2YgU3ltYm9sICYmICJzeW1ib2wiID09IHR5cGVvZiBTeW1ib2wuaXRlcmF0b3IgPyBmdW5jdGlvbiAob2JqKSB7cmV0dXJuIHR5cGVvZiBvYmo7fSA6IGZ1bmN0aW9uIChvYmopIHtyZXR1cm4gb2JqICYmICJmdW5jdGlvbiIgPT0gdHlwZW9mIFN5bWJvbCAmJiBvYmouY29uc3RydWN0b3IgPT09IFN5bWJvbCAmJiBvYmogIT09IFN5bWJvbC5wcm90b3R5cGUgPyAic3ltYm9sIiA6IHR5cGVvZiBvYmo7fSwgX3R5cGVvZihvYmopO31mdW5jdGlvbiBfcmVnZW5lcmF0b3JSdW50aW1lKCkgeyJ1c2Ugc3RyaWN0IjsKICAgICAgICAgICAgLyohIHJlZ2VuZXJhdG9yLXJ1bnRpbWUgLS0gQ29weXJpZ2h0IChjKSAyMDE0LXByZXNlbnQsIEZhY2Vib29rLCBJbmMuIC0tIGxpY2Vuc2UgKE1JVCk6IGh0dHBzOi8vZ2l0aHViLmNvbS9mYWNlYm9vay9yZWdlbmVyYXRvci9ibG9iL21haW4vTElDRU5TRSAqL19yZWdlbmVyYXRvclJ1bnRpbWUgPSBmdW5jdGlvbiBfcmVnZW5lcmF0b3JSdW50aW1lKCkge3JldHVybiBleHBvcnRzO307dmFyIGV4cG9ydHMgPSB7fSxPcCA9IE9iamVjdC5wcm90b3R5cGUsaGFzT3duID0gT3AuaGFzT3duUHJvcGVydHksZGVmaW5lUHJvcGVydHkgPSBPYmplY3QuZGVmaW5lUHJvcGVydHkgfHwgZnVuY3Rpb24gKG9iaiwga2V5LCBkZXNjKSB7b2JqW2tleV0gPSBkZXNjLnZhbHVlO30sJFN5bWJvbCA9ICJmdW5jdGlvbiIgPT0gdHlwZW9mIFN5bWJvbCA/IFN5bWJvbCA6IHt9LGl0ZXJhdG9yU3ltYm9sID0gJFN5bWJvbC5pdGVyYXRvciB8fCAiQEBpdGVyYXRvciIsYXN5bmNJdGVyYXRvclN5bWJvbCA9ICRTeW1ib2wuYXN5bmNJdGVyYXRvciB8fCAiQEBhc3luY0l0ZXJhdG9yIix0b1N0cmluZ1RhZ1N5bWJvbCA9ICRTeW1ib2wudG9TdHJpbmdUYWcgfHwgIkBAdG9TdHJpbmdUYWciO2Z1bmN0aW9uIGRlZmluZShvYmosIGtleSwgdmFsdWUpIHtyZXR1cm4gT2JqZWN0LmRlZmluZVByb3BlcnR5KG9iaiwga2V5LCB7IHZhbHVlOiB2YWx1ZSwgZW51bWVyYWJsZTogITAsIGNvbmZpZ3VyYWJsZTogITAsIHdyaXRhYmxlOiAhMCB9KSwgb2JqW2tleV07fXRyeSB7ZGVmaW5lKHt9LCAiIik7fSBjYXRjaCAoZXJyKSB7ZGVmaW5lID0gZnVuY3Rpb24gZGVmaW5lKG9iaiwga2V5LCB2YWx1ZSkge3JldHVybiBvYmpba2V5XSA9IHZhbHVlO307fWZ1bmN0aW9uIHdyYXAoaW5uZXJGbiwgb3V0ZXJGbiwgc2VsZiwgdHJ5TG9jc0xpc3QpIHt2YXIgcHJvdG9HZW5lcmF0b3IgPSBvdXRlckZuICYmIG91dGVyRm4ucHJvdG90eXBlIGluc3RhbmNlb2YgR2VuZXJhdG9yID8gb3V0ZXJGbiA6IEdlbmVyYXRvcixnZW5lcmF0b3IgPSBPYmplY3QuY3JlYXRlKHByb3RvR2VuZXJhdG9yLnByb3RvdHlwZSksY29udGV4dCA9IG5ldyBDb250ZXh0KHRyeUxvY3NMaXN0IHx8IFtdKTtyZXR1cm4gZGVmaW5lUHJvcGVydHkoZ2VuZXJhdG9yLCAiX2ludm9rZSIsIHsgdmFsdWU6IG1ha2VJbnZva2VNZXRob2QoaW5uZXJGbiwgc2VsZiwgY29udGV4dCkgfSksIGdlbmVyYXRvcjt9ZnVuY3Rpb24gdHJ5Q2F0Y2goZm4sIG9iaiwgYXJnKSB7dHJ5IHtyZXR1cm4geyB0eXBlOiAibm9ybWFsIiwgYXJnOiBmbi5jYWxsKG9iaiwgYXJnKSB9O30gY2F0Y2ggKGVycikge3JldHVybiB7IHR5cGU6ICJ0aHJvdyIsIGFyZzogZXJyIH07fX1leHBvcnRzLndyYXAgPSB3cmFwO3ZhciBDb250aW51ZVNlbnRpbmVsID0ge307ZnVuY3Rpb24gR2VuZXJhdG9yKCkge31mdW5jdGlvbiBHZW5lcmF0b3JGdW5jdGlvbigpIHt9ZnVuY3Rpb24gR2VuZXJhdG9yRnVuY3Rpb25Qcm90b3R5cGUoKSB7fXZhciBJdGVyYXRvclByb3RvdHlwZSA9IHt9O2RlZmluZShJdGVyYXRvclByb3RvdHlwZSwgaXRlcmF0b3JTeW1ib2wsIGZ1bmN0aW9uICgpIHtyZXR1cm4gdGhpczt9KTt2YXIgZ2V0UHJvdG8gPSBPYmplY3QuZ2V0UHJvdG90eXBlT2YsTmF0aXZlSXRlcmF0b3JQcm90b3R5cGUgPSBnZXRQcm90byAmJiBnZXRQcm90byhnZXRQcm90byh2YWx1ZXMoW10pKSk7TmF0aXZlSXRlcmF0b3JQcm90b3R5cGUgJiYgTmF0aXZlSXRlcmF0b3JQcm90b3R5cGUgIT09IE9wICYmIGhhc093bi5jYWxsKE5hdGl2ZUl0ZXJhdG9yUHJvdG90eXBlLCBpdGVyYXRvclN5bWJvbCkgJiYgKEl0ZXJhdG9yUHJvdG90eXBlID0gTmF0aXZlSXRlcmF0b3JQcm90b3R5cGUpO3ZhciBHcCA9IEdlbmVyYXRvckZ1bmN0aW9uUHJvdG90eXBlLnByb3RvdHlwZSA9IEdlbmVyYXRvci5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKEl0ZXJhdG9yUHJvdG90eXBlKTtmdW5jdGlvbiBkZWZpbmVJdGVyYXRvck1ldGhvZHMocHJvdG90eXBlKSB7WyJuZXh0IiwgInRocm93IiwgInJldHVybiJdLmZvckVhY2goZnVuY3Rpb24gKG1ldGhvZCkge2RlZmluZShwcm90b3R5cGUsIG1ldGhvZCwgZnVuY3Rpb24gKGFyZykge3JldHVybiB0aGlzLl9pbnZva2UobWV0aG9kLCBhcmcpO30pO30pO31mdW5jdGlvbiBBc3luY0l0ZXJhdG9yKGdlbmVyYXRvciwgUHJvbWlzZUltcGwpIHtmdW5jdGlvbiBpbnZva2UobWV0aG9kLCBhcmcsIHJlc29sdmUsIHJlamVjdCkge3ZhciByZWNvcmQgPSB0cnlDYXRjaChnZW5lcmF0b3JbbWV0aG9kXSwgZ2VuZXJhdG9yLCBhcmcpO2lmICgidGhyb3ciICE9PSByZWNvcmQudHlwZSkge3ZhciByZXN1bHQgPSByZWNvcmQuYXJnLHZhbHVlID0gcmVzdWx0LnZhbHVlO3JldHVybiB2YWx1ZSAmJiAib2JqZWN0IiA9PSBfdHlwZW9mKHZhbHVlKSAmJiBoYXNPd24uY2FsbCh2YWx1ZSwgIl9fYXdhaXQiKSA/IFByb21pc2VJbXBsLnJlc29sdmUodmFsdWUuX19hd2FpdCkudGhlbihmdW5jdGlvbiAodmFsdWUpIHtpbnZva2UoIm5leHQiLCB2YWx1ZSwgcmVzb2x2ZSwgcmVqZWN0KTt9LCBmdW5jdGlvbiAoZXJyKSB7aW52b2tlKCJ0aHJvdyIsIGVyciwgcmVzb2x2ZSwgcmVqZWN0KTt9KSA6IFByb21pc2VJbXBsLnJlc29sdmUodmFsdWUpLnRoZW4oZnVuY3Rpb24gKHVud3JhcHBlZCkge3Jlc3VsdC52YWx1ZSA9IHVud3JhcHBlZCwgcmVzb2x2ZShyZXN1bHQpO30sIGZ1bmN0aW9uIChlcnJvcikge3JldHVybiBpbnZva2UoInRocm93IiwgZXJyb3IsIHJlc29sdmUsIHJlamVjdCk7fSk7fXJlamVjdChyZWNvcmQuYXJnKTt9dmFyIHByZXZpb3VzUHJvbWlzZTtkZWZpbmVQcm9wZXJ0eSh0aGlzLCAiX2ludm9rZSIsIHsgdmFsdWU6IGZ1bmN0aW9uIHZhbHVlKG1ldGhvZCwgYXJnKSB7ZnVuY3Rpb24gY2FsbEludm9rZVdpdGhNZXRob2RBbmRBcmcoKSB7cmV0dXJuIG5ldyBQcm9taXNlSW1wbChmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7aW52b2tlKG1ldGhvZCwgYXJnLCByZXNvbHZlLCByZWplY3QpO30pO31yZXR1cm4gcHJldmlvdXNQcm9taXNlID0gcHJldmlvdXNQcm9taXNlID8gcHJldmlvdXNQcm9taXNlLnRoZW4oY2FsbEludm9rZVdpdGhNZXRob2RBbmRBcmcsIGNhbGxJbnZva2VXaXRoTWV0aG9kQW5kQXJnKSA6IGNhbGxJbnZva2VXaXRoTWV0aG9kQW5kQXJnKCk7fSB9KTt9ZnVuY3Rpb24gbWFrZUludm9rZU1ldGhvZChpbm5lckZuLCBzZWxmLCBjb250ZXh0KSB7dmFyIHN0YXRlID0gInN1c3BlbmRlZFN0YXJ0IjtyZXR1cm4gZnVuY3Rpb24gKG1ldGhvZCwgYXJnKSB7aWYgKCJleGVjdXRpbmciID09PSBzdGF0ZSkgdGhyb3cgbmV3IEVycm9yKCJHZW5lcmF0b3IgaXMgYWxyZWFkeSBydW5uaW5nIik7aWYgKCJjb21wbGV0ZWQiID09PSBzdGF0ZSkge2lmICgidGhyb3ciID09PSBtZXRob2QpIHRocm93IGFyZztyZXR1cm4gZG9uZVJlc3VsdCgpO31mb3IgKGNvbnRleHQubWV0aG9kID0gbWV0aG9kLCBjb250ZXh0LmFyZyA9IGFyZzs7KSB7dmFyIGRlbGVnYXRlID0gY29udGV4dC5kZWxlZ2F0ZTtpZiAoZGVsZWdhdGUpIHt2YXIgZGVsZWdhdGVSZXN1bHQgPSBtYXliZUludm9rZURlbGVnYXRlKGRlbGVnYXRlLCBjb250ZXh0KTtpZiAoZGVsZWdhdGVSZXN1bHQpIHtpZiAoZGVsZWdhdGVSZXN1bHQgPT09IENvbnRpbnVlU2VudGluZWwpIGNvbnRpbnVlO3JldHVybiBkZWxlZ2F0ZVJlc3VsdDt9fWlmICgibmV4dCIgPT09IGNvbnRleHQubWV0aG9kKSBjb250ZXh0LnNlbnQgPSBjb250ZXh0Ll9zZW50ID0gY29udGV4dC5hcmc7ZWxzZSBpZiAoInRocm93IiA9PT0gY29udGV4dC5tZXRob2QpIHtpZiAoInN1c3BlbmRlZFN0YXJ0IiA9PT0gc3RhdGUpIHRocm93IHN0YXRlID0gImNvbXBsZXRlZCIsIGNvbnRleHQuYXJnO2NvbnRleHQuZGlzcGF0Y2hFeGNlcHRpb24oY29udGV4dC5hcmcpO30gZWxzZSAicmV0dXJuIiA9PT0gY29udGV4dC5tZXRob2QgJiYgY29udGV4dC5hYnJ1cHQoInJldHVybiIsIGNvbnRleHQuYXJnKTtzdGF0ZSA9ICJleGVjdXRpbmciO3ZhciByZWNvcmQgPSB0cnlDYXRjaChpbm5lckZuLCBzZWxmLCBjb250ZXh0KTtpZiAoIm5vcm1hbCIgPT09IHJlY29yZC50eXBlKSB7aWYgKHN0YXRlID0gY29udGV4dC5kb25lID8gImNvbXBsZXRlZCIgOiAic3VzcGVuZGVkWWllbGQiLCByZWNvcmQuYXJnID09PSBDb250aW51ZVNlbnRpbmVsKSBjb250aW51ZTtyZXR1cm4geyB2YWx1ZTogcmVjb3JkLmFyZywgZG9uZTogY29udGV4dC5kb25lIH07fSJ0aHJvdyIgPT09IHJlY29yZC50eXBlICYmIChzdGF0ZSA9ICJjb21wbGV0ZWQiLCBjb250ZXh0Lm1ldGhvZCA9ICJ0aHJvdyIsIGNvbnRleHQuYXJnID0gcmVjb3JkLmFyZyk7fX07fWZ1bmN0aW9uIG1heWJlSW52b2tlRGVsZWdhdGUoZGVsZWdhdGUsIGNvbnRleHQpIHt2YXIgbWV0aG9kID0gZGVsZWdhdGUuaXRlcmF0b3JbY29udGV4dC5tZXRob2RdO2lmICh1bmRlZmluZWQgPT09IG1ldGhvZCkge2lmIChjb250ZXh0LmRlbGVnYXRlID0gbnVsbCwgInRocm93IiA9PT0gY29udGV4dC5tZXRob2QpIHtpZiAoZGVsZWdhdGUuaXRlcmF0b3JbInJldHVybiJdICYmIChjb250ZXh0Lm1ldGhvZCA9ICJyZXR1cm4iLCBjb250ZXh0LmFyZyA9IHVuZGVmaW5lZCwgbWF5YmVJbnZva2VEZWxlZ2F0ZShkZWxlZ2F0ZSwgY29udGV4dCksICJ0aHJvdyIgPT09IGNvbnRleHQubWV0aG9kKSkgcmV0dXJuIENvbnRpbnVlU2VudGluZWw7Y29udGV4dC5tZXRob2QgPSAidGhyb3ciLCBjb250ZXh0LmFyZyA9IG5ldyBUeXBlRXJyb3IoIlRoZSBpdGVyYXRvciBkb2VzIG5vdCBwcm92aWRlIGEgJ3Rocm93JyBtZXRob2QiKTt9cmV0dXJuIENvbnRpbnVlU2VudGluZWw7fXZhciByZWNvcmQgPSB0cnlDYXRjaChtZXRob2QsIGRlbGVnYXRlLml0ZXJhdG9yLCBjb250ZXh0LmFyZyk7aWYgKCJ0aHJvdyIgPT09IHJlY29yZC50eXBlKSByZXR1cm4gY29udGV4dC5tZXRob2QgPSAidGhyb3ciLCBjb250ZXh0LmFyZyA9IHJlY29yZC5hcmcsIGNvbnRleHQuZGVsZWdhdGUgPSBudWxsLCBDb250aW51ZVNlbnRpbmVsO3ZhciBpbmZvID0gcmVjb3JkLmFyZztyZXR1cm4gaW5mbyA/IGluZm8uZG9uZSA/IChjb250ZXh0W2RlbGVnYXRlLnJlc3VsdE5hbWVdID0gaW5mby52YWx1ZSwgY29udGV4dC5uZXh0ID0gZGVsZWdhdGUubmV4dExvYywgInJldHVybiIgIT09IGNvbnRleHQubWV0aG9kICYmIChjb250ZXh0Lm1ldGhvZCA9ICJuZXh0IiwgY29udGV4dC5hcmcgPSB1bmRlZmluZWQpLCBjb250ZXh0LmRlbGVnYXRlID0gbnVsbCwgQ29udGludWVTZW50aW5lbCkgOiBpbmZvIDogKGNvbnRleHQubWV0aG9kID0gInRocm93IiwgY29udGV4dC5hcmcgPSBuZXcgVHlwZUVycm9yKCJpdGVyYXRvciByZXN1bHQgaXMgbm90IGFuIG9iamVjdCIpLCBjb250ZXh0LmRlbGVnYXRlID0gbnVsbCwgQ29udGludWVTZW50aW5lbCk7fWZ1bmN0aW9uIHB1c2hUcnlFbnRyeShsb2NzKSB7dmFyIGVudHJ5ID0geyB0cnlMb2M6IGxvY3NbMF0gfTsxIGluIGxvY3MgJiYgKGVudHJ5LmNhdGNoTG9jID0gbG9jc1sxXSksIDIgaW4gbG9jcyAmJiAoZW50cnkuZmluYWxseUxvYyA9IGxvY3NbMl0sIGVudHJ5LmFmdGVyTG9jID0gbG9jc1szXSksIHRoaXMudHJ5RW50cmllcy5wdXNoKGVudHJ5KTt9ZnVuY3Rpb24gcmVzZXRUcnlFbnRyeShlbnRyeSkge3ZhciByZWNvcmQgPSBlbnRyeS5jb21wbGV0aW9uIHx8IHt9O3JlY29yZC50eXBlID0gIm5vcm1hbCIsIGRlbGV0ZSByZWNvcmQuYXJnLCBlbnRyeS5jb21wbGV0aW9uID0gcmVjb3JkO31mdW5jdGlvbiBDb250ZXh0KHRyeUxvY3NMaXN0KSB7dGhpcy50cnlFbnRyaWVzID0gW3sgdHJ5TG9jOiAicm9vdCIgfV0sIHRyeUxvY3NMaXN0LmZvckVhY2gocHVzaFRyeUVudHJ5LCB0aGlzKSwgdGhpcy5yZXNldCghMCk7fWZ1bmN0aW9uIHZhbHVlcyhpdGVyYWJsZSkge2lmIChpdGVyYWJsZSkge3ZhciBpdGVyYXRvck1ldGhvZCA9IGl0ZXJhYmxlW2l0ZXJhdG9yU3ltYm9sXTtpZiAoaXRlcmF0b3JNZXRob2QpIHJldHVybiBpdGVyYXRvck1ldGhvZC5jYWxsKGl0ZXJhYmxlKTtpZiAoImZ1bmN0aW9uIiA9PSB0eXBlb2YgaXRlcmFibGUubmV4dCkgcmV0dXJuIGl0ZXJhYmxlO2lmICghaXNOYU4oaXRlcmFibGUubGVuZ3RoKSkge3ZhciBpID0gLTEsbmV4dCA9IGZ1bmN0aW9uIG5leHQoKSB7Zm9yICg7ICsraSA8IGl0ZXJhYmxlLmxlbmd0aDspIHtpZiAoaGFzT3duLmNhbGwoaXRlcmFibGUsIGkpKSByZXR1cm4gbmV4dC52YWx1ZSA9IGl0ZXJhYmxlW2ldLCBuZXh0LmRvbmUgPSAhMSwgbmV4dDt9cmV0dXJuIG5leHQudmFsdWUgPSB1bmRlZmluZWQsIG5leHQuZG9uZSA9ICEwLCBuZXh0O307cmV0dXJuIG5leHQubmV4dCA9IG5leHQ7fX1yZXR1cm4geyBuZXh0OiBkb25lUmVzdWx0IH07fWZ1bmN0aW9uIGRvbmVSZXN1bHQoKSB7cmV0dXJuIHsgdmFsdWU6IHVuZGVmaW5lZCwgZG9uZTogITAgfTt9cmV0dXJuIEdlbmVyYXRvckZ1bmN0aW9uLnByb3RvdHlwZSA9IEdlbmVyYXRvckZ1bmN0aW9uUHJvdG90eXBlLCBkZWZpbmVQcm9wZXJ0eShHcCwgImNvbnN0cnVjdG9yIiwgeyB2YWx1ZTogR2VuZXJhdG9yRnVuY3Rpb25Qcm90b3R5cGUsIGNvbmZpZ3VyYWJsZTogITAgfSksIGRlZmluZVByb3BlcnR5KEdlbmVyYXRvckZ1bmN0aW9uUHJvdG90eXBlLCAiY29uc3RydWN0b3IiLCB7IHZhbHVlOiBHZW5lcmF0b3JGdW5jdGlvbiwgY29uZmlndXJhYmxlOiAhMCB9KSwgR2VuZXJhdG9yRnVuY3Rpb24uZGlzcGxheU5hbWUgPSBkZWZpbmUoR2VuZXJhdG9yRnVuY3Rpb25Qcm90b3R5cGUsIHRvU3RyaW5nVGFnU3ltYm9sLCAiR2VuZXJhdG9yRnVuY3Rpb24iKSwgZXhwb3J0cy5pc0dlbmVyYXRvckZ1bmN0aW9uID0gZnVuY3Rpb24gKGdlbkZ1bikge3ZhciBjdG9yID0gImZ1bmN0aW9uIiA9PSB0eXBlb2YgZ2VuRnVuICYmIGdlbkZ1bi5jb25zdHJ1Y3RvcjtyZXR1cm4gISFjdG9yICYmIChjdG9yID09PSBHZW5lcmF0b3JGdW5jdGlvbiB8fCAiR2VuZXJhdG9yRnVuY3Rpb24iID09PSAoY3Rvci5kaXNwbGF5TmFtZSB8fCBjdG9yLm5hbWUpKTt9LCBleHBvcnRzLm1hcmsgPSBmdW5jdGlvbiAoZ2VuRnVuKSB7cmV0dXJuIE9iamVjdC5zZXRQcm90b3R5cGVPZiA/IE9iamVjdC5zZXRQcm90b3R5cGVPZihnZW5GdW4sIEdlbmVyYXRvckZ1bmN0aW9uUHJvdG90eXBlKSA6IChnZW5GdW4uX19wcm90b19fID0gR2VuZXJhdG9yRnVuY3Rpb25Qcm90b3R5cGUsIGRlZmluZShnZW5GdW4sIHRvU3RyaW5nVGFnU3ltYm9sLCAiR2VuZXJhdG9yRnVuY3Rpb24iKSksIGdlbkZ1bi5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKEdwKSwgZ2VuRnVuO30sIGV4cG9ydHMuYXdyYXAgPSBmdW5jdGlvbiAoYXJnKSB7cmV0dXJuIHsgX19hd2FpdDogYXJnIH07fSwgZGVmaW5lSXRlcmF0b3JNZXRob2RzKEFzeW5jSXRlcmF0b3IucHJvdG90eXBlKSwgZGVmaW5lKEFzeW5jSXRlcmF0b3IucHJvdG90eXBlLCBhc3luY0l0ZXJhdG9yU3ltYm9sLCBmdW5jdGlvbiAoKSB7cmV0dXJuIHRoaXM7fSksIGV4cG9ydHMuQXN5bmNJdGVyYXRvciA9IEFzeW5jSXRlcmF0b3IsIGV4cG9ydHMuYXN5bmMgPSBmdW5jdGlvbiAoaW5uZXJGbiwgb3V0ZXJGbiwgc2VsZiwgdHJ5TG9jc0xpc3QsIFByb21pc2VJbXBsKSB7dm9pZCAwID09PSBQcm9taXNlSW1wbCAmJiAoUHJvbWlzZUltcGwgPSBQcm9taXNlKTt2YXIgaXRlciA9IG5ldyBBc3luY0l0ZXJhdG9yKHdyYXAoaW5uZXJGbiwgb3V0ZXJGbiwgc2VsZiwgdHJ5TG9jc0xpc3QpLCBQcm9taXNlSW1wbCk7cmV0dXJuIGV4cG9ydHMuaXNHZW5lcmF0b3JGdW5jdGlvbihvdXRlckZuKSA/IGl0ZXIgOiBpdGVyLm5leHQoKS50aGVuKGZ1bmN0aW9uIChyZXN1bHQpIHtyZXR1cm4gcmVzdWx0LmRvbmUgPyByZXN1bHQudmFsdWUgOiBpdGVyLm5leHQoKTt9KTt9LCBkZWZpbmVJdGVyYXRvck1ldGhvZHMoR3ApLCBkZWZpbmUoR3AsIHRvU3RyaW5nVGFnU3ltYm9sLCAiR2VuZXJhdG9yIiksIGRlZmluZShHcCwgaXRlcmF0b3JTeW1ib2wsIGZ1bmN0aW9uICgpIHtyZXR1cm4gdGhpczt9KSwgZGVmaW5lKEdwLCAidG9TdHJpbmciLCBmdW5jdGlvbiAoKSB7cmV0dXJuICJbb2JqZWN0IEdlbmVyYXRvcl0iO30pLCBleHBvcnRzLmtleXMgPSBmdW5jdGlvbiAodmFsKSB7dmFyIG9iamVjdCA9IE9iamVjdCh2YWwpLGtleXMgPSBbXTtmb3IgKHZhciBrZXkgaW4gb2JqZWN0KSB7a2V5cy5wdXNoKGtleSk7fXJldHVybiBrZXlzLnJldmVyc2UoKSwgZnVuY3Rpb24gbmV4dCgpIHtmb3IgKDsga2V5cy5sZW5ndGg7KSB7dmFyIGtleSA9IGtleXMucG9wKCk7aWYgKGtleSBpbiBvYmplY3QpIHJldHVybiBuZXh0LnZhbHVlID0ga2V5LCBuZXh0LmRvbmUgPSAhMSwgbmV4dDt9cmV0dXJuIG5leHQuZG9uZSA9ICEwLCBuZXh0O307fSwgZXhwb3J0cy52YWx1ZXMgPSB2YWx1ZXMsIENvbnRleHQucHJvdG90eXBlID0geyBjb25zdHJ1Y3RvcjogQ29udGV4dCwgcmVzZXQ6IGZ1bmN0aW9uIHJlc2V0KHNraXBUZW1wUmVzZXQpIHtpZiAodGhpcy5wcmV2ID0gMCwgdGhpcy5uZXh0ID0gMCwgdGhpcy5zZW50ID0gdGhpcy5fc2VudCA9IHVuZGVmaW5lZCwgdGhpcy5kb25lID0gITEsIHRoaXMuZGVsZWdhdGUgPSBudWxsLCB0aGlzLm1ldGhvZCA9ICJuZXh0IiwgdGhpcy5hcmcgPSB1bmRlZmluZWQsIHRoaXMudHJ5RW50cmllcy5mb3JFYWNoKHJlc2V0VHJ5RW50cnkpLCAhc2tpcFRlbXBSZXNldCkgZm9yICh2YXIgbmFtZSBpbiB0aGlzKSB7InQiID09PSBuYW1lLmNoYXJBdCgwKSAmJiBoYXNPd24uY2FsbCh0aGlzLCBuYW1lKSAmJiAhaXNOYU4oK25hbWUuc2xpY2UoMSkpICYmICh0aGlzW25hbWVdID0gdW5kZWZpbmVkKTt9fSwgc3RvcDogZnVuY3Rpb24gc3RvcCgpIHt0aGlzLmRvbmUgPSAhMDt2YXIgcm9vdFJlY29yZCA9IHRoaXMudHJ5RW50cmllc1swXS5jb21wbGV0aW9uO2lmICgidGhyb3ciID09PSByb290UmVjb3JkLnR5cGUpIHRocm93IHJvb3RSZWNvcmQuYXJnO3JldHVybiB0aGlzLnJ2YWw7fSwgZGlzcGF0Y2hFeGNlcHRpb246IGZ1bmN0aW9uIGRpc3BhdGNoRXhjZXB0aW9uKGV4Y2VwdGlvbikge2lmICh0aGlzLmRvbmUpIHRocm93IGV4Y2VwdGlvbjt2YXIgY29udGV4dCA9IHRoaXM7ZnVuY3Rpb24gaGFuZGxlKGxvYywgY2F1Z2h0KSB7cmV0dXJuIHJlY29yZC50eXBlID0gInRocm93IiwgcmVjb3JkLmFyZyA9IGV4Y2VwdGlvbiwgY29udGV4dC5uZXh0ID0gbG9jLCBjYXVnaHQgJiYgKGNvbnRleHQubWV0aG9kID0gIm5leHQiLCBjb250ZXh0LmFyZyA9IHVuZGVmaW5lZCksICEhY2F1Z2h0O31mb3IgKHZhciBpID0gdGhpcy50cnlFbnRyaWVzLmxlbmd0aCAtIDE7IGkgPj0gMDsgLS1pKSB7dmFyIGVudHJ5ID0gdGhpcy50cnlFbnRyaWVzW2ldLHJlY29yZCA9IGVudHJ5LmNvbXBsZXRpb247aWYgKCJyb290IiA9PT0gZW50cnkudHJ5TG9jKSByZXR1cm4gaGFuZGxlKCJlbmQiKTtpZiAoZW50cnkudHJ5TG9jIDw9IHRoaXMucHJldikge3ZhciBoYXNDYXRjaCA9IGhhc093bi5jYWxsKGVudHJ5LCAiY2F0Y2hMb2MiKSxoYXNGaW5hbGx5ID0gaGFzT3duLmNhbGwoZW50cnksICJmaW5hbGx5TG9jIik7aWYgKGhhc0NhdGNoICYmIGhhc0ZpbmFsbHkpIHtpZiAodGhpcy5wcmV2IDwgZW50cnkuY2F0Y2hMb2MpIHJldHVybiBoYW5kbGUoZW50cnkuY2F0Y2hMb2MsICEwKTtpZiAodGhpcy5wcmV2IDwgZW50cnkuZmluYWxseUxvYykgcmV0dXJuIGhhbmRsZShlbnRyeS5maW5hbGx5TG9jKTt9IGVsc2UgaWYgKGhhc0NhdGNoKSB7aWYgKHRoaXMucHJldiA8IGVudHJ5LmNhdGNoTG9jKSByZXR1cm4gaGFuZGxlKGVudHJ5LmNhdGNoTG9jLCAhMCk7fSBlbHNlIHtpZiAoIWhhc0ZpbmFsbHkpIHRocm93IG5ldyBFcnJvcigidHJ5IHN0YXRlbWVudCB3aXRob3V0IGNhdGNoIG9yIGZpbmFsbHkiKTtpZiAodGhpcy5wcmV2IDwgZW50cnkuZmluYWxseUxvYykgcmV0dXJuIGhhbmRsZShlbnRyeS5maW5hbGx5TG9jKTt9fX19LCBhYnJ1cHQ6IGZ1bmN0aW9uIGFicnVwdCh0eXBlLCBhcmcpIHtmb3IgKHZhciBpID0gdGhpcy50cnlFbnRyaWVzLmxlbmd0aCAtIDE7IGkgPj0gMDsgLS1pKSB7dmFyIGVudHJ5ID0gdGhpcy50cnlFbnRyaWVzW2ldO2lmIChlbnRyeS50cnlMb2MgPD0gdGhpcy5wcmV2ICYmIGhhc093bi5jYWxsKGVudHJ5LCAiZmluYWxseUxvYyIpICYmIHRoaXMucHJldiA8IGVudHJ5LmZpbmFsbHlMb2MpIHt2YXIgZmluYWxseUVudHJ5ID0gZW50cnk7YnJlYWs7fX1maW5hbGx5RW50cnkgJiYgKCJicmVhayIgPT09IHR5cGUgfHwgImNvbnRpbnVlIiA9PT0gdHlwZSkgJiYgZmluYWxseUVudHJ5LnRyeUxvYyA8PSBhcmcgJiYgYXJnIDw9IGZpbmFsbHlFbnRyeS5maW5hbGx5TG9jICYmIChmaW5hbGx5RW50cnkgPSBudWxsKTt2YXIgcmVjb3JkID0gZmluYWxseUVudHJ5ID8gZmluYWxseUVudHJ5LmNvbXBsZXRpb24gOiB7fTtyZXR1cm4gcmVjb3JkLnR5cGUgPSB0eXBlLCByZWNvcmQuYXJnID0gYXJnLCBmaW5hbGx5RW50cnkgPyAodGhpcy5tZXRob2QgPSAibmV4dCIsIHRoaXMubmV4dCA9IGZpbmFsbHlFbnRyeS5maW5hbGx5TG9jLCBDb250aW51ZVNlbnRpbmVsKSA6IHRoaXMuY29tcGxldGUocmVjb3JkKTt9LCBjb21wbGV0ZTogZnVuY3Rpb24gY29tcGxldGUocmVjb3JkLCBhZnRlckxvYykge2lmICgidGhyb3ciID09PSByZWNvcmQudHlwZSkgdGhyb3cgcmVjb3JkLmFyZztyZXR1cm4gImJyZWFrIiA9PT0gcmVjb3JkLnR5cGUgfHwgImNvbnRpbnVlIiA9PT0gcmVjb3JkLnR5cGUgPyB0aGlzLm5leHQgPSByZWNvcmQuYXJnIDogInJldHVybiIgPT09IHJlY29yZC50eXBlID8gKHRoaXMucnZhbCA9IHRoaXMuYXJnID0gcmVjb3JkLmFyZywgdGhpcy5tZXRob2QgPSAicmV0dXJuIiwgdGhpcy5uZXh0ID0gImVuZCIpIDogIm5vcm1hbCIgPT09IHJlY29yZC50eXBlICYmIGFmdGVyTG9jICYmICh0aGlzLm5leHQgPSBhZnRlckxvYyksIENvbnRpbnVlU2VudGluZWw7fSwgZmluaXNoOiBmdW5jdGlvbiBmaW5pc2goZmluYWxseUxvYykge2ZvciAodmFyIGkgPSB0aGlzLnRyeUVudHJpZXMubGVuZ3RoIC0gMTsgaSA+PSAwOyAtLWkpIHt2YXIgZW50cnkgPSB0aGlzLnRyeUVudHJpZXNbaV07aWYgKGVudHJ5LmZpbmFsbHlMb2MgPT09IGZpbmFsbHlMb2MpIHJldHVybiB0aGlzLmNvbXBsZXRlKGVudHJ5LmNvbXBsZXRpb24sIGVudHJ5LmFmdGVyTG9jKSwgcmVzZXRUcnlFbnRyeShlbnRyeSksIENvbnRpbnVlU2VudGluZWw7fX0sICJjYXRjaCI6IGZ1bmN0aW9uIF9jYXRjaCh0cnlMb2MpIHtmb3IgKHZhciBpID0gdGhpcy50cnlFbnRyaWVzLmxlbmd0aCAtIDE7IGkgPj0gMDsgLS1pKSB7dmFyIGVudHJ5ID0gdGhpcy50cnlFbnRyaWVzW2ldO2lmIChlbnRyeS50cnlMb2MgPT09IHRyeUxvYykge3ZhciByZWNvcmQgPSBlbnRyeS5jb21wbGV0aW9uO2lmICgidGhyb3ciID09PSByZWNvcmQudHlwZSkge3ZhciB0aHJvd24gPSByZWNvcmQuYXJnO3Jlc2V0VHJ5RW50cnkoZW50cnkpO31yZXR1cm4gdGhyb3duO319dGhyb3cgbmV3IEVycm9yKCJpbGxlZ2FsIGNhdGNoIGF0dGVtcHQiKTt9LCBkZWxlZ2F0ZVlpZWxkOiBmdW5jdGlvbiBkZWxlZ2F0ZVlpZWxkKGl0ZXJhYmxlLCByZXN1bHROYW1lLCBuZXh0TG9jKSB7cmV0dXJuIHRoaXMuZGVsZWdhdGUgPSB7IGl0ZXJhdG9yOiB2YWx1ZXMoaXRlcmFibGUpLCByZXN1bHROYW1lOiByZXN1bHROYW1lLCBuZXh0TG9jOiBuZXh0TG9jIH0sICJuZXh0IiA9PT0gdGhpcy5tZXRob2QgJiYgKHRoaXMuYXJnID0gdW5kZWZpbmVkKSwgQ29udGludWVTZW50aW5lbDt9IH0sIGV4cG9ydHM7fWZ1bmN0aW9uIF9zbGljZWRUb0FycmF5KGFyciwgaSkge3JldHVybiBfYXJyYXlXaXRoSG9sZXMoYXJyKSB8fCBfaXRlcmFibGVUb0FycmF5TGltaXQoYXJyLCBpKSB8fCBfdW5zdXBwb3J0ZWRJdGVyYWJsZVRvQXJyYXkoYXJyLCBpKSB8fCBfbm9uSXRlcmFibGVSZXN0KCk7fWZ1bmN0aW9uIF9ub25JdGVyYWJsZVJlc3QoKSB7dGhyb3cgbmV3IFR5cGVFcnJvcigiSW52YWxpZCBhdHRlbXB0IHRvIGRlc3RydWN0dXJlIG5vbi1pdGVyYWJsZSBpbnN0YW5jZS5cbkluIG9yZGVyIHRvIGJlIGl0ZXJhYmxlLCBub24tYXJyYXkgb2JqZWN0cyBtdXN0IGhhdmUgYSBbU3ltYm9sLml0ZXJhdG9yXSgpIG1ldGhvZC4iKTt9ZnVuY3Rpb24gX3Vuc3VwcG9ydGVkSXRlcmFibGVUb0FycmF5KG8sIG1pbkxlbikge2lmICghbykgcmV0dXJuO2lmICh0eXBlb2YgbyA9PT0gInN0cmluZyIpIHJldHVybiBfYXJyYXlMaWtlVG9BcnJheShvLCBtaW5MZW4pO3ZhciBuID0gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKG8pLnNsaWNlKDgsIC0xKTtpZiAobiA9PT0gIk9iamVjdCIgJiYgby5jb25zdHJ1Y3RvcikgbiA9IG8uY29uc3RydWN0b3IubmFtZTtpZiAobiA9PT0gIk1hcCIgfHwgbiA9PT0gIlNldCIpIHJldHVybiBBcnJheS5mcm9tKG8pO2lmIChuID09PSAiQXJndW1lbnRzIiB8fCAvXig/OlVpfEkpbnQoPzo4fDE2fDMyKSg/OkNsYW1wZWQpP0FycmF5JC8udGVzdChuKSkgcmV0dXJuIF9hcnJheUxpa2VUb0FycmF5KG8sIG1pbkxlbik7fWZ1bmN0aW9uIF9hcnJheUxpa2VUb0FycmF5KGFyciwgbGVuKSB7aWYgKGxlbiA9PSBudWxsIHx8IGxlbiA+IGFyci5sZW5ndGgpIGxlbiA9IGFyci5sZW5ndGg7Zm9yICh2YXIgaSA9IDAsIGFycjIgPSBuZXcgQXJyYXkobGVuKTsgaSA8IGxlbjsgaSsrKSB7YXJyMltpXSA9IGFycltpXTt9cmV0dXJuIGFycjI7fWZ1bmN0aW9uIF9pdGVyYWJsZVRvQXJyYXlMaW1pdChhcnIsIGkpIHt2YXIgX2kgPSBhcnIgPT0gbnVsbCA/IG51bGwgOiB0eXBlb2YgU3ltYm9sICE9PSAidW5kZWZpbmVkIiAmJiBhcnJbU3ltYm9sLml0ZXJhdG9yXSB8fCBhcnJbIkBAaXRlcmF0b3IiXTtpZiAoX2kgPT0gbnVsbCkgcmV0dXJuO3ZhciBfYXJyID0gW107dmFyIF9uID0gdHJ1ZTt2YXIgX2QgPSBmYWxzZTt2YXIgX3MsIF9lO3RyeSB7Zm9yIChfaSA9IF9pLmNhbGwoYXJyKTsgIShfbiA9IChfcyA9IF9pLm5leHQoKSkuZG9uZSk7IF9uID0gdHJ1ZSkge19hcnIucHVzaChfcy52YWx1ZSk7aWYgKGkgJiYgX2Fyci5sZW5ndGggPT09IGkpIGJyZWFrO319IGNhdGNoIChlcnIpIHtfZCA9IHRydWU7X2UgPSBlcnI7fSBmaW5hbGx5IHt0cnkge2lmICghX24gJiYgX2lbInJldHVybiJdICE9IG51bGwpIF9pWyJyZXR1cm4iXSgpO30gZmluYWxseSB7aWYgKF9kKSB0aHJvdyBfZTt9fXJldHVybiBfYXJyO31mdW5jdGlvbiBfYXJyYXlXaXRoSG9sZXMoYXJyKSB7aWYgKEFycmF5LmlzQXJyYXkoYXJyKSkgcmV0dXJuIGFycjt9ZnVuY3Rpb24gYXN5bmNHZW5lcmF0b3JTdGVwKGdlbiwgcmVzb2x2ZSwgcmVqZWN0LCBfbmV4dCwgX3Rocm93LCBrZXksIGFyZykge3RyeSB7dmFyIGluZm8gPSBnZW5ba2V5XShhcmcpO3ZhciB2YWx1ZSA9IGluZm8udmFsdWU7fSBjYXRjaCAoZXJyb3IpIHtyZWplY3QoZXJyb3IpO3JldHVybjt9aWYgKGluZm8uZG9uZSkge3Jlc29sdmUodmFsdWUpO30gZWxzZSB7UHJvbWlzZS5yZXNvbHZlKHZhbHVlKS50aGVuKF9uZXh0LCBfdGhyb3cpO319ZnVuY3Rpb24gX2FzeW5jVG9HZW5lcmF0b3IoZm4pIHtyZXR1cm4gZnVuY3Rpb24gKCkge3ZhciBzZWxmID0gdGhpcyxhcmdzID0gYXJndW1lbnRzO3JldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7dmFyIGdlbiA9IGZuLmFwcGx5KHNlbGYsIGFyZ3MpO2Z1bmN0aW9uIF9uZXh0KHZhbHVlKSB7YXN5bmNHZW5lcmF0b3JTdGVwKGdlbiwgcmVzb2x2ZSwgcmVqZWN0LCBfbmV4dCwgX3Rocm93LCAibmV4dCIsIHZhbHVlKTt9ZnVuY3Rpb24gX3Rocm93KGVycikge2FzeW5jR2VuZXJhdG9yU3RlcChnZW4sIHJlc29sdmUsIHJlamVjdCwgX25leHQsIF90aHJvdywgInRocm93IiwgZXJyKTt9X25leHQodW5kZWZpbmVkKTt9KTt9O31mdW5jdGlvbgogICAgICAgICAgZ2V0UHJvcGVydHkoX3gpIHtyZXR1cm4gX2dldFByb3BlcnR5LmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7fWZ1bmN0aW9uIF9nZXRQcm9wZXJ0eSgpIHtfZ2V0UHJvcGVydHkgPSBfYXN5bmNUb0dlbmVyYXRvciggLyojX19QVVJFX18qL19yZWdlbmVyYXRvclJ1bnRpbWUoKS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUocHJvcGVydHkpIHtyZXR1cm4gX3JlZ2VuZXJhdG9yUnVudGltZSgpLndyYXAoZnVuY3Rpb24gX2NhbGxlZSQoX2NvbnRleHQpIHt3aGlsZSAoMSkge3N3aXRjaCAoX2NvbnRleHQucHJldiA9IF9jb250ZXh0Lm5leHQpIHtjYXNlIDA6cmV0dXJuIF9jb250ZXh0LmFicnVwdCgicmV0dXJuIiwKICAgICAgICAgICAgICAgICAgICAgIHJ1bkphdmFzY3JpcHQoInJlcXVpcmUoYGtvbG1hZmlhYCkuZ2V0UHJvcGVydHkoYCIuY29uY2F0KHByb3BlcnR5LCAiYCk7IikpKTtjYXNlIDE6Y2FzZSAiZW5kIjpyZXR1cm4gX2NvbnRleHQuc3RvcCgpO319fSwgX2NhbGxlZSk7fSkpO3JldHVybiBfZ2V0UHJvcGVydHkuYXBwbHkodGhpcywgYXJndW1lbnRzKTt9CgoKICAgICAgICAgIGZ1bmN0aW9uIGFkZE5vdGlmaWNhdGlvbihub3RpZmljYXRpb24pIHsKICAgICAgICAgICAgdmFyIGVsZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpOwogICAgICAgICAgICBlbGUuY2xhc3NOYW1lID0gIm5vdGlmaWNhdGlvbiI7CiAgICAgICAgICAgIGVsZS5hZGRFdmVudExpc3RlbmVyKCJhbmltYXRpb25lbmQiLCBmdW5jdGlvbiAoKSB7cmV0dXJuIGVsZS5yZW1vdmUoKTt9KTsKICAgICAgICAgICAgZWxlLmlubmVyVGV4dCA9IG5vdGlmaWNhdGlvbjsKCiAgICAgICAgICAgIHZhciBjb250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgibm90aWZpY2F0aW9uc0NvbnRhaW5lciIpOwoKICAgICAgICAgICAgaWYgKCFjb250YWluZXIpIHsKICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGNvbnRhaW5lci5hcHBlbmRDaGlsZChlbGUpOwogICAgICAgICAgfQoKICAgICAgICAgIGZ1bmN0aW9uIHNldFByb3BlcnR5KF94MiwgX3gzKSB7cmV0dXJuIF9zZXRQcm9wZXJ0eS5hcHBseSh0aGlzLCBhcmd1bWVudHMpO31mdW5jdGlvbiBfc2V0UHJvcGVydHkoKSB7X3NldFByb3BlcnR5ID0gX2FzeW5jVG9HZW5lcmF0b3IoIC8qI19fUFVSRV9fKi9fcmVnZW5lcmF0b3JSdW50aW1lKCkubWFyayhmdW5jdGlvbiBfY2FsbGVlMigKICAgICAgICAgICAgcHJvcGVydHksCiAgICAgICAgICAgIHZhbHVlKSB7cmV0dXJuIF9yZWdlbmVyYXRvclJ1bnRpbWUoKS53cmFwKGZ1bmN0aW9uIF9jYWxsZWUyJChfY29udGV4dDIpIHt3aGlsZSAoMSkge3N3aXRjaCAoX2NvbnRleHQyLnByZXYgPSBfY29udGV4dDIubmV4dCkge2Nhc2UgMDpfY29udGV4dDIubmV4dCA9IDI7cmV0dXJuICgKCiAgICAgICAgICAgICAgICAgICAgICAgIHJ1bkphdmFzY3JpcHQoInJlcXVpcmUoXCJrb2xtYWZpYVwiKS5zZXRQcm9wZXJ0eShgIi5jb25jYXQoCiAgICAgICAgICAgICAgICAgICAgICAgIHByb3BlcnR5LCAiYCwgYCIpLmNvbmNhdCh2YWx1ZSwgImApOyIpKSk7Y2FzZSAyOmNhc2UgImVuZCI6cmV0dXJuIF9jb250ZXh0Mi5zdG9wKCk7fX19LCBfY2FsbGVlMik7fSkpO3JldHVybiBfc2V0UHJvcGVydHkuYXBwbHkodGhpcywgYXJndW1lbnRzKTt9CgoKCiAgICAgICAgICBmdW5jdGlvbiBzYXZlU2V0dGluZ3MocHJvcGVydGllcykgewogICAgICAgICAgICByZXR1cm4gc2V0UHJvcGVydGllcygKICAgICAgICAgICAgcHJvcGVydGllcy4KICAgICAgICAgICAgZmlsdGVyKGZ1bmN0aW9uIChwKSB7CiAgICAgICAgICAgICAgaWYgKHAucHJldmlvdXNWYWx1ZSA9PT0gcC52YWx1ZSkgewogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgcC5wcmV2aW91c1ZhbHVlID0gcC52YWx1ZTsKICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgfSkuCiAgICAgICAgICAgIG1hcChmdW5jdGlvbiAocHJvcCkge3JldHVybiBbcHJvcC5wcmVmZXJlbmNlLCBwcm9wLnZhbHVlLnRyaW0oKV07fSkpOwoKICAgICAgICAgIH0KCiAgICAgICAgICBmdW5jdGlvbiBzZXRQcm9wZXJ0aWVzKHByb3BlcnRpZXMpIHsKICAgICAgICAgICAgdmFyIGpzID0KICAgICAgICAgICAgJ2NvbnN0IGNoYW5nZWQgPSBbXTsgY29uc3QgY2hhbmdlID0gKGtleSwgdmFsdWUpID0+IHsgbGV0IHByZXYgPSByZXF1aXJlKCJrb2xtYWZpYSIpLmdldFByb3BlcnR5KGtleSk7IGlmIChwcmV2ID09PSB2YWx1ZSlyZXR1cm47IGNoYW5nZWQucHVzaChba2V5LCBwcmV2LCB2YWx1ZV0pOyByZXF1aXJlKCJrb2xtYWZpYSIpLnNldFByb3BlcnR5KGtleSwgdmFsdWUpO307JzsKCiAgICAgICAgICAgIGpzICs9IHByb3BlcnRpZXMuCiAgICAgICAgICAgIG1hcChmdW5jdGlvbiAoX3JlZikge3ZhciBfcmVmMiA9IF9zbGljZWRUb0FycmF5KF9yZWYsIDIpLGsgPSBfcmVmMlswXSx2ID0gX3JlZjJbMV07CiAgICAgICAgICAgICAgcmV0dXJuICJjaGFuZ2UoYCIuY29uY2F0KGssICJgLCBgIikuY29uY2F0KHYsICJgKTsiKTsKICAgICAgICAgICAgfSkuCiAgICAgICAgICAgIGpvaW4oIlxuIik7CgogICAgICAgICAgICBqcyArPSAiSlNPTi5zdHJpbmdpZnkoY2hhbmdlZCk7IjsKCiAgICAgICAgICAgIHJldHVybiBydW5KYXZhc2NyaXB0KGpzKTsKICAgICAgICAgIH1mdW5jdGlvbgoKICAgICAgICAgIHJ1bkphdmFzY3JpcHQoX3g0KSB7cmV0dXJuIF9ydW5KYXZhc2NyaXB0LmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7fWZ1bmN0aW9uIF9ydW5KYXZhc2NyaXB0KCkge19ydW5KYXZhc2NyaXB0ID0gX2FzeW5jVG9HZW5lcmF0b3IoIC8qI19fUFVSRV9fKi9fcmVnZW5lcmF0b3JSdW50aW1lKCkubWFyayhmdW5jdGlvbiBfY2FsbGVlMyhqYXZhc2NyaXB0KSB7cmV0dXJuIF9yZWdlbmVyYXRvclJ1bnRpbWUoKS53cmFwKGZ1bmN0aW9uIF9jYWxsZWUzJChfY29udGV4dDMpIHt3aGlsZSAoMSkge3N3aXRjaCAoX2NvbnRleHQzLnByZXYgPSBfY29udGV4dDMubmV4dCkge2Nhc2UgMDpyZXR1cm4gX2NvbnRleHQzLmFicnVwdCgicmV0dXJuIiwKICAgICAgICAgICAgICAgICAgICAgIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciB4aHIgPSBuZXcgWE1MSHR0cFJlcXVlc3QoKTsKICAgICAgICAgICAgICAgICAgICAgICAgeGhyLnJlc3BvbnNlVHlwZSA9ICJ0ZXh0IjsKICAgICAgICAgICAgICAgICAgICAgICAgeGhyLm9wZW4oIlBPU1QiLCBkb2N1bWVudC5sb2NhdGlvbi5ocmVmLCB0cnVlKTsKICAgICAgICAgICAgICAgICAgICAgICAgeGhyLnNldFJlcXVlc3RIZWFkZXIoIkNvbnRlbnQtVHlwZSIsICJhcHBsaWNhdGlvbi94LXd3dy1mb3JtLXVybGVuY29kZWQiKTsKICAgICAgICAgICAgICAgICAgICAgICAgeGhyLnNlbmQoImFwaT0iICsgZW5jb2RlVVJJQ29tcG9uZW50KGphdmFzY3JpcHQpKTsKICAgICAgICAgICAgICAgICAgICAgICAgeGhyLm9ucmVhZHlzdGF0ZWNoYW5nZSA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoeGhyLnJlYWR5U3RhdGUgIT0gNCB8fCB4aHIuc3RhdHVzICE9IDIwMCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZSh4aHIucmVzcG9uc2VUZXh0KTsKICAgICAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgICAgICAgIH0pKTtjYXNlIDE6Y2FzZSAiZW5kIjpyZXR1cm4gX2NvbnRleHQzLnN0b3AoKTt9fX0sIF9jYWxsZWUzKTt9KSk7cmV0dXJuIF9ydW5KYXZhc2NyaXB0LmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7fQogICAgICAgICAgOyAvLyBDT05DQVRFTkFURUQgTU9EVUxFOiAuL3NyYy9yZWxheS9hcGkvU2V0dGluZ1ZhbGlkYXRvci50c3gKICAgICAgICAgIGZ1bmN0aW9uIFNldHRpbmdWYWxpZGF0b3Jfc2xpY2VkVG9BcnJheShhcnIsIGkpIHtyZXR1cm4gU2V0dGluZ1ZhbGlkYXRvcl9hcnJheVdpdGhIb2xlcyhhcnIpIHx8IFNldHRpbmdWYWxpZGF0b3JfaXRlcmFibGVUb0FycmF5TGltaXQoYXJyLCBpKSB8fCBTZXR0aW5nVmFsaWRhdG9yX3Vuc3VwcG9ydGVkSXRlcmFibGVUb0FycmF5KGFyciwgaSkgfHwgU2V0dGluZ1ZhbGlkYXRvcl9ub25JdGVyYWJsZVJlc3QoKTt9ZnVuY3Rpb24gU2V0dGluZ1ZhbGlkYXRvcl9ub25JdGVyYWJsZVJlc3QoKSB7dGhyb3cgbmV3IFR5cGVFcnJvcigiSW52YWxpZCBhdHRlbXB0IHRvIGRlc3RydWN0dXJlIG5vbi1pdGVyYWJsZSBpbnN0YW5jZS5cbkluIG9yZGVyIHRvIGJlIGl0ZXJhYmxlLCBub24tYXJyYXkgb2JqZWN0cyBtdXN0IGhhdmUgYSBbU3ltYm9sLml0ZXJhdG9yXSgpIG1ldGhvZC4iKTt9ZnVuY3Rpb24gU2V0dGluZ1ZhbGlkYXRvcl9pdGVyYWJsZVRvQXJyYXlMaW1pdChhcnIsIGkpIHt2YXIgX2kgPSBhcnIgPT0gbnVsbCA/IG51bGwgOiB0eXBlb2YgU3ltYm9sICE9PSAidW5kZWZpbmVkIiAmJiBhcnJbU3ltYm9sLml0ZXJhdG9yXSB8fCBhcnJbIkBAaXRlcmF0b3IiXTtpZiAoX2kgPT0gbnVsbCkgcmV0dXJuO3ZhciBfYXJyID0gW107dmFyIF9uID0gdHJ1ZTt2YXIgX2QgPSBmYWxzZTt2YXIgX3MsIF9lO3RyeSB7Zm9yIChfaSA9IF9pLmNhbGwoYXJyKTsgIShfbiA9IChfcyA9IF9pLm5leHQoKSkuZG9uZSk7IF9uID0gdHJ1ZSkge19hcnIucHVzaChfcy52YWx1ZSk7aWYgKGkgJiYgX2Fyci5sZW5ndGggPT09IGkpIGJyZWFrO319IGNhdGNoIChlcnIpIHtfZCA9IHRydWU7X2UgPSBlcnI7fSBmaW5hbGx5IHt0cnkge2lmICghX24gJiYgX2lbInJldHVybiJdICE9IG51bGwpIF9pWyJyZXR1cm4iXSgpO30gZmluYWxseSB7aWYgKF9kKSB0aHJvdyBfZTt9fXJldHVybiBfYXJyO31mdW5jdGlvbiBTZXR0aW5nVmFsaWRhdG9yX2FycmF5V2l0aEhvbGVzKGFycikge2lmIChBcnJheS5pc0FycmF5KGFycikpIHJldHVybiBhcnI7fWZ1bmN0aW9uIF9jcmVhdGVGb3JPZkl0ZXJhdG9ySGVscGVyKG8sIGFsbG93QXJyYXlMaWtlKSB7dmFyIGl0ID0gdHlwZW9mIFN5bWJvbCAhPT0gInVuZGVmaW5lZCIgJiYgb1tTeW1ib2wuaXRlcmF0b3JdIHx8IG9bIkBAaXRlcmF0b3IiXTtpZiAoIWl0KSB7aWYgKEFycmF5LmlzQXJyYXkobykgfHwgKGl0ID0gU2V0dGluZ1ZhbGlkYXRvcl91bnN1cHBvcnRlZEl0ZXJhYmxlVG9BcnJheShvKSkgfHwgYWxsb3dBcnJheUxpa2UgJiYgbyAmJiB0eXBlb2Ygby5sZW5ndGggPT09ICJudW1iZXIiKSB7aWYgKGl0KSBvID0gaXQ7dmFyIGkgPSAwO3ZhciBGID0gZnVuY3Rpb24gRigpIHt9O3JldHVybiB7IHM6IEYsIG46IGZ1bmN0aW9uIG4oKSB7aWYgKGkgPj0gby5sZW5ndGgpIHJldHVybiB7IGRvbmU6IHRydWUgfTtyZXR1cm4geyBkb25lOiBmYWxzZSwgdmFsdWU6IG9baSsrXSB9O30sIGU6IGZ1bmN0aW9uIGUoX2UyKSB7dGhyb3cgX2UyO30sIGY6IEYgfTt9dGhyb3cgbmV3IFR5cGVFcnJvcigiSW52YWxpZCBhdHRlbXB0IHRvIGl0ZXJhdGUgbm9uLWl0ZXJhYmxlIGluc3RhbmNlLlxuSW4gb3JkZXIgdG8gYmUgaXRlcmFibGUsIG5vbi1hcnJheSBvYmplY3RzIG11c3QgaGF2ZSBhIFtTeW1ib2wuaXRlcmF0b3JdKCkgbWV0aG9kLiIpO312YXIgbm9ybWFsQ29tcGxldGlvbiA9IHRydWUsZGlkRXJyID0gZmFsc2UsZXJyO3JldHVybiB7IHM6IGZ1bmN0aW9uIHMoKSB7aXQgPSBpdC5jYWxsKG8pO30sIG46IGZ1bmN0aW9uIG4oKSB7dmFyIHN0ZXAgPSBpdC5uZXh0KCk7bm9ybWFsQ29tcGxldGlvbiA9IHN0ZXAuZG9uZTtyZXR1cm4gc3RlcDt9LCBlOiBmdW5jdGlvbiBlKF9lMykge2RpZEVyciA9IHRydWU7ZXJyID0gX2UzO30sIGY6IGZ1bmN0aW9uIGYoKSB7dHJ5IHtpZiAoIW5vcm1hbENvbXBsZXRpb24gJiYgaXRbInJldHVybiJdICE9IG51bGwpIGl0WyJyZXR1cm4iXSgpO30gZmluYWxseSB7aWYgKGRpZEVycikgdGhyb3cgZXJyO319IH07fWZ1bmN0aW9uIFNldHRpbmdWYWxpZGF0b3JfdW5zdXBwb3J0ZWRJdGVyYWJsZVRvQXJyYXkobywgbWluTGVuKSB7aWYgKCFvKSByZXR1cm47aWYgKHR5cGVvZiBvID09PSAic3RyaW5nIikgcmV0dXJuIFNldHRpbmdWYWxpZGF0b3JfYXJyYXlMaWtlVG9BcnJheShvLCBtaW5MZW4pO3ZhciBuID0gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKG8pLnNsaWNlKDgsIC0xKTtpZiAobiA9PT0gIk9iamVjdCIgJiYgby5jb25zdHJ1Y3RvcikgbiA9IG8uY29uc3RydWN0b3IubmFtZTtpZiAobiA9PT0gIk1hcCIgfHwgbiA9PT0gIlNldCIpIHJldHVybiBBcnJheS5mcm9tKG8pO2lmIChuID09PSAiQXJndW1lbnRzIiB8fCAvXig/OlVpfEkpbnQoPzo4fDE2fDMyKSg/OkNsYW1wZWQpP0FycmF5JC8udGVzdChuKSkgcmV0dXJuIFNldHRpbmdWYWxpZGF0b3JfYXJyYXlMaWtlVG9BcnJheShvLCBtaW5MZW4pO31mdW5jdGlvbiBTZXR0aW5nVmFsaWRhdG9yX2FycmF5TGlrZVRvQXJyYXkoYXJyLCBsZW4pIHtpZiAobGVuID09IG51bGwgfHwgbGVuID4gYXJyLmxlbmd0aCkgbGVuID0gYXJyLmxlbmd0aDtmb3IgKHZhciBpID0gMCwgYXJyMiA9IG5ldyBBcnJheShsZW4pOyBpIDwgbGVuOyBpKyspIHthcnIyW2ldID0gYXJyW2ldO31yZXR1cm4gYXJyMjt9ZnVuY3Rpb24gX2NsYXNzQ2FsbENoZWNrKGluc3RhbmNlLCBDb25zdHJ1Y3Rvcikge2lmICghKGluc3RhbmNlIGluc3RhbmNlb2YgQ29uc3RydWN0b3IpKSB7dGhyb3cgbmV3IFR5cGVFcnJvcigiQ2Fubm90IGNhbGwgYSBjbGFzcyBhcyBhIGZ1bmN0aW9uIik7fX1mdW5jdGlvbiBfZGVmaW5lUHJvcGVydGllcyh0YXJnZXQsIHByb3BzKSB7Zm9yICh2YXIgaSA9IDA7IGkgPCBwcm9wcy5sZW5ndGg7IGkrKykge3ZhciBkZXNjcmlwdG9yID0gcHJvcHNbaV07ZGVzY3JpcHRvci5lbnVtZXJhYmxlID0gZGVzY3JpcHRvci5lbnVtZXJhYmxlIHx8IGZhbHNlO2Rlc2NyaXB0b3IuY29uZmlndXJhYmxlID0gdHJ1ZTtpZiAoInZhbHVlIiBpbiBkZXNjcmlwdG9yKSBkZXNjcmlwdG9yLndyaXRhYmxlID0gdHJ1ZTtPYmplY3QuZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBkZXNjcmlwdG9yLmtleSwgZGVzY3JpcHRvcik7fX1mdW5jdGlvbiBfY3JlYXRlQ2xhc3MoQ29uc3RydWN0b3IsIHByb3RvUHJvcHMsIHN0YXRpY1Byb3BzKSB7aWYgKHByb3RvUHJvcHMpIF9kZWZpbmVQcm9wZXJ0aWVzKENvbnN0cnVjdG9yLnByb3RvdHlwZSwgcHJvdG9Qcm9wcyk7aWYgKHN0YXRpY1Byb3BzKSBfZGVmaW5lUHJvcGVydGllcyhDb25zdHJ1Y3Rvciwgc3RhdGljUHJvcHMpO09iamVjdC5kZWZpbmVQcm9wZXJ0eShDb25zdHJ1Y3RvciwgInByb3RvdHlwZSIsIHsgd3JpdGFibGU6IGZhbHNlIH0pO3JldHVybiBDb25zdHJ1Y3Rvcjt9ZnVuY3Rpb24gX2RlZmluZVByb3BlcnR5KG9iaiwga2V5LCB2YWx1ZSkge2lmIChrZXkgaW4gb2JqKSB7T2JqZWN0LmRlZmluZVByb3BlcnR5KG9iaiwga2V5LCB7IHZhbHVlOiB2YWx1ZSwgZW51bWVyYWJsZTogdHJ1ZSwgY29uZmlndXJhYmxlOiB0cnVlLCB3cml0YWJsZTogdHJ1ZSB9KTt9IGVsc2Uge29ialtrZXldID0gdmFsdWU7fXJldHVybiBvYmo7fXZhcgoKCiAgICAgICAgICBTZXR0aW5nVmFsaWRhdG9yID0gLyojX19QVVJFX18qL2Z1bmN0aW9uICgpIHtmdW5jdGlvbiBTZXR0aW5nVmFsaWRhdG9yKCkge19jbGFzc0NhbGxDaGVjayh0aGlzLCBTZXR0aW5nVmFsaWRhdG9yKTtfZGVmaW5lUHJvcGVydHkodGhpcywgInNldHRpbmdzIiwKICAgICAgICAgICAgICBbXSk7X2RlZmluZVByb3BlcnR5KHRoaXMsICJvYmplY3QiLAogICAgICAgICAgICAgIHt9KTt9X2NyZWF0ZUNsYXNzKFNldHRpbmdWYWxpZGF0b3IsIFt7IGtleTogImFkZFNldHRpbmciLCB2YWx1ZToKCiAgICAgICAgICAgICAgZnVuY3Rpb24gYWRkU2V0dGluZyhzZXR0aW5nLCBzZXRTdGF0ZSkgewogICAgICAgICAgICAgICAgdGhpcy5zZXR0aW5ncy5wdXNoKFtzZXR0aW5nLCBzZXRTdGF0ZV0pOwogICAgICAgICAgICAgIH0gfSwgeyBrZXk6ICJ1cGRhdGVTZXR0aW5nIiwgdmFsdWU6CgogICAgICAgICAgICAgIGZ1bmN0aW9uIHVwZGF0ZVNldHRpbmcoc2V0dGluZykgewogICAgICAgICAgICAgICAgdGhpcy5vYmplY3Rbc2V0dGluZy5wcmVmZXJlbmNlXSA9IHNldHRpbmcudmFsdWU7CiAgICAgICAgICAgICAgICB0aGlzLmRvVmFsaWRhdGVzKCk7CiAgICAgICAgICAgICAgfSB9LCB7IGtleTogInVwZGF0ZU9iamVjdCIsIHZhbHVlOgoKICAgICAgICAgICAgICBmdW5jdGlvbiB1cGRhdGVPYmplY3QoKSB7dmFyIF9pdGVyYXRvciA9IF9jcmVhdGVGb3JPZkl0ZXJhdG9ySGVscGVyKAogICAgICAgICAgICAgICAgICB0aGlzLnNldHRpbmdzKSxfc3RlcDt0cnkge2ZvciAoX2l0ZXJhdG9yLnMoKTsgIShfc3RlcCA9IF9pdGVyYXRvci5uKCkpLmRvbmU7KSB7dmFyIF9zdGVwJHZhbHVlID0gU2V0dGluZ1ZhbGlkYXRvcl9zbGljZWRUb0FycmF5KF9zdGVwLnZhbHVlLCAxKSxzZXR0aW5nID0gX3N0ZXAkdmFsdWVbMF07CiAgICAgICAgICAgICAgICAgICAgdGhpcy5vYmplY3Rbc2V0dGluZy5wcmVmZXJlbmNlXSA9IHNldHRpbmcudmFsdWU7CiAgICAgICAgICAgICAgICAgIH19IGNhdGNoIChlcnIpIHtfaXRlcmF0b3IuZShlcnIpO30gZmluYWxseSB7X2l0ZXJhdG9yLmYoKTt9CiAgICAgICAgICAgICAgfSB9LCB7IGtleTogImRvVmFsaWRhdGVzIiwgdmFsdWU6CgogICAgICAgICAgICAgIGZ1bmN0aW9uIGRvVmFsaWRhdGVzKCkge3ZhciBfaXRlcmF0b3IyID0gX2NyZWF0ZUZvck9mSXRlcmF0b3JIZWxwZXIoCiAgICAgICAgICAgICAgICAgIHRoaXMuc2V0dGluZ3MpLF9zdGVwMjt0cnkge2ZvciAoX2l0ZXJhdG9yMi5zKCk7ICEoX3N0ZXAyID0gX2l0ZXJhdG9yMi5uKCkpLmRvbmU7KSB7dmFyIF9zdGVwMiR2YWx1ZSA9IFNldHRpbmdWYWxpZGF0b3Jfc2xpY2VkVG9BcnJheShfc3RlcDIudmFsdWUsIDIpLHNldHRpbmcgPSBfc3RlcDIkdmFsdWVbMF0sc2V0VmFsaWQgPSBfc3RlcDIkdmFsdWVbMV07CiAgICAgICAgICAgICAgICAgICAgc2V0VmFsaWQodGhpcy5pc1ZhbGlkKHNldHRpbmcpKTsKICAgICAgICAgICAgICAgICAgfX0gY2F0Y2ggKGVycikge19pdGVyYXRvcjIuZShlcnIpO30gZmluYWxseSB7X2l0ZXJhdG9yMi5mKCk7fQogICAgICAgICAgICAgIH0gfSwgeyBrZXk6ICJpc1ZhbGlkIiwgdmFsdWU6CgogICAgICAgICAgICAgIGZ1bmN0aW9uIGlzVmFsaWQoc2V0dGluZykgewogICAgICAgICAgICAgICAgcmV0dXJuICgKICAgICAgICAgICAgICAgICAgc2V0dGluZy52YWxpZGF0ZSA9PSBudWxsIHx8IHNldHRpbmcudmFsaWRhdGUoc2V0dGluZy52YWx1ZSwgdGhpcy5vYmplY3QpKTsKCiAgICAgICAgICAgICAgfSB9XSk7cmV0dXJuIFNldHRpbmdWYWxpZGF0b3I7fSgpOwoKCiAgICAgICAgICAvKiBoYXJtb255IGRlZmF1bHQgZXhwb3J0ICovdmFyIGFwaV9TZXR0aW5nVmFsaWRhdG9yID0gU2V0dGluZ1ZhbGlkYXRvcjsKICAgICAgICAgIDsgLy8gQ09OQ0FURU5BVEVEIE1PRFVMRTogLi9zcmMvcmVsYXkvY29tcG9uZW50cy9JbnRlcnJ1cHQudHN4CiAgICAgICAgICBmdW5jdGlvbiBfdG9Db25zdW1hYmxlQXJyYXkoYXJyKSB7cmV0dXJuIF9hcnJheVdpdGhvdXRIb2xlcyhhcnIpIHx8IF9pdGVyYWJsZVRvQXJyYXkoYXJyKSB8fCBJbnRlcnJ1cHRfdW5zdXBwb3J0ZWRJdGVyYWJsZVRvQXJyYXkoYXJyKSB8fCBfbm9uSXRlcmFibGVTcHJlYWQoKTt9ZnVuY3Rpb24gX25vbkl0ZXJhYmxlU3ByZWFkKCkge3Rocm93IG5ldyBUeXBlRXJyb3IoIkludmFsaWQgYXR0ZW1wdCB0byBzcHJlYWQgbm9uLWl0ZXJhYmxlIGluc3RhbmNlLlxuSW4gb3JkZXIgdG8gYmUgaXRlcmFibGUsIG5vbi1hcnJheSBvYmplY3RzIG11c3QgaGF2ZSBhIFtTeW1ib2wuaXRlcmF0b3JdKCkgbWV0aG9kLiIpO31mdW5jdGlvbiBJbnRlcnJ1cHRfdW5zdXBwb3J0ZWRJdGVyYWJsZVRvQXJyYXkobywgbWluTGVuKSB7aWYgKCFvKSByZXR1cm47aWYgKHR5cGVvZiBvID09PSAic3RyaW5nIikgcmV0dXJuIEludGVycnVwdF9hcnJheUxpa2VUb0FycmF5KG8sIG1pbkxlbik7dmFyIG4gPSBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwobykuc2xpY2UoOCwgLTEpO2lmIChuID09PSAiT2JqZWN0IiAmJiBvLmNvbnN0cnVjdG9yKSBuID0gby5jb25zdHJ1Y3Rvci5uYW1lO2lmIChuID09PSAiTWFwIiB8fCBuID09PSAiU2V0IikgcmV0dXJuIEFycmF5LmZyb20obyk7aWYgKG4gPT09ICJBcmd1bWVudHMiIHx8IC9eKD86VWl8SSludCg/Ojh8MTZ8MzIpKD86Q2xhbXBlZCk/QXJyYXkkLy50ZXN0KG4pKSByZXR1cm4gSW50ZXJydXB0X2FycmF5TGlrZVRvQXJyYXkobywgbWluTGVuKTt9ZnVuY3Rpb24gX2l0ZXJhYmxlVG9BcnJheShpdGVyKSB7aWYgKHR5cGVvZiBTeW1ib2wgIT09ICJ1bmRlZmluZWQiICYmIGl0ZXJbU3ltYm9sLml0ZXJhdG9yXSAhPSBudWxsIHx8IGl0ZXJbIkBAaXRlcmF0b3IiXSAhPSBudWxsKSByZXR1cm4gQXJyYXkuZnJvbShpdGVyKTt9ZnVuY3Rpb24gX2FycmF5V2l0aG91dEhvbGVzKGFycikge2lmIChBcnJheS5pc0FycmF5KGFycikpIHJldHVybiBJbnRlcnJ1cHRfYXJyYXlMaWtlVG9BcnJheShhcnIpO31mdW5jdGlvbiBJbnRlcnJ1cHRfYXJyYXlMaWtlVG9BcnJheShhcnIsIGxlbikge2lmIChsZW4gPT0gbnVsbCB8fCBsZW4gPiBhcnIubGVuZ3RoKSBsZW4gPSBhcnIubGVuZ3RoO2ZvciAodmFyIGkgPSAwLCBhcnIyID0gbmV3IEFycmF5KGxlbik7IGkgPCBsZW47IGkrKykge2FycjJbaV0gPSBhcnJbaV07fXJldHVybiBhcnIyO31mdW5jdGlvbiBJbnRlcnJ1cHRfZGVmaW5lUHJvcGVydHkob2JqLCBrZXksIHZhbHVlKSB7aWYgKGtleSBpbiBvYmopIHtPYmplY3QuZGVmaW5lUHJvcGVydHkob2JqLCBrZXksIHsgdmFsdWU6IHZhbHVlLCBlbnVtZXJhYmxlOiB0cnVlLCBjb25maWd1cmFibGU6IHRydWUsIHdyaXRhYmxlOiB0cnVlIH0pO30gZWxzZSB7b2JqW2tleV0gPSB2YWx1ZTt9cmV0dXJuIG9iajt9CgoKCiAgICAgICAgICBmdW5jdGlvbiBJbnRlcnJ1cHQoX3JlZikge3ZhciBidXR0b24gPSBfcmVmLmJ1dHRvbjsKICAgICAgICAgICAgdmFyIENTU3N0cmluZyA9IGZ1bmN0aW9uIENTU3N0cmluZyhzdHJpbmcpIHsKICAgICAgICAgICAgICB2YXIgY3NzX2pzb24gPSAie1wiIi5jb25jYXQoc3RyaW5nLgogICAgICAgICAgICAgIHJlcGxhY2UoLzsgL2csICciLCAiJykuCiAgICAgICAgICAgICAgcmVwbGFjZSgvOiAvZywgJyI6ICInKS4KICAgICAgICAgICAgICByZXBsYWNlKCI7IiwgIiIpLCAiXCJ9Iik7CgogICAgICAgICAgICAgIHZhciBvYmogPSBKU09OLnBhcnNlKGNzc19qc29uKTsKCiAgICAgICAgICAgICAgdmFyIGtleVZhbHVlcyA9IE9iamVjdC5rZXlzKG9iaikubWFwKGZ1bmN0aW9uIChrZXkpIHsKICAgICAgICAgICAgICAgIHZhciBjYW1lbENhc2VkID0ga2V5LnJlcGxhY2UoLy1bYS16XS9nLCBmdW5jdGlvbiAoZykge3JldHVybiBnWzFdLnRvVXBwZXJDYXNlKCk7fSk7CiAgICAgICAgICAgICAgICByZXR1cm4gSW50ZXJydXB0X2RlZmluZVByb3BlcnR5KHt9LCBjYW1lbENhc2VkLCBvYmpba2V5XSk7CiAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgIHJldHVybiBPYmplY3QuYXNzaWduLmFwcGx5KE9iamVjdCwgW3t9XS5jb25jYXQoX3RvQ29uc3VtYWJsZUFycmF5KGtleVZhbHVlcykpKTsKICAgICAgICAgICAgfTsKCiAgICAgICAgICAgIHJldHVybiAvKiNfX1BVUkVfXyovKAogICAgICAgICAgICAgIHJlYWN0LmNyZWF0ZUVsZW1lbnQoImlucHV0IiwgewogICAgICAgICAgICAgICAgY2xhc3NOYW1lOiAiaW50ZXJydXB0IiwKICAgICAgICAgICAgICAgIHN0eWxlOiBidXR0b24uY3NzID8gQ1NTc3RyaW5nKGJ1dHRvbi5jc3MpIDogbnVsbCwKICAgICAgICAgICAgICAgIHR5cGU6ICJzdWJtaXQiLAogICAgICAgICAgICAgICAgdmFsdWU6IGJ1dHRvbi5uYW1lLAogICAgICAgICAgICAgICAgb25DbGljazogZnVuY3Rpb24gb25DbGljaygpIHsKICAgICAgICAgICAgICAgICAgc2V0UHJvcGVydGllcygKICAgICAgICAgICAgICAgICAgYnV0dG9uLmFjdGlvbnMubWFwKGZ1bmN0aW9uIChfcmVmMykge3ZhciBwcmVmZXJlbmNlID0gX3JlZjMucHJlZmVyZW5jZSx2YWx1ZSA9IF9yZWYzLnZhbHVlO3JldHVybiBbcHJlZmVyZW5jZSwgdmFsdWVdO30pKS4KICAgICAgICAgICAgICAgICAgdGhlbihmdW5jdGlvbiAoKSB7cmV0dXJuIGFkZE5vdGlmaWNhdGlvbihidXR0b24ubm90aWZpY2F0aW9uIHx8ICJJbnRlcnJ1cHRlZCEiKTt9KTsKICAgICAgICAgICAgICAgIH0gfSkpOwoKCiAgICAgICAgICB9CgogICAgICAgICAgLyogaGFybW9ueSBkZWZhdWx0IGV4cG9ydCAqL3ZhciBjb21wb25lbnRzX0ludGVycnVwdCA9IEludGVycnVwdDsKICAgICAgICAgIDsgLy8gQ09OQ0FURU5BVEVEIE1PRFVMRTogLi9zcmMvcmVsYXkvdHlwZXMvVHlwZXMudHN4CgoKICAgICAgICAgIHZhciBSZWxheUNvbXBvbmVudFR5cGU7KGZ1bmN0aW9uIChSZWxheUNvbXBvbmVudFR5cGUpIHtSZWxheUNvbXBvbmVudFR5cGVbIkJPT0xFQU4iXSA9ICJib29sZWFuIjtSZWxheUNvbXBvbmVudFR5cGVbIkRST1BET1dOIl0gPSAiZHJvcGRvd24iO1JlbGF5Q29tcG9uZW50VHlwZVsiU1RSSU5HIl0gPSAic3RyaW5nIjtSZWxheUNvbXBvbmVudFR5cGVbIkhUTUwiXSA9ICJodG1sIjtSZWxheUNvbXBvbmVudFR5cGVbIklOVEVSUlVQVCJdID0gImludGVycnVwdCI7fSkoUmVsYXlDb21wb25lbnRUeXBlIHx8IChSZWxheUNvbXBvbmVudFR5cGUgPSB7fSkpOwogICAgICAgICAgOyAvLyBDT05DQVRFTkFURUQgTU9EVUxFOiAuL3NyYy9yZWxheS9jb21wb25lbnRzL3NldHRpbmdzL0Jvb2xlYW5JbnB1dC50c3gKICAgICAgICAgIGZ1bmN0aW9uIEJvb2xlYW5JbnB1dF9zbGljZWRUb0FycmF5KGFyciwgaSkge3JldHVybiBCb29sZWFuSW5wdXRfYXJyYXlXaXRoSG9sZXMoYXJyKSB8fCBCb29sZWFuSW5wdXRfaXRlcmFibGVUb0FycmF5TGltaXQoYXJyLCBpKSB8fCBCb29sZWFuSW5wdXRfdW5zdXBwb3J0ZWRJdGVyYWJsZVRvQXJyYXkoYXJyLCBpKSB8fCBCb29sZWFuSW5wdXRfbm9uSXRlcmFibGVSZXN0KCk7fWZ1bmN0aW9uIEJvb2xlYW5JbnB1dF9ub25JdGVyYWJsZVJlc3QoKSB7dGhyb3cgbmV3IFR5cGVFcnJvcigiSW52YWxpZCBhdHRlbXB0IHRvIGRlc3RydWN0dXJlIG5vbi1pdGVyYWJsZSBpbnN0YW5jZS5cbkluIG9yZGVyIHRvIGJlIGl0ZXJhYmxlLCBub24tYXJyYXkgb2JqZWN0cyBtdXN0IGhhdmUgYSBbU3ltYm9sLml0ZXJhdG9yXSgpIG1ldGhvZC4iKTt9ZnVuY3Rpb24gQm9vbGVhbklucHV0X3Vuc3VwcG9ydGVkSXRlcmFibGVUb0FycmF5KG8sIG1pbkxlbikge2lmICghbykgcmV0dXJuO2lmICh0eXBlb2YgbyA9PT0gInN0cmluZyIpIHJldHVybiBCb29sZWFuSW5wdXRfYXJyYXlMaWtlVG9BcnJheShvLCBtaW5MZW4pO3ZhciBuID0gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKG8pLnNsaWNlKDgsIC0xKTtpZiAobiA9PT0gIk9iamVjdCIgJiYgby5jb25zdHJ1Y3RvcikgbiA9IG8uY29uc3RydWN0b3IubmFtZTtpZiAobiA9PT0gIk1hcCIgfHwgbiA9PT0gIlNldCIpIHJldHVybiBBcnJheS5mcm9tKG8pO2lmIChuID09PSAiQXJndW1lbnRzIiB8fCAvXig/OlVpfEkpbnQoPzo4fDE2fDMyKSg/OkNsYW1wZWQpP0FycmF5JC8udGVzdChuKSkgcmV0dXJuIEJvb2xlYW5JbnB1dF9hcnJheUxpa2VUb0FycmF5KG8sIG1pbkxlbik7fWZ1bmN0aW9uIEJvb2xlYW5JbnB1dF9hcnJheUxpa2VUb0FycmF5KGFyciwgbGVuKSB7aWYgKGxlbiA9PSBudWxsIHx8IGxlbiA+IGFyci5sZW5ndGgpIGxlbiA9IGFyci5sZW5ndGg7Zm9yICh2YXIgaSA9IDAsIGFycjIgPSBuZXcgQXJyYXkobGVuKTsgaSA8IGxlbjsgaSsrKSB7YXJyMltpXSA9IGFycltpXTt9cmV0dXJuIGFycjI7fWZ1bmN0aW9uIEJvb2xlYW5JbnB1dF9pdGVyYWJsZVRvQXJyYXlMaW1pdChhcnIsIGkpIHt2YXIgX2kgPSBhcnIgPT0gbnVsbCA/IG51bGwgOiB0eXBlb2YgU3ltYm9sICE9PSAidW5kZWZpbmVkIiAmJiBhcnJbU3ltYm9sLml0ZXJhdG9yXSB8fCBhcnJbIkBAaXRlcmF0b3IiXTtpZiAoX2kgPT0gbnVsbCkgcmV0dXJuO3ZhciBfYXJyID0gW107dmFyIF9uID0gdHJ1ZTt2YXIgX2QgPSBmYWxzZTt2YXIgX3MsIF9lO3RyeSB7Zm9yIChfaSA9IF9pLmNhbGwoYXJyKTsgIShfbiA9IChfcyA9IF9pLm5leHQoKSkuZG9uZSk7IF9uID0gdHJ1ZSkge19hcnIucHVzaChfcy52YWx1ZSk7aWYgKGkgJiYgX2Fyci5sZW5ndGggPT09IGkpIGJyZWFrO319IGNhdGNoIChlcnIpIHtfZCA9IHRydWU7X2UgPSBlcnI7fSBmaW5hbGx5IHt0cnkge2lmICghX24gJiYgX2lbInJldHVybiJdICE9IG51bGwpIF9pWyJyZXR1cm4iXSgpO30gZmluYWxseSB7aWYgKF9kKSB0aHJvdyBfZTt9fXJldHVybiBfYXJyO31mdW5jdGlvbiBCb29sZWFuSW5wdXRfYXJyYXlXaXRoSG9sZXMoYXJyKSB7aWYgKEFycmF5LmlzQXJyYXkoYXJyKSkgcmV0dXJuIGFycjt9CgoKCiAgICAgICAgICBmdW5jdGlvbiBCb29sZWFuSW5wdXQoX3JlZikge3ZhciBidXR0b24gPSBfcmVmLmJ1dHRvbjsKICAgICAgICAgICAgdmFyIF91c2VTdGF0ZSA9ICgwLCByZWFjdC51c2VTdGF0ZSkoYnV0dG9uLnZhbHVlID09PSAidHJ1ZSIpLF91c2VTdGF0ZTIgPSBCb29sZWFuSW5wdXRfc2xpY2VkVG9BcnJheShfdXNlU3RhdGUsIDIpLHZhbHVlID0gX3VzZVN0YXRlMlswXSxzZXRWYWx1ZSA9IF91c2VTdGF0ZTJbMV07CgogICAgICAgICAgICByZXR1cm4gLyojX19QVVJFX18qLygKICAgICAgICAgICAgICByZWFjdC5jcmVhdGVFbGVtZW50KCJsYWJlbCIsIHsgY2xhc3NOYW1lOiAiY2hlY2tjb250YWluZXIiIH0sIC8qI19fUFVSRV9fKi8KICAgICAgICAgICAgICByZWFjdC5jcmVhdGVFbGVtZW50KCJpbnB1dCIsIHsKICAgICAgICAgICAgICAgIHR5cGU6ICJoaWRkZW4iLAogICAgICAgICAgICAgICAgbmFtZTogYnV0dG9uLm5hbWUsCiAgICAgICAgICAgICAgICB2YWx1ZTogdmFsdWUudG9TdHJpbmcoKSwKICAgICAgICAgICAgICAgICJkYXRhLWRlZmF1bHQiOiBidXR0b24udmFsdWUgfSksIC8qI19fUFVSRV9fKi8KCiAgICAgICAgICAgICAgcmVhY3QuY3JlYXRlRWxlbWVudCgiZGl2IiwgewogICAgICAgICAgICAgICAgY2xhc3NOYW1lOiAidG9nZ2xlLXRyYWNrIiwKICAgICAgICAgICAgICAgIG9uQ2xpY2s6IGZ1bmN0aW9uIG9uQ2xpY2soKSB7CiAgICAgICAgICAgICAgICAgIHNldFZhbHVlKCF2YWx1ZSk7CiAgICAgICAgICAgICAgICAgIGJ1dHRvbi5zZXRWYWx1ZSgoIXZhbHVlKS50b1N0cmluZygpKTsKICAgICAgICAgICAgICAgIH0gfSwgLyojX19QVVJFX18qLwoKICAgICAgICAgICAgICByZWFjdC5jcmVhdGVFbGVtZW50KCJzcGFuIiwgeyBjbGFzc05hbWU6ICJ0b2dnbGUtaW5kaWNhdG9yIiB9LCAvKiNfX1BVUkVfXyovCiAgICAgICAgICAgICAgcmVhY3QuY3JlYXRlRWxlbWVudCgic3BhbiIsIHsgY2xhc3NOYW1lOiAiY2hlY2tNYXJrIiB9LCAvKiNfX1BVUkVfXyovCiAgICAgICAgICAgICAgcmVhY3QuY3JlYXRlRWxlbWVudCgic3ZnIiwgewogICAgICAgICAgICAgICAgdmlld0JveDogIjAgMCAyNCAyNCIsCiAgICAgICAgICAgICAgICBpZDogImdocS1zdmctY2hlY2siLAogICAgICAgICAgICAgICAgcm9sZTogInByZXNlbnRhdGlvbiIsCiAgICAgICAgICAgICAgICAiYXJpYS1oaWRkZW4iOiAidHJ1ZSIgfSwgLyojX19QVVJFX18qLwoKICAgICAgICAgICAgICByZWFjdC5jcmVhdGVFbGVtZW50KCJwYXRoIiwgeyBkOiAiTTkuODYgMThhMSAxIDAgMDEtLjczLS4zMmwtNC44Ni01LjE3YTEuMDAxIDEuMDAxIDAgMDExLjQ2LTEuMzdsNC4xMiA0LjM5IDguNDEtOS4yYTEgMSAwIDExMS40OCAxLjM0bC05LjE0IDEwYTEgMSAwIDAxLS43My4zM2gtLjAxeiIgfSkpKSkpKSk7CgoKCgoKCiAgICAgICAgICB9CgogICAgICAgICAgLyoKICAgICAgICAgIDxkaXYKICAgICAgICAgICAgY2xhc3M9ImNoZWNrbWFyayIKICAgICAgICAgICAgb25DbGljaz17KCkgPT4gewogICAgICAgICAgICAgIHNldFZhbHVlKCF2YWx1ZSk7CiAgICAgICAgICAgIH19CiAgICAgICAgICAvPgogICAgICAgICAgICovCiAgICAgICAgICAvKiBoYXJtb255IGRlZmF1bHQgZXhwb3J0ICovdmFyIHNldHRpbmdzX0Jvb2xlYW5JbnB1dCA9IEJvb2xlYW5JbnB1dDsKICAgICAgICAgIDsgLy8gQ09OQ0FURU5BVEVEIE1PRFVMRTogLi9zcmMvcmVsYXkvY29tcG9uZW50cy9zZXR0aW5ncy9Ecm9wZG93bklucHV0LnRzeAoKCgogICAgICAgICAgZnVuY3Rpb24gRHJvcGRvd25JbnB1dChfcmVmKSB7dmFyIGJ1dHRvbiA9IF9yZWYuYnV0dG9uOwogICAgICAgICAgICByZXR1cm4gLyojX19QVVJFX18qLygKICAgICAgICAgICAgICByZWFjdC5jcmVhdGVFbGVtZW50KCJzZWxlY3QiLCB7CiAgICAgICAgICAgICAgICBjbGFzc05hbWU6ICJkcm9wZG93bmNvbnRhaW5lciIsCiAgICAgICAgICAgICAgICBuYW1lOiBidXR0b24ubmFtZSwKICAgICAgICAgICAgICAgIGRlZmF1bHRWYWx1ZTogYnV0dG9uLnZhbHVlLAogICAgICAgICAgICAgICAgb25DaGFuZ2U6IGZ1bmN0aW9uIG9uQ2hhbmdlKGUpIHtyZXR1cm4gYnV0dG9uLnNldFZhbHVlKGUudGFyZ2V0LnZhbHVlKTt9IH0sCgogICAgICAgICAgICAgIGJ1dHRvbi5kcm9wZG93bi5tYXAoZnVuY3Rpb24gKG9wdGlvbikgewogICAgICAgICAgICAgICAgcmV0dXJuIC8qI19fUFVSRV9fKi8oCiAgICAgICAgICAgICAgICAgIHJlYWN0LmNyZWF0ZUVsZW1lbnQoIm9wdGlvbiIsIHsga2V5OiBvcHRpb24udmFsdWUsIHZhbHVlOiBvcHRpb24udmFsdWUgfSwKICAgICAgICAgICAgICAgICAgb3B0aW9uLmRpc3BsYXkgfHwgb3B0aW9uLnZhbHVlKSk7CgoKICAgICAgICAgICAgICB9KSkpOwoKCiAgICAgICAgICB9CgogICAgICAgICAgLyogaGFybW9ueSBkZWZhdWx0IGV4cG9ydCAqL3ZhciBzZXR0aW5nc19Ecm9wZG93bklucHV0ID0gRHJvcGRvd25JbnB1dDsKICAgICAgICAgIDsgLy8gQ09OQ0FURU5BVEVEIE1PRFVMRTogLi9zcmMvcmVsYXkvY29tcG9uZW50cy9zZXR0aW5ncy9TdHJpbmdJbnB1dC50c3gKCgoKICAgICAgICAgIGZ1bmN0aW9uIFN0cmluZ0lucHV0KF9yZWYpIHt2YXIgYnV0dG9uID0gX3JlZi5idXR0b247CiAgICAgICAgICAgIHJldHVybiAvKiNfX1BVUkVfXyovKAogICAgICAgICAgICAgIHJlYWN0LmNyZWF0ZUVsZW1lbnQoImlucHV0IiwgewogICAgICAgICAgICAgICAgY2xhc3NOYW1lOiAic3RyaW5nY29udGFpbmVyIiwKICAgICAgICAgICAgICAgIG5hbWU6IGJ1dHRvbi5uYW1lLAogICAgICAgICAgICAgICAgZGVmYXVsdFZhbHVlOiBidXR0b24udmFsdWUsCiAgICAgICAgICAgICAgICBvbkNoYW5nZTogZnVuY3Rpb24gb25DaGFuZ2UoZSkge3JldHVybiBidXR0b24uc2V0VmFsdWUoZS50YXJnZXQudmFsdWUpO30gfSkpOwoKCiAgICAgICAgICB9CgogICAgICAgICAgLyogaGFybW9ueSBkZWZhdWx0IGV4cG9ydCAqL3ZhciBzZXR0aW5nc19TdHJpbmdJbnB1dCA9IFN0cmluZ0lucHV0OwogICAgICAgICAgOyAvLyBDT05DQVRFTkFURUQgTU9EVUxFOiAuL3NyYy9yZWxheS9jb21wb25lbnRzL3NldHRpbmdzL1NldHRpbmcudHN4CiAgICAgICAgICBmdW5jdGlvbiBTZXR0aW5nX3NsaWNlZFRvQXJyYXkoYXJyLCBpKSB7cmV0dXJuIFNldHRpbmdfYXJyYXlXaXRoSG9sZXMoYXJyKSB8fCBTZXR0aW5nX2l0ZXJhYmxlVG9BcnJheUxpbWl0KGFyciwgaSkgfHwgU2V0dGluZ191bnN1cHBvcnRlZEl0ZXJhYmxlVG9BcnJheShhcnIsIGkpIHx8IFNldHRpbmdfbm9uSXRlcmFibGVSZXN0KCk7fWZ1bmN0aW9uIFNldHRpbmdfbm9uSXRlcmFibGVSZXN0KCkge3Rocm93IG5ldyBUeXBlRXJyb3IoIkludmFsaWQgYXR0ZW1wdCB0byBkZXN0cnVjdHVyZSBub24taXRlcmFibGUgaW5zdGFuY2UuXG5JbiBvcmRlciB0byBiZSBpdGVyYWJsZSwgbm9uLWFycmF5IG9iamVjdHMgbXVzdCBoYXZlIGEgW1N5bWJvbC5pdGVyYXRvcl0oKSBtZXRob2QuIik7fWZ1bmN0aW9uIFNldHRpbmdfdW5zdXBwb3J0ZWRJdGVyYWJsZVRvQXJyYXkobywgbWluTGVuKSB7aWYgKCFvKSByZXR1cm47aWYgKHR5cGVvZiBvID09PSAic3RyaW5nIikgcmV0dXJuIFNldHRpbmdfYXJyYXlMaWtlVG9BcnJheShvLCBtaW5MZW4pO3ZhciBuID0gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKG8pLnNsaWNlKDgsIC0xKTtpZiAobiA9PT0gIk9iamVjdCIgJiYgby5jb25zdHJ1Y3RvcikgbiA9IG8uY29uc3RydWN0b3IubmFtZTtpZiAobiA9PT0gIk1hcCIgfHwgbiA9PT0gIlNldCIpIHJldHVybiBBcnJheS5mcm9tKG8pO2lmIChuID09PSAiQXJndW1lbnRzIiB8fCAvXig/OlVpfEkpbnQoPzo4fDE2fDMyKSg/OkNsYW1wZWQpP0FycmF5JC8udGVzdChuKSkgcmV0dXJuIFNldHRpbmdfYXJyYXlMaWtlVG9BcnJheShvLCBtaW5MZW4pO31mdW5jdGlvbiBTZXR0aW5nX2FycmF5TGlrZVRvQXJyYXkoYXJyLCBsZW4pIHtpZiAobGVuID09IG51bGwgfHwgbGVuID4gYXJyLmxlbmd0aCkgbGVuID0gYXJyLmxlbmd0aDtmb3IgKHZhciBpID0gMCwgYXJyMiA9IG5ldyBBcnJheShsZW4pOyBpIDwgbGVuOyBpKyspIHthcnIyW2ldID0gYXJyW2ldO31yZXR1cm4gYXJyMjt9ZnVuY3Rpb24gU2V0dGluZ19pdGVyYWJsZVRvQXJyYXlMaW1pdChhcnIsIGkpIHt2YXIgX2kgPSBhcnIgPT0gbnVsbCA/IG51bGwgOiB0eXBlb2YgU3ltYm9sICE9PSAidW5kZWZpbmVkIiAmJiBhcnJbU3ltYm9sLml0ZXJhdG9yXSB8fCBhcnJbIkBAaXRlcmF0b3IiXTtpZiAoX2kgPT0gbnVsbCkgcmV0dXJuO3ZhciBfYXJyID0gW107dmFyIF9uID0gdHJ1ZTt2YXIgX2QgPSBmYWxzZTt2YXIgX3MsIF9lO3RyeSB7Zm9yIChfaSA9IF9pLmNhbGwoYXJyKTsgIShfbiA9IChfcyA9IF9pLm5leHQoKSkuZG9uZSk7IF9uID0gdHJ1ZSkge19hcnIucHVzaChfcy52YWx1ZSk7aWYgKGkgJiYgX2Fyci5sZW5ndGggPT09IGkpIGJyZWFrO319IGNhdGNoIChlcnIpIHtfZCA9IHRydWU7X2UgPSBlcnI7fSBmaW5hbGx5IHt0cnkge2lmICghX24gJiYgX2lbInJldHVybiJdICE9IG51bGwpIF9pWyJyZXR1cm4iXSgpO30gZmluYWxseSB7aWYgKF9kKSB0aHJvdyBfZTt9fXJldHVybiBfYXJyO31mdW5jdGlvbiBTZXR0aW5nX2FycmF5V2l0aEhvbGVzKGFycikge2lmIChBcnJheS5pc0FycmF5KGFycikpIHJldHVybiBhcnI7fQoKCgoKCgogICAgICAgICAgZnVuY3Rpb24gU2V0dGluZyhfcmVmKQoKCgoKCiAgICAgICAgICB7dmFyIGJ1dHRvbiA9IF9yZWYuYnV0dG9uLHZhbGlkYXRvciA9IF9yZWYudmFsaWRhdG9yOwogICAgICAgICAgICB2YXIgX3VzZVN0YXRlID0gKDAsIHJlYWN0LnVzZVN0YXRlKSh2YWxpZGF0b3IuaXNWYWxpZChidXR0b24pKSxfdXNlU3RhdGUyID0gU2V0dGluZ19zbGljZWRUb0FycmF5KF91c2VTdGF0ZSwgMiksdmFsaWQgPSBfdXNlU3RhdGUyWzBdLHNldFZhbGlkID0gX3VzZVN0YXRlMlsxXTsKCiAgICAgICAgICAgIGJ1dHRvbi5zZXRWYWx1ZSA9IGZ1bmN0aW9uICh2YWwpIHsKICAgICAgICAgICAgICBidXR0b24udmFsdWUgPSB2YWw7CiAgICAgICAgICAgICAgdmFsaWRhdG9yLnVwZGF0ZVNldHRpbmcoYnV0dG9uKTsKICAgICAgICAgICAgfTsKCiAgICAgICAgICAgIHZhbGlkYXRvci5hZGRTZXR0aW5nKGJ1dHRvbiwgc2V0VmFsaWQpOwoKICAgICAgICAgICAgcmV0dXJuIC8qI19fUFVSRV9fKi8oCiAgICAgICAgICAgICAgcmVhY3QuY3JlYXRlRWxlbWVudCgidHIiLCB7IGlkOiAidXNlclByZWZlcmVuY2UiIH0sIC8qI19fUFVSRV9fKi8KICAgICAgICAgICAgICByZWFjdC5jcmVhdGVFbGVtZW50KCJ0ZCIsIHsgY2xhc3NOYW1lOiAic2V0dGluZyIgfSwKICAgICAgICAgICAgICBidXR0b24ubmFtZSwgLyojX19QVVJFX18qLwogICAgICAgICAgICAgIHJlYWN0LmNyZWF0ZUVsZW1lbnQoImRpdiIsIHsgY2xhc3NOYW1lOiAic2V0dGluZ0hvdmVyIiB9LCBidXR0b24ucHJlZmVyZW5jZSkpLCAvKiNfX1BVUkVfXyovCgogICAgICAgICAgICAgIHJlYWN0LmNyZWF0ZUVsZW1lbnQoInRkIiwgeyBjbGFzc05hbWU6IHZhbGlkID8gIiIgOiAiaW52YWxpZC1zZXR0aW5nIiB9LAogICAgICAgICAgICAgIGJ1dHRvbi50eXBlID09PSBSZWxheUNvbXBvbmVudFR5cGUuQk9PTEVBTiA/IC8qI19fUFVSRV9fKi8KICAgICAgICAgICAgICByZWFjdC5jcmVhdGVFbGVtZW50KHNldHRpbmdzX0Jvb2xlYW5JbnB1dCwgeyBidXR0b246IGJ1dHRvbiB9KSA6CiAgICAgICAgICAgICAgYnV0dG9uLnR5cGUgPT09IFJlbGF5Q29tcG9uZW50VHlwZS5EUk9QRE9XTiA/IC8qI19fUFVSRV9fKi8KICAgICAgICAgICAgICByZWFjdC5jcmVhdGVFbGVtZW50KHNldHRpbmdzX0Ryb3Bkb3duSW5wdXQsIHsgYnV0dG9uOiBidXR0b24gfSkgOiAvKiNfX1BVUkVfXyovCgogICAgICAgICAgICAgIHJlYWN0LmNyZWF0ZUVsZW1lbnQoc2V0dGluZ3NfU3RyaW5nSW5wdXQsIHsgYnV0dG9uOiBidXR0b24gfSksCgogICAgICAgICAgICAgIGJ1dHRvbi5pbnZhbGlkUmVhc29uICE9IG51bGwgPyAvKiNfX1BVUkVfXyovCiAgICAgICAgICAgICAgcmVhY3QuY3JlYXRlRWxlbWVudCgiZGl2IiwgeyBjbGFzc05hbWU6ICJpbnZhbGlkLXJlYXNvbiIsIGhpZGRlbjogdmFsaWQgfSwgLyojX19QVVJFX18qLwogICAgICAgICAgICAgIHJlYWN0LmNyZWF0ZUVsZW1lbnQoInNtYWxsIiwgbnVsbCwgYnV0dG9uLmludmFsaWRSZWFzb24pKSA6IC8qI19fUFVSRV9fKi8KCgogICAgICAgICAgICAgIHJlYWN0LmNyZWF0ZUVsZW1lbnQocmVhY3QuRnJhZ21lbnQsIG51bGwpKSwgLyojX19QVVJFX18qLwoKCiAgICAgICAgICAgICAgcmVhY3QuY3JlYXRlRWxlbWVudCgidGQiLCBudWxsLCBidXR0b24uZGVzY3JpcHRpb24pKSk7CgoKICAgICAgICAgIH0KCiAgICAgICAgICAvKiBoYXJtb255IGRlZmF1bHQgZXhwb3J0ICovdmFyIHNldHRpbmdzX1NldHRpbmcgPSBTZXR0aW5nOwogICAgICAgICAgOyAvLyBDT05DQVRFTkFURUQgTU9EVUxFOiAuL3NyYy9yZWxheS9yb3V0ZXMvUmVsYXlQYWdlLnRzeAogICAgICAgICAgZnVuY3Rpb24gUmVsYXlQYWdlX3NsaWNlZFRvQXJyYXkoYXJyLCBpKSB7cmV0dXJuIFJlbGF5UGFnZV9hcnJheVdpdGhIb2xlcyhhcnIpIHx8IFJlbGF5UGFnZV9pdGVyYWJsZVRvQXJyYXlMaW1pdChhcnIsIGkpIHx8IFJlbGF5UGFnZV91bnN1cHBvcnRlZEl0ZXJhYmxlVG9BcnJheShhcnIsIGkpIHx8IFJlbGF5UGFnZV9ub25JdGVyYWJsZVJlc3QoKTt9ZnVuY3Rpb24gUmVsYXlQYWdlX25vbkl0ZXJhYmxlUmVzdCgpIHt0aHJvdyBuZXcgVHlwZUVycm9yKCJJbnZhbGlkIGF0dGVtcHQgdG8gZGVzdHJ1Y3R1cmUgbm9uLWl0ZXJhYmxlIGluc3RhbmNlLlxuSW4gb3JkZXIgdG8gYmUgaXRlcmFibGUsIG5vbi1hcnJheSBvYmplY3RzIG11c3QgaGF2ZSBhIFtTeW1ib2wuaXRlcmF0b3JdKCkgbWV0aG9kLiIpO31mdW5jdGlvbiBSZWxheVBhZ2VfaXRlcmFibGVUb0FycmF5TGltaXQoYXJyLCBpKSB7dmFyIF9pID0gYXJyID09IG51bGwgPyBudWxsIDogdHlwZW9mIFN5bWJvbCAhPT0gInVuZGVmaW5lZCIgJiYgYXJyW1N5bWJvbC5pdGVyYXRvcl0gfHwgYXJyWyJAQGl0ZXJhdG9yIl07aWYgKF9pID09IG51bGwpIHJldHVybjt2YXIgX2FyciA9IFtdO3ZhciBfbiA9IHRydWU7dmFyIF9kID0gZmFsc2U7dmFyIF9zLCBfZTt0cnkge2ZvciAoX2kgPSBfaS5jYWxsKGFycik7ICEoX24gPSAoX3MgPSBfaS5uZXh0KCkpLmRvbmUpOyBfbiA9IHRydWUpIHtfYXJyLnB1c2goX3MudmFsdWUpO2lmIChpICYmIF9hcnIubGVuZ3RoID09PSBpKSBicmVhazt9fSBjYXRjaCAoZXJyKSB7X2QgPSB0cnVlO19lID0gZXJyO30gZmluYWxseSB7dHJ5IHtpZiAoIV9uICYmIF9pWyJyZXR1cm4iXSAhPSBudWxsKSBfaVsicmV0dXJuIl0oKTt9IGZpbmFsbHkge2lmIChfZCkgdGhyb3cgX2U7fX1yZXR1cm4gX2Fycjt9ZnVuY3Rpb24gUmVsYXlQYWdlX2FycmF5V2l0aEhvbGVzKGFycikge2lmIChBcnJheS5pc0FycmF5KGFycikpIHJldHVybiBhcnI7fWZ1bmN0aW9uIFJlbGF5UGFnZV9jcmVhdGVGb3JPZkl0ZXJhdG9ySGVscGVyKG8sIGFsbG93QXJyYXlMaWtlKSB7dmFyIGl0ID0gdHlwZW9mIFN5bWJvbCAhPT0gInVuZGVmaW5lZCIgJiYgb1tTeW1ib2wuaXRlcmF0b3JdIHx8IG9bIkBAaXRlcmF0b3IiXTtpZiAoIWl0KSB7aWYgKEFycmF5LmlzQXJyYXkobykgfHwgKGl0ID0gUmVsYXlQYWdlX3Vuc3VwcG9ydGVkSXRlcmFibGVUb0FycmF5KG8pKSB8fCBhbGxvd0FycmF5TGlrZSAmJiBvICYmIHR5cGVvZiBvLmxlbmd0aCA9PT0gIm51bWJlciIpIHtpZiAoaXQpIG8gPSBpdDt2YXIgaSA9IDA7dmFyIEYgPSBmdW5jdGlvbiBGKCkge307cmV0dXJuIHsgczogRiwgbjogZnVuY3Rpb24gbigpIHtpZiAoaSA+PSBvLmxlbmd0aCkgcmV0dXJuIHsgZG9uZTogdHJ1ZSB9O3JldHVybiB7IGRvbmU6IGZhbHNlLCB2YWx1ZTogb1tpKytdIH07fSwgZTogZnVuY3Rpb24gZShfZTIpIHt0aHJvdyBfZTI7fSwgZjogRiB9O310aHJvdyBuZXcgVHlwZUVycm9yKCJJbnZhbGlkIGF0dGVtcHQgdG8gaXRlcmF0ZSBub24taXRlcmFibGUgaW5zdGFuY2UuXG5JbiBvcmRlciB0byBiZSBpdGVyYWJsZSwgbm9uLWFycmF5IG9iamVjdHMgbXVzdCBoYXZlIGEgW1N5bWJvbC5pdGVyYXRvcl0oKSBtZXRob2QuIik7fXZhciBub3JtYWxDb21wbGV0aW9uID0gdHJ1ZSxkaWRFcnIgPSBmYWxzZSxlcnI7cmV0dXJuIHsgczogZnVuY3Rpb24gcygpIHtpdCA9IGl0LmNhbGwobyk7fSwgbjogZnVuY3Rpb24gbigpIHt2YXIgc3RlcCA9IGl0Lm5leHQoKTtub3JtYWxDb21wbGV0aW9uID0gc3RlcC5kb25lO3JldHVybiBzdGVwO30sIGU6IGZ1bmN0aW9uIGUoX2UzKSB7ZGlkRXJyID0gdHJ1ZTtlcnIgPSBfZTM7fSwgZjogZnVuY3Rpb24gZigpIHt0cnkge2lmICghbm9ybWFsQ29tcGxldGlvbiAmJiBpdFsicmV0dXJuIl0gIT0gbnVsbCkgaXRbInJldHVybiJdKCk7fSBmaW5hbGx5IHtpZiAoZGlkRXJyKSB0aHJvdyBlcnI7fX0gfTt9ZnVuY3Rpb24gUmVsYXlQYWdlX3Vuc3VwcG9ydGVkSXRlcmFibGVUb0FycmF5KG8sIG1pbkxlbikge2lmICghbykgcmV0dXJuO2lmICh0eXBlb2YgbyA9PT0gInN0cmluZyIpIHJldHVybiBSZWxheVBhZ2VfYXJyYXlMaWtlVG9BcnJheShvLCBtaW5MZW4pO3ZhciBuID0gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKG8pLnNsaWNlKDgsIC0xKTtpZiAobiA9PT0gIk9iamVjdCIgJiYgby5jb25zdHJ1Y3RvcikgbiA9IG8uY29uc3RydWN0b3IubmFtZTtpZiAobiA9PT0gIk1hcCIgfHwgbiA9PT0gIlNldCIpIHJldHVybiBBcnJheS5mcm9tKG8pO2lmIChuID09PSAiQXJndW1lbnRzIiB8fCAvXig/OlVpfEkpbnQoPzo4fDE2fDMyKSg/OkNsYW1wZWQpP0FycmF5JC8udGVzdChuKSkgcmV0dXJuIFJlbGF5UGFnZV9hcnJheUxpa2VUb0FycmF5KG8sIG1pbkxlbik7fWZ1bmN0aW9uIFJlbGF5UGFnZV9hcnJheUxpa2VUb0FycmF5KGFyciwgbGVuKSB7aWYgKGxlbiA9PSBudWxsIHx8IGxlbiA+IGFyci5sZW5ndGgpIGxlbiA9IGFyci5sZW5ndGg7Zm9yICh2YXIgaSA9IDAsIGFycjIgPSBuZXcgQXJyYXkobGVuKTsgaSA8IGxlbjsgaSsrKSB7YXJyMltpXSA9IGFycltpXTt9cmV0dXJuIGFycjI7fQoKCgoKCgogICAgICAgICAgZnVuY3Rpb24gUmVsYXlQYWdlKF9yZWYpIHt2YXIgcGFnZSA9IF9yZWYucGFnZTsKICAgICAgICAgICAgdmFyIGdyb3VwcyA9IFtdOwogICAgICAgICAgICB2YXIgY3VycmVudEdyb3VwID0gbnVsbDt2YXIgX2l0ZXJhdG9yID0gUmVsYXlQYWdlX2NyZWF0ZUZvck9mSXRlcmF0b3JIZWxwZXIoCgogICAgICAgICAgICAgIHBhZ2UuY29tcG9uZW50cyksX3N0ZXA7dHJ5IHtmb3IgKF9pdGVyYXRvci5zKCk7ICEoX3N0ZXAgPSBfaXRlcmF0b3IubigpKS5kb25lOykge3ZhciBjb21wb25lbnQgPSBfc3RlcC52YWx1ZTsKICAgICAgICAgICAgICAgIGlmICgKICAgICAgICAgICAgICAgIGNvbXBvbmVudC50eXBlID09IFJlbGF5Q29tcG9uZW50VHlwZS5IVE1MIHx8CiAgICAgICAgICAgICAgICBjb21wb25lbnQudHlwZSA9PSBSZWxheUNvbXBvbmVudFR5cGUuSU5URVJSVVBUKQogICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICBncm91cHMucHVzaChjb21wb25lbnQpOwogICAgICAgICAgICAgICAgICBjdXJyZW50R3JvdXAgPSBudWxsOwogICAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBpZiAoY3VycmVudEdyb3VwID09IG51bGwpIHsKICAgICAgICAgICAgICAgICAgY3VycmVudEdyb3VwID0gW107CiAgICAgICAgICAgICAgICAgIGdyb3Vwcy5wdXNoKGN1cnJlbnRHcm91cCk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgY3VycmVudEdyb3VwLnB1c2goY29tcG9uZW50KTsKICAgICAgICAgICAgICB9fSBjYXRjaCAoZXJyKSB7X2l0ZXJhdG9yLmUoZXJyKTt9IGZpbmFsbHkge19pdGVyYXRvci5mKCk7fQoKICAgICAgICAgICAgdmFyIGVsZW1lbnRzID0gW107CiAgICAgICAgICAgIHZhciB2YWxpZGF0b3IgPSBuZXcgYXBpX1NldHRpbmdWYWxpZGF0b3IoKTsKCiAgICAgICAgICAgIGdyb3Vwcy5mb3JFYWNoKGZ1bmN0aW9uIChjb21wb25lbnRzKSB7CiAgICAgICAgICAgICAgaWYgKGNvbXBvbmVudHMudHlwZSA9PSBSZWxheUNvbXBvbmVudFR5cGUuSFRNTCkgewogICAgICAgICAgICAgICAgdmFyIGh0bWwgPSBjb21wb25lbnRzOwoKICAgICAgICAgICAgICAgIGlmIChodG1sLmRhdGEgPT0gbnVsbCkgewogICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgZWxlbWVudHMucHVzaCggLyojX19QVVJFX18qLwogICAgICAgICAgICAgICAgcmVhY3QuY3JlYXRlRWxlbWVudCgiZGl2IiwgewogICAgICAgICAgICAgICAgICBkYW5nZXJvdXNseVNldElubmVySFRNTDogewogICAgICAgICAgICAgICAgICAgIF9faHRtbDogY29tcG9uZW50cy5kYXRhCiAgICAgICAgICAgICAgICAgIH0gfSkpOwoKCiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBpZiAoY29tcG9uZW50cy50eXBlID09IFJlbGF5Q29tcG9uZW50VHlwZS5JTlRFUlJVUFQpIHsKICAgICAgICAgICAgICAgIGVsZW1lbnRzLnB1c2goIC8qI19fUFVSRV9fKi8KICAgICAgICAgICAgICAgIHJlYWN0LmNyZWF0ZUVsZW1lbnQoY29tcG9uZW50c19JbnRlcnJ1cHQsIHsgYnV0dG9uOiBjb21wb25lbnRzIH0pKTsKCiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICB2YXIgYnV0dG9ucyA9IGNvbXBvbmVudHM7CgogICAgICAgICAgICAgIGVsZW1lbnRzLnB1c2goIC8qI19fUFVSRV9fKi8KICAgICAgICAgICAgICByZWFjdC5jcmVhdGVFbGVtZW50KCJ0YWJsZSIsIG51bGwsIC8qI19fUFVSRV9fKi8KICAgICAgICAgICAgICByZWFjdC5jcmVhdGVFbGVtZW50KCJ0Ym9keSIsIG51bGwsCiAgICAgICAgICAgICAgYnV0dG9ucy5tYXAoZnVuY3Rpb24gKHNldHRpbmcsIGluZGV4KSB7cmV0dXJuIC8qI19fUFVSRV9fKi8oCiAgICAgICAgICAgICAgICAgIHJlYWN0LmNyZWF0ZUVsZW1lbnQoc2V0dGluZ3NfU2V0dGluZywgeyBrZXk6IGluZGV4LCBidXR0b246IHNldHRpbmcsIHZhbGlkYXRvcjogdmFsaWRhdG9yIH0pKTt9KSkpKTsKCgoKCiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgdmFsaWRhdG9yLnVwZGF0ZU9iamVjdCgpOwoKICAgICAgICAgICAgLy8gSWYgd2UgaGF2ZSBubyBzZXR0aW5ncyBpbiB3aGljaCB3ZSdkIHNhdmUgc3R1ZmYsIGRvbid0IGJvdGhlciByZW5kZXJpbmcgc2F2ZSBidXR0b24KICAgICAgICAgICAgaWYgKAogICAgICAgICAgICBwYWdlLmNvbXBvbmVudHMuZmluZChmdW5jdGlvbiAoYykge3JldHVybiBjLnByZWZlcmVuY2UgIT0gbnVsbDt9KSA9PQogICAgICAgICAgICBudWxsKQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgcmV0dXJuIC8qI19fUFVSRV9fKi9yZWFjdC5jcmVhdGVFbGVtZW50KHJlYWN0LkZyYWdtZW50LCBudWxsLCBlbGVtZW50cyk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybiAvKiNfX1BVUkVfXyovKAogICAgICAgICAgICAgIHJlYWN0LmNyZWF0ZUVsZW1lbnQocmVhY3QuRnJhZ21lbnQsIG51bGwsCiAgICAgICAgICAgICAgIiAiLAogICAgICAgICAgICAgIGVsZW1lbnRzLCAiICIsIC8qI19fUFVSRV9fKi9yZWFjdC5jcmVhdGVFbGVtZW50KCJiciIsIG51bGwpLCAvKiNfX1BVUkVfXyovCiAgICAgICAgICAgICAgcmVhY3QuY3JlYXRlRWxlbWVudCgiaW5wdXQiLCB7CiAgICAgICAgICAgICAgICBjbGFzc05hbWU6ICJzYXZlIiwKICAgICAgICAgICAgICAgIG9uQ2xpY2s6IGZ1bmN0aW9uIG9uQ2xpY2soKSB7cmV0dXJuICgKICAgICAgICAgICAgICAgICAgICBzYXZlU2V0dGluZ3MoCiAgICAgICAgICAgICAgICAgICAgcGFnZS5jb21wb25lbnRzLmZpbHRlcigKICAgICAgICAgICAgICAgICAgICBmdW5jdGlvbiAoYikge3JldHVybiBiLnByZWZlcmVuY2UgIT0gbnVsbDt9KSkuCgogICAgICAgICAgICAgICAgICAgIHRoZW4oZnVuY3Rpb24gKGUpIHsKICAgICAgICAgICAgICAgICAgICAgIHZhciBjaGFuZ2VkID0gSlNPTi5wYXJzZShlKTt2YXIgX2l0ZXJhdG9yMiA9IFJlbGF5UGFnZV9jcmVhdGVGb3JPZkl0ZXJhdG9ySGVscGVyKAoKICAgICAgICAgICAgICAgICAgICAgICAgY2hhbmdlZCksX3N0ZXAyO3RyeSB7Zm9yIChfaXRlcmF0b3IyLnMoKTsgIShfc3RlcDIgPSBfaXRlcmF0b3IyLm4oKSkuZG9uZTspIHt2YXIgX3N0ZXAyJHZhbHVlID0gUmVsYXlQYWdlX3NsaWNlZFRvQXJyYXkoX3N0ZXAyLnZhbHVlLCAzKSxwcm9wID0gX3N0ZXAyJHZhbHVlWzBdLHByZXYgPSBfc3RlcDIkdmFsdWVbMV0sbm93ID0gX3N0ZXAyJHZhbHVlWzJdOwogICAgICAgICAgICAgICAgICAgICAgICAgIGFkZE5vdGlmaWNhdGlvbigiIi5jb25jYXQocHJvcCwgIiBjaGFuZ2VkIGZyb20gYCIpLmNvbmNhdChwcmV2LCAiYCB0byBgIikuY29uY2F0KG5vdywgImAiKSk7CiAgICAgICAgICAgICAgICAgICAgICAgIH19IGNhdGNoIChlcnIpIHtfaXRlcmF0b3IyLmUoZXJyKTt9IGZpbmFsbHkge19pdGVyYXRvcjIuZigpO30KCiAgICAgICAgICAgICAgICAgICAgICBpZiAoY2hhbmdlZC5sZW5ndGggPT0gMCkgewogICAgICAgICAgICAgICAgICAgICAgICBhZGROb3RpZmljYXRpb24oIk5vIHNldHRpbmdzIHdlcmUgbW9kaWZpZWQuIik7CiAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSkpO30sCgogICAgICAgICAgICAgICAgdHlwZTogInN1Ym1pdCIsCiAgICAgICAgICAgICAgICB2YWx1ZTogIlNhdmUgQ2hhbmdlcyIgfSkpKTsKCgoKICAgICAgICAgIH0KCiAgICAgICAgICAvKiBoYXJtb255IGRlZmF1bHQgZXhwb3J0ICovdmFyIHJvdXRlc19SZWxheVBhZ2UgPSBSZWxheVBhZ2U7CiAgICAgICAgICA7IC8vIENPTkNBVEVOQVRFRCBNT0RVTEU6IC4vc3JjL3JlbGF5L0FwcC50c3gKCgoKCgoKICAgICAgICAgIGZ1bmN0aW9uIEFwcChfcmVmKSB7dmFyIHBhZ2VzID0gX3JlZi5wYWdlczsKICAgICAgICAgICAgcmV0dXJuIC8qI19fUFVSRV9fKi8oCiAgICAgICAgICAgICAgcmVhY3QuY3JlYXRlRWxlbWVudChNZW1vcnlSb3V0ZXIsIG51bGwsCiAgICAgICAgICAgICAgIiAiLCAvKiNfX1BVUkVfXyovCiAgICAgICAgICAgICAgcmVhY3QuY3JlYXRlRWxlbWVudChSb3V0ZXMsIG51bGwsCiAgICAgICAgICAgICAgIiAiLCAvKiNfX1BVUkVfXyovCiAgICAgICAgICAgICAgcmVhY3QuY3JlYXRlRWxlbWVudChSb3V0ZSwgeyBlbGVtZW50OiAvKiNfX1BVUkVfXyovcmVhY3QuY3JlYXRlRWxlbWVudChjb21wb25lbnRzX0xheW91dCwgeyBwYWdlczogcGFnZXMgfSkgfSwKICAgICAgICAgICAgICAiICIsIC8qI19fUFVSRV9fKi8KICAgICAgICAgICAgICByZWFjdC5jcmVhdGVFbGVtZW50KFJvdXRlLCB7CiAgICAgICAgICAgICAgICBwYXRoOiAiLyIsCiAgICAgICAgICAgICAgICBlbGVtZW50OiAvKiNfX1BVUkVfXyovcmVhY3QuY3JlYXRlRWxlbWVudChOYXZpZ2F0ZSwgeyB0bzogIi8iICsgcGFnZXNbMF0uZmlsZSwgcmVwbGFjZTogdHJ1ZSB9KSB9KSwKICAgICAgICAgICAgICAiICIsCiAgICAgICAgICAgICAgcGFnZXMubWFwKGZ1bmN0aW9uIChwLCBpbmRleCkgewogICAgICAgICAgICAgICAgcmV0dXJuIC8qI19fUFVSRV9fKi8oCiAgICAgICAgICAgICAgICAgIHJlYWN0LmNyZWF0ZUVsZW1lbnQoUm91dGUsIHsKICAgICAgICAgICAgICAgICAgICBrZXk6IGluZGV4LAogICAgICAgICAgICAgICAgICAgIHBhdGg6ICIvIiArIHAuZmlsZSwKICAgICAgICAgICAgICAgICAgICBlbGVtZW50OiAvKiNfX1BVUkVfXyovcmVhY3QuY3JlYXRlRWxlbWVudChyb3V0ZXNfUmVsYXlQYWdlLCB7IHBhZ2U6IHAgfSkgfSkpOwoKCiAgICAgICAgICAgICAgfSksICIgIiksCiAgICAgICAgICAgICAgIiAiKSwKICAgICAgICAgICAgICAiICIpKTsKCgogICAgICAgICAgfQoKICAgICAgICAgIC8qIGhhcm1vbnkgZGVmYXVsdCBleHBvcnQgKi92YXIgcmVsYXlfQXBwID0gQXBwOwoKICAgICAgICAgIC8qKiovfSwKCiAgICAgICAgLyoqKi80NDg6CiAgICAgICAgLyoqKi8oX191bnVzZWRfd2VicGFja19tb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pID0+IHsKCiAgICAgICAgICAvKioKICAgICAgICAgICAqIEBsaWNlbnNlIFJlYWN0CiAgICAgICAgICAgKiByZWFjdC1kb20ucHJvZHVjdGlvbi5taW4uanMKICAgICAgICAgICAqCiAgICAgICAgICAgKiBDb3B5cmlnaHQgKGMpIEZhY2Vib29rLCBJbmMuIGFuZCBpdHMgYWZmaWxpYXRlcy4KICAgICAgICAgICAqCiAgICAgICAgICAgKiBUaGlzIHNvdXJjZSBjb2RlIGlzIGxpY2Vuc2VkIHVuZGVyIHRoZSBNSVQgbGljZW5zZSBmb3VuZCBpbiB0aGUKICAgICAgICAgICAqIExJQ0VOU0UgZmlsZSBpbiB0aGUgcm9vdCBkaXJlY3Rvcnkgb2YgdGhpcyBzb3VyY2UgdHJlZS4KICAgICAgICAgICAqLwogICAgICAgICAgLyoKICAgICAgICAgICBNb2Rlcm5penIgMy4wLjBwcmUgKEN1c3RvbSBCdWlsZCkgfCBNSVQKICAgICAgICAgICovCiAgICAgICAgICB2YXIgYWEgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDI5NCksY2EgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDg0MCk7ZnVuY3Rpb24gcChhKSB7Zm9yICh2YXIgYiA9ICJodHRwczovL3JlYWN0anMub3JnL2RvY3MvZXJyb3ItZGVjb2Rlci5odG1sP2ludmFyaWFudD0iICsgYSwgYyA9IDE7IGMgPCBhcmd1bWVudHMubGVuZ3RoOyBjKyspIHtiICs9ICImYXJnc1tdPSIgKyBlbmNvZGVVUklDb21wb25lbnQoYXJndW1lbnRzW2NdKTt9cmV0dXJuICJNaW5pZmllZCBSZWFjdCBlcnJvciAjIiArIGEgKyAiOyB2aXNpdCAiICsgYiArICIgZm9yIHRoZSBmdWxsIG1lc3NhZ2Ugb3IgdXNlIHRoZSBub24tbWluaWZpZWQgZGV2IGVudmlyb25tZW50IGZvciBmdWxsIGVycm9ycyBhbmQgYWRkaXRpb25hbCBoZWxwZnVsIHdhcm5pbmdzLiI7fXZhciBkYSA9IG5ldyBTZXQoKSxlYSA9IHt9O2Z1bmN0aW9uIGZhKGEsIGIpIHtoYShhLCBiKTtoYShhICsgIkNhcHR1cmUiLCBiKTt9CiAgICAgICAgICBmdW5jdGlvbiBoYShhLCBiKSB7ZWFbYV0gPSBiO2ZvciAoYSA9IDA7IGEgPCBiLmxlbmd0aDsgYSsrKSB7ZGEuYWRkKGJbYV0pO319CiAgICAgICAgICB2YXIgaWEgPSAhKCJ1bmRlZmluZWQiID09PSB0eXBlb2Ygd2luZG93IHx8ICJ1bmRlZmluZWQiID09PSB0eXBlb2Ygd2luZG93LmRvY3VtZW50IHx8ICJ1bmRlZmluZWQiID09PSB0eXBlb2Ygd2luZG93LmRvY3VtZW50LmNyZWF0ZUVsZW1lbnQpLGphID0gT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eSxrYSA9IC9eWzpBLVpfYS16XHUwMEMwLVx1MDBENlx1MDBEOC1cdTAwRjZcdTAwRjgtXHUwMkZGXHUwMzcwLVx1MDM3RFx1MDM3Ri1cdTFGRkZcdTIwMEMtXHUyMDBEXHUyMDcwLVx1MjE4Rlx1MkMwMC1cdTJGRUZcdTMwMDEtXHVEN0ZGXHVGOTAwLVx1RkRDRlx1RkRGMC1cdUZGRkRdWzpBLVpfYS16XHUwMEMwLVx1MDBENlx1MDBEOC1cdTAwRjZcdTAwRjgtXHUwMkZGXHUwMzcwLVx1MDM3RFx1MDM3Ri1cdTFGRkZcdTIwMEMtXHUyMDBEXHUyMDcwLVx1MjE4Rlx1MkMwMC1cdTJGRUZcdTMwMDEtXHVEN0ZGXHVGOTAwLVx1RkRDRlx1RkRGMC1cdUZGRkRcLS4wLTlcdTAwQjdcdTAzMDAtXHUwMzZGXHUyMDNGLVx1MjA0MF0qJC8sbGEgPQogICAgICAgICAgICB7fSxtYSA9IHt9O2Z1bmN0aW9uIG9hKGEpIHtpZiAoamEuY2FsbChtYSwgYSkpIHJldHVybiAhMDtpZiAoamEuY2FsbChsYSwgYSkpIHJldHVybiAhMTtpZiAoa2EudGVzdChhKSkgcmV0dXJuIG1hW2FdID0gITA7bGFbYV0gPSAhMDtyZXR1cm4gITE7fWZ1bmN0aW9uIHBhKGEsIGIsIGMsIGQpIHtpZiAobnVsbCAhPT0gYyAmJiAwID09PSBjLnR5cGUpIHJldHVybiAhMTtzd2l0Y2ggKHR5cGVvZiBiKSB7Y2FzZSAiZnVuY3Rpb24iOmNhc2UgInN5bWJvbCI6cmV0dXJuICEwO2Nhc2UgImJvb2xlYW4iOmlmIChkKSByZXR1cm4gITE7aWYgKG51bGwgIT09IGMpIHJldHVybiAhYy5hY2NlcHRzQm9vbGVhbnM7YSA9IGEudG9Mb3dlckNhc2UoKS5zbGljZSgwLCA1KTtyZXR1cm4gImRhdGEtIiAhPT0gYSAmJiAiYXJpYS0iICE9PSBhO2RlZmF1bHQ6cmV0dXJuICExO319CiAgICAgICAgICBmdW5jdGlvbiBxYShhLCBiLCBjLCBkKSB7aWYgKG51bGwgPT09IGIgfHwgInVuZGVmaW5lZCIgPT09IHR5cGVvZiBiIHx8IHBhKGEsIGIsIGMsIGQpKSByZXR1cm4gITA7aWYgKGQpIHJldHVybiAhMTtpZiAobnVsbCAhPT0gYykgc3dpdGNoIChjLnR5cGUpIHtjYXNlIDM6cmV0dXJuICFiO2Nhc2UgNDpyZXR1cm4gITEgPT09IGI7Y2FzZSA1OnJldHVybiBpc05hTihiKTtjYXNlIDY6cmV0dXJuIGlzTmFOKGIpIHx8IDEgPiBiO31yZXR1cm4gITE7fWZ1bmN0aW9uIHYoYSwgYiwgYywgZCwgZSwgZiwgZykge3RoaXMuYWNjZXB0c0Jvb2xlYW5zID0gMiA9PT0gYiB8fCAzID09PSBiIHx8IDQgPT09IGI7dGhpcy5hdHRyaWJ1dGVOYW1lID0gZDt0aGlzLmF0dHJpYnV0ZU5hbWVzcGFjZSA9IGU7dGhpcy5tdXN0VXNlUHJvcGVydHkgPSBjO3RoaXMucHJvcGVydHlOYW1lID0gYTt0aGlzLnR5cGUgPSBiO3RoaXMuc2FuaXRpemVVUkwgPSBmO3RoaXMucmVtb3ZlRW1wdHlTdHJpbmcgPSBnO312YXIgeiA9IHt9OwogICAgICAgICAgImNoaWxkcmVuIGRhbmdlcm91c2x5U2V0SW5uZXJIVE1MIGRlZmF1bHRWYWx1ZSBkZWZhdWx0Q2hlY2tlZCBpbm5lckhUTUwgc3VwcHJlc3NDb250ZW50RWRpdGFibGVXYXJuaW5nIHN1cHByZXNzSHlkcmF0aW9uV2FybmluZyBzdHlsZSIuc3BsaXQoIiAiKS5mb3JFYWNoKGZ1bmN0aW9uIChhKSB7elthXSA9IG5ldyB2KGEsIDAsICExLCBhLCBudWxsLCAhMSwgITEpO30pO1tbImFjY2VwdENoYXJzZXQiLCAiYWNjZXB0LWNoYXJzZXQiXSwgWyJjbGFzc05hbWUiLCAiY2xhc3MiXSwgWyJodG1sRm9yIiwgImZvciJdLCBbImh0dHBFcXVpdiIsICJodHRwLWVxdWl2Il1dLmZvckVhY2goZnVuY3Rpb24gKGEpIHt2YXIgYiA9IGFbMF07eltiXSA9IG5ldyB2KGIsIDEsICExLCBhWzFdLCBudWxsLCAhMSwgITEpO30pO1siY29udGVudEVkaXRhYmxlIiwgImRyYWdnYWJsZSIsICJzcGVsbENoZWNrIiwgInZhbHVlIl0uZm9yRWFjaChmdW5jdGlvbiAoYSkge3pbYV0gPSBuZXcgdihhLCAyLCAhMSwgYS50b0xvd2VyQ2FzZSgpLCBudWxsLCAhMSwgITEpO30pOwogICAgICAgICAgWyJhdXRvUmV2ZXJzZSIsICJleHRlcm5hbFJlc291cmNlc1JlcXVpcmVkIiwgImZvY3VzYWJsZSIsICJwcmVzZXJ2ZUFscGhhIl0uZm9yRWFjaChmdW5jdGlvbiAoYSkge3pbYV0gPSBuZXcgdihhLCAyLCAhMSwgYSwgbnVsbCwgITEsICExKTt9KTsiYWxsb3dGdWxsU2NyZWVuIGFzeW5jIGF1dG9Gb2N1cyBhdXRvUGxheSBjb250cm9scyBkZWZhdWx0IGRlZmVyIGRpc2FibGVkIGRpc2FibGVQaWN0dXJlSW5QaWN0dXJlIGRpc2FibGVSZW1vdGVQbGF5YmFjayBmb3JtTm9WYWxpZGF0ZSBoaWRkZW4gbG9vcCBub01vZHVsZSBub1ZhbGlkYXRlIG9wZW4gcGxheXNJbmxpbmUgcmVhZE9ubHkgcmVxdWlyZWQgcmV2ZXJzZWQgc2NvcGVkIHNlYW1sZXNzIGl0ZW1TY29wZSIuc3BsaXQoIiAiKS5mb3JFYWNoKGZ1bmN0aW9uIChhKSB7elthXSA9IG5ldyB2KGEsIDMsICExLCBhLnRvTG93ZXJDYXNlKCksIG51bGwsICExLCAhMSk7fSk7CiAgICAgICAgICBbImNoZWNrZWQiLCAibXVsdGlwbGUiLCAibXV0ZWQiLCAic2VsZWN0ZWQiXS5mb3JFYWNoKGZ1bmN0aW9uIChhKSB7elthXSA9IG5ldyB2KGEsIDMsICEwLCBhLCBudWxsLCAhMSwgITEpO30pO1siY2FwdHVyZSIsICJkb3dubG9hZCJdLmZvckVhY2goZnVuY3Rpb24gKGEpIHt6W2FdID0gbmV3IHYoYSwgNCwgITEsIGEsIG51bGwsICExLCAhMSk7fSk7WyJjb2xzIiwgInJvd3MiLCAic2l6ZSIsICJzcGFuIl0uZm9yRWFjaChmdW5jdGlvbiAoYSkge3pbYV0gPSBuZXcgdihhLCA2LCAhMSwgYSwgbnVsbCwgITEsICExKTt9KTtbInJvd1NwYW4iLCAic3RhcnQiXS5mb3JFYWNoKGZ1bmN0aW9uIChhKSB7elthXSA9IG5ldyB2KGEsIDUsICExLCBhLnRvTG93ZXJDYXNlKCksIG51bGwsICExLCAhMSk7fSk7dmFyIHJhID0gL1tcLTpdKFthLXpdKS9nO2Z1bmN0aW9uIHNhKGEpIHtyZXR1cm4gYVsxXS50b1VwcGVyQ2FzZSgpO30KICAgICAgICAgICJhY2NlbnQtaGVpZ2h0IGFsaWdubWVudC1iYXNlbGluZSBhcmFiaWMtZm9ybSBiYXNlbGluZS1zaGlmdCBjYXAtaGVpZ2h0IGNsaXAtcGF0aCBjbGlwLXJ1bGUgY29sb3ItaW50ZXJwb2xhdGlvbiBjb2xvci1pbnRlcnBvbGF0aW9uLWZpbHRlcnMgY29sb3ItcHJvZmlsZSBjb2xvci1yZW5kZXJpbmcgZG9taW5hbnQtYmFzZWxpbmUgZW5hYmxlLWJhY2tncm91bmQgZmlsbC1vcGFjaXR5IGZpbGwtcnVsZSBmbG9vZC1jb2xvciBmbG9vZC1vcGFjaXR5IGZvbnQtZmFtaWx5IGZvbnQtc2l6ZSBmb250LXNpemUtYWRqdXN0IGZvbnQtc3RyZXRjaCBmb250LXN0eWxlIGZvbnQtdmFyaWFudCBmb250LXdlaWdodCBnbHlwaC1uYW1lIGdseXBoLW9yaWVudGF0aW9uLWhvcml6b250YWwgZ2x5cGgtb3JpZW50YXRpb24tdmVydGljYWwgaG9yaXotYWR2LXggaG9yaXotb3JpZ2luLXggaW1hZ2UtcmVuZGVyaW5nIGxldHRlci1zcGFjaW5nIGxpZ2h0aW5nLWNvbG9yIG1hcmtlci1lbmQgbWFya2VyLW1pZCBtYXJrZXItc3RhcnQgb3ZlcmxpbmUtcG9zaXRpb24gb3ZlcmxpbmUtdGhpY2tuZXNzIHBhaW50LW9yZGVyIHBhbm9zZS0xIHBvaW50ZXItZXZlbnRzIHJlbmRlcmluZy1pbnRlbnQgc2hhcGUtcmVuZGVyaW5nIHN0b3AtY29sb3Igc3RvcC1vcGFjaXR5IHN0cmlrZXRocm91Z2gtcG9zaXRpb24gc3RyaWtldGhyb3VnaC10aGlja25lc3Mgc3Ryb2tlLWRhc2hhcnJheSBzdHJva2UtZGFzaG9mZnNldCBzdHJva2UtbGluZWNhcCBzdHJva2UtbGluZWpvaW4gc3Ryb2tlLW1pdGVybGltaXQgc3Ryb2tlLW9wYWNpdHkgc3Ryb2tlLXdpZHRoIHRleHQtYW5jaG9yIHRleHQtZGVjb3JhdGlvbiB0ZXh0LXJlbmRlcmluZyB1bmRlcmxpbmUtcG9zaXRpb24gdW5kZXJsaW5lLXRoaWNrbmVzcyB1bmljb2RlLWJpZGkgdW5pY29kZS1yYW5nZSB1bml0cy1wZXItZW0gdi1hbHBoYWJldGljIHYtaGFuZ2luZyB2LWlkZW9ncmFwaGljIHYtbWF0aGVtYXRpY2FsIHZlY3Rvci1lZmZlY3QgdmVydC1hZHYteSB2ZXJ0LW9yaWdpbi14IHZlcnQtb3JpZ2luLXkgd29yZC1zcGFjaW5nIHdyaXRpbmctbW9kZSB4bWxuczp4bGluayB4LWhlaWdodCIuc3BsaXQoIiAiKS5mb3JFYWNoKGZ1bmN0aW9uIChhKSB7dmFyIGIgPSBhLnJlcGxhY2UocmEsCiAgICAgICAgICAgIHNhKTt6W2JdID0gbmV3IHYoYiwgMSwgITEsIGEsIG51bGwsICExLCAhMSk7fSk7InhsaW5rOmFjdHVhdGUgeGxpbms6YXJjcm9sZSB4bGluazpyb2xlIHhsaW5rOnNob3cgeGxpbms6dGl0bGUgeGxpbms6dHlwZSIuc3BsaXQoIiAiKS5mb3JFYWNoKGZ1bmN0aW9uIChhKSB7dmFyIGIgPSBhLnJlcGxhY2UocmEsIHNhKTt6W2JdID0gbmV3IHYoYiwgMSwgITEsIGEsICJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiwgITEsICExKTt9KTtbInhtbDpiYXNlIiwgInhtbDpsYW5nIiwgInhtbDpzcGFjZSJdLmZvckVhY2goZnVuY3Rpb24gKGEpIHt2YXIgYiA9IGEucmVwbGFjZShyYSwgc2EpO3pbYl0gPSBuZXcgdihiLCAxLCAhMSwgYSwgImh0dHA6Ly93d3cudzMub3JnL1hNTC8xOTk4L25hbWVzcGFjZSIsICExLCAhMSk7fSk7WyJ0YWJJbmRleCIsICJjcm9zc09yaWdpbiJdLmZvckVhY2goZnVuY3Rpb24gKGEpIHt6W2FdID0gbmV3IHYoYSwgMSwgITEsIGEudG9Mb3dlckNhc2UoKSwgbnVsbCwgITEsICExKTt9KTsKICAgICAgICAgIHoueGxpbmtIcmVmID0gbmV3IHYoInhsaW5rSHJlZiIsIDEsICExLCAieGxpbms6aHJlZiIsICJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiwgITAsICExKTtbInNyYyIsICJocmVmIiwgImFjdGlvbiIsICJmb3JtQWN0aW9uIl0uZm9yRWFjaChmdW5jdGlvbiAoYSkge3pbYV0gPSBuZXcgdihhLCAxLCAhMSwgYS50b0xvd2VyQ2FzZSgpLCBudWxsLCAhMCwgITApO30pOwogICAgICAgICAgZnVuY3Rpb24gdGEoYSwgYiwgYywgZCkge3ZhciBlID0gei5oYXNPd25Qcm9wZXJ0eShiKSA/IHpbYl0gOiBudWxsO2lmIChudWxsICE9PSBlID8gMCAhPT0gZS50eXBlIDogZCB8fCAhKDIgPCBiLmxlbmd0aCkgfHwgIm8iICE9PSBiWzBdICYmICJPIiAhPT0gYlswXSB8fCAibiIgIT09IGJbMV0gJiYgIk4iICE9PSBiWzFdKSBxYShiLCBjLCBlLCBkKSAmJiAoYyA9IG51bGwpLCBkIHx8IG51bGwgPT09IGUgPyBvYShiKSAmJiAobnVsbCA9PT0gYyA/IGEucmVtb3ZlQXR0cmlidXRlKGIpIDogYS5zZXRBdHRyaWJ1dGUoYiwgIiIgKyBjKSkgOiBlLm11c3RVc2VQcm9wZXJ0eSA/IGFbZS5wcm9wZXJ0eU5hbWVdID0gbnVsbCA9PT0gYyA/IDMgPT09IGUudHlwZSA/ICExIDogIiIgOiBjIDogKGIgPSBlLmF0dHJpYnV0ZU5hbWUsIGQgPSBlLmF0dHJpYnV0ZU5hbWVzcGFjZSwgbnVsbCA9PT0gYyA/IGEucmVtb3ZlQXR0cmlidXRlKGIpIDogKGUgPSBlLnR5cGUsIGMgPSAzID09PSBlIHx8IDQgPT09IGUgJiYgITAgPT09IGMgPyAiIiA6ICIiICsgYywgZCA/IGEuc2V0QXR0cmlidXRlTlMoZCwgYiwgYykgOiBhLnNldEF0dHJpYnV0ZShiLCBjKSkpO30KICAgICAgICAgIHZhciB1YSA9IGFhLl9fU0VDUkVUX0lOVEVSTkFMU19ET19OT1RfVVNFX09SX1lPVV9XSUxMX0JFX0ZJUkVELHZhID0gU3ltYm9sLmZvcigicmVhY3QuZWxlbWVudCIpLHdhID0gU3ltYm9sLmZvcigicmVhY3QucG9ydGFsIikseWEgPSBTeW1ib2wuZm9yKCJyZWFjdC5mcmFnbWVudCIpLHphID0gU3ltYm9sLmZvcigicmVhY3Quc3RyaWN0X21vZGUiKSxBYSA9IFN5bWJvbC5mb3IoInJlYWN0LnByb2ZpbGVyIiksQmEgPSBTeW1ib2wuZm9yKCJyZWFjdC5wcm92aWRlciIpLENhID0gU3ltYm9sLmZvcigicmVhY3QuY29udGV4dCIpLERhID0gU3ltYm9sLmZvcigicmVhY3QuZm9yd2FyZF9yZWYiKSxFYSA9IFN5bWJvbC5mb3IoInJlYWN0LnN1c3BlbnNlIiksRmEgPSBTeW1ib2wuZm9yKCJyZWFjdC5zdXNwZW5zZV9saXN0IiksR2EgPSBTeW1ib2wuZm9yKCJyZWFjdC5tZW1vIiksSGEgPSBTeW1ib2wuZm9yKCJyZWFjdC5sYXp5Iik7U3ltYm9sLmZvcigicmVhY3Quc2NvcGUiKTtTeW1ib2wuZm9yKCJyZWFjdC5kZWJ1Z190cmFjZV9tb2RlIik7CiAgICAgICAgICB2YXIgSWEgPSBTeW1ib2wuZm9yKCJyZWFjdC5vZmZzY3JlZW4iKTtTeW1ib2wuZm9yKCJyZWFjdC5sZWdhY3lfaGlkZGVuIik7U3ltYm9sLmZvcigicmVhY3QuY2FjaGUiKTtTeW1ib2wuZm9yKCJyZWFjdC50cmFjaW5nX21hcmtlciIpO3ZhciBKYSA9IFN5bWJvbC5pdGVyYXRvcjtmdW5jdGlvbiBLYShhKSB7aWYgKG51bGwgPT09IGEgfHwgIm9iamVjdCIgIT09IHR5cGVvZiBhKSByZXR1cm4gbnVsbDthID0gSmEgJiYgYVtKYV0gfHwgYVsiQEBpdGVyYXRvciJdO3JldHVybiAiZnVuY3Rpb24iID09PSB0eXBlb2YgYSA/IGEgOiBudWxsO312YXIgQSA9IE9iamVjdC5hc3NpZ24sTGE7ZnVuY3Rpb24gTWEoYSkge2lmICh2b2lkIDAgPT09IExhKSB0cnkge3Rocm93IEVycm9yKCk7fSBjYXRjaCAoYykge3ZhciBiID0gYy5zdGFjay50cmltKCkubWF0Y2goL1xuKCAqKGF0ICk/KS8pO0xhID0gYiAmJiBiWzFdIHx8ICIiO31yZXR1cm4gIlxuIiArIExhICsgYTt9dmFyIE5hID0gITE7CiAgICAgICAgICBmdW5jdGlvbiBPYShhLCBiKSB7aWYgKCFhIHx8IE5hKSByZXR1cm4gIiI7TmEgPSAhMDt2YXIgYyA9IEVycm9yLnByZXBhcmVTdGFja1RyYWNlO0Vycm9yLnByZXBhcmVTdGFja1RyYWNlID0gdm9pZCAwO3RyeSB7aWYgKGIpIHtpZiAoYiA9IGZ1bmN0aW9uIGIoKSB7dGhyb3cgRXJyb3IoKTt9LCBPYmplY3QuZGVmaW5lUHJvcGVydHkoYi5wcm90b3R5cGUsICJwcm9wcyIsIHsgc2V0OiBmdW5jdGlvbiBzZXQoKSB7dGhyb3cgRXJyb3IoKTt9IH0pLCAib2JqZWN0IiA9PT0gdHlwZW9mIFJlZmxlY3QgJiYgUmVmbGVjdC5jb25zdHJ1Y3QpIHt0cnkge1JlZmxlY3QuY29uc3RydWN0KGIsIFtdKTt9IGNhdGNoIChsKSB7dmFyIGQgPSBsO31SZWZsZWN0LmNvbnN0cnVjdChhLCBbXSwgYik7fSBlbHNlIHt0cnkge2IuY2FsbCgpO30gY2F0Y2ggKGwpIHtkID0gbDt9YS5jYWxsKGIucHJvdG90eXBlKTt9fSBlbHNlIHt0cnkge3Rocm93IEVycm9yKCk7fSBjYXRjaCAobCkge2QgPSBsO31hKCk7fX0gY2F0Y2ggKGwpIHtpZiAobCAmJiBkICYmICJzdHJpbmciID09PSB0eXBlb2YgbC5zdGFjaykge2ZvciAodmFyIGUgPSBsLnN0YWNrLnNwbGl0KCJcbiIpLAogICAgICAgICAgICAgICAgICBmID0gZC5zdGFjay5zcGxpdCgiXG4iKSwgZyA9IGUubGVuZ3RoIC0gMSwgaCA9IGYubGVuZ3RoIC0gMTsgMSA8PSBnICYmIDAgPD0gaCAmJiBlW2ddICE9PSBmW2hdOykge2gtLTt9Zm9yICg7IDEgPD0gZyAmJiAwIDw9IGg7IGctLSwgaC0tKSB7aWYgKGVbZ10gIT09IGZbaF0pIHtpZiAoMSAhPT0gZyB8fCAxICE9PSBoKSB7ZG8ge2lmIChnLS0sIGgtLSwgMCA+IGggfHwgZVtnXSAhPT0gZltoXSkge3ZhciBrID0gIlxuIiArIGVbZ10ucmVwbGFjZSgiIGF0IG5ldyAiLCAiIGF0ICIpO2EuZGlzcGxheU5hbWUgJiYgay5pbmNsdWRlcygiPGFub255bW91cz4iKSAmJiAoayA9IGsucmVwbGFjZSgiPGFub255bW91cz4iLCBhLmRpc3BsYXlOYW1lKSk7cmV0dXJuIGs7fX0gd2hpbGUgKDEgPD0gZyAmJiAwIDw9IGgpO31icmVhazt9fX19IGZpbmFsbHkge05hID0gITEsIEVycm9yLnByZXBhcmVTdGFja1RyYWNlID0gYzt9cmV0dXJuIChhID0gYSA/IGEuZGlzcGxheU5hbWUgfHwgYS5uYW1lIDogIiIpID8gTWEoYSkgOiAiIjt9CiAgICAgICAgICBmdW5jdGlvbiBQYShhKSB7c3dpdGNoIChhLnRhZykge2Nhc2UgNTpyZXR1cm4gTWEoYS50eXBlKTtjYXNlIDE2OnJldHVybiBNYSgiTGF6eSIpO2Nhc2UgMTM6cmV0dXJuIE1hKCJTdXNwZW5zZSIpO2Nhc2UgMTk6cmV0dXJuIE1hKCJTdXNwZW5zZUxpc3QiKTtjYXNlIDA6Y2FzZSAyOmNhc2UgMTU6cmV0dXJuIGEgPSBPYShhLnR5cGUsICExKSwgYTtjYXNlIDExOnJldHVybiBhID0gT2EoYS50eXBlLnJlbmRlciwgITEpLCBhO2Nhc2UgMTpyZXR1cm4gYSA9IE9hKGEudHlwZSwgITApLCBhO2RlZmF1bHQ6cmV0dXJuICIiO319CiAgICAgICAgICBmdW5jdGlvbiBRYShhKSB7aWYgKG51bGwgPT0gYSkgcmV0dXJuIG51bGw7aWYgKCJmdW5jdGlvbiIgPT09IHR5cGVvZiBhKSByZXR1cm4gYS5kaXNwbGF5TmFtZSB8fCBhLm5hbWUgfHwgbnVsbDtpZiAoInN0cmluZyIgPT09IHR5cGVvZiBhKSByZXR1cm4gYTtzd2l0Y2ggKGEpIHtjYXNlIHlhOnJldHVybiAiRnJhZ21lbnQiO2Nhc2Ugd2E6cmV0dXJuICJQb3J0YWwiO2Nhc2UgQWE6cmV0dXJuICJQcm9maWxlciI7Y2FzZSB6YTpyZXR1cm4gIlN0cmljdE1vZGUiO2Nhc2UgRWE6cmV0dXJuICJTdXNwZW5zZSI7Y2FzZSBGYTpyZXR1cm4gIlN1c3BlbnNlTGlzdCI7fWlmICgib2JqZWN0IiA9PT0gdHlwZW9mIGEpIHN3aXRjaCAoYS4kJHR5cGVvZikge2Nhc2UgQ2E6cmV0dXJuIChhLmRpc3BsYXlOYW1lIHx8ICJDb250ZXh0IikgKyAiLkNvbnN1bWVyIjtjYXNlIEJhOnJldHVybiAoYS5fY29udGV4dC5kaXNwbGF5TmFtZSB8fCAiQ29udGV4dCIpICsgIi5Qcm92aWRlciI7Y2FzZSBEYTp2YXIgYiA9IGEucmVuZGVyO2EgPSBhLmRpc3BsYXlOYW1lO2EgfHwgKGEgPSBiLmRpc3BsYXlOYW1lIHx8CiAgICAgICAgICAgICAgICBiLm5hbWUgfHwgIiIsIGEgPSAiIiAhPT0gYSA/ICJGb3J3YXJkUmVmKCIgKyBhICsgIikiIDogIkZvcndhcmRSZWYiKTtyZXR1cm4gYTtjYXNlIEdhOnJldHVybiBiID0gYS5kaXNwbGF5TmFtZSB8fCBudWxsLCBudWxsICE9PSBiID8gYiA6IFFhKGEudHlwZSkgfHwgIk1lbW8iO2Nhc2UgSGE6YiA9IGEuX3BheWxvYWQ7YSA9IGEuX2luaXQ7dHJ5IHtyZXR1cm4gUWEoYShiKSk7fSBjYXRjaCAoYykge319cmV0dXJuIG51bGw7fQogICAgICAgICAgZnVuY3Rpb24gUmEoYSkge3ZhciBiID0gYS50eXBlO3N3aXRjaCAoYS50YWcpIHtjYXNlIDI0OnJldHVybiAiQ2FjaGUiO2Nhc2UgOTpyZXR1cm4gKGIuZGlzcGxheU5hbWUgfHwgIkNvbnRleHQiKSArICIuQ29uc3VtZXIiO2Nhc2UgMTA6cmV0dXJuIChiLl9jb250ZXh0LmRpc3BsYXlOYW1lIHx8ICJDb250ZXh0IikgKyAiLlByb3ZpZGVyIjtjYXNlIDE4OnJldHVybiAiRGVoeWRyYXRlZEZyYWdtZW50IjtjYXNlIDExOnJldHVybiBhID0gYi5yZW5kZXIsIGEgPSBhLmRpc3BsYXlOYW1lIHx8IGEubmFtZSB8fCAiIiwgYi5kaXNwbGF5TmFtZSB8fCAoIiIgIT09IGEgPyAiRm9yd2FyZFJlZigiICsgYSArICIpIiA6ICJGb3J3YXJkUmVmIik7Y2FzZSA3OnJldHVybiAiRnJhZ21lbnQiO2Nhc2UgNTpyZXR1cm4gYjtjYXNlIDQ6cmV0dXJuICJQb3J0YWwiO2Nhc2UgMzpyZXR1cm4gIlJvb3QiO2Nhc2UgNjpyZXR1cm4gIlRleHQiO2Nhc2UgMTY6cmV0dXJuIFFhKGIpO2Nhc2UgODpyZXR1cm4gYiA9PT0gemEgPyAiU3RyaWN0TW9kZSIgOiAiTW9kZSI7Y2FzZSAyMjpyZXR1cm4gIk9mZnNjcmVlbiI7CiAgICAgICAgICAgICAgY2FzZSAxMjpyZXR1cm4gIlByb2ZpbGVyIjtjYXNlIDIxOnJldHVybiAiU2NvcGUiO2Nhc2UgMTM6cmV0dXJuICJTdXNwZW5zZSI7Y2FzZSAxOTpyZXR1cm4gIlN1c3BlbnNlTGlzdCI7Y2FzZSAyNTpyZXR1cm4gIlRyYWNpbmdNYXJrZXIiO2Nhc2UgMTpjYXNlIDA6Y2FzZSAxNzpjYXNlIDI6Y2FzZSAxNDpjYXNlIDE1OmlmICgiZnVuY3Rpb24iID09PSB0eXBlb2YgYikgcmV0dXJuIGIuZGlzcGxheU5hbWUgfHwgYi5uYW1lIHx8IG51bGw7aWYgKCJzdHJpbmciID09PSB0eXBlb2YgYikgcmV0dXJuIGI7fXJldHVybiBudWxsO31mdW5jdGlvbiBTYShhKSB7c3dpdGNoICh0eXBlb2YgYSkge2Nhc2UgImJvb2xlYW4iOmNhc2UgIm51bWJlciI6Y2FzZSAic3RyaW5nIjpjYXNlICJ1bmRlZmluZWQiOnJldHVybiBhO2Nhc2UgIm9iamVjdCI6cmV0dXJuIGE7ZGVmYXVsdDpyZXR1cm4gIiI7fX0KICAgICAgICAgIGZ1bmN0aW9uIFRhKGEpIHt2YXIgYiA9IGEudHlwZTtyZXR1cm4gKGEgPSBhLm5vZGVOYW1lKSAmJiAiaW5wdXQiID09PSBhLnRvTG93ZXJDYXNlKCkgJiYgKCJjaGVja2JveCIgPT09IGIgfHwgInJhZGlvIiA9PT0gYik7fQogICAgICAgICAgZnVuY3Rpb24gVWEoYSkge3ZhciBiID0gVGEoYSkgPyAiY2hlY2tlZCIgOiAidmFsdWUiLGMgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKGEuY29uc3RydWN0b3IucHJvdG90eXBlLCBiKSxkID0gIiIgKyBhW2JdO2lmICghYS5oYXNPd25Qcm9wZXJ0eShiKSAmJiAidW5kZWZpbmVkIiAhPT0gdHlwZW9mIGMgJiYgImZ1bmN0aW9uIiA9PT0gdHlwZW9mIGMuZ2V0ICYmICJmdW5jdGlvbiIgPT09IHR5cGVvZiBjLnNldCkge3ZhciBlID0gYy5nZXQsZiA9IGMuc2V0O09iamVjdC5kZWZpbmVQcm9wZXJ0eShhLCBiLCB7IGNvbmZpZ3VyYWJsZTogITAsIGdldDogZnVuY3Rpb24gZ2V0KCkge3JldHVybiBlLmNhbGwodGhpcyk7fSwgc2V0OiBmdW5jdGlvbiBzZXQoYSkge2QgPSAiIiArIGE7Zi5jYWxsKHRoaXMsIGEpO30gfSk7T2JqZWN0LmRlZmluZVByb3BlcnR5KGEsIGIsIHsgZW51bWVyYWJsZTogYy5lbnVtZXJhYmxlIH0pO3JldHVybiB7IGdldFZhbHVlOiBmdW5jdGlvbiBnZXRWYWx1ZSgpIHtyZXR1cm4gZDt9LCBzZXRWYWx1ZTogZnVuY3Rpb24gc2V0VmFsdWUoYSkge2QgPSAiIiArIGE7fSwgc3RvcFRyYWNraW5nOiBmdW5jdGlvbiBzdG9wVHJhY2tpbmcoKSB7YS5fdmFsdWVUcmFja2VyID0KICAgICAgICAgICAgICAgICAgbnVsbDtkZWxldGUgYVtiXTt9IH07fX1mdW5jdGlvbiBWYShhKSB7YS5fdmFsdWVUcmFja2VyIHx8IChhLl92YWx1ZVRyYWNrZXIgPSBVYShhKSk7fWZ1bmN0aW9uIFdhKGEpIHtpZiAoIWEpIHJldHVybiAhMTt2YXIgYiA9IGEuX3ZhbHVlVHJhY2tlcjtpZiAoIWIpIHJldHVybiAhMDt2YXIgYyA9IGIuZ2V0VmFsdWUoKTt2YXIgZCA9ICIiO2EgJiYgKGQgPSBUYShhKSA/IGEuY2hlY2tlZCA/ICJ0cnVlIiA6ICJmYWxzZSIgOiBhLnZhbHVlKTthID0gZDtyZXR1cm4gYSAhPT0gYyA/IChiLnNldFZhbHVlKGEpLCAhMCkgOiAhMTt9ZnVuY3Rpb24gWGEoYSkge2EgPSBhIHx8ICgidW5kZWZpbmVkIiAhPT0gdHlwZW9mIGRvY3VtZW50ID8gZG9jdW1lbnQgOiB2b2lkIDApO2lmICgidW5kZWZpbmVkIiA9PT0gdHlwZW9mIGEpIHJldHVybiBudWxsO3RyeSB7cmV0dXJuIGEuYWN0aXZlRWxlbWVudCB8fCBhLmJvZHk7fSBjYXRjaCAoYikge3JldHVybiBhLmJvZHk7fX0KICAgICAgICAgIGZ1bmN0aW9uIFlhKGEsIGIpIHt2YXIgYyA9IGIuY2hlY2tlZDtyZXR1cm4gQSh7fSwgYiwgeyBkZWZhdWx0Q2hlY2tlZDogdm9pZCAwLCBkZWZhdWx0VmFsdWU6IHZvaWQgMCwgdmFsdWU6IHZvaWQgMCwgY2hlY2tlZDogbnVsbCAhPSBjID8gYyA6IGEuX3dyYXBwZXJTdGF0ZS5pbml0aWFsQ2hlY2tlZCB9KTt9ZnVuY3Rpb24gWmEoYSwgYikge3ZhciBjID0gbnVsbCA9PSBiLmRlZmF1bHRWYWx1ZSA/ICIiIDogYi5kZWZhdWx0VmFsdWUsZCA9IG51bGwgIT0gYi5jaGVja2VkID8gYi5jaGVja2VkIDogYi5kZWZhdWx0Q2hlY2tlZDtjID0gU2EobnVsbCAhPSBiLnZhbHVlID8gYi52YWx1ZSA6IGMpO2EuX3dyYXBwZXJTdGF0ZSA9IHsgaW5pdGlhbENoZWNrZWQ6IGQsIGluaXRpYWxWYWx1ZTogYywgY29udHJvbGxlZDogImNoZWNrYm94IiA9PT0gYi50eXBlIHx8ICJyYWRpbyIgPT09IGIudHlwZSA/IG51bGwgIT0gYi5jaGVja2VkIDogbnVsbCAhPSBiLnZhbHVlIH07fWZ1bmN0aW9uIGFiKGEsIGIpIHtiID0gYi5jaGVja2VkO251bGwgIT0gYiAmJiB0YShhLCAiY2hlY2tlZCIsIGIsICExKTt9CiAgICAgICAgICBmdW5jdGlvbiBiYihhLCBiKSB7YWIoYSwgYik7dmFyIGMgPSBTYShiLnZhbHVlKSxkID0gYi50eXBlO2lmIChudWxsICE9IGMpIHtpZiAoIm51bWJlciIgPT09IGQpIHtpZiAoMCA9PT0gYyAmJiAiIiA9PT0gYS52YWx1ZSB8fCBhLnZhbHVlICE9IGMpIGEudmFsdWUgPSAiIiArIGM7fSBlbHNlIGEudmFsdWUgIT09ICIiICsgYyAmJiAoYS52YWx1ZSA9ICIiICsgYyk7fSBlbHNlIGlmICgic3VibWl0IiA9PT0gZCB8fCAicmVzZXQiID09PSBkKSB7YS5yZW1vdmVBdHRyaWJ1dGUoInZhbHVlIik7cmV0dXJuO31iLmhhc093blByb3BlcnR5KCJ2YWx1ZSIpID8gY2IoYSwgYi50eXBlLCBjKSA6IGIuaGFzT3duUHJvcGVydHkoImRlZmF1bHRWYWx1ZSIpICYmIGNiKGEsIGIudHlwZSwgU2EoYi5kZWZhdWx0VmFsdWUpKTtudWxsID09IGIuY2hlY2tlZCAmJiBudWxsICE9IGIuZGVmYXVsdENoZWNrZWQgJiYgKGEuZGVmYXVsdENoZWNrZWQgPSAhIWIuZGVmYXVsdENoZWNrZWQpO30KICAgICAgICAgIGZ1bmN0aW9uIGRiKGEsIGIsIGMpIHtpZiAoYi5oYXNPd25Qcm9wZXJ0eSgidmFsdWUiKSB8fCBiLmhhc093blByb3BlcnR5KCJkZWZhdWx0VmFsdWUiKSkge3ZhciBkID0gYi50eXBlO2lmICghKCJzdWJtaXQiICE9PSBkICYmICJyZXNldCIgIT09IGQgfHwgdm9pZCAwICE9PSBiLnZhbHVlICYmIG51bGwgIT09IGIudmFsdWUpKSByZXR1cm47YiA9ICIiICsgYS5fd3JhcHBlclN0YXRlLmluaXRpYWxWYWx1ZTtjIHx8IGIgPT09IGEudmFsdWUgfHwgKGEudmFsdWUgPSBiKTthLmRlZmF1bHRWYWx1ZSA9IGI7fWMgPSBhLm5hbWU7IiIgIT09IGMgJiYgKGEubmFtZSA9ICIiKTthLmRlZmF1bHRDaGVja2VkID0gISFhLl93cmFwcGVyU3RhdGUuaW5pdGlhbENoZWNrZWQ7IiIgIT09IGMgJiYgKGEubmFtZSA9IGMpO30KICAgICAgICAgIGZ1bmN0aW9uIGNiKGEsIGIsIGMpIHtpZiAoIm51bWJlciIgIT09IGIgfHwgWGEoYS5vd25lckRvY3VtZW50KSAhPT0gYSkgbnVsbCA9PSBjID8gYS5kZWZhdWx0VmFsdWUgPSAiIiArIGEuX3dyYXBwZXJTdGF0ZS5pbml0aWFsVmFsdWUgOiBhLmRlZmF1bHRWYWx1ZSAhPT0gIiIgKyBjICYmIChhLmRlZmF1bHRWYWx1ZSA9ICIiICsgYyk7fXZhciBlYiA9IEFycmF5LmlzQXJyYXk7CiAgICAgICAgICBmdW5jdGlvbiBmYihhLCBiLCBjLCBkKSB7YSA9IGEub3B0aW9ucztpZiAoYikge2IgPSB7fTtmb3IgKHZhciBlID0gMDsgZSA8IGMubGVuZ3RoOyBlKyspIHtiWyIkIiArIGNbZV1dID0gITA7fWZvciAoYyA9IDA7IGMgPCBhLmxlbmd0aDsgYysrKSB7ZSA9IGIuaGFzT3duUHJvcGVydHkoIiQiICsgYVtjXS52YWx1ZSksIGFbY10uc2VsZWN0ZWQgIT09IGUgJiYgKGFbY10uc2VsZWN0ZWQgPSBlKSwgZSAmJiBkICYmIChhW2NdLmRlZmF1bHRTZWxlY3RlZCA9ICEwKTt9fSBlbHNlIHtjID0gIiIgKyBTYShjKTtiID0gbnVsbDtmb3IgKGUgPSAwOyBlIDwgYS5sZW5ndGg7IGUrKykge2lmIChhW2VdLnZhbHVlID09PSBjKSB7YVtlXS5zZWxlY3RlZCA9ICEwO2QgJiYgKGFbZV0uZGVmYXVsdFNlbGVjdGVkID0gITApO3JldHVybjt9bnVsbCAhPT0gYiB8fCBhW2VdLmRpc2FibGVkIHx8IChiID0gYVtlXSk7fW51bGwgIT09IGIgJiYgKGIuc2VsZWN0ZWQgPSAhMCk7fX0KICAgICAgICAgIGZ1bmN0aW9uIGdiKGEsIGIpIHtpZiAobnVsbCAhPSBiLmRhbmdlcm91c2x5U2V0SW5uZXJIVE1MKSB0aHJvdyBFcnJvcihwKDkxKSk7cmV0dXJuIEEoe30sIGIsIHsgdmFsdWU6IHZvaWQgMCwgZGVmYXVsdFZhbHVlOiB2b2lkIDAsIGNoaWxkcmVuOiAiIiArIGEuX3dyYXBwZXJTdGF0ZS5pbml0aWFsVmFsdWUgfSk7fWZ1bmN0aW9uIGhiKGEsIGIpIHt2YXIgYyA9IGIudmFsdWU7aWYgKG51bGwgPT0gYykge2MgPSBiLmNoaWxkcmVuO2IgPSBiLmRlZmF1bHRWYWx1ZTtpZiAobnVsbCAhPSBjKSB7aWYgKG51bGwgIT0gYikgdGhyb3cgRXJyb3IocCg5MikpO2lmIChlYihjKSkge2lmICgxIDwgYy5sZW5ndGgpIHRocm93IEVycm9yKHAoOTMpKTtjID0gY1swXTt9YiA9IGM7fW51bGwgPT0gYiAmJiAoYiA9ICIiKTtjID0gYjt9YS5fd3JhcHBlclN0YXRlID0geyBpbml0aWFsVmFsdWU6IFNhKGMpIH07fQogICAgICAgICAgZnVuY3Rpb24gaWIoYSwgYikge3ZhciBjID0gU2EoYi52YWx1ZSksZCA9IFNhKGIuZGVmYXVsdFZhbHVlKTtudWxsICE9IGMgJiYgKGMgPSAiIiArIGMsIGMgIT09IGEudmFsdWUgJiYgKGEudmFsdWUgPSBjKSwgbnVsbCA9PSBiLmRlZmF1bHRWYWx1ZSAmJiBhLmRlZmF1bHRWYWx1ZSAhPT0gYyAmJiAoYS5kZWZhdWx0VmFsdWUgPSBjKSk7bnVsbCAhPSBkICYmIChhLmRlZmF1bHRWYWx1ZSA9ICIiICsgZCk7fWZ1bmN0aW9uIGpiKGEpIHt2YXIgYiA9IGEudGV4dENvbnRlbnQ7YiA9PT0gYS5fd3JhcHBlclN0YXRlLmluaXRpYWxWYWx1ZSAmJiAiIiAhPT0gYiAmJiBudWxsICE9PSBiICYmIChhLnZhbHVlID0gYik7fWZ1bmN0aW9uIGtiKGEpIHtzd2l0Y2ggKGEpIHtjYXNlICJzdmciOnJldHVybiAiaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciO2Nhc2UgIm1hdGgiOnJldHVybiAiaHR0cDovL3d3dy53My5vcmcvMTk5OC9NYXRoL01hdGhNTCI7ZGVmYXVsdDpyZXR1cm4gImh0dHA6Ly93d3cudzMub3JnLzE5OTkveGh0bWwiO319CiAgICAgICAgICBmdW5jdGlvbiBsYihhLCBiKSB7cmV0dXJuIG51bGwgPT0gYSB8fCAiaHR0cDovL3d3dy53My5vcmcvMTk5OS94aHRtbCIgPT09IGEgPyBrYihiKSA6ICJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgPT09IGEgJiYgImZvcmVpZ25PYmplY3QiID09PSBiID8gImh0dHA6Ly93d3cudzMub3JnLzE5OTkveGh0bWwiIDogYTt9CiAgICAgICAgICB2YXIgbWIsbmIgPSBmdW5jdGlvbiAoYSkge3JldHVybiAidW5kZWZpbmVkIiAhPT0gdHlwZW9mIE1TQXBwICYmIE1TQXBwLmV4ZWNVbnNhZmVMb2NhbEZ1bmN0aW9uID8gZnVuY3Rpb24gKGIsIGMsIGQsIGUpIHtNU0FwcC5leGVjVW5zYWZlTG9jYWxGdW5jdGlvbihmdW5jdGlvbiAoKSB7cmV0dXJuIGEoYiwgYywgZCwgZSk7fSk7fSA6IGE7fShmdW5jdGlvbiAoYSwgYikge2lmICgiaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciICE9PSBhLm5hbWVzcGFjZVVSSSB8fCAiaW5uZXJIVE1MIiBpbiBhKSBhLmlubmVySFRNTCA9IGI7ZWxzZSB7bWIgPSBtYiB8fCBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKTttYi5pbm5lckhUTUwgPSAiPHN2Zz4iICsgYi52YWx1ZU9mKCkudG9TdHJpbmcoKSArICI8L3N2Zz4iO2ZvciAoYiA9IG1iLmZpcnN0Q2hpbGQ7IGEuZmlyc3RDaGlsZDspIHthLnJlbW92ZUNoaWxkKGEuZmlyc3RDaGlsZCk7fWZvciAoOyBiLmZpcnN0Q2hpbGQ7KSB7YS5hcHBlbmRDaGlsZChiLmZpcnN0Q2hpbGQpO319fSk7CiAgICAgICAgICBmdW5jdGlvbiBvYihhLCBiKSB7aWYgKGIpIHt2YXIgYyA9IGEuZmlyc3RDaGlsZDtpZiAoYyAmJiBjID09PSBhLmxhc3RDaGlsZCAmJiAzID09PSBjLm5vZGVUeXBlKSB7Yy5ub2RlVmFsdWUgPSBiO3JldHVybjt9fWEudGV4dENvbnRlbnQgPSBiO30KICAgICAgICAgIHZhciBwYiA9IHsgYW5pbWF0aW9uSXRlcmF0aW9uQ291bnQ6ICEwLCBhc3BlY3RSYXRpbzogITAsIGJvcmRlckltYWdlT3V0c2V0OiAhMCwgYm9yZGVySW1hZ2VTbGljZTogITAsIGJvcmRlckltYWdlV2lkdGg6ICEwLCBib3hGbGV4OiAhMCwgYm94RmxleEdyb3VwOiAhMCwgYm94T3JkaW5hbEdyb3VwOiAhMCwgY29sdW1uQ291bnQ6ICEwLCBjb2x1bW5zOiAhMCwgZmxleDogITAsIGZsZXhHcm93OiAhMCwgZmxleFBvc2l0aXZlOiAhMCwgZmxleFNocmluazogITAsIGZsZXhOZWdhdGl2ZTogITAsIGZsZXhPcmRlcjogITAsIGdyaWRBcmVhOiAhMCwgZ3JpZFJvdzogITAsIGdyaWRSb3dFbmQ6ICEwLCBncmlkUm93U3BhbjogITAsIGdyaWRSb3dTdGFydDogITAsIGdyaWRDb2x1bW46ICEwLCBncmlkQ29sdW1uRW5kOiAhMCwgZ3JpZENvbHVtblNwYW46ICEwLCBncmlkQ29sdW1uU3RhcnQ6ICEwLCBmb250V2VpZ2h0OiAhMCwgbGluZUNsYW1wOiAhMCwgbGluZUhlaWdodDogITAsIG9wYWNpdHk6ICEwLCBvcmRlcjogITAsIG9ycGhhbnM6ICEwLCB0YWJTaXplOiAhMCwgd2lkb3dzOiAhMCwgekluZGV4OiAhMCwKICAgICAgICAgICAgICB6b29tOiAhMCwgZmlsbE9wYWNpdHk6ICEwLCBmbG9vZE9wYWNpdHk6ICEwLCBzdG9wT3BhY2l0eTogITAsIHN0cm9rZURhc2hhcnJheTogITAsIHN0cm9rZURhc2hvZmZzZXQ6ICEwLCBzdHJva2VNaXRlcmxpbWl0OiAhMCwgc3Ryb2tlT3BhY2l0eTogITAsIHN0cm9rZVdpZHRoOiAhMCB9LHFiID0gWyJXZWJraXQiLCAibXMiLCAiTW96IiwgIk8iXTtPYmplY3Qua2V5cyhwYikuZm9yRWFjaChmdW5jdGlvbiAoYSkge3FiLmZvckVhY2goZnVuY3Rpb24gKGIpIHtiID0gYiArIGEuY2hhckF0KDApLnRvVXBwZXJDYXNlKCkgKyBhLnN1YnN0cmluZygxKTtwYltiXSA9IHBiW2FdO30pO30pO2Z1bmN0aW9uIHJiKGEsIGIsIGMpIHtyZXR1cm4gbnVsbCA9PSBiIHx8ICJib29sZWFuIiA9PT0gdHlwZW9mIGIgfHwgIiIgPT09IGIgPyAiIiA6IGMgfHwgIm51bWJlciIgIT09IHR5cGVvZiBiIHx8IDAgPT09IGIgfHwgcGIuaGFzT3duUHJvcGVydHkoYSkgJiYgcGJbYV0gPyAoIiIgKyBiKS50cmltKCkgOiBiICsgInB4Ijt9CiAgICAgICAgICBmdW5jdGlvbiBzYihhLCBiKSB7YSA9IGEuc3R5bGU7Zm9yICh2YXIgYyBpbiBiKSB7aWYgKGIuaGFzT3duUHJvcGVydHkoYykpIHt2YXIgZCA9IDAgPT09IGMuaW5kZXhPZigiLS0iKSxlID0gcmIoYywgYltjXSwgZCk7ImZsb2F0IiA9PT0gYyAmJiAoYyA9ICJjc3NGbG9hdCIpO2QgPyBhLnNldFByb3BlcnR5KGMsIGUpIDogYVtjXSA9IGU7fX19dmFyIHRiID0gQSh7IG1lbnVpdGVtOiAhMCB9LCB7IGFyZWE6ICEwLCBiYXNlOiAhMCwgYnI6ICEwLCBjb2w6ICEwLCBlbWJlZDogITAsIGhyOiAhMCwgaW1nOiAhMCwgaW5wdXQ6ICEwLCBrZXlnZW46ICEwLCBsaW5rOiAhMCwgbWV0YTogITAsIHBhcmFtOiAhMCwgc291cmNlOiAhMCwgdHJhY2s6ICEwLCB3YnI6ICEwIH0pOwogICAgICAgICAgZnVuY3Rpb24gdWIoYSwgYikge2lmIChiKSB7aWYgKHRiW2FdICYmIChudWxsICE9IGIuY2hpbGRyZW4gfHwgbnVsbCAhPSBiLmRhbmdlcm91c2x5U2V0SW5uZXJIVE1MKSkgdGhyb3cgRXJyb3IocCgxMzcsIGEpKTtpZiAobnVsbCAhPSBiLmRhbmdlcm91c2x5U2V0SW5uZXJIVE1MKSB7aWYgKG51bGwgIT0gYi5jaGlsZHJlbikgdGhyb3cgRXJyb3IocCg2MCkpO2lmICgib2JqZWN0IiAhPT0gdHlwZW9mIGIuZGFuZ2Vyb3VzbHlTZXRJbm5lckhUTUwgfHwgISgiX19odG1sIiBpbiBiLmRhbmdlcm91c2x5U2V0SW5uZXJIVE1MKSkgdGhyb3cgRXJyb3IocCg2MSkpO31pZiAobnVsbCAhPSBiLnN0eWxlICYmICJvYmplY3QiICE9PSB0eXBlb2YgYi5zdHlsZSkgdGhyb3cgRXJyb3IocCg2MikpO319CiAgICAgICAgICBmdW5jdGlvbiB2YihhLCBiKSB7aWYgKC0xID09PSBhLmluZGV4T2YoIi0iKSkgcmV0dXJuICJzdHJpbmciID09PSB0eXBlb2YgYi5pcztzd2l0Y2ggKGEpIHtjYXNlICJhbm5vdGF0aW9uLXhtbCI6Y2FzZSAiY29sb3ItcHJvZmlsZSI6Y2FzZSAiZm9udC1mYWNlIjpjYXNlICJmb250LWZhY2Utc3JjIjpjYXNlICJmb250LWZhY2UtdXJpIjpjYXNlICJmb250LWZhY2UtZm9ybWF0IjpjYXNlICJmb250LWZhY2UtbmFtZSI6Y2FzZSAibWlzc2luZy1nbHlwaCI6cmV0dXJuICExO2RlZmF1bHQ6cmV0dXJuICEwO319dmFyIHdiID0gbnVsbDtmdW5jdGlvbiB4YihhKSB7YSA9IGEudGFyZ2V0IHx8IGEuc3JjRWxlbWVudCB8fCB3aW5kb3c7YS5jb3JyZXNwb25kaW5nVXNlRWxlbWVudCAmJiAoYSA9IGEuY29ycmVzcG9uZGluZ1VzZUVsZW1lbnQpO3JldHVybiAzID09PSBhLm5vZGVUeXBlID8gYS5wYXJlbnROb2RlIDogYTt9dmFyIHliID0gbnVsbCx6YiA9IG51bGwsQWIgPSBudWxsOwogICAgICAgICAgZnVuY3Rpb24gQmIoYSkge2lmIChhID0gQ2IoYSkpIHtpZiAoImZ1bmN0aW9uIiAhPT0gdHlwZW9mIHliKSB0aHJvdyBFcnJvcihwKDI4MCkpO3ZhciBiID0gYS5zdGF0ZU5vZGU7YiAmJiAoYiA9IERiKGIpLCB5YihhLnN0YXRlTm9kZSwgYS50eXBlLCBiKSk7fX1mdW5jdGlvbiBFYihhKSB7emIgPyBBYiA/IEFiLnB1c2goYSkgOiBBYiA9IFthXSA6IHpiID0gYTt9ZnVuY3Rpb24gRmIoKSB7aWYgKHpiKSB7dmFyIGEgPSB6YixiID0gQWI7QWIgPSB6YiA9IG51bGw7QmIoYSk7aWYgKGIpIGZvciAoYSA9IDA7IGEgPCBiLmxlbmd0aDsgYSsrKSB7QmIoYlthXSk7fX19ZnVuY3Rpb24gR2IoYSwgYikge3JldHVybiBhKGIpO31mdW5jdGlvbiBIYigpIHt9dmFyIEliID0gITE7ZnVuY3Rpb24gSmIoYSwgYiwgYykge2lmIChJYikgcmV0dXJuIGEoYiwgYyk7SWIgPSAhMDt0cnkge3JldHVybiBHYihhLCBiLCBjKTt9IGZpbmFsbHkge2lmIChJYiA9ICExLCBudWxsICE9PSB6YiB8fCBudWxsICE9PSBBYikgSGIoKSwgRmIoKTt9fQogICAgICAgICAgZnVuY3Rpb24gS2IoYSwgYikge3ZhciBjID0gYS5zdGF0ZU5vZGU7aWYgKG51bGwgPT09IGMpIHJldHVybiBudWxsO3ZhciBkID0gRGIoYyk7aWYgKG51bGwgPT09IGQpIHJldHVybiBudWxsO2MgPSBkW2JdO2E6IHN3aXRjaCAoYikge2Nhc2UgIm9uQ2xpY2siOmNhc2UgIm9uQ2xpY2tDYXB0dXJlIjpjYXNlICJvbkRvdWJsZUNsaWNrIjpjYXNlICJvbkRvdWJsZUNsaWNrQ2FwdHVyZSI6Y2FzZSAib25Nb3VzZURvd24iOmNhc2UgIm9uTW91c2VEb3duQ2FwdHVyZSI6Y2FzZSAib25Nb3VzZU1vdmUiOmNhc2UgIm9uTW91c2VNb3ZlQ2FwdHVyZSI6Y2FzZSAib25Nb3VzZVVwIjpjYXNlICJvbk1vdXNlVXBDYXB0dXJlIjpjYXNlICJvbk1vdXNlRW50ZXIiOihkID0gIWQuZGlzYWJsZWQpIHx8IChhID0gYS50eXBlLCBkID0gISgiYnV0dG9uIiA9PT0gYSB8fCAiaW5wdXQiID09PSBhIHx8ICJzZWxlY3QiID09PSBhIHx8ICJ0ZXh0YXJlYSIgPT09IGEpKTthID0gIWQ7YnJlYWsgYTtkZWZhdWx0OmEgPSAhMTt9aWYgKGEpIHJldHVybiBudWxsO2lmIChjICYmICJmdW5jdGlvbiIgIT09CiAgICAgICAgICAgIHR5cGVvZiBjKSB0aHJvdyBFcnJvcihwKDIzMSwgYiwgdHlwZW9mIGMpKTtyZXR1cm4gYzt9dmFyIExiID0gITE7aWYgKGlhKSB0cnkge3ZhciBNYiA9IHt9O09iamVjdC5kZWZpbmVQcm9wZXJ0eShNYiwgInBhc3NpdmUiLCB7IGdldDogZnVuY3Rpb24gZ2V0KCkge0xiID0gITA7fSB9KTt3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigidGVzdCIsIE1iLCBNYik7d2luZG93LnJlbW92ZUV2ZW50TGlzdGVuZXIoInRlc3QiLCBNYiwgTWIpO30gY2F0Y2ggKGEpIHtMYiA9ICExO31mdW5jdGlvbiBOYihhLCBiLCBjLCBkLCBlLCBmLCBnLCBoLCBrKSB7dmFyIGwgPSBBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChhcmd1bWVudHMsIDMpO3RyeSB7Yi5hcHBseShjLCBsKTt9IGNhdGNoIChtKSB7dGhpcy5vbkVycm9yKG0pO319dmFyIE9iID0gITEsUGIgPSBudWxsLFFiID0gITEsUmIgPSBudWxsLFNiID0geyBvbkVycm9yOiBmdW5jdGlvbiBvbkVycm9yKGEpIHtPYiA9ICEwO1BiID0gYTt9IH07ZnVuY3Rpb24gVGIoYSwgYiwgYywgZCwgZSwgZiwgZywgaCwgaykge09iID0gITE7UGIgPSBudWxsO05iLmFwcGx5KFNiLCBhcmd1bWVudHMpO30KICAgICAgICAgIGZ1bmN0aW9uIFViKGEsIGIsIGMsIGQsIGUsIGYsIGcsIGgsIGspIHtUYi5hcHBseSh0aGlzLCBhcmd1bWVudHMpO2lmIChPYikge2lmIChPYikge3ZhciBsID0gUGI7T2IgPSAhMTtQYiA9IG51bGw7fSBlbHNlIHRocm93IEVycm9yKHAoMTk4KSk7UWIgfHwgKFFiID0gITAsIFJiID0gbCk7fX1mdW5jdGlvbiBWYihhKSB7dmFyIGIgPSBhLGMgPSBhO2lmIChhLmFsdGVybmF0ZSkgZm9yICg7IGIucmV0dXJuOykge2IgPSBiLnJldHVybjt9IGVsc2Uge2EgPSBiO2RvIHtiID0gYSwgMCAhPT0gKGIuZmxhZ3MgJiA0MDk4KSAmJiAoYyA9IGIucmV0dXJuKSwgYSA9IGIucmV0dXJuO30gd2hpbGUgKGEpO31yZXR1cm4gMyA9PT0gYi50YWcgPyBjIDogbnVsbDt9ZnVuY3Rpb24gV2IoYSkge2lmICgxMyA9PT0gYS50YWcpIHt2YXIgYiA9IGEubWVtb2l6ZWRTdGF0ZTtudWxsID09PSBiICYmIChhID0gYS5hbHRlcm5hdGUsIG51bGwgIT09IGEgJiYgKGIgPSBhLm1lbW9pemVkU3RhdGUpKTtpZiAobnVsbCAhPT0gYikgcmV0dXJuIGIuZGVoeWRyYXRlZDt9cmV0dXJuIG51bGw7fWZ1bmN0aW9uIFhiKGEpIHtpZiAoVmIoYSkgIT09IGEpIHRocm93IEVycm9yKHAoMTg4KSk7fQogICAgICAgICAgZnVuY3Rpb24gWWIoYSkge3ZhciBiID0gYS5hbHRlcm5hdGU7aWYgKCFiKSB7YiA9IFZiKGEpO2lmIChudWxsID09PSBiKSB0aHJvdyBFcnJvcihwKDE4OCkpO3JldHVybiBiICE9PSBhID8gbnVsbCA6IGE7fWZvciAodmFyIGMgPSBhLCBkID0gYjs7KSB7dmFyIGUgPSBjLnJldHVybjtpZiAobnVsbCA9PT0gZSkgYnJlYWs7dmFyIGYgPSBlLmFsdGVybmF0ZTtpZiAobnVsbCA9PT0gZikge2QgPSBlLnJldHVybjtpZiAobnVsbCAhPT0gZCkge2MgPSBkO2NvbnRpbnVlO31icmVhazt9aWYgKGUuY2hpbGQgPT09IGYuY2hpbGQpIHtmb3IgKGYgPSBlLmNoaWxkOyBmOykge2lmIChmID09PSBjKSByZXR1cm4gWGIoZSksIGE7aWYgKGYgPT09IGQpIHJldHVybiBYYihlKSwgYjtmID0gZi5zaWJsaW5nO310aHJvdyBFcnJvcihwKDE4OCkpO31pZiAoYy5yZXR1cm4gIT09IGQucmV0dXJuKSBjID0gZSwgZCA9IGY7ZWxzZSB7Zm9yICh2YXIgZyA9ICExLCBoID0gZS5jaGlsZDsgaDspIHtpZiAoaCA9PT0gYykge2cgPSAhMDtjID0gZTtkID0gZjticmVhazt9aWYgKGggPT09IGQpIHtnID0gITA7ZCA9IGU7YyA9IGY7YnJlYWs7fWggPSBoLnNpYmxpbmc7fWlmICghZykge2ZvciAoaCA9IGYuY2hpbGQ7IGg7KSB7aWYgKGggPT09CiAgICAgICAgICAgICAgICAgICAgYykge2cgPSAhMDtjID0gZjtkID0gZTticmVhazt9aWYgKGggPT09IGQpIHtnID0gITA7ZCA9IGY7YyA9IGU7YnJlYWs7fWggPSBoLnNpYmxpbmc7fWlmICghZykgdGhyb3cgRXJyb3IocCgxODkpKTt9fWlmIChjLmFsdGVybmF0ZSAhPT0gZCkgdGhyb3cgRXJyb3IocCgxOTApKTt9aWYgKDMgIT09IGMudGFnKSB0aHJvdyBFcnJvcihwKDE4OCkpO3JldHVybiBjLnN0YXRlTm9kZS5jdXJyZW50ID09PSBjID8gYSA6IGI7fWZ1bmN0aW9uIFpiKGEpIHthID0gWWIoYSk7cmV0dXJuIG51bGwgIT09IGEgPyAkYihhKSA6IG51bGw7fWZ1bmN0aW9uICRiKGEpIHtpZiAoNSA9PT0gYS50YWcgfHwgNiA9PT0gYS50YWcpIHJldHVybiBhO2ZvciAoYSA9IGEuY2hpbGQ7IG51bGwgIT09IGE7KSB7dmFyIGIgPSAkYihhKTtpZiAobnVsbCAhPT0gYikgcmV0dXJuIGI7YSA9IGEuc2libGluZzt9cmV0dXJuIG51bGw7fQogICAgICAgICAgdmFyIGFjID0gY2EudW5zdGFibGVfc2NoZWR1bGVDYWxsYmFjayxiYyA9IGNhLnVuc3RhYmxlX2NhbmNlbENhbGxiYWNrLGNjID0gY2EudW5zdGFibGVfc2hvdWxkWWllbGQsZGMgPSBjYS51bnN0YWJsZV9yZXF1ZXN0UGFpbnQsQiA9IGNhLnVuc3RhYmxlX25vdyxlYyA9IGNhLnVuc3RhYmxlX2dldEN1cnJlbnRQcmlvcml0eUxldmVsLGZjID0gY2EudW5zdGFibGVfSW1tZWRpYXRlUHJpb3JpdHksZ2MgPSBjYS51bnN0YWJsZV9Vc2VyQmxvY2tpbmdQcmlvcml0eSxoYyA9IGNhLnVuc3RhYmxlX05vcm1hbFByaW9yaXR5LGljID0gY2EudW5zdGFibGVfTG93UHJpb3JpdHksamMgPSBjYS51bnN0YWJsZV9JZGxlUHJpb3JpdHksa2MgPSBudWxsLGxjID0gbnVsbDtmdW5jdGlvbiBtYyhhKSB7aWYgKGxjICYmICJmdW5jdGlvbiIgPT09IHR5cGVvZiBsYy5vbkNvbW1pdEZpYmVyUm9vdCkgdHJ5IHtsYy5vbkNvbW1pdEZpYmVyUm9vdChrYywgYSwgdm9pZCAwLCAxMjggPT09IChhLmN1cnJlbnQuZmxhZ3MgJiAxMjgpKTt9IGNhdGNoIChiKSB7fX0KICAgICAgICAgIHZhciBvYyA9IE1hdGguY2x6MzIgPyBNYXRoLmNsejMyIDogbmMscGMgPSBNYXRoLmxvZyxxYyA9IE1hdGguTE4yO2Z1bmN0aW9uIG5jKGEpIHthID4+Pj0gMDtyZXR1cm4gMCA9PT0gYSA/IDMyIDogMzEgLSAocGMoYSkgLyBxYyB8IDApIHwgMDt9dmFyIHJjID0gNjQsc2MgPSA0MTk0MzA0OwogICAgICAgICAgZnVuY3Rpb24gdGMoYSkge3N3aXRjaCAoYSAmIC1hKSB7Y2FzZSAxOnJldHVybiAxO2Nhc2UgMjpyZXR1cm4gMjtjYXNlIDQ6cmV0dXJuIDQ7Y2FzZSA4OnJldHVybiA4O2Nhc2UgMTY6cmV0dXJuIDE2O2Nhc2UgMzI6cmV0dXJuIDMyO2Nhc2UgNjQ6Y2FzZSAxMjg6Y2FzZSAyNTY6Y2FzZSA1MTI6Y2FzZSAxMDI0OmNhc2UgMjA0ODpjYXNlIDQwOTY6Y2FzZSA4MTkyOmNhc2UgMTYzODQ6Y2FzZSAzMjc2ODpjYXNlIDY1NTM2OmNhc2UgMTMxMDcyOmNhc2UgMjYyMTQ0OmNhc2UgNTI0Mjg4OmNhc2UgMTA0ODU3NjpjYXNlIDIwOTcxNTI6cmV0dXJuIGEgJiA0MTk0MjQwO2Nhc2UgNDE5NDMwNDpjYXNlIDgzODg2MDg6Y2FzZSAxNjc3NzIxNjpjYXNlIDMzNTU0NDMyOmNhc2UgNjcxMDg4NjQ6cmV0dXJuIGEgJiAxMzAwMjM0MjQ7Y2FzZSAxMzQyMTc3Mjg6cmV0dXJuIDEzNDIxNzcyODtjYXNlIDI2ODQzNTQ1NjpyZXR1cm4gMjY4NDM1NDU2O2Nhc2UgNTM2ODcwOTEyOnJldHVybiA1MzY4NzA5MTI7Y2FzZSAxMDczNzQxODI0OnJldHVybiAxMDczNzQxODI0OwogICAgICAgICAgICAgIGRlZmF1bHQ6cmV0dXJuIGE7fX1mdW5jdGlvbiB1YyhhLCBiKSB7dmFyIGMgPSBhLnBlbmRpbmdMYW5lcztpZiAoMCA9PT0gYykgcmV0dXJuIDA7dmFyIGQgPSAwLGUgPSBhLnN1c3BlbmRlZExhbmVzLGYgPSBhLnBpbmdlZExhbmVzLGcgPSBjICYgMjY4NDM1NDU1O2lmICgwICE9PSBnKSB7dmFyIGggPSBnICYgfmU7MCAhPT0gaCA/IGQgPSB0YyhoKSA6IChmICY9IGcsIDAgIT09IGYgJiYgKGQgPSB0YyhmKSkpO30gZWxzZSBnID0gYyAmIH5lLCAwICE9PSBnID8gZCA9IHRjKGcpIDogMCAhPT0gZiAmJiAoZCA9IHRjKGYpKTtpZiAoMCA9PT0gZCkgcmV0dXJuIDA7aWYgKDAgIT09IGIgJiYgYiAhPT0gZCAmJiAwID09PSAoYiAmIGUpICYmIChlID0gZCAmIC1kLCBmID0gYiAmIC1iLCBlID49IGYgfHwgMTYgPT09IGUgJiYgMCAhPT0gKGYgJiA0MTk0MjQwKSkpIHJldHVybiBiOzAgIT09IChkICYgNCkgJiYgKGQgfD0gYyAmIDE2KTtiID0gYS5lbnRhbmdsZWRMYW5lcztpZiAoMCAhPT0gYikgZm9yIChhID0gYS5lbnRhbmdsZW1lbnRzLCBiICY9IGQ7IDAgPCBiOykge2MgPSAzMSAtIG9jKGIpLCBlID0gMSA8PCBjLCBkIHw9IGFbY10sIGIgJj0gfmU7fXJldHVybiBkO30KICAgICAgICAgIGZ1bmN0aW9uIHZjKGEsIGIpIHtzd2l0Y2ggKGEpIHtjYXNlIDE6Y2FzZSAyOmNhc2UgNDpyZXR1cm4gYiArIDI1MDtjYXNlIDg6Y2FzZSAxNjpjYXNlIDMyOmNhc2UgNjQ6Y2FzZSAxMjg6Y2FzZSAyNTY6Y2FzZSA1MTI6Y2FzZSAxMDI0OmNhc2UgMjA0ODpjYXNlIDQwOTY6Y2FzZSA4MTkyOmNhc2UgMTYzODQ6Y2FzZSAzMjc2ODpjYXNlIDY1NTM2OmNhc2UgMTMxMDcyOmNhc2UgMjYyMTQ0OmNhc2UgNTI0Mjg4OmNhc2UgMTA0ODU3NjpjYXNlIDIwOTcxNTI6cmV0dXJuIGIgKyA1RTM7Y2FzZSA0MTk0MzA0OmNhc2UgODM4ODYwODpjYXNlIDE2Nzc3MjE2OmNhc2UgMzM1NTQ0MzI6Y2FzZSA2NzEwODg2NDpyZXR1cm4gLTE7Y2FzZSAxMzQyMTc3Mjg6Y2FzZSAyNjg0MzU0NTY6Y2FzZSA1MzY4NzA5MTI6Y2FzZSAxMDczNzQxODI0OnJldHVybiAtMTtkZWZhdWx0OnJldHVybiAtMTt9fQogICAgICAgICAgZnVuY3Rpb24gd2MoYSwgYikge2ZvciAodmFyIGMgPSBhLnN1c3BlbmRlZExhbmVzLCBkID0gYS5waW5nZWRMYW5lcywgZSA9IGEuZXhwaXJhdGlvblRpbWVzLCBmID0gYS5wZW5kaW5nTGFuZXM7IDAgPCBmOykge3ZhciBnID0gMzEgLSBvYyhmKSxoID0gMSA8PCBnLGsgPSBlW2ddO2lmICgtMSA9PT0gaykge2lmICgwID09PSAoaCAmIGMpIHx8IDAgIT09IChoICYgZCkpIGVbZ10gPSB2YyhoLCBiKTt9IGVsc2UgayA8PSBiICYmIChhLmV4cGlyZWRMYW5lcyB8PSBoKTtmICY9IH5oO319ZnVuY3Rpb24geGMoYSkge2EgPSBhLnBlbmRpbmdMYW5lcyAmIC0xMDczNzQxODI1O3JldHVybiAwICE9PSBhID8gYSA6IGEgJiAxMDczNzQxODI0ID8gMTA3Mzc0MTgyNCA6IDA7fWZ1bmN0aW9uIHljKCkge3ZhciBhID0gcmM7cmMgPDw9IDE7MCA9PT0gKHJjICYgNDE5NDI0MCkgJiYgKHJjID0gNjQpO3JldHVybiBhO31mdW5jdGlvbiB6YyhhKSB7Zm9yICh2YXIgYiA9IFtdLCBjID0gMDsgMzEgPiBjOyBjKyspIHtiLnB1c2goYSk7fXJldHVybiBiO30KICAgICAgICAgIGZ1bmN0aW9uIEFjKGEsIGIsIGMpIHthLnBlbmRpbmdMYW5lcyB8PSBiOzUzNjg3MDkxMiAhPT0gYiAmJiAoYS5zdXNwZW5kZWRMYW5lcyA9IDAsIGEucGluZ2VkTGFuZXMgPSAwKTthID0gYS5ldmVudFRpbWVzO2IgPSAzMSAtIG9jKGIpO2FbYl0gPSBjO31mdW5jdGlvbiBCYyhhLCBiKSB7dmFyIGMgPSBhLnBlbmRpbmdMYW5lcyAmIH5iO2EucGVuZGluZ0xhbmVzID0gYjthLnN1c3BlbmRlZExhbmVzID0gMDthLnBpbmdlZExhbmVzID0gMDthLmV4cGlyZWRMYW5lcyAmPSBiO2EubXV0YWJsZVJlYWRMYW5lcyAmPSBiO2EuZW50YW5nbGVkTGFuZXMgJj0gYjtiID0gYS5lbnRhbmdsZW1lbnRzO3ZhciBkID0gYS5ldmVudFRpbWVzO2ZvciAoYSA9IGEuZXhwaXJhdGlvblRpbWVzOyAwIDwgYzspIHt2YXIgZSA9IDMxIC0gb2MoYyksZiA9IDEgPDwgZTtiW2VdID0gMDtkW2VdID0gLTE7YVtlXSA9IC0xO2MgJj0gfmY7fX0KICAgICAgICAgIGZ1bmN0aW9uIENjKGEsIGIpIHt2YXIgYyA9IGEuZW50YW5nbGVkTGFuZXMgfD0gYjtmb3IgKGEgPSBhLmVudGFuZ2xlbWVudHM7IGM7KSB7dmFyIGQgPSAzMSAtIG9jKGMpLGUgPSAxIDw8IGQ7ZSAmIGIgfCBhW2RdICYgYiAmJiAoYVtkXSB8PSBiKTtjICY9IH5lO319dmFyIEMgPSAwO2Z1bmN0aW9uIERjKGEpIHthICY9IC1hO3JldHVybiAxIDwgYSA/IDQgPCBhID8gMCAhPT0gKGEgJiAyNjg0MzU0NTUpID8gMTYgOiA1MzY4NzA5MTIgOiA0IDogMTt9dmFyIEVjLEZjLEdjLEhjLEljLEpjID0gITEsS2MgPSBbXSxMYyA9IG51bGwsTWMgPSBudWxsLE5jID0gbnVsbCxPYyA9IG5ldyBNYXAoKSxQYyA9IG5ldyBNYXAoKSxRYyA9IFtdLFJjID0gIm1vdXNlZG93biBtb3VzZXVwIHRvdWNoY2FuY2VsIHRvdWNoZW5kIHRvdWNoc3RhcnQgYXV4Y2xpY2sgZGJsY2xpY2sgcG9pbnRlcmNhbmNlbCBwb2ludGVyZG93biBwb2ludGVydXAgZHJhZ2VuZCBkcmFnc3RhcnQgZHJvcCBjb21wb3NpdGlvbmVuZCBjb21wb3NpdGlvbnN0YXJ0IGtleWRvd24ga2V5cHJlc3Mga2V5dXAgaW5wdXQgdGV4dElucHV0IGNvcHkgY3V0IHBhc3RlIGNsaWNrIGNoYW5nZSBjb250ZXh0bWVudSByZXNldCBzdWJtaXQiLnNwbGl0KCIgIik7CiAgICAgICAgICBmdW5jdGlvbiBTYyhhLCBiKSB7c3dpdGNoIChhKSB7Y2FzZSAiZm9jdXNpbiI6Y2FzZSAiZm9jdXNvdXQiOkxjID0gbnVsbDticmVhaztjYXNlICJkcmFnZW50ZXIiOmNhc2UgImRyYWdsZWF2ZSI6TWMgPSBudWxsO2JyZWFrO2Nhc2UgIm1vdXNlb3ZlciI6Y2FzZSAibW91c2VvdXQiOk5jID0gbnVsbDticmVhaztjYXNlICJwb2ludGVyb3ZlciI6Y2FzZSAicG9pbnRlcm91dCI6T2MuZGVsZXRlKGIucG9pbnRlcklkKTticmVhaztjYXNlICJnb3Rwb2ludGVyY2FwdHVyZSI6Y2FzZSAibG9zdHBvaW50ZXJjYXB0dXJlIjpQYy5kZWxldGUoYi5wb2ludGVySWQpO319CiAgICAgICAgICBmdW5jdGlvbiBUYyhhLCBiLCBjLCBkLCBlLCBmKSB7aWYgKG51bGwgPT09IGEgfHwgYS5uYXRpdmVFdmVudCAhPT0gZikgcmV0dXJuIGEgPSB7IGJsb2NrZWRPbjogYiwgZG9tRXZlbnROYW1lOiBjLCBldmVudFN5c3RlbUZsYWdzOiBkLCBuYXRpdmVFdmVudDogZiwgdGFyZ2V0Q29udGFpbmVyczogW2VdIH0sIG51bGwgIT09IGIgJiYgKGIgPSBDYihiKSwgbnVsbCAhPT0gYiAmJiBGYyhiKSksIGE7YS5ldmVudFN5c3RlbUZsYWdzIHw9IGQ7YiA9IGEudGFyZ2V0Q29udGFpbmVycztudWxsICE9PSBlICYmIC0xID09PSBiLmluZGV4T2YoZSkgJiYgYi5wdXNoKGUpO3JldHVybiBhO30KICAgICAgICAgIGZ1bmN0aW9uIFVjKGEsIGIsIGMsIGQsIGUpIHtzd2l0Y2ggKGIpIHtjYXNlICJmb2N1c2luIjpyZXR1cm4gTGMgPSBUYyhMYywgYSwgYiwgYywgZCwgZSksICEwO2Nhc2UgImRyYWdlbnRlciI6cmV0dXJuIE1jID0gVGMoTWMsIGEsIGIsIGMsIGQsIGUpLCAhMDtjYXNlICJtb3VzZW92ZXIiOnJldHVybiBOYyA9IFRjKE5jLCBhLCBiLCBjLCBkLCBlKSwgITA7Y2FzZSAicG9pbnRlcm92ZXIiOnZhciBmID0gZS5wb2ludGVySWQ7T2Muc2V0KGYsIFRjKE9jLmdldChmKSB8fCBudWxsLCBhLCBiLCBjLCBkLCBlKSk7cmV0dXJuICEwO2Nhc2UgImdvdHBvaW50ZXJjYXB0dXJlIjpyZXR1cm4gZiA9IGUucG9pbnRlcklkLCBQYy5zZXQoZiwgVGMoUGMuZ2V0KGYpIHx8IG51bGwsIGEsIGIsIGMsIGQsIGUpKSwgITA7fXJldHVybiAhMTt9CiAgICAgICAgICBmdW5jdGlvbiBWYyhhKSB7dmFyIGIgPSBXYyhhLnRhcmdldCk7aWYgKG51bGwgIT09IGIpIHt2YXIgYyA9IFZiKGIpO2lmIChudWxsICE9PSBjKSBpZiAoYiA9IGMudGFnLCAxMyA9PT0gYikge2lmIChiID0gV2IoYyksIG51bGwgIT09IGIpIHthLmJsb2NrZWRPbiA9IGI7SWMoYS5wcmlvcml0eSwgZnVuY3Rpb24gKCkge0djKGMpO30pO3JldHVybjt9fSBlbHNlIGlmICgzID09PSBiICYmIGMuc3RhdGVOb2RlLmN1cnJlbnQubWVtb2l6ZWRTdGF0ZS5pc0RlaHlkcmF0ZWQpIHthLmJsb2NrZWRPbiA9IDMgPT09IGMudGFnID8gYy5zdGF0ZU5vZGUuY29udGFpbmVySW5mbyA6IG51bGw7cmV0dXJuO319YS5ibG9ja2VkT24gPSBudWxsO30KICAgICAgICAgIGZ1bmN0aW9uIFhjKGEpIHtpZiAobnVsbCAhPT0gYS5ibG9ja2VkT24pIHJldHVybiAhMTtmb3IgKHZhciBiID0gYS50YXJnZXRDb250YWluZXJzOyAwIDwgYi5sZW5ndGg7KSB7dmFyIGMgPSBZYyhhLmRvbUV2ZW50TmFtZSwgYS5ldmVudFN5c3RlbUZsYWdzLCBiWzBdLCBhLm5hdGl2ZUV2ZW50KTtpZiAobnVsbCA9PT0gYykge2MgPSBhLm5hdGl2ZUV2ZW50O3ZhciBkID0gbmV3IGMuY29uc3RydWN0b3IoYy50eXBlLCBjKTt3YiA9IGQ7Yy50YXJnZXQuZGlzcGF0Y2hFdmVudChkKTt3YiA9IG51bGw7fSBlbHNlIHJldHVybiBiID0gQ2IoYyksIG51bGwgIT09IGIgJiYgRmMoYiksIGEuYmxvY2tlZE9uID0gYywgITE7Yi5zaGlmdCgpO31yZXR1cm4gITA7fWZ1bmN0aW9uIFpjKGEsIGIsIGMpIHtYYyhhKSAmJiBjLmRlbGV0ZShiKTt9ZnVuY3Rpb24gJGMoKSB7SmMgPSAhMTtudWxsICE9PSBMYyAmJiBYYyhMYykgJiYgKExjID0gbnVsbCk7bnVsbCAhPT0gTWMgJiYgWGMoTWMpICYmIChNYyA9IG51bGwpO251bGwgIT09IE5jICYmIFhjKE5jKSAmJiAoTmMgPSBudWxsKTtPYy5mb3JFYWNoKFpjKTtQYy5mb3JFYWNoKFpjKTt9CiAgICAgICAgICBmdW5jdGlvbiBhZChhLCBiKSB7YS5ibG9ja2VkT24gPT09IGIgJiYgKGEuYmxvY2tlZE9uID0gbnVsbCwgSmMgfHwgKEpjID0gITAsIGNhLnVuc3RhYmxlX3NjaGVkdWxlQ2FsbGJhY2soY2EudW5zdGFibGVfTm9ybWFsUHJpb3JpdHksICRjKSkpO30KICAgICAgICAgIGZ1bmN0aW9uIGJkKGEpIHtmdW5jdGlvbiBiKGIpIHtyZXR1cm4gYWQoYiwgYSk7fWlmICgwIDwgS2MubGVuZ3RoKSB7YWQoS2NbMF0sIGEpO2ZvciAodmFyIGMgPSAxOyBjIDwgS2MubGVuZ3RoOyBjKyspIHt2YXIgZCA9IEtjW2NdO2QuYmxvY2tlZE9uID09PSBhICYmIChkLmJsb2NrZWRPbiA9IG51bGwpO319bnVsbCAhPT0gTGMgJiYgYWQoTGMsIGEpO251bGwgIT09IE1jICYmIGFkKE1jLCBhKTtudWxsICE9PSBOYyAmJiBhZChOYywgYSk7T2MuZm9yRWFjaChiKTtQYy5mb3JFYWNoKGIpO2ZvciAoYyA9IDA7IGMgPCBRYy5sZW5ndGg7IGMrKykge2QgPSBRY1tjXSwgZC5ibG9ja2VkT24gPT09IGEgJiYgKGQuYmxvY2tlZE9uID0gbnVsbCk7fWZvciAoOyAwIDwgUWMubGVuZ3RoICYmIChjID0gUWNbMF0sIG51bGwgPT09IGMuYmxvY2tlZE9uKTspIHtWYyhjKSwgbnVsbCA9PT0gYy5ibG9ja2VkT24gJiYgUWMuc2hpZnQoKTt9fXZhciBjZCA9IHVhLlJlYWN0Q3VycmVudEJhdGNoQ29uZmlnLGRkID0gITA7CiAgICAgICAgICBmdW5jdGlvbiBlZChhLCBiLCBjLCBkKSB7dmFyIGUgPSBDLGYgPSBjZC50cmFuc2l0aW9uO2NkLnRyYW5zaXRpb24gPSBudWxsO3RyeSB7QyA9IDEsIGZkKGEsIGIsIGMsIGQpO30gZmluYWxseSB7QyA9IGUsIGNkLnRyYW5zaXRpb24gPSBmO319ZnVuY3Rpb24gZ2QoYSwgYiwgYywgZCkge3ZhciBlID0gQyxmID0gY2QudHJhbnNpdGlvbjtjZC50cmFuc2l0aW9uID0gbnVsbDt0cnkge0MgPSA0LCBmZChhLCBiLCBjLCBkKTt9IGZpbmFsbHkge0MgPSBlLCBjZC50cmFuc2l0aW9uID0gZjt9fQogICAgICAgICAgZnVuY3Rpb24gZmQoYSwgYiwgYywgZCkge2lmIChkZCkge3ZhciBlID0gWWMoYSwgYiwgYywgZCk7aWYgKG51bGwgPT09IGUpIGhkKGEsIGIsIGQsIGlkLCBjKSwgU2MoYSwgZCk7ZWxzZSBpZiAoVWMoZSwgYSwgYiwgYywgZCkpIGQuc3RvcFByb3BhZ2F0aW9uKCk7ZWxzZSBpZiAoU2MoYSwgZCksIGIgJiA0ICYmIC0xIDwgUmMuaW5kZXhPZihhKSkge2ZvciAoOyBudWxsICE9PSBlOykge3ZhciBmID0gQ2IoZSk7bnVsbCAhPT0gZiAmJiBFYyhmKTtmID0gWWMoYSwgYiwgYywgZCk7bnVsbCA9PT0gZiAmJiBoZChhLCBiLCBkLCBpZCwgYyk7aWYgKGYgPT09IGUpIGJyZWFrO2UgPSBmO31udWxsICE9PSBlICYmIGQuc3RvcFByb3BhZ2F0aW9uKCk7fSBlbHNlIGhkKGEsIGIsIGQsIG51bGwsIGMpO319dmFyIGlkID0gbnVsbDsKICAgICAgICAgIGZ1bmN0aW9uIFljKGEsIGIsIGMsIGQpIHtpZCA9IG51bGw7YSA9IHhiKGQpO2EgPSBXYyhhKTtpZiAobnVsbCAhPT0gYSkgaWYgKGIgPSBWYihhKSwgbnVsbCA9PT0gYikgYSA9IG51bGw7ZWxzZSBpZiAoYyA9IGIudGFnLCAxMyA9PT0gYykge2EgPSBXYihiKTtpZiAobnVsbCAhPT0gYSkgcmV0dXJuIGE7YSA9IG51bGw7fSBlbHNlIGlmICgzID09PSBjKSB7aWYgKGIuc3RhdGVOb2RlLmN1cnJlbnQubWVtb2l6ZWRTdGF0ZS5pc0RlaHlkcmF0ZWQpIHJldHVybiAzID09PSBiLnRhZyA/IGIuc3RhdGVOb2RlLmNvbnRhaW5lckluZm8gOiBudWxsO2EgPSBudWxsO30gZWxzZSBiICE9PSBhICYmIChhID0gbnVsbCk7aWQgPSBhO3JldHVybiBudWxsO30KICAgICAgICAgIGZ1bmN0aW9uIGpkKGEpIHtzd2l0Y2ggKGEpIHtjYXNlICJjYW5jZWwiOmNhc2UgImNsaWNrIjpjYXNlICJjbG9zZSI6Y2FzZSAiY29udGV4dG1lbnUiOmNhc2UgImNvcHkiOmNhc2UgImN1dCI6Y2FzZSAiYXV4Y2xpY2siOmNhc2UgImRibGNsaWNrIjpjYXNlICJkcmFnZW5kIjpjYXNlICJkcmFnc3RhcnQiOmNhc2UgImRyb3AiOmNhc2UgImZvY3VzaW4iOmNhc2UgImZvY3Vzb3V0IjpjYXNlICJpbnB1dCI6Y2FzZSAiaW52YWxpZCI6Y2FzZSAia2V5ZG93biI6Y2FzZSAia2V5cHJlc3MiOmNhc2UgImtleXVwIjpjYXNlICJtb3VzZWRvd24iOmNhc2UgIm1vdXNldXAiOmNhc2UgInBhc3RlIjpjYXNlICJwYXVzZSI6Y2FzZSAicGxheSI6Y2FzZSAicG9pbnRlcmNhbmNlbCI6Y2FzZSAicG9pbnRlcmRvd24iOmNhc2UgInBvaW50ZXJ1cCI6Y2FzZSAicmF0ZWNoYW5nZSI6Y2FzZSAicmVzZXQiOmNhc2UgInJlc2l6ZSI6Y2FzZSAic2Vla2VkIjpjYXNlICJzdWJtaXQiOmNhc2UgInRvdWNoY2FuY2VsIjpjYXNlICJ0b3VjaGVuZCI6Y2FzZSAidG91Y2hzdGFydCI6Y2FzZSAidm9sdW1lY2hhbmdlIjpjYXNlICJjaGFuZ2UiOmNhc2UgInNlbGVjdGlvbmNoYW5nZSI6Y2FzZSAidGV4dElucHV0IjpjYXNlICJjb21wb3NpdGlvbnN0YXJ0IjpjYXNlICJjb21wb3NpdGlvbmVuZCI6Y2FzZSAiY29tcG9zaXRpb251cGRhdGUiOmNhc2UgImJlZm9yZWJsdXIiOmNhc2UgImFmdGVyYmx1ciI6Y2FzZSAiYmVmb3JlaW5wdXQiOmNhc2UgImJsdXIiOmNhc2UgImZ1bGxzY3JlZW5jaGFuZ2UiOmNhc2UgImZvY3VzIjpjYXNlICJoYXNoY2hhbmdlIjpjYXNlICJwb3BzdGF0ZSI6Y2FzZSAic2VsZWN0IjpjYXNlICJzZWxlY3RzdGFydCI6cmV0dXJuIDE7Y2FzZSAiZHJhZyI6Y2FzZSAiZHJhZ2VudGVyIjpjYXNlICJkcmFnZXhpdCI6Y2FzZSAiZHJhZ2xlYXZlIjpjYXNlICJkcmFnb3ZlciI6Y2FzZSAibW91c2Vtb3ZlIjpjYXNlICJtb3VzZW91dCI6Y2FzZSAibW91c2VvdmVyIjpjYXNlICJwb2ludGVybW92ZSI6Y2FzZSAicG9pbnRlcm91dCI6Y2FzZSAicG9pbnRlcm92ZXIiOmNhc2UgInNjcm9sbCI6Y2FzZSAidG9nZ2xlIjpjYXNlICJ0b3VjaG1vdmUiOmNhc2UgIndoZWVsIjpjYXNlICJtb3VzZWVudGVyIjpjYXNlICJtb3VzZWxlYXZlIjpjYXNlICJwb2ludGVyZW50ZXIiOmNhc2UgInBvaW50ZXJsZWF2ZSI6cmV0dXJuIDQ7CiAgICAgICAgICAgICAgY2FzZSAibWVzc2FnZSI6c3dpdGNoIChlYygpKSB7Y2FzZSBmYzpyZXR1cm4gMTtjYXNlIGdjOnJldHVybiA0O2Nhc2UgaGM6Y2FzZSBpYzpyZXR1cm4gMTY7Y2FzZSBqYzpyZXR1cm4gNTM2ODcwOTEyO2RlZmF1bHQ6cmV0dXJuIDE2O31kZWZhdWx0OnJldHVybiAxNjt9fXZhciBrZCA9IG51bGwsbGQgPSBudWxsLG1kID0gbnVsbDtmdW5jdGlvbiBuZCgpIHtpZiAobWQpIHJldHVybiBtZDt2YXIgYSxiID0gbGQsYyA9IGIubGVuZ3RoLGQsZSA9ICJ2YWx1ZSIgaW4ga2QgPyBrZC52YWx1ZSA6IGtkLnRleHRDb250ZW50LGYgPSBlLmxlbmd0aDtmb3IgKGEgPSAwOyBhIDwgYyAmJiBiW2FdID09PSBlW2FdOyBhKyspIHs7fXZhciBnID0gYyAtIGE7Zm9yIChkID0gMTsgZCA8PSBnICYmIGJbYyAtIGRdID09PSBlW2YgLSBkXTsgZCsrKSB7O31yZXR1cm4gbWQgPSBlLnNsaWNlKGEsIDEgPCBkID8gMSAtIGQgOiB2b2lkIDApO30KICAgICAgICAgIGZ1bmN0aW9uIG9kKGEpIHt2YXIgYiA9IGEua2V5Q29kZTsiY2hhckNvZGUiIGluIGEgPyAoYSA9IGEuY2hhckNvZGUsIDAgPT09IGEgJiYgMTMgPT09IGIgJiYgKGEgPSAxMykpIDogYSA9IGI7MTAgPT09IGEgJiYgKGEgPSAxMyk7cmV0dXJuIDMyIDw9IGEgfHwgMTMgPT09IGEgPyBhIDogMDt9ZnVuY3Rpb24gcGQoKSB7cmV0dXJuICEwO31mdW5jdGlvbiBxZCgpIHtyZXR1cm4gITE7fQogICAgICAgICAgZnVuY3Rpb24gcmQoYSkge2Z1bmN0aW9uIGIoYiwgZCwgZSwgZiwgZykge3RoaXMuX3JlYWN0TmFtZSA9IGI7dGhpcy5fdGFyZ2V0SW5zdCA9IGU7dGhpcy50eXBlID0gZDt0aGlzLm5hdGl2ZUV2ZW50ID0gZjt0aGlzLnRhcmdldCA9IGc7dGhpcy5jdXJyZW50VGFyZ2V0ID0gbnVsbDtmb3IgKHZhciBjIGluIGEpIHthLmhhc093blByb3BlcnR5KGMpICYmIChiID0gYVtjXSwgdGhpc1tjXSA9IGIgPyBiKGYpIDogZltjXSk7fXRoaXMuaXNEZWZhdWx0UHJldmVudGVkID0gKG51bGwgIT0gZi5kZWZhdWx0UHJldmVudGVkID8gZi5kZWZhdWx0UHJldmVudGVkIDogITEgPT09IGYucmV0dXJuVmFsdWUpID8gcGQgOiBxZDt0aGlzLmlzUHJvcGFnYXRpb25TdG9wcGVkID0gcWQ7cmV0dXJuIHRoaXM7fUEoYi5wcm90b3R5cGUsIHsgcHJldmVudERlZmF1bHQ6IGZ1bmN0aW9uIHByZXZlbnREZWZhdWx0KCkge3RoaXMuZGVmYXVsdFByZXZlbnRlZCA9ICEwO3ZhciBhID0gdGhpcy5uYXRpdmVFdmVudDthICYmIChhLnByZXZlbnREZWZhdWx0ID8gYS5wcmV2ZW50RGVmYXVsdCgpIDogInVua25vd24iICE9PSB0eXBlb2YgYS5yZXR1cm5WYWx1ZSAmJiAoCiAgICAgICAgICAgICAgICBhLnJldHVyblZhbHVlID0gITEpLCB0aGlzLmlzRGVmYXVsdFByZXZlbnRlZCA9IHBkKTt9LCBzdG9wUHJvcGFnYXRpb246IGZ1bmN0aW9uIHN0b3BQcm9wYWdhdGlvbigpIHt2YXIgYSA9IHRoaXMubmF0aXZlRXZlbnQ7YSAmJiAoYS5zdG9wUHJvcGFnYXRpb24gPyBhLnN0b3BQcm9wYWdhdGlvbigpIDogInVua25vd24iICE9PSB0eXBlb2YgYS5jYW5jZWxCdWJibGUgJiYgKGEuY2FuY2VsQnViYmxlID0gITApLCB0aGlzLmlzUHJvcGFnYXRpb25TdG9wcGVkID0gcGQpO30sIHBlcnNpc3Q6IGZ1bmN0aW9uIHBlcnNpc3QoKSB7fSwgaXNQZXJzaXN0ZW50OiBwZCB9KTtyZXR1cm4gYjt9CiAgICAgICAgICB2YXIgc2QgPSB7IGV2ZW50UGhhc2U6IDAsIGJ1YmJsZXM6IDAsIGNhbmNlbGFibGU6IDAsIHRpbWVTdGFtcDogZnVuY3Rpb24gdGltZVN0YW1wKGEpIHtyZXR1cm4gYS50aW1lU3RhbXAgfHwgRGF0ZS5ub3coKTt9LCBkZWZhdWx0UHJldmVudGVkOiAwLCBpc1RydXN0ZWQ6IDAgfSx0ZCA9IHJkKHNkKSx1ZCA9IEEoe30sIHNkLCB7IHZpZXc6IDAsIGRldGFpbDogMCB9KSx2ZCA9IHJkKHVkKSx3ZCx4ZCx5ZCxBZCA9IEEoe30sIHVkLCB7IHNjcmVlblg6IDAsIHNjcmVlblk6IDAsIGNsaWVudFg6IDAsIGNsaWVudFk6IDAsIHBhZ2VYOiAwLCBwYWdlWTogMCwgY3RybEtleTogMCwgc2hpZnRLZXk6IDAsIGFsdEtleTogMCwgbWV0YUtleTogMCwgZ2V0TW9kaWZpZXJTdGF0ZTogemQsIGJ1dHRvbjogMCwgYnV0dG9uczogMCwgcmVsYXRlZFRhcmdldDogZnVuY3Rpb24gcmVsYXRlZFRhcmdldChhKSB7cmV0dXJuIHZvaWQgMCA9PT0gYS5yZWxhdGVkVGFyZ2V0ID8gYS5mcm9tRWxlbWVudCA9PT0gYS5zcmNFbGVtZW50ID8gYS50b0VsZW1lbnQgOiBhLmZyb21FbGVtZW50IDogYS5yZWxhdGVkVGFyZ2V0O30sIG1vdmVtZW50WDogZnVuY3Rpb24gbW92ZW1lbnRYKGEpIHtpZiAoIm1vdmVtZW50WCIgaW4KICAgICAgICAgICAgICAgIGEpIHJldHVybiBhLm1vdmVtZW50WDthICE9PSB5ZCAmJiAoeWQgJiYgIm1vdXNlbW92ZSIgPT09IGEudHlwZSA/ICh3ZCA9IGEuc2NyZWVuWCAtIHlkLnNjcmVlblgsIHhkID0gYS5zY3JlZW5ZIC0geWQuc2NyZWVuWSkgOiB4ZCA9IHdkID0gMCwgeWQgPSBhKTtyZXR1cm4gd2Q7fSwgbW92ZW1lbnRZOiBmdW5jdGlvbiBtb3ZlbWVudFkoYSkge3JldHVybiAibW92ZW1lbnRZIiBpbiBhID8gYS5tb3ZlbWVudFkgOiB4ZDt9IH0pLEJkID0gcmQoQWQpLENkID0gQSh7fSwgQWQsIHsgZGF0YVRyYW5zZmVyOiAwIH0pLERkID0gcmQoQ2QpLEVkID0gQSh7fSwgdWQsIHsgcmVsYXRlZFRhcmdldDogMCB9KSxGZCA9IHJkKEVkKSxHZCA9IEEoe30sIHNkLCB7IGFuaW1hdGlvbk5hbWU6IDAsIGVsYXBzZWRUaW1lOiAwLCBwc2V1ZG9FbGVtZW50OiAwIH0pLEhkID0gcmQoR2QpLElkID0gQSh7fSwgc2QsIHsgY2xpcGJvYXJkRGF0YTogZnVuY3Rpb24gY2xpcGJvYXJkRGF0YShhKSB7cmV0dXJuICJjbGlwYm9hcmREYXRhIiBpbiBhID8gYS5jbGlwYm9hcmREYXRhIDogd2luZG93LmNsaXBib2FyZERhdGE7fSB9KSxKZCA9IHJkKElkKSxLZCA9IEEoe30sIHNkLCB7IGRhdGE6IDAgfSksTGQgPSByZChLZCksTWQgPSB7IEVzYzogIkVzY2FwZSIsCiAgICAgICAgICAgICAgU3BhY2ViYXI6ICIgIiwgTGVmdDogIkFycm93TGVmdCIsIFVwOiAiQXJyb3dVcCIsIFJpZ2h0OiAiQXJyb3dSaWdodCIsIERvd246ICJBcnJvd0Rvd24iLCBEZWw6ICJEZWxldGUiLCBXaW46ICJPUyIsIE1lbnU6ICJDb250ZXh0TWVudSIsIEFwcHM6ICJDb250ZXh0TWVudSIsIFNjcm9sbDogIlNjcm9sbExvY2siLCBNb3pQcmludGFibGVLZXk6ICJVbmlkZW50aWZpZWQiIH0sTmQgPSB7IDg6ICJCYWNrc3BhY2UiLCA5OiAiVGFiIiwgMTI6ICJDbGVhciIsIDEzOiAiRW50ZXIiLCAxNjogIlNoaWZ0IiwgMTc6ICJDb250cm9sIiwgMTg6ICJBbHQiLCAxOTogIlBhdXNlIiwgMjA6ICJDYXBzTG9jayIsIDI3OiAiRXNjYXBlIiwgMzI6ICIgIiwgMzM6ICJQYWdlVXAiLCAzNDogIlBhZ2VEb3duIiwgMzU6ICJFbmQiLCAzNjogIkhvbWUiLCAzNzogIkFycm93TGVmdCIsIDM4OiAiQXJyb3dVcCIsIDM5OiAiQXJyb3dSaWdodCIsIDQwOiAiQXJyb3dEb3duIiwgNDU6ICJJbnNlcnQiLCA0NjogIkRlbGV0ZSIsIDExMjogIkYxIiwgMTEzOiAiRjIiLCAxMTQ6ICJGMyIsIDExNTogIkY0IiwgMTE2OiAiRjUiLCAxMTc6ICJGNiIsIDExODogIkY3IiwKICAgICAgICAgICAgICAxMTk6ICJGOCIsIDEyMDogIkY5IiwgMTIxOiAiRjEwIiwgMTIyOiAiRjExIiwgMTIzOiAiRjEyIiwgMTQ0OiAiTnVtTG9jayIsIDE0NTogIlNjcm9sbExvY2siLCAyMjQ6ICJNZXRhIiB9LE9kID0geyBBbHQ6ICJhbHRLZXkiLCBDb250cm9sOiAiY3RybEtleSIsIE1ldGE6ICJtZXRhS2V5IiwgU2hpZnQ6ICJzaGlmdEtleSIgfTtmdW5jdGlvbiBQZChhKSB7dmFyIGIgPSB0aGlzLm5hdGl2ZUV2ZW50O3JldHVybiBiLmdldE1vZGlmaWVyU3RhdGUgPyBiLmdldE1vZGlmaWVyU3RhdGUoYSkgOiAoYSA9IE9kW2FdKSA/ICEhYlthXSA6ICExO31mdW5jdGlvbiB6ZCgpIHtyZXR1cm4gUGQ7fQogICAgICAgICAgdmFyIFFkID0gQSh7fSwgdWQsIHsga2V5OiBmdW5jdGlvbiBrZXkoYSkge2lmIChhLmtleSkge3ZhciBiID0gTWRbYS5rZXldIHx8IGEua2V5O2lmICgiVW5pZGVudGlmaWVkIiAhPT0gYikgcmV0dXJuIGI7fXJldHVybiAia2V5cHJlc3MiID09PSBhLnR5cGUgPyAoYSA9IG9kKGEpLCAxMyA9PT0gYSA/ICJFbnRlciIgOiBTdHJpbmcuZnJvbUNoYXJDb2RlKGEpKSA6ICJrZXlkb3duIiA9PT0gYS50eXBlIHx8ICJrZXl1cCIgPT09IGEudHlwZSA/IE5kW2Eua2V5Q29kZV0gfHwgIlVuaWRlbnRpZmllZCIgOiAiIjt9LCBjb2RlOiAwLCBsb2NhdGlvbjogMCwgY3RybEtleTogMCwgc2hpZnRLZXk6IDAsIGFsdEtleTogMCwgbWV0YUtleTogMCwgcmVwZWF0OiAwLCBsb2NhbGU6IDAsIGdldE1vZGlmaWVyU3RhdGU6IHpkLCBjaGFyQ29kZTogZnVuY3Rpb24gY2hhckNvZGUoYSkge3JldHVybiAia2V5cHJlc3MiID09PSBhLnR5cGUgPyBvZChhKSA6IDA7fSwga2V5Q29kZTogZnVuY3Rpb24ga2V5Q29kZShhKSB7cmV0dXJuICJrZXlkb3duIiA9PT0gYS50eXBlIHx8ICJrZXl1cCIgPT09IGEudHlwZSA/IGEua2V5Q29kZSA6IDA7fSwgd2hpY2g6IGZ1bmN0aW9uIHdoaWNoKGEpIHtyZXR1cm4gImtleXByZXNzIiA9PT0KICAgICAgICAgICAgICAgIGEudHlwZSA/IG9kKGEpIDogImtleWRvd24iID09PSBhLnR5cGUgfHwgImtleXVwIiA9PT0gYS50eXBlID8gYS5rZXlDb2RlIDogMDt9IH0pLFJkID0gcmQoUWQpLFNkID0gQSh7fSwgQWQsIHsgcG9pbnRlcklkOiAwLCB3aWR0aDogMCwgaGVpZ2h0OiAwLCBwcmVzc3VyZTogMCwgdGFuZ2VudGlhbFByZXNzdXJlOiAwLCB0aWx0WDogMCwgdGlsdFk6IDAsIHR3aXN0OiAwLCBwb2ludGVyVHlwZTogMCwgaXNQcmltYXJ5OiAwIH0pLFRkID0gcmQoU2QpLFVkID0gQSh7fSwgdWQsIHsgdG91Y2hlczogMCwgdGFyZ2V0VG91Y2hlczogMCwgY2hhbmdlZFRvdWNoZXM6IDAsIGFsdEtleTogMCwgbWV0YUtleTogMCwgY3RybEtleTogMCwgc2hpZnRLZXk6IDAsIGdldE1vZGlmaWVyU3RhdGU6IHpkIH0pLFZkID0gcmQoVWQpLFdkID0gQSh7fSwgc2QsIHsgcHJvcGVydHlOYW1lOiAwLCBlbGFwc2VkVGltZTogMCwgcHNldWRvRWxlbWVudDogMCB9KSxYZCA9IHJkKFdkKSxZZCA9IEEoe30sIEFkLCB7IGRlbHRhWDogZnVuY3Rpb24gZGVsdGFYKGEpIHtyZXR1cm4gImRlbHRhWCIgaW4gYSA/IGEuZGVsdGFYIDogIndoZWVsRGVsdGFYIiBpbiBhID8gLWEud2hlZWxEZWx0YVggOiAwO30sCiAgICAgICAgICAgICAgZGVsdGFZOiBmdW5jdGlvbiBkZWx0YVkoYSkge3JldHVybiAiZGVsdGFZIiBpbiBhID8gYS5kZWx0YVkgOiAid2hlZWxEZWx0YVkiIGluIGEgPyAtYS53aGVlbERlbHRhWSA6ICJ3aGVlbERlbHRhIiBpbiBhID8gLWEud2hlZWxEZWx0YSA6IDA7fSwgZGVsdGFaOiAwLCBkZWx0YU1vZGU6IDAgfSksWmQgPSByZChZZCksJGQgPSBbOSwgMTMsIDI3LCAzMl0sYWUgPSBpYSAmJiAiQ29tcG9zaXRpb25FdmVudCIgaW4gd2luZG93LGJlID0gbnVsbDtpYSAmJiAiZG9jdW1lbnRNb2RlIiBpbiBkb2N1bWVudCAmJiAoYmUgPSBkb2N1bWVudC5kb2N1bWVudE1vZGUpO3ZhciBjZSA9IGlhICYmICJUZXh0RXZlbnQiIGluIHdpbmRvdyAmJiAhYmUsZGUgPSBpYSAmJiAoIWFlIHx8IGJlICYmIDggPCBiZSAmJiAxMSA+PSBiZSksZWUgPSBTdHJpbmcuZnJvbUNoYXJDb2RlKDMyKSxmZSA9ICExOwogICAgICAgICAgZnVuY3Rpb24gZ2UoYSwgYikge3N3aXRjaCAoYSkge2Nhc2UgImtleXVwIjpyZXR1cm4gLTEgIT09ICRkLmluZGV4T2YoYi5rZXlDb2RlKTtjYXNlICJrZXlkb3duIjpyZXR1cm4gMjI5ICE9PSBiLmtleUNvZGU7Y2FzZSAia2V5cHJlc3MiOmNhc2UgIm1vdXNlZG93biI6Y2FzZSAiZm9jdXNvdXQiOnJldHVybiAhMDtkZWZhdWx0OnJldHVybiAhMTt9fWZ1bmN0aW9uIGhlKGEpIHthID0gYS5kZXRhaWw7cmV0dXJuICJvYmplY3QiID09PSB0eXBlb2YgYSAmJiAiZGF0YSIgaW4gYSA/IGEuZGF0YSA6IG51bGw7fXZhciBpZSA9ICExO2Z1bmN0aW9uIGplKGEsIGIpIHtzd2l0Y2ggKGEpIHtjYXNlICJjb21wb3NpdGlvbmVuZCI6cmV0dXJuIGhlKGIpO2Nhc2UgImtleXByZXNzIjppZiAoMzIgIT09IGIud2hpY2gpIHJldHVybiBudWxsO2ZlID0gITA7cmV0dXJuIGVlO2Nhc2UgInRleHRJbnB1dCI6cmV0dXJuIGEgPSBiLmRhdGEsIGEgPT09IGVlICYmIGZlID8gbnVsbCA6IGE7ZGVmYXVsdDpyZXR1cm4gbnVsbDt9fQogICAgICAgICAgZnVuY3Rpb24ga2UoYSwgYikge2lmIChpZSkgcmV0dXJuICJjb21wb3NpdGlvbmVuZCIgPT09IGEgfHwgIWFlICYmIGdlKGEsIGIpID8gKGEgPSBuZCgpLCBtZCA9IGxkID0ga2QgPSBudWxsLCBpZSA9ICExLCBhKSA6IG51bGw7c3dpdGNoIChhKSB7Y2FzZSAicGFzdGUiOnJldHVybiBudWxsO2Nhc2UgImtleXByZXNzIjppZiAoIShiLmN0cmxLZXkgfHwgYi5hbHRLZXkgfHwgYi5tZXRhS2V5KSB8fCBiLmN0cmxLZXkgJiYgYi5hbHRLZXkpIHtpZiAoYi5jaGFyICYmIDEgPCBiLmNoYXIubGVuZ3RoKSByZXR1cm4gYi5jaGFyO2lmIChiLndoaWNoKSByZXR1cm4gU3RyaW5nLmZyb21DaGFyQ29kZShiLndoaWNoKTt9cmV0dXJuIG51bGw7Y2FzZSAiY29tcG9zaXRpb25lbmQiOnJldHVybiBkZSAmJiAia28iICE9PSBiLmxvY2FsZSA/IG51bGwgOiBiLmRhdGE7ZGVmYXVsdDpyZXR1cm4gbnVsbDt9fQogICAgICAgICAgdmFyIGxlID0geyBjb2xvcjogITAsIGRhdGU6ICEwLCBkYXRldGltZTogITAsICJkYXRldGltZS1sb2NhbCI6ICEwLCBlbWFpbDogITAsIG1vbnRoOiAhMCwgbnVtYmVyOiAhMCwgcGFzc3dvcmQ6ICEwLCByYW5nZTogITAsIHNlYXJjaDogITAsIHRlbDogITAsIHRleHQ6ICEwLCB0aW1lOiAhMCwgdXJsOiAhMCwgd2VlazogITAgfTtmdW5jdGlvbiBtZShhKSB7dmFyIGIgPSBhICYmIGEubm9kZU5hbWUgJiYgYS5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpO3JldHVybiAiaW5wdXQiID09PSBiID8gISFsZVthLnR5cGVdIDogInRleHRhcmVhIiA9PT0gYiA/ICEwIDogITE7fWZ1bmN0aW9uIG5lKGEsIGIsIGMsIGQpIHtFYihkKTtiID0gb2UoYiwgIm9uQ2hhbmdlIik7MCA8IGIubGVuZ3RoICYmIChjID0gbmV3IHRkKCJvbkNoYW5nZSIsICJjaGFuZ2UiLCBudWxsLCBjLCBkKSwgYS5wdXNoKHsgZXZlbnQ6IGMsIGxpc3RlbmVyczogYiB9KSk7fXZhciBwZSA9IG51bGwscWUgPSBudWxsO2Z1bmN0aW9uIHJlKGEpIHtzZShhLCAwKTt9ZnVuY3Rpb24gdGUoYSkge3ZhciBiID0gdWUoYSk7aWYgKFdhKGIpKSByZXR1cm4gYTt9CiAgICAgICAgICBmdW5jdGlvbiB2ZShhLCBiKSB7aWYgKCJjaGFuZ2UiID09PSBhKSByZXR1cm4gYjt9dmFyIHdlID0gITE7aWYgKGlhKSB7dmFyIHhlO2lmIChpYSkge3ZhciB5ZSA9ICgib25pbnB1dCIgaW4gZG9jdW1lbnQpO2lmICgheWUpIHt2YXIgemUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKTt6ZS5zZXRBdHRyaWJ1dGUoIm9uaW5wdXQiLCAicmV0dXJuOyIpO3llID0gImZ1bmN0aW9uIiA9PT0gdHlwZW9mIHplLm9uaW5wdXQ7fXhlID0geWU7fSBlbHNlIHhlID0gITE7d2UgPSB4ZSAmJiAoIWRvY3VtZW50LmRvY3VtZW50TW9kZSB8fCA5IDwgZG9jdW1lbnQuZG9jdW1lbnRNb2RlKTt9ZnVuY3Rpb24gQWUoKSB7cGUgJiYgKHBlLmRldGFjaEV2ZW50KCJvbnByb3BlcnR5Y2hhbmdlIiwgQmUpLCBxZSA9IHBlID0gbnVsbCk7fWZ1bmN0aW9uIEJlKGEpIHtpZiAoInZhbHVlIiA9PT0gYS5wcm9wZXJ0eU5hbWUgJiYgdGUocWUpKSB7dmFyIGIgPSBbXTtuZShiLCBxZSwgYSwgeGIoYSkpO0piKHJlLCBiKTt9fQogICAgICAgICAgZnVuY3Rpb24gQ2UoYSwgYiwgYykgeyJmb2N1c2luIiA9PT0gYSA/IChBZSgpLCBwZSA9IGIsIHFlID0gYywgcGUuYXR0YWNoRXZlbnQoIm9ucHJvcGVydHljaGFuZ2UiLCBCZSkpIDogImZvY3Vzb3V0IiA9PT0gYSAmJiBBZSgpO31mdW5jdGlvbiBEZShhKSB7aWYgKCJzZWxlY3Rpb25jaGFuZ2UiID09PSBhIHx8ICJrZXl1cCIgPT09IGEgfHwgImtleWRvd24iID09PSBhKSByZXR1cm4gdGUocWUpO31mdW5jdGlvbiBFZShhLCBiKSB7aWYgKCJjbGljayIgPT09IGEpIHJldHVybiB0ZShiKTt9ZnVuY3Rpb24gRmUoYSwgYikge2lmICgiaW5wdXQiID09PSBhIHx8ICJjaGFuZ2UiID09PSBhKSByZXR1cm4gdGUoYik7fWZ1bmN0aW9uIEdlKGEsIGIpIHtyZXR1cm4gYSA9PT0gYiAmJiAoMCAhPT0gYSB8fCAxIC8gYSA9PT0gMSAvIGIpIHx8IGEgIT09IGEgJiYgYiAhPT0gYjt9dmFyIEhlID0gImZ1bmN0aW9uIiA9PT0gdHlwZW9mIE9iamVjdC5pcyA/IE9iamVjdC5pcyA6IEdlOwogICAgICAgICAgZnVuY3Rpb24gSWUoYSwgYikge2lmIChIZShhLCBiKSkgcmV0dXJuICEwO2lmICgib2JqZWN0IiAhPT0gdHlwZW9mIGEgfHwgbnVsbCA9PT0gYSB8fCAib2JqZWN0IiAhPT0gdHlwZW9mIGIgfHwgbnVsbCA9PT0gYikgcmV0dXJuICExO3ZhciBjID0gT2JqZWN0LmtleXMoYSksZCA9IE9iamVjdC5rZXlzKGIpO2lmIChjLmxlbmd0aCAhPT0gZC5sZW5ndGgpIHJldHVybiAhMTtmb3IgKGQgPSAwOyBkIDwgYy5sZW5ndGg7IGQrKykge3ZhciBlID0gY1tkXTtpZiAoIWphLmNhbGwoYiwgZSkgfHwgIUhlKGFbZV0sIGJbZV0pKSByZXR1cm4gITE7fXJldHVybiAhMDt9ZnVuY3Rpb24gSmUoYSkge2ZvciAoOyBhICYmIGEuZmlyc3RDaGlsZDspIHthID0gYS5maXJzdENoaWxkO31yZXR1cm4gYTt9CiAgICAgICAgICBmdW5jdGlvbiBLZShhLCBiKSB7dmFyIGMgPSBKZShhKTthID0gMDtmb3IgKHZhciBkOyBjOykge2lmICgzID09PSBjLm5vZGVUeXBlKSB7ZCA9IGEgKyBjLnRleHRDb250ZW50Lmxlbmd0aDtpZiAoYSA8PSBiICYmIGQgPj0gYikgcmV0dXJuIHsgbm9kZTogYywgb2Zmc2V0OiBiIC0gYSB9O2EgPSBkO31hOiB7Zm9yICg7IGM7KSB7aWYgKGMubmV4dFNpYmxpbmcpIHtjID0gYy5uZXh0U2libGluZzticmVhayBhO31jID0gYy5wYXJlbnROb2RlO31jID0gdm9pZCAwO31jID0gSmUoYyk7fX1mdW5jdGlvbiBMZShhLCBiKSB7cmV0dXJuIGEgJiYgYiA/IGEgPT09IGIgPyAhMCA6IGEgJiYgMyA9PT0gYS5ub2RlVHlwZSA/ICExIDogYiAmJiAzID09PSBiLm5vZGVUeXBlID8gTGUoYSwgYi5wYXJlbnROb2RlKSA6ICJjb250YWlucyIgaW4gYSA/IGEuY29udGFpbnMoYikgOiBhLmNvbXBhcmVEb2N1bWVudFBvc2l0aW9uID8gISEoYS5jb21wYXJlRG9jdW1lbnRQb3NpdGlvbihiKSAmIDE2KSA6ICExIDogITE7fQogICAgICAgICAgZnVuY3Rpb24gTWUoKSB7Zm9yICh2YXIgYSA9IHdpbmRvdywgYiA9IFhhKCk7IGIgaW5zdGFuY2VvZiBhLkhUTUxJRnJhbWVFbGVtZW50Oykge3RyeSB7dmFyIGMgPSAic3RyaW5nIiA9PT0gdHlwZW9mIGIuY29udGVudFdpbmRvdy5sb2NhdGlvbi5ocmVmO30gY2F0Y2ggKGQpIHtjID0gITE7fWlmIChjKSBhID0gYi5jb250ZW50V2luZG93O2Vsc2UgYnJlYWs7YiA9IFhhKGEuZG9jdW1lbnQpO31yZXR1cm4gYjt9ZnVuY3Rpb24gTmUoYSkge3ZhciBiID0gYSAmJiBhLm5vZGVOYW1lICYmIGEubm9kZU5hbWUudG9Mb3dlckNhc2UoKTtyZXR1cm4gYiAmJiAoImlucHV0IiA9PT0gYiAmJiAoInRleHQiID09PSBhLnR5cGUgfHwgInNlYXJjaCIgPT09IGEudHlwZSB8fCAidGVsIiA9PT0gYS50eXBlIHx8ICJ1cmwiID09PSBhLnR5cGUgfHwgInBhc3N3b3JkIiA9PT0gYS50eXBlKSB8fCAidGV4dGFyZWEiID09PSBiIHx8ICJ0cnVlIiA9PT0gYS5jb250ZW50RWRpdGFibGUpO30KICAgICAgICAgIGZ1bmN0aW9uIE9lKGEpIHt2YXIgYiA9IE1lKCksYyA9IGEuZm9jdXNlZEVsZW0sZCA9IGEuc2VsZWN0aW9uUmFuZ2U7aWYgKGIgIT09IGMgJiYgYyAmJiBjLm93bmVyRG9jdW1lbnQgJiYgTGUoYy5vd25lckRvY3VtZW50LmRvY3VtZW50RWxlbWVudCwgYykpIHtpZiAobnVsbCAhPT0gZCAmJiBOZShjKSkgaWYgKGIgPSBkLnN0YXJ0LCBhID0gZC5lbmQsIHZvaWQgMCA9PT0gYSAmJiAoYSA9IGIpLCAic2VsZWN0aW9uU3RhcnQiIGluIGMpIGMuc2VsZWN0aW9uU3RhcnQgPSBiLCBjLnNlbGVjdGlvbkVuZCA9IE1hdGgubWluKGEsIGMudmFsdWUubGVuZ3RoKTtlbHNlIGlmIChhID0gKGIgPSBjLm93bmVyRG9jdW1lbnQgfHwgZG9jdW1lbnQpICYmIGIuZGVmYXVsdFZpZXcgfHwgd2luZG93LCBhLmdldFNlbGVjdGlvbikge2EgPSBhLmdldFNlbGVjdGlvbigpO3ZhciBlID0gYy50ZXh0Q29udGVudC5sZW5ndGgsZiA9IE1hdGgubWluKGQuc3RhcnQsIGUpO2QgPSB2b2lkIDAgPT09IGQuZW5kID8gZiA6IE1hdGgubWluKGQuZW5kLCBlKTshYS5leHRlbmQgJiYgZiA+IGQgJiYgKGUgPSBkLCBkID0gZiwgZiA9IGUpO2UgPSBLZShjLCBmKTt2YXIgZyA9IEtlKGMsCiAgICAgICAgICAgICAgICBkKTtlICYmIGcgJiYgKDEgIT09IGEucmFuZ2VDb3VudCB8fCBhLmFuY2hvck5vZGUgIT09IGUubm9kZSB8fCBhLmFuY2hvck9mZnNldCAhPT0gZS5vZmZzZXQgfHwgYS5mb2N1c05vZGUgIT09IGcubm9kZSB8fCBhLmZvY3VzT2Zmc2V0ICE9PSBnLm9mZnNldCkgJiYgKGIgPSBiLmNyZWF0ZVJhbmdlKCksIGIuc2V0U3RhcnQoZS5ub2RlLCBlLm9mZnNldCksIGEucmVtb3ZlQWxsUmFuZ2VzKCksIGYgPiBkID8gKGEuYWRkUmFuZ2UoYiksIGEuZXh0ZW5kKGcubm9kZSwgZy5vZmZzZXQpKSA6IChiLnNldEVuZChnLm5vZGUsIGcub2Zmc2V0KSwgYS5hZGRSYW5nZShiKSkpO31iID0gW107Zm9yIChhID0gYzsgYSA9IGEucGFyZW50Tm9kZTspIHsxID09PSBhLm5vZGVUeXBlICYmIGIucHVzaCh7IGVsZW1lbnQ6IGEsIGxlZnQ6IGEuc2Nyb2xsTGVmdCwgdG9wOiBhLnNjcm9sbFRvcCB9KTt9ImZ1bmN0aW9uIiA9PT0gdHlwZW9mIGMuZm9jdXMgJiYgYy5mb2N1cygpO2ZvciAoYyA9IDA7IGMgPCBiLmxlbmd0aDsgYysrKSB7YSA9IGJbY10sIGEuZWxlbWVudC5zY3JvbGxMZWZ0ID0gYS5sZWZ0LCBhLmVsZW1lbnQuc2Nyb2xsVG9wID0gYS50b3A7fX19CiAgICAgICAgICB2YXIgUGUgPSBpYSAmJiAiZG9jdW1lbnRNb2RlIiBpbiBkb2N1bWVudCAmJiAxMSA+PSBkb2N1bWVudC5kb2N1bWVudE1vZGUsUWUgPSBudWxsLFJlID0gbnVsbCxTZSA9IG51bGwsVGUgPSAhMTsKICAgICAgICAgIGZ1bmN0aW9uIFVlKGEsIGIsIGMpIHt2YXIgZCA9IGMud2luZG93ID09PSBjID8gYy5kb2N1bWVudCA6IDkgPT09IGMubm9kZVR5cGUgPyBjIDogYy5vd25lckRvY3VtZW50O1RlIHx8IG51bGwgPT0gUWUgfHwgUWUgIT09IFhhKGQpIHx8IChkID0gUWUsICJzZWxlY3Rpb25TdGFydCIgaW4gZCAmJiBOZShkKSA/IGQgPSB7IHN0YXJ0OiBkLnNlbGVjdGlvblN0YXJ0LCBlbmQ6IGQuc2VsZWN0aW9uRW5kIH0gOiAoZCA9IChkLm93bmVyRG9jdW1lbnQgJiYgZC5vd25lckRvY3VtZW50LmRlZmF1bHRWaWV3IHx8IHdpbmRvdykuZ2V0U2VsZWN0aW9uKCksIGQgPSB7IGFuY2hvck5vZGU6IGQuYW5jaG9yTm9kZSwgYW5jaG9yT2Zmc2V0OiBkLmFuY2hvck9mZnNldCwgZm9jdXNOb2RlOiBkLmZvY3VzTm9kZSwgZm9jdXNPZmZzZXQ6IGQuZm9jdXNPZmZzZXQgfSksIFNlICYmIEllKFNlLCBkKSB8fCAoU2UgPSBkLCBkID0gb2UoUmUsICJvblNlbGVjdCIpLCAwIDwgZC5sZW5ndGggJiYgKGIgPSBuZXcgdGQoIm9uU2VsZWN0IiwgInNlbGVjdCIsIG51bGwsIGIsIGMpLCBhLnB1c2goeyBldmVudDogYiwgbGlzdGVuZXJzOiBkIH0pLCBiLnRhcmdldCA9IFFlKSkpO30KICAgICAgICAgIGZ1bmN0aW9uIFZlKGEsIGIpIHt2YXIgYyA9IHt9O2NbYS50b0xvd2VyQ2FzZSgpXSA9IGIudG9Mb3dlckNhc2UoKTtjWyJXZWJraXQiICsgYV0gPSAid2Via2l0IiArIGI7Y1siTW96IiArIGFdID0gIm1veiIgKyBiO3JldHVybiBjO312YXIgV2UgPSB7IGFuaW1hdGlvbmVuZDogVmUoIkFuaW1hdGlvbiIsICJBbmltYXRpb25FbmQiKSwgYW5pbWF0aW9uaXRlcmF0aW9uOiBWZSgiQW5pbWF0aW9uIiwgIkFuaW1hdGlvbkl0ZXJhdGlvbiIpLCBhbmltYXRpb25zdGFydDogVmUoIkFuaW1hdGlvbiIsICJBbmltYXRpb25TdGFydCIpLCB0cmFuc2l0aW9uZW5kOiBWZSgiVHJhbnNpdGlvbiIsICJUcmFuc2l0aW9uRW5kIikgfSxYZSA9IHt9LFllID0ge307CiAgICAgICAgICBpYSAmJiAoWWUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKS5zdHlsZSwgIkFuaW1hdGlvbkV2ZW50IiBpbiB3aW5kb3cgfHwgKGRlbGV0ZSBXZS5hbmltYXRpb25lbmQuYW5pbWF0aW9uLCBkZWxldGUgV2UuYW5pbWF0aW9uaXRlcmF0aW9uLmFuaW1hdGlvbiwgZGVsZXRlIFdlLmFuaW1hdGlvbnN0YXJ0LmFuaW1hdGlvbiksICJUcmFuc2l0aW9uRXZlbnQiIGluIHdpbmRvdyB8fCBkZWxldGUgV2UudHJhbnNpdGlvbmVuZC50cmFuc2l0aW9uKTtmdW5jdGlvbiBaZShhKSB7aWYgKFhlW2FdKSByZXR1cm4gWGVbYV07aWYgKCFXZVthXSkgcmV0dXJuIGE7dmFyIGIgPSBXZVthXSxjO2ZvciAoYyBpbiBiKSB7aWYgKGIuaGFzT3duUHJvcGVydHkoYykgJiYgYyBpbiBZZSkgcmV0dXJuIFhlW2FdID0gYltjXTt9cmV0dXJuIGE7fXZhciAkZSA9IFplKCJhbmltYXRpb25lbmQiKSxhZiA9IFplKCJhbmltYXRpb25pdGVyYXRpb24iKSxiZiA9IFplKCJhbmltYXRpb25zdGFydCIpLGNmID0gWmUoInRyYW5zaXRpb25lbmQiKSxkZiA9IG5ldyBNYXAoKSxlZiA9ICJhYm9ydCBhdXhDbGljayBjYW5jZWwgY2FuUGxheSBjYW5QbGF5VGhyb3VnaCBjbGljayBjbG9zZSBjb250ZXh0TWVudSBjb3B5IGN1dCBkcmFnIGRyYWdFbmQgZHJhZ0VudGVyIGRyYWdFeGl0IGRyYWdMZWF2ZSBkcmFnT3ZlciBkcmFnU3RhcnQgZHJvcCBkdXJhdGlvbkNoYW5nZSBlbXB0aWVkIGVuY3J5cHRlZCBlbmRlZCBlcnJvciBnb3RQb2ludGVyQ2FwdHVyZSBpbnB1dCBpbnZhbGlkIGtleURvd24ga2V5UHJlc3Mga2V5VXAgbG9hZCBsb2FkZWREYXRhIGxvYWRlZE1ldGFkYXRhIGxvYWRTdGFydCBsb3N0UG9pbnRlckNhcHR1cmUgbW91c2VEb3duIG1vdXNlTW92ZSBtb3VzZU91dCBtb3VzZU92ZXIgbW91c2VVcCBwYXN0ZSBwYXVzZSBwbGF5IHBsYXlpbmcgcG9pbnRlckNhbmNlbCBwb2ludGVyRG93biBwb2ludGVyTW92ZSBwb2ludGVyT3V0IHBvaW50ZXJPdmVyIHBvaW50ZXJVcCBwcm9ncmVzcyByYXRlQ2hhbmdlIHJlc2V0IHJlc2l6ZSBzZWVrZWQgc2Vla2luZyBzdGFsbGVkIHN1Ym1pdCBzdXNwZW5kIHRpbWVVcGRhdGUgdG91Y2hDYW5jZWwgdG91Y2hFbmQgdG91Y2hTdGFydCB2b2x1bWVDaGFuZ2Ugc2Nyb2xsIHRvZ2dsZSB0b3VjaE1vdmUgd2FpdGluZyB3aGVlbCIuc3BsaXQoIiAiKTsKICAgICAgICAgIGZ1bmN0aW9uIGZmKGEsIGIpIHtkZi5zZXQoYSwgYik7ZmEoYiwgW2FdKTt9Zm9yICh2YXIgZ2YgPSAwOyBnZiA8IGVmLmxlbmd0aDsgZ2YrKykge3ZhciBoZiA9IGVmW2dmXSxqZiA9IGhmLnRvTG93ZXJDYXNlKCksa2YgPSBoZlswXS50b1VwcGVyQ2FzZSgpICsgaGYuc2xpY2UoMSk7ZmYoamYsICJvbiIgKyBrZik7fWZmKCRlLCAib25BbmltYXRpb25FbmQiKTtmZihhZiwgIm9uQW5pbWF0aW9uSXRlcmF0aW9uIik7ZmYoYmYsICJvbkFuaW1hdGlvblN0YXJ0Iik7ZmYoImRibGNsaWNrIiwgIm9uRG91YmxlQ2xpY2siKTtmZigiZm9jdXNpbiIsICJvbkZvY3VzIik7ZmYoImZvY3Vzb3V0IiwgIm9uQmx1ciIpO2ZmKGNmLCAib25UcmFuc2l0aW9uRW5kIik7aGEoIm9uTW91c2VFbnRlciIsIFsibW91c2VvdXQiLCAibW91c2VvdmVyIl0pO2hhKCJvbk1vdXNlTGVhdmUiLCBbIm1vdXNlb3V0IiwgIm1vdXNlb3ZlciJdKTtoYSgib25Qb2ludGVyRW50ZXIiLCBbInBvaW50ZXJvdXQiLCAicG9pbnRlcm92ZXIiXSk7CiAgICAgICAgICBoYSgib25Qb2ludGVyTGVhdmUiLCBbInBvaW50ZXJvdXQiLCAicG9pbnRlcm92ZXIiXSk7ZmEoIm9uQ2hhbmdlIiwgImNoYW5nZSBjbGljayBmb2N1c2luIGZvY3Vzb3V0IGlucHV0IGtleWRvd24ga2V5dXAgc2VsZWN0aW9uY2hhbmdlIi5zcGxpdCgiICIpKTtmYSgib25TZWxlY3QiLCAiZm9jdXNvdXQgY29udGV4dG1lbnUgZHJhZ2VuZCBmb2N1c2luIGtleWRvd24ga2V5dXAgbW91c2Vkb3duIG1vdXNldXAgc2VsZWN0aW9uY2hhbmdlIi5zcGxpdCgiICIpKTtmYSgib25CZWZvcmVJbnB1dCIsIFsiY29tcG9zaXRpb25lbmQiLCAia2V5cHJlc3MiLCAidGV4dElucHV0IiwgInBhc3RlIl0pO2ZhKCJvbkNvbXBvc2l0aW9uRW5kIiwgImNvbXBvc2l0aW9uZW5kIGZvY3Vzb3V0IGtleWRvd24ga2V5cHJlc3Mga2V5dXAgbW91c2Vkb3duIi5zcGxpdCgiICIpKTtmYSgib25Db21wb3NpdGlvblN0YXJ0IiwgImNvbXBvc2l0aW9uc3RhcnQgZm9jdXNvdXQga2V5ZG93biBrZXlwcmVzcyBrZXl1cCBtb3VzZWRvd24iLnNwbGl0KCIgIikpOwogICAgICAgICAgZmEoIm9uQ29tcG9zaXRpb25VcGRhdGUiLCAiY29tcG9zaXRpb251cGRhdGUgZm9jdXNvdXQga2V5ZG93biBrZXlwcmVzcyBrZXl1cCBtb3VzZWRvd24iLnNwbGl0KCIgIikpO3ZhciBsZiA9ICJhYm9ydCBjYW5wbGF5IGNhbnBsYXl0aHJvdWdoIGR1cmF0aW9uY2hhbmdlIGVtcHRpZWQgZW5jcnlwdGVkIGVuZGVkIGVycm9yIGxvYWRlZGRhdGEgbG9hZGVkbWV0YWRhdGEgbG9hZHN0YXJ0IHBhdXNlIHBsYXkgcGxheWluZyBwcm9ncmVzcyByYXRlY2hhbmdlIHJlc2l6ZSBzZWVrZWQgc2Vla2luZyBzdGFsbGVkIHN1c3BlbmQgdGltZXVwZGF0ZSB2b2x1bWVjaGFuZ2Ugd2FpdGluZyIuc3BsaXQoIiAiKSxtZiA9IG5ldyBTZXQoImNhbmNlbCBjbG9zZSBpbnZhbGlkIGxvYWQgc2Nyb2xsIHRvZ2dsZSIuc3BsaXQoIiAiKS5jb25jYXQobGYpKTsKICAgICAgICAgIGZ1bmN0aW9uIG5mKGEsIGIsIGMpIHt2YXIgZCA9IGEudHlwZSB8fCAidW5rbm93bi1ldmVudCI7YS5jdXJyZW50VGFyZ2V0ID0gYztVYihkLCBiLCB2b2lkIDAsIGEpO2EuY3VycmVudFRhcmdldCA9IG51bGw7fQogICAgICAgICAgZnVuY3Rpb24gc2UoYSwgYikge2IgPSAwICE9PSAoYiAmIDQpO2ZvciAodmFyIGMgPSAwOyBjIDwgYS5sZW5ndGg7IGMrKykge3ZhciBkID0gYVtjXSxlID0gZC5ldmVudDtkID0gZC5saXN0ZW5lcnM7YToge3ZhciBmID0gdm9pZCAwO2lmIChiKSBmb3IgKHZhciBnID0gZC5sZW5ndGggLSAxOyAwIDw9IGc7IGctLSkge3ZhciBoID0gZFtnXSxrID0gaC5pbnN0YW5jZSxsID0gaC5jdXJyZW50VGFyZ2V0O2ggPSBoLmxpc3RlbmVyO2lmIChrICE9PSBmICYmIGUuaXNQcm9wYWdhdGlvblN0b3BwZWQoKSkgYnJlYWsgYTtuZihlLCBoLCBsKTtmID0gazt9IGVsc2UgZm9yIChnID0gMDsgZyA8IGQubGVuZ3RoOyBnKyspIHtoID0gZFtnXTtrID0gaC5pbnN0YW5jZTtsID0gaC5jdXJyZW50VGFyZ2V0O2ggPSBoLmxpc3RlbmVyO2lmIChrICE9PSBmICYmIGUuaXNQcm9wYWdhdGlvblN0b3BwZWQoKSkgYnJlYWsgYTtuZihlLCBoLCBsKTtmID0gazt9fX1pZiAoUWIpIHRocm93IGEgPSBSYiwgUWIgPSAhMSwgUmIgPSBudWxsLCBhO30KICAgICAgICAgIGZ1bmN0aW9uIEQoYSwgYikge3ZhciBjID0gYltvZl07dm9pZCAwID09PSBjICYmIChjID0gYltvZl0gPSBuZXcgU2V0KCkpO3ZhciBkID0gYSArICJfX2J1YmJsZSI7Yy5oYXMoZCkgfHwgKHBmKGIsIGEsIDIsICExKSwgYy5hZGQoZCkpO31mdW5jdGlvbiBxZihhLCBiLCBjKSB7dmFyIGQgPSAwO2IgJiYgKGQgfD0gNCk7cGYoYywgYSwgZCwgYik7fXZhciByZiA9ICJfcmVhY3RMaXN0ZW5pbmciICsgTWF0aC5yYW5kb20oKS50b1N0cmluZygzNikuc2xpY2UoMik7ZnVuY3Rpb24gc2YoYSkge2lmICghYVtyZl0pIHthW3JmXSA9ICEwO2RhLmZvckVhY2goZnVuY3Rpb24gKGIpIHsic2VsZWN0aW9uY2hhbmdlIiAhPT0gYiAmJiAobWYuaGFzKGIpIHx8IHFmKGIsICExLCBhKSwgcWYoYiwgITAsIGEpKTt9KTt2YXIgYiA9IDkgPT09IGEubm9kZVR5cGUgPyBhIDogYS5vd25lckRvY3VtZW50O251bGwgPT09IGIgfHwgYltyZl0gfHwgKGJbcmZdID0gITAsIHFmKCJzZWxlY3Rpb25jaGFuZ2UiLCAhMSwgYikpO319CiAgICAgICAgICBmdW5jdGlvbiBwZihhLCBiLCBjLCBkKSB7c3dpdGNoIChqZChiKSkge2Nhc2UgMTp2YXIgZSA9IGVkO2JyZWFrO2Nhc2UgNDplID0gZ2Q7YnJlYWs7ZGVmYXVsdDplID0gZmQ7fWMgPSBlLmJpbmQobnVsbCwgYiwgYywgYSk7ZSA9IHZvaWQgMDshTGIgfHwgInRvdWNoc3RhcnQiICE9PSBiICYmICJ0b3VjaG1vdmUiICE9PSBiICYmICJ3aGVlbCIgIT09IGIgfHwgKGUgPSAhMCk7ZCA/IHZvaWQgMCAhPT0gZSA/IGEuYWRkRXZlbnRMaXN0ZW5lcihiLCBjLCB7IGNhcHR1cmU6ICEwLCBwYXNzaXZlOiBlIH0pIDogYS5hZGRFdmVudExpc3RlbmVyKGIsIGMsICEwKSA6IHZvaWQgMCAhPT0gZSA/IGEuYWRkRXZlbnRMaXN0ZW5lcihiLCBjLCB7IHBhc3NpdmU6IGUgfSkgOiBhLmFkZEV2ZW50TGlzdGVuZXIoYiwgYywgITEpO30KICAgICAgICAgIGZ1bmN0aW9uIGhkKGEsIGIsIGMsIGQsIGUpIHt2YXIgZiA9IGQ7aWYgKDAgPT09IChiICYgMSkgJiYgMCA9PT0gKGIgJiAyKSAmJiBudWxsICE9PSBkKSBhOiBmb3IgKDs7KSB7aWYgKG51bGwgPT09IGQpIHJldHVybjt2YXIgZyA9IGQudGFnO2lmICgzID09PSBnIHx8IDQgPT09IGcpIHt2YXIgaCA9IGQuc3RhdGVOb2RlLmNvbnRhaW5lckluZm87aWYgKGggPT09IGUgfHwgOCA9PT0gaC5ub2RlVHlwZSAmJiBoLnBhcmVudE5vZGUgPT09IGUpIGJyZWFrO2lmICg0ID09PSBnKSBmb3IgKGcgPSBkLnJldHVybjsgbnVsbCAhPT0gZzspIHt2YXIgayA9IGcudGFnO2lmICgzID09PSBrIHx8IDQgPT09IGspIGlmIChrID0gZy5zdGF0ZU5vZGUuY29udGFpbmVySW5mbywgayA9PT0gZSB8fCA4ID09PSBrLm5vZGVUeXBlICYmIGsucGFyZW50Tm9kZSA9PT0gZSkgcmV0dXJuO2cgPSBnLnJldHVybjt9Zm9yICg7IG51bGwgIT09IGg7KSB7ZyA9IFdjKGgpO2lmIChudWxsID09PSBnKSByZXR1cm47ayA9IGcudGFnO2lmICg1ID09PSBrIHx8IDYgPT09IGspIHtkID0gZiA9IGc7Y29udGludWUgYTt9aCA9IGgucGFyZW50Tm9kZTt9fWQgPSBkLnJldHVybjt9SmIoZnVuY3Rpb24gKCkge3ZhciBkID0gZixlID0geGIoYyksZyA9IFtdOwogICAgICAgICAgICAgIGE6IHt2YXIgaCA9IGRmLmdldChhKTtpZiAodm9pZCAwICE9PSBoKSB7dmFyIGsgPSB0ZCxuID0gYTtzd2l0Y2ggKGEpIHtjYXNlICJrZXlwcmVzcyI6aWYgKDAgPT09IG9kKGMpKSBicmVhayBhO2Nhc2UgImtleWRvd24iOmNhc2UgImtleXVwIjprID0gUmQ7YnJlYWs7Y2FzZSAiZm9jdXNpbiI6biA9ICJmb2N1cyI7ayA9IEZkO2JyZWFrO2Nhc2UgImZvY3Vzb3V0IjpuID0gImJsdXIiO2sgPSBGZDticmVhaztjYXNlICJiZWZvcmVibHVyIjpjYXNlICJhZnRlcmJsdXIiOmsgPSBGZDticmVhaztjYXNlICJjbGljayI6aWYgKDIgPT09IGMuYnV0dG9uKSBicmVhayBhO2Nhc2UgImF1eGNsaWNrIjpjYXNlICJkYmxjbGljayI6Y2FzZSAibW91c2Vkb3duIjpjYXNlICJtb3VzZW1vdmUiOmNhc2UgIm1vdXNldXAiOmNhc2UgIm1vdXNlb3V0IjpjYXNlICJtb3VzZW92ZXIiOmNhc2UgImNvbnRleHRtZW51IjprID0gQmQ7YnJlYWs7Y2FzZSAiZHJhZyI6Y2FzZSAiZHJhZ2VuZCI6Y2FzZSAiZHJhZ2VudGVyIjpjYXNlICJkcmFnZXhpdCI6Y2FzZSAiZHJhZ2xlYXZlIjpjYXNlICJkcmFnb3ZlciI6Y2FzZSAiZHJhZ3N0YXJ0IjpjYXNlICJkcm9wIjprID0KICAgICAgICAgICAgICAgICAgICAgIERkO2JyZWFrO2Nhc2UgInRvdWNoY2FuY2VsIjpjYXNlICJ0b3VjaGVuZCI6Y2FzZSAidG91Y2htb3ZlIjpjYXNlICJ0b3VjaHN0YXJ0IjprID0gVmQ7YnJlYWs7Y2FzZSAkZTpjYXNlIGFmOmNhc2UgYmY6ayA9IEhkO2JyZWFrO2Nhc2UgY2Y6ayA9IFhkO2JyZWFrO2Nhc2UgInNjcm9sbCI6ayA9IHZkO2JyZWFrO2Nhc2UgIndoZWVsIjprID0gWmQ7YnJlYWs7Y2FzZSAiY29weSI6Y2FzZSAiY3V0IjpjYXNlICJwYXN0ZSI6ayA9IEpkO2JyZWFrO2Nhc2UgImdvdHBvaW50ZXJjYXB0dXJlIjpjYXNlICJsb3N0cG9pbnRlcmNhcHR1cmUiOmNhc2UgInBvaW50ZXJjYW5jZWwiOmNhc2UgInBvaW50ZXJkb3duIjpjYXNlICJwb2ludGVybW92ZSI6Y2FzZSAicG9pbnRlcm91dCI6Y2FzZSAicG9pbnRlcm92ZXIiOmNhc2UgInBvaW50ZXJ1cCI6ayA9IFRkO312YXIgdCA9IDAgIT09IChiICYgNCksSiA9ICF0ICYmICJzY3JvbGwiID09PSBhLHggPSB0ID8gbnVsbCAhPT0gaCA/IGggKyAiQ2FwdHVyZSIgOiBudWxsIDogaDt0ID0gW107Zm9yICh2YXIgdyA9IGQsIHU7IG51bGwgIT09CiAgICAgICAgICAgICAgICAgIHc7KSB7dSA9IHc7dmFyIEYgPSB1LnN0YXRlTm9kZTs1ID09PSB1LnRhZyAmJiBudWxsICE9PSBGICYmICh1ID0gRiwgbnVsbCAhPT0geCAmJiAoRiA9IEtiKHcsIHgpLCBudWxsICE9IEYgJiYgdC5wdXNoKHRmKHcsIEYsIHUpKSkpO2lmIChKKSBicmVhazt3ID0gdy5yZXR1cm47fTAgPCB0Lmxlbmd0aCAmJiAoaCA9IG5ldyBrKGgsIG4sIG51bGwsIGMsIGUpLCBnLnB1c2goeyBldmVudDogaCwgbGlzdGVuZXJzOiB0IH0pKTt9fWlmICgwID09PSAoYiAmIDcpKSB7YToge2ggPSAibW91c2VvdmVyIiA9PT0gYSB8fCAicG9pbnRlcm92ZXIiID09PSBhO2sgPSAibW91c2VvdXQiID09PSBhIHx8ICJwb2ludGVyb3V0IiA9PT0gYTtpZiAoaCAmJiBjICE9PSB3YiAmJiAobiA9IGMucmVsYXRlZFRhcmdldCB8fCBjLmZyb21FbGVtZW50KSAmJiAoV2MobikgfHwgblt1Zl0pKSBicmVhayBhO2lmIChrIHx8IGgpIHtoID0gZS53aW5kb3cgPT09IGUgPyBlIDogKGggPSBlLm93bmVyRG9jdW1lbnQpID8gaC5kZWZhdWx0VmlldyB8fCBoLnBhcmVudFdpbmRvdyA6IHdpbmRvdztpZiAoaykge2lmIChuID0gYy5yZWxhdGVkVGFyZ2V0IHx8IGMudG9FbGVtZW50LCBrID0gZCwgbiA9IG4gPyBXYyhuKSA6IG51bGwsIG51bGwgIT09CiAgICAgICAgICAgICAgICAgICAgICBuICYmIChKID0gVmIobiksIG4gIT09IEogfHwgNSAhPT0gbi50YWcgJiYgNiAhPT0gbi50YWcpKSBuID0gbnVsbDt9IGVsc2UgayA9IG51bGwsIG4gPSBkO2lmIChrICE9PSBuKSB7dCA9IEJkO0YgPSAib25Nb3VzZUxlYXZlIjt4ID0gIm9uTW91c2VFbnRlciI7dyA9ICJtb3VzZSI7aWYgKCJwb2ludGVyb3V0IiA9PT0gYSB8fCAicG9pbnRlcm92ZXIiID09PSBhKSB0ID0gVGQsIEYgPSAib25Qb2ludGVyTGVhdmUiLCB4ID0gIm9uUG9pbnRlckVudGVyIiwgdyA9ICJwb2ludGVyIjtKID0gbnVsbCA9PSBrID8gaCA6IHVlKGspO3UgPSBudWxsID09IG4gPyBoIDogdWUobik7aCA9IG5ldyB0KEYsIHcgKyAibGVhdmUiLCBrLCBjLCBlKTtoLnRhcmdldCA9IEo7aC5yZWxhdGVkVGFyZ2V0ID0gdTtGID0gbnVsbDtXYyhlKSA9PT0gZCAmJiAodCA9IG5ldyB0KHgsIHcgKyAiZW50ZXIiLCBuLCBjLCBlKSwgdC50YXJnZXQgPSB1LCB0LnJlbGF0ZWRUYXJnZXQgPSBKLCBGID0gdCk7SiA9IEY7aWYgKGsgJiYgbikgYjoge3QgPSBrO3ggPSBuO3cgPSAwO2ZvciAodSA9IHQ7IHU7IHUgPSB2Zih1KSkge3crKzt9dSA9IDA7Zm9yIChGID0geDsgRjsgRiA9IHZmKEYpKSB7dSsrO31mb3IgKDsgMCA8IHcgLSB1Oykge3QgPSB2Zih0KSwgdy0tO31mb3IgKDsgMCA8IHUgLSB3Oykge3ggPQogICAgICAgICAgICAgICAgICAgICAgICAgIHZmKHgpLCB1LS07fWZvciAoOyB3LS07KSB7aWYgKHQgPT09IHggfHwgbnVsbCAhPT0geCAmJiB0ID09PSB4LmFsdGVybmF0ZSkgYnJlYWsgYjt0ID0gdmYodCk7eCA9IHZmKHgpO310ID0gbnVsbDt9IGVsc2UgdCA9IG51bGw7bnVsbCAhPT0gayAmJiB3ZihnLCBoLCBrLCB0LCAhMSk7bnVsbCAhPT0gbiAmJiBudWxsICE9PSBKICYmIHdmKGcsIEosIG4sIHQsICEwKTt9fX1hOiB7aCA9IGQgPyB1ZShkKSA6IHdpbmRvdztrID0gaC5ub2RlTmFtZSAmJiBoLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCk7aWYgKCJzZWxlY3QiID09PSBrIHx8ICJpbnB1dCIgPT09IGsgJiYgImZpbGUiID09PSBoLnR5cGUpIHZhciBuYSA9IHZlO2Vsc2UgaWYgKG1lKGgpKSB7aWYgKHdlKSBuYSA9IEZlO2Vsc2Uge25hID0gRGU7dmFyIHhhID0gQ2U7fX0gZWxzZSAoayA9IGgubm9kZU5hbWUpICYmICJpbnB1dCIgPT09IGsudG9Mb3dlckNhc2UoKSAmJiAoImNoZWNrYm94IiA9PT0gaC50eXBlIHx8ICJyYWRpbyIgPT09IGgudHlwZSkgJiYgKG5hID0gRWUpO2lmIChuYSAmJiAobmEgPSBuYShhLCBkKSkpIHtuZShnLCBuYSwgYywgZSk7YnJlYWsgYTt9eGEgJiYgeGEoYSwgaCwgZCk7ImZvY3Vzb3V0IiA9PT0gYSAmJiAoeGEgPSBoLl93cmFwcGVyU3RhdGUpICYmCiAgICAgICAgICAgICAgICAgIHhhLmNvbnRyb2xsZWQgJiYgIm51bWJlciIgPT09IGgudHlwZSAmJiBjYihoLCAibnVtYmVyIiwgaC52YWx1ZSk7fXhhID0gZCA/IHVlKGQpIDogd2luZG93O3N3aXRjaCAoYSkge2Nhc2UgImZvY3VzaW4iOmlmIChtZSh4YSkgfHwgInRydWUiID09PSB4YS5jb250ZW50RWRpdGFibGUpIFFlID0geGEsIFJlID0gZCwgU2UgPSBudWxsO2JyZWFrO2Nhc2UgImZvY3Vzb3V0IjpTZSA9IFJlID0gUWUgPSBudWxsO2JyZWFrO2Nhc2UgIm1vdXNlZG93biI6VGUgPSAhMDticmVhaztjYXNlICJjb250ZXh0bWVudSI6Y2FzZSAibW91c2V1cCI6Y2FzZSAiZHJhZ2VuZCI6VGUgPSAhMTtVZShnLCBjLCBlKTticmVhaztjYXNlICJzZWxlY3Rpb25jaGFuZ2UiOmlmIChQZSkgYnJlYWs7Y2FzZSAia2V5ZG93biI6Y2FzZSAia2V5dXAiOlVlKGcsIGMsIGUpO312YXIgJGE7aWYgKGFlKSBiOiB7c3dpdGNoIChhKSB7Y2FzZSAiY29tcG9zaXRpb25zdGFydCI6dmFyIGJhID0gIm9uQ29tcG9zaXRpb25TdGFydCI7YnJlYWsgYjtjYXNlICJjb21wb3NpdGlvbmVuZCI6YmEgPSAib25Db21wb3NpdGlvbkVuZCI7CiAgICAgICAgICAgICAgICAgICAgICBicmVhayBiO2Nhc2UgImNvbXBvc2l0aW9udXBkYXRlIjpiYSA9ICJvbkNvbXBvc2l0aW9uVXBkYXRlIjticmVhayBiO31iYSA9IHZvaWQgMDt9IGVsc2UgaWUgPyBnZShhLCBjKSAmJiAoYmEgPSAib25Db21wb3NpdGlvbkVuZCIpIDogImtleWRvd24iID09PSBhICYmIDIyOSA9PT0gYy5rZXlDb2RlICYmIChiYSA9ICJvbkNvbXBvc2l0aW9uU3RhcnQiKTtiYSAmJiAoZGUgJiYgImtvIiAhPT0gYy5sb2NhbGUgJiYgKGllIHx8ICJvbkNvbXBvc2l0aW9uU3RhcnQiICE9PSBiYSA/ICJvbkNvbXBvc2l0aW9uRW5kIiA9PT0gYmEgJiYgaWUgJiYgKCRhID0gbmQoKSkgOiAoa2QgPSBlLCBsZCA9ICJ2YWx1ZSIgaW4ga2QgPyBrZC52YWx1ZSA6IGtkLnRleHRDb250ZW50LCBpZSA9ICEwKSksIHhhID0gb2UoZCwgYmEpLCAwIDwgeGEubGVuZ3RoICYmIChiYSA9IG5ldyBMZChiYSwgYSwgbnVsbCwgYywgZSksIGcucHVzaCh7IGV2ZW50OiBiYSwgbGlzdGVuZXJzOiB4YSB9KSwgJGEgPyBiYS5kYXRhID0gJGEgOiAoJGEgPSBoZShjKSwgbnVsbCAhPT0gJGEgJiYgKGJhLmRhdGEgPSAkYSkpKSk7aWYgKCRhID0gY2UgPyBqZShhLCBjKSA6IGtlKGEsIGMpKSBkID0gb2UoZCwgIm9uQmVmb3JlSW5wdXQiKSwKICAgICAgICAgICAgICAgIDAgPCBkLmxlbmd0aCAmJiAoZSA9IG5ldyBMZCgib25CZWZvcmVJbnB1dCIsICJiZWZvcmVpbnB1dCIsIG51bGwsIGMsIGUpLCBnLnB1c2goeyBldmVudDogZSwgbGlzdGVuZXJzOiBkIH0pLCBlLmRhdGEgPSAkYSk7fXNlKGcsIGIpO30pO31mdW5jdGlvbiB0ZihhLCBiLCBjKSB7cmV0dXJuIHsgaW5zdGFuY2U6IGEsIGxpc3RlbmVyOiBiLCBjdXJyZW50VGFyZ2V0OiBjIH07fWZ1bmN0aW9uIG9lKGEsIGIpIHtmb3IgKHZhciBjID0gYiArICJDYXB0dXJlIiwgZCA9IFtdOyBudWxsICE9PSBhOykge3ZhciBlID0gYSxmID0gZS5zdGF0ZU5vZGU7NSA9PT0gZS50YWcgJiYgbnVsbCAhPT0gZiAmJiAoZSA9IGYsIGYgPSBLYihhLCBjKSwgbnVsbCAhPSBmICYmIGQudW5zaGlmdCh0ZihhLCBmLCBlKSksIGYgPSBLYihhLCBiKSwgbnVsbCAhPSBmICYmIGQucHVzaCh0ZihhLCBmLCBlKSkpO2EgPSBhLnJldHVybjt9cmV0dXJuIGQ7fWZ1bmN0aW9uIHZmKGEpIHtpZiAobnVsbCA9PT0gYSkgcmV0dXJuIG51bGw7ZG8ge2EgPSBhLnJldHVybjt9IHdoaWxlIChhICYmIDUgIT09IGEudGFnKTtyZXR1cm4gYSA/IGEgOiBudWxsO30KICAgICAgICAgIGZ1bmN0aW9uIHdmKGEsIGIsIGMsIGQsIGUpIHtmb3IgKHZhciBmID0gYi5fcmVhY3ROYW1lLCBnID0gW107IG51bGwgIT09IGMgJiYgYyAhPT0gZDspIHt2YXIgaCA9IGMsayA9IGguYWx0ZXJuYXRlLGwgPSBoLnN0YXRlTm9kZTtpZiAobnVsbCAhPT0gayAmJiBrID09PSBkKSBicmVhazs1ID09PSBoLnRhZyAmJiBudWxsICE9PSBsICYmIChoID0gbCwgZSA/IChrID0gS2IoYywgZiksIG51bGwgIT0gayAmJiBnLnVuc2hpZnQodGYoYywgaywgaCkpKSA6IGUgfHwgKGsgPSBLYihjLCBmKSwgbnVsbCAhPSBrICYmIGcucHVzaCh0ZihjLCBrLCBoKSkpKTtjID0gYy5yZXR1cm47fTAgIT09IGcubGVuZ3RoICYmIGEucHVzaCh7IGV2ZW50OiBiLCBsaXN0ZW5lcnM6IGcgfSk7fXZhciB4ZiA9IC9cclxuPy9nLHlmID0gL1x1MDAwMHxcdUZGRkQvZztmdW5jdGlvbiB6ZihhKSB7cmV0dXJuICgic3RyaW5nIiA9PT0gdHlwZW9mIGEgPyBhIDogIiIgKyBhKS5yZXBsYWNlKHhmLCAiXG4iKS5yZXBsYWNlKHlmLCAiIik7fWZ1bmN0aW9uIEFmKGEsIGIsIGMpIHtiID0gemYoYik7aWYgKHpmKGEpICE9PSBiICYmIGMpIHRocm93IEVycm9yKHAoNDI1KSk7fWZ1bmN0aW9uIEJmKCkge30KICAgICAgICAgIHZhciBDZiA9IG51bGwsRGYgPSBudWxsO2Z1bmN0aW9uIEVmKGEsIGIpIHtyZXR1cm4gInRleHRhcmVhIiA9PT0gYSB8fCAibm9zY3JpcHQiID09PSBhIHx8ICJzdHJpbmciID09PSB0eXBlb2YgYi5jaGlsZHJlbiB8fCAibnVtYmVyIiA9PT0gdHlwZW9mIGIuY2hpbGRyZW4gfHwgIm9iamVjdCIgPT09IHR5cGVvZiBiLmRhbmdlcm91c2x5U2V0SW5uZXJIVE1MICYmIG51bGwgIT09IGIuZGFuZ2Vyb3VzbHlTZXRJbm5lckhUTUwgJiYgbnVsbCAhPSBiLmRhbmdlcm91c2x5U2V0SW5uZXJIVE1MLl9faHRtbDt9CiAgICAgICAgICB2YXIgRmYgPSAiZnVuY3Rpb24iID09PSB0eXBlb2Ygc2V0VGltZW91dCA/IHNldFRpbWVvdXQgOiB2b2lkIDAsR2YgPSAiZnVuY3Rpb24iID09PSB0eXBlb2YgY2xlYXJUaW1lb3V0ID8gY2xlYXJUaW1lb3V0IDogdm9pZCAwLEhmID0gImZ1bmN0aW9uIiA9PT0gdHlwZW9mIFByb21pc2UgPyBQcm9taXNlIDogdm9pZCAwLEpmID0gImZ1bmN0aW9uIiA9PT0gdHlwZW9mIHF1ZXVlTWljcm90YXNrID8gcXVldWVNaWNyb3Rhc2sgOiAidW5kZWZpbmVkIiAhPT0gdHlwZW9mIEhmID8gZnVuY3Rpb24gKGEpIHtyZXR1cm4gSGYucmVzb2x2ZShudWxsKS50aGVuKGEpLmNhdGNoKElmKTt9IDogRmY7ZnVuY3Rpb24gSWYoYSkge3NldFRpbWVvdXQoZnVuY3Rpb24gKCkge3Rocm93IGE7fSk7fQogICAgICAgICAgZnVuY3Rpb24gS2YoYSwgYikge3ZhciBjID0gYixkID0gMDtkbyB7dmFyIGUgPSBjLm5leHRTaWJsaW5nO2EucmVtb3ZlQ2hpbGQoYyk7aWYgKGUgJiYgOCA9PT0gZS5ub2RlVHlwZSkgaWYgKGMgPSBlLmRhdGEsICIvJCIgPT09IGMpIHtpZiAoMCA9PT0gZCkge2EucmVtb3ZlQ2hpbGQoZSk7YmQoYik7cmV0dXJuO31kLS07fSBlbHNlICIkIiAhPT0gYyAmJiAiJD8iICE9PSBjICYmICIkISIgIT09IGMgfHwgZCsrO2MgPSBlO30gd2hpbGUgKGMpO2JkKGIpO31mdW5jdGlvbiBMZihhKSB7Zm9yICg7IG51bGwgIT0gYTsgYSA9IGEubmV4dFNpYmxpbmcpIHt2YXIgYiA9IGEubm9kZVR5cGU7aWYgKDEgPT09IGIgfHwgMyA9PT0gYikgYnJlYWs7aWYgKDggPT09IGIpIHtiID0gYS5kYXRhO2lmICgiJCIgPT09IGIgfHwgIiQhIiA9PT0gYiB8fCAiJD8iID09PSBiKSBicmVhaztpZiAoIi8kIiA9PT0gYikgcmV0dXJuIG51bGw7fX1yZXR1cm4gYTt9CiAgICAgICAgICBmdW5jdGlvbiBNZihhKSB7YSA9IGEucHJldmlvdXNTaWJsaW5nO2ZvciAodmFyIGIgPSAwOyBhOykge2lmICg4ID09PSBhLm5vZGVUeXBlKSB7dmFyIGMgPSBhLmRhdGE7aWYgKCIkIiA9PT0gYyB8fCAiJCEiID09PSBjIHx8ICIkPyIgPT09IGMpIHtpZiAoMCA9PT0gYikgcmV0dXJuIGE7Yi0tO30gZWxzZSAiLyQiID09PSBjICYmIGIrKzt9YSA9IGEucHJldmlvdXNTaWJsaW5nO31yZXR1cm4gbnVsbDt9dmFyIE5mID0gTWF0aC5yYW5kb20oKS50b1N0cmluZygzNikuc2xpY2UoMiksT2YgPSAiX19yZWFjdEZpYmVyJCIgKyBOZixQZiA9ICJfX3JlYWN0UHJvcHMkIiArIE5mLHVmID0gIl9fcmVhY3RDb250YWluZXIkIiArIE5mLG9mID0gIl9fcmVhY3RFdmVudHMkIiArIE5mLFFmID0gIl9fcmVhY3RMaXN0ZW5lcnMkIiArIE5mLFJmID0gIl9fcmVhY3RIYW5kbGVzJCIgKyBOZjsKICAgICAgICAgIGZ1bmN0aW9uIFdjKGEpIHt2YXIgYiA9IGFbT2ZdO2lmIChiKSByZXR1cm4gYjtmb3IgKHZhciBjID0gYS5wYXJlbnROb2RlOyBjOykge2lmIChiID0gY1t1Zl0gfHwgY1tPZl0pIHtjID0gYi5hbHRlcm5hdGU7aWYgKG51bGwgIT09IGIuY2hpbGQgfHwgbnVsbCAhPT0gYyAmJiBudWxsICE9PSBjLmNoaWxkKSBmb3IgKGEgPSBNZihhKTsgbnVsbCAhPT0gYTspIHtpZiAoYyA9IGFbT2ZdKSByZXR1cm4gYzthID0gTWYoYSk7fXJldHVybiBiO31hID0gYztjID0gYS5wYXJlbnROb2RlO31yZXR1cm4gbnVsbDt9ZnVuY3Rpb24gQ2IoYSkge2EgPSBhW09mXSB8fCBhW3VmXTtyZXR1cm4gIWEgfHwgNSAhPT0gYS50YWcgJiYgNiAhPT0gYS50YWcgJiYgMTMgIT09IGEudGFnICYmIDMgIT09IGEudGFnID8gbnVsbCA6IGE7fWZ1bmN0aW9uIHVlKGEpIHtpZiAoNSA9PT0gYS50YWcgfHwgNiA9PT0gYS50YWcpIHJldHVybiBhLnN0YXRlTm9kZTt0aHJvdyBFcnJvcihwKDMzKSk7fWZ1bmN0aW9uIERiKGEpIHtyZXR1cm4gYVtQZl0gfHwgbnVsbDt9dmFyIFNmID0gW10sVGYgPSAtMTtmdW5jdGlvbiBVZihhKSB7cmV0dXJuIHsgY3VycmVudDogYSB9O30KICAgICAgICAgIGZ1bmN0aW9uIEUoYSkgezAgPiBUZiB8fCAoYS5jdXJyZW50ID0gU2ZbVGZdLCBTZltUZl0gPSBudWxsLCBUZi0tKTt9ZnVuY3Rpb24gRyhhLCBiKSB7VGYrKztTZltUZl0gPSBhLmN1cnJlbnQ7YS5jdXJyZW50ID0gYjt9dmFyIFZmID0ge30sSCA9IFVmKFZmKSxXZiA9IFVmKCExKSxYZiA9IFZmO2Z1bmN0aW9uIFlmKGEsIGIpIHt2YXIgYyA9IGEudHlwZS5jb250ZXh0VHlwZXM7aWYgKCFjKSByZXR1cm4gVmY7dmFyIGQgPSBhLnN0YXRlTm9kZTtpZiAoZCAmJiBkLl9fcmVhY3RJbnRlcm5hbE1lbW9pemVkVW5tYXNrZWRDaGlsZENvbnRleHQgPT09IGIpIHJldHVybiBkLl9fcmVhY3RJbnRlcm5hbE1lbW9pemVkTWFza2VkQ2hpbGRDb250ZXh0O3ZhciBlID0ge30sZjtmb3IgKGYgaW4gYykge2VbZl0gPSBiW2ZdO31kICYmIChhID0gYS5zdGF0ZU5vZGUsIGEuX19yZWFjdEludGVybmFsTWVtb2l6ZWRVbm1hc2tlZENoaWxkQ29udGV4dCA9IGIsIGEuX19yZWFjdEludGVybmFsTWVtb2l6ZWRNYXNrZWRDaGlsZENvbnRleHQgPSBlKTtyZXR1cm4gZTt9CiAgICAgICAgICBmdW5jdGlvbiBaZihhKSB7YSA9IGEuY2hpbGRDb250ZXh0VHlwZXM7cmV0dXJuIG51bGwgIT09IGEgJiYgdm9pZCAwICE9PSBhO31mdW5jdGlvbiAkZigpIHtFKFdmKTtFKEgpO31mdW5jdGlvbiBhZyhhLCBiLCBjKSB7aWYgKEguY3VycmVudCAhPT0gVmYpIHRocm93IEVycm9yKHAoMTY4KSk7RyhILCBiKTtHKFdmLCBjKTt9ZnVuY3Rpb24gYmcoYSwgYiwgYykge3ZhciBkID0gYS5zdGF0ZU5vZGU7YiA9IGIuY2hpbGRDb250ZXh0VHlwZXM7aWYgKCJmdW5jdGlvbiIgIT09IHR5cGVvZiBkLmdldENoaWxkQ29udGV4dCkgcmV0dXJuIGM7ZCA9IGQuZ2V0Q2hpbGRDb250ZXh0KCk7Zm9yICh2YXIgZSBpbiBkKSB7aWYgKCEoZSBpbiBiKSkgdGhyb3cgRXJyb3IocCgxMDgsIFJhKGEpIHx8ICJVbmtub3duIiwgZSkpO31yZXR1cm4gQSh7fSwgYywgZCk7fQogICAgICAgICAgZnVuY3Rpb24gY2coYSkge2EgPSAoYSA9IGEuc3RhdGVOb2RlKSAmJiBhLl9fcmVhY3RJbnRlcm5hbE1lbW9pemVkTWVyZ2VkQ2hpbGRDb250ZXh0IHx8IFZmO1hmID0gSC5jdXJyZW50O0coSCwgYSk7RyhXZiwgV2YuY3VycmVudCk7cmV0dXJuICEwO31mdW5jdGlvbiBkZyhhLCBiLCBjKSB7dmFyIGQgPSBhLnN0YXRlTm9kZTtpZiAoIWQpIHRocm93IEVycm9yKHAoMTY5KSk7YyA/IChhID0gYmcoYSwgYiwgWGYpLCBkLl9fcmVhY3RJbnRlcm5hbE1lbW9pemVkTWVyZ2VkQ2hpbGRDb250ZXh0ID0gYSwgRShXZiksIEUoSCksIEcoSCwgYSkpIDogRShXZik7RyhXZiwgYyk7fXZhciBlZyA9IG51bGwsZmcgPSAhMSxnZyA9ICExO2Z1bmN0aW9uIGhnKGEpIHtudWxsID09PSBlZyA/IGVnID0gW2FdIDogZWcucHVzaChhKTt9ZnVuY3Rpb24gaWcoYSkge2ZnID0gITA7aGcoYSk7fQogICAgICAgICAgZnVuY3Rpb24gamcoKSB7aWYgKCFnZyAmJiBudWxsICE9PSBlZykge2dnID0gITA7dmFyIGEgPSAwLGIgPSBDO3RyeSB7dmFyIGMgPSBlZztmb3IgKEMgPSAxOyBhIDwgYy5sZW5ndGg7IGErKykge3ZhciBkID0gY1thXTtkbyB7ZCA9IGQoITApO30gd2hpbGUgKG51bGwgIT09IGQpO31lZyA9IG51bGw7ZmcgPSAhMTt9IGNhdGNoIChlKSB7dGhyb3cgbnVsbCAhPT0gZWcgJiYgKGVnID0gZWcuc2xpY2UoYSArIDEpKSwgYWMoZmMsIGpnKSwgZTt9IGZpbmFsbHkge0MgPSBiLCBnZyA9ICExO319cmV0dXJuIG51bGw7fXZhciBrZyA9IFtdLGxnID0gMCxtZyA9IG51bGwsbmcgPSAwLG9nID0gW10scGcgPSAwLHFnID0gbnVsbCxyZyA9IDEsc2cgPSAiIjtmdW5jdGlvbiB0ZyhhLCBiKSB7a2dbbGcrK10gPSBuZztrZ1tsZysrXSA9IG1nO21nID0gYTtuZyA9IGI7fQogICAgICAgICAgZnVuY3Rpb24gdWcoYSwgYiwgYykge29nW3BnKytdID0gcmc7b2dbcGcrK10gPSBzZztvZ1twZysrXSA9IHFnO3FnID0gYTt2YXIgZCA9IHJnO2EgPSBzZzt2YXIgZSA9IDMyIC0gb2MoZCkgLSAxO2QgJj0gfigxIDw8IGUpO2MgKz0gMTt2YXIgZiA9IDMyIC0gb2MoYikgKyBlO2lmICgzMCA8IGYpIHt2YXIgZyA9IGUgLSBlICUgNTtmID0gKGQgJiAoMSA8PCBnKSAtIDEpLnRvU3RyaW5nKDMyKTtkID4+PSBnO2UgLT0gZztyZyA9IDEgPDwgMzIgLSBvYyhiKSArIGUgfCBjIDw8IGUgfCBkO3NnID0gZiArIGE7fSBlbHNlIHJnID0gMSA8PCBmIHwgYyA8PCBlIHwgZCwgc2cgPSBhO31mdW5jdGlvbiB2ZyhhKSB7bnVsbCAhPT0gYS5yZXR1cm4gJiYgKHRnKGEsIDEpLCB1ZyhhLCAxLCAwKSk7fWZ1bmN0aW9uIHdnKGEpIHtmb3IgKDsgYSA9PT0gbWc7KSB7bWcgPSBrZ1stLWxnXSwga2dbbGddID0gbnVsbCwgbmcgPSBrZ1stLWxnXSwga2dbbGddID0gbnVsbDt9Zm9yICg7IGEgPT09IHFnOykge3FnID0gb2dbLS1wZ10sIG9nW3BnXSA9IG51bGwsIHNnID0gb2dbLS1wZ10sIG9nW3BnXSA9IG51bGwsIHJnID0gb2dbLS1wZ10sIG9nW3BnXSA9IG51bGw7fX12YXIgeGcgPSBudWxsLHlnID0gbnVsbCxJID0gITEsemcgPSBudWxsOwogICAgICAgICAgZnVuY3Rpb24gQWcoYSwgYikge3ZhciBjID0gQmcoNSwgbnVsbCwgbnVsbCwgMCk7Yy5lbGVtZW50VHlwZSA9ICJERUxFVEVEIjtjLnN0YXRlTm9kZSA9IGI7Yy5yZXR1cm4gPSBhO2IgPSBhLmRlbGV0aW9ucztudWxsID09PSBiID8gKGEuZGVsZXRpb25zID0gW2NdLCBhLmZsYWdzIHw9IDE2KSA6IGIucHVzaChjKTt9CiAgICAgICAgICBmdW5jdGlvbiBDZyhhLCBiKSB7c3dpdGNoIChhLnRhZykge2Nhc2UgNTp2YXIgYyA9IGEudHlwZTtiID0gMSAhPT0gYi5ub2RlVHlwZSB8fCBjLnRvTG93ZXJDYXNlKCkgIT09IGIubm9kZU5hbWUudG9Mb3dlckNhc2UoKSA/IG51bGwgOiBiO3JldHVybiBudWxsICE9PSBiID8gKGEuc3RhdGVOb2RlID0gYiwgeGcgPSBhLCB5ZyA9IExmKGIuZmlyc3RDaGlsZCksICEwKSA6ICExO2Nhc2UgNjpyZXR1cm4gYiA9ICIiID09PSBhLnBlbmRpbmdQcm9wcyB8fCAzICE9PSBiLm5vZGVUeXBlID8gbnVsbCA6IGIsIG51bGwgIT09IGIgPyAoYS5zdGF0ZU5vZGUgPSBiLCB4ZyA9IGEsIHlnID0gbnVsbCwgITApIDogITE7Y2FzZSAxMzpyZXR1cm4gYiA9IDggIT09IGIubm9kZVR5cGUgPyBudWxsIDogYiwgbnVsbCAhPT0gYiA/IChjID0gbnVsbCAhPT0gcWcgPyB7IGlkOiByZywgb3ZlcmZsb3c6IHNnIH0gOiBudWxsLCBhLm1lbW9pemVkU3RhdGUgPSB7IGRlaHlkcmF0ZWQ6IGIsIHRyZWVDb250ZXh0OiBjLCByZXRyeUxhbmU6IDEwNzM3NDE4MjQgfSwgYyA9IEJnKDE4LCBudWxsLCBudWxsLCAwKSwgYy5zdGF0ZU5vZGUgPSBiLCBjLnJldHVybiA9IGEsIGEuY2hpbGQgPSBjLCB4ZyA9IGEsIHlnID0KICAgICAgICAgICAgICAgIG51bGwsICEwKSA6ICExO2RlZmF1bHQ6cmV0dXJuICExO319ZnVuY3Rpb24gRGcoYSkge3JldHVybiAwICE9PSAoYS5tb2RlICYgMSkgJiYgMCA9PT0gKGEuZmxhZ3MgJiAxMjgpO31mdW5jdGlvbiBFZyhhKSB7aWYgKEkpIHt2YXIgYiA9IHlnO2lmIChiKSB7dmFyIGMgPSBiO2lmICghQ2coYSwgYikpIHtpZiAoRGcoYSkpIHRocm93IEVycm9yKHAoNDE4KSk7YiA9IExmKGMubmV4dFNpYmxpbmcpO3ZhciBkID0geGc7YiAmJiBDZyhhLCBiKSA/IEFnKGQsIGMpIDogKGEuZmxhZ3MgPSBhLmZsYWdzICYgLTQwOTcgfCAyLCBJID0gITEsIHhnID0gYSk7fX0gZWxzZSB7aWYgKERnKGEpKSB0aHJvdyBFcnJvcihwKDQxOCkpO2EuZmxhZ3MgPSBhLmZsYWdzICYgLTQwOTcgfCAyO0kgPSAhMTt4ZyA9IGE7fX19ZnVuY3Rpb24gRmcoYSkge2ZvciAoYSA9IGEucmV0dXJuOyBudWxsICE9PSBhICYmIDUgIT09IGEudGFnICYmIDMgIT09IGEudGFnICYmIDEzICE9PSBhLnRhZzspIHthID0gYS5yZXR1cm47fXhnID0gYTt9CiAgICAgICAgICBmdW5jdGlvbiBHZyhhKSB7aWYgKGEgIT09IHhnKSByZXR1cm4gITE7aWYgKCFJKSByZXR1cm4gRmcoYSksIEkgPSAhMCwgITE7dmFyIGI7KGIgPSAzICE9PSBhLnRhZykgJiYgIShiID0gNSAhPT0gYS50YWcpICYmIChiID0gYS50eXBlLCBiID0gImhlYWQiICE9PSBiICYmICJib2R5IiAhPT0gYiAmJiAhRWYoYS50eXBlLCBhLm1lbW9pemVkUHJvcHMpKTtpZiAoYiAmJiAoYiA9IHlnKSkge2lmIChEZyhhKSkgdGhyb3cgSGcoKSwgRXJyb3IocCg0MTgpKTtmb3IgKDsgYjspIHtBZyhhLCBiKSwgYiA9IExmKGIubmV4dFNpYmxpbmcpO319RmcoYSk7aWYgKDEzID09PSBhLnRhZykge2EgPSBhLm1lbW9pemVkU3RhdGU7YSA9IG51bGwgIT09IGEgPyBhLmRlaHlkcmF0ZWQgOiBudWxsO2lmICghYSkgdGhyb3cgRXJyb3IocCgzMTcpKTthOiB7YSA9IGEubmV4dFNpYmxpbmc7Zm9yIChiID0gMDsgYTspIHtpZiAoOCA9PT0gYS5ub2RlVHlwZSkge3ZhciBjID0gYS5kYXRhO2lmICgiLyQiID09PSBjKSB7aWYgKDAgPT09IGIpIHt5ZyA9IExmKGEubmV4dFNpYmxpbmcpO2JyZWFrIGE7fWItLTt9IGVsc2UgIiQiICE9PSBjICYmICIkISIgIT09IGMgJiYgIiQ/IiAhPT0gYyB8fCBiKys7fWEgPSBhLm5leHRTaWJsaW5nO315ZyA9CiAgICAgICAgICAgICAgICBudWxsO319IGVsc2UgeWcgPSB4ZyA/IExmKGEuc3RhdGVOb2RlLm5leHRTaWJsaW5nKSA6IG51bGw7cmV0dXJuICEwO31mdW5jdGlvbiBIZygpIHtmb3IgKHZhciBhID0geWc7IGE7KSB7YSA9IExmKGEubmV4dFNpYmxpbmcpO319ZnVuY3Rpb24gSWcoKSB7eWcgPSB4ZyA9IG51bGw7SSA9ICExO31mdW5jdGlvbiBKZyhhKSB7bnVsbCA9PT0gemcgPyB6ZyA9IFthXSA6IHpnLnB1c2goYSk7fXZhciBLZyA9IHVhLlJlYWN0Q3VycmVudEJhdGNoQ29uZmlnO2Z1bmN0aW9uIExnKGEsIGIpIHtpZiAoYSAmJiBhLmRlZmF1bHRQcm9wcykge2IgPSBBKHt9LCBiKTthID0gYS5kZWZhdWx0UHJvcHM7Zm9yICh2YXIgYyBpbiBhKSB7dm9pZCAwID09PSBiW2NdICYmIChiW2NdID0gYVtjXSk7fXJldHVybiBiO31yZXR1cm4gYjt9dmFyIE1nID0gVWYobnVsbCksTmcgPSBudWxsLE9nID0gbnVsbCxQZyA9IG51bGw7ZnVuY3Rpb24gUWcoKSB7UGcgPSBPZyA9IE5nID0gbnVsbDt9ZnVuY3Rpb24gUmcoYSkge3ZhciBiID0gTWcuY3VycmVudDtFKE1nKTthLl9jdXJyZW50VmFsdWUgPSBiO30KICAgICAgICAgIGZ1bmN0aW9uIFNnKGEsIGIsIGMpIHtmb3IgKDsgbnVsbCAhPT0gYTspIHt2YXIgZCA9IGEuYWx0ZXJuYXRlOyhhLmNoaWxkTGFuZXMgJiBiKSAhPT0gYiA/IChhLmNoaWxkTGFuZXMgfD0gYiwgbnVsbCAhPT0gZCAmJiAoZC5jaGlsZExhbmVzIHw9IGIpKSA6IG51bGwgIT09IGQgJiYgKGQuY2hpbGRMYW5lcyAmIGIpICE9PSBiICYmIChkLmNoaWxkTGFuZXMgfD0gYik7aWYgKGEgPT09IGMpIGJyZWFrO2EgPSBhLnJldHVybjt9fWZ1bmN0aW9uIFRnKGEsIGIpIHtOZyA9IGE7UGcgPSBPZyA9IG51bGw7YSA9IGEuZGVwZW5kZW5jaWVzO251bGwgIT09IGEgJiYgbnVsbCAhPT0gYS5maXJzdENvbnRleHQgJiYgKDAgIT09IChhLmxhbmVzICYgYikgJiYgKFVnID0gITApLCBhLmZpcnN0Q29udGV4dCA9IG51bGwpO30KICAgICAgICAgIGZ1bmN0aW9uIFZnKGEpIHt2YXIgYiA9IGEuX2N1cnJlbnRWYWx1ZTtpZiAoUGcgIT09IGEpIGlmIChhID0geyBjb250ZXh0OiBhLCBtZW1vaXplZFZhbHVlOiBiLCBuZXh0OiBudWxsIH0sIG51bGwgPT09IE9nKSB7aWYgKG51bGwgPT09IE5nKSB0aHJvdyBFcnJvcihwKDMwOCkpO09nID0gYTtOZy5kZXBlbmRlbmNpZXMgPSB7IGxhbmVzOiAwLCBmaXJzdENvbnRleHQ6IGEgfTt9IGVsc2UgT2cgPSBPZy5uZXh0ID0gYTtyZXR1cm4gYjt9dmFyIFdnID0gbnVsbDtmdW5jdGlvbiBYZyhhKSB7bnVsbCA9PT0gV2cgPyBXZyA9IFthXSA6IFdnLnB1c2goYSk7fWZ1bmN0aW9uIFlnKGEsIGIsIGMsIGQpIHt2YXIgZSA9IGIuaW50ZXJsZWF2ZWQ7bnVsbCA9PT0gZSA/IChjLm5leHQgPSBjLCBYZyhiKSkgOiAoYy5uZXh0ID0gZS5uZXh0LCBlLm5leHQgPSBjKTtiLmludGVybGVhdmVkID0gYztyZXR1cm4gWmcoYSwgZCk7fQogICAgICAgICAgZnVuY3Rpb24gWmcoYSwgYikge2EubGFuZXMgfD0gYjt2YXIgYyA9IGEuYWx0ZXJuYXRlO251bGwgIT09IGMgJiYgKGMubGFuZXMgfD0gYik7YyA9IGE7Zm9yIChhID0gYS5yZXR1cm47IG51bGwgIT09IGE7KSB7YS5jaGlsZExhbmVzIHw9IGIsIGMgPSBhLmFsdGVybmF0ZSwgbnVsbCAhPT0gYyAmJiAoYy5jaGlsZExhbmVzIHw9IGIpLCBjID0gYSwgYSA9IGEucmV0dXJuO31yZXR1cm4gMyA9PT0gYy50YWcgPyBjLnN0YXRlTm9kZSA6IG51bGw7fXZhciAkZyA9ICExO2Z1bmN0aW9uIGFoKGEpIHthLnVwZGF0ZVF1ZXVlID0geyBiYXNlU3RhdGU6IGEubWVtb2l6ZWRTdGF0ZSwgZmlyc3RCYXNlVXBkYXRlOiBudWxsLCBsYXN0QmFzZVVwZGF0ZTogbnVsbCwgc2hhcmVkOiB7IHBlbmRpbmc6IG51bGwsIGludGVybGVhdmVkOiBudWxsLCBsYW5lczogMCB9LCBlZmZlY3RzOiBudWxsIH07fQogICAgICAgICAgZnVuY3Rpb24gYmgoYSwgYikge2EgPSBhLnVwZGF0ZVF1ZXVlO2IudXBkYXRlUXVldWUgPT09IGEgJiYgKGIudXBkYXRlUXVldWUgPSB7IGJhc2VTdGF0ZTogYS5iYXNlU3RhdGUsIGZpcnN0QmFzZVVwZGF0ZTogYS5maXJzdEJhc2VVcGRhdGUsIGxhc3RCYXNlVXBkYXRlOiBhLmxhc3RCYXNlVXBkYXRlLCBzaGFyZWQ6IGEuc2hhcmVkLCBlZmZlY3RzOiBhLmVmZmVjdHMgfSk7fWZ1bmN0aW9uIGNoKGEsIGIpIHtyZXR1cm4geyBldmVudFRpbWU6IGEsIGxhbmU6IGIsIHRhZzogMCwgcGF5bG9hZDogbnVsbCwgY2FsbGJhY2s6IG51bGwsIG5leHQ6IG51bGwgfTt9CiAgICAgICAgICBmdW5jdGlvbiBkaChhLCBiLCBjKSB7dmFyIGQgPSBhLnVwZGF0ZVF1ZXVlO2lmIChudWxsID09PSBkKSByZXR1cm4gbnVsbDtkID0gZC5zaGFyZWQ7aWYgKDAgIT09IChLICYgMikpIHt2YXIgZSA9IGQucGVuZGluZztudWxsID09PSBlID8gYi5uZXh0ID0gYiA6IChiLm5leHQgPSBlLm5leHQsIGUubmV4dCA9IGIpO2QucGVuZGluZyA9IGI7cmV0dXJuIFpnKGEsIGMpO31lID0gZC5pbnRlcmxlYXZlZDtudWxsID09PSBlID8gKGIubmV4dCA9IGIsIFhnKGQpKSA6IChiLm5leHQgPSBlLm5leHQsIGUubmV4dCA9IGIpO2QuaW50ZXJsZWF2ZWQgPSBiO3JldHVybiBaZyhhLCBjKTt9ZnVuY3Rpb24gZWgoYSwgYiwgYykge2IgPSBiLnVwZGF0ZVF1ZXVlO2lmIChudWxsICE9PSBiICYmIChiID0gYi5zaGFyZWQsIDAgIT09IChjICYgNDE5NDI0MCkpKSB7dmFyIGQgPSBiLmxhbmVzO2QgJj0gYS5wZW5kaW5nTGFuZXM7YyB8PSBkO2IubGFuZXMgPSBjO0NjKGEsIGMpO319CiAgICAgICAgICBmdW5jdGlvbiBmaChhLCBiKSB7dmFyIGMgPSBhLnVwZGF0ZVF1ZXVlLGQgPSBhLmFsdGVybmF0ZTtpZiAobnVsbCAhPT0gZCAmJiAoZCA9IGQudXBkYXRlUXVldWUsIGMgPT09IGQpKSB7dmFyIGUgPSBudWxsLGYgPSBudWxsO2MgPSBjLmZpcnN0QmFzZVVwZGF0ZTtpZiAobnVsbCAhPT0gYykge2RvIHt2YXIgZyA9IHsgZXZlbnRUaW1lOiBjLmV2ZW50VGltZSwgbGFuZTogYy5sYW5lLCB0YWc6IGMudGFnLCBwYXlsb2FkOiBjLnBheWxvYWQsIGNhbGxiYWNrOiBjLmNhbGxiYWNrLCBuZXh0OiBudWxsIH07bnVsbCA9PT0gZiA/IGUgPSBmID0gZyA6IGYgPSBmLm5leHQgPSBnO2MgPSBjLm5leHQ7fSB3aGlsZSAobnVsbCAhPT0gYyk7bnVsbCA9PT0gZiA/IGUgPSBmID0gYiA6IGYgPSBmLm5leHQgPSBiO30gZWxzZSBlID0gZiA9IGI7YyA9IHsgYmFzZVN0YXRlOiBkLmJhc2VTdGF0ZSwgZmlyc3RCYXNlVXBkYXRlOiBlLCBsYXN0QmFzZVVwZGF0ZTogZiwgc2hhcmVkOiBkLnNoYXJlZCwgZWZmZWN0czogZC5lZmZlY3RzIH07YS51cGRhdGVRdWV1ZSA9IGM7cmV0dXJuO31hID0gYy5sYXN0QmFzZVVwZGF0ZTtudWxsID09PSBhID8gYy5maXJzdEJhc2VVcGRhdGUgPSBiIDogYS5uZXh0ID0KICAgICAgICAgICAgYjtjLmxhc3RCYXNlVXBkYXRlID0gYjt9CiAgICAgICAgICBmdW5jdGlvbiBnaChhLCBiLCBjLCBkKSB7dmFyIGUgPSBhLnVwZGF0ZVF1ZXVlOyRnID0gITE7dmFyIGYgPSBlLmZpcnN0QmFzZVVwZGF0ZSxnID0gZS5sYXN0QmFzZVVwZGF0ZSxoID0gZS5zaGFyZWQucGVuZGluZztpZiAobnVsbCAhPT0gaCkge2Uuc2hhcmVkLnBlbmRpbmcgPSBudWxsO3ZhciBrID0gaCxsID0gay5uZXh0O2submV4dCA9IG51bGw7bnVsbCA9PT0gZyA/IGYgPSBsIDogZy5uZXh0ID0gbDtnID0gazt2YXIgbSA9IGEuYWx0ZXJuYXRlO251bGwgIT09IG0gJiYgKG0gPSBtLnVwZGF0ZVF1ZXVlLCBoID0gbS5sYXN0QmFzZVVwZGF0ZSwgaCAhPT0gZyAmJiAobnVsbCA9PT0gaCA/IG0uZmlyc3RCYXNlVXBkYXRlID0gbCA6IGgubmV4dCA9IGwsIG0ubGFzdEJhc2VVcGRhdGUgPSBrKSk7fWlmIChudWxsICE9PSBmKSB7dmFyIHEgPSBlLmJhc2VTdGF0ZTtnID0gMDttID0gbCA9IGsgPSBudWxsO2ggPSBmO2RvIHt2YXIgciA9IGgubGFuZSx5ID0gaC5ldmVudFRpbWU7aWYgKChkICYgcikgPT09IHIpIHtudWxsICE9PSBtICYmIChtID0gbS5uZXh0ID0geyBldmVudFRpbWU6IHksIGxhbmU6IDAsIHRhZzogaC50YWcsIHBheWxvYWQ6IGgucGF5bG9hZCwgY2FsbGJhY2s6IGguY2FsbGJhY2ssCiAgICAgICAgICAgICAgICAgICAgbmV4dDogbnVsbCB9KTthOiB7dmFyIG4gPSBhLHQgPSBoO3IgPSBiO3kgPSBjO3N3aXRjaCAodC50YWcpIHtjYXNlIDE6biA9IHQucGF5bG9hZDtpZiAoImZ1bmN0aW9uIiA9PT0gdHlwZW9mIG4pIHtxID0gbi5jYWxsKHksIHEsIHIpO2JyZWFrIGE7fXEgPSBuO2JyZWFrIGE7Y2FzZSAzOm4uZmxhZ3MgPSBuLmZsYWdzICYgLTY1NTM3IHwgMTI4O2Nhc2UgMDpuID0gdC5wYXlsb2FkO3IgPSAiZnVuY3Rpb24iID09PSB0eXBlb2YgbiA/IG4uY2FsbCh5LCBxLCByKSA6IG47aWYgKG51bGwgPT09IHIgfHwgdm9pZCAwID09PSByKSBicmVhayBhO3EgPSBBKHt9LCBxLCByKTticmVhayBhO2Nhc2UgMjokZyA9ICEwO319bnVsbCAhPT0gaC5jYWxsYmFjayAmJiAwICE9PSBoLmxhbmUgJiYgKGEuZmxhZ3MgfD0gNjQsIHIgPSBlLmVmZmVjdHMsIG51bGwgPT09IHIgPyBlLmVmZmVjdHMgPSBbaF0gOiByLnB1c2goaCkpO30gZWxzZSB5ID0geyBldmVudFRpbWU6IHksIGxhbmU6IHIsIHRhZzogaC50YWcsIHBheWxvYWQ6IGgucGF5bG9hZCwgY2FsbGJhY2s6IGguY2FsbGJhY2ssIG5leHQ6IG51bGwgfSwgbnVsbCA9PT0gbSA/IChsID0gbSA9IHksIGsgPSBxKSA6IG0gPSBtLm5leHQgPSB5LCBnIHw9IHI7CiAgICAgICAgICAgICAgICBoID0gaC5uZXh0O2lmIChudWxsID09PSBoKSBpZiAoaCA9IGUuc2hhcmVkLnBlbmRpbmcsIG51bGwgPT09IGgpIGJyZWFrO2Vsc2UgciA9IGgsIGggPSByLm5leHQsIHIubmV4dCA9IG51bGwsIGUubGFzdEJhc2VVcGRhdGUgPSByLCBlLnNoYXJlZC5wZW5kaW5nID0gbnVsbDt9IHdoaWxlICgxKTtudWxsID09PSBtICYmIChrID0gcSk7ZS5iYXNlU3RhdGUgPSBrO2UuZmlyc3RCYXNlVXBkYXRlID0gbDtlLmxhc3RCYXNlVXBkYXRlID0gbTtiID0gZS5zaGFyZWQuaW50ZXJsZWF2ZWQ7aWYgKG51bGwgIT09IGIpIHtlID0gYjtkbyB7ZyB8PSBlLmxhbmUsIGUgPSBlLm5leHQ7fSB3aGlsZSAoZSAhPT0gYik7fSBlbHNlIG51bGwgPT09IGYgJiYgKGUuc2hhcmVkLmxhbmVzID0gMCk7aGggfD0gZzthLmxhbmVzID0gZzthLm1lbW9pemVkU3RhdGUgPSBxO319CiAgICAgICAgICBmdW5jdGlvbiBpaChhLCBiLCBjKSB7YSA9IGIuZWZmZWN0cztiLmVmZmVjdHMgPSBudWxsO2lmIChudWxsICE9PSBhKSBmb3IgKGIgPSAwOyBiIDwgYS5sZW5ndGg7IGIrKykge3ZhciBkID0gYVtiXSxlID0gZC5jYWxsYmFjaztpZiAobnVsbCAhPT0gZSkge2QuY2FsbGJhY2sgPSBudWxsO2QgPSBjO2lmICgiZnVuY3Rpb24iICE9PSB0eXBlb2YgZSkgdGhyb3cgRXJyb3IocCgxOTEsIGUpKTtlLmNhbGwoZCk7fX19dmFyIGpoID0gbmV3IGFhLkNvbXBvbmVudCgpLnJlZnM7ZnVuY3Rpb24ga2goYSwgYiwgYywgZCkge2IgPSBhLm1lbW9pemVkU3RhdGU7YyA9IGMoZCwgYik7YyA9IG51bGwgPT09IGMgfHwgdm9pZCAwID09PSBjID8gYiA6IEEoe30sIGIsIGMpO2EubWVtb2l6ZWRTdGF0ZSA9IGM7MCA9PT0gYS5sYW5lcyAmJiAoYS51cGRhdGVRdWV1ZS5iYXNlU3RhdGUgPSBjKTt9CiAgICAgICAgICB2YXIgbmggPSB7IGlzTW91bnRlZDogZnVuY3Rpb24gaXNNb3VudGVkKGEpIHtyZXR1cm4gKGEgPSBhLl9yZWFjdEludGVybmFscykgPyBWYihhKSA9PT0gYSA6ICExO30sIGVucXVldWVTZXRTdGF0ZTogZnVuY3Rpb24gZW5xdWV1ZVNldFN0YXRlKGEsIGIsIGMpIHthID0gYS5fcmVhY3RJbnRlcm5hbHM7dmFyIGQgPSBMKCksZSA9IGxoKGEpLGYgPSBjaChkLCBlKTtmLnBheWxvYWQgPSBiO3ZvaWQgMCAhPT0gYyAmJiBudWxsICE9PSBjICYmIChmLmNhbGxiYWNrID0gYyk7YiA9IGRoKGEsIGYsIGUpO251bGwgIT09IGIgJiYgKG1oKGIsIGEsIGUsIGQpLCBlaChiLCBhLCBlKSk7fSwgZW5xdWV1ZVJlcGxhY2VTdGF0ZTogZnVuY3Rpb24gZW5xdWV1ZVJlcGxhY2VTdGF0ZShhLCBiLCBjKSB7YSA9IGEuX3JlYWN0SW50ZXJuYWxzO3ZhciBkID0gTCgpLGUgPSBsaChhKSxmID0gY2goZCwgZSk7Zi50YWcgPSAxO2YucGF5bG9hZCA9IGI7dm9pZCAwICE9PSBjICYmIG51bGwgIT09IGMgJiYgKGYuY2FsbGJhY2sgPSBjKTtiID0gZGgoYSwgZiwgZSk7bnVsbCAhPT0gYiAmJiAobWgoYiwgYSwgZSwgZCksIGVoKGIsIGEsIGUpKTt9LCBlbnF1ZXVlRm9yY2VVcGRhdGU6IGZ1bmN0aW9uIGVucXVldWVGb3JjZVVwZGF0ZShhLCBiKSB7YSA9IGEuX3JlYWN0SW50ZXJuYWxzO3ZhciBjID0gTCgpLGQgPQogICAgICAgICAgICAgICAgbGgoYSksZSA9IGNoKGMsIGQpO2UudGFnID0gMjt2b2lkIDAgIT09IGIgJiYgbnVsbCAhPT0gYiAmJiAoZS5jYWxsYmFjayA9IGIpO2IgPSBkaChhLCBlLCBkKTtudWxsICE9PSBiICYmIChtaChiLCBhLCBkLCBjKSwgZWgoYiwgYSwgZCkpO30gfTtmdW5jdGlvbiBvaChhLCBiLCBjLCBkLCBlLCBmLCBnKSB7YSA9IGEuc3RhdGVOb2RlO3JldHVybiAiZnVuY3Rpb24iID09PSB0eXBlb2YgYS5zaG91bGRDb21wb25lbnRVcGRhdGUgPyBhLnNob3VsZENvbXBvbmVudFVwZGF0ZShkLCBmLCBnKSA6IGIucHJvdG90eXBlICYmIGIucHJvdG90eXBlLmlzUHVyZVJlYWN0Q29tcG9uZW50ID8gIUllKGMsIGQpIHx8ICFJZShlLCBmKSA6ICEwO30KICAgICAgICAgIGZ1bmN0aW9uIHBoKGEsIGIsIGMpIHt2YXIgZCA9ICExLGUgPSBWZjt2YXIgZiA9IGIuY29udGV4dFR5cGU7Im9iamVjdCIgPT09IHR5cGVvZiBmICYmIG51bGwgIT09IGYgPyBmID0gVmcoZikgOiAoZSA9IFpmKGIpID8gWGYgOiBILmN1cnJlbnQsIGQgPSBiLmNvbnRleHRUeXBlcywgZiA9IChkID0gbnVsbCAhPT0gZCAmJiB2b2lkIDAgIT09IGQpID8gWWYoYSwgZSkgOiBWZik7YiA9IG5ldyBiKGMsIGYpO2EubWVtb2l6ZWRTdGF0ZSA9IG51bGwgIT09IGIuc3RhdGUgJiYgdm9pZCAwICE9PSBiLnN0YXRlID8gYi5zdGF0ZSA6IG51bGw7Yi51cGRhdGVyID0gbmg7YS5zdGF0ZU5vZGUgPSBiO2IuX3JlYWN0SW50ZXJuYWxzID0gYTtkICYmIChhID0gYS5zdGF0ZU5vZGUsIGEuX19yZWFjdEludGVybmFsTWVtb2l6ZWRVbm1hc2tlZENoaWxkQ29udGV4dCA9IGUsIGEuX19yZWFjdEludGVybmFsTWVtb2l6ZWRNYXNrZWRDaGlsZENvbnRleHQgPSBmKTtyZXR1cm4gYjt9CiAgICAgICAgICBmdW5jdGlvbiBxaChhLCBiLCBjLCBkKSB7YSA9IGIuc3RhdGU7ImZ1bmN0aW9uIiA9PT0gdHlwZW9mIGIuY29tcG9uZW50V2lsbFJlY2VpdmVQcm9wcyAmJiBiLmNvbXBvbmVudFdpbGxSZWNlaXZlUHJvcHMoYywgZCk7ImZ1bmN0aW9uIiA9PT0gdHlwZW9mIGIuVU5TQUZFX2NvbXBvbmVudFdpbGxSZWNlaXZlUHJvcHMgJiYgYi5VTlNBRkVfY29tcG9uZW50V2lsbFJlY2VpdmVQcm9wcyhjLCBkKTtiLnN0YXRlICE9PSBhICYmIG5oLmVucXVldWVSZXBsYWNlU3RhdGUoYiwgYi5zdGF0ZSwgbnVsbCk7fQogICAgICAgICAgZnVuY3Rpb24gcmgoYSwgYiwgYywgZCkge3ZhciBlID0gYS5zdGF0ZU5vZGU7ZS5wcm9wcyA9IGM7ZS5zdGF0ZSA9IGEubWVtb2l6ZWRTdGF0ZTtlLnJlZnMgPSBqaDthaChhKTt2YXIgZiA9IGIuY29udGV4dFR5cGU7Im9iamVjdCIgPT09IHR5cGVvZiBmICYmIG51bGwgIT09IGYgPyBlLmNvbnRleHQgPSBWZyhmKSA6IChmID0gWmYoYikgPyBYZiA6IEguY3VycmVudCwgZS5jb250ZXh0ID0gWWYoYSwgZikpO2Uuc3RhdGUgPSBhLm1lbW9pemVkU3RhdGU7ZiA9IGIuZ2V0RGVyaXZlZFN0YXRlRnJvbVByb3BzOyJmdW5jdGlvbiIgPT09IHR5cGVvZiBmICYmIChraChhLCBiLCBmLCBjKSwgZS5zdGF0ZSA9IGEubWVtb2l6ZWRTdGF0ZSk7ImZ1bmN0aW9uIiA9PT0gdHlwZW9mIGIuZ2V0RGVyaXZlZFN0YXRlRnJvbVByb3BzIHx8ICJmdW5jdGlvbiIgPT09IHR5cGVvZiBlLmdldFNuYXBzaG90QmVmb3JlVXBkYXRlIHx8ICJmdW5jdGlvbiIgIT09IHR5cGVvZiBlLlVOU0FGRV9jb21wb25lbnRXaWxsTW91bnQgJiYgImZ1bmN0aW9uIiAhPT0gdHlwZW9mIGUuY29tcG9uZW50V2lsbE1vdW50IHx8IChiID0gZS5zdGF0ZSwKICAgICAgICAgICAgImZ1bmN0aW9uIiA9PT0gdHlwZW9mIGUuY29tcG9uZW50V2lsbE1vdW50ICYmIGUuY29tcG9uZW50V2lsbE1vdW50KCksICJmdW5jdGlvbiIgPT09IHR5cGVvZiBlLlVOU0FGRV9jb21wb25lbnRXaWxsTW91bnQgJiYgZS5VTlNBRkVfY29tcG9uZW50V2lsbE1vdW50KCksIGIgIT09IGUuc3RhdGUgJiYgbmguZW5xdWV1ZVJlcGxhY2VTdGF0ZShlLCBlLnN0YXRlLCBudWxsKSwgZ2goYSwgYywgZSwgZCksIGUuc3RhdGUgPSBhLm1lbW9pemVkU3RhdGUpOyJmdW5jdGlvbiIgPT09IHR5cGVvZiBlLmNvbXBvbmVudERpZE1vdW50ICYmIChhLmZsYWdzIHw9IDQxOTQzMDgpO30KICAgICAgICAgIGZ1bmN0aW9uIHNoKGEsIGIsIGMpIHthID0gYy5yZWY7aWYgKG51bGwgIT09IGEgJiYgImZ1bmN0aW9uIiAhPT0gdHlwZW9mIGEgJiYgIm9iamVjdCIgIT09IHR5cGVvZiBhKSB7aWYgKGMuX293bmVyKSB7YyA9IGMuX293bmVyO2lmIChjKSB7aWYgKDEgIT09IGMudGFnKSB0aHJvdyBFcnJvcihwKDMwOSkpO3ZhciBkID0gYy5zdGF0ZU5vZGU7fWlmICghZCkgdGhyb3cgRXJyb3IocCgxNDcsIGEpKTt2YXIgZSA9IGQsZiA9ICIiICsgYTtpZiAobnVsbCAhPT0gYiAmJiBudWxsICE9PSBiLnJlZiAmJiAiZnVuY3Rpb24iID09PSB0eXBlb2YgYi5yZWYgJiYgYi5yZWYuX3N0cmluZ1JlZiA9PT0gZikgcmV0dXJuIGIucmVmO2IgPSBmdW5jdGlvbiBiKGEpIHt2YXIgYiA9IGUucmVmcztiID09PSBqaCAmJiAoYiA9IGUucmVmcyA9IHt9KTtudWxsID09PSBhID8gZGVsZXRlIGJbZl0gOiBiW2ZdID0gYTt9O2IuX3N0cmluZ1JlZiA9IGY7cmV0dXJuIGI7fWlmICgic3RyaW5nIiAhPT0gdHlwZW9mIGEpIHRocm93IEVycm9yKHAoMjg0KSk7aWYgKCFjLl9vd25lcikgdGhyb3cgRXJyb3IocCgyOTAsIGEpKTt9cmV0dXJuIGE7fQogICAgICAgICAgZnVuY3Rpb24gdGgoYSwgYikge2EgPSBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwoYik7dGhyb3cgRXJyb3IocCgzMSwgIltvYmplY3QgT2JqZWN0XSIgPT09IGEgPyAib2JqZWN0IHdpdGgga2V5cyB7IiArIE9iamVjdC5rZXlzKGIpLmpvaW4oIiwgIikgKyAifSIgOiBhKSk7fWZ1bmN0aW9uIHVoKGEpIHt2YXIgYiA9IGEuX2luaXQ7cmV0dXJuIGIoYS5fcGF5bG9hZCk7fQogICAgICAgICAgZnVuY3Rpb24gdmgoYSkge2Z1bmN0aW9uIGIoYiwgYykge2lmIChhKSB7dmFyIGQgPSBiLmRlbGV0aW9ucztudWxsID09PSBkID8gKGIuZGVsZXRpb25zID0gW2NdLCBiLmZsYWdzIHw9IDE2KSA6IGQucHVzaChjKTt9fWZ1bmN0aW9uIGMoYywgZCkge2lmICghYSkgcmV0dXJuIG51bGw7Zm9yICg7IG51bGwgIT09IGQ7KSB7YihjLCBkKSwgZCA9IGQuc2libGluZzt9cmV0dXJuIG51bGw7fWZ1bmN0aW9uIGQoYSwgYikge2ZvciAoYSA9IG5ldyBNYXAoKTsgbnVsbCAhPT0gYjspIHtudWxsICE9PSBiLmtleSA/IGEuc2V0KGIua2V5LCBiKSA6IGEuc2V0KGIuaW5kZXgsIGIpLCBiID0gYi5zaWJsaW5nO31yZXR1cm4gYTt9ZnVuY3Rpb24gZShhLCBiKSB7YSA9IHdoKGEsIGIpO2EuaW5kZXggPSAwO2Euc2libGluZyA9IG51bGw7cmV0dXJuIGE7fWZ1bmN0aW9uIGYoYiwgYywgZCkge2IuaW5kZXggPSBkO2lmICghYSkgcmV0dXJuIGIuZmxhZ3MgfD0gMTA0ODU3NiwgYztkID0gYi5hbHRlcm5hdGU7aWYgKG51bGwgIT09IGQpIHJldHVybiBkID0gZC5pbmRleCwgZCA8IGMgPyAoYi5mbGFncyB8PSAyLCBjKSA6IGQ7Yi5mbGFncyB8PSAyO3JldHVybiBjO31mdW5jdGlvbiBnKGIpIHthICYmCiAgICAgICAgICAgICAgbnVsbCA9PT0gYi5hbHRlcm5hdGUgJiYgKGIuZmxhZ3MgfD0gMik7cmV0dXJuIGI7fWZ1bmN0aW9uIGgoYSwgYiwgYywgZCkge2lmIChudWxsID09PSBiIHx8IDYgIT09IGIudGFnKSByZXR1cm4gYiA9IHhoKGMsIGEubW9kZSwgZCksIGIucmV0dXJuID0gYSwgYjtiID0gZShiLCBjKTtiLnJldHVybiA9IGE7cmV0dXJuIGI7fWZ1bmN0aW9uIGsoYSwgYiwgYywgZCkge3ZhciBmID0gYy50eXBlO2lmIChmID09PSB5YSkgcmV0dXJuIG0oYSwgYiwgYy5wcm9wcy5jaGlsZHJlbiwgZCwgYy5rZXkpO2lmIChudWxsICE9PSBiICYmIChiLmVsZW1lbnRUeXBlID09PSBmIHx8ICJvYmplY3QiID09PSB0eXBlb2YgZiAmJiBudWxsICE9PSBmICYmIGYuJCR0eXBlb2YgPT09IEhhICYmIHVoKGYpID09PSBiLnR5cGUpKSByZXR1cm4gZCA9IGUoYiwgYy5wcm9wcyksIGQucmVmID0gc2goYSwgYiwgYyksIGQucmV0dXJuID0gYSwgZDtkID0geWgoYy50eXBlLCBjLmtleSwgYy5wcm9wcywgbnVsbCwgYS5tb2RlLCBkKTtkLnJlZiA9IHNoKGEsIGIsIGMpO2QucmV0dXJuID0gYTtyZXR1cm4gZDt9ZnVuY3Rpb24gbChhLCBiLCBjLCBkKSB7aWYgKG51bGwgPT09IGIgfHwgNCAhPT0gYi50YWcgfHwKICAgICAgICAgICAgICBiLnN0YXRlTm9kZS5jb250YWluZXJJbmZvICE9PSBjLmNvbnRhaW5lckluZm8gfHwgYi5zdGF0ZU5vZGUuaW1wbGVtZW50YXRpb24gIT09IGMuaW1wbGVtZW50YXRpb24pIHJldHVybiBiID0gemgoYywgYS5tb2RlLCBkKSwgYi5yZXR1cm4gPSBhLCBiO2IgPSBlKGIsIGMuY2hpbGRyZW4gfHwgW10pO2IucmV0dXJuID0gYTtyZXR1cm4gYjt9ZnVuY3Rpb24gbShhLCBiLCBjLCBkLCBmKSB7aWYgKG51bGwgPT09IGIgfHwgNyAhPT0gYi50YWcpIHJldHVybiBiID0gQWgoYywgYS5tb2RlLCBkLCBmKSwgYi5yZXR1cm4gPSBhLCBiO2IgPSBlKGIsIGMpO2IucmV0dXJuID0gYTtyZXR1cm4gYjt9ZnVuY3Rpb24gcShhLCBiLCBjKSB7aWYgKCJzdHJpbmciID09PSB0eXBlb2YgYiAmJiAiIiAhPT0gYiB8fCAibnVtYmVyIiA9PT0gdHlwZW9mIGIpIHJldHVybiBiID0geGgoIiIgKyBiLCBhLm1vZGUsIGMpLCBiLnJldHVybiA9IGEsIGI7aWYgKCJvYmplY3QiID09PSB0eXBlb2YgYiAmJiBudWxsICE9PSBiKSB7c3dpdGNoIChiLiQkdHlwZW9mKSB7Y2FzZSB2YTpyZXR1cm4gYyA9IHloKGIudHlwZSwgYi5rZXksIGIucHJvcHMsIG51bGwsIGEubW9kZSwgYyksCiAgICAgICAgICAgICAgICAgICAgYy5yZWYgPSBzaChhLCBudWxsLCBiKSwgYy5yZXR1cm4gPSBhLCBjO2Nhc2Ugd2E6cmV0dXJuIGIgPSB6aChiLCBhLm1vZGUsIGMpLCBiLnJldHVybiA9IGEsIGI7Y2FzZSBIYTp2YXIgZCA9IGIuX2luaXQ7cmV0dXJuIHEoYSwgZChiLl9wYXlsb2FkKSwgYyk7fWlmIChlYihiKSB8fCBLYShiKSkgcmV0dXJuIGIgPSBBaChiLCBhLm1vZGUsIGMsIG51bGwpLCBiLnJldHVybiA9IGEsIGI7dGgoYSwgYik7fXJldHVybiBudWxsO31mdW5jdGlvbiByKGEsIGIsIGMsIGQpIHt2YXIgZSA9IG51bGwgIT09IGIgPyBiLmtleSA6IG51bGw7aWYgKCJzdHJpbmciID09PSB0eXBlb2YgYyAmJiAiIiAhPT0gYyB8fCAibnVtYmVyIiA9PT0gdHlwZW9mIGMpIHJldHVybiBudWxsICE9PSBlID8gbnVsbCA6IGgoYSwgYiwgIiIgKyBjLCBkKTtpZiAoIm9iamVjdCIgPT09IHR5cGVvZiBjICYmIG51bGwgIT09IGMpIHtzd2l0Y2ggKGMuJCR0eXBlb2YpIHtjYXNlIHZhOnJldHVybiBjLmtleSA9PT0gZSA/IGsoYSwgYiwgYywgZCkgOiBudWxsO2Nhc2Ugd2E6cmV0dXJuIGMua2V5ID09PSBlID8gbChhLCBiLCBjLCBkKSA6IG51bGw7Y2FzZSBIYTpyZXR1cm4gZSA9IGMuX2luaXQsIHIoYSwKICAgICAgICAgICAgICAgICAgICBiLCBlKGMuX3BheWxvYWQpLCBkKTt9aWYgKGViKGMpIHx8IEthKGMpKSByZXR1cm4gbnVsbCAhPT0gZSA/IG51bGwgOiBtKGEsIGIsIGMsIGQsIG51bGwpO3RoKGEsIGMpO31yZXR1cm4gbnVsbDt9ZnVuY3Rpb24geShhLCBiLCBjLCBkLCBlKSB7aWYgKCJzdHJpbmciID09PSB0eXBlb2YgZCAmJiAiIiAhPT0gZCB8fCAibnVtYmVyIiA9PT0gdHlwZW9mIGQpIHJldHVybiBhID0gYS5nZXQoYykgfHwgbnVsbCwgaChiLCBhLCAiIiArIGQsIGUpO2lmICgib2JqZWN0IiA9PT0gdHlwZW9mIGQgJiYgbnVsbCAhPT0gZCkge3N3aXRjaCAoZC4kJHR5cGVvZikge2Nhc2UgdmE6cmV0dXJuIGEgPSBhLmdldChudWxsID09PSBkLmtleSA/IGMgOiBkLmtleSkgfHwgbnVsbCwgayhiLCBhLCBkLCBlKTtjYXNlIHdhOnJldHVybiBhID0gYS5nZXQobnVsbCA9PT0gZC5rZXkgPyBjIDogZC5rZXkpIHx8IG51bGwsIGwoYiwgYSwgZCwgZSk7Y2FzZSBIYTp2YXIgZiA9IGQuX2luaXQ7cmV0dXJuIHkoYSwgYiwgYywgZihkLl9wYXlsb2FkKSwgZSk7fWlmIChlYihkKSB8fCBLYShkKSkgcmV0dXJuIGEgPSBhLmdldChjKSB8fCBudWxsLCBtKGIsIGEsIGQsIGUsIG51bGwpO3RoKGIsIGQpO31yZXR1cm4gbnVsbDt9CiAgICAgICAgICAgIGZ1bmN0aW9uIG4oZSwgZywgaCwgaykge2ZvciAodmFyIGwgPSBudWxsLCBtID0gbnVsbCwgdSA9IGcsIHcgPSBnID0gMCwgeCA9IG51bGw7IG51bGwgIT09IHUgJiYgdyA8IGgubGVuZ3RoOyB3KyspIHt1LmluZGV4ID4gdyA/ICh4ID0gdSwgdSA9IG51bGwpIDogeCA9IHUuc2libGluZzt2YXIgbiA9IHIoZSwgdSwgaFt3XSwgayk7aWYgKG51bGwgPT09IG4pIHtudWxsID09PSB1ICYmICh1ID0geCk7YnJlYWs7fWEgJiYgdSAmJiBudWxsID09PSBuLmFsdGVybmF0ZSAmJiBiKGUsIHUpO2cgPSBmKG4sIGcsIHcpO251bGwgPT09IG0gPyBsID0gbiA6IG0uc2libGluZyA9IG47bSA9IG47dSA9IHg7fWlmICh3ID09PSBoLmxlbmd0aCkgcmV0dXJuIGMoZSwgdSksIEkgJiYgdGcoZSwgdyksIGw7aWYgKG51bGwgPT09IHUpIHtmb3IgKDsgdyA8IGgubGVuZ3RoOyB3KyspIHt1ID0gcShlLCBoW3ddLCBrKSwgbnVsbCAhPT0gdSAmJiAoZyA9IGYodSwgZywgdyksIG51bGwgPT09IG0gPyBsID0gdSA6IG0uc2libGluZyA9IHUsIG0gPSB1KTt9SSAmJiB0ZyhlLCB3KTtyZXR1cm4gbDt9Zm9yICh1ID0gZChlLCB1KTsgdyA8IGgubGVuZ3RoOyB3KyspIHt4ID0geSh1LCBlLCB3LCBoW3ddLCBrKSwgbnVsbCAhPT0geCAmJiAoYSAmJiBudWxsICE9PSB4LmFsdGVybmF0ZSAmJiB1LmRlbGV0ZShudWxsID09PQogICAgICAgICAgICAgICAgeC5rZXkgPyB3IDogeC5rZXkpLCBnID0gZih4LCBnLCB3KSwgbnVsbCA9PT0gbSA/IGwgPSB4IDogbS5zaWJsaW5nID0geCwgbSA9IHgpO31hICYmIHUuZm9yRWFjaChmdW5jdGlvbiAoYSkge3JldHVybiBiKGUsIGEpO30pO0kgJiYgdGcoZSwgdyk7cmV0dXJuIGw7fWZ1bmN0aW9uIHQoZSwgZywgaCwgaykge3ZhciBsID0gS2EoaCk7aWYgKCJmdW5jdGlvbiIgIT09IHR5cGVvZiBsKSB0aHJvdyBFcnJvcihwKDE1MCkpO2ggPSBsLmNhbGwoaCk7aWYgKG51bGwgPT0gaCkgdGhyb3cgRXJyb3IocCgxNTEpKTtmb3IgKHZhciB1ID0gbCA9IG51bGwsIG0gPSBnLCB3ID0gZyA9IDAsIHggPSBudWxsLCBuID0gaC5uZXh0KCk7IG51bGwgIT09IG0gJiYgIW4uZG9uZTsgdysrLCBuID0gaC5uZXh0KCkpIHttLmluZGV4ID4gdyA/ICh4ID0gbSwgbSA9IG51bGwpIDogeCA9IG0uc2libGluZzt2YXIgdCA9IHIoZSwgbSwgbi52YWx1ZSwgayk7aWYgKG51bGwgPT09IHQpIHtudWxsID09PSBtICYmIChtID0geCk7YnJlYWs7fWEgJiYgbSAmJiBudWxsID09PSB0LmFsdGVybmF0ZSAmJiBiKGUsIG0pO2cgPSBmKHQsIGcsIHcpO251bGwgPT09IHUgPyBsID0gdCA6IHUuc2libGluZyA9IHQ7dSA9IHQ7bSA9IHg7fWlmIChuLmRvbmUpIHJldHVybiBjKGUsCiAgICAgICAgICAgICAgbSksIEkgJiYgdGcoZSwgdyksIGw7aWYgKG51bGwgPT09IG0pIHtmb3IgKDsgIW4uZG9uZTsgdysrLCBuID0gaC5uZXh0KCkpIHtuID0gcShlLCBuLnZhbHVlLCBrKSwgbnVsbCAhPT0gbiAmJiAoZyA9IGYobiwgZywgdyksIG51bGwgPT09IHUgPyBsID0gbiA6IHUuc2libGluZyA9IG4sIHUgPSBuKTt9SSAmJiB0ZyhlLCB3KTtyZXR1cm4gbDt9Zm9yIChtID0gZChlLCBtKTsgIW4uZG9uZTsgdysrLCBuID0gaC5uZXh0KCkpIHtuID0geShtLCBlLCB3LCBuLnZhbHVlLCBrKSwgbnVsbCAhPT0gbiAmJiAoYSAmJiBudWxsICE9PSBuLmFsdGVybmF0ZSAmJiBtLmRlbGV0ZShudWxsID09PSBuLmtleSA/IHcgOiBuLmtleSksIGcgPSBmKG4sIGcsIHcpLCBudWxsID09PSB1ID8gbCA9IG4gOiB1LnNpYmxpbmcgPSBuLCB1ID0gbik7fWEgJiYgbS5mb3JFYWNoKGZ1bmN0aW9uIChhKSB7cmV0dXJuIGIoZSwgYSk7fSk7SSAmJiB0ZyhlLCB3KTtyZXR1cm4gbDt9ZnVuY3Rpb24gSihhLCBkLCBmLCBoKSB7Im9iamVjdCIgPT09IHR5cGVvZiBmICYmIG51bGwgIT09IGYgJiYgZi50eXBlID09PSB5YSAmJiBudWxsID09PSBmLmtleSAmJiAoZiA9IGYucHJvcHMuY2hpbGRyZW4pO2lmICgib2JqZWN0IiA9PT0gdHlwZW9mIGYgJiYgbnVsbCAhPT0gZikge3N3aXRjaCAoZi4kJHR5cGVvZikge2Nhc2UgdmE6YToge2ZvciAodmFyIGsgPQogICAgICAgICAgICAgICAgICAgICAgICBmLmtleSwgbCA9IGQ7IG51bGwgIT09IGw7KSB7aWYgKGwua2V5ID09PSBrKSB7ayA9IGYudHlwZTtpZiAoayA9PT0geWEpIHtpZiAoNyA9PT0gbC50YWcpIHtjKGEsIGwuc2libGluZyk7ZCA9IGUobCwgZi5wcm9wcy5jaGlsZHJlbik7ZC5yZXR1cm4gPSBhO2EgPSBkO2JyZWFrIGE7fX0gZWxzZSBpZiAobC5lbGVtZW50VHlwZSA9PT0gayB8fCAib2JqZWN0IiA9PT0gdHlwZW9mIGsgJiYgbnVsbCAhPT0gayAmJiBrLiQkdHlwZW9mID09PSBIYSAmJiB1aChrKSA9PT0gbC50eXBlKSB7YyhhLCBsLnNpYmxpbmcpO2QgPSBlKGwsIGYucHJvcHMpO2QucmVmID0gc2goYSwgbCwgZik7ZC5yZXR1cm4gPSBhO2EgPSBkO2JyZWFrIGE7fWMoYSwgbCk7YnJlYWs7fSBlbHNlIGIoYSwgbCk7bCA9IGwuc2libGluZzt9Zi50eXBlID09PSB5YSA/IChkID0gQWgoZi5wcm9wcy5jaGlsZHJlbiwgYS5tb2RlLCBoLCBmLmtleSksIGQucmV0dXJuID0gYSwgYSA9IGQpIDogKGggPSB5aChmLnR5cGUsIGYua2V5LCBmLnByb3BzLCBudWxsLCBhLm1vZGUsIGgpLCBoLnJlZiA9IHNoKGEsIGQsIGYpLCBoLnJldHVybiA9IGEsIGEgPSBoKTt9cmV0dXJuIGcoYSk7Y2FzZSB3YTphOiB7Zm9yIChsID0gZi5rZXk7IG51bGwgIT09CiAgICAgICAgICAgICAgICAgICAgICBkOykge2lmIChkLmtleSA9PT0gbCkge2lmICg0ID09PSBkLnRhZyAmJiBkLnN0YXRlTm9kZS5jb250YWluZXJJbmZvID09PSBmLmNvbnRhaW5lckluZm8gJiYgZC5zdGF0ZU5vZGUuaW1wbGVtZW50YXRpb24gPT09IGYuaW1wbGVtZW50YXRpb24pIHtjKGEsIGQuc2libGluZyk7ZCA9IGUoZCwgZi5jaGlsZHJlbiB8fCBbXSk7ZC5yZXR1cm4gPSBhO2EgPSBkO2JyZWFrIGE7fSBlbHNlIHtjKGEsIGQpO2JyZWFrO319IGVsc2UgYihhLCBkKTtkID0gZC5zaWJsaW5nO31kID0gemgoZiwgYS5tb2RlLCBoKTtkLnJldHVybiA9IGE7YSA9IGQ7fXJldHVybiBnKGEpO2Nhc2UgSGE6cmV0dXJuIGwgPSBmLl9pbml0LCBKKGEsIGQsIGwoZi5fcGF5bG9hZCksIGgpO31pZiAoZWIoZikpIHJldHVybiBuKGEsIGQsIGYsIGgpO2lmIChLYShmKSkgcmV0dXJuIHQoYSwgZCwgZiwgaCk7dGgoYSwgZik7fXJldHVybiAic3RyaW5nIiA9PT0gdHlwZW9mIGYgJiYgIiIgIT09IGYgfHwgIm51bWJlciIgPT09IHR5cGVvZiBmID8gKGYgPSAiIiArIGYsIG51bGwgIT09IGQgJiYgNiA9PT0gZC50YWcgPyAoYyhhLCBkLnNpYmxpbmcpLCBkID0gZShkLCBmKSwgZC5yZXR1cm4gPSBhLCBhID0gZCkgOiAoCiAgICAgICAgICAgICAgYyhhLCBkKSwgZCA9IHhoKGYsIGEubW9kZSwgaCksIGQucmV0dXJuID0gYSwgYSA9IGQpLCBnKGEpKSA6IGMoYSwgZCk7fXJldHVybiBKO312YXIgQmggPSB2aCghMCksQ2ggPSB2aCghMSksRGggPSB7fSxFaCA9IFVmKERoKSxGaCA9IFVmKERoKSxHaCA9IFVmKERoKTtmdW5jdGlvbiBIaChhKSB7aWYgKGEgPT09IERoKSB0aHJvdyBFcnJvcihwKDE3NCkpO3JldHVybiBhO31mdW5jdGlvbiBJaChhLCBiKSB7RyhHaCwgYik7RyhGaCwgYSk7RyhFaCwgRGgpO2EgPSBiLm5vZGVUeXBlO3N3aXRjaCAoYSkge2Nhc2UgOTpjYXNlIDExOmIgPSAoYiA9IGIuZG9jdW1lbnRFbGVtZW50KSA/IGIubmFtZXNwYWNlVVJJIDogbGIobnVsbCwgIiIpO2JyZWFrO2RlZmF1bHQ6YSA9IDggPT09IGEgPyBiLnBhcmVudE5vZGUgOiBiLCBiID0gYS5uYW1lc3BhY2VVUkkgfHwgbnVsbCwgYSA9IGEudGFnTmFtZSwgYiA9IGxiKGIsIGEpO31FKEVoKTtHKEVoLCBiKTt9ZnVuY3Rpb24gSmgoKSB7RShFaCk7RShGaCk7RShHaCk7fQogICAgICAgICAgZnVuY3Rpb24gS2goYSkge0hoKEdoLmN1cnJlbnQpO3ZhciBiID0gSGgoRWguY3VycmVudCk7dmFyIGMgPSBsYihiLCBhLnR5cGUpO2IgIT09IGMgJiYgKEcoRmgsIGEpLCBHKEVoLCBjKSk7fWZ1bmN0aW9uIExoKGEpIHtGaC5jdXJyZW50ID09PSBhICYmIChFKEVoKSwgRShGaCkpO312YXIgTSA9IFVmKDApOwogICAgICAgICAgZnVuY3Rpb24gTWgoYSkge2ZvciAodmFyIGIgPSBhOyBudWxsICE9PSBiOykge2lmICgxMyA9PT0gYi50YWcpIHt2YXIgYyA9IGIubWVtb2l6ZWRTdGF0ZTtpZiAobnVsbCAhPT0gYyAmJiAoYyA9IGMuZGVoeWRyYXRlZCwgbnVsbCA9PT0gYyB8fCAiJD8iID09PSBjLmRhdGEgfHwgIiQhIiA9PT0gYy5kYXRhKSkgcmV0dXJuIGI7fSBlbHNlIGlmICgxOSA9PT0gYi50YWcgJiYgdm9pZCAwICE9PSBiLm1lbW9pemVkUHJvcHMucmV2ZWFsT3JkZXIpIHtpZiAoMCAhPT0gKGIuZmxhZ3MgJiAxMjgpKSByZXR1cm4gYjt9IGVsc2UgaWYgKG51bGwgIT09IGIuY2hpbGQpIHtiLmNoaWxkLnJldHVybiA9IGI7YiA9IGIuY2hpbGQ7Y29udGludWU7fWlmIChiID09PSBhKSBicmVhaztmb3IgKDsgbnVsbCA9PT0gYi5zaWJsaW5nOykge2lmIChudWxsID09PSBiLnJldHVybiB8fCBiLnJldHVybiA9PT0gYSkgcmV0dXJuIG51bGw7YiA9IGIucmV0dXJuO31iLnNpYmxpbmcucmV0dXJuID0gYi5yZXR1cm47YiA9IGIuc2libGluZzt9cmV0dXJuIG51bGw7fXZhciBOaCA9IFtdOwogICAgICAgICAgZnVuY3Rpb24gT2goKSB7Zm9yICh2YXIgYSA9IDA7IGEgPCBOaC5sZW5ndGg7IGErKykge05oW2FdLl93b3JrSW5Qcm9ncmVzc1ZlcnNpb25QcmltYXJ5ID0gbnVsbDt9TmgubGVuZ3RoID0gMDt9dmFyIFBoID0gdWEuUmVhY3RDdXJyZW50RGlzcGF0Y2hlcixRaCA9IHVhLlJlYWN0Q3VycmVudEJhdGNoQ29uZmlnLFJoID0gMCxOID0gbnVsbCxPID0gbnVsbCxQID0gbnVsbCxTaCA9ICExLFRoID0gITEsVWggPSAwLFZoID0gMDtmdW5jdGlvbiBRKCkge3Rocm93IEVycm9yKHAoMzIxKSk7fWZ1bmN0aW9uIFdoKGEsIGIpIHtpZiAobnVsbCA9PT0gYikgcmV0dXJuICExO2ZvciAodmFyIGMgPSAwOyBjIDwgYi5sZW5ndGggJiYgYyA8IGEubGVuZ3RoOyBjKyspIHtpZiAoIUhlKGFbY10sIGJbY10pKSByZXR1cm4gITE7fXJldHVybiAhMDt9CiAgICAgICAgICBmdW5jdGlvbiBYaChhLCBiLCBjLCBkLCBlLCBmKSB7UmggPSBmO04gPSBiO2IubWVtb2l6ZWRTdGF0ZSA9IG51bGw7Yi51cGRhdGVRdWV1ZSA9IG51bGw7Yi5sYW5lcyA9IDA7UGguY3VycmVudCA9IG51bGwgPT09IGEgfHwgbnVsbCA9PT0gYS5tZW1vaXplZFN0YXRlID8gWWggOiBaaDthID0gYyhkLCBlKTtpZiAoVGgpIHtmID0gMDtkbyB7VGggPSAhMTtVaCA9IDA7aWYgKDI1IDw9IGYpIHRocm93IEVycm9yKHAoMzAxKSk7ZiArPSAxO1AgPSBPID0gbnVsbDtiLnVwZGF0ZVF1ZXVlID0gbnVsbDtQaC5jdXJyZW50ID0gJGg7YSA9IGMoZCwgZSk7fSB3aGlsZSAoVGgpO31QaC5jdXJyZW50ID0gYWk7YiA9IG51bGwgIT09IE8gJiYgbnVsbCAhPT0gTy5uZXh0O1JoID0gMDtQID0gTyA9IE4gPSBudWxsO1NoID0gITE7aWYgKGIpIHRocm93IEVycm9yKHAoMzAwKSk7cmV0dXJuIGE7fWZ1bmN0aW9uIGJpKCkge3ZhciBhID0gMCAhPT0gVWg7VWggPSAwO3JldHVybiBhO30KICAgICAgICAgIGZ1bmN0aW9uIGNpKCkge3ZhciBhID0geyBtZW1vaXplZFN0YXRlOiBudWxsLCBiYXNlU3RhdGU6IG51bGwsIGJhc2VRdWV1ZTogbnVsbCwgcXVldWU6IG51bGwsIG5leHQ6IG51bGwgfTtudWxsID09PSBQID8gTi5tZW1vaXplZFN0YXRlID0gUCA9IGEgOiBQID0gUC5uZXh0ID0gYTtyZXR1cm4gUDt9ZnVuY3Rpb24gZGkoKSB7aWYgKG51bGwgPT09IE8pIHt2YXIgYSA9IE4uYWx0ZXJuYXRlO2EgPSBudWxsICE9PSBhID8gYS5tZW1vaXplZFN0YXRlIDogbnVsbDt9IGVsc2UgYSA9IE8ubmV4dDt2YXIgYiA9IG51bGwgPT09IFAgPyBOLm1lbW9pemVkU3RhdGUgOiBQLm5leHQ7aWYgKG51bGwgIT09IGIpIFAgPSBiLCBPID0gYTtlbHNlIHtpZiAobnVsbCA9PT0gYSkgdGhyb3cgRXJyb3IocCgzMTApKTtPID0gYTthID0geyBtZW1vaXplZFN0YXRlOiBPLm1lbW9pemVkU3RhdGUsIGJhc2VTdGF0ZTogTy5iYXNlU3RhdGUsIGJhc2VRdWV1ZTogTy5iYXNlUXVldWUsIHF1ZXVlOiBPLnF1ZXVlLCBuZXh0OiBudWxsIH07bnVsbCA9PT0gUCA/IE4ubWVtb2l6ZWRTdGF0ZSA9IFAgPSBhIDogUCA9IFAubmV4dCA9IGE7fXJldHVybiBQO30KICAgICAgICAgIGZ1bmN0aW9uIGVpKGEsIGIpIHtyZXR1cm4gImZ1bmN0aW9uIiA9PT0gdHlwZW9mIGIgPyBiKGEpIDogYjt9CiAgICAgICAgICBmdW5jdGlvbiBmaShhKSB7dmFyIGIgPSBkaSgpLGMgPSBiLnF1ZXVlO2lmIChudWxsID09PSBjKSB0aHJvdyBFcnJvcihwKDMxMSkpO2MubGFzdFJlbmRlcmVkUmVkdWNlciA9IGE7dmFyIGQgPSBPLGUgPSBkLmJhc2VRdWV1ZSxmID0gYy5wZW5kaW5nO2lmIChudWxsICE9PSBmKSB7aWYgKG51bGwgIT09IGUpIHt2YXIgZyA9IGUubmV4dDtlLm5leHQgPSBmLm5leHQ7Zi5uZXh0ID0gZzt9ZC5iYXNlUXVldWUgPSBlID0gZjtjLnBlbmRpbmcgPSBudWxsO31pZiAobnVsbCAhPT0gZSkge2YgPSBlLm5leHQ7ZCA9IGQuYmFzZVN0YXRlO3ZhciBoID0gZyA9IG51bGwsayA9IG51bGwsbCA9IGY7ZG8ge3ZhciBtID0gbC5sYW5lO2lmICgoUmggJiBtKSA9PT0gbSkgbnVsbCAhPT0gayAmJiAoayA9IGsubmV4dCA9IHsgbGFuZTogMCwgYWN0aW9uOiBsLmFjdGlvbiwgaGFzRWFnZXJTdGF0ZTogbC5oYXNFYWdlclN0YXRlLCBlYWdlclN0YXRlOiBsLmVhZ2VyU3RhdGUsIG5leHQ6IG51bGwgfSksIGQgPSBsLmhhc0VhZ2VyU3RhdGUgPyBsLmVhZ2VyU3RhdGUgOiBhKGQsIGwuYWN0aW9uKTtlbHNlIHt2YXIgcSA9IHsgbGFuZTogbSwgYWN0aW9uOiBsLmFjdGlvbiwgaGFzRWFnZXJTdGF0ZTogbC5oYXNFYWdlclN0YXRlLAogICAgICAgICAgICAgICAgICAgIGVhZ2VyU3RhdGU6IGwuZWFnZXJTdGF0ZSwgbmV4dDogbnVsbCB9O251bGwgPT09IGsgPyAoaCA9IGsgPSBxLCBnID0gZCkgOiBrID0gay5uZXh0ID0gcTtOLmxhbmVzIHw9IG07aGggfD0gbTt9bCA9IGwubmV4dDt9IHdoaWxlIChudWxsICE9PSBsICYmIGwgIT09IGYpO251bGwgPT09IGsgPyBnID0gZCA6IGsubmV4dCA9IGg7SGUoZCwgYi5tZW1vaXplZFN0YXRlKSB8fCAoVWcgPSAhMCk7Yi5tZW1vaXplZFN0YXRlID0gZDtiLmJhc2VTdGF0ZSA9IGc7Yi5iYXNlUXVldWUgPSBrO2MubGFzdFJlbmRlcmVkU3RhdGUgPSBkO31hID0gYy5pbnRlcmxlYXZlZDtpZiAobnVsbCAhPT0gYSkge2UgPSBhO2RvIHtmID0gZS5sYW5lLCBOLmxhbmVzIHw9IGYsIGhoIHw9IGYsIGUgPSBlLm5leHQ7fSB3aGlsZSAoZSAhPT0gYSk7fSBlbHNlIG51bGwgPT09IGUgJiYgKGMubGFuZXMgPSAwKTtyZXR1cm4gW2IubWVtb2l6ZWRTdGF0ZSwgYy5kaXNwYXRjaF07fQogICAgICAgICAgZnVuY3Rpb24gZ2koYSkge3ZhciBiID0gZGkoKSxjID0gYi5xdWV1ZTtpZiAobnVsbCA9PT0gYykgdGhyb3cgRXJyb3IocCgzMTEpKTtjLmxhc3RSZW5kZXJlZFJlZHVjZXIgPSBhO3ZhciBkID0gYy5kaXNwYXRjaCxlID0gYy5wZW5kaW5nLGYgPSBiLm1lbW9pemVkU3RhdGU7aWYgKG51bGwgIT09IGUpIHtjLnBlbmRpbmcgPSBudWxsO3ZhciBnID0gZSA9IGUubmV4dDtkbyB7ZiA9IGEoZiwgZy5hY3Rpb24pLCBnID0gZy5uZXh0O30gd2hpbGUgKGcgIT09IGUpO0hlKGYsIGIubWVtb2l6ZWRTdGF0ZSkgfHwgKFVnID0gITApO2IubWVtb2l6ZWRTdGF0ZSA9IGY7bnVsbCA9PT0gYi5iYXNlUXVldWUgJiYgKGIuYmFzZVN0YXRlID0gZik7Yy5sYXN0UmVuZGVyZWRTdGF0ZSA9IGY7fXJldHVybiBbZiwgZF07fWZ1bmN0aW9uIGhpKCkge30KICAgICAgICAgIGZ1bmN0aW9uIGlpKGEsIGIpIHt2YXIgYyA9IE4sZCA9IGRpKCksZSA9IGIoKSxmID0gIUhlKGQubWVtb2l6ZWRTdGF0ZSwgZSk7ZiAmJiAoZC5tZW1vaXplZFN0YXRlID0gZSwgVWcgPSAhMCk7ZCA9IGQucXVldWU7amkoa2kuYmluZChudWxsLCBjLCBkLCBhKSwgW2FdKTtpZiAoZC5nZXRTbmFwc2hvdCAhPT0gYiB8fCBmIHx8IG51bGwgIT09IFAgJiYgUC5tZW1vaXplZFN0YXRlLnRhZyAmIDEpIHtjLmZsYWdzIHw9IDIwNDg7bGkoOSwgbWkuYmluZChudWxsLCBjLCBkLCBlLCBiKSwgdm9pZCAwLCBudWxsKTtpZiAobnVsbCA9PT0gUikgdGhyb3cgRXJyb3IocCgzNDkpKTswICE9PSAoUmggJiAzMCkgfHwgbmkoYywgYiwgZSk7fXJldHVybiBlO31mdW5jdGlvbiBuaShhLCBiLCBjKSB7YS5mbGFncyB8PSAxNjM4NDthID0geyBnZXRTbmFwc2hvdDogYiwgdmFsdWU6IGMgfTtiID0gTi51cGRhdGVRdWV1ZTtudWxsID09PSBiID8gKGIgPSB7IGxhc3RFZmZlY3Q6IG51bGwsIHN0b3JlczogbnVsbCB9LCBOLnVwZGF0ZVF1ZXVlID0gYiwgYi5zdG9yZXMgPSBbYV0pIDogKGMgPSBiLnN0b3JlcywgbnVsbCA9PT0gYyA/IGIuc3RvcmVzID0gW2FdIDogYy5wdXNoKGEpKTt9CiAgICAgICAgICBmdW5jdGlvbiBtaShhLCBiLCBjLCBkKSB7Yi52YWx1ZSA9IGM7Yi5nZXRTbmFwc2hvdCA9IGQ7b2koYikgJiYgcGkoYSk7fWZ1bmN0aW9uIGtpKGEsIGIsIGMpIHtyZXR1cm4gYyhmdW5jdGlvbiAoKSB7b2koYikgJiYgcGkoYSk7fSk7fWZ1bmN0aW9uIG9pKGEpIHt2YXIgYiA9IGEuZ2V0U25hcHNob3Q7YSA9IGEudmFsdWU7dHJ5IHt2YXIgYyA9IGIoKTtyZXR1cm4gIUhlKGEsIGMpO30gY2F0Y2ggKGQpIHtyZXR1cm4gITA7fX1mdW5jdGlvbiBwaShhKSB7dmFyIGIgPSBaZyhhLCAxKTtudWxsICE9PSBiICYmIG1oKGIsIGEsIDEsIC0xKTt9CiAgICAgICAgICBmdW5jdGlvbiBxaShhKSB7dmFyIGIgPSBjaSgpOyJmdW5jdGlvbiIgPT09IHR5cGVvZiBhICYmIChhID0gYSgpKTtiLm1lbW9pemVkU3RhdGUgPSBiLmJhc2VTdGF0ZSA9IGE7YSA9IHsgcGVuZGluZzogbnVsbCwgaW50ZXJsZWF2ZWQ6IG51bGwsIGxhbmVzOiAwLCBkaXNwYXRjaDogbnVsbCwgbGFzdFJlbmRlcmVkUmVkdWNlcjogZWksIGxhc3RSZW5kZXJlZFN0YXRlOiBhIH07Yi5xdWV1ZSA9IGE7YSA9IGEuZGlzcGF0Y2ggPSByaS5iaW5kKG51bGwsIE4sIGEpO3JldHVybiBbYi5tZW1vaXplZFN0YXRlLCBhXTt9CiAgICAgICAgICBmdW5jdGlvbiBsaShhLCBiLCBjLCBkKSB7YSA9IHsgdGFnOiBhLCBjcmVhdGU6IGIsIGRlc3Ryb3k6IGMsIGRlcHM6IGQsIG5leHQ6IG51bGwgfTtiID0gTi51cGRhdGVRdWV1ZTtudWxsID09PSBiID8gKGIgPSB7IGxhc3RFZmZlY3Q6IG51bGwsIHN0b3JlczogbnVsbCB9LCBOLnVwZGF0ZVF1ZXVlID0gYiwgYi5sYXN0RWZmZWN0ID0gYS5uZXh0ID0gYSkgOiAoYyA9IGIubGFzdEVmZmVjdCwgbnVsbCA9PT0gYyA/IGIubGFzdEVmZmVjdCA9IGEubmV4dCA9IGEgOiAoZCA9IGMubmV4dCwgYy5uZXh0ID0gYSwgYS5uZXh0ID0gZCwgYi5sYXN0RWZmZWN0ID0gYSkpO3JldHVybiBhO31mdW5jdGlvbiBzaSgpIHtyZXR1cm4gZGkoKS5tZW1vaXplZFN0YXRlO31mdW5jdGlvbiB0aShhLCBiLCBjLCBkKSB7dmFyIGUgPSBjaSgpO04uZmxhZ3MgfD0gYTtlLm1lbW9pemVkU3RhdGUgPSBsaSgxIHwgYiwgYywgdm9pZCAwLCB2b2lkIDAgPT09IGQgPyBudWxsIDogZCk7fQogICAgICAgICAgZnVuY3Rpb24gdWkoYSwgYiwgYywgZCkge3ZhciBlID0gZGkoKTtkID0gdm9pZCAwID09PSBkID8gbnVsbCA6IGQ7dmFyIGYgPSB2b2lkIDA7aWYgKG51bGwgIT09IE8pIHt2YXIgZyA9IE8ubWVtb2l6ZWRTdGF0ZTtmID0gZy5kZXN0cm95O2lmIChudWxsICE9PSBkICYmIFdoKGQsIGcuZGVwcykpIHtlLm1lbW9pemVkU3RhdGUgPSBsaShiLCBjLCBmLCBkKTtyZXR1cm47fX1OLmZsYWdzIHw9IGE7ZS5tZW1vaXplZFN0YXRlID0gbGkoMSB8IGIsIGMsIGYsIGQpO31mdW5jdGlvbiB2aShhLCBiKSB7cmV0dXJuIHRpKDgzOTA2NTYsIDgsIGEsIGIpO31mdW5jdGlvbiBqaShhLCBiKSB7cmV0dXJuIHVpKDIwNDgsIDgsIGEsIGIpO31mdW5jdGlvbiB3aShhLCBiKSB7cmV0dXJuIHVpKDQsIDIsIGEsIGIpO31mdW5jdGlvbiB4aShhLCBiKSB7cmV0dXJuIHVpKDQsIDQsIGEsIGIpO30KICAgICAgICAgIGZ1bmN0aW9uIHlpKGEsIGIpIHtpZiAoImZ1bmN0aW9uIiA9PT0gdHlwZW9mIGIpIHJldHVybiBhID0gYSgpLCBiKGEpLCBmdW5jdGlvbiAoKSB7YihudWxsKTt9O2lmIChudWxsICE9PSBiICYmIHZvaWQgMCAhPT0gYikgcmV0dXJuIGEgPSBhKCksIGIuY3VycmVudCA9IGEsIGZ1bmN0aW9uICgpIHtiLmN1cnJlbnQgPSBudWxsO307fWZ1bmN0aW9uIHppKGEsIGIsIGMpIHtjID0gbnVsbCAhPT0gYyAmJiB2b2lkIDAgIT09IGMgPyBjLmNvbmNhdChbYV0pIDogbnVsbDtyZXR1cm4gdWkoNCwgNCwgeWkuYmluZChudWxsLCBiLCBhKSwgYyk7fWZ1bmN0aW9uIEFpKCkge31mdW5jdGlvbiBCaShhLCBiKSB7dmFyIGMgPSBkaSgpO2IgPSB2b2lkIDAgPT09IGIgPyBudWxsIDogYjt2YXIgZCA9IGMubWVtb2l6ZWRTdGF0ZTtpZiAobnVsbCAhPT0gZCAmJiBudWxsICE9PSBiICYmIFdoKGIsIGRbMV0pKSByZXR1cm4gZFswXTtjLm1lbW9pemVkU3RhdGUgPSBbYSwgYl07cmV0dXJuIGE7fQogICAgICAgICAgZnVuY3Rpb24gQ2koYSwgYikge3ZhciBjID0gZGkoKTtiID0gdm9pZCAwID09PSBiID8gbnVsbCA6IGI7dmFyIGQgPSBjLm1lbW9pemVkU3RhdGU7aWYgKG51bGwgIT09IGQgJiYgbnVsbCAhPT0gYiAmJiBXaChiLCBkWzFdKSkgcmV0dXJuIGRbMF07YSA9IGEoKTtjLm1lbW9pemVkU3RhdGUgPSBbYSwgYl07cmV0dXJuIGE7fWZ1bmN0aW9uIERpKGEsIGIsIGMpIHtpZiAoMCA9PT0gKFJoICYgMjEpKSByZXR1cm4gYS5iYXNlU3RhdGUgJiYgKGEuYmFzZVN0YXRlID0gITEsIFVnID0gITApLCBhLm1lbW9pemVkU3RhdGUgPSBjO0hlKGMsIGIpIHx8IChjID0geWMoKSwgTi5sYW5lcyB8PSBjLCBoaCB8PSBjLCBhLmJhc2VTdGF0ZSA9ICEwKTtyZXR1cm4gYjt9ZnVuY3Rpb24gRWkoYSwgYikge3ZhciBjID0gQztDID0gMCAhPT0gYyAmJiA0ID4gYyA/IGMgOiA0O2EoITApO3ZhciBkID0gUWgudHJhbnNpdGlvbjtRaC50cmFuc2l0aW9uID0ge307dHJ5IHthKCExKSwgYigpO30gZmluYWxseSB7QyA9IGMsIFFoLnRyYW5zaXRpb24gPSBkO319ZnVuY3Rpb24gRmkoKSB7cmV0dXJuIGRpKCkubWVtb2l6ZWRTdGF0ZTt9CiAgICAgICAgICBmdW5jdGlvbiBHaShhLCBiLCBjKSB7dmFyIGQgPSBsaChhKTtjID0geyBsYW5lOiBkLCBhY3Rpb246IGMsIGhhc0VhZ2VyU3RhdGU6ICExLCBlYWdlclN0YXRlOiBudWxsLCBuZXh0OiBudWxsIH07aWYgKEhpKGEpKSBJaShiLCBjKTtlbHNlIGlmIChjID0gWWcoYSwgYiwgYywgZCksIG51bGwgIT09IGMpIHt2YXIgZSA9IEwoKTttaChjLCBhLCBkLCBlKTtKaShjLCBiLCBkKTt9fQogICAgICAgICAgZnVuY3Rpb24gcmkoYSwgYiwgYykge3ZhciBkID0gbGgoYSksZSA9IHsgbGFuZTogZCwgYWN0aW9uOiBjLCBoYXNFYWdlclN0YXRlOiAhMSwgZWFnZXJTdGF0ZTogbnVsbCwgbmV4dDogbnVsbCB9O2lmIChIaShhKSkgSWkoYiwgZSk7ZWxzZSB7dmFyIGYgPSBhLmFsdGVybmF0ZTtpZiAoMCA9PT0gYS5sYW5lcyAmJiAobnVsbCA9PT0gZiB8fCAwID09PSBmLmxhbmVzKSAmJiAoZiA9IGIubGFzdFJlbmRlcmVkUmVkdWNlciwgbnVsbCAhPT0gZikpIHRyeSB7dmFyIGcgPSBiLmxhc3RSZW5kZXJlZFN0YXRlLGggPSBmKGcsIGMpO2UuaGFzRWFnZXJTdGF0ZSA9ICEwO2UuZWFnZXJTdGF0ZSA9IGg7aWYgKEhlKGgsIGcpKSB7dmFyIGsgPSBiLmludGVybGVhdmVkO251bGwgPT09IGsgPyAoZS5uZXh0ID0gZSwgWGcoYikpIDogKGUubmV4dCA9IGsubmV4dCwgay5uZXh0ID0gZSk7Yi5pbnRlcmxlYXZlZCA9IGU7cmV0dXJuO319IGNhdGNoIChsKSB7fSBmaW5hbGx5IHt9YyA9IFlnKGEsIGIsIGUsIGQpO251bGwgIT09IGMgJiYgKGUgPSBMKCksIG1oKGMsIGEsIGQsIGUpLCBKaShjLCBiLCBkKSk7fX0KICAgICAgICAgIGZ1bmN0aW9uIEhpKGEpIHt2YXIgYiA9IGEuYWx0ZXJuYXRlO3JldHVybiBhID09PSBOIHx8IG51bGwgIT09IGIgJiYgYiA9PT0gTjt9ZnVuY3Rpb24gSWkoYSwgYikge1RoID0gU2ggPSAhMDt2YXIgYyA9IGEucGVuZGluZztudWxsID09PSBjID8gYi5uZXh0ID0gYiA6IChiLm5leHQgPSBjLm5leHQsIGMubmV4dCA9IGIpO2EucGVuZGluZyA9IGI7fWZ1bmN0aW9uIEppKGEsIGIsIGMpIHtpZiAoMCAhPT0gKGMgJiA0MTk0MjQwKSkge3ZhciBkID0gYi5sYW5lcztkICY9IGEucGVuZGluZ0xhbmVzO2MgfD0gZDtiLmxhbmVzID0gYztDYyhhLCBjKTt9fQogICAgICAgICAgdmFyIGFpID0geyByZWFkQ29udGV4dDogVmcsIHVzZUNhbGxiYWNrOiBRLCB1c2VDb250ZXh0OiBRLCB1c2VFZmZlY3Q6IFEsIHVzZUltcGVyYXRpdmVIYW5kbGU6IFEsIHVzZUluc2VydGlvbkVmZmVjdDogUSwgdXNlTGF5b3V0RWZmZWN0OiBRLCB1c2VNZW1vOiBRLCB1c2VSZWR1Y2VyOiBRLCB1c2VSZWY6IFEsIHVzZVN0YXRlOiBRLCB1c2VEZWJ1Z1ZhbHVlOiBRLCB1c2VEZWZlcnJlZFZhbHVlOiBRLCB1c2VUcmFuc2l0aW9uOiBRLCB1c2VNdXRhYmxlU291cmNlOiBRLCB1c2VTeW5jRXh0ZXJuYWxTdG9yZTogUSwgdXNlSWQ6IFEsIHVuc3RhYmxlX2lzTmV3UmVjb25jaWxlcjogITEgfSxZaCA9IHsgcmVhZENvbnRleHQ6IFZnLCB1c2VDYWxsYmFjazogZnVuY3Rpb24gdXNlQ2FsbGJhY2soYSwgYikge2NpKCkubWVtb2l6ZWRTdGF0ZSA9IFthLCB2b2lkIDAgPT09IGIgPyBudWxsIDogYl07cmV0dXJuIGE7fSwgdXNlQ29udGV4dDogVmcsIHVzZUVmZmVjdDogdmksIHVzZUltcGVyYXRpdmVIYW5kbGU6IGZ1bmN0aW9uIHVzZUltcGVyYXRpdmVIYW5kbGUoYSwgYiwgYykge2MgPSBudWxsICE9PSBjICYmIHZvaWQgMCAhPT0gYyA/IGMuY29uY2F0KFthXSkgOiBudWxsO3JldHVybiB0aSg0MTk0MzA4LAogICAgICAgICAgICAgICAgNCwgeWkuYmluZChudWxsLCBiLCBhKSwgYyk7fSwgdXNlTGF5b3V0RWZmZWN0OiBmdW5jdGlvbiB1c2VMYXlvdXRFZmZlY3QoYSwgYikge3JldHVybiB0aSg0MTk0MzA4LCA0LCBhLCBiKTt9LCB1c2VJbnNlcnRpb25FZmZlY3Q6IGZ1bmN0aW9uIHVzZUluc2VydGlvbkVmZmVjdChhLCBiKSB7cmV0dXJuIHRpKDQsIDIsIGEsIGIpO30sIHVzZU1lbW86IGZ1bmN0aW9uIHVzZU1lbW8oYSwgYikge3ZhciBjID0gY2koKTtiID0gdm9pZCAwID09PSBiID8gbnVsbCA6IGI7YSA9IGEoKTtjLm1lbW9pemVkU3RhdGUgPSBbYSwgYl07cmV0dXJuIGE7fSwgdXNlUmVkdWNlcjogZnVuY3Rpb24gdXNlUmVkdWNlcihhLCBiLCBjKSB7dmFyIGQgPSBjaSgpO2IgPSB2b2lkIDAgIT09IGMgPyBjKGIpIDogYjtkLm1lbW9pemVkU3RhdGUgPSBkLmJhc2VTdGF0ZSA9IGI7YSA9IHsgcGVuZGluZzogbnVsbCwgaW50ZXJsZWF2ZWQ6IG51bGwsIGxhbmVzOiAwLCBkaXNwYXRjaDogbnVsbCwgbGFzdFJlbmRlcmVkUmVkdWNlcjogYSwgbGFzdFJlbmRlcmVkU3RhdGU6IGIgfTtkLnF1ZXVlID0gYTthID0gYS5kaXNwYXRjaCA9IEdpLmJpbmQobnVsbCwgTiwgYSk7cmV0dXJuIFtkLm1lbW9pemVkU3RhdGUsIGFdO30sIHVzZVJlZjogZnVuY3Rpb24gdXNlUmVmKGEpIHt2YXIgYiA9CiAgICAgICAgICAgICAgICBjaSgpO2EgPSB7IGN1cnJlbnQ6IGEgfTtyZXR1cm4gYi5tZW1vaXplZFN0YXRlID0gYTt9LCB1c2VTdGF0ZTogcWksIHVzZURlYnVnVmFsdWU6IEFpLCB1c2VEZWZlcnJlZFZhbHVlOiBmdW5jdGlvbiB1c2VEZWZlcnJlZFZhbHVlKGEpIHtyZXR1cm4gY2koKS5tZW1vaXplZFN0YXRlID0gYTt9LCB1c2VUcmFuc2l0aW9uOiBmdW5jdGlvbiB1c2VUcmFuc2l0aW9uKCkge3ZhciBhID0gcWkoITEpLGIgPSBhWzBdO2EgPSBFaS5iaW5kKG51bGwsIGFbMV0pO2NpKCkubWVtb2l6ZWRTdGF0ZSA9IGE7cmV0dXJuIFtiLCBhXTt9LCB1c2VNdXRhYmxlU291cmNlOiBmdW5jdGlvbiB1c2VNdXRhYmxlU291cmNlKCkge30sIHVzZVN5bmNFeHRlcm5hbFN0b3JlOiBmdW5jdGlvbiB1c2VTeW5jRXh0ZXJuYWxTdG9yZShhLCBiLCBjKSB7dmFyIGQgPSBOLGUgPSBjaSgpO2lmIChJKSB7aWYgKHZvaWQgMCA9PT0gYykgdGhyb3cgRXJyb3IocCg0MDcpKTtjID0gYygpO30gZWxzZSB7YyA9IGIoKTtpZiAobnVsbCA9PT0gUikgdGhyb3cgRXJyb3IocCgzNDkpKTswICE9PSAoUmggJiAzMCkgfHwgbmkoZCwgYiwgYyk7fWUubWVtb2l6ZWRTdGF0ZSA9IGM7dmFyIGYgPSB7IHZhbHVlOiBjLCBnZXRTbmFwc2hvdDogYiB9O2UucXVldWUgPSBmO3ZpKGtpLmJpbmQobnVsbCwgZCwKICAgICAgICAgICAgICAgIGYsIGEpLCBbYV0pO2QuZmxhZ3MgfD0gMjA0ODtsaSg5LCBtaS5iaW5kKG51bGwsIGQsIGYsIGMsIGIpLCB2b2lkIDAsIG51bGwpO3JldHVybiBjO30sIHVzZUlkOiBmdW5jdGlvbiB1c2VJZCgpIHt2YXIgYSA9IGNpKCksYiA9IFIuaWRlbnRpZmllclByZWZpeDtpZiAoSSkge3ZhciBjID0gc2c7dmFyIGQgPSByZztjID0gKGQgJiB+KDEgPDwgMzIgLSBvYyhkKSAtIDEpKS50b1N0cmluZygzMikgKyBjO2IgPSAiOiIgKyBiICsgIlIiICsgYztjID0gVWgrKzswIDwgYyAmJiAoYiArPSAiSCIgKyBjLnRvU3RyaW5nKDMyKSk7YiArPSAiOiI7fSBlbHNlIGMgPSBWaCsrLCBiID0gIjoiICsgYiArICJyIiArIGMudG9TdHJpbmcoMzIpICsgIjoiO3JldHVybiBhLm1lbW9pemVkU3RhdGUgPSBiO30sIHVuc3RhYmxlX2lzTmV3UmVjb25jaWxlcjogITEgfSxaaCA9IHsgcmVhZENvbnRleHQ6IFZnLCB1c2VDYWxsYmFjazogQmksIHVzZUNvbnRleHQ6IFZnLCB1c2VFZmZlY3Q6IGppLCB1c2VJbXBlcmF0aXZlSGFuZGxlOiB6aSwgdXNlSW5zZXJ0aW9uRWZmZWN0OiB3aSwgdXNlTGF5b3V0RWZmZWN0OiB4aSwgdXNlTWVtbzogQ2ksIHVzZVJlZHVjZXI6IGZpLCB1c2VSZWY6IHNpLCB1c2VTdGF0ZTogZnVuY3Rpb24gdXNlU3RhdGUoKSB7cmV0dXJuIGZpKGVpKTt9LAogICAgICAgICAgICAgIHVzZURlYnVnVmFsdWU6IEFpLCB1c2VEZWZlcnJlZFZhbHVlOiBmdW5jdGlvbiB1c2VEZWZlcnJlZFZhbHVlKGEpIHt2YXIgYiA9IGRpKCk7cmV0dXJuIERpKGIsIE8ubWVtb2l6ZWRTdGF0ZSwgYSk7fSwgdXNlVHJhbnNpdGlvbjogZnVuY3Rpb24gdXNlVHJhbnNpdGlvbigpIHt2YXIgYSA9IGZpKGVpKVswXSxiID0gZGkoKS5tZW1vaXplZFN0YXRlO3JldHVybiBbYSwgYl07fSwgdXNlTXV0YWJsZVNvdXJjZTogaGksIHVzZVN5bmNFeHRlcm5hbFN0b3JlOiBpaSwgdXNlSWQ6IEZpLCB1bnN0YWJsZV9pc05ld1JlY29uY2lsZXI6ICExIH0sJGggPSB7IHJlYWRDb250ZXh0OiBWZywgdXNlQ2FsbGJhY2s6IEJpLCB1c2VDb250ZXh0OiBWZywgdXNlRWZmZWN0OiBqaSwgdXNlSW1wZXJhdGl2ZUhhbmRsZTogemksIHVzZUluc2VydGlvbkVmZmVjdDogd2ksIHVzZUxheW91dEVmZmVjdDogeGksIHVzZU1lbW86IENpLCB1c2VSZWR1Y2VyOiBnaSwgdXNlUmVmOiBzaSwgdXNlU3RhdGU6IGZ1bmN0aW9uIHVzZVN0YXRlKCkge3JldHVybiBnaShlaSk7fSwgdXNlRGVidWdWYWx1ZTogQWksIHVzZURlZmVycmVkVmFsdWU6IGZ1bmN0aW9uIHVzZURlZmVycmVkVmFsdWUoYSkge3ZhciBiID0gZGkoKTtyZXR1cm4gbnVsbCA9PT0KICAgICAgICAgICAgICAgIE8gPyBiLm1lbW9pemVkU3RhdGUgPSBhIDogRGkoYiwgTy5tZW1vaXplZFN0YXRlLCBhKTt9LCB1c2VUcmFuc2l0aW9uOiBmdW5jdGlvbiB1c2VUcmFuc2l0aW9uKCkge3ZhciBhID0gZ2koZWkpWzBdLGIgPSBkaSgpLm1lbW9pemVkU3RhdGU7cmV0dXJuIFthLCBiXTt9LCB1c2VNdXRhYmxlU291cmNlOiBoaSwgdXNlU3luY0V4dGVybmFsU3RvcmU6IGlpLCB1c2VJZDogRmksIHVuc3RhYmxlX2lzTmV3UmVjb25jaWxlcjogITEgfTtmdW5jdGlvbiBLaShhLCBiKSB7dHJ5IHt2YXIgYyA9ICIiLGQgPSBiO2RvIHtjICs9IFBhKGQpLCBkID0gZC5yZXR1cm47fSB3aGlsZSAoZCk7dmFyIGUgPSBjO30gY2F0Y2ggKGYpIHtlID0gIlxuRXJyb3IgZ2VuZXJhdGluZyBzdGFjazogIiArIGYubWVzc2FnZSArICJcbiIgKyBmLnN0YWNrO31yZXR1cm4geyB2YWx1ZTogYSwgc291cmNlOiBiLCBzdGFjazogZSwgZGlnZXN0OiBudWxsIH07fWZ1bmN0aW9uIExpKGEsIGIsIGMpIHtyZXR1cm4geyB2YWx1ZTogYSwgc291cmNlOiBudWxsLCBzdGFjazogbnVsbCAhPSBjID8gYyA6IG51bGwsIGRpZ2VzdDogbnVsbCAhPSBiID8gYiA6IG51bGwgfTt9CiAgICAgICAgICBmdW5jdGlvbiBNaShhLCBiKSB7dHJ5IHtjb25zb2xlLmVycm9yKGIudmFsdWUpO30gY2F0Y2ggKGMpIHtzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHt0aHJvdyBjO30pO319dmFyIE5pID0gImZ1bmN0aW9uIiA9PT0gdHlwZW9mIFdlYWtNYXAgPyBXZWFrTWFwIDogTWFwO2Z1bmN0aW9uIE9pKGEsIGIsIGMpIHtjID0gY2goLTEsIGMpO2MudGFnID0gMztjLnBheWxvYWQgPSB7IGVsZW1lbnQ6IG51bGwgfTt2YXIgZCA9IGIudmFsdWU7Yy5jYWxsYmFjayA9IGZ1bmN0aW9uICgpIHtQaSB8fCAoUGkgPSAhMCwgUWkgPSBkKTtNaShhLCBiKTt9O3JldHVybiBjO30KICAgICAgICAgIGZ1bmN0aW9uIFJpKGEsIGIsIGMpIHtjID0gY2goLTEsIGMpO2MudGFnID0gMzt2YXIgZCA9IGEudHlwZS5nZXREZXJpdmVkU3RhdGVGcm9tRXJyb3I7aWYgKCJmdW5jdGlvbiIgPT09IHR5cGVvZiBkKSB7dmFyIGUgPSBiLnZhbHVlO2MucGF5bG9hZCA9IGZ1bmN0aW9uICgpIHtyZXR1cm4gZChlKTt9O2MuY2FsbGJhY2sgPSBmdW5jdGlvbiAoKSB7TWkoYSwgYik7fTt9dmFyIGYgPSBhLnN0YXRlTm9kZTtudWxsICE9PSBmICYmICJmdW5jdGlvbiIgPT09IHR5cGVvZiBmLmNvbXBvbmVudERpZENhdGNoICYmIChjLmNhbGxiYWNrID0gZnVuY3Rpb24gKCkge01pKGEsIGIpOyJmdW5jdGlvbiIgIT09IHR5cGVvZiBkICYmIChudWxsID09PSBTaSA/IFNpID0gbmV3IFNldChbdGhpc10pIDogU2kuYWRkKHRoaXMpKTt2YXIgYyA9IGIuc3RhY2s7dGhpcy5jb21wb25lbnREaWRDYXRjaChiLnZhbHVlLCB7IGNvbXBvbmVudFN0YWNrOiBudWxsICE9PSBjID8gYyA6ICIiIH0pO30pO3JldHVybiBjO30KICAgICAgICAgIGZ1bmN0aW9uIFRpKGEsIGIsIGMpIHt2YXIgZCA9IGEucGluZ0NhY2hlO2lmIChudWxsID09PSBkKSB7ZCA9IGEucGluZ0NhY2hlID0gbmV3IE5pKCk7dmFyIGUgPSBuZXcgU2V0KCk7ZC5zZXQoYiwgZSk7fSBlbHNlIGUgPSBkLmdldChiKSwgdm9pZCAwID09PSBlICYmIChlID0gbmV3IFNldCgpLCBkLnNldChiLCBlKSk7ZS5oYXMoYykgfHwgKGUuYWRkKGMpLCBhID0gVWkuYmluZChudWxsLCBhLCBiLCBjKSwgYi50aGVuKGEsIGEpKTt9ZnVuY3Rpb24gVmkoYSkge2RvIHt2YXIgYjtpZiAoYiA9IDEzID09PSBhLnRhZykgYiA9IGEubWVtb2l6ZWRTdGF0ZSwgYiA9IG51bGwgIT09IGIgPyBudWxsICE9PSBiLmRlaHlkcmF0ZWQgPyAhMCA6ICExIDogITA7aWYgKGIpIHJldHVybiBhO2EgPSBhLnJldHVybjt9IHdoaWxlIChudWxsICE9PSBhKTtyZXR1cm4gbnVsbDt9CiAgICAgICAgICBmdW5jdGlvbiBXaShhLCBiLCBjLCBkLCBlKSB7aWYgKDAgPT09IChhLm1vZGUgJiAxKSkgcmV0dXJuIGEgPT09IGIgPyBhLmZsYWdzIHw9IDY1NTM2IDogKGEuZmxhZ3MgfD0gMTI4LCBjLmZsYWdzIHw9IDEzMTA3MiwgYy5mbGFncyAmPSAtNTI4MDUsIDEgPT09IGMudGFnICYmIChudWxsID09PSBjLmFsdGVybmF0ZSA/IGMudGFnID0gMTcgOiAoYiA9IGNoKC0xLCAxKSwgYi50YWcgPSAyLCBkaChjLCBiLCAxKSkpLCBjLmxhbmVzIHw9IDEpLCBhO2EuZmxhZ3MgfD0gNjU1MzY7YS5sYW5lcyA9IGU7cmV0dXJuIGE7fXZhciBYaSA9IHVhLlJlYWN0Q3VycmVudE93bmVyLFVnID0gITE7ZnVuY3Rpb24gWWkoYSwgYiwgYywgZCkge2IuY2hpbGQgPSBudWxsID09PSBhID8gQ2goYiwgbnVsbCwgYywgZCkgOiBCaChiLCBhLmNoaWxkLCBjLCBkKTt9CiAgICAgICAgICBmdW5jdGlvbiBaaShhLCBiLCBjLCBkLCBlKSB7YyA9IGMucmVuZGVyO3ZhciBmID0gYi5yZWY7VGcoYiwgZSk7ZCA9IFhoKGEsIGIsIGMsIGQsIGYsIGUpO2MgPSBiaSgpO2lmIChudWxsICE9PSBhICYmICFVZykgcmV0dXJuIGIudXBkYXRlUXVldWUgPSBhLnVwZGF0ZVF1ZXVlLCBiLmZsYWdzICY9IC0yMDUzLCBhLmxhbmVzICY9IH5lLCAkaShhLCBiLCBlKTtJICYmIGMgJiYgdmcoYik7Yi5mbGFncyB8PSAxO1lpKGEsIGIsIGQsIGUpO3JldHVybiBiLmNoaWxkO30KICAgICAgICAgIGZ1bmN0aW9uIGFqKGEsIGIsIGMsIGQsIGUpIHtpZiAobnVsbCA9PT0gYSkge3ZhciBmID0gYy50eXBlO2lmICgiZnVuY3Rpb24iID09PSB0eXBlb2YgZiAmJiAhYmooZikgJiYgdm9pZCAwID09PSBmLmRlZmF1bHRQcm9wcyAmJiBudWxsID09PSBjLmNvbXBhcmUgJiYgdm9pZCAwID09PSBjLmRlZmF1bHRQcm9wcykgcmV0dXJuIGIudGFnID0gMTUsIGIudHlwZSA9IGYsIGNqKGEsIGIsIGYsIGQsIGUpO2EgPSB5aChjLnR5cGUsIG51bGwsIGQsIGIsIGIubW9kZSwgZSk7YS5yZWYgPSBiLnJlZjthLnJldHVybiA9IGI7cmV0dXJuIGIuY2hpbGQgPSBhO31mID0gYS5jaGlsZDtpZiAoMCA9PT0gKGEubGFuZXMgJiBlKSkge3ZhciBnID0gZi5tZW1vaXplZFByb3BzO2MgPSBjLmNvbXBhcmU7YyA9IG51bGwgIT09IGMgPyBjIDogSWU7aWYgKGMoZywgZCkgJiYgYS5yZWYgPT09IGIucmVmKSByZXR1cm4gJGkoYSwgYiwgZSk7fWIuZmxhZ3MgfD0gMTthID0gd2goZiwgZCk7YS5yZWYgPSBiLnJlZjthLnJldHVybiA9IGI7cmV0dXJuIGIuY2hpbGQgPSBhO30KICAgICAgICAgIGZ1bmN0aW9uIGNqKGEsIGIsIGMsIGQsIGUpIHtpZiAobnVsbCAhPT0gYSkge3ZhciBmID0gYS5tZW1vaXplZFByb3BzO2lmIChJZShmLCBkKSAmJiBhLnJlZiA9PT0gYi5yZWYpIGlmIChVZyA9ICExLCBiLnBlbmRpbmdQcm9wcyA9IGQgPSBmLCAwICE9PSAoYS5sYW5lcyAmIGUpKSAwICE9PSAoYS5mbGFncyAmIDEzMTA3MikgJiYgKFVnID0gITApO2Vsc2UgcmV0dXJuIGIubGFuZXMgPSBhLmxhbmVzLCAkaShhLCBiLCBlKTt9cmV0dXJuIGRqKGEsIGIsIGMsIGQsIGUpO30KICAgICAgICAgIGZ1bmN0aW9uIGVqKGEsIGIsIGMpIHt2YXIgZCA9IGIucGVuZGluZ1Byb3BzLGUgPSBkLmNoaWxkcmVuLGYgPSBudWxsICE9PSBhID8gYS5tZW1vaXplZFN0YXRlIDogbnVsbDtpZiAoImhpZGRlbiIgPT09IGQubW9kZSkge2lmICgwID09PSAoYi5tb2RlICYgMSkpIGIubWVtb2l6ZWRTdGF0ZSA9IHsgYmFzZUxhbmVzOiAwLCBjYWNoZVBvb2w6IG51bGwsIHRyYW5zaXRpb25zOiBudWxsIH0sIEcoZmosIGdqKSwgZ2ogfD0gYztlbHNlIHtpZiAoMCA9PT0gKGMgJiAxMDczNzQxODI0KSkgcmV0dXJuIGEgPSBudWxsICE9PSBmID8gZi5iYXNlTGFuZXMgfCBjIDogYywgYi5sYW5lcyA9IGIuY2hpbGRMYW5lcyA9IDEwNzM3NDE4MjQsIGIubWVtb2l6ZWRTdGF0ZSA9IHsgYmFzZUxhbmVzOiBhLCBjYWNoZVBvb2w6IG51bGwsIHRyYW5zaXRpb25zOiBudWxsIH0sIGIudXBkYXRlUXVldWUgPSBudWxsLCBHKGZqLCBnaiksIGdqIHw9IGEsIG51bGw7Yi5tZW1vaXplZFN0YXRlID0geyBiYXNlTGFuZXM6IDAsIGNhY2hlUG9vbDogbnVsbCwgdHJhbnNpdGlvbnM6IG51bGwgfTtkID0gbnVsbCAhPT0gZiA/IGYuYmFzZUxhbmVzIDogYztHKGZqLCBnaik7Z2ogfD0gZDt9fSBlbHNlIG51bGwgIT09CiAgICAgICAgICAgIGYgPyAoZCA9IGYuYmFzZUxhbmVzIHwgYywgYi5tZW1vaXplZFN0YXRlID0gbnVsbCkgOiBkID0gYywgRyhmaiwgZ2opLCBnaiB8PSBkO1lpKGEsIGIsIGUsIGMpO3JldHVybiBiLmNoaWxkO31mdW5jdGlvbiBoaihhLCBiKSB7dmFyIGMgPSBiLnJlZjtpZiAobnVsbCA9PT0gYSAmJiBudWxsICE9PSBjIHx8IG51bGwgIT09IGEgJiYgYS5yZWYgIT09IGMpIGIuZmxhZ3MgfD0gNTEyLCBiLmZsYWdzIHw9IDIwOTcxNTI7fWZ1bmN0aW9uIGRqKGEsIGIsIGMsIGQsIGUpIHt2YXIgZiA9IFpmKGMpID8gWGYgOiBILmN1cnJlbnQ7ZiA9IFlmKGIsIGYpO1RnKGIsIGUpO2MgPSBYaChhLCBiLCBjLCBkLCBmLCBlKTtkID0gYmkoKTtpZiAobnVsbCAhPT0gYSAmJiAhVWcpIHJldHVybiBiLnVwZGF0ZVF1ZXVlID0gYS51cGRhdGVRdWV1ZSwgYi5mbGFncyAmPSAtMjA1MywgYS5sYW5lcyAmPSB+ZSwgJGkoYSwgYiwgZSk7SSAmJiBkICYmIHZnKGIpO2IuZmxhZ3MgfD0gMTtZaShhLCBiLCBjLCBlKTtyZXR1cm4gYi5jaGlsZDt9CiAgICAgICAgICBmdW5jdGlvbiBpaihhLCBiLCBjLCBkLCBlKSB7aWYgKFpmKGMpKSB7dmFyIGYgPSAhMDtjZyhiKTt9IGVsc2UgZiA9ICExO1RnKGIsIGUpO2lmIChudWxsID09PSBiLnN0YXRlTm9kZSkgamooYSwgYiksIHBoKGIsIGMsIGQpLCByaChiLCBjLCBkLCBlKSwgZCA9ICEwO2Vsc2UgaWYgKG51bGwgPT09IGEpIHt2YXIgZyA9IGIuc3RhdGVOb2RlLGggPSBiLm1lbW9pemVkUHJvcHM7Zy5wcm9wcyA9IGg7dmFyIGsgPSBnLmNvbnRleHQsbCA9IGMuY29udGV4dFR5cGU7Im9iamVjdCIgPT09IHR5cGVvZiBsICYmIG51bGwgIT09IGwgPyBsID0gVmcobCkgOiAobCA9IFpmKGMpID8gWGYgOiBILmN1cnJlbnQsIGwgPSBZZihiLCBsKSk7dmFyIG0gPSBjLmdldERlcml2ZWRTdGF0ZUZyb21Qcm9wcyxxID0gImZ1bmN0aW9uIiA9PT0gdHlwZW9mIG0gfHwgImZ1bmN0aW9uIiA9PT0gdHlwZW9mIGcuZ2V0U25hcHNob3RCZWZvcmVVcGRhdGU7cSB8fCAiZnVuY3Rpb24iICE9PSB0eXBlb2YgZy5VTlNBRkVfY29tcG9uZW50V2lsbFJlY2VpdmVQcm9wcyAmJiAiZnVuY3Rpb24iICE9PSB0eXBlb2YgZy5jb21wb25lbnRXaWxsUmVjZWl2ZVByb3BzIHx8CiAgICAgICAgICAgICAgKGggIT09IGQgfHwgayAhPT0gbCkgJiYgcWgoYiwgZywgZCwgbCk7JGcgPSAhMTt2YXIgciA9IGIubWVtb2l6ZWRTdGF0ZTtnLnN0YXRlID0gcjtnaChiLCBkLCBnLCBlKTtrID0gYi5tZW1vaXplZFN0YXRlO2ggIT09IGQgfHwgciAhPT0gayB8fCBXZi5jdXJyZW50IHx8ICRnID8gKCJmdW5jdGlvbiIgPT09IHR5cGVvZiBtICYmIChraChiLCBjLCBtLCBkKSwgayA9IGIubWVtb2l6ZWRTdGF0ZSksIChoID0gJGcgfHwgb2goYiwgYywgaCwgZCwgciwgaywgbCkpID8gKHEgfHwgImZ1bmN0aW9uIiAhPT0gdHlwZW9mIGcuVU5TQUZFX2NvbXBvbmVudFdpbGxNb3VudCAmJiAiZnVuY3Rpb24iICE9PSB0eXBlb2YgZy5jb21wb25lbnRXaWxsTW91bnQgfHwgKCJmdW5jdGlvbiIgPT09IHR5cGVvZiBnLmNvbXBvbmVudFdpbGxNb3VudCAmJiBnLmNvbXBvbmVudFdpbGxNb3VudCgpLCAiZnVuY3Rpb24iID09PSB0eXBlb2YgZy5VTlNBRkVfY29tcG9uZW50V2lsbE1vdW50ICYmIGcuVU5TQUZFX2NvbXBvbmVudFdpbGxNb3VudCgpKSwgImZ1bmN0aW9uIiA9PT0gdHlwZW9mIGcuY29tcG9uZW50RGlkTW91bnQgJiYgKGIuZmxhZ3MgfD0gNDE5NDMwOCkpIDogKAogICAgICAgICAgICAgICJmdW5jdGlvbiIgPT09IHR5cGVvZiBnLmNvbXBvbmVudERpZE1vdW50ICYmIChiLmZsYWdzIHw9IDQxOTQzMDgpLCBiLm1lbW9pemVkUHJvcHMgPSBkLCBiLm1lbW9pemVkU3RhdGUgPSBrKSwgZy5wcm9wcyA9IGQsIGcuc3RhdGUgPSBrLCBnLmNvbnRleHQgPSBsLCBkID0gaCkgOiAoImZ1bmN0aW9uIiA9PT0gdHlwZW9mIGcuY29tcG9uZW50RGlkTW91bnQgJiYgKGIuZmxhZ3MgfD0gNDE5NDMwOCksIGQgPSAhMSk7fSBlbHNlIHtnID0gYi5zdGF0ZU5vZGU7YmgoYSwgYik7aCA9IGIubWVtb2l6ZWRQcm9wcztsID0gYi50eXBlID09PSBiLmVsZW1lbnRUeXBlID8gaCA6IExnKGIudHlwZSwgaCk7Zy5wcm9wcyA9IGw7cSA9IGIucGVuZGluZ1Byb3BzO3IgPSBnLmNvbnRleHQ7ayA9IGMuY29udGV4dFR5cGU7Im9iamVjdCIgPT09IHR5cGVvZiBrICYmIG51bGwgIT09IGsgPyBrID0gVmcoaykgOiAoayA9IFpmKGMpID8gWGYgOiBILmN1cnJlbnQsIGsgPSBZZihiLCBrKSk7dmFyIHkgPSBjLmdldERlcml2ZWRTdGF0ZUZyb21Qcm9wczsobSA9ICJmdW5jdGlvbiIgPT09IHR5cGVvZiB5IHx8ICJmdW5jdGlvbiIgPT09IHR5cGVvZiBnLmdldFNuYXBzaG90QmVmb3JlVXBkYXRlKSB8fAogICAgICAgICAgICAgICJmdW5jdGlvbiIgIT09IHR5cGVvZiBnLlVOU0FGRV9jb21wb25lbnRXaWxsUmVjZWl2ZVByb3BzICYmICJmdW5jdGlvbiIgIT09IHR5cGVvZiBnLmNvbXBvbmVudFdpbGxSZWNlaXZlUHJvcHMgfHwgKGggIT09IHEgfHwgciAhPT0gaykgJiYgcWgoYiwgZywgZCwgayk7JGcgPSAhMTtyID0gYi5tZW1vaXplZFN0YXRlO2cuc3RhdGUgPSByO2doKGIsIGQsIGcsIGUpO3ZhciBuID0gYi5tZW1vaXplZFN0YXRlO2ggIT09IHEgfHwgciAhPT0gbiB8fCBXZi5jdXJyZW50IHx8ICRnID8gKCJmdW5jdGlvbiIgPT09IHR5cGVvZiB5ICYmIChraChiLCBjLCB5LCBkKSwgbiA9IGIubWVtb2l6ZWRTdGF0ZSksIChsID0gJGcgfHwgb2goYiwgYywgbCwgZCwgciwgbiwgaykgfHwgITEpID8gKG0gfHwgImZ1bmN0aW9uIiAhPT0gdHlwZW9mIGcuVU5TQUZFX2NvbXBvbmVudFdpbGxVcGRhdGUgJiYgImZ1bmN0aW9uIiAhPT0gdHlwZW9mIGcuY29tcG9uZW50V2lsbFVwZGF0ZSB8fCAoImZ1bmN0aW9uIiA9PT0gdHlwZW9mIGcuY29tcG9uZW50V2lsbFVwZGF0ZSAmJiBnLmNvbXBvbmVudFdpbGxVcGRhdGUoZCwgbiwgayksICJmdW5jdGlvbiIgPT09IHR5cGVvZiBnLlVOU0FGRV9jb21wb25lbnRXaWxsVXBkYXRlICYmCiAgICAgICAgICAgICAgZy5VTlNBRkVfY29tcG9uZW50V2lsbFVwZGF0ZShkLCBuLCBrKSksICJmdW5jdGlvbiIgPT09IHR5cGVvZiBnLmNvbXBvbmVudERpZFVwZGF0ZSAmJiAoYi5mbGFncyB8PSA0KSwgImZ1bmN0aW9uIiA9PT0gdHlwZW9mIGcuZ2V0U25hcHNob3RCZWZvcmVVcGRhdGUgJiYgKGIuZmxhZ3MgfD0gMTAyNCkpIDogKCJmdW5jdGlvbiIgIT09IHR5cGVvZiBnLmNvbXBvbmVudERpZFVwZGF0ZSB8fCBoID09PSBhLm1lbW9pemVkUHJvcHMgJiYgciA9PT0gYS5tZW1vaXplZFN0YXRlIHx8IChiLmZsYWdzIHw9IDQpLCAiZnVuY3Rpb24iICE9PSB0eXBlb2YgZy5nZXRTbmFwc2hvdEJlZm9yZVVwZGF0ZSB8fCBoID09PSBhLm1lbW9pemVkUHJvcHMgJiYgciA9PT0gYS5tZW1vaXplZFN0YXRlIHx8IChiLmZsYWdzIHw9IDEwMjQpLCBiLm1lbW9pemVkUHJvcHMgPSBkLCBiLm1lbW9pemVkU3RhdGUgPSBuKSwgZy5wcm9wcyA9IGQsIGcuc3RhdGUgPSBuLCBnLmNvbnRleHQgPSBrLCBkID0gbCkgOiAoImZ1bmN0aW9uIiAhPT0gdHlwZW9mIGcuY29tcG9uZW50RGlkVXBkYXRlIHx8IGggPT09IGEubWVtb2l6ZWRQcm9wcyAmJiByID09PQogICAgICAgICAgICAgIGEubWVtb2l6ZWRTdGF0ZSB8fCAoYi5mbGFncyB8PSA0KSwgImZ1bmN0aW9uIiAhPT0gdHlwZW9mIGcuZ2V0U25hcHNob3RCZWZvcmVVcGRhdGUgfHwgaCA9PT0gYS5tZW1vaXplZFByb3BzICYmIHIgPT09IGEubWVtb2l6ZWRTdGF0ZSB8fCAoYi5mbGFncyB8PSAxMDI0KSwgZCA9ICExKTt9cmV0dXJuIGtqKGEsIGIsIGMsIGQsIGYsIGUpO30KICAgICAgICAgIGZ1bmN0aW9uIGtqKGEsIGIsIGMsIGQsIGUsIGYpIHtoaihhLCBiKTt2YXIgZyA9IDAgIT09IChiLmZsYWdzICYgMTI4KTtpZiAoIWQgJiYgIWcpIHJldHVybiBlICYmIGRnKGIsIGMsICExKSwgJGkoYSwgYiwgZik7ZCA9IGIuc3RhdGVOb2RlO1hpLmN1cnJlbnQgPSBiO3ZhciBoID0gZyAmJiAiZnVuY3Rpb24iICE9PSB0eXBlb2YgYy5nZXREZXJpdmVkU3RhdGVGcm9tRXJyb3IgPyBudWxsIDogZC5yZW5kZXIoKTtiLmZsYWdzIHw9IDE7bnVsbCAhPT0gYSAmJiBnID8gKGIuY2hpbGQgPSBCaChiLCBhLmNoaWxkLCBudWxsLCBmKSwgYi5jaGlsZCA9IEJoKGIsIG51bGwsIGgsIGYpKSA6IFlpKGEsIGIsIGgsIGYpO2IubWVtb2l6ZWRTdGF0ZSA9IGQuc3RhdGU7ZSAmJiBkZyhiLCBjLCAhMCk7cmV0dXJuIGIuY2hpbGQ7fWZ1bmN0aW9uIGxqKGEpIHt2YXIgYiA9IGEuc3RhdGVOb2RlO2IucGVuZGluZ0NvbnRleHQgPyBhZyhhLCBiLnBlbmRpbmdDb250ZXh0LCBiLnBlbmRpbmdDb250ZXh0ICE9PSBiLmNvbnRleHQpIDogYi5jb250ZXh0ICYmIGFnKGEsIGIuY29udGV4dCwgITEpO0loKGEsIGIuY29udGFpbmVySW5mbyk7fQogICAgICAgICAgZnVuY3Rpb24gbWooYSwgYiwgYywgZCwgZSkge0lnKCk7SmcoZSk7Yi5mbGFncyB8PSAyNTY7WWkoYSwgYiwgYywgZCk7cmV0dXJuIGIuY2hpbGQ7fXZhciBuaiA9IHsgZGVoeWRyYXRlZDogbnVsbCwgdHJlZUNvbnRleHQ6IG51bGwsIHJldHJ5TGFuZTogMCB9O2Z1bmN0aW9uIG9qKGEpIHtyZXR1cm4geyBiYXNlTGFuZXM6IGEsIGNhY2hlUG9vbDogbnVsbCwgdHJhbnNpdGlvbnM6IG51bGwgfTt9CiAgICAgICAgICBmdW5jdGlvbiBwaihhLCBiLCBjKSB7dmFyIGQgPSBiLnBlbmRpbmdQcm9wcyxlID0gTS5jdXJyZW50LGYgPSAhMSxnID0gMCAhPT0gKGIuZmxhZ3MgJiAxMjgpLGg7KGggPSBnKSB8fCAoaCA9IG51bGwgIT09IGEgJiYgbnVsbCA9PT0gYS5tZW1vaXplZFN0YXRlID8gITEgOiAwICE9PSAoZSAmIDIpKTtpZiAoaCkgZiA9ICEwLCBiLmZsYWdzICY9IC0xMjk7ZWxzZSBpZiAobnVsbCA9PT0gYSB8fCBudWxsICE9PSBhLm1lbW9pemVkU3RhdGUpIGUgfD0gMTtHKE0sIGUgJiAxKTtpZiAobnVsbCA9PT0gYSkge0VnKGIpO2EgPSBiLm1lbW9pemVkU3RhdGU7aWYgKG51bGwgIT09IGEgJiYgKGEgPSBhLmRlaHlkcmF0ZWQsIG51bGwgIT09IGEpKSByZXR1cm4gMCA9PT0gKGIubW9kZSAmIDEpID8gYi5sYW5lcyA9IDEgOiAiJCEiID09PSBhLmRhdGEgPyBiLmxhbmVzID0gOCA6IGIubGFuZXMgPSAxMDczNzQxODI0LCBudWxsO2cgPSBkLmNoaWxkcmVuO2EgPSBkLmZhbGxiYWNrO3JldHVybiBmID8gKGQgPSBiLm1vZGUsIGYgPSBiLmNoaWxkLCBnID0geyBtb2RlOiAiaGlkZGVuIiwgY2hpbGRyZW46IGcgfSwgMCA9PT0gKGQgJiAxKSAmJiBudWxsICE9PSBmID8gKGYuY2hpbGRMYW5lcyA9IDAsIGYucGVuZGluZ1Byb3BzID0KICAgICAgICAgICAgICBnKSA6IGYgPSBxaihnLCBkLCAwLCBudWxsKSwgYSA9IEFoKGEsIGQsIGMsIG51bGwpLCBmLnJldHVybiA9IGIsIGEucmV0dXJuID0gYiwgZi5zaWJsaW5nID0gYSwgYi5jaGlsZCA9IGYsIGIuY2hpbGQubWVtb2l6ZWRTdGF0ZSA9IG9qKGMpLCBiLm1lbW9pemVkU3RhdGUgPSBuaiwgYSkgOiByaihiLCBnKTt9ZSA9IGEubWVtb2l6ZWRTdGF0ZTtpZiAobnVsbCAhPT0gZSAmJiAoaCA9IGUuZGVoeWRyYXRlZCwgbnVsbCAhPT0gaCkpIHJldHVybiBzaihhLCBiLCBnLCBkLCBoLCBlLCBjKTtpZiAoZikge2YgPSBkLmZhbGxiYWNrO2cgPSBiLm1vZGU7ZSA9IGEuY2hpbGQ7aCA9IGUuc2libGluZzt2YXIgayA9IHsgbW9kZTogImhpZGRlbiIsIGNoaWxkcmVuOiBkLmNoaWxkcmVuIH07MCA9PT0gKGcgJiAxKSAmJiBiLmNoaWxkICE9PSBlID8gKGQgPSBiLmNoaWxkLCBkLmNoaWxkTGFuZXMgPSAwLCBkLnBlbmRpbmdQcm9wcyA9IGssIGIuZGVsZXRpb25zID0gbnVsbCkgOiAoZCA9IHdoKGUsIGspLCBkLnN1YnRyZWVGbGFncyA9IGUuc3VidHJlZUZsYWdzICYgMTQ2ODAwNjQpO251bGwgIT09IGggPyBmID0gd2goaCwgZikgOiAoZiA9IEFoKGYsIGcsIGMsIG51bGwpLCBmLmZsYWdzIHw9IDIpO2YucmV0dXJuID0KICAgICAgICAgICAgICBiO2QucmV0dXJuID0gYjtkLnNpYmxpbmcgPSBmO2IuY2hpbGQgPSBkO2QgPSBmO2YgPSBiLmNoaWxkO2cgPSBhLmNoaWxkLm1lbW9pemVkU3RhdGU7ZyA9IG51bGwgPT09IGcgPyBvaihjKSA6IHsgYmFzZUxhbmVzOiBnLmJhc2VMYW5lcyB8IGMsIGNhY2hlUG9vbDogbnVsbCwgdHJhbnNpdGlvbnM6IGcudHJhbnNpdGlvbnMgfTtmLm1lbW9pemVkU3RhdGUgPSBnO2YuY2hpbGRMYW5lcyA9IGEuY2hpbGRMYW5lcyAmIH5jO2IubWVtb2l6ZWRTdGF0ZSA9IG5qO3JldHVybiBkO31mID0gYS5jaGlsZDthID0gZi5zaWJsaW5nO2QgPSB3aChmLCB7IG1vZGU6ICJ2aXNpYmxlIiwgY2hpbGRyZW46IGQuY2hpbGRyZW4gfSk7MCA9PT0gKGIubW9kZSAmIDEpICYmIChkLmxhbmVzID0gYyk7ZC5yZXR1cm4gPSBiO2Quc2libGluZyA9IG51bGw7bnVsbCAhPT0gYSAmJiAoYyA9IGIuZGVsZXRpb25zLCBudWxsID09PSBjID8gKGIuZGVsZXRpb25zID0gW2FdLCBiLmZsYWdzIHw9IDE2KSA6IGMucHVzaChhKSk7Yi5jaGlsZCA9IGQ7Yi5tZW1vaXplZFN0YXRlID0gbnVsbDtyZXR1cm4gZDt9CiAgICAgICAgICBmdW5jdGlvbiByaihhLCBiKSB7YiA9IHFqKHsgbW9kZTogInZpc2libGUiLCBjaGlsZHJlbjogYiB9LCBhLm1vZGUsIDAsIG51bGwpO2IucmV0dXJuID0gYTtyZXR1cm4gYS5jaGlsZCA9IGI7fWZ1bmN0aW9uIHRqKGEsIGIsIGMsIGQpIHtudWxsICE9PSBkICYmIEpnKGQpO0JoKGIsIGEuY2hpbGQsIG51bGwsIGMpO2EgPSByaihiLCBiLnBlbmRpbmdQcm9wcy5jaGlsZHJlbik7YS5mbGFncyB8PSAyO2IubWVtb2l6ZWRTdGF0ZSA9IG51bGw7cmV0dXJuIGE7fQogICAgICAgICAgZnVuY3Rpb24gc2ooYSwgYiwgYywgZCwgZSwgZiwgZykge2lmIChjKSB7aWYgKGIuZmxhZ3MgJiAyNTYpIHJldHVybiBiLmZsYWdzICY9IC0yNTcsIGQgPSBMaShFcnJvcihwKDQyMikpKSwgdGooYSwgYiwgZywgZCk7aWYgKG51bGwgIT09IGIubWVtb2l6ZWRTdGF0ZSkgcmV0dXJuIGIuY2hpbGQgPSBhLmNoaWxkLCBiLmZsYWdzIHw9IDEyOCwgbnVsbDtmID0gZC5mYWxsYmFjaztlID0gYi5tb2RlO2QgPSBxaih7IG1vZGU6ICJ2aXNpYmxlIiwgY2hpbGRyZW46IGQuY2hpbGRyZW4gfSwgZSwgMCwgbnVsbCk7ZiA9IEFoKGYsIGUsIGcsIG51bGwpO2YuZmxhZ3MgfD0gMjtkLnJldHVybiA9IGI7Zi5yZXR1cm4gPSBiO2Quc2libGluZyA9IGY7Yi5jaGlsZCA9IGQ7MCAhPT0gKGIubW9kZSAmIDEpICYmIEJoKGIsIGEuY2hpbGQsIG51bGwsIGcpO2IuY2hpbGQubWVtb2l6ZWRTdGF0ZSA9IG9qKGcpO2IubWVtb2l6ZWRTdGF0ZSA9IG5qO3JldHVybiBmO31pZiAoMCA9PT0gKGIubW9kZSAmIDEpKSByZXR1cm4gdGooYSwgYiwgZywgbnVsbCk7aWYgKCIkISIgPT09IGUuZGF0YSkge2QgPSBlLm5leHRTaWJsaW5nICYmIGUubmV4dFNpYmxpbmcuZGF0YXNldDsKICAgICAgICAgICAgICBpZiAoZCkgdmFyIGggPSBkLmRnc3Q7ZCA9IGg7ZiA9IEVycm9yKHAoNDE5KSk7ZCA9IExpKGYsIGQsIHZvaWQgMCk7cmV0dXJuIHRqKGEsIGIsIGcsIGQpO31oID0gMCAhPT0gKGcgJiBhLmNoaWxkTGFuZXMpO2lmIChVZyB8fCBoKSB7ZCA9IFI7aWYgKG51bGwgIT09IGQpIHtzd2l0Y2ggKGcgJiAtZykge2Nhc2UgNDplID0gMjticmVhaztjYXNlIDE2OmUgPSA4O2JyZWFrO2Nhc2UgNjQ6Y2FzZSAxMjg6Y2FzZSAyNTY6Y2FzZSA1MTI6Y2FzZSAxMDI0OmNhc2UgMjA0ODpjYXNlIDQwOTY6Y2FzZSA4MTkyOmNhc2UgMTYzODQ6Y2FzZSAzMjc2ODpjYXNlIDY1NTM2OmNhc2UgMTMxMDcyOmNhc2UgMjYyMTQ0OmNhc2UgNTI0Mjg4OmNhc2UgMTA0ODU3NjpjYXNlIDIwOTcxNTI6Y2FzZSA0MTk0MzA0OmNhc2UgODM4ODYwODpjYXNlIDE2Nzc3MjE2OmNhc2UgMzM1NTQ0MzI6Y2FzZSA2NzEwODg2NDplID0gMzI7YnJlYWs7Y2FzZSA1MzY4NzA5MTI6ZSA9IDI2ODQzNTQ1NjticmVhaztkZWZhdWx0OmUgPSAwO31lID0gMCAhPT0gKGUgJiAoZC5zdXNwZW5kZWRMYW5lcyB8IGcpKSA/IDAgOiBlOwogICAgICAgICAgICAgICAgMCAhPT0gZSAmJiBlICE9PSBmLnJldHJ5TGFuZSAmJiAoZi5yZXRyeUxhbmUgPSBlLCBaZyhhLCBlKSwgbWgoZCwgYSwgZSwgLTEpKTt9dWooKTtkID0gTGkoRXJyb3IocCg0MjEpKSk7cmV0dXJuIHRqKGEsIGIsIGcsIGQpO31pZiAoIiQ/IiA9PT0gZS5kYXRhKSByZXR1cm4gYi5mbGFncyB8PSAxMjgsIGIuY2hpbGQgPSBhLmNoaWxkLCBiID0gdmouYmluZChudWxsLCBhKSwgZS5fcmVhY3RSZXRyeSA9IGIsIG51bGw7YSA9IGYudHJlZUNvbnRleHQ7eWcgPSBMZihlLm5leHRTaWJsaW5nKTt4ZyA9IGI7SSA9ICEwO3pnID0gbnVsbDtudWxsICE9PSBhICYmIChvZ1twZysrXSA9IHJnLCBvZ1twZysrXSA9IHNnLCBvZ1twZysrXSA9IHFnLCByZyA9IGEuaWQsIHNnID0gYS5vdmVyZmxvdywgcWcgPSBiKTtiID0gcmooYiwgZC5jaGlsZHJlbik7Yi5mbGFncyB8PSA0MDk2O3JldHVybiBiO31mdW5jdGlvbiB3aihhLCBiLCBjKSB7YS5sYW5lcyB8PSBiO3ZhciBkID0gYS5hbHRlcm5hdGU7bnVsbCAhPT0gZCAmJiAoZC5sYW5lcyB8PSBiKTtTZyhhLnJldHVybiwgYiwgYyk7fQogICAgICAgICAgZnVuY3Rpb24geGooYSwgYiwgYywgZCwgZSkge3ZhciBmID0gYS5tZW1vaXplZFN0YXRlO251bGwgPT09IGYgPyBhLm1lbW9pemVkU3RhdGUgPSB7IGlzQmFja3dhcmRzOiBiLCByZW5kZXJpbmc6IG51bGwsIHJlbmRlcmluZ1N0YXJ0VGltZTogMCwgbGFzdDogZCwgdGFpbDogYywgdGFpbE1vZGU6IGUgfSA6IChmLmlzQmFja3dhcmRzID0gYiwgZi5yZW5kZXJpbmcgPSBudWxsLCBmLnJlbmRlcmluZ1N0YXJ0VGltZSA9IDAsIGYubGFzdCA9IGQsIGYudGFpbCA9IGMsIGYudGFpbE1vZGUgPSBlKTt9CiAgICAgICAgICBmdW5jdGlvbiB5aihhLCBiLCBjKSB7dmFyIGQgPSBiLnBlbmRpbmdQcm9wcyxlID0gZC5yZXZlYWxPcmRlcixmID0gZC50YWlsO1lpKGEsIGIsIGQuY2hpbGRyZW4sIGMpO2QgPSBNLmN1cnJlbnQ7aWYgKDAgIT09IChkICYgMikpIGQgPSBkICYgMSB8IDIsIGIuZmxhZ3MgfD0gMTI4O2Vsc2Uge2lmIChudWxsICE9PSBhICYmIDAgIT09IChhLmZsYWdzICYgMTI4KSkgYTogZm9yIChhID0gYi5jaGlsZDsgbnVsbCAhPT0gYTspIHtpZiAoMTMgPT09IGEudGFnKSBudWxsICE9PSBhLm1lbW9pemVkU3RhdGUgJiYgd2ooYSwgYywgYik7ZWxzZSBpZiAoMTkgPT09IGEudGFnKSB3aihhLCBjLCBiKTtlbHNlIGlmIChudWxsICE9PSBhLmNoaWxkKSB7YS5jaGlsZC5yZXR1cm4gPSBhO2EgPSBhLmNoaWxkO2NvbnRpbnVlO31pZiAoYSA9PT0gYikgYnJlYWsgYTtmb3IgKDsgbnVsbCA9PT0gYS5zaWJsaW5nOykge2lmIChudWxsID09PSBhLnJldHVybiB8fCBhLnJldHVybiA9PT0gYikgYnJlYWsgYTthID0gYS5yZXR1cm47fWEuc2libGluZy5yZXR1cm4gPSBhLnJldHVybjthID0gYS5zaWJsaW5nO31kICY9IDE7fUcoTSwgZCk7aWYgKDAgPT09IChiLm1vZGUgJiAxKSkgYi5tZW1vaXplZFN0YXRlID0KICAgICAgICAgICAgbnVsbDtlbHNlIHN3aXRjaCAoZSkge2Nhc2UgImZvcndhcmRzIjpjID0gYi5jaGlsZDtmb3IgKGUgPSBudWxsOyBudWxsICE9PSBjOykge2EgPSBjLmFsdGVybmF0ZSwgbnVsbCAhPT0gYSAmJiBudWxsID09PSBNaChhKSAmJiAoZSA9IGMpLCBjID0gYy5zaWJsaW5nO31jID0gZTtudWxsID09PSBjID8gKGUgPSBiLmNoaWxkLCBiLmNoaWxkID0gbnVsbCkgOiAoZSA9IGMuc2libGluZywgYy5zaWJsaW5nID0gbnVsbCk7eGooYiwgITEsIGUsIGMsIGYpO2JyZWFrO2Nhc2UgImJhY2t3YXJkcyI6YyA9IG51bGw7ZSA9IGIuY2hpbGQ7Zm9yIChiLmNoaWxkID0gbnVsbDsgbnVsbCAhPT0gZTspIHthID0gZS5hbHRlcm5hdGU7aWYgKG51bGwgIT09IGEgJiYgbnVsbCA9PT0gTWgoYSkpIHtiLmNoaWxkID0gZTticmVhazt9YSA9IGUuc2libGluZztlLnNpYmxpbmcgPSBjO2MgPSBlO2UgPSBhO314aihiLCAhMCwgYywgbnVsbCwgZik7YnJlYWs7Y2FzZSAidG9nZXRoZXIiOnhqKGIsICExLCBudWxsLCBudWxsLCB2b2lkIDApO2JyZWFrO2RlZmF1bHQ6Yi5tZW1vaXplZFN0YXRlID0gbnVsbDt9cmV0dXJuIGIuY2hpbGQ7fQogICAgICAgICAgZnVuY3Rpb24gamooYSwgYikgezAgPT09IChiLm1vZGUgJiAxKSAmJiBudWxsICE9PSBhICYmIChhLmFsdGVybmF0ZSA9IG51bGwsIGIuYWx0ZXJuYXRlID0gbnVsbCwgYi5mbGFncyB8PSAyKTt9ZnVuY3Rpb24gJGkoYSwgYiwgYykge251bGwgIT09IGEgJiYgKGIuZGVwZW5kZW5jaWVzID0gYS5kZXBlbmRlbmNpZXMpO2hoIHw9IGIubGFuZXM7aWYgKDAgPT09IChjICYgYi5jaGlsZExhbmVzKSkgcmV0dXJuIG51bGw7aWYgKG51bGwgIT09IGEgJiYgYi5jaGlsZCAhPT0gYS5jaGlsZCkgdGhyb3cgRXJyb3IocCgxNTMpKTtpZiAobnVsbCAhPT0gYi5jaGlsZCkge2EgPSBiLmNoaWxkO2MgPSB3aChhLCBhLnBlbmRpbmdQcm9wcyk7Yi5jaGlsZCA9IGM7Zm9yIChjLnJldHVybiA9IGI7IG51bGwgIT09IGEuc2libGluZzspIHthID0gYS5zaWJsaW5nLCBjID0gYy5zaWJsaW5nID0gd2goYSwgYS5wZW5kaW5nUHJvcHMpLCBjLnJldHVybiA9IGI7fWMuc2libGluZyA9IG51bGw7fXJldHVybiBiLmNoaWxkO30KICAgICAgICAgIGZ1bmN0aW9uIHpqKGEsIGIsIGMpIHtzd2l0Y2ggKGIudGFnKSB7Y2FzZSAzOmxqKGIpO0lnKCk7YnJlYWs7Y2FzZSA1OktoKGIpO2JyZWFrO2Nhc2UgMTpaZihiLnR5cGUpICYmIGNnKGIpO2JyZWFrO2Nhc2UgNDpJaChiLCBiLnN0YXRlTm9kZS5jb250YWluZXJJbmZvKTticmVhaztjYXNlIDEwOnZhciBkID0gYi50eXBlLl9jb250ZXh0LGUgPSBiLm1lbW9pemVkUHJvcHMudmFsdWU7RyhNZywgZC5fY3VycmVudFZhbHVlKTtkLl9jdXJyZW50VmFsdWUgPSBlO2JyZWFrO2Nhc2UgMTM6ZCA9IGIubWVtb2l6ZWRTdGF0ZTtpZiAobnVsbCAhPT0gZCkge2lmIChudWxsICE9PSBkLmRlaHlkcmF0ZWQpIHJldHVybiBHKE0sIE0uY3VycmVudCAmIDEpLCBiLmZsYWdzIHw9IDEyOCwgbnVsbDtpZiAoMCAhPT0gKGMgJiBiLmNoaWxkLmNoaWxkTGFuZXMpKSByZXR1cm4gcGooYSwgYiwgYyk7RyhNLCBNLmN1cnJlbnQgJiAxKTthID0gJGkoYSwgYiwgYyk7cmV0dXJuIG51bGwgIT09IGEgPyBhLnNpYmxpbmcgOiBudWxsO31HKE0sIE0uY3VycmVudCAmIDEpO2JyZWFrO2Nhc2UgMTk6ZCA9IDAgIT09IChjICYKICAgICAgICAgICAgICAgIGIuY2hpbGRMYW5lcyk7aWYgKDAgIT09IChhLmZsYWdzICYgMTI4KSkge2lmIChkKSByZXR1cm4geWooYSwgYiwgYyk7Yi5mbGFncyB8PSAxMjg7fWUgPSBiLm1lbW9pemVkU3RhdGU7bnVsbCAhPT0gZSAmJiAoZS5yZW5kZXJpbmcgPSBudWxsLCBlLnRhaWwgPSBudWxsLCBlLmxhc3RFZmZlY3QgPSBudWxsKTtHKE0sIE0uY3VycmVudCk7aWYgKGQpIGJyZWFrO2Vsc2UgcmV0dXJuIG51bGw7Y2FzZSAyMjpjYXNlIDIzOnJldHVybiBiLmxhbmVzID0gMCwgZWooYSwgYiwgYyk7fXJldHVybiAkaShhLCBiLCBjKTt9dmFyIEFqLCBCaiwgQ2osIERqOwogICAgICAgICAgQWogPSBmdW5jdGlvbiBBaihhLCBiKSB7Zm9yICh2YXIgYyA9IGIuY2hpbGQ7IG51bGwgIT09IGM7KSB7aWYgKDUgPT09IGMudGFnIHx8IDYgPT09IGMudGFnKSBhLmFwcGVuZENoaWxkKGMuc3RhdGVOb2RlKTtlbHNlIGlmICg0ICE9PSBjLnRhZyAmJiBudWxsICE9PSBjLmNoaWxkKSB7Yy5jaGlsZC5yZXR1cm4gPSBjO2MgPSBjLmNoaWxkO2NvbnRpbnVlO31pZiAoYyA9PT0gYikgYnJlYWs7Zm9yICg7IG51bGwgPT09IGMuc2libGluZzspIHtpZiAobnVsbCA9PT0gYy5yZXR1cm4gfHwgYy5yZXR1cm4gPT09IGIpIHJldHVybjtjID0gYy5yZXR1cm47fWMuc2libGluZy5yZXR1cm4gPSBjLnJldHVybjtjID0gYy5zaWJsaW5nO319O0JqID0gZnVuY3Rpb24gQmooKSB7fTsKICAgICAgICAgIENqID0gZnVuY3Rpb24gQ2ooYSwgYiwgYywgZCkge3ZhciBlID0gYS5tZW1vaXplZFByb3BzO2lmIChlICE9PSBkKSB7YSA9IGIuc3RhdGVOb2RlO0hoKEVoLmN1cnJlbnQpO3ZhciBmID0gbnVsbDtzd2l0Y2ggKGMpIHtjYXNlICJpbnB1dCI6ZSA9IFlhKGEsIGUpO2QgPSBZYShhLCBkKTtmID0gW107YnJlYWs7Y2FzZSAic2VsZWN0IjplID0gQSh7fSwgZSwgeyB2YWx1ZTogdm9pZCAwIH0pO2QgPSBBKHt9LCBkLCB7IHZhbHVlOiB2b2lkIDAgfSk7ZiA9IFtdO2JyZWFrO2Nhc2UgInRleHRhcmVhIjplID0gZ2IoYSwgZSk7ZCA9IGdiKGEsIGQpO2YgPSBbXTticmVhaztkZWZhdWx0OiJmdW5jdGlvbiIgIT09IHR5cGVvZiBlLm9uQ2xpY2sgJiYgImZ1bmN0aW9uIiA9PT0gdHlwZW9mIGQub25DbGljayAmJiAoYS5vbmNsaWNrID0gQmYpO311YihjLCBkKTt2YXIgZztjID0gbnVsbDtmb3IgKGwgaW4gZSkge2lmICghZC5oYXNPd25Qcm9wZXJ0eShsKSAmJiBlLmhhc093blByb3BlcnR5KGwpICYmIG51bGwgIT0gZVtsXSkgaWYgKCJzdHlsZSIgPT09IGwpIHt2YXIgaCA9IGVbbF07Zm9yIChnIGluIGgpIHtoLmhhc093blByb3BlcnR5KGcpICYmICgKICAgICAgICAgICAgICAgICAgICBjIHx8IChjID0ge30pLCBjW2ddID0gIiIpO319IGVsc2UgImRhbmdlcm91c2x5U2V0SW5uZXJIVE1MIiAhPT0gbCAmJiAiY2hpbGRyZW4iICE9PSBsICYmICJzdXBwcmVzc0NvbnRlbnRFZGl0YWJsZVdhcm5pbmciICE9PSBsICYmICJzdXBwcmVzc0h5ZHJhdGlvbldhcm5pbmciICE9PSBsICYmICJhdXRvRm9jdXMiICE9PSBsICYmIChlYS5oYXNPd25Qcm9wZXJ0eShsKSA/IGYgfHwgKGYgPSBbXSkgOiAoZiA9IGYgfHwgW10pLnB1c2gobCwgbnVsbCkpO31mb3IgKGwgaW4gZCkge3ZhciBrID0gZFtsXTtoID0gbnVsbCAhPSBlID8gZVtsXSA6IHZvaWQgMDtpZiAoZC5oYXNPd25Qcm9wZXJ0eShsKSAmJiBrICE9PSBoICYmIChudWxsICE9IGsgfHwgbnVsbCAhPSBoKSkgaWYgKCJzdHlsZSIgPT09IGwpIHtpZiAoaCkge2ZvciAoZyBpbiBoKSB7IWguaGFzT3duUHJvcGVydHkoZykgfHwgayAmJiBrLmhhc093blByb3BlcnR5KGcpIHx8IChjIHx8IChjID0ge30pLCBjW2ddID0gIiIpO31mb3IgKGcgaW4gaykge2suaGFzT3duUHJvcGVydHkoZykgJiYgaFtnXSAhPT0ga1tnXSAmJiAoYyB8fCAoYyA9IHt9KSwgY1tnXSA9IGtbZ10pO319IGVsc2UgYyB8fCAoZiB8fCAoZiA9IFtdKSwgZi5wdXNoKGwsCiAgICAgICAgICAgICAgICAgIGMpKSwgYyA9IGs7fSBlbHNlICJkYW5nZXJvdXNseVNldElubmVySFRNTCIgPT09IGwgPyAoayA9IGsgPyBrLl9faHRtbCA6IHZvaWQgMCwgaCA9IGggPyBoLl9faHRtbCA6IHZvaWQgMCwgbnVsbCAhPSBrICYmIGggIT09IGsgJiYgKGYgPSBmIHx8IFtdKS5wdXNoKGwsIGspKSA6ICJjaGlsZHJlbiIgPT09IGwgPyAic3RyaW5nIiAhPT0gdHlwZW9mIGsgJiYgIm51bWJlciIgIT09IHR5cGVvZiBrIHx8IChmID0gZiB8fCBbXSkucHVzaChsLCAiIiArIGspIDogInN1cHByZXNzQ29udGVudEVkaXRhYmxlV2FybmluZyIgIT09IGwgJiYgInN1cHByZXNzSHlkcmF0aW9uV2FybmluZyIgIT09IGwgJiYgKGVhLmhhc093blByb3BlcnR5KGwpID8gKG51bGwgIT0gayAmJiAib25TY3JvbGwiID09PSBsICYmIEQoInNjcm9sbCIsIGEpLCBmIHx8IGggPT09IGsgfHwgKGYgPSBbXSkpIDogKGYgPSBmIHx8IFtdKS5wdXNoKGwsIGspKTt9YyAmJiAoZiA9IGYgfHwgW10pLnB1c2goInN0eWxlIiwgYyk7dmFyIGwgPSBmO2lmIChiLnVwZGF0ZVF1ZXVlID0gbCkgYi5mbGFncyB8PSA0O319O0RqID0gZnVuY3Rpb24gRGooYSwgYiwgYywgZCkge2MgIT09IGQgJiYgKGIuZmxhZ3MgfD0gNCk7fTsKICAgICAgICAgIGZ1bmN0aW9uIEVqKGEsIGIpIHtpZiAoIUkpIHN3aXRjaCAoYS50YWlsTW9kZSkge2Nhc2UgImhpZGRlbiI6YiA9IGEudGFpbDtmb3IgKHZhciBjID0gbnVsbDsgbnVsbCAhPT0gYjspIHtudWxsICE9PSBiLmFsdGVybmF0ZSAmJiAoYyA9IGIpLCBiID0gYi5zaWJsaW5nO31udWxsID09PSBjID8gYS50YWlsID0gbnVsbCA6IGMuc2libGluZyA9IG51bGw7YnJlYWs7Y2FzZSAiY29sbGFwc2VkIjpjID0gYS50YWlsO2ZvciAodmFyIGQgPSBudWxsOyBudWxsICE9PSBjOykge251bGwgIT09IGMuYWx0ZXJuYXRlICYmIChkID0gYyksIGMgPSBjLnNpYmxpbmc7fW51bGwgPT09IGQgPyBiIHx8IG51bGwgPT09IGEudGFpbCA/IGEudGFpbCA9IG51bGwgOiBhLnRhaWwuc2libGluZyA9IG51bGwgOiBkLnNpYmxpbmcgPSBudWxsO319CiAgICAgICAgICBmdW5jdGlvbiBTKGEpIHt2YXIgYiA9IG51bGwgIT09IGEuYWx0ZXJuYXRlICYmIGEuYWx0ZXJuYXRlLmNoaWxkID09PSBhLmNoaWxkLGMgPSAwLGQgPSAwO2lmIChiKSBmb3IgKHZhciBlID0gYS5jaGlsZDsgbnVsbCAhPT0gZTspIHtjIHw9IGUubGFuZXMgfCBlLmNoaWxkTGFuZXMsIGQgfD0gZS5zdWJ0cmVlRmxhZ3MgJiAxNDY4MDA2NCwgZCB8PSBlLmZsYWdzICYgMTQ2ODAwNjQsIGUucmV0dXJuID0gYSwgZSA9IGUuc2libGluZzt9IGVsc2UgZm9yIChlID0gYS5jaGlsZDsgbnVsbCAhPT0gZTspIHtjIHw9IGUubGFuZXMgfCBlLmNoaWxkTGFuZXMsIGQgfD0gZS5zdWJ0cmVlRmxhZ3MsIGQgfD0gZS5mbGFncywgZS5yZXR1cm4gPSBhLCBlID0gZS5zaWJsaW5nO31hLnN1YnRyZWVGbGFncyB8PSBkO2EuY2hpbGRMYW5lcyA9IGM7cmV0dXJuIGI7fQogICAgICAgICAgZnVuY3Rpb24gRmooYSwgYiwgYykge3ZhciBkID0gYi5wZW5kaW5nUHJvcHM7d2coYik7c3dpdGNoIChiLnRhZykge2Nhc2UgMjpjYXNlIDE2OmNhc2UgMTU6Y2FzZSAwOmNhc2UgMTE6Y2FzZSA3OmNhc2UgODpjYXNlIDEyOmNhc2UgOTpjYXNlIDE0OnJldHVybiBTKGIpLCBudWxsO2Nhc2UgMTpyZXR1cm4gWmYoYi50eXBlKSAmJiAkZigpLCBTKGIpLCBudWxsO2Nhc2UgMzpkID0gYi5zdGF0ZU5vZGU7SmgoKTtFKFdmKTtFKEgpO09oKCk7ZC5wZW5kaW5nQ29udGV4dCAmJiAoZC5jb250ZXh0ID0gZC5wZW5kaW5nQ29udGV4dCwgZC5wZW5kaW5nQ29udGV4dCA9IG51bGwpO2lmIChudWxsID09PSBhIHx8IG51bGwgPT09IGEuY2hpbGQpIEdnKGIpID8gYi5mbGFncyB8PSA0IDogbnVsbCA9PT0gYSB8fCBhLm1lbW9pemVkU3RhdGUuaXNEZWh5ZHJhdGVkICYmIDAgPT09IChiLmZsYWdzICYgMjU2KSB8fCAoYi5mbGFncyB8PSAxMDI0LCBudWxsICE9PSB6ZyAmJiAoR2ooemcpLCB6ZyA9IG51bGwpKTtCaihhLCBiKTtTKGIpO3JldHVybiBudWxsO2Nhc2UgNTpMaChiKTt2YXIgZSA9IEhoKEdoLmN1cnJlbnQpOwogICAgICAgICAgICAgICAgYyA9IGIudHlwZTtpZiAobnVsbCAhPT0gYSAmJiBudWxsICE9IGIuc3RhdGVOb2RlKSBDaihhLCBiLCBjLCBkLCBlKSwgYS5yZWYgIT09IGIucmVmICYmIChiLmZsYWdzIHw9IDUxMiwgYi5mbGFncyB8PSAyMDk3MTUyKTtlbHNlIHtpZiAoIWQpIHtpZiAobnVsbCA9PT0gYi5zdGF0ZU5vZGUpIHRocm93IEVycm9yKHAoMTY2KSk7UyhiKTtyZXR1cm4gbnVsbDt9YSA9IEhoKEVoLmN1cnJlbnQpO2lmIChHZyhiKSkge2QgPSBiLnN0YXRlTm9kZTtjID0gYi50eXBlO3ZhciBmID0gYi5tZW1vaXplZFByb3BzO2RbT2ZdID0gYjtkW1BmXSA9IGY7YSA9IDAgIT09IChiLm1vZGUgJiAxKTtzd2l0Y2ggKGMpIHtjYXNlICJkaWFsb2ciOkQoImNhbmNlbCIsIGQpO0QoImNsb3NlIiwgZCk7YnJlYWs7Y2FzZSAiaWZyYW1lIjpjYXNlICJvYmplY3QiOmNhc2UgImVtYmVkIjpEKCJsb2FkIiwgZCk7YnJlYWs7Y2FzZSAidmlkZW8iOmNhc2UgImF1ZGlvIjpmb3IgKGUgPSAwOyBlIDwgbGYubGVuZ3RoOyBlKyspIHtEKGxmW2VdLCBkKTt9YnJlYWs7Y2FzZSAic291cmNlIjpEKCJlcnJvciIsIGQpO2JyZWFrO2Nhc2UgImltZyI6Y2FzZSAiaW1hZ2UiOmNhc2UgImxpbmsiOkQoImVycm9yIiwKICAgICAgICAgICAgICAgICAgICAgICAgZCk7RCgibG9hZCIsIGQpO2JyZWFrO2Nhc2UgImRldGFpbHMiOkQoInRvZ2dsZSIsIGQpO2JyZWFrO2Nhc2UgImlucHV0IjpaYShkLCBmKTtEKCJpbnZhbGlkIiwgZCk7YnJlYWs7Y2FzZSAic2VsZWN0IjpkLl93cmFwcGVyU3RhdGUgPSB7IHdhc011bHRpcGxlOiAhIWYubXVsdGlwbGUgfTtEKCJpbnZhbGlkIiwgZCk7YnJlYWs7Y2FzZSAidGV4dGFyZWEiOmhiKGQsIGYpLCBEKCJpbnZhbGlkIiwgZCk7fXViKGMsIGYpO2UgPSBudWxsO2ZvciAodmFyIGcgaW4gZikge2lmIChmLmhhc093blByb3BlcnR5KGcpKSB7dmFyIGggPSBmW2ddOyJjaGlsZHJlbiIgPT09IGcgPyAic3RyaW5nIiA9PT0gdHlwZW9mIGggPyBkLnRleHRDb250ZW50ICE9PSBoICYmICghMCAhPT0gZi5zdXBwcmVzc0h5ZHJhdGlvbldhcm5pbmcgJiYgQWYoZC50ZXh0Q29udGVudCwgaCwgYSksIGUgPSBbImNoaWxkcmVuIiwgaF0pIDogIm51bWJlciIgPT09IHR5cGVvZiBoICYmIGQudGV4dENvbnRlbnQgIT09ICIiICsgaCAmJiAoITAgIT09IGYuc3VwcHJlc3NIeWRyYXRpb25XYXJuaW5nICYmIEFmKGQudGV4dENvbnRlbnQsCiAgICAgICAgICAgICAgICAgICAgICAgIGgsIGEpLCBlID0gWyJjaGlsZHJlbiIsICIiICsgaF0pIDogZWEuaGFzT3duUHJvcGVydHkoZykgJiYgbnVsbCAhPSBoICYmICJvblNjcm9sbCIgPT09IGcgJiYgRCgic2Nyb2xsIiwgZCk7fX1zd2l0Y2ggKGMpIHtjYXNlICJpbnB1dCI6VmEoZCk7ZGIoZCwgZiwgITApO2JyZWFrO2Nhc2UgInRleHRhcmVhIjpWYShkKTtqYihkKTticmVhaztjYXNlICJzZWxlY3QiOmNhc2UgIm9wdGlvbiI6YnJlYWs7ZGVmYXVsdDoiZnVuY3Rpb24iID09PSB0eXBlb2YgZi5vbkNsaWNrICYmIChkLm9uY2xpY2sgPSBCZik7fWQgPSBlO2IudXBkYXRlUXVldWUgPSBkO251bGwgIT09IGQgJiYgKGIuZmxhZ3MgfD0gNCk7fSBlbHNlIHtnID0gOSA9PT0gZS5ub2RlVHlwZSA/IGUgOiBlLm93bmVyRG9jdW1lbnQ7Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGh0bWwiID09PSBhICYmIChhID0ga2IoYykpOyJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hodG1sIiA9PT0gYSA/ICJzY3JpcHQiID09PSBjID8gKGEgPSBnLmNyZWF0ZUVsZW1lbnQoImRpdiIpLCBhLmlubmVySFRNTCA9ICI8c2NyaXB0Plx4M2Mvc2NyaXB0PiIsIGEgPSBhLnJlbW92ZUNoaWxkKGEuZmlyc3RDaGlsZCkpIDoKICAgICAgICAgICAgICAgICAgICAic3RyaW5nIiA9PT0gdHlwZW9mIGQuaXMgPyBhID0gZy5jcmVhdGVFbGVtZW50KGMsIHsgaXM6IGQuaXMgfSkgOiAoYSA9IGcuY3JlYXRlRWxlbWVudChjKSwgInNlbGVjdCIgPT09IGMgJiYgKGcgPSBhLCBkLm11bHRpcGxlID8gZy5tdWx0aXBsZSA9ICEwIDogZC5zaXplICYmIChnLnNpemUgPSBkLnNpemUpKSkgOiBhID0gZy5jcmVhdGVFbGVtZW50TlMoYSwgYyk7YVtPZl0gPSBiO2FbUGZdID0gZDtBaihhLCBiLCAhMSwgITEpO2Iuc3RhdGVOb2RlID0gYTthOiB7ZyA9IHZiKGMsIGQpO3N3aXRjaCAoYykge2Nhc2UgImRpYWxvZyI6RCgiY2FuY2VsIiwgYSk7RCgiY2xvc2UiLCBhKTtlID0gZDticmVhaztjYXNlICJpZnJhbWUiOmNhc2UgIm9iamVjdCI6Y2FzZSAiZW1iZWQiOkQoImxvYWQiLCBhKTtlID0gZDticmVhaztjYXNlICJ2aWRlbyI6Y2FzZSAiYXVkaW8iOmZvciAoZSA9IDA7IGUgPCBsZi5sZW5ndGg7IGUrKykge0QobGZbZV0sIGEpO31lID0gZDticmVhaztjYXNlICJzb3VyY2UiOkQoImVycm9yIiwgYSk7ZSA9IGQ7YnJlYWs7Y2FzZSAiaW1nIjpjYXNlICJpbWFnZSI6Y2FzZSAibGluayI6RCgiZXJyb3IiLAogICAgICAgICAgICAgICAgICAgICAgICAgIGEpO0QoImxvYWQiLCBhKTtlID0gZDticmVhaztjYXNlICJkZXRhaWxzIjpEKCJ0b2dnbGUiLCBhKTtlID0gZDticmVhaztjYXNlICJpbnB1dCI6WmEoYSwgZCk7ZSA9IFlhKGEsIGQpO0QoImludmFsaWQiLCBhKTticmVhaztjYXNlICJvcHRpb24iOmUgPSBkO2JyZWFrO2Nhc2UgInNlbGVjdCI6YS5fd3JhcHBlclN0YXRlID0geyB3YXNNdWx0aXBsZTogISFkLm11bHRpcGxlIH07ZSA9IEEoe30sIGQsIHsgdmFsdWU6IHZvaWQgMCB9KTtEKCJpbnZhbGlkIiwgYSk7YnJlYWs7Y2FzZSAidGV4dGFyZWEiOmhiKGEsIGQpO2UgPSBnYihhLCBkKTtEKCJpbnZhbGlkIiwgYSk7YnJlYWs7ZGVmYXVsdDplID0gZDt9dWIoYywgZSk7aCA9IGU7Zm9yIChmIGluIGgpIHtpZiAoaC5oYXNPd25Qcm9wZXJ0eShmKSkge3ZhciBrID0gaFtmXTsic3R5bGUiID09PSBmID8gc2IoYSwgaykgOiAiZGFuZ2Vyb3VzbHlTZXRJbm5lckhUTUwiID09PSBmID8gKGsgPSBrID8gay5fX2h0bWwgOiB2b2lkIDAsIG51bGwgIT0gayAmJiBuYihhLCBrKSkgOiAiY2hpbGRyZW4iID09PSBmID8gInN0cmluZyIgPT09IHR5cGVvZiBrID8gKCJ0ZXh0YXJlYSIgIT09CiAgICAgICAgICAgICAgICAgICAgICAgICAgYyB8fCAiIiAhPT0gaykgJiYgb2IoYSwgaykgOiAibnVtYmVyIiA9PT0gdHlwZW9mIGsgJiYgb2IoYSwgIiIgKyBrKSA6ICJzdXBwcmVzc0NvbnRlbnRFZGl0YWJsZVdhcm5pbmciICE9PSBmICYmICJzdXBwcmVzc0h5ZHJhdGlvbldhcm5pbmciICE9PSBmICYmICJhdXRvRm9jdXMiICE9PSBmICYmIChlYS5oYXNPd25Qcm9wZXJ0eShmKSA/IG51bGwgIT0gayAmJiAib25TY3JvbGwiID09PSBmICYmIEQoInNjcm9sbCIsIGEpIDogbnVsbCAhPSBrICYmIHRhKGEsIGYsIGssIGcpKTt9fXN3aXRjaCAoYykge2Nhc2UgImlucHV0IjpWYShhKTtkYihhLCBkLCAhMSk7YnJlYWs7Y2FzZSAidGV4dGFyZWEiOlZhKGEpO2piKGEpO2JyZWFrO2Nhc2UgIm9wdGlvbiI6bnVsbCAhPSBkLnZhbHVlICYmIGEuc2V0QXR0cmlidXRlKCJ2YWx1ZSIsICIiICsgU2EoZC52YWx1ZSkpO2JyZWFrO2Nhc2UgInNlbGVjdCI6YS5tdWx0aXBsZSA9ICEhZC5tdWx0aXBsZTtmID0gZC52YWx1ZTtudWxsICE9IGYgPyBmYihhLCAhIWQubXVsdGlwbGUsIGYsICExKSA6IG51bGwgIT0gZC5kZWZhdWx0VmFsdWUgJiYgZmIoYSwgISFkLm11bHRpcGxlLCBkLmRlZmF1bHRWYWx1ZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAhMCk7YnJlYWs7ZGVmYXVsdDoiZnVuY3Rpb24iID09PSB0eXBlb2YgZS5vbkNsaWNrICYmIChhLm9uY2xpY2sgPSBCZik7fXN3aXRjaCAoYykge2Nhc2UgImJ1dHRvbiI6Y2FzZSAiaW5wdXQiOmNhc2UgInNlbGVjdCI6Y2FzZSAidGV4dGFyZWEiOmQgPSAhIWQuYXV0b0ZvY3VzO2JyZWFrIGE7Y2FzZSAiaW1nIjpkID0gITA7YnJlYWsgYTtkZWZhdWx0OmQgPSAhMTt9fWQgJiYgKGIuZmxhZ3MgfD0gNCk7fW51bGwgIT09IGIucmVmICYmIChiLmZsYWdzIHw9IDUxMiwgYi5mbGFncyB8PSAyMDk3MTUyKTt9UyhiKTtyZXR1cm4gbnVsbDtjYXNlIDY6aWYgKGEgJiYgbnVsbCAhPSBiLnN0YXRlTm9kZSkgRGooYSwgYiwgYS5tZW1vaXplZFByb3BzLCBkKTtlbHNlIHtpZiAoInN0cmluZyIgIT09IHR5cGVvZiBkICYmIG51bGwgPT09IGIuc3RhdGVOb2RlKSB0aHJvdyBFcnJvcihwKDE2NikpO2MgPSBIaChHaC5jdXJyZW50KTtIaChFaC5jdXJyZW50KTtpZiAoR2coYikpIHtkID0gYi5zdGF0ZU5vZGU7YyA9IGIubWVtb2l6ZWRQcm9wcztkW09mXSA9IGI7aWYgKGYgPSBkLm5vZGVWYWx1ZSAhPT0gYykgaWYgKGEgPQogICAgICAgICAgICAgICAgICAgIHhnLCBudWxsICE9PSBhKSBzd2l0Y2ggKGEudGFnKSB7Y2FzZSAzOkFmKGQubm9kZVZhbHVlLCBjLCAwICE9PSAoYS5tb2RlICYgMSkpO2JyZWFrO2Nhc2UgNTohMCAhPT0gYS5tZW1vaXplZFByb3BzLnN1cHByZXNzSHlkcmF0aW9uV2FybmluZyAmJiBBZihkLm5vZGVWYWx1ZSwgYywgMCAhPT0gKGEubW9kZSAmIDEpKTt9ZiAmJiAoYi5mbGFncyB8PSA0KTt9IGVsc2UgZCA9ICg5ID09PSBjLm5vZGVUeXBlID8gYyA6IGMub3duZXJEb2N1bWVudCkuY3JlYXRlVGV4dE5vZGUoZCksIGRbT2ZdID0gYiwgYi5zdGF0ZU5vZGUgPSBkO31TKGIpO3JldHVybiBudWxsO2Nhc2UgMTM6RShNKTtkID0gYi5tZW1vaXplZFN0YXRlO2lmIChudWxsID09PSBhIHx8IG51bGwgIT09IGEubWVtb2l6ZWRTdGF0ZSAmJiBudWxsICE9PSBhLm1lbW9pemVkU3RhdGUuZGVoeWRyYXRlZCkge2lmIChJICYmIG51bGwgIT09IHlnICYmIDAgIT09IChiLm1vZGUgJiAxKSAmJiAwID09PSAoYi5mbGFncyAmIDEyOCkpIEhnKCksIElnKCksIGIuZmxhZ3MgfD0gOTg1NjAsIGYgPSAhMTtlbHNlIGlmIChmID0gR2coYiksIG51bGwgIT09IGQgJiYgbnVsbCAhPT0gZC5kZWh5ZHJhdGVkKSB7aWYgKG51bGwgPT09CiAgICAgICAgICAgICAgICAgICAgYSkge2lmICghZikgdGhyb3cgRXJyb3IocCgzMTgpKTtmID0gYi5tZW1vaXplZFN0YXRlO2YgPSBudWxsICE9PSBmID8gZi5kZWh5ZHJhdGVkIDogbnVsbDtpZiAoIWYpIHRocm93IEVycm9yKHAoMzE3KSk7ZltPZl0gPSBiO30gZWxzZSBJZygpLCAwID09PSAoYi5mbGFncyAmIDEyOCkgJiYgKGIubWVtb2l6ZWRTdGF0ZSA9IG51bGwpLCBiLmZsYWdzIHw9IDQ7UyhiKTtmID0gITE7fSBlbHNlIG51bGwgIT09IHpnICYmIChHaih6ZyksIHpnID0gbnVsbCksIGYgPSAhMDtpZiAoIWYpIHJldHVybiBiLmZsYWdzICYgNjU1MzYgPyBiIDogbnVsbDt9aWYgKDAgIT09IChiLmZsYWdzICYgMTI4KSkgcmV0dXJuIGIubGFuZXMgPSBjLCBiO2QgPSBudWxsICE9PSBkO2QgIT09IChudWxsICE9PSBhICYmIG51bGwgIT09IGEubWVtb2l6ZWRTdGF0ZSkgJiYgZCAmJiAoYi5jaGlsZC5mbGFncyB8PSA4MTkyLCAwICE9PSAoYi5tb2RlICYgMSkgJiYgKG51bGwgPT09IGEgfHwgMCAhPT0gKE0uY3VycmVudCAmIDEpID8gMCA9PT0gVCAmJiAoVCA9IDMpIDogdWooKSkpO251bGwgIT09IGIudXBkYXRlUXVldWUgJiYgKGIuZmxhZ3MgfD0gNCk7UyhiKTtyZXR1cm4gbnVsbDtjYXNlIDQ6cmV0dXJuIEpoKCksCiAgICAgICAgICAgICAgICBCaihhLCBiKSwgbnVsbCA9PT0gYSAmJiBzZihiLnN0YXRlTm9kZS5jb250YWluZXJJbmZvKSwgUyhiKSwgbnVsbDtjYXNlIDEwOnJldHVybiBSZyhiLnR5cGUuX2NvbnRleHQpLCBTKGIpLCBudWxsO2Nhc2UgMTc6cmV0dXJuIFpmKGIudHlwZSkgJiYgJGYoKSwgUyhiKSwgbnVsbDtjYXNlIDE5OkUoTSk7ZiA9IGIubWVtb2l6ZWRTdGF0ZTtpZiAobnVsbCA9PT0gZikgcmV0dXJuIFMoYiksIG51bGw7ZCA9IDAgIT09IChiLmZsYWdzICYgMTI4KTtnID0gZi5yZW5kZXJpbmc7aWYgKG51bGwgPT09IGcpIHtpZiAoZCkgRWooZiwgITEpO2Vsc2Uge2lmICgwICE9PSBUIHx8IG51bGwgIT09IGEgJiYgMCAhPT0gKGEuZmxhZ3MgJiAxMjgpKSBmb3IgKGEgPSBiLmNoaWxkOyBudWxsICE9PSBhOykge2cgPSBNaChhKTtpZiAobnVsbCAhPT0gZykge2IuZmxhZ3MgfD0gMTI4O0VqKGYsICExKTtkID0gZy51cGRhdGVRdWV1ZTtudWxsICE9PSBkICYmIChiLnVwZGF0ZVF1ZXVlID0gZCwgYi5mbGFncyB8PSA0KTtiLnN1YnRyZWVGbGFncyA9IDA7ZCA9IGM7Zm9yIChjID0gYi5jaGlsZDsgbnVsbCAhPT0gYzspIHtmID0gYywgYSA9IGQsIGYuZmxhZ3MgJj0gMTQ2ODAwNjYsCiAgICAgICAgICAgICAgICAgICAgICAgICAgZyA9IGYuYWx0ZXJuYXRlLCBudWxsID09PSBnID8gKGYuY2hpbGRMYW5lcyA9IDAsIGYubGFuZXMgPSBhLCBmLmNoaWxkID0gbnVsbCwgZi5zdWJ0cmVlRmxhZ3MgPSAwLCBmLm1lbW9pemVkUHJvcHMgPSBudWxsLCBmLm1lbW9pemVkU3RhdGUgPSBudWxsLCBmLnVwZGF0ZVF1ZXVlID0gbnVsbCwgZi5kZXBlbmRlbmNpZXMgPSBudWxsLCBmLnN0YXRlTm9kZSA9IG51bGwpIDogKGYuY2hpbGRMYW5lcyA9IGcuY2hpbGRMYW5lcywgZi5sYW5lcyA9IGcubGFuZXMsIGYuY2hpbGQgPSBnLmNoaWxkLCBmLnN1YnRyZWVGbGFncyA9IDAsIGYuZGVsZXRpb25zID0gbnVsbCwgZi5tZW1vaXplZFByb3BzID0gZy5tZW1vaXplZFByb3BzLCBmLm1lbW9pemVkU3RhdGUgPSBnLm1lbW9pemVkU3RhdGUsIGYudXBkYXRlUXVldWUgPSBnLnVwZGF0ZVF1ZXVlLCBmLnR5cGUgPSBnLnR5cGUsIGEgPSBnLmRlcGVuZGVuY2llcywgZi5kZXBlbmRlbmNpZXMgPSBudWxsID09PSBhID8gbnVsbCA6IHsgbGFuZXM6IGEubGFuZXMsIGZpcnN0Q29udGV4dDogYS5maXJzdENvbnRleHQgfSksIGMgPSBjLnNpYmxpbmc7fUcoTSwgTS5jdXJyZW50ICYgMSB8IDIpO3JldHVybiBiLmNoaWxkO31hID0KICAgICAgICAgICAgICAgICAgICAgIGEuc2libGluZzt9bnVsbCAhPT0gZi50YWlsICYmIEIoKSA+IEhqICYmIChiLmZsYWdzIHw9IDEyOCwgZCA9ICEwLCBFaihmLCAhMSksIGIubGFuZXMgPSA0MTk0MzA0KTt9fSBlbHNlIHtpZiAoIWQpIGlmIChhID0gTWgoZyksIG51bGwgIT09IGEpIHtpZiAoYi5mbGFncyB8PSAxMjgsIGQgPSAhMCwgYyA9IGEudXBkYXRlUXVldWUsIG51bGwgIT09IGMgJiYgKGIudXBkYXRlUXVldWUgPSBjLCBiLmZsYWdzIHw9IDQpLCBFaihmLCAhMCksIG51bGwgPT09IGYudGFpbCAmJiAiaGlkZGVuIiA9PT0gZi50YWlsTW9kZSAmJiAhZy5hbHRlcm5hdGUgJiYgIUkpIHJldHVybiBTKGIpLCBudWxsO30gZWxzZSAyICogQigpIC0gZi5yZW5kZXJpbmdTdGFydFRpbWUgPiBIaiAmJiAxMDczNzQxODI0ICE9PSBjICYmIChiLmZsYWdzIHw9IDEyOCwgZCA9ICEwLCBFaihmLCAhMSksIGIubGFuZXMgPSA0MTk0MzA0KTtmLmlzQmFja3dhcmRzID8gKGcuc2libGluZyA9IGIuY2hpbGQsIGIuY2hpbGQgPSBnKSA6IChjID0gZi5sYXN0LCBudWxsICE9PSBjID8gYy5zaWJsaW5nID0gZyA6IGIuY2hpbGQgPSBnLCBmLmxhc3QgPSBnKTt9aWYgKG51bGwgIT09IGYudGFpbCkgcmV0dXJuIGIgPSBmLnRhaWwsIGYucmVuZGVyaW5nID0KICAgICAgICAgICAgICAgIGIsIGYudGFpbCA9IGIuc2libGluZywgZi5yZW5kZXJpbmdTdGFydFRpbWUgPSBCKCksIGIuc2libGluZyA9IG51bGwsIGMgPSBNLmN1cnJlbnQsIEcoTSwgZCA/IGMgJiAxIHwgMiA6IGMgJiAxKSwgYjtTKGIpO3JldHVybiBudWxsO2Nhc2UgMjI6Y2FzZSAyMzpyZXR1cm4gSWooKSwgZCA9IG51bGwgIT09IGIubWVtb2l6ZWRTdGF0ZSwgbnVsbCAhPT0gYSAmJiBudWxsICE9PSBhLm1lbW9pemVkU3RhdGUgIT09IGQgJiYgKGIuZmxhZ3MgfD0gODE5MiksIGQgJiYgMCAhPT0gKGIubW9kZSAmIDEpID8gMCAhPT0gKGdqICYgMTA3Mzc0MTgyNCkgJiYgKFMoYiksIGIuc3VidHJlZUZsYWdzICYgNiAmJiAoYi5mbGFncyB8PSA4MTkyKSkgOiBTKGIpLCBudWxsO2Nhc2UgMjQ6cmV0dXJuIG51bGw7Y2FzZSAyNTpyZXR1cm4gbnVsbDt9dGhyb3cgRXJyb3IocCgxNTYsIGIudGFnKSk7fQogICAgICAgICAgZnVuY3Rpb24gSmooYSwgYikge3dnKGIpO3N3aXRjaCAoYi50YWcpIHtjYXNlIDE6cmV0dXJuIFpmKGIudHlwZSkgJiYgJGYoKSwgYSA9IGIuZmxhZ3MsIGEgJiA2NTUzNiA/IChiLmZsYWdzID0gYSAmIC02NTUzNyB8IDEyOCwgYikgOiBudWxsO2Nhc2UgMzpyZXR1cm4gSmgoKSwgRShXZiksIEUoSCksIE9oKCksIGEgPSBiLmZsYWdzLCAwICE9PSAoYSAmIDY1NTM2KSAmJiAwID09PSAoYSAmIDEyOCkgPyAoYi5mbGFncyA9IGEgJiAtNjU1MzcgfCAxMjgsIGIpIDogbnVsbDtjYXNlIDU6cmV0dXJuIExoKGIpLCBudWxsO2Nhc2UgMTM6RShNKTthID0gYi5tZW1vaXplZFN0YXRlO2lmIChudWxsICE9PSBhICYmIG51bGwgIT09IGEuZGVoeWRyYXRlZCkge2lmIChudWxsID09PSBiLmFsdGVybmF0ZSkgdGhyb3cgRXJyb3IocCgzNDApKTtJZygpO31hID0gYi5mbGFncztyZXR1cm4gYSAmIDY1NTM2ID8gKGIuZmxhZ3MgPSBhICYgLTY1NTM3IHwgMTI4LCBiKSA6IG51bGw7Y2FzZSAxOTpyZXR1cm4gRShNKSwgbnVsbDtjYXNlIDQ6cmV0dXJuIEpoKCksIG51bGw7Y2FzZSAxMDpyZXR1cm4gUmcoYi50eXBlLl9jb250ZXh0KSwgbnVsbDtjYXNlIDIyOmNhc2UgMjM6cmV0dXJuIElqKCksCiAgICAgICAgICAgICAgICBudWxsO2Nhc2UgMjQ6cmV0dXJuIG51bGw7ZGVmYXVsdDpyZXR1cm4gbnVsbDt9fXZhciBLaiA9ICExLFUgPSAhMSxMaiA9ICJmdW5jdGlvbiIgPT09IHR5cGVvZiBXZWFrU2V0ID8gV2Vha1NldCA6IFNldCxWID0gbnVsbDtmdW5jdGlvbiBNaihhLCBiKSB7dmFyIGMgPSBhLnJlZjtpZiAobnVsbCAhPT0gYykgaWYgKCJmdW5jdGlvbiIgPT09IHR5cGVvZiBjKSB0cnkge2MobnVsbCk7fSBjYXRjaCAoZCkge1coYSwgYiwgZCk7fSBlbHNlIGMuY3VycmVudCA9IG51bGw7fWZ1bmN0aW9uIE5qKGEsIGIsIGMpIHt0cnkge2MoKTt9IGNhdGNoIChkKSB7VyhhLCBiLCBkKTt9fXZhciBPaiA9ICExOwogICAgICAgICAgZnVuY3Rpb24gUGooYSwgYikge0NmID0gZGQ7YSA9IE1lKCk7aWYgKE5lKGEpKSB7aWYgKCJzZWxlY3Rpb25TdGFydCIgaW4gYSkgdmFyIGMgPSB7IHN0YXJ0OiBhLnNlbGVjdGlvblN0YXJ0LCBlbmQ6IGEuc2VsZWN0aW9uRW5kIH07ZWxzZSBhOiB7YyA9IChjID0gYS5vd25lckRvY3VtZW50KSAmJiBjLmRlZmF1bHRWaWV3IHx8IHdpbmRvdzt2YXIgZCA9IGMuZ2V0U2VsZWN0aW9uICYmIGMuZ2V0U2VsZWN0aW9uKCk7aWYgKGQgJiYgMCAhPT0gZC5yYW5nZUNvdW50KSB7YyA9IGQuYW5jaG9yTm9kZTt2YXIgZSA9IGQuYW5jaG9yT2Zmc2V0LGYgPSBkLmZvY3VzTm9kZTtkID0gZC5mb2N1c09mZnNldDt0cnkge2Mubm9kZVR5cGUsIGYubm9kZVR5cGU7fSBjYXRjaCAoRikge2MgPSBudWxsO2JyZWFrIGE7fXZhciBnID0gMCxoID0gLTEsayA9IC0xLGwgPSAwLG0gPSAwLHEgPSBhLHIgPSBudWxsO2I6IGZvciAoOzspIHtmb3IgKHZhciB5OzspIHtxICE9PSBjIHx8IDAgIT09IGUgJiYgMyAhPT0gcS5ub2RlVHlwZSB8fCAoaCA9IGcgKyBlKTtxICE9PSBmIHx8IDAgIT09IGQgJiYgMyAhPT0gcS5ub2RlVHlwZSB8fCAoayA9IGcgKyBkKTszID09PSBxLm5vZGVUeXBlICYmIChnICs9CiAgICAgICAgICAgICAgICAgICAgICBxLm5vZGVWYWx1ZS5sZW5ndGgpO2lmIChudWxsID09PSAoeSA9IHEuZmlyc3RDaGlsZCkpIGJyZWFrO3IgPSBxO3EgPSB5O31mb3IgKDs7KSB7aWYgKHEgPT09IGEpIGJyZWFrIGI7ciA9PT0gYyAmJiArK2wgPT09IGUgJiYgKGggPSBnKTtyID09PSBmICYmICsrbSA9PT0gZCAmJiAoayA9IGcpO2lmIChudWxsICE9PSAoeSA9IHEubmV4dFNpYmxpbmcpKSBicmVhaztxID0gcjtyID0gcS5wYXJlbnROb2RlO31xID0geTt9YyA9IC0xID09PSBoIHx8IC0xID09PSBrID8gbnVsbCA6IHsgc3RhcnQ6IGgsIGVuZDogayB9O30gZWxzZSBjID0gbnVsbDt9YyA9IGMgfHwgeyBzdGFydDogMCwgZW5kOiAwIH07fSBlbHNlIGMgPSBudWxsO0RmID0geyBmb2N1c2VkRWxlbTogYSwgc2VsZWN0aW9uUmFuZ2U6IGMgfTtkZCA9ICExO2ZvciAoViA9IGI7IG51bGwgIT09IFY7KSB7aWYgKGIgPSBWLCBhID0gYi5jaGlsZCwgMCAhPT0gKGIuc3VidHJlZUZsYWdzICYgMTAyOCkgJiYgbnVsbCAhPT0gYSkgYS5yZXR1cm4gPSBiLCBWID0gYTtlbHNlIGZvciAoOyBudWxsICE9PSBWOykge2IgPSBWO3RyeSB7dmFyIG4gPSBiLmFsdGVybmF0ZTtpZiAoMCAhPT0gKGIuZmxhZ3MgJiAxMDI0KSkgc3dpdGNoIChiLnRhZykge2Nhc2UgMDpjYXNlIDExOmNhc2UgMTU6YnJlYWs7CiAgICAgICAgICAgICAgICAgICAgY2FzZSAxOmlmIChudWxsICE9PSBuKSB7dmFyIHQgPSBuLm1lbW9pemVkUHJvcHMsSiA9IG4ubWVtb2l6ZWRTdGF0ZSx4ID0gYi5zdGF0ZU5vZGUsdyA9IHguZ2V0U25hcHNob3RCZWZvcmVVcGRhdGUoYi5lbGVtZW50VHlwZSA9PT0gYi50eXBlID8gdCA6IExnKGIudHlwZSwgdCksIEopO3guX19yZWFjdEludGVybmFsU25hcHNob3RCZWZvcmVVcGRhdGUgPSB3O31icmVhaztjYXNlIDM6dmFyIHUgPSBiLnN0YXRlTm9kZS5jb250YWluZXJJbmZvOzEgPT09IHUubm9kZVR5cGUgPyB1LnRleHRDb250ZW50ID0gIiIgOiA5ID09PSB1Lm5vZGVUeXBlICYmIHUuZG9jdW1lbnRFbGVtZW50ICYmIHUucmVtb3ZlQ2hpbGQodS5kb2N1bWVudEVsZW1lbnQpO2JyZWFrO2Nhc2UgNTpjYXNlIDY6Y2FzZSA0OmNhc2UgMTc6YnJlYWs7ZGVmYXVsdDp0aHJvdyBFcnJvcihwKDE2MykpO319IGNhdGNoIChGKSB7VyhiLCBiLnJldHVybiwgRik7fWEgPSBiLnNpYmxpbmc7aWYgKG51bGwgIT09IGEpIHthLnJldHVybiA9IGIucmV0dXJuO1YgPSBhO2JyZWFrO31WID0gYi5yZXR1cm47fX1uID0gT2o7T2ogPSAhMTtyZXR1cm4gbjt9CiAgICAgICAgICBmdW5jdGlvbiBRaihhLCBiLCBjKSB7dmFyIGQgPSBiLnVwZGF0ZVF1ZXVlO2QgPSBudWxsICE9PSBkID8gZC5sYXN0RWZmZWN0IDogbnVsbDtpZiAobnVsbCAhPT0gZCkge3ZhciBlID0gZCA9IGQubmV4dDtkbyB7aWYgKChlLnRhZyAmIGEpID09PSBhKSB7dmFyIGYgPSBlLmRlc3Ryb3k7ZS5kZXN0cm95ID0gdm9pZCAwO3ZvaWQgMCAhPT0gZiAmJiBOaihiLCBjLCBmKTt9ZSA9IGUubmV4dDt9IHdoaWxlIChlICE9PSBkKTt9fWZ1bmN0aW9uIFJqKGEsIGIpIHtiID0gYi51cGRhdGVRdWV1ZTtiID0gbnVsbCAhPT0gYiA/IGIubGFzdEVmZmVjdCA6IG51bGw7aWYgKG51bGwgIT09IGIpIHt2YXIgYyA9IGIgPSBiLm5leHQ7ZG8ge2lmICgoYy50YWcgJiBhKSA9PT0gYSkge3ZhciBkID0gYy5jcmVhdGU7Yy5kZXN0cm95ID0gZCgpO31jID0gYy5uZXh0O30gd2hpbGUgKGMgIT09IGIpO319ZnVuY3Rpb24gU2ooYSkge3ZhciBiID0gYS5yZWY7aWYgKG51bGwgIT09IGIpIHt2YXIgYyA9IGEuc3RhdGVOb2RlO3N3aXRjaCAoYS50YWcpIHtjYXNlIDU6YSA9IGM7YnJlYWs7ZGVmYXVsdDphID0gYzt9ImZ1bmN0aW9uIiA9PT0gdHlwZW9mIGIgPyBiKGEpIDogYi5jdXJyZW50ID0gYTt9fQogICAgICAgICAgZnVuY3Rpb24gVGooYSkge3ZhciBiID0gYS5hbHRlcm5hdGU7bnVsbCAhPT0gYiAmJiAoYS5hbHRlcm5hdGUgPSBudWxsLCBUaihiKSk7YS5jaGlsZCA9IG51bGw7YS5kZWxldGlvbnMgPSBudWxsO2Euc2libGluZyA9IG51bGw7NSA9PT0gYS50YWcgJiYgKGIgPSBhLnN0YXRlTm9kZSwgbnVsbCAhPT0gYiAmJiAoZGVsZXRlIGJbT2ZdLCBkZWxldGUgYltQZl0sIGRlbGV0ZSBiW29mXSwgZGVsZXRlIGJbUWZdLCBkZWxldGUgYltSZl0pKTthLnN0YXRlTm9kZSA9IG51bGw7YS5yZXR1cm4gPSBudWxsO2EuZGVwZW5kZW5jaWVzID0gbnVsbDthLm1lbW9pemVkUHJvcHMgPSBudWxsO2EubWVtb2l6ZWRTdGF0ZSA9IG51bGw7YS5wZW5kaW5nUHJvcHMgPSBudWxsO2Euc3RhdGVOb2RlID0gbnVsbDthLnVwZGF0ZVF1ZXVlID0gbnVsbDt9ZnVuY3Rpb24gVWooYSkge3JldHVybiA1ID09PSBhLnRhZyB8fCAzID09PSBhLnRhZyB8fCA0ID09PSBhLnRhZzt9CiAgICAgICAgICBmdW5jdGlvbiBWaihhKSB7YTogZm9yICg7Oykge2ZvciAoOyBudWxsID09PSBhLnNpYmxpbmc7KSB7aWYgKG51bGwgPT09IGEucmV0dXJuIHx8IFVqKGEucmV0dXJuKSkgcmV0dXJuIG51bGw7YSA9IGEucmV0dXJuO31hLnNpYmxpbmcucmV0dXJuID0gYS5yZXR1cm47Zm9yIChhID0gYS5zaWJsaW5nOyA1ICE9PSBhLnRhZyAmJiA2ICE9PSBhLnRhZyAmJiAxOCAhPT0gYS50YWc7KSB7aWYgKGEuZmxhZ3MgJiAyKSBjb250aW51ZSBhO2lmIChudWxsID09PSBhLmNoaWxkIHx8IDQgPT09IGEudGFnKSBjb250aW51ZSBhO2Vsc2UgYS5jaGlsZC5yZXR1cm4gPSBhLCBhID0gYS5jaGlsZDt9aWYgKCEoYS5mbGFncyAmIDIpKSByZXR1cm4gYS5zdGF0ZU5vZGU7fX0KICAgICAgICAgIGZ1bmN0aW9uIFdqKGEsIGIsIGMpIHt2YXIgZCA9IGEudGFnO2lmICg1ID09PSBkIHx8IDYgPT09IGQpIGEgPSBhLnN0YXRlTm9kZSwgYiA/IDggPT09IGMubm9kZVR5cGUgPyBjLnBhcmVudE5vZGUuaW5zZXJ0QmVmb3JlKGEsIGIpIDogYy5pbnNlcnRCZWZvcmUoYSwgYikgOiAoOCA9PT0gYy5ub2RlVHlwZSA/IChiID0gYy5wYXJlbnROb2RlLCBiLmluc2VydEJlZm9yZShhLCBjKSkgOiAoYiA9IGMsIGIuYXBwZW5kQ2hpbGQoYSkpLCBjID0gYy5fcmVhY3RSb290Q29udGFpbmVyLCBudWxsICE9PSBjICYmIHZvaWQgMCAhPT0gYyB8fCBudWxsICE9PSBiLm9uY2xpY2sgfHwgKGIub25jbGljayA9IEJmKSk7ZWxzZSBpZiAoNCAhPT0gZCAmJiAoYSA9IGEuY2hpbGQsIG51bGwgIT09IGEpKSBmb3IgKFdqKGEsIGIsIGMpLCBhID0gYS5zaWJsaW5nOyBudWxsICE9PSBhOykge1dqKGEsIGIsIGMpLCBhID0gYS5zaWJsaW5nO319CiAgICAgICAgICBmdW5jdGlvbiBYaihhLCBiLCBjKSB7dmFyIGQgPSBhLnRhZztpZiAoNSA9PT0gZCB8fCA2ID09PSBkKSBhID0gYS5zdGF0ZU5vZGUsIGIgPyBjLmluc2VydEJlZm9yZShhLCBiKSA6IGMuYXBwZW5kQ2hpbGQoYSk7ZWxzZSBpZiAoNCAhPT0gZCAmJiAoYSA9IGEuY2hpbGQsIG51bGwgIT09IGEpKSBmb3IgKFhqKGEsIGIsIGMpLCBhID0gYS5zaWJsaW5nOyBudWxsICE9PSBhOykge1hqKGEsIGIsIGMpLCBhID0gYS5zaWJsaW5nO319dmFyIFggPSBudWxsLFlqID0gITE7ZnVuY3Rpb24gWmooYSwgYiwgYykge2ZvciAoYyA9IGMuY2hpbGQ7IG51bGwgIT09IGM7KSB7YWsoYSwgYiwgYyksIGMgPSBjLnNpYmxpbmc7fX0KICAgICAgICAgIGZ1bmN0aW9uIGFrKGEsIGIsIGMpIHtpZiAobGMgJiYgImZ1bmN0aW9uIiA9PT0gdHlwZW9mIGxjLm9uQ29tbWl0RmliZXJVbm1vdW50KSB0cnkge2xjLm9uQ29tbWl0RmliZXJVbm1vdW50KGtjLCBjKTt9IGNhdGNoIChoKSB7fXN3aXRjaCAoYy50YWcpIHtjYXNlIDU6VSB8fCBNaihjLCBiKTtjYXNlIDY6dmFyIGQgPSBYLGUgPSBZajtYID0gbnVsbDtaaihhLCBiLCBjKTtYID0gZDtZaiA9IGU7bnVsbCAhPT0gWCAmJiAoWWogPyAoYSA9IFgsIGMgPSBjLnN0YXRlTm9kZSwgOCA9PT0gYS5ub2RlVHlwZSA/IGEucGFyZW50Tm9kZS5yZW1vdmVDaGlsZChjKSA6IGEucmVtb3ZlQ2hpbGQoYykpIDogWC5yZW1vdmVDaGlsZChjLnN0YXRlTm9kZSkpO2JyZWFrO2Nhc2UgMTg6bnVsbCAhPT0gWCAmJiAoWWogPyAoYSA9IFgsIGMgPSBjLnN0YXRlTm9kZSwgOCA9PT0gYS5ub2RlVHlwZSA/IEtmKGEucGFyZW50Tm9kZSwgYykgOiAxID09PSBhLm5vZGVUeXBlICYmIEtmKGEsIGMpLCBiZChhKSkgOiBLZihYLCBjLnN0YXRlTm9kZSkpO2JyZWFrO2Nhc2UgNDpkID0gWDtlID0gWWo7WCA9IGMuc3RhdGVOb2RlLmNvbnRhaW5lckluZm87WWogPSAhMDsKICAgICAgICAgICAgICAgIFpqKGEsIGIsIGMpO1ggPSBkO1lqID0gZTticmVhaztjYXNlIDA6Y2FzZSAxMTpjYXNlIDE0OmNhc2UgMTU6aWYgKCFVICYmIChkID0gYy51cGRhdGVRdWV1ZSwgbnVsbCAhPT0gZCAmJiAoZCA9IGQubGFzdEVmZmVjdCwgbnVsbCAhPT0gZCkpKSB7ZSA9IGQgPSBkLm5leHQ7ZG8ge3ZhciBmID0gZSxnID0gZi5kZXN0cm95O2YgPSBmLnRhZzt2b2lkIDAgIT09IGcgJiYgKDAgIT09IChmICYgMikgPyBOaihjLCBiLCBnKSA6IDAgIT09IChmICYgNCkgJiYgTmooYywgYiwgZykpO2UgPSBlLm5leHQ7fSB3aGlsZSAoZSAhPT0gZCk7fVpqKGEsIGIsIGMpO2JyZWFrO2Nhc2UgMTppZiAoIVUgJiYgKE1qKGMsIGIpLCBkID0gYy5zdGF0ZU5vZGUsICJmdW5jdGlvbiIgPT09IHR5cGVvZiBkLmNvbXBvbmVudFdpbGxVbm1vdW50KSkgdHJ5IHtkLnByb3BzID0gYy5tZW1vaXplZFByb3BzLCBkLnN0YXRlID0gYy5tZW1vaXplZFN0YXRlLCBkLmNvbXBvbmVudFdpbGxVbm1vdW50KCk7fSBjYXRjaCAoaCkge1coYywgYiwgaCk7fVpqKGEsIGIsIGMpO2JyZWFrO2Nhc2UgMjE6WmooYSwgYiwgYyk7YnJlYWs7Y2FzZSAyMjpjLm1vZGUgJiAxID8gKFUgPSAoZCA9IFUpIHx8IG51bGwgIT09CiAgICAgICAgICAgICAgICBjLm1lbW9pemVkU3RhdGUsIFpqKGEsIGIsIGMpLCBVID0gZCkgOiBaaihhLCBiLCBjKTticmVhaztkZWZhdWx0OlpqKGEsIGIsIGMpO319ZnVuY3Rpb24gYmsoYSkge3ZhciBiID0gYS51cGRhdGVRdWV1ZTtpZiAobnVsbCAhPT0gYikge2EudXBkYXRlUXVldWUgPSBudWxsO3ZhciBjID0gYS5zdGF0ZU5vZGU7bnVsbCA9PT0gYyAmJiAoYyA9IGEuc3RhdGVOb2RlID0gbmV3IExqKCkpO2IuZm9yRWFjaChmdW5jdGlvbiAoYikge3ZhciBkID0gY2suYmluZChudWxsLCBhLCBiKTtjLmhhcyhiKSB8fCAoYy5hZGQoYiksIGIudGhlbihkLCBkKSk7fSk7fX0KICAgICAgICAgIGZ1bmN0aW9uIGRrKGEsIGIpIHt2YXIgYyA9IGIuZGVsZXRpb25zO2lmIChudWxsICE9PSBjKSBmb3IgKHZhciBkID0gMDsgZCA8IGMubGVuZ3RoOyBkKyspIHt2YXIgZSA9IGNbZF07dHJ5IHt2YXIgZiA9IGEsZyA9IGIsaCA9IGc7YTogZm9yICg7IG51bGwgIT09IGg7KSB7c3dpdGNoIChoLnRhZykge2Nhc2UgNTpYID0gaC5zdGF0ZU5vZGU7WWogPSAhMTticmVhayBhO2Nhc2UgMzpYID0gaC5zdGF0ZU5vZGUuY29udGFpbmVySW5mbztZaiA9ICEwO2JyZWFrIGE7Y2FzZSA0OlggPSBoLnN0YXRlTm9kZS5jb250YWluZXJJbmZvO1lqID0gITA7YnJlYWsgYTt9aCA9IGgucmV0dXJuO31pZiAobnVsbCA9PT0gWCkgdGhyb3cgRXJyb3IocCgxNjApKTthayhmLCBnLCBlKTtYID0gbnVsbDtZaiA9ICExO3ZhciBrID0gZS5hbHRlcm5hdGU7bnVsbCAhPT0gayAmJiAoay5yZXR1cm4gPSBudWxsKTtlLnJldHVybiA9IG51bGw7fSBjYXRjaCAobCkge1coZSwgYiwgbCk7fX1pZiAoYi5zdWJ0cmVlRmxhZ3MgJiAxMjg1NCkgZm9yIChiID0gYi5jaGlsZDsgbnVsbCAhPT0gYjspIHtlayhiLCBhKSwgYiA9IGIuc2libGluZzt9fQogICAgICAgICAgZnVuY3Rpb24gZWsoYSwgYikge3ZhciBjID0gYS5hbHRlcm5hdGUsZCA9IGEuZmxhZ3M7c3dpdGNoIChhLnRhZykge2Nhc2UgMDpjYXNlIDExOmNhc2UgMTQ6Y2FzZSAxNTpkayhiLCBhKTtmayhhKTtpZiAoZCAmIDQpIHt0cnkge1FqKDMsIGEsIGEucmV0dXJuKSwgUmooMywgYSk7fSBjYXRjaCAodCkge1coYSwgYS5yZXR1cm4sIHQpO310cnkge1FqKDUsIGEsIGEucmV0dXJuKTt9IGNhdGNoICh0KSB7VyhhLCBhLnJldHVybiwgdCk7fX1icmVhaztjYXNlIDE6ZGsoYiwgYSk7ZmsoYSk7ZCAmIDUxMiAmJiBudWxsICE9PSBjICYmIE1qKGMsIGMucmV0dXJuKTticmVhaztjYXNlIDU6ZGsoYiwgYSk7ZmsoYSk7ZCAmIDUxMiAmJiBudWxsICE9PSBjICYmIE1qKGMsIGMucmV0dXJuKTtpZiAoYS5mbGFncyAmIDMyKSB7dmFyIGUgPSBhLnN0YXRlTm9kZTt0cnkge29iKGUsICIiKTt9IGNhdGNoICh0KSB7VyhhLCBhLnJldHVybiwgdCk7fX1pZiAoZCAmIDQgJiYgKGUgPSBhLnN0YXRlTm9kZSwgbnVsbCAhPSBlKSkge3ZhciBmID0gYS5tZW1vaXplZFByb3BzLGcgPSBudWxsICE9PSBjID8gYy5tZW1vaXplZFByb3BzIDogZixoID0gYS50eXBlLGsgPSBhLnVwZGF0ZVF1ZXVlOwogICAgICAgICAgICAgICAgICBhLnVwZGF0ZVF1ZXVlID0gbnVsbDtpZiAobnVsbCAhPT0gaykgdHJ5IHsiaW5wdXQiID09PSBoICYmICJyYWRpbyIgPT09IGYudHlwZSAmJiBudWxsICE9IGYubmFtZSAmJiBhYihlLCBmKTt2YihoLCBnKTt2YXIgbCA9IHZiKGgsIGYpO2ZvciAoZyA9IDA7IGcgPCBrLmxlbmd0aDsgZyArPSAyKSB7dmFyIG0gPSBrW2ddLHEgPSBrW2cgKyAxXTsic3R5bGUiID09PSBtID8gc2IoZSwgcSkgOiAiZGFuZ2Vyb3VzbHlTZXRJbm5lckhUTUwiID09PSBtID8gbmIoZSwgcSkgOiAiY2hpbGRyZW4iID09PSBtID8gb2IoZSwgcSkgOiB0YShlLCBtLCBxLCBsKTt9c3dpdGNoIChoKSB7Y2FzZSAiaW5wdXQiOmJiKGUsIGYpO2JyZWFrO2Nhc2UgInRleHRhcmVhIjppYihlLCBmKTticmVhaztjYXNlICJzZWxlY3QiOnZhciByID0gZS5fd3JhcHBlclN0YXRlLndhc011bHRpcGxlO2UuX3dyYXBwZXJTdGF0ZS53YXNNdWx0aXBsZSA9ICEhZi5tdWx0aXBsZTt2YXIgeSA9IGYudmFsdWU7bnVsbCAhPSB5ID8gZmIoZSwgISFmLm11bHRpcGxlLCB5LCAhMSkgOiByICE9PSAhIWYubXVsdGlwbGUgJiYgKG51bGwgIT0gZi5kZWZhdWx0VmFsdWUgPyBmYihlLCAhIWYubXVsdGlwbGUsCiAgICAgICAgICAgICAgICAgICAgICAgIGYuZGVmYXVsdFZhbHVlLCAhMCkgOiBmYihlLCAhIWYubXVsdGlwbGUsIGYubXVsdGlwbGUgPyBbXSA6ICIiLCAhMSkpO31lW1BmXSA9IGY7fSBjYXRjaCAodCkge1coYSwgYS5yZXR1cm4sIHQpO319YnJlYWs7Y2FzZSA2OmRrKGIsIGEpO2ZrKGEpO2lmIChkICYgNCkge2lmIChudWxsID09PSBhLnN0YXRlTm9kZSkgdGhyb3cgRXJyb3IocCgxNjIpKTtlID0gYS5zdGF0ZU5vZGU7ZiA9IGEubWVtb2l6ZWRQcm9wczt0cnkge2Uubm9kZVZhbHVlID0gZjt9IGNhdGNoICh0KSB7VyhhLCBhLnJldHVybiwgdCk7fX1icmVhaztjYXNlIDM6ZGsoYiwgYSk7ZmsoYSk7aWYgKGQgJiA0ICYmIG51bGwgIT09IGMgJiYgYy5tZW1vaXplZFN0YXRlLmlzRGVoeWRyYXRlZCkgdHJ5IHtiZChiLmNvbnRhaW5lckluZm8pO30gY2F0Y2ggKHQpIHtXKGEsIGEucmV0dXJuLCB0KTt9YnJlYWs7Y2FzZSA0OmRrKGIsIGEpO2ZrKGEpO2JyZWFrO2Nhc2UgMTM6ZGsoYiwgYSk7ZmsoYSk7ZSA9IGEuY2hpbGQ7ZS5mbGFncyAmIDgxOTIgJiYgKGYgPSBudWxsICE9PSBlLm1lbW9pemVkU3RhdGUsIGUuc3RhdGVOb2RlLmlzSGlkZGVuID0gZiwgIWYgfHwKICAgICAgICAgICAgICAgIG51bGwgIT09IGUuYWx0ZXJuYXRlICYmIG51bGwgIT09IGUuYWx0ZXJuYXRlLm1lbW9pemVkU3RhdGUgfHwgKGdrID0gQigpKSk7ZCAmIDQgJiYgYmsoYSk7YnJlYWs7Y2FzZSAyMjptID0gbnVsbCAhPT0gYyAmJiBudWxsICE9PSBjLm1lbW9pemVkU3RhdGU7YS5tb2RlICYgMSA/IChVID0gKGwgPSBVKSB8fCBtLCBkayhiLCBhKSwgVSA9IGwpIDogZGsoYiwgYSk7ZmsoYSk7aWYgKGQgJiA4MTkyKSB7bCA9IG51bGwgIT09IGEubWVtb2l6ZWRTdGF0ZTtpZiAoKGEuc3RhdGVOb2RlLmlzSGlkZGVuID0gbCkgJiYgIW0gJiYgMCAhPT0gKGEubW9kZSAmIDEpKSBmb3IgKFYgPSBhLCBtID0gYS5jaGlsZDsgbnVsbCAhPT0gbTspIHtmb3IgKHEgPSBWID0gbTsgbnVsbCAhPT0gVjspIHtyID0gVjt5ID0gci5jaGlsZDtzd2l0Y2ggKHIudGFnKSB7Y2FzZSAwOmNhc2UgMTE6Y2FzZSAxNDpjYXNlIDE1OlFqKDQsIHIsIHIucmV0dXJuKTticmVhaztjYXNlIDE6TWoociwgci5yZXR1cm4pO3ZhciBuID0gci5zdGF0ZU5vZGU7aWYgKCJmdW5jdGlvbiIgPT09IHR5cGVvZiBuLmNvbXBvbmVudFdpbGxVbm1vdW50KSB7ZCA9IHI7YyA9IHIucmV0dXJuO3RyeSB7YiA9IGQsIG4ucHJvcHMgPQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBiLm1lbW9pemVkUHJvcHMsIG4uc3RhdGUgPSBiLm1lbW9pemVkU3RhdGUsIG4uY29tcG9uZW50V2lsbFVubW91bnQoKTt9IGNhdGNoICh0KSB7VyhkLCBjLCB0KTt9fWJyZWFrO2Nhc2UgNTpNaihyLCByLnJldHVybik7YnJlYWs7Y2FzZSAyMjppZiAobnVsbCAhPT0gci5tZW1vaXplZFN0YXRlKSB7aGsocSk7Y29udGludWU7fX1udWxsICE9PSB5ID8gKHkucmV0dXJuID0gciwgViA9IHkpIDogaGsocSk7fW0gPSBtLnNpYmxpbmc7fWE6IGZvciAobSA9IG51bGwsIHEgPSBhOzspIHtpZiAoNSA9PT0gcS50YWcpIHtpZiAobnVsbCA9PT0gbSkge20gPSBxO3RyeSB7ZSA9IHEuc3RhdGVOb2RlLCBsID8gKGYgPSBlLnN0eWxlLCAiZnVuY3Rpb24iID09PSB0eXBlb2YgZi5zZXRQcm9wZXJ0eSA/IGYuc2V0UHJvcGVydHkoImRpc3BsYXkiLCAibm9uZSIsICJpbXBvcnRhbnQiKSA6IGYuZGlzcGxheSA9ICJub25lIikgOiAoaCA9IHEuc3RhdGVOb2RlLCBrID0gcS5tZW1vaXplZFByb3BzLnN0eWxlLCBnID0gdm9pZCAwICE9PSBrICYmIG51bGwgIT09IGsgJiYgay5oYXNPd25Qcm9wZXJ0eSgiZGlzcGxheSIpID8gay5kaXNwbGF5IDogbnVsbCwgaC5zdHlsZS5kaXNwbGF5ID0KICAgICAgICAgICAgICAgICAgICAgICAgICByYigiZGlzcGxheSIsIGcpKTt9IGNhdGNoICh0KSB7VyhhLCBhLnJldHVybiwgdCk7fX19IGVsc2UgaWYgKDYgPT09IHEudGFnKSB7aWYgKG51bGwgPT09IG0pIHRyeSB7cS5zdGF0ZU5vZGUubm9kZVZhbHVlID0gbCA/ICIiIDogcS5tZW1vaXplZFByb3BzO30gY2F0Y2ggKHQpIHtXKGEsIGEucmV0dXJuLCB0KTt9fSBlbHNlIGlmICgoMjIgIT09IHEudGFnICYmIDIzICE9PSBxLnRhZyB8fCBudWxsID09PSBxLm1lbW9pemVkU3RhdGUgfHwgcSA9PT0gYSkgJiYgbnVsbCAhPT0gcS5jaGlsZCkge3EuY2hpbGQucmV0dXJuID0gcTtxID0gcS5jaGlsZDtjb250aW51ZTt9aWYgKHEgPT09IGEpIGJyZWFrIGE7Zm9yICg7IG51bGwgPT09IHEuc2libGluZzspIHtpZiAobnVsbCA9PT0gcS5yZXR1cm4gfHwgcS5yZXR1cm4gPT09IGEpIGJyZWFrIGE7bSA9PT0gcSAmJiAobSA9IG51bGwpO3EgPSBxLnJldHVybjt9bSA9PT0gcSAmJiAobSA9IG51bGwpO3Euc2libGluZy5yZXR1cm4gPSBxLnJldHVybjtxID0gcS5zaWJsaW5nO319YnJlYWs7Y2FzZSAxOTpkayhiLCBhKTtmayhhKTtkICYgNCAmJiBiayhhKTticmVhaztjYXNlIDIxOmJyZWFrO2RlZmF1bHQ6ZGsoYiwKICAgICAgICAgICAgICAgIGEpLCBmayhhKTt9fWZ1bmN0aW9uIGZrKGEpIHt2YXIgYiA9IGEuZmxhZ3M7aWYgKGIgJiAyKSB7dHJ5IHthOiB7Zm9yICh2YXIgYyA9IGEucmV0dXJuOyBudWxsICE9PSBjOykge2lmIChVaihjKSkge3ZhciBkID0gYzticmVhayBhO31jID0gYy5yZXR1cm47fXRocm93IEVycm9yKHAoMTYwKSk7fXN3aXRjaCAoZC50YWcpIHtjYXNlIDU6dmFyIGUgPSBkLnN0YXRlTm9kZTtkLmZsYWdzICYgMzIgJiYgKG9iKGUsICIiKSwgZC5mbGFncyAmPSAtMzMpO3ZhciBmID0gVmooYSk7WGooYSwgZiwgZSk7YnJlYWs7Y2FzZSAzOmNhc2UgNDp2YXIgZyA9IGQuc3RhdGVOb2RlLmNvbnRhaW5lckluZm8saCA9IFZqKGEpO1dqKGEsIGgsIGcpO2JyZWFrO2RlZmF1bHQ6dGhyb3cgRXJyb3IocCgxNjEpKTt9fSBjYXRjaCAoaykge1coYSwgYS5yZXR1cm4sIGspO31hLmZsYWdzICY9IC0zO31iICYgNDA5NiAmJiAoYS5mbGFncyAmPSAtNDA5Nyk7fWZ1bmN0aW9uIGlrKGEsIGIsIGMpIHtWID0gYTtqayhhLCBiLCBjKTt9CiAgICAgICAgICBmdW5jdGlvbiBqayhhLCBiLCBjKSB7Zm9yICh2YXIgZCA9IDAgIT09IChhLm1vZGUgJiAxKTsgbnVsbCAhPT0gVjspIHt2YXIgZSA9IFYsZiA9IGUuY2hpbGQ7aWYgKDIyID09PSBlLnRhZyAmJiBkKSB7dmFyIGcgPSBudWxsICE9PSBlLm1lbW9pemVkU3RhdGUgfHwgS2o7aWYgKCFnKSB7dmFyIGggPSBlLmFsdGVybmF0ZSxrID0gbnVsbCAhPT0gaCAmJiBudWxsICE9PSBoLm1lbW9pemVkU3RhdGUgfHwgVTtoID0gS2o7dmFyIGwgPSBVO0tqID0gZztpZiAoKFUgPSBrKSAmJiAhbCkgZm9yIChWID0gZTsgbnVsbCAhPT0gVjspIHtnID0gViwgayA9IGcuY2hpbGQsIDIyID09PSBnLnRhZyAmJiBudWxsICE9PSBnLm1lbW9pemVkU3RhdGUgPyBrayhlKSA6IG51bGwgIT09IGsgPyAoay5yZXR1cm4gPSBnLCBWID0gaykgOiBrayhlKTt9Zm9yICg7IG51bGwgIT09IGY7KSB7ViA9IGYsIGprKGYsIGIsIGMpLCBmID0gZi5zaWJsaW5nO31WID0gZTtLaiA9IGg7VSA9IGw7fWxrKGEsIGIsIGMpO30gZWxzZSAwICE9PSAoZS5zdWJ0cmVlRmxhZ3MgJiA4NzcyKSAmJiBudWxsICE9PSBmID8gKGYucmV0dXJuID0gZSwgViA9IGYpIDogbGsoYSwgYiwgYyk7fX0KICAgICAgICAgIGZ1bmN0aW9uIGxrKGEpIHtmb3IgKDsgbnVsbCAhPT0gVjspIHt2YXIgYiA9IFY7aWYgKDAgIT09IChiLmZsYWdzICYgODc3MikpIHt2YXIgYyA9IGIuYWx0ZXJuYXRlO3RyeSB7aWYgKDAgIT09IChiLmZsYWdzICYgODc3MikpIHN3aXRjaCAoYi50YWcpIHtjYXNlIDA6Y2FzZSAxMTpjYXNlIDE1OlUgfHwgUmooNSwgYik7YnJlYWs7Y2FzZSAxOnZhciBkID0gYi5zdGF0ZU5vZGU7aWYgKGIuZmxhZ3MgJiA0ICYmICFVKSBpZiAobnVsbCA9PT0gYykgZC5jb21wb25lbnREaWRNb3VudCgpO2Vsc2Uge3ZhciBlID0gYi5lbGVtZW50VHlwZSA9PT0gYi50eXBlID8gYy5tZW1vaXplZFByb3BzIDogTGcoYi50eXBlLCBjLm1lbW9pemVkUHJvcHMpO2QuY29tcG9uZW50RGlkVXBkYXRlKGUsIGMubWVtb2l6ZWRTdGF0ZSwgZC5fX3JlYWN0SW50ZXJuYWxTbmFwc2hvdEJlZm9yZVVwZGF0ZSk7fXZhciBmID0gYi51cGRhdGVRdWV1ZTtudWxsICE9PSBmICYmIGloKGIsIGYsIGQpO2JyZWFrO2Nhc2UgMzp2YXIgZyA9IGIudXBkYXRlUXVldWU7aWYgKG51bGwgIT09IGcpIHtjID0gbnVsbDtpZiAobnVsbCAhPT0gYi5jaGlsZCkgc3dpdGNoIChiLmNoaWxkLnRhZykge2Nhc2UgNTpjID0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGIuY2hpbGQuc3RhdGVOb2RlO2JyZWFrO2Nhc2UgMTpjID0gYi5jaGlsZC5zdGF0ZU5vZGU7fWloKGIsIGcsIGMpO31icmVhaztjYXNlIDU6dmFyIGggPSBiLnN0YXRlTm9kZTtpZiAobnVsbCA9PT0gYyAmJiBiLmZsYWdzICYgNCkge2MgPSBoO3ZhciBrID0gYi5tZW1vaXplZFByb3BzO3N3aXRjaCAoYi50eXBlKSB7Y2FzZSAiYnV0dG9uIjpjYXNlICJpbnB1dCI6Y2FzZSAic2VsZWN0IjpjYXNlICJ0ZXh0YXJlYSI6ay5hdXRvRm9jdXMgJiYgYy5mb2N1cygpO2JyZWFrO2Nhc2UgImltZyI6ay5zcmMgJiYgKGMuc3JjID0gay5zcmMpO319YnJlYWs7Y2FzZSA2OmJyZWFrO2Nhc2UgNDpicmVhaztjYXNlIDEyOmJyZWFrO2Nhc2UgMTM6aWYgKG51bGwgPT09IGIubWVtb2l6ZWRTdGF0ZSkge3ZhciBsID0gYi5hbHRlcm5hdGU7aWYgKG51bGwgIT09IGwpIHt2YXIgbSA9IGwubWVtb2l6ZWRTdGF0ZTtpZiAobnVsbCAhPT0gbSkge3ZhciBxID0gbS5kZWh5ZHJhdGVkO251bGwgIT09IHEgJiYgYmQocSk7fX19YnJlYWs7Y2FzZSAxOTpjYXNlIDE3OmNhc2UgMjE6Y2FzZSAyMjpjYXNlIDIzOmNhc2UgMjU6YnJlYWs7CiAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDp0aHJvdyBFcnJvcihwKDE2MykpO31VIHx8IGIuZmxhZ3MgJiA1MTIgJiYgU2ooYik7fSBjYXRjaCAocikge1coYiwgYi5yZXR1cm4sIHIpO319aWYgKGIgPT09IGEpIHtWID0gbnVsbDticmVhazt9YyA9IGIuc2libGluZztpZiAobnVsbCAhPT0gYykge2MucmV0dXJuID0gYi5yZXR1cm47ViA9IGM7YnJlYWs7fVYgPSBiLnJldHVybjt9fWZ1bmN0aW9uIGhrKGEpIHtmb3IgKDsgbnVsbCAhPT0gVjspIHt2YXIgYiA9IFY7aWYgKGIgPT09IGEpIHtWID0gbnVsbDticmVhazt9dmFyIGMgPSBiLnNpYmxpbmc7aWYgKG51bGwgIT09IGMpIHtjLnJldHVybiA9IGIucmV0dXJuO1YgPSBjO2JyZWFrO31WID0gYi5yZXR1cm47fX0KICAgICAgICAgIGZ1bmN0aW9uIGtrKGEpIHtmb3IgKDsgbnVsbCAhPT0gVjspIHt2YXIgYiA9IFY7dHJ5IHtzd2l0Y2ggKGIudGFnKSB7Y2FzZSAwOmNhc2UgMTE6Y2FzZSAxNTp2YXIgYyA9IGIucmV0dXJuO3RyeSB7UmooNCwgYik7fSBjYXRjaCAoaykge1coYiwgYywgayk7fWJyZWFrO2Nhc2UgMTp2YXIgZCA9IGIuc3RhdGVOb2RlO2lmICgiZnVuY3Rpb24iID09PSB0eXBlb2YgZC5jb21wb25lbnREaWRNb3VudCkge3ZhciBlID0gYi5yZXR1cm47dHJ5IHtkLmNvbXBvbmVudERpZE1vdW50KCk7fSBjYXRjaCAoaykge1coYiwgZSwgayk7fX12YXIgZiA9IGIucmV0dXJuO3RyeSB7U2ooYik7fSBjYXRjaCAoaykge1coYiwgZiwgayk7fWJyZWFrO2Nhc2UgNTp2YXIgZyA9IGIucmV0dXJuO3RyeSB7U2ooYik7fSBjYXRjaCAoaykge1coYiwgZywgayk7fX19IGNhdGNoIChrKSB7VyhiLCBiLnJldHVybiwgayk7fWlmIChiID09PSBhKSB7ViA9IG51bGw7YnJlYWs7fXZhciBoID0gYi5zaWJsaW5nO2lmIChudWxsICE9PSBoKSB7aC5yZXR1cm4gPSBiLnJldHVybjtWID0gaDticmVhazt9ViA9IGIucmV0dXJuO319CiAgICAgICAgICB2YXIgbWsgPSBNYXRoLmNlaWwsbmsgPSB1YS5SZWFjdEN1cnJlbnREaXNwYXRjaGVyLG9rID0gdWEuUmVhY3RDdXJyZW50T3duZXIscGsgPSB1YS5SZWFjdEN1cnJlbnRCYXRjaENvbmZpZyxLID0gMCxSID0gbnVsbCxZID0gbnVsbCxaID0gMCxnaiA9IDAsZmogPSBVZigwKSxUID0gMCxxayA9IG51bGwsaGggPSAwLHJrID0gMCxzayA9IDAsdGsgPSBudWxsLHVrID0gbnVsbCxnayA9IDAsSGogPSBJbmZpbml0eSx2ayA9IG51bGwsUGkgPSAhMSxRaSA9IG51bGwsU2kgPSBudWxsLHdrID0gITEseGsgPSBudWxsLHlrID0gMCx6ayA9IDAsQWsgPSBudWxsLEJrID0gLTEsQ2sgPSAwO2Z1bmN0aW9uIEwoKSB7cmV0dXJuIDAgIT09IChLICYgNikgPyBCKCkgOiAtMSAhPT0gQmsgPyBCayA6IEJrID0gQigpO30KICAgICAgICAgIGZ1bmN0aW9uIGxoKGEpIHtpZiAoMCA9PT0gKGEubW9kZSAmIDEpKSByZXR1cm4gMTtpZiAoMCAhPT0gKEsgJiAyKSAmJiAwICE9PSBaKSByZXR1cm4gWiAmIC1aO2lmIChudWxsICE9PSBLZy50cmFuc2l0aW9uKSByZXR1cm4gMCA9PT0gQ2sgJiYgKENrID0geWMoKSksIENrO2EgPSBDO2lmICgwICE9PSBhKSByZXR1cm4gYTthID0gd2luZG93LmV2ZW50O2EgPSB2b2lkIDAgPT09IGEgPyAxNiA6IGpkKGEudHlwZSk7cmV0dXJuIGE7fWZ1bmN0aW9uIG1oKGEsIGIsIGMsIGQpIHtpZiAoNTAgPCB6aykgdGhyb3cgemsgPSAwLCBBayA9IG51bGwsIEVycm9yKHAoMTg1KSk7QWMoYSwgYywgZCk7aWYgKDAgPT09IChLICYgMikgfHwgYSAhPT0gUikgYSA9PT0gUiAmJiAoMCA9PT0gKEsgJiAyKSAmJiAocmsgfD0gYyksIDQgPT09IFQgJiYgRGsoYSwgWikpLCBFayhhLCBkKSwgMSA9PT0gYyAmJiAwID09PSBLICYmIDAgPT09IChiLm1vZGUgJiAxKSAmJiAoSGogPSBCKCkgKyA1MDAsIGZnICYmIGpnKCkpO30KICAgICAgICAgIGZ1bmN0aW9uIEVrKGEsIGIpIHt2YXIgYyA9IGEuY2FsbGJhY2tOb2RlO3djKGEsIGIpO3ZhciBkID0gdWMoYSwgYSA9PT0gUiA/IFogOiAwKTtpZiAoMCA9PT0gZCkgbnVsbCAhPT0gYyAmJiBiYyhjKSwgYS5jYWxsYmFja05vZGUgPSBudWxsLCBhLmNhbGxiYWNrUHJpb3JpdHkgPSAwO2Vsc2UgaWYgKGIgPSBkICYgLWQsIGEuY2FsbGJhY2tQcmlvcml0eSAhPT0gYikge251bGwgIT0gYyAmJiBiYyhjKTtpZiAoMSA9PT0gYikgMCA9PT0gYS50YWcgPyBpZyhGay5iaW5kKG51bGwsIGEpKSA6IGhnKEZrLmJpbmQobnVsbCwgYSkpLCBKZihmdW5jdGlvbiAoKSB7MCA9PT0gKEsgJiA2KSAmJiBqZygpO30pLCBjID0gbnVsbDtlbHNlIHtzd2l0Y2ggKERjKGQpKSB7Y2FzZSAxOmMgPSBmYzticmVhaztjYXNlIDQ6YyA9IGdjO2JyZWFrO2Nhc2UgMTY6YyA9IGhjO2JyZWFrO2Nhc2UgNTM2ODcwOTEyOmMgPSBqYzticmVhaztkZWZhdWx0OmMgPSBoYzt9YyA9IEdrKGMsIEhrLmJpbmQobnVsbCwgYSkpO31hLmNhbGxiYWNrUHJpb3JpdHkgPSBiO2EuY2FsbGJhY2tOb2RlID0gYzt9fQogICAgICAgICAgZnVuY3Rpb24gSGsoYSwgYikge0JrID0gLTE7Q2sgPSAwO2lmICgwICE9PSAoSyAmIDYpKSB0aHJvdyBFcnJvcihwKDMyNykpO3ZhciBjID0gYS5jYWxsYmFja05vZGU7aWYgKElrKCkgJiYgYS5jYWxsYmFja05vZGUgIT09IGMpIHJldHVybiBudWxsO3ZhciBkID0gdWMoYSwgYSA9PT0gUiA/IFogOiAwKTtpZiAoMCA9PT0gZCkgcmV0dXJuIG51bGw7aWYgKDAgIT09IChkICYgMzApIHx8IDAgIT09IChkICYgYS5leHBpcmVkTGFuZXMpIHx8IGIpIGIgPSBKayhhLCBkKTtlbHNlIHtiID0gZDt2YXIgZSA9IEs7SyB8PSAyO3ZhciBmID0gS2soKTtpZiAoUiAhPT0gYSB8fCBaICE9PSBiKSB2ayA9IG51bGwsIEhqID0gQigpICsgNTAwLCBMayhhLCBiKTtkbyB7dHJ5IHtNaygpO2JyZWFrO30gY2F0Y2ggKGgpIHtOayhhLCBoKTt9fSB3aGlsZSAoMSk7UWcoKTtuay5jdXJyZW50ID0gZjtLID0gZTtudWxsICE9PSBZID8gYiA9IDAgOiAoUiA9IG51bGwsIFogPSAwLCBiID0gVCk7fWlmICgwICE9PSBiKSB7MiA9PT0gYiAmJiAoZSA9IHhjKGEpLCAwICE9PSBlICYmIChkID0gZSwgYiA9IE9rKGEsIGUpKSk7aWYgKDEgPT09IGIpIHRocm93IGMgPSBxaywgTGsoYSwgMCksIERrKGEsIGQpLCBFayhhLCBCKCkpLCBjO2lmICg2ID09PSBiKSBEayhhLCBkKTtlbHNlCiAgICAgICAgICAgICAge2UgPSBhLmN1cnJlbnQuYWx0ZXJuYXRlO2lmICgwID09PSAoZCAmIDMwKSAmJiAhUGsoZSkgJiYgKGIgPSBKayhhLCBkKSwgMiA9PT0gYiAmJiAoZiA9IHhjKGEpLCAwICE9PSBmICYmIChkID0gZiwgYiA9IE9rKGEsIGYpKSksIDEgPT09IGIpKSB0aHJvdyBjID0gcWssIExrKGEsIDApLCBEayhhLCBkKSwgRWsoYSwgQigpKSwgYzthLmZpbmlzaGVkV29yayA9IGU7YS5maW5pc2hlZExhbmVzID0gZDtzd2l0Y2ggKGIpIHtjYXNlIDA6Y2FzZSAxOnRocm93IEVycm9yKHAoMzQ1KSk7Y2FzZSAyOlFrKGEsIHVrLCB2ayk7YnJlYWs7Y2FzZSAzOkRrKGEsIGQpO2lmICgoZCAmIDEzMDAyMzQyNCkgPT09IGQgJiYgKGIgPSBnayArIDUwMCAtIEIoKSwgMTAgPCBiKSkge2lmICgwICE9PSB1YyhhLCAwKSkgYnJlYWs7ZSA9IGEuc3VzcGVuZGVkTGFuZXM7aWYgKChlICYgZCkgIT09IGQpIHtMKCk7YS5waW5nZWRMYW5lcyB8PSBhLnN1c3BlbmRlZExhbmVzICYgZTticmVhazt9YS50aW1lb3V0SGFuZGxlID0gRmYoUWsuYmluZChudWxsLCBhLCB1aywgdmspLCBiKTticmVhazt9UWsoYSwgdWssIHZrKTticmVhaztjYXNlIDQ6RGsoYSwgZCk7aWYgKChkICYgNDE5NDI0MCkgPT09CiAgICAgICAgICAgICAgICAgICAgZCkgYnJlYWs7YiA9IGEuZXZlbnRUaW1lcztmb3IgKGUgPSAtMTsgMCA8IGQ7KSB7dmFyIGcgPSAzMSAtIG9jKGQpO2YgPSAxIDw8IGc7ZyA9IGJbZ107ZyA+IGUgJiYgKGUgPSBnKTtkICY9IH5mO31kID0gZTtkID0gQigpIC0gZDtkID0gKDEyMCA+IGQgPyAxMjAgOiA0ODAgPiBkID8gNDgwIDogMTA4MCA+IGQgPyAxMDgwIDogMTkyMCA+IGQgPyAxOTIwIDogM0UzID4gZCA/IDNFMyA6IDQzMjAgPiBkID8gNDMyMCA6IDE5NjAgKiBtayhkIC8gMTk2MCkpIC0gZDtpZiAoMTAgPCBkKSB7YS50aW1lb3V0SGFuZGxlID0gRmYoUWsuYmluZChudWxsLCBhLCB1aywgdmspLCBkKTticmVhazt9UWsoYSwgdWssIHZrKTticmVhaztjYXNlIDU6UWsoYSwgdWssIHZrKTticmVhaztkZWZhdWx0OnRocm93IEVycm9yKHAoMzI5KSk7fX19RWsoYSwgQigpKTtyZXR1cm4gYS5jYWxsYmFja05vZGUgPT09IGMgPyBIay5iaW5kKG51bGwsIGEpIDogbnVsbDt9CiAgICAgICAgICBmdW5jdGlvbiBPayhhLCBiKSB7dmFyIGMgPSB0azthLmN1cnJlbnQubWVtb2l6ZWRTdGF0ZS5pc0RlaHlkcmF0ZWQgJiYgKExrKGEsIGIpLmZsYWdzIHw9IDI1Nik7YSA9IEprKGEsIGIpOzIgIT09IGEgJiYgKGIgPSB1aywgdWsgPSBjLCBudWxsICE9PSBiICYmIEdqKGIpKTtyZXR1cm4gYTt9ZnVuY3Rpb24gR2ooYSkge251bGwgPT09IHVrID8gdWsgPSBhIDogdWsucHVzaC5hcHBseSh1aywgYSk7fQogICAgICAgICAgZnVuY3Rpb24gUGsoYSkge2ZvciAodmFyIGIgPSBhOzspIHtpZiAoYi5mbGFncyAmIDE2Mzg0KSB7dmFyIGMgPSBiLnVwZGF0ZVF1ZXVlO2lmIChudWxsICE9PSBjICYmIChjID0gYy5zdG9yZXMsIG51bGwgIT09IGMpKSBmb3IgKHZhciBkID0gMDsgZCA8IGMubGVuZ3RoOyBkKyspIHt2YXIgZSA9IGNbZF0sZiA9IGUuZ2V0U25hcHNob3Q7ZSA9IGUudmFsdWU7dHJ5IHtpZiAoIUhlKGYoKSwgZSkpIHJldHVybiAhMTt9IGNhdGNoIChnKSB7cmV0dXJuICExO319fWMgPSBiLmNoaWxkO2lmIChiLnN1YnRyZWVGbGFncyAmIDE2Mzg0ICYmIG51bGwgIT09IGMpIGMucmV0dXJuID0gYiwgYiA9IGM7ZWxzZSB7aWYgKGIgPT09IGEpIGJyZWFrO2ZvciAoOyBudWxsID09PSBiLnNpYmxpbmc7KSB7aWYgKG51bGwgPT09IGIucmV0dXJuIHx8IGIucmV0dXJuID09PSBhKSByZXR1cm4gITA7YiA9IGIucmV0dXJuO31iLnNpYmxpbmcucmV0dXJuID0gYi5yZXR1cm47YiA9IGIuc2libGluZzt9fXJldHVybiAhMDt9CiAgICAgICAgICBmdW5jdGlvbiBEayhhLCBiKSB7YiAmPSB+c2s7YiAmPSB+cms7YS5zdXNwZW5kZWRMYW5lcyB8PSBiO2EucGluZ2VkTGFuZXMgJj0gfmI7Zm9yIChhID0gYS5leHBpcmF0aW9uVGltZXM7IDAgPCBiOykge3ZhciBjID0gMzEgLSBvYyhiKSxkID0gMSA8PCBjO2FbY10gPSAtMTtiICY9IH5kO319ZnVuY3Rpb24gRmsoYSkge2lmICgwICE9PSAoSyAmIDYpKSB0aHJvdyBFcnJvcihwKDMyNykpO0lrKCk7dmFyIGIgPSB1YyhhLCAwKTtpZiAoMCA9PT0gKGIgJiAxKSkgcmV0dXJuIEVrKGEsIEIoKSksIG51bGw7dmFyIGMgPSBKayhhLCBiKTtpZiAoMCAhPT0gYS50YWcgJiYgMiA9PT0gYykge3ZhciBkID0geGMoYSk7MCAhPT0gZCAmJiAoYiA9IGQsIGMgPSBPayhhLCBkKSk7fWlmICgxID09PSBjKSB0aHJvdyBjID0gcWssIExrKGEsIDApLCBEayhhLCBiKSwgRWsoYSwgQigpKSwgYztpZiAoNiA9PT0gYykgdGhyb3cgRXJyb3IocCgzNDUpKTthLmZpbmlzaGVkV29yayA9IGEuY3VycmVudC5hbHRlcm5hdGU7YS5maW5pc2hlZExhbmVzID0gYjtRayhhLCB1aywgdmspO0VrKGEsIEIoKSk7cmV0dXJuIG51bGw7fQogICAgICAgICAgZnVuY3Rpb24gUmsoYSwgYikge3ZhciBjID0gSztLIHw9IDE7dHJ5IHtyZXR1cm4gYShiKTt9IGZpbmFsbHkge0sgPSBjLCAwID09PSBLICYmIChIaiA9IEIoKSArIDUwMCwgZmcgJiYgamcoKSk7fX1mdW5jdGlvbiBTayhhKSB7bnVsbCAhPT0geGsgJiYgMCA9PT0geGsudGFnICYmIDAgPT09IChLICYgNikgJiYgSWsoKTt2YXIgYiA9IEs7SyB8PSAxO3ZhciBjID0gcGsudHJhbnNpdGlvbixkID0gQzt0cnkge2lmIChway50cmFuc2l0aW9uID0gbnVsbCwgQyA9IDEsIGEpIHJldHVybiBhKCk7fSBmaW5hbGx5IHtDID0gZCwgcGsudHJhbnNpdGlvbiA9IGMsIEsgPSBiLCAwID09PSAoSyAmIDYpICYmIGpnKCk7fX1mdW5jdGlvbiBJaigpIHtnaiA9IGZqLmN1cnJlbnQ7RShmaik7fQogICAgICAgICAgZnVuY3Rpb24gTGsoYSwgYikge2EuZmluaXNoZWRXb3JrID0gbnVsbDthLmZpbmlzaGVkTGFuZXMgPSAwO3ZhciBjID0gYS50aW1lb3V0SGFuZGxlOy0xICE9PSBjICYmIChhLnRpbWVvdXRIYW5kbGUgPSAtMSwgR2YoYykpO2lmIChudWxsICE9PSBZKSBmb3IgKGMgPSBZLnJldHVybjsgbnVsbCAhPT0gYzspIHt2YXIgZCA9IGM7d2coZCk7c3dpdGNoIChkLnRhZykge2Nhc2UgMTpkID0gZC50eXBlLmNoaWxkQ29udGV4dFR5cGVzO251bGwgIT09IGQgJiYgdm9pZCAwICE9PSBkICYmICRmKCk7YnJlYWs7Y2FzZSAzOkpoKCk7RShXZik7RShIKTtPaCgpO2JyZWFrO2Nhc2UgNTpMaChkKTticmVhaztjYXNlIDQ6SmgoKTticmVhaztjYXNlIDEzOkUoTSk7YnJlYWs7Y2FzZSAxOTpFKE0pO2JyZWFrO2Nhc2UgMTA6UmcoZC50eXBlLl9jb250ZXh0KTticmVhaztjYXNlIDIyOmNhc2UgMjM6SWooKTt9YyA9IGMucmV0dXJuO31SID0gYTtZID0gYSA9IHdoKGEuY3VycmVudCwgbnVsbCk7WiA9IGdqID0gYjtUID0gMDtxayA9IG51bGw7c2sgPSByayA9IGhoID0gMDt1ayA9IHRrID0gbnVsbDtpZiAobnVsbCAhPT0gV2cpIHtmb3IgKGIgPQogICAgICAgICAgICAgIDA7IGIgPCBXZy5sZW5ndGg7IGIrKykge2lmIChjID0gV2dbYl0sIGQgPSBjLmludGVybGVhdmVkLCBudWxsICE9PSBkKSB7Yy5pbnRlcmxlYXZlZCA9IG51bGw7dmFyIGUgPSBkLm5leHQsZiA9IGMucGVuZGluZztpZiAobnVsbCAhPT0gZikge3ZhciBnID0gZi5uZXh0O2YubmV4dCA9IGU7ZC5uZXh0ID0gZzt9Yy5wZW5kaW5nID0gZDt9fVdnID0gbnVsbDt9cmV0dXJuIGE7fQogICAgICAgICAgZnVuY3Rpb24gTmsoYSwgYikge2RvIHt2YXIgYyA9IFk7dHJ5IHtRZygpO1BoLmN1cnJlbnQgPSBhaTtpZiAoU2gpIHtmb3IgKHZhciBkID0gTi5tZW1vaXplZFN0YXRlOyBudWxsICE9PSBkOykge3ZhciBlID0gZC5xdWV1ZTtudWxsICE9PSBlICYmIChlLnBlbmRpbmcgPSBudWxsKTtkID0gZC5uZXh0O31TaCA9ICExO31SaCA9IDA7UCA9IE8gPSBOID0gbnVsbDtUaCA9ICExO1VoID0gMDtvay5jdXJyZW50ID0gbnVsbDtpZiAobnVsbCA9PT0gYyB8fCBudWxsID09PSBjLnJldHVybikge1QgPSAxO3FrID0gYjtZID0gbnVsbDticmVhazt9YToge3ZhciBmID0gYSxnID0gYy5yZXR1cm4saCA9IGMsayA9IGI7YiA9IFo7aC5mbGFncyB8PSAzMjc2ODtpZiAobnVsbCAhPT0gayAmJiAib2JqZWN0IiA9PT0gdHlwZW9mIGsgJiYgImZ1bmN0aW9uIiA9PT0gdHlwZW9mIGsudGhlbikge3ZhciBsID0gayxtID0gaCxxID0gbS50YWc7aWYgKDAgPT09IChtLm1vZGUgJiAxKSAmJiAoMCA9PT0gcSB8fCAxMSA9PT0gcSB8fCAxNSA9PT0gcSkpIHt2YXIgciA9IG0uYWx0ZXJuYXRlO3IgPyAobS51cGRhdGVRdWV1ZSA9IHIudXBkYXRlUXVldWUsIG0ubWVtb2l6ZWRTdGF0ZSA9IHIubWVtb2l6ZWRTdGF0ZSwKICAgICAgICAgICAgICAgICAgICAgIG0ubGFuZXMgPSByLmxhbmVzKSA6IChtLnVwZGF0ZVF1ZXVlID0gbnVsbCwgbS5tZW1vaXplZFN0YXRlID0gbnVsbCk7fXZhciB5ID0gVmkoZyk7aWYgKG51bGwgIT09IHkpIHt5LmZsYWdzICY9IC0yNTc7V2koeSwgZywgaCwgZiwgYik7eS5tb2RlICYgMSAmJiBUaShmLCBsLCBiKTtiID0geTtrID0gbDt2YXIgbiA9IGIudXBkYXRlUXVldWU7aWYgKG51bGwgPT09IG4pIHt2YXIgdCA9IG5ldyBTZXQoKTt0LmFkZChrKTtiLnVwZGF0ZVF1ZXVlID0gdDt9IGVsc2Ugbi5hZGQoayk7YnJlYWsgYTt9IGVsc2Uge2lmICgwID09PSAoYiAmIDEpKSB7VGkoZiwgbCwgYik7dWooKTticmVhayBhO31rID0gRXJyb3IocCg0MjYpKTt9fSBlbHNlIGlmIChJICYmIGgubW9kZSAmIDEpIHt2YXIgSiA9IFZpKGcpO2lmIChudWxsICE9PSBKKSB7MCA9PT0gKEouZmxhZ3MgJiA2NTUzNikgJiYgKEouZmxhZ3MgfD0gMjU2KTtXaShKLCBnLCBoLCBmLCBiKTtKZyhLaShrLCBoKSk7YnJlYWsgYTt9fWYgPSBrID0gS2koaywgaCk7NCAhPT0gVCAmJiAoVCA9IDIpO251bGwgPT09IHRrID8gdGsgPSBbZl0gOiB0ay5wdXNoKGYpO2YgPSBnO2RvIHtzd2l0Y2ggKGYudGFnKSB7Y2FzZSAzOmYuZmxhZ3MgfD0gNjU1MzY7CiAgICAgICAgICAgICAgICAgICAgICAgIGIgJj0gLWI7Zi5sYW5lcyB8PSBiO3ZhciB4ID0gT2koZiwgaywgYik7ZmgoZiwgeCk7YnJlYWsgYTtjYXNlIDE6aCA9IGs7dmFyIHcgPSBmLnR5cGUsdSA9IGYuc3RhdGVOb2RlO2lmICgwID09PSAoZi5mbGFncyAmIDEyOCkgJiYgKCJmdW5jdGlvbiIgPT09IHR5cGVvZiB3LmdldERlcml2ZWRTdGF0ZUZyb21FcnJvciB8fCBudWxsICE9PSB1ICYmICJmdW5jdGlvbiIgPT09IHR5cGVvZiB1LmNvbXBvbmVudERpZENhdGNoICYmIChudWxsID09PSBTaSB8fCAhU2kuaGFzKHUpKSkpIHtmLmZsYWdzIHw9IDY1NTM2O2IgJj0gLWI7Zi5sYW5lcyB8PSBiO3ZhciBGID0gUmkoZiwgaCwgYik7ZmgoZiwgRik7YnJlYWsgYTt9fWYgPSBmLnJldHVybjt9IHdoaWxlIChudWxsICE9PSBmKTt9VGsoYyk7fSBjYXRjaCAobmEpIHtiID0gbmE7WSA9PT0gYyAmJiBudWxsICE9PSBjICYmIChZID0gYyA9IGMucmV0dXJuKTtjb250aW51ZTt9YnJlYWs7fSB3aGlsZSAoMSk7fWZ1bmN0aW9uIEtrKCkge3ZhciBhID0gbmsuY3VycmVudDtuay5jdXJyZW50ID0gYWk7cmV0dXJuIG51bGwgPT09IGEgPyBhaSA6IGE7fQogICAgICAgICAgZnVuY3Rpb24gdWooKSB7aWYgKDAgPT09IFQgfHwgMyA9PT0gVCB8fCAyID09PSBUKSBUID0gNDtudWxsID09PSBSIHx8IDAgPT09IChoaCAmIDI2ODQzNTQ1NSkgJiYgMCA9PT0gKHJrICYgMjY4NDM1NDU1KSB8fCBEayhSLCBaKTt9ZnVuY3Rpb24gSmsoYSwgYikge3ZhciBjID0gSztLIHw9IDI7dmFyIGQgPSBLaygpO2lmIChSICE9PSBhIHx8IFogIT09IGIpIHZrID0gbnVsbCwgTGsoYSwgYik7ZG8ge3RyeSB7VWsoKTticmVhazt9IGNhdGNoIChlKSB7TmsoYSwgZSk7fX0gd2hpbGUgKDEpO1FnKCk7SyA9IGM7bmsuY3VycmVudCA9IGQ7aWYgKG51bGwgIT09IFkpIHRocm93IEVycm9yKHAoMjYxKSk7UiA9IG51bGw7WiA9IDA7cmV0dXJuIFQ7fWZ1bmN0aW9uIFVrKCkge2ZvciAoOyBudWxsICE9PSBZOykge1ZrKFkpO319ZnVuY3Rpb24gTWsoKSB7Zm9yICg7IG51bGwgIT09IFkgJiYgIWNjKCk7KSB7VmsoWSk7fX1mdW5jdGlvbiBWayhhKSB7dmFyIGIgPSBXayhhLmFsdGVybmF0ZSwgYSwgZ2opO2EubWVtb2l6ZWRQcm9wcyA9IGEucGVuZGluZ1Byb3BzO251bGwgPT09IGIgPyBUayhhKSA6IFkgPSBiO29rLmN1cnJlbnQgPSBudWxsO30KICAgICAgICAgIGZ1bmN0aW9uIFRrKGEpIHt2YXIgYiA9IGE7ZG8ge3ZhciBjID0gYi5hbHRlcm5hdGU7YSA9IGIucmV0dXJuO2lmICgwID09PSAoYi5mbGFncyAmIDMyNzY4KSkge2lmIChjID0gRmooYywgYiwgZ2opLCBudWxsICE9PSBjKSB7WSA9IGM7cmV0dXJuO319IGVsc2Uge2MgPSBKaihjLCBiKTtpZiAobnVsbCAhPT0gYykge2MuZmxhZ3MgJj0gMzI3Njc7WSA9IGM7cmV0dXJuO31pZiAobnVsbCAhPT0gYSkgYS5mbGFncyB8PSAzMjc2OCwgYS5zdWJ0cmVlRmxhZ3MgPSAwLCBhLmRlbGV0aW9ucyA9IG51bGw7ZWxzZSB7VCA9IDY7WSA9IG51bGw7cmV0dXJuO319YiA9IGIuc2libGluZztpZiAobnVsbCAhPT0gYikge1kgPSBiO3JldHVybjt9WSA9IGIgPSBhO30gd2hpbGUgKG51bGwgIT09IGIpOzAgPT09IFQgJiYgKFQgPSA1KTt9ZnVuY3Rpb24gUWsoYSwgYiwgYykge3ZhciBkID0gQyxlID0gcGsudHJhbnNpdGlvbjt0cnkge3BrLnRyYW5zaXRpb24gPSBudWxsLCBDID0gMSwgWGsoYSwgYiwgYywgZCk7fSBmaW5hbGx5IHtway50cmFuc2l0aW9uID0gZSwgQyA9IGQ7fXJldHVybiBudWxsO30KICAgICAgICAgIGZ1bmN0aW9uIFhrKGEsIGIsIGMsIGQpIHtkbyB7SWsoKTt9IHdoaWxlIChudWxsICE9PSB4ayk7aWYgKDAgIT09IChLICYgNikpIHRocm93IEVycm9yKHAoMzI3KSk7YyA9IGEuZmluaXNoZWRXb3JrO3ZhciBlID0gYS5maW5pc2hlZExhbmVzO2lmIChudWxsID09PSBjKSByZXR1cm4gbnVsbDthLmZpbmlzaGVkV29yayA9IG51bGw7YS5maW5pc2hlZExhbmVzID0gMDtpZiAoYyA9PT0gYS5jdXJyZW50KSB0aHJvdyBFcnJvcihwKDE3NykpO2EuY2FsbGJhY2tOb2RlID0gbnVsbDthLmNhbGxiYWNrUHJpb3JpdHkgPSAwO3ZhciBmID0gYy5sYW5lcyB8IGMuY2hpbGRMYW5lcztCYyhhLCBmKTthID09PSBSICYmIChZID0gUiA9IG51bGwsIFogPSAwKTswID09PSAoYy5zdWJ0cmVlRmxhZ3MgJiAyMDY0KSAmJiAwID09PSAoYy5mbGFncyAmIDIwNjQpIHx8IHdrIHx8ICh3ayA9ICEwLCBHayhoYywgZnVuY3Rpb24gKCkge0lrKCk7cmV0dXJuIG51bGw7fSkpO2YgPSAwICE9PSAoYy5mbGFncyAmIDE1OTkwKTtpZiAoMCAhPT0gKGMuc3VidHJlZUZsYWdzICYgMTU5OTApIHx8IGYpIHtmID0gcGsudHJhbnNpdGlvbjtway50cmFuc2l0aW9uID0gbnVsbDsKICAgICAgICAgICAgICB2YXIgZyA9IEM7QyA9IDE7dmFyIGggPSBLO0sgfD0gNDtvay5jdXJyZW50ID0gbnVsbDtQaihhLCBjKTtlayhjLCBhKTtPZShEZik7ZGQgPSAhIUNmO0RmID0gQ2YgPSBudWxsO2EuY3VycmVudCA9IGM7aWsoYywgYSwgZSk7ZGMoKTtLID0gaDtDID0gZztway50cmFuc2l0aW9uID0gZjt9IGVsc2UgYS5jdXJyZW50ID0gYzt3ayAmJiAod2sgPSAhMSwgeGsgPSBhLCB5ayA9IGUpO2YgPSBhLnBlbmRpbmdMYW5lczswID09PSBmICYmIChTaSA9IG51bGwpO21jKGMuc3RhdGVOb2RlLCBkKTtFayhhLCBCKCkpO2lmIChudWxsICE9PSBiKSBmb3IgKGQgPSBhLm9uUmVjb3ZlcmFibGVFcnJvciwgYyA9IDA7IGMgPCBiLmxlbmd0aDsgYysrKSB7ZSA9IGJbY10sIGQoZS52YWx1ZSwgeyBjb21wb25lbnRTdGFjazogZS5zdGFjaywgZGlnZXN0OiBlLmRpZ2VzdCB9KTt9aWYgKFBpKSB0aHJvdyBQaSA9ICExLCBhID0gUWksIFFpID0gbnVsbCwgYTswICE9PSAoeWsgJiAxKSAmJiAwICE9PSBhLnRhZyAmJiBJaygpO2YgPSBhLnBlbmRpbmdMYW5lczswICE9PSAoZiAmIDEpID8gYSA9PT0gQWsgPyB6aysrIDogKHprID0gMCwgQWsgPSBhKSA6IHprID0gMDtqZygpO3JldHVybiBudWxsO30KICAgICAgICAgIGZ1bmN0aW9uIElrKCkge2lmIChudWxsICE9PSB4aykge3ZhciBhID0gRGMoeWspLGIgPSBway50cmFuc2l0aW9uLGMgPSBDO3RyeSB7cGsudHJhbnNpdGlvbiA9IG51bGw7QyA9IDE2ID4gYSA/IDE2IDogYTtpZiAobnVsbCA9PT0geGspIHZhciBkID0gITE7ZWxzZSB7YSA9IHhrO3hrID0gbnVsbDt5ayA9IDA7aWYgKDAgIT09IChLICYgNikpIHRocm93IEVycm9yKHAoMzMxKSk7dmFyIGUgPSBLO0sgfD0gNDtmb3IgKFYgPSBhLmN1cnJlbnQ7IG51bGwgIT09IFY7KSB7dmFyIGYgPSBWLGcgPSBmLmNoaWxkO2lmICgwICE9PSAoVi5mbGFncyAmIDE2KSkge3ZhciBoID0gZi5kZWxldGlvbnM7aWYgKG51bGwgIT09IGgpIHtmb3IgKHZhciBrID0gMDsgayA8IGgubGVuZ3RoOyBrKyspIHt2YXIgbCA9IGhba107Zm9yIChWID0gbDsgbnVsbCAhPT0gVjspIHt2YXIgbSA9IFY7c3dpdGNoIChtLnRhZykge2Nhc2UgMDpjYXNlIDExOmNhc2UgMTU6UWooOCwgbSwgZik7fXZhciBxID0gbS5jaGlsZDtpZiAobnVsbCAhPT0gcSkgcS5yZXR1cm4gPSBtLCBWID0gcTtlbHNlIGZvciAoOyBudWxsICE9PSBWOykge20gPSBWO3ZhciByID0gbS5zaWJsaW5nLHkgPSBtLnJldHVybjtUaihtKTtpZiAobSA9PT0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbCkge1YgPSBudWxsO2JyZWFrO31pZiAobnVsbCAhPT0gcikge3IucmV0dXJuID0geTtWID0gcjticmVhazt9ViA9IHk7fX19dmFyIG4gPSBmLmFsdGVybmF0ZTtpZiAobnVsbCAhPT0gbikge3ZhciB0ID0gbi5jaGlsZDtpZiAobnVsbCAhPT0gdCkge24uY2hpbGQgPSBudWxsO2RvIHt2YXIgSiA9IHQuc2libGluZzt0LnNpYmxpbmcgPSBudWxsO3QgPSBKO30gd2hpbGUgKG51bGwgIT09IHQpO319ViA9IGY7fX1pZiAoMCAhPT0gKGYuc3VidHJlZUZsYWdzICYgMjA2NCkgJiYgbnVsbCAhPT0gZykgZy5yZXR1cm4gPSBmLCBWID0gZztlbHNlIGI6IGZvciAoOyBudWxsICE9PSBWOykge2YgPSBWO2lmICgwICE9PSAoZi5mbGFncyAmIDIwNDgpKSBzd2l0Y2ggKGYudGFnKSB7Y2FzZSAwOmNhc2UgMTE6Y2FzZSAxNTpRaig5LCBmLCBmLnJldHVybik7fXZhciB4ID0gZi5zaWJsaW5nO2lmIChudWxsICE9PSB4KSB7eC5yZXR1cm4gPSBmLnJldHVybjtWID0geDticmVhayBiO31WID0gZi5yZXR1cm47fX12YXIgdyA9IGEuY3VycmVudDtmb3IgKFYgPSB3OyBudWxsICE9PSBWOykge2cgPSBWO3ZhciB1ID0gZy5jaGlsZDtpZiAoMCAhPT0gKGcuc3VidHJlZUZsYWdzICYgMjA2NCkgJiYgbnVsbCAhPT0KICAgICAgICAgICAgICAgICAgICB1KSB1LnJldHVybiA9IGcsIFYgPSB1O2Vsc2UgYjogZm9yIChnID0gdzsgbnVsbCAhPT0gVjspIHtoID0gVjtpZiAoMCAhPT0gKGguZmxhZ3MgJiAyMDQ4KSkgdHJ5IHtzd2l0Y2ggKGgudGFnKSB7Y2FzZSAwOmNhc2UgMTE6Y2FzZSAxNTpSaig5LCBoKTt9fSBjYXRjaCAobmEpIHtXKGgsIGgucmV0dXJuLCBuYSk7fWlmIChoID09PSBnKSB7ViA9IG51bGw7YnJlYWsgYjt9dmFyIEYgPSBoLnNpYmxpbmc7aWYgKG51bGwgIT09IEYpIHtGLnJldHVybiA9IGgucmV0dXJuO1YgPSBGO2JyZWFrIGI7fVYgPSBoLnJldHVybjt9fUsgPSBlO2pnKCk7aWYgKGxjICYmICJmdW5jdGlvbiIgPT09IHR5cGVvZiBsYy5vblBvc3RDb21taXRGaWJlclJvb3QpIHRyeSB7bGMub25Qb3N0Q29tbWl0RmliZXJSb290KGtjLCBhKTt9IGNhdGNoIChuYSkge31kID0gITA7fXJldHVybiBkO30gZmluYWxseSB7QyA9IGMsIHBrLnRyYW5zaXRpb24gPSBiO319cmV0dXJuICExO31mdW5jdGlvbiBZayhhLCBiLCBjKSB7YiA9IEtpKGMsIGIpO2IgPSBPaShhLCBiLCAxKTthID0gZGgoYSwgYiwgMSk7YiA9IEwoKTtudWxsICE9PSBhICYmIChBYyhhLCAxLCBiKSwgRWsoYSwgYikpO30KICAgICAgICAgIGZ1bmN0aW9uIFcoYSwgYiwgYykge2lmICgzID09PSBhLnRhZykgWWsoYSwgYSwgYyk7ZWxzZSBmb3IgKDsgbnVsbCAhPT0gYjspIHtpZiAoMyA9PT0gYi50YWcpIHtZayhiLCBhLCBjKTticmVhazt9IGVsc2UgaWYgKDEgPT09IGIudGFnKSB7dmFyIGQgPSBiLnN0YXRlTm9kZTtpZiAoImZ1bmN0aW9uIiA9PT0gdHlwZW9mIGIudHlwZS5nZXREZXJpdmVkU3RhdGVGcm9tRXJyb3IgfHwgImZ1bmN0aW9uIiA9PT0gdHlwZW9mIGQuY29tcG9uZW50RGlkQ2F0Y2ggJiYgKG51bGwgPT09IFNpIHx8ICFTaS5oYXMoZCkpKSB7YSA9IEtpKGMsIGEpO2EgPSBSaShiLCBhLCAxKTtiID0gZGgoYiwgYSwgMSk7YSA9IEwoKTtudWxsICE9PSBiICYmIChBYyhiLCAxLCBhKSwgRWsoYiwgYSkpO2JyZWFrO319YiA9IGIucmV0dXJuO319CiAgICAgICAgICBmdW5jdGlvbiBVaShhLCBiLCBjKSB7dmFyIGQgPSBhLnBpbmdDYWNoZTtudWxsICE9PSBkICYmIGQuZGVsZXRlKGIpO2IgPSBMKCk7YS5waW5nZWRMYW5lcyB8PSBhLnN1c3BlbmRlZExhbmVzICYgYztSID09PSBhICYmIChaICYgYykgPT09IGMgJiYgKDQgPT09IFQgfHwgMyA9PT0gVCAmJiAoWiAmIDEzMDAyMzQyNCkgPT09IFogJiYgNTAwID4gQigpIC0gZ2sgPyBMayhhLCAwKSA6IHNrIHw9IGMpO0VrKGEsIGIpO31mdW5jdGlvbiBaayhhLCBiKSB7MCA9PT0gYiAmJiAoMCA9PT0gKGEubW9kZSAmIDEpID8gYiA9IDEgOiAoYiA9IHNjLCBzYyA8PD0gMSwgMCA9PT0gKHNjICYgMTMwMDIzNDI0KSAmJiAoc2MgPSA0MTk0MzA0KSkpO3ZhciBjID0gTCgpO2EgPSBaZyhhLCBiKTtudWxsICE9PSBhICYmIChBYyhhLCBiLCBjKSwgRWsoYSwgYykpO31mdW5jdGlvbiB2aihhKSB7dmFyIGIgPSBhLm1lbW9pemVkU3RhdGUsYyA9IDA7bnVsbCAhPT0gYiAmJiAoYyA9IGIucmV0cnlMYW5lKTtaayhhLCBjKTt9CiAgICAgICAgICBmdW5jdGlvbiBjayhhLCBiKSB7dmFyIGMgPSAwO3N3aXRjaCAoYS50YWcpIHtjYXNlIDEzOnZhciBkID0gYS5zdGF0ZU5vZGU7dmFyIGUgPSBhLm1lbW9pemVkU3RhdGU7bnVsbCAhPT0gZSAmJiAoYyA9IGUucmV0cnlMYW5lKTticmVhaztjYXNlIDE5OmQgPSBhLnN0YXRlTm9kZTticmVhaztkZWZhdWx0OnRocm93IEVycm9yKHAoMzE0KSk7fW51bGwgIT09IGQgJiYgZC5kZWxldGUoYik7WmsoYSwgYyk7fXZhciBXazsKICAgICAgICAgIFdrID0gZnVuY3Rpb24gV2soYSwgYiwgYykge2lmIChudWxsICE9PSBhKSB7aWYgKGEubWVtb2l6ZWRQcm9wcyAhPT0gYi5wZW5kaW5nUHJvcHMgfHwgV2YuY3VycmVudCkgVWcgPSAhMDtlbHNlIHtpZiAoMCA9PT0gKGEubGFuZXMgJiBjKSAmJiAwID09PSAoYi5mbGFncyAmIDEyOCkpIHJldHVybiBVZyA9ICExLCB6aihhLCBiLCBjKTtVZyA9IDAgIT09IChhLmZsYWdzICYgMTMxMDcyKSA/ICEwIDogITE7fX0gZWxzZSBVZyA9ICExLCBJICYmIDAgIT09IChiLmZsYWdzICYgMTA0ODU3NikgJiYgdWcoYiwgbmcsIGIuaW5kZXgpO2IubGFuZXMgPSAwO3N3aXRjaCAoYi50YWcpIHtjYXNlIDI6dmFyIGQgPSBiLnR5cGU7amooYSwgYik7YSA9IGIucGVuZGluZ1Byb3BzO3ZhciBlID0gWWYoYiwgSC5jdXJyZW50KTtUZyhiLCBjKTtlID0gWGgobnVsbCwgYiwgZCwgYSwgZSwgYyk7dmFyIGYgPSBiaSgpO2IuZmxhZ3MgfD0gMTsib2JqZWN0IiA9PT0gdHlwZW9mIGUgJiYgbnVsbCAhPT0gZSAmJiAiZnVuY3Rpb24iID09PSB0eXBlb2YgZS5yZW5kZXIgJiYgdm9pZCAwID09PSBlLiQkdHlwZW9mID8gKGIudGFnID0gMSwgYi5tZW1vaXplZFN0YXRlID0gbnVsbCwgYi51cGRhdGVRdWV1ZSA9CiAgICAgICAgICAgICAgICBudWxsLCBaZihkKSA/IChmID0gITAsIGNnKGIpKSA6IGYgPSAhMSwgYi5tZW1vaXplZFN0YXRlID0gbnVsbCAhPT0gZS5zdGF0ZSAmJiB2b2lkIDAgIT09IGUuc3RhdGUgPyBlLnN0YXRlIDogbnVsbCwgYWgoYiksIGUudXBkYXRlciA9IG5oLCBiLnN0YXRlTm9kZSA9IGUsIGUuX3JlYWN0SW50ZXJuYWxzID0gYiwgcmgoYiwgZCwgYSwgYyksIGIgPSBraihudWxsLCBiLCBkLCAhMCwgZiwgYykpIDogKGIudGFnID0gMCwgSSAmJiBmICYmIHZnKGIpLCBZaShudWxsLCBiLCBlLCBjKSwgYiA9IGIuY2hpbGQpO3JldHVybiBiO2Nhc2UgMTY6ZCA9IGIuZWxlbWVudFR5cGU7YToge2pqKGEsIGIpO2EgPSBiLnBlbmRpbmdQcm9wcztlID0gZC5faW5pdDtkID0gZShkLl9wYXlsb2FkKTtiLnR5cGUgPSBkO2UgPSBiLnRhZyA9ICRrKGQpO2EgPSBMZyhkLCBhKTtzd2l0Y2ggKGUpIHtjYXNlIDA6YiA9IGRqKG51bGwsIGIsIGQsIGEsIGMpO2JyZWFrIGE7Y2FzZSAxOmIgPSBpaihudWxsLCBiLCBkLCBhLCBjKTticmVhayBhO2Nhc2UgMTE6YiA9IFppKG51bGwsIGIsIGQsIGEsIGMpO2JyZWFrIGE7Y2FzZSAxNDpiID0gYWoobnVsbCwgYiwgZCwgTGcoZC50eXBlLCBhKSwgYyk7YnJlYWsgYTt9dGhyb3cgRXJyb3IocCgzMDYsCiAgICAgICAgICAgICAgICAgIGQsICIiKSk7fXJldHVybiBiO2Nhc2UgMDpyZXR1cm4gZCA9IGIudHlwZSwgZSA9IGIucGVuZGluZ1Byb3BzLCBlID0gYi5lbGVtZW50VHlwZSA9PT0gZCA/IGUgOiBMZyhkLCBlKSwgZGooYSwgYiwgZCwgZSwgYyk7Y2FzZSAxOnJldHVybiBkID0gYi50eXBlLCBlID0gYi5wZW5kaW5nUHJvcHMsIGUgPSBiLmVsZW1lbnRUeXBlID09PSBkID8gZSA6IExnKGQsIGUpLCBpaihhLCBiLCBkLCBlLCBjKTtjYXNlIDM6YToge2xqKGIpO2lmIChudWxsID09PSBhKSB0aHJvdyBFcnJvcihwKDM4NykpO2QgPSBiLnBlbmRpbmdQcm9wcztmID0gYi5tZW1vaXplZFN0YXRlO2UgPSBmLmVsZW1lbnQ7YmgoYSwgYik7Z2goYiwgZCwgbnVsbCwgYyk7dmFyIGcgPSBiLm1lbW9pemVkU3RhdGU7ZCA9IGcuZWxlbWVudDtpZiAoZi5pc0RlaHlkcmF0ZWQpIHtpZiAoZiA9IHsgZWxlbWVudDogZCwgaXNEZWh5ZHJhdGVkOiAhMSwgY2FjaGU6IGcuY2FjaGUsIHBlbmRpbmdTdXNwZW5zZUJvdW5kYXJpZXM6IGcucGVuZGluZ1N1c3BlbnNlQm91bmRhcmllcywgdHJhbnNpdGlvbnM6IGcudHJhbnNpdGlvbnMgfSwgYi51cGRhdGVRdWV1ZS5iYXNlU3RhdGUgPQogICAgICAgICAgICAgICAgICAgIGYsIGIubWVtb2l6ZWRTdGF0ZSA9IGYsIGIuZmxhZ3MgJiAyNTYpIHtlID0gS2koRXJyb3IocCg0MjMpKSwgYik7YiA9IG1qKGEsIGIsIGQsIGMsIGUpO2JyZWFrIGE7fSBlbHNlIGlmIChkICE9PSBlKSB7ZSA9IEtpKEVycm9yKHAoNDI0KSksIGIpO2IgPSBtaihhLCBiLCBkLCBjLCBlKTticmVhayBhO30gZWxzZSBmb3IgKHlnID0gTGYoYi5zdGF0ZU5vZGUuY29udGFpbmVySW5mby5maXJzdENoaWxkKSwgeGcgPSBiLCBJID0gITAsIHpnID0gbnVsbCwgYyA9IENoKGIsIG51bGwsIGQsIGMpLCBiLmNoaWxkID0gYzsgYzspIHtjLmZsYWdzID0gYy5mbGFncyAmIC0zIHwgNDA5NiwgYyA9IGMuc2libGluZzt9fSBlbHNlIHtJZygpO2lmIChkID09PSBlKSB7YiA9ICRpKGEsIGIsIGMpO2JyZWFrIGE7fVlpKGEsIGIsIGQsIGMpO31iID0gYi5jaGlsZDt9cmV0dXJuIGI7Y2FzZSA1OnJldHVybiBLaChiKSwgbnVsbCA9PT0gYSAmJiBFZyhiKSwgZCA9IGIudHlwZSwgZSA9IGIucGVuZGluZ1Byb3BzLCBmID0gbnVsbCAhPT0gYSA/IGEubWVtb2l6ZWRQcm9wcyA6IG51bGwsIGcgPSBlLmNoaWxkcmVuLCBFZihkLCBlKSA/IGcgPSBudWxsIDogbnVsbCAhPT0gZiAmJiBFZihkLCBmKSAmJiAoYi5mbGFncyB8PSAzMiksCiAgICAgICAgICAgICAgICBoaihhLCBiKSwgWWkoYSwgYiwgZywgYyksIGIuY2hpbGQ7Y2FzZSA2OnJldHVybiBudWxsID09PSBhICYmIEVnKGIpLCBudWxsO2Nhc2UgMTM6cmV0dXJuIHBqKGEsIGIsIGMpO2Nhc2UgNDpyZXR1cm4gSWgoYiwgYi5zdGF0ZU5vZGUuY29udGFpbmVySW5mbyksIGQgPSBiLnBlbmRpbmdQcm9wcywgbnVsbCA9PT0gYSA/IGIuY2hpbGQgPSBCaChiLCBudWxsLCBkLCBjKSA6IFlpKGEsIGIsIGQsIGMpLCBiLmNoaWxkO2Nhc2UgMTE6cmV0dXJuIGQgPSBiLnR5cGUsIGUgPSBiLnBlbmRpbmdQcm9wcywgZSA9IGIuZWxlbWVudFR5cGUgPT09IGQgPyBlIDogTGcoZCwgZSksIFppKGEsIGIsIGQsIGUsIGMpO2Nhc2UgNzpyZXR1cm4gWWkoYSwgYiwgYi5wZW5kaW5nUHJvcHMsIGMpLCBiLmNoaWxkO2Nhc2UgODpyZXR1cm4gWWkoYSwgYiwgYi5wZW5kaW5nUHJvcHMuY2hpbGRyZW4sIGMpLCBiLmNoaWxkO2Nhc2UgMTI6cmV0dXJuIFlpKGEsIGIsIGIucGVuZGluZ1Byb3BzLmNoaWxkcmVuLCBjKSwgYi5jaGlsZDtjYXNlIDEwOmE6IHtkID0gYi50eXBlLl9jb250ZXh0O2UgPSBiLnBlbmRpbmdQcm9wcztmID0gYi5tZW1vaXplZFByb3BzOwogICAgICAgICAgICAgICAgICBnID0gZS52YWx1ZTtHKE1nLCBkLl9jdXJyZW50VmFsdWUpO2QuX2N1cnJlbnRWYWx1ZSA9IGc7aWYgKG51bGwgIT09IGYpIGlmIChIZShmLnZhbHVlLCBnKSkge2lmIChmLmNoaWxkcmVuID09PSBlLmNoaWxkcmVuICYmICFXZi5jdXJyZW50KSB7YiA9ICRpKGEsIGIsIGMpO2JyZWFrIGE7fX0gZWxzZSBmb3IgKGYgPSBiLmNoaWxkLCBudWxsICE9PSBmICYmIChmLnJldHVybiA9IGIpOyBudWxsICE9PSBmOykge3ZhciBoID0gZi5kZXBlbmRlbmNpZXM7aWYgKG51bGwgIT09IGgpIHtnID0gZi5jaGlsZDtmb3IgKHZhciBrID0gaC5maXJzdENvbnRleHQ7IG51bGwgIT09IGs7KSB7aWYgKGsuY29udGV4dCA9PT0gZCkge2lmICgxID09PSBmLnRhZykge2sgPSBjaCgtMSwgYyAmIC1jKTtrLnRhZyA9IDI7dmFyIGwgPSBmLnVwZGF0ZVF1ZXVlO2lmIChudWxsICE9PSBsKSB7bCA9IGwuc2hhcmVkO3ZhciBtID0gbC5wZW5kaW5nO251bGwgPT09IG0gPyBrLm5leHQgPSBrIDogKGsubmV4dCA9IG0ubmV4dCwgbS5uZXh0ID0gayk7bC5wZW5kaW5nID0gazt9fWYubGFuZXMgfD0gYztrID0gZi5hbHRlcm5hdGU7bnVsbCAhPT0gayAmJiAoay5sYW5lcyB8PSBjKTtTZyhmLnJldHVybiwKICAgICAgICAgICAgICAgICAgICAgICAgICBjLCBiKTtoLmxhbmVzIHw9IGM7YnJlYWs7fWsgPSBrLm5leHQ7fX0gZWxzZSBpZiAoMTAgPT09IGYudGFnKSBnID0gZi50eXBlID09PSBiLnR5cGUgPyBudWxsIDogZi5jaGlsZDtlbHNlIGlmICgxOCA9PT0gZi50YWcpIHtnID0gZi5yZXR1cm47aWYgKG51bGwgPT09IGcpIHRocm93IEVycm9yKHAoMzQxKSk7Zy5sYW5lcyB8PSBjO2ggPSBnLmFsdGVybmF0ZTtudWxsICE9PSBoICYmIChoLmxhbmVzIHw9IGMpO1NnKGcsIGMsIGIpO2cgPSBmLnNpYmxpbmc7fSBlbHNlIGcgPSBmLmNoaWxkO2lmIChudWxsICE9PSBnKSBnLnJldHVybiA9IGY7ZWxzZSBmb3IgKGcgPSBmOyBudWxsICE9PSBnOykge2lmIChnID09PSBiKSB7ZyA9IG51bGw7YnJlYWs7fWYgPSBnLnNpYmxpbmc7aWYgKG51bGwgIT09IGYpIHtmLnJldHVybiA9IGcucmV0dXJuO2cgPSBmO2JyZWFrO31nID0gZy5yZXR1cm47fWYgPSBnO31ZaShhLCBiLCBlLmNoaWxkcmVuLCBjKTtiID0gYi5jaGlsZDt9cmV0dXJuIGI7Y2FzZSA5OnJldHVybiBlID0gYi50eXBlLCBkID0gYi5wZW5kaW5nUHJvcHMuY2hpbGRyZW4sIFRnKGIsIGMpLCBlID0gVmcoZSksIGQgPSBkKGUpLCBiLmZsYWdzIHw9IDEsIFlpKGEsIGIsIGQsIGMpLAogICAgICAgICAgICAgICAgYi5jaGlsZDtjYXNlIDE0OnJldHVybiBkID0gYi50eXBlLCBlID0gTGcoZCwgYi5wZW5kaW5nUHJvcHMpLCBlID0gTGcoZC50eXBlLCBlKSwgYWooYSwgYiwgZCwgZSwgYyk7Y2FzZSAxNTpyZXR1cm4gY2ooYSwgYiwgYi50eXBlLCBiLnBlbmRpbmdQcm9wcywgYyk7Y2FzZSAxNzpyZXR1cm4gZCA9IGIudHlwZSwgZSA9IGIucGVuZGluZ1Byb3BzLCBlID0gYi5lbGVtZW50VHlwZSA9PT0gZCA/IGUgOiBMZyhkLCBlKSwgamooYSwgYiksIGIudGFnID0gMSwgWmYoZCkgPyAoYSA9ICEwLCBjZyhiKSkgOiBhID0gITEsIFRnKGIsIGMpLCBwaChiLCBkLCBlKSwgcmgoYiwgZCwgZSwgYyksIGtqKG51bGwsIGIsIGQsICEwLCBhLCBjKTtjYXNlIDE5OnJldHVybiB5aihhLCBiLCBjKTtjYXNlIDIyOnJldHVybiBlaihhLCBiLCBjKTt9dGhyb3cgRXJyb3IocCgxNTYsIGIudGFnKSk7fTtmdW5jdGlvbiBHayhhLCBiKSB7cmV0dXJuIGFjKGEsIGIpO30KICAgICAgICAgIGZ1bmN0aW9uIGFsKGEsIGIsIGMsIGQpIHt0aGlzLnRhZyA9IGE7dGhpcy5rZXkgPSBjO3RoaXMuc2libGluZyA9IHRoaXMuY2hpbGQgPSB0aGlzLnJldHVybiA9IHRoaXMuc3RhdGVOb2RlID0gdGhpcy50eXBlID0gdGhpcy5lbGVtZW50VHlwZSA9IG51bGw7dGhpcy5pbmRleCA9IDA7dGhpcy5yZWYgPSBudWxsO3RoaXMucGVuZGluZ1Byb3BzID0gYjt0aGlzLmRlcGVuZGVuY2llcyA9IHRoaXMubWVtb2l6ZWRTdGF0ZSA9IHRoaXMudXBkYXRlUXVldWUgPSB0aGlzLm1lbW9pemVkUHJvcHMgPSBudWxsO3RoaXMubW9kZSA9IGQ7dGhpcy5zdWJ0cmVlRmxhZ3MgPSB0aGlzLmZsYWdzID0gMDt0aGlzLmRlbGV0aW9ucyA9IG51bGw7dGhpcy5jaGlsZExhbmVzID0gdGhpcy5sYW5lcyA9IDA7dGhpcy5hbHRlcm5hdGUgPSBudWxsO31mdW5jdGlvbiBCZyhhLCBiLCBjLCBkKSB7cmV0dXJuIG5ldyBhbChhLCBiLCBjLCBkKTt9ZnVuY3Rpb24gYmooYSkge2EgPSBhLnByb3RvdHlwZTtyZXR1cm4gISghYSB8fCAhYS5pc1JlYWN0Q29tcG9uZW50KTt9CiAgICAgICAgICBmdW5jdGlvbiAkayhhKSB7aWYgKCJmdW5jdGlvbiIgPT09IHR5cGVvZiBhKSByZXR1cm4gYmooYSkgPyAxIDogMDtpZiAodm9pZCAwICE9PSBhICYmIG51bGwgIT09IGEpIHthID0gYS4kJHR5cGVvZjtpZiAoYSA9PT0gRGEpIHJldHVybiAxMTtpZiAoYSA9PT0gR2EpIHJldHVybiAxNDt9cmV0dXJuIDI7fQogICAgICAgICAgZnVuY3Rpb24gd2goYSwgYikge3ZhciBjID0gYS5hbHRlcm5hdGU7bnVsbCA9PT0gYyA/IChjID0gQmcoYS50YWcsIGIsIGEua2V5LCBhLm1vZGUpLCBjLmVsZW1lbnRUeXBlID0gYS5lbGVtZW50VHlwZSwgYy50eXBlID0gYS50eXBlLCBjLnN0YXRlTm9kZSA9IGEuc3RhdGVOb2RlLCBjLmFsdGVybmF0ZSA9IGEsIGEuYWx0ZXJuYXRlID0gYykgOiAoYy5wZW5kaW5nUHJvcHMgPSBiLCBjLnR5cGUgPSBhLnR5cGUsIGMuZmxhZ3MgPSAwLCBjLnN1YnRyZWVGbGFncyA9IDAsIGMuZGVsZXRpb25zID0gbnVsbCk7Yy5mbGFncyA9IGEuZmxhZ3MgJiAxNDY4MDA2NDtjLmNoaWxkTGFuZXMgPSBhLmNoaWxkTGFuZXM7Yy5sYW5lcyA9IGEubGFuZXM7Yy5jaGlsZCA9IGEuY2hpbGQ7Yy5tZW1vaXplZFByb3BzID0gYS5tZW1vaXplZFByb3BzO2MubWVtb2l6ZWRTdGF0ZSA9IGEubWVtb2l6ZWRTdGF0ZTtjLnVwZGF0ZVF1ZXVlID0gYS51cGRhdGVRdWV1ZTtiID0gYS5kZXBlbmRlbmNpZXM7Yy5kZXBlbmRlbmNpZXMgPSBudWxsID09PSBiID8gbnVsbCA6IHsgbGFuZXM6IGIubGFuZXMsIGZpcnN0Q29udGV4dDogYi5maXJzdENvbnRleHQgfTsKICAgICAgICAgICAgYy5zaWJsaW5nID0gYS5zaWJsaW5nO2MuaW5kZXggPSBhLmluZGV4O2MucmVmID0gYS5yZWY7cmV0dXJuIGM7fQogICAgICAgICAgZnVuY3Rpb24geWgoYSwgYiwgYywgZCwgZSwgZikge3ZhciBnID0gMjtkID0gYTtpZiAoImZ1bmN0aW9uIiA9PT0gdHlwZW9mIGEpIGJqKGEpICYmIChnID0gMSk7ZWxzZSBpZiAoInN0cmluZyIgPT09IHR5cGVvZiBhKSBnID0gNTtlbHNlIGE6IHN3aXRjaCAoYSkge2Nhc2UgeWE6cmV0dXJuIEFoKGMuY2hpbGRyZW4sIGUsIGYsIGIpO2Nhc2UgemE6ZyA9IDg7ZSB8PSA4O2JyZWFrO2Nhc2UgQWE6cmV0dXJuIGEgPSBCZygxMiwgYywgYiwgZSB8IDIpLCBhLmVsZW1lbnRUeXBlID0gQWEsIGEubGFuZXMgPSBmLCBhO2Nhc2UgRWE6cmV0dXJuIGEgPSBCZygxMywgYywgYiwgZSksIGEuZWxlbWVudFR5cGUgPSBFYSwgYS5sYW5lcyA9IGYsIGE7Y2FzZSBGYTpyZXR1cm4gYSA9IEJnKDE5LCBjLCBiLCBlKSwgYS5lbGVtZW50VHlwZSA9IEZhLCBhLmxhbmVzID0gZiwgYTtjYXNlIElhOnJldHVybiBxaihjLCBlLCBmLCBiKTtkZWZhdWx0OmlmICgib2JqZWN0IiA9PT0gdHlwZW9mIGEgJiYgbnVsbCAhPT0gYSkgc3dpdGNoIChhLiQkdHlwZW9mKSB7Y2FzZSBCYTpnID0gMTA7YnJlYWsgYTtjYXNlIENhOmcgPSA5O2JyZWFrIGE7Y2FzZSBEYTpnID0gMTE7CiAgICAgICAgICAgICAgICAgICAgYnJlYWsgYTtjYXNlIEdhOmcgPSAxNDticmVhayBhO2Nhc2UgSGE6ZyA9IDE2O2QgPSBudWxsO2JyZWFrIGE7fXRocm93IEVycm9yKHAoMTMwLCBudWxsID09IGEgPyBhIDogdHlwZW9mIGEsICIiKSk7fWIgPSBCZyhnLCBjLCBiLCBlKTtiLmVsZW1lbnRUeXBlID0gYTtiLnR5cGUgPSBkO2IubGFuZXMgPSBmO3JldHVybiBiO31mdW5jdGlvbiBBaChhLCBiLCBjLCBkKSB7YSA9IEJnKDcsIGEsIGQsIGIpO2EubGFuZXMgPSBjO3JldHVybiBhO31mdW5jdGlvbiBxaihhLCBiLCBjLCBkKSB7YSA9IEJnKDIyLCBhLCBkLCBiKTthLmVsZW1lbnRUeXBlID0gSWE7YS5sYW5lcyA9IGM7YS5zdGF0ZU5vZGUgPSB7IGlzSGlkZGVuOiAhMSB9O3JldHVybiBhO31mdW5jdGlvbiB4aChhLCBiLCBjKSB7YSA9IEJnKDYsIGEsIG51bGwsIGIpO2EubGFuZXMgPSBjO3JldHVybiBhO30KICAgICAgICAgIGZ1bmN0aW9uIHpoKGEsIGIsIGMpIHtiID0gQmcoNCwgbnVsbCAhPT0gYS5jaGlsZHJlbiA/IGEuY2hpbGRyZW4gOiBbXSwgYS5rZXksIGIpO2IubGFuZXMgPSBjO2Iuc3RhdGVOb2RlID0geyBjb250YWluZXJJbmZvOiBhLmNvbnRhaW5lckluZm8sIHBlbmRpbmdDaGlsZHJlbjogbnVsbCwgaW1wbGVtZW50YXRpb246IGEuaW1wbGVtZW50YXRpb24gfTtyZXR1cm4gYjt9CiAgICAgICAgICBmdW5jdGlvbiBibChhLCBiLCBjLCBkLCBlKSB7dGhpcy50YWcgPSBiO3RoaXMuY29udGFpbmVySW5mbyA9IGE7dGhpcy5maW5pc2hlZFdvcmsgPSB0aGlzLnBpbmdDYWNoZSA9IHRoaXMuY3VycmVudCA9IHRoaXMucGVuZGluZ0NoaWxkcmVuID0gbnVsbDt0aGlzLnRpbWVvdXRIYW5kbGUgPSAtMTt0aGlzLmNhbGxiYWNrTm9kZSA9IHRoaXMucGVuZGluZ0NvbnRleHQgPSB0aGlzLmNvbnRleHQgPSBudWxsO3RoaXMuY2FsbGJhY2tQcmlvcml0eSA9IDA7dGhpcy5ldmVudFRpbWVzID0gemMoMCk7dGhpcy5leHBpcmF0aW9uVGltZXMgPSB6YygtMSk7dGhpcy5lbnRhbmdsZWRMYW5lcyA9IHRoaXMuZmluaXNoZWRMYW5lcyA9IHRoaXMubXV0YWJsZVJlYWRMYW5lcyA9IHRoaXMuZXhwaXJlZExhbmVzID0gdGhpcy5waW5nZWRMYW5lcyA9IHRoaXMuc3VzcGVuZGVkTGFuZXMgPSB0aGlzLnBlbmRpbmdMYW5lcyA9IDA7dGhpcy5lbnRhbmdsZW1lbnRzID0gemMoMCk7dGhpcy5pZGVudGlmaWVyUHJlZml4ID0gZDt0aGlzLm9uUmVjb3ZlcmFibGVFcnJvciA9IGU7dGhpcy5tdXRhYmxlU291cmNlRWFnZXJIeWRyYXRpb25EYXRhID0KICAgICAgICAgICAgbnVsbDt9ZnVuY3Rpb24gY2woYSwgYiwgYywgZCwgZSwgZiwgZywgaCwgaykge2EgPSBuZXcgYmwoYSwgYiwgYywgaCwgayk7MSA9PT0gYiA/IChiID0gMSwgITAgPT09IGYgJiYgKGIgfD0gOCkpIDogYiA9IDA7ZiA9IEJnKDMsIG51bGwsIG51bGwsIGIpO2EuY3VycmVudCA9IGY7Zi5zdGF0ZU5vZGUgPSBhO2YubWVtb2l6ZWRTdGF0ZSA9IHsgZWxlbWVudDogZCwgaXNEZWh5ZHJhdGVkOiBjLCBjYWNoZTogbnVsbCwgdHJhbnNpdGlvbnM6IG51bGwsIHBlbmRpbmdTdXNwZW5zZUJvdW5kYXJpZXM6IG51bGwgfTthaChmKTtyZXR1cm4gYTt9ZnVuY3Rpb24gZGwoYSwgYiwgYykge3ZhciBkID0gMyA8IGFyZ3VtZW50cy5sZW5ndGggJiYgdm9pZCAwICE9PSBhcmd1bWVudHNbM10gPyBhcmd1bWVudHNbM10gOiBudWxsO3JldHVybiB7ICQkdHlwZW9mOiB3YSwga2V5OiBudWxsID09IGQgPyBudWxsIDogIiIgKyBkLCBjaGlsZHJlbjogYSwgY29udGFpbmVySW5mbzogYiwgaW1wbGVtZW50YXRpb246IGMgfTt9CiAgICAgICAgICBmdW5jdGlvbiBlbChhKSB7aWYgKCFhKSByZXR1cm4gVmY7YSA9IGEuX3JlYWN0SW50ZXJuYWxzO2E6IHtpZiAoVmIoYSkgIT09IGEgfHwgMSAhPT0gYS50YWcpIHRocm93IEVycm9yKHAoMTcwKSk7dmFyIGIgPSBhO2RvIHtzd2l0Y2ggKGIudGFnKSB7Y2FzZSAzOmIgPSBiLnN0YXRlTm9kZS5jb250ZXh0O2JyZWFrIGE7Y2FzZSAxOmlmIChaZihiLnR5cGUpKSB7YiA9IGIuc3RhdGVOb2RlLl9fcmVhY3RJbnRlcm5hbE1lbW9pemVkTWVyZ2VkQ2hpbGRDb250ZXh0O2JyZWFrIGE7fX1iID0gYi5yZXR1cm47fSB3aGlsZSAobnVsbCAhPT0gYik7dGhyb3cgRXJyb3IocCgxNzEpKTt9aWYgKDEgPT09IGEudGFnKSB7dmFyIGMgPSBhLnR5cGU7aWYgKFpmKGMpKSByZXR1cm4gYmcoYSwgYywgYik7fXJldHVybiBiO30KICAgICAgICAgIGZ1bmN0aW9uIGZsKGEsIGIsIGMsIGQsIGUsIGYsIGcsIGgsIGspIHthID0gY2woYywgZCwgITAsIGEsIGUsIGYsIGcsIGgsIGspO2EuY29udGV4dCA9IGVsKG51bGwpO2MgPSBhLmN1cnJlbnQ7ZCA9IEwoKTtlID0gbGgoYyk7ZiA9IGNoKGQsIGUpO2YuY2FsbGJhY2sgPSB2b2lkIDAgIT09IGIgJiYgbnVsbCAhPT0gYiA/IGIgOiBudWxsO2RoKGMsIGYsIGUpO2EuY3VycmVudC5sYW5lcyA9IGU7QWMoYSwgZSwgZCk7RWsoYSwgZCk7cmV0dXJuIGE7fWZ1bmN0aW9uIGdsKGEsIGIsIGMsIGQpIHt2YXIgZSA9IGIuY3VycmVudCxmID0gTCgpLGcgPSBsaChlKTtjID0gZWwoYyk7bnVsbCA9PT0gYi5jb250ZXh0ID8gYi5jb250ZXh0ID0gYyA6IGIucGVuZGluZ0NvbnRleHQgPSBjO2IgPSBjaChmLCBnKTtiLnBheWxvYWQgPSB7IGVsZW1lbnQ6IGEgfTtkID0gdm9pZCAwID09PSBkID8gbnVsbCA6IGQ7bnVsbCAhPT0gZCAmJiAoYi5jYWxsYmFjayA9IGQpO2EgPSBkaChlLCBiLCBnKTtudWxsICE9PSBhICYmIChtaChhLCBlLCBnLCBmKSwgZWgoYSwgZSwgZykpO3JldHVybiBnO30KICAgICAgICAgIGZ1bmN0aW9uIGhsKGEpIHthID0gYS5jdXJyZW50O2lmICghYS5jaGlsZCkgcmV0dXJuIG51bGw7c3dpdGNoIChhLmNoaWxkLnRhZykge2Nhc2UgNTpyZXR1cm4gYS5jaGlsZC5zdGF0ZU5vZGU7ZGVmYXVsdDpyZXR1cm4gYS5jaGlsZC5zdGF0ZU5vZGU7fX1mdW5jdGlvbiBpbChhLCBiKSB7YSA9IGEubWVtb2l6ZWRTdGF0ZTtpZiAobnVsbCAhPT0gYSAmJiBudWxsICE9PSBhLmRlaHlkcmF0ZWQpIHt2YXIgYyA9IGEucmV0cnlMYW5lO2EucmV0cnlMYW5lID0gMCAhPT0gYyAmJiBjIDwgYiA/IGMgOiBiO319ZnVuY3Rpb24gamwoYSwgYikge2lsKGEsIGIpOyhhID0gYS5hbHRlcm5hdGUpICYmIGlsKGEsIGIpO31mdW5jdGlvbiBrbCgpIHtyZXR1cm4gbnVsbDt9dmFyIGxsID0gImZ1bmN0aW9uIiA9PT0gdHlwZW9mIHJlcG9ydEVycm9yID8gcmVwb3J0RXJyb3IgOiBmdW5jdGlvbiAoYSkge2NvbnNvbGUuZXJyb3IoYSk7fTtmdW5jdGlvbiBtbChhKSB7dGhpcy5faW50ZXJuYWxSb290ID0gYTt9CiAgICAgICAgICBubC5wcm90b3R5cGUucmVuZGVyID0gbWwucHJvdG90eXBlLnJlbmRlciA9IGZ1bmN0aW9uIChhKSB7dmFyIGIgPSB0aGlzLl9pbnRlcm5hbFJvb3Q7aWYgKG51bGwgPT09IGIpIHRocm93IEVycm9yKHAoNDA5KSk7Z2woYSwgYiwgbnVsbCwgbnVsbCk7fTtubC5wcm90b3R5cGUudW5tb3VudCA9IG1sLnByb3RvdHlwZS51bm1vdW50ID0gZnVuY3Rpb24gKCkge3ZhciBhID0gdGhpcy5faW50ZXJuYWxSb290O2lmIChudWxsICE9PSBhKSB7dGhpcy5faW50ZXJuYWxSb290ID0gbnVsbDt2YXIgYiA9IGEuY29udGFpbmVySW5mbztTayhmdW5jdGlvbiAoKSB7Z2wobnVsbCwgYSwgbnVsbCwgbnVsbCk7fSk7Ylt1Zl0gPSBudWxsO319O2Z1bmN0aW9uIG5sKGEpIHt0aGlzLl9pbnRlcm5hbFJvb3QgPSBhO30KICAgICAgICAgIG5sLnByb3RvdHlwZS51bnN0YWJsZV9zY2hlZHVsZUh5ZHJhdGlvbiA9IGZ1bmN0aW9uIChhKSB7aWYgKGEpIHt2YXIgYiA9IEhjKCk7YSA9IHsgYmxvY2tlZE9uOiBudWxsLCB0YXJnZXQ6IGEsIHByaW9yaXR5OiBiIH07Zm9yICh2YXIgYyA9IDA7IGMgPCBRYy5sZW5ndGggJiYgMCAhPT0gYiAmJiBiIDwgUWNbY10ucHJpb3JpdHk7IGMrKykgezt9UWMuc3BsaWNlKGMsIDAsIGEpOzAgPT09IGMgJiYgVmMoYSk7fX07ZnVuY3Rpb24gb2woYSkge3JldHVybiAhKCFhIHx8IDEgIT09IGEubm9kZVR5cGUgJiYgOSAhPT0gYS5ub2RlVHlwZSAmJiAxMSAhPT0gYS5ub2RlVHlwZSk7fWZ1bmN0aW9uIHBsKGEpIHtyZXR1cm4gISghYSB8fCAxICE9PSBhLm5vZGVUeXBlICYmIDkgIT09IGEubm9kZVR5cGUgJiYgMTEgIT09IGEubm9kZVR5cGUgJiYgKDggIT09IGEubm9kZVR5cGUgfHwgIiByZWFjdC1tb3VudC1wb2ludC11bnN0YWJsZSAiICE9PSBhLm5vZGVWYWx1ZSkpO31mdW5jdGlvbiBxbCgpIHt9CiAgICAgICAgICBmdW5jdGlvbiBybChhLCBiLCBjLCBkLCBlKSB7aWYgKGUpIHtpZiAoImZ1bmN0aW9uIiA9PT0gdHlwZW9mIGQpIHt2YXIgZiA9IGQ7ZCA9IGZ1bmN0aW9uIGQoKSB7dmFyIGEgPSBobChnKTtmLmNhbGwoYSk7fTt9dmFyIGcgPSBmbChiLCBkLCBhLCAwLCBudWxsLCAhMSwgITEsICIiLCBxbCk7YS5fcmVhY3RSb290Q29udGFpbmVyID0gZzthW3VmXSA9IGcuY3VycmVudDtzZig4ID09PSBhLm5vZGVUeXBlID8gYS5wYXJlbnROb2RlIDogYSk7U2soKTtyZXR1cm4gZzt9Zm9yICg7IGUgPSBhLmxhc3RDaGlsZDspIHthLnJlbW92ZUNoaWxkKGUpO31pZiAoImZ1bmN0aW9uIiA9PT0gdHlwZW9mIGQpIHt2YXIgaCA9IGQ7ZCA9IGZ1bmN0aW9uIGQoKSB7dmFyIGEgPSBobChrKTtoLmNhbGwoYSk7fTt9dmFyIGsgPSBjbChhLCAwLCAhMSwgbnVsbCwgbnVsbCwgITEsICExLCAiIiwgcWwpO2EuX3JlYWN0Um9vdENvbnRhaW5lciA9IGs7YVt1Zl0gPSBrLmN1cnJlbnQ7c2YoOCA9PT0gYS5ub2RlVHlwZSA/IGEucGFyZW50Tm9kZSA6IGEpO1NrKGZ1bmN0aW9uICgpIHtnbChiLCBrLCBjLCBkKTt9KTtyZXR1cm4gazt9CiAgICAgICAgICBmdW5jdGlvbiBzbChhLCBiLCBjLCBkLCBlKSB7dmFyIGYgPSBjLl9yZWFjdFJvb3RDb250YWluZXI7aWYgKGYpIHt2YXIgZyA9IGY7aWYgKCJmdW5jdGlvbiIgPT09IHR5cGVvZiBlKSB7dmFyIGggPSBlO2UgPSBmdW5jdGlvbiBlKCkge3ZhciBhID0gaGwoZyk7aC5jYWxsKGEpO307fWdsKGIsIGcsIGEsIGUpO30gZWxzZSBnID0gcmwoYywgYiwgYSwgZSwgZCk7cmV0dXJuIGhsKGcpO31FYyA9IGZ1bmN0aW9uIEVjKGEpIHtzd2l0Y2ggKGEudGFnKSB7Y2FzZSAzOnZhciBiID0gYS5zdGF0ZU5vZGU7aWYgKGIuY3VycmVudC5tZW1vaXplZFN0YXRlLmlzRGVoeWRyYXRlZCkge3ZhciBjID0gdGMoYi5wZW5kaW5nTGFuZXMpOzAgIT09IGMgJiYgKENjKGIsIGMgfCAxKSwgRWsoYiwgQigpKSwgMCA9PT0gKEsgJiA2KSAmJiAoSGogPSBCKCkgKyA1MDAsIGpnKCkpKTt9YnJlYWs7Y2FzZSAxMzpTayhmdW5jdGlvbiAoKSB7dmFyIGIgPSBaZyhhLCAxKTtpZiAobnVsbCAhPT0gYikge3ZhciBjID0gTCgpO21oKGIsIGEsIDEsIGMpO319KSwgamwoYSwgMSk7fX07CiAgICAgICAgICBGYyA9IGZ1bmN0aW9uIEZjKGEpIHtpZiAoMTMgPT09IGEudGFnKSB7dmFyIGIgPSBaZyhhLCAxMzQyMTc3MjgpO2lmIChudWxsICE9PSBiKSB7dmFyIGMgPSBMKCk7bWgoYiwgYSwgMTM0MjE3NzI4LCBjKTt9amwoYSwgMTM0MjE3NzI4KTt9fTtHYyA9IGZ1bmN0aW9uIEdjKGEpIHtpZiAoMTMgPT09IGEudGFnKSB7dmFyIGIgPSBsaChhKSxjID0gWmcoYSwgYik7aWYgKG51bGwgIT09IGMpIHt2YXIgZCA9IEwoKTttaChjLCBhLCBiLCBkKTt9amwoYSwgYik7fX07SGMgPSBmdW5jdGlvbiBIYygpIHtyZXR1cm4gQzt9O0ljID0gZnVuY3Rpb24gSWMoYSwgYikge3ZhciBjID0gQzt0cnkge3JldHVybiBDID0gYSwgYigpO30gZmluYWxseSB7QyA9IGM7fX07CiAgICAgICAgICB5YiA9IGZ1bmN0aW9uIHliKGEsIGIsIGMpIHtzd2l0Y2ggKGIpIHtjYXNlICJpbnB1dCI6YmIoYSwgYyk7YiA9IGMubmFtZTtpZiAoInJhZGlvIiA9PT0gYy50eXBlICYmIG51bGwgIT0gYikge2ZvciAoYyA9IGE7IGMucGFyZW50Tm9kZTspIHtjID0gYy5wYXJlbnROb2RlO31jID0gYy5xdWVyeVNlbGVjdG9yQWxsKCJpbnB1dFtuYW1lPSIgKyBKU09OLnN0cmluZ2lmeSgiIiArIGIpICsgJ11bdHlwZT0icmFkaW8iXScpO2ZvciAoYiA9IDA7IGIgPCBjLmxlbmd0aDsgYisrKSB7dmFyIGQgPSBjW2JdO2lmIChkICE9PSBhICYmIGQuZm9ybSA9PT0gYS5mb3JtKSB7dmFyIGUgPSBEYihkKTtpZiAoIWUpIHRocm93IEVycm9yKHAoOTApKTtXYShkKTtiYihkLCBlKTt9fX1icmVhaztjYXNlICJ0ZXh0YXJlYSI6aWIoYSwgYyk7YnJlYWs7Y2FzZSAic2VsZWN0IjpiID0gYy52YWx1ZSwgbnVsbCAhPSBiICYmIGZiKGEsICEhYy5tdWx0aXBsZSwgYiwgITEpO319O0diID0gUms7SGIgPSBTazsKICAgICAgICAgIHZhciB0bCA9IHsgdXNpbmdDbGllbnRFbnRyeVBvaW50OiAhMSwgRXZlbnRzOiBbQ2IsIHVlLCBEYiwgRWIsIEZiLCBSa10gfSx1bCA9IHsgZmluZEZpYmVyQnlIb3N0SW5zdGFuY2U6IFdjLCBidW5kbGVUeXBlOiAwLCB2ZXJzaW9uOiAiMTguMi4wIiwgcmVuZGVyZXJQYWNrYWdlTmFtZTogInJlYWN0LWRvbSIgfTsKICAgICAgICAgIHZhciB2bCA9IHsgYnVuZGxlVHlwZTogdWwuYnVuZGxlVHlwZSwgdmVyc2lvbjogdWwudmVyc2lvbiwgcmVuZGVyZXJQYWNrYWdlTmFtZTogdWwucmVuZGVyZXJQYWNrYWdlTmFtZSwgcmVuZGVyZXJDb25maWc6IHVsLnJlbmRlcmVyQ29uZmlnLCBvdmVycmlkZUhvb2tTdGF0ZTogbnVsbCwgb3ZlcnJpZGVIb29rU3RhdGVEZWxldGVQYXRoOiBudWxsLCBvdmVycmlkZUhvb2tTdGF0ZVJlbmFtZVBhdGg6IG51bGwsIG92ZXJyaWRlUHJvcHM6IG51bGwsIG92ZXJyaWRlUHJvcHNEZWxldGVQYXRoOiBudWxsLCBvdmVycmlkZVByb3BzUmVuYW1lUGF0aDogbnVsbCwgc2V0RXJyb3JIYW5kbGVyOiBudWxsLCBzZXRTdXNwZW5zZUhhbmRsZXI6IG51bGwsIHNjaGVkdWxlVXBkYXRlOiBudWxsLCBjdXJyZW50RGlzcGF0Y2hlclJlZjogdWEuUmVhY3RDdXJyZW50RGlzcGF0Y2hlciwgZmluZEhvc3RJbnN0YW5jZUJ5RmliZXI6IGZ1bmN0aW9uIGZpbmRIb3N0SW5zdGFuY2VCeUZpYmVyKGEpIHthID0gWmIoYSk7cmV0dXJuIG51bGwgPT09IGEgPyBudWxsIDogYS5zdGF0ZU5vZGU7fSwgZmluZEZpYmVyQnlIb3N0SW5zdGFuY2U6IHVsLmZpbmRGaWJlckJ5SG9zdEluc3RhbmNlIHx8CiAgICAgICAgICAgIGtsLCBmaW5kSG9zdEluc3RhbmNlc0ZvclJlZnJlc2g6IG51bGwsIHNjaGVkdWxlUmVmcmVzaDogbnVsbCwgc2NoZWR1bGVSb290OiBudWxsLCBzZXRSZWZyZXNoSGFuZGxlcjogbnVsbCwgZ2V0Q3VycmVudEZpYmVyOiBudWxsLCByZWNvbmNpbGVyVmVyc2lvbjogIjE4LjIuMC1uZXh0LTllM2I3NzJiOC0yMDIyMDYwOCIgfTtpZiAoInVuZGVmaW5lZCIgIT09IHR5cGVvZiBfX1JFQUNUX0RFVlRPT0xTX0dMT0JBTF9IT09LX18pIHt2YXIgd2wgPSBfX1JFQUNUX0RFVlRPT0xTX0dMT0JBTF9IT09LX187aWYgKCF3bC5pc0Rpc2FibGVkICYmIHdsLnN1cHBvcnRzRmliZXIpIHRyeSB7a2MgPSB3bC5pbmplY3QodmwpLCBsYyA9IHdsO30gY2F0Y2ggKGEpIHt9fWV4cG9ydHMuX19TRUNSRVRfSU5URVJOQUxTX0RPX05PVF9VU0VfT1JfWU9VX1dJTExfQkVfRklSRUQgPSB0bDsKICAgICAgICAgIGV4cG9ydHMuY3JlYXRlUG9ydGFsID0gZnVuY3Rpb24gKGEsIGIpIHt2YXIgYyA9IDIgPCBhcmd1bWVudHMubGVuZ3RoICYmIHZvaWQgMCAhPT0gYXJndW1lbnRzWzJdID8gYXJndW1lbnRzWzJdIDogbnVsbDtpZiAoIW9sKGIpKSB0aHJvdyBFcnJvcihwKDIwMCkpO3JldHVybiBkbChhLCBiLCBudWxsLCBjKTt9O2V4cG9ydHMuY3JlYXRlUm9vdCA9IGZ1bmN0aW9uIChhLCBiKSB7aWYgKCFvbChhKSkgdGhyb3cgRXJyb3IocCgyOTkpKTt2YXIgYyA9ICExLGQgPSAiIixlID0gbGw7bnVsbCAhPT0gYiAmJiB2b2lkIDAgIT09IGIgJiYgKCEwID09PSBiLnVuc3RhYmxlX3N0cmljdE1vZGUgJiYgKGMgPSAhMCksIHZvaWQgMCAhPT0gYi5pZGVudGlmaWVyUHJlZml4ICYmIChkID0gYi5pZGVudGlmaWVyUHJlZml4KSwgdm9pZCAwICE9PSBiLm9uUmVjb3ZlcmFibGVFcnJvciAmJiAoZSA9IGIub25SZWNvdmVyYWJsZUVycm9yKSk7YiA9IGNsKGEsIDEsICExLCBudWxsLCBudWxsLCBjLCAhMSwgZCwgZSk7YVt1Zl0gPSBiLmN1cnJlbnQ7c2YoOCA9PT0gYS5ub2RlVHlwZSA/IGEucGFyZW50Tm9kZSA6IGEpO3JldHVybiBuZXcgbWwoYik7fTsKICAgICAgICAgIGV4cG9ydHMuZmluZERPTU5vZGUgPSBmdW5jdGlvbiAoYSkge2lmIChudWxsID09IGEpIHJldHVybiBudWxsO2lmICgxID09PSBhLm5vZGVUeXBlKSByZXR1cm4gYTt2YXIgYiA9IGEuX3JlYWN0SW50ZXJuYWxzO2lmICh2b2lkIDAgPT09IGIpIHtpZiAoImZ1bmN0aW9uIiA9PT0gdHlwZW9mIGEucmVuZGVyKSB0aHJvdyBFcnJvcihwKDE4OCkpO2EgPSBPYmplY3Qua2V5cyhhKS5qb2luKCIsIik7dGhyb3cgRXJyb3IocCgyNjgsIGEpKTt9YSA9IFpiKGIpO2EgPSBudWxsID09PSBhID8gbnVsbCA6IGEuc3RhdGVOb2RlO3JldHVybiBhO307ZXhwb3J0cy5mbHVzaFN5bmMgPSBmdW5jdGlvbiAoYSkge3JldHVybiBTayhhKTt9O2V4cG9ydHMuaHlkcmF0ZSA9IGZ1bmN0aW9uIChhLCBiLCBjKSB7aWYgKCFwbChiKSkgdGhyb3cgRXJyb3IocCgyMDApKTtyZXR1cm4gc2wobnVsbCwgYSwgYiwgITAsIGMpO307CiAgICAgICAgICBleHBvcnRzLmh5ZHJhdGVSb290ID0gZnVuY3Rpb24gKGEsIGIsIGMpIHtpZiAoIW9sKGEpKSB0aHJvdyBFcnJvcihwKDQwNSkpO3ZhciBkID0gbnVsbCAhPSBjICYmIGMuaHlkcmF0ZWRTb3VyY2VzIHx8IG51bGwsZSA9ICExLGYgPSAiIixnID0gbGw7bnVsbCAhPT0gYyAmJiB2b2lkIDAgIT09IGMgJiYgKCEwID09PSBjLnVuc3RhYmxlX3N0cmljdE1vZGUgJiYgKGUgPSAhMCksIHZvaWQgMCAhPT0gYy5pZGVudGlmaWVyUHJlZml4ICYmIChmID0gYy5pZGVudGlmaWVyUHJlZml4KSwgdm9pZCAwICE9PSBjLm9uUmVjb3ZlcmFibGVFcnJvciAmJiAoZyA9IGMub25SZWNvdmVyYWJsZUVycm9yKSk7YiA9IGZsKGIsIG51bGwsIGEsIDEsIG51bGwgIT0gYyA/IGMgOiBudWxsLCBlLCAhMSwgZiwgZyk7YVt1Zl0gPSBiLmN1cnJlbnQ7c2YoYSk7aWYgKGQpIGZvciAoYSA9IDA7IGEgPCBkLmxlbmd0aDsgYSsrKSB7YyA9IGRbYV0sIGUgPSBjLl9nZXRWZXJzaW9uLCBlID0gZShjLl9zb3VyY2UpLCBudWxsID09IGIubXV0YWJsZVNvdXJjZUVhZ2VySHlkcmF0aW9uRGF0YSA/IGIubXV0YWJsZVNvdXJjZUVhZ2VySHlkcmF0aW9uRGF0YSA9IFtjLCBlXSA6IGIubXV0YWJsZVNvdXJjZUVhZ2VySHlkcmF0aW9uRGF0YS5wdXNoKGMsCiAgICAgICAgICAgICAgZSk7fXJldHVybiBuZXcgbmwoYik7fTtleHBvcnRzLnJlbmRlciA9IGZ1bmN0aW9uIChhLCBiLCBjKSB7aWYgKCFwbChiKSkgdGhyb3cgRXJyb3IocCgyMDApKTtyZXR1cm4gc2wobnVsbCwgYSwgYiwgITEsIGMpO307ZXhwb3J0cy51bm1vdW50Q29tcG9uZW50QXROb2RlID0gZnVuY3Rpb24gKGEpIHtpZiAoIXBsKGEpKSB0aHJvdyBFcnJvcihwKDQwKSk7cmV0dXJuIGEuX3JlYWN0Um9vdENvbnRhaW5lciA/IChTayhmdW5jdGlvbiAoKSB7c2wobnVsbCwgbnVsbCwgYSwgITEsIGZ1bmN0aW9uICgpIHthLl9yZWFjdFJvb3RDb250YWluZXIgPSBudWxsO2FbdWZdID0gbnVsbDt9KTt9KSwgITApIDogITE7fTtleHBvcnRzLnVuc3RhYmxlX2JhdGNoZWRVcGRhdGVzID0gUms7CiAgICAgICAgICBleHBvcnRzLnVuc3RhYmxlX3JlbmRlclN1YnRyZWVJbnRvQ29udGFpbmVyID0gZnVuY3Rpb24gKGEsIGIsIGMsIGQpIHtpZiAoIXBsKGMpKSB0aHJvdyBFcnJvcihwKDIwMCkpO2lmIChudWxsID09IGEgfHwgdm9pZCAwID09PSBhLl9yZWFjdEludGVybmFscykgdGhyb3cgRXJyb3IocCgzOCkpO3JldHVybiBzbChhLCBiLCBjLCAhMSwgZCk7fTtleHBvcnRzLnZlcnNpb24gPSAiMTguMi4wLW5leHQtOWUzYjc3MmI4LTIwMjIwNjA4IjsKCgogICAgICAgICAgLyoqKi99LAoKICAgICAgICAvKioqLzc0NToKICAgICAgICAvKioqLyhfX3VudXNlZF93ZWJwYWNrX21vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgPT4gewoKICAgICAgICAgIHZhciBfX3dlYnBhY2tfdW51c2VkX2V4cG9ydF9fOwoKCiAgICAgICAgICB2YXIgbSA9IF9fd2VicGFja19yZXF1aXJlX18oOTM1KTsKICAgICAgICAgIGlmICh0cnVlKSB7CiAgICAgICAgICAgIGV4cG9ydHMucyA9IG0uY3JlYXRlUm9vdDsKICAgICAgICAgICAgX193ZWJwYWNrX3VudXNlZF9leHBvcnRfXyA9IG0uaHlkcmF0ZVJvb3Q7CiAgICAgICAgICB9IGVsc2Uge3ZhciBpO30KCgogICAgICAgICAgLyoqKi99LAoKICAgICAgICAvKioqLzkzNToKICAgICAgICAvKioqLyhtb2R1bGUsIF9fdW51c2VkX3dlYnBhY2tfZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgPT4gewoKCgogICAgICAgICAgZnVuY3Rpb24gY2hlY2tEQ0UoKSB7CiAgICAgICAgICAgIC8qIGdsb2JhbCBfX1JFQUNUX0RFVlRPT0xTX0dMT0JBTF9IT09LX18gKi8KICAgICAgICAgICAgaWYgKAogICAgICAgICAgICB0eXBlb2YgX19SRUFDVF9ERVZUT09MU19HTE9CQUxfSE9PS19fID09PSAndW5kZWZpbmVkJyB8fAogICAgICAgICAgICB0eXBlb2YgX19SRUFDVF9ERVZUT09MU19HTE9CQUxfSE9PS19fLmNoZWNrRENFICE9PSAnZnVuY3Rpb24nKQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChmYWxzZSkge30KICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAvLyBWZXJpZnkgdGhhdCB0aGUgY29kZSBhYm92ZSBoYXMgYmVlbiBkZWFkIGNvZGUgZWxpbWluYXRlZCAoRENFJ2QpLgogICAgICAgICAgICAgIF9fUkVBQ1RfREVWVE9PTFNfR0xPQkFMX0hPT0tfXy5jaGVja0RDRShjaGVja0RDRSk7CiAgICAgICAgICAgIH0gY2F0Y2ggKGVycikgewogICAgICAgICAgICAgIC8vIERldlRvb2xzIHNob3VsZG4ndCBjcmFzaCBSZWFjdCwgbm8gbWF0dGVyIHdoYXQuCiAgICAgICAgICAgICAgLy8gV2Ugc2hvdWxkIHN0aWxsIHJlcG9ydCBpbiBjYXNlIHdlIGJyZWFrIHRoaXMgY29kZS4KICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKGVycik7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KCiAgICAgICAgICBpZiAodHJ1ZSkgewogICAgICAgICAgICAvLyBEQ0UgY2hlY2sgc2hvdWxkIGhhcHBlbiBiZWZvcmUgUmVhY3RET00gYnVuZGxlIGV4ZWN1dGVzIHNvIHRoYXQKICAgICAgICAgICAgLy8gRGV2VG9vbHMgY2FuIHJlcG9ydCBiYWQgbWluaWZpY2F0aW9uIGR1cmluZyBpbmplY3Rpb24uCiAgICAgICAgICAgIGNoZWNrRENFKCk7CiAgICAgICAgICAgIG1vZHVsZS5leHBvcnRzID0gX193ZWJwYWNrX3JlcXVpcmVfXyg0NDgpOwogICAgICAgICAgfSBlbHNlIHt9CgoKICAgICAgICAgIC8qKiovfSwKCiAgICAgICAgLyoqKi80MDg6CiAgICAgICAgLyoqKi8oX191bnVzZWRfd2VicGFja19tb2R1bGUsIGV4cG9ydHMpID0+IHsKCiAgICAgICAgICAvKioKICAgICAgICAgICAqIEBsaWNlbnNlIFJlYWN0CiAgICAgICAgICAgKiByZWFjdC5wcm9kdWN0aW9uLm1pbi5qcwogICAgICAgICAgICoKICAgICAgICAgICAqIENvcHlyaWdodCAoYykgRmFjZWJvb2ssIEluYy4gYW5kIGl0cyBhZmZpbGlhdGVzLgogICAgICAgICAgICoKICAgICAgICAgICAqIFRoaXMgc291cmNlIGNvZGUgaXMgbGljZW5zZWQgdW5kZXIgdGhlIE1JVCBsaWNlbnNlIGZvdW5kIGluIHRoZQogICAgICAgICAgICogTElDRU5TRSBmaWxlIGluIHRoZSByb290IGRpcmVjdG9yeSBvZiB0aGlzIHNvdXJjZSB0cmVlLgogICAgICAgICAgICovCiAgICAgICAgICB2YXIgbCA9IFN5bWJvbC5mb3IoInJlYWN0LmVsZW1lbnQiKSxuID0gU3ltYm9sLmZvcigicmVhY3QucG9ydGFsIikscCA9IFN5bWJvbC5mb3IoInJlYWN0LmZyYWdtZW50IikscSA9IFN5bWJvbC5mb3IoInJlYWN0LnN0cmljdF9tb2RlIiksciA9IFN5bWJvbC5mb3IoInJlYWN0LnByb2ZpbGVyIiksdCA9IFN5bWJvbC5mb3IoInJlYWN0LnByb3ZpZGVyIiksdSA9IFN5bWJvbC5mb3IoInJlYWN0LmNvbnRleHQiKSx2ID0gU3ltYm9sLmZvcigicmVhY3QuZm9yd2FyZF9yZWYiKSx3ID0gU3ltYm9sLmZvcigicmVhY3Quc3VzcGVuc2UiKSx4ID0gU3ltYm9sLmZvcigicmVhY3QubWVtbyIpLHkgPSBTeW1ib2wuZm9yKCJyZWFjdC5sYXp5IikseiA9IFN5bWJvbC5pdGVyYXRvcjtmdW5jdGlvbiBBKGEpIHtpZiAobnVsbCA9PT0gYSB8fCAib2JqZWN0IiAhPT0gdHlwZW9mIGEpIHJldHVybiBudWxsO2EgPSB6ICYmIGFbel0gfHwgYVsiQEBpdGVyYXRvciJdO3JldHVybiAiZnVuY3Rpb24iID09PSB0eXBlb2YgYSA/IGEgOiBudWxsO30KICAgICAgICAgIHZhciBCID0geyBpc01vdW50ZWQ6IGZ1bmN0aW9uIGlzTW91bnRlZCgpIHtyZXR1cm4gITE7fSwgZW5xdWV1ZUZvcmNlVXBkYXRlOiBmdW5jdGlvbiBlbnF1ZXVlRm9yY2VVcGRhdGUoKSB7fSwgZW5xdWV1ZVJlcGxhY2VTdGF0ZTogZnVuY3Rpb24gZW5xdWV1ZVJlcGxhY2VTdGF0ZSgpIHt9LCBlbnF1ZXVlU2V0U3RhdGU6IGZ1bmN0aW9uIGVucXVldWVTZXRTdGF0ZSgpIHt9IH0sQyA9IE9iamVjdC5hc3NpZ24sRCA9IHt9O2Z1bmN0aW9uIEUoYSwgYiwgZSkge3RoaXMucHJvcHMgPSBhO3RoaXMuY29udGV4dCA9IGI7dGhpcy5yZWZzID0gRDt0aGlzLnVwZGF0ZXIgPSBlIHx8IEI7fUUucHJvdG90eXBlLmlzUmVhY3RDb21wb25lbnQgPSB7fTsKICAgICAgICAgIEUucHJvdG90eXBlLnNldFN0YXRlID0gZnVuY3Rpb24gKGEsIGIpIHtpZiAoIm9iamVjdCIgIT09IHR5cGVvZiBhICYmICJmdW5jdGlvbiIgIT09IHR5cGVvZiBhICYmIG51bGwgIT0gYSkgdGhyb3cgRXJyb3IoInNldFN0YXRlKC4uLik6IHRha2VzIGFuIG9iamVjdCBvZiBzdGF0ZSB2YXJpYWJsZXMgdG8gdXBkYXRlIG9yIGEgZnVuY3Rpb24gd2hpY2ggcmV0dXJucyBhbiBvYmplY3Qgb2Ygc3RhdGUgdmFyaWFibGVzLiIpO3RoaXMudXBkYXRlci5lbnF1ZXVlU2V0U3RhdGUodGhpcywgYSwgYiwgInNldFN0YXRlIik7fTtFLnByb3RvdHlwZS5mb3JjZVVwZGF0ZSA9IGZ1bmN0aW9uIChhKSB7dGhpcy51cGRhdGVyLmVucXVldWVGb3JjZVVwZGF0ZSh0aGlzLCBhLCAiZm9yY2VVcGRhdGUiKTt9O2Z1bmN0aW9uIEYoKSB7fUYucHJvdG90eXBlID0gRS5wcm90b3R5cGU7ZnVuY3Rpb24gRyhhLCBiLCBlKSB7dGhpcy5wcm9wcyA9IGE7dGhpcy5jb250ZXh0ID0gYjt0aGlzLnJlZnMgPSBEO3RoaXMudXBkYXRlciA9IGUgfHwgQjt9dmFyIEggPSBHLnByb3RvdHlwZSA9IG5ldyBGKCk7CiAgICAgICAgICBILmNvbnN0cnVjdG9yID0gRztDKEgsIEUucHJvdG90eXBlKTtILmlzUHVyZVJlYWN0Q29tcG9uZW50ID0gITA7dmFyIEkgPSBBcnJheS5pc0FycmF5LEogPSBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LEsgPSB7IGN1cnJlbnQ6IG51bGwgfSxMID0geyBrZXk6ICEwLCByZWY6ICEwLCBfX3NlbGY6ICEwLCBfX3NvdXJjZTogITAgfTsKICAgICAgICAgIGZ1bmN0aW9uIE0oYSwgYiwgZSkge3ZhciBkLGMgPSB7fSxrID0gbnVsbCxoID0gbnVsbDtpZiAobnVsbCAhPSBiKSBmb3IgKGQgaW4gdm9pZCAwICE9PSBiLnJlZiAmJiAoaCA9IGIucmVmKSwgdm9pZCAwICE9PSBiLmtleSAmJiAoayA9ICIiICsgYi5rZXkpLCBiKSB7Si5jYWxsKGIsIGQpICYmICFMLmhhc093blByb3BlcnR5KGQpICYmIChjW2RdID0gYltkXSk7fXZhciBnID0gYXJndW1lbnRzLmxlbmd0aCAtIDI7aWYgKDEgPT09IGcpIGMuY2hpbGRyZW4gPSBlO2Vsc2UgaWYgKDEgPCBnKSB7Zm9yICh2YXIgZiA9IEFycmF5KGcpLCBtID0gMDsgbSA8IGc7IG0rKykge2ZbbV0gPSBhcmd1bWVudHNbbSArIDJdO31jLmNoaWxkcmVuID0gZjt9aWYgKGEgJiYgYS5kZWZhdWx0UHJvcHMpIGZvciAoZCBpbiBnID0gYS5kZWZhdWx0UHJvcHMsIGcpIHt2b2lkIDAgPT09IGNbZF0gJiYgKGNbZF0gPSBnW2RdKTt9cmV0dXJuIHsgJCR0eXBlb2Y6IGwsIHR5cGU6IGEsIGtleTogaywgcmVmOiBoLCBwcm9wczogYywgX293bmVyOiBLLmN1cnJlbnQgfTt9CiAgICAgICAgICBmdW5jdGlvbiBOKGEsIGIpIHtyZXR1cm4geyAkJHR5cGVvZjogbCwgdHlwZTogYS50eXBlLCBrZXk6IGIsIHJlZjogYS5yZWYsIHByb3BzOiBhLnByb3BzLCBfb3duZXI6IGEuX293bmVyIH07fWZ1bmN0aW9uIE8oYSkge3JldHVybiAib2JqZWN0IiA9PT0gdHlwZW9mIGEgJiYgbnVsbCAhPT0gYSAmJiBhLiQkdHlwZW9mID09PSBsO31mdW5jdGlvbiBlc2NhcGUoYSkge3ZhciBiID0geyAiPSI6ICI9MCIsICI6IjogIj0yIiB9O3JldHVybiAiJCIgKyBhLnJlcGxhY2UoL1s9Ol0vZywgZnVuY3Rpb24gKGEpIHtyZXR1cm4gYlthXTt9KTt9dmFyIFAgPSAvXC8rL2c7ZnVuY3Rpb24gUShhLCBiKSB7cmV0dXJuICJvYmplY3QiID09PSB0eXBlb2YgYSAmJiBudWxsICE9PSBhICYmIG51bGwgIT0gYS5rZXkgPyBlc2NhcGUoIiIgKyBhLmtleSkgOiBiLnRvU3RyaW5nKDM2KTt9CiAgICAgICAgICBmdW5jdGlvbiBSKGEsIGIsIGUsIGQsIGMpIHt2YXIgayA9IHR5cGVvZiBhO2lmICgidW5kZWZpbmVkIiA9PT0gayB8fCAiYm9vbGVhbiIgPT09IGspIGEgPSBudWxsO3ZhciBoID0gITE7aWYgKG51bGwgPT09IGEpIGggPSAhMDtlbHNlIHN3aXRjaCAoaykge2Nhc2UgInN0cmluZyI6Y2FzZSAibnVtYmVyIjpoID0gITA7YnJlYWs7Y2FzZSAib2JqZWN0Ijpzd2l0Y2ggKGEuJCR0eXBlb2YpIHtjYXNlIGw6Y2FzZSBuOmggPSAhMDt9fWlmIChoKSByZXR1cm4gaCA9IGEsIGMgPSBjKGgpLCBhID0gIiIgPT09IGQgPyAiLiIgKyBRKGgsIDApIDogZCwgSShjKSA/IChlID0gIiIsIG51bGwgIT0gYSAmJiAoZSA9IGEucmVwbGFjZShQLCAiJCYvIikgKyAiLyIpLCBSKGMsIGIsIGUsICIiLCBmdW5jdGlvbiAoYSkge3JldHVybiBhO30pKSA6IG51bGwgIT0gYyAmJiAoTyhjKSAmJiAoYyA9IE4oYywgZSArICghYy5rZXkgfHwgaCAmJiBoLmtleSA9PT0gYy5rZXkgPyAiIiA6ICgiIiArIGMua2V5KS5yZXBsYWNlKFAsICIkJi8iKSArICIvIikgKyBhKSksIGIucHVzaChjKSksIDE7aCA9IDA7ZCA9ICIiID09PSBkID8gIi4iIDogZCArICI6IjtpZiAoSShhKSkgZm9yICh2YXIgZyA9IDA7IGcgPCBhLmxlbmd0aDsgZysrKSB7ayA9CiAgICAgICAgICAgICAgYVtnXTt2YXIgZiA9IGQgKyBRKGssIGcpO2ggKz0gUihrLCBiLCBlLCBmLCBjKTt9IGVsc2UgaWYgKGYgPSBBKGEpLCAiZnVuY3Rpb24iID09PSB0eXBlb2YgZikgZm9yIChhID0gZi5jYWxsKGEpLCBnID0gMDsgIShrID0gYS5uZXh0KCkpLmRvbmU7KSB7ayA9IGsudmFsdWUsIGYgPSBkICsgUShrLCBnKyspLCBoICs9IFIoaywgYiwgZSwgZiwgYyk7fSBlbHNlIGlmICgib2JqZWN0IiA9PT0gaykgdGhyb3cgYiA9IFN0cmluZyhhKSwgRXJyb3IoIk9iamVjdHMgYXJlIG5vdCB2YWxpZCBhcyBhIFJlYWN0IGNoaWxkIChmb3VuZDogIiArICgiW29iamVjdCBPYmplY3RdIiA9PT0gYiA/ICJvYmplY3Qgd2l0aCBrZXlzIHsiICsgT2JqZWN0LmtleXMoYSkuam9pbigiLCAiKSArICJ9IiA6IGIpICsgIikuIElmIHlvdSBtZWFudCB0byByZW5kZXIgYSBjb2xsZWN0aW9uIG9mIGNoaWxkcmVuLCB1c2UgYW4gYXJyYXkgaW5zdGVhZC4iKTtyZXR1cm4gaDt9CiAgICAgICAgICBmdW5jdGlvbiBTKGEsIGIsIGUpIHtpZiAobnVsbCA9PSBhKSByZXR1cm4gYTt2YXIgZCA9IFtdLGMgPSAwO1IoYSwgZCwgIiIsICIiLCBmdW5jdGlvbiAoYSkge3JldHVybiBiLmNhbGwoZSwgYSwgYysrKTt9KTtyZXR1cm4gZDt9ZnVuY3Rpb24gVChhKSB7aWYgKC0xID09PSBhLl9zdGF0dXMpIHt2YXIgYiA9IGEuX3Jlc3VsdDtiID0gYigpO2IudGhlbihmdW5jdGlvbiAoYikge2lmICgwID09PSBhLl9zdGF0dXMgfHwgLTEgPT09IGEuX3N0YXR1cykgYS5fc3RhdHVzID0gMSwgYS5fcmVzdWx0ID0gYjt9LCBmdW5jdGlvbiAoYikge2lmICgwID09PSBhLl9zdGF0dXMgfHwgLTEgPT09IGEuX3N0YXR1cykgYS5fc3RhdHVzID0gMiwgYS5fcmVzdWx0ID0gYjt9KTstMSA9PT0gYS5fc3RhdHVzICYmIChhLl9zdGF0dXMgPSAwLCBhLl9yZXN1bHQgPSBiKTt9aWYgKDEgPT09IGEuX3N0YXR1cykgcmV0dXJuIGEuX3Jlc3VsdC5kZWZhdWx0O3Rocm93IGEuX3Jlc3VsdDt9CiAgICAgICAgICB2YXIgVSA9IHsgY3VycmVudDogbnVsbCB9LFYgPSB7IHRyYW5zaXRpb246IG51bGwgfSxXID0geyBSZWFjdEN1cnJlbnREaXNwYXRjaGVyOiBVLCBSZWFjdEN1cnJlbnRCYXRjaENvbmZpZzogViwgUmVhY3RDdXJyZW50T3duZXI6IEsgfTtleHBvcnRzLkNoaWxkcmVuID0geyBtYXA6IFMsIGZvckVhY2g6IGZ1bmN0aW9uIGZvckVhY2goYSwgYiwgZSkge1MoYSwgZnVuY3Rpb24gKCkge2IuYXBwbHkodGhpcywgYXJndW1lbnRzKTt9LCBlKTt9LCBjb3VudDogZnVuY3Rpb24gY291bnQoYSkge3ZhciBiID0gMDtTKGEsIGZ1bmN0aW9uICgpIHtiKys7fSk7cmV0dXJuIGI7fSwgdG9BcnJheTogZnVuY3Rpb24gdG9BcnJheShhKSB7cmV0dXJuIFMoYSwgZnVuY3Rpb24gKGEpIHtyZXR1cm4gYTt9KSB8fCBbXTt9LCBvbmx5OiBmdW5jdGlvbiBvbmx5KGEpIHtpZiAoIU8oYSkpIHRocm93IEVycm9yKCJSZWFjdC5DaGlsZHJlbi5vbmx5IGV4cGVjdGVkIHRvIHJlY2VpdmUgYSBzaW5nbGUgUmVhY3QgZWxlbWVudCBjaGlsZC4iKTtyZXR1cm4gYTt9IH07ZXhwb3J0cy5Db21wb25lbnQgPSBFO2V4cG9ydHMuRnJhZ21lbnQgPSBwOwogICAgICAgICAgZXhwb3J0cy5Qcm9maWxlciA9IHI7ZXhwb3J0cy5QdXJlQ29tcG9uZW50ID0gRztleHBvcnRzLlN0cmljdE1vZGUgPSBxO2V4cG9ydHMuU3VzcGVuc2UgPSB3O2V4cG9ydHMuX19TRUNSRVRfSU5URVJOQUxTX0RPX05PVF9VU0VfT1JfWU9VX1dJTExfQkVfRklSRUQgPSBXOwogICAgICAgICAgZXhwb3J0cy5jbG9uZUVsZW1lbnQgPSBmdW5jdGlvbiAoYSwgYiwgZSkge2lmIChudWxsID09PSBhIHx8IHZvaWQgMCA9PT0gYSkgdGhyb3cgRXJyb3IoIlJlYWN0LmNsb25lRWxlbWVudCguLi4pOiBUaGUgYXJndW1lbnQgbXVzdCBiZSBhIFJlYWN0IGVsZW1lbnQsIGJ1dCB5b3UgcGFzc2VkICIgKyBhICsgIi4iKTt2YXIgZCA9IEMoe30sIGEucHJvcHMpLGMgPSBhLmtleSxrID0gYS5yZWYsaCA9IGEuX293bmVyO2lmIChudWxsICE9IGIpIHt2b2lkIDAgIT09IGIucmVmICYmIChrID0gYi5yZWYsIGggPSBLLmN1cnJlbnQpO3ZvaWQgMCAhPT0gYi5rZXkgJiYgKGMgPSAiIiArIGIua2V5KTtpZiAoYS50eXBlICYmIGEudHlwZS5kZWZhdWx0UHJvcHMpIHZhciBnID0gYS50eXBlLmRlZmF1bHRQcm9wcztmb3IgKGYgaW4gYikge0ouY2FsbChiLCBmKSAmJiAhTC5oYXNPd25Qcm9wZXJ0eShmKSAmJiAoZFtmXSA9IHZvaWQgMCA9PT0gYltmXSAmJiB2b2lkIDAgIT09IGcgPyBnW2ZdIDogYltmXSk7fX12YXIgZiA9IGFyZ3VtZW50cy5sZW5ndGggLSAyO2lmICgxID09PSBmKSBkLmNoaWxkcmVuID0gZTtlbHNlIGlmICgxIDwgZikge2cgPSBBcnJheShmKTsKICAgICAgICAgICAgICBmb3IgKHZhciBtID0gMDsgbSA8IGY7IG0rKykge2dbbV0gPSBhcmd1bWVudHNbbSArIDJdO31kLmNoaWxkcmVuID0gZzt9cmV0dXJuIHsgJCR0eXBlb2Y6IGwsIHR5cGU6IGEudHlwZSwga2V5OiBjLCByZWY6IGssIHByb3BzOiBkLCBfb3duZXI6IGggfTt9O2V4cG9ydHMuY3JlYXRlQ29udGV4dCA9IGZ1bmN0aW9uIChhKSB7YSA9IHsgJCR0eXBlb2Y6IHUsIF9jdXJyZW50VmFsdWU6IGEsIF9jdXJyZW50VmFsdWUyOiBhLCBfdGhyZWFkQ291bnQ6IDAsIFByb3ZpZGVyOiBudWxsLCBDb25zdW1lcjogbnVsbCwgX2RlZmF1bHRWYWx1ZTogbnVsbCwgX2dsb2JhbE5hbWU6IG51bGwgfTthLlByb3ZpZGVyID0geyAkJHR5cGVvZjogdCwgX2NvbnRleHQ6IGEgfTtyZXR1cm4gYS5Db25zdW1lciA9IGE7fTtleHBvcnRzLmNyZWF0ZUVsZW1lbnQgPSBNO2V4cG9ydHMuY3JlYXRlRmFjdG9yeSA9IGZ1bmN0aW9uIChhKSB7dmFyIGIgPSBNLmJpbmQobnVsbCwgYSk7Yi50eXBlID0gYTtyZXR1cm4gYjt9O2V4cG9ydHMuY3JlYXRlUmVmID0gZnVuY3Rpb24gKCkge3JldHVybiB7IGN1cnJlbnQ6IG51bGwgfTt9OwogICAgICAgICAgZXhwb3J0cy5mb3J3YXJkUmVmID0gZnVuY3Rpb24gKGEpIHtyZXR1cm4geyAkJHR5cGVvZjogdiwgcmVuZGVyOiBhIH07fTtleHBvcnRzLmlzVmFsaWRFbGVtZW50ID0gTztleHBvcnRzLmxhenkgPSBmdW5jdGlvbiAoYSkge3JldHVybiB7ICQkdHlwZW9mOiB5LCBfcGF5bG9hZDogeyBfc3RhdHVzOiAtMSwgX3Jlc3VsdDogYSB9LCBfaW5pdDogVCB9O307ZXhwb3J0cy5tZW1vID0gZnVuY3Rpb24gKGEsIGIpIHtyZXR1cm4geyAkJHR5cGVvZjogeCwgdHlwZTogYSwgY29tcGFyZTogdm9pZCAwID09PSBiID8gbnVsbCA6IGIgfTt9O2V4cG9ydHMuc3RhcnRUcmFuc2l0aW9uID0gZnVuY3Rpb24gKGEpIHt2YXIgYiA9IFYudHJhbnNpdGlvbjtWLnRyYW5zaXRpb24gPSB7fTt0cnkge2EoKTt9IGZpbmFsbHkge1YudHJhbnNpdGlvbiA9IGI7fX07ZXhwb3J0cy51bnN0YWJsZV9hY3QgPSBmdW5jdGlvbiAoKSB7dGhyb3cgRXJyb3IoImFjdCguLi4pIGlzIG5vdCBzdXBwb3J0ZWQgaW4gcHJvZHVjdGlvbiBidWlsZHMgb2YgUmVhY3QuIik7fTsKICAgICAgICAgIGV4cG9ydHMudXNlQ2FsbGJhY2sgPSBmdW5jdGlvbiAoYSwgYikge3JldHVybiBVLmN1cnJlbnQudXNlQ2FsbGJhY2soYSwgYik7fTtleHBvcnRzLnVzZUNvbnRleHQgPSBmdW5jdGlvbiAoYSkge3JldHVybiBVLmN1cnJlbnQudXNlQ29udGV4dChhKTt9O2V4cG9ydHMudXNlRGVidWdWYWx1ZSA9IGZ1bmN0aW9uICgpIHt9O2V4cG9ydHMudXNlRGVmZXJyZWRWYWx1ZSA9IGZ1bmN0aW9uIChhKSB7cmV0dXJuIFUuY3VycmVudC51c2VEZWZlcnJlZFZhbHVlKGEpO307ZXhwb3J0cy51c2VFZmZlY3QgPSBmdW5jdGlvbiAoYSwgYikge3JldHVybiBVLmN1cnJlbnQudXNlRWZmZWN0KGEsIGIpO307ZXhwb3J0cy51c2VJZCA9IGZ1bmN0aW9uICgpIHtyZXR1cm4gVS5jdXJyZW50LnVzZUlkKCk7fTtleHBvcnRzLnVzZUltcGVyYXRpdmVIYW5kbGUgPSBmdW5jdGlvbiAoYSwgYiwgZSkge3JldHVybiBVLmN1cnJlbnQudXNlSW1wZXJhdGl2ZUhhbmRsZShhLCBiLCBlKTt9OwogICAgICAgICAgZXhwb3J0cy51c2VJbnNlcnRpb25FZmZlY3QgPSBmdW5jdGlvbiAoYSwgYikge3JldHVybiBVLmN1cnJlbnQudXNlSW5zZXJ0aW9uRWZmZWN0KGEsIGIpO307ZXhwb3J0cy51c2VMYXlvdXRFZmZlY3QgPSBmdW5jdGlvbiAoYSwgYikge3JldHVybiBVLmN1cnJlbnQudXNlTGF5b3V0RWZmZWN0KGEsIGIpO307ZXhwb3J0cy51c2VNZW1vID0gZnVuY3Rpb24gKGEsIGIpIHtyZXR1cm4gVS5jdXJyZW50LnVzZU1lbW8oYSwgYik7fTtleHBvcnRzLnVzZVJlZHVjZXIgPSBmdW5jdGlvbiAoYSwgYiwgZSkge3JldHVybiBVLmN1cnJlbnQudXNlUmVkdWNlcihhLCBiLCBlKTt9O2V4cG9ydHMudXNlUmVmID0gZnVuY3Rpb24gKGEpIHtyZXR1cm4gVS5jdXJyZW50LnVzZVJlZihhKTt9O2V4cG9ydHMudXNlU3RhdGUgPSBmdW5jdGlvbiAoYSkge3JldHVybiBVLmN1cnJlbnQudXNlU3RhdGUoYSk7fTtleHBvcnRzLnVzZVN5bmNFeHRlcm5hbFN0b3JlID0gZnVuY3Rpb24gKGEsIGIsIGUpIHtyZXR1cm4gVS5jdXJyZW50LnVzZVN5bmNFeHRlcm5hbFN0b3JlKGEsIGIsIGUpO307CiAgICAgICAgICBleHBvcnRzLnVzZVRyYW5zaXRpb24gPSBmdW5jdGlvbiAoKSB7cmV0dXJuIFUuY3VycmVudC51c2VUcmFuc2l0aW9uKCk7fTtleHBvcnRzLnZlcnNpb24gPSAiMTguMi4wIjsKCgogICAgICAgICAgLyoqKi99LAoKICAgICAgICAvKioqLzI5NDoKICAgICAgICAvKioqLyhtb2R1bGUsIF9fdW51c2VkX3dlYnBhY2tfZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgPT4gewoKCgogICAgICAgICAgaWYgKHRydWUpIHsKICAgICAgICAgICAgbW9kdWxlLmV4cG9ydHMgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDQwOCk7CiAgICAgICAgICB9IGVsc2Uge30KCgogICAgICAgICAgLyoqKi99LAoKICAgICAgICAvKioqLzUzOgogICAgICAgIC8qKiovKF9fdW51c2VkX3dlYnBhY2tfbW9kdWxlLCBleHBvcnRzKSA9PiB7CgogICAgICAgICAgLyoqCiAgICAgICAgICAgKiBAbGljZW5zZSBSZWFjdAogICAgICAgICAgICogc2NoZWR1bGVyLnByb2R1Y3Rpb24ubWluLmpzCiAgICAgICAgICAgKgogICAgICAgICAgICogQ29weXJpZ2h0IChjKSBGYWNlYm9vaywgSW5jLiBhbmQgaXRzIGFmZmlsaWF0ZXMuCiAgICAgICAgICAgKgogICAgICAgICAgICogVGhpcyBzb3VyY2UgY29kZSBpcyBsaWNlbnNlZCB1bmRlciB0aGUgTUlUIGxpY2Vuc2UgZm91bmQgaW4gdGhlCiAgICAgICAgICAgKiBMSUNFTlNFIGZpbGUgaW4gdGhlIHJvb3QgZGlyZWN0b3J5IG9mIHRoaXMgc291cmNlIHRyZWUuCiAgICAgICAgICAgKi8KICAgICAgICAgIGZ1bmN0aW9uIGYoYSwgYikge3ZhciBjID0gYS5sZW5ndGg7YS5wdXNoKGIpO2E6IGZvciAoOyAwIDwgYzspIHt2YXIgZCA9IGMgLSAxID4+PiAxLGUgPSBhW2RdO2lmICgwIDwgZyhlLCBiKSkgYVtkXSA9IGIsIGFbY10gPSBlLCBjID0gZDtlbHNlIGJyZWFrIGE7fX1mdW5jdGlvbiBoKGEpIHtyZXR1cm4gMCA9PT0gYS5sZW5ndGggPyBudWxsIDogYVswXTt9ZnVuY3Rpb24gayhhKSB7aWYgKDAgPT09IGEubGVuZ3RoKSByZXR1cm4gbnVsbDt2YXIgYiA9IGFbMF0sYyA9IGEucG9wKCk7aWYgKGMgIT09IGIpIHthWzBdID0gYzthOiBmb3IgKHZhciBkID0gMCwgZSA9IGEubGVuZ3RoLCB3ID0gZSA+Pj4gMTsgZCA8IHc7KSB7dmFyIG0gPSAyICogKGQgKyAxKSAtIDEsQyA9IGFbbV0sbiA9IG0gKyAxLHggPSBhW25dO2lmICgwID4gZyhDLCBjKSkgbiA8IGUgJiYgMCA+IGcoeCwgQykgPyAoYVtkXSA9IHgsIGFbbl0gPSBjLCBkID0gbikgOiAoYVtkXSA9IEMsIGFbbV0gPSBjLCBkID0gbSk7ZWxzZSBpZiAobiA8IGUgJiYgMCA+IGcoeCwgYykpIGFbZF0gPSB4LCBhW25dID0gYywgZCA9IG47ZWxzZSBicmVhayBhO319cmV0dXJuIGI7fQogICAgICAgICAgZnVuY3Rpb24gZyhhLCBiKSB7dmFyIGMgPSBhLnNvcnRJbmRleCAtIGIuc29ydEluZGV4O3JldHVybiAwICE9PSBjID8gYyA6IGEuaWQgLSBiLmlkO31pZiAoIm9iamVjdCIgPT09IHR5cGVvZiBwZXJmb3JtYW5jZSAmJiAiZnVuY3Rpb24iID09PSB0eXBlb2YgcGVyZm9ybWFuY2Uubm93KSB7dmFyIGwgPSBwZXJmb3JtYW5jZTtleHBvcnRzLnVuc3RhYmxlX25vdyA9IGZ1bmN0aW9uICgpIHtyZXR1cm4gbC5ub3coKTt9O30gZWxzZSB7dmFyIHAgPSBEYXRlLHEgPSBwLm5vdygpO2V4cG9ydHMudW5zdGFibGVfbm93ID0gZnVuY3Rpb24gKCkge3JldHVybiBwLm5vdygpIC0gcTt9O312YXIgciA9IFtdLHQgPSBbXSx1ID0gMSx2ID0gbnVsbCx5ID0gMyx6ID0gITEsQSA9ICExLEIgPSAhMSxEID0gImZ1bmN0aW9uIiA9PT0gdHlwZW9mIHNldFRpbWVvdXQgPyBzZXRUaW1lb3V0IDogbnVsbCxFID0gImZ1bmN0aW9uIiA9PT0gdHlwZW9mIGNsZWFyVGltZW91dCA/IGNsZWFyVGltZW91dCA6IG51bGwsRiA9ICJ1bmRlZmluZWQiICE9PSB0eXBlb2Ygc2V0SW1tZWRpYXRlID8gc2V0SW1tZWRpYXRlIDogbnVsbDsKICAgICAgICAgICJ1bmRlZmluZWQiICE9PSB0eXBlb2YgbmF2aWdhdG9yICYmIHZvaWQgMCAhPT0gbmF2aWdhdG9yLnNjaGVkdWxpbmcgJiYgdm9pZCAwICE9PSBuYXZpZ2F0b3Iuc2NoZWR1bGluZy5pc0lucHV0UGVuZGluZyAmJiBuYXZpZ2F0b3Iuc2NoZWR1bGluZy5pc0lucHV0UGVuZGluZy5iaW5kKG5hdmlnYXRvci5zY2hlZHVsaW5nKTtmdW5jdGlvbiBHKGEpIHtmb3IgKHZhciBiID0gaCh0KTsgbnVsbCAhPT0gYjspIHtpZiAobnVsbCA9PT0gYi5jYWxsYmFjaykgayh0KTtlbHNlIGlmIChiLnN0YXJ0VGltZSA8PSBhKSBrKHQpLCBiLnNvcnRJbmRleCA9IGIuZXhwaXJhdGlvblRpbWUsIGYociwgYik7ZWxzZSBicmVhaztiID0gaCh0KTt9fWZ1bmN0aW9uIEgoYSkge0IgPSAhMTtHKGEpO2lmICghQSkgaWYgKG51bGwgIT09IGgocikpIEEgPSAhMCwgSShKKTtlbHNlIHt2YXIgYiA9IGgodCk7bnVsbCAhPT0gYiAmJiBLKEgsIGIuc3RhcnRUaW1lIC0gYSk7fX0KICAgICAgICAgIGZ1bmN0aW9uIEooYSwgYikge0EgPSAhMTtCICYmIChCID0gITEsIEUoTCksIEwgPSAtMSk7eiA9ICEwO3ZhciBjID0geTt0cnkge0coYik7Zm9yICh2ID0gaChyKTsgbnVsbCAhPT0gdiAmJiAoISh2LmV4cGlyYXRpb25UaW1lID4gYikgfHwgYSAmJiAhTSgpKTspIHt2YXIgZCA9IHYuY2FsbGJhY2s7aWYgKCJmdW5jdGlvbiIgPT09IHR5cGVvZiBkKSB7di5jYWxsYmFjayA9IG51bGw7eSA9IHYucHJpb3JpdHlMZXZlbDt2YXIgZSA9IGQodi5leHBpcmF0aW9uVGltZSA8PSBiKTtiID0gZXhwb3J0cy51bnN0YWJsZV9ub3coKTsiZnVuY3Rpb24iID09PSB0eXBlb2YgZSA/IHYuY2FsbGJhY2sgPSBlIDogdiA9PT0gaChyKSAmJiBrKHIpO0coYik7fSBlbHNlIGsocik7diA9IGgocik7fWlmIChudWxsICE9PSB2KSB2YXIgdyA9ICEwO2Vsc2Uge3ZhciBtID0gaCh0KTtudWxsICE9PSBtICYmIEsoSCwgbS5zdGFydFRpbWUgLSBiKTt3ID0gITE7fXJldHVybiB3O30gZmluYWxseSB7diA9IG51bGwsIHkgPSBjLCB6ID0gITE7fX12YXIgTiA9ICExLE8gPSBudWxsLEwgPSAtMSxQID0gNSxRID0gLTE7CiAgICAgICAgICBmdW5jdGlvbiBNKCkge3JldHVybiBleHBvcnRzLnVuc3RhYmxlX25vdygpIC0gUSA8IFAgPyAhMSA6ICEwO31mdW5jdGlvbiBSKCkge2lmIChudWxsICE9PSBPKSB7dmFyIGEgPSBleHBvcnRzLnVuc3RhYmxlX25vdygpO1EgPSBhO3ZhciBiID0gITA7dHJ5IHtiID0gTyghMCwgYSk7fSBmaW5hbGx5IHtiID8gUygpIDogKE4gPSAhMSwgTyA9IG51bGwpO319IGVsc2UgTiA9ICExO312YXIgUztpZiAoImZ1bmN0aW9uIiA9PT0gdHlwZW9mIEYpIFMgPSBmdW5jdGlvbiBTKCkge0YoUik7fTtlbHNlIGlmICgidW5kZWZpbmVkIiAhPT0gdHlwZW9mIE1lc3NhZ2VDaGFubmVsKSB7dmFyIFQgPSBuZXcgTWVzc2FnZUNoYW5uZWwoKSxVID0gVC5wb3J0MjtULnBvcnQxLm9ubWVzc2FnZSA9IFI7UyA9IGZ1bmN0aW9uIFMoKSB7VS5wb3N0TWVzc2FnZShudWxsKTt9O30gZWxzZSBTID0gZnVuY3Rpb24gUygpIHtEKFIsIDApO307ZnVuY3Rpb24gSShhKSB7TyA9IGE7TiB8fCAoTiA9ICEwLCBTKCkpO31mdW5jdGlvbiBLKGEsIGIpIHtMID0gRChmdW5jdGlvbiAoKSB7YShleHBvcnRzLnVuc3RhYmxlX25vdygpKTt9LCBiKTt9CiAgICAgICAgICBleHBvcnRzLnVuc3RhYmxlX0lkbGVQcmlvcml0eSA9IDU7ZXhwb3J0cy51bnN0YWJsZV9JbW1lZGlhdGVQcmlvcml0eSA9IDE7ZXhwb3J0cy51bnN0YWJsZV9Mb3dQcmlvcml0eSA9IDQ7ZXhwb3J0cy51bnN0YWJsZV9Ob3JtYWxQcmlvcml0eSA9IDM7ZXhwb3J0cy51bnN0YWJsZV9Qcm9maWxpbmcgPSBudWxsO2V4cG9ydHMudW5zdGFibGVfVXNlckJsb2NraW5nUHJpb3JpdHkgPSAyO2V4cG9ydHMudW5zdGFibGVfY2FuY2VsQ2FsbGJhY2sgPSBmdW5jdGlvbiAoYSkge2EuY2FsbGJhY2sgPSBudWxsO307ZXhwb3J0cy51bnN0YWJsZV9jb250aW51ZUV4ZWN1dGlvbiA9IGZ1bmN0aW9uICgpIHtBIHx8IHogfHwgKEEgPSAhMCwgSShKKSk7fTsKICAgICAgICAgIGV4cG9ydHMudW5zdGFibGVfZm9yY2VGcmFtZVJhdGUgPSBmdW5jdGlvbiAoYSkgezAgPiBhIHx8IDEyNSA8IGEgPyBjb25zb2xlLmVycm9yKCJmb3JjZUZyYW1lUmF0ZSB0YWtlcyBhIHBvc2l0aXZlIGludCBiZXR3ZWVuIDAgYW5kIDEyNSwgZm9yY2luZyBmcmFtZSByYXRlcyBoaWdoZXIgdGhhbiAxMjUgZnBzIGlzIG5vdCBzdXBwb3J0ZWQiKSA6IFAgPSAwIDwgYSA/IE1hdGguZmxvb3IoMUUzIC8gYSkgOiA1O307ZXhwb3J0cy51bnN0YWJsZV9nZXRDdXJyZW50UHJpb3JpdHlMZXZlbCA9IGZ1bmN0aW9uICgpIHtyZXR1cm4geTt9O2V4cG9ydHMudW5zdGFibGVfZ2V0Rmlyc3RDYWxsYmFja05vZGUgPSBmdW5jdGlvbiAoKSB7cmV0dXJuIGgocik7fTtleHBvcnRzLnVuc3RhYmxlX25leHQgPSBmdW5jdGlvbiAoYSkge3N3aXRjaCAoeSkge2Nhc2UgMTpjYXNlIDI6Y2FzZSAzOnZhciBiID0gMzticmVhaztkZWZhdWx0OmIgPSB5O312YXIgYyA9IHk7eSA9IGI7dHJ5IHtyZXR1cm4gYSgpO30gZmluYWxseSB7eSA9IGM7fX07ZXhwb3J0cy51bnN0YWJsZV9wYXVzZUV4ZWN1dGlvbiA9IGZ1bmN0aW9uICgpIHt9OwogICAgICAgICAgZXhwb3J0cy51bnN0YWJsZV9yZXF1ZXN0UGFpbnQgPSBmdW5jdGlvbiAoKSB7fTtleHBvcnRzLnVuc3RhYmxlX3J1bldpdGhQcmlvcml0eSA9IGZ1bmN0aW9uIChhLCBiKSB7c3dpdGNoIChhKSB7Y2FzZSAxOmNhc2UgMjpjYXNlIDM6Y2FzZSA0OmNhc2UgNTpicmVhaztkZWZhdWx0OmEgPSAzO312YXIgYyA9IHk7eSA9IGE7dHJ5IHtyZXR1cm4gYigpO30gZmluYWxseSB7eSA9IGM7fX07CiAgICAgICAgICBleHBvcnRzLnVuc3RhYmxlX3NjaGVkdWxlQ2FsbGJhY2sgPSBmdW5jdGlvbiAoYSwgYiwgYykge3ZhciBkID0gZXhwb3J0cy51bnN0YWJsZV9ub3coKTsib2JqZWN0IiA9PT0gdHlwZW9mIGMgJiYgbnVsbCAhPT0gYyA/IChjID0gYy5kZWxheSwgYyA9ICJudW1iZXIiID09PSB0eXBlb2YgYyAmJiAwIDwgYyA/IGQgKyBjIDogZCkgOiBjID0gZDtzd2l0Y2ggKGEpIHtjYXNlIDE6dmFyIGUgPSAtMTticmVhaztjYXNlIDI6ZSA9IDI1MDticmVhaztjYXNlIDU6ZSA9IDEwNzM3NDE4MjM7YnJlYWs7Y2FzZSA0OmUgPSAxRTQ7YnJlYWs7ZGVmYXVsdDplID0gNUUzO31lID0gYyArIGU7YSA9IHsgaWQ6IHUrKywgY2FsbGJhY2s6IGIsIHByaW9yaXR5TGV2ZWw6IGEsIHN0YXJ0VGltZTogYywgZXhwaXJhdGlvblRpbWU6IGUsIHNvcnRJbmRleDogLTEgfTtjID4gZCA/IChhLnNvcnRJbmRleCA9IGMsIGYodCwgYSksIG51bGwgPT09IGgocikgJiYgYSA9PT0gaCh0KSAmJiAoQiA/IChFKEwpLCBMID0gLTEpIDogQiA9ICEwLCBLKEgsIGMgLSBkKSkpIDogKGEuc29ydEluZGV4ID0gZSwgZihyLCBhKSwgQSB8fCB6IHx8IChBID0gITAsIEkoSikpKTtyZXR1cm4gYTt9OwogICAgICAgICAgZXhwb3J0cy51bnN0YWJsZV9zaG91bGRZaWVsZCA9IE07ZXhwb3J0cy51bnN0YWJsZV93cmFwQ2FsbGJhY2sgPSBmdW5jdGlvbiAoYSkge3ZhciBiID0geTtyZXR1cm4gZnVuY3Rpb24gKCkge3ZhciBjID0geTt5ID0gYjt0cnkge3JldHVybiBhLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7fSBmaW5hbGx5IHt5ID0gYzt9fTt9OwoKCiAgICAgICAgICAvKioqL30sCgogICAgICAgIC8qKiovODQwOgogICAgICAgIC8qKiovKG1vZHVsZSwgX191bnVzZWRfd2VicGFja19leHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSA9PiB7CgoKCiAgICAgICAgICBpZiAodHJ1ZSkgewogICAgICAgICAgICBtb2R1bGUuZXhwb3J0cyA9IF9fd2VicGFja19yZXF1aXJlX18oNTMpOwogICAgICAgICAgfSBlbHNlIHt9CgoKICAgICAgICAgIC8qKiovfQoKICAgICAgICAvKioqKioqLyB9OwogICAgICAvKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqLwogICAgICAvKioqKioqLyAvLyBUaGUgbW9kdWxlIGNhY2hlCiAgICAgIC8qKioqKiovdmFyIF9fd2VicGFja19tb2R1bGVfY2FjaGVfXyA9IHt9OwogICAgICAvKioqKioqLwogICAgICAvKioqKioqLyAvLyBUaGUgcmVxdWlyZSBmdW5jdGlvbgogICAgICAvKioqKioqL2Z1bmN0aW9uIF9fd2VicGFja19yZXF1aXJlX18obW9kdWxlSWQpIHsKICAgICAgICAvKioqKioqLyAvLyBDaGVjayBpZiBtb2R1bGUgaXMgaW4gY2FjaGUKICAgICAgICAvKioqKioqL3ZhciBjYWNoZWRNb2R1bGUgPSBfX3dlYnBhY2tfbW9kdWxlX2NhY2hlX19bbW9kdWxlSWRdOwogICAgICAgIC8qKioqKiovaWYgKGNhY2hlZE1vZHVsZSAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAvKioqKioqL3JldHVybiBjYWNoZWRNb2R1bGUuZXhwb3J0czsKICAgICAgICAgIC8qKioqKiovfQogICAgICAgIC8qKioqKiovIC8vIENyZWF0ZSBhIG5ldyBtb2R1bGUgKGFuZCBwdXQgaXQgaW50byB0aGUgY2FjaGUpCiAgICAgICAgLyoqKioqKi92YXIgbW9kdWxlID0gX193ZWJwYWNrX21vZHVsZV9jYWNoZV9fW21vZHVsZUlkXSA9IHsKICAgICAgICAgIC8qKioqKiovIC8vIG5vIG1vZHVsZS5pZCBuZWVkZWQKICAgICAgICAgIC8qKioqKiovIC8vIG5vIG1vZHVsZS5sb2FkZWQgbmVlZGVkCiAgICAgICAgICAvKioqKioqL2V4cG9ydHM6IHt9CiAgICAgICAgICAvKioqKioqLyB9OwogICAgICAgIC8qKioqKiovCiAgICAgICAgLyoqKioqKi8gLy8gRXhlY3V0ZSB0aGUgbW9kdWxlIGZ1bmN0aW9uCiAgICAgICAgLyoqKioqKi9fX3dlYnBhY2tfbW9kdWxlc19fW21vZHVsZUlkXShtb2R1bGUsIG1vZHVsZS5leHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKTsKICAgICAgICAvKioqKioqLwogICAgICAgIC8qKioqKiovIC8vIFJldHVybiB0aGUgZXhwb3J0cyBvZiB0aGUgbW9kdWxlCiAgICAgICAgLyoqKioqKi9yZXR1cm4gbW9kdWxlLmV4cG9ydHM7CiAgICAgICAgLyoqKioqKi99CiAgICAgIC8qKioqKiovCiAgICAgIC8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovCiAgICAgIC8qKioqKiovIC8qIHdlYnBhY2svcnVudGltZS9jcmVhdGUgZmFrZSBuYW1lc3BhY2Ugb2JqZWN0ICovCiAgICAgIC8qKioqKiovKCgpID0+IHsKICAgICAgICAvKioqKioqL3ZhciBnZXRQcm90byA9IE9iamVjdC5nZXRQcm90b3R5cGVPZiA/IChvYmopID0+IE9iamVjdC5nZXRQcm90b3R5cGVPZihvYmopIDogKG9iaikgPT4gb2JqLl9fcHJvdG9fXzsKICAgICAgICAvKioqKioqL3ZhciBsZWFmUHJvdG90eXBlczsKICAgICAgICAvKioqKioqLyAvLyBjcmVhdGUgYSBmYWtlIG5hbWVzcGFjZSBvYmplY3QKICAgICAgICAvKioqKioqLyAvLyBtb2RlICYgMTogdmFsdWUgaXMgYSBtb2R1bGUgaWQsIHJlcXVpcmUgaXQKICAgICAgICAvKioqKioqLyAvLyBtb2RlICYgMjogbWVyZ2UgYWxsIHByb3BlcnRpZXMgb2YgdmFsdWUgaW50byB0aGUgbnMKICAgICAgICAvKioqKioqLyAvLyBtb2RlICYgNDogcmV0dXJuIHZhbHVlIHdoZW4gYWxyZWFkeSBucyBvYmplY3QKICAgICAgICAvKioqKioqLyAvLyBtb2RlICYgMTY6IHJldHVybiB2YWx1ZSB3aGVuIGl0J3MgUHJvbWlzZS1saWtlCiAgICAgICAgLyoqKioqKi8gLy8gbW9kZSAmIDh8MTogYmVoYXZlIGxpa2UgcmVxdWlyZQogICAgICAgIC8qKioqKiovX193ZWJwYWNrX3JlcXVpcmVfXy50ID0gZnVuY3Rpb24gKHZhbHVlLCBtb2RlKSB7CiAgICAgICAgICAvKioqKioqL2lmIChtb2RlICYgMSkgdmFsdWUgPSB0aGlzKHZhbHVlKTsKICAgICAgICAgIC8qKioqKiovaWYgKG1vZGUgJiA4KSByZXR1cm4gdmFsdWU7CiAgICAgICAgICAvKioqKioqL2lmICh0eXBlb2YgdmFsdWUgPT09ICdvYmplY3QnICYmIHZhbHVlKSB7CiAgICAgICAgICAgIC8qKioqKiovaWYgKG1vZGUgJiA0ICYmIHZhbHVlLl9fZXNNb2R1bGUpIHJldHVybiB2YWx1ZTsKICAgICAgICAgICAgLyoqKioqKi9pZiAobW9kZSAmIDE2ICYmIHR5cGVvZiB2YWx1ZS50aGVuID09PSAnZnVuY3Rpb24nKSByZXR1cm4gdmFsdWU7CiAgICAgICAgICAgIC8qKioqKiovfQogICAgICAgICAgLyoqKioqKi92YXIgbnMgPSBPYmplY3QuY3JlYXRlKG51bGwpOwogICAgICAgICAgLyoqKioqKi9fX3dlYnBhY2tfcmVxdWlyZV9fLnIobnMpOwogICAgICAgICAgLyoqKioqKi92YXIgZGVmID0ge307CiAgICAgICAgICAvKioqKioqL2xlYWZQcm90b3R5cGVzID0gbGVhZlByb3RvdHlwZXMgfHwgW251bGwsIGdldFByb3RvKHt9KSwgZ2V0UHJvdG8oW10pLCBnZXRQcm90byhnZXRQcm90byldOwogICAgICAgICAgLyoqKioqKi9mb3IgKHZhciBjdXJyZW50ID0gbW9kZSAmIDIgJiYgdmFsdWU7IHR5cGVvZiBjdXJyZW50ID09ICdvYmplY3QnICYmICF+bGVhZlByb3RvdHlwZXMuaW5kZXhPZihjdXJyZW50KTsgY3VycmVudCA9IGdldFByb3RvKGN1cnJlbnQpKSB7CiAgICAgICAgICAgIC8qKioqKiovT2JqZWN0LmdldE93blByb3BlcnR5TmFtZXMoY3VycmVudCkuZm9yRWFjaCgoa2V5KSA9PiBkZWZba2V5XSA9ICgpID0+IHZhbHVlW2tleV0pOwogICAgICAgICAgICAvKioqKioqL30KICAgICAgICAgIC8qKioqKiovZGVmWydkZWZhdWx0J10gPSAoKSA9PiB2YWx1ZTsKICAgICAgICAgIC8qKioqKiovX193ZWJwYWNrX3JlcXVpcmVfXy5kKG5zLCBkZWYpOwogICAgICAgICAgLyoqKioqKi9yZXR1cm4gbnM7CiAgICAgICAgICAvKioqKioqL307CiAgICAgICAgLyoqKioqKi99KSgpOwogICAgICAvKioqKioqLwogICAgICAvKioqKioqLyAvKiB3ZWJwYWNrL3J1bnRpbWUvZGVmaW5lIHByb3BlcnR5IGdldHRlcnMgKi8KICAgICAgLyoqKioqKi8oKCkgPT4gewogICAgICAgIC8qKioqKiovIC8vIGRlZmluZSBnZXR0ZXIgZnVuY3Rpb25zIGZvciBoYXJtb255IGV4cG9ydHMKICAgICAgICAvKioqKioqL19fd2VicGFja19yZXF1aXJlX18uZCA9IChleHBvcnRzLCBkZWZpbml0aW9uKSA9PiB7CiAgICAgICAgICAvKioqKioqL2ZvciAodmFyIGtleSBpbiBkZWZpbml0aW9uKSB7CiAgICAgICAgICAgIC8qKioqKiovaWYgKF9fd2VicGFja19yZXF1aXJlX18ubyhkZWZpbml0aW9uLCBrZXkpICYmICFfX3dlYnBhY2tfcmVxdWlyZV9fLm8oZXhwb3J0cywga2V5KSkgewogICAgICAgICAgICAgIC8qKioqKiovT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIGtleSwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGRlZmluaXRpb25ba2V5XSB9KTsKICAgICAgICAgICAgICAvKioqKioqL30KICAgICAgICAgICAgLyoqKioqKi99CiAgICAgICAgICAvKioqKioqL307CiAgICAgICAgLyoqKioqKi99KSgpOwogICAgICAvKioqKioqLwogICAgICAvKioqKioqLyAvKiB3ZWJwYWNrL3J1bnRpbWUvaGFzT3duUHJvcGVydHkgc2hvcnRoYW5kICovCiAgICAgIC8qKioqKiovKCgpID0+IHsKICAgICAgICAvKioqKioqL19fd2VicGFja19yZXF1aXJlX18ubyA9IChvYmosIHByb3ApID0+IE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChvYmosIHByb3ApOwogICAgICAgIC8qKioqKiovfSkoKTsKICAgICAgLyoqKioqKi8KICAgICAgLyoqKioqKi8gLyogd2VicGFjay9ydW50aW1lL21ha2UgbmFtZXNwYWNlIG9iamVjdCAqLwogICAgICAvKioqKioqLygoKSA9PiB7CiAgICAgICAgLyoqKioqKi8gLy8gZGVmaW5lIF9fZXNNb2R1bGUgb24gZXhwb3J0cwogICAgICAgIC8qKioqKiovX193ZWJwYWNrX3JlcXVpcmVfXy5yID0gKGV4cG9ydHMpID0+IHsKICAgICAgICAgIC8qKioqKiovaWYgKHR5cGVvZiBTeW1ib2wgIT09ICd1bmRlZmluZWQnICYmIFN5bWJvbC50b1N0cmluZ1RhZykgewogICAgICAgICAgICAvKioqKioqL09iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBTeW1ib2wudG9TdHJpbmdUYWcsIHsgdmFsdWU6ICdNb2R1bGUnIH0pOwogICAgICAgICAgICAvKioqKioqL30KICAgICAgICAgIC8qKioqKiovT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICdfX2VzTW9kdWxlJywgeyB2YWx1ZTogdHJ1ZSB9KTsKICAgICAgICAgIC8qKioqKiovfTsKICAgICAgICAvKioqKioqL30pKCk7CiAgICAgIC8qKioqKiovCiAgICAgIC8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovCiAgICAgIHZhciBfX3dlYnBhY2tfZXhwb3J0c19fID0ge307CiAgICAgIC8vIFRoaXMgZW50cnkgbmVlZCB0byBiZSB3cmFwcGVkIGluIGFuIElJRkUgYmVjYXVzZSBpdCBuZWVkIHRvIGJlIGlzb2xhdGVkIGFnYWluc3Qgb3RoZXIgbW9kdWxlcyBpbiB0aGUgY2h1bmsuCiAgICAgICgoKSA9PiB7CiAgICAgICAgX193ZWJwYWNrX3JlcXVpcmVfXy5yKF9fd2VicGFja19leHBvcnRzX18pOwogICAgICAgIC8qIGhhcm1vbnkgaW1wb3J0ICovdmFyIF9BcHBfX1dFQlBBQ0tfSU1QT1JURURfTU9EVUxFXzBfXyA9IF9fd2VicGFja19yZXF1aXJlX18oMjQyKTsKICAgICAgICAvKiBoYXJtb255IGltcG9ydCAqL3ZhciByZWFjdF9kb21fY2xpZW50X19XRUJQQUNLX0lNUE9SVEVEX01PRFVMRV8xX18gPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDc0NSk7CiAgICAgICAgLyogaGFybW9ueSBpbXBvcnQgKi92YXIgcmVhY3RfX1dFQlBBQ0tfSU1QT1JURURfTU9EVUxFXzJfXyA9IF9fd2VicGFja19yZXF1aXJlX18oMjk0KTsKICAgICAgICBmdW5jdGlvbiBfY3JlYXRlRm9yT2ZJdGVyYXRvckhlbHBlcihvLCBhbGxvd0FycmF5TGlrZSkge3ZhciBpdCA9IHR5cGVvZiBTeW1ib2wgIT09ICJ1bmRlZmluZWQiICYmIG9bU3ltYm9sLml0ZXJhdG9yXSB8fCBvWyJAQGl0ZXJhdG9yIl07aWYgKCFpdCkge2lmIChBcnJheS5pc0FycmF5KG8pIHx8IChpdCA9IF91bnN1cHBvcnRlZEl0ZXJhYmxlVG9BcnJheShvKSkgfHwgYWxsb3dBcnJheUxpa2UgJiYgbyAmJiB0eXBlb2Ygby5sZW5ndGggPT09ICJudW1iZXIiKSB7aWYgKGl0KSBvID0gaXQ7dmFyIGkgPSAwO3ZhciBGID0gZnVuY3Rpb24gRigpIHt9O3JldHVybiB7IHM6IEYsIG46IGZ1bmN0aW9uIG4oKSB7aWYgKGkgPj0gby5sZW5ndGgpIHJldHVybiB7IGRvbmU6IHRydWUgfTtyZXR1cm4geyBkb25lOiBmYWxzZSwgdmFsdWU6IG9baSsrXSB9O30sIGU6IGZ1bmN0aW9uIGUoX2UpIHt0aHJvdyBfZTt9LCBmOiBGIH07fXRocm93IG5ldyBUeXBlRXJyb3IoIkludmFsaWQgYXR0ZW1wdCB0byBpdGVyYXRlIG5vbi1pdGVyYWJsZSBpbnN0YW5jZS5cbkluIG9yZGVyIHRvIGJlIGl0ZXJhYmxlLCBub24tYXJyYXkgb2JqZWN0cyBtdXN0IGhhdmUgYSBbU3ltYm9sLml0ZXJhdG9yXSgpIG1ldGhvZC4iKTt9dmFyIG5vcm1hbENvbXBsZXRpb24gPSB0cnVlLGRpZEVyciA9IGZhbHNlLGVycjtyZXR1cm4geyBzOiBmdW5jdGlvbiBzKCkge2l0ID0gaXQuY2FsbChvKTt9LCBuOiBmdW5jdGlvbiBuKCkge3ZhciBzdGVwID0gaXQubmV4dCgpO25vcm1hbENvbXBsZXRpb24gPSBzdGVwLmRvbmU7cmV0dXJuIHN0ZXA7fSwgZTogZnVuY3Rpb24gZShfZTIpIHtkaWRFcnIgPSB0cnVlO2VyciA9IF9lMjt9LCBmOiBmdW5jdGlvbiBmKCkge3RyeSB7aWYgKCFub3JtYWxDb21wbGV0aW9uICYmIGl0WyJyZXR1cm4iXSAhPSBudWxsKSBpdFsicmV0dXJuIl0oKTt9IGZpbmFsbHkge2lmIChkaWRFcnIpIHRocm93IGVycjt9fSB9O31mdW5jdGlvbiBfdW5zdXBwb3J0ZWRJdGVyYWJsZVRvQXJyYXkobywgbWluTGVuKSB7aWYgKCFvKSByZXR1cm47aWYgKHR5cGVvZiBvID09PSAic3RyaW5nIikgcmV0dXJuIF9hcnJheUxpa2VUb0FycmF5KG8sIG1pbkxlbik7dmFyIG4gPSBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwobykuc2xpY2UoOCwgLTEpO2lmIChuID09PSAiT2JqZWN0IiAmJiBvLmNvbnN0cnVjdG9yKSBuID0gby5jb25zdHJ1Y3Rvci5uYW1lO2lmIChuID09PSAiTWFwIiB8fCBuID09PSAiU2V0IikgcmV0dXJuIEFycmF5LmZyb20obyk7aWYgKG4gPT09ICJBcmd1bWVudHMiIHx8IC9eKD86VWl8SSludCg/Ojh8MTZ8MzIpKD86Q2xhbXBlZCk/QXJyYXkkLy50ZXN0KG4pKSByZXR1cm4gX2FycmF5TGlrZVRvQXJyYXkobywgbWluTGVuKTt9ZnVuY3Rpb24gX2FycmF5TGlrZVRvQXJyYXkoYXJyLCBsZW4pIHtpZiAobGVuID09IG51bGwgfHwgbGVuID4gYXJyLmxlbmd0aCkgbGVuID0gYXJyLmxlbmd0aDtmb3IgKHZhciBpID0gMCwgYXJyMiA9IG5ldyBBcnJheShsZW4pOyBpIDwgbGVuOyBpKyspIHthcnIyW2ldID0gYXJyW2ldO31yZXR1cm4gYXJyMjt9CgoKCgoKICAgICAgICBnZXREYXRhKGZ1bmN0aW9uIChwYWdlcykge3ZhciBfaXRlcmF0b3IgPSBfY3JlYXRlRm9yT2ZJdGVyYXRvckhlbHBlcigKICAgICAgICAgICAgcGFnZXMpLF9zdGVwO3RyeSB7Zm9yIChfaXRlcmF0b3IucygpOyAhKF9zdGVwID0gX2l0ZXJhdG9yLm4oKSkuZG9uZTspIHt2YXIgcGFnZSA9IF9zdGVwLnZhbHVlOwogICAgICAgICAgICAgIGZvciAodmFyIF9pID0gMCwgX2FyciA9IHBhZ2UuY29tcG9uZW50czsgX2kgPCBfYXJyLmxlbmd0aDsgX2krKykge3ZhciBjb21wb25lbnQgPSBfYXJyW19pXTsKICAgICAgICAgICAgICAgIGNvbXBvbmVudC5wcmV2aW91c1ZhbHVlID0gY29tcG9uZW50LnZhbHVlOwoKICAgICAgICAgICAgICAgIGlmIChjb21wb25lbnQudmFsaWRhdGUgIT0gbnVsbCkgewogICAgICAgICAgICAgICAgICBjb21wb25lbnQudmFsaWRhdGUgPSBldmFsKGNvbXBvbmVudC52YWxpZGF0ZSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9fSBjYXRjaCAoZXJyKSB7X2l0ZXJhdG9yLmUoZXJyKTt9IGZpbmFsbHkge19pdGVyYXRvci5mKCk7fQoKICAgICAgICAgIHZhciBjb250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgicm9vdCIpOwogICAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9uby1ub24tbnVsbC1hc3NlcnRpb24KICAgICAgICAgIHZhciByb290ID0gKDAsIHJlYWN0X2RvbV9jbGllbnRfX1dFQlBBQ0tfSU1QT1JURURfTU9EVUxFXzFfXyAvKiAuY3JlYXRlUm9vdCAqLy5zKShjb250YWluZXIpOwogICAgICAgICAgcm9vdC5yZW5kZXIoIC8qI19fUFVSRV9fKi9yZWFjdF9fV0VCUEFDS19JTVBPUlRFRF9NT0RVTEVfMl9fLmNyZWF0ZUVsZW1lbnQoX0FwcF9fV0VCUEFDS19JTVBPUlRFRF9NT0RVTEVfMF9fIC8qIFsiZGVmYXVsdCJdICovLlosIHsgcGFnZXM6IHBhZ2VzIH0pKTsKICAgICAgICB9KTsKICAgICAgfSkoKTsKCiAgICAgIC8qKioqKiovcmV0dXJuIF9fd2VicGFja19leHBvcnRzX187CiAgICAgIC8qKioqKiovfSkoKSk7Cgp9KTs=";

/***/ }),

/***/ 171:
/***/ ((module) => {

module.exports = "#relayContainer{margin:1rem;font-family:Arial,Helvetica,sans-serif}#notificationsContainer{pointer-events:none;position:absolute;top:5%;left:70%;transform:translateX(-50%);z-index:999}img{display:block;margin:auto}input.stringcontainer{background-color:#fff;border-radius:5px;border:1px solid #121943;height:24px;margin:auto;display:flex;padding-left:10px}input.interrupt{width:100%;border-color:darkred;background-color:#f1948a;color:darkred;margin:10px 0px;cursor:pointer}input.interrupt:hover{background-color:#f5867a}input.interrupt:active{background-color:#f77163}input.save,input.interrupt{margin:auto;display:block;font-size:x-large;padding:5px 25px;border-radius:10px}.notification{border:3px solid #00529b;background-color:#bde5f8;width:fit-content;margin-right:auto;margin-left:auto;border-radius:40px;color:#00529b;padding:7px 60px;animation:2s fadeOut 5s 1 forwards;cursor:default;pointer-events:auto}@keyframes fadeOut{0%{opacity:1}99%{height:100%}100%{opacity:0;height:0}}td{padding:.5rem}.toggle{align-items:center;border-radius:100px;display:flex;font-weight:700;margin-bottom:16px}.toggle:last-of-type{margin:0}.toggle__input{clip:rect(0 0 0 0);clip-path:inset(50%);height:1px;overflow:hidden;position:absolute;white-space:nowrap;width:1px}.toggle__input:not([disabled]):active+.toggle-track,.toggle__input:not([disabled]):focus+.toggle-track{border:1px solid rgba(0,0,0,0);box-shadow:0px 0px 0px 2px #121943}.toggle__input:disabled+.toggle-track{cursor:not-allowed;opacity:.7}.toggle-track{background:#fff;border:1px solid #5a72b5;border-radius:100px;cursor:pointer;display:flex;height:30px;margin:auto;position:relative;width:60px}.toggle-indicator{align-items:center;background:#121943;border-radius:24px;bottom:2px;display:flex;height:24px;justify-content:center;left:2px;outline:solid 2px rgba(0,0,0,0);position:absolute;transition:.4s;width:24px}.checkMark{fill:#fff;height:20px;width:20px;opacity:0;transition:opacity .4s ease-in-out}.dropdowncontainer{padding:8px 16px;border:1px solid rgba(0,0,0,0);border-color:#000}input[value=true]+.toggle-track .toggle-indicator{background:#121943;transform:translateX(30px)}input[value=true]+.toggle-track .toggle-indicator .checkMark{opacity:1;transition:opacity .4s ease-in-out}@media screen and (-ms-high-contrast: active){.toggle-track{border-radius:0;background-color:red}}.topBar{display:flex}.tabEntry{margin-right:10px;border-radius:10px;background-color:#333}.tabEntry a{display:block;color:#fff;text-align:center;padding:6px;text-decoration:none}.tabEntry a[aria-current=page]{background-color:#00529b;border-radius:10px}.tabEntry a:hover[aria-current=page]{background-color:#002c53;border-radius:10px}.tabEntry a:hover{background-color:#111;border-radius:10px}.setting{position:relative;display:inline-block}.setting .settingHover{visibility:hidden;background-color:#cacaca;color:#000;text-align:center;border-radius:6px;border-color:#000;position:absolute;z-index:1}.setting:hover .settingHover{visibility:visible;padding:5px;margin-left:15px}.invalid-setting input,.invalid-setting select,.invalid-setting .toggle-track{background:pink !important}.invalid-reason{text-align:center}.invalid-reason small{padding:0px 5px;border-radius:10px;color:red}\n";

/***/ }),

/***/ 530:
/***/ ((module) => {

module.exports = require("kolmafia");

/***/ })

/******/ 	});
/************************************************************************/
/******/ 	// The module cache
/******/ 	var __webpack_module_cache__ = {};
/******/ 	
/******/ 	// The require function
/******/ 	function __webpack_require__(moduleId) {
/******/ 		// Check if module is in cache
/******/ 		var cachedModule = __webpack_module_cache__[moduleId];
/******/ 		if (cachedModule !== undefined) {
/******/ 			return cachedModule.exports;
/******/ 		}
/******/ 		// Create a new module (and put it into the cache)
/******/ 		var module = __webpack_module_cache__[moduleId] = {
/******/ 			// no module.id needed
/******/ 			// no module.loaded needed
/******/ 			exports: {}
/******/ 		};
/******/ 	
/******/ 		// Execute the module function
/******/ 		__webpack_modules__[moduleId](module, module.exports, __webpack_require__);
/******/ 	
/******/ 		// Return the exports of the module
/******/ 		return module.exports;
/******/ 	}
/******/ 	
/************************************************************************/
/******/ 	/* webpack/runtime/compat get default export */
/******/ 	(() => {
/******/ 		// getDefaultExport function for compatibility with non-harmony modules
/******/ 		__webpack_require__.n = (module) => {
/******/ 			var getter = module && module.__esModule ?
/******/ 				() => (module['default']) :
/******/ 				() => (module);
/******/ 			__webpack_require__.d(getter, { a: getter });
/******/ 			return getter;
/******/ 		};
/******/ 	})();
/******/ 	
/******/ 	/* webpack/runtime/define property getters */
/******/ 	(() => {
/******/ 		// define getter functions for harmony exports
/******/ 		__webpack_require__.d = (exports, definition) => {
/******/ 			for(var key in definition) {
/******/ 				if(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {
/******/ 					Object.defineProperty(exports, key, { enumerable: true, get: definition[key] });
/******/ 				}
/******/ 			}
/******/ 		};
/******/ 	})();
/******/ 	
/******/ 	/* webpack/runtime/hasOwnProperty shorthand */
/******/ 	(() => {
/******/ 		__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))
/******/ 	})();
/******/ 	
/******/ 	/* webpack/runtime/make namespace object */
/******/ 	(() => {
/******/ 		// define __esModule on exports
/******/ 		__webpack_require__.r = (exports) => {
/******/ 			if(typeof Symbol !== 'undefined' && Symbol.toStringTag) {
/******/ 				Object.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });
/******/ 			}
/******/ 			Object.defineProperty(exports, '__esModule', { value: true });
/******/ 		};
/******/ 	})();
/******/ 	
/************************************************************************/
var __webpack_exports__ = {};
// This entry need to be wrapped in an IIFE because it need to be isolated against other modules in the chunk.
(() => {
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "main": () => (/* binding */ main)
/* harmony export */ });
/* harmony import */ var kolmafia__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(530);
/* harmony import */ var kolmafia__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(kolmafia__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var _RelayUtils__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(616);
function _createForOfIteratorHelper(o, allowArrayLike) {var it = typeof Symbol !== "undefined" && o[Symbol.iterator] || o["@@iterator"];if (!it) {if (Array.isArray(o) || (it = _unsupportedIterableToArray(o)) || allowArrayLike && o && typeof o.length === "number") {if (it) o = it;var i = 0;var F = function F() {};return { s: F, n: function n() {if (i >= o.length) return { done: true };return { done: false, value: o[i++] };}, e: function e(_e) {throw _e;}, f: F };}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");}var normalCompletion = true,didErr = false,err;return { s: function s() {it = it.call(o);}, n: function n() {var step = it.next();normalCompletion = step.done;return step;}, e: function e(_e2) {didErr = true;err = _e2;}, f: function f() {try {if (!normalCompletion && it.return != null) it.return();} finally {if (didErr) throw err;}} };}function _unsupportedIterableToArray(o, minLen) {if (!o) return;if (typeof o === "string") return _arrayLikeToArray(o, minLen);var n = Object.prototype.toString.call(o).slice(8, -1);if (n === "Object" && o.constructor) n = o.constructor.name;if (n === "Map" || n === "Set") return Array.from(o);if (n === "Arguments" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen);}function _arrayLikeToArray(arr, len) {if (len == null || len > arr.length) len = arr.length;for (var i = 0, arr2 = new Array(len); i < len; i++) {arr2[i] = arr[i];}return arr2;}



function main() {for (var _len = arguments.length, pagesToLoad = new Array(_len), _key = 0; _key < _len; _key++) {pagesToLoad[_key] = arguments[_key];}
  if ((0,_RelayUtils__WEBPACK_IMPORTED_MODULE_1__/* .handledApiRequest */ .k7)()) {
    return;
  }

  if (pagesToLoad.length == 0) {
    // Find any 'page' or 'pages' parameters
    pagesToLoad = ((0,kolmafia__WEBPACK_IMPORTED_MODULE_0__.formFields)()["page"] || (0,kolmafia__WEBPACK_IMPORTED_MODULE_0__.formFields)()["pages"] || "").
    split(",").
    filter((s) => s.length > 0);
  }

  var pages = [];
  var extraHtml;

  if (pagesToLoad.length > 0) {
    var cssFile;var _iterator = _createForOfIteratorHelper(
      pagesToLoad),_step;try {for (_iterator.s(); !(_step = _iterator.n()).done;) {var page = _step.value;
        // If the parameter is a string, then try to load from file
        if (typeof page == "string") {
          cssFile = (0,_RelayUtils__WEBPACK_IMPORTED_MODULE_1__/* .parseCssFromFile */ .$p)(page);
          page = (0,_RelayUtils__WEBPACK_IMPORTED_MODULE_1__/* .parsePageFromFile */ .jU)(page);
        }

        if (page == null) {
          continue;
        }

        // Assume at this point it must be a RelayPage
        pages.push(page);

        if (cssFile == null) {
          continue;
        }

        if (extraHtml == null) {
          extraHtml = { cssFiles: [] };
        }

        extraHtml.cssFiles.push(cssFile);
      }} catch (err) {_iterator.e(err);} finally {_iterator.f();}
  }

  if (pages.length == 0) {
    (0,kolmafia__WEBPACK_IMPORTED_MODULE_0__.write)(
    "<h3>The relay script could not find any pages to load, either invalid/missing pages were provided or nothing was.</h3>");

    return;
  }

  (0,kolmafia__WEBPACK_IMPORTED_MODULE_0__.write)((0,_RelayUtils__WEBPACK_IMPORTED_MODULE_1__/* .generateHTML */ .ar)(pages, extraHtml));
}
})();

var __webpack_export_target__ = exports;
for(var i in __webpack_exports__) __webpack_export_target__[i] = __webpack_exports__[i];
if(__webpack_exports__.__esModule) Object.defineProperty(__webpack_export_target__, "__esModule", { value: true });
/******/ })()
;