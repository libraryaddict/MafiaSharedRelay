/******/ (() => { // webpackBootstrap
/******/ 	"use strict";
/******/ 	var __webpack_modules__ = ({

/***/ 616:
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "$p": () => (/* binding */ parseCssFromFile),
/* harmony export */   "SU": () => (/* binding */ handleApiRequest),
/* harmony export */   "ar": () => (/* binding */ generateHTML),
/* harmony export */   "jU": () => (/* binding */ parsePageFromFile),
/* harmony export */   "mn": () => (/* binding */ getPagePath)
/* harmony export */ });
/* unused harmony export parsePageFromJson */
/* harmony import */ var kolmafia__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(530);
/* harmony import */ var kolmafia__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(kolmafia__WEBPACK_IMPORTED_MODULE_0__);
function _toConsumableArray(arr) {return _arrayWithoutHoles(arr) || _iterableToArray(arr) || _unsupportedIterableToArray(arr) || _nonIterableSpread();}function _nonIterableSpread() {throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");}function _iterableToArray(iter) {if (typeof Symbol !== "undefined" && iter[Symbol.iterator] != null || iter["@@iterator"] != null) return Array.from(iter);}function _arrayWithoutHoles(arr) {if (Array.isArray(arr)) return _arrayLikeToArray(arr);}function _slicedToArray(arr, i) {return _arrayWithHoles(arr) || _iterableToArrayLimit(arr, i) || _unsupportedIterableToArray(arr, i) || _nonIterableRest();}function _nonIterableRest() {throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");}function _iterableToArrayLimit(arr, i) {var _i = null == arr ? null : "undefined" != typeof Symbol && arr[Symbol.iterator] || arr["@@iterator"];if (null != _i) {var _s,_e,_x,_r,_arr = [],_n = !0,_d = !1;try {if (_x = (_i = _i.call(arr)).next, 0 === i) {if (Object(_i) !== _i) return;_n = !1;} else for (; !(_n = (_s = _x.call(_i)).done) && (_arr.push(_s.value), _arr.length !== i); _n = !0);} catch (err) {_d = !0, _e = err;} finally {try {if (!_n && null != _i.return && (_r = _i.return(), Object(_r) !== _r)) return;} finally {if (_d) throw _e;}}return _arr;}}function _arrayWithHoles(arr) {if (Array.isArray(arr)) return arr;}function _createForOfIteratorHelper(o, allowArrayLike) {var it = typeof Symbol !== "undefined" && o[Symbol.iterator] || o["@@iterator"];if (!it) {if (Array.isArray(o) || (it = _unsupportedIterableToArray(o)) || allowArrayLike && o && typeof o.length === "number") {if (it) o = it;var i = 0;var F = function F() {};return { s: F, n: function n() {if (i >= o.length) return { done: true };return { done: false, value: o[i++] };}, e: function e(_e2) {throw _e2;}, f: F };}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");}var normalCompletion = true,didErr = false,err;return { s: function s() {it = it.call(o);}, n: function n() {var step = it.next();normalCompletion = step.done;return step;}, e: function e(_e3) {didErr = true;err = _e3;}, f: function f() {try {if (!normalCompletion && it.return != null) it.return();} finally {if (didErr) throw err;}} };}function _unsupportedIterableToArray(o, minLen) {if (!o) return;if (typeof o === "string") return _arrayLikeToArray(o, minLen);var n = Object.prototype.toString.call(o).slice(8, -1);if (n === "Object" && o.constructor) n = o.constructor.name;if (n === "Map" || n === "Set") return Array.from(o);if (n === "Arguments" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen);}function _arrayLikeToArray(arr, len) {if (len == null || len > arr.length) len = arr.length;for (var i = 0, arr2 = new Array(len); i < len; i++) arr2[i] = arr[i];return arr2;}










function handleApiRequest() {
  if (handleJavascript()) {
    return true;
  }

  if (handleProperties()) {
    return true;
  }

  return false;
}

function handleProperties() {
  var toSet = (0,kolmafia__WEBPACK_IMPORTED_MODULE_0__.formFields)()["setProperties"];

  if (toSet == null) {
    return false;
  }

  var props = JSON.parse(toSet);
  var notifications = [];var _iterator = _createForOfIteratorHelper(

    props),_step;try {for (_iterator.s(); !(_step = _iterator.n()).done;) {var _step$value = _slicedToArray(_step.value, 2),key = _step$value[0],value = _step$value[1];
      var prevValue = (0,kolmafia__WEBPACK_IMPORTED_MODULE_0__.getProperty)(key);

      if (prevValue === value) {
        continue;
      }

      (0,kolmafia__WEBPACK_IMPORTED_MODULE_0__.setProperty)(key, value);
      notifications.push("".concat(key, " changed from `").concat(prevValue, "` to `").concat(value, "`"));
    }} catch (err) {_iterator.e(err);} finally {_iterator.f();}

  if (notifications.length == 0) {
    notifications.push("No settings were modified.");
  }

  // We include the ' ' because otherwise the browser doesn't like an empty page
  (0,kolmafia__WEBPACK_IMPORTED_MODULE_0__.write)(JSON.stringify(notifications));
  return true;
}

function handleJavascript() {
  var js = (0,kolmafia__WEBPACK_IMPORTED_MODULE_0__.formFields)()["javascript"];

  if (js == null) {
    return false;
  }

  var returns = eval(js) || "";
  // We include the ' ' because otherwise the browser doesn't like an empty page
  (0,kolmafia__WEBPACK_IMPORTED_MODULE_0__.write)(returns + (returns ? "" : " "));
  return true;
}

function validateComponents(components) {var _iterator2 = _createForOfIteratorHelper(
    components),_step2;try {for (_iterator2.s(); !(_step2 = _iterator2.n()).done;) {var _button$name;var component = _step2.value;
      var button = component;

      if (button.preference == null) {
        continue;
      }

      button.name = (_button$name = button.name) !== null && _button$name !== void 0 ? _button$name : button.preference;

      if (button.validate != null) {
        try {
          eval(button.validate);
        } catch (e) {
          (0,kolmafia__WEBPACK_IMPORTED_MODULE_0__.print)("Unable to load ".concat(button.name, "'s validator '").concat(button.validate, "'"));
          button.validate = null;
        }
      }

      if (button.default != undefined && typeof button.default != "string") {
        button.default = button.default + "";
      }

      if (button.default == null && (0,kolmafia__WEBPACK_IMPORTED_MODULE_0__.propertyHasDefault)(button.preference)) {
        button.default = (0,kolmafia__WEBPACK_IMPORTED_MODULE_0__.propertyDefaultValue)(button.preference);
      }

      if (button.value != undefined && typeof button.value != "string") {
        button.value = button.value + "";
      }

      if (button.default == null && button.type == "boolean") {
        button.default = "true";
      }

      if (button.type == "tags") {
        var tags = button;
        if (tags.allowDuplicateTags == null) {
          tags.allowDuplicateTags = true;
        }

        if (tags.tagsSeperator == null) {
          tags.tagsSeperator = ",";
        }

        if (button.placeholderText == null) {
          button.placeholderText = button.default ? button.default : "";
        }
      }

      if (button.value != null) {
        continue;
      }

      var val = void 0;

      if ((0,kolmafia__WEBPACK_IMPORTED_MODULE_0__.propertyExists)(button.preference)) {
        val = (0,kolmafia__WEBPACK_IMPORTED_MODULE_0__.getProperty)(button.preference);
      } else if (button.default != null) {
        val = button.default;
      } else {
        if (button.type == "dropdown") {
          if (typeof button.dropdown[0] == "string") {
            val = button.dropdown[0];
          } else {
            val = button.dropdown[0].value;
          }
        } else if (button.type == "boolean") {
          val = "true";
        } else {
          val = "";
        }
      }

      button.value = val;
    }} catch (err) {_iterator2.e(err);} finally {_iterator2.f();}
}

function generateHTML(
pages,
extraHtml)
{
  pages = pages.filter((p) => p != null);var _iterator3 = _createForOfIteratorHelper(

    pages),_step3;try {for (_iterator3.s(); !(_step3 = _iterator3.n()).done;) {var _page$file;var page = _step3.value;
      page.file = (_page$file = page.file) !== null && _page$file !== void 0 ? _page$file : page.page;

      validateComponents(page.components);
    }} catch (err) {_iterator3.e(err);} finally {_iterator3.f();}

  var buffer = [];

  var cssFiles = [];

  if (extraHtml && extraHtml.cssFiles) {
    cssFiles.push.apply(cssFiles, _toConsumableArray(extraHtml.cssFiles));
  }

  buffer.push("<!DOCTYPE html>");
  buffer.push("<head>");

  cssFiles.forEach((s) => {
    buffer.push("<link rel=\"stylesheet\" src=\"".concat(s, "\">"));
  });

  buffer.push("<style>");
  buffer.push("".concat(__webpack_require__(171)));

  if (extraHtml && extraHtml.css) {
    buffer.push(extraHtml.css);
  }

  buffer.push("</style>");

  buffer.push("</head>");

  buffer.push('<div id="root"></div>');

  buffer.push("<script>");

  // add script that react calls when loaded to get kol data
  buffer.push("let getData = function(callback) {callback(".concat(
  JSON.stringify(pages), ")}"));


  // close notifications when they are clicked on
  buffer.push("document.onclick = (e) => {\n    if(e.target.classList.contains('notification')) e.target.remove();\n  }");



  buffer.push("</script>");

  // include react script
  buffer.push("<script src=\"".concat(
  __webpack_require__(832), "\"></script>"));


  return buffer.join("\n");
}

function getPagePath(file) {
  var fileName = file.includes("/") ?
  file :
  "relay/shared_relay/pages/" + file + ".json";

  if (!fileName.endsWith(".json") && (0,kolmafia__WEBPACK_IMPORTED_MODULE_0__.fileToBuffer)(fileName).length == 0) {
    fileName += ".json";
  }

  return fileName;
}

/**
 * Parses from relay/shared_relay/pages/ if no slashes are in the name, otherwise expects a valid json file
 */
function parsePageFromFile(file) {
  var data = (0,kolmafia__WEBPACK_IMPORTED_MODULE_0__.fileToBuffer)(getPagePath(file));

  return parsePageFromJson(file, data);
}

function parseCssFromFile(file) {
  var fileName = file.includes("/") ?
  file :
  "relay/shared_relay/pages/" + file + ".css";

  if (!fileName.endsWith(".css")) {
    fileName += ".css";
  }

  var data = (0,kolmafia__WEBPACK_IMPORTED_MODULE_0__.fileToBuffer)(fileName);

  if (data.length == 0) {
    return null;
  }

  return data;
}

function parsePageFromJson(id, jsonData) {
  if (jsonData.length == 0) {
    return null;
  }

  var subpage = JSON.parse(jsonData);

  subpage.file = id;

  for (var _i2 = 0, _arr2 = subpage.components; _i2 < _arr2.length; _i2++) {var _ref3;var button = _arr2[_i2];
    if (button.type != "dropdown") {
      continue;
    }

    var dropdown = button;

    if (dropdown.dropdown == null) {
      dropdown.dropdown = [];
    } else if (typeof dropdown.dropdown[0] == "string") {
      dropdown.dropdown = dropdown.dropdown.map(
      (s) => {
        return {
          display: s,
          value: s
        };
      });

    }

    if (dropdown.dropdownFiller == null) {
      continue;
    }

    var data =
    eval(dropdown.dropdownFiller).
    map((_ref) => {var _ref2 = _slicedToArray(_ref, 2),display = _ref2[0],value = _ref2[1];
      return {
        display: display,
        value: value
      };
    });

    (_ref3 = dropdown.dropdown).push.apply(_ref3, _toConsumableArray(data));
  }

  return subpage;
}

/***/ }),

/***/ 832:
/***/ ((module) => {

module.exports = "data:application/javascript;base64,ZnVuY3Rpb24gX3JlZ2VuZXJhdG9yUnVudGltZTIoKSB7InVzZSBzdHJpY3QiOwovKiEgcmVnZW5lcmF0b3ItcnVudGltZSAtLSBDb3B5cmlnaHQgKGMpIDIwMTQtcHJlc2VudCwgRmFjZWJvb2ssIEluYy4gLS0gbGljZW5zZSAoTUlUKTogaHR0cHM6Ly9naXRodWIuY29tL2ZhY2Vib29rL3JlZ2VuZXJhdG9yL2Jsb2IvbWFpbi9MSUNFTlNFICovX3JlZ2VuZXJhdG9yUnVudGltZTIgPSBmdW5jdGlvbiBfcmVnZW5lcmF0b3JSdW50aW1lMigpIHtyZXR1cm4gZXhwb3J0czt9O3ZhciBleHBvcnRzID0ge30sT3AgPSBPYmplY3QucHJvdG90eXBlLGhhc093biA9IE9wLmhhc093blByb3BlcnR5LGRlZmluZVByb3BlcnR5ID0gT2JqZWN0LmRlZmluZVByb3BlcnR5IHx8IGZ1bmN0aW9uIChvYmosIGtleSwgZGVzYykge29ialtrZXldID0gZGVzYy52YWx1ZTt9LCRTeW1ib2wgPSAiZnVuY3Rpb24iID09IHR5cGVvZiBTeW1ib2wgPyBTeW1ib2wgOiB7fSxpdGVyYXRvclN5bWJvbCA9ICRTeW1ib2wuaXRlcmF0b3IgfHwgIkBAaXRlcmF0b3IiLGFzeW5jSXRlcmF0b3JTeW1ib2wgPSAkU3ltYm9sLmFzeW5jSXRlcmF0b3IgfHwgIkBAYXN5bmNJdGVyYXRvciIsdG9TdHJpbmdUYWdTeW1ib2wgPSAkU3ltYm9sLnRvU3RyaW5nVGFnIHx8ICJAQHRvU3RyaW5nVGFnIjtmdW5jdGlvbiBkZWZpbmUob2JqLCBrZXksIHZhbHVlKSB7cmV0dXJuIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvYmosIGtleSwgeyB2YWx1ZTogdmFsdWUsIGVudW1lcmFibGU6ICEwLCBjb25maWd1cmFibGU6ICEwLCB3cml0YWJsZTogITAgfSksIG9ialtrZXldO310cnkge2RlZmluZSh7fSwgIiIpO30gY2F0Y2ggKGVycikge2RlZmluZSA9IGZ1bmN0aW9uIGRlZmluZShvYmosIGtleSwgdmFsdWUpIHtyZXR1cm4gb2JqW2tleV0gPSB2YWx1ZTt9O31mdW5jdGlvbiB3cmFwKGlubmVyRm4sIG91dGVyRm4sIHNlbGYsIHRyeUxvY3NMaXN0KSB7dmFyIHByb3RvR2VuZXJhdG9yID0gb3V0ZXJGbiAmJiBvdXRlckZuLnByb3RvdHlwZSBpbnN0YW5jZW9mIEdlbmVyYXRvciA/IG91dGVyRm4gOiBHZW5lcmF0b3IsZ2VuZXJhdG9yID0gT2JqZWN0LmNyZWF0ZShwcm90b0dlbmVyYXRvci5wcm90b3R5cGUpLGNvbnRleHQgPSBuZXcgQ29udGV4dCh0cnlMb2NzTGlzdCB8fCBbXSk7cmV0dXJuIGRlZmluZVByb3BlcnR5KGdlbmVyYXRvciwgIl9pbnZva2UiLCB7IHZhbHVlOiBtYWtlSW52b2tlTWV0aG9kKGlubmVyRm4sIHNlbGYsIGNvbnRleHQpIH0pLCBnZW5lcmF0b3I7fWZ1bmN0aW9uIHRyeUNhdGNoKGZuLCBvYmosIGFyZykge3RyeSB7cmV0dXJuIHsgdHlwZTogIm5vcm1hbCIsIGFyZzogZm4uY2FsbChvYmosIGFyZykgfTt9IGNhdGNoIChlcnIpIHtyZXR1cm4geyB0eXBlOiAidGhyb3ciLCBhcmc6IGVyciB9O319ZXhwb3J0cy53cmFwID0gd3JhcDt2YXIgQ29udGludWVTZW50aW5lbCA9IHt9O2Z1bmN0aW9uIEdlbmVyYXRvcigpIHt9ZnVuY3Rpb24gR2VuZXJhdG9yRnVuY3Rpb24oKSB7fWZ1bmN0aW9uIEdlbmVyYXRvckZ1bmN0aW9uUHJvdG90eXBlKCkge312YXIgSXRlcmF0b3JQcm90b3R5cGUgPSB7fTtkZWZpbmUoSXRlcmF0b3JQcm90b3R5cGUsIGl0ZXJhdG9yU3ltYm9sLCBmdW5jdGlvbiAoKSB7cmV0dXJuIHRoaXM7fSk7dmFyIGdldFByb3RvID0gT2JqZWN0LmdldFByb3RvdHlwZU9mLE5hdGl2ZUl0ZXJhdG9yUHJvdG90eXBlID0gZ2V0UHJvdG8gJiYgZ2V0UHJvdG8oZ2V0UHJvdG8odmFsdWVzKFtdKSkpO05hdGl2ZUl0ZXJhdG9yUHJvdG90eXBlICYmIE5hdGl2ZUl0ZXJhdG9yUHJvdG90eXBlICE9PSBPcCAmJiBoYXNPd24uY2FsbChOYXRpdmVJdGVyYXRvclByb3RvdHlwZSwgaXRlcmF0b3JTeW1ib2wpICYmIChJdGVyYXRvclByb3RvdHlwZSA9IE5hdGl2ZUl0ZXJhdG9yUHJvdG90eXBlKTt2YXIgR3AgPSBHZW5lcmF0b3JGdW5jdGlvblByb3RvdHlwZS5wcm90b3R5cGUgPSBHZW5lcmF0b3IucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZShJdGVyYXRvclByb3RvdHlwZSk7ZnVuY3Rpb24gZGVmaW5lSXRlcmF0b3JNZXRob2RzKHByb3RvdHlwZSkge1sibmV4dCIsICJ0aHJvdyIsICJyZXR1cm4iXS5mb3JFYWNoKGZ1bmN0aW9uIChtZXRob2QpIHtkZWZpbmUocHJvdG90eXBlLCBtZXRob2QsIGZ1bmN0aW9uIChhcmcpIHtyZXR1cm4gdGhpcy5faW52b2tlKG1ldGhvZCwgYXJnKTt9KTt9KTt9ZnVuY3Rpb24gQXN5bmNJdGVyYXRvcihnZW5lcmF0b3IsIFByb21pc2VJbXBsKSB7ZnVuY3Rpb24gaW52b2tlKG1ldGhvZCwgYXJnLCByZXNvbHZlLCByZWplY3QpIHt2YXIgcmVjb3JkID0gdHJ5Q2F0Y2goZ2VuZXJhdG9yW21ldGhvZF0sIGdlbmVyYXRvciwgYXJnKTtpZiAoInRocm93IiAhPT0gcmVjb3JkLnR5cGUpIHt2YXIgcmVzdWx0ID0gcmVjb3JkLmFyZyx2YWx1ZSA9IHJlc3VsdC52YWx1ZTtyZXR1cm4gdmFsdWUgJiYgIm9iamVjdCIgPT0gdHlwZW9mIHZhbHVlICYmIGhhc093bi5jYWxsKHZhbHVlLCAiX19hd2FpdCIpID8gUHJvbWlzZUltcGwucmVzb2x2ZSh2YWx1ZS5fX2F3YWl0KS50aGVuKGZ1bmN0aW9uICh2YWx1ZSkge2ludm9rZSgibmV4dCIsIHZhbHVlLCByZXNvbHZlLCByZWplY3QpO30sIGZ1bmN0aW9uIChlcnIpIHtpbnZva2UoInRocm93IiwgZXJyLCByZXNvbHZlLCByZWplY3QpO30pIDogUHJvbWlzZUltcGwucmVzb2x2ZSh2YWx1ZSkudGhlbihmdW5jdGlvbiAodW53cmFwcGVkKSB7cmVzdWx0LnZhbHVlID0gdW53cmFwcGVkLCByZXNvbHZlKHJlc3VsdCk7fSwgZnVuY3Rpb24gKGVycm9yKSB7cmV0dXJuIGludm9rZSgidGhyb3ciLCBlcnJvciwgcmVzb2x2ZSwgcmVqZWN0KTt9KTt9cmVqZWN0KHJlY29yZC5hcmcpO312YXIgcHJldmlvdXNQcm9taXNlO2RlZmluZVByb3BlcnR5KHRoaXMsICJfaW52b2tlIiwgeyB2YWx1ZTogZnVuY3Rpb24gdmFsdWUobWV0aG9kLCBhcmcpIHtmdW5jdGlvbiBjYWxsSW52b2tlV2l0aE1ldGhvZEFuZEFyZygpIHtyZXR1cm4gbmV3IFByb21pc2VJbXBsKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtpbnZva2UobWV0aG9kLCBhcmcsIHJlc29sdmUsIHJlamVjdCk7fSk7fXJldHVybiBwcmV2aW91c1Byb21pc2UgPSBwcmV2aW91c1Byb21pc2UgPyBwcmV2aW91c1Byb21pc2UudGhlbihjYWxsSW52b2tlV2l0aE1ldGhvZEFuZEFyZywgY2FsbEludm9rZVdpdGhNZXRob2RBbmRBcmcpIDogY2FsbEludm9rZVdpdGhNZXRob2RBbmRBcmcoKTt9IH0pO31mdW5jdGlvbiBtYWtlSW52b2tlTWV0aG9kKGlubmVyRm4sIHNlbGYsIGNvbnRleHQpIHt2YXIgc3RhdGUgPSAic3VzcGVuZGVkU3RhcnQiO3JldHVybiBmdW5jdGlvbiAobWV0aG9kLCBhcmcpIHtpZiAoImV4ZWN1dGluZyIgPT09IHN0YXRlKSB0aHJvdyBuZXcgRXJyb3IoIkdlbmVyYXRvciBpcyBhbHJlYWR5IHJ1bm5pbmciKTtpZiAoImNvbXBsZXRlZCIgPT09IHN0YXRlKSB7aWYgKCJ0aHJvdyIgPT09IG1ldGhvZCkgdGhyb3cgYXJnO3JldHVybiBkb25lUmVzdWx0KCk7fWZvciAoY29udGV4dC5tZXRob2QgPSBtZXRob2QsIGNvbnRleHQuYXJnID0gYXJnOzspIHt2YXIgZGVsZWdhdGUgPSBjb250ZXh0LmRlbGVnYXRlO2lmIChkZWxlZ2F0ZSkge3ZhciBkZWxlZ2F0ZVJlc3VsdCA9IG1heWJlSW52b2tlRGVsZWdhdGUoZGVsZWdhdGUsIGNvbnRleHQpO2lmIChkZWxlZ2F0ZVJlc3VsdCkge2lmIChkZWxlZ2F0ZVJlc3VsdCA9PT0gQ29udGludWVTZW50aW5lbCkgY29udGludWU7cmV0dXJuIGRlbGVnYXRlUmVzdWx0O319aWYgKCJuZXh0IiA9PT0gY29udGV4dC5tZXRob2QpIGNvbnRleHQuc2VudCA9IGNvbnRleHQuX3NlbnQgPSBjb250ZXh0LmFyZztlbHNlIGlmICgidGhyb3ciID09PSBjb250ZXh0Lm1ldGhvZCkge2lmICgic3VzcGVuZGVkU3RhcnQiID09PSBzdGF0ZSkgdGhyb3cgc3RhdGUgPSAiY29tcGxldGVkIiwgY29udGV4dC5hcmc7Y29udGV4dC5kaXNwYXRjaEV4Y2VwdGlvbihjb250ZXh0LmFyZyk7fSBlbHNlICJyZXR1cm4iID09PSBjb250ZXh0Lm1ldGhvZCAmJiBjb250ZXh0LmFicnVwdCgicmV0dXJuIiwgY29udGV4dC5hcmcpO3N0YXRlID0gImV4ZWN1dGluZyI7dmFyIHJlY29yZCA9IHRyeUNhdGNoKGlubmVyRm4sIHNlbGYsIGNvbnRleHQpO2lmICgibm9ybWFsIiA9PT0gcmVjb3JkLnR5cGUpIHtpZiAoc3RhdGUgPSBjb250ZXh0LmRvbmUgPyAiY29tcGxldGVkIiA6ICJzdXNwZW5kZWRZaWVsZCIsIHJlY29yZC5hcmcgPT09IENvbnRpbnVlU2VudGluZWwpIGNvbnRpbnVlO3JldHVybiB7IHZhbHVlOiByZWNvcmQuYXJnLCBkb25lOiBjb250ZXh0LmRvbmUgfTt9InRocm93IiA9PT0gcmVjb3JkLnR5cGUgJiYgKHN0YXRlID0gImNvbXBsZXRlZCIsIGNvbnRleHQubWV0aG9kID0gInRocm93IiwgY29udGV4dC5hcmcgPSByZWNvcmQuYXJnKTt9fTt9ZnVuY3Rpb24gbWF5YmVJbnZva2VEZWxlZ2F0ZShkZWxlZ2F0ZSwgY29udGV4dCkge3ZhciBtZXRob2ROYW1lID0gY29udGV4dC5tZXRob2QsbWV0aG9kID0gZGVsZWdhdGUuaXRlcmF0b3JbbWV0aG9kTmFtZV07aWYgKHVuZGVmaW5lZCA9PT0gbWV0aG9kKSByZXR1cm4gY29udGV4dC5kZWxlZ2F0ZSA9IG51bGwsICJ0aHJvdyIgPT09IG1ldGhvZE5hbWUgJiYgZGVsZWdhdGUuaXRlcmF0b3IucmV0dXJuICYmIChjb250ZXh0Lm1ldGhvZCA9ICJyZXR1cm4iLCBjb250ZXh0LmFyZyA9IHVuZGVmaW5lZCwgbWF5YmVJbnZva2VEZWxlZ2F0ZShkZWxlZ2F0ZSwgY29udGV4dCksICJ0aHJvdyIgPT09IGNvbnRleHQubWV0aG9kKSB8fCAicmV0dXJuIiAhPT0gbWV0aG9kTmFtZSAmJiAoY29udGV4dC5tZXRob2QgPSAidGhyb3ciLCBjb250ZXh0LmFyZyA9IG5ldyBUeXBlRXJyb3IoIlRoZSBpdGVyYXRvciBkb2VzIG5vdCBwcm92aWRlIGEgJyIgKyBtZXRob2ROYW1lICsgIicgbWV0aG9kIikpLCBDb250aW51ZVNlbnRpbmVsO3ZhciByZWNvcmQgPSB0cnlDYXRjaChtZXRob2QsIGRlbGVnYXRlLml0ZXJhdG9yLCBjb250ZXh0LmFyZyk7aWYgKCJ0aHJvdyIgPT09IHJlY29yZC50eXBlKSByZXR1cm4gY29udGV4dC5tZXRob2QgPSAidGhyb3ciLCBjb250ZXh0LmFyZyA9IHJlY29yZC5hcmcsIGNvbnRleHQuZGVsZWdhdGUgPSBudWxsLCBDb250aW51ZVNlbnRpbmVsO3ZhciBpbmZvID0gcmVjb3JkLmFyZztyZXR1cm4gaW5mbyA/IGluZm8uZG9uZSA/IChjb250ZXh0W2RlbGVnYXRlLnJlc3VsdE5hbWVdID0gaW5mby52YWx1ZSwgY29udGV4dC5uZXh0ID0gZGVsZWdhdGUubmV4dExvYywgInJldHVybiIgIT09IGNvbnRleHQubWV0aG9kICYmIChjb250ZXh0Lm1ldGhvZCA9ICJuZXh0IiwgY29udGV4dC5hcmcgPSB1bmRlZmluZWQpLCBjb250ZXh0LmRlbGVnYXRlID0gbnVsbCwgQ29udGludWVTZW50aW5lbCkgOiBpbmZvIDogKGNvbnRleHQubWV0aG9kID0gInRocm93IiwgY29udGV4dC5hcmcgPSBuZXcgVHlwZUVycm9yKCJpdGVyYXRvciByZXN1bHQgaXMgbm90IGFuIG9iamVjdCIpLCBjb250ZXh0LmRlbGVnYXRlID0gbnVsbCwgQ29udGludWVTZW50aW5lbCk7fWZ1bmN0aW9uIHB1c2hUcnlFbnRyeShsb2NzKSB7dmFyIGVudHJ5ID0geyB0cnlMb2M6IGxvY3NbMF0gfTsxIGluIGxvY3MgJiYgKGVudHJ5LmNhdGNoTG9jID0gbG9jc1sxXSksIDIgaW4gbG9jcyAmJiAoZW50cnkuZmluYWxseUxvYyA9IGxvY3NbMl0sIGVudHJ5LmFmdGVyTG9jID0gbG9jc1szXSksIHRoaXMudHJ5RW50cmllcy5wdXNoKGVudHJ5KTt9ZnVuY3Rpb24gcmVzZXRUcnlFbnRyeShlbnRyeSkge3ZhciByZWNvcmQgPSBlbnRyeS5jb21wbGV0aW9uIHx8IHt9O3JlY29yZC50eXBlID0gIm5vcm1hbCIsIGRlbGV0ZSByZWNvcmQuYXJnLCBlbnRyeS5jb21wbGV0aW9uID0gcmVjb3JkO31mdW5jdGlvbiBDb250ZXh0KHRyeUxvY3NMaXN0KSB7dGhpcy50cnlFbnRyaWVzID0gW3sgdHJ5TG9jOiAicm9vdCIgfV0sIHRyeUxvY3NMaXN0LmZvckVhY2gocHVzaFRyeUVudHJ5LCB0aGlzKSwgdGhpcy5yZXNldCghMCk7fWZ1bmN0aW9uIHZhbHVlcyhpdGVyYWJsZSkge2lmIChpdGVyYWJsZSkge3ZhciBpdGVyYXRvck1ldGhvZCA9IGl0ZXJhYmxlW2l0ZXJhdG9yU3ltYm9sXTtpZiAoaXRlcmF0b3JNZXRob2QpIHJldHVybiBpdGVyYXRvck1ldGhvZC5jYWxsKGl0ZXJhYmxlKTtpZiAoImZ1bmN0aW9uIiA9PSB0eXBlb2YgaXRlcmFibGUubmV4dCkgcmV0dXJuIGl0ZXJhYmxlO2lmICghaXNOYU4oaXRlcmFibGUubGVuZ3RoKSkge3ZhciBpID0gLTEsbmV4dCA9IGZ1bmN0aW9uIG5leHQoKSB7Zm9yICg7ICsraSA8IGl0ZXJhYmxlLmxlbmd0aDspIGlmIChoYXNPd24uY2FsbChpdGVyYWJsZSwgaSkpIHJldHVybiBuZXh0LnZhbHVlID0gaXRlcmFibGVbaV0sIG5leHQuZG9uZSA9ICExLCBuZXh0O3JldHVybiBuZXh0LnZhbHVlID0gdW5kZWZpbmVkLCBuZXh0LmRvbmUgPSAhMCwgbmV4dDt9O3JldHVybiBuZXh0Lm5leHQgPSBuZXh0O319cmV0dXJuIHsgbmV4dDogZG9uZVJlc3VsdCB9O31mdW5jdGlvbiBkb25lUmVzdWx0KCkge3JldHVybiB7IHZhbHVlOiB1bmRlZmluZWQsIGRvbmU6ICEwIH07fXJldHVybiBHZW5lcmF0b3JGdW5jdGlvbi5wcm90b3R5cGUgPSBHZW5lcmF0b3JGdW5jdGlvblByb3RvdHlwZSwgZGVmaW5lUHJvcGVydHkoR3AsICJjb25zdHJ1Y3RvciIsIHsgdmFsdWU6IEdlbmVyYXRvckZ1bmN0aW9uUHJvdG90eXBlLCBjb25maWd1cmFibGU6ICEwIH0pLCBkZWZpbmVQcm9wZXJ0eShHZW5lcmF0b3JGdW5jdGlvblByb3RvdHlwZSwgImNvbnN0cnVjdG9yIiwgeyB2YWx1ZTogR2VuZXJhdG9yRnVuY3Rpb24sIGNvbmZpZ3VyYWJsZTogITAgfSksIEdlbmVyYXRvckZ1bmN0aW9uLmRpc3BsYXlOYW1lID0gZGVmaW5lKEdlbmVyYXRvckZ1bmN0aW9uUHJvdG90eXBlLCB0b1N0cmluZ1RhZ1N5bWJvbCwgIkdlbmVyYXRvckZ1bmN0aW9uIiksIGV4cG9ydHMuaXNHZW5lcmF0b3JGdW5jdGlvbiA9IGZ1bmN0aW9uIChnZW5GdW4pIHt2YXIgY3RvciA9ICJmdW5jdGlvbiIgPT0gdHlwZW9mIGdlbkZ1biAmJiBnZW5GdW4uY29uc3RydWN0b3I7cmV0dXJuICEhY3RvciAmJiAoY3RvciA9PT0gR2VuZXJhdG9yRnVuY3Rpb24gfHwgIkdlbmVyYXRvckZ1bmN0aW9uIiA9PT0gKGN0b3IuZGlzcGxheU5hbWUgfHwgY3Rvci5uYW1lKSk7fSwgZXhwb3J0cy5tYXJrID0gZnVuY3Rpb24gKGdlbkZ1bikge3JldHVybiBPYmplY3Quc2V0UHJvdG90eXBlT2YgPyBPYmplY3Quc2V0UHJvdG90eXBlT2YoZ2VuRnVuLCBHZW5lcmF0b3JGdW5jdGlvblByb3RvdHlwZSkgOiAoZ2VuRnVuLl9fcHJvdG9fXyA9IEdlbmVyYXRvckZ1bmN0aW9uUHJvdG90eXBlLCBkZWZpbmUoZ2VuRnVuLCB0b1N0cmluZ1RhZ1N5bWJvbCwgIkdlbmVyYXRvckZ1bmN0aW9uIikpLCBnZW5GdW4ucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZShHcCksIGdlbkZ1bjt9LCBleHBvcnRzLmF3cmFwID0gZnVuY3Rpb24gKGFyZykge3JldHVybiB7IF9fYXdhaXQ6IGFyZyB9O30sIGRlZmluZUl0ZXJhdG9yTWV0aG9kcyhBc3luY0l0ZXJhdG9yLnByb3RvdHlwZSksIGRlZmluZShBc3luY0l0ZXJhdG9yLnByb3RvdHlwZSwgYXN5bmNJdGVyYXRvclN5bWJvbCwgZnVuY3Rpb24gKCkge3JldHVybiB0aGlzO30pLCBleHBvcnRzLkFzeW5jSXRlcmF0b3IgPSBBc3luY0l0ZXJhdG9yLCBleHBvcnRzLmFzeW5jID0gZnVuY3Rpb24gKGlubmVyRm4sIG91dGVyRm4sIHNlbGYsIHRyeUxvY3NMaXN0LCBQcm9taXNlSW1wbCkge3ZvaWQgMCA9PT0gUHJvbWlzZUltcGwgJiYgKFByb21pc2VJbXBsID0gUHJvbWlzZSk7dmFyIGl0ZXIgPSBuZXcgQXN5bmNJdGVyYXRvcih3cmFwKGlubmVyRm4sIG91dGVyRm4sIHNlbGYsIHRyeUxvY3NMaXN0KSwgUHJvbWlzZUltcGwpO3JldHVybiBleHBvcnRzLmlzR2VuZXJhdG9yRnVuY3Rpb24ob3V0ZXJGbikgPyBpdGVyIDogaXRlci5uZXh0KCkudGhlbihmdW5jdGlvbiAocmVzdWx0KSB7cmV0dXJuIHJlc3VsdC5kb25lID8gcmVzdWx0LnZhbHVlIDogaXRlci5uZXh0KCk7fSk7fSwgZGVmaW5lSXRlcmF0b3JNZXRob2RzKEdwKSwgZGVmaW5lKEdwLCB0b1N0cmluZ1RhZ1N5bWJvbCwgIkdlbmVyYXRvciIpLCBkZWZpbmUoR3AsIGl0ZXJhdG9yU3ltYm9sLCBmdW5jdGlvbiAoKSB7cmV0dXJuIHRoaXM7fSksIGRlZmluZShHcCwgInRvU3RyaW5nIiwgZnVuY3Rpb24gKCkge3JldHVybiAiW29iamVjdCBHZW5lcmF0b3JdIjt9KSwgZXhwb3J0cy5rZXlzID0gZnVuY3Rpb24gKHZhbCkge3ZhciBvYmplY3QgPSBPYmplY3QodmFsKSxrZXlzID0gW107Zm9yICh2YXIga2V5IGluIG9iamVjdCkga2V5cy5wdXNoKGtleSk7cmV0dXJuIGtleXMucmV2ZXJzZSgpLCBmdW5jdGlvbiBuZXh0KCkge2ZvciAoOyBrZXlzLmxlbmd0aDspIHt2YXIga2V5ID0ga2V5cy5wb3AoKTtpZiAoa2V5IGluIG9iamVjdCkgcmV0dXJuIG5leHQudmFsdWUgPSBrZXksIG5leHQuZG9uZSA9ICExLCBuZXh0O31yZXR1cm4gbmV4dC5kb25lID0gITAsIG5leHQ7fTt9LCBleHBvcnRzLnZhbHVlcyA9IHZhbHVlcywgQ29udGV4dC5wcm90b3R5cGUgPSB7IGNvbnN0cnVjdG9yOiBDb250ZXh0LCByZXNldDogZnVuY3Rpb24gcmVzZXQoc2tpcFRlbXBSZXNldCkge2lmICh0aGlzLnByZXYgPSAwLCB0aGlzLm5leHQgPSAwLCB0aGlzLnNlbnQgPSB0aGlzLl9zZW50ID0gdW5kZWZpbmVkLCB0aGlzLmRvbmUgPSAhMSwgdGhpcy5kZWxlZ2F0ZSA9IG51bGwsIHRoaXMubWV0aG9kID0gIm5leHQiLCB0aGlzLmFyZyA9IHVuZGVmaW5lZCwgdGhpcy50cnlFbnRyaWVzLmZvckVhY2gocmVzZXRUcnlFbnRyeSksICFza2lwVGVtcFJlc2V0KSBmb3IgKHZhciBuYW1lIGluIHRoaXMpICJ0IiA9PT0gbmFtZS5jaGFyQXQoMCkgJiYgaGFzT3duLmNhbGwodGhpcywgbmFtZSkgJiYgIWlzTmFOKCtuYW1lLnNsaWNlKDEpKSAmJiAodGhpc1tuYW1lXSA9IHVuZGVmaW5lZCk7fSwgc3RvcDogZnVuY3Rpb24gc3RvcCgpIHt0aGlzLmRvbmUgPSAhMDt2YXIgcm9vdFJlY29yZCA9IHRoaXMudHJ5RW50cmllc1swXS5jb21wbGV0aW9uO2lmICgidGhyb3ciID09PSByb290UmVjb3JkLnR5cGUpIHRocm93IHJvb3RSZWNvcmQuYXJnO3JldHVybiB0aGlzLnJ2YWw7fSwgZGlzcGF0Y2hFeGNlcHRpb246IGZ1bmN0aW9uIGRpc3BhdGNoRXhjZXB0aW9uKGV4Y2VwdGlvbikge2lmICh0aGlzLmRvbmUpIHRocm93IGV4Y2VwdGlvbjt2YXIgY29udGV4dCA9IHRoaXM7ZnVuY3Rpb24gaGFuZGxlKGxvYywgY2F1Z2h0KSB7cmV0dXJuIHJlY29yZC50eXBlID0gInRocm93IiwgcmVjb3JkLmFyZyA9IGV4Y2VwdGlvbiwgY29udGV4dC5uZXh0ID0gbG9jLCBjYXVnaHQgJiYgKGNvbnRleHQubWV0aG9kID0gIm5leHQiLCBjb250ZXh0LmFyZyA9IHVuZGVmaW5lZCksICEhY2F1Z2h0O31mb3IgKHZhciBpID0gdGhpcy50cnlFbnRyaWVzLmxlbmd0aCAtIDE7IGkgPj0gMDsgLS1pKSB7dmFyIGVudHJ5ID0gdGhpcy50cnlFbnRyaWVzW2ldLHJlY29yZCA9IGVudHJ5LmNvbXBsZXRpb247aWYgKCJyb290IiA9PT0gZW50cnkudHJ5TG9jKSByZXR1cm4gaGFuZGxlKCJlbmQiKTtpZiAoZW50cnkudHJ5TG9jIDw9IHRoaXMucHJldikge3ZhciBoYXNDYXRjaCA9IGhhc093bi5jYWxsKGVudHJ5LCAiY2F0Y2hMb2MiKSxoYXNGaW5hbGx5ID0gaGFzT3duLmNhbGwoZW50cnksICJmaW5hbGx5TG9jIik7aWYgKGhhc0NhdGNoICYmIGhhc0ZpbmFsbHkpIHtpZiAodGhpcy5wcmV2IDwgZW50cnkuY2F0Y2hMb2MpIHJldHVybiBoYW5kbGUoZW50cnkuY2F0Y2hMb2MsICEwKTtpZiAodGhpcy5wcmV2IDwgZW50cnkuZmluYWxseUxvYykgcmV0dXJuIGhhbmRsZShlbnRyeS5maW5hbGx5TG9jKTt9IGVsc2UgaWYgKGhhc0NhdGNoKSB7aWYgKHRoaXMucHJldiA8IGVudHJ5LmNhdGNoTG9jKSByZXR1cm4gaGFuZGxlKGVudHJ5LmNhdGNoTG9jLCAhMCk7fSBlbHNlIHtpZiAoIWhhc0ZpbmFsbHkpIHRocm93IG5ldyBFcnJvcigidHJ5IHN0YXRlbWVudCB3aXRob3V0IGNhdGNoIG9yIGZpbmFsbHkiKTtpZiAodGhpcy5wcmV2IDwgZW50cnkuZmluYWxseUxvYykgcmV0dXJuIGhhbmRsZShlbnRyeS5maW5hbGx5TG9jKTt9fX19LCBhYnJ1cHQ6IGZ1bmN0aW9uIGFicnVwdCh0eXBlLCBhcmcpIHtmb3IgKHZhciBpID0gdGhpcy50cnlFbnRyaWVzLmxlbmd0aCAtIDE7IGkgPj0gMDsgLS1pKSB7dmFyIGVudHJ5ID0gdGhpcy50cnlFbnRyaWVzW2ldO2lmIChlbnRyeS50cnlMb2MgPD0gdGhpcy5wcmV2ICYmIGhhc093bi5jYWxsKGVudHJ5LCAiZmluYWxseUxvYyIpICYmIHRoaXMucHJldiA8IGVudHJ5LmZpbmFsbHlMb2MpIHt2YXIgZmluYWxseUVudHJ5ID0gZW50cnk7YnJlYWs7fX1maW5hbGx5RW50cnkgJiYgKCJicmVhayIgPT09IHR5cGUgfHwgImNvbnRpbnVlIiA9PT0gdHlwZSkgJiYgZmluYWxseUVudHJ5LnRyeUxvYyA8PSBhcmcgJiYgYXJnIDw9IGZpbmFsbHlFbnRyeS5maW5hbGx5TG9jICYmIChmaW5hbGx5RW50cnkgPSBudWxsKTt2YXIgcmVjb3JkID0gZmluYWxseUVudHJ5ID8gZmluYWxseUVudHJ5LmNvbXBsZXRpb24gOiB7fTtyZXR1cm4gcmVjb3JkLnR5cGUgPSB0eXBlLCByZWNvcmQuYXJnID0gYXJnLCBmaW5hbGx5RW50cnkgPyAodGhpcy5tZXRob2QgPSAibmV4dCIsIHRoaXMubmV4dCA9IGZpbmFsbHlFbnRyeS5maW5hbGx5TG9jLCBDb250aW51ZVNlbnRpbmVsKSA6IHRoaXMuY29tcGxldGUocmVjb3JkKTt9LCBjb21wbGV0ZTogZnVuY3Rpb24gY29tcGxldGUocmVjb3JkLCBhZnRlckxvYykge2lmICgidGhyb3ciID09PSByZWNvcmQudHlwZSkgdGhyb3cgcmVjb3JkLmFyZztyZXR1cm4gImJyZWFrIiA9PT0gcmVjb3JkLnR5cGUgfHwgImNvbnRpbnVlIiA9PT0gcmVjb3JkLnR5cGUgPyB0aGlzLm5leHQgPSByZWNvcmQuYXJnIDogInJldHVybiIgPT09IHJlY29yZC50eXBlID8gKHRoaXMucnZhbCA9IHRoaXMuYXJnID0gcmVjb3JkLmFyZywgdGhpcy5tZXRob2QgPSAicmV0dXJuIiwgdGhpcy5uZXh0ID0gImVuZCIpIDogIm5vcm1hbCIgPT09IHJlY29yZC50eXBlICYmIGFmdGVyTG9jICYmICh0aGlzLm5leHQgPSBhZnRlckxvYyksIENvbnRpbnVlU2VudGluZWw7fSwgZmluaXNoOiBmdW5jdGlvbiBmaW5pc2goZmluYWxseUxvYykge2ZvciAodmFyIGkgPSB0aGlzLnRyeUVudHJpZXMubGVuZ3RoIC0gMTsgaSA+PSAwOyAtLWkpIHt2YXIgZW50cnkgPSB0aGlzLnRyeUVudHJpZXNbaV07aWYgKGVudHJ5LmZpbmFsbHlMb2MgPT09IGZpbmFsbHlMb2MpIHJldHVybiB0aGlzLmNvbXBsZXRlKGVudHJ5LmNvbXBsZXRpb24sIGVudHJ5LmFmdGVyTG9jKSwgcmVzZXRUcnlFbnRyeShlbnRyeSksIENvbnRpbnVlU2VudGluZWw7fX0sIGNhdGNoOiBmdW5jdGlvbiBfY2F0Y2godHJ5TG9jKSB7Zm9yICh2YXIgaSA9IHRoaXMudHJ5RW50cmllcy5sZW5ndGggLSAxOyBpID49IDA7IC0taSkge3ZhciBlbnRyeSA9IHRoaXMudHJ5RW50cmllc1tpXTtpZiAoZW50cnkudHJ5TG9jID09PSB0cnlMb2MpIHt2YXIgcmVjb3JkID0gZW50cnkuY29tcGxldGlvbjtpZiAoInRocm93IiA9PT0gcmVjb3JkLnR5cGUpIHt2YXIgdGhyb3duID0gcmVjb3JkLmFyZztyZXNldFRyeUVudHJ5KGVudHJ5KTt9cmV0dXJuIHRocm93bjt9fXRocm93IG5ldyBFcnJvcigiaWxsZWdhbCBjYXRjaCBhdHRlbXB0Iik7fSwgZGVsZWdhdGVZaWVsZDogZnVuY3Rpb24gZGVsZWdhdGVZaWVsZChpdGVyYWJsZSwgcmVzdWx0TmFtZSwgbmV4dExvYykge3JldHVybiB0aGlzLmRlbGVnYXRlID0geyBpdGVyYXRvcjogdmFsdWVzKGl0ZXJhYmxlKSwgcmVzdWx0TmFtZTogcmVzdWx0TmFtZSwgbmV4dExvYzogbmV4dExvYyB9LCAibmV4dCIgPT09IHRoaXMubWV0aG9kICYmICh0aGlzLmFyZyA9IHVuZGVmaW5lZCksIENvbnRpbnVlU2VudGluZWw7fSB9LCBleHBvcnRzO31mdW5jdGlvbiBhc3luY0dlbmVyYXRvclN0ZXAoZ2VuLCByZXNvbHZlLCByZWplY3QsIF9uZXh0LCBfdGhyb3csIGtleSwgYXJnKSB7dHJ5IHt2YXIgaW5mbyA9IGdlbltrZXldKGFyZyk7dmFyIHZhbHVlID0gaW5mby52YWx1ZTt9IGNhdGNoIChlcnJvcikge3JlamVjdChlcnJvcik7cmV0dXJuO31pZiAoaW5mby5kb25lKSB7cmVzb2x2ZSh2YWx1ZSk7fSBlbHNlIHtQcm9taXNlLnJlc29sdmUodmFsdWUpLnRoZW4oX25leHQsIF90aHJvdyk7fX1mdW5jdGlvbiBfYXN5bmNUb0dlbmVyYXRvcjIoZm4pIHtyZXR1cm4gZnVuY3Rpb24gKCkge3ZhciBzZWxmID0gdGhpcyxhcmdzID0gYXJndW1lbnRzO3JldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7dmFyIGdlbiA9IGZuLmFwcGx5KHNlbGYsIGFyZ3MpO2Z1bmN0aW9uIF9uZXh0KHZhbHVlKSB7YXN5bmNHZW5lcmF0b3JTdGVwKGdlbiwgcmVzb2x2ZSwgcmVqZWN0LCBfbmV4dCwgX3Rocm93LCAibmV4dCIsIHZhbHVlKTt9ZnVuY3Rpb24gX3Rocm93KGVycikge2FzeW5jR2VuZXJhdG9yU3RlcChnZW4sIHJlc29sdmUsIHJlamVjdCwgX25leHQsIF90aHJvdywgInRocm93IiwgZXJyKTt9X25leHQodW5kZWZpbmVkKTt9KTt9O31mdW5jdGlvbiBfZGVmaW5lUHJvcGVydHkyKG9iaiwga2V5LCB2YWx1ZSkge2tleSA9IF90b1Byb3BlcnR5S2V5MihrZXkpO2lmIChrZXkgaW4gb2JqKSB7T2JqZWN0LmRlZmluZVByb3BlcnR5KG9iaiwga2V5LCB7IHZhbHVlOiB2YWx1ZSwgZW51bWVyYWJsZTogdHJ1ZSwgY29uZmlndXJhYmxlOiB0cnVlLCB3cml0YWJsZTogdHJ1ZSB9KTt9IGVsc2Uge29ialtrZXldID0gdmFsdWU7fXJldHVybiBvYmo7fWZ1bmN0aW9uIF9kZWZpbmVQcm9wZXJ0aWVzKHRhcmdldCwgcHJvcHMpIHtmb3IgKHZhciBpID0gMDsgaSA8IHByb3BzLmxlbmd0aDsgaSsrKSB7dmFyIGRlc2NyaXB0b3IgPSBwcm9wc1tpXTtkZXNjcmlwdG9yLmVudW1lcmFibGUgPSBkZXNjcmlwdG9yLmVudW1lcmFibGUgfHwgZmFsc2U7ZGVzY3JpcHRvci5jb25maWd1cmFibGUgPSB0cnVlO2lmICgidmFsdWUiIGluIGRlc2NyaXB0b3IpIGRlc2NyaXB0b3Iud3JpdGFibGUgPSB0cnVlO09iamVjdC5kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIF90b1Byb3BlcnR5S2V5MihkZXNjcmlwdG9yLmtleSksIGRlc2NyaXB0b3IpO319ZnVuY3Rpb24gX2NyZWF0ZUNsYXNzMihDb25zdHJ1Y3RvciwgcHJvdG9Qcm9wcywgc3RhdGljUHJvcHMpIHtpZiAocHJvdG9Qcm9wcykgX2RlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IucHJvdG90eXBlLCBwcm90b1Byb3BzKTtpZiAoc3RhdGljUHJvcHMpIF9kZWZpbmVQcm9wZXJ0aWVzKENvbnN0cnVjdG9yLCBzdGF0aWNQcm9wcyk7T2JqZWN0LmRlZmluZVByb3BlcnR5KENvbnN0cnVjdG9yLCAicHJvdG90eXBlIiwgeyB3cml0YWJsZTogZmFsc2UgfSk7cmV0dXJuIENvbnN0cnVjdG9yO31mdW5jdGlvbiBfdG9Qcm9wZXJ0eUtleTIoYXJnKSB7dmFyIGtleSA9IF90b1ByaW1pdGl2ZTIoYXJnLCAic3RyaW5nIik7cmV0dXJuIHR5cGVvZiBrZXkgPT09ICJzeW1ib2wiID8ga2V5IDogU3RyaW5nKGtleSk7fWZ1bmN0aW9uIF90b1ByaW1pdGl2ZTIoaW5wdXQsIGhpbnQpIHtpZiAodHlwZW9mIGlucHV0ICE9PSAib2JqZWN0IiB8fCBpbnB1dCA9PT0gbnVsbCkgcmV0dXJuIGlucHV0O3ZhciBwcmltID0gaW5wdXRbU3ltYm9sLnRvUHJpbWl0aXZlXTtpZiAocHJpbSAhPT0gdW5kZWZpbmVkKSB7dmFyIHJlcyA9IHByaW0uY2FsbChpbnB1dCwgaGludCB8fCAiZGVmYXVsdCIpO2lmICh0eXBlb2YgcmVzICE9PSAib2JqZWN0IikgcmV0dXJuIHJlczt0aHJvdyBuZXcgVHlwZUVycm9yKCJAQHRvUHJpbWl0aXZlIG11c3QgcmV0dXJuIGEgcHJpbWl0aXZlIHZhbHVlLiIpO31yZXR1cm4gKGhpbnQgPT09ICJzdHJpbmciID8gU3RyaW5nIDogTnVtYmVyKShpbnB1dCk7fWZ1bmN0aW9uIF9jbGFzc0NhbGxDaGVjazIoaW5zdGFuY2UsIENvbnN0cnVjdG9yKSB7aWYgKCEoaW5zdGFuY2UgaW5zdGFuY2VvZiBDb25zdHJ1Y3RvcikpIHt0aHJvdyBuZXcgVHlwZUVycm9yKCJDYW5ub3QgY2FsbCBhIGNsYXNzIGFzIGEgZnVuY3Rpb24iKTt9fWZ1bmN0aW9uIF9pbmhlcml0cyhzdWJDbGFzcywgc3VwZXJDbGFzcykge2lmICh0eXBlb2Ygc3VwZXJDbGFzcyAhPT0gImZ1bmN0aW9uIiAmJiBzdXBlckNsYXNzICE9PSBudWxsKSB7dGhyb3cgbmV3IFR5cGVFcnJvcigiU3VwZXIgZXhwcmVzc2lvbiBtdXN0IGVpdGhlciBiZSBudWxsIG9yIGEgZnVuY3Rpb24iKTt9c3ViQ2xhc3MucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZShzdXBlckNsYXNzICYmIHN1cGVyQ2xhc3MucHJvdG90eXBlLCB7IGNvbnN0cnVjdG9yOiB7IHZhbHVlOiBzdWJDbGFzcywgd3JpdGFibGU6IHRydWUsIGNvbmZpZ3VyYWJsZTogdHJ1ZSB9IH0pO09iamVjdC5kZWZpbmVQcm9wZXJ0eShzdWJDbGFzcywgInByb3RvdHlwZSIsIHsgd3JpdGFibGU6IGZhbHNlIH0pO2lmIChzdXBlckNsYXNzKSBfc2V0UHJvdG90eXBlT2Yoc3ViQ2xhc3MsIHN1cGVyQ2xhc3MpO31mdW5jdGlvbiBfY3JlYXRlU3VwZXIoRGVyaXZlZCkge3ZhciBoYXNOYXRpdmVSZWZsZWN0Q29uc3RydWN0ID0gX2lzTmF0aXZlUmVmbGVjdENvbnN0cnVjdCgpO3JldHVybiBmdW5jdGlvbiBfY3JlYXRlU3VwZXJJbnRlcm5hbCgpIHt2YXIgU3VwZXIgPSBfZ2V0UHJvdG90eXBlT2YoRGVyaXZlZCkscmVzdWx0O2lmIChoYXNOYXRpdmVSZWZsZWN0Q29uc3RydWN0KSB7dmFyIE5ld1RhcmdldCA9IF9nZXRQcm90b3R5cGVPZih0aGlzKS5jb25zdHJ1Y3RvcjtyZXN1bHQgPSBSZWZsZWN0LmNvbnN0cnVjdChTdXBlciwgYXJndW1lbnRzLCBOZXdUYXJnZXQpO30gZWxzZSB7cmVzdWx0ID0gU3VwZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKTt9cmV0dXJuIF9wb3NzaWJsZUNvbnN0cnVjdG9yUmV0dXJuKHRoaXMsIHJlc3VsdCk7fTt9ZnVuY3Rpb24gX3Bvc3NpYmxlQ29uc3RydWN0b3JSZXR1cm4oc2VsZiwgY2FsbCkge2lmIChjYWxsICYmICh0eXBlb2YgY2FsbCA9PT0gIm9iamVjdCIgfHwgdHlwZW9mIGNhbGwgPT09ICJmdW5jdGlvbiIpKSB7cmV0dXJuIGNhbGw7fSBlbHNlIGlmIChjYWxsICE9PSB2b2lkIDApIHt0aHJvdyBuZXcgVHlwZUVycm9yKCJEZXJpdmVkIGNvbnN0cnVjdG9ycyBtYXkgb25seSByZXR1cm4gb2JqZWN0IG9yIHVuZGVmaW5lZCIpO31yZXR1cm4gX2Fzc2VydFRoaXNJbml0aWFsaXplZChzZWxmKTt9ZnVuY3Rpb24gX2Fzc2VydFRoaXNJbml0aWFsaXplZChzZWxmKSB7aWYgKHNlbGYgPT09IHZvaWQgMCkge3Rocm93IG5ldyBSZWZlcmVuY2VFcnJvcigidGhpcyBoYXNuJ3QgYmVlbiBpbml0aWFsaXNlZCAtIHN1cGVyKCkgaGFzbid0IGJlZW4gY2FsbGVkIik7fXJldHVybiBzZWxmO31mdW5jdGlvbiBfd3JhcE5hdGl2ZVN1cGVyKENsYXNzKSB7dmFyIF9jYWNoZSA9IHR5cGVvZiBNYXAgPT09ICJmdW5jdGlvbiIgPyBuZXcgTWFwKCkgOiB1bmRlZmluZWQ7X3dyYXBOYXRpdmVTdXBlciA9IGZ1bmN0aW9uIF93cmFwTmF0aXZlU3VwZXIoQ2xhc3MpIHtpZiAoQ2xhc3MgPT09IG51bGwgfHwgIV9pc05hdGl2ZUZ1bmN0aW9uKENsYXNzKSkgcmV0dXJuIENsYXNzO2lmICh0eXBlb2YgQ2xhc3MgIT09ICJmdW5jdGlvbiIpIHt0aHJvdyBuZXcgVHlwZUVycm9yKCJTdXBlciBleHByZXNzaW9uIG11c3QgZWl0aGVyIGJlIG51bGwgb3IgYSBmdW5jdGlvbiIpO31pZiAodHlwZW9mIF9jYWNoZSAhPT0gInVuZGVmaW5lZCIpIHtpZiAoX2NhY2hlLmhhcyhDbGFzcykpIHJldHVybiBfY2FjaGUuZ2V0KENsYXNzKTtfY2FjaGUuc2V0KENsYXNzLCBXcmFwcGVyKTt9ZnVuY3Rpb24gV3JhcHBlcigpIHtyZXR1cm4gX2NvbnN0cnVjdChDbGFzcywgYXJndW1lbnRzLCBfZ2V0UHJvdG90eXBlT2YodGhpcykuY29uc3RydWN0b3IpO31XcmFwcGVyLnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoQ2xhc3MucHJvdG90eXBlLCB7IGNvbnN0cnVjdG9yOiB7IHZhbHVlOiBXcmFwcGVyLCBlbnVtZXJhYmxlOiBmYWxzZSwgd3JpdGFibGU6IHRydWUsIGNvbmZpZ3VyYWJsZTogdHJ1ZSB9IH0pO3JldHVybiBfc2V0UHJvdG90eXBlT2YoV3JhcHBlciwgQ2xhc3MpO307cmV0dXJuIF93cmFwTmF0aXZlU3VwZXIoQ2xhc3MpO31mdW5jdGlvbiBfY29uc3RydWN0KFBhcmVudCwgYXJncywgQ2xhc3MpIHtpZiAoX2lzTmF0aXZlUmVmbGVjdENvbnN0cnVjdCgpKSB7X2NvbnN0cnVjdCA9IFJlZmxlY3QuY29uc3RydWN0LmJpbmQoKTt9IGVsc2Uge19jb25zdHJ1Y3QgPSBmdW5jdGlvbiBfY29uc3RydWN0KFBhcmVudCwgYXJncywgQ2xhc3MpIHt2YXIgYSA9IFtudWxsXTthLnB1c2guYXBwbHkoYSwgYXJncyk7dmFyIENvbnN0cnVjdG9yID0gRnVuY3Rpb24uYmluZC5hcHBseShQYXJlbnQsIGEpO3ZhciBpbnN0YW5jZSA9IG5ldyBDb25zdHJ1Y3RvcigpO2lmIChDbGFzcykgX3NldFByb3RvdHlwZU9mKGluc3RhbmNlLCBDbGFzcy5wcm90b3R5cGUpO3JldHVybiBpbnN0YW5jZTt9O31yZXR1cm4gX2NvbnN0cnVjdC5hcHBseShudWxsLCBhcmd1bWVudHMpO31mdW5jdGlvbiBfaXNOYXRpdmVSZWZsZWN0Q29uc3RydWN0KCkge2lmICh0eXBlb2YgUmVmbGVjdCA9PT0gInVuZGVmaW5lZCIgfHwgIVJlZmxlY3QuY29uc3RydWN0KSByZXR1cm4gZmFsc2U7aWYgKFJlZmxlY3QuY29uc3RydWN0LnNoYW0pIHJldHVybiBmYWxzZTtpZiAodHlwZW9mIFByb3h5ID09PSAiZnVuY3Rpb24iKSByZXR1cm4gdHJ1ZTt0cnkge0Jvb2xlYW4ucHJvdG90eXBlLnZhbHVlT2YuY2FsbChSZWZsZWN0LmNvbnN0cnVjdChCb29sZWFuLCBbXSwgZnVuY3Rpb24gKCkge30pKTtyZXR1cm4gdHJ1ZTt9IGNhdGNoIChlKSB7cmV0dXJuIGZhbHNlO319ZnVuY3Rpb24gX2lzTmF0aXZlRnVuY3Rpb24oZm4pIHtyZXR1cm4gRnVuY3Rpb24udG9TdHJpbmcuY2FsbChmbikuaW5kZXhPZigiW25hdGl2ZSBjb2RlXSIpICE9PSAtMTt9ZnVuY3Rpb24gX3NldFByb3RvdHlwZU9mKG8sIHApIHtfc2V0UHJvdG90eXBlT2YgPSBPYmplY3Quc2V0UHJvdG90eXBlT2YgPyBPYmplY3Quc2V0UHJvdG90eXBlT2YuYmluZCgpIDogZnVuY3Rpb24gX3NldFByb3RvdHlwZU9mKG8sIHApIHtvLl9fcHJvdG9fXyA9IHA7cmV0dXJuIG87fTtyZXR1cm4gX3NldFByb3RvdHlwZU9mKG8sIHApO31mdW5jdGlvbiBfZ2V0UHJvdG90eXBlT2Yobykge19nZXRQcm90b3R5cGVPZiA9IE9iamVjdC5zZXRQcm90b3R5cGVPZiA/IE9iamVjdC5nZXRQcm90b3R5cGVPZi5iaW5kKCkgOiBmdW5jdGlvbiBfZ2V0UHJvdG90eXBlT2Yobykge3JldHVybiBvLl9fcHJvdG9fXyB8fCBPYmplY3QuZ2V0UHJvdG90eXBlT2Yobyk7fTtyZXR1cm4gX2dldFByb3RvdHlwZU9mKG8pO31mdW5jdGlvbiBfc2xpY2VkVG9BcnJheTIoYXJyLCBpKSB7cmV0dXJuIF9hcnJheVdpdGhIb2xlczIoYXJyKSB8fCBfaXRlcmFibGVUb0FycmF5TGltaXQyKGFyciwgaSkgfHwgX3Vuc3VwcG9ydGVkSXRlcmFibGVUb0FycmF5MihhcnIsIGkpIHx8IF9ub25JdGVyYWJsZVJlc3QyKCk7fWZ1bmN0aW9uIF9pdGVyYWJsZVRvQXJyYXlMaW1pdDIoYXJyLCBpKSB7dmFyIF9pID0gbnVsbCA9PSBhcnIgPyBudWxsIDogInVuZGVmaW5lZCIgIT0gdHlwZW9mIFN5bWJvbCAmJiBhcnJbU3ltYm9sLml0ZXJhdG9yXSB8fCBhcnJbIkBAaXRlcmF0b3IiXTtpZiAobnVsbCAhPSBfaSkge3ZhciBfcyxfZSxfeCxfcixfYXJyID0gW10sX24gPSAhMCxfZCA9ICExO3RyeSB7aWYgKF94ID0gKF9pID0gX2kuY2FsbChhcnIpKS5uZXh0LCAwID09PSBpKSB7aWYgKE9iamVjdChfaSkgIT09IF9pKSByZXR1cm47X24gPSAhMTt9IGVsc2UgZm9yICg7ICEoX24gPSAoX3MgPSBfeC5jYWxsKF9pKSkuZG9uZSkgJiYgKF9hcnIucHVzaChfcy52YWx1ZSksIF9hcnIubGVuZ3RoICE9PSBpKTsgX24gPSAhMCk7fSBjYXRjaCAoZXJyKSB7X2QgPSAhMCwgX2UgPSBlcnI7fSBmaW5hbGx5IHt0cnkge2lmICghX24gJiYgbnVsbCAhPSBfaS5yZXR1cm4gJiYgKF9yID0gX2kucmV0dXJuKCksIE9iamVjdChfcikgIT09IF9yKSkgcmV0dXJuO30gZmluYWxseSB7aWYgKF9kKSB0aHJvdyBfZTt9fXJldHVybiBfYXJyO319ZnVuY3Rpb24gX3RvQXJyYXkoYXJyKSB7cmV0dXJuIF9hcnJheVdpdGhIb2xlczIoYXJyKSB8fCBfaXRlcmFibGVUb0FycmF5MihhcnIpIHx8IF91bnN1cHBvcnRlZEl0ZXJhYmxlVG9BcnJheTIoYXJyKSB8fCBfbm9uSXRlcmFibGVSZXN0MigpO31mdW5jdGlvbiBfbm9uSXRlcmFibGVSZXN0MigpIHt0aHJvdyBuZXcgVHlwZUVycm9yKCJJbnZhbGlkIGF0dGVtcHQgdG8gZGVzdHJ1Y3R1cmUgbm9uLWl0ZXJhYmxlIGluc3RhbmNlLlxuSW4gb3JkZXIgdG8gYmUgaXRlcmFibGUsIG5vbi1hcnJheSBvYmplY3RzIG11c3QgaGF2ZSBhIFtTeW1ib2wuaXRlcmF0b3JdKCkgbWV0aG9kLiIpO31mdW5jdGlvbiBfYXJyYXlXaXRoSG9sZXMyKGFycikge2lmIChBcnJheS5pc0FycmF5KGFycikpIHJldHVybiBhcnI7fWZ1bmN0aW9uIF9jcmVhdGVGb3JPZkl0ZXJhdG9ySGVscGVyMihvLCBhbGxvd0FycmF5TGlrZSkge3ZhciBpdCA9IHR5cGVvZiBTeW1ib2wgIT09ICJ1bmRlZmluZWQiICYmIG9bU3ltYm9sLml0ZXJhdG9yXSB8fCBvWyJAQGl0ZXJhdG9yIl07aWYgKCFpdCkge2lmIChBcnJheS5pc0FycmF5KG8pIHx8IChpdCA9IF91bnN1cHBvcnRlZEl0ZXJhYmxlVG9BcnJheTIobykpIHx8IGFsbG93QXJyYXlMaWtlICYmIG8gJiYgdHlwZW9mIG8ubGVuZ3RoID09PSAibnVtYmVyIikge2lmIChpdCkgbyA9IGl0O3ZhciBpID0gMDt2YXIgRiA9IGZ1bmN0aW9uIEYoKSB7fTtyZXR1cm4geyBzOiBGLCBuOiBmdW5jdGlvbiBuKCkge2lmIChpID49IG8ubGVuZ3RoKSByZXR1cm4geyBkb25lOiB0cnVlIH07cmV0dXJuIHsgZG9uZTogZmFsc2UsIHZhbHVlOiBvW2krK10gfTt9LCBlOiBmdW5jdGlvbiBlKF9lNCkge3Rocm93IF9lNDt9LCBmOiBGIH07fXRocm93IG5ldyBUeXBlRXJyb3IoIkludmFsaWQgYXR0ZW1wdCB0byBpdGVyYXRlIG5vbi1pdGVyYWJsZSBpbnN0YW5jZS5cbkluIG9yZGVyIHRvIGJlIGl0ZXJhYmxlLCBub24tYXJyYXkgb2JqZWN0cyBtdXN0IGhhdmUgYSBbU3ltYm9sLml0ZXJhdG9yXSgpIG1ldGhvZC4iKTt9dmFyIG5vcm1hbENvbXBsZXRpb24gPSB0cnVlLGRpZEVyciA9IGZhbHNlLGVycjtyZXR1cm4geyBzOiBmdW5jdGlvbiBzKCkge2l0ID0gaXQuY2FsbChvKTt9LCBuOiBmdW5jdGlvbiBuKCkge3ZhciBzdGVwID0gaXQubmV4dCgpO25vcm1hbENvbXBsZXRpb24gPSBzdGVwLmRvbmU7cmV0dXJuIHN0ZXA7fSwgZTogZnVuY3Rpb24gZShfZTUpIHtkaWRFcnIgPSB0cnVlO2VyciA9IF9lNTt9LCBmOiBmdW5jdGlvbiBmKCkge3RyeSB7aWYgKCFub3JtYWxDb21wbGV0aW9uICYmIGl0LnJldHVybiAhPSBudWxsKSBpdC5yZXR1cm4oKTt9IGZpbmFsbHkge2lmIChkaWRFcnIpIHRocm93IGVycjt9fSB9O31mdW5jdGlvbiBfdG9Db25zdW1hYmxlQXJyYXkyKGFycikge3JldHVybiBfYXJyYXlXaXRob3V0SG9sZXMyKGFycikgfHwgX2l0ZXJhYmxlVG9BcnJheTIoYXJyKSB8fCBfdW5zdXBwb3J0ZWRJdGVyYWJsZVRvQXJyYXkyKGFycikgfHwgX25vbkl0ZXJhYmxlU3ByZWFkMigpO31mdW5jdGlvbiBfbm9uSXRlcmFibGVTcHJlYWQyKCkge3Rocm93IG5ldyBUeXBlRXJyb3IoIkludmFsaWQgYXR0ZW1wdCB0byBzcHJlYWQgbm9uLWl0ZXJhYmxlIGluc3RhbmNlLlxuSW4gb3JkZXIgdG8gYmUgaXRlcmFibGUsIG5vbi1hcnJheSBvYmplY3RzIG11c3QgaGF2ZSBhIFtTeW1ib2wuaXRlcmF0b3JdKCkgbWV0aG9kLiIpO31mdW5jdGlvbiBfdW5zdXBwb3J0ZWRJdGVyYWJsZVRvQXJyYXkyKG8sIG1pbkxlbikge2lmICghbykgcmV0dXJuO2lmICh0eXBlb2YgbyA9PT0gInN0cmluZyIpIHJldHVybiBfYXJyYXlMaWtlVG9BcnJheTIobywgbWluTGVuKTt2YXIgbiA9IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChvKS5zbGljZSg4LCAtMSk7aWYgKG4gPT09ICJPYmplY3QiICYmIG8uY29uc3RydWN0b3IpIG4gPSBvLmNvbnN0cnVjdG9yLm5hbWU7aWYgKG4gPT09ICJNYXAiIHx8IG4gPT09ICJTZXQiKSByZXR1cm4gQXJyYXkuZnJvbShvKTtpZiAobiA9PT0gIkFyZ3VtZW50cyIgfHwgL14oPzpVaXxJKW50KD86OHwxNnwzMikoPzpDbGFtcGVkKT9BcnJheSQvLnRlc3QobikpIHJldHVybiBfYXJyYXlMaWtlVG9BcnJheTIobywgbWluTGVuKTt9ZnVuY3Rpb24gX2l0ZXJhYmxlVG9BcnJheTIoaXRlcikge2lmICh0eXBlb2YgU3ltYm9sICE9PSAidW5kZWZpbmVkIiAmJiBpdGVyW1N5bWJvbC5pdGVyYXRvcl0gIT0gbnVsbCB8fCBpdGVyWyJAQGl0ZXJhdG9yIl0gIT0gbnVsbCkgcmV0dXJuIEFycmF5LmZyb20oaXRlcik7fWZ1bmN0aW9uIF9hcnJheVdpdGhvdXRIb2xlczIoYXJyKSB7aWYgKEFycmF5LmlzQXJyYXkoYXJyKSkgcmV0dXJuIF9hcnJheUxpa2VUb0FycmF5MihhcnIpO31mdW5jdGlvbiBfYXJyYXlMaWtlVG9BcnJheTIoYXJyLCBsZW4pIHtpZiAobGVuID09IG51bGwgfHwgbGVuID4gYXJyLmxlbmd0aCkgbGVuID0gYXJyLmxlbmd0aDtmb3IgKHZhciBpID0gMCwgYXJyMiA9IG5ldyBBcnJheShsZW4pOyBpIDwgbGVuOyBpKyspIGFycjJbaV0gPSBhcnJbaV07cmV0dXJuIGFycjI7fShmdW5jdGlvbiB3ZWJwYWNrVW5pdmVyc2FsTW9kdWxlRGVmaW5pdGlvbihyb290LCBmYWN0b3J5KSB7aWYgKHR5cGVvZiBleHBvcnRzID09PSAnb2JqZWN0JyAmJiB0eXBlb2YgbW9kdWxlID09PSAnb2JqZWN0JykKICBtb2R1bGUuZXhwb3J0cyA9IGZhY3RvcnkoKTtlbHNlCiAgaWYgKHR5cGVvZiBkZWZpbmUgPT09ICdmdW5jdGlvbicgJiYgZGVmaW5lLmFtZCkKICBkZWZpbmUoW10sIGZhY3RvcnkpO2Vsc2UKICB7CiAgICB2YXIgYSA9IGZhY3RvcnkoKTsKICAgIGZvciAodmFyIGkgaW4gYSkgKHR5cGVvZiBleHBvcnRzID09PSAnb2JqZWN0JyA/IGV4cG9ydHMgOiByb290KVtpXSA9IGFbaV07CiAgfQp9KShzZWxmLCAoKSA9PiB7CiAgcmV0dXJuICgvKioqKioqLygoKSA9PiB7Ly8gd2VicGFja0Jvb3RzdHJhcAogICAgICAvKioqKioqLyJ1c2Ugc3RyaWN0IjsKICAgICAgLyoqKioqKi92YXIgX193ZWJwYWNrX21vZHVsZXNfXyA9IHsKCiAgICAgICAgLyoqKi84ODc6CiAgICAgICAgLyoqKi8oX191bnVzZWRfd2VicGFja19tb2R1bGUsIF9fd2VicGFja19leHBvcnRzX18sIF9fd2VicGFja19yZXF1aXJlX18pID0+IHsKCgogICAgICAgICAgLy8gRVhQT1JUUwogICAgICAgICAgX193ZWJwYWNrX3JlcXVpcmVfXy5kKF9fd2VicGFja19leHBvcnRzX18sIHsKICAgICAgICAgICAgIloiOiAoKSA9PiAvKiBiaW5kaW5nICovcmVsYXlfQXBwCiAgICAgICAgICB9KTsKCiAgICAgICAgICA7IC8vIENPTkNBVEVOQVRFRCBNT0RVTEU6IC4vbm9kZV9tb2R1bGVzL0ByZW1peC1ydW4vcm91dGVyL2Rpc3Qvcm91dGVyLmpzCiAgICAgICAgICAvKioKICAgICAgICAgICAqIEByZW1peC1ydW4vcm91dGVyIHYxLjMuMAogICAgICAgICAgICoKICAgICAgICAgICAqIENvcHlyaWdodCAoYykgUmVtaXggU29mdHdhcmUgSW5jLgogICAgICAgICAgICoKICAgICAgICAgICAqIFRoaXMgc291cmNlIGNvZGUgaXMgbGljZW5zZWQgdW5kZXIgdGhlIE1JVCBsaWNlbnNlIGZvdW5kIGluIHRoZQogICAgICAgICAgICogTElDRU5TRS5tZCBmaWxlIGluIHRoZSByb290IGRpcmVjdG9yeSBvZiB0aGlzIHNvdXJjZSB0cmVlLgogICAgICAgICAgICoKICAgICAgICAgICAqIEBsaWNlbnNlIE1JVAogICAgICAgICAgICovCiAgICAgICAgICBmdW5jdGlvbiBfZXh0ZW5kcygpIHsKICAgICAgICAgICAgX2V4dGVuZHMgPSBPYmplY3QuYXNzaWduID8gT2JqZWN0LmFzc2lnbi5iaW5kKCkgOiBmdW5jdGlvbiAodGFyZ2V0KSB7CiAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDE7IGkgPCBhcmd1bWVudHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICAgIHZhciBzb3VyY2UgPSBhcmd1bWVudHNbaV07CgogICAgICAgICAgICAgICAgZm9yICh2YXIga2V5IGluIHNvdXJjZSkgewogICAgICAgICAgICAgICAgICBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKHNvdXJjZSwga2V5KSkgewogICAgICAgICAgICAgICAgICAgIHRhcmdldFtrZXldID0gc291cmNlW2tleV07CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIHJldHVybiB0YXJnZXQ7CiAgICAgICAgICAgIH07CiAgICAgICAgICAgIHJldHVybiBfZXh0ZW5kcy5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICAgICAgfQoKICAgICAgICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCiAgICAgICAgICAvLyNyZWdpb24gVHlwZXMgYW5kIENvbnN0YW50cwogICAgICAgICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KCiAgICAgICAgICAvKioKICAgICAgICAgICAqIEFjdGlvbnMgcmVwcmVzZW50IHRoZSB0eXBlIG9mIGNoYW5nZSB0byBhIGxvY2F0aW9uIHZhbHVlLgogICAgICAgICAgICovCiAgICAgICAgICB2YXIgQWN0aW9uOwoKICAgICAgICAgIChmdW5jdGlvbiAoQWN0aW9uKSB7CiAgICAgICAgICAgIC8qKgogICAgICAgICAgICAgKiBBIFBPUCBpbmRpY2F0ZXMgYSBjaGFuZ2UgdG8gYW4gYXJiaXRyYXJ5IGluZGV4IGluIHRoZSBoaXN0b3J5IHN0YWNrLCBzdWNoCiAgICAgICAgICAgICAqIGFzIGEgYmFjayBvciBmb3J3YXJkIG5hdmlnYXRpb24uIEl0IGRvZXMgbm90IGRlc2NyaWJlIHRoZSBkaXJlY3Rpb24gb2YgdGhlCiAgICAgICAgICAgICAqIG5hdmlnYXRpb24sIG9ubHkgdGhhdCB0aGUgY3VycmVudCBpbmRleCBjaGFuZ2VkLgogICAgICAgICAgICAgKgogICAgICAgICAgICAgKiBOb3RlOiBUaGlzIGlzIHRoZSBkZWZhdWx0IGFjdGlvbiBmb3IgbmV3bHkgY3JlYXRlZCBoaXN0b3J5IG9iamVjdHMuCiAgICAgICAgICAgICAqLwogICAgICAgICAgICBBY3Rpb25bIlBvcCJdID0gIlBPUCI7CiAgICAgICAgICAgIC8qKgogICAgICAgICAgICAgKiBBIFBVU0ggaW5kaWNhdGVzIGEgbmV3IGVudHJ5IGJlaW5nIGFkZGVkIHRvIHRoZSBoaXN0b3J5IHN0YWNrLCBzdWNoIGFzIHdoZW4KICAgICAgICAgICAgICogYSBsaW5rIGlzIGNsaWNrZWQgYW5kIGEgbmV3IHBhZ2UgbG9hZHMuIFdoZW4gdGhpcyBoYXBwZW5zLCBhbGwgc3Vic2VxdWVudAogICAgICAgICAgICAgKiBlbnRyaWVzIGluIHRoZSBzdGFjayBhcmUgbG9zdC4KICAgICAgICAgICAgICovCgogICAgICAgICAgICBBY3Rpb25bIlB1c2giXSA9ICJQVVNIIjsKICAgICAgICAgICAgLyoqCiAgICAgICAgICAgICAqIEEgUkVQTEFDRSBpbmRpY2F0ZXMgdGhlIGVudHJ5IGF0IHRoZSBjdXJyZW50IGluZGV4IGluIHRoZSBoaXN0b3J5IHN0YWNrCiAgICAgICAgICAgICAqIGJlaW5nIHJlcGxhY2VkIGJ5IGEgbmV3IG9uZS4KICAgICAgICAgICAgICovCgogICAgICAgICAgICBBY3Rpb25bIlJlcGxhY2UiXSA9ICJSRVBMQUNFIjsKICAgICAgICAgIH0pKEFjdGlvbiB8fCAoQWN0aW9uID0ge30pKTsKCiAgICAgICAgICB2YXIgUG9wU3RhdGVFdmVudFR5cGUgPSAicG9wc3RhdGUiOwogICAgICAgICAgLyoqCiAgICAgICAgICAgKiBNZW1vcnkgaGlzdG9yeSBzdG9yZXMgdGhlIGN1cnJlbnQgbG9jYXRpb24gaW4gbWVtb3J5LiBJdCBpcyBkZXNpZ25lZCBmb3IgdXNlCiAgICAgICAgICAgKiBpbiBzdGF0ZWZ1bCBub24tYnJvd3NlciBlbnZpcm9ubWVudHMgbGlrZSB0ZXN0cyBhbmQgUmVhY3QgTmF0aXZlLgogICAgICAgICAgICovCgogICAgICAgICAgZnVuY3Rpb24gcm91dGVyX2NyZWF0ZU1lbW9yeUhpc3Rvcnkob3B0aW9ucykgewogICAgICAgICAgICBpZiAob3B0aW9ucyA9PT0gdm9pZCAwKSB7CiAgICAgICAgICAgICAgb3B0aW9ucyA9IHt9OwogICAgICAgICAgICB9CgogICAgICAgICAgICB2YXIgX29wdGlvbnMgPQoKCgogICAgICAgICAgICAgIG9wdGlvbnMsX29wdGlvbnMkaW5pdGlhbEVudHJpID0gX29wdGlvbnMuaW5pdGlhbEVudHJpZXMsaW5pdGlhbEVudHJpZXMgPSBfb3B0aW9ucyRpbml0aWFsRW50cmkgPT09IHZvaWQgMCA/IFsiLyJdIDogX29wdGlvbnMkaW5pdGlhbEVudHJpLGluaXRpYWxJbmRleCA9IF9vcHRpb25zLmluaXRpYWxJbmRleCxfb3B0aW9ucyR2NUNvbXBhdCA9IF9vcHRpb25zLnY1Q29tcGF0LHY1Q29tcGF0ID0gX29wdGlvbnMkdjVDb21wYXQgPT09IHZvaWQgMCA/IGZhbHNlIDogX29wdGlvbnMkdjVDb21wYXQ7CiAgICAgICAgICAgIHZhciBlbnRyaWVzOyAvLyBEZWNsYXJlIHNvIHdlIGNhbiBhY2Nlc3MgZnJvbSBjcmVhdGVNZW1vcnlMb2NhdGlvbgoKICAgICAgICAgICAgZW50cmllcyA9IGluaXRpYWxFbnRyaWVzLm1hcCgoZW50cnksIGluZGV4KSA9PiBjcmVhdGVNZW1vcnlMb2NhdGlvbihlbnRyeSwgdHlwZW9mIGVudHJ5ID09PSAic3RyaW5nIiA/IG51bGwgOiBlbnRyeS5zdGF0ZSwgaW5kZXggPT09IDAgPyAiZGVmYXVsdCIgOiB1bmRlZmluZWQpKTsKICAgICAgICAgICAgdmFyIGluZGV4ID0gY2xhbXBJbmRleChpbml0aWFsSW5kZXggPT0gbnVsbCA/IGVudHJpZXMubGVuZ3RoIC0gMSA6IGluaXRpYWxJbmRleCk7CiAgICAgICAgICAgIHZhciBhY3Rpb24gPSBBY3Rpb24uUG9wOwogICAgICAgICAgICB2YXIgbGlzdGVuZXIgPSBudWxsOwoKICAgICAgICAgICAgZnVuY3Rpb24gY2xhbXBJbmRleChuKSB7CiAgICAgICAgICAgICAgcmV0dXJuIE1hdGgubWluKE1hdGgubWF4KG4sIDApLCBlbnRyaWVzLmxlbmd0aCAtIDEpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBmdW5jdGlvbiBnZXRDdXJyZW50TG9jYXRpb24oKSB7CiAgICAgICAgICAgICAgcmV0dXJuIGVudHJpZXNbaW5kZXhdOwogICAgICAgICAgICB9CgogICAgICAgICAgICBmdW5jdGlvbiBjcmVhdGVNZW1vcnlMb2NhdGlvbih0bywgc3RhdGUsIGtleSkgewogICAgICAgICAgICAgIGlmIChzdGF0ZSA9PT0gdm9pZCAwKSB7CiAgICAgICAgICAgICAgICBzdGF0ZSA9IG51bGw7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICB2YXIgbG9jYXRpb24gPSBjcmVhdGVMb2NhdGlvbihlbnRyaWVzID8gZ2V0Q3VycmVudExvY2F0aW9uKCkucGF0aG5hbWUgOiAiLyIsIHRvLCBzdGF0ZSwga2V5KTsKICAgICAgICAgICAgICB3YXJuaW5nJDEobG9jYXRpb24ucGF0aG5hbWUuY2hhckF0KDApID09PSAiLyIsICJyZWxhdGl2ZSBwYXRobmFtZXMgYXJlIG5vdCBzdXBwb3J0ZWQgaW4gbWVtb3J5IGhpc3Rvcnk6ICIgKyBKU09OLnN0cmluZ2lmeSh0bykpOwogICAgICAgICAgICAgIHJldHVybiBsb2NhdGlvbjsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgZnVuY3Rpb24gY3JlYXRlSHJlZih0bykgewogICAgICAgICAgICAgIHJldHVybiB0eXBlb2YgdG8gPT09ICJzdHJpbmciID8gdG8gOiByb3V0ZXJfY3JlYXRlUGF0aCh0byk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHZhciBoaXN0b3J5ID0gewogICAgICAgICAgICAgIGdldCBpbmRleCgpIHsKICAgICAgICAgICAgICAgIHJldHVybiBpbmRleDsKICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICBnZXQgYWN0aW9uKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIGFjdGlvbjsKICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICBnZXQgbG9jYXRpb24oKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gZ2V0Q3VycmVudExvY2F0aW9uKCk7CiAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgY3JlYXRlSHJlZjogY3JlYXRlSHJlZiwKCiAgICAgICAgICAgICAgY3JlYXRlVVJMOiBmdW5jdGlvbiBjcmVhdGVVUkwodG8pIHsKICAgICAgICAgICAgICAgIHJldHVybiBuZXcgVVJMKGNyZWF0ZUhyZWYodG8pLCAiaHR0cDovL2xvY2FsaG9zdCIpOwogICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgIGVuY29kZUxvY2F0aW9uOiBmdW5jdGlvbiBlbmNvZGVMb2NhdGlvbih0bykgewogICAgICAgICAgICAgICAgdmFyIHBhdGggPSB0eXBlb2YgdG8gPT09ICJzdHJpbmciID8gcGFyc2VQYXRoKHRvKSA6IHRvOwogICAgICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgICAgcGF0aG5hbWU6IHBhdGgucGF0aG5hbWUgfHwgIiIsCiAgICAgICAgICAgICAgICAgIHNlYXJjaDogcGF0aC5zZWFyY2ggfHwgIiIsCiAgICAgICAgICAgICAgICAgIGhhc2g6IHBhdGguaGFzaCB8fCAiIgogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICBwdXNoOiBmdW5jdGlvbiBwdXNoKHRvLCBzdGF0ZSkgewogICAgICAgICAgICAgICAgYWN0aW9uID0gQWN0aW9uLlB1c2g7CiAgICAgICAgICAgICAgICB2YXIgbmV4dExvY2F0aW9uID0gY3JlYXRlTWVtb3J5TG9jYXRpb24odG8sIHN0YXRlKTsKICAgICAgICAgICAgICAgIGluZGV4ICs9IDE7CiAgICAgICAgICAgICAgICBlbnRyaWVzLnNwbGljZShpbmRleCwgZW50cmllcy5sZW5ndGgsIG5leHRMb2NhdGlvbik7CgogICAgICAgICAgICAgICAgaWYgKHY1Q29tcGF0ICYmIGxpc3RlbmVyKSB7CiAgICAgICAgICAgICAgICAgIGxpc3RlbmVyKHsKICAgICAgICAgICAgICAgICAgICBhY3Rpb246IGFjdGlvbiwKICAgICAgICAgICAgICAgICAgICBsb2NhdGlvbjogbmV4dExvY2F0aW9uLAogICAgICAgICAgICAgICAgICAgIGRlbHRhOiAxCiAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgIHJlcGxhY2U6IGZ1bmN0aW9uIHJlcGxhY2UodG8sIHN0YXRlKSB7CiAgICAgICAgICAgICAgICBhY3Rpb24gPSBBY3Rpb24uUmVwbGFjZTsKICAgICAgICAgICAgICAgIHZhciBuZXh0TG9jYXRpb24gPSBjcmVhdGVNZW1vcnlMb2NhdGlvbih0bywgc3RhdGUpOwogICAgICAgICAgICAgICAgZW50cmllc1tpbmRleF0gPSBuZXh0TG9jYXRpb247CgogICAgICAgICAgICAgICAgaWYgKHY1Q29tcGF0ICYmIGxpc3RlbmVyKSB7CiAgICAgICAgICAgICAgICAgIGxpc3RlbmVyKHsKICAgICAgICAgICAgICAgICAgICBhY3Rpb246IGFjdGlvbiwKICAgICAgICAgICAgICAgICAgICBsb2NhdGlvbjogbmV4dExvY2F0aW9uLAogICAgICAgICAgICAgICAgICAgIGRlbHRhOiAwCiAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgIGdvOiBmdW5jdGlvbiBnbyhkZWx0YSkgewogICAgICAgICAgICAgICAgYWN0aW9uID0gQWN0aW9uLlBvcDsKICAgICAgICAgICAgICAgIHZhciBuZXh0SW5kZXggPSBjbGFtcEluZGV4KGluZGV4ICsgZGVsdGEpOwogICAgICAgICAgICAgICAgdmFyIG5leHRMb2NhdGlvbiA9IGVudHJpZXNbbmV4dEluZGV4XTsKICAgICAgICAgICAgICAgIGluZGV4ID0gbmV4dEluZGV4OwoKICAgICAgICAgICAgICAgIGlmIChsaXN0ZW5lcikgewogICAgICAgICAgICAgICAgICBsaXN0ZW5lcih7CiAgICAgICAgICAgICAgICAgICAgYWN0aW9uOiBhY3Rpb24sCiAgICAgICAgICAgICAgICAgICAgbG9jYXRpb246IG5leHRMb2NhdGlvbiwKICAgICAgICAgICAgICAgICAgICBkZWx0YTogZGVsdGEKICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgbGlzdGVuOiBmdW5jdGlvbiBsaXN0ZW4oZm4pIHsKICAgICAgICAgICAgICAgIGxpc3RlbmVyID0gZm47CiAgICAgICAgICAgICAgICByZXR1cm4gKCkgPT4gewogICAgICAgICAgICAgICAgICBsaXN0ZW5lciA9IG51bGw7CiAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgIH07CiAgICAgICAgICAgIHJldHVybiBoaXN0b3J5OwogICAgICAgICAgfQogICAgICAgICAgLyoqCiAgICAgICAgICAgKiBCcm93c2VyIGhpc3Rvcnkgc3RvcmVzIHRoZSBsb2NhdGlvbiBpbiByZWd1bGFyIFVSTHMuIFRoaXMgaXMgdGhlIHN0YW5kYXJkIGZvcgogICAgICAgICAgICogbW9zdCB3ZWIgYXBwcywgYnV0IGl0IHJlcXVpcmVzIHNvbWUgY29uZmlndXJhdGlvbiBvbiB0aGUgc2VydmVyIHRvIGVuc3VyZSB5b3UKICAgICAgICAgICAqIHNlcnZlIHRoZSBzYW1lIGFwcCBhdCBtdWx0aXBsZSBVUkxzLgogICAgICAgICAgICoKICAgICAgICAgICAqIEBzZWUgaHR0cHM6Ly9naXRodWIuY29tL3JlbWl4LXJ1bi9oaXN0b3J5L3RyZWUvbWFpbi9kb2NzL2FwaS1yZWZlcmVuY2UubWQjY3JlYXRlYnJvd3Nlcmhpc3RvcnkKICAgICAgICAgICAqLwoKICAgICAgICAgIGZ1bmN0aW9uIHJvdXRlcl9jcmVhdGVCcm93c2VySGlzdG9yeShvcHRpb25zKSB7CiAgICAgICAgICAgIGlmIChvcHRpb25zID09PSB2b2lkIDApIHsKICAgICAgICAgICAgICBvcHRpb25zID0ge307CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGZ1bmN0aW9uIGNyZWF0ZUJyb3dzZXJMb2NhdGlvbih3aW5kb3csIGdsb2JhbEhpc3RvcnkpIHsKICAgICAgICAgICAgICB2YXIgX3dpbmRvdyRsb2NhdGlvbiA9CgoKCiAgICAgICAgICAgICAgICB3aW5kb3cubG9jYXRpb24scGF0aG5hbWUgPSBfd2luZG93JGxvY2F0aW9uLnBhdGhuYW1lLHNlYXJjaCA9IF93aW5kb3ckbG9jYXRpb24uc2VhcmNoLGhhc2ggPSBfd2luZG93JGxvY2F0aW9uLmhhc2g7CiAgICAgICAgICAgICAgcmV0dXJuIGNyZWF0ZUxvY2F0aW9uKCIiLCB7CiAgICAgICAgICAgICAgICBwYXRobmFtZTogcGF0aG5hbWUsCiAgICAgICAgICAgICAgICBzZWFyY2g6IHNlYXJjaCwKICAgICAgICAgICAgICAgIGhhc2g6IGhhc2gKICAgICAgICAgICAgICB9LCAvLyBzdGF0ZSBkZWZhdWx0cyB0byBgbnVsbGAgYmVjYXVzZSBgd2luZG93Lmhpc3Rvcnkuc3RhdGVgIGRvZXMKICAgICAgICAgICAgICBnbG9iYWxIaXN0b3J5LnN0YXRlICYmIGdsb2JhbEhpc3Rvcnkuc3RhdGUudXNyIHx8IG51bGwsIGdsb2JhbEhpc3Rvcnkuc3RhdGUgJiYgZ2xvYmFsSGlzdG9yeS5zdGF0ZS5rZXkgfHwgImRlZmF1bHQiKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgZnVuY3Rpb24gY3JlYXRlQnJvd3NlckhyZWYod2luZG93LCB0bykgewogICAgICAgICAgICAgIHJldHVybiB0eXBlb2YgdG8gPT09ICJzdHJpbmciID8gdG8gOiByb3V0ZXJfY3JlYXRlUGF0aCh0byk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybiBnZXRVcmxCYXNlZEhpc3RvcnkoY3JlYXRlQnJvd3NlckxvY2F0aW9uLCBjcmVhdGVCcm93c2VySHJlZiwgbnVsbCwgb3B0aW9ucyk7CiAgICAgICAgICB9CiAgICAgICAgICAvKioKICAgICAgICAgICAqIEhhc2ggaGlzdG9yeSBzdG9yZXMgdGhlIGxvY2F0aW9uIGluIHdpbmRvdy5sb2NhdGlvbi5oYXNoLiBUaGlzIG1ha2VzIGl0IGlkZWFsCiAgICAgICAgICAgKiBmb3Igc2l0dWF0aW9ucyB3aGVyZSB5b3UgZG9uJ3Qgd2FudCB0byBzZW5kIHRoZSBsb2NhdGlvbiB0byB0aGUgc2VydmVyIGZvcgogICAgICAgICAgICogc29tZSByZWFzb24sIGVpdGhlciBiZWNhdXNlIHlvdSBkbyBjYW5ub3QgY29uZmlndXJlIGl0IG9yIHRoZSBVUkwgc3BhY2UgaXMKICAgICAgICAgICAqIHJlc2VydmVkIGZvciBzb21ldGhpbmcgZWxzZS4KICAgICAgICAgICAqCiAgICAgICAgICAgKiBAc2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9yZW1peC1ydW4vaGlzdG9yeS90cmVlL21haW4vZG9jcy9hcGktcmVmZXJlbmNlLm1kI2NyZWF0ZWhhc2hoaXN0b3J5CiAgICAgICAgICAgKi8KCiAgICAgICAgICBmdW5jdGlvbiByb3V0ZXJfY3JlYXRlSGFzaEhpc3Rvcnkob3B0aW9ucykgewogICAgICAgICAgICBpZiAob3B0aW9ucyA9PT0gdm9pZCAwKSB7CiAgICAgICAgICAgICAgb3B0aW9ucyA9IHt9OwogICAgICAgICAgICB9CgogICAgICAgICAgICBmdW5jdGlvbiBjcmVhdGVIYXNoTG9jYXRpb24od2luZG93LCBnbG9iYWxIaXN0b3J5KSB7CiAgICAgICAgICAgICAgdmFyIF9wYXJzZVBhdGggPQoKCgogICAgICAgICAgICAgICAgcGFyc2VQYXRoKHdpbmRvdy5sb2NhdGlvbi5oYXNoLnN1YnN0cigxKSksX3BhcnNlUGF0aCRwYXRobmFtZSA9IF9wYXJzZVBhdGgucGF0aG5hbWUscGF0aG5hbWUgPSBfcGFyc2VQYXRoJHBhdGhuYW1lID09PSB2b2lkIDAgPyAiLyIgOiBfcGFyc2VQYXRoJHBhdGhuYW1lLF9wYXJzZVBhdGgkc2VhcmNoID0gX3BhcnNlUGF0aC5zZWFyY2gsc2VhcmNoID0gX3BhcnNlUGF0aCRzZWFyY2ggPT09IHZvaWQgMCA/ICIiIDogX3BhcnNlUGF0aCRzZWFyY2gsX3BhcnNlUGF0aCRoYXNoID0gX3BhcnNlUGF0aC5oYXNoLGhhc2ggPSBfcGFyc2VQYXRoJGhhc2ggPT09IHZvaWQgMCA/ICIiIDogX3BhcnNlUGF0aCRoYXNoOwogICAgICAgICAgICAgIHJldHVybiBjcmVhdGVMb2NhdGlvbigiIiwgewogICAgICAgICAgICAgICAgcGF0aG5hbWU6IHBhdGhuYW1lLAogICAgICAgICAgICAgICAgc2VhcmNoOiBzZWFyY2gsCiAgICAgICAgICAgICAgICBoYXNoOiBoYXNoCiAgICAgICAgICAgICAgfSwgLy8gc3RhdGUgZGVmYXVsdHMgdG8gYG51bGxgIGJlY2F1c2UgYHdpbmRvdy5oaXN0b3J5LnN0YXRlYCBkb2VzCiAgICAgICAgICAgICAgZ2xvYmFsSGlzdG9yeS5zdGF0ZSAmJiBnbG9iYWxIaXN0b3J5LnN0YXRlLnVzciB8fCBudWxsLCBnbG9iYWxIaXN0b3J5LnN0YXRlICYmIGdsb2JhbEhpc3Rvcnkuc3RhdGUua2V5IHx8ICJkZWZhdWx0Iik7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGZ1bmN0aW9uIGNyZWF0ZUhhc2hIcmVmKHdpbmRvdywgdG8pIHsKICAgICAgICAgICAgICB2YXIgYmFzZSA9IHdpbmRvdy5kb2N1bWVudC5xdWVyeVNlbGVjdG9yKCJiYXNlIik7CiAgICAgICAgICAgICAgdmFyIGhyZWYgPSAiIjsKCiAgICAgICAgICAgICAgaWYgKGJhc2UgJiYgYmFzZS5nZXRBdHRyaWJ1dGUoImhyZWYiKSkgewogICAgICAgICAgICAgICAgdmFyIHVybCA9IHdpbmRvdy5sb2NhdGlvbi5ocmVmOwogICAgICAgICAgICAgICAgdmFyIGhhc2hJbmRleCA9IHVybC5pbmRleE9mKCIjIik7CiAgICAgICAgICAgICAgICBocmVmID0gaGFzaEluZGV4ID09PSAtMSA/IHVybCA6IHVybC5zbGljZSgwLCBoYXNoSW5kZXgpOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgcmV0dXJuIGhyZWYgKyAiIyIgKyAodHlwZW9mIHRvID09PSAic3RyaW5nIiA/IHRvIDogcm91dGVyX2NyZWF0ZVBhdGgodG8pKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgZnVuY3Rpb24gdmFsaWRhdGVIYXNoTG9jYXRpb24obG9jYXRpb24sIHRvKSB7CiAgICAgICAgICAgICAgd2FybmluZyQxKGxvY2F0aW9uLnBhdGhuYW1lLmNoYXJBdCgwKSA9PT0gIi8iLCAicmVsYXRpdmUgcGF0aG5hbWVzIGFyZSBub3Qgc3VwcG9ydGVkIGluIGhhc2ggaGlzdG9yeS5wdXNoKCIgKyBKU09OLnN0cmluZ2lmeSh0bykgKyAiKSIpOwogICAgICAgICAgICB9CgogICAgICAgICAgICByZXR1cm4gZ2V0VXJsQmFzZWRIaXN0b3J5KGNyZWF0ZUhhc2hMb2NhdGlvbiwgY3JlYXRlSGFzaEhyZWYsIHZhbGlkYXRlSGFzaExvY2F0aW9uLCBvcHRpb25zKTsKICAgICAgICAgIH0KICAgICAgICAgIGZ1bmN0aW9uIHJvdXRlcl9pbnZhcmlhbnQodmFsdWUsIG1lc3NhZ2UpIHsKICAgICAgICAgICAgaWYgKHZhbHVlID09PSBmYWxzZSB8fCB2YWx1ZSA9PT0gbnVsbCB8fCB0eXBlb2YgdmFsdWUgPT09ICJ1bmRlZmluZWQiKSB7CiAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKG1lc3NhZ2UpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CgogICAgICAgICAgZnVuY3Rpb24gd2FybmluZyQxKGNvbmQsIG1lc3NhZ2UpIHsKICAgICAgICAgICAgaWYgKCFjb25kKSB7CiAgICAgICAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG5vLWNvbnNvbGUKICAgICAgICAgICAgICBpZiAodHlwZW9mIGNvbnNvbGUgIT09ICJ1bmRlZmluZWQiKSBjb25zb2xlLndhcm4obWVzc2FnZSk7CgogICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAvLyBXZWxjb21lIHRvIGRlYnVnZ2luZyBoaXN0b3J5IQogICAgICAgICAgICAgICAgLy8KICAgICAgICAgICAgICAgIC8vIFRoaXMgZXJyb3IgaXMgdGhyb3duIGFzIGEgY29udmVuaWVuY2Ugc28geW91IGNhbiBtb3JlIGVhc2lseQogICAgICAgICAgICAgICAgLy8gZmluZCB0aGUgc291cmNlIGZvciBhIHdhcm5pbmcgdGhhdCBhcHBlYXJzIGluIHRoZSBjb25zb2xlIGJ5CiAgICAgICAgICAgICAgICAvLyBlbmFibGluZyAicGF1c2Ugb24gZXhjZXB0aW9ucyIgaW4geW91ciBKYXZhU2NyaXB0IGRlYnVnZ2VyLgogICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKG1lc3NhZ2UpOyAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tZW1wdHkKICAgICAgICAgICAgICB9IGNhdGNoIChlKSB7fQogICAgICAgICAgICB9CiAgICAgICAgICB9CgogICAgICAgICAgZnVuY3Rpb24gY3JlYXRlS2V5KCkgewogICAgICAgICAgICByZXR1cm4gTWF0aC5yYW5kb20oKS50b1N0cmluZygzNikuc3Vic3RyKDIsIDgpOwogICAgICAgICAgfQogICAgICAgICAgLyoqCiAgICAgICAgICAgKiBGb3IgYnJvd3Nlci1iYXNlZCBoaXN0b3JpZXMsIHdlIGNvbWJpbmUgdGhlIHN0YXRlIGFuZCBrZXkgaW50byBhbiBvYmplY3QKICAgICAgICAgICAqLwoKCiAgICAgICAgICBmdW5jdGlvbiBnZXRIaXN0b3J5U3RhdGUobG9jYXRpb24sIGluZGV4KSB7CiAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgdXNyOiBsb2NhdGlvbi5zdGF0ZSwKICAgICAgICAgICAgICBrZXk6IGxvY2F0aW9uLmtleSwKICAgICAgICAgICAgICBpZHg6IGluZGV4CiAgICAgICAgICAgIH07CiAgICAgICAgICB9CiAgICAgICAgICAvKioKICAgICAgICAgICAqIENyZWF0ZXMgYSBMb2NhdGlvbiBvYmplY3Qgd2l0aCBhIHVuaXF1ZSBrZXkgZnJvbSB0aGUgZ2l2ZW4gUGF0aAogICAgICAgICAgICovCgoKICAgICAgICAgIGZ1bmN0aW9uIGNyZWF0ZUxvY2F0aW9uKGN1cnJlbnQsIHRvLCBzdGF0ZSwga2V5KSB7CiAgICAgICAgICAgIGlmIChzdGF0ZSA9PT0gdm9pZCAwKSB7CiAgICAgICAgICAgICAgc3RhdGUgPSBudWxsOwogICAgICAgICAgICB9CgogICAgICAgICAgICB2YXIgbG9jYXRpb24gPSBfZXh0ZW5kcyh7CiAgICAgICAgICAgICAgcGF0aG5hbWU6IHR5cGVvZiBjdXJyZW50ID09PSAic3RyaW5nIiA/IGN1cnJlbnQgOiBjdXJyZW50LnBhdGhuYW1lLAogICAgICAgICAgICAgIHNlYXJjaDogIiIsCiAgICAgICAgICAgICAgaGFzaDogIiIKICAgICAgICAgICAgfSwgdHlwZW9mIHRvID09PSAic3RyaW5nIiA/IHBhcnNlUGF0aCh0bykgOiB0bywgewogICAgICAgICAgICAgIHN0YXRlOiBzdGF0ZSwKICAgICAgICAgICAgICAvLyBUT0RPOiBUaGlzIGNvdWxkIGJlIGNsZWFuZWQgdXAuICBwdXNoL3JlcGxhY2Ugc2hvdWxkIHByb2JhYmx5IGp1c3QgdGFrZQogICAgICAgICAgICAgIC8vIGZ1bGwgTG9jYXRpb25zIG5vdyBhbmQgYXZvaWQgdGhlIG5lZWQgdG8gcnVuIHRocm91Z2ggdGhpcyBmbG93IGF0IGFsbAogICAgICAgICAgICAgIC8vIEJ1dCB0aGF0J3MgYSBwcmV0dHkgYmlnIHJlZmFjdG9yIHRvIHRoZSBjdXJyZW50IHRlc3Qgc3VpdGUgc28gZ29pbmcgdG8KICAgICAgICAgICAgICAvLyBrZWVwIGFzIGlzIGZvciB0aGUgdGltZSBiZWluZyBhbmQganVzdCBsZXQgYW55IGluY29taW5nIGtleXMgdGFrZSBwcmVjZWRlbmNlCiAgICAgICAgICAgICAga2V5OiB0byAmJiB0by5rZXkgfHwga2V5IHx8IGNyZWF0ZUtleSgpCiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgcmV0dXJuIGxvY2F0aW9uOwogICAgICAgICAgfQogICAgICAgICAgLyoqCiAgICAgICAgICAgKiBDcmVhdGVzIGEgc3RyaW5nIFVSTCBwYXRoIGZyb20gdGhlIGdpdmVuIHBhdGhuYW1lLCBzZWFyY2gsIGFuZCBoYXNoIGNvbXBvbmVudHMuCiAgICAgICAgICAgKi8KCiAgICAgICAgICBmdW5jdGlvbiByb3V0ZXJfY3JlYXRlUGF0aChfcmVmKSB7CiAgICAgICAgICAgIHZhciBfcmVmJHBhdGhuYW1lID0KCgoKICAgICAgICAgICAgICBfcmVmLnBhdGhuYW1lLHBhdGhuYW1lID0gX3JlZiRwYXRobmFtZSA9PT0gdm9pZCAwID8gIi8iIDogX3JlZiRwYXRobmFtZSxfcmVmJHNlYXJjaCA9IF9yZWYuc2VhcmNoLHNlYXJjaCA9IF9yZWYkc2VhcmNoID09PSB2b2lkIDAgPyAiIiA6IF9yZWYkc2VhcmNoLF9yZWYkaGFzaCA9IF9yZWYuaGFzaCxoYXNoID0gX3JlZiRoYXNoID09PSB2b2lkIDAgPyAiIiA6IF9yZWYkaGFzaDsKICAgICAgICAgICAgaWYgKHNlYXJjaCAmJiBzZWFyY2ggIT09ICI/IikgcGF0aG5hbWUgKz0gc2VhcmNoLmNoYXJBdCgwKSA9PT0gIj8iID8gc2VhcmNoIDogIj8iICsgc2VhcmNoOwogICAgICAgICAgICBpZiAoaGFzaCAmJiBoYXNoICE9PSAiIyIpIHBhdGhuYW1lICs9IGhhc2guY2hhckF0KDApID09PSAiIyIgPyBoYXNoIDogIiMiICsgaGFzaDsKICAgICAgICAgICAgcmV0dXJuIHBhdGhuYW1lOwogICAgICAgICAgfQogICAgICAgICAgLyoqCiAgICAgICAgICAgKiBQYXJzZXMgYSBzdHJpbmcgVVJMIHBhdGggaW50byBpdHMgc2VwYXJhdGUgcGF0aG5hbWUsIHNlYXJjaCwgYW5kIGhhc2ggY29tcG9uZW50cy4KICAgICAgICAgICAqLwoKICAgICAgICAgIGZ1bmN0aW9uIHBhcnNlUGF0aChwYXRoKSB7CiAgICAgICAgICAgIHZhciBwYXJzZWRQYXRoID0ge307CgogICAgICAgICAgICBpZiAocGF0aCkgewogICAgICAgICAgICAgIHZhciBoYXNoSW5kZXggPSBwYXRoLmluZGV4T2YoIiMiKTsKCiAgICAgICAgICAgICAgaWYgKGhhc2hJbmRleCA+PSAwKSB7CiAgICAgICAgICAgICAgICBwYXJzZWRQYXRoLmhhc2ggPSBwYXRoLnN1YnN0cihoYXNoSW5kZXgpOwogICAgICAgICAgICAgICAgcGF0aCA9IHBhdGguc3Vic3RyKDAsIGhhc2hJbmRleCk7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICB2YXIgc2VhcmNoSW5kZXggPSBwYXRoLmluZGV4T2YoIj8iKTsKCiAgICAgICAgICAgICAgaWYgKHNlYXJjaEluZGV4ID49IDApIHsKICAgICAgICAgICAgICAgIHBhcnNlZFBhdGguc2VhcmNoID0gcGF0aC5zdWJzdHIoc2VhcmNoSW5kZXgpOwogICAgICAgICAgICAgICAgcGF0aCA9IHBhdGguc3Vic3RyKDAsIHNlYXJjaEluZGV4KTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIGlmIChwYXRoKSB7CiAgICAgICAgICAgICAgICBwYXJzZWRQYXRoLnBhdGhuYW1lID0gcGF0aDsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybiBwYXJzZWRQYXRoOwogICAgICAgICAgfQoKICAgICAgICAgIGZ1bmN0aW9uIGdldFVybEJhc2VkSGlzdG9yeShnZXRMb2NhdGlvbiwgX2NyZWF0ZUhyZWYsIHZhbGlkYXRlTG9jYXRpb24sIG9wdGlvbnMpIHsKICAgICAgICAgICAgaWYgKG9wdGlvbnMgPT09IHZvaWQgMCkgewogICAgICAgICAgICAgIG9wdGlvbnMgPSB7fTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdmFyIF9vcHRpb25zMiA9CgoKICAgICAgICAgICAgICBvcHRpb25zLF9vcHRpb25zMiR3aW5kb3cgPSBfb3B0aW9uczIud2luZG93LHdpbmRvdyA9IF9vcHRpb25zMiR3aW5kb3cgPT09IHZvaWQgMCA/IGRvY3VtZW50LmRlZmF1bHRWaWV3IDogX29wdGlvbnMyJHdpbmRvdyxfb3B0aW9uczIkdjVDb21wYXQgPSBfb3B0aW9uczIudjVDb21wYXQsdjVDb21wYXQgPSBfb3B0aW9uczIkdjVDb21wYXQgPT09IHZvaWQgMCA/IGZhbHNlIDogX29wdGlvbnMyJHY1Q29tcGF0OwogICAgICAgICAgICB2YXIgZ2xvYmFsSGlzdG9yeSA9IHdpbmRvdy5oaXN0b3J5OwogICAgICAgICAgICB2YXIgYWN0aW9uID0gQWN0aW9uLlBvcDsKICAgICAgICAgICAgdmFyIGxpc3RlbmVyID0gbnVsbDsKICAgICAgICAgICAgdmFyIGluZGV4ID0gZ2V0SW5kZXgoKTsgLy8gSW5kZXggc2hvdWxkIG9ubHkgYmUgbnVsbCB3aGVuIHdlIGluaXRpYWxpemUuIElmIG5vdCwgaXQncyBiZWNhdXNlIHRoZQogICAgICAgICAgICAvLyB1c2VyIGNhbGxlZCBoaXN0b3J5LnB1c2hTdGF0ZSBvciBoaXN0b3J5LnJlcGxhY2VTdGF0ZSBkaXJlY3RseSwgaW4gd2hpY2gKICAgICAgICAgICAgLy8gY2FzZSB3ZSBzaG91bGQgbG9nIGEgd2FybmluZyBhcyBpdCB3aWxsIHJlc3VsdCBpbiBidWdzLgoKICAgICAgICAgICAgaWYgKGluZGV4ID09IG51bGwpIHsKICAgICAgICAgICAgICBpbmRleCA9IDA7CiAgICAgICAgICAgICAgZ2xvYmFsSGlzdG9yeS5yZXBsYWNlU3RhdGUoX2V4dGVuZHMoe30sIGdsb2JhbEhpc3Rvcnkuc3RhdGUsIHsKICAgICAgICAgICAgICAgIGlkeDogaW5kZXgKICAgICAgICAgICAgICB9KSwgIiIpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBmdW5jdGlvbiBnZXRJbmRleCgpIHsKICAgICAgICAgICAgICB2YXIgc3RhdGUgPSBnbG9iYWxIaXN0b3J5LnN0YXRlIHx8IHsKICAgICAgICAgICAgICAgIGlkeDogbnVsbAogICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgcmV0dXJuIHN0YXRlLmlkeDsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgZnVuY3Rpb24gaGFuZGxlUG9wKCkgewogICAgICAgICAgICAgIHZhciBuZXh0QWN0aW9uID0gQWN0aW9uLlBvcDsKICAgICAgICAgICAgICB2YXIgbmV4dEluZGV4ID0gZ2V0SW5kZXgoKTsKCiAgICAgICAgICAgICAgaWYgKG5leHRJbmRleCAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICB2YXIgZGVsdGEgPSBuZXh0SW5kZXggLSBpbmRleDsKICAgICAgICAgICAgICAgIGFjdGlvbiA9IG5leHRBY3Rpb247CiAgICAgICAgICAgICAgICBpbmRleCA9IG5leHRJbmRleDsKCiAgICAgICAgICAgICAgICBpZiAobGlzdGVuZXIpIHsKICAgICAgICAgICAgICAgICAgbGlzdGVuZXIoewogICAgICAgICAgICAgICAgICAgIGFjdGlvbjogYWN0aW9uLAogICAgICAgICAgICAgICAgICAgIGxvY2F0aW9uOiBoaXN0b3J5LmxvY2F0aW9uLAogICAgICAgICAgICAgICAgICAgIGRlbHRhOiBkZWx0YQogICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgd2FybmluZyQxKGZhbHNlLCAvLyBUT0RPOiBXcml0ZSB1cCBhIGRvYyB0aGF0IGV4cGxhaW5zIG91ciBibG9ja2luZyBzdHJhdGVneSBpbiBkZXRhaWwKICAgICAgICAgICAgICAgIC8vIGFuZCBsaW5rIHRvIGl0IGhlcmUgc28gcGVvcGxlIGNhbiB1bmRlcnN0YW5kIGJldHRlciB3aGF0IGlzIGdvaW5nIG9uCiAgICAgICAgICAgICAgICAvLyBhbmQgaG93IHRvIGF2b2lkIGl0LgogICAgICAgICAgICAgICAgIllvdSBhcmUgdHJ5aW5nIHRvIGJsb2NrIGEgUE9QIG5hdmlnYXRpb24gdG8gYSBsb2NhdGlvbiB0aGF0IHdhcyBub3QgIiArICJjcmVhdGVkIGJ5IEByZW1peC1ydW4vcm91dGVyLiBUaGUgYmxvY2sgd2lsbCBmYWlsIHNpbGVudGx5IGluICIgKyAicHJvZHVjdGlvbiwgYnV0IGluIGdlbmVyYWwgeW91IHNob3VsZCBkbyBhbGwgbmF2aWdhdGlvbiB3aXRoIHRoZSAiICsgInJvdXRlciAoaW5zdGVhZCBvZiB1c2luZyB3aW5kb3cuaGlzdG9yeS5wdXNoU3RhdGUgZGlyZWN0bHkpICIgKyAidG8gYXZvaWQgdGhpcyBzaXR1YXRpb24uIik7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICBmdW5jdGlvbiBwdXNoKHRvLCBzdGF0ZSkgewogICAgICAgICAgICAgIGFjdGlvbiA9IEFjdGlvbi5QdXNoOwogICAgICAgICAgICAgIHZhciBsb2NhdGlvbiA9IGNyZWF0ZUxvY2F0aW9uKGhpc3RvcnkubG9jYXRpb24sIHRvLCBzdGF0ZSk7CiAgICAgICAgICAgICAgaWYgKHZhbGlkYXRlTG9jYXRpb24pIHZhbGlkYXRlTG9jYXRpb24obG9jYXRpb24sIHRvKTsKICAgICAgICAgICAgICBpbmRleCA9IGdldEluZGV4KCkgKyAxOwogICAgICAgICAgICAgIHZhciBoaXN0b3J5U3RhdGUgPSBnZXRIaXN0b3J5U3RhdGUobG9jYXRpb24sIGluZGV4KTsKICAgICAgICAgICAgICB2YXIgdXJsID0gaGlzdG9yeS5jcmVhdGVIcmVmKGxvY2F0aW9uKTsgLy8gdHJ5Li4uY2F0Y2ggYmVjYXVzZSBpT1MgbGltaXRzIHVzIHRvIDEwMCBwdXNoU3RhdGUgY2FsbHMgOi8KCiAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIGdsb2JhbEhpc3RvcnkucHVzaFN0YXRlKGhpc3RvcnlTdGF0ZSwgIiIsIHVybCk7CiAgICAgICAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICAgICAgICAgIC8vIFRoZXkgYXJlIGdvaW5nIHRvIGxvc2Ugc3RhdGUgaGVyZSwgYnV0IHRoZXJlIGlzIG5vIHJlYWwKICAgICAgICAgICAgICAgIC8vIHdheSB0byB3YXJuIHRoZW0gYWJvdXQgaXQgc2luY2UgdGhlIHBhZ2Ugd2lsbCByZWZyZXNoLi4uCiAgICAgICAgICAgICAgICB3aW5kb3cubG9jYXRpb24uYXNzaWduKHVybCk7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBpZiAodjVDb21wYXQgJiYgbGlzdGVuZXIpIHsKICAgICAgICAgICAgICAgIGxpc3RlbmVyKHsKICAgICAgICAgICAgICAgICAgYWN0aW9uOiBhY3Rpb24sCiAgICAgICAgICAgICAgICAgIGxvY2F0aW9uOiBoaXN0b3J5LmxvY2F0aW9uLAogICAgICAgICAgICAgICAgICBkZWx0YTogMQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICBmdW5jdGlvbiByZXBsYWNlKHRvLCBzdGF0ZSkgewogICAgICAgICAgICAgIGFjdGlvbiA9IEFjdGlvbi5SZXBsYWNlOwogICAgICAgICAgICAgIHZhciBsb2NhdGlvbiA9IGNyZWF0ZUxvY2F0aW9uKGhpc3RvcnkubG9jYXRpb24sIHRvLCBzdGF0ZSk7CiAgICAgICAgICAgICAgaWYgKHZhbGlkYXRlTG9jYXRpb24pIHZhbGlkYXRlTG9jYXRpb24obG9jYXRpb24sIHRvKTsKICAgICAgICAgICAgICBpbmRleCA9IGdldEluZGV4KCk7CiAgICAgICAgICAgICAgdmFyIGhpc3RvcnlTdGF0ZSA9IGdldEhpc3RvcnlTdGF0ZShsb2NhdGlvbiwgaW5kZXgpOwogICAgICAgICAgICAgIHZhciB1cmwgPSBoaXN0b3J5LmNyZWF0ZUhyZWYobG9jYXRpb24pOwogICAgICAgICAgICAgIGdsb2JhbEhpc3RvcnkucmVwbGFjZVN0YXRlKGhpc3RvcnlTdGF0ZSwgIiIsIHVybCk7CgogICAgICAgICAgICAgIGlmICh2NUNvbXBhdCAmJiBsaXN0ZW5lcikgewogICAgICAgICAgICAgICAgbGlzdGVuZXIoewogICAgICAgICAgICAgICAgICBhY3Rpb246IGFjdGlvbiwKICAgICAgICAgICAgICAgICAgbG9jYXRpb246IGhpc3RvcnkubG9jYXRpb24sCiAgICAgICAgICAgICAgICAgIGRlbHRhOiAwCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGZ1bmN0aW9uIGNyZWF0ZVVSTCh0bykgewogICAgICAgICAgICAgIC8vIHdpbmRvdy5sb2NhdGlvbi5vcmlnaW4gaXMgIm51bGwiICh0aGUgbGl0ZXJhbCBzdHJpbmcgdmFsdWUpIGluIEZpcmVmb3gKICAgICAgICAgICAgICAvLyB1bmRlciBjZXJ0YWluIGNvbmRpdGlvbnMsIG5vdGFibHkgd2hlbiBzZXJ2aW5nIGZyb20gYSBsb2NhbCBIVE1MIGZpbGUKICAgICAgICAgICAgICAvLyBTZWUgaHR0cHM6Ly9idWd6aWxsYS5tb3ppbGxhLm9yZy9zaG93X2J1Zy5jZ2k/aWQ9ODc4Mjk3CiAgICAgICAgICAgICAgdmFyIGJhc2UgPSB3aW5kb3cubG9jYXRpb24ub3JpZ2luICE9PSAibnVsbCIgPyB3aW5kb3cubG9jYXRpb24ub3JpZ2luIDogd2luZG93LmxvY2F0aW9uLmhyZWY7CiAgICAgICAgICAgICAgdmFyIGhyZWYgPSB0eXBlb2YgdG8gPT09ICJzdHJpbmciID8gdG8gOiByb3V0ZXJfY3JlYXRlUGF0aCh0byk7CiAgICAgICAgICAgICAgcm91dGVyX2ludmFyaWFudChiYXNlLCAiTm8gd2luZG93LmxvY2F0aW9uLihvcmlnaW58aHJlZikgYXZhaWxhYmxlIHRvIGNyZWF0ZSBVUkwgZm9yIGhyZWY6ICIgKyBocmVmKTsKICAgICAgICAgICAgICByZXR1cm4gbmV3IFVSTChocmVmLCBiYXNlKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdmFyIGhpc3RvcnkgPSB7CiAgICAgICAgICAgICAgZ2V0IGFjdGlvbigpIHsKICAgICAgICAgICAgICAgIHJldHVybiBhY3Rpb247CiAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgZ2V0IGxvY2F0aW9uKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIGdldExvY2F0aW9uKHdpbmRvdywgZ2xvYmFsSGlzdG9yeSk7CiAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgbGlzdGVuOiBmdW5jdGlvbiBsaXN0ZW4oZm4pIHsKICAgICAgICAgICAgICAgIGlmIChsaXN0ZW5lcikgewogICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIkEgaGlzdG9yeSBvbmx5IGFjY2VwdHMgb25lIGFjdGl2ZSBsaXN0ZW5lciIpOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKFBvcFN0YXRlRXZlbnRUeXBlLCBoYW5kbGVQb3ApOwogICAgICAgICAgICAgICAgbGlzdGVuZXIgPSBmbjsKICAgICAgICAgICAgICAgIHJldHVybiAoKSA9PiB7CiAgICAgICAgICAgICAgICAgIHdpbmRvdy5yZW1vdmVFdmVudExpc3RlbmVyKFBvcFN0YXRlRXZlbnRUeXBlLCBoYW5kbGVQb3ApOwogICAgICAgICAgICAgICAgICBsaXN0ZW5lciA9IG51bGw7CiAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgIGNyZWF0ZUhyZWY6IGZ1bmN0aW9uIGNyZWF0ZUhyZWYodG8pIHsKICAgICAgICAgICAgICAgIHJldHVybiBfY3JlYXRlSHJlZih3aW5kb3csIHRvKTsKICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICBjcmVhdGVVUkw6IGNyZWF0ZVVSTCwKCiAgICAgICAgICAgICAgZW5jb2RlTG9jYXRpb246IGZ1bmN0aW9uIGVuY29kZUxvY2F0aW9uKHRvKSB7CiAgICAgICAgICAgICAgICAvLyBFbmNvZGUgYSBMb2NhdGlvbiB0aGUgc2FtZSB3YXkgd2luZG93LmxvY2F0aW9uIHdvdWxkCiAgICAgICAgICAgICAgICB2YXIgdXJsID0gY3JlYXRlVVJMKHRvKTsKICAgICAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICAgIHBhdGhuYW1lOiB1cmwucGF0aG5hbWUsCiAgICAgICAgICAgICAgICAgIHNlYXJjaDogdXJsLnNlYXJjaCwKICAgICAgICAgICAgICAgICAgaGFzaDogdXJsLmhhc2gKICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgcHVzaDogcHVzaCwKICAgICAgICAgICAgICByZXBsYWNlOiByZXBsYWNlLAoKICAgICAgICAgICAgICBnbzogZnVuY3Rpb24gZ28obikgewogICAgICAgICAgICAgICAgcmV0dXJuIGdsb2JhbEhpc3RvcnkuZ28obik7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgfTsKICAgICAgICAgICAgcmV0dXJuIGhpc3Rvcnk7CiAgICAgICAgICB9IC8vI2VuZHJlZ2lvbgoKICAgICAgICAgIHZhciBSZXN1bHRUeXBlOwoKICAgICAgICAgIChmdW5jdGlvbiAoUmVzdWx0VHlwZSkgewogICAgICAgICAgICBSZXN1bHRUeXBlWyJkYXRhIl0gPSAiZGF0YSI7CiAgICAgICAgICAgIFJlc3VsdFR5cGVbImRlZmVycmVkIl0gPSAiZGVmZXJyZWQiOwogICAgICAgICAgICBSZXN1bHRUeXBlWyJyZWRpcmVjdCJdID0gInJlZGlyZWN0IjsKICAgICAgICAgICAgUmVzdWx0VHlwZVsiZXJyb3IiXSA9ICJlcnJvciI7CiAgICAgICAgICB9KShSZXN1bHRUeXBlIHx8IChSZXN1bHRUeXBlID0ge30pKTsKCiAgICAgICAgICBmdW5jdGlvbiBpc0luZGV4Um91dGUocm91dGUpIHsKICAgICAgICAgICAgcmV0dXJuIHJvdXRlLmluZGV4ID09PSB0cnVlOwogICAgICAgICAgfSAvLyBXYWxrIHRoZSByb3V0ZSB0cmVlIGdlbmVyYXRpbmcgdW5pcXVlIElEcyB3aGVyZSBuZWNlc3Nhcnkgc28gd2UgYXJlIHdvcmtpbmcKICAgICAgICAgIC8vIHNvbGVseSB3aXRoIEFnbm9zdGljRGF0YVJvdXRlT2JqZWN0J3Mgd2l0aGluIHRoZSBSb3V0ZXIKCgogICAgICAgICAgZnVuY3Rpb24gY29udmVydFJvdXRlc1RvRGF0YVJvdXRlcyhyb3V0ZXMsIHBhcmVudFBhdGgsIGFsbElkcykgewogICAgICAgICAgICBpZiAocGFyZW50UGF0aCA9PT0gdm9pZCAwKSB7CiAgICAgICAgICAgICAgcGFyZW50UGF0aCA9IFtdOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoYWxsSWRzID09PSB2b2lkIDApIHsKICAgICAgICAgICAgICBhbGxJZHMgPSBuZXcgU2V0KCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybiByb3V0ZXMubWFwKChyb3V0ZSwgaW5kZXgpID0+IHsKICAgICAgICAgICAgICB2YXIgdHJlZVBhdGggPSBbXS5jb25jYXQoX3RvQ29uc3VtYWJsZUFycmF5MihwYXJlbnRQYXRoKSwgW2luZGV4XSk7CiAgICAgICAgICAgICAgdmFyIGlkID0gdHlwZW9mIHJvdXRlLmlkID09PSAic3RyaW5nIiA/IHJvdXRlLmlkIDogdHJlZVBhdGguam9pbigiLSIpOwogICAgICAgICAgICAgIHJvdXRlcl9pbnZhcmlhbnQocm91dGUuaW5kZXggIT09IHRydWUgfHwgIXJvdXRlLmNoaWxkcmVuLCAiQ2Fubm90IHNwZWNpZnkgY2hpbGRyZW4gb24gYW4gaW5kZXggcm91dGUiKTsKICAgICAgICAgICAgICByb3V0ZXJfaW52YXJpYW50KCFhbGxJZHMuaGFzKGlkKSwgIkZvdW5kIGEgcm91dGUgaWQgY29sbGlzaW9uIG9uIGlkIFwiIiArIGlkICsgIlwiLiAgUm91dGUgIiArICJpZCdzIG11c3QgYmUgZ2xvYmFsbHkgdW5pcXVlIHdpdGhpbiBEYXRhIFJvdXRlciB1c2FnZXMiKTsKICAgICAgICAgICAgICBhbGxJZHMuYWRkKGlkKTsKCiAgICAgICAgICAgICAgaWYgKGlzSW5kZXhSb3V0ZShyb3V0ZSkpIHsKICAgICAgICAgICAgICAgIHZhciBpbmRleFJvdXRlID0gX2V4dGVuZHMoe30sIHJvdXRlLCB7CiAgICAgICAgICAgICAgICAgIGlkOiBpZAogICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgICAgcmV0dXJuIGluZGV4Um91dGU7CiAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHZhciBwYXRoT3JMYXlvdXRSb3V0ZSA9IF9leHRlbmRzKHt9LCByb3V0ZSwgewogICAgICAgICAgICAgICAgICBpZDogaWQsCiAgICAgICAgICAgICAgICAgIGNoaWxkcmVuOiByb3V0ZS5jaGlsZHJlbiA/IGNvbnZlcnRSb3V0ZXNUb0RhdGFSb3V0ZXMocm91dGUuY2hpbGRyZW4sIHRyZWVQYXRoLCBhbGxJZHMpIDogdW5kZWZpbmVkCiAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgICByZXR1cm4gcGF0aE9yTGF5b3V0Um91dGU7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICAgIH0KICAgICAgICAgIC8qKgogICAgICAgICAgICogTWF0Y2hlcyB0aGUgZ2l2ZW4gcm91dGVzIHRvIGEgbG9jYXRpb24gYW5kIHJldHVybnMgdGhlIG1hdGNoIGRhdGEuCiAgICAgICAgICAgKgogICAgICAgICAgICogQHNlZSBodHRwczovL3JlYWN0cm91dGVyLmNvbS91dGlscy9tYXRjaC1yb3V0ZXMKICAgICAgICAgICAqLwoKICAgICAgICAgIGZ1bmN0aW9uIG1hdGNoUm91dGVzKHJvdXRlcywgbG9jYXRpb25BcmcsIGJhc2VuYW1lKSB7CiAgICAgICAgICAgIGlmIChiYXNlbmFtZSA9PT0gdm9pZCAwKSB7CiAgICAgICAgICAgICAgYmFzZW5hbWUgPSAiLyI7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHZhciBsb2NhdGlvbiA9IHR5cGVvZiBsb2NhdGlvbkFyZyA9PT0gInN0cmluZyIgPyBwYXJzZVBhdGgobG9jYXRpb25BcmcpIDogbG9jYXRpb25Bcmc7CiAgICAgICAgICAgIHZhciBwYXRobmFtZSA9IHN0cmlwQmFzZW5hbWUobG9jYXRpb24ucGF0aG5hbWUgfHwgIi8iLCBiYXNlbmFtZSk7CgogICAgICAgICAgICBpZiAocGF0aG5hbWUgPT0gbnVsbCkgewogICAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgICAgICB9CgogICAgICAgICAgICB2YXIgYnJhbmNoZXMgPSBmbGF0dGVuUm91dGVzKHJvdXRlcyk7CiAgICAgICAgICAgIHJhbmtSb3V0ZUJyYW5jaGVzKGJyYW5jaGVzKTsKICAgICAgICAgICAgdmFyIG1hdGNoZXMgPSBudWxsOwoKICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IG1hdGNoZXMgPT0gbnVsbCAmJiBpIDwgYnJhbmNoZXMubGVuZ3RoOyArK2kpIHsKICAgICAgICAgICAgICBtYXRjaGVzID0gbWF0Y2hSb3V0ZUJyYW5jaChicmFuY2hlc1tpXSwgLy8gSW5jb21pbmcgcGF0aG5hbWVzIGFyZSBnZW5lcmFsbHkgZW5jb2RlZCBmcm9tIGVpdGhlciB3aW5kb3cubG9jYXRpb24KICAgICAgICAgICAgICAvLyBvciBmcm9tIHJvdXRlci5uYXZpZ2F0ZSwgYnV0IHdlIHdhbnQgdG8gbWF0Y2ggYWdhaW5zdCB0aGUgdW5lbmNvZGVkCiAgICAgICAgICAgICAgLy8gcGF0aHMgaW4gdGhlIHJvdXRlIGRlZmluaXRpb25zLiAgTWVtb3J5IHJvdXRlciBsb2NhdGlvbnMgd29uJ3QgYmUKICAgICAgICAgICAgICAvLyBlbmNvZGVkIGhlcmUgYnV0IHRoZXJlIGFsc28gc2hvdWxkbid0IGJlIGFueXRoaW5nIHRvIGRlY29kZSBzbyB0aGlzCiAgICAgICAgICAgICAgLy8gc2hvdWxkIGJlIGEgc2FmZSBvcGVyYXRpb24uICBUaGlzIGF2b2lkcyBuZWVkaW5nIG1hdGNoUm91dGVzIHRvIGJlCiAgICAgICAgICAgICAgLy8gaGlzdG9yeS1hd2FyZS4KICAgICAgICAgICAgICBzYWZlbHlEZWNvZGVVUkkocGF0aG5hbWUpKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuIG1hdGNoZXM7CiAgICAgICAgICB9CgogICAgICAgICAgZnVuY3Rpb24gZmxhdHRlblJvdXRlcyhyb3V0ZXMsIGJyYW5jaGVzLCBwYXJlbnRzTWV0YSwgcGFyZW50UGF0aCkgewogICAgICAgICAgICBpZiAoYnJhbmNoZXMgPT09IHZvaWQgMCkgewogICAgICAgICAgICAgIGJyYW5jaGVzID0gW107CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChwYXJlbnRzTWV0YSA9PT0gdm9pZCAwKSB7CiAgICAgICAgICAgICAgcGFyZW50c01ldGEgPSBbXTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKHBhcmVudFBhdGggPT09IHZvaWQgMCkgewogICAgICAgICAgICAgIHBhcmVudFBhdGggPSAiIjsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdmFyIGZsYXR0ZW5Sb3V0ZSA9IChyb3V0ZSwgaW5kZXgsIHJlbGF0aXZlUGF0aCkgPT4gewogICAgICAgICAgICAgIHZhciBtZXRhID0gewogICAgICAgICAgICAgICAgcmVsYXRpdmVQYXRoOiByZWxhdGl2ZVBhdGggPT09IHVuZGVmaW5lZCA/IHJvdXRlLnBhdGggfHwgIiIgOiByZWxhdGl2ZVBhdGgsCiAgICAgICAgICAgICAgICBjYXNlU2Vuc2l0aXZlOiByb3V0ZS5jYXNlU2Vuc2l0aXZlID09PSB0cnVlLAogICAgICAgICAgICAgICAgY2hpbGRyZW5JbmRleDogaW5kZXgsCiAgICAgICAgICAgICAgICByb3V0ZTogcm91dGUKICAgICAgICAgICAgICB9OwoKICAgICAgICAgICAgICBpZiAobWV0YS5yZWxhdGl2ZVBhdGguc3RhcnRzV2l0aCgiLyIpKSB7CiAgICAgICAgICAgICAgICByb3V0ZXJfaW52YXJpYW50KG1ldGEucmVsYXRpdmVQYXRoLnN0YXJ0c1dpdGgocGFyZW50UGF0aCksICJBYnNvbHV0ZSByb3V0ZSBwYXRoIFwiIiArIG1ldGEucmVsYXRpdmVQYXRoICsgIlwiIG5lc3RlZCB1bmRlciBwYXRoICIgKyAoIlwiIiArIHBhcmVudFBhdGggKyAiXCIgaXMgbm90IHZhbGlkLiBBbiBhYnNvbHV0ZSBjaGlsZCByb3V0ZSBwYXRoICIpICsgIm11c3Qgc3RhcnQgd2l0aCB0aGUgY29tYmluZWQgcGF0aCBvZiBhbGwgaXRzIHBhcmVudCByb3V0ZXMuIik7CiAgICAgICAgICAgICAgICBtZXRhLnJlbGF0aXZlUGF0aCA9IG1ldGEucmVsYXRpdmVQYXRoLnNsaWNlKHBhcmVudFBhdGgubGVuZ3RoKTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIHZhciBwYXRoID0gcm91dGVyX2pvaW5QYXRocyhbcGFyZW50UGF0aCwgbWV0YS5yZWxhdGl2ZVBhdGhdKTsKICAgICAgICAgICAgICB2YXIgcm91dGVzTWV0YSA9IHBhcmVudHNNZXRhLmNvbmNhdChtZXRhKTsgLy8gQWRkIHRoZSBjaGlsZHJlbiBiZWZvcmUgYWRkaW5nIHRoaXMgcm91dGUgdG8gdGhlIGFycmF5IHNvIHdlIHRyYXZlcnNlIHRoZQogICAgICAgICAgICAgIC8vIHJvdXRlIHRyZWUgZGVwdGgtZmlyc3QgYW5kIGNoaWxkIHJvdXRlcyBhcHBlYXIgYmVmb3JlIHRoZWlyIHBhcmVudHMgaW4KICAgICAgICAgICAgICAvLyB0aGUgImZsYXR0ZW5lZCIgdmVyc2lvbi4KCiAgICAgICAgICAgICAgaWYgKHJvdXRlLmNoaWxkcmVuICYmIHJvdXRlLmNoaWxkcmVuLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgICAgIHJvdXRlcl9pbnZhcmlhbnQoIC8vIE91ciB0eXBlcyBrbm93IGJldHRlciwgYnV0IHJ1bnRpbWUgSlMgbWF5IG5vdCEKICAgICAgICAgICAgICAgIC8vIEB0cy1leHBlY3QtZXJyb3IKICAgICAgICAgICAgICAgIHJvdXRlLmluZGV4ICE9PSB0cnVlLCAiSW5kZXggcm91dGVzIG11c3Qgbm90IGhhdmUgY2hpbGQgcm91dGVzLiBQbGVhc2UgcmVtb3ZlICIgKyAoImFsbCBjaGlsZCByb3V0ZXMgZnJvbSByb3V0ZSBwYXRoIFwiIiArIHBhdGggKyAiXCIuIikpOwogICAgICAgICAgICAgICAgZmxhdHRlblJvdXRlcyhyb3V0ZS5jaGlsZHJlbiwgYnJhbmNoZXMsIHJvdXRlc01ldGEsIHBhdGgpOwogICAgICAgICAgICAgIH0gLy8gUm91dGVzIHdpdGhvdXQgYSBwYXRoIHNob3VsZG4ndCBldmVyIG1hdGNoIGJ5IHRoZW1zZWx2ZXMgdW5sZXNzIHRoZXkgYXJlCiAgICAgICAgICAgICAgLy8gaW5kZXggcm91dGVzLCBzbyBkb24ndCBhZGQgdGhlbSB0byB0aGUgbGlzdCBvZiBwb3NzaWJsZSBicmFuY2hlcy4KCgogICAgICAgICAgICAgIGlmIChyb3V0ZS5wYXRoID09IG51bGwgJiYgIXJvdXRlLmluZGV4KSB7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBicmFuY2hlcy5wdXNoKHsKICAgICAgICAgICAgICAgIHBhdGg6IHBhdGgsCiAgICAgICAgICAgICAgICBzY29yZTogY29tcHV0ZVNjb3JlKHBhdGgsIHJvdXRlLmluZGV4KSwKICAgICAgICAgICAgICAgIHJvdXRlc01ldGE6IHJvdXRlc01ldGEKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfTsKCiAgICAgICAgICAgIHJvdXRlcy5mb3JFYWNoKChyb3V0ZSwgaW5kZXgpID0+IHsKICAgICAgICAgICAgICB2YXIgX3JvdXRlJHBhdGg7CgogICAgICAgICAgICAgIC8vIGNvYXJzZS1ncmFpbiBjaGVjayBmb3Igb3B0aW9uYWwgcGFyYW1zCiAgICAgICAgICAgICAgaWYgKHJvdXRlLnBhdGggPT09ICIiIHx8ICEoKF9yb3V0ZSRwYXRoID0gcm91dGUucGF0aCkgIT0gbnVsbCAmJiBfcm91dGUkcGF0aC5pbmNsdWRlcygiPyIpKSkgewogICAgICAgICAgICAgICAgZmxhdHRlblJvdXRlKHJvdXRlLCBpbmRleCk7CiAgICAgICAgICAgICAgfSBlbHNlIHt2YXIgX2l0ZXJhdG9yMyA9IF9jcmVhdGVGb3JPZkl0ZXJhdG9ySGVscGVyMigKICAgICAgICAgICAgICAgICAgZXhwbG9kZU9wdGlvbmFsU2VnbWVudHMocm91dGUucGF0aCkpLF9zdGVwMzt0cnkge2ZvciAoX2l0ZXJhdG9yMy5zKCk7ICEoX3N0ZXAzID0gX2l0ZXJhdG9yMy5uKCkpLmRvbmU7KSB7dmFyIGV4cGxvZGVkID0gX3N0ZXAzLnZhbHVlOwogICAgICAgICAgICAgICAgICAgIGZsYXR0ZW5Sb3V0ZShyb3V0ZSwgaW5kZXgsIGV4cGxvZGVkKTsKICAgICAgICAgICAgICAgICAgfX0gY2F0Y2ggKGVycikge19pdGVyYXRvcjMuZShlcnIpO30gZmluYWxseSB7X2l0ZXJhdG9yMy5mKCk7fQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIHJldHVybiBicmFuY2hlczsKICAgICAgICAgIH0KICAgICAgICAgIC8qKgogICAgICAgICAgICogQ29tcHV0ZXMgYWxsIGNvbWJpbmF0aW9ucyBvZiBvcHRpb25hbCBwYXRoIHNlZ21lbnRzIGZvciBhIGdpdmVuIHBhdGgsCiAgICAgICAgICAgKiBleGNsdWRpbmcgY29tYmluYXRpb25zIHRoYXQgYXJlIGFtYmlndW91cyBhbmQgb2YgbG93ZXIgcHJpb3JpdHkuCiAgICAgICAgICAgKgogICAgICAgICAgICogRm9yIGV4YW1wbGUsIGAvb25lLzp0d28/L3RocmVlLzpmb3VyPy86Zml2ZT9gIGV4cGxvZGVzIHRvOgogICAgICAgICAgICogLSBgL29uZS90aHJlZWAKICAgICAgICAgICAqIC0gYC9vbmUvOnR3by90aHJlZWAKICAgICAgICAgICAqIC0gYC9vbmUvdGhyZWUvOmZvdXJgCiAgICAgICAgICAgKiAtIGAvb25lL3RocmVlLzpmaXZlYAogICAgICAgICAgICogLSBgL29uZS86dHdvL3RocmVlLzpmb3VyYAogICAgICAgICAgICogLSBgL29uZS86dHdvL3RocmVlLzpmaXZlYAogICAgICAgICAgICogLSBgL29uZS90aHJlZS86Zm91ci86Zml2ZWAKICAgICAgICAgICAqIC0gYC9vbmUvOnR3by90aHJlZS86Zm91ci86Zml2ZWAKICAgICAgICAgICAqLwoKCiAgICAgICAgICBmdW5jdGlvbiBleHBsb2RlT3B0aW9uYWxTZWdtZW50cyhwYXRoKSB7CiAgICAgICAgICAgIHZhciBzZWdtZW50cyA9IHBhdGguc3BsaXQoIi8iKTsKICAgICAgICAgICAgaWYgKHNlZ21lbnRzLmxlbmd0aCA9PT0gMCkgcmV0dXJuIFtdOwogICAgICAgICAgICB2YXIgX3NlZ21lbnRzID0gX3RvQXJyYXkoc2VnbWVudHMpLGZpcnN0ID0gX3NlZ21lbnRzWzBdLHJlc3QgPSBfc2VnbWVudHMuc2xpY2UoMSk7IC8vIE9wdGlvbmFsIHBhdGggc2VnbWVudHMgYXJlIGRlbm90ZWQgYnkgYSB0cmFpbGluZyBgP2AKCiAgICAgICAgICAgIHZhciBpc09wdGlvbmFsID0gZmlyc3QuZW5kc1dpdGgoIj8iKTsgLy8gQ29tcHV0ZSB0aGUgY29ycmVzcG9uZGluZyByZXF1aXJlZCBzZWdtZW50OiBgZm9vP2AgLT4gYGZvb2AKCiAgICAgICAgICAgIHZhciByZXF1aXJlZCA9IGZpcnN0LnJlcGxhY2UoL1w/JC8sICIiKTsKCiAgICAgICAgICAgIGlmIChyZXN0Lmxlbmd0aCA9PT0gMCkgewogICAgICAgICAgICAgIC8vIEludGVwcmV0IGVtcHR5IHN0cmluZyBhcyBvbWl0dGluZyBhbiBvcHRpb25hbCBzZWdtZW50CiAgICAgICAgICAgICAgLy8gYFsib25lIiwgIiIsICJ0aHJlZSJdYCBjb3JyZXNwb25kcyB0byBvbWl0dGluZyBgOnR3b2AgZnJvbSBgL29uZS86dHdvPy90aHJlZWAgLT4gYC9vbmUvdGhyZWVgCiAgICAgICAgICAgICAgcmV0dXJuIGlzT3B0aW9uYWwgPyBbcmVxdWlyZWQsICIiXSA6IFtyZXF1aXJlZF07CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHZhciByZXN0RXhwbG9kZWQgPSBleHBsb2RlT3B0aW9uYWxTZWdtZW50cyhyZXN0LmpvaW4oIi8iKSk7CiAgICAgICAgICAgIHZhciByZXN1bHQgPSBbXTsgLy8gQWxsIGNoaWxkIHBhdGhzIHdpdGggdGhlIHByZWZpeC4gIERvIHRoaXMgZm9yIGFsbCBjaGlsZHJlbiBiZWZvcmUgdGhlCiAgICAgICAgICAgIC8vIG9wdGlvbmFsIHZlcnNpb24gZm9yIGFsbCBjaGlsZHJlbiBzbyB3ZSBnZXQgY29uc2lzdGVudCBvcmRlcmluZyB3aGVyZSB0aGUKICAgICAgICAgICAgLy8gcGFyZW50IG9wdGlvbmFsIGFzcGVjdCBpcyBwcmVmZXJyZWQgYXMgcmVxdWlyZWQuICBPdGhlcndpc2UsIHdlIGNhbiBnZXQKICAgICAgICAgICAgLy8gY2hpbGQgc2VjdGlvbnMgaW50ZXJzcGVyc2VkIHdoZXJlIGRlZXBlciBvcHRpb25hbCBzZWdtZW50cyBhcmUgaGlnaGVyIHRoYW4KICAgICAgICAgICAgLy8gcGFyZW50IG9wdGlvbmFsIHNlZ21lbnRzLCB3aGVyZSBmb3IgZXhhbXBsZSwgLzp0d28gd291bGQgZXhwbG9kZXMgX2VhcmxpZXJfCiAgICAgICAgICAgIC8vIHRoZW4gLzpvbmUuICBCeSBhbHdheXMgaW5jbHVkaW5nIHRoZSBwYXJlbnQgYXMgcmVxdWlyZWQgX2ZvciBhbGwgY2hpbGRyZW5fCiAgICAgICAgICAgIC8vIGZpcnN0LCB3ZSBhdm9pZCB0aGlzIGlzc3VlCgogICAgICAgICAgICByZXN1bHQucHVzaC5hcHBseShyZXN1bHQsIF90b0NvbnN1bWFibGVBcnJheTIocmVzdEV4cGxvZGVkLm1hcCgoc3VicGF0aCkgPT4gc3VicGF0aCA9PT0gIiIgPyByZXF1aXJlZCA6IFtyZXF1aXJlZCwgc3VicGF0aF0uam9pbigiLyIpKSkpOyAvLyBUaGVuIGlmIHRoaXMgaXMgYW4gb3B0aW9uYWwgdmFsdWUsIGFkZCBhbGwgY2hpbGQgdmVyc2lvbnMgd2l0aG91dAoKICAgICAgICAgICAgaWYgKGlzT3B0aW9uYWwpIHsKICAgICAgICAgICAgICByZXN1bHQucHVzaC5hcHBseShyZXN1bHQsIF90b0NvbnN1bWFibGVBcnJheTIocmVzdEV4cGxvZGVkKSk7CiAgICAgICAgICAgIH0gLy8gZm9yIGFic29sdXRlIHBhdGhzLCBlbnN1cmUgYC9gIGluc3RlYWQgb2YgZW1wdHkgc2VnbWVudAoKCiAgICAgICAgICAgIHJldHVybiByZXN1bHQubWFwKChleHBsb2RlZCkgPT4gcGF0aC5zdGFydHNXaXRoKCIvIikgJiYgZXhwbG9kZWQgPT09ICIiID8gIi8iIDogZXhwbG9kZWQpOwogICAgICAgICAgfQoKICAgICAgICAgIGZ1bmN0aW9uIHJhbmtSb3V0ZUJyYW5jaGVzKGJyYW5jaGVzKSB7CiAgICAgICAgICAgIGJyYW5jaGVzLnNvcnQoKGEsIGIpID0+IGEuc2NvcmUgIT09IGIuc2NvcmUgPyBiLnNjb3JlIC0gYS5zY29yZSAvLyBIaWdoZXIgc2NvcmUgZmlyc3QKICAgICAgICAgICAgOiBjb21wYXJlSW5kZXhlcyhhLnJvdXRlc01ldGEubWFwKChtZXRhKSA9PiBtZXRhLmNoaWxkcmVuSW5kZXgpLCBiLnJvdXRlc01ldGEubWFwKChtZXRhKSA9PiBtZXRhLmNoaWxkcmVuSW5kZXgpKSk7CiAgICAgICAgICB9CgogICAgICAgICAgdmFyIHBhcmFtUmUgPSAvXjpcdyskLzsKICAgICAgICAgIHZhciBkeW5hbWljU2VnbWVudFZhbHVlID0gMzsKICAgICAgICAgIHZhciBpbmRleFJvdXRlVmFsdWUgPSAyOwogICAgICAgICAgdmFyIGVtcHR5U2VnbWVudFZhbHVlID0gMTsKICAgICAgICAgIHZhciBzdGF0aWNTZWdtZW50VmFsdWUgPSAxMDsKICAgICAgICAgIHZhciBzcGxhdFBlbmFsdHkgPSAtMjsKCiAgICAgICAgICB2YXIgaXNTcGxhdCA9IChzKSA9PiBzID09PSAiKiI7CgogICAgICAgICAgZnVuY3Rpb24gY29tcHV0ZVNjb3JlKHBhdGgsIGluZGV4KSB7CiAgICAgICAgICAgIHZhciBzZWdtZW50cyA9IHBhdGguc3BsaXQoIi8iKTsKICAgICAgICAgICAgdmFyIGluaXRpYWxTY29yZSA9IHNlZ21lbnRzLmxlbmd0aDsKCiAgICAgICAgICAgIGlmIChzZWdtZW50cy5zb21lKGlzU3BsYXQpKSB7CiAgICAgICAgICAgICAgaW5pdGlhbFNjb3JlICs9IHNwbGF0UGVuYWx0eTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKGluZGV4KSB7CiAgICAgICAgICAgICAgaW5pdGlhbFNjb3JlICs9IGluZGV4Um91dGVWYWx1ZTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuIHNlZ21lbnRzLmZpbHRlcigocykgPT4gIWlzU3BsYXQocykpLnJlZHVjZSgoc2NvcmUsIHNlZ21lbnQpID0+IHNjb3JlICsgKHBhcmFtUmUudGVzdChzZWdtZW50KSA/IGR5bmFtaWNTZWdtZW50VmFsdWUgOiBzZWdtZW50ID09PSAiIiA/IGVtcHR5U2VnbWVudFZhbHVlIDogc3RhdGljU2VnbWVudFZhbHVlKSwgaW5pdGlhbFNjb3JlKTsKICAgICAgICAgIH0KCiAgICAgICAgICBmdW5jdGlvbiBjb21wYXJlSW5kZXhlcyhhLCBiKSB7CiAgICAgICAgICAgIHZhciBzaWJsaW5ncyA9IGEubGVuZ3RoID09PSBiLmxlbmd0aCAmJiBhLnNsaWNlKDAsIC0xKS5ldmVyeSgobiwgaSkgPT4gbiA9PT0gYltpXSk7CiAgICAgICAgICAgIHJldHVybiBzaWJsaW5ncyA/IC8vIElmIHR3byByb3V0ZXMgYXJlIHNpYmxpbmdzLCB3ZSBzaG91bGQgdHJ5IHRvIG1hdGNoIHRoZSBlYXJsaWVyIHNpYmxpbmcKICAgICAgICAgICAgLy8gZmlyc3QuIFRoaXMgYWxsb3dzIHBlb3BsZSB0byBoYXZlIGZpbmUtZ3JhaW5lZCBjb250cm9sIG92ZXIgdGhlIG1hdGNoaW5nCiAgICAgICAgICAgIC8vIGJlaGF2aW9yIGJ5IHNpbXBseSBwdXR0aW5nIHJvdXRlcyB3aXRoIGlkZW50aWNhbCBwYXRocyBpbiB0aGUgb3JkZXIgdGhleQogICAgICAgICAgICAvLyB3YW50IHRoZW0gdHJpZWQuCiAgICAgICAgICAgIGFbYS5sZW5ndGggLSAxXSAtIGJbYi5sZW5ndGggLSAxXSA6IC8vIE90aGVyd2lzZSwgaXQgZG9lc24ndCByZWFsbHkgbWFrZSBzZW5zZSB0byByYW5rIG5vbi1zaWJsaW5ncyBieSBpbmRleCwKICAgICAgICAgICAgLy8gc28gdGhleSBzb3J0IGVxdWFsbHkuCiAgICAgICAgICAgIDA7CiAgICAgICAgICB9CgogICAgICAgICAgZnVuY3Rpb24gbWF0Y2hSb3V0ZUJyYW5jaChicmFuY2gsIHBhdGhuYW1lKSB7CiAgICAgICAgICAgIHZhcgogICAgICAgICAgICByb3V0ZXNNZXRhID0KICAgICAgICAgICAgYnJhbmNoLnJvdXRlc01ldGE7CiAgICAgICAgICAgIHZhciBtYXRjaGVkUGFyYW1zID0ge307CiAgICAgICAgICAgIHZhciBtYXRjaGVkUGF0aG5hbWUgPSAiLyI7CiAgICAgICAgICAgIHZhciBtYXRjaGVzID0gW107CgogICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHJvdXRlc01ldGEubGVuZ3RoOyArK2kpIHsKICAgICAgICAgICAgICB2YXIgbWV0YSA9IHJvdXRlc01ldGFbaV07CiAgICAgICAgICAgICAgdmFyIGVuZCA9IGkgPT09IHJvdXRlc01ldGEubGVuZ3RoIC0gMTsKICAgICAgICAgICAgICB2YXIgcmVtYWluaW5nUGF0aG5hbWUgPSBtYXRjaGVkUGF0aG5hbWUgPT09ICIvIiA/IHBhdGhuYW1lIDogcGF0aG5hbWUuc2xpY2UobWF0Y2hlZFBhdGhuYW1lLmxlbmd0aCkgfHwgIi8iOwogICAgICAgICAgICAgIHZhciBtYXRjaCA9IHJvdXRlcl9tYXRjaFBhdGgoewogICAgICAgICAgICAgICAgcGF0aDogbWV0YS5yZWxhdGl2ZVBhdGgsCiAgICAgICAgICAgICAgICBjYXNlU2Vuc2l0aXZlOiBtZXRhLmNhc2VTZW5zaXRpdmUsCiAgICAgICAgICAgICAgICBlbmQ6IGVuZAogICAgICAgICAgICAgIH0sIHJlbWFpbmluZ1BhdGhuYW1lKTsKICAgICAgICAgICAgICBpZiAoIW1hdGNoKSByZXR1cm4gbnVsbDsKICAgICAgICAgICAgICBPYmplY3QuYXNzaWduKG1hdGNoZWRQYXJhbXMsIG1hdGNoLnBhcmFtcyk7CiAgICAgICAgICAgICAgdmFyIHJvdXRlID0gbWV0YS5yb3V0ZTsKICAgICAgICAgICAgICBtYXRjaGVzLnB1c2goewogICAgICAgICAgICAgICAgLy8gVE9ETzogQ2FuIHRoaXMgYXMgYmUgYXZvaWRlZD8KICAgICAgICAgICAgICAgIHBhcmFtczogbWF0Y2hlZFBhcmFtcywKICAgICAgICAgICAgICAgIHBhdGhuYW1lOiByb3V0ZXJfam9pblBhdGhzKFttYXRjaGVkUGF0aG5hbWUsIG1hdGNoLnBhdGhuYW1lXSksCiAgICAgICAgICAgICAgICBwYXRobmFtZUJhc2U6IG5vcm1hbGl6ZVBhdGhuYW1lKHJvdXRlcl9qb2luUGF0aHMoW21hdGNoZWRQYXRobmFtZSwgbWF0Y2gucGF0aG5hbWVCYXNlXSkpLAogICAgICAgICAgICAgICAgcm91dGU6IHJvdXRlCiAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgIGlmIChtYXRjaC5wYXRobmFtZUJhc2UgIT09ICIvIikgewogICAgICAgICAgICAgICAgbWF0Y2hlZFBhdGhuYW1lID0gcm91dGVyX2pvaW5QYXRocyhbbWF0Y2hlZFBhdGhuYW1lLCBtYXRjaC5wYXRobmFtZUJhc2VdKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybiBtYXRjaGVzOwogICAgICAgICAgfQogICAgICAgICAgLyoqCiAgICAgICAgICAgKiBSZXR1cm5zIGEgcGF0aCB3aXRoIHBhcmFtcyBpbnRlcnBvbGF0ZWQuCiAgICAgICAgICAgKgogICAgICAgICAgICogQHNlZSBodHRwczovL3JlYWN0cm91dGVyLmNvbS91dGlscy9nZW5lcmF0ZS1wYXRoCiAgICAgICAgICAgKi8KCgogICAgICAgICAgZnVuY3Rpb24gZ2VuZXJhdGVQYXRoKG9yaWdpbmFsUGF0aCwgcGFyYW1zKSB7CiAgICAgICAgICAgIGlmIChwYXJhbXMgPT09IHZvaWQgMCkgewogICAgICAgICAgICAgIHBhcmFtcyA9IHt9OwogICAgICAgICAgICB9CgogICAgICAgICAgICB2YXIgcGF0aCA9IG9yaWdpbmFsUGF0aDsKCiAgICAgICAgICAgIGlmIChwYXRoLmVuZHNXaXRoKCIqIikgJiYgcGF0aCAhPT0gIioiICYmICFwYXRoLmVuZHNXaXRoKCIvKiIpKSB7CiAgICAgICAgICAgICAgd2FybmluZyhmYWxzZSwgIlJvdXRlIHBhdGggXCIiICsgcGF0aCArICJcIiB3aWxsIGJlIHRyZWF0ZWQgYXMgaWYgaXQgd2VyZSAiICsgKCJcIiIgKyBwYXRoLnJlcGxhY2UoL1wqJC8sICIvKiIpICsgIlwiIGJlY2F1c2UgdGhlIGAqYCBjaGFyYWN0ZXIgbXVzdCAiKSArICJhbHdheXMgZm9sbG93IGEgYC9gIGluIHRoZSBwYXR0ZXJuLiBUbyBnZXQgcmlkIG9mIHRoaXMgd2FybmluZywgIiArICgicGxlYXNlIGNoYW5nZSB0aGUgcm91dGUgcGF0aCB0byBcIiIgKyBwYXRoLnJlcGxhY2UoL1wqJC8sICIvKiIpICsgIlwiLiIpKTsKICAgICAgICAgICAgICBwYXRoID0gcGF0aC5yZXBsYWNlKC9cKiQvLCAiLyoiKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuIHBhdGgucmVwbGFjZSgvXjooXHcrKShcPz8pL2csIChfLCBrZXksIG9wdGlvbmFsKSA9PiB7CiAgICAgICAgICAgICAgdmFyIHBhcmFtID0gcGFyYW1zW2tleV07CgogICAgICAgICAgICAgIGlmIChvcHRpb25hbCA9PT0gIj8iKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gcGFyYW0gPT0gbnVsbCA/ICIiIDogcGFyYW07CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBpZiAocGFyYW0gPT0gbnVsbCkgewogICAgICAgICAgICAgICAgcm91dGVyX2ludmFyaWFudChmYWxzZSwgIk1pc3NpbmcgXCI6IiArIGtleSArICJcIiBwYXJhbSIpOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgcmV0dXJuIHBhcmFtOwogICAgICAgICAgICB9KS5yZXBsYWNlKC9cLzooXHcrKShcPz8pL2csIChfLCBrZXksIG9wdGlvbmFsKSA9PiB7CiAgICAgICAgICAgICAgdmFyIHBhcmFtID0gcGFyYW1zW2tleV07CgogICAgICAgICAgICAgIGlmIChvcHRpb25hbCA9PT0gIj8iKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gcGFyYW0gPT0gbnVsbCA/ICIiIDogIi8iICsgcGFyYW07CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBpZiAocGFyYW0gPT0gbnVsbCkgewogICAgICAgICAgICAgICAgcm91dGVyX2ludmFyaWFudChmYWxzZSwgIk1pc3NpbmcgXCI6IiArIGtleSArICJcIiBwYXJhbSIpOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgcmV0dXJuICIvIiArIHBhcmFtOwogICAgICAgICAgICB9KSAvLyBSZW1vdmUgYW55IG9wdGlvbmFsIG1hcmtlcnMgZnJvbSBvcHRpb25hbCBzdGF0aWMgc2VnbWVudHMKICAgICAgICAgICAgLnJlcGxhY2UoL1w/L2csICIiKS5yZXBsYWNlKC8oXC8/KVwqLywgKF8sIHByZWZpeCwgX18sIHN0cikgPT4gewogICAgICAgICAgICAgIHZhciBzdGFyID0gIioiOwoKICAgICAgICAgICAgICBpZiAocGFyYW1zW3N0YXJdID09IG51bGwpIHsKICAgICAgICAgICAgICAgIC8vIElmIG5vIHNwbGF0IHdhcyBwcm92aWRlZCwgdHJpbSB0aGUgdHJhaWxpbmcgc2xhc2ggX3VubGVzc18gaXQncwogICAgICAgICAgICAgICAgLy8gdGhlIGVudGlyZSBwYXRoCiAgICAgICAgICAgICAgICByZXR1cm4gc3RyID09PSAiLyoiID8gIi8iIDogIiI7CiAgICAgICAgICAgICAgfSAvLyBBcHBseSB0aGUgc3BsYXQKCgogICAgICAgICAgICAgIHJldHVybiAiIiArIHByZWZpeCArIHBhcmFtc1tzdGFyXTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9CiAgICAgICAgICAvKioKICAgICAgICAgICAqIFBlcmZvcm1zIHBhdHRlcm4gbWF0Y2hpbmcgb24gYSBVUkwgcGF0aG5hbWUgYW5kIHJldHVybnMgaW5mb3JtYXRpb24gYWJvdXQKICAgICAgICAgICAqIHRoZSBtYXRjaC4KICAgICAgICAgICAqCiAgICAgICAgICAgKiBAc2VlIGh0dHBzOi8vcmVhY3Ryb3V0ZXIuY29tL3V0aWxzL21hdGNoLXBhdGgKICAgICAgICAgICAqLwoKICAgICAgICAgIGZ1bmN0aW9uIHJvdXRlcl9tYXRjaFBhdGgocGF0dGVybiwgcGF0aG5hbWUpIHsKICAgICAgICAgICAgaWYgKHR5cGVvZiBwYXR0ZXJuID09PSAic3RyaW5nIikgewogICAgICAgICAgICAgIHBhdHRlcm4gPSB7CiAgICAgICAgICAgICAgICBwYXRoOiBwYXR0ZXJuLAogICAgICAgICAgICAgICAgY2FzZVNlbnNpdGl2ZTogZmFsc2UsCiAgICAgICAgICAgICAgICBlbmQ6IHRydWUKICAgICAgICAgICAgICB9OwogICAgICAgICAgICB9CgogICAgICAgICAgICB2YXIgX2NvbXBpbGVQYXRoID0gY29tcGlsZVBhdGgocGF0dGVybi5wYXRoLCBwYXR0ZXJuLmNhc2VTZW5zaXRpdmUsIHBhdHRlcm4uZW5kKSxfY29tcGlsZVBhdGgyID0gX3NsaWNlZFRvQXJyYXkyKF9jb21waWxlUGF0aCwgMiksbWF0Y2hlciA9IF9jb21waWxlUGF0aDJbMF0scGFyYW1OYW1lcyA9IF9jb21waWxlUGF0aDJbMV07CiAgICAgICAgICAgIHZhciBtYXRjaCA9IHBhdGhuYW1lLm1hdGNoKG1hdGNoZXIpOwogICAgICAgICAgICBpZiAoIW1hdGNoKSByZXR1cm4gbnVsbDsKICAgICAgICAgICAgdmFyIG1hdGNoZWRQYXRobmFtZSA9IG1hdGNoWzBdOwogICAgICAgICAgICB2YXIgcGF0aG5hbWVCYXNlID0gbWF0Y2hlZFBhdGhuYW1lLnJlcGxhY2UoLyguKVwvKyQvLCAiJDEiKTsKICAgICAgICAgICAgdmFyIGNhcHR1cmVHcm91cHMgPSBtYXRjaC5zbGljZSgxKTsKICAgICAgICAgICAgdmFyIHBhcmFtcyA9IHBhcmFtTmFtZXMucmVkdWNlKChtZW1vLCBwYXJhbU5hbWUsIGluZGV4KSA9PiB7CiAgICAgICAgICAgICAgLy8gV2UgbmVlZCB0byBjb21wdXRlIHRoZSBwYXRobmFtZUJhc2UgaGVyZSB1c2luZyB0aGUgcmF3IHNwbGF0IHZhbHVlCiAgICAgICAgICAgICAgLy8gaW5zdGVhZCBvZiB1c2luZyBwYXJhbXNbIioiXSBsYXRlciBiZWNhdXNlIGl0IHdpbGwgYmUgZGVjb2RlZCB0aGVuCiAgICAgICAgICAgICAgaWYgKHBhcmFtTmFtZSA9PT0gIioiKSB7CiAgICAgICAgICAgICAgICB2YXIgc3BsYXRWYWx1ZSA9IGNhcHR1cmVHcm91cHNbaW5kZXhdIHx8ICIiOwogICAgICAgICAgICAgICAgcGF0aG5hbWVCYXNlID0gbWF0Y2hlZFBhdGhuYW1lLnNsaWNlKDAsIG1hdGNoZWRQYXRobmFtZS5sZW5ndGggLSBzcGxhdFZhbHVlLmxlbmd0aCkucmVwbGFjZSgvKC4pXC8rJC8sICIkMSIpOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgbWVtb1twYXJhbU5hbWVdID0gc2FmZWx5RGVjb2RlVVJJQ29tcG9uZW50KGNhcHR1cmVHcm91cHNbaW5kZXhdIHx8ICIiLCBwYXJhbU5hbWUpOwogICAgICAgICAgICAgIHJldHVybiBtZW1vOwogICAgICAgICAgICB9LCB7fSk7CiAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgcGFyYW1zOiBwYXJhbXMsCiAgICAgICAgICAgICAgcGF0aG5hbWU6IG1hdGNoZWRQYXRobmFtZSwKICAgICAgICAgICAgICBwYXRobmFtZUJhc2U6IHBhdGhuYW1lQmFzZSwKICAgICAgICAgICAgICBwYXR0ZXJuOiBwYXR0ZXJuCiAgICAgICAgICAgIH07CiAgICAgICAgICB9CgogICAgICAgICAgZnVuY3Rpb24gY29tcGlsZVBhdGgocGF0aCwgY2FzZVNlbnNpdGl2ZSwgZW5kKSB7CiAgICAgICAgICAgIGlmIChjYXNlU2Vuc2l0aXZlID09PSB2b2lkIDApIHsKICAgICAgICAgICAgICBjYXNlU2Vuc2l0aXZlID0gZmFsc2U7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChlbmQgPT09IHZvaWQgMCkgewogICAgICAgICAgICAgIGVuZCA9IHRydWU7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHdhcm5pbmcocGF0aCA9PT0gIioiIHx8ICFwYXRoLmVuZHNXaXRoKCIqIikgfHwgcGF0aC5lbmRzV2l0aCgiLyoiKSwgIlJvdXRlIHBhdGggXCIiICsgcGF0aCArICJcIiB3aWxsIGJlIHRyZWF0ZWQgYXMgaWYgaXQgd2VyZSAiICsgKCJcIiIgKyBwYXRoLnJlcGxhY2UoL1wqJC8sICIvKiIpICsgIlwiIGJlY2F1c2UgdGhlIGAqYCBjaGFyYWN0ZXIgbXVzdCAiKSArICJhbHdheXMgZm9sbG93IGEgYC9gIGluIHRoZSBwYXR0ZXJuLiBUbyBnZXQgcmlkIG9mIHRoaXMgd2FybmluZywgIiArICgicGxlYXNlIGNoYW5nZSB0aGUgcm91dGUgcGF0aCB0byBcIiIgKyBwYXRoLnJlcGxhY2UoL1wqJC8sICIvKiIpICsgIlwiLiIpKTsKICAgICAgICAgICAgdmFyIHBhcmFtTmFtZXMgPSBbXTsKICAgICAgICAgICAgdmFyIHJlZ2V4cFNvdXJjZSA9ICJeIiArIHBhdGgucmVwbGFjZSgvXC8qXCo/JC8sICIiKSAvLyBJZ25vcmUgdHJhaWxpbmcgLyBhbmQgLyosIHdlJ2xsIGhhbmRsZSBpdCBiZWxvdwogICAgICAgICAgICAucmVwbGFjZSgvXlwvKi8sICIvIikgLy8gTWFrZSBzdXJlIGl0IGhhcyBhIGxlYWRpbmcgLwogICAgICAgICAgICAucmVwbGFjZSgvW1xcLiorXiQ/e318KClbXF1dL2csICJcXCQmIikgLy8gRXNjYXBlIHNwZWNpYWwgcmVnZXggY2hhcnMKICAgICAgICAgICAgLnJlcGxhY2UoL1wvOihcdyspL2csIChfLCBwYXJhbU5hbWUpID0+IHsKICAgICAgICAgICAgICBwYXJhbU5hbWVzLnB1c2gocGFyYW1OYW1lKTsKICAgICAgICAgICAgICByZXR1cm4gIi8oW15cXC9dKykiOwogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIGlmIChwYXRoLmVuZHNXaXRoKCIqIikpIHsKICAgICAgICAgICAgICBwYXJhbU5hbWVzLnB1c2goIioiKTsKICAgICAgICAgICAgICByZWdleHBTb3VyY2UgKz0gcGF0aCA9PT0gIioiIHx8IHBhdGggPT09ICIvKiIgPyAiKC4qKSQiIC8vIEFscmVhZHkgbWF0Y2hlZCB0aGUgaW5pdGlhbCAvLCBqdXN0IG1hdGNoIHRoZSByZXN0CiAgICAgICAgICAgICAgOiAiKD86XFwvKC4rKXxcXC8qKSQiOyAvLyBEb24ndCBpbmNsdWRlIHRoZSAvIGluIHBhcmFtc1siKiJdCiAgICAgICAgICAgIH0gZWxzZSBpZiAoZW5kKSB7CiAgICAgICAgICAgICAgLy8gV2hlbiBtYXRjaGluZyB0byB0aGUgZW5kLCBpZ25vcmUgdHJhaWxpbmcgc2xhc2hlcwogICAgICAgICAgICAgIHJlZ2V4cFNvdXJjZSArPSAiXFwvKiQiOwogICAgICAgICAgICB9IGVsc2UgaWYgKHBhdGggIT09ICIiICYmIHBhdGggIT09ICIvIikgewogICAgICAgICAgICAgIC8vIElmIG91ciBwYXRoIGlzIG5vbi1lbXB0eSBhbmQgY29udGFpbnMgYW55dGhpbmcgYmV5b25kIGFuIGluaXRpYWwgc2xhc2gsCiAgICAgICAgICAgICAgLy8gdGhlbiB3ZSBoYXZlIF9zb21lXyBmb3JtIG9mIHBhdGggaW4gb3VyIHJlZ2V4IHNvIHdlIHNob3VsZCBleHBlY3QgdG8KICAgICAgICAgICAgICAvLyBtYXRjaCBvbmx5IGlmIHdlIGZpbmQgdGhlIGVuZCBvZiB0aGlzIHBhdGggc2VnbWVudC4gIExvb2sgZm9yIGFuIG9wdGlvbmFsCiAgICAgICAgICAgICAgLy8gbm9uLWNhcHR1cmVkIHRyYWlsaW5nIHNsYXNoICh0byBtYXRjaCBhIHBvcnRpb24gb2YgdGhlIFVSTCkgb3IgdGhlIGVuZAogICAgICAgICAgICAgIC8vIG9mIHRoZSBwYXRoIChpZiB3ZSd2ZSBtYXRjaGVkIHRvIHRoZSBlbmQpLiAgV2UgdXNlZCB0byBkbyB0aGlzIHdpdGggYQogICAgICAgICAgICAgIC8vIHdvcmQgYm91bmRhcnkgYnV0IHRoYXQgZ2l2ZXMgZmFsc2UgcG9zaXRpdmVzIG9uIHJvdXRlcyBsaWtlCiAgICAgICAgICAgICAgLy8gL3VzZXItcHJlZmVyZW5jZXMgc2luY2UgYC1gIGNvdW50cyBhcyBhIHdvcmQgYm91bmRhcnkuCiAgICAgICAgICAgICAgcmVnZXhwU291cmNlICs9ICIoPzooPz1cXC98JCkpIjsKICAgICAgICAgICAgfSBlbHNlIDsKCiAgICAgICAgICAgIHZhciBtYXRjaGVyID0gbmV3IFJlZ0V4cChyZWdleHBTb3VyY2UsIGNhc2VTZW5zaXRpdmUgPyB1bmRlZmluZWQgOiAiaSIpOwogICAgICAgICAgICByZXR1cm4gW21hdGNoZXIsIHBhcmFtTmFtZXNdOwogICAgICAgICAgfQoKICAgICAgICAgIGZ1bmN0aW9uIHNhZmVseURlY29kZVVSSSh2YWx1ZSkgewogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgIHJldHVybiBkZWNvZGVVUkkodmFsdWUpOwogICAgICAgICAgICB9IGNhdGNoIChlcnJvcikgewogICAgICAgICAgICAgIHdhcm5pbmcoZmFsc2UsICJUaGUgVVJMIHBhdGggXCIiICsgdmFsdWUgKyAiXCIgY291bGQgbm90IGJlIGRlY29kZWQgYmVjYXVzZSBpdCBpcyBpcyBhICIgKyAibWFsZm9ybWVkIFVSTCBzZWdtZW50LiBUaGlzIGlzIHByb2JhYmx5IGR1ZSB0byBhIGJhZCBwZXJjZW50ICIgKyAoImVuY29kaW5nICgiICsgZXJyb3IgKyAiKS4iKSk7CiAgICAgICAgICAgICAgcmV0dXJuIHZhbHVlOwogICAgICAgICAgICB9CiAgICAgICAgICB9CgogICAgICAgICAgZnVuY3Rpb24gc2FmZWx5RGVjb2RlVVJJQ29tcG9uZW50KHZhbHVlLCBwYXJhbU5hbWUpIHsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICByZXR1cm4gZGVjb2RlVVJJQ29tcG9uZW50KHZhbHVlKTsKICAgICAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICAgICAgICB3YXJuaW5nKGZhbHNlLCAiVGhlIHZhbHVlIGZvciB0aGUgVVJMIHBhcmFtIFwiIiArIHBhcmFtTmFtZSArICJcIiB3aWxsIG5vdCBiZSBkZWNvZGVkIGJlY2F1c2UiICsgKCIgdGhlIHN0cmluZyBcIiIgKyB2YWx1ZSArICJcIiBpcyBhIG1hbGZvcm1lZCBVUkwgc2VnbWVudC4gVGhpcyBpcyBwcm9iYWJseSIpICsgKCIgZHVlIHRvIGEgYmFkIHBlcmNlbnQgZW5jb2RpbmcgKCIgKyBlcnJvciArICIpLiIpKTsKICAgICAgICAgICAgICByZXR1cm4gdmFsdWU7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIC8qKgogICAgICAgICAgICogQHByaXZhdGUKICAgICAgICAgICAqLwoKCiAgICAgICAgICBmdW5jdGlvbiBzdHJpcEJhc2VuYW1lKHBhdGhuYW1lLCBiYXNlbmFtZSkgewogICAgICAgICAgICBpZiAoYmFzZW5hbWUgPT09ICIvIikgcmV0dXJuIHBhdGhuYW1lOwoKICAgICAgICAgICAgaWYgKCFwYXRobmFtZS50b0xvd2VyQ2FzZSgpLnN0YXJ0c1dpdGgoYmFzZW5hbWUudG9Mb3dlckNhc2UoKSkpIHsKICAgICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICAgICAgfSAvLyBXZSB3YW50IHRvIGxlYXZlIHRyYWlsaW5nIHNsYXNoIGJlaGF2aW9yIGluIHRoZSB1c2VyJ3MgY29udHJvbCwgc28gaWYgdGhleQogICAgICAgICAgICAvLyBzcGVjaWZ5IGEgYmFzZW5hbWUgd2l0aCBhIHRyYWlsaW5nIHNsYXNoLCB3ZSBzaG91bGQgc3VwcG9ydCBpdAoKCiAgICAgICAgICAgIHZhciBzdGFydEluZGV4ID0gYmFzZW5hbWUuZW5kc1dpdGgoIi8iKSA/IGJhc2VuYW1lLmxlbmd0aCAtIDEgOiBiYXNlbmFtZS5sZW5ndGg7CiAgICAgICAgICAgIHZhciBuZXh0Q2hhciA9IHBhdGhuYW1lLmNoYXJBdChzdGFydEluZGV4KTsKCiAgICAgICAgICAgIGlmIChuZXh0Q2hhciAmJiBuZXh0Q2hhciAhPT0gIi8iKSB7CiAgICAgICAgICAgICAgLy8gcGF0aG5hbWUgZG9lcyBub3Qgc3RhcnQgd2l0aCBiYXNlbmFtZS8KICAgICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuIHBhdGhuYW1lLnNsaWNlKHN0YXJ0SW5kZXgpIHx8ICIvIjsKICAgICAgICAgIH0KICAgICAgICAgIC8qKgogICAgICAgICAgICogQHByaXZhdGUKICAgICAgICAgICAqLwoKICAgICAgICAgIGZ1bmN0aW9uIHdhcm5pbmcoY29uZCwgbWVzc2FnZSkgewogICAgICAgICAgICBpZiAoIWNvbmQpIHsKICAgICAgICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tY29uc29sZQogICAgICAgICAgICAgIGlmICh0eXBlb2YgY29uc29sZSAhPT0gInVuZGVmaW5lZCIpIGNvbnNvbGUud2FybihtZXNzYWdlKTsKCiAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIC8vIFdlbGNvbWUgdG8gZGVidWdnaW5nIEByZW1peC1ydW4vcm91dGVyIQogICAgICAgICAgICAgICAgLy8KICAgICAgICAgICAgICAgIC8vIFRoaXMgZXJyb3IgaXMgdGhyb3duIGFzIGEgY29udmVuaWVuY2Ugc28geW91IGNhbiBtb3JlIGVhc2lseQogICAgICAgICAgICAgICAgLy8gZmluZCB0aGUgc291cmNlIGZvciBhIHdhcm5pbmcgdGhhdCBhcHBlYXJzIGluIHRoZSBjb25zb2xlIGJ5CiAgICAgICAgICAgICAgICAvLyBlbmFibGluZyAicGF1c2Ugb24gZXhjZXB0aW9ucyIgaW4geW91ciBKYXZhU2NyaXB0IGRlYnVnZ2VyLgogICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKG1lc3NhZ2UpOyAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tZW1wdHkKICAgICAgICAgICAgICB9IGNhdGNoIChlKSB7fQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICAvKioKICAgICAgICAgICAqIFJldHVybnMgYSByZXNvbHZlZCBwYXRoIG9iamVjdCByZWxhdGl2ZSB0byB0aGUgZ2l2ZW4gcGF0aG5hbWUuCiAgICAgICAgICAgKgogICAgICAgICAgICogQHNlZSBodHRwczovL3JlYWN0cm91dGVyLmNvbS91dGlscy9yZXNvbHZlLXBhdGgKICAgICAgICAgICAqLwoKICAgICAgICAgIGZ1bmN0aW9uIHJlc29sdmVQYXRoKHRvLCBmcm9tUGF0aG5hbWUpIHsKICAgICAgICAgICAgaWYgKGZyb21QYXRobmFtZSA9PT0gdm9pZCAwKSB7CiAgICAgICAgICAgICAgZnJvbVBhdGhuYW1lID0gIi8iOwogICAgICAgICAgICB9CgogICAgICAgICAgICB2YXIgX3JlZjEyID0KCgoKICAgICAgICAgICAgICB0eXBlb2YgdG8gPT09ICJzdHJpbmciID8gcGFyc2VQYXRoKHRvKSA6IHRvLHRvUGF0aG5hbWUgPSBfcmVmMTIucGF0aG5hbWUsX3JlZjEyJHNlYXJjaCA9IF9yZWYxMi5zZWFyY2gsc2VhcmNoID0gX3JlZjEyJHNlYXJjaCA9PT0gdm9pZCAwID8gIiIgOiBfcmVmMTIkc2VhcmNoLF9yZWYxMiRoYXNoID0gX3JlZjEyLmhhc2gsaGFzaCA9IF9yZWYxMiRoYXNoID09PSB2b2lkIDAgPyAiIiA6IF9yZWYxMiRoYXNoOwogICAgICAgICAgICB2YXIgcGF0aG5hbWUgPSB0b1BhdGhuYW1lID8gdG9QYXRobmFtZS5zdGFydHNXaXRoKCIvIikgPyB0b1BhdGhuYW1lIDogcmVzb2x2ZVBhdGhuYW1lKHRvUGF0aG5hbWUsIGZyb21QYXRobmFtZSkgOiBmcm9tUGF0aG5hbWU7CiAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgcGF0aG5hbWU6IHBhdGhuYW1lLAogICAgICAgICAgICAgIHNlYXJjaDogbm9ybWFsaXplU2VhcmNoKHNlYXJjaCksCiAgICAgICAgICAgICAgaGFzaDogbm9ybWFsaXplSGFzaChoYXNoKQogICAgICAgICAgICB9OwogICAgICAgICAgfQoKICAgICAgICAgIGZ1bmN0aW9uIHJlc29sdmVQYXRobmFtZShyZWxhdGl2ZVBhdGgsIGZyb21QYXRobmFtZSkgewogICAgICAgICAgICB2YXIgc2VnbWVudHMgPSBmcm9tUGF0aG5hbWUucmVwbGFjZSgvXC8rJC8sICIiKS5zcGxpdCgiLyIpOwogICAgICAgICAgICB2YXIgcmVsYXRpdmVTZWdtZW50cyA9IHJlbGF0aXZlUGF0aC5zcGxpdCgiLyIpOwogICAgICAgICAgICByZWxhdGl2ZVNlZ21lbnRzLmZvckVhY2goKHNlZ21lbnQpID0+IHsKICAgICAgICAgICAgICBpZiAoc2VnbWVudCA9PT0gIi4uIikgewogICAgICAgICAgICAgICAgLy8gS2VlcCB0aGUgcm9vdCAiIiBzZWdtZW50IHNvIHRoZSBwYXRobmFtZSBzdGFydHMgYXQgLwogICAgICAgICAgICAgICAgaWYgKHNlZ21lbnRzLmxlbmd0aCA+IDEpIHNlZ21lbnRzLnBvcCgpOwogICAgICAgICAgICAgIH0gZWxzZSBpZiAoc2VnbWVudCAhPT0gIi4iKSB7CiAgICAgICAgICAgICAgICBzZWdtZW50cy5wdXNoKHNlZ21lbnQpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIHJldHVybiBzZWdtZW50cy5sZW5ndGggPiAxID8gc2VnbWVudHMuam9pbigiLyIpIDogIi8iOwogICAgICAgICAgfQoKICAgICAgICAgIGZ1bmN0aW9uIGdldEludmFsaWRQYXRoRXJyb3IoY2hhciwgZmllbGQsIGRlc3QsIHBhdGgpIHsKICAgICAgICAgICAgcmV0dXJuICJDYW5ub3QgaW5jbHVkZSBhICciICsgY2hhciArICInIGNoYXJhY3RlciBpbiBhIG1hbnVhbGx5IHNwZWNpZmllZCAiICsgKCJgdG8uIiArIGZpZWxkICsgImAgZmllbGQgWyIgKyBKU09OLnN0cmluZ2lmeShwYXRoKSArICJdLiAgUGxlYXNlIHNlcGFyYXRlIGl0IG91dCB0byB0aGUgIikgKyAoImB0by4iICsgZGVzdCArICJgIGZpZWxkLiBBbHRlcm5hdGl2ZWx5IHlvdSBtYXkgcHJvdmlkZSB0aGUgZnVsbCBwYXRoIGFzICIpICsgImEgc3RyaW5nIGluIDxMaW5rIHRvPVwiLi4uXCI+IGFuZCB0aGUgcm91dGVyIHdpbGwgcGFyc2UgaXQgZm9yIHlvdS4iOwogICAgICAgICAgfQogICAgICAgICAgLyoqCiAgICAgICAgICAgKiBAcHJpdmF0ZQogICAgICAgICAgICoKICAgICAgICAgICAqIFdoZW4gcHJvY2Vzc2luZyByZWxhdGl2ZSBuYXZpZ2F0aW9uIHdlIHdhbnQgdG8gaWdub3JlIGFuY2VzdG9yIHJvdXRlcyB0aGF0CiAgICAgICAgICAgKiBkbyBub3QgY29udHJpYnV0ZSB0byB0aGUgcGF0aCwgc3VjaCB0aGF0IGluZGV4L3BhdGhsZXNzIGxheW91dCByb3V0ZXMgZG9uJ3QKICAgICAgICAgICAqIGludGVyZmVyZS4KICAgICAgICAgICAqCiAgICAgICAgICAgKiBGb3IgZXhhbXBsZSwgd2hlbiBtb3ZpbmcgYSByb3V0ZSBlbGVtZW50IGludG8gYW4gaW5kZXggcm91dGUgYW5kL29yIGEKICAgICAgICAgICAqIHBhdGhsZXNzIGxheW91dCByb3V0ZSwgcmVsYXRpdmUgbGluayBiZWhhdmlvciBjb250YWluZWQgd2l0aGluIHNob3VsZCBzdGF5CiAgICAgICAgICAgKiB0aGUgc2FtZS4gIEJvdGggb2YgdGhlIGZvbGxvd2luZyBleGFtcGxlcyBzaG91bGQgbGluayBiYWNrIHRvIHRoZSByb290OgogICAgICAgICAgICoKICAgICAgICAgICAqICAgPFJvdXRlIHBhdGg9Ii8iPgogICAgICAgICAgICogICAgIDxSb3V0ZSBwYXRoPSJhY2NvdW50cyIgZWxlbWVudD17PExpbmsgdG89Ii4uIn0+CiAgICAgICAgICAgKiAgIDwvUm91dGU+CiAgICAgICAgICAgKgogICAgICAgICAgICogICA8Um91dGUgcGF0aD0iLyI+CiAgICAgICAgICAgKiAgICAgPFJvdXRlIHBhdGg9ImFjY291bnRzIj4KICAgICAgICAgICAqICAgICAgIDxSb3V0ZSBlbGVtZW50PXs8QWNjb3VudHNMYXlvdXQgLz59PiAgICAgICAvLyA8LS0gRG9lcyBub3QgY29udHJpYnV0ZQogICAgICAgICAgICogICAgICAgICA8Um91dGUgaW5kZXggZWxlbWVudD17PExpbmsgdG89Ii4uIn0gLz4gIC8vIDwtLSBEb2VzIG5vdCBjb250cmlidXRlCiAgICAgICAgICAgKiAgICAgICA8L1JvdXRlCiAgICAgICAgICAgKiAgICAgPC9Sb3V0ZT4KICAgICAgICAgICAqICAgPC9Sb3V0ZT4KICAgICAgICAgICAqLwoKCiAgICAgICAgICBmdW5jdGlvbiBnZXRQYXRoQ29udHJpYnV0aW5nTWF0Y2hlcyhtYXRjaGVzKSB7CiAgICAgICAgICAgIHJldHVybiBtYXRjaGVzLmZpbHRlcigobWF0Y2gsIGluZGV4KSA9PiBpbmRleCA9PT0gMCB8fCBtYXRjaC5yb3V0ZS5wYXRoICYmIG1hdGNoLnJvdXRlLnBhdGgubGVuZ3RoID4gMCk7CiAgICAgICAgICB9CiAgICAgICAgICAvKioKICAgICAgICAgICAqIEBwcml2YXRlCiAgICAgICAgICAgKi8KCiAgICAgICAgICBmdW5jdGlvbiByZXNvbHZlVG8odG9BcmcsIHJvdXRlUGF0aG5hbWVzLCBsb2NhdGlvblBhdGhuYW1lLCBpc1BhdGhSZWxhdGl2ZSkgewogICAgICAgICAgICBpZiAoaXNQYXRoUmVsYXRpdmUgPT09IHZvaWQgMCkgewogICAgICAgICAgICAgIGlzUGF0aFJlbGF0aXZlID0gZmFsc2U7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHZhciB0bzsKCiAgICAgICAgICAgIGlmICh0eXBlb2YgdG9BcmcgPT09ICJzdHJpbmciKSB7CiAgICAgICAgICAgICAgdG8gPSBwYXJzZVBhdGgodG9BcmcpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIHRvID0gX2V4dGVuZHMoe30sIHRvQXJnKTsKICAgICAgICAgICAgICByb3V0ZXJfaW52YXJpYW50KCF0by5wYXRobmFtZSB8fCAhdG8ucGF0aG5hbWUuaW5jbHVkZXMoIj8iKSwgZ2V0SW52YWxpZFBhdGhFcnJvcigiPyIsICJwYXRobmFtZSIsICJzZWFyY2giLCB0bykpOwogICAgICAgICAgICAgIHJvdXRlcl9pbnZhcmlhbnQoIXRvLnBhdGhuYW1lIHx8ICF0by5wYXRobmFtZS5pbmNsdWRlcygiIyIpLCBnZXRJbnZhbGlkUGF0aEVycm9yKCIjIiwgInBhdGhuYW1lIiwgImhhc2giLCB0bykpOwogICAgICAgICAgICAgIHJvdXRlcl9pbnZhcmlhbnQoIXRvLnNlYXJjaCB8fCAhdG8uc2VhcmNoLmluY2x1ZGVzKCIjIiksIGdldEludmFsaWRQYXRoRXJyb3IoIiMiLCAic2VhcmNoIiwgImhhc2giLCB0bykpOwogICAgICAgICAgICB9CgogICAgICAgICAgICB2YXIgaXNFbXB0eVBhdGggPSB0b0FyZyA9PT0gIiIgfHwgdG8ucGF0aG5hbWUgPT09ICIiOwogICAgICAgICAgICB2YXIgdG9QYXRobmFtZSA9IGlzRW1wdHlQYXRoID8gIi8iIDogdG8ucGF0aG5hbWU7CiAgICAgICAgICAgIHZhciBmcm9tOyAvLyBSb3V0aW5nIGlzIHJlbGF0aXZlIHRvIHRoZSBjdXJyZW50IHBhdGhuYW1lIGlmIGV4cGxpY2l0bHkgcmVxdWVzdGVkLgogICAgICAgICAgICAvLwogICAgICAgICAgICAvLyBJZiBhIHBhdGhuYW1lIGlzIGV4cGxpY2l0bHkgcHJvdmlkZWQgaW4gYHRvYCwgaXQgc2hvdWxkIGJlIHJlbGF0aXZlIHRvIHRoZQogICAgICAgICAgICAvLyByb3V0ZSBjb250ZXh0LiBUaGlzIGlzIGV4cGxhaW5lZCBpbiBgTm90ZSBvbiBgPExpbmsgdG8+YCB2YWx1ZXNgIGluIG91cgogICAgICAgICAgICAvLyBtaWdyYXRpb24gZ3VpZGUgZnJvbSB2NSBhcyBhIG1lYW5zIG9mIGRpc2FtYmlndWF0aW9uIGJldHdlZW4gYHRvYCB2YWx1ZXMKICAgICAgICAgICAgLy8gdGhhdCBiZWdpbiB3aXRoIGAvYCBhbmQgdGhvc2UgdGhhdCBkbyBub3QuIEhvd2V2ZXIsIHRoaXMgaXMgcHJvYmxlbWF0aWMgZm9yCiAgICAgICAgICAgIC8vIGB0b2AgdmFsdWVzIHRoYXQgZG8gbm90IHByb3ZpZGUgYSBwYXRobmFtZS4gYHRvYCBjYW4gc2ltcGx5IGJlIGEgc2VhcmNoIG9yCiAgICAgICAgICAgIC8vIGhhc2ggc3RyaW5nLCBpbiB3aGljaCBjYXNlIHdlIHNob3VsZCBhc3N1bWUgdGhhdCB0aGUgbmF2aWdhdGlvbiBpcyByZWxhdGl2ZQogICAgICAgICAgICAvLyB0byB0aGUgY3VycmVudCBsb2NhdGlvbidzIHBhdGhuYW1lIGFuZCAqbm90KiB0aGUgcm91dGUgcGF0aG5hbWUuCgogICAgICAgICAgICBpZiAoaXNQYXRoUmVsYXRpdmUgfHwgdG9QYXRobmFtZSA9PSBudWxsKSB7CiAgICAgICAgICAgICAgZnJvbSA9IGxvY2F0aW9uUGF0aG5hbWU7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgdmFyIHJvdXRlUGF0aG5hbWVJbmRleCA9IHJvdXRlUGF0aG5hbWVzLmxlbmd0aCAtIDE7CgogICAgICAgICAgICAgIGlmICh0b1BhdGhuYW1lLnN0YXJ0c1dpdGgoIi4uIikpIHsKICAgICAgICAgICAgICAgIHZhciB0b1NlZ21lbnRzID0gdG9QYXRobmFtZS5zcGxpdCgiLyIpOyAvLyBFYWNoIGxlYWRpbmcgLi4gc2VnbWVudCBtZWFucyAiZ28gdXAgb25lIHJvdXRlIiBpbnN0ZWFkIG9mICJnbyB1cCBvbmUKICAgICAgICAgICAgICAgIC8vIFVSTCBzZWdtZW50Ii4gIFRoaXMgaXMgYSBrZXkgZGlmZmVyZW5jZSBmcm9tIGhvdyA8YSBocmVmPiB3b3JrcyBhbmQgYQogICAgICAgICAgICAgICAgLy8gbWFqb3IgcmVhc29uIHdlIGNhbGwgdGhpcyBhICJ0byIgdmFsdWUgaW5zdGVhZCBvZiBhICJocmVmIi4KCiAgICAgICAgICAgICAgICB3aGlsZSAodG9TZWdtZW50c1swXSA9PT0gIi4uIikgewogICAgICAgICAgICAgICAgICB0b1NlZ21lbnRzLnNoaWZ0KCk7CiAgICAgICAgICAgICAgICAgIHJvdXRlUGF0aG5hbWVJbmRleCAtPSAxOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHRvLnBhdGhuYW1lID0gdG9TZWdtZW50cy5qb2luKCIvIik7CiAgICAgICAgICAgICAgfSAvLyBJZiB0aGVyZSBhcmUgbW9yZSAiLi4iIHNlZ21lbnRzIHRoYW4gcGFyZW50IHJvdXRlcywgcmVzb2x2ZSByZWxhdGl2ZSB0bwogICAgICAgICAgICAgIC8vIHRoZSByb290IC8gVVJMLgoKCiAgICAgICAgICAgICAgZnJvbSA9IHJvdXRlUGF0aG5hbWVJbmRleCA+PSAwID8gcm91dGVQYXRobmFtZXNbcm91dGVQYXRobmFtZUluZGV4XSA6ICIvIjsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdmFyIHBhdGggPSByZXNvbHZlUGF0aCh0bywgZnJvbSk7IC8vIEVuc3VyZSB0aGUgcGF0aG5hbWUgaGFzIGEgdHJhaWxpbmcgc2xhc2ggaWYgdGhlIG9yaWdpbmFsICJ0byIgaGFkIG9uZQoKICAgICAgICAgICAgdmFyIGhhc0V4cGxpY2l0VHJhaWxpbmdTbGFzaCA9IHRvUGF0aG5hbWUgJiYgdG9QYXRobmFtZSAhPT0gIi8iICYmIHRvUGF0aG5hbWUuZW5kc1dpdGgoIi8iKTsgLy8gT3IgaWYgdGhpcyB3YXMgYSBsaW5rIHRvIHRoZSBjdXJyZW50IHBhdGggd2hpY2ggaGFzIGEgdHJhaWxpbmcgc2xhc2gKCiAgICAgICAgICAgIHZhciBoYXNDdXJyZW50VHJhaWxpbmdTbGFzaCA9IChpc0VtcHR5UGF0aCB8fCB0b1BhdGhuYW1lID09PSAiLiIpICYmIGxvY2F0aW9uUGF0aG5hbWUuZW5kc1dpdGgoIi8iKTsKCiAgICAgICAgICAgIGlmICghcGF0aC5wYXRobmFtZS5lbmRzV2l0aCgiLyIpICYmIChoYXNFeHBsaWNpdFRyYWlsaW5nU2xhc2ggfHwgaGFzQ3VycmVudFRyYWlsaW5nU2xhc2gpKSB7CiAgICAgICAgICAgICAgcGF0aC5wYXRobmFtZSArPSAiLyI7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybiBwYXRoOwogICAgICAgICAgfQogICAgICAgICAgLyoqCiAgICAgICAgICAgKiBAcHJpdmF0ZQogICAgICAgICAgICovCgogICAgICAgICAgZnVuY3Rpb24gZ2V0VG9QYXRobmFtZSh0bykgewogICAgICAgICAgICAvLyBFbXB0eSBzdHJpbmdzIHNob3VsZCBiZSB0cmVhdGVkIHRoZSBzYW1lIGFzIC8gcGF0aHMKICAgICAgICAgICAgcmV0dXJuIHRvID09PSAiIiB8fCB0by5wYXRobmFtZSA9PT0gIiIgPyAiLyIgOiB0eXBlb2YgdG8gPT09ICJzdHJpbmciID8gcGFyc2VQYXRoKHRvKS5wYXRobmFtZSA6IHRvLnBhdGhuYW1lOwogICAgICAgICAgfQogICAgICAgICAgLyoqCiAgICAgICAgICAgKiBAcHJpdmF0ZQogICAgICAgICAgICovCgogICAgICAgICAgdmFyIHJvdXRlcl9qb2luUGF0aHMgPSAocGF0aHMpID0+IHBhdGhzLmpvaW4oIi8iKS5yZXBsYWNlKC9cL1wvKy9nLCAiLyIpOwogICAgICAgICAgLyoqCiAgICAgICAgICAgKiBAcHJpdmF0ZQogICAgICAgICAgICovCgogICAgICAgICAgdmFyIG5vcm1hbGl6ZVBhdGhuYW1lID0gKHBhdGhuYW1lKSA9PiBwYXRobmFtZS5yZXBsYWNlKC9cLyskLywgIiIpLnJlcGxhY2UoL15cLyovLCAiLyIpOwogICAgICAgICAgLyoqCiAgICAgICAgICAgKiBAcHJpdmF0ZQogICAgICAgICAgICovCgogICAgICAgICAgdmFyIG5vcm1hbGl6ZVNlYXJjaCA9IChzZWFyY2gpID0+ICFzZWFyY2ggfHwgc2VhcmNoID09PSAiPyIgPyAiIiA6IHNlYXJjaC5zdGFydHNXaXRoKCI/IikgPyBzZWFyY2ggOiAiPyIgKyBzZWFyY2g7CiAgICAgICAgICAvKioKICAgICAgICAgICAqIEBwcml2YXRlCiAgICAgICAgICAgKi8KCiAgICAgICAgICB2YXIgbm9ybWFsaXplSGFzaCA9IChoYXNoKSA9PiAhaGFzaCB8fCBoYXNoID09PSAiIyIgPyAiIiA6IGhhc2guc3RhcnRzV2l0aCgiIyIpID8gaGFzaCA6ICIjIiArIGhhc2g7CiAgICAgICAgICAvKioKICAgICAgICAgICAqIFRoaXMgaXMgYSBzaG9ydGN1dCBmb3IgY3JlYXRpbmcgYGFwcGxpY2F0aW9uL2pzb25gIHJlc3BvbnNlcy4gQ29udmVydHMgYGRhdGFgCiAgICAgICAgICAgKiB0byBKU09OIGFuZCBzZXRzIHRoZSBgQ29udGVudC1UeXBlYCBoZWFkZXIuCiAgICAgICAgICAgKi8KCiAgICAgICAgICB2YXIganNvbiA9IGZ1bmN0aW9uIGpzb24oZGF0YSwgaW5pdCkgewogICAgICAgICAgICBpZiAoaW5pdCA9PT0gdm9pZCAwKSB7CiAgICAgICAgICAgICAgaW5pdCA9IHt9OwogICAgICAgICAgICB9CgogICAgICAgICAgICB2YXIgcmVzcG9uc2VJbml0ID0gdHlwZW9mIGluaXQgPT09ICJudW1iZXIiID8gewogICAgICAgICAgICAgIHN0YXR1czogaW5pdAogICAgICAgICAgICB9IDogaW5pdDsKICAgICAgICAgICAgdmFyIGhlYWRlcnMgPSBuZXcgSGVhZGVycyhyZXNwb25zZUluaXQuaGVhZGVycyk7CgogICAgICAgICAgICBpZiAoIWhlYWRlcnMuaGFzKCJDb250ZW50LVR5cGUiKSkgewogICAgICAgICAgICAgIGhlYWRlcnMuc2V0KCJDb250ZW50LVR5cGUiLCAiYXBwbGljYXRpb24vanNvbjsgY2hhcnNldD11dGYtOCIpOwogICAgICAgICAgICB9CgogICAgICAgICAgICByZXR1cm4gbmV3IFJlc3BvbnNlKEpTT04uc3RyaW5naWZ5KGRhdGEpLCBfZXh0ZW5kcyh7fSwgcmVzcG9uc2VJbml0LCB7CiAgICAgICAgICAgICAgaGVhZGVyczogaGVhZGVycwogICAgICAgICAgICB9KSk7CiAgICAgICAgICB9O3ZhcgogICAgICAgICAgcm91dGVyX0Fib3J0ZWREZWZlcnJlZEVycm9yID0gLyojX19QVVJFX18qL2Z1bmN0aW9uIChfRXJyb3IpIHtfaW5oZXJpdHMocm91dGVyX0Fib3J0ZWREZWZlcnJlZEVycm9yLCBfRXJyb3IpO3ZhciBfc3VwZXIgPSBfY3JlYXRlU3VwZXIocm91dGVyX0Fib3J0ZWREZWZlcnJlZEVycm9yKTtmdW5jdGlvbiByb3V0ZXJfQWJvcnRlZERlZmVycmVkRXJyb3IoKSB7X2NsYXNzQ2FsbENoZWNrMih0aGlzLCByb3V0ZXJfQWJvcnRlZERlZmVycmVkRXJyb3IpO3JldHVybiBfc3VwZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKTt9cmV0dXJuIF9jcmVhdGVDbGFzczIocm91dGVyX0Fib3J0ZWREZWZlcnJlZEVycm9yKTt9KCAvKiNfX1BVUkVfXyovX3dyYXBOYXRpdmVTdXBlcihFcnJvcikpO3ZhcgogICAgICAgICAgRGVmZXJyZWREYXRhID0gLyojX19QVVJFX18qL2Z1bmN0aW9uICgpIHsKICAgICAgICAgICAgZnVuY3Rpb24gRGVmZXJyZWREYXRhKGRhdGEsIHJlc3BvbnNlSW5pdCkge19jbGFzc0NhbGxDaGVjazIodGhpcywgRGVmZXJyZWREYXRhKTsKICAgICAgICAgICAgICB0aGlzLnBlbmRpbmdLZXlzU2V0ID0gbmV3IFNldCgpOwogICAgICAgICAgICAgIHRoaXMuc3Vic2NyaWJlcnMgPSBuZXcgU2V0KCk7CiAgICAgICAgICAgICAgdGhpcy5kZWZlcnJlZEtleXMgPSBbXTsKICAgICAgICAgICAgICByb3V0ZXJfaW52YXJpYW50KGRhdGEgJiYgdHlwZW9mIGRhdGEgPT09ICJvYmplY3QiICYmICFBcnJheS5pc0FycmF5KGRhdGEpLCAiZGVmZXIoKSBvbmx5IGFjY2VwdHMgcGxhaW4gb2JqZWN0cyIpOyAvLyBTZXQgdXAgYW4gQWJvcnRDb250cm9sbGVyICsgUHJvbWlzZSB3ZSBjYW4gcmFjZSBhZ2FpbnN0IHRvIGV4aXQgZWFybHkKICAgICAgICAgICAgICAvLyBjYW5jZWxsYXRpb24KCiAgICAgICAgICAgICAgdmFyIHJlamVjdDsKICAgICAgICAgICAgICB0aGlzLmFib3J0UHJvbWlzZSA9IG5ldyBQcm9taXNlKChfLCByKSA9PiByZWplY3QgPSByKTsKICAgICAgICAgICAgICB0aGlzLmNvbnRyb2xsZXIgPSBuZXcgQWJvcnRDb250cm9sbGVyKCk7CgogICAgICAgICAgICAgIHZhciBvbkFib3J0ID0gKCkgPT4gcmVqZWN0KG5ldyByb3V0ZXJfQWJvcnRlZERlZmVycmVkRXJyb3IoIkRlZmVycmVkIGRhdGEgYWJvcnRlZCIpKTsKCiAgICAgICAgICAgICAgdGhpcy51bmxpc3RlbkFib3J0U2lnbmFsID0gKCkgPT4gdGhpcy5jb250cm9sbGVyLnNpZ25hbC5yZW1vdmVFdmVudExpc3RlbmVyKCJhYm9ydCIsIG9uQWJvcnQpOwoKICAgICAgICAgICAgICB0aGlzLmNvbnRyb2xsZXIuc2lnbmFsLmFkZEV2ZW50TGlzdGVuZXIoImFib3J0Iiwgb25BYm9ydCk7CiAgICAgICAgICAgICAgdGhpcy5kYXRhID0gT2JqZWN0LmVudHJpZXMoZGF0YSkucmVkdWNlKChhY2MsIF9yZWYpID0+IHsKICAgICAgICAgICAgICAgIHZhciBfcmVmMTMgPSBfc2xpY2VkVG9BcnJheTIoX3JlZiwgMiksa2V5ID0gX3JlZjEzWzBdLHZhbHVlID0gX3JlZjEzWzFdOwogICAgICAgICAgICAgICAgcmV0dXJuIE9iamVjdC5hc3NpZ24oYWNjLCBfZGVmaW5lUHJvcGVydHkyKHt9LAogICAgICAgICAgICAgICAga2V5LCB0aGlzLnRyYWNrUHJvbWlzZShrZXksIHZhbHVlKSkpOwoKICAgICAgICAgICAgICB9LCB7fSk7CiAgICAgICAgICAgICAgdGhpcy5pbml0ID0gcmVzcG9uc2VJbml0OwogICAgICAgICAgICB9X2NyZWF0ZUNsYXNzMihEZWZlcnJlZERhdGEsIFt7IGtleTogInRyYWNrUHJvbWlzZSIsIHZhbHVlOgoKICAgICAgICAgICAgICBmdW5jdGlvbiB0cmFja1Byb21pc2Uoa2V5LCB2YWx1ZSkgewogICAgICAgICAgICAgICAgaWYgKCEodmFsdWUgaW5zdGFuY2VvZiBQcm9taXNlKSkgewogICAgICAgICAgICAgICAgICByZXR1cm4gdmFsdWU7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgdGhpcy5kZWZlcnJlZEtleXMucHVzaChrZXkpOwogICAgICAgICAgICAgICAgdGhpcy5wZW5kaW5nS2V5c1NldC5hZGQoa2V5KTsgLy8gV2Ugc3RvcmUgYSBsaXR0bGUgd3JhcHBlciBwcm9taXNlIHRoYXQgd2lsbCBiZSBleHRlbmRlZCB3aXRoCiAgICAgICAgICAgICAgICAvLyBfZGF0YS9fZXJyb3IgcHJvcHMgdXBvbiByZXNvbHZlL3JlamVjdAoKICAgICAgICAgICAgICAgIHZhciBwcm9taXNlID0gUHJvbWlzZS5yYWNlKFt2YWx1ZSwgdGhpcy5hYm9ydFByb21pc2VdKS50aGVuKChkYXRhKSA9PiB0aGlzLm9uU2V0dGxlKHByb21pc2UsIGtleSwgbnVsbCwgZGF0YSksIChlcnJvcikgPT4gdGhpcy5vblNldHRsZShwcm9taXNlLCBrZXksIGVycm9yKSk7IC8vIFJlZ2lzdGVyIHJlamVjdGlvbiBsaXN0ZW5lcnMgdG8gYXZvaWQgdW5jYXVnaHQgcHJvbWlzZSByZWplY3Rpb25zIG9uCiAgICAgICAgICAgICAgICAvLyBlcnJvcnMgb3IgYWJvcnRlZCBkZWZlcnJlZCB2YWx1ZXMKCiAgICAgICAgICAgICAgICBwcm9taXNlLmNhdGNoKCgpID0+IHt9KTsKICAgICAgICAgICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShwcm9taXNlLCAiX3RyYWNrZWQiLCB7CiAgICAgICAgICAgICAgICAgIGdldDogKCkgPT4gdHJ1ZQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICByZXR1cm4gcHJvbWlzZTsKICAgICAgICAgICAgICB9IH0sIHsga2V5OiAib25TZXR0bGUiLCB2YWx1ZToKCiAgICAgICAgICAgICAgZnVuY3Rpb24gb25TZXR0bGUocHJvbWlzZSwga2V5LCBlcnJvciwgZGF0YSkgewogICAgICAgICAgICAgICAgaWYgKHRoaXMuY29udHJvbGxlci5zaWduYWwuYWJvcnRlZCAmJiBlcnJvciBpbnN0YW5jZW9mIHJvdXRlcl9BYm9ydGVkRGVmZXJyZWRFcnJvcikgewogICAgICAgICAgICAgICAgICB0aGlzLnVubGlzdGVuQWJvcnRTaWduYWwoKTsKICAgICAgICAgICAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHByb21pc2UsICJfZXJyb3IiLCB7CiAgICAgICAgICAgICAgICAgICAgZ2V0OiAoKSA9PiBlcnJvcgogICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KGVycm9yKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICB0aGlzLnBlbmRpbmdLZXlzU2V0LmRlbGV0ZShrZXkpOwoKICAgICAgICAgICAgICAgIGlmICh0aGlzLmRvbmUpIHsKICAgICAgICAgICAgICAgICAgLy8gTm90aGluZyBsZWZ0IHRvIGFib3J0IQogICAgICAgICAgICAgICAgICB0aGlzLnVubGlzdGVuQWJvcnRTaWduYWwoKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBpZiAoZXJyb3IpIHsKICAgICAgICAgICAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHByb21pc2UsICJfZXJyb3IiLCB7CiAgICAgICAgICAgICAgICAgICAgZ2V0OiAoKSA9PiBlcnJvcgogICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgdGhpcy5lbWl0KGZhbHNlLCBrZXkpOwogICAgICAgICAgICAgICAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QoZXJyb3IpOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShwcm9taXNlLCAiX2RhdGEiLCB7CiAgICAgICAgICAgICAgICAgIGdldDogKCkgPT4gZGF0YQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB0aGlzLmVtaXQoZmFsc2UsIGtleSk7CiAgICAgICAgICAgICAgICByZXR1cm4gZGF0YTsKICAgICAgICAgICAgICB9IH0sIHsga2V5OiAiZW1pdCIsIHZhbHVlOgoKICAgICAgICAgICAgICBmdW5jdGlvbiBlbWl0KGFib3J0ZWQsIHNldHRsZWRLZXkpIHsKICAgICAgICAgICAgICAgIHRoaXMuc3Vic2NyaWJlcnMuZm9yRWFjaCgoc3Vic2NyaWJlcikgPT4gc3Vic2NyaWJlcihhYm9ydGVkLCBzZXR0bGVkS2V5KSk7CiAgICAgICAgICAgICAgfSB9LCB7IGtleTogInN1YnNjcmliZSIsIHZhbHVlOgoKICAgICAgICAgICAgICBmdW5jdGlvbiBzdWJzY3JpYmUoZm4pIHsKICAgICAgICAgICAgICAgIHRoaXMuc3Vic2NyaWJlcnMuYWRkKGZuKTsKICAgICAgICAgICAgICAgIHJldHVybiAoKSA9PiB0aGlzLnN1YnNjcmliZXJzLmRlbGV0ZShmbik7CiAgICAgICAgICAgICAgfSB9LCB7IGtleTogImNhbmNlbCIsIHZhbHVlOgoKICAgICAgICAgICAgICBmdW5jdGlvbiBjYW5jZWwoKSB7CiAgICAgICAgICAgICAgICB0aGlzLmNvbnRyb2xsZXIuYWJvcnQoKTsKICAgICAgICAgICAgICAgIHRoaXMucGVuZGluZ0tleXNTZXQuZm9yRWFjaCgodiwgaykgPT4gdGhpcy5wZW5kaW5nS2V5c1NldC5kZWxldGUoaykpOwogICAgICAgICAgICAgICAgdGhpcy5lbWl0KHRydWUpOwogICAgICAgICAgICAgIH0gfSwgeyBrZXk6ICJyZXNvbHZlRGF0YSIsIHZhbHVlOiBmdW5jdGlvbiAoKSB7dmFyIF9yZXNvbHZlRGF0YSA9IF9hc3luY1RvR2VuZXJhdG9yMiggLyojX19QVVJFX18qL19yZWdlbmVyYXRvclJ1bnRpbWUyKCkubWFyaygKCiAgICAgICAgICAgICAgICBmdW5jdGlvbiBfY2FsbGVlMihzaWduYWwpIHt2YXIgYWJvcnRlZCwgb25BYm9ydDtyZXR1cm4gX3JlZ2VuZXJhdG9yUnVudGltZTIoKS53cmFwKGZ1bmN0aW9uIF9jYWxsZWUyJChfY29udGV4dDIpIHt3aGlsZSAoMSkgc3dpdGNoIChfY29udGV4dDIucHJldiA9IF9jb250ZXh0Mi5uZXh0KSB7Y2FzZSAwOgogICAgICAgICAgICAgICAgICAgICAgICBhYm9ydGVkID0gZmFsc2U7aWYgKAoKICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5kb25lKSB7X2NvbnRleHQyLm5leHQgPSA3O2JyZWFrO30KICAgICAgICAgICAgICAgICAgICAgICAgb25BYm9ydCA9ICgpID0+IHRoaXMuY2FuY2VsKCk7CgogICAgICAgICAgICAgICAgICAgICAgICBzaWduYWwuYWRkRXZlbnRMaXN0ZW5lcigiYWJvcnQiLCBvbkFib3J0KTtfY29udGV4dDIubmV4dCA9IDY7cmV0dXJuICgKICAgICAgICAgICAgICAgICAgICAgICAgICBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zdWJzY3JpYmUoKGFib3J0ZWQpID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2lnbmFsLnJlbW92ZUV2ZW50TGlzdGVuZXIoImFib3J0Iiwgb25BYm9ydCk7CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoYWJvcnRlZCB8fCB0aGlzLmRvbmUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKGFib3J0ZWQpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgICB9KSk7Y2FzZSA2OmFib3J0ZWQgPSBfY29udGV4dDIuc2VudDtjYXNlIDc6cmV0dXJuIF9jb250ZXh0Mi5hYnJ1cHQoInJldHVybiIsCgoKICAgICAgICAgICAgICAgICAgICAgICAgYWJvcnRlZCk7Y2FzZSA4OmNhc2UgImVuZCI6cmV0dXJuIF9jb250ZXh0Mi5zdG9wKCk7fX0sIF9jYWxsZWUyLCB0aGlzKTt9KSk7ZnVuY3Rpb24gcmVzb2x2ZURhdGEoX3gzKSB7cmV0dXJuIF9yZXNvbHZlRGF0YS5hcHBseSh0aGlzLCBhcmd1bWVudHMpO31yZXR1cm4gcmVzb2x2ZURhdGE7fSgpIH0sIHsga2V5OiAiZG9uZSIsIGdldDoKCgogICAgICAgICAgICAgIGZ1bmN0aW9uIGdldCgpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnBlbmRpbmdLZXlzU2V0LnNpemUgPT09IDA7CiAgICAgICAgICAgICAgfSB9LCB7IGtleTogInVud3JhcHBlZERhdGEiLCBnZXQ6CgogICAgICAgICAgICAgIGZ1bmN0aW9uIGdldCgpIHsKICAgICAgICAgICAgICAgIHJvdXRlcl9pbnZhcmlhbnQodGhpcy5kYXRhICE9PSBudWxsICYmIHRoaXMuZG9uZSwgIkNhbiBvbmx5IHVud3JhcCBkYXRhIG9uIGluaXRpYWxpemVkIGFuZCBzZXR0bGVkIGRlZmVycmVkcyIpOwogICAgICAgICAgICAgICAgcmV0dXJuIE9iamVjdC5lbnRyaWVzKHRoaXMuZGF0YSkucmVkdWNlKChhY2MsIF9yZWYyKSA9PiB7CiAgICAgICAgICAgICAgICAgIHZhciBfcmVmMTQgPSBfc2xpY2VkVG9BcnJheTIoX3JlZjIsIDIpLGtleSA9IF9yZWYxNFswXSx2YWx1ZSA9IF9yZWYxNFsxXTsKICAgICAgICAgICAgICAgICAgcmV0dXJuIE9iamVjdC5hc3NpZ24oYWNjLCBfZGVmaW5lUHJvcGVydHkyKHt9LAogICAgICAgICAgICAgICAgICBrZXksIHVud3JhcFRyYWNrZWRQcm9taXNlKHZhbHVlKSkpOwoKICAgICAgICAgICAgICAgIH0sIHt9KTsKICAgICAgICAgICAgICB9IH0sIHsga2V5OiAicGVuZGluZ0tleXMiLCBnZXQ6CgogICAgICAgICAgICAgIGZ1bmN0aW9uIGdldCgpIHsKICAgICAgICAgICAgICAgIHJldHVybiBBcnJheS5mcm9tKHRoaXMucGVuZGluZ0tleXNTZXQpOwogICAgICAgICAgICAgIH0gfV0pO3JldHVybiBEZWZlcnJlZERhdGE7fSgpOwoKCgogICAgICAgICAgZnVuY3Rpb24gaXNUcmFja2VkUHJvbWlzZSh2YWx1ZSkgewogICAgICAgICAgICByZXR1cm4gdmFsdWUgaW5zdGFuY2VvZiBQcm9taXNlICYmIHZhbHVlLl90cmFja2VkID09PSB0cnVlOwogICAgICAgICAgfQoKICAgICAgICAgIGZ1bmN0aW9uIHVud3JhcFRyYWNrZWRQcm9taXNlKHZhbHVlKSB7CiAgICAgICAgICAgIGlmICghaXNUcmFja2VkUHJvbWlzZSh2YWx1ZSkpIHsKICAgICAgICAgICAgICByZXR1cm4gdmFsdWU7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmICh2YWx1ZS5fZXJyb3IpIHsKICAgICAgICAgICAgICB0aHJvdyB2YWx1ZS5fZXJyb3I7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybiB2YWx1ZS5fZGF0YTsKICAgICAgICAgIH0KCiAgICAgICAgICB2YXIgZGVmZXIgPSBmdW5jdGlvbiBkZWZlcihkYXRhLCBpbml0KSB7CiAgICAgICAgICAgIGlmIChpbml0ID09PSB2b2lkIDApIHsKICAgICAgICAgICAgICBpbml0ID0ge307CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHZhciByZXNwb25zZUluaXQgPSB0eXBlb2YgaW5pdCA9PT0gIm51bWJlciIgPyB7CiAgICAgICAgICAgICAgc3RhdHVzOiBpbml0CiAgICAgICAgICAgIH0gOiBpbml0OwogICAgICAgICAgICByZXR1cm4gbmV3IERlZmVycmVkRGF0YShkYXRhLCByZXNwb25zZUluaXQpOwogICAgICAgICAgfTsKICAgICAgICAgIC8qKgogICAgICAgICAgICogQSByZWRpcmVjdCByZXNwb25zZS4gU2V0cyB0aGUgc3RhdHVzIGNvZGUgYW5kIHRoZSBgTG9jYXRpb25gIGhlYWRlci4KICAgICAgICAgICAqIERlZmF1bHRzIHRvICIzMDIgRm91bmQiLgogICAgICAgICAgICovCgogICAgICAgICAgdmFyIHJlZGlyZWN0ID0gZnVuY3Rpb24gcmVkaXJlY3QodXJsLCBpbml0KSB7CiAgICAgICAgICAgIGlmIChpbml0ID09PSB2b2lkIDApIHsKICAgICAgICAgICAgICBpbml0ID0gMzAyOwogICAgICAgICAgICB9CgogICAgICAgICAgICB2YXIgcmVzcG9uc2VJbml0ID0gaW5pdDsKCiAgICAgICAgICAgIGlmICh0eXBlb2YgcmVzcG9uc2VJbml0ID09PSAibnVtYmVyIikgewogICAgICAgICAgICAgIHJlc3BvbnNlSW5pdCA9IHsKICAgICAgICAgICAgICAgIHN0YXR1czogcmVzcG9uc2VJbml0CiAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgfSBlbHNlIGlmICh0eXBlb2YgcmVzcG9uc2VJbml0LnN0YXR1cyA9PT0gInVuZGVmaW5lZCIpIHsKICAgICAgICAgICAgICByZXNwb25zZUluaXQuc3RhdHVzID0gMzAyOwogICAgICAgICAgICB9CgogICAgICAgICAgICB2YXIgaGVhZGVycyA9IG5ldyBIZWFkZXJzKHJlc3BvbnNlSW5pdC5oZWFkZXJzKTsKICAgICAgICAgICAgaGVhZGVycy5zZXQoIkxvY2F0aW9uIiwgdXJsKTsKICAgICAgICAgICAgcmV0dXJuIG5ldyBSZXNwb25zZShudWxsLCBfZXh0ZW5kcyh7fSwgcmVzcG9uc2VJbml0LCB7CiAgICAgICAgICAgICAgaGVhZGVyczogaGVhZGVycwogICAgICAgICAgICB9KSk7CiAgICAgICAgICB9OwogICAgICAgICAgLyoqCiAgICAgICAgICAgKiBAcHJpdmF0ZQogICAgICAgICAgICogVXRpbGl0eSBjbGFzcyB3ZSB1c2UgdG8gaG9sZCBhdXRvLXVud3JhcHBlZCA0eHgvNXh4IFJlc3BvbnNlIGJvZGllcwogICAgICAgICAgICovdmFyCgogICAgICAgICAgcm91dGVyX0Vycm9yUmVzcG9uc2UgPSAvKiNfX1BVUkVfXyovX2NyZWF0ZUNsYXNzMigKICAgICAgICAgIGZ1bmN0aW9uIHJvdXRlcl9FcnJvclJlc3BvbnNlKHN0YXR1cywgc3RhdHVzVGV4dCwgZGF0YSwgaW50ZXJuYWwpIHtfY2xhc3NDYWxsQ2hlY2syKHRoaXMsIHJvdXRlcl9FcnJvclJlc3BvbnNlKTsKICAgICAgICAgICAgaWYgKGludGVybmFsID09PSB2b2lkIDApIHsKICAgICAgICAgICAgICBpbnRlcm5hbCA9IGZhbHNlOwogICAgICAgICAgICB9CgogICAgICAgICAgICB0aGlzLnN0YXR1cyA9IHN0YXR1czsKICAgICAgICAgICAgdGhpcy5zdGF0dXNUZXh0ID0gc3RhdHVzVGV4dCB8fCAiIjsKICAgICAgICAgICAgdGhpcy5pbnRlcm5hbCA9IGludGVybmFsOwoKICAgICAgICAgICAgaWYgKGRhdGEgaW5zdGFuY2VvZiBFcnJvcikgewogICAgICAgICAgICAgIHRoaXMuZGF0YSA9IGRhdGEudG9TdHJpbmcoKTsKICAgICAgICAgICAgICB0aGlzLmVycm9yID0gZGF0YTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICB0aGlzLmRhdGEgPSBkYXRhOwogICAgICAgICAgICB9CiAgICAgICAgICB9KTsKCgogICAgICAgICAgLyoqCiAgICAgICAgICAgKiBDaGVjayBpZiB0aGUgZ2l2ZW4gZXJyb3IgaXMgYW4gRXJyb3JSZXNwb25zZSBnZW5lcmF0ZWQgZnJvbSBhIDR4eC81eHgKICAgICAgICAgICAqIFJlc3BvbnNlIHRocm93IGZyb20gYW4gYWN0aW9uL2xvYWRlcgogICAgICAgICAgICovCgogICAgICAgICAgZnVuY3Rpb24gaXNSb3V0ZUVycm9yUmVzcG9uc2UoZSkgewogICAgICAgICAgICByZXR1cm4gZSBpbnN0YW5jZW9mIHJvdXRlcl9FcnJvclJlc3BvbnNlOwogICAgICAgICAgfQoKICAgICAgICAgIHZhciB2YWxpZE11dGF0aW9uTWV0aG9kc0FyciA9IFsicG9zdCIsICJwdXQiLCAicGF0Y2giLCAiZGVsZXRlIl07CiAgICAgICAgICB2YXIgdmFsaWRNdXRhdGlvbk1ldGhvZHMgPSBuZXcgU2V0KHZhbGlkTXV0YXRpb25NZXRob2RzQXJyKTsKICAgICAgICAgIHZhciB2YWxpZFJlcXVlc3RNZXRob2RzQXJyID0gWyJnZXQiXS5jb25jYXQodmFsaWRNdXRhdGlvbk1ldGhvZHNBcnIpOwogICAgICAgICAgdmFyIHZhbGlkUmVxdWVzdE1ldGhvZHMgPSBuZXcgU2V0KHZhbGlkUmVxdWVzdE1ldGhvZHNBcnIpOwogICAgICAgICAgdmFyIHJlZGlyZWN0U3RhdHVzQ29kZXMgPSBuZXcgU2V0KFszMDEsIDMwMiwgMzAzLCAzMDcsIDMwOF0pOwogICAgICAgICAgdmFyIHJlZGlyZWN0UHJlc2VydmVNZXRob2RTdGF0dXNDb2RlcyA9IG5ldyBTZXQoWzMwNywgMzA4XSk7CiAgICAgICAgICB2YXIgSURMRV9OQVZJR0FUSU9OID0gewogICAgICAgICAgICBzdGF0ZTogImlkbGUiLAogICAgICAgICAgICBsb2NhdGlvbjogdW5kZWZpbmVkLAogICAgICAgICAgICBmb3JtTWV0aG9kOiB1bmRlZmluZWQsCiAgICAgICAgICAgIGZvcm1BY3Rpb246IHVuZGVmaW5lZCwKICAgICAgICAgICAgZm9ybUVuY1R5cGU6IHVuZGVmaW5lZCwKICAgICAgICAgICAgZm9ybURhdGE6IHVuZGVmaW5lZAogICAgICAgICAgfTsKICAgICAgICAgIHZhciBJRExFX0ZFVENIRVIgPSB7CiAgICAgICAgICAgIHN0YXRlOiAiaWRsZSIsCiAgICAgICAgICAgIGRhdGE6IHVuZGVmaW5lZCwKICAgICAgICAgICAgZm9ybU1ldGhvZDogdW5kZWZpbmVkLAogICAgICAgICAgICBmb3JtQWN0aW9uOiB1bmRlZmluZWQsCiAgICAgICAgICAgIGZvcm1FbmNUeXBlOiB1bmRlZmluZWQsCiAgICAgICAgICAgIGZvcm1EYXRhOiB1bmRlZmluZWQKICAgICAgICAgIH07CiAgICAgICAgICB2YXIgSURMRV9CTE9DS0VSID0gewogICAgICAgICAgICBzdGF0ZTogInVuYmxvY2tlZCIsCiAgICAgICAgICAgIHByb2NlZWQ6IHVuZGVmaW5lZCwKICAgICAgICAgICAgcmVzZXQ6IHVuZGVmaW5lZCwKICAgICAgICAgICAgbG9jYXRpb246IHVuZGVmaW5lZAogICAgICAgICAgfTsKICAgICAgICAgIHZhciBpc0Jyb3dzZXIgPSB0eXBlb2Ygd2luZG93ICE9PSAidW5kZWZpbmVkIiAmJiB0eXBlb2Ygd2luZG93LmRvY3VtZW50ICE9PSAidW5kZWZpbmVkIiAmJiB0eXBlb2Ygd2luZG93LmRvY3VtZW50LmNyZWF0ZUVsZW1lbnQgIT09ICJ1bmRlZmluZWQiOwogICAgICAgICAgdmFyIGlzU2VydmVyID0gIWlzQnJvd3NlcjsgLy8jZW5kcmVnaW9uCiAgICAgICAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwogICAgICAgICAgLy8jcmVnaW9uIGNyZWF0ZVJvdXRlcgogICAgICAgICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KCiAgICAgICAgICAvKioKICAgICAgICAgICAqIENyZWF0ZSBhIHJvdXRlciBhbmQgbGlzdGVuIHRvIGhpc3RvcnkgUE9QIG5hdmlnYXRpb25zCiAgICAgICAgICAgKi8KCiAgICAgICAgICBmdW5jdGlvbiByb3V0ZXJfY3JlYXRlUm91dGVyKGluaXQpIHsKICAgICAgICAgICAgcm91dGVyX2ludmFyaWFudChpbml0LnJvdXRlcy5sZW5ndGggPiAwLCAiWW91IG11c3QgcHJvdmlkZSBhIG5vbi1lbXB0eSByb3V0ZXMgYXJyYXkgdG8gY3JlYXRlUm91dGVyIik7CiAgICAgICAgICAgIHZhciBkYXRhUm91dGVzID0gY29udmVydFJvdXRlc1RvRGF0YVJvdXRlcyhpbml0LnJvdXRlcyk7IC8vIENsZWFudXAgZnVuY3Rpb24gZm9yIGhpc3RvcnkKCiAgICAgICAgICAgIHZhciB1bmxpc3Rlbkhpc3RvcnkgPSBudWxsOyAvLyBFeHRlcm5hbGx5LXByb3ZpZGVkIGZ1bmN0aW9ucyB0byBjYWxsIG9uIGFsbCBzdGF0ZSBjaGFuZ2VzCgogICAgICAgICAgICB2YXIgc3Vic2NyaWJlcnMgPSBuZXcgU2V0KCk7IC8vIEV4dGVybmFsbHktcHJvdmlkZWQgb2JqZWN0IHRvIGhvbGQgc2Nyb2xsIHJlc3RvcmF0aW9uIGxvY2F0aW9ucyBkdXJpbmcgcm91dGluZwoKICAgICAgICAgICAgdmFyIHNhdmVkU2Nyb2xsUG9zaXRpb25zID0gbnVsbDsgLy8gRXh0ZXJuYWxseS1wcm92aWRlZCBmdW5jdGlvbiB0byBnZXQgc2Nyb2xsIHJlc3RvcmF0aW9uIGtleXMKCiAgICAgICAgICAgIHZhciBnZXRTY3JvbGxSZXN0b3JhdGlvbktleSA9IG51bGw7IC8vIEV4dGVybmFsbHktcHJvdmlkZWQgZnVuY3Rpb24gdG8gZ2V0IGN1cnJlbnQgc2Nyb2xsIHBvc2l0aW9uCgogICAgICAgICAgICB2YXIgZ2V0U2Nyb2xsUG9zaXRpb24gPSBudWxsOyAvLyBPbmUtdGltZSBmbGFnIHRvIGNvbnRyb2wgdGhlIGluaXRpYWwgaHlkcmF0aW9uIHNjcm9sbCByZXN0b3JhdGlvbi4gIEJlY2F1c2UKICAgICAgICAgICAgLy8gd2UgZG9uJ3QgZ2V0IHRoZSBzYXZlZCBwb3NpdGlvbnMgZnJvbSA8U2Nyb2xsUmVzdG9yYXRpb24gLz4gdW50aWwgX2FmdGVyXwogICAgICAgICAgICAvLyB0aGUgaW5pdGlhbCByZW5kZXIsIHdlIG5lZWQgdG8gbWFudWFsbHkgdHJpZ2dlciBhIHNlcGFyYXRlIHVwZGF0ZVN0YXRlIHRvCiAgICAgICAgICAgIC8vIHNlbmQgYWxvbmcgdGhlIHJlc3RvcmVTY3JvbGxQb3NpdGlvbgogICAgICAgICAgICAvLyBTZXQgdG8gdHJ1ZSBpZiB3ZSBoYXZlIGBoeWRyYXRpb25EYXRhYCBzaW5jZSB3ZSBhc3N1bWUgd2Ugd2VyZSBTU1InZCBhbmQgdGhhdAogICAgICAgICAgICAvLyBTU1IgZGlkIHRoZSBpbml0aWFsIHNjcm9sbCByZXN0b3JhdGlvbi4KCiAgICAgICAgICAgIHZhciBpbml0aWFsU2Nyb2xsUmVzdG9yZWQgPSBpbml0Lmh5ZHJhdGlvbkRhdGEgIT0gbnVsbDsKICAgICAgICAgICAgdmFyIGluaXRpYWxNYXRjaGVzID0gbWF0Y2hSb3V0ZXMoZGF0YVJvdXRlcywgaW5pdC5oaXN0b3J5LmxvY2F0aW9uLCBpbml0LmJhc2VuYW1lKTsKICAgICAgICAgICAgdmFyIGluaXRpYWxFcnJvcnMgPSBudWxsOwoKICAgICAgICAgICAgaWYgKGluaXRpYWxNYXRjaGVzID09IG51bGwpIHsKICAgICAgICAgICAgICAvLyBJZiB3ZSBkbyBub3QgbWF0Y2ggYSB1c2VyLXByb3ZpZGVkLXJvdXRlLCBmYWxsIGJhY2sgdG8gdGhlIHJvb3QKICAgICAgICAgICAgICAvLyB0byBhbGxvdyB0aGUgZXJyb3IgYm91bmRhcnkgdG8gdGFrZSBvdmVyCiAgICAgICAgICAgICAgdmFyIGVycm9yID0gZ2V0SW50ZXJuYWxSb3V0ZXJFcnJvcig0MDQsIHsKICAgICAgICAgICAgICAgIHBhdGhuYW1lOiBpbml0Lmhpc3RvcnkubG9jYXRpb24ucGF0aG5hbWUKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICB2YXIgX2dldFNob3J0Q2lyY3VpdE1hdGNoID0KCgogICAgICAgICAgICAgICAgZ2V0U2hvcnRDaXJjdWl0TWF0Y2hlcyhkYXRhUm91dGVzKSxtYXRjaGVzID0gX2dldFNob3J0Q2lyY3VpdE1hdGNoLm1hdGNoZXMscm91dGUgPSBfZ2V0U2hvcnRDaXJjdWl0TWF0Y2gucm91dGU7CiAgICAgICAgICAgICAgaW5pdGlhbE1hdGNoZXMgPSBtYXRjaGVzOwogICAgICAgICAgICAgIGluaXRpYWxFcnJvcnMgPSBfZGVmaW5lUHJvcGVydHkyKHt9LAogICAgICAgICAgICAgIHJvdXRlLmlkLCBlcnJvcik7CgogICAgICAgICAgICB9CgogICAgICAgICAgICB2YXIgaW5pdGlhbGl6ZWQgPSAhaW5pdGlhbE1hdGNoZXMuc29tZSgobSkgPT4gbS5yb3V0ZS5sb2FkZXIpIHx8IGluaXQuaHlkcmF0aW9uRGF0YSAhPSBudWxsOwogICAgICAgICAgICB2YXIgcm91dGVyOwogICAgICAgICAgICB2YXIgc3RhdGUgPSB7CiAgICAgICAgICAgICAgaGlzdG9yeUFjdGlvbjogaW5pdC5oaXN0b3J5LmFjdGlvbiwKICAgICAgICAgICAgICBsb2NhdGlvbjogaW5pdC5oaXN0b3J5LmxvY2F0aW9uLAogICAgICAgICAgICAgIG1hdGNoZXM6IGluaXRpYWxNYXRjaGVzLAogICAgICAgICAgICAgIGluaXRpYWxpemVkOiBpbml0aWFsaXplZCwKICAgICAgICAgICAgICBuYXZpZ2F0aW9uOiBJRExFX05BVklHQVRJT04sCiAgICAgICAgICAgICAgLy8gRG9uJ3QgcmVzdG9yZSBvbiBpbml0aWFsIHVwZGF0ZVN0YXRlKCkgaWYgd2Ugd2VyZSBTU1InZAogICAgICAgICAgICAgIHJlc3RvcmVTY3JvbGxQb3NpdGlvbjogaW5pdC5oeWRyYXRpb25EYXRhICE9IG51bGwgPyBmYWxzZSA6IG51bGwsCiAgICAgICAgICAgICAgcHJldmVudFNjcm9sbFJlc2V0OiBmYWxzZSwKICAgICAgICAgICAgICByZXZhbGlkYXRpb246ICJpZGxlIiwKICAgICAgICAgICAgICBsb2FkZXJEYXRhOiBpbml0Lmh5ZHJhdGlvbkRhdGEgJiYgaW5pdC5oeWRyYXRpb25EYXRhLmxvYWRlckRhdGEgfHwge30sCiAgICAgICAgICAgICAgYWN0aW9uRGF0YTogaW5pdC5oeWRyYXRpb25EYXRhICYmIGluaXQuaHlkcmF0aW9uRGF0YS5hY3Rpb25EYXRhIHx8IG51bGwsCiAgICAgICAgICAgICAgZXJyb3JzOiBpbml0Lmh5ZHJhdGlvbkRhdGEgJiYgaW5pdC5oeWRyYXRpb25EYXRhLmVycm9ycyB8fCBpbml0aWFsRXJyb3JzLAogICAgICAgICAgICAgIGZldGNoZXJzOiBuZXcgTWFwKCksCiAgICAgICAgICAgICAgYmxvY2tlcnM6IG5ldyBNYXAoKQogICAgICAgICAgICB9OyAvLyAtLSBTdGF0ZWZ1bCBpbnRlcm5hbCB2YXJpYWJsZXMgdG8gbWFuYWdlIG5hdmlnYXRpb25zIC0tCiAgICAgICAgICAgIC8vIEN1cnJlbnQgbmF2aWdhdGlvbiBpbiBwcm9ncmVzcyAodG8gYmUgY29tbWl0dGVkIGluIGNvbXBsZXRlTmF2aWdhdGlvbikKCiAgICAgICAgICAgIHZhciBwZW5kaW5nQWN0aW9uID0gQWN0aW9uLlBvcDsgLy8gU2hvdWxkIHRoZSBjdXJyZW50IG5hdmlnYXRpb24gcHJldmVudCB0aGUgc2Nyb2xsIHJlc2V0IGlmIHNjcm9sbCBjYW5ub3QKICAgICAgICAgICAgLy8gYmUgcmVzdG9yZWQ/CgogICAgICAgICAgICB2YXIgcGVuZGluZ1ByZXZlbnRTY3JvbGxSZXNldCA9IGZhbHNlOyAvLyBBYm9ydENvbnRyb2xsZXIgZm9yIHRoZSBhY3RpdmUgbmF2aWdhdGlvbgoKICAgICAgICAgICAgdmFyIHBlbmRpbmdOYXZpZ2F0aW9uQ29udHJvbGxlcjsgLy8gV2UgdXNlIHRoaXMgdG8gYXZvaWQgdG91Y2hpbmcgaGlzdG9yeSBpbiBjb21wbGV0ZU5hdmlnYXRpb24gaWYgYQogICAgICAgICAgICAvLyByZXZhbGlkYXRpb24gaXMgZW50aXJlbHkgdW5pbnRlcnJ1cHRlZAoKICAgICAgICAgICAgdmFyIGlzVW5pbnRlcnJ1cHRlZFJldmFsaWRhdGlvbiA9IGZhbHNlOyAvLyBVc2UgdGhpcyBpbnRlcm5hbCBmbGFnIHRvIGZvcmNlIHJldmFsaWRhdGlvbiBvZiBhbGwgbG9hZGVyczoKICAgICAgICAgICAgLy8gIC0gc3VibWlzc2lvbnMgKGNvbXBsZXRlZCBvciBpbnRlcnJ1cHRlZCkKICAgICAgICAgICAgLy8gIC0gdXNlUmV2YWxpZGF0ZSgpCiAgICAgICAgICAgIC8vICAtIFgtUmVtaXgtUmV2YWxpZGF0ZSAoZnJvbSByZWRpcmVjdCkKCiAgICAgICAgICAgIHZhciBpc1JldmFsaWRhdGlvblJlcXVpcmVkID0gZmFsc2U7IC8vIFVzZSB0aGlzIGludGVybmFsIGFycmF5IHRvIGNhcHR1cmUgcm91dGVzIHRoYXQgcmVxdWlyZSByZXZhbGlkYXRpb24gZHVlCiAgICAgICAgICAgIC8vIHRvIGEgY2FuY2VsbGVkIGRlZmVycmVkIG9uIGFjdGlvbiBzdWJtaXNzaW9uCgogICAgICAgICAgICB2YXIgY2FuY2VsbGVkRGVmZXJyZWRSb3V0ZXMgPSBbXTsgLy8gVXNlIHRoaXMgaW50ZXJuYWwgYXJyYXkgdG8gY2FwdHVyZSBmZXRjaGVyIGxvYWRzIHRoYXQgd2VyZSBjYW5jZWxsZWQgYnkgYW4KICAgICAgICAgICAgLy8gYWN0aW9uIG5hdmlnYXRpb24gYW5kIHJlcXVpcmUgcmV2YWxpZGF0aW9uCgogICAgICAgICAgICB2YXIgY2FuY2VsbGVkRmV0Y2hlckxvYWRzID0gW107IC8vIEFib3J0Q29udHJvbGxlcnMgZm9yIGFueSBpbi1mbGlnaHQgZmV0Y2hlcnMKCiAgICAgICAgICAgIHZhciBmZXRjaENvbnRyb2xsZXJzID0gbmV3IE1hcCgpOyAvLyBUcmFjayBsb2FkcyBiYXNlZCBvbiB0aGUgb3JkZXIgaW4gd2hpY2ggdGhleSBzdGFydGVkCgogICAgICAgICAgICB2YXIgaW5jcmVtZW50aW5nTG9hZElkID0gMDsgLy8gVHJhY2sgdGhlIG91dHN0YW5kaW5nIHBlbmRpbmcgbmF2aWdhdGlvbiBkYXRhIGxvYWQgdG8gYmUgY29tcGFyZWQgYWdhaW5zdAogICAgICAgICAgICAvLyB0aGUgZ2xvYmFsbHkgaW5jcmVtZW50aW5nIGxvYWQgd2hlbiBhIGZldGNoZXIgbG9hZCBsYW5kcyBhZnRlciBhIGNvbXBsZXRlZAogICAgICAgICAgICAvLyBuYXZpZ2F0aW9uCgogICAgICAgICAgICB2YXIgcGVuZGluZ05hdmlnYXRpb25Mb2FkSWQgPSAtMTsgLy8gRmV0Y2hlcnMgdGhhdCB0cmlnZ2VyZWQgZGF0YSByZWxvYWRzIGFzIGEgcmVzdWx0IG9mIHRoZWlyIGFjdGlvbnMKCiAgICAgICAgICAgIHZhciBmZXRjaFJlbG9hZElkcyA9IG5ldyBNYXAoKTsgLy8gRmV0Y2hlcnMgdGhhdCB0cmlnZ2VyZWQgcmVkaXJlY3QgbmF2aWdhdGlvbnMgZnJvbSB0aGVpciBhY3Rpb25zCgogICAgICAgICAgICB2YXIgZmV0Y2hSZWRpcmVjdElkcyA9IG5ldyBTZXQoKTsgLy8gTW9zdCByZWNlbnQgaHJlZi9tYXRjaCBmb3IgZmV0Y2hlci5sb2FkIGNhbGxzIGZvciBmZXRjaGVycwoKICAgICAgICAgICAgdmFyIGZldGNoTG9hZE1hdGNoZXMgPSBuZXcgTWFwKCk7IC8vIFN0b3JlIERlZmVycmVkRGF0YSBpbnN0YW5jZXMgZm9yIGFjdGl2ZSByb3V0ZSBtYXRjaGVzLiAgV2hlbiBhCiAgICAgICAgICAgIC8vIHJvdXRlIGxvYWRlciByZXR1cm5zIGRlZmVyKCkgd2Ugc3RpY2sgb25lIGluIGhlcmUuICBUaGVuLCB3aGVuIGEgbmVzdGVkCiAgICAgICAgICAgIC8vIHByb21pc2UgcmVzb2x2ZXMgd2UgdXBkYXRlIGxvYWRlckRhdGEuICBJZiBhIG5ldyBuYXZpZ2F0aW9uIHN0YXJ0cyB3ZQogICAgICAgICAgICAvLyBjYW5jZWwgYWN0aXZlIGRlZmVycmVkcyBmb3IgZWxpbWluYXRlZCByb3V0ZXMuCgogICAgICAgICAgICB2YXIgYWN0aXZlRGVmZXJyZWRzID0gbmV3IE1hcCgpOyAvLyBXZSBvbnkgc3VwcG9ydCBhIHNpbmdsZSBhY3RpdmUgYmxvY2tlciBhdCB0aGUgbW9tZW50IHNpbmNlIHdlIGRvbid0IGhhdmUKICAgICAgICAgICAgLy8gYW55IGNvbXBlbGxpbmcgdXNlIGNhc2VzIGZvciBtdWx0aS1ibG9ja2VyIHlldAoKICAgICAgICAgICAgdmFyIGFjdGl2ZUJsb2NrZXIgPSBudWxsOyAvLyBTdG9yZSBibG9ja2VyIGZ1bmN0aW9ucyBpbiBhIHNlcGFyYXRlIE1hcCBvdXRzaWRlIG9mIHJvdXRlciBzdGF0ZSBzaW5jZQogICAgICAgICAgICAvLyB3ZSBkb24ndCBuZWVkIHRvIHVwZGF0ZSBVSSBzdGF0ZSBpZiB0aGV5IGNoYW5nZQoKICAgICAgICAgICAgdmFyIGJsb2NrZXJGdW5jdGlvbnMgPSBuZXcgTWFwKCk7IC8vIEZsYWcgdG8gaWdub3JlIHRoZSBuZXh0IGhpc3RvcnkgdXBkYXRlLCBzbyB3ZSBjYW4gcmV2ZXJ0IHRoZSBVUkwgY2hhbmdlIG9uCiAgICAgICAgICAgIC8vIGEgUE9QIG5hdmlnYXRpb24gdGhhdCB3YXMgYmxvY2tlZCBieSB0aGUgdXNlciB3aXRob3V0IHRvdWNoaW5nIHJvdXRlciBzdGF0ZQoKICAgICAgICAgICAgdmFyIGlnbm9yZU5leHRIaXN0b3J5VXBkYXRlID0gZmFsc2U7IC8vIEluaXRpYWxpemUgdGhlIHJvdXRlciwgYWxsIHNpZGUgZWZmZWN0cyBzaG91bGQgYmUga2lja2VkIG9mZiBmcm9tIGhlcmUuCiAgICAgICAgICAgIC8vIEltcGxlbWVudGVkIGFzIGEgRmx1ZW50IEFQSSBmb3IgZWFzZSBvZjoKICAgICAgICAgICAgLy8gICBsZXQgcm91dGVyID0gY3JlYXRlUm91dGVyKGluaXQpLmluaXRpYWxpemUoKTsKCiAgICAgICAgICAgIGZ1bmN0aW9uIGluaXRpYWxpemUoKSB7CiAgICAgICAgICAgICAgLy8gSWYgaGlzdG9yeSBpbmZvcm1zIHVzIG9mIGEgUE9QIG5hdmlnYXRpb24sIHN0YXJ0IHRoZSBuYXZpZ2F0aW9uIGJ1dCBkbyBub3QgdXBkYXRlCiAgICAgICAgICAgICAgLy8gc3RhdGUuICBXZSdsbCB1cGRhdGUgb3VyIG93biBzdGF0ZSBvbmNlIHRoZSBuYXZpZ2F0aW9uIGNvbXBsZXRlcwogICAgICAgICAgICAgIHVubGlzdGVuSGlzdG9yeSA9IGluaXQuaGlzdG9yeS5saXN0ZW4oKF9yZWYpID0+IHsKICAgICAgICAgICAgICAgIHZhcgogICAgICAgICAgICAgICAgICBoaXN0b3J5QWN0aW9uID0KCgogICAgICAgICAgICAgICAgICBfcmVmLmFjdGlvbixsb2NhdGlvbiA9IF9yZWYubG9jYXRpb24sZGVsdGEgPSBfcmVmLmRlbHRhOwoKICAgICAgICAgICAgICAgIC8vIElnbm9yZSB0aGlzIGV2ZW50IGlmIGl0IHdhcyBqdXN0IHVzIHJlc2V0dGluZyB0aGUgVVJMIGZyb20gYQogICAgICAgICAgICAgICAgLy8gYmxvY2tlZCBQT1AgbmF2aWdhdGlvbgogICAgICAgICAgICAgICAgaWYgKGlnbm9yZU5leHRIaXN0b3J5VXBkYXRlKSB7CiAgICAgICAgICAgICAgICAgIGlnbm9yZU5leHRIaXN0b3J5VXBkYXRlID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICB2YXIgYmxvY2tlcktleSA9IHNob3VsZEJsb2NrTmF2aWdhdGlvbih7CiAgICAgICAgICAgICAgICAgIGN1cnJlbnRMb2NhdGlvbjogc3RhdGUubG9jYXRpb24sCiAgICAgICAgICAgICAgICAgIG5leHRMb2NhdGlvbjogbG9jYXRpb24sCiAgICAgICAgICAgICAgICAgIGhpc3RvcnlBY3Rpb246IGhpc3RvcnlBY3Rpb24KICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICAgIGlmIChibG9ja2VyS2V5KSB7CiAgICAgICAgICAgICAgICAgIC8vIFJlc3RvcmUgdGhlIFVSTCB0byBtYXRjaCB0aGUgY3VycmVudCBVSSwgYnV0IGRvbid0IHVwZGF0ZSByb3V0ZXIgc3RhdGUKICAgICAgICAgICAgICAgICAgaWdub3JlTmV4dEhpc3RvcnlVcGRhdGUgPSB0cnVlOwogICAgICAgICAgICAgICAgICBpbml0Lmhpc3RvcnkuZ28oZGVsdGEgKiAtMSk7IC8vIFB1dCB0aGUgYmxvY2tlciBpbnRvIGEgYmxvY2tlZCBzdGF0ZQoKICAgICAgICAgICAgICAgICAgdXBkYXRlQmxvY2tlcihibG9ja2VyS2V5LCB7CiAgICAgICAgICAgICAgICAgICAgc3RhdGU6ICJibG9ja2VkIiwKICAgICAgICAgICAgICAgICAgICBsb2NhdGlvbjogbG9jYXRpb24sCgogICAgICAgICAgICAgICAgICAgIHByb2NlZWQ6IGZ1bmN0aW9uIHByb2NlZWQoKSB7CiAgICAgICAgICAgICAgICAgICAgICB1cGRhdGVCbG9ja2VyKGJsb2NrZXJLZXksIHsKICAgICAgICAgICAgICAgICAgICAgICAgc3RhdGU6ICJwcm9jZWVkaW5nIiwKICAgICAgICAgICAgICAgICAgICAgICAgcHJvY2VlZDogdW5kZWZpbmVkLAogICAgICAgICAgICAgICAgICAgICAgICByZXNldDogdW5kZWZpbmVkLAogICAgICAgICAgICAgICAgICAgICAgICBsb2NhdGlvbjogbG9jYXRpb24KICAgICAgICAgICAgICAgICAgICAgIH0pOyAvLyBSZS1kbyB0aGUgc2FtZSBQT1AgbmF2aWdhdGlvbiB3ZSBqdXN0IGJsb2NrZWQKCiAgICAgICAgICAgICAgICAgICAgICBpbml0Lmhpc3RvcnkuZ28oZGVsdGEpOwogICAgICAgICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgICAgICAgIHJlc2V0OiBmdW5jdGlvbiByZXNldCgpIHsKICAgICAgICAgICAgICAgICAgICAgIGRlbGV0ZUJsb2NrZXIoYmxvY2tlcktleSk7CiAgICAgICAgICAgICAgICAgICAgICB1cGRhdGVTdGF0ZSh7CiAgICAgICAgICAgICAgICAgICAgICAgIGJsb2NrZXJzOiBuZXcgTWFwKHJvdXRlci5zdGF0ZS5ibG9ja2VycykKICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgcmV0dXJuIHN0YXJ0TmF2aWdhdGlvbihoaXN0b3J5QWN0aW9uLCBsb2NhdGlvbik7CiAgICAgICAgICAgICAgfSk7IC8vIEtpY2sgb2ZmIGluaXRpYWwgZGF0YSBsb2FkIGlmIG5lZWRlZC4gIFVzZSBQb3AgdG8gYXZvaWQgbW9kaWZ5aW5nIGhpc3RvcnkKCiAgICAgICAgICAgICAgaWYgKCFzdGF0ZS5pbml0aWFsaXplZCkgewogICAgICAgICAgICAgICAgc3RhcnROYXZpZ2F0aW9uKEFjdGlvbi5Qb3AsIHN0YXRlLmxvY2F0aW9uKTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIHJldHVybiByb3V0ZXI7CiAgICAgICAgICAgIH0gLy8gQ2xlYW4gdXAgYSByb3V0ZXIgYW5kIGl0J3Mgc2lkZSBlZmZlY3RzCgoKICAgICAgICAgICAgZnVuY3Rpb24gZGlzcG9zZSgpIHsKICAgICAgICAgICAgICBpZiAodW5saXN0ZW5IaXN0b3J5KSB7CiAgICAgICAgICAgICAgICB1bmxpc3Rlbkhpc3RvcnkoKTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIHN1YnNjcmliZXJzLmNsZWFyKCk7CiAgICAgICAgICAgICAgcGVuZGluZ05hdmlnYXRpb25Db250cm9sbGVyICYmIHBlbmRpbmdOYXZpZ2F0aW9uQ29udHJvbGxlci5hYm9ydCgpOwogICAgICAgICAgICAgIHN0YXRlLmZldGNoZXJzLmZvckVhY2goKF8sIGtleSkgPT4gZGVsZXRlRmV0Y2hlcihrZXkpKTsKICAgICAgICAgICAgICBzdGF0ZS5ibG9ja2Vycy5mb3JFYWNoKChfLCBrZXkpID0+IGRlbGV0ZUJsb2NrZXIoa2V5KSk7CiAgICAgICAgICAgIH0gLy8gU3Vic2NyaWJlIHRvIHN0YXRlIHVwZGF0ZXMgZm9yIHRoZSByb3V0ZXIKCgogICAgICAgICAgICBmdW5jdGlvbiBzdWJzY3JpYmUoZm4pIHsKICAgICAgICAgICAgICBzdWJzY3JpYmVycy5hZGQoZm4pOwogICAgICAgICAgICAgIHJldHVybiAoKSA9PiBzdWJzY3JpYmVycy5kZWxldGUoZm4pOwogICAgICAgICAgICB9IC8vIFVwZGF0ZSBvdXIgc3RhdGUgYW5kIG5vdGlmeSB0aGUgY2FsbGluZyBjb250ZXh0IG9mIHRoZSBjaGFuZ2UKCgogICAgICAgICAgICBmdW5jdGlvbiB1cGRhdGVTdGF0ZShuZXdTdGF0ZSkgewogICAgICAgICAgICAgIHN0YXRlID0gX2V4dGVuZHMoe30sIHN0YXRlLCBuZXdTdGF0ZSk7CiAgICAgICAgICAgICAgc3Vic2NyaWJlcnMuZm9yRWFjaCgoc3Vic2NyaWJlcikgPT4gc3Vic2NyaWJlcihzdGF0ZSkpOwogICAgICAgICAgICB9IC8vIENvbXBsZXRlIGEgbmF2aWdhdGlvbiByZXR1cm5pbmcgdGhlIHN0YXRlLm5hdmlnYXRpb24gYmFjayB0byB0aGUgSURMRV9OQVZJR0FUSU9OCiAgICAgICAgICAgIC8vIGFuZCBzZXR0aW5nIHN0YXRlLltoaXN0b3J5QWN0aW9uL2xvY2F0aW9uL21hdGNoZXNdIHRvIHRoZSBuZXcgcm91dGUuCiAgICAgICAgICAgIC8vIC0gTG9jYXRpb24gaXMgYSByZXF1aXJlZCBwYXJhbQogICAgICAgICAgICAvLyAtIE5hdmlnYXRpb24gd2lsbCBhbHdheXMgYmUgc2V0IHRvIElETEVfTkFWSUdBVElPTgogICAgICAgICAgICAvLyAtIENhbiBwYXNzIGFueSBvdGhlciBzdGF0ZSBpbiBuZXdTdGF0ZQoKCiAgICAgICAgICAgIGZ1bmN0aW9uIGNvbXBsZXRlTmF2aWdhdGlvbihsb2NhdGlvbiwgbmV3U3RhdGUpIHsKICAgICAgICAgICAgICB2YXIgX2xvY2F0aW9uJHN0YXRlLCBfbG9jYXRpb24kc3RhdGUyOwoKICAgICAgICAgICAgICAvLyBEZWR1Y2UgaWYgd2UncmUgaW4gYSBsb2FkaW5nL2FjdGlvblJlbG9hZCBzdGF0ZToKICAgICAgICAgICAgICAvLyAtIFdlIGhhdmUgY29tbWl0dGVkIGFjdGlvbkRhdGEgaW4gdGhlIHN0b3JlCiAgICAgICAgICAgICAgLy8gLSBUaGUgY3VycmVudCBuYXZpZ2F0aW9uIHdhcyBhIG11dGF0aW9uIHN1Ym1pc3Npb24KICAgICAgICAgICAgICAvLyAtIFdlJ3JlIHBhc3QgdGhlIHN1Ym1pdHRpbmcgc3RhdGUgYW5kIGludG8gdGhlIGxvYWRpbmcgc3RhdGUKICAgICAgICAgICAgICAvLyAtIFRoZSBsb2NhdGlvbiBiZWluZyBsb2FkZWQgaXMgbm90IHRoZSByZXN1bHQgb2YgYSByZWRpcmVjdAogICAgICAgICAgICAgIHZhciBpc0FjdGlvblJlbG9hZCA9IHN0YXRlLmFjdGlvbkRhdGEgIT0gbnVsbCAmJiBzdGF0ZS5uYXZpZ2F0aW9uLmZvcm1NZXRob2QgIT0gbnVsbCAmJiBpc011dGF0aW9uTWV0aG9kKHN0YXRlLm5hdmlnYXRpb24uZm9ybU1ldGhvZCkgJiYgc3RhdGUubmF2aWdhdGlvbi5zdGF0ZSA9PT0gImxvYWRpbmciICYmICgoX2xvY2F0aW9uJHN0YXRlID0gbG9jYXRpb24uc3RhdGUpID09IG51bGwgPyB2b2lkIDAgOiBfbG9jYXRpb24kc3RhdGUuX2lzUmVkaXJlY3QpICE9PSB0cnVlOwogICAgICAgICAgICAgIHZhciBhY3Rpb25EYXRhOwoKICAgICAgICAgICAgICBpZiAobmV3U3RhdGUuYWN0aW9uRGF0YSkgewogICAgICAgICAgICAgICAgaWYgKE9iamVjdC5rZXlzKG5ld1N0YXRlLmFjdGlvbkRhdGEpLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgICAgICAgYWN0aW9uRGF0YSA9IG5ld1N0YXRlLmFjdGlvbkRhdGE7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAvLyBFbXB0eSBhY3Rpb25EYXRhIC0+IGNsZWFyIHByaW9yIGFjdGlvbkRhdGEgZHVlIHRvIGFuIGFjdGlvbiBlcnJvcgogICAgICAgICAgICAgICAgICBhY3Rpb25EYXRhID0gbnVsbDsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9IGVsc2UgaWYgKGlzQWN0aW9uUmVsb2FkKSB7CiAgICAgICAgICAgICAgICAvLyBLZWVwIHRoZSBjdXJyZW50IGRhdGEgaWYgd2UncmUgd3JhcHBpbmcgdXAgdGhlIGFjdGlvbiByZWxvYWQKICAgICAgICAgICAgICAgIGFjdGlvbkRhdGEgPSBzdGF0ZS5hY3Rpb25EYXRhOwogICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAvLyBDbGVhciBhY3Rpb25EYXRhIG9uIGFueSBvdGhlciBjb21wbGV0ZWQgbmF2aWdhdGlvbnMKICAgICAgICAgICAgICAgIGFjdGlvbkRhdGEgPSBudWxsOwogICAgICAgICAgICAgIH0gLy8gQWx3YXlzIHByZXNlcnZlIGFueSBleGlzdGluZyBsb2FkZXJEYXRhIGZyb20gcmUtdXNlZCByb3V0ZXMKCgogICAgICAgICAgICAgIHZhciBsb2FkZXJEYXRhID0gbmV3U3RhdGUubG9hZGVyRGF0YSA/IG1lcmdlTG9hZGVyRGF0YShzdGF0ZS5sb2FkZXJEYXRhLCBuZXdTdGF0ZS5sb2FkZXJEYXRhLCBuZXdTdGF0ZS5tYXRjaGVzIHx8IFtdLCBuZXdTdGF0ZS5lcnJvcnMpIDogc3RhdGUubG9hZGVyRGF0YTsgLy8gT24gYSBzdWNjZXNzZnVsIG5hdmlnYXRpb24gd2UgY2FuIGFzc3VtZSB3ZSBnb3QgdGhyb3VnaCBhbGwgYmxvY2tlcnMKICAgICAgICAgICAgICAvLyBzbyB3ZSBjYW4gc3RhcnQgZnJlc2gKICAgICAgICAgICAgICB2YXIgX2l0ZXJhdG9yNCA9IF9jcmVhdGVGb3JPZkl0ZXJhdG9ySGVscGVyMigKICAgICAgICAgICAgICAgIGJsb2NrZXJGdW5jdGlvbnMpLF9zdGVwNDt0cnkge2ZvciAoX2l0ZXJhdG9yNC5zKCk7ICEoX3N0ZXA0ID0gX2l0ZXJhdG9yNC5uKCkpLmRvbmU7KSB7dmFyIF9zdGVwNCR2YWx1ZSA9IF9zbGljZWRUb0FycmF5Mihfc3RlcDQudmFsdWUsIDEpLGtleSA9IF9zdGVwNCR2YWx1ZVswXTsKICAgICAgICAgICAgICAgICAgZGVsZXRlQmxvY2tlcihrZXkpOwogICAgICAgICAgICAgICAgfSAvLyBBbHdheXMgcmVzcGVjdCB0aGUgdXNlciBmbGFnLiAgT3RoZXJ3aXNlIGRvbid0IHJlc2V0IG9uIG11dGF0aW9uCiAgICAgICAgICAgICAgICAvLyBzdWJtaXNzaW9uIG5hdmlnYXRpb25zIHVubGVzcyB0aGV5IHJlZGlyZWN0CiAgICAgICAgICAgICAgfSBjYXRjaCAoZXJyKSB7X2l0ZXJhdG9yNC5lKGVycik7fSBmaW5hbGx5IHtfaXRlcmF0b3I0LmYoKTt9CgogICAgICAgICAgICAgIHZhciBwcmV2ZW50U2Nyb2xsUmVzZXQgPSBwZW5kaW5nUHJldmVudFNjcm9sbFJlc2V0ID09PSB0cnVlIHx8IHN0YXRlLm5hdmlnYXRpb24uZm9ybU1ldGhvZCAhPSBudWxsICYmIGlzTXV0YXRpb25NZXRob2Qoc3RhdGUubmF2aWdhdGlvbi5mb3JtTWV0aG9kKSAmJiAoKF9sb2NhdGlvbiRzdGF0ZTIgPSBsb2NhdGlvbi5zdGF0ZSkgPT0gbnVsbCA/IHZvaWQgMCA6IF9sb2NhdGlvbiRzdGF0ZTIuX2lzUmVkaXJlY3QpICE9PSB0cnVlOwogICAgICAgICAgICAgIHVwZGF0ZVN0YXRlKF9leHRlbmRzKHt9LCBuZXdTdGF0ZSwgewogICAgICAgICAgICAgICAgYWN0aW9uRGF0YTogYWN0aW9uRGF0YSwKICAgICAgICAgICAgICAgIGxvYWRlckRhdGE6IGxvYWRlckRhdGEsCiAgICAgICAgICAgICAgICBoaXN0b3J5QWN0aW9uOiBwZW5kaW5nQWN0aW9uLAogICAgICAgICAgICAgICAgbG9jYXRpb246IGxvY2F0aW9uLAogICAgICAgICAgICAgICAgaW5pdGlhbGl6ZWQ6IHRydWUsCiAgICAgICAgICAgICAgICBuYXZpZ2F0aW9uOiBJRExFX05BVklHQVRJT04sCiAgICAgICAgICAgICAgICByZXZhbGlkYXRpb246ICJpZGxlIiwKICAgICAgICAgICAgICAgIHJlc3RvcmVTY3JvbGxQb3NpdGlvbjogZ2V0U2F2ZWRTY3JvbGxQb3NpdGlvbihsb2NhdGlvbiwgbmV3U3RhdGUubWF0Y2hlcyB8fCBzdGF0ZS5tYXRjaGVzKSwKICAgICAgICAgICAgICAgIHByZXZlbnRTY3JvbGxSZXNldDogcHJldmVudFNjcm9sbFJlc2V0LAogICAgICAgICAgICAgICAgYmxvY2tlcnM6IG5ldyBNYXAoc3RhdGUuYmxvY2tlcnMpCiAgICAgICAgICAgICAgfSkpOwoKICAgICAgICAgICAgICBpZiAoaXNVbmludGVycnVwdGVkUmV2YWxpZGF0aW9uKSA7ZWxzZSBpZiAocGVuZGluZ0FjdGlvbiA9PT0gQWN0aW9uLlBvcCkgO2Vsc2UgaWYgKHBlbmRpbmdBY3Rpb24gPT09IEFjdGlvbi5QdXNoKSB7CiAgICAgICAgICAgICAgICBpbml0Lmhpc3RvcnkucHVzaChsb2NhdGlvbiwgbG9jYXRpb24uc3RhdGUpOwogICAgICAgICAgICAgIH0gZWxzZSBpZiAocGVuZGluZ0FjdGlvbiA9PT0gQWN0aW9uLlJlcGxhY2UpIHsKICAgICAgICAgICAgICAgIGluaXQuaGlzdG9yeS5yZXBsYWNlKGxvY2F0aW9uLCBsb2NhdGlvbi5zdGF0ZSk7CiAgICAgICAgICAgICAgfSAvLyBSZXNldCBzdGF0ZWZ1bCBuYXZpZ2F0aW9uIHZhcnMKCgogICAgICAgICAgICAgIHBlbmRpbmdBY3Rpb24gPSBBY3Rpb24uUG9wOwogICAgICAgICAgICAgIHBlbmRpbmdQcmV2ZW50U2Nyb2xsUmVzZXQgPSBmYWxzZTsKICAgICAgICAgICAgICBpc1VuaW50ZXJydXB0ZWRSZXZhbGlkYXRpb24gPSBmYWxzZTsKICAgICAgICAgICAgICBpc1JldmFsaWRhdGlvblJlcXVpcmVkID0gZmFsc2U7CiAgICAgICAgICAgICAgY2FuY2VsbGVkRGVmZXJyZWRSb3V0ZXMgPSBbXTsKICAgICAgICAgICAgICBjYW5jZWxsZWRGZXRjaGVyTG9hZHMgPSBbXTsKICAgICAgICAgICAgfSAvLyBUcmlnZ2VyIGEgbmF2aWdhdGlvbiBldmVudCwgd2hpY2ggY2FuIGVpdGhlciBiZSBhIG51bWVyaWNhbCBQT1Agb3IgYSBQVVNICiAgICAgICAgICAgIC8vIHJlcGxhY2Ugd2l0aCBhbiBvcHRpb25hbCBzdWJtaXNzaW9uCiAgICAgICAgICAgIGZ1bmN0aW9uCgogICAgICAgICAgICBuYXZpZ2F0ZShfeDQsIF94NSkge3JldHVybiBfbmF2aWdhdGUuYXBwbHkodGhpcywgYXJndW1lbnRzKTt9CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKICAgICAgICAgICAgLy8gUmV2YWxpZGF0ZSBhbGwgY3VycmVudCBsb2FkZXJzLiAgSWYgYSBuYXZpZ2F0aW9uIGlzIGluIHByb2dyZXNzIG9yIGlmIHRoaXMKICAgICAgICAgICAgLy8gaXMgaW50ZXJydXB0ZWQgYnkgYSBuYXZpZ2F0aW9uLCBhbGxvdyB0aGlzIHRvICJzdWNjZWVkIiBieSBjYWxsaW5nIGFsbAogICAgICAgICAgICAvLyBsb2FkZXJzIGR1cmluZyB0aGUgbmV4dCBsb2FkZXIgcm91bmQKICAgICAgICAgICAgZnVuY3Rpb24gX25hdmlnYXRlKCkge19uYXZpZ2F0ZSA9IF9hc3luY1RvR2VuZXJhdG9yMiggLyojX19QVVJFX18qL19yZWdlbmVyYXRvclJ1bnRpbWUyKCkubWFyayhmdW5jdGlvbiBfY2FsbGVlMyh0bywgb3B0cykge3ZhciBfbm9ybWFsaXplTmF2aWdhdGVPcHQyLCBwYXRoLCBzdWJtaXNzaW9uLCBlcnJvciwgY3VycmVudExvY2F0aW9uLCBuZXh0TG9jYXRpb24sIHVzZXJSZXBsYWNlLCBoaXN0b3J5QWN0aW9uLCBwcmV2ZW50U2Nyb2xsUmVzZXQsIGJsb2NrZXJLZXk7cmV0dXJuIF9yZWdlbmVyYXRvclJ1bnRpbWUyKCkud3JhcChmdW5jdGlvbiBfY2FsbGVlMyQoX2NvbnRleHQzKSB7d2hpbGUgKDEpIHN3aXRjaCAoX2NvbnRleHQzLnByZXYgPSBfY29udGV4dDMubmV4dCkge2Nhc2UgMDppZiAoISh0eXBlb2YgdG8gPT09ICJudW1iZXIiKSkge19jb250ZXh0My5uZXh0ID0gMzticmVhazt9aW5pdC5oaXN0b3J5LmdvKHRvKTtyZXR1cm4gX2NvbnRleHQzLmFicnVwdCgicmV0dXJuIik7Y2FzZSAzOl9ub3JtYWxpemVOYXZpZ2F0ZU9wdDIgPSBub3JtYWxpemVOYXZpZ2F0ZU9wdGlvbnModG8sIG9wdHMpLCBwYXRoID0gX25vcm1hbGl6ZU5hdmlnYXRlT3B0Mi5wYXRoLCBzdWJtaXNzaW9uID0gX25vcm1hbGl6ZU5hdmlnYXRlT3B0Mi5zdWJtaXNzaW9uLCBlcnJvciA9IF9ub3JtYWxpemVOYXZpZ2F0ZU9wdDIuZXJyb3I7Y3VycmVudExvY2F0aW9uID0gc3RhdGUubG9jYXRpb247bmV4dExvY2F0aW9uID0gY3JlYXRlTG9jYXRpb24oc3RhdGUubG9jYXRpb24sIHBhdGgsIG9wdHMgJiYgb3B0cy5zdGF0ZSk7IC8vIFdoZW4gdXNpbmcgbmF2aWdhdGUgYXMgYSBQVVNIL1JFUExBQ0Ugd2UgYXJlbid0IHJlYWRpbmcgYW4gYWxyZWFkeS1lbmNvZGVkCiAgICAgICAgICAgICAgICAgICAgICAvLyBVUkwgZnJvbSB3aW5kb3cubG9jYXRpb24sIHNvIHdlIG5lZWQgdG8gZW5jb2RlIGl0IGhlcmUgc28gdGhlIGJlaGF2aW9yCiAgICAgICAgICAgICAgICAgICAgICAvLyByZW1haW5zIHRoZSBzYW1lIGFzIFBPUCBhbmQgbm9uLWRhdGEtcm91dGVyIHVzYWdlcy4gIG5ldyBVUkwoKSBkb2VzIGFsbAogICAgICAgICAgICAgICAgICAgICAgLy8gdGhlIHNhbWUgZW5jb2Rpbmcgd2UnZCBnZXQgZnJvbSBhIGhpc3RvcnkucHVzaFN0YXRlL3dpbmRvdy5sb2NhdGlvbiByZWFkCiAgICAgICAgICAgICAgICAgICAgICAvLyB3aXRob3V0IGhhdmluZyB0byB0b3VjaCBoaXN0b3J5CiAgICAgICAgICAgICAgICAgICAgICBuZXh0TG9jYXRpb24gPSBfZXh0ZW5kcyh7fSwgbmV4dExvY2F0aW9uLCBpbml0Lmhpc3RvcnkuZW5jb2RlTG9jYXRpb24obmV4dExvY2F0aW9uKSk7dXNlclJlcGxhY2UgPSBvcHRzICYmIG9wdHMucmVwbGFjZSAhPSBudWxsID8gb3B0cy5yZXBsYWNlIDogdW5kZWZpbmVkO2hpc3RvcnlBY3Rpb24gPSBBY3Rpb24uUHVzaDtpZiAodXNlclJlcGxhY2UgPT09IHRydWUpIHtoaXN0b3J5QWN0aW9uID0gQWN0aW9uLlJlcGxhY2U7fSBlbHNlIGlmICh1c2VyUmVwbGFjZSA9PT0gZmFsc2UpIDtlbHNlIGlmIChzdWJtaXNzaW9uICE9IG51bGwgJiYgaXNNdXRhdGlvbk1ldGhvZChzdWJtaXNzaW9uLmZvcm1NZXRob2QpICYmIHN1Ym1pc3Npb24uZm9ybUFjdGlvbiA9PT0gc3RhdGUubG9jYXRpb24ucGF0aG5hbWUgKyBzdGF0ZS5sb2NhdGlvbi5zZWFyY2gpIHsvLyBCeSBkZWZhdWx0IG9uIHN1Ym1pc3Npb25zIHRvIHRoZSBjdXJyZW50IGxvY2F0aW9uIHdlIFJFUExBQ0Ugc28gdGhhdAogICAgICAgICAgICAgICAgICAgICAgICAvLyB1c2VycyBkb24ndCBoYXZlIHRvIGRvdWJsZS1jbGljayB0aGUgYmFjayBidXR0b24gdG8gZ2V0IHRvIHRoZSBwcmlvcgogICAgICAgICAgICAgICAgICAgICAgICAvLyBsb2NhdGlvbi4gIElmIHRoZSB1c2VyIHJlZGlyZWN0cyB0byBhIGRpZmZlcmVudCBsb2NhdGlvbiBmcm9tIHRoZQogICAgICAgICAgICAgICAgICAgICAgICAvLyBhY3Rpb24vbG9hZGVyIHRoaXMgd2lsbCBiZSBpZ25vcmVkIGFuZCB0aGUgcmVkaXJlY3Qgd2lsbCBiZSBhIFBVU0gKICAgICAgICAgICAgICAgICAgICAgICAgaGlzdG9yeUFjdGlvbiA9IEFjdGlvbi5SZXBsYWNlO31wcmV2ZW50U2Nyb2xsUmVzZXQgPSBvcHRzICYmICJwcmV2ZW50U2Nyb2xsUmVzZXQiIGluIG9wdHMgPyBvcHRzLnByZXZlbnRTY3JvbGxSZXNldCA9PT0gdHJ1ZSA6IHVuZGVmaW5lZDtibG9ja2VyS2V5ID0gc2hvdWxkQmxvY2tOYXZpZ2F0aW9uKHsgY3VycmVudExvY2F0aW9uOiBjdXJyZW50TG9jYXRpb24sIG5leHRMb2NhdGlvbjogbmV4dExvY2F0aW9uLCBoaXN0b3J5QWN0aW9uOiBoaXN0b3J5QWN0aW9uIH0pO2lmICghYmxvY2tlcktleSkge19jb250ZXh0My5uZXh0ID0gMTU7YnJlYWs7fSAvLyBQdXQgdGhlIGJsb2NrZXIgaW50byBhIGJsb2NrZWQgc3RhdGUKICAgICAgICAgICAgICAgICAgICAgIHVwZGF0ZUJsb2NrZXIoYmxvY2tlcktleSwgeyBzdGF0ZTogImJsb2NrZWQiLCBsb2NhdGlvbjogbmV4dExvY2F0aW9uLCBwcm9jZWVkOiBmdW5jdGlvbiBwcm9jZWVkKCkge3VwZGF0ZUJsb2NrZXIoYmxvY2tlcktleSwgeyBzdGF0ZTogInByb2NlZWRpbmciLCBwcm9jZWVkOiB1bmRlZmluZWQsIHJlc2V0OiB1bmRlZmluZWQsIGxvY2F0aW9uOiBuZXh0TG9jYXRpb24gfSk7IC8vIFNlbmQgdGhlIHNhbWUgbmF2aWdhdGlvbiB0aHJvdWdoCiAgICAgICAgICAgICAgICAgICAgICAgICAgbmF2aWdhdGUodG8sIG9wdHMpO30sIHJlc2V0OiBmdW5jdGlvbiByZXNldCgpIHtkZWxldGVCbG9ja2VyKGJsb2NrZXJLZXkpO3VwZGF0ZVN0YXRlKHsgYmxvY2tlcnM6IG5ldyBNYXAoc3RhdGUuYmxvY2tlcnMpIH0pO30gfSk7cmV0dXJuIF9jb250ZXh0My5hYnJ1cHQoInJldHVybiIpO2Nhc2UgMTU6X2NvbnRleHQzLm5leHQgPSAxNztyZXR1cm4gc3RhcnROYXZpZ2F0aW9uKGhpc3RvcnlBY3Rpb24sIG5leHRMb2NhdGlvbiwgeyBzdWJtaXNzaW9uOiBzdWJtaXNzaW9uLCAvLyBTZW5kIHRocm91Z2ggdGhlIGZvcm1EYXRhIHNlcmlhbGl6YXRpb24gZXJyb3IgaWYgd2UgaGF2ZSBvbmUgc28gd2UgY2FuCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIHJlbmRlciBhdCB0aGUgcmlnaHQgZXJyb3IgYm91bmRhcnkgYWZ0ZXIgd2UgbWF0Y2ggcm91dGVzCiAgICAgICAgICAgICAgICAgICAgICAgIHBlbmRpbmdFcnJvcjogZXJyb3IsIHByZXZlbnRTY3JvbGxSZXNldDogcHJldmVudFNjcm9sbFJlc2V0LCByZXBsYWNlOiBvcHRzICYmIG9wdHMucmVwbGFjZSB9KTtjYXNlIDE3OnJldHVybiBfY29udGV4dDMuYWJydXB0KCJyZXR1cm4iLCBfY29udGV4dDMuc2VudCk7Y2FzZSAxODpjYXNlICJlbmQiOnJldHVybiBfY29udGV4dDMuc3RvcCgpO319LCBfY2FsbGVlMyk7fSkpO3JldHVybiBfbmF2aWdhdGUuYXBwbHkodGhpcywgYXJndW1lbnRzKTt9ZnVuY3Rpb24gcmV2YWxpZGF0ZSgpIHtpbnRlcnJ1cHRBY3RpdmVMb2FkcygpO3VwZGF0ZVN0YXRlKHsgcmV2YWxpZGF0aW9uOiAibG9hZGluZyIgfSk7IC8vIElmIHdlJ3JlIGN1cnJlbnRseSBzdWJtaXR0aW5nIGFuIGFjdGlvbiwgd2UgZG9uJ3QgbmVlZCB0byBzdGFydCBhIG5ldwogICAgICAgICAgICAgIC8vIG5hdmlnYXRpb24sIHdlJ2xsIGp1c3QgbGV0IHRoZSBmb2xsb3cgdXAgbG9hZGVyIGV4ZWN1dGlvbiBjYWxsIGFsbCBsb2FkZXJzCiAgICAgICAgICAgICAgaWYgKHN0YXRlLm5hdmlnYXRpb24uc3RhdGUgPT09ICJzdWJtaXR0aW5nIikge3JldHVybjt9IC8vIElmIHdlJ3JlIGN1cnJlbnRseSBpbiBhbiBpZGxlIHN0YXRlLCBzdGFydCBhIG5ldyBuYXZpZ2F0aW9uIGZvciB0aGUgY3VycmVudAogICAgICAgICAgICAgIC8vIGFjdGlvbi9sb2NhdGlvbiBhbmQgbWFyayBpdCBhcyB1bmludGVycnVwdGVkLCB3aGljaCB3aWxsIHNraXAgdGhlIGhpc3RvcnkKICAgICAgICAgICAgICAvLyB1cGRhdGUgaW4gY29tcGxldGVOYXZpZ2F0aW9uCiAgICAgICAgICAgICAgaWYgKHN0YXRlLm5hdmlnYXRpb24uc3RhdGUgPT09ICJpZGxlIikge3N0YXJ0TmF2aWdhdGlvbihzdGF0ZS5oaXN0b3J5QWN0aW9uLCBzdGF0ZS5sb2NhdGlvbiwgeyBzdGFydFVuaW50ZXJydXB0ZWRSZXZhbGlkYXRpb246IHRydWUKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgIH0gLy8gT3RoZXJ3aXNlLCBpZiB3ZSdyZSBjdXJyZW50bHkgaW4gYSBsb2FkaW5nIHN0YXRlLCBqdXN0IHN0YXJ0IGEgbmV3CiAgICAgICAgICAgICAgLy8gbmF2aWdhdGlvbiB0byB0aGUgbmF2aWdhdGlvbi5sb2NhdGlvbiBidXQgZG8gbm90IHRyaWdnZXIgYW4gdW5pbnRlcnJ1cHRlZAogICAgICAgICAgICAgIC8vIHJldmFsaWRhdGlvbiBzbyB0aGF0IGhpc3RvcnkgY29ycmVjdGx5IHVwZGF0ZXMgb25jZSB0aGUgbmF2aWdhdGlvbiBjb21wbGV0ZXMKCgogICAgICAgICAgICAgIHN0YXJ0TmF2aWdhdGlvbihwZW5kaW5nQWN0aW9uIHx8IHN0YXRlLmhpc3RvcnlBY3Rpb24sIHN0YXRlLm5hdmlnYXRpb24ubG9jYXRpb24sIHsKICAgICAgICAgICAgICAgIG92ZXJyaWRlTmF2aWdhdGlvbjogc3RhdGUubmF2aWdhdGlvbgogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9IC8vIFN0YXJ0IGEgbmF2aWdhdGlvbiB0byB0aGUgZ2l2ZW4gYWN0aW9uL2xvY2F0aW9uLiAgQ2FuIG9wdGlvbmFsbHkgcHJvdmlkZSBhCiAgICAgICAgICAgIC8vIG92ZXJyaWRlTmF2aWdhdGlvbiB3aGljaCB3aWxsIG92ZXJyaWRlIHRoZSBub3JtYWxMb2FkIGluIHRoZSBjYXNlIG9mIGEgcmVkaXJlY3QKICAgICAgICAgICAgLy8gbmF2aWdhdGlvbgogICAgICAgICAgICBmdW5jdGlvbgoKICAgICAgICAgICAgc3RhcnROYXZpZ2F0aW9uKF94NiwgX3g3LCBfeDgpIHtyZXR1cm4gX3N0YXJ0TmF2aWdhdGlvbi5hcHBseSh0aGlzLCBhcmd1bWVudHMpO30KCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgogICAgICAgICAgICAvLyBDYWxsIHRoZSBhY3Rpb24gbWF0Y2hlZCBieSB0aGUgbGVhZiByb3V0ZSBmb3IgdGhpcyBuYXZpZ2F0aW9uIGFuZCBoYW5kbGUKICAgICAgICAgICAgLy8gcmVkaXJlY3RzL2Vycm9ycwogICAgICAgICAgICBmdW5jdGlvbiBfc3RhcnROYXZpZ2F0aW9uKCkge19zdGFydE5hdmlnYXRpb24gPSBfYXN5bmNUb0dlbmVyYXRvcjIoIC8qI19fUFVSRV9fKi9fcmVnZW5lcmF0b3JSdW50aW1lMigpLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTQoaGlzdG9yeUFjdGlvbiwgbG9jYXRpb24sIG9wdHMpIHt2YXIgbG9hZGluZ05hdmlnYXRpb24sIG1hdGNoZXMsIF9lcnJvciwgX2dldFNob3J0Q2lyY3VpdE1hdGNoMiwgbm90Rm91bmRNYXRjaGVzLCBfcm91dGUsIHJlcXVlc3QsIHBlbmRpbmdBY3Rpb25EYXRhLCBwZW5kaW5nRXJyb3IsIGFjdGlvbk91dHB1dCwgbmF2aWdhdGlvbiwgX3lpZWxkJGhhbmRsZUxvYWRlcnMsIHNob3J0Q2lyY3VpdGVkLCBsb2FkZXJEYXRhLCBlcnJvcnM7cmV0dXJuIF9yZWdlbmVyYXRvclJ1bnRpbWUyKCkud3JhcChmdW5jdGlvbiBfY2FsbGVlNCQoX2NvbnRleHQ0KSB7d2hpbGUgKDEpIHN3aXRjaCAoX2NvbnRleHQ0LnByZXYgPSBfY29udGV4dDQubmV4dCkge2Nhc2UgMDogLy8gQWJvcnQgYW55IGluLXByb2dyZXNzIG5hdmlnYXRpb25zIGFuZCBzdGFydCBhIG5ldyBvbmUuIFVuc2V0IGFueSBvbmdvaW5nCiAgICAgICAgICAgICAgICAgICAgICAvLyB1bmludGVycnVwdGVkIHJldmFsaWRhdGlvbnMgdW5sZXNzIHRvbGQgb3RoZXJ3aXNlLCBzaW5jZSB3ZSB3YW50IHRoaXMKICAgICAgICAgICAgICAgICAgICAgIC8vIG5ldyBuYXZpZ2F0aW9uIHRvIHVwZGF0ZSBoaXN0b3J5IG5vcm1hbGx5CiAgICAgICAgICAgICAgICAgICAgICBwZW5kaW5nTmF2aWdhdGlvbkNvbnRyb2xsZXIgJiYgcGVuZGluZ05hdmlnYXRpb25Db250cm9sbGVyLmFib3J0KCk7cGVuZGluZ05hdmlnYXRpb25Db250cm9sbGVyID0gbnVsbDtwZW5kaW5nQWN0aW9uID0gaGlzdG9yeUFjdGlvbjtpc1VuaW50ZXJydXB0ZWRSZXZhbGlkYXRpb24gPSAob3B0cyAmJiBvcHRzLnN0YXJ0VW5pbnRlcnJ1cHRlZFJldmFsaWRhdGlvbikgPT09IHRydWU7IC8vIFNhdmUgdGhlIGN1cnJlbnQgc2Nyb2xsIHBvc2l0aW9uIGV2ZXJ5IHRpbWUgd2Ugc3RhcnQgYSBuZXcgbmF2aWdhdGlvbiwKICAgICAgICAgICAgICAgICAgICAgIC8vIGFuZCB0cmFjayB3aGV0aGVyIHdlIHNob3VsZCByZXNldCBzY3JvbGwgb24gY29tcGxldGlvbgogICAgICAgICAgICAgICAgICAgICAgc2F2ZVNjcm9sbFBvc2l0aW9uKHN0YXRlLmxvY2F0aW9uLCBzdGF0ZS5tYXRjaGVzKTtwZW5kaW5nUHJldmVudFNjcm9sbFJlc2V0ID0gKG9wdHMgJiYgb3B0cy5wcmV2ZW50U2Nyb2xsUmVzZXQpID09PSB0cnVlO2xvYWRpbmdOYXZpZ2F0aW9uID0gb3B0cyAmJiBvcHRzLm92ZXJyaWRlTmF2aWdhdGlvbjttYXRjaGVzID0gbWF0Y2hSb3V0ZXMoZGF0YVJvdXRlcywgbG9jYXRpb24sIGluaXQuYmFzZW5hbWUpOyAvLyBTaG9ydCBjaXJjdWl0IHdpdGggYSA0MDQgb24gdGhlIHJvb3QgZXJyb3IgYm91bmRhcnkgaWYgd2UgbWF0Y2ggbm90aGluZwogICAgICAgICAgICAgICAgICAgICAgaWYgKG1hdGNoZXMpIHtfY29udGV4dDQubmV4dCA9IDE0O2JyZWFrO31fZXJyb3IgPSBnZXRJbnRlcm5hbFJvdXRlckVycm9yKDQwNCwgeyBwYXRobmFtZTogbG9jYXRpb24ucGF0aG5hbWUgfSk7X2dldFNob3J0Q2lyY3VpdE1hdGNoMiA9IGdldFNob3J0Q2lyY3VpdE1hdGNoZXMoZGF0YVJvdXRlcyksIG5vdEZvdW5kTWF0Y2hlcyA9IF9nZXRTaG9ydENpcmN1aXRNYXRjaDIubWF0Y2hlcywgX3JvdXRlID0gX2dldFNob3J0Q2lyY3VpdE1hdGNoMi5yb3V0ZTsgLy8gQ2FuY2VsIGFsbCBwZW5kaW5nIGRlZmVycmVkIG9uIDQwNHMgc2luY2Ugd2UgZG9uJ3Qga2VlcCBhbnkgcm91dGVzCiAgICAgICAgICAgICAgICAgICAgICBjYW5jZWxBY3RpdmVEZWZlcnJlZHMoKTtjb21wbGV0ZU5hdmlnYXRpb24obG9jYXRpb24sIHsgbWF0Y2hlczogbm90Rm91bmRNYXRjaGVzLCBsb2FkZXJEYXRhOiB7fSwgZXJyb3JzOiBfZGVmaW5lUHJvcGVydHkyKHt9LCBfcm91dGUuaWQsIF9lcnJvcikgfSk7cmV0dXJuIF9jb250ZXh0NC5hYnJ1cHQoInJldHVybiIpO2Nhc2UgMTQ6aWYgKCFpc0hhc2hDaGFuZ2VPbmx5KHN0YXRlLmxvY2F0aW9uLCBsb2NhdGlvbikpIHtfY29udGV4dDQubmV4dCA9IDE3O2JyZWFrO31jb21wbGV0ZU5hdmlnYXRpb24obG9jYXRpb24sIHsgbWF0Y2hlczogbWF0Y2hlcyB9KTtyZXR1cm4gX2NvbnRleHQ0LmFicnVwdCgicmV0dXJuIik7Y2FzZSAxNzogLy8gQ3JlYXRlIGEgY29udHJvbGxlci9SZXF1ZXN0IGZvciB0aGlzIG5hdmlnYXRpb24KICAgICAgICAgICAgICAgICAgICAgIHBlbmRpbmdOYXZpZ2F0aW9uQ29udHJvbGxlciA9IG5ldyBBYm9ydENvbnRyb2xsZXIoKTtyZXF1ZXN0ID0gY3JlYXRlQ2xpZW50U2lkZVJlcXVlc3QoaW5pdC5oaXN0b3J5LCBsb2NhdGlvbiwgcGVuZGluZ05hdmlnYXRpb25Db250cm9sbGVyLnNpZ25hbCwgb3B0cyAmJiBvcHRzLnN1Ym1pc3Npb24pO2lmICghKG9wdHMgJiYgb3B0cy5wZW5kaW5nRXJyb3IpKSB7X2NvbnRleHQ0Lm5leHQgPSAyMzticmVhazt9IC8vIElmIHdlIGhhdmUgYSBwZW5kaW5nRXJyb3IsIGl0IG1lYW5zIHRoZSB1c2VyIGF0dGVtcHRlZCBhIEdFVCBzdWJtaXNzaW9uCiAgICAgICAgICAgICAgICAgICAgICAvLyB3aXRoIGJpbmFyeSBGb3JtRGF0YSBzbyBhc3NpZ24gaGVyZSBhbmQgc2tpcCB0byBoYW5kbGVMb2FkZXJzLiAgVGhhdAogICAgICAgICAgICAgICAgICAgICAgLy8gd2F5IHdlIGhhbmRsZSBjYWxsaW5nIGxvYWRlcnMgYWJvdmUgdGhlIGJvdW5kYXJ5IGV0Yy4gIEl0J3Mgbm90IHJlYWxseQogICAgICAgICAgICAgICAgICAgICAgLy8gZGlmZmVyZW50IGZyb20gYW4gYWN0aW9uRXJyb3IgaW4gdGhhdCBzZW5zZS4KICAgICAgICAgICAgICAgICAgICAgIHBlbmRpbmdFcnJvciA9IF9kZWZpbmVQcm9wZXJ0eTIoe30sIGZpbmROZWFyZXN0Qm91bmRhcnkobWF0Y2hlcykucm91dGUuaWQsIG9wdHMucGVuZGluZ0Vycm9yKTtfY29udGV4dDQubmV4dCA9IDM0O2JyZWFrO2Nhc2UgMjM6aWYgKCEob3B0cyAmJiBvcHRzLnN1Ym1pc3Npb24gJiYgaXNNdXRhdGlvbk1ldGhvZChvcHRzLnN1Ym1pc3Npb24uZm9ybU1ldGhvZCkpKSB7X2NvbnRleHQ0Lm5leHQgPSAzNDticmVhazt9X2NvbnRleHQ0Lm5leHQgPSAyNjtyZXR1cm4gaGFuZGxlQWN0aW9uKHJlcXVlc3QsIGxvY2F0aW9uLCBvcHRzLnN1Ym1pc3Npb24sIG1hdGNoZXMsIHsgcmVwbGFjZTogb3B0cy5yZXBsYWNlIH0pO2Nhc2UgMjY6YWN0aW9uT3V0cHV0ID0gX2NvbnRleHQ0LnNlbnQ7aWYgKCFhY3Rpb25PdXRwdXQuc2hvcnRDaXJjdWl0ZWQpIHtfY29udGV4dDQubmV4dCA9IDI5O2JyZWFrO31yZXR1cm4gX2NvbnRleHQ0LmFicnVwdCgicmV0dXJuIik7Y2FzZSAyOTpwZW5kaW5nQWN0aW9uRGF0YSA9IGFjdGlvbk91dHB1dC5wZW5kaW5nQWN0aW9uRGF0YTtwZW5kaW5nRXJyb3IgPSBhY3Rpb25PdXRwdXQucGVuZGluZ0FjdGlvbkVycm9yO25hdmlnYXRpb24gPSBfZXh0ZW5kcyh7IHN0YXRlOiAibG9hZGluZyIsIGxvY2F0aW9uOiBsb2NhdGlvbiB9LCBvcHRzLnN1Ym1pc3Npb24pO2xvYWRpbmdOYXZpZ2F0aW9uID0gbmF2aWdhdGlvbjsgLy8gQ3JlYXRlIGEgR0VUIHJlcXVlc3QgZm9yIHRoZSBsb2FkZXJzCiAgICAgICAgICAgICAgICAgICAgICByZXF1ZXN0ID0gbmV3IFJlcXVlc3QocmVxdWVzdC51cmwsIHsgc2lnbmFsOiByZXF1ZXN0LnNpZ25hbCB9KTtjYXNlIDM0Ol9jb250ZXh0NC5uZXh0ID0gMzY7cmV0dXJuIGhhbmRsZUxvYWRlcnMocmVxdWVzdCwgbG9jYXRpb24sIG1hdGNoZXMsIGxvYWRpbmdOYXZpZ2F0aW9uLCBvcHRzICYmIG9wdHMuc3VibWlzc2lvbiwgb3B0cyAmJiBvcHRzLnJlcGxhY2UsIHBlbmRpbmdBY3Rpb25EYXRhLCBwZW5kaW5nRXJyb3IpO2Nhc2UgMzY6X3lpZWxkJGhhbmRsZUxvYWRlcnMgPSBfY29udGV4dDQuc2VudDtzaG9ydENpcmN1aXRlZCA9IF95aWVsZCRoYW5kbGVMb2FkZXJzLnNob3J0Q2lyY3VpdGVkO2xvYWRlckRhdGEgPSBfeWllbGQkaGFuZGxlTG9hZGVycy5sb2FkZXJEYXRhO2Vycm9ycyA9IF95aWVsZCRoYW5kbGVMb2FkZXJzLmVycm9ycztpZiAoIXNob3J0Q2lyY3VpdGVkKSB7X2NvbnRleHQ0Lm5leHQgPSA0MjticmVhazt9cmV0dXJuIF9jb250ZXh0NC5hYnJ1cHQoInJldHVybiIpO2Nhc2UgNDI6IC8vIENsZWFuIHVwIG5vdyB0aGF0IHRoZSBhY3Rpb24vbG9hZGVycyBoYXZlIGNvbXBsZXRlZC4gIERvbid0IGNsZWFuIHVwIGlmCiAgICAgICAgICAgICAgICAgICAgICAvLyB3ZSBzaG9ydCBjaXJjdWl0ZWQgYmVjYXVzZSBwZW5kaW5nTmF2aWdhdGlvbkNvbnRyb2xsZXIgd2lsbCBoYXZlIGFscmVhZHkKICAgICAgICAgICAgICAgICAgICAgIC8vIGJlZW4gYXNzaWduZWQgdG8gYSBuZXcgY29udHJvbGxlciBmb3IgdGhlIG5leHQgbmF2aWdhdGlvbgogICAgICAgICAgICAgICAgICAgICAgcGVuZGluZ05hdmlnYXRpb25Db250cm9sbGVyID0gbnVsbDtjb21wbGV0ZU5hdmlnYXRpb24obG9jYXRpb24sIF9leHRlbmRzKHsgbWF0Y2hlczogbWF0Y2hlcyB9LCBwZW5kaW5nQWN0aW9uRGF0YSA/IHsgYWN0aW9uRGF0YTogcGVuZGluZ0FjdGlvbkRhdGEgfSA6IHt9LCB7IGxvYWRlckRhdGE6IGxvYWRlckRhdGEsIGVycm9yczogZXJyb3JzIH0pKTtjYXNlIDQ0OmNhc2UgImVuZCI6cmV0dXJuIF9jb250ZXh0NC5zdG9wKCk7fX0sIF9jYWxsZWU0KTt9KSk7cmV0dXJuIF9zdGFydE5hdmlnYXRpb24uYXBwbHkodGhpcywgYXJndW1lbnRzKTt9ZnVuY3Rpb24gaGFuZGxlQWN0aW9uKF94OSwgX3gxMCwgX3gxMSwgX3gxMiwgX3gxMykge3JldHVybiBfaGFuZGxlQWN0aW9uLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7fQoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgogICAgICAgICAgICAvLyBDYWxsIGFsbCBhcHBsaWNhYmxlIGxvYWRlcnMgZm9yIHRoZSBnaXZlbiBtYXRjaGVzLCBoYW5kbGluZyByZWRpcmVjdHMsCiAgICAgICAgICAgIC8vIGVycm9ycywgZXRjLgogICAgICAgICAgICBmdW5jdGlvbiBfaGFuZGxlQWN0aW9uKCkge19oYW5kbGVBY3Rpb24gPSBfYXN5bmNUb0dlbmVyYXRvcjIoIC8qI19fUFVSRV9fKi9fcmVnZW5lcmF0b3JSdW50aW1lMigpLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTUocmVxdWVzdCwgbG9jYXRpb24sIHN1Ym1pc3Npb24sIG1hdGNoZXMsIG9wdHMpIHt2YXIgbmF2aWdhdGlvbiwgcmVzdWx0LCBhY3Rpb25NYXRjaCwgcmVwbGFjZSwgYm91bmRhcnlNYXRjaDtyZXR1cm4gX3JlZ2VuZXJhdG9yUnVudGltZTIoKS53cmFwKGZ1bmN0aW9uIF9jYWxsZWU1JChfY29udGV4dDUpIHt3aGlsZSAoMSkgc3dpdGNoIChfY29udGV4dDUucHJldiA9IF9jb250ZXh0NS5uZXh0KSB7Y2FzZSAwOmludGVycnVwdEFjdGl2ZUxvYWRzKCk7IC8vIFB1dCB1cyBpbiBhIHN1Ym1pdHRpbmcgc3RhdGUKICAgICAgICAgICAgICAgICAgICAgIG5hdmlnYXRpb24gPSBfZXh0ZW5kcyh7IHN0YXRlOiAic3VibWl0dGluZyIsIGxvY2F0aW9uOiBsb2NhdGlvbiB9LCBzdWJtaXNzaW9uKTt1cGRhdGVTdGF0ZSh7IG5hdmlnYXRpb246IG5hdmlnYXRpb24gfSk7IC8vIENhbGwgb3VyIGFjdGlvbiBhbmQgZ2V0IHRoZSByZXN1bHQKICAgICAgICAgICAgICAgICAgICAgIGFjdGlvbk1hdGNoID0gZ2V0VGFyZ2V0TWF0Y2gobWF0Y2hlcywgbG9jYXRpb24pO2lmIChhY3Rpb25NYXRjaC5yb3V0ZS5hY3Rpb24pIHtfY29udGV4dDUubmV4dCA9IDg7YnJlYWs7fXJlc3VsdCA9IHsgdHlwZTogUmVzdWx0VHlwZS5lcnJvciwgZXJyb3I6IGdldEludGVybmFsUm91dGVyRXJyb3IoNDA1LCB7IG1ldGhvZDogcmVxdWVzdC5tZXRob2QsIHBhdGhuYW1lOiBsb2NhdGlvbi5wYXRobmFtZSwgcm91dGVJZDogYWN0aW9uTWF0Y2gucm91dGUuaWQgfSkgfTtfY29udGV4dDUubmV4dCA9IDEzO2JyZWFrO2Nhc2UgODpfY29udGV4dDUubmV4dCA9IDEwO3JldHVybiBjYWxsTG9hZGVyT3JBY3Rpb24oImFjdGlvbiIsIHJlcXVlc3QsIGFjdGlvbk1hdGNoLCBtYXRjaGVzLCByb3V0ZXIuYmFzZW5hbWUpO2Nhc2UgMTA6cmVzdWx0ID0gX2NvbnRleHQ1LnNlbnQ7aWYgKCFyZXF1ZXN0LnNpZ25hbC5hYm9ydGVkKSB7X2NvbnRleHQ1Lm5leHQgPSAxMzticmVhazt9cmV0dXJuIF9jb250ZXh0NS5hYnJ1cHQoInJldHVybiIsIHsgc2hvcnRDaXJjdWl0ZWQ6IHRydWUgfSk7Y2FzZSAxMzppZiAoIWlzUmVkaXJlY3RSZXN1bHQocmVzdWx0KSkge19jb250ZXh0NS5uZXh0ID0gMTg7YnJlYWs7fWlmIChvcHRzICYmIG9wdHMucmVwbGFjZSAhPSBudWxsKSB7cmVwbGFjZSA9IG9wdHMucmVwbGFjZTt9IGVsc2Ugey8vIElmIHRoZSB1c2VyIGRpZG4ndCBleHBsaWNpdHkgaW5kaWNhdGUgcmVwbGFjZSBiZWhhdmlvciwgcmVwbGFjZSBpZgogICAgICAgICAgICAgICAgICAgICAgICAvLyB3ZSByZWRpcmVjdGVkIHRvIHRoZSBleGFjdCBzYW1lIGxvY2F0aW9uIHdlJ3JlIGN1cnJlbnRseSBhdCB0byBhdm9pZAogICAgICAgICAgICAgICAgICAgICAgICAvLyBkb3VibGUgYmFjay1idXR0b25zCiAgICAgICAgICAgICAgICAgICAgICAgIHJlcGxhY2UgPSByZXN1bHQubG9jYXRpb24gPT09IHN0YXRlLmxvY2F0aW9uLnBhdGhuYW1lICsgc3RhdGUubG9jYXRpb24uc2VhcmNoO31fY29udGV4dDUubmV4dCA9IDE3O3JldHVybiBzdGFydFJlZGlyZWN0TmF2aWdhdGlvbihzdGF0ZSwgcmVzdWx0LCB7IHN1Ym1pc3Npb246IHN1Ym1pc3Npb24sIHJlcGxhY2U6IHJlcGxhY2UgfSk7Y2FzZSAxNzpyZXR1cm4gX2NvbnRleHQ1LmFicnVwdCgicmV0dXJuIiwgeyBzaG9ydENpcmN1aXRlZDogdHJ1ZSB9KTtjYXNlIDE4OmlmICghaXNFcnJvclJlc3VsdChyZXN1bHQpKSB7X2NvbnRleHQ1Lm5leHQgPSAyMjticmVhazt9IC8vIFN0b3JlIG9mZiB0aGUgcGVuZGluZyBlcnJvciAtIHdlIHVzZSBpdCB0byBkZXRlcm1pbmUgd2hpY2ggbG9hZGVycwogICAgICAgICAgICAgICAgICAgICAgLy8gdG8gY2FsbCBhbmQgd2lsbCBjb21taXQgaXQgd2hlbiB3ZSBjb21wbGV0ZSB0aGUgbmF2aWdhdGlvbgogICAgICAgICAgICAgICAgICAgICAgYm91bmRhcnlNYXRjaCA9IGZpbmROZWFyZXN0Qm91bmRhcnkobWF0Y2hlcywgYWN0aW9uTWF0Y2gucm91dGUuaWQpOyAvLyBCeSBkZWZhdWx0LCBhbGwgc3VibWlzc2lvbnMgYXJlIFJFUExBQ0UgbmF2aWdhdGlvbnMsIGJ1dCBpZiB0aGUKICAgICAgICAgICAgICAgICAgICAgIC8vIGFjdGlvbiB0aHJldyBhbiBlcnJvciB0aGF0J2xsIGJlIHJlbmRlcmVkIGluIGFuIGVycm9yRWxlbWVudCwgd2UgZmFsbAogICAgICAgICAgICAgICAgICAgICAgLy8gYmFjayB0byBQVVNIIHNvIHRoYXQgdGhlIHVzZXIgY2FuIHVzZSB0aGUgYmFjayBidXR0b24gdG8gZ2V0IGJhY2sgdG8KICAgICAgICAgICAgICAgICAgICAgIC8vIHRoZSBwcmUtc3VibWlzc2lvbiBmb3JtIGxvY2F0aW9uIHRvIHRyeSBhZ2FpbgogICAgICAgICAgICAgICAgICAgICAgaWYgKChvcHRzICYmIG9wdHMucmVwbGFjZSkgIT09IHRydWUpIHtwZW5kaW5nQWN0aW9uID0gQWN0aW9uLlB1c2g7fXJldHVybiBfY29udGV4dDUuYWJydXB0KCJyZXR1cm4iLCB7IC8vIFNlbmQgYmFjayBhbiBlbXB0eSBvYmplY3Qgd2UgY2FuIHVzZSB0byBjbGVhciBvdXQgYW55IHByaW9yIGFjdGlvbkRhdGEKICAgICAgICAgICAgICAgICAgICAgICAgcGVuZGluZ0FjdGlvbkRhdGE6IHt9LCBwZW5kaW5nQWN0aW9uRXJyb3I6IF9kZWZpbmVQcm9wZXJ0eTIoe30sIGJvdW5kYXJ5TWF0Y2gucm91dGUuaWQsIHJlc3VsdC5lcnJvcikgfSk7Y2FzZSAyMjppZiAoIWlzRGVmZXJyZWRSZXN1bHQocmVzdWx0KSkge19jb250ZXh0NS5uZXh0ID0gMjQ7YnJlYWs7fXRocm93IGdldEludGVybmFsUm91dGVyRXJyb3IoNDAwLCB7IHR5cGU6ICJkZWZlci1hY3Rpb24iIH0pO2Nhc2UgMjQ6cmV0dXJuIF9jb250ZXh0NS5hYnJ1cHQoInJldHVybiIsIHsgcGVuZGluZ0FjdGlvbkRhdGE6IF9kZWZpbmVQcm9wZXJ0eTIoe30sIGFjdGlvbk1hdGNoLnJvdXRlLmlkLCByZXN1bHQuZGF0YSkgfSk7Y2FzZSAyNTpjYXNlICJlbmQiOnJldHVybiBfY29udGV4dDUuc3RvcCgpO319LCBfY2FsbGVlNSk7fSkpO3JldHVybiBfaGFuZGxlQWN0aW9uLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7fWZ1bmN0aW9uIGhhbmRsZUxvYWRlcnMoX3gxNCwgX3gxNSwgX3gxNiwgX3gxNywgX3gxOCwgX3gxOSwgX3gyMCwgX3gyMSkge3JldHVybiBfaGFuZGxlTG9hZGVycy5hcHBseSh0aGlzLCBhcmd1bWVudHMpO31mdW5jdGlvbiBfaGFuZGxlTG9hZGVycygpIHtfaGFuZGxlTG9hZGVycyA9IF9hc3luY1RvR2VuZXJhdG9yMiggLyojX19QVVJFX18qL19yZWdlbmVyYXRvclJ1bnRpbWUyKCkubWFyayhmdW5jdGlvbiBfY2FsbGVlNihyZXF1ZXN0LCBsb2NhdGlvbiwgbWF0Y2hlcywgb3ZlcnJpZGVOYXZpZ2F0aW9uLCBzdWJtaXNzaW9uLCByZXBsYWNlLCBwZW5kaW5nQWN0aW9uRGF0YSwgcGVuZGluZ0Vycm9yKSB7dmFyIGxvYWRpbmdOYXZpZ2F0aW9uLCBuYXZpZ2F0aW9uLCBhY3RpdmVTdWJtaXNzaW9uLCBfZ2V0TWF0Y2hlc1RvTG9hZCwgX2dldE1hdGNoZXNUb0xvYWQyLCBtYXRjaGVzVG9Mb2FkLCByZXZhbGlkYXRpbmdGZXRjaGVycywgYWN0aW9uRGF0YSwgX3lpZWxkJGNhbGxMb2FkZXJzQW5kLCByZXN1bHRzLCBsb2FkZXJSZXN1bHRzLCBmZXRjaGVyUmVzdWx0cywgcmVkaXJlY3QsIF9wcm9jZXNzTG9hZGVyRGF0YSwgbG9hZGVyRGF0YSwgZXJyb3JzLCBkaWRBYm9ydEZldGNoTG9hZHM7cmV0dXJuIF9yZWdlbmVyYXRvclJ1bnRpbWUyKCkud3JhcChmdW5jdGlvbiBfY2FsbGVlNiQoX2NvbnRleHQ2KSB7d2hpbGUgKDEpIHN3aXRjaCAoX2NvbnRleHQ2LnByZXYgPSBfY29udGV4dDYubmV4dCkge2Nhc2UgMDogLy8gRmlndXJlIG91dCB0aGUgcmlnaHQgbmF2aWdhdGlvbiB3ZSB3YW50IHRvIHVzZSBmb3IgZGF0YSBsb2FkaW5nCiAgICAgICAgICAgICAgICAgICAgICBsb2FkaW5nTmF2aWdhdGlvbiA9IG92ZXJyaWRlTmF2aWdhdGlvbjtpZiAoIWxvYWRpbmdOYXZpZ2F0aW9uKSB7bmF2aWdhdGlvbiA9IF9leHRlbmRzKHsgc3RhdGU6ICJsb2FkaW5nIiwgbG9jYXRpb246IGxvY2F0aW9uLCBmb3JtTWV0aG9kOiB1bmRlZmluZWQsIGZvcm1BY3Rpb246IHVuZGVmaW5lZCwgZm9ybUVuY1R5cGU6IHVuZGVmaW5lZCwgZm9ybURhdGE6IHVuZGVmaW5lZAogICAgICAgICAgICAgICAgICAgICAgICB9LCBzdWJtaXNzaW9uKTsKCiAgICAgICAgICAgICAgICAgICAgICAgIGxvYWRpbmdOYXZpZ2F0aW9uID0gbmF2aWdhdGlvbjsKICAgICAgICAgICAgICAgICAgICAgIH0gLy8gSWYgdGhpcyB3YXMgYSByZWRpcmVjdCBmcm9tIGFuIGFjdGlvbiB3ZSBkb24ndCBoYXZlIGEgInN1Ym1pc3Npb24iIGJ1dAogICAgICAgICAgICAgICAgICAgICAgLy8gd2UgaGF2ZSBpdCBvbiB0aGUgbG9hZGluZyBuYXZpZ2F0aW9uIHNvIHVzZSB0aGF0IGlmIGF2YWlsYWJsZQoKCiAgICAgICAgICAgICAgICAgICAgICBhY3RpdmVTdWJtaXNzaW9uID0gc3VibWlzc2lvbiA/IHN1Ym1pc3Npb24gOiBsb2FkaW5nTmF2aWdhdGlvbi5mb3JtTWV0aG9kICYmIGxvYWRpbmdOYXZpZ2F0aW9uLmZvcm1BY3Rpb24gJiYgbG9hZGluZ05hdmlnYXRpb24uZm9ybURhdGEgJiYgbG9hZGluZ05hdmlnYXRpb24uZm9ybUVuY1R5cGUgPyB7CiAgICAgICAgICAgICAgICAgICAgICAgIGZvcm1NZXRob2Q6IGxvYWRpbmdOYXZpZ2F0aW9uLmZvcm1NZXRob2QsCiAgICAgICAgICAgICAgICAgICAgICAgIGZvcm1BY3Rpb246IGxvYWRpbmdOYXZpZ2F0aW9uLmZvcm1BY3Rpb24sCiAgICAgICAgICAgICAgICAgICAgICAgIGZvcm1EYXRhOiBsb2FkaW5nTmF2aWdhdGlvbi5mb3JtRGF0YSwKICAgICAgICAgICAgICAgICAgICAgICAgZm9ybUVuY1R5cGU6IGxvYWRpbmdOYXZpZ2F0aW9uLmZvcm1FbmNUeXBlCiAgICAgICAgICAgICAgICAgICAgICB9IDogdW5kZWZpbmVkO19nZXRNYXRjaGVzVG9Mb2FkID0KICAgICAgICAgICAgICAgICAgICAgIGdldE1hdGNoZXNUb0xvYWQoaW5pdC5oaXN0b3J5LCBzdGF0ZSwgbWF0Y2hlcywgYWN0aXZlU3VibWlzc2lvbiwgbG9jYXRpb24sIGlzUmV2YWxpZGF0aW9uUmVxdWlyZWQsIGNhbmNlbGxlZERlZmVycmVkUm91dGVzLCBjYW5jZWxsZWRGZXRjaGVyTG9hZHMsIHBlbmRpbmdBY3Rpb25EYXRhLCBwZW5kaW5nRXJyb3IsIGZldGNoTG9hZE1hdGNoZXMpLCBfZ2V0TWF0Y2hlc1RvTG9hZDIgPSBfc2xpY2VkVG9BcnJheTIoX2dldE1hdGNoZXNUb0xvYWQsIDIpLCBtYXRjaGVzVG9Mb2FkID0gX2dldE1hdGNoZXNUb0xvYWQyWzBdLCByZXZhbGlkYXRpbmdGZXRjaGVycyA9IF9nZXRNYXRjaGVzVG9Mb2FkMlsxXTsgLy8gQ2FuY2VsIHBlbmRpbmcgZGVmZXJyZWRzIGZvciBuby1sb25nZXItbWF0Y2hlZCByb3V0ZXMgb3Igcm91dGVzIHdlJ3JlCiAgICAgICAgICAgICAgICAgICAgICAvLyBhYm91dCB0byByZWxvYWQuICBOb3RlIHRoYXQgaWYgdGhpcyBpcyBhbiBhY3Rpb24gcmVsb2FkIHdlIHdvdWxkIGhhdmUKICAgICAgICAgICAgICAgICAgICAgIC8vIGFscmVhZHkgY2FuY2VsbGVkIGFsbCBwZW5kaW5nIGRlZmVycmVkcyBzbyB0aGlzIHdvdWxkIGJlIGEgbm8tb3AKCiAgICAgICAgICAgICAgICAgICAgICBjYW5jZWxBY3RpdmVEZWZlcnJlZHMoKHJvdXRlSWQpID0+ICEobWF0Y2hlcyAmJiBtYXRjaGVzLnNvbWUoKG0pID0+IG0ucm91dGUuaWQgPT09IHJvdXRlSWQpKSB8fCBtYXRjaGVzVG9Mb2FkICYmIG1hdGNoZXNUb0xvYWQuc29tZSgobSkgPT4gbS5yb3V0ZS5pZCA9PT0gcm91dGVJZCkpOyAvLyBTaG9ydCBjaXJjdWl0IGlmIHdlIGhhdmUgbm8gbG9hZGVycyB0byBydW4KICAgICAgICAgICAgICAgICAgICAgIGlmICghKAogICAgICAgICAgICAgICAgICAgICAgbWF0Y2hlc1RvTG9hZC5sZW5ndGggPT09IDAgJiYgcmV2YWxpZGF0aW5nRmV0Y2hlcnMubGVuZ3RoID09PSAwKSkge19jb250ZXh0Ni5uZXh0ID0gODticmVhazt9CiAgICAgICAgICAgICAgICAgICAgICBjb21wbGV0ZU5hdmlnYXRpb24obG9jYXRpb24sIF9leHRlbmRzKHsKICAgICAgICAgICAgICAgICAgICAgICAgbWF0Y2hlczogbWF0Y2hlcywKICAgICAgICAgICAgICAgICAgICAgICAgbG9hZGVyRGF0YToge30sCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIENvbW1pdCBwZW5kaW5nIGVycm9yIGlmIHdlJ3JlIHNob3J0IGNpcmN1aXRpbmcKICAgICAgICAgICAgICAgICAgICAgICAgZXJyb3JzOiBwZW5kaW5nRXJyb3IgfHwgbnVsbAogICAgICAgICAgICAgICAgICAgICAgfSwgcGVuZGluZ0FjdGlvbkRhdGEgPyB7CiAgICAgICAgICAgICAgICAgICAgICAgIGFjdGlvbkRhdGE6IHBlbmRpbmdBY3Rpb25EYXRhCiAgICAgICAgICAgICAgICAgICAgICB9IDoge30pKTtyZXR1cm4gX2NvbnRleHQ2LmFicnVwdCgicmV0dXJuIiwKICAgICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgc2hvcnRDaXJjdWl0ZWQ6IHRydWUKICAgICAgICAgICAgICAgICAgICAgIH0pO2Nhc2UgODoKICAgICAgICAgICAgICAgICAgICAgIC8vIElmIHRoaXMgaXMgYW4gdW5pbnRlcnJ1cHRlZCByZXZhbGlkYXRpb24sIHdlIHJlbWFpbiBpbiBvdXIgY3VycmVudCBpZGxlCiAgICAgICAgICAgICAgICAgICAgICAvLyBzdGF0ZS4gIElmIG5vdCwgd2UgbmVlZCB0byBzd2l0Y2ggdG8gb3VyIGxvYWRpbmcgc3RhdGUgYW5kIGxvYWQgZGF0YSwKICAgICAgICAgICAgICAgICAgICAgIC8vIHByZXNlcnZpbmcgYW55IG5ldyBhY3Rpb24gZGF0YSBvciBleGlzdGluZyBhY3Rpb24gZGF0YSAoaW4gdGhlIGNhc2Ugb2YKICAgICAgICAgICAgICAgICAgICAgIC8vIGEgcmV2YWxpZGF0aW9uIGludGVycnVwdGluZyBhbiBhY3Rpb25SZWxvYWQpCgoKICAgICAgICAgICAgICAgICAgICAgIGlmICghaXNVbmludGVycnVwdGVkUmV2YWxpZGF0aW9uKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldmFsaWRhdGluZ0ZldGNoZXJzLmZvckVhY2goKF9yZWYyKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIF9yZWYxNSA9IF9zbGljZWRUb0FycmF5MihfcmVmMiwgMSksa2V5ID0gX3JlZjE1WzBdOwogICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBmZXRjaGVyID0gc3RhdGUuZmV0Y2hlcnMuZ2V0KGtleSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHJldmFsaWRhdGluZ0ZldGNoZXIgPSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGF0ZTogImxvYWRpbmciLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YTogZmV0Y2hlciAmJiBmZXRjaGVyLmRhdGEsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3JtTWV0aG9kOiB1bmRlZmluZWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3JtQWN0aW9uOiB1bmRlZmluZWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3JtRW5jVHlwZTogdW5kZWZpbmVkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9ybURhdGE6IHVuZGVmaW5lZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICIgX2hhc0ZldGNoZXJEb25lQW55dGhpbmcgIjogdHJ1ZQogICAgICAgICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhdGUuZmV0Y2hlcnMuc2V0KGtleSwgcmV2YWxpZGF0aW5nRmV0Y2hlcik7CiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICBhY3Rpb25EYXRhID0gcGVuZGluZ0FjdGlvbkRhdGEgfHwgc3RhdGUuYWN0aW9uRGF0YTsKICAgICAgICAgICAgICAgICAgICAgICAgdXBkYXRlU3RhdGUoX2V4dGVuZHMoewogICAgICAgICAgICAgICAgICAgICAgICAgIG5hdmlnYXRpb246IGxvYWRpbmdOYXZpZ2F0aW9uCiAgICAgICAgICAgICAgICAgICAgICAgIH0sIGFjdGlvbkRhdGEgPyBPYmplY3Qua2V5cyhhY3Rpb25EYXRhKS5sZW5ndGggPT09IDAgPyB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgYWN0aW9uRGF0YTogbnVsbAogICAgICAgICAgICAgICAgICAgICAgICB9IDogewogICAgICAgICAgICAgICAgICAgICAgICAgIGFjdGlvbkRhdGE6IGFjdGlvbkRhdGEKICAgICAgICAgICAgICAgICAgICAgICAgfSA6IHt9LCByZXZhbGlkYXRpbmdGZXRjaGVycy5sZW5ndGggPiAwID8gewogICAgICAgICAgICAgICAgICAgICAgICAgIGZldGNoZXJzOiBuZXcgTWFwKHN0YXRlLmZldGNoZXJzKQogICAgICAgICAgICAgICAgICAgICAgICB9IDoge30pKTsKICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICBwZW5kaW5nTmF2aWdhdGlvbkxvYWRJZCA9ICsraW5jcmVtZW50aW5nTG9hZElkOwogICAgICAgICAgICAgICAgICAgICAgcmV2YWxpZGF0aW5nRmV0Y2hlcnMuZm9yRWFjaCgoX3JlZjMpID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIF9yZWYxNiA9IF9zbGljZWRUb0FycmF5MihfcmVmMywgMSksa2V5ID0gX3JlZjE2WzBdOwogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmV0Y2hDb250cm9sbGVycy5zZXQoa2V5LCBwZW5kaW5nTmF2aWdhdGlvbkNvbnRyb2xsZXIpOwogICAgICAgICAgICAgICAgICAgICAgfSk7X2NvbnRleHQ2Lm5leHQgPSAxMztyZXR1cm4gKAoKCgoKICAgICAgICAgICAgICAgICAgICAgICAgY2FsbExvYWRlcnNBbmRNYXliZVJlc29sdmVEYXRhKHN0YXRlLm1hdGNoZXMsIG1hdGNoZXMsIG1hdGNoZXNUb0xvYWQsIHJldmFsaWRhdGluZ0ZldGNoZXJzLCByZXF1ZXN0KSk7Y2FzZSAxMzpfeWllbGQkY2FsbExvYWRlcnNBbmQgPSBfY29udGV4dDYuc2VudDtyZXN1bHRzID0gX3lpZWxkJGNhbGxMb2FkZXJzQW5kLnJlc3VsdHM7bG9hZGVyUmVzdWx0cyA9IF95aWVsZCRjYWxsTG9hZGVyc0FuZC5sb2FkZXJSZXN1bHRzO2ZldGNoZXJSZXN1bHRzID0gX3lpZWxkJGNhbGxMb2FkZXJzQW5kLmZldGNoZXJSZXN1bHRzO2lmICghCgogICAgICAgICAgICAgICAgICAgICAgcmVxdWVzdC5zaWduYWwuYWJvcnRlZCkge19jb250ZXh0Ni5uZXh0ID0gMTk7YnJlYWs7fXJldHVybiBfY29udGV4dDYuYWJydXB0KCJyZXR1cm4iLAogICAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICBzaG9ydENpcmN1aXRlZDogdHJ1ZQogICAgICAgICAgICAgICAgICAgICAgfSk7Y2FzZSAxOToKICAgICAgICAgICAgICAgICAgICAgIC8vIENsZWFuIHVwIF9hZnRlcl8gbG9hZGVycyBoYXZlIGNvbXBsZXRlZC4gIERvbid0IGNsZWFuIHVwIGlmIHdlIHNob3J0CiAgICAgICAgICAgICAgICAgICAgICAvLyBjaXJjdWl0ZWQgYmVjYXVzZSBmZXRjaENvbnRyb2xsZXJzIHdvdWxkIGhhdmUgYmVlbiBhYm9ydGVkIGFuZAogICAgICAgICAgICAgICAgICAgICAgLy8gcmVhc3NpZ25lZCB0byBuZXcgY29udHJvbGxlcnMgZm9yIHRoZSBuZXh0IG5hdmlnYXRpb24KCgogICAgICAgICAgICAgICAgICAgICAgcmV2YWxpZGF0aW5nRmV0Y2hlcnMuZm9yRWFjaCgoX3JlZjQpID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIF9yZWYxNyA9IF9zbGljZWRUb0FycmF5MihfcmVmNCwgMSksa2V5ID0gX3JlZjE3WzBdOwogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmV0Y2hDb250cm9sbGVycy5kZWxldGUoa2V5KTsKICAgICAgICAgICAgICAgICAgICAgIH0pOyAvLyBJZiBhbnkgbG9hZGVycyByZXR1cm5lZCBhIHJlZGlyZWN0IFJlc3BvbnNlLCBzdGFydCBhIG5ldyBSRVBMQUNFIG5hdmlnYXRpb24KCiAgICAgICAgICAgICAgICAgICAgICByZWRpcmVjdCA9IGZpbmRSZWRpcmVjdChyZXN1bHRzKTtpZiAoIQoKICAgICAgICAgICAgICAgICAgICAgIHJlZGlyZWN0KSB7X2NvbnRleHQ2Lm5leHQgPSAyNTticmVhazt9X2NvbnRleHQ2Lm5leHQgPSAyNDtyZXR1cm4gKAogICAgICAgICAgICAgICAgICAgICAgICBzdGFydFJlZGlyZWN0TmF2aWdhdGlvbihzdGF0ZSwgcmVkaXJlY3QsIHsKICAgICAgICAgICAgICAgICAgICAgICAgICByZXBsYWNlOiByZXBsYWNlCiAgICAgICAgICAgICAgICAgICAgICAgIH0pKTtjYXNlIDI0OnJldHVybiBfY29udGV4dDYuYWJydXB0KCJyZXR1cm4iLAogICAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICBzaG9ydENpcmN1aXRlZDogdHJ1ZQogICAgICAgICAgICAgICAgICAgICAgfSk7Y2FzZSAyNToKICAgICAgICAgICAgICAgICAgICAgIC8vIFByb2Nlc3MgYW5kIGNvbW1pdCBvdXRwdXQgZnJvbSBsb2FkZXJzCiAgICAgICAgICAgICAgICAgICAgICBfcHJvY2Vzc0xvYWRlckRhdGEgPQoKCgoKICAgICAgICAgICAgICAgICAgICAgIHByb2Nlc3NMb2FkZXJEYXRhKHN0YXRlLCBtYXRjaGVzLCBtYXRjaGVzVG9Mb2FkLCBsb2FkZXJSZXN1bHRzLCBwZW5kaW5nRXJyb3IsIHJldmFsaWRhdGluZ0ZldGNoZXJzLCBmZXRjaGVyUmVzdWx0cywgYWN0aXZlRGVmZXJyZWRzKSwgbG9hZGVyRGF0YSA9IF9wcm9jZXNzTG9hZGVyRGF0YS5sb2FkZXJEYXRhLCBlcnJvcnMgPSBfcHJvY2Vzc0xvYWRlckRhdGEuZXJyb3JzOyAvLyBXaXJlIHVwIHN1YnNjcmliZXJzIHRvIHVwZGF0ZSBsb2FkZXJEYXRhIGFzIHByb21pc2VzIHNldHRsZQoKICAgICAgICAgICAgICAgICAgICAgIGFjdGl2ZURlZmVycmVkcy5mb3JFYWNoKChkZWZlcnJlZERhdGEsIHJvdXRlSWQpID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgZGVmZXJyZWREYXRhLnN1YnNjcmliZSgoYWJvcnRlZCkgPT4gewogICAgICAgICAgICAgICAgICAgICAgICAgIC8vIE5vdGU6IE5vIG5lZWQgdG8gdXBkYXRlU3RhdGUgaGVyZSBzaW5jZSB0aGUgVHJhY2tlZFByb21pc2Ugb24KICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBsb2FkZXJEYXRhIGlzIHN0YWJsZSBhY3Jvc3MgcmVzb2x2ZS9yZWplY3QKICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBSZW1vdmUgdGhpcyBpbnN0YW5jZSBpZiB3ZSB3ZXJlIGFib3J0ZWQgb3IgaWYgcHJvbWlzZXMgaGF2ZSBzZXR0bGVkCiAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGFib3J0ZWQgfHwgZGVmZXJyZWREYXRhLmRvbmUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFjdGl2ZURlZmVycmVkcy5kZWxldGUocm91dGVJZCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgbWFya0ZldGNoUmVkaXJlY3RzRG9uZSgpOwogICAgICAgICAgICAgICAgICAgICAgZGlkQWJvcnRGZXRjaExvYWRzID0gYWJvcnRTdGFsZUZldGNoTG9hZHMocGVuZGluZ05hdmlnYXRpb25Mb2FkSWQpO3JldHVybiBfY29udGV4dDYuYWJydXB0KCJyZXR1cm4iLAogICAgICAgICAgICAgICAgICAgICAgX2V4dGVuZHMoewogICAgICAgICAgICAgICAgICAgICAgICBsb2FkZXJEYXRhOiBsb2FkZXJEYXRhLAogICAgICAgICAgICAgICAgICAgICAgICBlcnJvcnM6IGVycm9ycwogICAgICAgICAgICAgICAgICAgICAgfSwgZGlkQWJvcnRGZXRjaExvYWRzIHx8IHJldmFsaWRhdGluZ0ZldGNoZXJzLmxlbmd0aCA+IDAgPyB7CiAgICAgICAgICAgICAgICAgICAgICAgIGZldGNoZXJzOiBuZXcgTWFwKHN0YXRlLmZldGNoZXJzKQogICAgICAgICAgICAgICAgICAgICAgfSA6IHt9KSk7Y2FzZSAzMDpjYXNlICJlbmQiOnJldHVybiBfY29udGV4dDYuc3RvcCgpO319LCBfY2FsbGVlNik7fSkpO3JldHVybiBfaGFuZGxlTG9hZGVycy5hcHBseSh0aGlzLCBhcmd1bWVudHMpO30KCgogICAgICAgICAgICBmdW5jdGlvbiBnZXRGZXRjaGVyKGtleSkgewogICAgICAgICAgICAgIHJldHVybiBzdGF0ZS5mZXRjaGVycy5nZXQoa2V5KSB8fCBJRExFX0ZFVENIRVI7CiAgICAgICAgICAgIH0gLy8gVHJpZ2dlciBhIGZldGNoZXIgbG9hZC9zdWJtaXQgZm9yIHRoZSBnaXZlbiBmZXRjaGVyIGtleQoKCiAgICAgICAgICAgIGZ1bmN0aW9uIGZldGNoKGtleSwgcm91dGVJZCwgaHJlZiwgb3B0cykgewogICAgICAgICAgICAgIGlmIChpc1NlcnZlcikgewogICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJyb3V0ZXIuZmV0Y2goKSB3YXMgY2FsbGVkIGR1cmluZyB0aGUgc2VydmVyIHJlbmRlciwgYnV0IGl0IHNob3VsZG4ndCBiZS4gIiArICJZb3UgYXJlIGxpa2VseSBjYWxsaW5nIGEgdXNlRmV0Y2hlcigpIG1ldGhvZCBpbiB0aGUgYm9keSBvZiB5b3VyIGNvbXBvbmVudC4gIiArICJUcnkgbW92aW5nIGl0IHRvIGEgdXNlRWZmZWN0IG9yIGEgY2FsbGJhY2suIik7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBpZiAoZmV0Y2hDb250cm9sbGVycy5oYXMoa2V5KSkgYWJvcnRGZXRjaGVyKGtleSk7CiAgICAgICAgICAgICAgdmFyIG1hdGNoZXMgPSBtYXRjaFJvdXRlcyhkYXRhUm91dGVzLCBocmVmLCBpbml0LmJhc2VuYW1lKTsKCiAgICAgICAgICAgICAgaWYgKCFtYXRjaGVzKSB7CiAgICAgICAgICAgICAgICBzZXRGZXRjaGVyRXJyb3Ioa2V5LCByb3V0ZUlkLCBnZXRJbnRlcm5hbFJvdXRlckVycm9yKDQwNCwgewogICAgICAgICAgICAgICAgICBwYXRobmFtZTogaHJlZgogICAgICAgICAgICAgICAgfSkpOwogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgdmFyIF9ub3JtYWxpemVOYXZpZ2F0ZU9wdCA9CgoKICAgICAgICAgICAgICAgIG5vcm1hbGl6ZU5hdmlnYXRlT3B0aW9ucyhocmVmLCBvcHRzLCB0cnVlKSxwYXRoID0gX25vcm1hbGl6ZU5hdmlnYXRlT3B0LnBhdGgsc3VibWlzc2lvbiA9IF9ub3JtYWxpemVOYXZpZ2F0ZU9wdC5zdWJtaXNzaW9uOwogICAgICAgICAgICAgIHZhciBtYXRjaCA9IGdldFRhcmdldE1hdGNoKG1hdGNoZXMsIHBhdGgpOwoKICAgICAgICAgICAgICBpZiAoc3VibWlzc2lvbiAmJiBpc011dGF0aW9uTWV0aG9kKHN1Ym1pc3Npb24uZm9ybU1ldGhvZCkpIHsKICAgICAgICAgICAgICAgIGhhbmRsZUZldGNoZXJBY3Rpb24oa2V5LCByb3V0ZUlkLCBwYXRoLCBtYXRjaCwgbWF0Y2hlcywgc3VibWlzc2lvbik7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgfSAvLyBTdG9yZSBvZmYgdGhlIG1hdGNoIHNvIHdlIGNhbiBjYWxsIGl0J3Mgc2hvdWxkUmV2YWxpZGF0ZSBvbiBzdWJzZXF1ZW50CiAgICAgICAgICAgICAgLy8gcmV2YWxpZGF0aW9ucwoKCiAgICAgICAgICAgICAgZmV0Y2hMb2FkTWF0Y2hlcy5zZXQoa2V5LCBbcGF0aCwgbWF0Y2gsIG1hdGNoZXNdKTsKICAgICAgICAgICAgICBoYW5kbGVGZXRjaGVyTG9hZGVyKGtleSwgcm91dGVJZCwgcGF0aCwgbWF0Y2gsIG1hdGNoZXMsIHN1Ym1pc3Npb24pOwogICAgICAgICAgICB9IC8vIENhbGwgdGhlIGFjdGlvbiBmb3IgdGhlIG1hdGNoZWQgZmV0Y2hlci5zdWJtaXQoKSwgYW5kIHRoZW4gaGFuZGxlIHJlZGlyZWN0cywKICAgICAgICAgICAgLy8gZXJyb3JzLCBhbmQgcmV2YWxpZGF0aW9uCiAgICAgICAgICAgIGZ1bmN0aW9uCgogICAgICAgICAgICBoYW5kbGVGZXRjaGVyQWN0aW9uKF94MjIsIF94MjMsIF94MjQsIF94MjUsIF94MjYsIF94MjcpIHtyZXR1cm4gX2hhbmRsZUZldGNoZXJBY3Rpb24uYXBwbHkodGhpcywgYXJndW1lbnRzKTt9CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKICAgICAgICAgICAgLy8gQ2FsbCB0aGUgbWF0Y2hlZCBsb2FkZXIgZm9yIGZldGNoZXIubG9hZCgpLCBoYW5kbGluZyByZWRpcmVjdHMsIGVycm9ycywgZXRjLgogICAgICAgICAgICBmdW5jdGlvbiBfaGFuZGxlRmV0Y2hlckFjdGlvbigpIHtfaGFuZGxlRmV0Y2hlckFjdGlvbiA9IF9hc3luY1RvR2VuZXJhdG9yMiggLyojX19QVVJFX18qL19yZWdlbmVyYXRvclJ1bnRpbWUyKCkubWFyayhmdW5jdGlvbiBfY2FsbGVlNyhrZXksIHJvdXRlSWQsIHBhdGgsIG1hdGNoLCByZXF1ZXN0TWF0Y2hlcywgc3VibWlzc2lvbikge3ZhciBfZXJyb3IyLCBleGlzdGluZ0ZldGNoZXIsIGZldGNoZXIsIGFib3J0Q29udHJvbGxlciwgZmV0Y2hSZXF1ZXN0LCBhY3Rpb25SZXN1bHQsIGxvYWRpbmdGZXRjaGVyLCBuZXh0TG9jYXRpb24sIHJldmFsaWRhdGlvblJlcXVlc3QsIG1hdGNoZXMsIGxvYWRJZCwgbG9hZEZldGNoZXIsIF9nZXRNYXRjaGVzVG9Mb2FkMywgX2dldE1hdGNoZXNUb0xvYWQ0LCBtYXRjaGVzVG9Mb2FkLCByZXZhbGlkYXRpbmdGZXRjaGVycywgX3lpZWxkJGNhbGxMb2FkZXJzQW5kMiwgcmVzdWx0cywgbG9hZGVyUmVzdWx0cywgZmV0Y2hlclJlc3VsdHMsIHJlZGlyZWN0LCBfcHJvY2Vzc0xvYWRlckRhdGEyLCBsb2FkZXJEYXRhLCBlcnJvcnMsIGRvbmVGZXRjaGVyLCBkaWRBYm9ydEZldGNoTG9hZHM7cmV0dXJuIF9yZWdlbmVyYXRvclJ1bnRpbWUyKCkud3JhcChmdW5jdGlvbiBfY2FsbGVlNyQoX2NvbnRleHQ3KSB7d2hpbGUgKDEpIHN3aXRjaCAoX2NvbnRleHQ3LnByZXYgPSBfY29udGV4dDcubmV4dCkge2Nhc2UgMDppbnRlcnJ1cHRBY3RpdmVMb2FkcygpO2ZldGNoTG9hZE1hdGNoZXMuZGVsZXRlKGtleSk7aWYgKG1hdGNoLnJvdXRlLmFjdGlvbikge19jb250ZXh0Ny5uZXh0ID0gNjticmVhazt9X2Vycm9yMiA9IGdldEludGVybmFsUm91dGVyRXJyb3IoNDA1LCB7IG1ldGhvZDogc3VibWlzc2lvbi5mb3JtTWV0aG9kLCBwYXRobmFtZTogcGF0aCwgcm91dGVJZDogcm91dGVJZCB9KTtzZXRGZXRjaGVyRXJyb3Ioa2V5LCByb3V0ZUlkLCBfZXJyb3IyKTtyZXR1cm4gX2NvbnRleHQ3LmFicnVwdCgicmV0dXJuIik7Y2FzZSA2OiAvLyBQdXQgdGhpcyBmZXRjaGVyIGludG8gaXQncyBzdWJtaXR0aW5nIHN0YXRlCiAgICAgICAgICAgICAgICAgICAgICBleGlzdGluZ0ZldGNoZXIgPSBzdGF0ZS5mZXRjaGVycy5nZXQoa2V5KTtmZXRjaGVyID0gX2V4dGVuZHMoeyBzdGF0ZTogInN1Ym1pdHRpbmciIH0sIHN1Ym1pc3Npb24sIHsgZGF0YTogZXhpc3RpbmdGZXRjaGVyICYmIGV4aXN0aW5nRmV0Y2hlci5kYXRhLCAiIF9oYXNGZXRjaGVyRG9uZUFueXRoaW5nICI6IHRydWUgfSk7c3RhdGUuZmV0Y2hlcnMuc2V0KGtleSwgZmV0Y2hlcik7dXBkYXRlU3RhdGUoeyBmZXRjaGVyczogbmV3IE1hcChzdGF0ZS5mZXRjaGVycykgfSk7IC8vIENhbGwgdGhlIGFjdGlvbiBmb3IgdGhlIGZldGNoZXIKICAgICAgICAgICAgICAgICAgICAgIGFib3J0Q29udHJvbGxlciA9IG5ldyBBYm9ydENvbnRyb2xsZXIoKTtmZXRjaFJlcXVlc3QgPSBjcmVhdGVDbGllbnRTaWRlUmVxdWVzdChpbml0Lmhpc3RvcnksIHBhdGgsIGFib3J0Q29udHJvbGxlci5zaWduYWwsIHN1Ym1pc3Npb24pO2ZldGNoQ29udHJvbGxlcnMuc2V0KGtleSwgYWJvcnRDb250cm9sbGVyKTtfY29udGV4dDcubmV4dCA9IDE1O3JldHVybiBjYWxsTG9hZGVyT3JBY3Rpb24oImFjdGlvbiIsIGZldGNoUmVxdWVzdCwgbWF0Y2gsIHJlcXVlc3RNYXRjaGVzLCByb3V0ZXIuYmFzZW5hbWUpO2Nhc2UgMTU6YWN0aW9uUmVzdWx0ID0gX2NvbnRleHQ3LnNlbnQ7aWYgKCFmZXRjaFJlcXVlc3Quc2lnbmFsLmFib3J0ZWQpIHtfY29udGV4dDcubmV4dCA9IDE5O2JyZWFrO30gLy8gV2UgY2FuIGRlbGV0ZSB0aGlzIHNvIGxvbmcgYXMgd2Ugd2VyZW4ndCBhYm9ydGVkIGJ5IG91IG91ciBvd24gZmV0Y2hlcgogICAgICAgICAgICAgICAgICAgICAgLy8gcmUtc3VibWl0IHdoaWNoIHdvdWxkIGhhdmUgcHV0IF9uZXdfIGNvbnRyb2xsZXIgaXMgaW4gZmV0Y2hDb250cm9sbGVycwogICAgICAgICAgICAgICAgICAgICAgaWYgKGZldGNoQ29udHJvbGxlcnMuZ2V0KGtleSkgPT09IGFib3J0Q29udHJvbGxlcikge2ZldGNoQ29udHJvbGxlcnMuZGVsZXRlKGtleSk7fXJldHVybiBfY29udGV4dDcuYWJydXB0KCJyZXR1cm4iKTtjYXNlIDE5OmlmICghaXNSZWRpcmVjdFJlc3VsdChhY3Rpb25SZXN1bHQpKSB7X2NvbnRleHQ3Lm5leHQgPSAyNjticmVhazt9ZmV0Y2hDb250cm9sbGVycy5kZWxldGUoa2V5KTtmZXRjaFJlZGlyZWN0SWRzLmFkZChrZXkpO2xvYWRpbmdGZXRjaGVyID0gX2V4dGVuZHMoeyBzdGF0ZTogImxvYWRpbmciIH0sIHN1Ym1pc3Npb24sIHsgZGF0YTogdW5kZWZpbmVkLCAiIF9oYXNGZXRjaGVyRG9uZUFueXRoaW5nICI6IHRydWUgfSk7c3RhdGUuZmV0Y2hlcnMuc2V0KGtleSwgbG9hZGluZ0ZldGNoZXIpO3VwZGF0ZVN0YXRlKHsgZmV0Y2hlcnM6IG5ldyBNYXAoc3RhdGUuZmV0Y2hlcnMpIH0pO3JldHVybiBfY29udGV4dDcuYWJydXB0KCJyZXR1cm4iLCBzdGFydFJlZGlyZWN0TmF2aWdhdGlvbihzdGF0ZSwgYWN0aW9uUmVzdWx0LCB7IGlzRmV0Y2hBY3Rpb25SZWRpcmVjdDogdHJ1ZSB9KSk7Y2FzZSAyNjppZiAoIWlzRXJyb3JSZXN1bHQoYWN0aW9uUmVzdWx0KSkge19jb250ZXh0Ny5uZXh0ID0gMjk7YnJlYWs7fXNldEZldGNoZXJFcnJvcihrZXksIHJvdXRlSWQsIGFjdGlvblJlc3VsdC5lcnJvcik7cmV0dXJuIF9jb250ZXh0Ny5hYnJ1cHQoInJldHVybiIpO2Nhc2UgMjk6aWYgKCFpc0RlZmVycmVkUmVzdWx0KGFjdGlvblJlc3VsdCkpIHtfY29udGV4dDcubmV4dCA9IDMxO2JyZWFrO310aHJvdyBnZXRJbnRlcm5hbFJvdXRlckVycm9yKDQwMCwgeyB0eXBlOiAiZGVmZXItYWN0aW9uIiB9KTtjYXNlIDMxOiAvLyBTdGFydCB0aGUgZGF0YSBsb2FkIGZvciBjdXJyZW50IG1hdGNoZXMsIG9yIHRoZSBuZXh0IGxvY2F0aW9uIGlmIHdlJ3JlCiAgICAgICAgICAgICAgICAgICAgICAvLyBpbiB0aGUgbWlkZGxlIG9mIGEgbmF2aWdhdGlvbgogICAgICAgICAgICAgICAgICAgICAgbmV4dExvY2F0aW9uID0gc3RhdGUubmF2aWdhdGlvbi5sb2NhdGlvbiB8fCBzdGF0ZS5sb2NhdGlvbjtyZXZhbGlkYXRpb25SZXF1ZXN0ID0gY3JlYXRlQ2xpZW50U2lkZVJlcXVlc3QoaW5pdC5oaXN0b3J5LCBuZXh0TG9jYXRpb24sIGFib3J0Q29udHJvbGxlci5zaWduYWwpO21hdGNoZXMgPSBzdGF0ZS5uYXZpZ2F0aW9uLnN0YXRlICE9PSAiaWRsZSIgPyBtYXRjaFJvdXRlcyhkYXRhUm91dGVzLCBzdGF0ZS5uYXZpZ2F0aW9uLmxvY2F0aW9uLCBpbml0LmJhc2VuYW1lKSA6IHN0YXRlLm1hdGNoZXM7cm91dGVyX2ludmFyaWFudChtYXRjaGVzLCAiRGlkbid0IGZpbmQgYW55IG1hdGNoZXMgYWZ0ZXIgZmV0Y2hlciBhY3Rpb24iKTtsb2FkSWQgPSArK2luY3JlbWVudGluZ0xvYWRJZDtmZXRjaFJlbG9hZElkcy5zZXQoa2V5LCBsb2FkSWQpO2xvYWRGZXRjaGVyID0gX2V4dGVuZHMoeyBzdGF0ZTogImxvYWRpbmciLCBkYXRhOiBhY3Rpb25SZXN1bHQuZGF0YSB9LCBzdWJtaXNzaW9uLCB7ICIgX2hhc0ZldGNoZXJEb25lQW55dGhpbmcgIjogdHJ1ZSB9KTtzdGF0ZS5mZXRjaGVycy5zZXQoa2V5LCBsb2FkRmV0Y2hlcik7X2dldE1hdGNoZXNUb0xvYWQzID0gZ2V0TWF0Y2hlc1RvTG9hZChpbml0Lmhpc3RvcnksIHN0YXRlLCBtYXRjaGVzLCBzdWJtaXNzaW9uLCBuZXh0TG9jYXRpb24sIGlzUmV2YWxpZGF0aW9uUmVxdWlyZWQsIGNhbmNlbGxlZERlZmVycmVkUm91dGVzLCBjYW5jZWxsZWRGZXRjaGVyTG9hZHMsIF9kZWZpbmVQcm9wZXJ0eTIoe30sIG1hdGNoLnJvdXRlLmlkLCBhY3Rpb25SZXN1bHQuZGF0YSksIHVuZGVmaW5lZCwgLy8gTm8gbmVlZCB0byBzZW5kIHRocm91Z2ggZXJyb3JzIHNpbmNlIHdlIHNob3J0IGNpcmN1aXQgYWJvdmUKICAgICAgICAgICAgICAgICAgICAgIGZldGNoTG9hZE1hdGNoZXMpLCBfZ2V0TWF0Y2hlc1RvTG9hZDQgPSBfc2xpY2VkVG9BcnJheTIoX2dldE1hdGNoZXNUb0xvYWQzLCAyKSwgbWF0Y2hlc1RvTG9hZCA9IF9nZXRNYXRjaGVzVG9Mb2FkNFswXSwgcmV2YWxpZGF0aW5nRmV0Y2hlcnMgPSBfZ2V0TWF0Y2hlc1RvTG9hZDRbMV07IC8vIFB1dCBhbGwgcmV2YWxpZGF0aW5nIGZldGNoZXJzIGludG8gdGhlIGxvYWRpbmcgc3RhdGUsIGV4Y2VwdCBmb3IgdGhlCiAgICAgICAgICAgICAgICAgICAgICAvLyBjdXJyZW50IGZldGNoZXIgd2hpY2ggd2Ugd2FudCB0byBrZWVwIGluIGl0J3MgY3VycmVudCBsb2FkaW5nIHN0YXRlIHdoaWNoCiAgICAgICAgICAgICAgICAgICAgICAvLyBjb250YWlucyBpdCdzIGFjdGlvbiBzdWJtaXNzaW9uIGluZm8gKyBhY3Rpb24gZGF0YQogICAgICAgICAgICAgICAgICAgICAgcmV2YWxpZGF0aW5nRmV0Y2hlcnMuZmlsdGVyKChfcmVmNSkgPT4ge3ZhciBfcmVmMTggPSBfc2xpY2VkVG9BcnJheTIoX3JlZjUsIDEpLHN0YWxlS2V5ID0gX3JlZjE4WzBdO3JldHVybiBzdGFsZUtleSAhPT0ga2V5O30pLmZvckVhY2goKF9yZWY2KSA9PiB7dmFyIF9yZWYxOSA9IF9zbGljZWRUb0FycmF5MihfcmVmNiwgMSksc3RhbGVLZXkgPSBfcmVmMTlbMF07dmFyIGV4aXN0aW5nRmV0Y2hlciA9IHN0YXRlLmZldGNoZXJzLmdldChzdGFsZUtleSk7dmFyIHJldmFsaWRhdGluZ0ZldGNoZXIgPSB7IHN0YXRlOiAibG9hZGluZyIsIGRhdGE6IGV4aXN0aW5nRmV0Y2hlciAmJiBleGlzdGluZ0ZldGNoZXIuZGF0YSwgZm9ybU1ldGhvZDogdW5kZWZpbmVkLCBmb3JtQWN0aW9uOiB1bmRlZmluZWQsIGZvcm1FbmNUeXBlOiB1bmRlZmluZWQsIGZvcm1EYXRhOiB1bmRlZmluZWQsICIgX2hhc0ZldGNoZXJEb25lQW55dGhpbmcgIjogdHJ1ZSB9O3N0YXRlLmZldGNoZXJzLnNldChzdGFsZUtleSwgcmV2YWxpZGF0aW5nRmV0Y2hlcik7ZmV0Y2hDb250cm9sbGVycy5zZXQoc3RhbGVLZXksIGFib3J0Q29udHJvbGxlcik7fSk7dXBkYXRlU3RhdGUoeyBmZXRjaGVyczogbmV3IE1hcChzdGF0ZS5mZXRjaGVycykgfSk7X2NvbnRleHQ3Lm5leHQgPSA0NDtyZXR1cm4gY2FsbExvYWRlcnNBbmRNYXliZVJlc29sdmVEYXRhKHN0YXRlLm1hdGNoZXMsIG1hdGNoZXMsIG1hdGNoZXNUb0xvYWQsIHJldmFsaWRhdGluZ0ZldGNoZXJzLCByZXZhbGlkYXRpb25SZXF1ZXN0KTtjYXNlIDQ0Ol95aWVsZCRjYWxsTG9hZGVyc0FuZDIgPSBfY29udGV4dDcuc2VudDtyZXN1bHRzID0gX3lpZWxkJGNhbGxMb2FkZXJzQW5kMi5yZXN1bHRzO2xvYWRlclJlc3VsdHMgPSBfeWllbGQkY2FsbExvYWRlcnNBbmQyLmxvYWRlclJlc3VsdHM7ZmV0Y2hlclJlc3VsdHMgPSBfeWllbGQkY2FsbExvYWRlcnNBbmQyLmZldGNoZXJSZXN1bHRzO2lmICghYWJvcnRDb250cm9sbGVyLnNpZ25hbC5hYm9ydGVkKSB7X2NvbnRleHQ3Lm5leHQgPSA1MDticmVhazt9cmV0dXJuIF9jb250ZXh0Ny5hYnJ1cHQoInJldHVybiIpO2Nhc2UgNTA6ZmV0Y2hSZWxvYWRJZHMuZGVsZXRlKGtleSk7ZmV0Y2hDb250cm9sbGVycy5kZWxldGUoa2V5KTtyZXZhbGlkYXRpbmdGZXRjaGVycy5mb3JFYWNoKChfcmVmNykgPT4ge3ZhciBfcmVmMjAgPSBfc2xpY2VkVG9BcnJheTIoX3JlZjcsIDEpLHN0YWxlS2V5ID0gX3JlZjIwWzBdO3JldHVybiBmZXRjaENvbnRyb2xsZXJzLmRlbGV0ZShzdGFsZUtleSk7fSk7cmVkaXJlY3QgPSBmaW5kUmVkaXJlY3QocmVzdWx0cyk7aWYgKCFyZWRpcmVjdCkge19jb250ZXh0Ny5uZXh0ID0gNTY7YnJlYWs7fXJldHVybiBfY29udGV4dDcuYWJydXB0KCJyZXR1cm4iLCBzdGFydFJlZGlyZWN0TmF2aWdhdGlvbihzdGF0ZSwgcmVkaXJlY3QpKTtjYXNlIDU2OiAvLyBQcm9jZXNzIGFuZCBjb21taXQgb3V0cHV0IGZyb20gbG9hZGVycwogICAgICAgICAgICAgICAgICAgICAgX3Byb2Nlc3NMb2FkZXJEYXRhMiA9IHByb2Nlc3NMb2FkZXJEYXRhKHN0YXRlLCBzdGF0ZS5tYXRjaGVzLCBtYXRjaGVzVG9Mb2FkLCBsb2FkZXJSZXN1bHRzLCB1bmRlZmluZWQsIHJldmFsaWRhdGluZ0ZldGNoZXJzLCBmZXRjaGVyUmVzdWx0cywgYWN0aXZlRGVmZXJyZWRzKSwgbG9hZGVyRGF0YSA9IF9wcm9jZXNzTG9hZGVyRGF0YTIubG9hZGVyRGF0YSwgZXJyb3JzID0gX3Byb2Nlc3NMb2FkZXJEYXRhMi5lcnJvcnM7ZG9uZUZldGNoZXIgPSB7IHN0YXRlOiAiaWRsZSIsIGRhdGE6IGFjdGlvblJlc3VsdC5kYXRhLCBmb3JtTWV0aG9kOiB1bmRlZmluZWQsIGZvcm1BY3Rpb246IHVuZGVmaW5lZCwgZm9ybUVuY1R5cGU6IHVuZGVmaW5lZCwgZm9ybURhdGE6IHVuZGVmaW5lZCwgIiBfaGFzRmV0Y2hlckRvbmVBbnl0aGluZyAiOiB0cnVlIH07c3RhdGUuZmV0Y2hlcnMuc2V0KGtleSwgZG9uZUZldGNoZXIpO2RpZEFib3J0RmV0Y2hMb2FkcyA9IGFib3J0U3RhbGVGZXRjaExvYWRzKGxvYWRJZCk7IC8vIElmIHdlIGFyZSBjdXJyZW50bHkgaW4gYSBuYXZpZ2F0aW9uIGxvYWRpbmcgc3RhdGUgYW5kIHRoaXMgZmV0Y2hlciBpcwogICAgICAgICAgICAgICAgICAgICAgLy8gbW9yZSByZWNlbnQgdGhhbiB0aGUgbmF2aWdhdGlvbiwgd2Ugd2FudCB0aGUgbmV3ZXIgZGF0YSBzbyBhYm9ydCB0aGUKICAgICAgICAgICAgICAgICAgICAgIC8vIG5hdmlnYXRpb24gYW5kIGNvbXBsZXRlIGl0IHdpdGggdGhlIGZldGNoZXIgZGF0YQogICAgICAgICAgICAgICAgICAgICAgaWYgKHN0YXRlLm5hdmlnYXRpb24uc3RhdGUgPT09ICJsb2FkaW5nIiAmJiBsb2FkSWQgPiBwZW5kaW5nTmF2aWdhdGlvbkxvYWRJZCkge3JvdXRlcl9pbnZhcmlhbnQocGVuZGluZ0FjdGlvbiwgIkV4cGVjdGVkIHBlbmRpbmcgYWN0aW9uIik7cGVuZGluZ05hdmlnYXRpb25Db250cm9sbGVyICYmIHBlbmRpbmdOYXZpZ2F0aW9uQ29udHJvbGxlci5hYm9ydCgpO2NvbXBsZXRlTmF2aWdhdGlvbihzdGF0ZS5uYXZpZ2F0aW9uLmxvY2F0aW9uLCB7IG1hdGNoZXM6IG1hdGNoZXMsIGxvYWRlckRhdGE6IGxvYWRlckRhdGEsIGVycm9yczogZXJyb3JzLCBmZXRjaGVyczogbmV3IE1hcChzdGF0ZS5mZXRjaGVycykgfSk7fSBlbHNlIHsvLyBvdGhlcndpc2UganVzdCB1cGRhdGUgd2l0aCB0aGUgZmV0Y2hlciBkYXRhLCBwcmVzZXJ2aW5nIGFueSBleGlzdGluZwogICAgICAgICAgICAgICAgICAgICAgICAvLyBsb2FkZXJEYXRhIGZvciBsb2FkZXJzIHRoYXQgZGlkIG5vdCBuZWVkIHRvIHJlbG9hZC4gIFdlIGhhdmUgdG8KICAgICAgICAgICAgICAgICAgICAgICAgLy8gbWFudWFsbHkgbWVyZ2UgaGVyZSBzaW5jZSB3ZSBhcmVuJ3QgZ29pbmcgdGhyb3VnaCBjb21wbGV0ZU5hdmlnYXRpb24KICAgICAgICAgICAgICAgICAgICAgICAgdXBkYXRlU3RhdGUoX2V4dGVuZHMoeyBlcnJvcnM6IGVycm9ycywgbG9hZGVyRGF0YTogbWVyZ2VMb2FkZXJEYXRhKHN0YXRlLmxvYWRlckRhdGEsIGxvYWRlckRhdGEsIG1hdGNoZXMsIGVycm9ycykgfSwgZGlkQWJvcnRGZXRjaExvYWRzID8geyBmZXRjaGVyczogbmV3IE1hcChzdGF0ZS5mZXRjaGVycykgfSA6IHt9KSk7aXNSZXZhbGlkYXRpb25SZXF1aXJlZCA9IGZhbHNlO31jYXNlIDYxOmNhc2UgImVuZCI6cmV0dXJuIF9jb250ZXh0Ny5zdG9wKCk7fX0sIF9jYWxsZWU3KTt9KSk7cmV0dXJuIF9oYW5kbGVGZXRjaGVyQWN0aW9uLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7fWZ1bmN0aW9uIGhhbmRsZUZldGNoZXJMb2FkZXIoX3gyOCwgX3gyOSwgX3gzMCwgX3gzMSwgX3gzMiwgX3gzMykge3JldHVybiBfaGFuZGxlRmV0Y2hlckxvYWRlci5hcHBseSh0aGlzLCBhcmd1bWVudHMpO30KCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKICAgICAgICAgICAgLyoqCiAgICAgICAgICAgICAqIFV0aWxpdHkgZnVuY3Rpb24gdG8gaGFuZGxlIHJlZGlyZWN0cyByZXR1cm5lZCBmcm9tIGFuIGFjdGlvbiBvciBsb2FkZXIuCiAgICAgICAgICAgICAqIE5vcm1hbGx5LCBhIHJlZGlyZWN0ICJyZXBsYWNlcyIgdGhlIG5hdmlnYXRpb24gdGhhdCB0cmlnZ2VyZWQgaXQuICBTbywgZm9yCiAgICAgICAgICAgICAqIGV4YW1wbGU6CiAgICAgICAgICAgICAqCiAgICAgICAgICAgICAqICAtIHVzZXIgaXMgb24gL2EKICAgICAgICAgICAgICogIC0gdXNlciBjbGlja3MgYSBsaW5rIHRvIC9iCiAgICAgICAgICAgICAqICAtIGxvYWRlciBmb3IgL2IgcmVkaXJlY3RzIHRvIC9jCiAgICAgICAgICAgICAqCiAgICAgICAgICAgICAqIEluIGEgbm9uLUpTIGFwcCB0aGUgYnJvd3NlciB3b3VsZCB0cmFjayB0aGUgaW4tZmxpZ2h0IG5hdmlnYXRpb24gdG8gL2IgYW5kCiAgICAgICAgICAgICAqIHRoZW4gcmVwbGFjZSBpdCB3aXRoIC9jIHdoZW4gaXQgZW5jb3VudGVyZWQgdGhlIHJlZGlyZWN0IHJlc3BvbnNlLiAgSW4KICAgICAgICAgICAgICogdGhlIGVuZCBpdCB3b3VsZCBvbmx5IGV2ZXIgdXBkYXRlIHRoZSBVUkwgYmFyIHdpdGggL2MuCiAgICAgICAgICAgICAqCiAgICAgICAgICAgICAqIEluIGNsaWVudC1zaWRlIHJvdXRpbmcgdXNpbmcgcHVzaFN0YXRlL3JlcGxhY2VTdGF0ZSwgd2UgYWltIHRvIGVtdWxhdGUKICAgICAgICAgICAgICogdGhpcyBiZWhhdmlvciBhbmQgd2UgYWxzbyBkbyBub3QgdXBkYXRlIGhpc3RvcnkgdW50aWwgdGhlIGVuZCBvZiB0aGUKICAgICAgICAgICAgICogbmF2aWdhdGlvbiAoaW5jbHVkaW5nIHByb2Nlc3NlZCByZWRpcmVjdHMpLiAgVGhpcyBtZWFucyB0aGF0IHdlIG5ldmVyCiAgICAgICAgICAgICAqIGFjdHVhbGx5IHRvdWNoIGhpc3RvcnkgdW50aWwgd2UndmUgcHJvY2Vzc2VkIHJlZGlyZWN0cywgc28gd2UganVzdCB1c2UKICAgICAgICAgICAgICogdGhlIGhpc3RvcnkgYWN0aW9uIGZyb20gdGhlIG9yaWdpbmFsIG5hdmlnYXRpb24gKFBVU0ggb3IgUkVQTEFDRSkuCiAgICAgICAgICAgICAqL2Z1bmN0aW9uIF9oYW5kbGVGZXRjaGVyTG9hZGVyKCkge19oYW5kbGVGZXRjaGVyTG9hZGVyID0gX2FzeW5jVG9HZW5lcmF0b3IyKCAvKiNfX1BVUkVfXyovX3JlZ2VuZXJhdG9yUnVudGltZTIoKS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWU4KGtleSwgcm91dGVJZCwgcGF0aCwgbWF0Y2gsIG1hdGNoZXMsIHN1Ym1pc3Npb24pIHt2YXIgZXhpc3RpbmdGZXRjaGVyLCBsb2FkaW5nRmV0Y2hlciwgYWJvcnRDb250cm9sbGVyLCBmZXRjaFJlcXVlc3QsIHJlc3VsdCwgYm91bmRhcnlNYXRjaCwgZG9uZUZldGNoZXI7cmV0dXJuIF9yZWdlbmVyYXRvclJ1bnRpbWUyKCkud3JhcChmdW5jdGlvbiBfY2FsbGVlOCQoX2NvbnRleHQ4KSB7d2hpbGUgKDEpIHN3aXRjaCAoX2NvbnRleHQ4LnByZXYgPSBfY29udGV4dDgubmV4dCkge2Nhc2UgMDpleGlzdGluZ0ZldGNoZXIgPSBzdGF0ZS5mZXRjaGVycy5nZXQoa2V5KTsgLy8gUHV0IHRoaXMgZmV0Y2hlciBpbnRvIGl0J3MgbG9hZGluZyBzdGF0ZQogICAgICAgICAgICAgICAgICAgICAgbG9hZGluZ0ZldGNoZXIgPSBfZXh0ZW5kcyh7IHN0YXRlOiAibG9hZGluZyIsIGZvcm1NZXRob2Q6IHVuZGVmaW5lZCwgZm9ybUFjdGlvbjogdW5kZWZpbmVkLCBmb3JtRW5jVHlwZTogdW5kZWZpbmVkLCBmb3JtRGF0YTogdW5kZWZpbmVkIH0sIHN1Ym1pc3Npb24sIHsgZGF0YTogZXhpc3RpbmdGZXRjaGVyICYmIGV4aXN0aW5nRmV0Y2hlci5kYXRhLCAiIF9oYXNGZXRjaGVyRG9uZUFueXRoaW5nICI6IHRydWUgfSk7c3RhdGUuZmV0Y2hlcnMuc2V0KGtleSwgbG9hZGluZ0ZldGNoZXIpO3VwZGF0ZVN0YXRlKHsgZmV0Y2hlcnM6IG5ldyBNYXAoc3RhdGUuZmV0Y2hlcnMpIH0pOyAvLyBDYWxsIHRoZSBsb2FkZXIgZm9yIHRoaXMgZmV0Y2hlciByb3V0ZSBtYXRjaAogICAgICAgICAgICAgICAgICAgICAgYWJvcnRDb250cm9sbGVyID0gbmV3IEFib3J0Q29udHJvbGxlcigpO2ZldGNoUmVxdWVzdCA9IGNyZWF0ZUNsaWVudFNpZGVSZXF1ZXN0KGluaXQuaGlzdG9yeSwgcGF0aCwgYWJvcnRDb250cm9sbGVyLnNpZ25hbCk7ZmV0Y2hDb250cm9sbGVycy5zZXQoa2V5LCBhYm9ydENvbnRyb2xsZXIpO19jb250ZXh0OC5uZXh0ID0gOTtyZXR1cm4gY2FsbExvYWRlck9yQWN0aW9uKCJsb2FkZXIiLCBmZXRjaFJlcXVlc3QsIG1hdGNoLCBtYXRjaGVzLCByb3V0ZXIuYmFzZW5hbWUpO2Nhc2UgOTpyZXN1bHQgPSBfY29udGV4dDguc2VudDtpZiAoIWlzRGVmZXJyZWRSZXN1bHQocmVzdWx0KSkge19jb250ZXh0OC5uZXh0ID0gMTc7YnJlYWs7fV9jb250ZXh0OC5uZXh0ID0gMTM7cmV0dXJuIHJlc29sdmVEZWZlcnJlZERhdGEocmVzdWx0LCBmZXRjaFJlcXVlc3Quc2lnbmFsLCB0cnVlKTtjYXNlIDEzOl9jb250ZXh0OC50MCA9IF9jb250ZXh0OC5zZW50O2lmIChfY29udGV4dDgudDApIHtfY29udGV4dDgubmV4dCA9IDE2O2JyZWFrO31fY29udGV4dDgudDAgPSByZXN1bHQ7Y2FzZSAxNjpyZXN1bHQgPSBfY29udGV4dDgudDA7Y2FzZSAxNzogLy8gV2UgY2FuIGRlbGV0ZSB0aGlzIHNvIGxvbmcgYXMgd2Ugd2VyZW4ndCBhYm9ydGVkIGJ5IG91IG91ciBvd24gZmV0Y2hlcgogICAgICAgICAgICAgICAgICAgICAgLy8gcmUtbG9hZCB3aGljaCB3b3VsZCBoYXZlIHB1dCBfbmV3XyBjb250cm9sbGVyIGlzIGluIGZldGNoQ29udHJvbGxlcnMKICAgICAgICAgICAgICAgICAgICAgIGlmIChmZXRjaENvbnRyb2xsZXJzLmdldChrZXkpID09PSBhYm9ydENvbnRyb2xsZXIpIHtmZXRjaENvbnRyb2xsZXJzLmRlbGV0ZShrZXkpO31pZiAoIWZldGNoUmVxdWVzdC5zaWduYWwuYWJvcnRlZCkge19jb250ZXh0OC5uZXh0ID0gMjA7YnJlYWs7fXJldHVybiBfY29udGV4dDguYWJydXB0KCJyZXR1cm4iKTtjYXNlIDIwOmlmICghaXNSZWRpcmVjdFJlc3VsdChyZXN1bHQpKSB7X2NvbnRleHQ4Lm5leHQgPSAyNDticmVhazt9X2NvbnRleHQ4Lm5leHQgPSAyMztyZXR1cm4gc3RhcnRSZWRpcmVjdE5hdmlnYXRpb24oc3RhdGUsIHJlc3VsdCk7Y2FzZSAyMzpyZXR1cm4gX2NvbnRleHQ4LmFicnVwdCgicmV0dXJuIik7Y2FzZSAyNDppZiAoIWlzRXJyb3JSZXN1bHQocmVzdWx0KSkge19jb250ZXh0OC5uZXh0ID0gMjk7YnJlYWs7fWJvdW5kYXJ5TWF0Y2ggPSBmaW5kTmVhcmVzdEJvdW5kYXJ5KHN0YXRlLm1hdGNoZXMsIHJvdXRlSWQpO3N0YXRlLmZldGNoZXJzLmRlbGV0ZShrZXkpOyAvLyBUT0RPOiBJbiByZW1peCwgdGhpcyB3b3VsZCByZXNldCB0byBJRExFX05BVklHQVRJT04gaWYgaXQgd2FzIGEgY2F0Y2ggLQogICAgICAgICAgICAgICAgICAgICAgLy8gZG8gd2UgbmVlZCB0byBiZWhhdmUgYW55IGRpZmZlcmVudGx5IHdpdGggb3VyIG5vbi1yZWRpcmVjdCBlcnJvcnM/CiAgICAgICAgICAgICAgICAgICAgICAvLyBXaGF0IGlmIGl0IHdhcyBhIG5vbi1yZWRpcmVjdCBSZXNwb25zZT8KICAgICAgICAgICAgICAgICAgICAgIHVwZGF0ZVN0YXRlKHsgZmV0Y2hlcnM6IG5ldyBNYXAoc3RhdGUuZmV0Y2hlcnMpLCBlcnJvcnM6IF9kZWZpbmVQcm9wZXJ0eTIoe30sIGJvdW5kYXJ5TWF0Y2gucm91dGUuaWQsIHJlc3VsdC5lcnJvcikgfSk7cmV0dXJuIF9jb250ZXh0OC5hYnJ1cHQoInJldHVybiIpO2Nhc2UgMjk6cm91dGVyX2ludmFyaWFudCghaXNEZWZlcnJlZFJlc3VsdChyZXN1bHQpLCAiVW5oYW5kbGVkIGZldGNoZXIgZGVmZXJyZWQgZGF0YSIpOyAvLyBQdXQgdGhlIGZldGNoZXIgYmFjayBpbnRvIGFuIGlkbGUgc3RhdGUKICAgICAgICAgICAgICAgICAgICAgIGRvbmVGZXRjaGVyID0geyBzdGF0ZTogImlkbGUiLCBkYXRhOiByZXN1bHQuZGF0YSwgZm9ybU1ldGhvZDogdW5kZWZpbmVkLCBmb3JtQWN0aW9uOiB1bmRlZmluZWQsIGZvcm1FbmNUeXBlOiB1bmRlZmluZWQsIGZvcm1EYXRhOiB1bmRlZmluZWQsICIgX2hhc0ZldGNoZXJEb25lQW55dGhpbmcgIjogdHJ1ZSB9O3N0YXRlLmZldGNoZXJzLnNldChrZXksIGRvbmVGZXRjaGVyKTt1cGRhdGVTdGF0ZSh7IGZldGNoZXJzOiBuZXcgTWFwKHN0YXRlLmZldGNoZXJzKSB9KTtjYXNlIDMzOmNhc2UgImVuZCI6cmV0dXJuIF9jb250ZXh0OC5zdG9wKCk7fX0sIF9jYWxsZWU4KTt9KSk7cmV0dXJuIF9oYW5kbGVGZXRjaGVyTG9hZGVyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7fWZ1bmN0aW9uIHN0YXJ0UmVkaXJlY3ROYXZpZ2F0aW9uKF94MzQsIF94MzUsIF94MzYpIHtyZXR1cm4gX3N0YXJ0UmVkaXJlY3ROYXZpZ2F0aW9uLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7fWZ1bmN0aW9uIF9zdGFydFJlZGlyZWN0TmF2aWdhdGlvbigpIHtfc3RhcnRSZWRpcmVjdE5hdmlnYXRpb24gPSBfYXN5bmNUb0dlbmVyYXRvcjIoIC8qI19fUFVSRV9fKi9fcmVnZW5lcmF0b3JSdW50aW1lMigpLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTkoc3RhdGUsIHJlZGlyZWN0LCBfdGVtcCkge3ZhciBfd2luZG93LCBfcmVmMjEsIHN1Ym1pc3Npb24sIHJlcGxhY2UsIGlzRmV0Y2hBY3Rpb25SZWRpcmVjdCwgcmVkaXJlY3RMb2NhdGlvbiwgbmV3T3JpZ2luLCByZWRpcmVjdEhpc3RvcnlBY3Rpb24sIF9zdGF0ZSRuYXZpZ2F0aW9uLCBmb3JtTWV0aG9kLCBmb3JtQWN0aW9uLCBmb3JtRW5jVHlwZSwgZm9ybURhdGE7cmV0dXJuIF9yZWdlbmVyYXRvclJ1bnRpbWUyKCkud3JhcChmdW5jdGlvbiBfY2FsbGVlOSQoX2NvbnRleHQ5KSB7d2hpbGUgKDEpIHN3aXRjaCAoX2NvbnRleHQ5LnByZXYgPSBfY29udGV4dDkubmV4dCkge2Nhc2UgMDpfcmVmMjEgPQoKICAgICAgICAgICAgICAgICAgICAgIF90ZW1wID09PSB2b2lkIDAgPyB7fSA6IF90ZW1wLCBzdWJtaXNzaW9uID0gX3JlZjIxLnN1Ym1pc3Npb24sIHJlcGxhY2UgPSBfcmVmMjEucmVwbGFjZSwgaXNGZXRjaEFjdGlvblJlZGlyZWN0ID0gX3JlZjIxLmlzRmV0Y2hBY3Rpb25SZWRpcmVjdDsKCiAgICAgICAgICAgICAgICAgICAgICBpZiAocmVkaXJlY3QucmV2YWxpZGF0ZSkgewogICAgICAgICAgICAgICAgICAgICAgICBpc1JldmFsaWRhdGlvblJlcXVpcmVkID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICByZWRpcmVjdExvY2F0aW9uID0gY3JlYXRlTG9jYXRpb24oc3RhdGUubG9jYXRpb24sIHJlZGlyZWN0LmxvY2F0aW9uLCAvLyBUT0RPOiBUaGlzIGNhbiBiZSByZW1vdmVkIG9uY2Ugd2UgZ2V0IHJpZCBvZiB1c2VUcmFuc2l0aW9uIGluIFJlbWl4IHYyCiAgICAgICAgICAgICAgICAgICAgICBfZXh0ZW5kcyh7CiAgICAgICAgICAgICAgICAgICAgICAgIF9pc1JlZGlyZWN0OiB0cnVlCiAgICAgICAgICAgICAgICAgICAgICB9LCBpc0ZldGNoQWN0aW9uUmVkaXJlY3QgPyB7CiAgICAgICAgICAgICAgICAgICAgICAgIF9pc0ZldGNoQWN0aW9uUmVkaXJlY3Q6IHRydWUKICAgICAgICAgICAgICAgICAgICAgIH0gOiB7fSkpOwogICAgICAgICAgICAgICAgICAgICAgcm91dGVyX2ludmFyaWFudChyZWRpcmVjdExvY2F0aW9uLCAiRXhwZWN0ZWQgYSBsb2NhdGlvbiBvbiB0aGUgcmVkaXJlY3QgbmF2aWdhdGlvbiIpOyAvLyBDaGVjayBpZiB0aGlzIGFuIGV4dGVybmFsIHJlZGlyZWN0IHRoYXQgZ29lcyB0byBhIG5ldyBvcmlnaW4KICAgICAgICAgICAgICAgICAgICAgIGlmICghKAogICAgICAgICAgICAgICAgICAgICAgaXNCcm93c2VyICYmIHR5cGVvZiAoKF93aW5kb3cgPSB3aW5kb3cpID09IG51bGwgPyB2b2lkIDAgOiBfd2luZG93LmxvY2F0aW9uKSAhPT0gInVuZGVmaW5lZCIpKSB7X2NvbnRleHQ5Lm5leHQgPSA5O2JyZWFrO30KICAgICAgICAgICAgICAgICAgICAgIG5ld09yaWdpbiA9IGluaXQuaGlzdG9yeS5jcmVhdGVVUkwocmVkaXJlY3QubG9jYXRpb24pLm9yaWdpbjtpZiAoISgKCiAgICAgICAgICAgICAgICAgICAgICB3aW5kb3cubG9jYXRpb24ub3JpZ2luICE9PSBuZXdPcmlnaW4pKSB7X2NvbnRleHQ5Lm5leHQgPSA5O2JyZWFrO30KICAgICAgICAgICAgICAgICAgICAgIGlmIChyZXBsYWNlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvdy5sb2NhdGlvbi5yZXBsYWNlKHJlZGlyZWN0LmxvY2F0aW9uKTsKICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvdy5sb2NhdGlvbi5hc3NpZ24ocmVkaXJlY3QubG9jYXRpb24pOwogICAgICAgICAgICAgICAgICAgICAgfXJldHVybiBfY29udGV4dDkuYWJydXB0KCJyZXR1cm4iKTtjYXNlIDk6CgoKCiAgICAgICAgICAgICAgICAgICAgICAvLyBUaGVyZSdzIG5vIG5lZWQgdG8gYWJvcnQgb24gcmVkaXJlY3RzLCBzaW5jZSB3ZSBkb24ndCBkZXRlY3QgdGhlCiAgICAgICAgICAgICAgICAgICAgICAvLyByZWRpcmVjdCB1bnRpbCB0aGUgYWN0aW9uL2xvYWRlcnMgaGF2ZSBzZXR0bGVkCgoKICAgICAgICAgICAgICAgICAgICAgIHBlbmRpbmdOYXZpZ2F0aW9uQ29udHJvbGxlciA9IG51bGw7CiAgICAgICAgICAgICAgICAgICAgICByZWRpcmVjdEhpc3RvcnlBY3Rpb24gPSByZXBsYWNlID09PSB0cnVlID8gQWN0aW9uLlJlcGxhY2UgOiBBY3Rpb24uUHVzaDsgLy8gVXNlIHRoZSBpbmNvbWluZyBzdWJtaXNzaW9uIGlmIHByb3ZpZGVkLCBmYWxsYmFjayBvbiB0aGUgYWN0aXZlIG9uZSBpbgogICAgICAgICAgICAgICAgICAgICAgLy8gc3RhdGUubmF2aWdhdGlvbgogICAgICAgICAgICAgICAgICAgICAgX3N0YXRlJG5hdmlnYXRpb24gPQoKCgoKCiAgICAgICAgICAgICAgICAgICAgICBzdGF0ZS5uYXZpZ2F0aW9uLCBmb3JtTWV0aG9kID0gX3N0YXRlJG5hdmlnYXRpb24uZm9ybU1ldGhvZCwgZm9ybUFjdGlvbiA9IF9zdGF0ZSRuYXZpZ2F0aW9uLmZvcm1BY3Rpb24sIGZvcm1FbmNUeXBlID0gX3N0YXRlJG5hdmlnYXRpb24uZm9ybUVuY1R5cGUsIGZvcm1EYXRhID0gX3N0YXRlJG5hdmlnYXRpb24uZm9ybURhdGE7CgogICAgICAgICAgICAgICAgICAgICAgaWYgKCFzdWJtaXNzaW9uICYmIGZvcm1NZXRob2QgJiYgZm9ybUFjdGlvbiAmJiBmb3JtRGF0YSAmJiBmb3JtRW5jVHlwZSkgewogICAgICAgICAgICAgICAgICAgICAgICBzdWJtaXNzaW9uID0gewogICAgICAgICAgICAgICAgICAgICAgICAgIGZvcm1NZXRob2Q6IGZvcm1NZXRob2QsCiAgICAgICAgICAgICAgICAgICAgICAgICAgZm9ybUFjdGlvbjogZm9ybUFjdGlvbiwKICAgICAgICAgICAgICAgICAgICAgICAgICBmb3JtRW5jVHlwZTogZm9ybUVuY1R5cGUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgZm9ybURhdGE6IGZvcm1EYXRhCiAgICAgICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgICAgICB9IC8vIElmIHRoaXMgd2FzIGEgMzA3LzMwOCBzdWJtaXNzaW9uIHdlIHdhbnQgdG8gcHJlc2VydmUgdGhlIEhUVFAgbWV0aG9kIGFuZAogICAgICAgICAgICAgICAgICAgICAgLy8gcmUtc3VibWl0IHRoZSBHRVQvUE9TVC9QVVQvUEFUQ0gvREVMRVRFIGFzIGEgc3VibWlzc2lvbiBuYXZpZ2F0aW9uIHRvIHRoZQogICAgICAgICAgICAgICAgICAgICAgLy8gcmVkaXJlY3RlZCBsb2NhdGlvbgogICAgICAgICAgICAgICAgICAgICAgaWYgKCEoCgogICAgICAgICAgICAgICAgICAgICAgcmVkaXJlY3RQcmVzZXJ2ZU1ldGhvZFN0YXR1c0NvZGVzLmhhcyhyZWRpcmVjdC5zdGF0dXMpICYmIHN1Ym1pc3Npb24gJiYgaXNNdXRhdGlvbk1ldGhvZChzdWJtaXNzaW9uLmZvcm1NZXRob2QpKSkge19jb250ZXh0OS5uZXh0ID0gMTg7YnJlYWs7fV9jb250ZXh0OS5uZXh0ID0gMTY7cmV0dXJuICgKICAgICAgICAgICAgICAgICAgICAgICAgc3RhcnROYXZpZ2F0aW9uKHJlZGlyZWN0SGlzdG9yeUFjdGlvbiwgcmVkaXJlY3RMb2NhdGlvbiwgewogICAgICAgICAgICAgICAgICAgICAgICAgIHN1Ym1pc3Npb246IF9leHRlbmRzKHt9LCBzdWJtaXNzaW9uLCB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3JtQWN0aW9uOiByZWRpcmVjdC5sb2NhdGlvbgogICAgICAgICAgICAgICAgICAgICAgICAgIH0pLAogICAgICAgICAgICAgICAgICAgICAgICAgIC8vIFByZXNlcnZlIHRoaXMgZmxhZyBhY3Jvc3MgcmVkaXJlY3RzCiAgICAgICAgICAgICAgICAgICAgICAgICAgcHJldmVudFNjcm9sbFJlc2V0OiBwZW5kaW5nUHJldmVudFNjcm9sbFJlc2V0CiAgICAgICAgICAgICAgICAgICAgICAgIH0pKTtjYXNlIDE2Ol9jb250ZXh0OS5uZXh0ID0gMjA7YnJlYWs7Y2FzZSAxODpfY29udGV4dDkubmV4dCA9IDIwO3JldHVybiAoCgoKCiAgICAgICAgICAgICAgICAgICAgICAgIHN0YXJ0TmF2aWdhdGlvbihyZWRpcmVjdEhpc3RvcnlBY3Rpb24sIHJlZGlyZWN0TG9jYXRpb24sIHsKICAgICAgICAgICAgICAgICAgICAgICAgICBvdmVycmlkZU5hdmlnYXRpb246IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YXRlOiAibG9hZGluZyIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2NhdGlvbjogcmVkaXJlY3RMb2NhdGlvbiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvcm1NZXRob2Q6IHN1Ym1pc3Npb24gPyBzdWJtaXNzaW9uLmZvcm1NZXRob2QgOiB1bmRlZmluZWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3JtQWN0aW9uOiBzdWJtaXNzaW9uID8gc3VibWlzc2lvbi5mb3JtQWN0aW9uIDogdW5kZWZpbmVkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9ybUVuY1R5cGU6IHN1Ym1pc3Npb24gPyBzdWJtaXNzaW9uLmZvcm1FbmNUeXBlIDogdW5kZWZpbmVkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9ybURhdGE6IHN1Ym1pc3Npb24gPyBzdWJtaXNzaW9uLmZvcm1EYXRhIDogdW5kZWZpbmVkCiAgICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBQcmVzZXJ2ZSB0aGlzIGZsYWcgYWNyb3NzIHJlZGlyZWN0cwogICAgICAgICAgICAgICAgICAgICAgICAgIHByZXZlbnRTY3JvbGxSZXNldDogcGVuZGluZ1ByZXZlbnRTY3JvbGxSZXNldAogICAgICAgICAgICAgICAgICAgICAgICB9KSk7Y2FzZSAyMDpjYXNlICJlbmQiOnJldHVybiBfY29udGV4dDkuc3RvcCgpO319LCBfY2FsbGVlOSk7fSkpO3JldHVybiBfc3RhcnRSZWRpcmVjdE5hdmlnYXRpb24uYXBwbHkodGhpcywgYXJndW1lbnRzKTt9ZnVuY3Rpb24KCgoKICAgICAgICAgICAgY2FsbExvYWRlcnNBbmRNYXliZVJlc29sdmVEYXRhKF94MzcsIF94MzgsIF94MzksIF94NDAsIF94NDEpIHtyZXR1cm4gX2NhbGxMb2FkZXJzQW5kTWF5YmVSZXNvbHZlRGF0YS5hcHBseSh0aGlzLCBhcmd1bWVudHMpO31mdW5jdGlvbiBfY2FsbExvYWRlcnNBbmRNYXliZVJlc29sdmVEYXRhKCkge19jYWxsTG9hZGVyc0FuZE1heWJlUmVzb2x2ZURhdGEgPSBfYXN5bmNUb0dlbmVyYXRvcjIoIC8qI19fUFVSRV9fKi9fcmVnZW5lcmF0b3JSdW50aW1lMigpLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTEwKGN1cnJlbnRNYXRjaGVzLCBtYXRjaGVzLCBtYXRjaGVzVG9Mb2FkLCBmZXRjaGVyc1RvTG9hZCwgcmVxdWVzdCkge3ZhciByZXN1bHRzLCBsb2FkZXJSZXN1bHRzLCBmZXRjaGVyUmVzdWx0cztyZXR1cm4gX3JlZ2VuZXJhdG9yUnVudGltZTIoKS53cmFwKGZ1bmN0aW9uIF9jYWxsZWUxMCQoX2NvbnRleHQxMCkge3doaWxlICgxKSBzd2l0Y2ggKF9jb250ZXh0MTAucHJldiA9IF9jb250ZXh0MTAubmV4dCkge2Nhc2UgMDpfY29udGV4dDEwLm5leHQgPSAyO3JldHVybiAoCgoKCiAgICAgICAgICAgICAgICAgICAgICAgIFByb21pc2UuYWxsKFtdLmNvbmNhdChfdG9Db25zdW1hYmxlQXJyYXkyKG1hdGNoZXNUb0xvYWQubWFwKChtYXRjaCkgPT4gY2FsbExvYWRlck9yQWN0aW9uKCJsb2FkZXIiLCByZXF1ZXN0LCBtYXRjaCwgbWF0Y2hlcywgcm91dGVyLmJhc2VuYW1lKSkpLCBfdG9Db25zdW1hYmxlQXJyYXkyKGZldGNoZXJzVG9Mb2FkLm1hcCgoX3JlZjgpID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgX3JlZjIyID0gX3NsaWNlZFRvQXJyYXkyKF9yZWY4LCA0KSxocmVmID0gX3JlZjIyWzFdLG1hdGNoID0gX3JlZjIyWzJdLGZldGNoTWF0Y2hlcyA9IF9yZWYyMlszXTsKICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gY2FsbExvYWRlck9yQWN0aW9uKCJsb2FkZXIiLCBjcmVhdGVDbGllbnRTaWRlUmVxdWVzdChpbml0Lmhpc3RvcnksIGhyZWYsIHJlcXVlc3Quc2lnbmFsKSwgbWF0Y2gsIGZldGNoTWF0Y2hlcywgcm91dGVyLmJhc2VuYW1lKTsKICAgICAgICAgICAgICAgICAgICAgICAgfSkpKSkpO2Nhc2UgMjpyZXN1bHRzID0gX2NvbnRleHQxMC5zZW50OwogICAgICAgICAgICAgICAgICAgICAgbG9hZGVyUmVzdWx0cyA9IHJlc3VsdHMuc2xpY2UoMCwgbWF0Y2hlc1RvTG9hZC5sZW5ndGgpOwogICAgICAgICAgICAgICAgICAgICAgZmV0Y2hlclJlc3VsdHMgPSByZXN1bHRzLnNsaWNlKG1hdGNoZXNUb0xvYWQubGVuZ3RoKTtfY29udGV4dDEwLm5leHQgPSA3O3JldHVybiAoCiAgICAgICAgICAgICAgICAgICAgICAgIFByb21pc2UuYWxsKFtyZXNvbHZlRGVmZXJyZWRSZXN1bHRzKGN1cnJlbnRNYXRjaGVzLCBtYXRjaGVzVG9Mb2FkLCBsb2FkZXJSZXN1bHRzLCByZXF1ZXN0LnNpZ25hbCwgZmFsc2UsIHN0YXRlLmxvYWRlckRhdGEpLCByZXNvbHZlRGVmZXJyZWRSZXN1bHRzKGN1cnJlbnRNYXRjaGVzLCBmZXRjaGVyc1RvTG9hZC5tYXAoKF9yZWY5KSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIF9yZWYyMyA9IF9zbGljZWRUb0FycmF5MihfcmVmOSwgMyksbWF0Y2ggPSBfcmVmMjNbMl07CiAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG1hdGNoOwogICAgICAgICAgICAgICAgICAgICAgICB9KSwgZmV0Y2hlclJlc3VsdHMsIHJlcXVlc3Quc2lnbmFsLCB0cnVlKV0pKTtjYXNlIDc6cmV0dXJuIF9jb250ZXh0MTAuYWJydXB0KCJyZXR1cm4iLAogICAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICByZXN1bHRzOiByZXN1bHRzLAogICAgICAgICAgICAgICAgICAgICAgICBsb2FkZXJSZXN1bHRzOiBsb2FkZXJSZXN1bHRzLAogICAgICAgICAgICAgICAgICAgICAgICBmZXRjaGVyUmVzdWx0czogZmV0Y2hlclJlc3VsdHMKICAgICAgICAgICAgICAgICAgICAgIH0pO2Nhc2UgODpjYXNlICJlbmQiOnJldHVybiBfY29udGV4dDEwLnN0b3AoKTt9fSwgX2NhbGxlZTEwKTt9KSk7cmV0dXJuIF9jYWxsTG9hZGVyc0FuZE1heWJlUmVzb2x2ZURhdGEuYXBwbHkodGhpcywgYXJndW1lbnRzKTt9CgoKICAgICAgICAgICAgZnVuY3Rpb24gaW50ZXJydXB0QWN0aXZlTG9hZHMoKSB7dmFyIF9jYW5jZWxsZWREZWZlcnJlZFJvdTsKICAgICAgICAgICAgICAvLyBFdmVyeSBpbnRlcnJ1cHRpb24gdHJpZ2dlcnMgYSByZXZhbGlkYXRpb24KICAgICAgICAgICAgICBpc1JldmFsaWRhdGlvblJlcXVpcmVkID0gdHJ1ZTsgLy8gQ2FuY2VsIHBlbmRpbmcgcm91dGUtbGV2ZWwgZGVmZXJyZWRzIGFuZCBtYXJrIGNhbmNlbGxlZCByb3V0ZXMgZm9yCiAgICAgICAgICAgICAgLy8gcmV2YWxpZGF0aW9uCgogICAgICAgICAgICAgIChfY2FuY2VsbGVkRGVmZXJyZWRSb3UgPSBjYW5jZWxsZWREZWZlcnJlZFJvdXRlcykucHVzaC5hcHBseShfY2FuY2VsbGVkRGVmZXJyZWRSb3UsIF90b0NvbnN1bWFibGVBcnJheTIoY2FuY2VsQWN0aXZlRGVmZXJyZWRzKCkpKTsgLy8gQWJvcnQgaW4tZmxpZ2h0IGZldGNoZXIgbG9hZHMKCiAgICAgICAgICAgICAgZmV0Y2hMb2FkTWF0Y2hlcy5mb3JFYWNoKChfLCBrZXkpID0+IHsKICAgICAgICAgICAgICAgIGlmIChmZXRjaENvbnRyb2xsZXJzLmhhcyhrZXkpKSB7CiAgICAgICAgICAgICAgICAgIGNhbmNlbGxlZEZldGNoZXJMb2Fkcy5wdXNoKGtleSk7CiAgICAgICAgICAgICAgICAgIGFib3J0RmV0Y2hlcihrZXkpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CgogICAgICAgICAgICBmdW5jdGlvbiBzZXRGZXRjaGVyRXJyb3Ioa2V5LCByb3V0ZUlkLCBlcnJvcikgewogICAgICAgICAgICAgIHZhciBib3VuZGFyeU1hdGNoID0gZmluZE5lYXJlc3RCb3VuZGFyeShzdGF0ZS5tYXRjaGVzLCByb3V0ZUlkKTsKICAgICAgICAgICAgICBkZWxldGVGZXRjaGVyKGtleSk7CiAgICAgICAgICAgICAgdXBkYXRlU3RhdGUoewogICAgICAgICAgICAgICAgZXJyb3JzOiBfZGVmaW5lUHJvcGVydHkyKHt9LAogICAgICAgICAgICAgICAgYm91bmRhcnlNYXRjaC5yb3V0ZS5pZCwgZXJyb3IpLAoKICAgICAgICAgICAgICAgIGZldGNoZXJzOiBuZXcgTWFwKHN0YXRlLmZldGNoZXJzKQogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CgogICAgICAgICAgICBmdW5jdGlvbiBkZWxldGVGZXRjaGVyKGtleSkgewogICAgICAgICAgICAgIGlmIChmZXRjaENvbnRyb2xsZXJzLmhhcyhrZXkpKSBhYm9ydEZldGNoZXIoa2V5KTsKICAgICAgICAgICAgICBmZXRjaExvYWRNYXRjaGVzLmRlbGV0ZShrZXkpOwogICAgICAgICAgICAgIGZldGNoUmVsb2FkSWRzLmRlbGV0ZShrZXkpOwogICAgICAgICAgICAgIGZldGNoUmVkaXJlY3RJZHMuZGVsZXRlKGtleSk7CiAgICAgICAgICAgICAgc3RhdGUuZmV0Y2hlcnMuZGVsZXRlKGtleSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGZ1bmN0aW9uIGFib3J0RmV0Y2hlcihrZXkpIHsKICAgICAgICAgICAgICB2YXIgY29udHJvbGxlciA9IGZldGNoQ29udHJvbGxlcnMuZ2V0KGtleSk7CiAgICAgICAgICAgICAgcm91dGVyX2ludmFyaWFudChjb250cm9sbGVyLCAiRXhwZWN0ZWQgZmV0Y2ggY29udHJvbGxlcjogIiArIGtleSk7CiAgICAgICAgICAgICAgY29udHJvbGxlci5hYm9ydCgpOwogICAgICAgICAgICAgIGZldGNoQ29udHJvbGxlcnMuZGVsZXRlKGtleSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGZ1bmN0aW9uIG1hcmtGZXRjaGVyc0RvbmUoa2V5cykge3ZhciBfaXRlcmF0b3I1ID0gX2NyZWF0ZUZvck9mSXRlcmF0b3JIZWxwZXIyKAogICAgICAgICAgICAgICAga2V5cyksX3N0ZXA1O3RyeSB7Zm9yIChfaXRlcmF0b3I1LnMoKTsgIShfc3RlcDUgPSBfaXRlcmF0b3I1Lm4oKSkuZG9uZTspIHt2YXIga2V5ID0gX3N0ZXA1LnZhbHVlOwogICAgICAgICAgICAgICAgICB2YXIgZmV0Y2hlciA9IGdldEZldGNoZXIoa2V5KTsKICAgICAgICAgICAgICAgICAgdmFyIGRvbmVGZXRjaGVyID0gewogICAgICAgICAgICAgICAgICAgIHN0YXRlOiAiaWRsZSIsCiAgICAgICAgICAgICAgICAgICAgZGF0YTogZmV0Y2hlci5kYXRhLAogICAgICAgICAgICAgICAgICAgIGZvcm1NZXRob2Q6IHVuZGVmaW5lZCwKICAgICAgICAgICAgICAgICAgICBmb3JtQWN0aW9uOiB1bmRlZmluZWQsCiAgICAgICAgICAgICAgICAgICAgZm9ybUVuY1R5cGU6IHVuZGVmaW5lZCwKICAgICAgICAgICAgICAgICAgICBmb3JtRGF0YTogdW5kZWZpbmVkLAogICAgICAgICAgICAgICAgICAgICIgX2hhc0ZldGNoZXJEb25lQW55dGhpbmcgIjogdHJ1ZQogICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgICBzdGF0ZS5mZXRjaGVycy5zZXQoa2V5LCBkb25lRmV0Y2hlcik7CiAgICAgICAgICAgICAgICB9fSBjYXRjaCAoZXJyKSB7X2l0ZXJhdG9yNS5lKGVycik7fSBmaW5hbGx5IHtfaXRlcmF0b3I1LmYoKTt9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGZ1bmN0aW9uIG1hcmtGZXRjaFJlZGlyZWN0c0RvbmUoKSB7CiAgICAgICAgICAgICAgdmFyIGRvbmVLZXlzID0gW107dmFyIF9pdGVyYXRvcjYgPSBfY3JlYXRlRm9yT2ZJdGVyYXRvckhlbHBlcjIoCgogICAgICAgICAgICAgICAgZmV0Y2hSZWRpcmVjdElkcyksX3N0ZXA2O3RyeSB7Zm9yIChfaXRlcmF0b3I2LnMoKTsgIShfc3RlcDYgPSBfaXRlcmF0b3I2Lm4oKSkuZG9uZTspIHt2YXIga2V5ID0gX3N0ZXA2LnZhbHVlOwogICAgICAgICAgICAgICAgICB2YXIgZmV0Y2hlciA9IHN0YXRlLmZldGNoZXJzLmdldChrZXkpOwogICAgICAgICAgICAgICAgICByb3V0ZXJfaW52YXJpYW50KGZldGNoZXIsICJFeHBlY3RlZCBmZXRjaGVyOiAiICsga2V5KTsKCiAgICAgICAgICAgICAgICAgIGlmIChmZXRjaGVyLnN0YXRlID09PSAibG9hZGluZyIpIHsKICAgICAgICAgICAgICAgICAgICBmZXRjaFJlZGlyZWN0SWRzLmRlbGV0ZShrZXkpOwogICAgICAgICAgICAgICAgICAgIGRvbmVLZXlzLnB1c2goa2V5KTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfX0gY2F0Y2ggKGVycikge19pdGVyYXRvcjYuZShlcnIpO30gZmluYWxseSB7X2l0ZXJhdG9yNi5mKCk7fQoKICAgICAgICAgICAgICBtYXJrRmV0Y2hlcnNEb25lKGRvbmVLZXlzKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgZnVuY3Rpb24gYWJvcnRTdGFsZUZldGNoTG9hZHMobGFuZGVkSWQpIHsKICAgICAgICAgICAgICB2YXIgeWVldGVkS2V5cyA9IFtdO3ZhciBfaXRlcmF0b3I3ID0gX2NyZWF0ZUZvck9mSXRlcmF0b3JIZWxwZXIyKAoKICAgICAgICAgICAgICAgIGZldGNoUmVsb2FkSWRzKSxfc3RlcDc7dHJ5IHtmb3IgKF9pdGVyYXRvcjcucygpOyAhKF9zdGVwNyA9IF9pdGVyYXRvcjcubigpKS5kb25lOykge3ZhciBfc3RlcDckdmFsdWUgPSBfc2xpY2VkVG9BcnJheTIoX3N0ZXA3LnZhbHVlLCAyKSxrZXkgPSBfc3RlcDckdmFsdWVbMF0saWQgPSBfc3RlcDckdmFsdWVbMV07CiAgICAgICAgICAgICAgICAgIGlmIChpZCA8IGxhbmRlZElkKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIGZldGNoZXIgPSBzdGF0ZS5mZXRjaGVycy5nZXQoa2V5KTsKICAgICAgICAgICAgICAgICAgICByb3V0ZXJfaW52YXJpYW50KGZldGNoZXIsICJFeHBlY3RlZCBmZXRjaGVyOiAiICsga2V5KTsKCiAgICAgICAgICAgICAgICAgICAgaWYgKGZldGNoZXIuc3RhdGUgPT09ICJsb2FkaW5nIikgewogICAgICAgICAgICAgICAgICAgICAgYWJvcnRGZXRjaGVyKGtleSk7CiAgICAgICAgICAgICAgICAgICAgICBmZXRjaFJlbG9hZElkcy5kZWxldGUoa2V5KTsKICAgICAgICAgICAgICAgICAgICAgIHllZXRlZEtleXMucHVzaChrZXkpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfX0gY2F0Y2ggKGVycikge19pdGVyYXRvcjcuZShlcnIpO30gZmluYWxseSB7X2l0ZXJhdG9yNy5mKCk7fQoKICAgICAgICAgICAgICBtYXJrRmV0Y2hlcnNEb25lKHllZXRlZEtleXMpOwogICAgICAgICAgICAgIHJldHVybiB5ZWV0ZWRLZXlzLmxlbmd0aCA+IDA7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGZ1bmN0aW9uIGdldEJsb2NrZXIoa2V5LCBmbikgewogICAgICAgICAgICAgIHZhciBibG9ja2VyID0gc3RhdGUuYmxvY2tlcnMuZ2V0KGtleSkgfHwgSURMRV9CTE9DS0VSOwoKICAgICAgICAgICAgICBpZiAoYmxvY2tlckZ1bmN0aW9ucy5nZXQoa2V5KSAhPT0gZm4pIHsKICAgICAgICAgICAgICAgIGJsb2NrZXJGdW5jdGlvbnMuc2V0KGtleSwgZm4pOwoKICAgICAgICAgICAgICAgIGlmIChhY3RpdmVCbG9ja2VyID09IG51bGwpIHsKICAgICAgICAgICAgICAgICAgLy8gVGhpcyBpcyBub3cgdGhlIGFjdGl2ZSBibG9ja2VyCiAgICAgICAgICAgICAgICAgIGFjdGl2ZUJsb2NrZXIgPSBrZXk7CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGtleSAhPT0gYWN0aXZlQmxvY2tlcikgewogICAgICAgICAgICAgICAgICB3YXJuaW5nKGZhbHNlLCAiQSByb3V0ZXIgb25seSBzdXBwb3J0cyBvbmUgYmxvY2tlciBhdCBhIHRpbWUiKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIHJldHVybiBibG9ja2VyOwogICAgICAgICAgICB9CgogICAgICAgICAgICBmdW5jdGlvbiBkZWxldGVCbG9ja2VyKGtleSkgewogICAgICAgICAgICAgIHN0YXRlLmJsb2NrZXJzLmRlbGV0ZShrZXkpOwogICAgICAgICAgICAgIGJsb2NrZXJGdW5jdGlvbnMuZGVsZXRlKGtleSk7CgogICAgICAgICAgICAgIGlmIChhY3RpdmVCbG9ja2VyID09PSBrZXkpIHsKICAgICAgICAgICAgICAgIGFjdGl2ZUJsb2NrZXIgPSBudWxsOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSAvLyBVdGlsaXR5IGZ1bmN0aW9uIHRvIHVwZGF0ZSBibG9ja2VycywgZW5zdXJpbmcgdmFsaWQgc3RhdGUgdHJhbnNpdGlvbnMKCgogICAgICAgICAgICBmdW5jdGlvbiB1cGRhdGVCbG9ja2VyKGtleSwgbmV3QmxvY2tlcikgewogICAgICAgICAgICAgIHZhciBibG9ja2VyID0gc3RhdGUuYmxvY2tlcnMuZ2V0KGtleSkgfHwgSURMRV9CTE9DS0VSOyAvLyBQb29yIG1hbnMgc3RhdGUgbWFjaGluZSA6KQogICAgICAgICAgICAgIC8vIGh0dHBzOi8vbWVybWFpZC5saXZlL2VkaXQjcGFrbzplTnFWa2M5T3d6QU14bDhsOG5uakFZckV0RElPSEVCSWd3dktKVFJlR3kzX2xEcElxTzI3azZhd01HMFhjckxsbno4N253ZG9uRVNvZ0tYWEJ1RTc5cnE3NVhaTzMteUhkczBSSlZ1djcwWXJQbFVyQ0VlMkhmck9SUzNydWJxWmZ1aHRwZzVDOXdrNXRaNFZLY1JVcTg4cTlaOFJTMC00OGNFMWlISmtMMHVnYkh1Rkx1czlMNnNwWnk4blg5TVAyQ05kb21WYXBvc3F1M2ZHYXlUOFQ4LWpKUXdoZXBvX1V0cGdCUWFERVVvbTA0ZFpoQU4xYUpCRGxVS0pCeEUxY2VCMlNtajBNbG4tSUJXNUFGVTJkd1Vpa3R0XzJRYXEyZEJmYUtkRXVwODVVVjdZZC1kS2psbmthYmwyUHZyMERUa1RyZU0KCiAgICAgICAgICAgICAgcm91dGVyX2ludmFyaWFudChibG9ja2VyLnN0YXRlID09PSAidW5ibG9ja2VkIiAmJiBuZXdCbG9ja2VyLnN0YXRlID09PSAiYmxvY2tlZCIgfHwgYmxvY2tlci5zdGF0ZSA9PT0gImJsb2NrZWQiICYmIG5ld0Jsb2NrZXIuc3RhdGUgPT09ICJibG9ja2VkIiB8fCBibG9ja2VyLnN0YXRlID09PSAiYmxvY2tlZCIgJiYgbmV3QmxvY2tlci5zdGF0ZSA9PT0gInByb2NlZWRpbmciIHx8IGJsb2NrZXIuc3RhdGUgPT09ICJibG9ja2VkIiAmJiBuZXdCbG9ja2VyLnN0YXRlID09PSAidW5ibG9ja2VkIiB8fCBibG9ja2VyLnN0YXRlID09PSAicHJvY2VlZGluZyIgJiYgbmV3QmxvY2tlci5zdGF0ZSA9PT0gInVuYmxvY2tlZCIsICJJbnZhbGlkIGJsb2NrZXIgc3RhdGUgdHJhbnNpdGlvbjogIiArIGJsb2NrZXIuc3RhdGUgKyAiIC0+ICIgKyBuZXdCbG9ja2VyLnN0YXRlKTsKICAgICAgICAgICAgICBzdGF0ZS5ibG9ja2Vycy5zZXQoa2V5LCBuZXdCbG9ja2VyKTsKICAgICAgICAgICAgICB1cGRhdGVTdGF0ZSh7CiAgICAgICAgICAgICAgICBibG9ja2VyczogbmV3IE1hcChzdGF0ZS5ibG9ja2VycykKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgZnVuY3Rpb24gc2hvdWxkQmxvY2tOYXZpZ2F0aW9uKF9yZWYxMCkgewogICAgICAgICAgICAgIHZhcgogICAgICAgICAgICAgICAgY3VycmVudExvY2F0aW9uID0KCgogICAgICAgICAgICAgICAgX3JlZjEwLmN1cnJlbnRMb2NhdGlvbixuZXh0TG9jYXRpb24gPSBfcmVmMTAubmV4dExvY2F0aW9uLGhpc3RvcnlBY3Rpb24gPSBfcmVmMTAuaGlzdG9yeUFjdGlvbjsKCiAgICAgICAgICAgICAgaWYgKGFjdGl2ZUJsb2NrZXIgPT0gbnVsbCkgewogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgIH0gLy8gV2Ugb25seSBhbGxvdyBhIHNpbmdsZSBibG9ja2VyIGF0IHRoZSBtb21lbnQuICBUaGlzIHdpbGwgbmVlZCB0byBiZQogICAgICAgICAgICAgIC8vIHVwZGF0ZWQgaWYgd2UgZW5oYW5jZSB0byBzdXBwb3J0IG11bHRpcGxlIGJsb2NrZXJzIGluIHRoZSBmdXR1cmUKCgogICAgICAgICAgICAgIHZhciBibG9ja2VyRnVuY3Rpb24gPSBibG9ja2VyRnVuY3Rpb25zLmdldChhY3RpdmVCbG9ja2VyKTsKICAgICAgICAgICAgICByb3V0ZXJfaW52YXJpYW50KGJsb2NrZXJGdW5jdGlvbiwgIkNvdWxkIG5vdCBmaW5kIGEgZnVuY3Rpb24gZm9yIHRoZSBhY3RpdmUgYmxvY2tlciIpOwogICAgICAgICAgICAgIHZhciBibG9ja2VyID0gc3RhdGUuYmxvY2tlcnMuZ2V0KGFjdGl2ZUJsb2NrZXIpOwoKICAgICAgICAgICAgICBpZiAoYmxvY2tlciAmJiBibG9ja2VyLnN0YXRlID09PSAicHJvY2VlZGluZyIpIHsKICAgICAgICAgICAgICAgIC8vIElmIHRoZSBibG9ja2VyIGlzIGN1cnJlbnRseSBwcm9jZWVkaW5nLCB3ZSBkb24ndCBuZWVkIHRvIHJlLWNoZWNrCiAgICAgICAgICAgICAgICAvLyBpdCBhbmQgY2FuIGxldCB0aGlzIG5hdmlnYXRpb24gY29udGludWUKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICB9IC8vIEF0IHRoaXMgcG9pbnQsIHdlIGtub3cgd2UncmUgdW5ibG9ja2VkL2Jsb2NrZWQgc28gd2UgbmVlZCB0byBjaGVjayB0aGUKICAgICAgICAgICAgICAvLyB1c2VyLXByb3ZpZGVkIGJsb2NrZXIgZnVuY3Rpb24KCgogICAgICAgICAgICAgIGlmIChibG9ja2VyRnVuY3Rpb24oewogICAgICAgICAgICAgICAgY3VycmVudExvY2F0aW9uOiBjdXJyZW50TG9jYXRpb24sCiAgICAgICAgICAgICAgICBuZXh0TG9jYXRpb246IG5leHRMb2NhdGlvbiwKICAgICAgICAgICAgICAgIGhpc3RvcnlBY3Rpb246IGhpc3RvcnlBY3Rpb24KICAgICAgICAgICAgICB9KSkgewogICAgICAgICAgICAgICAgcmV0dXJuIGFjdGl2ZUJsb2NrZXI7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICBmdW5jdGlvbiBjYW5jZWxBY3RpdmVEZWZlcnJlZHMocHJlZGljYXRlKSB7CiAgICAgICAgICAgICAgdmFyIGNhbmNlbGxlZFJvdXRlSWRzID0gW107CiAgICAgICAgICAgICAgYWN0aXZlRGVmZXJyZWRzLmZvckVhY2goKGRmZCwgcm91dGVJZCkgPT4gewogICAgICAgICAgICAgICAgaWYgKCFwcmVkaWNhdGUgfHwgcHJlZGljYXRlKHJvdXRlSWQpKSB7CiAgICAgICAgICAgICAgICAgIC8vIENhbmNlbCB0aGUgZGVmZXJyZWQgLSBidXQgZG8gbm90IHJlbW92ZSBmcm9tIGFjdGl2ZURlZmVycmVkcyBoZXJlIC0KICAgICAgICAgICAgICAgICAgLy8gd2UgcmVseSBvbiB0aGUgc3Vic2NyaWJlcnMgdG8gZG8gdGhhdCBzbyBvdXIgdGVzdHMgY2FuIGFzc2VydCBwcm9wZXIKICAgICAgICAgICAgICAgICAgLy8gY2xlYW51cCB2aWEgX2ludGVybmFsQWN0aXZlRGVmZXJyZWRzCiAgICAgICAgICAgICAgICAgIGRmZC5jYW5jZWwoKTsKICAgICAgICAgICAgICAgICAgY2FuY2VsbGVkUm91dGVJZHMucHVzaChyb3V0ZUlkKTsKICAgICAgICAgICAgICAgICAgYWN0aXZlRGVmZXJyZWRzLmRlbGV0ZShyb3V0ZUlkKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICByZXR1cm4gY2FuY2VsbGVkUm91dGVJZHM7CiAgICAgICAgICAgIH0gLy8gT3B0IGluIHRvIGNhcHR1cmluZyBhbmQgcmVwb3J0aW5nIHNjcm9sbCBwb3NpdGlvbnMgZHVyaW5nIG5hdmlnYXRpb25zLAogICAgICAgICAgICAvLyB1c2VkIGJ5IHRoZSA8U2Nyb2xsUmVzdG9yYXRpb24+IGNvbXBvbmVudAoKCiAgICAgICAgICAgIGZ1bmN0aW9uIGVuYWJsZVNjcm9sbFJlc3RvcmF0aW9uKHBvc2l0aW9ucywgZ2V0UG9zaXRpb24sIGdldEtleSkgewogICAgICAgICAgICAgIHNhdmVkU2Nyb2xsUG9zaXRpb25zID0gcG9zaXRpb25zOwogICAgICAgICAgICAgIGdldFNjcm9sbFBvc2l0aW9uID0gZ2V0UG9zaXRpb247CgogICAgICAgICAgICAgIGdldFNjcm9sbFJlc3RvcmF0aW9uS2V5ID0gZ2V0S2V5IHx8ICgobG9jYXRpb24pID0+IGxvY2F0aW9uLmtleSk7IC8vIFBlcmZvcm0gaW5pdGlhbCBoeWRyYXRpb24gc2Nyb2xsIHJlc3RvcmF0aW9uLCBzaW5jZSB3ZSBtaXNzIHRoZSBib2F0IG9uCiAgICAgICAgICAgICAgLy8gdGhlIGluaXRpYWwgdXBkYXRlU3RhdGUoKSBiZWNhdXNlIHdlJ3ZlIG5vdCB5ZXQgcmVuZGVyZWQgPFNjcm9sbFJlc3RvcmF0aW9uLz4KICAgICAgICAgICAgICAvLyBhbmQgdGhlcmVmb3JlIGhhdmUgbm8gc2F2ZWRTY3JvbGxQb3NpdGlvbnMgYXZhaWxhYmxlCgoKICAgICAgICAgICAgICBpZiAoIWluaXRpYWxTY3JvbGxSZXN0b3JlZCAmJiBzdGF0ZS5uYXZpZ2F0aW9uID09PSBJRExFX05BVklHQVRJT04pIHsKICAgICAgICAgICAgICAgIGluaXRpYWxTY3JvbGxSZXN0b3JlZCA9IHRydWU7CiAgICAgICAgICAgICAgICB2YXIgeSA9IGdldFNhdmVkU2Nyb2xsUG9zaXRpb24oc3RhdGUubG9jYXRpb24sIHN0YXRlLm1hdGNoZXMpOwoKICAgICAgICAgICAgICAgIGlmICh5ICE9IG51bGwpIHsKICAgICAgICAgICAgICAgICAgdXBkYXRlU3RhdGUoewogICAgICAgICAgICAgICAgICAgIHJlc3RvcmVTY3JvbGxQb3NpdGlvbjogeQogICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIHJldHVybiAoKSA9PiB7CiAgICAgICAgICAgICAgICBzYXZlZFNjcm9sbFBvc2l0aW9ucyA9IG51bGw7CiAgICAgICAgICAgICAgICBnZXRTY3JvbGxQb3NpdGlvbiA9IG51bGw7CiAgICAgICAgICAgICAgICBnZXRTY3JvbGxSZXN0b3JhdGlvbktleSA9IG51bGw7CiAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgZnVuY3Rpb24gc2F2ZVNjcm9sbFBvc2l0aW9uKGxvY2F0aW9uLCBtYXRjaGVzKSB7CiAgICAgICAgICAgICAgaWYgKHNhdmVkU2Nyb2xsUG9zaXRpb25zICYmIGdldFNjcm9sbFJlc3RvcmF0aW9uS2V5ICYmIGdldFNjcm9sbFBvc2l0aW9uKSB7CiAgICAgICAgICAgICAgICB2YXIgdXNlck1hdGNoZXMgPSBtYXRjaGVzLm1hcCgobSkgPT4gY3JlYXRlVXNlTWF0Y2hlc01hdGNoKG0sIHN0YXRlLmxvYWRlckRhdGEpKTsKICAgICAgICAgICAgICAgIHZhciBrZXkgPSBnZXRTY3JvbGxSZXN0b3JhdGlvbktleShsb2NhdGlvbiwgdXNlck1hdGNoZXMpIHx8IGxvY2F0aW9uLmtleTsKICAgICAgICAgICAgICAgIHNhdmVkU2Nyb2xsUG9zaXRpb25zW2tleV0gPSBnZXRTY3JvbGxQb3NpdGlvbigpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgZnVuY3Rpb24gZ2V0U2F2ZWRTY3JvbGxQb3NpdGlvbihsb2NhdGlvbiwgbWF0Y2hlcykgewogICAgICAgICAgICAgIGlmIChzYXZlZFNjcm9sbFBvc2l0aW9ucyAmJiBnZXRTY3JvbGxSZXN0b3JhdGlvbktleSAmJiBnZXRTY3JvbGxQb3NpdGlvbikgewogICAgICAgICAgICAgICAgdmFyIHVzZXJNYXRjaGVzID0gbWF0Y2hlcy5tYXAoKG0pID0+IGNyZWF0ZVVzZU1hdGNoZXNNYXRjaChtLCBzdGF0ZS5sb2FkZXJEYXRhKSk7CiAgICAgICAgICAgICAgICB2YXIga2V5ID0gZ2V0U2Nyb2xsUmVzdG9yYXRpb25LZXkobG9jYXRpb24sIHVzZXJNYXRjaGVzKSB8fCBsb2NhdGlvbi5rZXk7CiAgICAgICAgICAgICAgICB2YXIgeSA9IHNhdmVkU2Nyb2xsUG9zaXRpb25zW2tleV07CgogICAgICAgICAgICAgICAgaWYgKHR5cGVvZiB5ID09PSAibnVtYmVyIikgewogICAgICAgICAgICAgICAgICByZXR1cm4geTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgICAgICB9CgogICAgICAgICAgICByb3V0ZXIgPSB7CiAgICAgICAgICAgICAgZ2V0IGJhc2VuYW1lKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIGluaXQuYmFzZW5hbWU7CiAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgZ2V0IHN0YXRlKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHN0YXRlOwogICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgIGdldCByb3V0ZXMoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gZGF0YVJvdXRlczsKICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICBpbml0aWFsaXplOiBpbml0aWFsaXplLAogICAgICAgICAgICAgIHN1YnNjcmliZTogc3Vic2NyaWJlLAogICAgICAgICAgICAgIGVuYWJsZVNjcm9sbFJlc3RvcmF0aW9uOiBlbmFibGVTY3JvbGxSZXN0b3JhdGlvbiwKICAgICAgICAgICAgICBuYXZpZ2F0ZTogbmF2aWdhdGUsCiAgICAgICAgICAgICAgZmV0Y2g6IGZldGNoLAogICAgICAgICAgICAgIHJldmFsaWRhdGU6IHJldmFsaWRhdGUsCiAgICAgICAgICAgICAgLy8gUGFzc3Rocm91Z2ggdG8gaGlzdG9yeS1hd2FyZSBjcmVhdGVIcmVmIHVzZWQgYnkgdXNlSHJlZiBzbyB3ZSBnZXQgcHJvcGVyCiAgICAgICAgICAgICAgLy8gaGFzaC1hd2FyZSBVUkxzIGluIERPTSBwYXRocwogICAgICAgICAgICAgIGNyZWF0ZUhyZWY6ICh0bykgPT4gaW5pdC5oaXN0b3J5LmNyZWF0ZUhyZWYodG8pLAogICAgICAgICAgICAgIGVuY29kZUxvY2F0aW9uOiAodG8pID0+IGluaXQuaGlzdG9yeS5lbmNvZGVMb2NhdGlvbih0byksCiAgICAgICAgICAgICAgZ2V0RmV0Y2hlcjogZ2V0RmV0Y2hlciwKICAgICAgICAgICAgICBkZWxldGVGZXRjaGVyOiBkZWxldGVGZXRjaGVyLAogICAgICAgICAgICAgIGRpc3Bvc2U6IGRpc3Bvc2UsCiAgICAgICAgICAgICAgZ2V0QmxvY2tlcjogZ2V0QmxvY2tlciwKICAgICAgICAgICAgICBkZWxldGVCbG9ja2VyOiBkZWxldGVCbG9ja2VyLAogICAgICAgICAgICAgIF9pbnRlcm5hbEZldGNoQ29udHJvbGxlcnM6IGZldGNoQ29udHJvbGxlcnMsCiAgICAgICAgICAgICAgX2ludGVybmFsQWN0aXZlRGVmZXJyZWRzOiBhY3RpdmVEZWZlcnJlZHMKICAgICAgICAgICAgfTsKICAgICAgICAgICAgcmV0dXJuIHJvdXRlcjsKICAgICAgICAgIH0gLy8jZW5kcmVnaW9uCiAgICAgICAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwogICAgICAgICAgLy8jcmVnaW9uIGNyZWF0ZVN0YXRpY0hhbmRsZXIKICAgICAgICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCgogICAgICAgICAgdmFyIFVOU0FGRV9ERUZFUlJFRF9TWU1CT0wgPSBTeW1ib2woImRlZmVycmVkIik7CiAgICAgICAgICBmdW5jdGlvbiBjcmVhdGVTdGF0aWNIYW5kbGVyKHJvdXRlcywgb3B0cykgewogICAgICAgICAgICByb3V0ZXJfaW52YXJpYW50KHJvdXRlcy5sZW5ndGggPiAwLCAiWW91IG11c3QgcHJvdmlkZSBhIG5vbi1lbXB0eSByb3V0ZXMgYXJyYXkgdG8gY3JlYXRlU3RhdGljSGFuZGxlciIpOwogICAgICAgICAgICB2YXIgZGF0YVJvdXRlcyA9IGNvbnZlcnRSb3V0ZXNUb0RhdGFSb3V0ZXMocm91dGVzKTsKICAgICAgICAgICAgdmFyIGJhc2VuYW1lID0gKG9wdHMgPyBvcHRzLmJhc2VuYW1lIDogbnVsbCkgfHwgIi8iOwogICAgICAgICAgICAvKioKICAgICAgICAgICAgICogVGhlIHF1ZXJ5KCkgbWV0aG9kIGlzIGludGVuZGVkIGZvciBkb2N1bWVudCByZXF1ZXN0cywgaW4gd2hpY2ggd2Ugd2FudCB0bwogICAgICAgICAgICAgKiBjYWxsIGFuIG9wdGlvbmFsIGFjdGlvbiBhbmQgcG90ZW50aWFsbHkgbXVsdGlwbGUgbG9hZGVycyBmb3IgYWxsIG5lc3RlZAogICAgICAgICAgICAgKiByb3V0ZXMuICBJdCByZXR1cm5zIGEgU3RhdGljSGFuZGxlckNvbnRleHQgb2JqZWN0LCB3aGljaCBpcyB2ZXJ5IHNpbWlsYXIKICAgICAgICAgICAgICogdG8gdGhlIHJvdXRlciBzdGF0ZSAobG9jYXRpb24sIGxvYWRlckRhdGEsIGFjdGlvbkRhdGEsIGVycm9ycywgZXRjLikgYW5kCiAgICAgICAgICAgICAqIGFsc28gYWRkcyBTU1Itc3BlY2lmaWMgaW5mb3JtYXRpb24gc3VjaCBhcyB0aGUgc3RhdHVzQ29kZSBhbmQgaGVhZGVycwogICAgICAgICAgICAgKiBmcm9tIGFjdGlvbi9sb2FkZXJzIFJlc3BvbnNlcy4KICAgICAgICAgICAgICoKICAgICAgICAgICAgICogSXQgX3Nob3VsZF8gbmV2ZXIgdGhyb3cgYW5kIHNob3VsZCByZXBvcnQgYWxsIGVycm9ycyB0aHJvdWdoIHRoZQogICAgICAgICAgICAgKiByZXR1cm5lZCBjb250ZXh0LmVycm9ycyBvYmplY3QsIHByb3Blcmx5IGFzc29jaWF0aW5nIGVycm9ycyB0byB0aGVpciBlcnJvcgogICAgICAgICAgICAgKiBib3VuZGFyeS4gIEFkZGl0aW9uYWxseSwgaXQgdHJhY2tzIF9kZWVwZXN0UmVuZGVyZWRCb3VuZGFyeUlkIHdoaWNoIGNhbiBiZQogICAgICAgICAgICAgKiB1c2VkIHRvIGVtdWxhdGUgUmVhY3QgZXJyb3IgYm91bmRhcmllcyBkdXJpbmcgU1NyIGJ5IHBlcmZvcm1pbmcgYSBzZWNvbmQKICAgICAgICAgICAgICogcGFzcyBvbmx5IGRvd24gdG8gdGhlIGJvdW5kYXJ5SWQuCiAgICAgICAgICAgICAqCiAgICAgICAgICAgICAqIFRoZSBvbmUgZXhjZXB0aW9uIHdoZXJlIHdlIGRvIG5vdCByZXR1cm4gYSBTdGF0aWNIYW5kbGVyQ29udGV4dCBpcyB3aGVuIGEKICAgICAgICAgICAgICogcmVkaXJlY3QgcmVzcG9uc2UgaXMgcmV0dXJuZWQgb3IgdGhyb3duIGZyb20gYW55IGFjdGlvbi9sb2FkZXIuICBXZQogICAgICAgICAgICAgKiBwcm9wYWdhdGUgdGhhdCBvdXQgYW5kIHJldHVybiB0aGUgcmF3IFJlc3BvbnNlIHNvIHRoZSBIVFRQIHNlcnZlciBjYW4KICAgICAgICAgICAgICogcmV0dXJuIGl0IGRpcmVjdGx5LgogICAgICAgICAgICAgKi9mdW5jdGlvbgoKICAgICAgICAgICAgcXVlcnkoX3g0MiwgX3g0Mykge3JldHVybiBfcXVlcnkuYXBwbHkodGhpcywgYXJndW1lbnRzKTt9CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKICAgICAgICAgICAgLyoqCiAgICAgICAgICAgICAqIFRoZSBxdWVyeVJvdXRlKCkgbWV0aG9kIGlzIGludGVuZGVkIGZvciB0YXJnZXRlZCByb3V0ZSByZXF1ZXN0cywgZWl0aGVyCiAgICAgICAgICAgICAqIGZvciBmZXRjaCA/X2RhdGEgcmVxdWVzdHMgb3IgcmVzb3VyY2Ugcm91dGUgcmVxdWVzdHMuICBJbiB0aGlzIGNhc2UsIHdlCiAgICAgICAgICAgICAqIGFyZSBvbmx5IGV2ZXIgY2FsbGluZyBhIHNpbmdsZSBhY3Rpb24gb3IgbG9hZGVyLCBhbmQgd2UgYXJlIHJldHVybmluZyB0aGUKICAgICAgICAgICAgICogcmV0dXJuZWQgdmFsdWUgZGlyZWN0bHkuICBJbiBtb3N0IGNhc2VzLCB0aGlzIHdpbGwgYmUgYSBSZXNwb25zZSByZXR1cm5lZAogICAgICAgICAgICAgKiBmcm9tIHRoZSBhY3Rpb24vbG9hZGVyLCBidXQgaXQgbWF5IGJlIGEgcHJpbWl0aXZlIG9yIG90aGVyIHZhbHVlIGFzIHdlbGwgLQogICAgICAgICAgICAgKiBhbmQgaW4gc3VjaCBjYXNlcyB0aGUgY2FsbGluZyBjb250ZXh0IHNob3VsZCBoYW5kbGUgdGhhdCBhY2NvcmRpbmdseS4KICAgICAgICAgICAgICoKICAgICAgICAgICAgICogV2UgZG8gcmVzcGVjdCB0aGUgdGhyb3cvcmV0dXJuIGRpZmZlcmVudGlhdGlvbiwgc28gaWYgYW4gYWN0aW9uL2xvYWRlcgogICAgICAgICAgICAgKiB0aHJvd3MsIHRoZW4gdGhpcyBtZXRob2Qgd2lsbCB0aHJvdyB0aGUgdmFsdWUuICBUaGlzIGlzIGltcG9ydGFudCBzbyB3ZQogICAgICAgICAgICAgKiBjYW4gZG8gcHJvcGVyIGJvdW5kYXJ5IGlkZW50aWZpY2F0aW9uIGluIFJlbWl4IHdoZXJlIGEgdGhyb3duIFJlc3BvbnNlCiAgICAgICAgICAgICAqIG11c3QgZ28gdG8gdGhlIENhdGNoIEJvdW5kYXJ5IGJ1dCBhIHJldHVybmVkIFJlc3BvbnNlIGlzIGhhcHB5LXBhdGguCiAgICAgICAgICAgICAqCiAgICAgICAgICAgICAqIE9uZSB0aGluZyB0byBub3RlIGlzIHRoYXQgYW55IFJvdXRlci1pbml0aWF0ZWQgRXJyb3JzIHRoYXQgbWFrZSBzZW5zZQogICAgICAgICAgICAgKiB0byBhc3NvY2lhdGUgd2l0aCBhIHN0YXR1cyBjb2RlIHdpbGwgYmUgdGhyb3duIGFzIGFuIEVycm9yUmVzcG9uc2UKICAgICAgICAgICAgICogaW5zdGFuY2Ugd2hpY2ggaW5jbHVkZSB0aGUgcmF3IEVycm9yLCBzdWNoIHRoYXQgdGhlIGNhbGxpbmcgY29udGV4dCBjYW4KICAgICAgICAgICAgICogc2VyaWFsaXplIHRoZSBlcnJvciBhcyB0aGV5IHNlZSBmaXQgd2hpbGUgaW5jbHVkaW5nIHRoZSBwcm9wZXIgcmVzcG9uc2UKICAgICAgICAgICAgICogY29kZS4gIEV4YW1wbGVzIGhlcmUgYXJlIDQwNCBhbmQgNDA1IGVycm9ycyB0aGF0IG9jY3VyIHByaW9yIHRvIHJlYWNoaW5nCiAgICAgICAgICAgICAqIGFueSB1c2VyLWRlZmluZWQgbG9hZGVycy4KICAgICAgICAgICAgICovZnVuY3Rpb24gX3F1ZXJ5KCkge19xdWVyeSA9IF9hc3luY1RvR2VuZXJhdG9yMiggLyojX19QVVJFX18qL19yZWdlbmVyYXRvclJ1bnRpbWUyKCkubWFyayhmdW5jdGlvbiBfY2FsbGVlMTEocmVxdWVzdCwgX3RlbXAyKSB7dmFyIF9yZWYyNCwgcmVxdWVzdENvbnRleHQsIHVybCwgbWV0aG9kLCBsb2NhdGlvbiwgbWF0Y2hlcywgZXJyb3IsIF9nZXRTaG9ydENpcmN1aXRNYXRjaDMsIG1ldGhvZE5vdEFsbG93ZWRNYXRjaGVzLCByb3V0ZSwgX2Vycm9yMywgX2dldFNob3J0Q2lyY3VpdE1hdGNoNCwgbm90Rm91bmRNYXRjaGVzLCBfcm91dGUyLCByZXN1bHQ7cmV0dXJuIF9yZWdlbmVyYXRvclJ1bnRpbWUyKCkud3JhcChmdW5jdGlvbiBfY2FsbGVlMTEkKF9jb250ZXh0MTEpIHt3aGlsZSAoMSkgc3dpdGNoIChfY29udGV4dDExLnByZXYgPSBfY29udGV4dDExLm5leHQpIHtjYXNlIDA6X3JlZjI0ID0gX3RlbXAyID09PSB2b2lkIDAgPyB7fSA6IF90ZW1wMiwgcmVxdWVzdENvbnRleHQgPSBfcmVmMjQucmVxdWVzdENvbnRleHQ7dXJsID0gbmV3IFVSTChyZXF1ZXN0LnVybCk7bWV0aG9kID0gcmVxdWVzdC5tZXRob2QudG9Mb3dlckNhc2UoKTtsb2NhdGlvbiA9IGNyZWF0ZUxvY2F0aW9uKCIiLCByb3V0ZXJfY3JlYXRlUGF0aCh1cmwpLCBudWxsLCAiZGVmYXVsdCIpO21hdGNoZXMgPSBtYXRjaFJvdXRlcyhkYXRhUm91dGVzLCBsb2NhdGlvbiwgYmFzZW5hbWUpOyAvLyBTU1Igc3VwcG9ydHMgSEVBRCByZXF1ZXN0cyB3aGlsZSBTUEEgZG9lc24ndAogICAgICAgICAgICAgICAgICAgICAgaWYgKCEoIWlzVmFsaWRNZXRob2QobWV0aG9kKSAmJiBtZXRob2QgIT09ICJoZWFkIikpIHtfY29udGV4dDExLm5leHQgPSAxMTticmVhazt9ZXJyb3IgPSBnZXRJbnRlcm5hbFJvdXRlckVycm9yKDQwNSwgeyBtZXRob2Q6IG1ldGhvZCB9KTtfZ2V0U2hvcnRDaXJjdWl0TWF0Y2gzID0gZ2V0U2hvcnRDaXJjdWl0TWF0Y2hlcyhkYXRhUm91dGVzKSwgbWV0aG9kTm90QWxsb3dlZE1hdGNoZXMgPSBfZ2V0U2hvcnRDaXJjdWl0TWF0Y2gzLm1hdGNoZXMsIHJvdXRlID0gX2dldFNob3J0Q2lyY3VpdE1hdGNoMy5yb3V0ZTtyZXR1cm4gX2NvbnRleHQxMS5hYnJ1cHQoInJldHVybiIsIHsgYmFzZW5hbWU6IGJhc2VuYW1lLCBsb2NhdGlvbjogbG9jYXRpb24sIG1hdGNoZXM6IG1ldGhvZE5vdEFsbG93ZWRNYXRjaGVzLCBsb2FkZXJEYXRhOiB7fSwgYWN0aW9uRGF0YTogbnVsbCwgZXJyb3JzOiBfZGVmaW5lUHJvcGVydHkyKHt9LCByb3V0ZS5pZCwgZXJyb3IpLCBzdGF0dXNDb2RlOiBlcnJvci5zdGF0dXMsIGxvYWRlckhlYWRlcnM6IHt9LCBhY3Rpb25IZWFkZXJzOiB7fSwgYWN0aXZlRGVmZXJyZWRzOiBudWxsIH0pO2Nhc2UgMTE6aWYgKG1hdGNoZXMpIHtfY29udGV4dDExLm5leHQgPSAxNTticmVhazt9X2Vycm9yMyA9IGdldEludGVybmFsUm91dGVyRXJyb3IoNDA0LCB7IHBhdGhuYW1lOiBsb2NhdGlvbi5wYXRobmFtZSB9KTtfZ2V0U2hvcnRDaXJjdWl0TWF0Y2g0ID0gZ2V0U2hvcnRDaXJjdWl0TWF0Y2hlcyhkYXRhUm91dGVzKSwgbm90Rm91bmRNYXRjaGVzID0gX2dldFNob3J0Q2lyY3VpdE1hdGNoNC5tYXRjaGVzLCBfcm91dGUyID0gX2dldFNob3J0Q2lyY3VpdE1hdGNoNC5yb3V0ZTtyZXR1cm4gX2NvbnRleHQxMS5hYnJ1cHQoInJldHVybiIsIHsgYmFzZW5hbWU6IGJhc2VuYW1lLCBsb2NhdGlvbjogbG9jYXRpb24sIG1hdGNoZXM6IG5vdEZvdW5kTWF0Y2hlcywgbG9hZGVyRGF0YToge30sIGFjdGlvbkRhdGE6IG51bGwsIGVycm9yczogX2RlZmluZVByb3BlcnR5Mih7fSwgX3JvdXRlMi5pZCwgX2Vycm9yMyksIHN0YXR1c0NvZGU6IF9lcnJvcjMuc3RhdHVzLCBsb2FkZXJIZWFkZXJzOiB7fSwgYWN0aW9uSGVhZGVyczoge30sIGFjdGl2ZURlZmVycmVkczogbnVsbCB9KTtjYXNlIDE1Ol9jb250ZXh0MTEubmV4dCA9IDE3O3JldHVybiBxdWVyeUltcGwocmVxdWVzdCwgbG9jYXRpb24sIG1hdGNoZXMsIHJlcXVlc3RDb250ZXh0KTtjYXNlIDE3OnJlc3VsdCA9IF9jb250ZXh0MTEuc2VudDtpZiAoIWlzUmVzcG9uc2UocmVzdWx0KSkge19jb250ZXh0MTEubmV4dCA9IDIwO2JyZWFrO31yZXR1cm4gX2NvbnRleHQxMS5hYnJ1cHQoInJldHVybiIsIHJlc3VsdCk7Y2FzZSAyMDpyZXR1cm4gX2NvbnRleHQxMS5hYnJ1cHQoInJldHVybiIsIF9leHRlbmRzKHsgbG9jYXRpb246IGxvY2F0aW9uLCBiYXNlbmFtZTogYmFzZW5hbWUgfSwgcmVzdWx0KSk7Y2FzZSAyMTpjYXNlICJlbmQiOnJldHVybiBfY29udGV4dDExLnN0b3AoKTt9fSwgX2NhbGxlZTExKTt9KSk7cmV0dXJuIF9xdWVyeS5hcHBseSh0aGlzLCBhcmd1bWVudHMpO31mdW5jdGlvbgoKICAgICAgICAgICAgcXVlcnlSb3V0ZShfeDQ0LCBfeDQ1KSB7cmV0dXJuIF9xdWVyeVJvdXRlLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7fWZ1bmN0aW9uIF9xdWVyeVJvdXRlKCkge19xdWVyeVJvdXRlID0gX2FzeW5jVG9HZW5lcmF0b3IyKCAvKiNfX1BVUkVfXyovX3JlZ2VuZXJhdG9yUnVudGltZTIoKS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUxMihyZXF1ZXN0LCBfdGVtcDMpIHt2YXIgX3JlZjI1LCByb3V0ZUlkLCByZXF1ZXN0Q29udGV4dCwgdXJsLCBtZXRob2QsIGxvY2F0aW9uLCBtYXRjaGVzLCBtYXRjaCwgcmVzdWx0LCBlcnJvciwgX3Jlc3VsdCRhY3RpdmVEZWZlcnJlLCBkYXRhO3JldHVybiBfcmVnZW5lcmF0b3JSdW50aW1lMigpLndyYXAoZnVuY3Rpb24gX2NhbGxlZTEyJChfY29udGV4dDEyKSB7d2hpbGUgKDEpIHN3aXRjaCAoX2NvbnRleHQxMi5wcmV2ID0gX2NvbnRleHQxMi5uZXh0KSB7Y2FzZSAwOl9yZWYyNSA9CgoKCiAgICAgICAgICAgICAgICAgICAgICBfdGVtcDMgPT09IHZvaWQgMCA/IHt9IDogX3RlbXAzLCByb3V0ZUlkID0gX3JlZjI1LnJvdXRlSWQsIHJlcXVlc3RDb250ZXh0ID0gX3JlZjI1LnJlcXVlc3RDb250ZXh0OwogICAgICAgICAgICAgICAgICAgICAgdXJsID0gbmV3IFVSTChyZXF1ZXN0LnVybCk7CiAgICAgICAgICAgICAgICAgICAgICBtZXRob2QgPSByZXF1ZXN0Lm1ldGhvZC50b0xvd2VyQ2FzZSgpOwogICAgICAgICAgICAgICAgICAgICAgbG9jYXRpb24gPSBjcmVhdGVMb2NhdGlvbigiIiwgcm91dGVyX2NyZWF0ZVBhdGgodXJsKSwgbnVsbCwgImRlZmF1bHQiKTsKICAgICAgICAgICAgICAgICAgICAgIG1hdGNoZXMgPSBtYXRjaFJvdXRlcyhkYXRhUm91dGVzLCBsb2NhdGlvbiwgYmFzZW5hbWUpOyAvLyBTU1Igc3VwcG9ydHMgSEVBRCByZXF1ZXN0cyB3aGlsZSBTUEEgZG9lc24ndAogICAgICAgICAgICAgICAgICAgICAgaWYgKCEoCiAgICAgICAgICAgICAgICAgICAgICAhaXNWYWxpZE1ldGhvZChtZXRob2QpICYmIG1ldGhvZCAhPT0gImhlYWQiICYmIG1ldGhvZCAhPT0gIm9wdGlvbnMiKSkge19jb250ZXh0MTIubmV4dCA9IDk7YnJlYWs7fXRocm93ICgKICAgICAgICAgICAgICAgICAgICAgICAgZ2V0SW50ZXJuYWxSb3V0ZXJFcnJvcig0MDUsIHsKICAgICAgICAgICAgICAgICAgICAgICAgICBtZXRob2Q6IG1ldGhvZAogICAgICAgICAgICAgICAgICAgICAgICB9KSk7Y2FzZSA5OmlmICgKICAgICAgICAgICAgICAgICAgICAgIG1hdGNoZXMpIHtfY29udGV4dDEyLm5leHQgPSAxMTticmVhazt9dGhyb3cgKAogICAgICAgICAgICAgICAgICAgICAgICBnZXRJbnRlcm5hbFJvdXRlckVycm9yKDQwNCwgewogICAgICAgICAgICAgICAgICAgICAgICAgIHBhdGhuYW1lOiBsb2NhdGlvbi5wYXRobmFtZQogICAgICAgICAgICAgICAgICAgICAgICB9KSk7Y2FzZSAxMToKCgogICAgICAgICAgICAgICAgICAgICAgbWF0Y2ggPSByb3V0ZUlkID8gbWF0Y2hlcy5maW5kKChtKSA9PiBtLnJvdXRlLmlkID09PSByb3V0ZUlkKSA6IGdldFRhcmdldE1hdGNoKG1hdGNoZXMsIGxvY2F0aW9uKTtpZiAoISgKCiAgICAgICAgICAgICAgICAgICAgICByb3V0ZUlkICYmICFtYXRjaCkpIHtfY29udGV4dDEyLm5leHQgPSAxNjticmVhazt9dGhyb3cgKAogICAgICAgICAgICAgICAgICAgICAgICBnZXRJbnRlcm5hbFJvdXRlckVycm9yKDQwMywgewogICAgICAgICAgICAgICAgICAgICAgICAgIHBhdGhuYW1lOiBsb2NhdGlvbi5wYXRobmFtZSwKICAgICAgICAgICAgICAgICAgICAgICAgICByb3V0ZUlkOiByb3V0ZUlkCiAgICAgICAgICAgICAgICAgICAgICAgIH0pKTtjYXNlIDE2OmlmICgKICAgICAgICAgICAgICAgICAgICAgIG1hdGNoKSB7X2NvbnRleHQxMi5uZXh0ID0gMTg7YnJlYWs7fXRocm93ICgKCiAgICAgICAgICAgICAgICAgICAgICAgIGdldEludGVybmFsUm91dGVyRXJyb3IoNDA0LCB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgcGF0aG5hbWU6IGxvY2F0aW9uLnBhdGhuYW1lCiAgICAgICAgICAgICAgICAgICAgICAgIH0pKTtjYXNlIDE4Ol9jb250ZXh0MTIubmV4dCA9IDIwO3JldHVybiAoCgoKICAgICAgICAgICAgICAgICAgICAgICAgcXVlcnlJbXBsKHJlcXVlc3QsIGxvY2F0aW9uLCBtYXRjaGVzLCByZXF1ZXN0Q29udGV4dCwgbWF0Y2gpKTtjYXNlIDIwOnJlc3VsdCA9IF9jb250ZXh0MTIuc2VudDtpZiAoIQoKICAgICAgICAgICAgICAgICAgICAgIGlzUmVzcG9uc2UocmVzdWx0KSkge19jb250ZXh0MTIubmV4dCA9IDIzO2JyZWFrO31yZXR1cm4gX2NvbnRleHQxMi5hYnJ1cHQoInJldHVybiIsCiAgICAgICAgICAgICAgICAgICAgICByZXN1bHQpO2Nhc2UgMjM6CgoKICAgICAgICAgICAgICAgICAgICAgIGVycm9yID0gcmVzdWx0LmVycm9ycyA/IE9iamVjdC52YWx1ZXMocmVzdWx0LmVycm9ycylbMF0gOiB1bmRlZmluZWQ7aWYgKCEoCgogICAgICAgICAgICAgICAgICAgICAgZXJyb3IgIT09IHVuZGVmaW5lZCkpIHtfY29udGV4dDEyLm5leHQgPSAyNjticmVhazt9dGhyb3cgKAoKCgoKICAgICAgICAgICAgICAgICAgICAgICAgZXJyb3IpO2Nhc2UgMjY6aWYgKCEKCgoKICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdC5hY3Rpb25EYXRhKSB7X2NvbnRleHQxMi5uZXh0ID0gMjg7YnJlYWs7fXJldHVybiBfY29udGV4dDEyLmFicnVwdCgicmV0dXJuIiwKICAgICAgICAgICAgICAgICAgICAgIE9iamVjdC52YWx1ZXMocmVzdWx0LmFjdGlvbkRhdGEpWzBdKTtjYXNlIDI4OmlmICghCgoKICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdC5sb2FkZXJEYXRhKSB7X2NvbnRleHQxMi5uZXh0ID0gMzI7YnJlYWs7fQoKCiAgICAgICAgICAgICAgICAgICAgICBkYXRhID0gT2JqZWN0LnZhbHVlcyhyZXN1bHQubG9hZGVyRGF0YSlbMF07CgogICAgICAgICAgICAgICAgICAgICAgaWYgKChfcmVzdWx0JGFjdGl2ZURlZmVycmUgPSByZXN1bHQuYWN0aXZlRGVmZXJyZWRzKSAhPSBudWxsICYmIF9yZXN1bHQkYWN0aXZlRGVmZXJyZVttYXRjaC5yb3V0ZS5pZF0pIHsKICAgICAgICAgICAgICAgICAgICAgICAgZGF0YVtVTlNBRkVfREVGRVJSRURfU1lNQk9MXSA9IHJlc3VsdC5hY3RpdmVEZWZlcnJlZHNbbWF0Y2gucm91dGUuaWRdOwogICAgICAgICAgICAgICAgICAgICAgfXJldHVybiBfY29udGV4dDEyLmFicnVwdCgicmV0dXJuIiwKCiAgICAgICAgICAgICAgICAgICAgICBkYXRhKTtjYXNlIDMyOnJldHVybiBfY29udGV4dDEyLmFicnVwdCgicmV0dXJuIiwKCgogICAgICAgICAgICAgICAgICAgICAgdW5kZWZpbmVkKTtjYXNlIDMzOmNhc2UgImVuZCI6cmV0dXJuIF9jb250ZXh0MTIuc3RvcCgpO319LCBfY2FsbGVlMTIpO30pKTtyZXR1cm4gX3F1ZXJ5Um91dGUuYXBwbHkodGhpcywgYXJndW1lbnRzKTt9ZnVuY3Rpb24KCgogICAgICAgICAgICBxdWVyeUltcGwoX3g0NiwgX3g0NywgX3g0OCwgX3g0OSwgX3g1MCkge3JldHVybiBfcXVlcnlJbXBsLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7fWZ1bmN0aW9uIF9xdWVyeUltcGwoKSB7X3F1ZXJ5SW1wbCA9IF9hc3luY1RvR2VuZXJhdG9yMiggLyojX19QVVJFX18qL19yZWdlbmVyYXRvclJ1bnRpbWUyKCkubWFyayhmdW5jdGlvbiBfY2FsbGVlMTMocmVxdWVzdCwgbG9jYXRpb24sIG1hdGNoZXMsIHJlcXVlc3RDb250ZXh0LCByb3V0ZU1hdGNoKSB7dmFyIF9yZXN1bHQsIHJlc3VsdDtyZXR1cm4gX3JlZ2VuZXJhdG9yUnVudGltZTIoKS53cmFwKGZ1bmN0aW9uIF9jYWxsZWUxMyQoX2NvbnRleHQxMykge3doaWxlICgxKSBzd2l0Y2ggKF9jb250ZXh0MTMucHJldiA9IF9jb250ZXh0MTMubmV4dCkge2Nhc2UgMDoKICAgICAgICAgICAgICAgICAgICAgIHJvdXRlcl9pbnZhcmlhbnQocmVxdWVzdC5zaWduYWwsICJxdWVyeSgpL3F1ZXJ5Um91dGUoKSByZXF1ZXN0cyBtdXN0IGNvbnRhaW4gYW4gQWJvcnRDb250cm9sbGVyIHNpZ25hbCIpO19jb250ZXh0MTMucHJldiA9IDE7aWYgKCEKCgogICAgICAgICAgICAgICAgICAgICAgaXNNdXRhdGlvbk1ldGhvZChyZXF1ZXN0Lm1ldGhvZC50b0xvd2VyQ2FzZSgpKSkge19jb250ZXh0MTMubmV4dCA9IDc7YnJlYWs7fV9jb250ZXh0MTMubmV4dCA9IDU7cmV0dXJuICgKICAgICAgICAgICAgICAgICAgICAgICAgc3VibWl0KHJlcXVlc3QsIG1hdGNoZXMsIHJvdXRlTWF0Y2ggfHwgZ2V0VGFyZ2V0TWF0Y2gobWF0Y2hlcywgbG9jYXRpb24pLCByZXF1ZXN0Q29udGV4dCwgcm91dGVNYXRjaCAhPSBudWxsKSk7Y2FzZSA1Ol9yZXN1bHQgPSBfY29udGV4dDEzLnNlbnQ7cmV0dXJuIF9jb250ZXh0MTMuYWJydXB0KCJyZXR1cm4iLAogICAgICAgICAgICAgICAgICAgICAgX3Jlc3VsdCk7Y2FzZSA3Ol9jb250ZXh0MTMubmV4dCA9IDk7cmV0dXJuICgKCgogICAgICAgICAgICAgICAgICAgICAgICBsb2FkUm91dGVEYXRhKHJlcXVlc3QsIG1hdGNoZXMsIHJlcXVlc3RDb250ZXh0LCByb3V0ZU1hdGNoKSk7Y2FzZSA5OnJlc3VsdCA9IF9jb250ZXh0MTMuc2VudDtyZXR1cm4gX2NvbnRleHQxMy5hYnJ1cHQoInJldHVybiIsCiAgICAgICAgICAgICAgICAgICAgICBpc1Jlc3BvbnNlKHJlc3VsdCkgPyByZXN1bHQgOiBfZXh0ZW5kcyh7fSwgcmVzdWx0LCB7CiAgICAgICAgICAgICAgICAgICAgICAgIGFjdGlvbkRhdGE6IG51bGwsCiAgICAgICAgICAgICAgICAgICAgICAgIGFjdGlvbkhlYWRlcnM6IHt9CiAgICAgICAgICAgICAgICAgICAgICB9KSk7Y2FzZSAxMzpfY29udGV4dDEzLnByZXYgPSAxMztfY29udGV4dDEzLnQwID0gX2NvbnRleHQxM1siY2F0Y2giXSgxKTtpZiAoIQoKCgoKICAgICAgICAgICAgICAgICAgICAgIGlzUXVlcnlSb3V0ZVJlc3BvbnNlKF9jb250ZXh0MTMudDApKSB7X2NvbnRleHQxMy5uZXh0ID0gMTk7YnJlYWs7fWlmICghKAogICAgICAgICAgICAgICAgICAgICAgX2NvbnRleHQxMy50MC50eXBlID09PSBSZXN1bHRUeXBlLmVycm9yICYmICFpc1JlZGlyZWN0UmVzcG9uc2UoX2NvbnRleHQxMy50MC5yZXNwb25zZSkpKSB7X2NvbnRleHQxMy5uZXh0ID0gMTg7YnJlYWs7fXRocm93ICgKICAgICAgICAgICAgICAgICAgICAgICAgX2NvbnRleHQxMy50MC5yZXNwb25zZSk7Y2FzZSAxODpyZXR1cm4gX2NvbnRleHQxMy5hYnJ1cHQoInJldHVybiIsCgoKICAgICAgICAgICAgICAgICAgICAgIF9jb250ZXh0MTMudDAucmVzcG9uc2UpO2Nhc2UgMTk6aWYgKCEKCgoKCiAgICAgICAgICAgICAgICAgICAgICBpc1JlZGlyZWN0UmVzcG9uc2UoX2NvbnRleHQxMy50MCkpIHtfY29udGV4dDEzLm5leHQgPSAyMTticmVhazt9cmV0dXJuIF9jb250ZXh0MTMuYWJydXB0KCJyZXR1cm4iLCBfY29udGV4dDEzLnQwKTtjYXNlIDIxOnRocm93IF9jb250ZXh0MTMudDA7Y2FzZSAyMjpjYXNlICJlbmQiOnJldHVybiBfY29udGV4dDEzLnN0b3AoKTt9fSwgX2NhbGxlZTEzLCBudWxsLCBbWzEsIDEzXV0pO30pKTtyZXR1cm4gX3F1ZXJ5SW1wbC5hcHBseSh0aGlzLCBhcmd1bWVudHMpO31mdW5jdGlvbgoKCgoKCgoKICAgICAgICAgICAgc3VibWl0KF94NTEsIF94NTIsIF94NTMsIF94NTQsIF94NTUpIHtyZXR1cm4gX3N1Ym1pdC5hcHBseSh0aGlzLCBhcmd1bWVudHMpO31mdW5jdGlvbiBfc3VibWl0KCkge19zdWJtaXQgPSBfYXN5bmNUb0dlbmVyYXRvcjIoIC8qI19fUFVSRV9fKi9fcmVnZW5lcmF0b3JSdW50aW1lMigpLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTE0KHJlcXVlc3QsIG1hdGNoZXMsIGFjdGlvbk1hdGNoLCByZXF1ZXN0Q29udGV4dCwgaXNSb3V0ZVJlcXVlc3QpIHt2YXIgcmVzdWx0LCBlcnJvciwgbWV0aG9kLCBfZXJyb3I0LCBib3VuZGFyeU1hdGNoLCBfY29udGV4dDE0LCBsb2FkZXJSZXF1ZXN0LCBjb250ZXh0O3JldHVybiBfcmVnZW5lcmF0b3JSdW50aW1lMigpLndyYXAoZnVuY3Rpb24gX2NhbGxlZTE0JChfY29udGV4dDE1KSB7d2hpbGUgKDEpIHN3aXRjaCAoX2NvbnRleHQxNS5wcmV2ID0gX2NvbnRleHQxNS5uZXh0KSB7Y2FzZSAwOmlmICgKCgogICAgICAgICAgICAgICAgICAgICAgYWN0aW9uTWF0Y2gucm91dGUuYWN0aW9uKSB7X2NvbnRleHQxNS5uZXh0ID0gNzticmVhazt9CiAgICAgICAgICAgICAgICAgICAgICBlcnJvciA9IGdldEludGVybmFsUm91dGVyRXJyb3IoNDA1LCB7CiAgICAgICAgICAgICAgICAgICAgICAgIG1ldGhvZDogcmVxdWVzdC5tZXRob2QsCiAgICAgICAgICAgICAgICAgICAgICAgIHBhdGhuYW1lOiBuZXcgVVJMKHJlcXVlc3QudXJsKS5wYXRobmFtZSwKICAgICAgICAgICAgICAgICAgICAgICAgcm91dGVJZDogYWN0aW9uTWF0Y2gucm91dGUuaWQKICAgICAgICAgICAgICAgICAgICAgIH0pO2lmICghCgogICAgICAgICAgICAgICAgICAgICAgaXNSb3V0ZVJlcXVlc3QpIHtfY29udGV4dDE1Lm5leHQgPSA0O2JyZWFrO310aHJvdyAoCiAgICAgICAgICAgICAgICAgICAgICAgIGVycm9yKTtjYXNlIDQ6CgoKICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdCA9IHsKICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogUmVzdWx0VHlwZS5lcnJvciwKICAgICAgICAgICAgICAgICAgICAgICAgZXJyb3I6IGVycm9yCiAgICAgICAgICAgICAgICAgICAgICB9O19jb250ZXh0MTUubmV4dCA9IDEzO2JyZWFrO2Nhc2UgNzpfY29udGV4dDE1Lm5leHQgPSA5O3JldHVybiAoCgogICAgICAgICAgICAgICAgICAgICAgICBjYWxsTG9hZGVyT3JBY3Rpb24oImFjdGlvbiIsIHJlcXVlc3QsIGFjdGlvbk1hdGNoLCBtYXRjaGVzLCBiYXNlbmFtZSwgdHJ1ZSwgaXNSb3V0ZVJlcXVlc3QsIHJlcXVlc3RDb250ZXh0KSk7Y2FzZSA5OnJlc3VsdCA9IF9jb250ZXh0MTUuc2VudDtpZiAoIQoKICAgICAgICAgICAgICAgICAgICAgIHJlcXVlc3Quc2lnbmFsLmFib3J0ZWQpIHtfY29udGV4dDE1Lm5leHQgPSAxMzticmVhazt9CiAgICAgICAgICAgICAgICAgICAgICBtZXRob2QgPSBpc1JvdXRlUmVxdWVzdCA/ICJxdWVyeVJvdXRlIiA6ICJxdWVyeSI7dGhyb3cgKAogICAgICAgICAgICAgICAgICAgICAgICBuZXcgRXJyb3IobWV0aG9kICsgIigpIGNhbGwgYWJvcnRlZCIpKTtjYXNlIDEzOmlmICghCgoKCiAgICAgICAgICAgICAgICAgICAgICBpc1JlZGlyZWN0UmVzdWx0KHJlc3VsdCkpIHtfY29udGV4dDE1Lm5leHQgPSAxNTticmVhazt9dGhyb3cgKAoKCgoKICAgICAgICAgICAgICAgICAgICAgICAgbmV3IFJlc3BvbnNlKG51bGwsIHsKICAgICAgICAgICAgICAgICAgICAgICAgICBzdGF0dXM6IHJlc3VsdC5zdGF0dXMsCiAgICAgICAgICAgICAgICAgICAgICAgICAgaGVhZGVyczogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgTG9jYXRpb246IHJlc3VsdC5sb2NhdGlvbgogICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgfSkpO2Nhc2UgMTU6aWYgKCEKCgogICAgICAgICAgICAgICAgICAgICAgaXNEZWZlcnJlZFJlc3VsdChyZXN1bHQpKSB7X2NvbnRleHQxNS5uZXh0ID0gMjA7YnJlYWs7fQogICAgICAgICAgICAgICAgICAgICAgX2Vycm9yNCA9IGdldEludGVybmFsUm91dGVyRXJyb3IoNDAwLCB7CiAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6ICJkZWZlci1hY3Rpb24iCiAgICAgICAgICAgICAgICAgICAgICB9KTtpZiAoIQoKICAgICAgICAgICAgICAgICAgICAgIGlzUm91dGVSZXF1ZXN0KSB7X2NvbnRleHQxNS5uZXh0ID0gMTk7YnJlYWs7fXRocm93ICgKICAgICAgICAgICAgICAgICAgICAgICAgX2Vycm9yNCk7Y2FzZSAxOToKCgogICAgICAgICAgICAgICAgICAgICAgcmVzdWx0ID0gewogICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiBSZXN1bHRUeXBlLmVycm9yLAogICAgICAgICAgICAgICAgICAgICAgICBlcnJvcjogX2Vycm9yNAogICAgICAgICAgICAgICAgICAgICAgfTtjYXNlIDIwOmlmICghCgoKICAgICAgICAgICAgICAgICAgICAgIGlzUm91dGVSZXF1ZXN0KSB7X2NvbnRleHQxNS5uZXh0ID0gMjQ7YnJlYWs7fWlmICghCgoKICAgICAgICAgICAgICAgICAgICAgIGlzRXJyb3JSZXN1bHQocmVzdWx0KSkge19jb250ZXh0MTUubmV4dCA9IDIzO2JyZWFrO310aHJvdyAoCiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdC5lcnJvcik7Y2FzZSAyMzpyZXR1cm4gX2NvbnRleHQxNS5hYnJ1cHQoInJldHVybiIsCgoKICAgICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgbWF0Y2hlczogW2FjdGlvbk1hdGNoXSwKICAgICAgICAgICAgICAgICAgICAgICAgbG9hZGVyRGF0YToge30sCiAgICAgICAgICAgICAgICAgICAgICAgIGFjdGlvbkRhdGE6IF9kZWZpbmVQcm9wZXJ0eTIoe30sCiAgICAgICAgICAgICAgICAgICAgICAgIGFjdGlvbk1hdGNoLnJvdXRlLmlkLCByZXN1bHQuZGF0YSksCgogICAgICAgICAgICAgICAgICAgICAgICBlcnJvcnM6IG51bGwsCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIE5vdGU6IHN0YXR1c0NvZGUgKyBoZWFkZXJzIGFyZSB1bnVzZWQgaGVyZSBzaW5jZSBxdWVyeVJvdXRlIHdpbGwKICAgICAgICAgICAgICAgICAgICAgICAgLy8gcmV0dXJuIHRoZSByYXcgUmVzcG9uc2Ugb3IgdmFsdWUKICAgICAgICAgICAgICAgICAgICAgICAgc3RhdHVzQ29kZTogMjAwLAogICAgICAgICAgICAgICAgICAgICAgICBsb2FkZXJIZWFkZXJzOiB7fSwKICAgICAgICAgICAgICAgICAgICAgICAgYWN0aW9uSGVhZGVyczoge30sCiAgICAgICAgICAgICAgICAgICAgICAgIGFjdGl2ZURlZmVycmVkczogbnVsbAogICAgICAgICAgICAgICAgICAgICAgfSk7Y2FzZSAyNDppZiAoIQoKCiAgICAgICAgICAgICAgICAgICAgICBpc0Vycm9yUmVzdWx0KHJlc3VsdCkpIHtfY29udGV4dDE1Lm5leHQgPSAzMDticmVhazt9CiAgICAgICAgICAgICAgICAgICAgICAvLyBTdG9yZSBvZmYgdGhlIHBlbmRpbmcgZXJyb3IgLSB3ZSB1c2UgaXQgdG8gZGV0ZXJtaW5lIHdoaWNoIGxvYWRlcnMKICAgICAgICAgICAgICAgICAgICAgIC8vIHRvIGNhbGwgYW5kIHdpbGwgY29tbWl0IGl0IHdoZW4gd2UgY29tcGxldGUgdGhlIG5hdmlnYXRpb24KICAgICAgICAgICAgICAgICAgICAgIGJvdW5kYXJ5TWF0Y2ggPSBmaW5kTmVhcmVzdEJvdW5kYXJ5KG1hdGNoZXMsIGFjdGlvbk1hdGNoLnJvdXRlLmlkKTtfY29udGV4dDE1Lm5leHQgPSAyODtyZXR1cm4gKAogICAgICAgICAgICAgICAgICAgICAgICBsb2FkUm91dGVEYXRhKHJlcXVlc3QsIG1hdGNoZXMsIHJlcXVlc3RDb250ZXh0LCB1bmRlZmluZWQsIF9kZWZpbmVQcm9wZXJ0eTIoe30sCiAgICAgICAgICAgICAgICAgICAgICAgIGJvdW5kYXJ5TWF0Y2gucm91dGUuaWQsIHJlc3VsdC5lcnJvcikpKTtjYXNlIDI4Ol9jb250ZXh0MTQgPSBfY29udGV4dDE1LnNlbnQ7cmV0dXJuIF9jb250ZXh0MTUuYWJydXB0KCJyZXR1cm4iLAoKCiAgICAgICAgICAgICAgICAgICAgICBfZXh0ZW5kcyh7fSwgX2NvbnRleHQxNCwgewogICAgICAgICAgICAgICAgICAgICAgICBzdGF0dXNDb2RlOiBpc1JvdXRlRXJyb3JSZXNwb25zZShyZXN1bHQuZXJyb3IpID8gcmVzdWx0LmVycm9yLnN0YXR1cyA6IDUwMCwKICAgICAgICAgICAgICAgICAgICAgICAgYWN0aW9uRGF0YTogbnVsbCwKICAgICAgICAgICAgICAgICAgICAgICAgYWN0aW9uSGVhZGVyczogX2V4dGVuZHMoe30sIHJlc3VsdC5oZWFkZXJzID8gX2RlZmluZVByb3BlcnR5Mih7fSwKICAgICAgICAgICAgICAgICAgICAgICAgYWN0aW9uTWF0Y2gucm91dGUuaWQsIHJlc3VsdC5oZWFkZXJzKSA6CiAgICAgICAgICAgICAgICAgICAgICAgIHt9KQogICAgICAgICAgICAgICAgICAgICAgfSkpO2Nhc2UgMzA6CiAgICAgICAgICAgICAgICAgICAgICAvLyBDcmVhdGUgYSBHRVQgcmVxdWVzdCBmb3IgdGhlIGxvYWRlcnMKCgogICAgICAgICAgICAgICAgICAgICAgbG9hZGVyUmVxdWVzdCA9IG5ldyBSZXF1ZXN0KHJlcXVlc3QudXJsLCB7CiAgICAgICAgICAgICAgICAgICAgICAgIGhlYWRlcnM6IHJlcXVlc3QuaGVhZGVycywKICAgICAgICAgICAgICAgICAgICAgICAgcmVkaXJlY3Q6IHJlcXVlc3QucmVkaXJlY3QsCiAgICAgICAgICAgICAgICAgICAgICAgIHNpZ25hbDogcmVxdWVzdC5zaWduYWwKICAgICAgICAgICAgICAgICAgICAgIH0pO19jb250ZXh0MTUubmV4dCA9IDMzO3JldHVybiAoCiAgICAgICAgICAgICAgICAgICAgICAgIGxvYWRSb3V0ZURhdGEobG9hZGVyUmVxdWVzdCwgbWF0Y2hlcywgcmVxdWVzdENvbnRleHQpKTtjYXNlIDMzOmNvbnRleHQgPSBfY29udGV4dDE1LnNlbnQ7cmV0dXJuIF9jb250ZXh0MTUuYWJydXB0KCJyZXR1cm4iLAogICAgICAgICAgICAgICAgICAgICAgX2V4dGVuZHMoe30sIGNvbnRleHQsIHJlc3VsdC5zdGF0dXNDb2RlID8gewogICAgICAgICAgICAgICAgICAgICAgICBzdGF0dXNDb2RlOiByZXN1bHQuc3RhdHVzQ29kZQogICAgICAgICAgICAgICAgICAgICAgfSA6IHt9LCB7CiAgICAgICAgICAgICAgICAgICAgICAgIGFjdGlvbkRhdGE6IF9kZWZpbmVQcm9wZXJ0eTIoe30sCiAgICAgICAgICAgICAgICAgICAgICAgIGFjdGlvbk1hdGNoLnJvdXRlLmlkLCByZXN1bHQuZGF0YSksCgogICAgICAgICAgICAgICAgICAgICAgICBhY3Rpb25IZWFkZXJzOiBfZXh0ZW5kcyh7fSwgcmVzdWx0LmhlYWRlcnMgPyBfZGVmaW5lUHJvcGVydHkyKHt9LAogICAgICAgICAgICAgICAgICAgICAgICBhY3Rpb25NYXRjaC5yb3V0ZS5pZCwgcmVzdWx0LmhlYWRlcnMpIDoKICAgICAgICAgICAgICAgICAgICAgICAge30pCiAgICAgICAgICAgICAgICAgICAgICB9KSk7Y2FzZSAzNTpjYXNlICJlbmQiOnJldHVybiBfY29udGV4dDE1LnN0b3AoKTt9fSwgX2NhbGxlZTE0KTt9KSk7cmV0dXJuIF9zdWJtaXQuYXBwbHkodGhpcywgYXJndW1lbnRzKTt9ZnVuY3Rpb24KCgogICAgICAgICAgICBsb2FkUm91dGVEYXRhKF94NTYsIF94NTcsIF94NTgsIF94NTksIF94NjApIHtyZXR1cm4gX2xvYWRSb3V0ZURhdGEuYXBwbHkodGhpcywgYXJndW1lbnRzKTt9ZnVuY3Rpb24gX2xvYWRSb3V0ZURhdGEoKSB7X2xvYWRSb3V0ZURhdGEgPSBfYXN5bmNUb0dlbmVyYXRvcjIoIC8qI19fUFVSRV9fKi9fcmVnZW5lcmF0b3JSdW50aW1lMigpLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTE1KHJlcXVlc3QsIG1hdGNoZXMsIHJlcXVlc3RDb250ZXh0LCByb3V0ZU1hdGNoLCBwZW5kaW5nQWN0aW9uRXJyb3IpIHt2YXIgaXNSb3V0ZVJlcXVlc3QsIHJlcXVlc3RNYXRjaGVzLCBtYXRjaGVzVG9Mb2FkLCByZXN1bHRzLCBtZXRob2QsIGFjdGl2ZURlZmVycmVkcywgY29udGV4dCwgZXhlY3V0ZWRMb2FkZXJzO3JldHVybiBfcmVnZW5lcmF0b3JSdW50aW1lMigpLndyYXAoZnVuY3Rpb24gX2NhbGxlZTE1JChfY29udGV4dDE2KSB7d2hpbGUgKDEpIHN3aXRjaCAoX2NvbnRleHQxNi5wcmV2ID0gX2NvbnRleHQxNi5uZXh0KSB7Y2FzZSAwOgogICAgICAgICAgICAgICAgICAgICAgaXNSb3V0ZVJlcXVlc3QgPSByb3V0ZU1hdGNoICE9IG51bGw7IC8vIFNob3J0IGNpcmN1aXQgaWYgd2UgaGF2ZSBubyBsb2FkZXJzIHRvIHJ1biAocXVlcnlSb3V0ZSgpKQogICAgICAgICAgICAgICAgICAgICAgaWYgKCEoCiAgICAgICAgICAgICAgICAgICAgICBpc1JvdXRlUmVxdWVzdCAmJiAhKHJvdXRlTWF0Y2ggIT0gbnVsbCAmJiByb3V0ZU1hdGNoLnJvdXRlLmxvYWRlcikpKSB7X2NvbnRleHQxNi5uZXh0ID0gMzticmVhazt9dGhyb3cgKAogICAgICAgICAgICAgICAgICAgICAgICBnZXRJbnRlcm5hbFJvdXRlckVycm9yKDQwMCwgewogICAgICAgICAgICAgICAgICAgICAgICAgIG1ldGhvZDogcmVxdWVzdC5tZXRob2QsCiAgICAgICAgICAgICAgICAgICAgICAgICAgcGF0aG5hbWU6IG5ldyBVUkwocmVxdWVzdC51cmwpLnBhdGhuYW1lLAogICAgICAgICAgICAgICAgICAgICAgICAgIHJvdXRlSWQ6IHJvdXRlTWF0Y2ggPT0gbnVsbCA/IHZvaWQgMCA6IHJvdXRlTWF0Y2gucm91dGUuaWQKICAgICAgICAgICAgICAgICAgICAgICAgfSkpO2Nhc2UgMzoKCgogICAgICAgICAgICAgICAgICAgICAgcmVxdWVzdE1hdGNoZXMgPSByb3V0ZU1hdGNoID8gW3JvdXRlTWF0Y2hdIDogZ2V0TG9hZGVyTWF0Y2hlc1VudGlsQm91bmRhcnkobWF0Y2hlcywgT2JqZWN0LmtleXMocGVuZGluZ0FjdGlvbkVycm9yIHx8IHt9KVswXSk7CiAgICAgICAgICAgICAgICAgICAgICBtYXRjaGVzVG9Mb2FkID0gcmVxdWVzdE1hdGNoZXMuZmlsdGVyKChtKSA9PiBtLnJvdXRlLmxvYWRlcik7IC8vIFNob3J0IGNpcmN1aXQgaWYgd2UgaGF2ZSBubyBsb2FkZXJzIHRvIHJ1biAocXVlcnkoKSkKICAgICAgICAgICAgICAgICAgICAgIGlmICghKAogICAgICAgICAgICAgICAgICAgICAgbWF0Y2hlc1RvTG9hZC5sZW5ndGggPT09IDApKSB7X2NvbnRleHQxNi5uZXh0ID0gNzticmVhazt9cmV0dXJuIF9jb250ZXh0MTYuYWJydXB0KCJyZXR1cm4iLAogICAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICBtYXRjaGVzOiBtYXRjaGVzLAogICAgICAgICAgICAgICAgICAgICAgICAvLyBBZGQgYSBudWxsIGZvciBhbGwgbWF0Y2hlZCByb3V0ZXMgZm9yIHByb3BlciByZXZhbGlkYXRpb24gb24gdGhlIGNsaWVudAogICAgICAgICAgICAgICAgICAgICAgICBsb2FkZXJEYXRhOiBtYXRjaGVzLnJlZHVjZSgoYWNjLCBtKSA9PiBPYmplY3QuYXNzaWduKGFjYywgX2RlZmluZVByb3BlcnR5Mih7fSwKICAgICAgICAgICAgICAgICAgICAgICAgbS5yb3V0ZS5pZCwgbnVsbCkpLAogICAgICAgICAgICAgICAgICAgICAgICB7fSksCiAgICAgICAgICAgICAgICAgICAgICAgIGVycm9yczogcGVuZGluZ0FjdGlvbkVycm9yIHx8IG51bGwsCiAgICAgICAgICAgICAgICAgICAgICAgIHN0YXR1c0NvZGU6IDIwMCwKICAgICAgICAgICAgICAgICAgICAgICAgbG9hZGVySGVhZGVyczoge30sCiAgICAgICAgICAgICAgICAgICAgICAgIGFjdGl2ZURlZmVycmVkczogbnVsbAogICAgICAgICAgICAgICAgICAgICAgfSk7Y2FzZSA3Ol9jb250ZXh0MTYubmV4dCA9IDk7cmV0dXJuICgKCgogICAgICAgICAgICAgICAgICAgICAgICBQcm9taXNlLmFsbChfdG9Db25zdW1hYmxlQXJyYXkyKG1hdGNoZXNUb0xvYWQubWFwKChtYXRjaCkgPT4gY2FsbExvYWRlck9yQWN0aW9uKCJsb2FkZXIiLCByZXF1ZXN0LCBtYXRjaCwgbWF0Y2hlcywgYmFzZW5hbWUsIHRydWUsIGlzUm91dGVSZXF1ZXN0LCByZXF1ZXN0Q29udGV4dCkpKSkpO2Nhc2UgOTpyZXN1bHRzID0gX2NvbnRleHQxNi5zZW50O2lmICghCgogICAgICAgICAgICAgICAgICAgICAgcmVxdWVzdC5zaWduYWwuYWJvcnRlZCkge19jb250ZXh0MTYubmV4dCA9IDEzO2JyZWFrO30KICAgICAgICAgICAgICAgICAgICAgIG1ldGhvZCA9IGlzUm91dGVSZXF1ZXN0ID8gInF1ZXJ5Um91dGUiIDogInF1ZXJ5Ijt0aHJvdyAoCiAgICAgICAgICAgICAgICAgICAgICAgIG5ldyBFcnJvcihtZXRob2QgKyAiKCkgY2FsbCBhYm9ydGVkIikpO2Nhc2UgMTM6CiAgICAgICAgICAgICAgICAgICAgICAvLyBQcm9jZXNzIGFuZCBjb21taXQgb3V0cHV0IGZyb20gbG9hZGVycwoKCiAgICAgICAgICAgICAgICAgICAgICBhY3RpdmVEZWZlcnJlZHMgPSBuZXcgTWFwKCk7CiAgICAgICAgICAgICAgICAgICAgICBjb250ZXh0ID0gcHJvY2Vzc1JvdXRlTG9hZGVyRGF0YShtYXRjaGVzLCBtYXRjaGVzVG9Mb2FkLCByZXN1bHRzLCBwZW5kaW5nQWN0aW9uRXJyb3IsIGFjdGl2ZURlZmVycmVkcyk7IC8vIEFkZCBhIG51bGwgZm9yIGFueSBub24tbG9hZGVyIG1hdGNoZXMgZm9yIHByb3BlciByZXZhbGlkYXRpb24gb24gdGhlIGNsaWVudAoKICAgICAgICAgICAgICAgICAgICAgIGV4ZWN1dGVkTG9hZGVycyA9IG5ldyBTZXQobWF0Y2hlc1RvTG9hZC5tYXAoKG1hdGNoKSA9PiBtYXRjaC5yb3V0ZS5pZCkpOwogICAgICAgICAgICAgICAgICAgICAgbWF0Y2hlcy5mb3JFYWNoKChtYXRjaCkgPT4gewogICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWV4ZWN1dGVkTG9hZGVycy5oYXMobWF0Y2gucm91dGUuaWQpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgY29udGV4dC5sb2FkZXJEYXRhW21hdGNoLnJvdXRlLmlkXSA9IG51bGw7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgIH0pO3JldHVybiBfY29udGV4dDE2LmFicnVwdCgicmV0dXJuIiwKICAgICAgICAgICAgICAgICAgICAgIF9leHRlbmRzKHt9LCBjb250ZXh0LCB7CiAgICAgICAgICAgICAgICAgICAgICAgIG1hdGNoZXM6IG1hdGNoZXMsCiAgICAgICAgICAgICAgICAgICAgICAgIGFjdGl2ZURlZmVycmVkczogYWN0aXZlRGVmZXJyZWRzLnNpemUgPiAwID8gT2JqZWN0LmZyb21FbnRyaWVzKGFjdGl2ZURlZmVycmVkcy5lbnRyaWVzKCkpIDogbnVsbAogICAgICAgICAgICAgICAgICAgICAgfSkpO2Nhc2UgMTg6Y2FzZSAiZW5kIjpyZXR1cm4gX2NvbnRleHQxNi5zdG9wKCk7fX0sIF9jYWxsZWUxNSk7fSkpO3JldHVybiBfbG9hZFJvdXRlRGF0YS5hcHBseSh0aGlzLCBhcmd1bWVudHMpO30KCgogICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgIGRhdGFSb3V0ZXM6IGRhdGFSb3V0ZXMsCiAgICAgICAgICAgICAgcXVlcnk6IHF1ZXJ5LAogICAgICAgICAgICAgIHF1ZXJ5Um91dGU6IHF1ZXJ5Um91dGUKICAgICAgICAgICAgfTsKICAgICAgICAgIH0gLy8jZW5kcmVnaW9uCiAgICAgICAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwogICAgICAgICAgLy8jcmVnaW9uIEhlbHBlcnMKICAgICAgICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCgogICAgICAgICAgLyoqCiAgICAgICAgICAgKiBHaXZlbiBhbiBleGlzdGluZyBTdGF0aWNIYW5kbGVyQ29udGV4dCBhbmQgYW4gZXJyb3IgdGhyb3duIGF0IHJlbmRlciB0aW1lLAogICAgICAgICAgICogcHJvdmlkZSBhbiB1cGRhdGVkIFN0YXRpY0hhbmRsZXJDb250ZXh0IHN1aXRhYmxlIGZvciBhIHNlY29uZCBTU1IgcmVuZGVyCiAgICAgICAgICAgKi8KCiAgICAgICAgICBmdW5jdGlvbiBnZXRTdGF0aWNDb250ZXh0RnJvbUVycm9yKHJvdXRlcywgY29udGV4dCwgZXJyb3IpIHsKICAgICAgICAgICAgdmFyIG5ld0NvbnRleHQgPSBfZXh0ZW5kcyh7fSwgY29udGV4dCwgewogICAgICAgICAgICAgIHN0YXR1c0NvZGU6IDUwMCwKICAgICAgICAgICAgICBlcnJvcnM6IF9kZWZpbmVQcm9wZXJ0eTIoe30sCiAgICAgICAgICAgICAgY29udGV4dC5fZGVlcGVzdFJlbmRlcmVkQm91bmRhcnlJZCB8fCByb3V0ZXNbMF0uaWQsIGVycm9yKQoKICAgICAgICAgICAgfSk7CgogICAgICAgICAgICByZXR1cm4gbmV3Q29udGV4dDsKICAgICAgICAgIH0KCiAgICAgICAgICBmdW5jdGlvbiBpc1N1Ym1pc3Npb25OYXZpZ2F0aW9uKG9wdHMpIHsKICAgICAgICAgICAgcmV0dXJuIG9wdHMgIT0gbnVsbCAmJiAiZm9ybURhdGEiIGluIG9wdHM7CiAgICAgICAgICB9IC8vIE5vcm1hbGl6ZSBuYXZpZ2F0aW9uIG9wdGlvbnMgYnkgY29udmVydGluZyBmb3JtTWV0aG9kPUdFVCBmb3JtRGF0YSBvYmplY3RzIHRvCiAgICAgICAgICAvLyBVUkxTZWFyY2hQYXJhbXMgc28gdGhleSBiZWhhdmUgaWRlbnRpY2FsbHkgdG8gbGlua3Mgd2l0aCBxdWVyeSBwYXJhbXMKCgogICAgICAgICAgZnVuY3Rpb24gbm9ybWFsaXplTmF2aWdhdGVPcHRpb25zKHRvLCBvcHRzLCBpc0ZldGNoZXIpIHsKICAgICAgICAgICAgaWYgKGlzRmV0Y2hlciA9PT0gdm9pZCAwKSB7CiAgICAgICAgICAgICAgaXNGZXRjaGVyID0gZmFsc2U7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHZhciBwYXRoID0gdHlwZW9mIHRvID09PSAic3RyaW5nIiA/IHRvIDogcm91dGVyX2NyZWF0ZVBhdGgodG8pOyAvLyBSZXR1cm4gbG9jYXRpb24gdmVyYmF0aW0gb24gbm9uLXN1Ym1pc3Npb24gbmF2aWdhdGlvbnMKCiAgICAgICAgICAgIGlmICghb3B0cyB8fCAhaXNTdWJtaXNzaW9uTmF2aWdhdGlvbihvcHRzKSkgewogICAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICBwYXRoOiBwYXRoCiAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKG9wdHMuZm9ybU1ldGhvZCAmJiAhaXNWYWxpZE1ldGhvZChvcHRzLmZvcm1NZXRob2QpKSB7CiAgICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgIHBhdGg6IHBhdGgsCiAgICAgICAgICAgICAgICBlcnJvcjogZ2V0SW50ZXJuYWxSb3V0ZXJFcnJvcig0MDUsIHsKICAgICAgICAgICAgICAgICAgbWV0aG9kOiBvcHRzLmZvcm1NZXRob2QKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgfSAvLyBDcmVhdGUgYSBTdWJtaXNzaW9uIG9uIG5vbi1HRVQgbmF2aWdhdGlvbnMKCgogICAgICAgICAgICB2YXIgc3VibWlzc2lvbjsKCiAgICAgICAgICAgIGlmIChvcHRzLmZvcm1EYXRhKSB7CiAgICAgICAgICAgICAgc3VibWlzc2lvbiA9IHsKICAgICAgICAgICAgICAgIGZvcm1NZXRob2Q6IG9wdHMuZm9ybU1ldGhvZCB8fCAiZ2V0IiwKICAgICAgICAgICAgICAgIGZvcm1BY3Rpb246IHN0cmlwSGFzaEZyb21QYXRoKHBhdGgpLAogICAgICAgICAgICAgICAgZm9ybUVuY1R5cGU6IG9wdHMgJiYgb3B0cy5mb3JtRW5jVHlwZSB8fCAiYXBwbGljYXRpb24veC13d3ctZm9ybS11cmxlbmNvZGVkIiwKICAgICAgICAgICAgICAgIGZvcm1EYXRhOiBvcHRzLmZvcm1EYXRhCiAgICAgICAgICAgICAgfTsKCiAgICAgICAgICAgICAgaWYgKGlzTXV0YXRpb25NZXRob2Qoc3VibWlzc2lvbi5mb3JtTWV0aG9kKSkgewogICAgICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgICAgcGF0aDogcGF0aCwKICAgICAgICAgICAgICAgICAgc3VibWlzc2lvbjogc3VibWlzc2lvbgogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gLy8gRmxhdHRlbiBzdWJtaXNzaW9uIG9udG8gVVJMU2VhcmNoUGFyYW1zIGZvciBHRVQgc3VibWlzc2lvbnMKCgogICAgICAgICAgICB2YXIgcGFyc2VkUGF0aCA9IHBhcnNlUGF0aChwYXRoKTsKCiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgdmFyIHNlYXJjaFBhcmFtcyA9IGNvbnZlcnRGb3JtRGF0YVRvU2VhcmNoUGFyYW1zKG9wdHMuZm9ybURhdGEpOyAvLyBTaW5jZSBmZXRjaGVyIEdFVCBzdWJtaXNzaW9ucyBvbmx5IHJ1biBhIHNpbmdsZSBsb2FkZXIgKGFzIG9wcG9zZWQgdG8KICAgICAgICAgICAgICAvLyBuYXZpZ2F0aW9uIEdFVCBzdWJtaXNzaW9ucyB3aGljaCBydW4gYWxsIGxvYWRlcnMpLCB3ZSBuZWVkIHRvIHByZXNlcnZlCiAgICAgICAgICAgICAgLy8gYW55IGluY29taW5nID9pbmRleCBwYXJhbXMKCiAgICAgICAgICAgICAgaWYgKGlzRmV0Y2hlciAmJiBwYXJzZWRQYXRoLnNlYXJjaCAmJiBoYXNOYWtlZEluZGV4UXVlcnkocGFyc2VkUGF0aC5zZWFyY2gpKSB7CiAgICAgICAgICAgICAgICBzZWFyY2hQYXJhbXMuYXBwZW5kKCJpbmRleCIsICIiKTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIHBhcnNlZFBhdGguc2VhcmNoID0gIj8iICsgc2VhcmNoUGFyYW1zOwogICAgICAgICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgIHBhdGg6IHBhdGgsCiAgICAgICAgICAgICAgICBlcnJvcjogZ2V0SW50ZXJuYWxSb3V0ZXJFcnJvcig0MDApCiAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICBwYXRoOiByb3V0ZXJfY3JlYXRlUGF0aChwYXJzZWRQYXRoKSwKICAgICAgICAgICAgICBzdWJtaXNzaW9uOiBzdWJtaXNzaW9uCiAgICAgICAgICAgIH07CiAgICAgICAgICB9IC8vIEZpbHRlciBvdXQgYWxsIHJvdXRlcyBiZWxvdyBhbnkgY2F1Z2h0IGVycm9yIGFzIHRoZXkgYXJlbid0IGdvaW5nIHRvCiAgICAgICAgICAvLyByZW5kZXIgc28gd2UgZG9uJ3QgbmVlZCB0byBsb2FkIHRoZW0KCgogICAgICAgICAgZnVuY3Rpb24gZ2V0TG9hZGVyTWF0Y2hlc1VudGlsQm91bmRhcnkobWF0Y2hlcywgYm91bmRhcnlJZCkgewogICAgICAgICAgICB2YXIgYm91bmRhcnlNYXRjaGVzID0gbWF0Y2hlczsKCiAgICAgICAgICAgIGlmIChib3VuZGFyeUlkKSB7CiAgICAgICAgICAgICAgdmFyIGluZGV4ID0gbWF0Y2hlcy5maW5kSW5kZXgoKG0pID0+IG0ucm91dGUuaWQgPT09IGJvdW5kYXJ5SWQpOwoKICAgICAgICAgICAgICBpZiAoaW5kZXggPj0gMCkgewogICAgICAgICAgICAgICAgYm91bmRhcnlNYXRjaGVzID0gbWF0Y2hlcy5zbGljZSgwLCBpbmRleCk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICByZXR1cm4gYm91bmRhcnlNYXRjaGVzOwogICAgICAgICAgfQoKICAgICAgICAgIGZ1bmN0aW9uIGdldE1hdGNoZXNUb0xvYWQoaGlzdG9yeSwgc3RhdGUsIG1hdGNoZXMsIHN1Ym1pc3Npb24sIGxvY2F0aW9uLCBpc1JldmFsaWRhdGlvblJlcXVpcmVkLCBjYW5jZWxsZWREZWZlcnJlZFJvdXRlcywgY2FuY2VsbGVkRmV0Y2hlckxvYWRzLCBwZW5kaW5nQWN0aW9uRGF0YSwgcGVuZGluZ0Vycm9yLCBmZXRjaExvYWRNYXRjaGVzKSB7CiAgICAgICAgICAgIHZhciBhY3Rpb25SZXN1bHQgPSBwZW5kaW5nRXJyb3IgPyBPYmplY3QudmFsdWVzKHBlbmRpbmdFcnJvcilbMF0gOiBwZW5kaW5nQWN0aW9uRGF0YSA/IE9iamVjdC52YWx1ZXMocGVuZGluZ0FjdGlvbkRhdGEpWzBdIDogdW5kZWZpbmVkOyAvLyBQaWNrIG5hdmlnYXRpb24gbWF0Y2hlcyB0aGF0IGFyZSBuZXQtbmV3IG9yIHF1YWxpZnkgZm9yIHJldmFsaWRhdGlvbgoKICAgICAgICAgICAgdmFyIGJvdW5kYXJ5SWQgPSBwZW5kaW5nRXJyb3IgPyBPYmplY3Qua2V5cyhwZW5kaW5nRXJyb3IpWzBdIDogdW5kZWZpbmVkOwogICAgICAgICAgICB2YXIgYm91bmRhcnlNYXRjaGVzID0gZ2V0TG9hZGVyTWF0Y2hlc1VudGlsQm91bmRhcnkobWF0Y2hlcywgYm91bmRhcnlJZCk7CiAgICAgICAgICAgIHZhciBuYXZpZ2F0aW9uTWF0Y2hlcyA9IGJvdW5kYXJ5TWF0Y2hlcy5maWx0ZXIoKG1hdGNoLCBpbmRleCkgPT4gbWF0Y2gucm91dGUubG9hZGVyICE9IG51bGwgJiYgKGlzTmV3TG9hZGVyKHN0YXRlLmxvYWRlckRhdGEsIHN0YXRlLm1hdGNoZXNbaW5kZXhdLCBtYXRjaCkgfHwgLy8gSWYgdGhpcyByb3V0ZSBoYWQgYSBwZW5kaW5nIGRlZmVycmVkIGNhbmNlbGxlZCBpdCBtdXN0IGJlIHJldmFsaWRhdGVkCiAgICAgICAgICAgIGNhbmNlbGxlZERlZmVycmVkUm91dGVzLnNvbWUoKGlkKSA9PiBpZCA9PT0gbWF0Y2gucm91dGUuaWQpIHx8IHNob3VsZFJldmFsaWRhdGVMb2FkZXIoaGlzdG9yeSwgc3RhdGUubG9jYXRpb24sIHN0YXRlLm1hdGNoZXNbaW5kZXhdLCBzdWJtaXNzaW9uLCBsb2NhdGlvbiwgbWF0Y2gsIGlzUmV2YWxpZGF0aW9uUmVxdWlyZWQsIGFjdGlvblJlc3VsdCkpKTsgLy8gUGljayBmZXRjaGVyLmxvYWRzIHRoYXQgbmVlZCB0byBiZSByZXZhbGlkYXRlZAoKICAgICAgICAgICAgdmFyIHJldmFsaWRhdGluZ0ZldGNoZXJzID0gW107CiAgICAgICAgICAgIGZldGNoTG9hZE1hdGNoZXMgJiYgZmV0Y2hMb2FkTWF0Y2hlcy5mb3JFYWNoKChfcmVmMTEsIGtleSkgPT4gewogICAgICAgICAgICAgIHZhciBfcmVmMjggPSBfc2xpY2VkVG9BcnJheTIoX3JlZjExLCAzKSxocmVmID0gX3JlZjI4WzBdLG1hdGNoID0gX3JlZjI4WzFdLGZldGNoTWF0Y2hlcyA9IF9yZWYyOFsyXTsKCiAgICAgICAgICAgICAgLy8gVGhpcyBmZXRjaGVyIHdhcyBjYW5jZWxsZWQgZnJvbSBhIHByaW9yIGFjdGlvbiBzdWJtaXNzaW9uIC0gZm9yY2UgcmVsb2FkCiAgICAgICAgICAgICAgaWYgKGNhbmNlbGxlZEZldGNoZXJMb2Fkcy5pbmNsdWRlcyhrZXkpKSB7CiAgICAgICAgICAgICAgICByZXZhbGlkYXRpbmdGZXRjaGVycy5wdXNoKFtrZXksIGhyZWYsIG1hdGNoLCBmZXRjaE1hdGNoZXNdKTsKICAgICAgICAgICAgICB9IGVsc2UgaWYgKGlzUmV2YWxpZGF0aW9uUmVxdWlyZWQpIHsKICAgICAgICAgICAgICAgIHZhciBzaG91bGRSZXZhbGlkYXRlID0gc2hvdWxkUmV2YWxpZGF0ZUxvYWRlcihoaXN0b3J5LCBocmVmLCBtYXRjaCwgc3VibWlzc2lvbiwgaHJlZiwgbWF0Y2gsIGlzUmV2YWxpZGF0aW9uUmVxdWlyZWQsIGFjdGlvblJlc3VsdCk7CgogICAgICAgICAgICAgICAgaWYgKHNob3VsZFJldmFsaWRhdGUpIHsKICAgICAgICAgICAgICAgICAgcmV2YWxpZGF0aW5nRmV0Y2hlcnMucHVzaChba2V5LCBocmVmLCBtYXRjaCwgZmV0Y2hNYXRjaGVzXSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICAgICAgcmV0dXJuIFtuYXZpZ2F0aW9uTWF0Y2hlcywgcmV2YWxpZGF0aW5nRmV0Y2hlcnNdOwogICAgICAgICAgfQoKICAgICAgICAgIGZ1bmN0aW9uIGlzTmV3TG9hZGVyKGN1cnJlbnRMb2FkZXJEYXRhLCBjdXJyZW50TWF0Y2gsIG1hdGNoKSB7CiAgICAgICAgICAgIHZhciBpc05ldyA9IC8vIFthXSAtPiBbYSwgYl0KICAgICAgICAgICAgIWN1cnJlbnRNYXRjaCB8fCAvLyBbYSwgYl0gLT4gW2EsIGNdCiAgICAgICAgICAgIG1hdGNoLnJvdXRlLmlkICE9PSBjdXJyZW50TWF0Y2gucm91dGUuaWQ7IC8vIEhhbmRsZSB0aGUgY2FzZSB0aGF0IHdlIGRvbid0IGhhdmUgZGF0YSBmb3IgYSByZS11c2VkIHJvdXRlLCBwb3RlbnRpYWxseQogICAgICAgICAgICAvLyBmcm9tIGEgcHJpb3IgZXJyb3Igb3IgZnJvbSBhIGNhbmNlbGxlZCBwZW5kaW5nIGRlZmVycmVkCgogICAgICAgICAgICB2YXIgaXNNaXNzaW5nRGF0YSA9IGN1cnJlbnRMb2FkZXJEYXRhW21hdGNoLnJvdXRlLmlkXSA9PT0gdW5kZWZpbmVkOyAvLyBBbHdheXMgbG9hZCBpZiB0aGlzIGlzIGEgbmV0LW5ldyByb3V0ZSBvciB3ZSBkb24ndCB5ZXQgaGF2ZSBkYXRhCgogICAgICAgICAgICByZXR1cm4gaXNOZXcgfHwgaXNNaXNzaW5nRGF0YTsKICAgICAgICAgIH0KCiAgICAgICAgICBmdW5jdGlvbiBpc05ld1JvdXRlSW5zdGFuY2UoY3VycmVudE1hdGNoLCBtYXRjaCkgewogICAgICAgICAgICB2YXIgY3VycmVudFBhdGggPSBjdXJyZW50TWF0Y2gucm91dGUucGF0aDsKICAgICAgICAgICAgcmV0dXJuICgvLyBwYXJhbSBjaGFuZ2UgZm9yIHRoaXMgbWF0Y2gsIC91c2Vycy8xMjMgLT4gL3VzZXJzLzQ1NgogICAgICAgICAgICAgIGN1cnJlbnRNYXRjaC5wYXRobmFtZSAhPT0gbWF0Y2gucGF0aG5hbWUgfHwgLy8gc3BsYXQgcGFyYW0gY2hhbmdlZCwgd2hpY2ggaXMgbm90IHByZXNlbnQgaW4gbWF0Y2gucGF0aAogICAgICAgICAgICAgIC8vIGUuZy4gL2ZpbGVzL2ltYWdlcy9hdmF0YXIuanBnIC0+IGZpbGVzL2ZpbmFuY2VzLnhscwogICAgICAgICAgICAgIGN1cnJlbnRQYXRoICYmIGN1cnJlbnRQYXRoLmVuZHNXaXRoKCIqIikgJiYgY3VycmVudE1hdGNoLnBhcmFtc1siKiJdICE9PSBtYXRjaC5wYXJhbXNbIioiXSk7CgogICAgICAgICAgfQoKICAgICAgICAgIGZ1bmN0aW9uIHNob3VsZFJldmFsaWRhdGVMb2FkZXIoaGlzdG9yeSwgY3VycmVudExvY2F0aW9uLCBjdXJyZW50TWF0Y2gsIHN1Ym1pc3Npb24sIGxvY2F0aW9uLCBtYXRjaCwgaXNSZXZhbGlkYXRpb25SZXF1aXJlZCwgYWN0aW9uUmVzdWx0KSB7CiAgICAgICAgICAgIHZhciBjdXJyZW50VXJsID0gaGlzdG9yeS5jcmVhdGVVUkwoY3VycmVudExvY2F0aW9uKTsKICAgICAgICAgICAgdmFyIGN1cnJlbnRQYXJhbXMgPSBjdXJyZW50TWF0Y2gucGFyYW1zOwogICAgICAgICAgICB2YXIgbmV4dFVybCA9IGhpc3RvcnkuY3JlYXRlVVJMKGxvY2F0aW9uKTsKICAgICAgICAgICAgdmFyIG5leHRQYXJhbXMgPSBtYXRjaC5wYXJhbXM7IC8vIFRoaXMgaXMgdGhlIGRlZmF1bHQgaW1wbGVtZW50YXRpb24gYXMgdG8gd2hlbiB3ZSByZXZhbGlkYXRlLiAgSWYgdGhlIHJvdXRlCiAgICAgICAgICAgIC8vIHByb3ZpZGVzIGl0J3Mgb3duIGltcGxlbWVudGF0aW9uLCB0aGVuIHdlIGdpdmUgdGhlbSBmdWxsIGNvbnRyb2wgYnV0CiAgICAgICAgICAgIC8vIHByb3ZpZGUgdGhpcyB2YWx1ZSBzbyB0aGV5IGNhbiBsZXZlcmFnZSBpdCBpZiBuZWVkZWQgYWZ0ZXIgdGhleSBjaGVjawogICAgICAgICAgICAvLyB0aGVpciBvd24gc3BlY2lmaWMgdXNlIGNhc2VzCiAgICAgICAgICAgIC8vIE5vdGUgdGhhdCBmZXRjaGVycyBhbHdheXMgcHJvdmlkZSB0aGUgc2FtZSBjdXJyZW50L25leHQgbG9jYXRpb25zIHNvIHRoZQogICAgICAgICAgICAvLyBVUkwtYmFzZWQgY2hlY2tzIGhlcmUgZG9uJ3QgYXBwbHkgdG8gZmV0Y2hlciBzaG91bGRSZXZhbGlkYXRlIGNhbGxzCgogICAgICAgICAgICB2YXIgZGVmYXVsdFNob3VsZFJldmFsaWRhdGUgPSBpc05ld1JvdXRlSW5zdGFuY2UoY3VycmVudE1hdGNoLCBtYXRjaCkgfHwgLy8gQ2xpY2tlZCB0aGUgc2FtZSBsaW5rLCByZXN1Ym1pdHRlZCBhIEdFVCBmb3JtCiAgICAgICAgICAgIGN1cnJlbnRVcmwudG9TdHJpbmcoKSA9PT0gbmV4dFVybC50b1N0cmluZygpIHx8IC8vIFNlYXJjaCBwYXJhbXMgYWZmZWN0IGFsbCBsb2FkZXJzCiAgICAgICAgICAgIGN1cnJlbnRVcmwuc2VhcmNoICE9PSBuZXh0VXJsLnNlYXJjaCB8fCAvLyBGb3JjZWQgcmV2YWxpZGF0aW9uIGR1ZSB0byBzdWJtaXNzaW9uLCB1c2VSZXZhbGlkYXRlLCBvciBYLVJlbWl4LVJldmFsaWRhdGUKICAgICAgICAgICAgaXNSZXZhbGlkYXRpb25SZXF1aXJlZDsKCiAgICAgICAgICAgIGlmIChtYXRjaC5yb3V0ZS5zaG91bGRSZXZhbGlkYXRlKSB7CiAgICAgICAgICAgICAgdmFyIHJvdXRlQ2hvaWNlID0gbWF0Y2gucm91dGUuc2hvdWxkUmV2YWxpZGF0ZShfZXh0ZW5kcyh7CiAgICAgICAgICAgICAgICBjdXJyZW50VXJsOiBjdXJyZW50VXJsLAogICAgICAgICAgICAgICAgY3VycmVudFBhcmFtczogY3VycmVudFBhcmFtcywKICAgICAgICAgICAgICAgIG5leHRVcmw6IG5leHRVcmwsCiAgICAgICAgICAgICAgICBuZXh0UGFyYW1zOiBuZXh0UGFyYW1zCiAgICAgICAgICAgICAgfSwgc3VibWlzc2lvbiwgewogICAgICAgICAgICAgICAgYWN0aW9uUmVzdWx0OiBhY3Rpb25SZXN1bHQsCiAgICAgICAgICAgICAgICBkZWZhdWx0U2hvdWxkUmV2YWxpZGF0ZTogZGVmYXVsdFNob3VsZFJldmFsaWRhdGUKICAgICAgICAgICAgICB9KSk7CgogICAgICAgICAgICAgIGlmICh0eXBlb2Ygcm91dGVDaG9pY2UgPT09ICJib29sZWFuIikgewogICAgICAgICAgICAgICAgcmV0dXJuIHJvdXRlQ2hvaWNlOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuIGRlZmF1bHRTaG91bGRSZXZhbGlkYXRlOwogICAgICAgICAgfWZ1bmN0aW9uCgogICAgICAgICAgY2FsbExvYWRlck9yQWN0aW9uKF94NjEsIF94NjIsIF94NjMsIF94NjQsIF94NjUsIF94NjYsIF94NjcsIF94NjgpIHtyZXR1cm4gX2NhbGxMb2FkZXJPckFjdGlvbi5hcHBseSh0aGlzLCBhcmd1bWVudHMpO30KCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCiAgICAgICAgICAvLyBVdGlsaXR5IG1ldGhvZCBmb3IgY3JlYXRpbmcgdGhlIFJlcXVlc3QgaW5zdGFuY2VzIGZvciBsb2FkZXJzL2FjdGlvbnMgZHVyaW5nCiAgICAgICAgICAvLyBjbGllbnQtc2lkZSBuYXZpZ2F0aW9ucyBhbmQgZmV0Y2hlcy4gIER1cmluZyBTU1Igd2Ugd2lsbCBhbHdheXMgaGF2ZSBhCiAgICAgICAgICAvLyBSZXF1ZXN0IGluc3RhbmNlIGZyb20gdGhlIHN0YXRpYyBoYW5kbGVyIChxdWVyeS9xdWVyeVJvdXRlKQogICAgICAgICAgZnVuY3Rpb24gX2NhbGxMb2FkZXJPckFjdGlvbigpIHtfY2FsbExvYWRlck9yQWN0aW9uID0gX2FzeW5jVG9HZW5lcmF0b3IyKCAvKiNfX1BVUkVfXyovX3JlZ2VuZXJhdG9yUnVudGltZTIoKS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUxNih0eXBlLCByZXF1ZXN0LCBtYXRjaCwgbWF0Y2hlcywgYmFzZW5hbWUsIGlzU3RhdGljUmVxdWVzdCwgaXNSb3V0ZVJlcXVlc3QsIHJlcXVlc3RDb250ZXh0KSB7dmFyIHJlc3VsdFR5cGUsIHJlc3VsdCwgcmVqZWN0LCBhYm9ydFByb21pc2UsIG9uUmVqZWN0LCBoYW5kbGVyLCBzdGF0dXMsIGxvY2F0aW9uLCBpc0Fic29sdXRlLCBhY3RpdmVNYXRjaGVzLCByb3V0ZVBhdGhuYW1lcywgcmVzb2x2ZWRMb2NhdGlvbiwgcGF0aCwgY3VycmVudFVybCwgdXJsLCBkYXRhLCBjb250ZW50VHlwZTtyZXR1cm4gX3JlZ2VuZXJhdG9yUnVudGltZTIoKS53cmFwKGZ1bmN0aW9uIF9jYWxsZWUxNiQoX2NvbnRleHQxNykge3doaWxlICgxKSBzd2l0Y2ggKF9jb250ZXh0MTcucHJldiA9IF9jb250ZXh0MTcubmV4dCkge2Nhc2UgMDppZiAoYmFzZW5hbWUgPT09IHZvaWQgMCkge2Jhc2VuYW1lID0gIi8iO31pZiAoaXNTdGF0aWNSZXF1ZXN0ID09PSB2b2lkIDApIHtpc1N0YXRpY1JlcXVlc3QgPSBmYWxzZTt9aWYgKGlzUm91dGVSZXF1ZXN0ID09PSB2b2lkIDApIHtpc1JvdXRlUmVxdWVzdCA9IGZhbHNlO31hYm9ydFByb21pc2UgPSBuZXcgUHJvbWlzZSgoXywgcikgPT4gcmVqZWN0ID0gcik7b25SZWplY3QgPSAoKSA9PiByZWplY3QoKTtyZXF1ZXN0LnNpZ25hbC5hZGRFdmVudExpc3RlbmVyKCJhYm9ydCIsIG9uUmVqZWN0KTtfY29udGV4dDE3LnByZXYgPSA2O2hhbmRsZXIgPSBtYXRjaC5yb3V0ZVt0eXBlXTtyb3V0ZXJfaW52YXJpYW50KGhhbmRsZXIsICJDb3VsZCBub3QgZmluZCB0aGUgIiArIHR5cGUgKyAiIHRvIHJ1biBvbiB0aGUgXCIiICsgbWF0Y2gucm91dGUuaWQgKyAiXCIgcm91dGUiKTtfY29udGV4dDE3Lm5leHQgPSAxMTtyZXR1cm4gUHJvbWlzZS5yYWNlKFtoYW5kbGVyKHsgcmVxdWVzdDogcmVxdWVzdCwgcGFyYW1zOiBtYXRjaC5wYXJhbXMsIGNvbnRleHQ6IHJlcXVlc3RDb250ZXh0IH0pLCBhYm9ydFByb21pc2VdKTtjYXNlIDExOnJlc3VsdCA9IF9jb250ZXh0MTcuc2VudDtyb3V0ZXJfaW52YXJpYW50KHJlc3VsdCAhPT0gdW5kZWZpbmVkLCAiWW91IGRlZmluZWQgIiArICh0eXBlID09PSAiYWN0aW9uIiA/ICJhbiBhY3Rpb24iIDogImEgbG9hZGVyIikgKyAiIGZvciByb3V0ZSAiICsgKCJcIiIgKyBtYXRjaC5yb3V0ZS5pZCArICJcIiBidXQgZGlkbid0IHJldHVybiBhbnl0aGluZyBmcm9tIHlvdXIgYCIgKyB0eXBlICsgImAgIikgKyAiZnVuY3Rpb24uIFBsZWFzZSByZXR1cm4gYSB2YWx1ZSBvciBgbnVsbGAuIik7X2NvbnRleHQxNy5uZXh0ID0gMTk7YnJlYWs7Y2FzZSAxNTpfY29udGV4dDE3LnByZXYgPSAxNTtfY29udGV4dDE3LnQwID0gX2NvbnRleHQxN1siY2F0Y2giXSg2KTtyZXN1bHRUeXBlID0gUmVzdWx0VHlwZS5lcnJvcjtyZXN1bHQgPSBfY29udGV4dDE3LnQwO2Nhc2UgMTk6X2NvbnRleHQxNy5wcmV2ID0gMTk7cmVxdWVzdC5zaWduYWwucmVtb3ZlRXZlbnRMaXN0ZW5lcigiYWJvcnQiLCBvblJlamVjdCk7cmV0dXJuIF9jb250ZXh0MTcuZmluaXNoKDE5KTtjYXNlIDIyOmlmICghaXNSZXNwb25zZShyZXN1bHQpKSB7X2NvbnRleHQxNy5uZXh0ID0gNDg7YnJlYWs7fXN0YXR1cyA9IHJlc3VsdC5zdGF0dXM7IC8vIFByb2Nlc3MgcmVkaXJlY3RzCiAgICAgICAgICAgICAgICAgICAgaWYgKCFyZWRpcmVjdFN0YXR1c0NvZGVzLmhhcyhzdGF0dXMpKSB7X2NvbnRleHQxNy5uZXh0ID0gMzM7YnJlYWs7fWxvY2F0aW9uID0gcmVzdWx0LmhlYWRlcnMuZ2V0KCJMb2NhdGlvbiIpO3JvdXRlcl9pbnZhcmlhbnQobG9jYXRpb24sICJSZWRpcmVjdHMgcmV0dXJuZWQvdGhyb3duIGZyb20gbG9hZGVycy9hY3Rpb25zIG11c3QgaGF2ZSBhIExvY2F0aW9uIGhlYWRlciIpO2lzQWJzb2x1dGUgPSAvXig/OlthLXpdW2EtejAtOSsuLV0qOnxcL1wvKS9pLnRlc3QobG9jYXRpb24pOyAvLyBTdXBwb3J0IHJlbGF0aXZlIHJvdXRpbmcgaW4gaW50ZXJuYWwgcmVkaXJlY3RzCiAgICAgICAgICAgICAgICAgICAgaWYgKCFpc0Fic29sdXRlKSB7YWN0aXZlTWF0Y2hlcyA9IG1hdGNoZXMuc2xpY2UoMCwgbWF0Y2hlcy5pbmRleE9mKG1hdGNoKSArIDEpO3JvdXRlUGF0aG5hbWVzID0gZ2V0UGF0aENvbnRyaWJ1dGluZ01hdGNoZXMoYWN0aXZlTWF0Y2hlcykubWFwKChtYXRjaCkgPT4gbWF0Y2gucGF0aG5hbWVCYXNlKTtyZXNvbHZlZExvY2F0aW9uID0gcmVzb2x2ZVRvKGxvY2F0aW9uLCByb3V0ZVBhdGhuYW1lcywgbmV3IFVSTChyZXF1ZXN0LnVybCkucGF0aG5hbWUpO3JvdXRlcl9pbnZhcmlhbnQocm91dGVyX2NyZWF0ZVBhdGgocmVzb2x2ZWRMb2NhdGlvbiksICJVbmFibGUgdG8gcmVzb2x2ZSByZWRpcmVjdCBsb2NhdGlvbjogIiArIGxvY2F0aW9uKTsgLy8gUHJlcGVuZCB0aGUgYmFzZW5hbWUgdG8gdGhlIHJlZGlyZWN0IGxvY2F0aW9uIGlmIHdlIGhhdmUgb25lCiAgICAgICAgICAgICAgICAgICAgICBpZiAoYmFzZW5hbWUpIHtwYXRoID0gcmVzb2x2ZWRMb2NhdGlvbi5wYXRobmFtZTtyZXNvbHZlZExvY2F0aW9uLnBhdGhuYW1lID0gcGF0aCA9PT0gIi8iID8gYmFzZW5hbWUgOiByb3V0ZXJfam9pblBhdGhzKFtiYXNlbmFtZSwgcGF0aF0pO31sb2NhdGlvbiA9IHJvdXRlcl9jcmVhdGVQYXRoKHJlc29sdmVkTG9jYXRpb24pO30gZWxzZSBpZiAoIWlzU3RhdGljUmVxdWVzdCkgey8vIFN0cmlwIG9mZiB0aGUgcHJvdG9jb2wrb3JpZ2luIGZvciBzYW1lLW9yaWdpbiBhYnNvbHV0ZSByZWRpcmVjdHMuCiAgICAgICAgICAgICAgICAgICAgICAvLyBJZiB0aGlzIGlzIGEgc3RhdGljIHJlcXVlcywgd2UgY2FuIGxldCBpdCBnbyBiYWNrIHRvIHRoZSBicm93c2VyCiAgICAgICAgICAgICAgICAgICAgICAvLyBhcy1pcwogICAgICAgICAgICAgICAgICAgICAgY3VycmVudFVybCA9IG5ldyBVUkwocmVxdWVzdC51cmwpO3VybCA9IGxvY2F0aW9uLnN0YXJ0c1dpdGgoIi8vIikgPyBuZXcgVVJMKGN1cnJlbnRVcmwucHJvdG9jb2wgKyBsb2NhdGlvbikgOiBuZXcgVVJMKGxvY2F0aW9uKTtpZiAodXJsLm9yaWdpbiA9PT0gY3VycmVudFVybC5vcmlnaW4pIHtsb2NhdGlvbiA9IHVybC5wYXRobmFtZSArIHVybC5zZWFyY2ggKyB1cmwuaGFzaDt9fSAvLyBEb24ndCBwcm9jZXNzIHJlZGlyZWN0cyBpbiB0aGUgcm91dGVyIGR1cmluZyBzdGF0aWMgcmVxdWVzdHMgcmVxdWVzdHMuCiAgICAgICAgICAgICAgICAgICAgLy8gSW5zdGVhZCwgdGhyb3cgdGhlIFJlc3BvbnNlIGFuZCBsZXQgdGhlIHNlcnZlciBoYW5kbGUgaXQgd2l0aCBhbiBIVFRQCiAgICAgICAgICAgICAgICAgICAgLy8gcmVkaXJlY3QuICBXZSBhbHNvIHVwZGF0ZSB0aGUgTG9jYXRpb24gaGVhZGVyIGluIHBsYWNlIGluIHRoaXMgZmxvdyBzbwogICAgICAgICAgICAgICAgICAgIC8vIGJhc2VuYW1lIGFuZCByZWxhdGl2ZSByb3V0aW5nIGlzIHRha2VuIGludG8gYWNjb3VudAogICAgICAgICAgICAgICAgICAgIGlmICghaXNTdGF0aWNSZXF1ZXN0KSB7X2NvbnRleHQxNy5uZXh0ID0gMzI7YnJlYWs7fXJlc3VsdC5oZWFkZXJzLnNldCgiTG9jYXRpb24iLCBsb2NhdGlvbik7dGhyb3cgcmVzdWx0O2Nhc2UgMzI6cmV0dXJuIF9jb250ZXh0MTcuYWJydXB0KCJyZXR1cm4iLCB7IHR5cGU6IFJlc3VsdFR5cGUucmVkaXJlY3QsIHN0YXR1czogc3RhdHVzLCBsb2NhdGlvbjogbG9jYXRpb24sIHJldmFsaWRhdGU6IHJlc3VsdC5oZWFkZXJzLmdldCgiWC1SZW1peC1SZXZhbGlkYXRlIikgIT09IG51bGwgfSk7Y2FzZSAzMzppZiAoIWlzUm91dGVSZXF1ZXN0KSB7X2NvbnRleHQxNy5uZXh0ID0gMzU7YnJlYWs7fXRocm93IHsgdHlwZTogcmVzdWx0VHlwZSB8fCBSZXN1bHRUeXBlLmRhdGEsIHJlc3BvbnNlOiByZXN1bHQgfTtjYXNlIDM1OmNvbnRlbnRUeXBlID0gcmVzdWx0LmhlYWRlcnMuZ2V0KCJDb250ZW50LVR5cGUiKTsgLy8gQ2hlY2sgYmV0d2VlbiB3b3JkIGJvdW5kYXJpZXMgaW5zdGVhZCBvZiBzdGFydHNXaXRoKCkgZHVlIHRvIHRoZSBsYXN0CiAgICAgICAgICAgICAgICAgICAgLy8gcGFyYWdyYXBoIG9mIGh0dHBzOi8vaHR0cHdnLm9yZy9zcGVjcy9yZmM5MTEwLmh0bWwjZmllbGQuY29udGVudC10eXBlCiAgICAgICAgICAgICAgICAgICAgaWYgKCEoY29udGVudFR5cGUgJiYgL1xiYXBwbGljYXRpb25cL2pzb25cYi8udGVzdChjb250ZW50VHlwZSkpKSB7X2NvbnRleHQxNy5uZXh0ID0gNDI7YnJlYWs7fV9jb250ZXh0MTcubmV4dCA9IDM5O3JldHVybiByZXN1bHQuanNvbigpO2Nhc2UgMzk6ZGF0YSA9IF9jb250ZXh0MTcuc2VudDtfY29udGV4dDE3Lm5leHQgPSA0NTticmVhaztjYXNlIDQyOl9jb250ZXh0MTcubmV4dCA9IDQ0O3JldHVybiByZXN1bHQudGV4dCgpO2Nhc2UgNDQ6ZGF0YSA9IF9jb250ZXh0MTcuc2VudDtjYXNlIDQ1OmlmICghKHJlc3VsdFR5cGUgPT09IFJlc3VsdFR5cGUuZXJyb3IpKSB7X2NvbnRleHQxNy5uZXh0ID0gNDc7YnJlYWs7fXJldHVybiBfY29udGV4dDE3LmFicnVwdCgicmV0dXJuIiwgeyB0eXBlOiByZXN1bHRUeXBlLCBlcnJvcjogbmV3IHJvdXRlcl9FcnJvclJlc3BvbnNlKHN0YXR1cywgcmVzdWx0LnN0YXR1c1RleHQsIGRhdGEpLCBoZWFkZXJzOiByZXN1bHQuaGVhZGVycyB9KTtjYXNlIDQ3OnJldHVybiBfY29udGV4dDE3LmFicnVwdCgicmV0dXJuIiwgeyB0eXBlOiBSZXN1bHRUeXBlLmRhdGEsIGRhdGE6IGRhdGEsIHN0YXR1c0NvZGU6IHJlc3VsdC5zdGF0dXMsIGhlYWRlcnM6IHJlc3VsdC5oZWFkZXJzIH0pO2Nhc2UgNDg6aWYgKCEocmVzdWx0VHlwZSA9PT0gUmVzdWx0VHlwZS5lcnJvcikpIHtfY29udGV4dDE3Lm5leHQgPSA1MDticmVhazt9cmV0dXJuIF9jb250ZXh0MTcuYWJydXB0KCJyZXR1cm4iLCB7IHR5cGU6IHJlc3VsdFR5cGUsIGVycm9yOiByZXN1bHQgfSk7Y2FzZSA1MDppZiAoIShyZXN1bHQgaW5zdGFuY2VvZiBEZWZlcnJlZERhdGEpKSB7X2NvbnRleHQxNy5uZXh0ID0gNTI7YnJlYWs7fXJldHVybiBfY29udGV4dDE3LmFicnVwdCgicmV0dXJuIiwgeyB0eXBlOiBSZXN1bHRUeXBlLmRlZmVycmVkLCBkZWZlcnJlZERhdGE6IHJlc3VsdCB9KTtjYXNlIDUyOnJldHVybiBfY29udGV4dDE3LmFicnVwdCgicmV0dXJuIiwgeyB0eXBlOiBSZXN1bHRUeXBlLmRhdGEsIGRhdGE6IHJlc3VsdCB9KTtjYXNlIDUzOmNhc2UgImVuZCI6cmV0dXJuIF9jb250ZXh0MTcuc3RvcCgpO319LCBfY2FsbGVlMTYsIG51bGwsIFtbNiwgMTUsIDE5LCAyMl1dKTt9KSk7cmV0dXJuIF9jYWxsTG9hZGVyT3JBY3Rpb24uYXBwbHkodGhpcywgYXJndW1lbnRzKTt9ZnVuY3Rpb24gY3JlYXRlQ2xpZW50U2lkZVJlcXVlc3QoaGlzdG9yeSwgbG9jYXRpb24sIHNpZ25hbCwgc3VibWlzc2lvbikge3ZhciB1cmwgPSBoaXN0b3J5LmNyZWF0ZVVSTChzdHJpcEhhc2hGcm9tUGF0aChsb2NhdGlvbikpLnRvU3RyaW5nKCk7dmFyIGluaXQgPSB7IHNpZ25hbDogc2lnbmFsIH07aWYgKHN1Ym1pc3Npb24gJiYgaXNNdXRhdGlvbk1ldGhvZChzdWJtaXNzaW9uLmZvcm1NZXRob2QpKSB7dmFyIGZvcm1NZXRob2QgPQogICAgICAgICAgICAgICAgc3VibWlzc2lvbi5mb3JtTWV0aG9kLGZvcm1FbmNUeXBlID0gc3VibWlzc2lvbi5mb3JtRW5jVHlwZSxmb3JtRGF0YSA9IHN1Ym1pc3Npb24uZm9ybURhdGE7CiAgICAgICAgICAgICAgaW5pdC5tZXRob2QgPSBmb3JtTWV0aG9kLnRvVXBwZXJDYXNlKCk7CiAgICAgICAgICAgICAgaW5pdC5ib2R5ID0gZm9ybUVuY1R5cGUgPT09ICJhcHBsaWNhdGlvbi94LXd3dy1mb3JtLXVybGVuY29kZWQiID8gY29udmVydEZvcm1EYXRhVG9TZWFyY2hQYXJhbXMoZm9ybURhdGEpIDogZm9ybURhdGE7CiAgICAgICAgICAgIH0gLy8gQ29udGVudC1UeXBlIGlzIGluZmVycmVkIChodHRwczovL2ZldGNoLnNwZWMud2hhdHdnLm9yZy8jZG9tLXJlcXVlc3QpCgoKICAgICAgICAgICAgcmV0dXJuIG5ldyBSZXF1ZXN0KHVybCwgaW5pdCk7CiAgICAgICAgICB9CgogICAgICAgICAgZnVuY3Rpb24gY29udmVydEZvcm1EYXRhVG9TZWFyY2hQYXJhbXMoZm9ybURhdGEpIHsKICAgICAgICAgICAgdmFyIHNlYXJjaFBhcmFtcyA9IG5ldyBVUkxTZWFyY2hQYXJhbXMoKTt2YXIgX2l0ZXJhdG9yOCA9IF9jcmVhdGVGb3JPZkl0ZXJhdG9ySGVscGVyMigKCiAgICAgICAgICAgICAgZm9ybURhdGEuZW50cmllcygpKSxfc3RlcDg7dHJ5IHtmb3IgKF9pdGVyYXRvcjgucygpOyAhKF9zdGVwOCA9IF9pdGVyYXRvcjgubigpKS5kb25lOykge3ZhciBfc3RlcDgkdmFsdWUgPSBfc2xpY2VkVG9BcnJheTIoX3N0ZXA4LnZhbHVlLCAyKSxrZXkgPSBfc3RlcDgkdmFsdWVbMF0sdmFsdWUgPSBfc3RlcDgkdmFsdWVbMV07CiAgICAgICAgICAgICAgICByb3V0ZXJfaW52YXJpYW50KHR5cGVvZiB2YWx1ZSA9PT0gInN0cmluZyIsICdGaWxlIGlucHV0cyBhcmUgbm90IHN1cHBvcnRlZCB3aXRoIGVuY1R5cGUgImFwcGxpY2F0aW9uL3gtd3d3LWZvcm0tdXJsZW5jb2RlZCIsICcgKyAncGxlYXNlIHVzZSAibXVsdGlwYXJ0L2Zvcm0tZGF0YSIgaW5zdGVhZC4nKTsKICAgICAgICAgICAgICAgIHNlYXJjaFBhcmFtcy5hcHBlbmQoa2V5LCB2YWx1ZSk7CiAgICAgICAgICAgICAgfX0gY2F0Y2ggKGVycikge19pdGVyYXRvcjguZShlcnIpO30gZmluYWxseSB7X2l0ZXJhdG9yOC5mKCk7fQoKICAgICAgICAgICAgcmV0dXJuIHNlYXJjaFBhcmFtczsKICAgICAgICAgIH0KCiAgICAgICAgICBmdW5jdGlvbiBwcm9jZXNzUm91dGVMb2FkZXJEYXRhKG1hdGNoZXMsIG1hdGNoZXNUb0xvYWQsIHJlc3VsdHMsIHBlbmRpbmdFcnJvciwgYWN0aXZlRGVmZXJyZWRzKSB7CiAgICAgICAgICAgIC8vIEZpbGwgaW4gbG9hZGVyRGF0YS9lcnJvcnMgZnJvbSBvdXIgbG9hZGVycwogICAgICAgICAgICB2YXIgbG9hZGVyRGF0YSA9IHt9OwogICAgICAgICAgICB2YXIgZXJyb3JzID0gbnVsbDsKICAgICAgICAgICAgdmFyIHN0YXR1c0NvZGU7CiAgICAgICAgICAgIHZhciBmb3VuZEVycm9yID0gZmFsc2U7CiAgICAgICAgICAgIHZhciBsb2FkZXJIZWFkZXJzID0ge307IC8vIFByb2Nlc3MgbG9hZGVyIHJlc3VsdHMgaW50byBzdGF0ZS5sb2FkZXJEYXRhL3N0YXRlLmVycm9ycwoKICAgICAgICAgICAgcmVzdWx0cy5mb3JFYWNoKChyZXN1bHQsIGluZGV4KSA9PiB7CiAgICAgICAgICAgICAgdmFyIGlkID0gbWF0Y2hlc1RvTG9hZFtpbmRleF0ucm91dGUuaWQ7CiAgICAgICAgICAgICAgcm91dGVyX2ludmFyaWFudCghaXNSZWRpcmVjdFJlc3VsdChyZXN1bHQpLCAiQ2Fubm90IGhhbmRsZSByZWRpcmVjdCByZXN1bHRzIGluIHByb2Nlc3NMb2FkZXJEYXRhIik7CgogICAgICAgICAgICAgIGlmIChpc0Vycm9yUmVzdWx0KHJlc3VsdCkpIHsKICAgICAgICAgICAgICAgIC8vIExvb2sgdXB3YXJkcyBmcm9tIHRoZSBtYXRjaGVkIHJvdXRlIGZvciB0aGUgY2xvc2VzdCBhbmNlc3RvcgogICAgICAgICAgICAgICAgLy8gZXJyb3IgYm91bmRhcnksIGRlZmF1bHRpbmcgdG8gdGhlIHJvb3QgbWF0Y2gKICAgICAgICAgICAgICAgIHZhciBib3VuZGFyeU1hdGNoID0gZmluZE5lYXJlc3RCb3VuZGFyeShtYXRjaGVzLCBpZCk7CiAgICAgICAgICAgICAgICB2YXIgZXJyb3IgPSByZXN1bHQuZXJyb3I7IC8vIElmIHdlIGhhdmUgYSBwZW5kaW5nIGFjdGlvbiBlcnJvciwgd2UgcmVwb3J0IGl0IGF0IHRoZSBoaWdoZXN0LXJvdXRlCiAgICAgICAgICAgICAgICAvLyB0aGF0IHRocm93cyBhIGxvYWRlciBlcnJvciwgYW5kIHRoZW4gY2xlYXIgaXQgb3V0IHRvIGluZGljYXRlIHRoYXQKICAgICAgICAgICAgICAgIC8vIGl0IHdhcyBjb25zdW1lZAoKICAgICAgICAgICAgICAgIGlmIChwZW5kaW5nRXJyb3IpIHsKICAgICAgICAgICAgICAgICAgZXJyb3IgPSBPYmplY3QudmFsdWVzKHBlbmRpbmdFcnJvcilbMF07CiAgICAgICAgICAgICAgICAgIHBlbmRpbmdFcnJvciA9IHVuZGVmaW5lZDsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBlcnJvcnMgPSBlcnJvcnMgfHwge307IC8vIFByZWZlciBoaWdoZXIgZXJyb3IgdmFsdWVzIGlmIGxvd2VyIGVycm9ycyBidWJibGUgdG8gdGhlIHNhbWUgYm91bmRhcnkKCiAgICAgICAgICAgICAgICBpZiAoZXJyb3JzW2JvdW5kYXJ5TWF0Y2gucm91dGUuaWRdID09IG51bGwpIHsKICAgICAgICAgICAgICAgICAgZXJyb3JzW2JvdW5kYXJ5TWF0Y2gucm91dGUuaWRdID0gZXJyb3I7CiAgICAgICAgICAgICAgICB9IC8vIENsZWFyIG91ciBhbnkgcHJpb3IgbG9hZGVyRGF0YSBmb3IgdGhlIHRocm93aW5nIHJvdXRlCgoKICAgICAgICAgICAgICAgIGxvYWRlckRhdGFbaWRdID0gdW5kZWZpbmVkOyAvLyBPbmNlIHdlIGZpbmQgb3VyIGZpcnN0IChoaWdoZXN0KSBlcnJvciwgd2Ugc2V0IHRoZSBzdGF0dXMgY29kZSBhbmQKICAgICAgICAgICAgICAgIC8vIHByZXZlbnQgZGVlcGVyIHN0YXR1cyBjb2RlcyBmcm9tIG92ZXJyaWRpbmcKCiAgICAgICAgICAgICAgICBpZiAoIWZvdW5kRXJyb3IpIHsKICAgICAgICAgICAgICAgICAgZm91bmRFcnJvciA9IHRydWU7CiAgICAgICAgICAgICAgICAgIHN0YXR1c0NvZGUgPSBpc1JvdXRlRXJyb3JSZXNwb25zZShyZXN1bHQuZXJyb3IpID8gcmVzdWx0LmVycm9yLnN0YXR1cyA6IDUwMDsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBpZiAocmVzdWx0LmhlYWRlcnMpIHsKICAgICAgICAgICAgICAgICAgbG9hZGVySGVhZGVyc1tpZF0gPSByZXN1bHQuaGVhZGVyczsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgaWYgKGlzRGVmZXJyZWRSZXN1bHQocmVzdWx0KSkgewogICAgICAgICAgICAgICAgICBhY3RpdmVEZWZlcnJlZHMuc2V0KGlkLCByZXN1bHQuZGVmZXJyZWREYXRhKTsKICAgICAgICAgICAgICAgICAgbG9hZGVyRGF0YVtpZF0gPSByZXN1bHQuZGVmZXJyZWREYXRhLmRhdGE7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICBsb2FkZXJEYXRhW2lkXSA9IHJlc3VsdC5kYXRhOwogICAgICAgICAgICAgICAgfSAvLyBFcnJvciBzdGF0dXMgY29kZXMgYWx3YXlzIG92ZXJyaWRlIHN1Y2Nlc3Mgc3RhdHVzIGNvZGVzLCBidXQgaWYgYWxsCiAgICAgICAgICAgICAgICAvLyBsb2FkZXJzIGFyZSBzdWNjZXNzZnVsIHdlIHRha2UgdGhlIGRlZXBlc3Qgc3RhdHVzIGNvZGUuCgoKICAgICAgICAgICAgICAgIGlmIChyZXN1bHQuc3RhdHVzQ29kZSAhPSBudWxsICYmIHJlc3VsdC5zdGF0dXNDb2RlICE9PSAyMDAgJiYgIWZvdW5kRXJyb3IpIHsKICAgICAgICAgICAgICAgICAgc3RhdHVzQ29kZSA9IHJlc3VsdC5zdGF0dXNDb2RlOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGlmIChyZXN1bHQuaGVhZGVycykgewogICAgICAgICAgICAgICAgICBsb2FkZXJIZWFkZXJzW2lkXSA9IHJlc3VsdC5oZWFkZXJzOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7IC8vIElmIHdlIGRpZG4ndCBjb25zdW1lIHRoZSBwZW5kaW5nIGFjdGlvbiBlcnJvciAoaS5lLiwgYWxsIGxvYWRlcnMKICAgICAgICAgICAgLy8gcmVzb2x2ZWQpLCB0aGVuIGNvbnN1bWUgaXQgaGVyZS4gIEFsc28gY2xlYXIgb3V0IGFueSBsb2FkZXJEYXRhIGZvciB0aGUKICAgICAgICAgICAgLy8gdGhyb3dpbmcgcm91dGUKCiAgICAgICAgICAgIGlmIChwZW5kaW5nRXJyb3IpIHsKICAgICAgICAgICAgICBlcnJvcnMgPSBwZW5kaW5nRXJyb3I7CiAgICAgICAgICAgICAgbG9hZGVyRGF0YVtPYmplY3Qua2V5cyhwZW5kaW5nRXJyb3IpWzBdXSA9IHVuZGVmaW5lZDsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICBsb2FkZXJEYXRhOiBsb2FkZXJEYXRhLAogICAgICAgICAgICAgIGVycm9yczogZXJyb3JzLAogICAgICAgICAgICAgIHN0YXR1c0NvZGU6IHN0YXR1c0NvZGUgfHwgMjAwLAogICAgICAgICAgICAgIGxvYWRlckhlYWRlcnM6IGxvYWRlckhlYWRlcnMKICAgICAgICAgICAgfTsKICAgICAgICAgIH0KCiAgICAgICAgICBmdW5jdGlvbiBwcm9jZXNzTG9hZGVyRGF0YShzdGF0ZSwgbWF0Y2hlcywgbWF0Y2hlc1RvTG9hZCwgcmVzdWx0cywgcGVuZGluZ0Vycm9yLCByZXZhbGlkYXRpbmdGZXRjaGVycywgZmV0Y2hlclJlc3VsdHMsIGFjdGl2ZURlZmVycmVkcykgewogICAgICAgICAgICB2YXIgX3Byb2Nlc3NSb3V0ZUxvYWRlckRhID0KCgogICAgICAgICAgICAgIHByb2Nlc3NSb3V0ZUxvYWRlckRhdGEobWF0Y2hlcywgbWF0Y2hlc1RvTG9hZCwgcmVzdWx0cywgcGVuZGluZ0Vycm9yLCBhY3RpdmVEZWZlcnJlZHMpLGxvYWRlckRhdGEgPSBfcHJvY2Vzc1JvdXRlTG9hZGVyRGEubG9hZGVyRGF0YSxlcnJvcnMgPSBfcHJvY2Vzc1JvdXRlTG9hZGVyRGEuZXJyb3JzOyAvLyBQcm9jZXNzIHJlc3VsdHMgZnJvbSBvdXIgcmV2YWxpZGF0aW5nIGZldGNoZXJzCgogICAgICAgICAgICBmb3IgKHZhciBpbmRleCA9IDA7IGluZGV4IDwgcmV2YWxpZGF0aW5nRmV0Y2hlcnMubGVuZ3RoOyBpbmRleCsrKSB7CiAgICAgICAgICAgICAgdmFyIF9yZXZhbGlkYXRpbmdGZXRjaGVycyA9IF9zbGljZWRUb0FycmF5MihyZXZhbGlkYXRpbmdGZXRjaGVyc1tpbmRleF0sIDMpLGtleSA9IF9yZXZhbGlkYXRpbmdGZXRjaGVyc1swXSxtYXRjaCA9IF9yZXZhbGlkYXRpbmdGZXRjaGVyc1syXTsKICAgICAgICAgICAgICByb3V0ZXJfaW52YXJpYW50KGZldGNoZXJSZXN1bHRzICE9PSB1bmRlZmluZWQgJiYgZmV0Y2hlclJlc3VsdHNbaW5kZXhdICE9PSB1bmRlZmluZWQsICJEaWQgbm90IGZpbmQgY29ycmVzcG9uZGluZyBmZXRjaGVyIHJlc3VsdCIpOwogICAgICAgICAgICAgIHZhciByZXN1bHQgPSBmZXRjaGVyUmVzdWx0c1tpbmRleF07IC8vIFByb2Nlc3MgZmV0Y2hlciBub24tcmVkaXJlY3QgZXJyb3JzCgogICAgICAgICAgICAgIGlmIChpc0Vycm9yUmVzdWx0KHJlc3VsdCkpIHsKICAgICAgICAgICAgICAgIHZhciBib3VuZGFyeU1hdGNoID0gZmluZE5lYXJlc3RCb3VuZGFyeShzdGF0ZS5tYXRjaGVzLCBtYXRjaC5yb3V0ZS5pZCk7CgogICAgICAgICAgICAgICAgaWYgKCEoZXJyb3JzICYmIGVycm9yc1tib3VuZGFyeU1hdGNoLnJvdXRlLmlkXSkpIHsKICAgICAgICAgICAgICAgICAgZXJyb3JzID0gX2V4dGVuZHMoe30sIGVycm9ycywgX2RlZmluZVByb3BlcnR5Mih7fSwKICAgICAgICAgICAgICAgICAgYm91bmRhcnlNYXRjaC5yb3V0ZS5pZCwgcmVzdWx0LmVycm9yKSk7CgogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHN0YXRlLmZldGNoZXJzLmRlbGV0ZShrZXkpOwogICAgICAgICAgICAgIH0gZWxzZSBpZiAoaXNSZWRpcmVjdFJlc3VsdChyZXN1bHQpKSB7CiAgICAgICAgICAgICAgICAvLyBTaG91bGQgbmV2ZXIgZ2V0IGhlcmUsIHJlZGlyZWN0cyBzaG91bGQgZ2V0IHByb2Nlc3NlZCBhYm92ZSwgYnV0IHdlCiAgICAgICAgICAgICAgICAvLyBrZWVwIHRoaXMgdG8gdHlwZSBuYXJyb3cgdG8gYSBzdWNjZXNzIHJlc3VsdCBpbiB0aGUgZWxzZQogICAgICAgICAgICAgICAgcm91dGVyX2ludmFyaWFudChmYWxzZSwgIlVuaGFuZGxlZCBmZXRjaGVyIHJldmFsaWRhdGlvbiByZWRpcmVjdCIpOwogICAgICAgICAgICAgIH0gZWxzZSBpZiAoaXNEZWZlcnJlZFJlc3VsdChyZXN1bHQpKSB7CiAgICAgICAgICAgICAgICAvLyBTaG91bGQgbmV2ZXIgZ2V0IGhlcmUsIGRlZmVycmVkIGRhdGEgc2hvdWxkIGJlIGF3YWl0ZWQgZm9yIGZldGNoZXJzCiAgICAgICAgICAgICAgICAvLyBpbiByZXNvbHZlRGVmZXJyZWRSZXN1bHRzCiAgICAgICAgICAgICAgICByb3V0ZXJfaW52YXJpYW50KGZhbHNlLCAiVW5oYW5kbGVkIGZldGNoZXIgZGVmZXJyZWQgZGF0YSIpOwogICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICB2YXIgZG9uZUZldGNoZXIgPSB7CiAgICAgICAgICAgICAgICAgIHN0YXRlOiAiaWRsZSIsCiAgICAgICAgICAgICAgICAgIGRhdGE6IHJlc3VsdC5kYXRhLAogICAgICAgICAgICAgICAgICBmb3JtTWV0aG9kOiB1bmRlZmluZWQsCiAgICAgICAgICAgICAgICAgIGZvcm1BY3Rpb246IHVuZGVmaW5lZCwKICAgICAgICAgICAgICAgICAgZm9ybUVuY1R5cGU6IHVuZGVmaW5lZCwKICAgICAgICAgICAgICAgICAgZm9ybURhdGE6IHVuZGVmaW5lZCwKICAgICAgICAgICAgICAgICAgIiBfaGFzRmV0Y2hlckRvbmVBbnl0aGluZyAiOiB0cnVlCiAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgc3RhdGUuZmV0Y2hlcnMuc2V0KGtleSwgZG9uZUZldGNoZXIpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICBsb2FkZXJEYXRhOiBsb2FkZXJEYXRhLAogICAgICAgICAgICAgIGVycm9yczogZXJyb3JzCiAgICAgICAgICAgIH07CiAgICAgICAgICB9CgogICAgICAgICAgZnVuY3Rpb24gbWVyZ2VMb2FkZXJEYXRhKGxvYWRlckRhdGEsIG5ld0xvYWRlckRhdGEsIG1hdGNoZXMsIGVycm9ycykgewogICAgICAgICAgICB2YXIgbWVyZ2VkTG9hZGVyRGF0YSA9IF9leHRlbmRzKHt9LCBuZXdMb2FkZXJEYXRhKTt2YXIgX2l0ZXJhdG9yOSA9IF9jcmVhdGVGb3JPZkl0ZXJhdG9ySGVscGVyMigKCiAgICAgICAgICAgICAgbWF0Y2hlcyksX3N0ZXA5O3RyeSB7Zm9yIChfaXRlcmF0b3I5LnMoKTsgIShfc3RlcDkgPSBfaXRlcmF0b3I5Lm4oKSkuZG9uZTspIHt2YXIgbWF0Y2ggPSBfc3RlcDkudmFsdWU7CiAgICAgICAgICAgICAgICB2YXIgaWQgPSBtYXRjaC5yb3V0ZS5pZDsKCiAgICAgICAgICAgICAgICBpZiAobmV3TG9hZGVyRGF0YS5oYXNPd25Qcm9wZXJ0eShpZCkpIHsKICAgICAgICAgICAgICAgICAgaWYgKG5ld0xvYWRlckRhdGFbaWRdICE9PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgICAgICAgICBtZXJnZWRMb2FkZXJEYXRhW2lkXSA9IG5ld0xvYWRlckRhdGFbaWRdOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGxvYWRlckRhdGFbaWRdICE9PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgICAgICAgbWVyZ2VkTG9hZGVyRGF0YVtpZF0gPSBsb2FkZXJEYXRhW2lkXTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBpZiAoZXJyb3JzICYmIGVycm9ycy5oYXNPd25Qcm9wZXJ0eShpZCkpIHsKICAgICAgICAgICAgICAgICAgLy8gRG9uJ3Qga2VlcCBhbnkgbG9hZGVyIGRhdGEgYmVsb3cgdGhlIGJvdW5kYXJ5CiAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH19IGNhdGNoIChlcnIpIHtfaXRlcmF0b3I5LmUoZXJyKTt9IGZpbmFsbHkge19pdGVyYXRvcjkuZigpO30KCiAgICAgICAgICAgIHJldHVybiBtZXJnZWRMb2FkZXJEYXRhOwogICAgICAgICAgfSAvLyBGaW5kIHRoZSBuZWFyZXN0IGVycm9yIGJvdW5kYXJ5LCBsb29raW5nIHVwd2FyZHMgZnJvbSB0aGUgbGVhZiByb3V0ZSAob3IgdGhlCiAgICAgICAgICAvLyByb3V0ZSBzcGVjaWZpZWQgYnkgcm91dGVJZCkgZm9yIHRoZSBjbG9zZXN0IGFuY2VzdG9yIGVycm9yIGJvdW5kYXJ5LAogICAgICAgICAgLy8gZGVmYXVsdGluZyB0byB0aGUgcm9vdCBtYXRjaAoKCiAgICAgICAgICBmdW5jdGlvbiBmaW5kTmVhcmVzdEJvdW5kYXJ5KG1hdGNoZXMsIHJvdXRlSWQpIHsKICAgICAgICAgICAgdmFyIGVsaWdpYmxlTWF0Y2hlcyA9IHJvdXRlSWQgPyBtYXRjaGVzLnNsaWNlKDAsIG1hdGNoZXMuZmluZEluZGV4KChtKSA9PiBtLnJvdXRlLmlkID09PSByb3V0ZUlkKSArIDEpIDogX3RvQ29uc3VtYWJsZUFycmF5MihtYXRjaGVzKTsKICAgICAgICAgICAgcmV0dXJuIGVsaWdpYmxlTWF0Y2hlcy5yZXZlcnNlKCkuZmluZCgobSkgPT4gbS5yb3V0ZS5oYXNFcnJvckJvdW5kYXJ5ID09PSB0cnVlKSB8fCBtYXRjaGVzWzBdOwogICAgICAgICAgfQoKICAgICAgICAgIGZ1bmN0aW9uIGdldFNob3J0Q2lyY3VpdE1hdGNoZXMocm91dGVzKSB7CiAgICAgICAgICAgIC8vIFByZWZlciBhIHJvb3QgbGF5b3V0IHJvdXRlIGlmIHByZXNlbnQsIG90aGVyd2lzZSBzaGltIGluIGEgcm91dGUgb2JqZWN0CiAgICAgICAgICAgIHZhciByb3V0ZSA9IHJvdXRlcy5maW5kKChyKSA9PiByLmluZGV4IHx8ICFyLnBhdGggfHwgci5wYXRoID09PSAiLyIpIHx8IHsKICAgICAgICAgICAgICBpZDogIl9fc2hpbS1lcnJvci1yb3V0ZV9fIgogICAgICAgICAgICB9OwogICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgIG1hdGNoZXM6IFt7CiAgICAgICAgICAgICAgICBwYXJhbXM6IHt9LAogICAgICAgICAgICAgICAgcGF0aG5hbWU6ICIiLAogICAgICAgICAgICAgICAgcGF0aG5hbWVCYXNlOiAiIiwKICAgICAgICAgICAgICAgIHJvdXRlOiByb3V0ZQogICAgICAgICAgICAgIH1dLAogICAgICAgICAgICAgIHJvdXRlOiByb3V0ZQogICAgICAgICAgICB9OwogICAgICAgICAgfQoKICAgICAgICAgIGZ1bmN0aW9uIGdldEludGVybmFsUm91dGVyRXJyb3Ioc3RhdHVzLCBfdGVtcDQpIHsKICAgICAgICAgICAgdmFyIF9yZWYyOSA9CgoKCgogICAgICAgICAgICAgIF90ZW1wNCA9PT0gdm9pZCAwID8ge30gOiBfdGVtcDQscGF0aG5hbWUgPSBfcmVmMjkucGF0aG5hbWUscm91dGVJZCA9IF9yZWYyOS5yb3V0ZUlkLG1ldGhvZCA9IF9yZWYyOS5tZXRob2QsdHlwZSA9IF9yZWYyOS50eXBlOwogICAgICAgICAgICB2YXIgc3RhdHVzVGV4dCA9ICJVbmtub3duIFNlcnZlciBFcnJvciI7CiAgICAgICAgICAgIHZhciBlcnJvck1lc3NhZ2UgPSAiVW5rbm93biBAcmVtaXgtcnVuL3JvdXRlciBlcnJvciI7CgogICAgICAgICAgICBpZiAoc3RhdHVzID09PSA0MDApIHsKICAgICAgICAgICAgICBzdGF0dXNUZXh0ID0gIkJhZCBSZXF1ZXN0IjsKCiAgICAgICAgICAgICAgaWYgKG1ldGhvZCAmJiBwYXRobmFtZSAmJiByb3V0ZUlkKSB7CiAgICAgICAgICAgICAgICBlcnJvck1lc3NhZ2UgPSAiWW91IG1hZGUgYSAiICsgbWV0aG9kICsgIiByZXF1ZXN0IHRvIFwiIiArIHBhdGhuYW1lICsgIlwiIGJ1dCAiICsgKCJkaWQgbm90IHByb3ZpZGUgYSBgbG9hZGVyYCBmb3Igcm91dGUgXCIiICsgcm91dGVJZCArICJcIiwgIikgKyAic28gdGhlcmUgaXMgbm8gd2F5IHRvIGhhbmRsZSB0aGUgcmVxdWVzdC4iOwogICAgICAgICAgICAgIH0gZWxzZSBpZiAodHlwZSA9PT0gImRlZmVyLWFjdGlvbiIpIHsKICAgICAgICAgICAgICAgIGVycm9yTWVzc2FnZSA9ICJkZWZlcigpIGlzIG5vdCBzdXBwb3J0ZWQgaW4gYWN0aW9ucyI7CiAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGVycm9yTWVzc2FnZSA9ICJDYW5ub3Qgc3VibWl0IGJpbmFyeSBmb3JtIGRhdGEgdXNpbmcgR0VUIjsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZWxzZSBpZiAoc3RhdHVzID09PSA0MDMpIHsKICAgICAgICAgICAgICBzdGF0dXNUZXh0ID0gIkZvcmJpZGRlbiI7CiAgICAgICAgICAgICAgZXJyb3JNZXNzYWdlID0gIlJvdXRlIFwiIiArIHJvdXRlSWQgKyAiXCIgZG9lcyBub3QgbWF0Y2ggVVJMIFwiIiArIHBhdGhuYW1lICsgIlwiIjsKICAgICAgICAgICAgfSBlbHNlIGlmIChzdGF0dXMgPT09IDQwNCkgewogICAgICAgICAgICAgIHN0YXR1c1RleHQgPSAiTm90IEZvdW5kIjsKICAgICAgICAgICAgICBlcnJvck1lc3NhZ2UgPSAiTm8gcm91dGUgbWF0Y2hlcyBVUkwgXCIiICsgcGF0aG5hbWUgKyAiXCIiOwogICAgICAgICAgICB9IGVsc2UgaWYgKHN0YXR1cyA9PT0gNDA1KSB7CiAgICAgICAgICAgICAgc3RhdHVzVGV4dCA9ICJNZXRob2QgTm90IEFsbG93ZWQiOwoKICAgICAgICAgICAgICBpZiAobWV0aG9kICYmIHBhdGhuYW1lICYmIHJvdXRlSWQpIHsKICAgICAgICAgICAgICAgIGVycm9yTWVzc2FnZSA9ICJZb3UgbWFkZSBhICIgKyBtZXRob2QudG9VcHBlckNhc2UoKSArICIgcmVxdWVzdCB0byBcIiIgKyBwYXRobmFtZSArICJcIiBidXQgIiArICgiZGlkIG5vdCBwcm92aWRlIGFuIGBhY3Rpb25gIGZvciByb3V0ZSBcIiIgKyByb3V0ZUlkICsgIlwiLCAiKSArICJzbyB0aGVyZSBpcyBubyB3YXkgdG8gaGFuZGxlIHRoZSByZXF1ZXN0LiI7CiAgICAgICAgICAgICAgfSBlbHNlIGlmIChtZXRob2QpIHsKICAgICAgICAgICAgICAgIGVycm9yTWVzc2FnZSA9ICJJbnZhbGlkIHJlcXVlc3QgbWV0aG9kIFwiIiArIG1ldGhvZC50b1VwcGVyQ2FzZSgpICsgIlwiIjsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybiBuZXcgcm91dGVyX0Vycm9yUmVzcG9uc2Uoc3RhdHVzIHx8IDUwMCwgc3RhdHVzVGV4dCwgbmV3IEVycm9yKGVycm9yTWVzc2FnZSksIHRydWUpOwogICAgICAgICAgfSAvLyBGaW5kIGFueSByZXR1cm5lZCByZWRpcmVjdCBlcnJvcnMsIHN0YXJ0aW5nIGZyb20gdGhlIGxvd2VzdCBtYXRjaAoKCiAgICAgICAgICBmdW5jdGlvbiBmaW5kUmVkaXJlY3QocmVzdWx0cykgewogICAgICAgICAgICBmb3IgKHZhciBpID0gcmVzdWx0cy5sZW5ndGggLSAxOyBpID49IDA7IGktLSkgewogICAgICAgICAgICAgIHZhciByZXN1bHQgPSByZXN1bHRzW2ldOwoKICAgICAgICAgICAgICBpZiAoaXNSZWRpcmVjdFJlc3VsdChyZXN1bHQpKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gcmVzdWx0OwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfQoKICAgICAgICAgIGZ1bmN0aW9uIHN0cmlwSGFzaEZyb21QYXRoKHBhdGgpIHsKICAgICAgICAgICAgdmFyIHBhcnNlZFBhdGggPSB0eXBlb2YgcGF0aCA9PT0gInN0cmluZyIgPyBwYXJzZVBhdGgocGF0aCkgOiBwYXRoOwogICAgICAgICAgICByZXR1cm4gcm91dGVyX2NyZWF0ZVBhdGgoX2V4dGVuZHMoe30sIHBhcnNlZFBhdGgsIHsKICAgICAgICAgICAgICBoYXNoOiAiIgogICAgICAgICAgICB9KSk7CiAgICAgICAgICB9CgogICAgICAgICAgZnVuY3Rpb24gaXNIYXNoQ2hhbmdlT25seShhLCBiKSB7CiAgICAgICAgICAgIHJldHVybiBhLnBhdGhuYW1lID09PSBiLnBhdGhuYW1lICYmIGEuc2VhcmNoID09PSBiLnNlYXJjaCAmJiBhLmhhc2ggIT09IGIuaGFzaDsKICAgICAgICAgIH0KCiAgICAgICAgICBmdW5jdGlvbiBpc0RlZmVycmVkUmVzdWx0KHJlc3VsdCkgewogICAgICAgICAgICByZXR1cm4gcmVzdWx0LnR5cGUgPT09IFJlc3VsdFR5cGUuZGVmZXJyZWQ7CiAgICAgICAgICB9CgogICAgICAgICAgZnVuY3Rpb24gaXNFcnJvclJlc3VsdChyZXN1bHQpIHsKICAgICAgICAgICAgcmV0dXJuIHJlc3VsdC50eXBlID09PSBSZXN1bHRUeXBlLmVycm9yOwogICAgICAgICAgfQoKICAgICAgICAgIGZ1bmN0aW9uIGlzUmVkaXJlY3RSZXN1bHQocmVzdWx0KSB7CiAgICAgICAgICAgIHJldHVybiAocmVzdWx0ICYmIHJlc3VsdC50eXBlKSA9PT0gUmVzdWx0VHlwZS5yZWRpcmVjdDsKICAgICAgICAgIH0KCiAgICAgICAgICBmdW5jdGlvbiBpc1Jlc3BvbnNlKHZhbHVlKSB7CiAgICAgICAgICAgIHJldHVybiB2YWx1ZSAhPSBudWxsICYmIHR5cGVvZiB2YWx1ZS5zdGF0dXMgPT09ICJudW1iZXIiICYmIHR5cGVvZiB2YWx1ZS5zdGF0dXNUZXh0ID09PSAic3RyaW5nIiAmJiB0eXBlb2YgdmFsdWUuaGVhZGVycyA9PT0gIm9iamVjdCIgJiYgdHlwZW9mIHZhbHVlLmJvZHkgIT09ICJ1bmRlZmluZWQiOwogICAgICAgICAgfQoKICAgICAgICAgIGZ1bmN0aW9uIGlzUmVkaXJlY3RSZXNwb25zZShyZXN1bHQpIHsKICAgICAgICAgICAgaWYgKCFpc1Jlc3BvbnNlKHJlc3VsdCkpIHsKICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHZhciBzdGF0dXMgPSByZXN1bHQuc3RhdHVzOwogICAgICAgICAgICB2YXIgbG9jYXRpb24gPSByZXN1bHQuaGVhZGVycy5nZXQoIkxvY2F0aW9uIik7CiAgICAgICAgICAgIHJldHVybiBzdGF0dXMgPj0gMzAwICYmIHN0YXR1cyA8PSAzOTkgJiYgbG9jYXRpb24gIT0gbnVsbDsKICAgICAgICAgIH0KCiAgICAgICAgICBmdW5jdGlvbiBpc1F1ZXJ5Um91dGVSZXNwb25zZShvYmopIHsKICAgICAgICAgICAgcmV0dXJuIG9iaiAmJiBpc1Jlc3BvbnNlKG9iai5yZXNwb25zZSkgJiYgKG9iai50eXBlID09PSBSZXN1bHRUeXBlLmRhdGEgfHwgUmVzdWx0VHlwZS5lcnJvcik7CiAgICAgICAgICB9CgogICAgICAgICAgZnVuY3Rpb24gaXNWYWxpZE1ldGhvZChtZXRob2QpIHsKICAgICAgICAgICAgcmV0dXJuIHZhbGlkUmVxdWVzdE1ldGhvZHMuaGFzKG1ldGhvZCk7CiAgICAgICAgICB9CgogICAgICAgICAgZnVuY3Rpb24gaXNNdXRhdGlvbk1ldGhvZChtZXRob2QpIHsKICAgICAgICAgICAgcmV0dXJuIHZhbGlkTXV0YXRpb25NZXRob2RzLmhhcyhtZXRob2QpOwogICAgICAgICAgfWZ1bmN0aW9uCgogICAgICAgICAgcmVzb2x2ZURlZmVycmVkUmVzdWx0cyhfeDY5LCBfeDcwLCBfeDcxLCBfeDcyLCBfeDczLCBfeDc0KSB7cmV0dXJuIF9yZXNvbHZlRGVmZXJyZWRSZXN1bHRzLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7fWZ1bmN0aW9uIF9yZXNvbHZlRGVmZXJyZWRSZXN1bHRzKCkge19yZXNvbHZlRGVmZXJyZWRSZXN1bHRzID0gX2FzeW5jVG9HZW5lcmF0b3IyKCAvKiNfX1BVUkVfXyovX3JlZ2VuZXJhdG9yUnVudGltZTIoKS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUxNyhjdXJyZW50TWF0Y2hlcywgbWF0Y2hlc1RvTG9hZCwgcmVzdWx0cywgc2lnbmFsLCBpc0ZldGNoZXIsIGN1cnJlbnRMb2FkZXJEYXRhKSB7dmFyIF9sb29wMiwgaW5kZXg7cmV0dXJuIF9yZWdlbmVyYXRvclJ1bnRpbWUyKCkud3JhcChmdW5jdGlvbiBfY2FsbGVlMTckKF9jb250ZXh0MTkpIHt3aGlsZSAoMSkgc3dpdGNoIChfY29udGV4dDE5LnByZXYgPSBfY29udGV4dDE5Lm5leHQpIHtjYXNlIDA6X2xvb3AyID0gLyojX19QVVJFX18qL19yZWdlbmVyYXRvclJ1bnRpbWUyKCkubWFyayhmdW5jdGlvbiBfbG9vcDIoaW5kZXgpIHt2YXIgcmVzdWx0LCBtYXRjaCwgY3VycmVudE1hdGNoLCBpc1JldmFsaWRhdGluZ0xvYWRlcjtyZXR1cm4gX3JlZ2VuZXJhdG9yUnVudGltZTIoKS53cmFwKGZ1bmN0aW9uIF9sb29wMiQoX2NvbnRleHQxOCkge3doaWxlICgxKSBzd2l0Y2ggKF9jb250ZXh0MTgucHJldiA9IF9jb250ZXh0MTgubmV4dCkge2Nhc2UgMDoKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQgPSByZXN1bHRzW2luZGV4XTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1hdGNoID0gbWF0Y2hlc1RvTG9hZFtpbmRleF07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50TWF0Y2ggPSBjdXJyZW50TWF0Y2hlcy5maW5kKChtKSA9PiBtLnJvdXRlLmlkID09PSBtYXRjaC5yb3V0ZS5pZCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpc1JldmFsaWRhdGluZ0xvYWRlciA9IGN1cnJlbnRNYXRjaCAhPSBudWxsICYmICFpc05ld1JvdXRlSW5zdGFuY2UoY3VycmVudE1hdGNoLCBtYXRjaCkgJiYgKGN1cnJlbnRMb2FkZXJEYXRhICYmIGN1cnJlbnRMb2FkZXJEYXRhW21hdGNoLnJvdXRlLmlkXSkgIT09IHVuZGVmaW5lZDtpZiAoISgKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpc0RlZmVycmVkUmVzdWx0KHJlc3VsdCkgJiYgKGlzRmV0Y2hlciB8fCBpc1JldmFsaWRhdGluZ0xvYWRlcikpKSB7X2NvbnRleHQxOC5uZXh0ID0gNzticmVhazt9X2NvbnRleHQxOC5uZXh0ID0gNztyZXR1cm4gKAoKCgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlRGVmZXJyZWREYXRhKHJlc3VsdCwgc2lnbmFsLCBpc0ZldGNoZXIpLnRoZW4oKHJlc3VsdCkgPT4gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZXN1bHQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdHNbaW5kZXhdID0gcmVzdWx0IHx8IHJlc3VsdHNbaW5kZXhdOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSkpO2Nhc2UgNzpjYXNlICJlbmQiOnJldHVybiBfY29udGV4dDE4LnN0b3AoKTt9fSwgX2xvb3AyKTt9KTtpbmRleCA9IDA7Y2FzZSAyOmlmICghKGluZGV4IDwgcmVzdWx0cy5sZW5ndGgpKSB7X2NvbnRleHQxOS5uZXh0ID0gNzticmVhazt9cmV0dXJuIF9jb250ZXh0MTkuZGVsZWdhdGVZaWVsZChfbG9vcDIoaW5kZXgpLCAidDAiLCA0KTtjYXNlIDQ6aW5kZXgrKztfY29udGV4dDE5Lm5leHQgPSAyO2JyZWFrO2Nhc2UgNzpjYXNlICJlbmQiOnJldHVybiBfY29udGV4dDE5LnN0b3AoKTt9fSwgX2NhbGxlZTE3KTt9KSk7cmV0dXJuIF9yZXNvbHZlRGVmZXJyZWRSZXN1bHRzLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7fWZ1bmN0aW9uCgoKCgogICAgICAgICAgcmVzb2x2ZURlZmVycmVkRGF0YShfeDc1LCBfeDc2LCBfeDc3KSB7cmV0dXJuIF9yZXNvbHZlRGVmZXJyZWREYXRhLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7fWZ1bmN0aW9uIF9yZXNvbHZlRGVmZXJyZWREYXRhKCkge19yZXNvbHZlRGVmZXJyZWREYXRhID0gX2FzeW5jVG9HZW5lcmF0b3IyKCAvKiNfX1BVUkVfXyovX3JlZ2VuZXJhdG9yUnVudGltZTIoKS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUxOChyZXN1bHQsIHNpZ25hbCwgdW53cmFwKSB7dmFyIGFib3J0ZWQ7cmV0dXJuIF9yZWdlbmVyYXRvclJ1bnRpbWUyKCkud3JhcChmdW5jdGlvbiBfY2FsbGVlMTgkKF9jb250ZXh0MjApIHt3aGlsZSAoMSkgc3dpdGNoIChfY29udGV4dDIwLnByZXYgPSBfY29udGV4dDIwLm5leHQpIHtjYXNlIDA6CiAgICAgICAgICAgICAgICAgICAgaWYgKHVud3JhcCA9PT0gdm9pZCAwKSB7CiAgICAgICAgICAgICAgICAgICAgICB1bndyYXAgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgICB9X2NvbnRleHQyMC5uZXh0ID0gMztyZXR1cm4gKAoKICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdC5kZWZlcnJlZERhdGEucmVzb2x2ZURhdGEoc2lnbmFsKSk7Y2FzZSAzOmFib3J0ZWQgPSBfY29udGV4dDIwLnNlbnQ7aWYgKCEKCiAgICAgICAgICAgICAgICAgICAgYWJvcnRlZCkge19jb250ZXh0MjAubmV4dCA9IDY7YnJlYWs7fXJldHVybiBfY29udGV4dDIwLmFicnVwdCgicmV0dXJuIik7Y2FzZSA2OmlmICghCgoKCiAgICAgICAgICAgICAgICAgICAgdW53cmFwKSB7X2NvbnRleHQyMC5uZXh0ID0gMTQ7YnJlYWs7fV9jb250ZXh0MjAucHJldiA9IDc7cmV0dXJuIF9jb250ZXh0MjAuYWJydXB0KCJyZXR1cm4iLAoKICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICB0eXBlOiBSZXN1bHRUeXBlLmRhdGEsCiAgICAgICAgICAgICAgICAgICAgICBkYXRhOiByZXN1bHQuZGVmZXJyZWREYXRhLnVud3JhcHBlZERhdGEKICAgICAgICAgICAgICAgICAgICB9KTtjYXNlIDExOl9jb250ZXh0MjAucHJldiA9IDExO19jb250ZXh0MjAudDAgPSBfY29udGV4dDIwWyJjYXRjaCJdKDcpO3JldHVybiBfY29udGV4dDIwLmFicnVwdCgicmV0dXJuIiwKCgogICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgIHR5cGU6IFJlc3VsdFR5cGUuZXJyb3IsCiAgICAgICAgICAgICAgICAgICAgICBlcnJvcjogX2NvbnRleHQyMC50MAogICAgICAgICAgICAgICAgICAgIH0pO2Nhc2UgMTQ6cmV0dXJuIF9jb250ZXh0MjAuYWJydXB0KCJyZXR1cm4iLAoKCgogICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgIHR5cGU6IFJlc3VsdFR5cGUuZGF0YSwKICAgICAgICAgICAgICAgICAgICAgIGRhdGE6IHJlc3VsdC5kZWZlcnJlZERhdGEuZGF0YQogICAgICAgICAgICAgICAgICAgIH0pO2Nhc2UgMTU6Y2FzZSAiZW5kIjpyZXR1cm4gX2NvbnRleHQyMC5zdG9wKCk7fX0sIF9jYWxsZWUxOCwgbnVsbCwgW1s3LCAxMV1dKTt9KSk7cmV0dXJuIF9yZXNvbHZlRGVmZXJyZWREYXRhLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7fQoKCiAgICAgICAgICBmdW5jdGlvbiBoYXNOYWtlZEluZGV4UXVlcnkoc2VhcmNoKSB7CiAgICAgICAgICAgIHJldHVybiBuZXcgVVJMU2VhcmNoUGFyYW1zKHNlYXJjaCkuZ2V0QWxsKCJpbmRleCIpLnNvbWUoKHYpID0+IHYgPT09ICIiKTsKICAgICAgICAgIH0gLy8gTm90ZTogVGhpcyBzaG91bGQgbWF0Y2ggdGhlIGZvcm1hdCBleHBvcnRlZCBieSB1c2VNYXRjaGVzLCBzbyBpZiB5b3UgY2hhbmdlCiAgICAgICAgICAvLyB0aGlzIHBsZWFzZSBhbHNvIGNoYW5nZSB0aGF0IDopICBFdmVudHVhbGx5IHdlJ2xsIERSWSB0aGlzIHVwCgoKICAgICAgICAgIGZ1bmN0aW9uIGNyZWF0ZVVzZU1hdGNoZXNNYXRjaChtYXRjaCwgbG9hZGVyRGF0YSkgewogICAgICAgICAgICB2YXIKICAgICAgICAgICAgICByb3V0ZSA9CgoKICAgICAgICAgICAgICBtYXRjaC5yb3V0ZSxwYXRobmFtZSA9IG1hdGNoLnBhdGhuYW1lLHBhcmFtcyA9IG1hdGNoLnBhcmFtczsKICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICBpZDogcm91dGUuaWQsCiAgICAgICAgICAgICAgcGF0aG5hbWU6IHBhdGhuYW1lLAogICAgICAgICAgICAgIHBhcmFtczogcGFyYW1zLAogICAgICAgICAgICAgIGRhdGE6IGxvYWRlckRhdGFbcm91dGUuaWRdLAogICAgICAgICAgICAgIGhhbmRsZTogcm91dGUuaGFuZGxlCiAgICAgICAgICAgIH07CiAgICAgICAgICB9CgogICAgICAgICAgZnVuY3Rpb24gZ2V0VGFyZ2V0TWF0Y2gobWF0Y2hlcywgbG9jYXRpb24pIHsKICAgICAgICAgICAgdmFyIHNlYXJjaCA9IHR5cGVvZiBsb2NhdGlvbiA9PT0gInN0cmluZyIgPyBwYXJzZVBhdGgobG9jYXRpb24pLnNlYXJjaCA6IGxvY2F0aW9uLnNlYXJjaDsKCiAgICAgICAgICAgIGlmIChtYXRjaGVzW21hdGNoZXMubGVuZ3RoIC0gMV0ucm91dGUuaW5kZXggJiYgaGFzTmFrZWRJbmRleFF1ZXJ5KHNlYXJjaCB8fCAiIikpIHsKICAgICAgICAgICAgICAvLyBSZXR1cm4gdGhlIGxlYWYgaW5kZXggcm91dGUgd2hlbiBpbmRleCBpcyBwcmVzZW50CiAgICAgICAgICAgICAgcmV0dXJuIG1hdGNoZXNbbWF0Y2hlcy5sZW5ndGggLSAxXTsKICAgICAgICAgICAgfSAvLyBPdGhlcndpc2UgZ3JhYiB0aGUgZGVlcGVzdCAicGF0aCBjb250cmlidXRpbmciIG1hdGNoIChpZ25vcmluZyBpbmRleCBhbmQKICAgICAgICAgICAgLy8gcGF0aGxlc3MgbGF5b3V0IHJvdXRlcykKCgogICAgICAgICAgICB2YXIgcGF0aE1hdGNoZXMgPSBnZXRQYXRoQ29udHJpYnV0aW5nTWF0Y2hlcyhtYXRjaGVzKTsKICAgICAgICAgICAgcmV0dXJuIHBhdGhNYXRjaGVzW3BhdGhNYXRjaGVzLmxlbmd0aCAtIDFdOwogICAgICAgICAgfSAvLyNlbmRyZWdpb24KCgoKCiAgICAgICAgICAvLyBFWFRFUk5BTCBNT0RVTEU6IC4vbm9kZV9tb2R1bGVzL3JlYWN0L2luZGV4LmpzCiAgICAgICAgICB2YXIgcmVhY3QgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDI5NCk7CiAgICAgICAgICB2YXIgcmVhY3RfbmFtZXNwYWNlT2JqZWN0ID0gLyojX19QVVJFX18qL19fd2VicGFja19yZXF1aXJlX18udChyZWFjdCwgMik7CiAgICAgICAgICA7IC8vIENPTkNBVEVOQVRFRCBNT0RVTEU6IC4vbm9kZV9tb2R1bGVzL3JlYWN0LXJvdXRlci9kaXN0L2luZGV4LmpzCiAgICAgICAgICAvKioKICAgICAgICAgICAqIFJlYWN0IFJvdXRlciB2Ni43LjAKICAgICAgICAgICAqCiAgICAgICAgICAgKiBDb3B5cmlnaHQgKGMpIFJlbWl4IFNvZnR3YXJlIEluYy4KICAgICAgICAgICAqCiAgICAgICAgICAgKiBUaGlzIHNvdXJjZSBjb2RlIGlzIGxpY2Vuc2VkIHVuZGVyIHRoZSBNSVQgbGljZW5zZSBmb3VuZCBpbiB0aGUKICAgICAgICAgICAqIExJQ0VOU0UubWQgZmlsZSBpbiB0aGUgcm9vdCBkaXJlY3Rvcnkgb2YgdGhpcyBzb3VyY2UgdHJlZS4KICAgICAgICAgICAqCiAgICAgICAgICAgKiBAbGljZW5zZSBNSVQKICAgICAgICAgICAqLwoKCgoKICAgICAgICAgIGZ1bmN0aW9uIGRpc3RfZXh0ZW5kcygpIHsKICAgICAgICAgICAgZGlzdF9leHRlbmRzID0gT2JqZWN0LmFzc2lnbiA/IE9iamVjdC5hc3NpZ24uYmluZCgpIDogZnVuY3Rpb24gKHRhcmdldCkgewogICAgICAgICAgICAgIGZvciAodmFyIGkgPSAxOyBpIDwgYXJndW1lbnRzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAgICB2YXIgc291cmNlID0gYXJndW1lbnRzW2ldOwoKICAgICAgICAgICAgICAgIGZvciAodmFyIGtleSBpbiBzb3VyY2UpIHsKICAgICAgICAgICAgICAgICAgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChzb3VyY2UsIGtleSkpIHsKICAgICAgICAgICAgICAgICAgICB0YXJnZXRba2V5XSA9IHNvdXJjZVtrZXldOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICByZXR1cm4gdGFyZ2V0OwogICAgICAgICAgICB9OwogICAgICAgICAgICByZXR1cm4gZGlzdF9leHRlbmRzLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgICAgICB9CgogICAgICAgICAgLyoqCiAgICAgICAgICAgKiBDb3B5cmlnaHQgKGMpIEZhY2Vib29rLCBJbmMuIGFuZCBpdHMgYWZmaWxpYXRlcy4KICAgICAgICAgICAqCiAgICAgICAgICAgKiBUaGlzIHNvdXJjZSBjb2RlIGlzIGxpY2Vuc2VkIHVuZGVyIHRoZSBNSVQgbGljZW5zZSBmb3VuZCBpbiB0aGUKICAgICAgICAgICAqIExJQ0VOU0UgZmlsZSBpbiB0aGUgcm9vdCBkaXJlY3Rvcnkgb2YgdGhpcyBzb3VyY2UgdHJlZS4KICAgICAgICAgICAqLwogICAgICAgICAgLyoqCiAgICAgICAgICAgKiBpbmxpbmVkIE9iamVjdC5pcyBwb2x5ZmlsbCB0byBhdm9pZCByZXF1aXJpbmcgY29uc3VtZXJzIHNoaXAgdGhlaXIgb3duCiAgICAgICAgICAgKiBodHRwczovL2RldmVsb3Blci5tb3ppbGxhLm9yZy9lbi1VUy9kb2NzL1dlYi9KYXZhU2NyaXB0L1JlZmVyZW5jZS9HbG9iYWxfT2JqZWN0cy9PYmplY3QvaXMKICAgICAgICAgICAqLwoKICAgICAgICAgIGZ1bmN0aW9uIGlzUG9seWZpbGwoeCwgeSkgewogICAgICAgICAgICByZXR1cm4geCA9PT0geSAmJiAoeCAhPT0gMCB8fCAxIC8geCA9PT0gMSAvIHkpIHx8IHggIT09IHggJiYgeSAhPT0geSAvLyBlc2xpbnQtZGlzYWJsZS1saW5lIG5vLXNlbGYtY29tcGFyZQogICAgICAgICAgICA7CiAgICAgICAgICB9CgogICAgICAgICAgdmFyIGlzID0gdHlwZW9mIE9iamVjdC5pcyA9PT0gImZ1bmN0aW9uIiA/IE9iamVjdC5pcyA6IGlzUG9seWZpbGw7IC8vIEludGVudGlvbmFsbHkgbm90IHVzaW5nIG5hbWVkIGltcG9ydHMgYmVjYXVzZSBSb2xsdXAgdXNlcyBkeW5hbWljCiAgICAgICAgICAvLyBkaXNwYXRjaCBmb3IgQ29tbW9uSlMgaW50ZXJvcCBuYW1lZCBpbXBvcnRzLgoKICAgICAgICAgIHZhcgogICAgICAgICAgICB1c2VTdGF0ZSA9CgoKCiAgICAgICAgICAgIHJlYWN0X25hbWVzcGFjZU9iamVjdC51c2VTdGF0ZSx1c2VFZmZlY3QgPSByZWFjdF9uYW1lc3BhY2VPYmplY3QudXNlRWZmZWN0LHVzZUxheW91dEVmZmVjdCA9IHJlYWN0X25hbWVzcGFjZU9iamVjdC51c2VMYXlvdXRFZmZlY3QsdXNlRGVidWdWYWx1ZSA9IHJlYWN0X25hbWVzcGFjZU9iamVjdC51c2VEZWJ1Z1ZhbHVlOwogICAgICAgICAgdmFyIGRpZFdhcm5PbGQxOEFscGhhID0gZmFsc2U7CiAgICAgICAgICB2YXIgZGlkV2FyblVuY2FjaGVkR2V0U25hcHNob3QgPSBmYWxzZTsgLy8gRGlzY2xhaW1lcjogVGhpcyBzaGltIGJyZWFrcyBtYW55IG9mIHRoZSBydWxlcyBvZiBSZWFjdCwgYW5kIG9ubHkgd29ya3MKICAgICAgICAgIC8vIGJlY2F1c2Ugb2YgYSB2ZXJ5IHBhcnRpY3VsYXIgc2V0IG9mIGltcGxlbWVudGF0aW9uIGRldGFpbHMgYW5kIGFzc3VtcHRpb25zCiAgICAgICAgICAvLyAtLSBjaGFuZ2UgYW55IG9uZSBvZiB0aGVtIGFuZCBpdCB3aWxsIGJyZWFrLiBUaGUgbW9zdCBpbXBvcnRhbnQgYXNzdW1wdGlvbgogICAgICAgICAgLy8gaXMgdGhhdCB1cGRhdGVzIGFyZSBhbHdheXMgc3luY2hyb25vdXMsIGJlY2F1c2UgY29uY3VycmVudCByZW5kZXJpbmcgaXMKICAgICAgICAgIC8vIG9ubHkgYXZhaWxhYmxlIGluIHZlcnNpb25zIG9mIFJlYWN0IHRoYXQgYWxzbyBoYXZlIGEgYnVpbHQtaW4KICAgICAgICAgIC8vIHVzZVN5bmNFeHRlcm5hbFN0b3JlIEFQSS4gQW5kIHdlIG9ubHkgdXNlIHRoaXMgc2hpbSB3aGVuIHRoZSBidWlsdC1pbiBBUEkKICAgICAgICAgIC8vIGRvZXMgbm90IGV4aXN0LgogICAgICAgICAgLy8KICAgICAgICAgIC8vIERvIG5vdCBhc3N1bWUgdGhhdCB0aGUgY2xldmVyIGhhY2tzIHVzZWQgYnkgdGhpcyBob29rIGFsc28gd29yayBpbiBnZW5lcmFsLgogICAgICAgICAgLy8gVGhlIHBvaW50IG9mIHRoaXMgc2hpbSBpcyB0byByZXBsYWNlIHRoZSBuZWVkIGZvciBoYWNrcyBieSBvdGhlciBsaWJyYXJpZXMuCgogICAgICAgICAgZnVuY3Rpb24gdXNlU3luY0V4dGVybmFsU3RvcmUkMihzdWJzY3JpYmUsIGdldFNuYXBzaG90LCAvLyBOb3RlOiBUaGUgc2hpbSBkb2VzIG5vdCB1c2UgZ2V0U2VydmVyU25hcHNob3QsIGJlY2F1c2UgcHJlLTE4IHZlcnNpb25zIG9mCiAgICAgICAgICAvLyBSZWFjdCBkbyBub3QgZXhwb3NlIGEgd2F5IHRvIGNoZWNrIGlmIHdlJ3JlIGh5ZHJhdGluZy4gU28gdXNlcnMgb2YgdGhlIHNoaW0KICAgICAgICAgIC8vIHdpbGwgbmVlZCB0byB0cmFjayB0aGF0IHRoZW1zZWx2ZXMgYW5kIHJldHVybiB0aGUgY29ycmVjdCB2YWx1ZQogICAgICAgICAgLy8gZnJvbSBgZ2V0U25hcHNob3RgLgogICAgICAgICAgZ2V0U2VydmVyU25hcHNob3QpIHsKICAgICAgICAgICAgaWYgKGZhbHNlKSB7fSAvLyBSZWFkIHRoZSBjdXJyZW50IHNuYXBzaG90IGZyb20gdGhlIHN0b3JlIG9uIGV2ZXJ5IHJlbmRlci4gQWdhaW4sIHRoaXMKICAgICAgICAgICAgLy8gYnJlYWtzIHRoZSBydWxlcyBvZiBSZWFjdCwgYW5kIG9ubHkgd29ya3MgaGVyZSBiZWNhdXNlIG9mIHNwZWNpZmljCiAgICAgICAgICAgIC8vIGltcGxlbWVudGF0aW9uIGRldGFpbHMsIG1vc3QgaW1wb3J0YW50bHkgdGhhdCB1cGRhdGVzIGFyZQogICAgICAgICAgICAvLyBhbHdheXMgc3luY2hyb25vdXMuCgoKICAgICAgICAgICAgdmFyIHZhbHVlID0gZ2V0U25hcHNob3QoKTsKCiAgICAgICAgICAgIGlmIChmYWxzZSkge30gLy8gQmVjYXVzZSB1cGRhdGVzIGFyZSBzeW5jaHJvbm91cywgd2UgZG9uJ3QgcXVldWUgdGhlbS4gSW5zdGVhZCB3ZSBmb3JjZSBhCiAgICAgICAgICAgIC8vIHJlLXJlbmRlciB3aGVuZXZlciB0aGUgc3Vic2NyaWJlZCBzdGF0ZSBjaGFuZ2VzIGJ5IHVwZGF0aW5nIGFuIHNvbWUKICAgICAgICAgICAgLy8gYXJiaXRyYXJ5IHVzZVN0YXRlIGhvb2suIFRoZW4sIGR1cmluZyByZW5kZXIsIHdlIGNhbGwgZ2V0U25hcHNob3QgdG8gcmVhZAogICAgICAgICAgICAvLyB0aGUgY3VycmVudCB2YWx1ZS4KICAgICAgICAgICAgLy8KICAgICAgICAgICAgLy8gQmVjYXVzZSB3ZSBkb24ndCBhY3R1YWxseSB1c2UgdGhlIHN0YXRlIHJldHVybmVkIGJ5IHRoZSB1c2VTdGF0ZSBob29rLCB3ZQogICAgICAgICAgICAvLyBjYW4gc2F2ZSBhIGJpdCBvZiBtZW1vcnkgYnkgc3RvcmluZyBvdGhlciBzdHVmZiBpbiB0aGF0IHNsb3QuCiAgICAgICAgICAgIC8vCiAgICAgICAgICAgIC8vIFRvIGltcGxlbWVudCB0aGUgZWFybHkgYmFpbG91dCwgd2UgbmVlZCB0byB0cmFjayBzb21lIHRoaW5ncyBvbiBhIG11dGFibGUKICAgICAgICAgICAgLy8gb2JqZWN0LiBVc3VhbGx5LCB3ZSB3b3VsZCBwdXQgdGhhdCBpbiBhIHVzZVJlZiBob29rLCBidXQgd2UgY2FuIHN0YXNoIGl0IGluCiAgICAgICAgICAgIC8vIG91ciB1c2VTdGF0ZSBob29rIGluc3RlYWQuCiAgICAgICAgICAgIC8vCiAgICAgICAgICAgIC8vIFRvIGZvcmNlIGEgcmUtcmVuZGVyLCB3ZSBjYWxsIGZvcmNlVXBkYXRlKHtpbnN0fSkuIFRoYXQgd29ya3MgYmVjYXVzZSB0aGUKICAgICAgICAgICAgLy8gbmV3IG9iamVjdCBhbHdheXMgZmFpbHMgYW4gZXF1YWxpdHkgY2hlY2suCgoKICAgICAgICAgICAgdmFyIF91c2VTdGF0ZTE1ID0KCiAgICAgICAgICAgICAgdXNlU3RhdGUoewogICAgICAgICAgICAgICAgaW5zdDogewogICAgICAgICAgICAgICAgICB2YWx1ZTogdmFsdWUsCiAgICAgICAgICAgICAgICAgIGdldFNuYXBzaG90OiBnZXRTbmFwc2hvdAogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0pLF91c2VTdGF0ZTE2ID0gX3NsaWNlZFRvQXJyYXkyKF91c2VTdGF0ZTE1LCAyKSxpbnN0ID0gX3VzZVN0YXRlMTZbMF0uaW5zdCxmb3JjZVVwZGF0ZSA9IF91c2VTdGF0ZTE2WzFdOyAvLyBUcmFjayB0aGUgbGF0ZXN0IGdldFNuYXBzaG90IGZ1bmN0aW9uIHdpdGggYSByZWYuIFRoaXMgbmVlZHMgdG8gYmUgdXBkYXRlZAogICAgICAgICAgICAvLyBpbiB0aGUgbGF5b3V0IHBoYXNlIHNvIHdlIGNhbiBhY2Nlc3MgaXQgZHVyaW5nIHRoZSB0ZWFyaW5nIGNoZWNrIHRoYXQKICAgICAgICAgICAgLy8gaGFwcGVucyBvbiBzdWJzY3JpYmUuCgogICAgICAgICAgICB1c2VMYXlvdXRFZmZlY3QoKCkgPT4gewogICAgICAgICAgICAgIGluc3QudmFsdWUgPSB2YWx1ZTsKICAgICAgICAgICAgICBpbnN0LmdldFNuYXBzaG90ID0gZ2V0U25hcHNob3Q7IC8vIFdoZW5ldmVyIGdldFNuYXBzaG90IG9yIHN1YnNjcmliZSBjaGFuZ2VzLCB3ZSBuZWVkIHRvIGNoZWNrIGluIHRoZQogICAgICAgICAgICAgIC8vIGNvbW1pdCBwaGFzZSBpZiB0aGVyZSB3YXMgYW4gaW50ZXJsZWF2ZWQgbXV0YXRpb24uIEluIGNvbmN1cnJlbnQgbW9kZQogICAgICAgICAgICAgIC8vIHRoaXMgY2FuIGhhcHBlbiBhbGwgdGhlIHRpbWUsIGJ1dCBldmVuIGluIHN5bmNocm9ub3VzIG1vZGUsIGFuIGVhcmxpZXIKICAgICAgICAgICAgICAvLyBlZmZlY3QgbWF5IGhhdmUgbXV0YXRlZCB0aGUgc3RvcmUuCgogICAgICAgICAgICAgIGlmIChjaGVja0lmU25hcHNob3RDaGFuZ2VkKGluc3QpKSB7CiAgICAgICAgICAgICAgICAvLyBGb3JjZSBhIHJlLXJlbmRlci4KICAgICAgICAgICAgICAgIGZvcmNlVXBkYXRlKHsKICAgICAgICAgICAgICAgICAgaW5zdDogaW5zdAogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgfSAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgcmVhY3QtaG9va3MvZXhoYXVzdGl2ZS1kZXBzCgogICAgICAgICAgICB9LCBbc3Vic2NyaWJlLCB2YWx1ZSwgZ2V0U25hcHNob3RdKTsKICAgICAgICAgICAgdXNlRWZmZWN0KCgpID0+IHsKICAgICAgICAgICAgICAvLyBDaGVjayBmb3IgY2hhbmdlcyByaWdodCBiZWZvcmUgc3Vic2NyaWJpbmcuIFN1YnNlcXVlbnQgY2hhbmdlcyB3aWxsIGJlCiAgICAgICAgICAgICAgLy8gZGV0ZWN0ZWQgaW4gdGhlIHN1YnNjcmlwdGlvbiBoYW5kbGVyLgogICAgICAgICAgICAgIGlmIChjaGVja0lmU25hcHNob3RDaGFuZ2VkKGluc3QpKSB7CiAgICAgICAgICAgICAgICAvLyBGb3JjZSBhIHJlLXJlbmRlci4KICAgICAgICAgICAgICAgIGZvcmNlVXBkYXRlKHsKICAgICAgICAgICAgICAgICAgaW5zdDogaW5zdAogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICB2YXIgaGFuZGxlU3RvcmVDaGFuZ2UgPSAoKSA9PiB7CiAgICAgICAgICAgICAgICAvLyBUT0RPOiBCZWNhdXNlIHRoZXJlIGlzIG5vIGNyb3NzLXJlbmRlcmVyIEFQSSBmb3IgYmF0Y2hpbmcgdXBkYXRlcywgaXQncwogICAgICAgICAgICAgICAgLy8gdXAgdG8gdGhlIGNvbnN1bWVyIG9mIHRoaXMgbGlicmFyeSB0byB3cmFwIHRoZWlyIHN1YnNjcmlwdGlvbiBldmVudAogICAgICAgICAgICAgICAgLy8gd2l0aCB1bnN0YWJsZV9iYXRjaGVkVXBkYXRlcy4gU2hvdWxkIHdlIHRyeSB0byBkZXRlY3Qgd2hlbiB0aGlzIGlzbid0CiAgICAgICAgICAgICAgICAvLyB0aGUgY2FzZSBhbmQgcHJpbnQgYSB3YXJuaW5nIGluIGRldmVsb3BtZW50PwogICAgICAgICAgICAgICAgLy8gVGhlIHN0b3JlIGNoYW5nZWQuIENoZWNrIGlmIHRoZSBzbmFwc2hvdCBjaGFuZ2VkIHNpbmNlIHRoZSBsYXN0IHRpbWUgd2UKICAgICAgICAgICAgICAgIC8vIHJlYWQgZnJvbSB0aGUgc3RvcmUuCiAgICAgICAgICAgICAgICBpZiAoY2hlY2tJZlNuYXBzaG90Q2hhbmdlZChpbnN0KSkgewogICAgICAgICAgICAgICAgICAvLyBGb3JjZSBhIHJlLXJlbmRlci4KICAgICAgICAgICAgICAgICAgZm9yY2VVcGRhdGUoewogICAgICAgICAgICAgICAgICAgIGluc3Q6IGluc3QKICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfTsgLy8gU3Vic2NyaWJlIHRvIHRoZSBzdG9yZSBhbmQgcmV0dXJuIGEgY2xlYW4tdXAgZnVuY3Rpb24uCgoKICAgICAgICAgICAgICByZXR1cm4gc3Vic2NyaWJlKGhhbmRsZVN0b3JlQ2hhbmdlKTsgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIHJlYWN0LWhvb2tzL2V4aGF1c3RpdmUtZGVwcwogICAgICAgICAgICB9LCBbc3Vic2NyaWJlXSk7CiAgICAgICAgICAgIHVzZURlYnVnVmFsdWUodmFsdWUpOwogICAgICAgICAgICByZXR1cm4gdmFsdWU7CiAgICAgICAgICB9CgogICAgICAgICAgZnVuY3Rpb24gY2hlY2tJZlNuYXBzaG90Q2hhbmdlZChpbnN0KSB7CiAgICAgICAgICAgIHZhciBsYXRlc3RHZXRTbmFwc2hvdCA9IGluc3QuZ2V0U25hcHNob3Q7CiAgICAgICAgICAgIHZhciBwcmV2VmFsdWUgPSBpbnN0LnZhbHVlOwoKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICB2YXIgbmV4dFZhbHVlID0gbGF0ZXN0R2V0U25hcHNob3QoKTsKICAgICAgICAgICAgICByZXR1cm4gIWlzKHByZXZWYWx1ZSwgbmV4dFZhbHVlKTsKICAgICAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgfQogICAgICAgICAgfQoKICAgICAgICAgIC8qKgogICAgICAgICAgICogQ29weXJpZ2h0IChjKSBGYWNlYm9vaywgSW5jLiBhbmQgaXRzIGFmZmlsaWF0ZXMuCiAgICAgICAgICAgKgogICAgICAgICAgICogVGhpcyBzb3VyY2UgY29kZSBpcyBsaWNlbnNlZCB1bmRlciB0aGUgTUlUIGxpY2Vuc2UgZm91bmQgaW4gdGhlCiAgICAgICAgICAgKiBMSUNFTlNFIGZpbGUgaW4gdGhlIHJvb3QgZGlyZWN0b3J5IG9mIHRoaXMgc291cmNlIHRyZWUuCiAgICAgICAgICAgKgogICAgICAgICAgICogQGZsb3cKICAgICAgICAgICAqLwogICAgICAgICAgZnVuY3Rpb24gdXNlU3luY0V4dGVybmFsU3RvcmUkMShzdWJzY3JpYmUsIGdldFNuYXBzaG90LCBnZXRTZXJ2ZXJTbmFwc2hvdCkgewogICAgICAgICAgICAvLyBOb3RlOiBUaGUgc2hpbSBkb2VzIG5vdCB1c2UgZ2V0U2VydmVyU25hcHNob3QsIGJlY2F1c2UgcHJlLTE4IHZlcnNpb25zIG9mCiAgICAgICAgICAgIC8vIFJlYWN0IGRvIG5vdCBleHBvc2UgYSB3YXkgdG8gY2hlY2sgaWYgd2UncmUgaHlkcmF0aW5nLiBTbyB1c2VycyBvZiB0aGUgc2hpbQogICAgICAgICAgICAvLyB3aWxsIG5lZWQgdG8gdHJhY2sgdGhhdCB0aGVtc2VsdmVzIGFuZCByZXR1cm4gdGhlIGNvcnJlY3QgdmFsdWUKICAgICAgICAgICAgLy8gZnJvbSBgZ2V0U25hcHNob3RgLgogICAgICAgICAgICByZXR1cm4gZ2V0U25hcHNob3QoKTsKICAgICAgICAgIH0KCiAgICAgICAgICAvKioKICAgICAgICAgICAqIElubGluZWQgaW50byB0aGUgcmVhY3Qtcm91dGVyIHJlcG8gc2luY2UgdXNlLXN5bmMtZXh0ZXJuYWwtc3RvcmUgZG9lcyBub3QKICAgICAgICAgICAqIHByb3ZpZGUgYSBVTUQtY29tcGF0aWJsZSBwYWNrYWdlLCBzbyB3ZSBuZWVkIHRoaXMgdG8gYmUgYWJsZSB0byBkaXN0cmlidXRlCiAgICAgICAgICAgKiBVTUQgcmVhY3Qtcm91dGVyIGJ1bmRsZXMKICAgICAgICAgICAqLwogICAgICAgICAgdmFyIGNhblVzZURPTSA9ICEhKHR5cGVvZiB3aW5kb3cgIT09ICJ1bmRlZmluZWQiICYmIHR5cGVvZiB3aW5kb3cuZG9jdW1lbnQgIT09ICJ1bmRlZmluZWQiICYmIHR5cGVvZiB3aW5kb3cuZG9jdW1lbnQuY3JlYXRlRWxlbWVudCAhPT0gInVuZGVmaW5lZCIpOwogICAgICAgICAgdmFyIGlzU2VydmVyRW52aXJvbm1lbnQgPSAhY2FuVXNlRE9NOwogICAgICAgICAgdmFyIHNoaW0gPSBpc1NlcnZlckVudmlyb25tZW50ID8gdXNlU3luY0V4dGVybmFsU3RvcmUkMSA6IHVzZVN5bmNFeHRlcm5hbFN0b3JlJDI7CiAgICAgICAgICB2YXIgdXNlU3luY0V4dGVybmFsU3RvcmUgPSB0cnVlID8gKChtb2R1bGUpID0+IG1vZHVsZS51c2VTeW5jRXh0ZXJuYWxTdG9yZSkocmVhY3RfbmFtZXNwYWNlT2JqZWN0KSA6IHNoaW07CgogICAgICAgICAgdmFyIERhdGFSb3V0ZXJDb250ZXh0ID0gLyojX19QVVJFX18qL3JlYWN0LmNyZWF0ZUNvbnRleHQobnVsbCk7CgogICAgICAgICAgaWYgKGZhbHNlKSB7fQoKICAgICAgICAgIHZhciBEYXRhUm91dGVyU3RhdGVDb250ZXh0ID0gLyojX19QVVJFX18qL3JlYWN0LmNyZWF0ZUNvbnRleHQobnVsbCk7CgogICAgICAgICAgaWYgKGZhbHNlKSB7fQoKICAgICAgICAgIHZhciBBd2FpdENvbnRleHQgPSAvKiNfX1BVUkVfXyovIC8qIHVudXNlZCBwdXJlIGV4cHJlc3Npb24gb3Igc3VwZXIgKi9udWxsICYmIFJlYWN0LmNyZWF0ZUNvbnRleHQobnVsbCk7CgogICAgICAgICAgaWYgKGZhbHNlKSB7fQoKICAgICAgICAgIHZhciBOYXZpZ2F0aW9uQ29udGV4dCA9IC8qI19fUFVSRV9fKi9yZWFjdC5jcmVhdGVDb250ZXh0KG51bGwpOwoKICAgICAgICAgIGlmIChmYWxzZSkge30KCiAgICAgICAgICB2YXIgTG9jYXRpb25Db250ZXh0ID0gLyojX19QVVJFX18qL3JlYWN0LmNyZWF0ZUNvbnRleHQobnVsbCk7CgogICAgICAgICAgaWYgKGZhbHNlKSB7fQoKICAgICAgICAgIHZhciBSb3V0ZUNvbnRleHQgPSAvKiNfX1BVUkVfXyovcmVhY3QuY3JlYXRlQ29udGV4dCh7CiAgICAgICAgICAgIG91dGxldDogbnVsbCwKICAgICAgICAgICAgbWF0Y2hlczogW10KICAgICAgICAgIH0pOwoKICAgICAgICAgIGlmIChmYWxzZSkge30KCiAgICAgICAgICB2YXIgUm91dGVFcnJvckNvbnRleHQgPSAvKiNfX1BVUkVfXyovcmVhY3QuY3JlYXRlQ29udGV4dChudWxsKTsKCiAgICAgICAgICBpZiAoZmFsc2UpIHt9CgogICAgICAgICAgLyoqCiAgICAgICAgICAgKiBSZXR1cm5zIHRoZSBmdWxsIGhyZWYgZm9yIHRoZSBnaXZlbiAidG8iIHZhbHVlLiBUaGlzIGlzIHVzZWZ1bCBmb3IgYnVpbGRpbmcKICAgICAgICAgICAqIGN1c3RvbSBsaW5rcyB0aGF0IGFyZSBhbHNvIGFjY2Vzc2libGUgYW5kIHByZXNlcnZlIHJpZ2h0LWNsaWNrIGJlaGF2aW9yLgogICAgICAgICAgICoKICAgICAgICAgICAqIEBzZWUgaHR0cHM6Ly9yZWFjdHJvdXRlci5jb20vaG9va3MvdXNlLWhyZWYKICAgICAgICAgICAqLwoKICAgICAgICAgIGZ1bmN0aW9uIHVzZUhyZWYodG8sIF90ZW1wKSB7CiAgICAgICAgICAgIHZhciBfcmVmMzAgPQoKICAgICAgICAgICAgICBfdGVtcCA9PT0gdm9pZCAwID8ge30gOiBfdGVtcCxyZWxhdGl2ZSA9IF9yZWYzMC5yZWxhdGl2ZTsKICAgICAgICAgICAgIXVzZUluUm91dGVyQ29udGV4dCgpID8gZmFsc2UgPyAwIDogcm91dGVyX2ludmFyaWFudChmYWxzZSkgOiB2b2lkIDA7CiAgICAgICAgICAgIHZhciBfcmVhY3QkdXNlQ29udGV4dCA9CgoKICAgICAgICAgICAgICByZWFjdC51c2VDb250ZXh0KE5hdmlnYXRpb25Db250ZXh0KSxiYXNlbmFtZSA9IF9yZWFjdCR1c2VDb250ZXh0LmJhc2VuYW1lLG5hdmlnYXRvciA9IF9yZWFjdCR1c2VDb250ZXh0Lm5hdmlnYXRvcjsKICAgICAgICAgICAgdmFyIF9kaXN0X3VzZVJlc29sdmVkUGF0aCA9CgoKCiAgICAgICAgICAgICAgZGlzdF91c2VSZXNvbHZlZFBhdGgodG8sIHsKICAgICAgICAgICAgICAgIHJlbGF0aXZlOiByZWxhdGl2ZQogICAgICAgICAgICAgIH0pLGhhc2ggPSBfZGlzdF91c2VSZXNvbHZlZFBhdGguaGFzaCxwYXRobmFtZSA9IF9kaXN0X3VzZVJlc29sdmVkUGF0aC5wYXRobmFtZSxzZWFyY2ggPSBfZGlzdF91c2VSZXNvbHZlZFBhdGguc2VhcmNoOwogICAgICAgICAgICB2YXIgam9pbmVkUGF0aG5hbWUgPSBwYXRobmFtZTsgLy8gSWYgd2UncmUgb3BlcmF0aW5nIHdpdGhpbiBhIGJhc2VuYW1lLCBwcmVwZW5kIGl0IHRvIHRoZSBwYXRobmFtZSBwcmlvcgogICAgICAgICAgICAvLyB0byBjcmVhdGluZyB0aGUgaHJlZi4gIElmIHRoaXMgaXMgYSByb290IG5hdmlnYXRpb24sIHRoZW4ganVzdCB1c2UgdGhlIHJhdwogICAgICAgICAgICAvLyBiYXNlbmFtZSB3aGljaCBhbGxvd3MgdGhlIGJhc2VuYW1lIHRvIGhhdmUgZnVsbCBjb250cm9sIG92ZXIgdGhlIHByZXNlbmNlCiAgICAgICAgICAgIC8vIG9mIGEgdHJhaWxpbmcgc2xhc2ggb24gcm9vdCBsaW5rcwoKICAgICAgICAgICAgaWYgKGJhc2VuYW1lICE9PSAiLyIpIHsKICAgICAgICAgICAgICBqb2luZWRQYXRobmFtZSA9IHBhdGhuYW1lID09PSAiLyIgPyBiYXNlbmFtZSA6IHJvdXRlcl9qb2luUGF0aHMoW2Jhc2VuYW1lLCBwYXRobmFtZV0pOwogICAgICAgICAgICB9CgogICAgICAgICAgICByZXR1cm4gbmF2aWdhdG9yLmNyZWF0ZUhyZWYoewogICAgICAgICAgICAgIHBhdGhuYW1lOiBqb2luZWRQYXRobmFtZSwKICAgICAgICAgICAgICBzZWFyY2g6IHNlYXJjaCwKICAgICAgICAgICAgICBoYXNoOiBoYXNoCiAgICAgICAgICAgIH0pOwogICAgICAgICAgfQogICAgICAgICAgLyoqCiAgICAgICAgICAgKiBSZXR1cm5zIHRydWUgaWYgdGhpcyBjb21wb25lbnQgaXMgYSBkZXNjZW5kYW50IG9mIGEgPFJvdXRlcj4uCiAgICAgICAgICAgKgogICAgICAgICAgICogQHNlZSBodHRwczovL3JlYWN0cm91dGVyLmNvbS9ob29rcy91c2UtaW4tcm91dGVyLWNvbnRleHQKICAgICAgICAgICAqLwoKICAgICAgICAgIGZ1bmN0aW9uIHVzZUluUm91dGVyQ29udGV4dCgpIHsKICAgICAgICAgICAgcmV0dXJuIHJlYWN0LnVzZUNvbnRleHQoTG9jYXRpb25Db250ZXh0KSAhPSBudWxsOwogICAgICAgICAgfQogICAgICAgICAgLyoqCiAgICAgICAgICAgKiBSZXR1cm5zIHRoZSBjdXJyZW50IGxvY2F0aW9uIG9iamVjdCwgd2hpY2ggcmVwcmVzZW50cyB0aGUgY3VycmVudCBVUkwgaW4gd2ViCiAgICAgICAgICAgKiBicm93c2Vycy4KICAgICAgICAgICAqCiAgICAgICAgICAgKiBOb3RlOiBJZiB5b3UncmUgdXNpbmcgdGhpcyBpdCBtYXkgbWVhbiB5b3UncmUgZG9pbmcgc29tZSBvZiB5b3VyIG93bgogICAgICAgICAgICogInJvdXRpbmciIGluIHlvdXIgYXBwLCBhbmQgd2UnZCBsaWtlIHRvIGtub3cgd2hhdCB5b3VyIHVzZSBjYXNlIGlzLiBXZSBtYXkKICAgICAgICAgICAqIGJlIGFibGUgdG8gcHJvdmlkZSBzb21ldGhpbmcgaGlnaGVyLWxldmVsIHRvIGJldHRlciBzdWl0IHlvdXIgbmVlZHMuCiAgICAgICAgICAgKgogICAgICAgICAgICogQHNlZSBodHRwczovL3JlYWN0cm91dGVyLmNvbS9ob29rcy91c2UtbG9jYXRpb24KICAgICAgICAgICAqLwoKICAgICAgICAgIGZ1bmN0aW9uIGRpc3RfdXNlTG9jYXRpb24oKSB7CiAgICAgICAgICAgICF1c2VJblJvdXRlckNvbnRleHQoKSA/IGZhbHNlID8gMCA6IHJvdXRlcl9pbnZhcmlhbnQoZmFsc2UpIDogdm9pZCAwOwogICAgICAgICAgICByZXR1cm4gcmVhY3QudXNlQ29udGV4dChMb2NhdGlvbkNvbnRleHQpLmxvY2F0aW9uOwogICAgICAgICAgfQogICAgICAgICAgLyoqCiAgICAgICAgICAgKiBSZXR1cm5zIHRoZSBjdXJyZW50IG5hdmlnYXRpb24gYWN0aW9uIHdoaWNoIGRlc2NyaWJlcyBob3cgdGhlIHJvdXRlciBjYW1lIHRvCiAgICAgICAgICAgKiB0aGUgY3VycmVudCBsb2NhdGlvbiwgZWl0aGVyIGJ5IGEgcG9wLCBwdXNoLCBvciByZXBsYWNlIG9uIHRoZSBoaXN0b3J5IHN0YWNrLgogICAgICAgICAgICoKICAgICAgICAgICAqIEBzZWUgaHR0cHM6Ly9yZWFjdHJvdXRlci5jb20vaG9va3MvdXNlLW5hdmlnYXRpb24tdHlwZQogICAgICAgICAgICovCgogICAgICAgICAgZnVuY3Rpb24gdXNlTmF2aWdhdGlvblR5cGUoKSB7CiAgICAgICAgICAgIHJldHVybiBSZWFjdC51c2VDb250ZXh0KExvY2F0aW9uQ29udGV4dCkubmF2aWdhdGlvblR5cGU7CiAgICAgICAgICB9CiAgICAgICAgICAvKioKICAgICAgICAgICAqIFJldHVybnMgYSBQYXRoTWF0Y2ggb2JqZWN0IGlmIHRoZSBnaXZlbiBwYXR0ZXJuIG1hdGNoZXMgdGhlIGN1cnJlbnQgVVJMLgogICAgICAgICAgICogVGhpcyBpcyB1c2VmdWwgZm9yIGNvbXBvbmVudHMgdGhhdCBuZWVkIHRvIGtub3cgImFjdGl2ZSIgc3RhdGUsIGUuZy4KICAgICAgICAgICAqIDxOYXZMaW5rPi4KICAgICAgICAgICAqCiAgICAgICAgICAgKiBAc2VlIGh0dHBzOi8vcmVhY3Ryb3V0ZXIuY29tL2hvb2tzL3VzZS1tYXRjaAogICAgICAgICAgICovCgogICAgICAgICAgZnVuY3Rpb24gdXNlTWF0Y2gocGF0dGVybikgewogICAgICAgICAgICAhdXNlSW5Sb3V0ZXJDb250ZXh0KCkgPyBmYWxzZSA/IDAgOiBpbnZhcmlhbnQoZmFsc2UpIDogdm9pZCAwOwogICAgICAgICAgICB2YXIgX2Rpc3RfdXNlTG9jYXRpb24gPQoKICAgICAgICAgICAgICBkaXN0X3VzZUxvY2F0aW9uKCkscGF0aG5hbWUgPSBfZGlzdF91c2VMb2NhdGlvbi5wYXRobmFtZTsKICAgICAgICAgICAgcmV0dXJuIFJlYWN0LnVzZU1lbW8oKCkgPT4gbWF0Y2hQYXRoKHBhdHRlcm4sIHBhdGhuYW1lKSwgW3BhdGhuYW1lLCBwYXR0ZXJuXSk7CiAgICAgICAgICB9CiAgICAgICAgICAvKioKICAgICAgICAgICAqIFRoZSBpbnRlcmZhY2UgZm9yIHRoZSBuYXZpZ2F0ZSgpIGZ1bmN0aW9uIHJldHVybmVkIGZyb20gdXNlTmF2aWdhdGUoKS4KICAgICAgICAgICAqLwoKICAgICAgICAgIC8qKgogICAgICAgICAgICogUmV0dXJucyBhbiBpbXBlcmF0aXZlIG1ldGhvZCBmb3IgY2hhbmdpbmcgdGhlIGxvY2F0aW9uLiBVc2VkIGJ5IDxMaW5rPnMsIGJ1dAogICAgICAgICAgICogbWF5IGFsc28gYmUgdXNlZCBieSBvdGhlciBlbGVtZW50cyB0byBjaGFuZ2UgdGhlIGxvY2F0aW9uLgogICAgICAgICAgICoKICAgICAgICAgICAqIEBzZWUgaHR0cHM6Ly9yZWFjdHJvdXRlci5jb20vaG9va3MvdXNlLW5hdmlnYXRlCiAgICAgICAgICAgKi8KICAgICAgICAgIGZ1bmN0aW9uIGRpc3RfdXNlTmF2aWdhdGUoKSB7CiAgICAgICAgICAgICF1c2VJblJvdXRlckNvbnRleHQoKSA/IGZhbHNlID8gMCA6IHJvdXRlcl9pbnZhcmlhbnQoZmFsc2UpIDogdm9pZCAwOwogICAgICAgICAgICB2YXIgX3JlYWN0JHVzZUNvbnRleHQyID0KCgogICAgICAgICAgICAgIHJlYWN0LnVzZUNvbnRleHQoTmF2aWdhdGlvbkNvbnRleHQpLGJhc2VuYW1lID0gX3JlYWN0JHVzZUNvbnRleHQyLmJhc2VuYW1lLG5hdmlnYXRvciA9IF9yZWFjdCR1c2VDb250ZXh0Mi5uYXZpZ2F0b3I7CiAgICAgICAgICAgIHZhciBfcmVhY3QkdXNlQ29udGV4dDMgPQoKICAgICAgICAgICAgICByZWFjdC51c2VDb250ZXh0KFJvdXRlQ29udGV4dCksbWF0Y2hlcyA9IF9yZWFjdCR1c2VDb250ZXh0My5tYXRjaGVzOwogICAgICAgICAgICB2YXIgX2Rpc3RfdXNlTG9jYXRpb24yID0KCiAgICAgICAgICAgICAgZGlzdF91c2VMb2NhdGlvbigpLGxvY2F0aW9uUGF0aG5hbWUgPSBfZGlzdF91c2VMb2NhdGlvbjIucGF0aG5hbWU7CiAgICAgICAgICAgIHZhciByb3V0ZVBhdGhuYW1lc0pzb24gPSBKU09OLnN0cmluZ2lmeShnZXRQYXRoQ29udHJpYnV0aW5nTWF0Y2hlcyhtYXRjaGVzKS5tYXAoKG1hdGNoKSA9PiBtYXRjaC5wYXRobmFtZUJhc2UpKTsKICAgICAgICAgICAgdmFyIGFjdGl2ZVJlZiA9IHJlYWN0LnVzZVJlZihmYWxzZSk7CiAgICAgICAgICAgIHJlYWN0LnVzZUVmZmVjdCgoKSA9PiB7CiAgICAgICAgICAgICAgYWN0aXZlUmVmLmN1cnJlbnQgPSB0cnVlOwogICAgICAgICAgICB9KTsKICAgICAgICAgICAgdmFyIG5hdmlnYXRlID0gcmVhY3QudXNlQ2FsbGJhY2soZnVuY3Rpb24gKHRvLCBvcHRpb25zKSB7CiAgICAgICAgICAgICAgaWYgKG9wdGlvbnMgPT09IHZvaWQgMCkgewogICAgICAgICAgICAgICAgb3B0aW9ucyA9IHt9OwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgZmFsc2UgPyAwIDogdm9pZCAwOwogICAgICAgICAgICAgIGlmICghYWN0aXZlUmVmLmN1cnJlbnQpIHJldHVybjsKCiAgICAgICAgICAgICAgaWYgKHR5cGVvZiB0byA9PT0gIm51bWJlciIpIHsKICAgICAgICAgICAgICAgIG5hdmlnYXRvci5nbyh0byk7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICB2YXIgcGF0aCA9IHJlc29sdmVUbyh0bywgSlNPTi5wYXJzZShyb3V0ZVBhdGhuYW1lc0pzb24pLCBsb2NhdGlvblBhdGhuYW1lLCBvcHRpb25zLnJlbGF0aXZlID09PSAicGF0aCIpOyAvLyBJZiB3ZSdyZSBvcGVyYXRpbmcgd2l0aGluIGEgYmFzZW5hbWUsIHByZXBlbmQgaXQgdG8gdGhlIHBhdGhuYW1lIHByaW9yCiAgICAgICAgICAgICAgLy8gdG8gaGFuZGluZyBvZmYgdG8gaGlzdG9yeS4gIElmIHRoaXMgaXMgYSByb290IG5hdmlnYXRpb24sIHRoZW4gd2UKICAgICAgICAgICAgICAvLyBuYXZpZ2F0ZSB0byB0aGUgcmF3IGJhc2VuYW1lIHdoaWNoIGFsbG93cyB0aGUgYmFzZW5hbWUgdG8gaGF2ZSBmdWxsCiAgICAgICAgICAgICAgLy8gY29udHJvbCBvdmVyIHRoZSBwcmVzZW5jZSBvZiBhIHRyYWlsaW5nIHNsYXNoIG9uIHJvb3QgbGlua3MKCiAgICAgICAgICAgICAgaWYgKGJhc2VuYW1lICE9PSAiLyIpIHsKICAgICAgICAgICAgICAgIHBhdGgucGF0aG5hbWUgPSBwYXRoLnBhdGhuYW1lID09PSAiLyIgPyBiYXNlbmFtZSA6IHJvdXRlcl9qb2luUGF0aHMoW2Jhc2VuYW1lLCBwYXRoLnBhdGhuYW1lXSk7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAoISFvcHRpb25zLnJlcGxhY2UgPyBuYXZpZ2F0b3IucmVwbGFjZSA6IG5hdmlnYXRvci5wdXNoKShwYXRoLCBvcHRpb25zLnN0YXRlLCBvcHRpb25zKTsKICAgICAgICAgICAgfSwgW2Jhc2VuYW1lLCBuYXZpZ2F0b3IsIHJvdXRlUGF0aG5hbWVzSnNvbiwgbG9jYXRpb25QYXRobmFtZV0pOwogICAgICAgICAgICByZXR1cm4gbmF2aWdhdGU7CiAgICAgICAgICB9CiAgICAgICAgICB2YXIgT3V0bGV0Q29udGV4dCA9IC8qI19fUFVSRV9fKi9yZWFjdC5jcmVhdGVDb250ZXh0KG51bGwpOwogICAgICAgICAgLyoqCiAgICAgICAgICAgKiBSZXR1cm5zIHRoZSBjb250ZXh0IChpZiBwcm92aWRlZCkgZm9yIHRoZSBjaGlsZCByb3V0ZSBhdCB0aGlzIGxldmVsIG9mIHRoZSByb3V0ZQogICAgICAgICAgICogaGllcmFyY2h5LgogICAgICAgICAgICogQHNlZSBodHRwczovL3JlYWN0cm91dGVyLmNvbS9ob29rcy91c2Utb3V0bGV0LWNvbnRleHQKICAgICAgICAgICAqLwoKICAgICAgICAgIGZ1bmN0aW9uIHVzZU91dGxldENvbnRleHQoKSB7CiAgICAgICAgICAgIHJldHVybiBSZWFjdC51c2VDb250ZXh0KE91dGxldENvbnRleHQpOwogICAgICAgICAgfQogICAgICAgICAgLyoqCiAgICAgICAgICAgKiBSZXR1cm5zIHRoZSBlbGVtZW50IGZvciB0aGUgY2hpbGQgcm91dGUgYXQgdGhpcyBsZXZlbCBvZiB0aGUgcm91dGUKICAgICAgICAgICAqIGhpZXJhcmNoeS4gVXNlZCBpbnRlcm5hbGx5IGJ5IDxPdXRsZXQ+IHRvIHJlbmRlciBjaGlsZCByb3V0ZXMuCiAgICAgICAgICAgKgogICAgICAgICAgICogQHNlZSBodHRwczovL3JlYWN0cm91dGVyLmNvbS9ob29rcy91c2Utb3V0bGV0CiAgICAgICAgICAgKi8KCiAgICAgICAgICBmdW5jdGlvbiB1c2VPdXRsZXQoY29udGV4dCkgewogICAgICAgICAgICB2YXIgb3V0bGV0ID0gcmVhY3QudXNlQ29udGV4dChSb3V0ZUNvbnRleHQpLm91dGxldDsKCiAgICAgICAgICAgIGlmIChvdXRsZXQpIHsKICAgICAgICAgICAgICByZXR1cm4gLyojX19QVVJFX18qL3JlYWN0LmNyZWF0ZUVsZW1lbnQoT3V0bGV0Q29udGV4dC5Qcm92aWRlciwgewogICAgICAgICAgICAgICAgdmFsdWU6IGNvbnRleHQKICAgICAgICAgICAgICB9LCBvdXRsZXQpOwogICAgICAgICAgICB9CgogICAgICAgICAgICByZXR1cm4gb3V0bGV0OwogICAgICAgICAgfQogICAgICAgICAgLyoqCiAgICAgICAgICAgKiBSZXR1cm5zIGFuIG9iamVjdCBvZiBrZXkvdmFsdWUgcGFpcnMgb2YgdGhlIGR5bmFtaWMgcGFyYW1zIGZyb20gdGhlIGN1cnJlbnQKICAgICAgICAgICAqIFVSTCB0aGF0IHdlcmUgbWF0Y2hlZCBieSB0aGUgcm91dGUgcGF0aC4KICAgICAgICAgICAqCiAgICAgICAgICAgKiBAc2VlIGh0dHBzOi8vcmVhY3Ryb3V0ZXIuY29tL2hvb2tzL3VzZS1wYXJhbXMKICAgICAgICAgICAqLwoKICAgICAgICAgIGZ1bmN0aW9uIHVzZVBhcmFtcygpIHsKICAgICAgICAgICAgdmFyIF9SZWFjdCR1c2VDb250ZXh0ID0KCiAgICAgICAgICAgICAgUmVhY3QudXNlQ29udGV4dChSb3V0ZUNvbnRleHQpLG1hdGNoZXMgPSBfUmVhY3QkdXNlQ29udGV4dC5tYXRjaGVzOwogICAgICAgICAgICB2YXIgcm91dGVNYXRjaCA9IG1hdGNoZXNbbWF0Y2hlcy5sZW5ndGggLSAxXTsKICAgICAgICAgICAgcmV0dXJuIHJvdXRlTWF0Y2ggPyByb3V0ZU1hdGNoLnBhcmFtcyA6IHt9OwogICAgICAgICAgfQogICAgICAgICAgLyoqCiAgICAgICAgICAgKiBSZXNvbHZlcyB0aGUgcGF0aG5hbWUgb2YgdGhlIGdpdmVuIGB0b2AgdmFsdWUgYWdhaW5zdCB0aGUgY3VycmVudCBsb2NhdGlvbi4KICAgICAgICAgICAqCiAgICAgICAgICAgKiBAc2VlIGh0dHBzOi8vcmVhY3Ryb3V0ZXIuY29tL2hvb2tzL3VzZS1yZXNvbHZlZC1wYXRoCiAgICAgICAgICAgKi8KCiAgICAgICAgICBmdW5jdGlvbiBkaXN0X3VzZVJlc29sdmVkUGF0aCh0bywgX3RlbXAyKSB7CiAgICAgICAgICAgIHZhciBfcmVmMzEgPQoKICAgICAgICAgICAgICBfdGVtcDIgPT09IHZvaWQgMCA/IHt9IDogX3RlbXAyLHJlbGF0aXZlID0gX3JlZjMxLnJlbGF0aXZlOwogICAgICAgICAgICB2YXIgX3JlYWN0JHVzZUNvbnRleHQ0ID0KCiAgICAgICAgICAgICAgcmVhY3QudXNlQ29udGV4dChSb3V0ZUNvbnRleHQpLG1hdGNoZXMgPSBfcmVhY3QkdXNlQ29udGV4dDQubWF0Y2hlczsKICAgICAgICAgICAgdmFyIF9kaXN0X3VzZUxvY2F0aW9uMyA9CgogICAgICAgICAgICAgIGRpc3RfdXNlTG9jYXRpb24oKSxsb2NhdGlvblBhdGhuYW1lID0gX2Rpc3RfdXNlTG9jYXRpb24zLnBhdGhuYW1lOwogICAgICAgICAgICB2YXIgcm91dGVQYXRobmFtZXNKc29uID0gSlNPTi5zdHJpbmdpZnkoZ2V0UGF0aENvbnRyaWJ1dGluZ01hdGNoZXMobWF0Y2hlcykubWFwKChtYXRjaCkgPT4gbWF0Y2gucGF0aG5hbWVCYXNlKSk7CiAgICAgICAgICAgIHJldHVybiByZWFjdC51c2VNZW1vKCgpID0+IHJlc29sdmVUbyh0bywgSlNPTi5wYXJzZShyb3V0ZVBhdGhuYW1lc0pzb24pLCBsb2NhdGlvblBhdGhuYW1lLCByZWxhdGl2ZSA9PT0gInBhdGgiKSwgW3RvLCByb3V0ZVBhdGhuYW1lc0pzb24sIGxvY2F0aW9uUGF0aG5hbWUsIHJlbGF0aXZlXSk7CiAgICAgICAgICB9CiAgICAgICAgICAvKioKICAgICAgICAgICAqIFJldHVybnMgdGhlIGVsZW1lbnQgb2YgdGhlIHJvdXRlIHRoYXQgbWF0Y2hlZCB0aGUgY3VycmVudCBsb2NhdGlvbiwgcHJlcGFyZWQKICAgICAgICAgICAqIHdpdGggdGhlIGNvcnJlY3QgY29udGV4dCB0byByZW5kZXIgdGhlIHJlbWFpbmRlciBvZiB0aGUgcm91dGUgdHJlZS4gUm91dGUKICAgICAgICAgICAqIGVsZW1lbnRzIGluIHRoZSB0cmVlIG11c3QgcmVuZGVyIGFuIDxPdXRsZXQ+IHRvIHJlbmRlciB0aGVpciBjaGlsZCByb3V0ZSdzCiAgICAgICAgICAgKiBlbGVtZW50LgogICAgICAgICAgICoKICAgICAgICAgICAqIEBzZWUgaHR0cHM6Ly9yZWFjdHJvdXRlci5jb20vaG9va3MvdXNlLXJvdXRlcwogICAgICAgICAgICovCgogICAgICAgICAgZnVuY3Rpb24gdXNlUm91dGVzKHJvdXRlcywgbG9jYXRpb25BcmcpIHsKICAgICAgICAgICAgIXVzZUluUm91dGVyQ29udGV4dCgpID8gZmFsc2UgPyAwIDogcm91dGVyX2ludmFyaWFudChmYWxzZSkgOiB2b2lkIDA7CiAgICAgICAgICAgIHZhciBfcmVhY3QkdXNlQ29udGV4dDUgPQoKICAgICAgICAgICAgICByZWFjdC51c2VDb250ZXh0KE5hdmlnYXRpb25Db250ZXh0KSxuYXZpZ2F0b3IgPSBfcmVhY3QkdXNlQ29udGV4dDUubmF2aWdhdG9yOwogICAgICAgICAgICB2YXIgZGF0YVJvdXRlclN0YXRlQ29udGV4dCA9IHJlYWN0LnVzZUNvbnRleHQoRGF0YVJvdXRlclN0YXRlQ29udGV4dCk7CiAgICAgICAgICAgIHZhciBfcmVhY3QkdXNlQ29udGV4dDYgPQoKICAgICAgICAgICAgICByZWFjdC51c2VDb250ZXh0KFJvdXRlQ29udGV4dCkscGFyZW50TWF0Y2hlcyA9IF9yZWFjdCR1c2VDb250ZXh0Ni5tYXRjaGVzOwogICAgICAgICAgICB2YXIgcm91dGVNYXRjaCA9IHBhcmVudE1hdGNoZXNbcGFyZW50TWF0Y2hlcy5sZW5ndGggLSAxXTsKICAgICAgICAgICAgdmFyIHBhcmVudFBhcmFtcyA9IHJvdXRlTWF0Y2ggPyByb3V0ZU1hdGNoLnBhcmFtcyA6IHt9OwogICAgICAgICAgICB2YXIgcGFyZW50UGF0aG5hbWUgPSByb3V0ZU1hdGNoID8gcm91dGVNYXRjaC5wYXRobmFtZSA6ICIvIjsKICAgICAgICAgICAgdmFyIHBhcmVudFBhdGhuYW1lQmFzZSA9IHJvdXRlTWF0Y2ggPyByb3V0ZU1hdGNoLnBhdGhuYW1lQmFzZSA6ICIvIjsKICAgICAgICAgICAgdmFyIHBhcmVudFJvdXRlID0gcm91dGVNYXRjaCAmJiByb3V0ZU1hdGNoLnJvdXRlOwoKICAgICAgICAgICAgaWYgKGZhbHNlKSB7fQoKICAgICAgICAgICAgdmFyIGxvY2F0aW9uRnJvbUNvbnRleHQgPSBkaXN0X3VzZUxvY2F0aW9uKCk7CiAgICAgICAgICAgIHZhciBsb2NhdGlvbjsKCiAgICAgICAgICAgIGlmIChsb2NhdGlvbkFyZykgewogICAgICAgICAgICAgIHZhciBfcGFyc2VkTG9jYXRpb25BcmckcGE7CgogICAgICAgICAgICAgIHZhciBwYXJzZWRMb2NhdGlvbkFyZyA9IHR5cGVvZiBsb2NhdGlvbkFyZyA9PT0gInN0cmluZyIgPyBwYXJzZVBhdGgobG9jYXRpb25BcmcpIDogbG9jYXRpb25Bcmc7CiAgICAgICAgICAgICAgIShwYXJlbnRQYXRobmFtZUJhc2UgPT09ICIvIiB8fCAoKF9wYXJzZWRMb2NhdGlvbkFyZyRwYSA9IHBhcnNlZExvY2F0aW9uQXJnLnBhdGhuYW1lKSA9PSBudWxsID8gdm9pZCAwIDogX3BhcnNlZExvY2F0aW9uQXJnJHBhLnN0YXJ0c1dpdGgocGFyZW50UGF0aG5hbWVCYXNlKSkpID8gZmFsc2UgPyAwIDogcm91dGVyX2ludmFyaWFudChmYWxzZSkgOiB2b2lkIDA7CiAgICAgICAgICAgICAgbG9jYXRpb24gPSBwYXJzZWRMb2NhdGlvbkFyZzsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICBsb2NhdGlvbiA9IGxvY2F0aW9uRnJvbUNvbnRleHQ7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHZhciBwYXRobmFtZSA9IGxvY2F0aW9uLnBhdGhuYW1lIHx8ICIvIjsKICAgICAgICAgICAgdmFyIHJlbWFpbmluZ1BhdGhuYW1lID0gcGFyZW50UGF0aG5hbWVCYXNlID09PSAiLyIgPyBwYXRobmFtZSA6IHBhdGhuYW1lLnNsaWNlKHBhcmVudFBhdGhuYW1lQmFzZS5sZW5ndGgpIHx8ICIvIjsKICAgICAgICAgICAgdmFyIG1hdGNoZXMgPSBtYXRjaFJvdXRlcyhyb3V0ZXMsIHsKICAgICAgICAgICAgICBwYXRobmFtZTogcmVtYWluaW5nUGF0aG5hbWUKICAgICAgICAgICAgfSk7CgogICAgICAgICAgICBpZiAoZmFsc2UpIHt9CgogICAgICAgICAgICB2YXIgcmVuZGVyZWRNYXRjaGVzID0gX3JlbmRlck1hdGNoZXMobWF0Y2hlcyAmJiBtYXRjaGVzLm1hcCgobWF0Y2gpID0+IE9iamVjdC5hc3NpZ24oe30sIG1hdGNoLCB7CiAgICAgICAgICAgICAgcGFyYW1zOiBPYmplY3QuYXNzaWduKHt9LCBwYXJlbnRQYXJhbXMsIG1hdGNoLnBhcmFtcyksCiAgICAgICAgICAgICAgcGF0aG5hbWU6IHJvdXRlcl9qb2luUGF0aHMoW3BhcmVudFBhdGhuYW1lQmFzZSwgLy8gUmUtZW5jb2RlIHBhdGhuYW1lcyB0aGF0IHdlcmUgZGVjb2RlZCBpbnNpZGUgbWF0Y2hSb3V0ZXMKICAgICAgICAgICAgICBuYXZpZ2F0b3IuZW5jb2RlTG9jYXRpb24gPyBuYXZpZ2F0b3IuZW5jb2RlTG9jYXRpb24obWF0Y2gucGF0aG5hbWUpLnBhdGhuYW1lIDogbWF0Y2gucGF0aG5hbWVdKSwKICAgICAgICAgICAgICBwYXRobmFtZUJhc2U6IG1hdGNoLnBhdGhuYW1lQmFzZSA9PT0gIi8iID8gcGFyZW50UGF0aG5hbWVCYXNlIDogcm91dGVyX2pvaW5QYXRocyhbcGFyZW50UGF0aG5hbWVCYXNlLCAvLyBSZS1lbmNvZGUgcGF0aG5hbWVzIHRoYXQgd2VyZSBkZWNvZGVkIGluc2lkZSBtYXRjaFJvdXRlcwogICAgICAgICAgICAgIG5hdmlnYXRvci5lbmNvZGVMb2NhdGlvbiA/IG5hdmlnYXRvci5lbmNvZGVMb2NhdGlvbihtYXRjaC5wYXRobmFtZUJhc2UpLnBhdGhuYW1lIDogbWF0Y2gucGF0aG5hbWVCYXNlXSkKICAgICAgICAgICAgfSkpLCBwYXJlbnRNYXRjaGVzLCBkYXRhUm91dGVyU3RhdGVDb250ZXh0IHx8IHVuZGVmaW5lZCk7IC8vIFdoZW4gYSB1c2VyIHBhc3NlcyBpbiBhIGBsb2NhdGlvbkFyZ2AsIHRoZSBhc3NvY2lhdGVkIHJvdXRlcyBuZWVkIHRvCiAgICAgICAgICAgIC8vIGJlIHdyYXBwZWQgaW4gYSBuZXcgYExvY2F0aW9uQ29udGV4dC5Qcm92aWRlcmAgaW4gb3JkZXIgZm9yIGB1c2VMb2NhdGlvbmAKICAgICAgICAgICAgLy8gdG8gdXNlIHRoZSBzY29wZWQgbG9jYXRpb24gaW5zdGVhZCBvZiB0aGUgZ2xvYmFsIGxvY2F0aW9uLgoKCiAgICAgICAgICAgIGlmIChsb2NhdGlvbkFyZyAmJiByZW5kZXJlZE1hdGNoZXMpIHsKICAgICAgICAgICAgICByZXR1cm4gLyojX19QVVJFX18qL3JlYWN0LmNyZWF0ZUVsZW1lbnQoTG9jYXRpb25Db250ZXh0LlByb3ZpZGVyLCB7CiAgICAgICAgICAgICAgICB2YWx1ZTogewogICAgICAgICAgICAgICAgICBsb2NhdGlvbjogZGlzdF9leHRlbmRzKHsKICAgICAgICAgICAgICAgICAgICBwYXRobmFtZTogIi8iLAogICAgICAgICAgICAgICAgICAgIHNlYXJjaDogIiIsCiAgICAgICAgICAgICAgICAgICAgaGFzaDogIiIsCiAgICAgICAgICAgICAgICAgICAgc3RhdGU6IG51bGwsCiAgICAgICAgICAgICAgICAgICAga2V5OiAiZGVmYXVsdCIKICAgICAgICAgICAgICAgICAgfSwgbG9jYXRpb24pLAogICAgICAgICAgICAgICAgICBuYXZpZ2F0aW9uVHlwZTogQWN0aW9uLlBvcAogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0sIHJlbmRlcmVkTWF0Y2hlcyk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybiByZW5kZXJlZE1hdGNoZXM7CiAgICAgICAgICB9CgogICAgICAgICAgZnVuY3Rpb24gRGVmYXVsdEVycm9yRWxlbWVudCgpIHsKICAgICAgICAgICAgdmFyIGVycm9yID0gdXNlUm91dGVFcnJvcigpOwogICAgICAgICAgICB2YXIgbWVzc2FnZSA9IGlzUm91dGVFcnJvclJlc3BvbnNlKGVycm9yKSA/IGVycm9yLnN0YXR1cyArICIgIiArIGVycm9yLnN0YXR1c1RleHQgOiBlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3IubWVzc2FnZSA6IEpTT04uc3RyaW5naWZ5KGVycm9yKTsKICAgICAgICAgICAgdmFyIHN0YWNrID0gZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLnN0YWNrIDogbnVsbDsKICAgICAgICAgICAgdmFyIGxpZ2h0Z3JleSA9ICJyZ2JhKDIwMCwyMDAsMjAwLCAwLjUpIjsKICAgICAgICAgICAgdmFyIHByZVN0eWxlcyA9IHsKICAgICAgICAgICAgICBwYWRkaW5nOiAiMC41cmVtIiwKICAgICAgICAgICAgICBiYWNrZ3JvdW5kQ29sb3I6IGxpZ2h0Z3JleQogICAgICAgICAgICB9OwogICAgICAgICAgICB2YXIgY29kZVN0eWxlcyA9IHsKICAgICAgICAgICAgICBwYWRkaW5nOiAiMnB4IDRweCIsCiAgICAgICAgICAgICAgYmFja2dyb3VuZENvbG9yOiBsaWdodGdyZXkKICAgICAgICAgICAgfTsKICAgICAgICAgICAgcmV0dXJuIC8qI19fUFVSRV9fKi9yZWFjdC5jcmVhdGVFbGVtZW50KHJlYWN0LkZyYWdtZW50LCBudWxsLCAvKiNfX1BVUkVfXyovcmVhY3QuY3JlYXRlRWxlbWVudCgiaDIiLCBudWxsLCAiVW5oYW5kbGVkIFRocm93biBFcnJvciEiKSwgLyojX19QVVJFX18qL3JlYWN0LmNyZWF0ZUVsZW1lbnQoImgzIiwgewogICAgICAgICAgICAgIHN0eWxlOiB7CiAgICAgICAgICAgICAgICBmb250U3R5bGU6ICJpdGFsaWMiCiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LCBtZXNzYWdlKSwgc3RhY2sgPyAvKiNfX1BVUkVfXyovcmVhY3QuY3JlYXRlRWxlbWVudCgicHJlIiwgewogICAgICAgICAgICAgIHN0eWxlOiBwcmVTdHlsZXMKICAgICAgICAgICAgfSwgc3RhY2spIDogbnVsbCwgLyojX19QVVJFX18qL3JlYWN0LmNyZWF0ZUVsZW1lbnQoInAiLCBudWxsLCAiXHVEODNEXHVEQ0JGIEhleSBkZXZlbG9wZXIgXHVEODNEXHVEQzRCIiksIC8qI19fUFVSRV9fKi9yZWFjdC5jcmVhdGVFbGVtZW50KCJwIiwgbnVsbCwgIllvdSBjYW4gcHJvdmlkZSBhIHdheSBiZXR0ZXIgVVggdGhhbiB0aGlzIHdoZW4geW91ciBhcHAgdGhyb3dzIGVycm9ycyBieSBwcm92aWRpbmcgeW91ciBvd25ceEEwIiwgLyojX19QVVJFX18qL3JlYWN0LmNyZWF0ZUVsZW1lbnQoImNvZGUiLCB7CiAgICAgICAgICAgICAgc3R5bGU6IGNvZGVTdHlsZXMKICAgICAgICAgICAgfSwgImVycm9yRWxlbWVudCIpLCAiIHByb3BzIG9uXHhBMCIsIC8qI19fUFVSRV9fKi9yZWFjdC5jcmVhdGVFbGVtZW50KCJjb2RlIiwgewogICAgICAgICAgICAgIHN0eWxlOiBjb2RlU3R5bGVzCiAgICAgICAgICAgIH0sICI8Um91dGU+IikpKTsKICAgICAgICAgIH12YXIKCiAgICAgICAgICBSZW5kZXJFcnJvckJvdW5kYXJ5ID0gLyojX19QVVJFX18qL2Z1bmN0aW9uIChfcmVhY3QkQ29tcG9uZW50KSB7X2luaGVyaXRzKFJlbmRlckVycm9yQm91bmRhcnksIF9yZWFjdCRDb21wb25lbnQpO3ZhciBfc3VwZXIyID0gX2NyZWF0ZVN1cGVyKFJlbmRlckVycm9yQm91bmRhcnkpOwogICAgICAgICAgICBmdW5jdGlvbiBSZW5kZXJFcnJvckJvdW5kYXJ5KHByb3BzKSB7dmFyIF90aGlzO19jbGFzc0NhbGxDaGVjazIodGhpcywgUmVuZGVyRXJyb3JCb3VuZGFyeSk7CiAgICAgICAgICAgICAgX3RoaXMgPSBfc3VwZXIyLmNhbGwodGhpcywgcHJvcHMpOwogICAgICAgICAgICAgIF90aGlzLnN0YXRlID0gewogICAgICAgICAgICAgICAgbG9jYXRpb246IHByb3BzLmxvY2F0aW9uLAogICAgICAgICAgICAgICAgZXJyb3I6IHByb3BzLmVycm9yCiAgICAgICAgICAgICAgfTtyZXR1cm4gX3RoaXM7CiAgICAgICAgICAgIH1fY3JlYXRlQ2xhc3MyKFJlbmRlckVycm9yQm91bmRhcnksIFt7IGtleTogImNvbXBvbmVudERpZENhdGNoIiwgdmFsdWU6CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCiAgICAgICAgICAgICAgZnVuY3Rpb24gY29tcG9uZW50RGlkQ2F0Y2goZXJyb3IsIGVycm9ySW5mbykgewogICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcigiUmVhY3QgUm91dGVyIGNhdWdodCB0aGUgZm9sbG93aW5nIGVycm9yIGR1cmluZyByZW5kZXIiLCBlcnJvciwgZXJyb3JJbmZvKTsKICAgICAgICAgICAgICB9IH0sIHsga2V5OiAicmVuZGVyIiwgdmFsdWU6CgogICAgICAgICAgICAgIGZ1bmN0aW9uIHJlbmRlcigpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnN0YXRlLmVycm9yID8gLyojX19QVVJFX18qL3JlYWN0LmNyZWF0ZUVsZW1lbnQoUm91dGVDb250ZXh0LlByb3ZpZGVyLCB7CiAgICAgICAgICAgICAgICAgIHZhbHVlOiB0aGlzLnByb3BzLnJvdXRlQ29udGV4dAogICAgICAgICAgICAgICAgfSwgLyojX19QVVJFX18qL3JlYWN0LmNyZWF0ZUVsZW1lbnQoUm91dGVFcnJvckNvbnRleHQuUHJvdmlkZXIsIHsKICAgICAgICAgICAgICAgICAgdmFsdWU6IHRoaXMuc3RhdGUuZXJyb3IsCiAgICAgICAgICAgICAgICAgIGNoaWxkcmVuOiB0aGlzLnByb3BzLmNvbXBvbmVudAogICAgICAgICAgICAgICAgfSkpIDogdGhpcy5wcm9wcy5jaGlsZHJlbjsKICAgICAgICAgICAgICB9IH1dLCBbeyBrZXk6ICJnZXREZXJpdmVkU3RhdGVGcm9tRXJyb3IiLCB2YWx1ZTogZnVuY3Rpb24gZ2V0RGVyaXZlZFN0YXRlRnJvbUVycm9yKGVycm9yKSB7cmV0dXJuIHsgZXJyb3I6IGVycm9yIH07fSB9LCB7IGtleTogImdldERlcml2ZWRTdGF0ZUZyb21Qcm9wcyIsIHZhbHVlOiBmdW5jdGlvbiBnZXREZXJpdmVkU3RhdGVGcm9tUHJvcHMocHJvcHMsIHN0YXRlKSB7Ly8gV2hlbiB3ZSBnZXQgaW50byBhbiBlcnJvciBzdGF0ZSwgdGhlIHVzZXIgd2lsbCBsaWtlbHkgY2xpY2sgImJhY2siIHRvIHRoZQogICAgICAgICAgICAgICAgLy8gcHJldmlvdXMgcGFnZSB0aGF0IGRpZG4ndCBoYXZlIGFuIGVycm9yLiBCZWNhdXNlIHRoaXMgd3JhcHMgdGhlIGVudGlyZQogICAgICAgICAgICAgICAgLy8gYXBwbGljYXRpb24sIHRoYXQgd2lsbCBoYXZlIG5vIGVmZmVjdC0tdGhlIGVycm9yIHBhZ2UgY29udGludWVzIHRvIGRpc3BsYXkuCiAgICAgICAgICAgICAgICAvLyBUaGlzIGdpdmVzIHVzIGEgbWVjaGFuaXNtIHRvIHJlY292ZXIgZnJvbSB0aGUgZXJyb3Igd2hlbiB0aGUgbG9jYXRpb24gY2hhbmdlcy4KICAgICAgICAgICAgICAgIC8vCiAgICAgICAgICAgICAgICAvLyBXaGV0aGVyIHdlJ3JlIGluIGFuIGVycm9yIHN0YXRlIG9yIG5vdCwgd2UgdXBkYXRlIHRoZSBsb2NhdGlvbiBpbiBzdGF0ZQogICAgICAgICAgICAgICAgLy8gc28gdGhhdCB3aGVuIHdlIGFyZSBpbiBhbiBlcnJvciBzdGF0ZSwgaXQgZ2V0cyByZXNldCB3aGVuIGEgbmV3IGxvY2F0aW9uCiAgICAgICAgICAgICAgICAvLyBjb21lcyBpbiBhbmQgdGhlIHVzZXIgcmVjb3ZlcnMgZnJvbSB0aGUgZXJyb3IuCiAgICAgICAgICAgICAgICBpZiAoc3RhdGUubG9jYXRpb24gIT09IHByb3BzLmxvY2F0aW9uKSB7cmV0dXJuIHsgZXJyb3I6IHByb3BzLmVycm9yLCBsb2NhdGlvbjogcHJvcHMubG9jYXRpb24gfTt9IC8vIElmIHdlJ3JlIG5vdCBjaGFuZ2luZyBsb2NhdGlvbnMsIHByZXNlcnZlIHRoZSBsb2NhdGlvbiBidXQgc3RpbGwgc3VyZmFjZQogICAgICAgICAgICAgICAgLy8gYW55IG5ldyBlcnJvcnMgdGhhdCBtYXkgY29tZSB0aHJvdWdoLiBXZSByZXRhaW4gdGhlIGV4aXN0aW5nIGVycm9yLCB3ZSBkbwogICAgICAgICAgICAgICAgLy8gdGhpcyBiZWNhdXNlIHRoZSBlcnJvciBwcm92aWRlZCBmcm9tIHRoZSBhcHAgc3RhdGUgbWF5IGJlIGNsZWFyZWQgd2l0aG91dAogICAgICAgICAgICAgICAgLy8gdGhlIGxvY2F0aW9uIGNoYW5naW5nLgogICAgICAgICAgICAgICAgcmV0dXJuIHsgZXJyb3I6IHByb3BzLmVycm9yIHx8IHN0YXRlLmVycm9yLCBsb2NhdGlvbjogc3RhdGUubG9jYXRpb24gfTt9IH1dKTtyZXR1cm4gUmVuZGVyRXJyb3JCb3VuZGFyeTt9KHJlYWN0LkNvbXBvbmVudCk7ZnVuY3Rpb24gUmVuZGVyZWRSb3V0ZShfcmVmKSB7dmFyIHJvdXRlQ29udGV4dCA9IF9yZWYucm91dGVDb250ZXh0LG1hdGNoID0gX3JlZi5tYXRjaCxjaGlsZHJlbiA9IF9yZWYuY2hpbGRyZW47dmFyIGRhdGFSb3V0ZXJDb250ZXh0ID0gcmVhY3QudXNlQ29udGV4dChEYXRhUm91dGVyQ29udGV4dCk7IC8vIFRyYWNrIGhvdyBkZWVwIHdlIGdvdCBpbiBvdXIgcmVuZGVyIHBhc3MgdG8gZW11bGF0ZSBTU1IgY29tcG9uZW50RGlkQ2F0Y2gKICAgICAgICAgICAgLy8gaW4gYSBEYXRhU3RhdGljUm91dGVyCiAgICAgICAgICAgIGlmIChkYXRhUm91dGVyQ29udGV4dCAmJiBkYXRhUm91dGVyQ29udGV4dC5zdGF0aWMgJiYgZGF0YVJvdXRlckNvbnRleHQuc3RhdGljQ29udGV4dCAmJiBtYXRjaC5yb3V0ZS5lcnJvckVsZW1lbnQpIHtkYXRhUm91dGVyQ29udGV4dC5zdGF0aWNDb250ZXh0Ll9kZWVwZXN0UmVuZGVyZWRCb3VuZGFyeUlkID0gbWF0Y2gucm91dGUuaWQ7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybiAvKiNfX1BVUkVfXyovcmVhY3QuY3JlYXRlRWxlbWVudChSb3V0ZUNvbnRleHQuUHJvdmlkZXIsIHsKICAgICAgICAgICAgICB2YWx1ZTogcm91dGVDb250ZXh0CiAgICAgICAgICAgIH0sIGNoaWxkcmVuKTsKICAgICAgICAgIH0KCiAgICAgICAgICBmdW5jdGlvbiBfcmVuZGVyTWF0Y2hlcyhtYXRjaGVzLCBwYXJlbnRNYXRjaGVzLCBkYXRhUm91dGVyU3RhdGUpIHsKICAgICAgICAgICAgaWYgKHBhcmVudE1hdGNoZXMgPT09IHZvaWQgMCkgewogICAgICAgICAgICAgIHBhcmVudE1hdGNoZXMgPSBbXTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKG1hdGNoZXMgPT0gbnVsbCkgewogICAgICAgICAgICAgIGlmIChkYXRhUm91dGVyU3RhdGUgIT0gbnVsbCAmJiBkYXRhUm91dGVyU3RhdGUuZXJyb3JzKSB7CiAgICAgICAgICAgICAgICAvLyBEb24ndCBiYWlsIGlmIHdlIGhhdmUgZGF0YSByb3V0ZXIgZXJyb3JzIHNvIHdlIGNhbiByZW5kZXIgdGhlbSBpbiB0aGUKICAgICAgICAgICAgICAgIC8vIGJvdW5kYXJ5LiAgVXNlIHRoZSBwcmUtbWF0Y2hlZCAob3Igc2hpbW1lZCkgbWF0Y2hlcwogICAgICAgICAgICAgICAgbWF0Y2hlcyA9IGRhdGFSb3V0ZXJTdGF0ZS5tYXRjaGVzOwogICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHZhciByZW5kZXJlZE1hdGNoZXMgPSBtYXRjaGVzOyAvLyBJZiB3ZSBoYXZlIGRhdGEgZXJyb3JzLCB0cmltIG1hdGNoZXMgdG8gdGhlIGhpZ2hlc3QgZXJyb3IgYm91bmRhcnkKCiAgICAgICAgICAgIHZhciBlcnJvcnMgPSBkYXRhUm91dGVyU3RhdGUgPT0gbnVsbCA/IHZvaWQgMCA6IGRhdGFSb3V0ZXJTdGF0ZS5lcnJvcnM7CgogICAgICAgICAgICBpZiAoZXJyb3JzICE9IG51bGwpIHsKICAgICAgICAgICAgICB2YXIgZXJyb3JJbmRleCA9IHJlbmRlcmVkTWF0Y2hlcy5maW5kSW5kZXgoKG0pID0+IG0ucm91dGUuaWQgJiYgKGVycm9ycyA9PSBudWxsID8gdm9pZCAwIDogZXJyb3JzW20ucm91dGUuaWRdKSk7CiAgICAgICAgICAgICAgIShlcnJvckluZGV4ID49IDApID8gZmFsc2UgPyAwIDogcm91dGVyX2ludmFyaWFudChmYWxzZSkgOiB2b2lkIDA7CiAgICAgICAgICAgICAgcmVuZGVyZWRNYXRjaGVzID0gcmVuZGVyZWRNYXRjaGVzLnNsaWNlKDAsIE1hdGgubWluKHJlbmRlcmVkTWF0Y2hlcy5sZW5ndGgsIGVycm9ySW5kZXggKyAxKSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybiByZW5kZXJlZE1hdGNoZXMucmVkdWNlUmlnaHQoKG91dGxldCwgbWF0Y2gsIGluZGV4KSA9PiB7CiAgICAgICAgICAgICAgdmFyIGVycm9yID0gbWF0Y2gucm91dGUuaWQgPyBlcnJvcnMgPT0gbnVsbCA/IHZvaWQgMCA6IGVycm9yc1ttYXRjaC5yb3V0ZS5pZF0gOiBudWxsOyAvLyBPbmx5IGRhdGEgcm91dGVycyBoYW5kbGUgZXJyb3JzCgogICAgICAgICAgICAgIHZhciBlcnJvckVsZW1lbnQgPSBkYXRhUm91dGVyU3RhdGUgPyBtYXRjaC5yb3V0ZS5lcnJvckVsZW1lbnQgfHwgLyojX19QVVJFX18qL3JlYWN0LmNyZWF0ZUVsZW1lbnQoRGVmYXVsdEVycm9yRWxlbWVudCwgbnVsbCkgOiBudWxsOwogICAgICAgICAgICAgIHZhciBtYXRjaGVzID0gcGFyZW50TWF0Y2hlcy5jb25jYXQocmVuZGVyZWRNYXRjaGVzLnNsaWNlKDAsIGluZGV4ICsgMSkpOwoKICAgICAgICAgICAgICB2YXIgZ2V0Q2hpbGRyZW4gPSAoKSA9PiAvKiNfX1BVUkVfXyovcmVhY3QuY3JlYXRlRWxlbWVudChSZW5kZXJlZFJvdXRlLCB7CiAgICAgICAgICAgICAgICBtYXRjaDogbWF0Y2gsCiAgICAgICAgICAgICAgICByb3V0ZUNvbnRleHQ6IHsKICAgICAgICAgICAgICAgICAgb3V0bGV0OiBvdXRsZXQsCiAgICAgICAgICAgICAgICAgIG1hdGNoZXM6IG1hdGNoZXMKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9LCBlcnJvciA/IGVycm9yRWxlbWVudCA6IG1hdGNoLnJvdXRlLmVsZW1lbnQgIT09IHVuZGVmaW5lZCA/IG1hdGNoLnJvdXRlLmVsZW1lbnQgOiBvdXRsZXQpOyAvLyBPbmx5IHdyYXAgaW4gYW4gZXJyb3IgYm91bmRhcnkgd2l0aGluIGRhdGEgcm91dGVyIHVzYWdlcyB3aGVuIHdlIGhhdmUgYW4KICAgICAgICAgICAgICAvLyBlcnJvckVsZW1lbnQgb24gdGhpcyByb3V0ZS4gIE90aGVyd2lzZSBsZXQgaXQgYnViYmxlIHVwIHRvIGFuIGFuY2VzdG9yCiAgICAgICAgICAgICAgLy8gZXJyb3JFbGVtZW50CgoKICAgICAgICAgICAgICByZXR1cm4gZGF0YVJvdXRlclN0YXRlICYmIChtYXRjaC5yb3V0ZS5lcnJvckVsZW1lbnQgfHwgaW5kZXggPT09IDApID8gLyojX19QVVJFX18qL3JlYWN0LmNyZWF0ZUVsZW1lbnQoUmVuZGVyRXJyb3JCb3VuZGFyeSwgewogICAgICAgICAgICAgICAgbG9jYXRpb246IGRhdGFSb3V0ZXJTdGF0ZS5sb2NhdGlvbiwKICAgICAgICAgICAgICAgIGNvbXBvbmVudDogZXJyb3JFbGVtZW50LAogICAgICAgICAgICAgICAgZXJyb3I6IGVycm9yLAogICAgICAgICAgICAgICAgY2hpbGRyZW46IGdldENoaWxkcmVuKCksCiAgICAgICAgICAgICAgICByb3V0ZUNvbnRleHQ6IHsKICAgICAgICAgICAgICAgICAgb3V0bGV0OiBudWxsLAogICAgICAgICAgICAgICAgICBtYXRjaGVzOiBtYXRjaGVzCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfSkgOiBnZXRDaGlsZHJlbigpOwogICAgICAgICAgICB9LCBudWxsKTsKICAgICAgICAgIH0KICAgICAgICAgIHZhciBEYXRhUm91dGVySG9vazsKCiAgICAgICAgICAoZnVuY3Rpb24gKERhdGFSb3V0ZXJIb29rKSB7CiAgICAgICAgICAgIERhdGFSb3V0ZXJIb29rWyJVc2VCbG9ja2VyIl0gPSAidXNlQmxvY2tlciI7CiAgICAgICAgICAgIERhdGFSb3V0ZXJIb29rWyJVc2VSZXZhbGlkYXRvciJdID0gInVzZVJldmFsaWRhdG9yIjsKICAgICAgICAgIH0pKERhdGFSb3V0ZXJIb29rIHx8IChEYXRhUm91dGVySG9vayA9IHt9KSk7CgogICAgICAgICAgdmFyIERhdGFSb3V0ZXJTdGF0ZUhvb2s7CgogICAgICAgICAgKGZ1bmN0aW9uIChEYXRhUm91dGVyU3RhdGVIb29rKSB7CiAgICAgICAgICAgIERhdGFSb3V0ZXJTdGF0ZUhvb2tbIlVzZUxvYWRlckRhdGEiXSA9ICJ1c2VMb2FkZXJEYXRhIjsKICAgICAgICAgICAgRGF0YVJvdXRlclN0YXRlSG9va1siVXNlQWN0aW9uRGF0YSJdID0gInVzZUFjdGlvbkRhdGEiOwogICAgICAgICAgICBEYXRhUm91dGVyU3RhdGVIb29rWyJVc2VSb3V0ZUVycm9yIl0gPSAidXNlUm91dGVFcnJvciI7CiAgICAgICAgICAgIERhdGFSb3V0ZXJTdGF0ZUhvb2tbIlVzZU5hdmlnYXRpb24iXSA9ICJ1c2VOYXZpZ2F0aW9uIjsKICAgICAgICAgICAgRGF0YVJvdXRlclN0YXRlSG9va1siVXNlUm91dGVMb2FkZXJEYXRhIl0gPSAidXNlUm91dGVMb2FkZXJEYXRhIjsKICAgICAgICAgICAgRGF0YVJvdXRlclN0YXRlSG9va1siVXNlTWF0Y2hlcyJdID0gInVzZU1hdGNoZXMiOwogICAgICAgICAgICBEYXRhUm91dGVyU3RhdGVIb29rWyJVc2VSZXZhbGlkYXRvciJdID0gInVzZVJldmFsaWRhdG9yIjsKICAgICAgICAgIH0pKERhdGFSb3V0ZXJTdGF0ZUhvb2sgfHwgKERhdGFSb3V0ZXJTdGF0ZUhvb2sgPSB7fSkpOwoKICAgICAgICAgIGZ1bmN0aW9uIGdldERhdGFSb3V0ZXJDb25zb2xlRXJyb3IoaG9va05hbWUpIHsKICAgICAgICAgICAgcmV0dXJuIGhvb2tOYW1lICsgIiBtdXN0IGJlIHVzZWQgd2l0aGluIGEgZGF0YSByb3V0ZXIuICBTZWUgaHR0cHM6Ly9yZWFjdHJvdXRlci5jb20vcm91dGVycy9waWNraW5nLWEtcm91dGVyLiI7CiAgICAgICAgICB9CgogICAgICAgICAgZnVuY3Rpb24gdXNlRGF0YVJvdXRlckNvbnRleHQoaG9va05hbWUpIHsKICAgICAgICAgICAgdmFyIGN0eCA9IFJlYWN0LnVzZUNvbnRleHQoRGF0YVJvdXRlckNvbnRleHQpOwogICAgICAgICAgICAhY3R4ID8gZmFsc2UgPyAwIDogaW52YXJpYW50KGZhbHNlKSA6IHZvaWQgMDsKICAgICAgICAgICAgcmV0dXJuIGN0eDsKICAgICAgICAgIH0KCiAgICAgICAgICBmdW5jdGlvbiB1c2VEYXRhUm91dGVyU3RhdGUoaG9va05hbWUpIHsKICAgICAgICAgICAgdmFyIHN0YXRlID0gcmVhY3QudXNlQ29udGV4dChEYXRhUm91dGVyU3RhdGVDb250ZXh0KTsKICAgICAgICAgICAgIXN0YXRlID8gZmFsc2UgPyAwIDogcm91dGVyX2ludmFyaWFudChmYWxzZSkgOiB2b2lkIDA7CiAgICAgICAgICAgIHJldHVybiBzdGF0ZTsKICAgICAgICAgIH0KCiAgICAgICAgICBmdW5jdGlvbiB1c2VSb3V0ZUNvbnRleHQoaG9va05hbWUpIHsKICAgICAgICAgICAgdmFyIHJvdXRlID0gcmVhY3QudXNlQ29udGV4dChSb3V0ZUNvbnRleHQpOwogICAgICAgICAgICAhcm91dGUgPyBmYWxzZSA/IDAgOiByb3V0ZXJfaW52YXJpYW50KGZhbHNlKSA6IHZvaWQgMDsKICAgICAgICAgICAgcmV0dXJuIHJvdXRlOwogICAgICAgICAgfQoKICAgICAgICAgIGZ1bmN0aW9uIHVzZUN1cnJlbnRSb3V0ZUlkKGhvb2tOYW1lKSB7CiAgICAgICAgICAgIHZhciByb3V0ZSA9IHVzZVJvdXRlQ29udGV4dChob29rTmFtZSk7CiAgICAgICAgICAgIHZhciB0aGlzUm91dGUgPSByb3V0ZS5tYXRjaGVzW3JvdXRlLm1hdGNoZXMubGVuZ3RoIC0gMV07CiAgICAgICAgICAgICF0aGlzUm91dGUucm91dGUuaWQgPyBmYWxzZSA/IDAgOiByb3V0ZXJfaW52YXJpYW50KGZhbHNlKSA6IHZvaWQgMDsKICAgICAgICAgICAgcmV0dXJuIHRoaXNSb3V0ZS5yb3V0ZS5pZDsKICAgICAgICAgIH0KICAgICAgICAgIC8qKgogICAgICAgICAgICogUmV0dXJucyB0aGUgY3VycmVudCBuYXZpZ2F0aW9uLCBkZWZhdWx0aW5nIHRvIGFuICJpZGxlIiBuYXZpZ2F0aW9uIHdoZW4KICAgICAgICAgICAqIG5vIG5hdmlnYXRpb24gaXMgaW4gcHJvZ3Jlc3MKICAgICAgICAgICAqLwoKCiAgICAgICAgICBmdW5jdGlvbiBkaXN0X3VzZU5hdmlnYXRpb24oKSB7CiAgICAgICAgICAgIHZhciBzdGF0ZSA9IHVzZURhdGFSb3V0ZXJTdGF0ZShEYXRhUm91dGVyU3RhdGVIb29rLlVzZU5hdmlnYXRpb24pOwogICAgICAgICAgICByZXR1cm4gc3RhdGUubmF2aWdhdGlvbjsKICAgICAgICAgIH0KICAgICAgICAgIC8qKgogICAgICAgICAgICogUmV0dXJucyBhIHJldmFsaWRhdGUgZnVuY3Rpb24gZm9yIG1hbnVhbGx5IHRyaWdnZXJpbmcgcmV2YWxpZGF0aW9uLCBhcyB3ZWxsCiAgICAgICAgICAgKiBhcyB0aGUgY3VycmVudCBzdGF0ZSBvZiBhbnkgbWFudWFsIHJldmFsaWRhdGlvbnMKICAgICAgICAgICAqLwoKICAgICAgICAgIGZ1bmN0aW9uIHVzZVJldmFsaWRhdG9yKCkgewogICAgICAgICAgICB2YXIgZGF0YVJvdXRlckNvbnRleHQgPSB1c2VEYXRhUm91dGVyQ29udGV4dChEYXRhUm91dGVySG9vay5Vc2VSZXZhbGlkYXRvcik7CiAgICAgICAgICAgIHZhciBzdGF0ZSA9IHVzZURhdGFSb3V0ZXJTdGF0ZShEYXRhUm91dGVyU3RhdGVIb29rLlVzZVJldmFsaWRhdG9yKTsKICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICByZXZhbGlkYXRlOiBkYXRhUm91dGVyQ29udGV4dC5yb3V0ZXIucmV2YWxpZGF0ZSwKICAgICAgICAgICAgICBzdGF0ZTogc3RhdGUucmV2YWxpZGF0aW9uCiAgICAgICAgICAgIH07CiAgICAgICAgICB9CiAgICAgICAgICAvKioKICAgICAgICAgICAqIFJldHVybnMgdGhlIGFjdGl2ZSByb3V0ZSBtYXRjaGVzLCB1c2VmdWwgZm9yIGFjY2Vzc2luZyBsb2FkZXJEYXRhIGZvcgogICAgICAgICAgICogcGFyZW50L2NoaWxkIHJvdXRlcyBvciB0aGUgcm91dGUgImhhbmRsZSIgcHJvcGVydHkKICAgICAgICAgICAqLwoKICAgICAgICAgIGZ1bmN0aW9uIGRpc3RfdXNlTWF0Y2hlcygpIHsKICAgICAgICAgICAgdmFyIF91c2VEYXRhUm91dGVyU3RhdGUgPQoKCiAgICAgICAgICAgICAgdXNlRGF0YVJvdXRlclN0YXRlKERhdGFSb3V0ZXJTdGF0ZUhvb2suVXNlTWF0Y2hlcyksbWF0Y2hlcyA9IF91c2VEYXRhUm91dGVyU3RhdGUubWF0Y2hlcyxsb2FkZXJEYXRhID0gX3VzZURhdGFSb3V0ZXJTdGF0ZS5sb2FkZXJEYXRhOwogICAgICAgICAgICByZXR1cm4gUmVhY3QudXNlTWVtbygoKSA9PiBtYXRjaGVzLm1hcCgobWF0Y2gpID0+IHsKICAgICAgICAgICAgICB2YXIKICAgICAgICAgICAgICAgIHBhdGhuYW1lID0KCiAgICAgICAgICAgICAgICBtYXRjaC5wYXRobmFtZSxwYXJhbXMgPSBtYXRjaC5wYXJhbXM7IC8vIE5vdGU6IFRoaXMgc3RydWN0dXJlIG1hdGNoZXMgdGhhdCBjcmVhdGVkIGJ5IGNyZWF0ZVVzZU1hdGNoZXNNYXRjaAogICAgICAgICAgICAgIC8vIGluIHRoZSBAcmVtaXgtcnVuL3JvdXRlciAsIHNvIGlmIHlvdSBjaGFuZ2UgdGhpcyBwbGVhc2UgYWxzbyBjaGFuZ2UKICAgICAgICAgICAgICAvLyB0aGF0IDopICBFdmVudHVhbGx5IHdlJ2xsIERSWSB0aGlzIHVwCgogICAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICBpZDogbWF0Y2gucm91dGUuaWQsCiAgICAgICAgICAgICAgICBwYXRobmFtZTogcGF0aG5hbWUsCiAgICAgICAgICAgICAgICBwYXJhbXM6IHBhcmFtcywKICAgICAgICAgICAgICAgIGRhdGE6IGxvYWRlckRhdGFbbWF0Y2gucm91dGUuaWRdLAogICAgICAgICAgICAgICAgaGFuZGxlOiBtYXRjaC5yb3V0ZS5oYW5kbGUKICAgICAgICAgICAgICB9OwogICAgICAgICAgICB9KSwgW21hdGNoZXMsIGxvYWRlckRhdGFdKTsKICAgICAgICAgIH0KICAgICAgICAgIC8qKgogICAgICAgICAgICogUmV0dXJucyB0aGUgbG9hZGVyIGRhdGEgZm9yIHRoZSBuZWFyZXN0IGFuY2VzdG9yIFJvdXRlIGxvYWRlcgogICAgICAgICAgICovCgogICAgICAgICAgZnVuY3Rpb24gdXNlTG9hZGVyRGF0YSgpIHsKICAgICAgICAgICAgdmFyIHN0YXRlID0gdXNlRGF0YVJvdXRlclN0YXRlKERhdGFSb3V0ZXJTdGF0ZUhvb2suVXNlTG9hZGVyRGF0YSk7CiAgICAgICAgICAgIHZhciByb3V0ZUlkID0gdXNlQ3VycmVudFJvdXRlSWQoRGF0YVJvdXRlclN0YXRlSG9vay5Vc2VMb2FkZXJEYXRhKTsKCiAgICAgICAgICAgIGlmIChzdGF0ZS5lcnJvcnMgJiYgc3RhdGUuZXJyb3JzW3JvdXRlSWRdICE9IG51bGwpIHsKICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKCJZb3UgY2Fubm90IGB1c2VMb2FkZXJEYXRhYCBpbiBhbiBlcnJvckVsZW1lbnQgKHJvdXRlSWQ6ICIgKyByb3V0ZUlkICsgIikiKTsKICAgICAgICAgICAgICByZXR1cm4gdW5kZWZpbmVkOwogICAgICAgICAgICB9CgogICAgICAgICAgICByZXR1cm4gc3RhdGUubG9hZGVyRGF0YVtyb3V0ZUlkXTsKICAgICAgICAgIH0KICAgICAgICAgIC8qKgogICAgICAgICAgICogUmV0dXJucyB0aGUgbG9hZGVyRGF0YSBmb3IgdGhlIGdpdmVuIHJvdXRlSWQKICAgICAgICAgICAqLwoKICAgICAgICAgIGZ1bmN0aW9uIHVzZVJvdXRlTG9hZGVyRGF0YShyb3V0ZUlkKSB7CiAgICAgICAgICAgIHZhciBzdGF0ZSA9IHVzZURhdGFSb3V0ZXJTdGF0ZShEYXRhUm91dGVyU3RhdGVIb29rLlVzZVJvdXRlTG9hZGVyRGF0YSk7CiAgICAgICAgICAgIHJldHVybiBzdGF0ZS5sb2FkZXJEYXRhW3JvdXRlSWRdOwogICAgICAgICAgfQogICAgICAgICAgLyoqCiAgICAgICAgICAgKiBSZXR1cm5zIHRoZSBhY3Rpb24gZGF0YSBmb3IgdGhlIG5lYXJlc3QgYW5jZXN0b3IgUm91dGUgYWN0aW9uCiAgICAgICAgICAgKi8KCiAgICAgICAgICBmdW5jdGlvbiB1c2VBY3Rpb25EYXRhKCkgewogICAgICAgICAgICB2YXIgc3RhdGUgPSB1c2VEYXRhUm91dGVyU3RhdGUoRGF0YVJvdXRlclN0YXRlSG9vay5Vc2VBY3Rpb25EYXRhKTsKICAgICAgICAgICAgdmFyIHJvdXRlID0gUmVhY3QudXNlQ29udGV4dChSb3V0ZUNvbnRleHQpOwogICAgICAgICAgICAhcm91dGUgPyBmYWxzZSA/IDAgOiBpbnZhcmlhbnQoZmFsc2UpIDogdm9pZCAwOwogICAgICAgICAgICByZXR1cm4gT2JqZWN0LnZhbHVlcygoc3RhdGUgPT0gbnVsbCA/IHZvaWQgMCA6IHN0YXRlLmFjdGlvbkRhdGEpIHx8IHt9KVswXTsKICAgICAgICAgIH0KICAgICAgICAgIC8qKgogICAgICAgICAgICogUmV0dXJucyB0aGUgbmVhcmVzdCBhbmNlc3RvciBSb3V0ZSBlcnJvciwgd2hpY2ggY291bGQgYmUgYSBsb2FkZXIvYWN0aW9uCiAgICAgICAgICAgKiBlcnJvciBvciBhIHJlbmRlciBlcnJvci4gIFRoaXMgaXMgaW50ZW5kZWQgdG8gYmUgY2FsbGVkIGZyb20geW91cgogICAgICAgICAgICogZXJyb3JFbGVtZW50IHRvIGRpc3BsYXkgYSBwcm9wZXIgZXJyb3IgbWVzc2FnZS4KICAgICAgICAgICAqLwoKICAgICAgICAgIGZ1bmN0aW9uIHVzZVJvdXRlRXJyb3IoKSB7CiAgICAgICAgICAgIHZhciBfc3RhdGUkZXJyb3JzOwoKICAgICAgICAgICAgdmFyIGVycm9yID0gcmVhY3QudXNlQ29udGV4dChSb3V0ZUVycm9yQ29udGV4dCk7CiAgICAgICAgICAgIHZhciBzdGF0ZSA9IHVzZURhdGFSb3V0ZXJTdGF0ZShEYXRhUm91dGVyU3RhdGVIb29rLlVzZVJvdXRlRXJyb3IpOwogICAgICAgICAgICB2YXIgcm91dGVJZCA9IHVzZUN1cnJlbnRSb3V0ZUlkKERhdGFSb3V0ZXJTdGF0ZUhvb2suVXNlUm91dGVFcnJvcik7IC8vIElmIHRoaXMgd2FzIGEgcmVuZGVyIGVycm9yLCB3ZSBwdXQgaXQgaW4gYSBSb3V0ZUVycm9yIGNvbnRleHQgaW5zaWRlCiAgICAgICAgICAgIC8vIG9mIFJlbmRlckVycm9yQm91bmRhcnkKCiAgICAgICAgICAgIGlmIChlcnJvcikgewogICAgICAgICAgICAgIHJldHVybiBlcnJvcjsKICAgICAgICAgICAgfSAvLyBPdGhlcndpc2UgbG9vayBmb3IgZXJyb3JzIGZyb20gb3VyIGRhdGEgcm91dGVyIHN0YXRlCgoKICAgICAgICAgICAgcmV0dXJuIChfc3RhdGUkZXJyb3JzID0gc3RhdGUuZXJyb3JzKSA9PSBudWxsID8gdm9pZCAwIDogX3N0YXRlJGVycm9yc1tyb3V0ZUlkXTsKICAgICAgICAgIH0KICAgICAgICAgIC8qKgogICAgICAgICAgICogUmV0dXJucyB0aGUgaGFwcHktcGF0aCBkYXRhIGZyb20gdGhlIG5lYXJlc3QgYW5jZXN0b3IgPEF3YWl0IC8+IHZhbHVlCiAgICAgICAgICAgKi8KCiAgICAgICAgICBmdW5jdGlvbiB1c2VBc3luY1ZhbHVlKCkgewogICAgICAgICAgICB2YXIgdmFsdWUgPSBSZWFjdC51c2VDb250ZXh0KEF3YWl0Q29udGV4dCk7CiAgICAgICAgICAgIHJldHVybiB2YWx1ZSA9PSBudWxsID8gdm9pZCAwIDogdmFsdWUuX2RhdGE7CiAgICAgICAgICB9CiAgICAgICAgICAvKioKICAgICAgICAgICAqIFJldHVybnMgdGhlIGVycm9yIGZyb20gdGhlIG5lYXJlc3QgYW5jZXN0b3IgPEF3YWl0IC8+IHZhbHVlCiAgICAgICAgICAgKi8KCiAgICAgICAgICBmdW5jdGlvbiB1c2VBc3luY0Vycm9yKCkgewogICAgICAgICAgICB2YXIgdmFsdWUgPSBSZWFjdC51c2VDb250ZXh0KEF3YWl0Q29udGV4dCk7CiAgICAgICAgICAgIHJldHVybiB2YWx1ZSA9PSBudWxsID8gdm9pZCAwIDogdmFsdWUuX2Vycm9yOwogICAgICAgICAgfSAvLyB1c2VCbG9ja2VyKCkgaXMgYSBzaW5nbGV0b24gZm9yIG5vdyBzaW5jZSB3ZSBkb24ndCBoYXZlIGFueSBjb21wZWxsaW5nIHVzZQogICAgICAgICAgLy8gY2FzZXMgZm9yIG11bHRpLWJsb2NrZXIgeWV0CgogICAgICAgICAgdmFyIGJsb2NrZXJLZXkgPSAiYmxvY2tlci1zaW5nbGV0b24iOwogICAgICAgICAgLyoqCiAgICAgICAgICAgKiBBbGxvdyB0aGUgYXBwbGljYXRpb24gdG8gYmxvY2sgbmF2aWdhdGlvbnMgd2l0aGluIHRoZSBTUEEgYW5kIHByZXNlbnQgdGhlCiAgICAgICAgICAgKiB1c2VyIGEgY29uZmlybWF0aW9uIGRpYWxvZyB0byBjb25maXJtIHRoZSBuYXZpZ2F0aW9uLiAgTW9zdGx5IHVzZWQgdG8gYXZvaWQKICAgICAgICAgICAqIHVzaW5nIGhhbGYtZmlsbGVkIGZvcm0gZGF0YS4gIFRoaXMgZG9lcyBub3QgaGFuZGxlIGhhcmQtcmVsb2FkcyBvcgogICAgICAgICAgICogY3Jvc3Mtb3JpZ2luIG5hdmlnYXRpb25zLgogICAgICAgICAgICovCgogICAgICAgICAgZnVuY3Rpb24gdXNlQmxvY2tlcihzaG91bGRCbG9jaykgewogICAgICAgICAgICB2YXIgX3VzZURhdGFSb3V0ZXJDb250ZXh0ID0KCiAgICAgICAgICAgICAgdXNlRGF0YVJvdXRlckNvbnRleHQoRGF0YVJvdXRlckhvb2suVXNlQmxvY2tlcikscm91dGVyID0gX3VzZURhdGFSb3V0ZXJDb250ZXh0LnJvdXRlcjsKICAgICAgICAgICAgdmFyIGJsb2NrZXJGdW5jdGlvbiA9IFJlYWN0LnVzZUNhbGxiYWNrKChhcmdzKSA9PiB7CiAgICAgICAgICAgICAgcmV0dXJuIHR5cGVvZiBzaG91bGRCbG9jayA9PT0gImZ1bmN0aW9uIiA/ICEhc2hvdWxkQmxvY2soYXJncykgOiAhIXNob3VsZEJsb2NrOwogICAgICAgICAgICB9LCBbc2hvdWxkQmxvY2tdKTsKICAgICAgICAgICAgdmFyIGJsb2NrZXIgPSByb3V0ZXIuZ2V0QmxvY2tlcihibG9ja2VyS2V5LCBibG9ja2VyRnVuY3Rpb24pOyAvLyBDbGVhbnVwIG9uIHVubW91bnQKCiAgICAgICAgICAgIFJlYWN0LnVzZUVmZmVjdCgoKSA9PiAoKSA9PiByb3V0ZXIuZGVsZXRlQmxvY2tlcihibG9ja2VyS2V5KSwgW3JvdXRlcl0pOwogICAgICAgICAgICByZXR1cm4gYmxvY2tlcjsKICAgICAgICAgIH0KICAgICAgICAgIHZhciBhbHJlYWR5V2FybmVkID0ge307CgogICAgICAgICAgZnVuY3Rpb24gd2FybmluZ09uY2Uoa2V5LCBjb25kLCBtZXNzYWdlKSB7CiAgICAgICAgICAgIGlmICghY29uZCAmJiAhYWxyZWFkeVdhcm5lZFtrZXldKSB7CiAgICAgICAgICAgICAgYWxyZWFkeVdhcm5lZFtrZXldID0gdHJ1ZTsKICAgICAgICAgICAgICBmYWxzZSA/IDAgOiB2b2lkIDA7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KCiAgICAgICAgICAvKioKICAgICAgICAgICAqIEdpdmVuIGEgUmVtaXggUm91dGVyIGluc3RhbmNlLCByZW5kZXIgdGhlIGFwcHJvcHJpYXRlIFVJCiAgICAgICAgICAgKi8KICAgICAgICAgIGZ1bmN0aW9uIFJvdXRlclByb3ZpZGVyKF9yZWYpIHsKICAgICAgICAgICAgdmFyCiAgICAgICAgICAgICAgZmFsbGJhY2tFbGVtZW50ID0KCiAgICAgICAgICAgICAgX3JlZi5mYWxsYmFja0VsZW1lbnQscm91dGVyID0gX3JlZi5yb3V0ZXI7CiAgICAgICAgICAgIC8vIFN5bmMgcm91dGVyIHN0YXRlIHRvIG91ciBjb21wb25lbnQgc3RhdGUgdG8gZm9yY2UgcmUtcmVuZGVycwogICAgICAgICAgICB2YXIgc3RhdGUgPSB1c2VTeW5jRXh0ZXJuYWxTdG9yZShyb3V0ZXIuc3Vic2NyaWJlLCAoKSA9PiByb3V0ZXIuc3RhdGUsIC8vIFdlIGhhdmUgdG8gcHJvdmlkZSB0aGlzIHNvIFJlYWN0QDE4IGRvZXNuJ3QgY29tcGxhaW4gZHVyaW5nIGh5ZHJhdGlvbiwKICAgICAgICAgICAgLy8gYnV0IHdlIHBhc3Mgb3VyIHNlcmlhbGl6ZWQgaHlkcmF0aW9uIGRhdGEgaW50byB0aGUgcm91dGVyIHNvIHN0YXRlIGhlcmUKICAgICAgICAgICAgLy8gaXMgYWxyZWFkeSBzeW5jZWQgd2l0aCB3aGF0IHRoZSBzZXJ2ZXIgc2F3CiAgICAgICAgICAgICgpID0+IHJvdXRlci5zdGF0ZSk7CiAgICAgICAgICAgIHZhciBuYXZpZ2F0b3IgPSBSZWFjdC51c2VNZW1vKCgpID0+IHsKICAgICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgY3JlYXRlSHJlZjogcm91dGVyLmNyZWF0ZUhyZWYsCiAgICAgICAgICAgICAgICBlbmNvZGVMb2NhdGlvbjogcm91dGVyLmVuY29kZUxvY2F0aW9uLAogICAgICAgICAgICAgICAgZ286IChuKSA9PiByb3V0ZXIubmF2aWdhdGUobiksCiAgICAgICAgICAgICAgICBwdXNoOiAodG8sIHN0YXRlLCBvcHRzKSA9PiByb3V0ZXIubmF2aWdhdGUodG8sIHsKICAgICAgICAgICAgICAgICAgc3RhdGU6IHN0YXRlLAogICAgICAgICAgICAgICAgICBwcmV2ZW50U2Nyb2xsUmVzZXQ6IG9wdHMgPT0gbnVsbCA/IHZvaWQgMCA6IG9wdHMucHJldmVudFNjcm9sbFJlc2V0CiAgICAgICAgICAgICAgICB9KSwKICAgICAgICAgICAgICAgIHJlcGxhY2U6ICh0bywgc3RhdGUsIG9wdHMpID0+IHJvdXRlci5uYXZpZ2F0ZSh0bywgewogICAgICAgICAgICAgICAgICByZXBsYWNlOiB0cnVlLAogICAgICAgICAgICAgICAgICBzdGF0ZTogc3RhdGUsCiAgICAgICAgICAgICAgICAgIHByZXZlbnRTY3JvbGxSZXNldDogb3B0cyA9PSBudWxsID8gdm9pZCAwIDogb3B0cy5wcmV2ZW50U2Nyb2xsUmVzZXQKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgfSwgW3JvdXRlcl0pOwogICAgICAgICAgICB2YXIgYmFzZW5hbWUgPSByb3V0ZXIuYmFzZW5hbWUgfHwgIi8iOyAvLyBUaGUgZnJhZ21lbnQgYW5kIHtudWxsfSBoZXJlIGFyZSBpbXBvcnRhbnQhICBXZSBuZWVkIHRoZW0gdG8ga2VlcCBSZWFjdCAxOCdzCiAgICAgICAgICAgIC8vIHVzZUlkIGhhcHB5IHdoZW4gd2UgYXJlIHNlcnZlci1yZW5kZXJpbmcgc2luY2Ugd2UgbWF5IGhhdmUgYSA8c2NyaXB0PiBoZXJlCiAgICAgICAgICAgIC8vIGNvbnRhaW5pbmcgdGhlIGh5ZHJhdGVkIHNlcnZlci1zaWRlIHN0YXRpY0NvbnRleHQgKGZyb20gU3RhdGljUm91dGVyUHJvdmlkZXIpLgogICAgICAgICAgICAvLyB1c2VJZCByZWxpZXMgb24gdGhlIGNvbXBvbmVudCB0cmVlIHN0cnVjdHVyZSB0byBnZW5lcmF0ZSBkZXRlcm1pbmlzdGljIGlkJ3MKICAgICAgICAgICAgLy8gc28gd2UgbmVlZCB0byBlbnN1cmUgaXQgcmVtYWlucyB0aGUgc2FtZSBvbiB0aGUgY2xpZW50IGV2ZW4gdGhvdWdoCiAgICAgICAgICAgIC8vIHdlIGRvbid0IG5lZWQgdGhlIDxzY3JpcHQ+IHRhZwoKICAgICAgICAgICAgcmV0dXJuIC8qI19fUFVSRV9fKi9SZWFjdC5jcmVhdGVFbGVtZW50KFJlYWN0LkZyYWdtZW50LCBudWxsLCAvKiNfX1BVUkVfXyovUmVhY3QuY3JlYXRlRWxlbWVudChEYXRhUm91dGVyQ29udGV4dC5Qcm92aWRlciwgewogICAgICAgICAgICAgIHZhbHVlOiB7CiAgICAgICAgICAgICAgICByb3V0ZXI6IHJvdXRlciwKICAgICAgICAgICAgICAgIG5hdmlnYXRvcjogbmF2aWdhdG9yLAogICAgICAgICAgICAgICAgc3RhdGljOiBmYWxzZSwKICAgICAgICAgICAgICAgIC8vIERvIHdlIG5lZWQgdGhpcz8KICAgICAgICAgICAgICAgIGJhc2VuYW1lOiBiYXNlbmFtZQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwgLyojX19QVVJFX18qL1JlYWN0LmNyZWF0ZUVsZW1lbnQoRGF0YVJvdXRlclN0YXRlQ29udGV4dC5Qcm92aWRlciwgewogICAgICAgICAgICAgIHZhbHVlOiBzdGF0ZQogICAgICAgICAgICB9LCAvKiNfX1BVUkVfXyovUmVhY3QuY3JlYXRlRWxlbWVudChkaXN0X1JvdXRlciwgewogICAgICAgICAgICAgIGJhc2VuYW1lOiByb3V0ZXIuYmFzZW5hbWUsCiAgICAgICAgICAgICAgbG9jYXRpb246IHJvdXRlci5zdGF0ZS5sb2NhdGlvbiwKICAgICAgICAgICAgICBuYXZpZ2F0aW9uVHlwZTogcm91dGVyLnN0YXRlLmhpc3RvcnlBY3Rpb24sCiAgICAgICAgICAgICAgbmF2aWdhdG9yOiBuYXZpZ2F0b3IKICAgICAgICAgICAgfSwgcm91dGVyLnN0YXRlLmluaXRpYWxpemVkID8gLyojX19QVVJFX18qL1JlYWN0LmNyZWF0ZUVsZW1lbnQoUm91dGVzLCBudWxsKSA6IGZhbGxiYWNrRWxlbWVudCkpKSwgbnVsbCk7CiAgICAgICAgICB9CgogICAgICAgICAgLyoqCiAgICAgICAgICAgKiBBIDxSb3V0ZXI+IHRoYXQgc3RvcmVzIGFsbCBlbnRyaWVzIGluIG1lbW9yeS4KICAgICAgICAgICAqCiAgICAgICAgICAgKiBAc2VlIGh0dHBzOi8vcmVhY3Ryb3V0ZXIuY29tL3JvdXRlci1jb21wb25lbnRzL21lbW9yeS1yb3V0ZXIKICAgICAgICAgICAqLwogICAgICAgICAgZnVuY3Rpb24gTWVtb3J5Um91dGVyKF9yZWYyKSB7CiAgICAgICAgICAgIHZhcgogICAgICAgICAgICAgIGJhc2VuYW1lID0KCgoKICAgICAgICAgICAgICBfcmVmMi5iYXNlbmFtZSxjaGlsZHJlbiA9IF9yZWYyLmNoaWxkcmVuLGluaXRpYWxFbnRyaWVzID0gX3JlZjIuaW5pdGlhbEVudHJpZXMsaW5pdGlhbEluZGV4ID0gX3JlZjIuaW5pdGlhbEluZGV4OwogICAgICAgICAgICB2YXIgaGlzdG9yeVJlZiA9IHJlYWN0LnVzZVJlZigpOwoKICAgICAgICAgICAgaWYgKGhpc3RvcnlSZWYuY3VycmVudCA9PSBudWxsKSB7CiAgICAgICAgICAgICAgaGlzdG9yeVJlZi5jdXJyZW50ID0gcm91dGVyX2NyZWF0ZU1lbW9yeUhpc3RvcnkoewogICAgICAgICAgICAgICAgaW5pdGlhbEVudHJpZXM6IGluaXRpYWxFbnRyaWVzLAogICAgICAgICAgICAgICAgaW5pdGlhbEluZGV4OiBpbml0aWFsSW5kZXgsCiAgICAgICAgICAgICAgICB2NUNvbXBhdDogdHJ1ZQogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CgogICAgICAgICAgICB2YXIgaGlzdG9yeSA9IGhpc3RvcnlSZWYuY3VycmVudDsKICAgICAgICAgICAgdmFyIF9yZWFjdCR1c2VTdGF0ZSA9IHJlYWN0LnVzZVN0YXRlKHsKICAgICAgICAgICAgICAgIGFjdGlvbjogaGlzdG9yeS5hY3Rpb24sCiAgICAgICAgICAgICAgICBsb2NhdGlvbjogaGlzdG9yeS5sb2NhdGlvbgogICAgICAgICAgICAgIH0pLF9yZWFjdCR1c2VTdGF0ZTIgPSBfc2xpY2VkVG9BcnJheTIoX3JlYWN0JHVzZVN0YXRlLCAyKSxzdGF0ZSA9IF9yZWFjdCR1c2VTdGF0ZTJbMF0sc2V0U3RhdGUgPSBfcmVhY3QkdXNlU3RhdGUyWzFdOwogICAgICAgICAgICByZWFjdC51c2VMYXlvdXRFZmZlY3QoKCkgPT4gaGlzdG9yeS5saXN0ZW4oc2V0U3RhdGUpLCBbaGlzdG9yeV0pOwogICAgICAgICAgICByZXR1cm4gLyojX19QVVJFX18qL3JlYWN0LmNyZWF0ZUVsZW1lbnQoZGlzdF9Sb3V0ZXIsIHsKICAgICAgICAgICAgICBiYXNlbmFtZTogYmFzZW5hbWUsCiAgICAgICAgICAgICAgY2hpbGRyZW46IGNoaWxkcmVuLAogICAgICAgICAgICAgIGxvY2F0aW9uOiBzdGF0ZS5sb2NhdGlvbiwKICAgICAgICAgICAgICBuYXZpZ2F0aW9uVHlwZTogc3RhdGUuYWN0aW9uLAogICAgICAgICAgICAgIG5hdmlnYXRvcjogaGlzdG9yeQogICAgICAgICAgICB9KTsKICAgICAgICAgIH0KCiAgICAgICAgICAvKioKICAgICAgICAgICAqIENoYW5nZXMgdGhlIGN1cnJlbnQgbG9jYXRpb24uCiAgICAgICAgICAgKgogICAgICAgICAgICogTm90ZTogVGhpcyBBUEkgaXMgbW9zdGx5IHVzZWZ1bCBpbiBSZWFjdC5Db21wb25lbnQgc3ViY2xhc3NlcyB0aGF0IGFyZSBub3QKICAgICAgICAgICAqIGFibGUgdG8gdXNlIGhvb2tzLiBJbiBmdW5jdGlvbmFsIGNvbXBvbmVudHMsIHdlIHJlY29tbWVuZCB5b3UgdXNlIHRoZQogICAgICAgICAgICogYHVzZU5hdmlnYXRlYCBob29rIGluc3RlYWQuCiAgICAgICAgICAgKgogICAgICAgICAgICogQHNlZSBodHRwczovL3JlYWN0cm91dGVyLmNvbS9jb21wb25lbnRzL25hdmlnYXRlCiAgICAgICAgICAgKi8KICAgICAgICAgIGZ1bmN0aW9uIE5hdmlnYXRlKF9yZWYzKSB7CiAgICAgICAgICAgIHZhcgogICAgICAgICAgICAgIHRvID0KCgoKICAgICAgICAgICAgICBfcmVmMy50byxyZXBsYWNlID0gX3JlZjMucmVwbGFjZSxzdGF0ZSA9IF9yZWYzLnN0YXRlLHJlbGF0aXZlID0gX3JlZjMucmVsYXRpdmU7CiAgICAgICAgICAgICF1c2VJblJvdXRlckNvbnRleHQoKSA/IGZhbHNlID8gMCA6IHJvdXRlcl9pbnZhcmlhbnQoZmFsc2UpIDogdm9pZCAwOwogICAgICAgICAgICBmYWxzZSA/IDAgOiB2b2lkIDA7CiAgICAgICAgICAgIHZhciBkYXRhUm91dGVyU3RhdGUgPSByZWFjdC51c2VDb250ZXh0KERhdGFSb3V0ZXJTdGF0ZUNvbnRleHQpOwogICAgICAgICAgICB2YXIgbmF2aWdhdGUgPSBkaXN0X3VzZU5hdmlnYXRlKCk7CiAgICAgICAgICAgIHJlYWN0LnVzZUVmZmVjdCgoKSA9PiB7CiAgICAgICAgICAgICAgLy8gQXZvaWQga2lja2luZyBvZmYgbXVsdGlwbGUgbmF2aWdhdGlvbnMgaWYgd2UncmUgaW4gdGhlIG1pZGRsZSBvZiBhCiAgICAgICAgICAgICAgLy8gZGF0YS1yb3V0ZXIgbmF2aWdhdGlvbiwgc2luY2UgY29tcG9uZW50cyBnZXQgcmUtcmVuZGVyZWQgd2hlbiB3ZSBlbnRlcgogICAgICAgICAgICAgIC8vIGEgc3VibWl0dGluZy9sb2FkaW5nIHN0YXRlCiAgICAgICAgICAgICAgaWYgKGRhdGFSb3V0ZXJTdGF0ZSAmJiBkYXRhUm91dGVyU3RhdGUubmF2aWdhdGlvbi5zdGF0ZSAhPT0gImlkbGUiKSB7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBuYXZpZ2F0ZSh0bywgewogICAgICAgICAgICAgICAgcmVwbGFjZTogcmVwbGFjZSwKICAgICAgICAgICAgICAgIHN0YXRlOiBzdGF0ZSwKICAgICAgICAgICAgICAgIHJlbGF0aXZlOiByZWxhdGl2ZQogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9KTsKICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgICB9CgogICAgICAgICAgLyoqCiAgICAgICAgICAgKiBSZW5kZXJzIHRoZSBjaGlsZCByb3V0ZSdzIGVsZW1lbnQsIGlmIHRoZXJlIGlzIG9uZS4KICAgICAgICAgICAqCiAgICAgICAgICAgKiBAc2VlIGh0dHBzOi8vcmVhY3Ryb3V0ZXIuY29tL2NvbXBvbmVudHMvb3V0bGV0CiAgICAgICAgICAgKi8KICAgICAgICAgIGZ1bmN0aW9uIE91dGxldChwcm9wcykgewogICAgICAgICAgICByZXR1cm4gdXNlT3V0bGV0KHByb3BzLmNvbnRleHQpOwogICAgICAgICAgfQoKICAgICAgICAgIC8qKgogICAgICAgICAgICogRGVjbGFyZXMgYW4gZWxlbWVudCB0aGF0IHNob3VsZCBiZSByZW5kZXJlZCBhdCBhIGNlcnRhaW4gVVJMIHBhdGguCiAgICAgICAgICAgKgogICAgICAgICAgICogQHNlZSBodHRwczovL3JlYWN0cm91dGVyLmNvbS9jb21wb25lbnRzL3JvdXRlCiAgICAgICAgICAgKi8KICAgICAgICAgIGZ1bmN0aW9uIFJvdXRlKF9wcm9wcykgewogICAgICAgICAgICBmYWxzZSA/IDAgOiByb3V0ZXJfaW52YXJpYW50KGZhbHNlKTsKICAgICAgICAgIH0KCiAgICAgICAgICAvKioKICAgICAgICAgICAqIFByb3ZpZGVzIGxvY2F0aW9uIGNvbnRleHQgZm9yIHRoZSByZXN0IG9mIHRoZSBhcHAuCiAgICAgICAgICAgKgogICAgICAgICAgICogTm90ZTogWW91IHVzdWFsbHkgd29uJ3QgcmVuZGVyIGEgPFJvdXRlcj4gZGlyZWN0bHkuIEluc3RlYWQsIHlvdSdsbCByZW5kZXIgYQogICAgICAgICAgICogcm91dGVyIHRoYXQgaXMgbW9yZSBzcGVjaWZpYyB0byB5b3VyIGVudmlyb25tZW50IHN1Y2ggYXMgYSA8QnJvd3NlclJvdXRlcj4KICAgICAgICAgICAqIGluIHdlYiBicm93c2VycyBvciBhIDxTdGF0aWNSb3V0ZXI+IGZvciBzZXJ2ZXIgcmVuZGVyaW5nLgogICAgICAgICAgICoKICAgICAgICAgICAqIEBzZWUgaHR0cHM6Ly9yZWFjdHJvdXRlci5jb20vcm91dGVyLWNvbXBvbmVudHMvcm91dGVyCiAgICAgICAgICAgKi8KICAgICAgICAgIGZ1bmN0aW9uIGRpc3RfUm91dGVyKF9yZWY0KSB7CiAgICAgICAgICAgIHZhciBfcmVmNCRiYXNlbmFtZSA9CgoKCgoKCiAgICAgICAgICAgICAgX3JlZjQuYmFzZW5hbWUsYmFzZW5hbWVQcm9wID0gX3JlZjQkYmFzZW5hbWUgPT09IHZvaWQgMCA/ICIvIiA6IF9yZWY0JGJhc2VuYW1lLF9yZWY0JGNoaWxkcmVuID0gX3JlZjQuY2hpbGRyZW4sY2hpbGRyZW4gPSBfcmVmNCRjaGlsZHJlbiA9PT0gdm9pZCAwID8gbnVsbCA6IF9yZWY0JGNoaWxkcmVuLGxvY2F0aW9uUHJvcCA9IF9yZWY0LmxvY2F0aW9uLF9yZWY0JG5hdmlnYXRpb25UeXBlID0gX3JlZjQubmF2aWdhdGlvblR5cGUsbmF2aWdhdGlvblR5cGUgPSBfcmVmNCRuYXZpZ2F0aW9uVHlwZSA9PT0gdm9pZCAwID8gQWN0aW9uLlBvcCA6IF9yZWY0JG5hdmlnYXRpb25UeXBlLG5hdmlnYXRvciA9IF9yZWY0Lm5hdmlnYXRvcixfcmVmNCRzdGF0aWMgPSBfcmVmNC5zdGF0aWMsc3RhdGljUHJvcCA9IF9yZWY0JHN0YXRpYyA9PT0gdm9pZCAwID8gZmFsc2UgOiBfcmVmNCRzdGF0aWM7CiAgICAgICAgICAgICEhdXNlSW5Sb3V0ZXJDb250ZXh0KCkgPyBmYWxzZSA/IDAgOiByb3V0ZXJfaW52YXJpYW50KGZhbHNlKSA6IHZvaWQgMDsgLy8gUHJlc2VydmUgdHJhaWxpbmcgc2xhc2hlcyBvbiBiYXNlbmFtZSwgc28gd2UgY2FuIGxldCB0aGUgdXNlciBjb250cm9sCiAgICAgICAgICAgIC8vIHRoZSBlbmZvcmNlbWVudCBvZiB0cmFpbGluZyBzbGFzaGVzIHRocm91Z2hvdXQgdGhlIGFwcAoKICAgICAgICAgICAgdmFyIGJhc2VuYW1lID0gYmFzZW5hbWVQcm9wLnJlcGxhY2UoL15cLyovLCAiLyIpOwogICAgICAgICAgICB2YXIgbmF2aWdhdGlvbkNvbnRleHQgPSByZWFjdC51c2VNZW1vKCgpID0+ICh7CiAgICAgICAgICAgICAgYmFzZW5hbWU6IGJhc2VuYW1lLAogICAgICAgICAgICAgIG5hdmlnYXRvcjogbmF2aWdhdG9yLAogICAgICAgICAgICAgIHN0YXRpYzogc3RhdGljUHJvcAogICAgICAgICAgICB9KSwgW2Jhc2VuYW1lLCBuYXZpZ2F0b3IsIHN0YXRpY1Byb3BdKTsKCiAgICAgICAgICAgIGlmICh0eXBlb2YgbG9jYXRpb25Qcm9wID09PSAic3RyaW5nIikgewogICAgICAgICAgICAgIGxvY2F0aW9uUHJvcCA9IHBhcnNlUGF0aChsb2NhdGlvblByb3ApOwogICAgICAgICAgICB9CgogICAgICAgICAgICB2YXIgX2xvY2F0aW9uUHJvcCA9CgoKCgoKICAgICAgICAgICAgICBsb2NhdGlvblByb3AsX2xvY2F0aW9uUHJvcCRwYXRobmFtID0gX2xvY2F0aW9uUHJvcC5wYXRobmFtZSxwYXRobmFtZSA9IF9sb2NhdGlvblByb3AkcGF0aG5hbSA9PT0gdm9pZCAwID8gIi8iIDogX2xvY2F0aW9uUHJvcCRwYXRobmFtLF9sb2NhdGlvblByb3Akc2VhcmNoID0gX2xvY2F0aW9uUHJvcC5zZWFyY2gsc2VhcmNoID0gX2xvY2F0aW9uUHJvcCRzZWFyY2ggPT09IHZvaWQgMCA/ICIiIDogX2xvY2F0aW9uUHJvcCRzZWFyY2gsX2xvY2F0aW9uUHJvcCRoYXNoID0gX2xvY2F0aW9uUHJvcC5oYXNoLGhhc2ggPSBfbG9jYXRpb25Qcm9wJGhhc2ggPT09IHZvaWQgMCA/ICIiIDogX2xvY2F0aW9uUHJvcCRoYXNoLF9sb2NhdGlvblByb3Akc3RhdGUgPSBfbG9jYXRpb25Qcm9wLnN0YXRlLHN0YXRlID0gX2xvY2F0aW9uUHJvcCRzdGF0ZSA9PT0gdm9pZCAwID8gbnVsbCA6IF9sb2NhdGlvblByb3Akc3RhdGUsX2xvY2F0aW9uUHJvcCRrZXkgPSBfbG9jYXRpb25Qcm9wLmtleSxrZXkgPSBfbG9jYXRpb25Qcm9wJGtleSA9PT0gdm9pZCAwID8gImRlZmF1bHQiIDogX2xvY2F0aW9uUHJvcCRrZXk7CiAgICAgICAgICAgIHZhciBsb2NhdGlvbiA9IHJlYWN0LnVzZU1lbW8oKCkgPT4gewogICAgICAgICAgICAgIHZhciB0cmFpbGluZ1BhdGhuYW1lID0gc3RyaXBCYXNlbmFtZShwYXRobmFtZSwgYmFzZW5hbWUpOwoKICAgICAgICAgICAgICBpZiAodHJhaWxpbmdQYXRobmFtZSA9PSBudWxsKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICBwYXRobmFtZTogdHJhaWxpbmdQYXRobmFtZSwKICAgICAgICAgICAgICAgIHNlYXJjaDogc2VhcmNoLAogICAgICAgICAgICAgICAgaGFzaDogaGFzaCwKICAgICAgICAgICAgICAgIHN0YXRlOiBzdGF0ZSwKICAgICAgICAgICAgICAgIGtleToga2V5CiAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgfSwgW2Jhc2VuYW1lLCBwYXRobmFtZSwgc2VhcmNoLCBoYXNoLCBzdGF0ZSwga2V5XSk7CiAgICAgICAgICAgIGZhbHNlID8gMCA6IHZvaWQgMDsKCiAgICAgICAgICAgIGlmIChsb2NhdGlvbiA9PSBudWxsKSB7CiAgICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybiAvKiNfX1BVUkVfXyovcmVhY3QuY3JlYXRlRWxlbWVudChOYXZpZ2F0aW9uQ29udGV4dC5Qcm92aWRlciwgewogICAgICAgICAgICAgIHZhbHVlOiBuYXZpZ2F0aW9uQ29udGV4dAogICAgICAgICAgICB9LCAvKiNfX1BVUkVfXyovcmVhY3QuY3JlYXRlRWxlbWVudChMb2NhdGlvbkNvbnRleHQuUHJvdmlkZXIsIHsKICAgICAgICAgICAgICBjaGlsZHJlbjogY2hpbGRyZW4sCiAgICAgICAgICAgICAgdmFsdWU6IHsKICAgICAgICAgICAgICAgIGxvY2F0aW9uOiBsb2NhdGlvbiwKICAgICAgICAgICAgICAgIG5hdmlnYXRpb25UeXBlOiBuYXZpZ2F0aW9uVHlwZQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSkpOwogICAgICAgICAgfQoKICAgICAgICAgIC8qKgogICAgICAgICAgICogQSBjb250YWluZXIgZm9yIGEgbmVzdGVkIHRyZWUgb2YgPFJvdXRlPiBlbGVtZW50cyB0aGF0IHJlbmRlcnMgdGhlIGJyYW5jaAogICAgICAgICAgICogdGhhdCBiZXN0IG1hdGNoZXMgdGhlIGN1cnJlbnQgbG9jYXRpb24uCiAgICAgICAgICAgKgogICAgICAgICAgICogQHNlZSBodHRwczovL3JlYWN0cm91dGVyLmNvbS9jb21wb25lbnRzL3JvdXRlcwogICAgICAgICAgICovCiAgICAgICAgICBmdW5jdGlvbiBSb3V0ZXMoX3JlZjUpIHsKICAgICAgICAgICAgdmFyCiAgICAgICAgICAgICAgY2hpbGRyZW4gPQoKICAgICAgICAgICAgICBfcmVmNS5jaGlsZHJlbixsb2NhdGlvbiA9IF9yZWY1LmxvY2F0aW9uOwogICAgICAgICAgICB2YXIgZGF0YVJvdXRlckNvbnRleHQgPSByZWFjdC51c2VDb250ZXh0KERhdGFSb3V0ZXJDb250ZXh0KTsgLy8gV2hlbiBpbiBhIERhdGFSb3V0ZXJDb250ZXh0IF93aXRob3V0XyBjaGlsZHJlbiwgd2UgdXNlIHRoZSByb3V0ZXIgcm91dGVzCiAgICAgICAgICAgIC8vIGRpcmVjdGx5LiAgSWYgd2UgaGF2ZSBjaGlsZHJlbiwgdGhlbiB3ZSdyZSBpbiBhIGRlc2NlbmRhbnQgdHJlZSBhbmQgd2UKICAgICAgICAgICAgLy8gbmVlZCB0byB1c2UgY2hpbGQgcm91dGVzLgoKICAgICAgICAgICAgdmFyIHJvdXRlcyA9IGRhdGFSb3V0ZXJDb250ZXh0ICYmICFjaGlsZHJlbiA/IGRhdGFSb3V0ZXJDb250ZXh0LnJvdXRlci5yb3V0ZXMgOiBjcmVhdGVSb3V0ZXNGcm9tQ2hpbGRyZW4oY2hpbGRyZW4pOwogICAgICAgICAgICByZXR1cm4gdXNlUm91dGVzKHJvdXRlcywgbG9jYXRpb24pOwogICAgICAgICAgfQoKICAgICAgICAgIC8qKgogICAgICAgICAgICogQ29tcG9uZW50IHRvIHVzZSBmb3IgcmVuZGVyaW5nIGxhemlseSBsb2FkZWQgZGF0YSBmcm9tIHJldHVybmluZyBkZWZlcigpCiAgICAgICAgICAgKiBpbiBhIGxvYWRlciBmdW5jdGlvbgogICAgICAgICAgICovCiAgICAgICAgICBmdW5jdGlvbiBBd2FpdChfcmVmNikgewogICAgICAgICAgICB2YXIKICAgICAgICAgICAgICBjaGlsZHJlbiA9CgoKICAgICAgICAgICAgICBfcmVmNi5jaGlsZHJlbixlcnJvckVsZW1lbnQgPSBfcmVmNi5lcnJvckVsZW1lbnQscmVzb2x2ZSA9IF9yZWY2LnJlc29sdmU7CiAgICAgICAgICAgIHJldHVybiAvKiNfX1BVUkVfXyovUmVhY3QuY3JlYXRlRWxlbWVudChBd2FpdEVycm9yQm91bmRhcnksIHsKICAgICAgICAgICAgICByZXNvbHZlOiByZXNvbHZlLAogICAgICAgICAgICAgIGVycm9yRWxlbWVudDogZXJyb3JFbGVtZW50CiAgICAgICAgICAgIH0sIC8qI19fUFVSRV9fKi9SZWFjdC5jcmVhdGVFbGVtZW50KFJlc29sdmVBd2FpdCwgbnVsbCwgY2hpbGRyZW4pKTsKICAgICAgICAgIH0KICAgICAgICAgIHZhciBBd2FpdFJlbmRlclN0YXR1czsKCiAgICAgICAgICAoZnVuY3Rpb24gKEF3YWl0UmVuZGVyU3RhdHVzKSB7CiAgICAgICAgICAgIEF3YWl0UmVuZGVyU3RhdHVzW0F3YWl0UmVuZGVyU3RhdHVzWyJwZW5kaW5nIl0gPSAwXSA9ICJwZW5kaW5nIjsKICAgICAgICAgICAgQXdhaXRSZW5kZXJTdGF0dXNbQXdhaXRSZW5kZXJTdGF0dXNbInN1Y2Nlc3MiXSA9IDFdID0gInN1Y2Nlc3MiOwogICAgICAgICAgICBBd2FpdFJlbmRlclN0YXR1c1tBd2FpdFJlbmRlclN0YXR1c1siZXJyb3IiXSA9IDJdID0gImVycm9yIjsKICAgICAgICAgIH0pKEF3YWl0UmVuZGVyU3RhdHVzIHx8IChBd2FpdFJlbmRlclN0YXR1cyA9IHt9KSk7CgogICAgICAgICAgdmFyIG5ldmVyU2V0dGxlZFByb21pc2UgPSBuZXcgUHJvbWlzZSgoKSA9PiB7fSk7dmFyCgogICAgICAgICAgQXdhaXRFcnJvckJvdW5kYXJ5ID0gLyojX19QVVJFX18qL2Z1bmN0aW9uIChfcmVhY3QkQ29tcG9uZW50Mikge19pbmhlcml0cyhBd2FpdEVycm9yQm91bmRhcnksIF9yZWFjdCRDb21wb25lbnQyKTt2YXIgX3N1cGVyMyA9IF9jcmVhdGVTdXBlcihBd2FpdEVycm9yQm91bmRhcnkpOwogICAgICAgICAgICBmdW5jdGlvbiBBd2FpdEVycm9yQm91bmRhcnkocHJvcHMpIHt2YXIgX3RoaXMyO19jbGFzc0NhbGxDaGVjazIodGhpcywgQXdhaXRFcnJvckJvdW5kYXJ5KTsKICAgICAgICAgICAgICBfdGhpczIgPSBfc3VwZXIzLmNhbGwodGhpcywgcHJvcHMpOwogICAgICAgICAgICAgIF90aGlzMi5zdGF0ZSA9IHsKICAgICAgICAgICAgICAgIGVycm9yOiBudWxsCiAgICAgICAgICAgICAgfTtyZXR1cm4gX3RoaXMyOwogICAgICAgICAgICB9X2NyZWF0ZUNsYXNzMihBd2FpdEVycm9yQm91bmRhcnksIFt7IGtleTogImNvbXBvbmVudERpZENhdGNoIiwgdmFsdWU6CgoKCgoKCgogICAgICAgICAgICAgIGZ1bmN0aW9uIGNvbXBvbmVudERpZENhdGNoKGVycm9yLCBlcnJvckluZm8pIHsKICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoIjxBd2FpdD4gY2F1Z2h0IHRoZSBmb2xsb3dpbmcgZXJyb3IgZHVyaW5nIHJlbmRlciIsIGVycm9yLCBlcnJvckluZm8pOwogICAgICAgICAgICAgIH0gfSwgeyBrZXk6ICJyZW5kZXIiLCB2YWx1ZToKCiAgICAgICAgICAgICAgZnVuY3Rpb24gcmVuZGVyKCkgewogICAgICAgICAgICAgICAgdmFyIF90aGlzJHByb3BzID0KCgoKICAgICAgICAgICAgICAgICAgdGhpcy5wcm9wcyxjaGlsZHJlbiA9IF90aGlzJHByb3BzLmNoaWxkcmVuLGVycm9yRWxlbWVudCA9IF90aGlzJHByb3BzLmVycm9yRWxlbWVudCxyZXNvbHZlID0gX3RoaXMkcHJvcHMucmVzb2x2ZTsKICAgICAgICAgICAgICAgIHZhciBwcm9taXNlID0gbnVsbDsKICAgICAgICAgICAgICAgIHZhciBzdGF0dXMgPSBBd2FpdFJlbmRlclN0YXR1cy5wZW5kaW5nOwoKICAgICAgICAgICAgICAgIGlmICghKHJlc29sdmUgaW5zdGFuY2VvZiBQcm9taXNlKSkgewogICAgICAgICAgICAgICAgICAvLyBEaWRuJ3QgZ2V0IGEgcHJvbWlzZSAtIHByb3ZpZGUgYXMgYSByZXNvbHZlZCBwcm9taXNlCiAgICAgICAgICAgICAgICAgIHN0YXR1cyA9IEF3YWl0UmVuZGVyU3RhdHVzLnN1Y2Nlc3M7CiAgICAgICAgICAgICAgICAgIHByb21pc2UgPSBQcm9taXNlLnJlc29sdmUoKTsKICAgICAgICAgICAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHByb21pc2UsICJfdHJhY2tlZCIsIHsKICAgICAgICAgICAgICAgICAgICBnZXQ6ICgpID0+IHRydWUKICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShwcm9taXNlLCAiX2RhdGEiLCB7CiAgICAgICAgICAgICAgICAgICAgZ2V0OiAoKSA9PiByZXNvbHZlCiAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfSBlbHNlIGlmICh0aGlzLnN0YXRlLmVycm9yKSB7CiAgICAgICAgICAgICAgICAgIC8vIENhdWdodCBhIHJlbmRlciBlcnJvciwgcHJvdmlkZSBpdCBhcyBhIHJlamVjdGVkIHByb21pc2UKICAgICAgICAgICAgICAgICAgc3RhdHVzID0gQXdhaXRSZW5kZXJTdGF0dXMuZXJyb3I7CiAgICAgICAgICAgICAgICAgIHZhciByZW5kZXJFcnJvciA9IHRoaXMuc3RhdGUuZXJyb3I7CiAgICAgICAgICAgICAgICAgIHByb21pc2UgPSBQcm9taXNlLnJlamVjdCgpLmNhdGNoKCgpID0+IHt9KTsgLy8gQXZvaWQgdW5oYW5kbGVkIHJlamVjdGlvbiB3YXJuaW5ncwoKICAgICAgICAgICAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHByb21pc2UsICJfdHJhY2tlZCIsIHsKICAgICAgICAgICAgICAgICAgICBnZXQ6ICgpID0+IHRydWUKICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShwcm9taXNlLCAiX2Vycm9yIiwgewogICAgICAgICAgICAgICAgICAgIGdldDogKCkgPT4gcmVuZGVyRXJyb3IKICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHJlc29sdmUuX3RyYWNrZWQpIHsKICAgICAgICAgICAgICAgICAgLy8gQWxyZWFkeSB0cmFja2VkIHByb21pc2UgLSBjaGVjayBjb250ZW50cwogICAgICAgICAgICAgICAgICBwcm9taXNlID0gcmVzb2x2ZTsKICAgICAgICAgICAgICAgICAgc3RhdHVzID0gcHJvbWlzZS5fZXJyb3IgIT09IHVuZGVmaW5lZCA/IEF3YWl0UmVuZGVyU3RhdHVzLmVycm9yIDogcHJvbWlzZS5fZGF0YSAhPT0gdW5kZWZpbmVkID8gQXdhaXRSZW5kZXJTdGF0dXMuc3VjY2VzcyA6IEF3YWl0UmVuZGVyU3RhdHVzLnBlbmRpbmc7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAvLyBSYXcgKHVudHJhY2tlZCkgcHJvbWlzZSAtIHRyYWNrIGl0CiAgICAgICAgICAgICAgICAgIHN0YXR1cyA9IEF3YWl0UmVuZGVyU3RhdHVzLnBlbmRpbmc7CiAgICAgICAgICAgICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShyZXNvbHZlLCAiX3RyYWNrZWQiLCB7CiAgICAgICAgICAgICAgICAgICAgZ2V0OiAoKSA9PiB0cnVlCiAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICBwcm9taXNlID0gcmVzb2x2ZS50aGVuKChkYXRhKSA9PiBPYmplY3QuZGVmaW5lUHJvcGVydHkocmVzb2x2ZSwgIl9kYXRhIiwgewogICAgICAgICAgICAgICAgICAgIGdldDogKCkgPT4gZGF0YQogICAgICAgICAgICAgICAgICB9KSwgKGVycm9yKSA9PiBPYmplY3QuZGVmaW5lUHJvcGVydHkocmVzb2x2ZSwgIl9lcnJvciIsIHsKICAgICAgICAgICAgICAgICAgICBnZXQ6ICgpID0+IGVycm9yCiAgICAgICAgICAgICAgICAgIH0pKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBpZiAoc3RhdHVzID09PSBBd2FpdFJlbmRlclN0YXR1cy5lcnJvciAmJiBwcm9taXNlLl9lcnJvciBpbnN0YW5jZW9mIEFib3J0ZWREZWZlcnJlZEVycm9yKSB7CiAgICAgICAgICAgICAgICAgIC8vIEZyZWV6ZSB0aGUgVUkgYnkgdGhyb3dpbmcgYSBuZXZlciByZXNvbHZlZCBwcm9taXNlCiAgICAgICAgICAgICAgICAgIHRocm93IG5ldmVyU2V0dGxlZFByb21pc2U7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgaWYgKHN0YXR1cyA9PT0gQXdhaXRSZW5kZXJTdGF0dXMuZXJyb3IgJiYgIWVycm9yRWxlbWVudCkgewogICAgICAgICAgICAgICAgICAvLyBObyBlcnJvckVsZW1lbnQsIHRocm93IHRvIHRoZSBuZWFyZXN0IHJvdXRlLWxldmVsIGVycm9yIGJvdW5kYXJ5CiAgICAgICAgICAgICAgICAgIHRocm93IHByb21pc2UuX2Vycm9yOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGlmIChzdGF0dXMgPT09IEF3YWl0UmVuZGVyU3RhdHVzLmVycm9yKSB7CiAgICAgICAgICAgICAgICAgIC8vIFJlbmRlciB2aWEgb3VyIGVycm9yRWxlbWVudAogICAgICAgICAgICAgICAgICByZXR1cm4gLyojX19QVVJFX18qL1JlYWN0LmNyZWF0ZUVsZW1lbnQoQXdhaXRDb250ZXh0LlByb3ZpZGVyLCB7CiAgICAgICAgICAgICAgICAgICAgdmFsdWU6IHByb21pc2UsCiAgICAgICAgICAgICAgICAgICAgY2hpbGRyZW46IGVycm9yRWxlbWVudAogICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBpZiAoc3RhdHVzID09PSBBd2FpdFJlbmRlclN0YXR1cy5zdWNjZXNzKSB7CiAgICAgICAgICAgICAgICAgIC8vIFJlbmRlciBjaGlsZHJlbiB3aXRoIHJlc29sdmVkIHZhbHVlCiAgICAgICAgICAgICAgICAgIHJldHVybiAvKiNfX1BVUkVfXyovUmVhY3QuY3JlYXRlRWxlbWVudChBd2FpdENvbnRleHQuUHJvdmlkZXIsIHsKICAgICAgICAgICAgICAgICAgICB2YWx1ZTogcHJvbWlzZSwKICAgICAgICAgICAgICAgICAgICBjaGlsZHJlbjogY2hpbGRyZW4KICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9IC8vIFRocm93IHRvIHRoZSBzdXNwZW5zZSBib3VuZGFyeQoKCiAgICAgICAgICAgICAgICB0aHJvdyBwcm9taXNlOwogICAgICAgICAgICAgIH0gfV0sIFt7IGtleTogImdldERlcml2ZWRTdGF0ZUZyb21FcnJvciIsIHZhbHVlOiBmdW5jdGlvbiBnZXREZXJpdmVkU3RhdGVGcm9tRXJyb3IoZXJyb3IpIHtyZXR1cm4geyBlcnJvcjogZXJyb3IgfTt9IH1dKTtyZXR1cm4gQXdhaXRFcnJvckJvdW5kYXJ5O30ocmVhY3QuQ29tcG9uZW50KTsKCgogICAgICAgICAgLyoqCiAgICAgICAgICAgKiBAcHJpdmF0ZQogICAgICAgICAgICogSW5kaXJlY3Rpb24gdG8gbGV2ZXJhZ2UgdXNlQXN5bmNWYWx1ZSBmb3IgYSByZW5kZXItcHJvcCBBUEkgb24gPEF3YWl0PgogICAgICAgICAgICovCgoKICAgICAgICAgIGZ1bmN0aW9uIFJlc29sdmVBd2FpdChfcmVmNykgewogICAgICAgICAgICB2YXIKICAgICAgICAgICAgY2hpbGRyZW4gPQogICAgICAgICAgICBfcmVmNy5jaGlsZHJlbjsKICAgICAgICAgICAgdmFyIGRhdGEgPSB1c2VBc3luY1ZhbHVlKCk7CiAgICAgICAgICAgIHZhciB0b1JlbmRlciA9IHR5cGVvZiBjaGlsZHJlbiA9PT0gImZ1bmN0aW9uIiA/IGNoaWxkcmVuKGRhdGEpIDogY2hpbGRyZW47CiAgICAgICAgICAgIHJldHVybiAvKiNfX1BVUkVfXyovUmVhY3QuY3JlYXRlRWxlbWVudChSZWFjdC5GcmFnbWVudCwgbnVsbCwgdG9SZW5kZXIpOwogICAgICAgICAgfSAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCiAgICAgICAgICAvLyBVVElMUwogICAgICAgICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwoKICAgICAgICAgIC8qKgogICAgICAgICAgICogQ3JlYXRlcyBhIHJvdXRlIGNvbmZpZyBmcm9tIGEgUmVhY3QgImNoaWxkcmVuIiBvYmplY3QsIHdoaWNoIGlzIHVzdWFsbHkKICAgICAgICAgICAqIGVpdGhlciBhIGA8Um91dGU+YCBlbGVtZW50IG9yIGFuIGFycmF5IG9mIHRoZW0uIFVzZWQgaW50ZXJuYWxseSBieQogICAgICAgICAgICogYDxSb3V0ZXM+YCB0byBjcmVhdGUgYSByb3V0ZSBjb25maWcgZnJvbSBpdHMgY2hpbGRyZW4uCiAgICAgICAgICAgKgogICAgICAgICAgICogQHNlZSBodHRwczovL3JlYWN0cm91dGVyLmNvbS91dGlscy9jcmVhdGUtcm91dGVzLWZyb20tY2hpbGRyZW4KICAgICAgICAgICAqLwoKCiAgICAgICAgICBmdW5jdGlvbiBjcmVhdGVSb3V0ZXNGcm9tQ2hpbGRyZW4oY2hpbGRyZW4sIHBhcmVudFBhdGgpIHsKICAgICAgICAgICAgaWYgKHBhcmVudFBhdGggPT09IHZvaWQgMCkgewogICAgICAgICAgICAgIHBhcmVudFBhdGggPSBbXTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdmFyIHJvdXRlcyA9IFtdOwogICAgICAgICAgICByZWFjdC5DaGlsZHJlbi5mb3JFYWNoKGNoaWxkcmVuLCAoZWxlbWVudCwgaW5kZXgpID0+IHsKICAgICAgICAgICAgICBpZiAoISAvKiNfX1BVUkVfXyovcmVhY3QuaXNWYWxpZEVsZW1lbnQoZWxlbWVudCkpIHsKICAgICAgICAgICAgICAgIC8vIElnbm9yZSBub24tZWxlbWVudHMuIFRoaXMgYWxsb3dzIHBlb3BsZSB0byBtb3JlIGVhc2lseSBpbmxpbmUKICAgICAgICAgICAgICAgIC8vIGNvbmRpdGlvbmFscyBpbiB0aGVpciByb3V0ZSBjb25maWcuCiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBpZiAoZWxlbWVudC50eXBlID09PSByZWFjdC5GcmFnbWVudCkgewogICAgICAgICAgICAgICAgLy8gVHJhbnNwYXJlbnRseSBzdXBwb3J0IFJlYWN0LkZyYWdtZW50IGFuZCBpdHMgY2hpbGRyZW4uCiAgICAgICAgICAgICAgICByb3V0ZXMucHVzaC5hcHBseShyb3V0ZXMsIGNyZWF0ZVJvdXRlc0Zyb21DaGlsZHJlbihlbGVtZW50LnByb3BzLmNoaWxkcmVuLCBwYXJlbnRQYXRoKSk7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAhKGVsZW1lbnQudHlwZSA9PT0gUm91dGUpID8gZmFsc2UgPyAwIDogcm91dGVyX2ludmFyaWFudChmYWxzZSkgOiB2b2lkIDA7CiAgICAgICAgICAgICAgISghZWxlbWVudC5wcm9wcy5pbmRleCB8fCAhZWxlbWVudC5wcm9wcy5jaGlsZHJlbikgPyBmYWxzZSA/IDAgOiByb3V0ZXJfaW52YXJpYW50KGZhbHNlKSA6IHZvaWQgMDsKICAgICAgICAgICAgICB2YXIgdHJlZVBhdGggPSBbXS5jb25jYXQoX3RvQ29uc3VtYWJsZUFycmF5MihwYXJlbnRQYXRoKSwgW2luZGV4XSk7CiAgICAgICAgICAgICAgdmFyIHJvdXRlID0gewogICAgICAgICAgICAgICAgaWQ6IGVsZW1lbnQucHJvcHMuaWQgfHwgdHJlZVBhdGguam9pbigiLSIpLAogICAgICAgICAgICAgICAgY2FzZVNlbnNpdGl2ZTogZWxlbWVudC5wcm9wcy5jYXNlU2Vuc2l0aXZlLAogICAgICAgICAgICAgICAgZWxlbWVudDogZWxlbWVudC5wcm9wcy5lbGVtZW50LAogICAgICAgICAgICAgICAgaW5kZXg6IGVsZW1lbnQucHJvcHMuaW5kZXgsCiAgICAgICAgICAgICAgICBwYXRoOiBlbGVtZW50LnByb3BzLnBhdGgsCiAgICAgICAgICAgICAgICBsb2FkZXI6IGVsZW1lbnQucHJvcHMubG9hZGVyLAogICAgICAgICAgICAgICAgYWN0aW9uOiBlbGVtZW50LnByb3BzLmFjdGlvbiwKICAgICAgICAgICAgICAgIGVycm9yRWxlbWVudDogZWxlbWVudC5wcm9wcy5lcnJvckVsZW1lbnQsCiAgICAgICAgICAgICAgICBoYXNFcnJvckJvdW5kYXJ5OiBlbGVtZW50LnByb3BzLmVycm9yRWxlbWVudCAhPSBudWxsLAogICAgICAgICAgICAgICAgc2hvdWxkUmV2YWxpZGF0ZTogZWxlbWVudC5wcm9wcy5zaG91bGRSZXZhbGlkYXRlLAogICAgICAgICAgICAgICAgaGFuZGxlOiBlbGVtZW50LnByb3BzLmhhbmRsZQogICAgICAgICAgICAgIH07CgogICAgICAgICAgICAgIGlmIChlbGVtZW50LnByb3BzLmNoaWxkcmVuKSB7CiAgICAgICAgICAgICAgICByb3V0ZS5jaGlsZHJlbiA9IGNyZWF0ZVJvdXRlc0Zyb21DaGlsZHJlbihlbGVtZW50LnByb3BzLmNoaWxkcmVuLCB0cmVlUGF0aCk7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICByb3V0ZXMucHVzaChyb3V0ZSk7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICByZXR1cm4gcm91dGVzOwogICAgICAgICAgfQogICAgICAgICAgLyoqCiAgICAgICAgICAgKiBSZW5kZXJzIHRoZSByZXN1bHQgb2YgYG1hdGNoUm91dGVzKClgIGludG8gYSBSZWFjdCBlbGVtZW50LgogICAgICAgICAgICovCgogICAgICAgICAgZnVuY3Rpb24gcmVuZGVyTWF0Y2hlcyhtYXRjaGVzKSB7CiAgICAgICAgICAgIHJldHVybiBfcmVuZGVyTWF0Y2hlcyhtYXRjaGVzKTsKICAgICAgICAgIH0KICAgICAgICAgIC8qKgogICAgICAgICAgICogQHByaXZhdGUKICAgICAgICAgICAqIFdhbGsgdGhlIHJvdXRlIHRyZWUgYW5kIGFkZCBoYXNFcnJvckJvdW5kYXJ5IGlmIGl0J3Mgbm90IHByb3ZpZGVkLCBzbyB0aGF0CiAgICAgICAgICAgKiB1c2VycyBwcm92aWRpbmcgbWFudWFsIHJvdXRlIGFycmF5cyBjYW4ganVzdCBzcGVjaWZ5IGVycm9yRWxlbWVudAogICAgICAgICAgICovCgogICAgICAgICAgZnVuY3Rpb24gZW5oYW5jZU1hbnVhbFJvdXRlT2JqZWN0cyhyb3V0ZXMpIHsKICAgICAgICAgICAgcmV0dXJuIHJvdXRlcy5tYXAoKHJvdXRlKSA9PiB7CiAgICAgICAgICAgICAgdmFyIHJvdXRlQ2xvbmUgPSBkaXN0X2V4dGVuZHMoe30sIHJvdXRlKTsKCiAgICAgICAgICAgICAgaWYgKHJvdXRlQ2xvbmUuaGFzRXJyb3JCb3VuZGFyeSA9PSBudWxsKSB7CiAgICAgICAgICAgICAgICByb3V0ZUNsb25lLmhhc0Vycm9yQm91bmRhcnkgPSByb3V0ZUNsb25lLmVycm9yRWxlbWVudCAhPSBudWxsOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgaWYgKHJvdXRlQ2xvbmUuY2hpbGRyZW4pIHsKICAgICAgICAgICAgICAgIHJvdXRlQ2xvbmUuY2hpbGRyZW4gPSBlbmhhbmNlTWFudWFsUm91dGVPYmplY3RzKHJvdXRlQ2xvbmUuY2hpbGRyZW4pOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgcmV0dXJuIHJvdXRlQ2xvbmU7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfQoKICAgICAgICAgIGZ1bmN0aW9uIGNyZWF0ZU1lbW9yeVJvdXRlcihyb3V0ZXMsIG9wdHMpIHsKICAgICAgICAgICAgcmV0dXJuIGNyZWF0ZVJvdXRlcih7CiAgICAgICAgICAgICAgYmFzZW5hbWU6IG9wdHMgPT0gbnVsbCA/IHZvaWQgMCA6IG9wdHMuYmFzZW5hbWUsCiAgICAgICAgICAgICAgaGlzdG9yeTogY3JlYXRlTWVtb3J5SGlzdG9yeSh7CiAgICAgICAgICAgICAgICBpbml0aWFsRW50cmllczogb3B0cyA9PSBudWxsID8gdm9pZCAwIDogb3B0cy5pbml0aWFsRW50cmllcywKICAgICAgICAgICAgICAgIGluaXRpYWxJbmRleDogb3B0cyA9PSBudWxsID8gdm9pZCAwIDogb3B0cy5pbml0aWFsSW5kZXgKICAgICAgICAgICAgICB9KSwKICAgICAgICAgICAgICBoeWRyYXRpb25EYXRhOiBvcHRzID09IG51bGwgPyB2b2lkIDAgOiBvcHRzLmh5ZHJhdGlvbkRhdGEsCiAgICAgICAgICAgICAgcm91dGVzOiBlbmhhbmNlTWFudWFsUm91dGVPYmplY3RzKHJvdXRlcykKICAgICAgICAgICAgfSkuaW5pdGlhbGl6ZSgpOwogICAgICAgICAgfSAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCgoKCgogICAgICAgICAgOyAvLyBDT05DQVRFTkFURUQgTU9EVUxFOiAuL25vZGVfbW9kdWxlcy9yZWFjdC1yb3V0ZXItZG9tL2Rpc3QvaW5kZXguanMKICAgICAgICAgIC8qKgogICAgICAgICAgICogUmVhY3QgUm91dGVyIERPTSB2Ni43LjAKICAgICAgICAgICAqCiAgICAgICAgICAgKiBDb3B5cmlnaHQgKGMpIFJlbWl4IFNvZnR3YXJlIEluYy4KICAgICAgICAgICAqCiAgICAgICAgICAgKiBUaGlzIHNvdXJjZSBjb2RlIGlzIGxpY2Vuc2VkIHVuZGVyIHRoZSBNSVQgbGljZW5zZSBmb3VuZCBpbiB0aGUKICAgICAgICAgICAqIExJQ0VOU0UubWQgZmlsZSBpbiB0aGUgcm9vdCBkaXJlY3Rvcnkgb2YgdGhpcyBzb3VyY2UgdHJlZS4KICAgICAgICAgICAqCiAgICAgICAgICAgKiBAbGljZW5zZSBNSVQKICAgICAgICAgICAqLwoKCgoKCiAgICAgICAgICBmdW5jdGlvbiByZWFjdF9yb3V0ZXJfZG9tX2Rpc3RfZXh0ZW5kcygpIHsKICAgICAgICAgICAgcmVhY3Rfcm91dGVyX2RvbV9kaXN0X2V4dGVuZHMgPSBPYmplY3QuYXNzaWduID8gT2JqZWN0LmFzc2lnbi5iaW5kKCkgOiBmdW5jdGlvbiAodGFyZ2V0KSB7CiAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDE7IGkgPCBhcmd1bWVudHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICAgIHZhciBzb3VyY2UgPSBhcmd1bWVudHNbaV07CgogICAgICAgICAgICAgICAgZm9yICh2YXIga2V5IGluIHNvdXJjZSkgewogICAgICAgICAgICAgICAgICBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKHNvdXJjZSwga2V5KSkgewogICAgICAgICAgICAgICAgICAgIHRhcmdldFtrZXldID0gc291cmNlW2tleV07CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIHJldHVybiB0YXJnZXQ7CiAgICAgICAgICAgIH07CiAgICAgICAgICAgIHJldHVybiByZWFjdF9yb3V0ZXJfZG9tX2Rpc3RfZXh0ZW5kcy5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICAgICAgfQoKICAgICAgICAgIGZ1bmN0aW9uIF9vYmplY3RXaXRob3V0UHJvcGVydGllc0xvb3NlKHNvdXJjZSwgZXhjbHVkZWQpIHsKICAgICAgICAgICAgaWYgKHNvdXJjZSA9PSBudWxsKSByZXR1cm4ge307CiAgICAgICAgICAgIHZhciB0YXJnZXQgPSB7fTsKICAgICAgICAgICAgdmFyIHNvdXJjZUtleXMgPSBPYmplY3Qua2V5cyhzb3VyY2UpOwogICAgICAgICAgICB2YXIga2V5LCBpOwoKICAgICAgICAgICAgZm9yIChpID0gMDsgaSA8IHNvdXJjZUtleXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICBrZXkgPSBzb3VyY2VLZXlzW2ldOwogICAgICAgICAgICAgIGlmIChleGNsdWRlZC5pbmRleE9mKGtleSkgPj0gMCkgY29udGludWU7CiAgICAgICAgICAgICAgdGFyZ2V0W2tleV0gPSBzb3VyY2Vba2V5XTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuIHRhcmdldDsKICAgICAgICAgIH0KCiAgICAgICAgICB2YXIgZGVmYXVsdE1ldGhvZCA9ICJnZXQiOwogICAgICAgICAgdmFyIGRlZmF1bHRFbmNUeXBlID0gImFwcGxpY2F0aW9uL3gtd3d3LWZvcm0tdXJsZW5jb2RlZCI7CiAgICAgICAgICBmdW5jdGlvbiBpc0h0bWxFbGVtZW50KG9iamVjdCkgewogICAgICAgICAgICByZXR1cm4gb2JqZWN0ICE9IG51bGwgJiYgdHlwZW9mIG9iamVjdC50YWdOYW1lID09PSAic3RyaW5nIjsKICAgICAgICAgIH0KICAgICAgICAgIGZ1bmN0aW9uIGlzQnV0dG9uRWxlbWVudChvYmplY3QpIHsKICAgICAgICAgICAgcmV0dXJuIGlzSHRtbEVsZW1lbnQob2JqZWN0KSAmJiBvYmplY3QudGFnTmFtZS50b0xvd2VyQ2FzZSgpID09PSAiYnV0dG9uIjsKICAgICAgICAgIH0KICAgICAgICAgIGZ1bmN0aW9uIGlzRm9ybUVsZW1lbnQob2JqZWN0KSB7CiAgICAgICAgICAgIHJldHVybiBpc0h0bWxFbGVtZW50KG9iamVjdCkgJiYgb2JqZWN0LnRhZ05hbWUudG9Mb3dlckNhc2UoKSA9PT0gImZvcm0iOwogICAgICAgICAgfQogICAgICAgICAgZnVuY3Rpb24gaXNJbnB1dEVsZW1lbnQob2JqZWN0KSB7CiAgICAgICAgICAgIHJldHVybiBpc0h0bWxFbGVtZW50KG9iamVjdCkgJiYgb2JqZWN0LnRhZ05hbWUudG9Mb3dlckNhc2UoKSA9PT0gImlucHV0IjsKICAgICAgICAgIH0KCiAgICAgICAgICBmdW5jdGlvbiBpc01vZGlmaWVkRXZlbnQoZXZlbnQpIHsKICAgICAgICAgICAgcmV0dXJuICEhKGV2ZW50Lm1ldGFLZXkgfHwgZXZlbnQuYWx0S2V5IHx8IGV2ZW50LmN0cmxLZXkgfHwgZXZlbnQuc2hpZnRLZXkpOwogICAgICAgICAgfQoKICAgICAgICAgIGZ1bmN0aW9uIHNob3VsZFByb2Nlc3NMaW5rQ2xpY2soZXZlbnQsIHRhcmdldCkgewogICAgICAgICAgICByZXR1cm4gZXZlbnQuYnV0dG9uID09PSAwICYmICggLy8gSWdub3JlIGV2ZXJ5dGhpbmcgYnV0IGxlZnQgY2xpY2tzCiAgICAgICAgICAgICF0YXJnZXQgfHwgdGFyZ2V0ID09PSAiX3NlbGYiKSAmJiAvLyBMZXQgYnJvd3NlciBoYW5kbGUgInRhcmdldD1fYmxhbmsiIGV0Yy4KICAgICAgICAgICAgIWlzTW9kaWZpZWRFdmVudChldmVudCkgLy8gSWdub3JlIGNsaWNrcyB3aXRoIG1vZGlmaWVyIGtleXMKICAgICAgICAgICAgOwogICAgICAgICAgfQogICAgICAgICAgLyoqCiAgICAgICAgICAgKiBDcmVhdGVzIGEgVVJMU2VhcmNoUGFyYW1zIG9iamVjdCB1c2luZyB0aGUgZ2l2ZW4gaW5pdGlhbGl6ZXIuCiAgICAgICAgICAgKgogICAgICAgICAgICogVGhpcyBpcyBpZGVudGljYWwgdG8gYG5ldyBVUkxTZWFyY2hQYXJhbXMoaW5pdClgIGV4Y2VwdCBpdCBhbHNvCiAgICAgICAgICAgKiBzdXBwb3J0cyBhcnJheXMgYXMgdmFsdWVzIGluIHRoZSBvYmplY3QgZm9ybSBvZiB0aGUgaW5pdGlhbGl6ZXIKICAgICAgICAgICAqIGluc3RlYWQgb2YganVzdCBzdHJpbmdzLiBUaGlzIGlzIGNvbnZlbmllbnQgd2hlbiB5b3UgbmVlZCBtdWx0aXBsZQogICAgICAgICAgICogdmFsdWVzIGZvciBhIGdpdmVuIGtleSwgYnV0IGRvbid0IHdhbnQgdG8gdXNlIGFuIGFycmF5IGluaXRpYWxpemVyLgogICAgICAgICAgICoKICAgICAgICAgICAqIEZvciBleGFtcGxlLCBpbnN0ZWFkIG9mOgogICAgICAgICAgICoKICAgICAgICAgICAqICAgbGV0IHNlYXJjaFBhcmFtcyA9IG5ldyBVUkxTZWFyY2hQYXJhbXMoWwogICAgICAgICAgICogICAgIFsnc29ydCcsICduYW1lJ10sCiAgICAgICAgICAgKiAgICAgWydzb3J0JywgJ3ByaWNlJ10KICAgICAgICAgICAqICAgXSk7CiAgICAgICAgICAgKgogICAgICAgICAgICogeW91IGNhbiBkbzoKICAgICAgICAgICAqCiAgICAgICAgICAgKiAgIGxldCBzZWFyY2hQYXJhbXMgPSBjcmVhdGVTZWFyY2hQYXJhbXMoewogICAgICAgICAgICogICAgIHNvcnQ6IFsnbmFtZScsICdwcmljZSddCiAgICAgICAgICAgKiAgIH0pOwogICAgICAgICAgICovCgogICAgICAgICAgZnVuY3Rpb24gY3JlYXRlU2VhcmNoUGFyYW1zKGluaXQpIHsKICAgICAgICAgICAgaWYgKGluaXQgPT09IHZvaWQgMCkgewogICAgICAgICAgICAgIGluaXQgPSAiIjsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuIG5ldyBVUkxTZWFyY2hQYXJhbXModHlwZW9mIGluaXQgPT09ICJzdHJpbmciIHx8IEFycmF5LmlzQXJyYXkoaW5pdCkgfHwgaW5pdCBpbnN0YW5jZW9mIFVSTFNlYXJjaFBhcmFtcyA/IGluaXQgOiBPYmplY3Qua2V5cyhpbml0KS5yZWR1Y2UoKG1lbW8sIGtleSkgPT4gewogICAgICAgICAgICAgIHZhciB2YWx1ZSA9IGluaXRba2V5XTsKICAgICAgICAgICAgICByZXR1cm4gbWVtby5jb25jYXQoQXJyYXkuaXNBcnJheSh2YWx1ZSkgPyB2YWx1ZS5tYXAoKHYpID0+IFtrZXksIHZdKSA6IFtba2V5LCB2YWx1ZV1dKTsKICAgICAgICAgICAgfSwgW10pKTsKICAgICAgICAgIH0KICAgICAgICAgIGZ1bmN0aW9uIGdldFNlYXJjaFBhcmFtc0ZvckxvY2F0aW9uKGxvY2F0aW9uU2VhcmNoLCBkZWZhdWx0U2VhcmNoUGFyYW1zKSB7CiAgICAgICAgICAgIHZhciBzZWFyY2hQYXJhbXMgPSBjcmVhdGVTZWFyY2hQYXJhbXMobG9jYXRpb25TZWFyY2gpO3ZhciBfaXRlcmF0b3IxMCA9IF9jcmVhdGVGb3JPZkl0ZXJhdG9ySGVscGVyMigKCiAgICAgICAgICAgICAgZGVmYXVsdFNlYXJjaFBhcmFtcy5rZXlzKCkpLF9zdGVwMTA7dHJ5IHt2YXIgX2xvb3AgPSBmdW5jdGlvbiBfbG9vcCgpIHt2YXIga2V5ID0gX3N0ZXAxMC52YWx1ZTsKICAgICAgICAgICAgICAgIGlmICghc2VhcmNoUGFyYW1zLmhhcyhrZXkpKSB7CiAgICAgICAgICAgICAgICAgIGRlZmF1bHRTZWFyY2hQYXJhbXMuZ2V0QWxsKGtleSkuZm9yRWFjaCgodmFsdWUpID0+IHsKICAgICAgICAgICAgICAgICAgICBzZWFyY2hQYXJhbXMuYXBwZW5kKGtleSwgdmFsdWUpOwogICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9O2ZvciAoX2l0ZXJhdG9yMTAucygpOyAhKF9zdGVwMTAgPSBfaXRlcmF0b3IxMC5uKCkpLmRvbmU7KSB7X2xvb3AoKTt9fSBjYXRjaCAoZXJyKSB7X2l0ZXJhdG9yMTAuZShlcnIpO30gZmluYWxseSB7X2l0ZXJhdG9yMTAuZigpO30KCiAgICAgICAgICAgIHJldHVybiBzZWFyY2hQYXJhbXM7CiAgICAgICAgICB9CiAgICAgICAgICBmdW5jdGlvbiBnZXRGb3JtU3VibWlzc2lvbkluZm8odGFyZ2V0LCBkZWZhdWx0QWN0aW9uLCBvcHRpb25zKSB7CiAgICAgICAgICAgIHZhciBtZXRob2Q7CiAgICAgICAgICAgIHZhciBhY3Rpb247CiAgICAgICAgICAgIHZhciBlbmNUeXBlOwogICAgICAgICAgICB2YXIgZm9ybURhdGE7CgogICAgICAgICAgICBpZiAoaXNGb3JtRWxlbWVudCh0YXJnZXQpKSB7CiAgICAgICAgICAgICAgdmFyIHN1Ym1pc3Npb25UcmlnZ2VyID0gb3B0aW9ucy5zdWJtaXNzaW9uVHJpZ2dlcjsKICAgICAgICAgICAgICBtZXRob2QgPSBvcHRpb25zLm1ldGhvZCB8fCB0YXJnZXQuZ2V0QXR0cmlidXRlKCJtZXRob2QiKSB8fCBkZWZhdWx0TWV0aG9kOwogICAgICAgICAgICAgIGFjdGlvbiA9IG9wdGlvbnMuYWN0aW9uIHx8IHRhcmdldC5nZXRBdHRyaWJ1dGUoImFjdGlvbiIpIHx8IGRlZmF1bHRBY3Rpb247CiAgICAgICAgICAgICAgZW5jVHlwZSA9IG9wdGlvbnMuZW5jVHlwZSB8fCB0YXJnZXQuZ2V0QXR0cmlidXRlKCJlbmN0eXBlIikgfHwgZGVmYXVsdEVuY1R5cGU7CiAgICAgICAgICAgICAgZm9ybURhdGEgPSBuZXcgRm9ybURhdGEodGFyZ2V0KTsKCiAgICAgICAgICAgICAgaWYgKHN1Ym1pc3Npb25UcmlnZ2VyICYmIHN1Ym1pc3Npb25UcmlnZ2VyLm5hbWUpIHsKICAgICAgICAgICAgICAgIGZvcm1EYXRhLmFwcGVuZChzdWJtaXNzaW9uVHJpZ2dlci5uYW1lLCBzdWJtaXNzaW9uVHJpZ2dlci52YWx1ZSk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2UgaWYgKGlzQnV0dG9uRWxlbWVudCh0YXJnZXQpIHx8IGlzSW5wdXRFbGVtZW50KHRhcmdldCkgJiYgKHRhcmdldC50eXBlID09PSAic3VibWl0IiB8fCB0YXJnZXQudHlwZSA9PT0gImltYWdlIikpIHsKICAgICAgICAgICAgICB2YXIgZm9ybSA9IHRhcmdldC5mb3JtOwoKICAgICAgICAgICAgICBpZiAoZm9ybSA9PSBudWxsKSB7CiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIkNhbm5vdCBzdWJtaXQgYSA8YnV0dG9uPiBvciA8aW5wdXQgdHlwZT1cInN1Ym1pdFwiPiB3aXRob3V0IGEgPGZvcm0+Iik7CiAgICAgICAgICAgICAgfSAvLyA8YnV0dG9uPi88aW5wdXQgdHlwZT0ic3VibWl0Ij4gbWF5IG92ZXJyaWRlIGF0dHJpYnV0ZXMgb2YgPGZvcm0+CgoKICAgICAgICAgICAgICBtZXRob2QgPSBvcHRpb25zLm1ldGhvZCB8fCB0YXJnZXQuZ2V0QXR0cmlidXRlKCJmb3JtbWV0aG9kIikgfHwgZm9ybS5nZXRBdHRyaWJ1dGUoIm1ldGhvZCIpIHx8IGRlZmF1bHRNZXRob2Q7CiAgICAgICAgICAgICAgYWN0aW9uID0gb3B0aW9ucy5hY3Rpb24gfHwgdGFyZ2V0LmdldEF0dHJpYnV0ZSgiZm9ybWFjdGlvbiIpIHx8IGZvcm0uZ2V0QXR0cmlidXRlKCJhY3Rpb24iKSB8fCBkZWZhdWx0QWN0aW9uOwogICAgICAgICAgICAgIGVuY1R5cGUgPSBvcHRpb25zLmVuY1R5cGUgfHwgdGFyZ2V0LmdldEF0dHJpYnV0ZSgiZm9ybWVuY3R5cGUiKSB8fCBmb3JtLmdldEF0dHJpYnV0ZSgiZW5jdHlwZSIpIHx8IGRlZmF1bHRFbmNUeXBlOwogICAgICAgICAgICAgIGZvcm1EYXRhID0gbmV3IEZvcm1EYXRhKGZvcm0pOyAvLyBJbmNsdWRlIG5hbWUgKyB2YWx1ZSBmcm9tIGEgPGJ1dHRvbj4sIGFwcGVuZGluZyBpbiBjYXNlIHRoZSBidXR0b24gbmFtZQogICAgICAgICAgICAgIC8vIG1hdGNoZXMgYW4gZXhpc3RpbmcgaW5wdXQgbmFtZQoKICAgICAgICAgICAgICBpZiAodGFyZ2V0Lm5hbWUpIHsKICAgICAgICAgICAgICAgIGZvcm1EYXRhLmFwcGVuZCh0YXJnZXQubmFtZSwgdGFyZ2V0LnZhbHVlKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZWxzZSBpZiAoaXNIdG1sRWxlbWVudCh0YXJnZXQpKSB7CiAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJDYW5ub3Qgc3VibWl0IGVsZW1lbnQgdGhhdCBpcyBub3QgPGZvcm0+LCA8YnV0dG9uPiwgb3IgIiArICI8aW5wdXQgdHlwZT1cInN1Ym1pdHxpbWFnZVwiPiIpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIG1ldGhvZCA9IG9wdGlvbnMubWV0aG9kIHx8IGRlZmF1bHRNZXRob2Q7CiAgICAgICAgICAgICAgYWN0aW9uID0gb3B0aW9ucy5hY3Rpb24gfHwgZGVmYXVsdEFjdGlvbjsKICAgICAgICAgICAgICBlbmNUeXBlID0gb3B0aW9ucy5lbmNUeXBlIHx8IGRlZmF1bHRFbmNUeXBlOwoKICAgICAgICAgICAgICBpZiAodGFyZ2V0IGluc3RhbmNlb2YgRm9ybURhdGEpIHsKICAgICAgICAgICAgICAgIGZvcm1EYXRhID0gdGFyZ2V0OwogICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBmb3JtRGF0YSA9IG5ldyBGb3JtRGF0YSgpOwoKICAgICAgICAgICAgICAgIGlmICh0YXJnZXQgaW5zdGFuY2VvZiBVUkxTZWFyY2hQYXJhbXMpIHt2YXIgX2l0ZXJhdG9yMTEgPSBfY3JlYXRlRm9yT2ZJdGVyYXRvckhlbHBlcjIoCiAgICAgICAgICAgICAgICAgICAgdGFyZ2V0KSxfc3RlcDExO3RyeSB7Zm9yIChfaXRlcmF0b3IxMS5zKCk7ICEoX3N0ZXAxMSA9IF9pdGVyYXRvcjExLm4oKSkuZG9uZTspIHt2YXIgX3N0ZXAxMSR2YWx1ZSA9IF9zbGljZWRUb0FycmF5Mihfc3RlcDExLnZhbHVlLCAyKSxuYW1lID0gX3N0ZXAxMSR2YWx1ZVswXSx2YWx1ZSA9IF9zdGVwMTEkdmFsdWVbMV07CiAgICAgICAgICAgICAgICAgICAgICBmb3JtRGF0YS5hcHBlbmQobmFtZSwgdmFsdWUpOwogICAgICAgICAgICAgICAgICAgIH19IGNhdGNoIChlcnIpIHtfaXRlcmF0b3IxMS5lKGVycik7fSBmaW5hbGx5IHtfaXRlcmF0b3IxMS5mKCk7fQogICAgICAgICAgICAgICAgfSBlbHNlIGlmICh0YXJnZXQgIT0gbnVsbCkgewogICAgICAgICAgICAgICAgICBmb3IgKHZhciBfaTMgPSAwLCBfT2JqZWN0JGtleXMgPSBPYmplY3Qua2V5cyh0YXJnZXQpOyBfaTMgPCBfT2JqZWN0JGtleXMubGVuZ3RoOyBfaTMrKykge3ZhciBfbmFtZSA9IF9PYmplY3Qka2V5c1tfaTNdOwogICAgICAgICAgICAgICAgICAgIGZvcm1EYXRhLmFwcGVuZChfbmFtZSwgdGFyZ2V0W19uYW1lXSk7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHZhciBfd2luZG93JGxvY2F0aW9uMiA9CgoKICAgICAgICAgICAgICB3aW5kb3cubG9jYXRpb24scHJvdG9jb2wgPSBfd2luZG93JGxvY2F0aW9uMi5wcm90b2NvbCxob3N0ID0gX3dpbmRvdyRsb2NhdGlvbjIuaG9zdDsKICAgICAgICAgICAgdmFyIHVybCA9IG5ldyBVUkwoYWN0aW9uLCBwcm90b2NvbCArICIvLyIgKyBob3N0KTsKICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICB1cmw6IHVybCwKICAgICAgICAgICAgICBtZXRob2Q6IG1ldGhvZC50b0xvd2VyQ2FzZSgpLAogICAgICAgICAgICAgIGVuY1R5cGU6IGVuY1R5cGUsCiAgICAgICAgICAgICAgZm9ybURhdGE6IGZvcm1EYXRhCiAgICAgICAgICAgIH07CiAgICAgICAgICB9CgogICAgICAgICAgdmFyIF9leGNsdWRlZCA9IFsib25DbGljayIsICJyZWxhdGl2ZSIsICJyZWxvYWREb2N1bWVudCIsICJyZXBsYWNlIiwgInN0YXRlIiwgInRhcmdldCIsICJ0byIsICJwcmV2ZW50U2Nyb2xsUmVzZXQiXSwKICAgICAgICAgICAgX2V4Y2x1ZGVkMiA9IFsiYXJpYS1jdXJyZW50IiwgImNhc2VTZW5zaXRpdmUiLCAiY2xhc3NOYW1lIiwgImVuZCIsICJzdHlsZSIsICJ0byIsICJjaGlsZHJlbiJdLAogICAgICAgICAgICBfZXhjbHVkZWQzID0gLyogdW51c2VkIHB1cmUgZXhwcmVzc2lvbiBvciBzdXBlciAqL251bGwgJiYgWyJyZWxvYWREb2N1bWVudCIsICJyZXBsYWNlIiwgIm1ldGhvZCIsICJhY3Rpb24iLCAib25TdWJtaXQiLCAiZmV0Y2hlcktleSIsICJyb3V0ZUlkIiwgInJlbGF0aXZlIiwgInByZXZlbnRTY3JvbGxSZXNldCJdOwogICAgICAgICAgLy8jcmVnaW9uIFJvdXRlcnMKICAgICAgICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCgogICAgICAgICAgZnVuY3Rpb24gY3JlYXRlQnJvd3NlclJvdXRlcihyb3V0ZXMsIG9wdHMpIHsKICAgICAgICAgICAgcmV0dXJuIGNyZWF0ZVJvdXRlcih7CiAgICAgICAgICAgICAgYmFzZW5hbWU6IG9wdHMgPT0gbnVsbCA/IHZvaWQgMCA6IG9wdHMuYmFzZW5hbWUsCiAgICAgICAgICAgICAgaGlzdG9yeTogY3JlYXRlQnJvd3Nlckhpc3RvcnkoewogICAgICAgICAgICAgICAgd2luZG93OiBvcHRzID09IG51bGwgPyB2b2lkIDAgOiBvcHRzLndpbmRvdwogICAgICAgICAgICAgIH0pLAogICAgICAgICAgICAgIGh5ZHJhdGlvbkRhdGE6IChvcHRzID09IG51bGwgPyB2b2lkIDAgOiBvcHRzLmh5ZHJhdGlvbkRhdGEpIHx8IHBhcnNlSHlkcmF0aW9uRGF0YSgpLAogICAgICAgICAgICAgIHJvdXRlczogVU5TQUZFX2VuaGFuY2VNYW51YWxSb3V0ZU9iamVjdHMocm91dGVzKQogICAgICAgICAgICB9KS5pbml0aWFsaXplKCk7CiAgICAgICAgICB9CiAgICAgICAgICBmdW5jdGlvbiBjcmVhdGVIYXNoUm91dGVyKHJvdXRlcywgb3B0cykgewogICAgICAgICAgICByZXR1cm4gY3JlYXRlUm91dGVyKHsKICAgICAgICAgICAgICBiYXNlbmFtZTogb3B0cyA9PSBudWxsID8gdm9pZCAwIDogb3B0cy5iYXNlbmFtZSwKICAgICAgICAgICAgICBoaXN0b3J5OiBjcmVhdGVIYXNoSGlzdG9yeSh7CiAgICAgICAgICAgICAgICB3aW5kb3c6IG9wdHMgPT0gbnVsbCA/IHZvaWQgMCA6IG9wdHMud2luZG93CiAgICAgICAgICAgICAgfSksCiAgICAgICAgICAgICAgaHlkcmF0aW9uRGF0YTogKG9wdHMgPT0gbnVsbCA/IHZvaWQgMCA6IG9wdHMuaHlkcmF0aW9uRGF0YSkgfHwgcGFyc2VIeWRyYXRpb25EYXRhKCksCiAgICAgICAgICAgICAgcm91dGVzOiBVTlNBRkVfZW5oYW5jZU1hbnVhbFJvdXRlT2JqZWN0cyhyb3V0ZXMpCiAgICAgICAgICAgIH0pLmluaXRpYWxpemUoKTsKICAgICAgICAgIH0KCiAgICAgICAgICBmdW5jdGlvbiBwYXJzZUh5ZHJhdGlvbkRhdGEoKSB7CiAgICAgICAgICAgIHZhciBfd2luZG93OwoKICAgICAgICAgICAgdmFyIHN0YXRlID0gKF93aW5kb3cgPSB3aW5kb3cpID09IG51bGwgPyB2b2lkIDAgOiBfd2luZG93Ll9fc3RhdGljUm91dGVySHlkcmF0aW9uRGF0YTsKCiAgICAgICAgICAgIGlmIChzdGF0ZSAmJiBzdGF0ZS5lcnJvcnMpIHsKICAgICAgICAgICAgICBzdGF0ZSA9IHJlYWN0X3JvdXRlcl9kb21fZGlzdF9leHRlbmRzKHt9LCBzdGF0ZSwgewogICAgICAgICAgICAgICAgZXJyb3JzOiBkZXNlcmlhbGl6ZUVycm9ycyhzdGF0ZS5lcnJvcnMpCiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybiBzdGF0ZTsKICAgICAgICAgIH0KCiAgICAgICAgICBmdW5jdGlvbiBkZXNlcmlhbGl6ZUVycm9ycyhlcnJvcnMpIHsKICAgICAgICAgICAgaWYgKCFlcnJvcnMpIHJldHVybiBudWxsOwogICAgICAgICAgICB2YXIgZW50cmllcyA9IE9iamVjdC5lbnRyaWVzKGVycm9ycyk7CiAgICAgICAgICAgIHZhciBzZXJpYWxpemVkID0ge307CgogICAgICAgICAgICBmb3IgKHZhciBfaTQgPSAwLCBfZW50cmllcyA9IGVudHJpZXM7IF9pNCA8IF9lbnRyaWVzLmxlbmd0aDsgX2k0KyspIHt2YXIgX2VudHJpZXMkX2kgPSBfc2xpY2VkVG9BcnJheTIoX2VudHJpZXNbX2k0XSwgMiksa2V5ID0gX2VudHJpZXMkX2lbMF0sdmFsID0gX2VudHJpZXMkX2lbMV07CiAgICAgICAgICAgICAgLy8gSGV5IHlvdSEgIElmIHlvdSBjaGFuZ2UgdGhpcywgcGxlYXNlIGNoYW5nZSB0aGUgY29ycmVzcG9uZGluZyBsb2dpYyBpbgogICAgICAgICAgICAgIC8vIHNlcmlhbGl6ZUVycm9ycyBpbiByZWFjdC1yb3V0ZXItZG9tL3NlcnZlci50c3ggOikKICAgICAgICAgICAgICBpZiAodmFsICYmIHZhbC5fX3R5cGUgPT09ICJSb3V0ZUVycm9yUmVzcG9uc2UiKSB7CiAgICAgICAgICAgICAgICBzZXJpYWxpemVkW2tleV0gPSBuZXcgRXJyb3JSZXNwb25zZSh2YWwuc3RhdHVzLCB2YWwuc3RhdHVzVGV4dCwgdmFsLmRhdGEsIHZhbC5pbnRlcm5hbCA9PT0gdHJ1ZSk7CiAgICAgICAgICAgICAgfSBlbHNlIGlmICh2YWwgJiYgdmFsLl9fdHlwZSA9PT0gIkVycm9yIikgewogICAgICAgICAgICAgICAgdmFyIGVycm9yID0gbmV3IEVycm9yKHZhbC5tZXNzYWdlKTsgLy8gV2lwZSBhd2F5IHRoZSBjbGllbnQtc2lkZSBzdGFjayB0cmFjZS4gIE5vdGhpbmcgdG8gZmlsbCBpdCBpbiB3aXRoCiAgICAgICAgICAgICAgICAvLyBiZWNhdXNlIHdlIGRvbid0IHNlcmlhbGl6ZSBTU1Igc3RhY2sgdHJhY2VzIGZvciBzZWN1cml0eSByZWFzb25zCgogICAgICAgICAgICAgICAgZXJyb3Iuc3RhY2sgPSAiIjsKICAgICAgICAgICAgICAgIHNlcmlhbGl6ZWRba2V5XSA9IGVycm9yOwogICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBzZXJpYWxpemVkW2tleV0gPSB2YWw7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICByZXR1cm4gc2VyaWFsaXplZDsKICAgICAgICAgIH0KICAgICAgICAgIC8qKgogICAgICAgICAgICogQSBgPFJvdXRlcj5gIGZvciB1c2UgaW4gd2ViIGJyb3dzZXJzLiBQcm92aWRlcyB0aGUgY2xlYW5lc3QgVVJMcy4KICAgICAgICAgICAqLwoKCiAgICAgICAgICBmdW5jdGlvbiBCcm93c2VyUm91dGVyKF9yZWYpIHsKICAgICAgICAgICAgdmFyCiAgICAgICAgICAgICAgYmFzZW5hbWUgPQoKCiAgICAgICAgICAgICAgX3JlZi5iYXNlbmFtZSxjaGlsZHJlbiA9IF9yZWYuY2hpbGRyZW4sd2luZG93ID0gX3JlZi53aW5kb3c7CiAgICAgICAgICAgIHZhciBoaXN0b3J5UmVmID0gUmVhY3QudXNlUmVmKCk7CgogICAgICAgICAgICBpZiAoaGlzdG9yeVJlZi5jdXJyZW50ID09IG51bGwpIHsKICAgICAgICAgICAgICBoaXN0b3J5UmVmLmN1cnJlbnQgPSBjcmVhdGVCcm93c2VySGlzdG9yeSh7CiAgICAgICAgICAgICAgICB3aW5kb3c6IHdpbmRvdywKICAgICAgICAgICAgICAgIHY1Q29tcGF0OiB0cnVlCiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHZhciBoaXN0b3J5ID0gaGlzdG9yeVJlZi5jdXJyZW50OwogICAgICAgICAgICB2YXIgX1JlYWN0JHVzZVN0YXRlMyA9IFJlYWN0LnVzZVN0YXRlKHsKICAgICAgICAgICAgICAgIGFjdGlvbjogaGlzdG9yeS5hY3Rpb24sCiAgICAgICAgICAgICAgICBsb2NhdGlvbjogaGlzdG9yeS5sb2NhdGlvbgogICAgICAgICAgICAgIH0pLF9SZWFjdCR1c2VTdGF0ZTQgPSBfc2xpY2VkVG9BcnJheTIoX1JlYWN0JHVzZVN0YXRlMywgMiksc3RhdGUgPSBfUmVhY3QkdXNlU3RhdGU0WzBdLHNldFN0YXRlID0gX1JlYWN0JHVzZVN0YXRlNFsxXTsKICAgICAgICAgICAgUmVhY3QudXNlTGF5b3V0RWZmZWN0KCgpID0+IGhpc3RvcnkubGlzdGVuKHNldFN0YXRlKSwgW2hpc3RvcnldKTsKICAgICAgICAgICAgcmV0dXJuIC8qI19fUFVSRV9fKi9SZWFjdC5jcmVhdGVFbGVtZW50KFJvdXRlciwgewogICAgICAgICAgICAgIGJhc2VuYW1lOiBiYXNlbmFtZSwKICAgICAgICAgICAgICBjaGlsZHJlbjogY2hpbGRyZW4sCiAgICAgICAgICAgICAgbG9jYXRpb246IHN0YXRlLmxvY2F0aW9uLAogICAgICAgICAgICAgIG5hdmlnYXRpb25UeXBlOiBzdGF0ZS5hY3Rpb24sCiAgICAgICAgICAgICAgbmF2aWdhdG9yOiBoaXN0b3J5CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfQogICAgICAgICAgLyoqCiAgICAgICAgICAgKiBBIGA8Um91dGVyPmAgZm9yIHVzZSBpbiB3ZWIgYnJvd3NlcnMuIFN0b3JlcyB0aGUgbG9jYXRpb24gaW4gdGhlIGhhc2gKICAgICAgICAgICAqIHBvcnRpb24gb2YgdGhlIFVSTCBzbyBpdCBpcyBub3Qgc2VudCB0byB0aGUgc2VydmVyLgogICAgICAgICAgICovCgogICAgICAgICAgZnVuY3Rpb24gSGFzaFJvdXRlcihfcmVmMikgewogICAgICAgICAgICB2YXIKICAgICAgICAgICAgICBiYXNlbmFtZSA9CgoKICAgICAgICAgICAgICBfcmVmMi5iYXNlbmFtZSxjaGlsZHJlbiA9IF9yZWYyLmNoaWxkcmVuLHdpbmRvdyA9IF9yZWYyLndpbmRvdzsKICAgICAgICAgICAgdmFyIGhpc3RvcnlSZWYgPSBSZWFjdC51c2VSZWYoKTsKCiAgICAgICAgICAgIGlmIChoaXN0b3J5UmVmLmN1cnJlbnQgPT0gbnVsbCkgewogICAgICAgICAgICAgIGhpc3RvcnlSZWYuY3VycmVudCA9IGNyZWF0ZUhhc2hIaXN0b3J5KHsKICAgICAgICAgICAgICAgIHdpbmRvdzogd2luZG93LAogICAgICAgICAgICAgICAgdjVDb21wYXQ6IHRydWUKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdmFyIGhpc3RvcnkgPSBoaXN0b3J5UmVmLmN1cnJlbnQ7CiAgICAgICAgICAgIHZhciBfUmVhY3QkdXNlU3RhdGU1ID0gUmVhY3QudXNlU3RhdGUoewogICAgICAgICAgICAgICAgYWN0aW9uOiBoaXN0b3J5LmFjdGlvbiwKICAgICAgICAgICAgICAgIGxvY2F0aW9uOiBoaXN0b3J5LmxvY2F0aW9uCiAgICAgICAgICAgICAgfSksX1JlYWN0JHVzZVN0YXRlNiA9IF9zbGljZWRUb0FycmF5MihfUmVhY3QkdXNlU3RhdGU1LCAyKSxzdGF0ZSA9IF9SZWFjdCR1c2VTdGF0ZTZbMF0sc2V0U3RhdGUgPSBfUmVhY3QkdXNlU3RhdGU2WzFdOwogICAgICAgICAgICBSZWFjdC51c2VMYXlvdXRFZmZlY3QoKCkgPT4gaGlzdG9yeS5saXN0ZW4oc2V0U3RhdGUpLCBbaGlzdG9yeV0pOwogICAgICAgICAgICByZXR1cm4gLyojX19QVVJFX18qL1JlYWN0LmNyZWF0ZUVsZW1lbnQoUm91dGVyLCB7CiAgICAgICAgICAgICAgYmFzZW5hbWU6IGJhc2VuYW1lLAogICAgICAgICAgICAgIGNoaWxkcmVuOiBjaGlsZHJlbiwKICAgICAgICAgICAgICBsb2NhdGlvbjogc3RhdGUubG9jYXRpb24sCiAgICAgICAgICAgICAgbmF2aWdhdGlvblR5cGU6IHN0YXRlLmFjdGlvbiwKICAgICAgICAgICAgICBuYXZpZ2F0b3I6IGhpc3RvcnkKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9CiAgICAgICAgICAvKioKICAgICAgICAgICAqIEEgYDxSb3V0ZXI+YCB0aGF0IGFjY2VwdHMgYSBwcmUtaW5zdGFudGlhdGVkIGhpc3Rvcnkgb2JqZWN0LiBJdCdzIGltcG9ydGFudAogICAgICAgICAgICogdG8gbm90ZSB0aGF0IHVzaW5nIHlvdXIgb3duIGhpc3Rvcnkgb2JqZWN0IGlzIGhpZ2hseSBkaXNjb3VyYWdlZCBhbmQgbWF5IGFkZAogICAgICAgICAgICogdHdvIHZlcnNpb25zIG9mIHRoZSBoaXN0b3J5IGxpYnJhcnkgdG8geW91ciBidW5kbGVzIHVubGVzcyB5b3UgdXNlIHRoZSBzYW1lCiAgICAgICAgICAgKiB2ZXJzaW9uIG9mIHRoZSBoaXN0b3J5IGxpYnJhcnkgdGhhdCBSZWFjdCBSb3V0ZXIgdXNlcyBpbnRlcm5hbGx5LgogICAgICAgICAgICovCgogICAgICAgICAgZnVuY3Rpb24gSGlzdG9yeVJvdXRlcihfcmVmMykgewogICAgICAgICAgICB2YXIKICAgICAgICAgICAgICBiYXNlbmFtZSA9CgoKICAgICAgICAgICAgICBfcmVmMy5iYXNlbmFtZSxjaGlsZHJlbiA9IF9yZWYzLmNoaWxkcmVuLGhpc3RvcnkgPSBfcmVmMy5oaXN0b3J5OwogICAgICAgICAgICB2YXIgX1JlYWN0JHVzZVN0YXRlNyA9IFJlYWN0LnVzZVN0YXRlKHsKICAgICAgICAgICAgICAgIGFjdGlvbjogaGlzdG9yeS5hY3Rpb24sCiAgICAgICAgICAgICAgICBsb2NhdGlvbjogaGlzdG9yeS5sb2NhdGlvbgogICAgICAgICAgICAgIH0pLF9SZWFjdCR1c2VTdGF0ZTggPSBfc2xpY2VkVG9BcnJheTIoX1JlYWN0JHVzZVN0YXRlNywgMiksc3RhdGUgPSBfUmVhY3QkdXNlU3RhdGU4WzBdLHNldFN0YXRlID0gX1JlYWN0JHVzZVN0YXRlOFsxXTsKICAgICAgICAgICAgUmVhY3QudXNlTGF5b3V0RWZmZWN0KCgpID0+IGhpc3RvcnkubGlzdGVuKHNldFN0YXRlKSwgW2hpc3RvcnldKTsKICAgICAgICAgICAgcmV0dXJuIC8qI19fUFVSRV9fKi9SZWFjdC5jcmVhdGVFbGVtZW50KFJvdXRlciwgewogICAgICAgICAgICAgIGJhc2VuYW1lOiBiYXNlbmFtZSwKICAgICAgICAgICAgICBjaGlsZHJlbjogY2hpbGRyZW4sCiAgICAgICAgICAgICAgbG9jYXRpb246IHN0YXRlLmxvY2F0aW9uLAogICAgICAgICAgICAgIG5hdmlnYXRpb25UeXBlOiBzdGF0ZS5hY3Rpb24sCiAgICAgICAgICAgICAgbmF2aWdhdG9yOiBoaXN0b3J5CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfQoKICAgICAgICAgIGlmIChmYWxzZSkge30KICAgICAgICAgIC8qKgogICAgICAgICAgICogVGhlIHB1YmxpYyBBUEkgZm9yIHJlbmRlcmluZyBhIGhpc3RvcnktYXdhcmUgPGE+LgogICAgICAgICAgICovCgogICAgICAgICAgdmFyIExpbmsgPSAvKiNfX1BVUkVfXyovcmVhY3QuZm9yd2FyZFJlZihmdW5jdGlvbiBMaW5rV2l0aFJlZihfcmVmNCwgcmVmKSB7CiAgICAgICAgICAgIHZhcgogICAgICAgICAgICAgIG9uQ2xpY2sgPQoKCgoKCgoKICAgICAgICAgICAgICBfcmVmNC5vbkNsaWNrLHJlbGF0aXZlID0gX3JlZjQucmVsYXRpdmUscmVsb2FkRG9jdW1lbnQgPSBfcmVmNC5yZWxvYWREb2N1bWVudCxyZXBsYWNlID0gX3JlZjQucmVwbGFjZSxzdGF0ZSA9IF9yZWY0LnN0YXRlLHRhcmdldCA9IF9yZWY0LnRhcmdldCx0byA9IF9yZWY0LnRvLHByZXZlbnRTY3JvbGxSZXNldCA9IF9yZWY0LnByZXZlbnRTY3JvbGxSZXNldCwKICAgICAgICAgICAgICByZXN0ID0gX29iamVjdFdpdGhvdXRQcm9wZXJ0aWVzTG9vc2UoX3JlZjQsIF9leGNsdWRlZCk7CgogICAgICAgICAgICB2YXIgaHJlZiA9IHVzZUhyZWYodG8sIHsKICAgICAgICAgICAgICByZWxhdGl2ZTogcmVsYXRpdmUKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIHZhciBpbnRlcm5hbE9uQ2xpY2sgPSB1c2VMaW5rQ2xpY2tIYW5kbGVyKHRvLCB7CiAgICAgICAgICAgICAgcmVwbGFjZTogcmVwbGFjZSwKICAgICAgICAgICAgICBzdGF0ZTogc3RhdGUsCiAgICAgICAgICAgICAgdGFyZ2V0OiB0YXJnZXQsCiAgICAgICAgICAgICAgcHJldmVudFNjcm9sbFJlc2V0OiBwcmV2ZW50U2Nyb2xsUmVzZXQsCiAgICAgICAgICAgICAgcmVsYXRpdmU6IHJlbGF0aXZlCiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgZnVuY3Rpb24gaGFuZGxlQ2xpY2soZXZlbnQpIHsKICAgICAgICAgICAgICBpZiAob25DbGljaykgb25DbGljayhldmVudCk7CgogICAgICAgICAgICAgIGlmICghZXZlbnQuZGVmYXVsdFByZXZlbnRlZCkgewogICAgICAgICAgICAgICAgaW50ZXJuYWxPbkNsaWNrKGV2ZW50KTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybiAoCiAgICAgICAgICAgICAgLyojX19QVVJFX18qLwogICAgICAgICAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBqc3gtYTExeS9hbmNob3ItaGFzLWNvbnRlbnQKICAgICAgICAgICAgICByZWFjdC5jcmVhdGVFbGVtZW50KCJhIiwgcmVhY3Rfcm91dGVyX2RvbV9kaXN0X2V4dGVuZHMoe30sIHJlc3QsIHsKICAgICAgICAgICAgICAgIGhyZWY6IGhyZWYsCiAgICAgICAgICAgICAgICBvbkNsaWNrOiByZWxvYWREb2N1bWVudCA/IG9uQ2xpY2sgOiBoYW5kbGVDbGljaywKICAgICAgICAgICAgICAgIHJlZjogcmVmLAogICAgICAgICAgICAgICAgdGFyZ2V0OiB0YXJnZXQKICAgICAgICAgICAgICB9KSkpOwoKICAgICAgICAgIH0pOwoKICAgICAgICAgIGlmIChmYWxzZSkge30KICAgICAgICAgIC8qKgogICAgICAgICAgICogQSA8TGluaz4gd3JhcHBlciB0aGF0IGtub3dzIGlmIGl0J3MgImFjdGl2ZSIgb3Igbm90LgogICAgICAgICAgICovCgoKICAgICAgICAgIHZhciBOYXZMaW5rID0gLyojX19QVVJFX18qL3JlYWN0LmZvcndhcmRSZWYoZnVuY3Rpb24gTmF2TGlua1dpdGhSZWYoX3JlZjUsIHJlZikgewogICAgICAgICAgICB2YXIgX3JlZjUkYXJpYUN1cnJlbnQgPQoKCgoKCgoKICAgICAgICAgICAgICBfcmVmNVsiYXJpYS1jdXJyZW50Il0sYXJpYUN1cnJlbnRQcm9wID0gX3JlZjUkYXJpYUN1cnJlbnQgPT09IHZvaWQgMCA/ICJwYWdlIiA6IF9yZWY1JGFyaWFDdXJyZW50LF9yZWY1JGNhc2VTZW5zaXRpdmUgPSBfcmVmNS5jYXNlU2Vuc2l0aXZlLGNhc2VTZW5zaXRpdmUgPSBfcmVmNSRjYXNlU2Vuc2l0aXZlID09PSB2b2lkIDAgPyBmYWxzZSA6IF9yZWY1JGNhc2VTZW5zaXRpdmUsX3JlZjUkY2xhc3NOYW1lID0gX3JlZjUuY2xhc3NOYW1lLGNsYXNzTmFtZVByb3AgPSBfcmVmNSRjbGFzc05hbWUgPT09IHZvaWQgMCA/ICIiIDogX3JlZjUkY2xhc3NOYW1lLF9yZWY1JGVuZCA9IF9yZWY1LmVuZCxlbmQgPSBfcmVmNSRlbmQgPT09IHZvaWQgMCA/IGZhbHNlIDogX3JlZjUkZW5kLHN0eWxlUHJvcCA9IF9yZWY1LnN0eWxlLHRvID0gX3JlZjUudG8sY2hpbGRyZW4gPSBfcmVmNS5jaGlsZHJlbiwKICAgICAgICAgICAgICByZXN0ID0gX29iamVjdFdpdGhvdXRQcm9wZXJ0aWVzTG9vc2UoX3JlZjUsIF9leGNsdWRlZDIpOwoKICAgICAgICAgICAgdmFyIHBhdGggPSBkaXN0X3VzZVJlc29sdmVkUGF0aCh0bywgewogICAgICAgICAgICAgIHJlbGF0aXZlOiByZXN0LnJlbGF0aXZlCiAgICAgICAgICAgIH0pOwogICAgICAgICAgICB2YXIgbG9jYXRpb24gPSBkaXN0X3VzZUxvY2F0aW9uKCk7CiAgICAgICAgICAgIHZhciByb3V0ZXJTdGF0ZSA9IHJlYWN0LnVzZUNvbnRleHQoRGF0YVJvdXRlclN0YXRlQ29udGV4dCk7CiAgICAgICAgICAgIHZhciBfcmVhY3QkdXNlQ29udGV4dDcgPQoKICAgICAgICAgICAgICByZWFjdC51c2VDb250ZXh0KE5hdmlnYXRpb25Db250ZXh0KSxuYXZpZ2F0b3IgPSBfcmVhY3QkdXNlQ29udGV4dDcubmF2aWdhdG9yOwogICAgICAgICAgICB2YXIgdG9QYXRobmFtZSA9IG5hdmlnYXRvci5lbmNvZGVMb2NhdGlvbiA/IG5hdmlnYXRvci5lbmNvZGVMb2NhdGlvbihwYXRoKS5wYXRobmFtZSA6IHBhdGgucGF0aG5hbWU7CiAgICAgICAgICAgIHZhciBsb2NhdGlvblBhdGhuYW1lID0gbG9jYXRpb24ucGF0aG5hbWU7CiAgICAgICAgICAgIHZhciBuZXh0TG9jYXRpb25QYXRobmFtZSA9IHJvdXRlclN0YXRlICYmIHJvdXRlclN0YXRlLm5hdmlnYXRpb24gJiYgcm91dGVyU3RhdGUubmF2aWdhdGlvbi5sb2NhdGlvbiA/IHJvdXRlclN0YXRlLm5hdmlnYXRpb24ubG9jYXRpb24ucGF0aG5hbWUgOiBudWxsOwoKICAgICAgICAgICAgaWYgKCFjYXNlU2Vuc2l0aXZlKSB7CiAgICAgICAgICAgICAgbG9jYXRpb25QYXRobmFtZSA9IGxvY2F0aW9uUGF0aG5hbWUudG9Mb3dlckNhc2UoKTsKICAgICAgICAgICAgICBuZXh0TG9jYXRpb25QYXRobmFtZSA9IG5leHRMb2NhdGlvblBhdGhuYW1lID8gbmV4dExvY2F0aW9uUGF0aG5hbWUudG9Mb3dlckNhc2UoKSA6IG51bGw7CiAgICAgICAgICAgICAgdG9QYXRobmFtZSA9IHRvUGF0aG5hbWUudG9Mb3dlckNhc2UoKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdmFyIGlzQWN0aXZlID0gbG9jYXRpb25QYXRobmFtZSA9PT0gdG9QYXRobmFtZSB8fCAhZW5kICYmIGxvY2F0aW9uUGF0aG5hbWUuc3RhcnRzV2l0aCh0b1BhdGhuYW1lKSAmJiBsb2NhdGlvblBhdGhuYW1lLmNoYXJBdCh0b1BhdGhuYW1lLmxlbmd0aCkgPT09ICIvIjsKICAgICAgICAgICAgdmFyIGlzUGVuZGluZyA9IG5leHRMb2NhdGlvblBhdGhuYW1lICE9IG51bGwgJiYgKG5leHRMb2NhdGlvblBhdGhuYW1lID09PSB0b1BhdGhuYW1lIHx8ICFlbmQgJiYgbmV4dExvY2F0aW9uUGF0aG5hbWUuc3RhcnRzV2l0aCh0b1BhdGhuYW1lKSAmJiBuZXh0TG9jYXRpb25QYXRobmFtZS5jaGFyQXQodG9QYXRobmFtZS5sZW5ndGgpID09PSAiLyIpOwogICAgICAgICAgICB2YXIgYXJpYUN1cnJlbnQgPSBpc0FjdGl2ZSA/IGFyaWFDdXJyZW50UHJvcCA6IHVuZGVmaW5lZDsKICAgICAgICAgICAgdmFyIGNsYXNzTmFtZTsKCiAgICAgICAgICAgIGlmICh0eXBlb2YgY2xhc3NOYW1lUHJvcCA9PT0gImZ1bmN0aW9uIikgewogICAgICAgICAgICAgIGNsYXNzTmFtZSA9IGNsYXNzTmFtZVByb3AoewogICAgICAgICAgICAgICAgaXNBY3RpdmU6IGlzQWN0aXZlLAogICAgICAgICAgICAgICAgaXNQZW5kaW5nOiBpc1BlbmRpbmcKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAvLyBJZiB0aGUgY2xhc3NOYW1lIHByb3AgaXMgbm90IGEgZnVuY3Rpb24sIHdlIHVzZSBhIGRlZmF1bHQgYGFjdGl2ZWAKICAgICAgICAgICAgICAvLyBjbGFzcyBmb3IgPE5hdkxpbmsgLz5zIHRoYXQgYXJlIGFjdGl2ZS4gSW4gdjUgYGFjdGl2ZWAgd2FzIHRoZSBkZWZhdWx0CiAgICAgICAgICAgICAgLy8gdmFsdWUgZm9yIGBhY3RpdmVDbGFzc05hbWVgLCBidXQgd2UgYXJlIHJlbW92aW5nIHRoYXQgQVBJIGFuZCBjYW4gc3RpbGwKICAgICAgICAgICAgICAvLyB1c2UgdGhlIG9sZCBkZWZhdWx0IGJlaGF2aW9yIGZvciBhIGNsZWFuZXIgdXBncmFkZSBwYXRoIGFuZCBrZWVwIHRoZQogICAgICAgICAgICAgIC8vIHNpbXBsZSBzdHlsaW5nIHJ1bGVzIHdvcmtpbmcgYXMgdGhleSBjdXJyZW50bHkgZG8uCiAgICAgICAgICAgICAgY2xhc3NOYW1lID0gW2NsYXNzTmFtZVByb3AsIGlzQWN0aXZlID8gImFjdGl2ZSIgOiBudWxsLCBpc1BlbmRpbmcgPyAicGVuZGluZyIgOiBudWxsXS5maWx0ZXIoQm9vbGVhbikuam9pbigiICIpOwogICAgICAgICAgICB9CgogICAgICAgICAgICB2YXIgc3R5bGUgPSB0eXBlb2Ygc3R5bGVQcm9wID09PSAiZnVuY3Rpb24iID8gc3R5bGVQcm9wKHsKICAgICAgICAgICAgICBpc0FjdGl2ZTogaXNBY3RpdmUsCiAgICAgICAgICAgICAgaXNQZW5kaW5nOiBpc1BlbmRpbmcKICAgICAgICAgICAgfSkgOiBzdHlsZVByb3A7CiAgICAgICAgICAgIHJldHVybiAvKiNfX1BVUkVfXyovcmVhY3QuY3JlYXRlRWxlbWVudChMaW5rLCByZWFjdF9yb3V0ZXJfZG9tX2Rpc3RfZXh0ZW5kcyh7fSwgcmVzdCwgewogICAgICAgICAgICAgICJhcmlhLWN1cnJlbnQiOiBhcmlhQ3VycmVudCwKICAgICAgICAgICAgICBjbGFzc05hbWU6IGNsYXNzTmFtZSwKICAgICAgICAgICAgICByZWY6IHJlZiwKICAgICAgICAgICAgICBzdHlsZTogc3R5bGUsCiAgICAgICAgICAgICAgdG86IHRvCiAgICAgICAgICAgIH0pLCB0eXBlb2YgY2hpbGRyZW4gPT09ICJmdW5jdGlvbiIgPyBjaGlsZHJlbih7CiAgICAgICAgICAgICAgaXNBY3RpdmU6IGlzQWN0aXZlLAogICAgICAgICAgICAgIGlzUGVuZGluZzogaXNQZW5kaW5nCiAgICAgICAgICAgIH0pIDogY2hpbGRyZW4pOwogICAgICAgICAgfSk7CgogICAgICAgICAgaWYgKGZhbHNlKSB7fQogICAgICAgICAgLyoqCiAgICAgICAgICAgKiBBIGBAcmVtaXgtcnVuL3JvdXRlcmAtYXdhcmUgYDxmb3JtPmAuIEl0IGJlaGF2ZXMgbGlrZSBhIG5vcm1hbCBmb3JtIGV4Y2VwdAogICAgICAgICAgICogdGhhdCB0aGUgaW50ZXJhY3Rpb24gd2l0aCB0aGUgc2VydmVyIGlzIHdpdGggYGZldGNoYCBpbnN0ZWFkIG9mIG5ldyBkb2N1bWVudAogICAgICAgICAgICogcmVxdWVzdHMsIGFsbG93aW5nIGNvbXBvbmVudHMgdG8gYWRkIG5pY2VyIFVYIHRvIHRoZSBwYWdlIGFzIHRoZSBmb3JtIGlzCiAgICAgICAgICAgKiBzdWJtaXR0ZWQgYW5kIHJldHVybnMgd2l0aCBkYXRhLgogICAgICAgICAgICovCgoKICAgICAgICAgIHZhciBGb3JtID0gLyojX19QVVJFX18qLyAvKiB1bnVzZWQgcHVyZSBleHByZXNzaW9uIG9yIHN1cGVyICovbnVsbCAmJiBSZWFjdC5mb3J3YXJkUmVmKChwcm9wcywgcmVmKSA9PiB7CiAgICAgICAgICAgIHJldHVybiAvKiNfX1BVUkVfXyovUmVhY3QuY3JlYXRlRWxlbWVudChGb3JtSW1wbCwgcmVhY3Rfcm91dGVyX2RvbV9kaXN0X2V4dGVuZHMoe30sIHByb3BzLCB7CiAgICAgICAgICAgICAgcmVmOiByZWYKICAgICAgICAgICAgfSkpOwogICAgICAgICAgfSk7CgogICAgICAgICAgaWYgKGZhbHNlKSB7fQoKICAgICAgICAgIHZhciBGb3JtSW1wbCA9IC8qI19fUFVSRV9fKi8gLyogdW51c2VkIHB1cmUgZXhwcmVzc2lvbiBvciBzdXBlciAqL251bGwgJiYgUmVhY3QuZm9yd2FyZFJlZigoX3JlZjYsIGZvcndhcmRlZFJlZikgPT4gewogICAgICAgICAgICB2YXIKICAgICAgICAgICAgICByZWxvYWREb2N1bWVudCA9CgoKCgoKCgoKICAgICAgICAgICAgICBfcmVmNi5yZWxvYWREb2N1bWVudCxyZXBsYWNlID0gX3JlZjYucmVwbGFjZSxfcmVmNiRtZXRob2QgPSBfcmVmNi5tZXRob2QsbWV0aG9kID0gX3JlZjYkbWV0aG9kID09PSB2b2lkIDAgPyBkZWZhdWx0TWV0aG9kIDogX3JlZjYkbWV0aG9kLGFjdGlvbiA9IF9yZWY2LmFjdGlvbixvblN1Ym1pdCA9IF9yZWY2Lm9uU3VibWl0LGZldGNoZXJLZXkgPSBfcmVmNi5mZXRjaGVyS2V5LHJvdXRlSWQgPSBfcmVmNi5yb3V0ZUlkLHJlbGF0aXZlID0gX3JlZjYucmVsYXRpdmUscHJldmVudFNjcm9sbFJlc2V0ID0gX3JlZjYucHJldmVudFNjcm9sbFJlc2V0LAogICAgICAgICAgICAgIHByb3BzID0gX29iamVjdFdpdGhvdXRQcm9wZXJ0aWVzTG9vc2UoX3JlZjYsIF9leGNsdWRlZDMpOwoKICAgICAgICAgICAgdmFyIHN1Ym1pdCA9IHVzZVN1Ym1pdEltcGwoZmV0Y2hlcktleSwgcm91dGVJZCk7CiAgICAgICAgICAgIHZhciBmb3JtTWV0aG9kID0gbWV0aG9kLnRvTG93ZXJDYXNlKCkgPT09ICJnZXQiID8gImdldCIgOiAicG9zdCI7CiAgICAgICAgICAgIHZhciBmb3JtQWN0aW9uID0gdXNlRm9ybUFjdGlvbihhY3Rpb24sIHsKICAgICAgICAgICAgICByZWxhdGl2ZTogcmVsYXRpdmUKICAgICAgICAgICAgfSk7CgogICAgICAgICAgICB2YXIgc3VibWl0SGFuZGxlciA9IChldmVudCkgPT4gewogICAgICAgICAgICAgIG9uU3VibWl0ICYmIG9uU3VibWl0KGV2ZW50KTsKICAgICAgICAgICAgICBpZiAoZXZlbnQuZGVmYXVsdFByZXZlbnRlZCkgcmV0dXJuOwogICAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgICAgICAgdmFyIHN1Ym1pdHRlciA9IGV2ZW50Lm5hdGl2ZUV2ZW50LnN1Ym1pdHRlcjsKICAgICAgICAgICAgICB2YXIgc3VibWl0TWV0aG9kID0gKHN1Ym1pdHRlciA9PSBudWxsID8gdm9pZCAwIDogc3VibWl0dGVyLmdldEF0dHJpYnV0ZSgiZm9ybW1ldGhvZCIpKSB8fCBtZXRob2Q7CiAgICAgICAgICAgICAgc3VibWl0KHN1Ym1pdHRlciB8fCBldmVudC5jdXJyZW50VGFyZ2V0LCB7CiAgICAgICAgICAgICAgICBtZXRob2Q6IHN1Ym1pdE1ldGhvZCwKICAgICAgICAgICAgICAgIHJlcGxhY2U6IHJlcGxhY2UsCiAgICAgICAgICAgICAgICByZWxhdGl2ZTogcmVsYXRpdmUsCiAgICAgICAgICAgICAgICBwcmV2ZW50U2Nyb2xsUmVzZXQ6IHByZXZlbnRTY3JvbGxSZXNldAogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9OwoKICAgICAgICAgICAgcmV0dXJuIC8qI19fUFVSRV9fKi9SZWFjdC5jcmVhdGVFbGVtZW50KCJmb3JtIiwgcmVhY3Rfcm91dGVyX2RvbV9kaXN0X2V4dGVuZHMoewogICAgICAgICAgICAgIHJlZjogZm9yd2FyZGVkUmVmLAogICAgICAgICAgICAgIG1ldGhvZDogZm9ybU1ldGhvZCwKICAgICAgICAgICAgICBhY3Rpb246IGZvcm1BY3Rpb24sCiAgICAgICAgICAgICAgb25TdWJtaXQ6IHJlbG9hZERvY3VtZW50ID8gb25TdWJtaXQgOiBzdWJtaXRIYW5kbGVyCiAgICAgICAgICAgIH0sIHByb3BzKSk7CiAgICAgICAgICB9KTsKCiAgICAgICAgICBpZiAoZmFsc2UpIHt9CiAgICAgICAgICAvKioKICAgICAgICAgICAqIFRoaXMgY29tcG9uZW50IHdpbGwgZW11bGF0ZSB0aGUgYnJvd3NlcidzIHNjcm9sbCByZXN0b3JhdGlvbiBvbiBsb2NhdGlvbgogICAgICAgICAgICogY2hhbmdlcy4KICAgICAgICAgICAqLwoKCiAgICAgICAgICBmdW5jdGlvbiBTY3JvbGxSZXN0b3JhdGlvbihfcmVmNykgewogICAgICAgICAgICB2YXIKICAgICAgICAgICAgICBnZXRLZXkgPQoKICAgICAgICAgICAgICBfcmVmNy5nZXRLZXksc3RvcmFnZUtleSA9IF9yZWY3LnN0b3JhZ2VLZXk7CiAgICAgICAgICAgIHVzZVNjcm9sbFJlc3RvcmF0aW9uKHsKICAgICAgICAgICAgICBnZXRLZXk6IGdldEtleSwKICAgICAgICAgICAgICBzdG9yYWdlS2V5OiBzdG9yYWdlS2V5CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoZmFsc2UpIHt9IC8vI2VuZHJlZ2lvbgogICAgICAgICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KICAgICAgICAgIC8vI3JlZ2lvbiBIb29rcwogICAgICAgICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KCgogICAgICAgICAgdmFyIGRpc3RfRGF0YVJvdXRlckhvb2s7CgogICAgICAgICAgKGZ1bmN0aW9uIChEYXRhUm91dGVySG9vaykgewogICAgICAgICAgICBEYXRhUm91dGVySG9va1siVXNlU2Nyb2xsUmVzdG9yYXRpb24iXSA9ICJ1c2VTY3JvbGxSZXN0b3JhdGlvbiI7CiAgICAgICAgICAgIERhdGFSb3V0ZXJIb29rWyJVc2VTdWJtaXRJbXBsIl0gPSAidXNlU3VibWl0SW1wbCI7CiAgICAgICAgICAgIERhdGFSb3V0ZXJIb29rWyJVc2VGZXRjaGVyIl0gPSAidXNlRmV0Y2hlciI7CiAgICAgICAgICB9KShkaXN0X0RhdGFSb3V0ZXJIb29rIHx8IChkaXN0X0RhdGFSb3V0ZXJIb29rID0ge30pKTsKCiAgICAgICAgICB2YXIgZGlzdF9EYXRhUm91dGVyU3RhdGVIb29rOwoKICAgICAgICAgIChmdW5jdGlvbiAoRGF0YVJvdXRlclN0YXRlSG9vaykgewogICAgICAgICAgICBEYXRhUm91dGVyU3RhdGVIb29rWyJVc2VGZXRjaGVycyJdID0gInVzZUZldGNoZXJzIjsKICAgICAgICAgICAgRGF0YVJvdXRlclN0YXRlSG9va1siVXNlU2Nyb2xsUmVzdG9yYXRpb24iXSA9ICJ1c2VTY3JvbGxSZXN0b3JhdGlvbiI7CiAgICAgICAgICB9KShkaXN0X0RhdGFSb3V0ZXJTdGF0ZUhvb2sgfHwgKGRpc3RfRGF0YVJvdXRlclN0YXRlSG9vayA9IHt9KSk7CgogICAgICAgICAgZnVuY3Rpb24gZGlzdF9nZXREYXRhUm91dGVyQ29uc29sZUVycm9yKGhvb2tOYW1lKSB7CiAgICAgICAgICAgIHJldHVybiBob29rTmFtZSArICIgbXVzdCBiZSB1c2VkIHdpdGhpbiBhIGRhdGEgcm91dGVyLiAgU2VlIGh0dHBzOi8vcmVhY3Ryb3V0ZXIuY29tL3JvdXRlcnMvcGlja2luZy1hLXJvdXRlci4iOwogICAgICAgICAgfQoKICAgICAgICAgIGZ1bmN0aW9uIGRpc3RfdXNlRGF0YVJvdXRlckNvbnRleHQoaG9va05hbWUpIHsKICAgICAgICAgICAgdmFyIGN0eCA9IFJlYWN0LnVzZUNvbnRleHQoVU5TQUZFX0RhdGFSb3V0ZXJDb250ZXh0KTsKICAgICAgICAgICAgIWN0eCA/IGZhbHNlID8gMCA6IGludmFyaWFudChmYWxzZSkgOiB2b2lkIDA7CiAgICAgICAgICAgIHJldHVybiBjdHg7CiAgICAgICAgICB9CgogICAgICAgICAgZnVuY3Rpb24gZGlzdF91c2VEYXRhUm91dGVyU3RhdGUoaG9va05hbWUpIHsKICAgICAgICAgICAgdmFyIHN0YXRlID0gUmVhY3QudXNlQ29udGV4dChVTlNBRkVfRGF0YVJvdXRlclN0YXRlQ29udGV4dCk7CiAgICAgICAgICAgICFzdGF0ZSA/IGZhbHNlID8gMCA6IGludmFyaWFudChmYWxzZSkgOiB2b2lkIDA7CiAgICAgICAgICAgIHJldHVybiBzdGF0ZTsKICAgICAgICAgIH0KICAgICAgICAgIC8qKgogICAgICAgICAgICogSGFuZGxlcyB0aGUgY2xpY2sgYmVoYXZpb3IgZm9yIHJvdXRlciBgPExpbms+YCBjb21wb25lbnRzLiBUaGlzIGlzIHVzZWZ1bCBpZgogICAgICAgICAgICogeW91IG5lZWQgdG8gY3JlYXRlIGN1c3RvbSBgPExpbms+YCBjb21wb25lbnRzIHdpdGggdGhlIHNhbWUgY2xpY2sgYmVoYXZpb3Igd2UKICAgICAgICAgICAqIHVzZSBpbiBvdXIgZXhwb3J0ZWQgYDxMaW5rPmAuCiAgICAgICAgICAgKi8KCgogICAgICAgICAgZnVuY3Rpb24gdXNlTGlua0NsaWNrSGFuZGxlcih0bywgX3RlbXApIHsKICAgICAgICAgICAgdmFyIF9yZWYzMiA9CgoKCgoKICAgICAgICAgICAgICBfdGVtcCA9PT0gdm9pZCAwID8ge30gOiBfdGVtcCx0YXJnZXQgPSBfcmVmMzIudGFyZ2V0LHJlcGxhY2VQcm9wID0gX3JlZjMyLnJlcGxhY2Usc3RhdGUgPSBfcmVmMzIuc3RhdGUscHJldmVudFNjcm9sbFJlc2V0ID0gX3JlZjMyLnByZXZlbnRTY3JvbGxSZXNldCxyZWxhdGl2ZSA9IF9yZWYzMi5yZWxhdGl2ZTsKICAgICAgICAgICAgdmFyIG5hdmlnYXRlID0gZGlzdF91c2VOYXZpZ2F0ZSgpOwogICAgICAgICAgICB2YXIgbG9jYXRpb24gPSBkaXN0X3VzZUxvY2F0aW9uKCk7CiAgICAgICAgICAgIHZhciBwYXRoID0gZGlzdF91c2VSZXNvbHZlZFBhdGgodG8sIHsKICAgICAgICAgICAgICByZWxhdGl2ZTogcmVsYXRpdmUKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIHJldHVybiByZWFjdC51c2VDYWxsYmFjaygoZXZlbnQpID0+IHsKICAgICAgICAgICAgICBpZiAoc2hvdWxkUHJvY2Vzc0xpbmtDbGljayhldmVudCwgdGFyZ2V0KSkgewogICAgICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTsgLy8gSWYgdGhlIFVSTCBoYXNuJ3QgY2hhbmdlZCwgYSByZWd1bGFyIDxhPiB3aWxsIGRvIGEgcmVwbGFjZSBpbnN0ZWFkIG9mCiAgICAgICAgICAgICAgICAvLyBhIHB1c2gsIHNvIGRvIHRoZSBzYW1lIGhlcmUgdW5sZXNzIHRoZSByZXBsYWNlIHByb3AgaXMgZXhwbGljaXRseSBzZXQKCiAgICAgICAgICAgICAgICB2YXIgcmVwbGFjZSA9IHJlcGxhY2VQcm9wICE9PSB1bmRlZmluZWQgPyByZXBsYWNlUHJvcCA6IHJvdXRlcl9jcmVhdGVQYXRoKGxvY2F0aW9uKSA9PT0gcm91dGVyX2NyZWF0ZVBhdGgocGF0aCk7CiAgICAgICAgICAgICAgICBuYXZpZ2F0ZSh0bywgewogICAgICAgICAgICAgICAgICByZXBsYWNlOiByZXBsYWNlLAogICAgICAgICAgICAgICAgICBzdGF0ZTogc3RhdGUsCiAgICAgICAgICAgICAgICAgIHByZXZlbnRTY3JvbGxSZXNldDogcHJldmVudFNjcm9sbFJlc2V0LAogICAgICAgICAgICAgICAgICByZWxhdGl2ZTogcmVsYXRpdmUKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwgW2xvY2F0aW9uLCBuYXZpZ2F0ZSwgcGF0aCwgcmVwbGFjZVByb3AsIHN0YXRlLCB0YXJnZXQsIHRvLCBwcmV2ZW50U2Nyb2xsUmVzZXQsIHJlbGF0aXZlXSk7CiAgICAgICAgICB9CiAgICAgICAgICAvKioKICAgICAgICAgICAqIEEgY29udmVuaWVudCB3cmFwcGVyIGZvciByZWFkaW5nIGFuZCB3cml0aW5nIHNlYXJjaCBwYXJhbWV0ZXJzIHZpYSB0aGUKICAgICAgICAgICAqIFVSTFNlYXJjaFBhcmFtcyBpbnRlcmZhY2UuCiAgICAgICAgICAgKi8KCiAgICAgICAgICBmdW5jdGlvbiB1c2VTZWFyY2hQYXJhbXMoZGVmYXVsdEluaXQpIHsKICAgICAgICAgICAgZmFsc2UgPyAwIDogdm9pZCAwOwogICAgICAgICAgICB2YXIgZGVmYXVsdFNlYXJjaFBhcmFtc1JlZiA9IFJlYWN0LnVzZVJlZihjcmVhdGVTZWFyY2hQYXJhbXMoZGVmYXVsdEluaXQpKTsKICAgICAgICAgICAgdmFyIGxvY2F0aW9uID0gdXNlTG9jYXRpb24oKTsKICAgICAgICAgICAgdmFyIHNlYXJjaFBhcmFtcyA9IFJlYWN0LnVzZU1lbW8oKCkgPT4gZ2V0U2VhcmNoUGFyYW1zRm9yTG9jYXRpb24obG9jYXRpb24uc2VhcmNoLCBkZWZhdWx0U2VhcmNoUGFyYW1zUmVmLmN1cnJlbnQpLCBbbG9jYXRpb24uc2VhcmNoXSk7CiAgICAgICAgICAgIHZhciBuYXZpZ2F0ZSA9IHVzZU5hdmlnYXRlKCk7CiAgICAgICAgICAgIHZhciBzZXRTZWFyY2hQYXJhbXMgPSBSZWFjdC51c2VDYWxsYmFjaygobmV4dEluaXQsIG5hdmlnYXRlT3B0aW9ucykgPT4gewogICAgICAgICAgICAgIHZhciBuZXdTZWFyY2hQYXJhbXMgPSBjcmVhdGVTZWFyY2hQYXJhbXModHlwZW9mIG5leHRJbml0ID09PSAiZnVuY3Rpb24iID8gbmV4dEluaXQoc2VhcmNoUGFyYW1zKSA6IG5leHRJbml0KTsKICAgICAgICAgICAgICBuYXZpZ2F0ZSgiPyIgKyBuZXdTZWFyY2hQYXJhbXMsIG5hdmlnYXRlT3B0aW9ucyk7CiAgICAgICAgICAgIH0sIFtuYXZpZ2F0ZSwgc2VhcmNoUGFyYW1zXSk7CiAgICAgICAgICAgIHJldHVybiBbc2VhcmNoUGFyYW1zLCBzZXRTZWFyY2hQYXJhbXNdOwogICAgICAgICAgfQogICAgICAgICAgLyoqCiAgICAgICAgICAgKiBSZXR1cm5zIGEgZnVuY3Rpb24gdGhhdCBtYXkgYmUgdXNlZCB0byBwcm9ncmFtbWF0aWNhbGx5IHN1Ym1pdCBhIGZvcm0gKG9yCiAgICAgICAgICAgKiBzb21lIGFyYml0cmFyeSBkYXRhKSB0byB0aGUgc2VydmVyLgogICAgICAgICAgICovCgogICAgICAgICAgZnVuY3Rpb24gdXNlU3VibWl0KCkgewogICAgICAgICAgICByZXR1cm4gdXNlU3VibWl0SW1wbCgpOwogICAgICAgICAgfQoKICAgICAgICAgIGZ1bmN0aW9uIHVzZVN1Ym1pdEltcGwoZmV0Y2hlcktleSwgcm91dGVJZCkgewogICAgICAgICAgICB2YXIgX2Rpc3RfdXNlRGF0YVJvdXRlckNvID0KCiAgICAgICAgICAgICAgZGlzdF91c2VEYXRhUm91dGVyQ29udGV4dChkaXN0X0RhdGFSb3V0ZXJIb29rLlVzZVN1Ym1pdEltcGwpLHJvdXRlciA9IF9kaXN0X3VzZURhdGFSb3V0ZXJDby5yb3V0ZXI7CiAgICAgICAgICAgIHZhciBkZWZhdWx0QWN0aW9uID0gdXNlRm9ybUFjdGlvbigpOwogICAgICAgICAgICByZXR1cm4gUmVhY3QudXNlQ2FsbGJhY2soZnVuY3Rpb24gKHRhcmdldCwgb3B0aW9ucykgewogICAgICAgICAgICAgIGlmIChvcHRpb25zID09PSB2b2lkIDApIHsKICAgICAgICAgICAgICAgIG9wdGlvbnMgPSB7fTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIGlmICh0eXBlb2YgZG9jdW1lbnQgPT09ICJ1bmRlZmluZWQiKSB7CiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIllvdSBhcmUgY2FsbGluZyBzdWJtaXQgZHVyaW5nIHRoZSBzZXJ2ZXIgcmVuZGVyLiAiICsgIlRyeSBjYWxsaW5nIHN1Ym1pdCB3aXRoaW4gYSBgdXNlRWZmZWN0YCBvciBjYWxsYmFjayBpbnN0ZWFkLiIpOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgdmFyIF9nZXRGb3JtU3VibWlzc2lvbkluZiA9CgoKCgogICAgICAgICAgICAgICAgZ2V0Rm9ybVN1Ym1pc3Npb25JbmZvKHRhcmdldCwgZGVmYXVsdEFjdGlvbiwgb3B0aW9ucyksbWV0aG9kID0gX2dldEZvcm1TdWJtaXNzaW9uSW5mLm1ldGhvZCxlbmNUeXBlID0gX2dldEZvcm1TdWJtaXNzaW9uSW5mLmVuY1R5cGUsZm9ybURhdGEgPSBfZ2V0Rm9ybVN1Ym1pc3Npb25JbmYuZm9ybURhdGEsdXJsID0gX2dldEZvcm1TdWJtaXNzaW9uSW5mLnVybDsKICAgICAgICAgICAgICB2YXIgaHJlZiA9IHVybC5wYXRobmFtZSArIHVybC5zZWFyY2g7CiAgICAgICAgICAgICAgdmFyIG9wdHMgPSB7CiAgICAgICAgICAgICAgICByZXBsYWNlOiBvcHRpb25zLnJlcGxhY2UsCiAgICAgICAgICAgICAgICBwcmV2ZW50U2Nyb2xsUmVzZXQ6IG9wdGlvbnMucHJldmVudFNjcm9sbFJlc2V0LAogICAgICAgICAgICAgICAgZm9ybURhdGE6IGZvcm1EYXRhLAogICAgICAgICAgICAgICAgZm9ybU1ldGhvZDogbWV0aG9kLAogICAgICAgICAgICAgICAgZm9ybUVuY1R5cGU6IGVuY1R5cGUKICAgICAgICAgICAgICB9OwoKICAgICAgICAgICAgICBpZiAoZmV0Y2hlcktleSkgewogICAgICAgICAgICAgICAgIShyb3V0ZUlkICE9IG51bGwpID8gZmFsc2UgPyAwIDogaW52YXJpYW50KGZhbHNlKSA6IHZvaWQgMDsKICAgICAgICAgICAgICAgIHJvdXRlci5mZXRjaChmZXRjaGVyS2V5LCByb3V0ZUlkLCBocmVmLCBvcHRzKTsKICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgcm91dGVyLm5hdmlnYXRlKGhyZWYsIG9wdHMpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwgW2RlZmF1bHRBY3Rpb24sIHJvdXRlciwgZmV0Y2hlcktleSwgcm91dGVJZF0pOwogICAgICAgICAgfQoKICAgICAgICAgIGZ1bmN0aW9uIHVzZUZvcm1BY3Rpb24oYWN0aW9uLCBfdGVtcDIpIHsKICAgICAgICAgICAgdmFyIF9yZWYzMyA9CgogICAgICAgICAgICAgIF90ZW1wMiA9PT0gdm9pZCAwID8ge30gOiBfdGVtcDIscmVsYXRpdmUgPSBfcmVmMzMucmVsYXRpdmU7CiAgICAgICAgICAgIHZhciBfUmVhY3QkdXNlQ29udGV4dDIgPQoKICAgICAgICAgICAgICBSZWFjdC51c2VDb250ZXh0KFVOU0FGRV9OYXZpZ2F0aW9uQ29udGV4dCksYmFzZW5hbWUgPSBfUmVhY3QkdXNlQ29udGV4dDIuYmFzZW5hbWU7CiAgICAgICAgICAgIHZhciByb3V0ZUNvbnRleHQgPSBSZWFjdC51c2VDb250ZXh0KFVOU0FGRV9Sb3V0ZUNvbnRleHQpOwogICAgICAgICAgICAhcm91dGVDb250ZXh0ID8gZmFsc2UgPyAwIDogaW52YXJpYW50KGZhbHNlKSA6IHZvaWQgMDsKICAgICAgICAgICAgdmFyIF9yb3V0ZUNvbnRleHQkbWF0Y2hlcyA9IHJvdXRlQ29udGV4dC5tYXRjaGVzLnNsaWNlKC0xKSxfcm91dGVDb250ZXh0JG1hdGNoZXMyID0gX3NsaWNlZFRvQXJyYXkyKF9yb3V0ZUNvbnRleHQkbWF0Y2hlcywgMSksbWF0Y2ggPSBfcm91dGVDb250ZXh0JG1hdGNoZXMyWzBdOyAvLyBTaGFsbG93IGNsb25lIHBhdGggc28gd2UgY2FuIG1vZGlmeSBpdCBiZWxvdywgb3RoZXJ3aXNlIHdlIG1vZGlmeSB0aGUKICAgICAgICAgICAgLy8gb2JqZWN0IHJlZmVyZW5jZWQgYnkgdXNlTWVtbyBpbnNpZGUgdXNlUmVzb2x2ZWRQYXRoCgogICAgICAgICAgICB2YXIgcGF0aCA9IHJlYWN0X3JvdXRlcl9kb21fZGlzdF9leHRlbmRzKHt9LCB1c2VSZXNvbHZlZFBhdGgoYWN0aW9uID8gYWN0aW9uIDogIi4iLCB7CiAgICAgICAgICAgICAgcmVsYXRpdmU6IHJlbGF0aXZlCiAgICAgICAgICAgIH0pKTsgLy8gUHJldmlvdXNseSB3ZSBzZXQgdGhlIGRlZmF1bHQgYWN0aW9uIHRvICIuIi4gVGhlIHByb2JsZW0gd2l0aCB0aGlzIGlzIHRoYXQKICAgICAgICAgICAgLy8gYHVzZVJlc29sdmVkUGF0aCgiLiIpYCBleGNsdWRlcyBzZWFyY2ggcGFyYW1zIGFuZCB0aGUgaGFzaCBvZiB0aGUgcmVzb2x2ZWQKICAgICAgICAgICAgLy8gVVJMLiBUaGlzIGlzIHRoZSBpbnRlbmRlZCBiZWhhdmlvciBvZiB3aGVuICIuIiBpcyBzcGVjaWZpY2FsbHkgcHJvdmlkZWQgYXMKICAgICAgICAgICAgLy8gdGhlIGZvcm0gYWN0aW9uLCBidXQgaW5jb25zaXN0ZW50IHcvIGJyb3dzZXJzIHdoZW4gdGhlIGFjdGlvbiBpcyBvbWl0dGVkLgogICAgICAgICAgICAvLyBodHRwczovL2dpdGh1Yi5jb20vcmVtaXgtcnVuL3JlbWl4L2lzc3Vlcy85MjcKCgogICAgICAgICAgICB2YXIgbG9jYXRpb24gPSB1c2VMb2NhdGlvbigpOwoKICAgICAgICAgICAgaWYgKGFjdGlvbiA9PSBudWxsKSB7CiAgICAgICAgICAgICAgLy8gU2FmZSB0byB3cml0ZSB0byB0aGVzZSBkaXJlY3RseSBoZXJlIHNpbmNlIGlmIGFjdGlvbiB3YXMgdW5kZWZpbmVkLCB3ZQogICAgICAgICAgICAgIC8vIHdvdWxkIGhhdmUgY2FsbGVkIHVzZVJlc29sdmVkUGF0aCgiLiIpIHdoaWNoIHdpbGwgbmV2ZXIgaW5jbHVkZSBhIHNlYXJjaAogICAgICAgICAgICAgIC8vIG9yIGhhc2gKICAgICAgICAgICAgICBwYXRoLnNlYXJjaCA9IGxvY2F0aW9uLnNlYXJjaDsKICAgICAgICAgICAgICBwYXRoLmhhc2ggPSBsb2NhdGlvbi5oYXNoOyAvLyBXaGVuIGdyYWJiaW5nIHNlYXJjaCBwYXJhbXMgZnJvbSB0aGUgVVJMLCByZW1vdmUgdGhlIGF1dG9tYXRpY2FsbHkKICAgICAgICAgICAgICAvLyBpbnNlcnRlZCA/aW5kZXggcGFyYW0gc28gd2UgbWF0Y2ggdGhlIHVzZVJlc29sdmVkUGF0aCBzZWFyY2ggYmVoYXZpb3IKICAgICAgICAgICAgICAvLyB3aGljaCB3b3VsZCBub3QgaW5jbHVkZSA/aW5kZXgKCiAgICAgICAgICAgICAgaWYgKG1hdGNoLnJvdXRlLmluZGV4KSB7CiAgICAgICAgICAgICAgICB2YXIgcGFyYW1zID0gbmV3IFVSTFNlYXJjaFBhcmFtcyhwYXRoLnNlYXJjaCk7CiAgICAgICAgICAgICAgICBwYXJhbXMuZGVsZXRlKCJpbmRleCIpOwogICAgICAgICAgICAgICAgcGF0aC5zZWFyY2ggPSBwYXJhbXMudG9TdHJpbmcoKSA/ICI/IiArIHBhcmFtcy50b1N0cmluZygpIDogIiI7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoKCFhY3Rpb24gfHwgYWN0aW9uID09PSAiLiIpICYmIG1hdGNoLnJvdXRlLmluZGV4KSB7CiAgICAgICAgICAgICAgcGF0aC5zZWFyY2ggPSBwYXRoLnNlYXJjaCA/IHBhdGguc2VhcmNoLnJlcGxhY2UoL15cPy8sICI/aW5kZXgmIikgOiAiP2luZGV4IjsKICAgICAgICAgICAgfSAvLyBJZiB3ZSdyZSBvcGVyYXRpbmcgd2l0aGluIGEgYmFzZW5hbWUsIHByZXBlbmQgaXQgdG8gdGhlIHBhdGhuYW1lIHByaW9yCiAgICAgICAgICAgIC8vIHRvIGNyZWF0aW5nIHRoZSBmb3JtIGFjdGlvbi4gIElmIHRoaXMgaXMgYSByb290IG5hdmlnYXRpb24sIHRoZW4ganVzdCB1c2UKICAgICAgICAgICAgLy8gdGhlIHJhdyBiYXNlbmFtZSB3aGljaCBhbGxvd3MgdGhlIGJhc2VuYW1lIHRvIGhhdmUgZnVsbCBjb250cm9sIG92ZXIgdGhlCiAgICAgICAgICAgIC8vIHByZXNlbmNlIG9mIGEgdHJhaWxpbmcgc2xhc2ggb24gcm9vdCBhY3Rpb25zCgoKICAgICAgICAgICAgaWYgKGJhc2VuYW1lICE9PSAiLyIpIHsKICAgICAgICAgICAgICBwYXRoLnBhdGhuYW1lID0gcGF0aC5wYXRobmFtZSA9PT0gIi8iID8gYmFzZW5hbWUgOiBqb2luUGF0aHMoW2Jhc2VuYW1lLCBwYXRoLnBhdGhuYW1lXSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybiBjcmVhdGVQYXRoKHBhdGgpOwogICAgICAgICAgfQoKICAgICAgICAgIGZ1bmN0aW9uIGNyZWF0ZUZldGNoZXJGb3JtKGZldGNoZXJLZXksIHJvdXRlSWQpIHsKICAgICAgICAgICAgdmFyIEZldGNoZXJGb3JtID0gLyojX19QVVJFX18qL1JlYWN0LmZvcndhcmRSZWYoKHByb3BzLCByZWYpID0+IHsKICAgICAgICAgICAgICByZXR1cm4gLyojX19QVVJFX18qL1JlYWN0LmNyZWF0ZUVsZW1lbnQoRm9ybUltcGwsIHJlYWN0X3JvdXRlcl9kb21fZGlzdF9leHRlbmRzKHt9LCBwcm9wcywgewogICAgICAgICAgICAgICAgcmVmOiByZWYsCiAgICAgICAgICAgICAgICBmZXRjaGVyS2V5OiBmZXRjaGVyS2V5LAogICAgICAgICAgICAgICAgcm91dGVJZDogcm91dGVJZAogICAgICAgICAgICAgIH0pKTsKICAgICAgICAgICAgfSk7CgogICAgICAgICAgICBpZiAoZmFsc2UpIHt9CgogICAgICAgICAgICByZXR1cm4gRmV0Y2hlckZvcm07CiAgICAgICAgICB9CgogICAgICAgICAgdmFyIGZldGNoZXJJZCA9IDA7CiAgICAgICAgICAvKioKICAgICAgICAgICAqIEludGVyYWN0cyB3aXRoIHJvdXRlIGxvYWRlcnMgYW5kIGFjdGlvbnMgd2l0aG91dCBjYXVzaW5nIGEgbmF2aWdhdGlvbi4gR3JlYXQKICAgICAgICAgICAqIGZvciBhbnkgaW50ZXJhY3Rpb24gdGhhdCBzdGF5cyBvbiB0aGUgc2FtZSBwYWdlLgogICAgICAgICAgICovCgogICAgICAgICAgZnVuY3Rpb24gdXNlRmV0Y2hlcigpIHsKICAgICAgICAgICAgdmFyIF9yb3V0ZSRtYXRjaGVzOwoKICAgICAgICAgICAgdmFyIF9kaXN0X3VzZURhdGFSb3V0ZXJDbzIgPQoKICAgICAgICAgICAgICBkaXN0X3VzZURhdGFSb3V0ZXJDb250ZXh0KGRpc3RfRGF0YVJvdXRlckhvb2suVXNlRmV0Y2hlcikscm91dGVyID0gX2Rpc3RfdXNlRGF0YVJvdXRlckNvMi5yb3V0ZXI7CiAgICAgICAgICAgIHZhciByb3V0ZSA9IFJlYWN0LnVzZUNvbnRleHQoVU5TQUZFX1JvdXRlQ29udGV4dCk7CiAgICAgICAgICAgICFyb3V0ZSA/IGZhbHNlID8gMCA6IGludmFyaWFudChmYWxzZSkgOiB2b2lkIDA7CiAgICAgICAgICAgIHZhciByb3V0ZUlkID0gKF9yb3V0ZSRtYXRjaGVzID0gcm91dGUubWF0Y2hlc1tyb3V0ZS5tYXRjaGVzLmxlbmd0aCAtIDFdKSA9PSBudWxsID8gdm9pZCAwIDogX3JvdXRlJG1hdGNoZXMucm91dGUuaWQ7CiAgICAgICAgICAgICEocm91dGVJZCAhPSBudWxsKSA/IGZhbHNlID8gMCA6IGludmFyaWFudChmYWxzZSkgOiB2b2lkIDA7CiAgICAgICAgICAgIHZhciBfUmVhY3QkdXNlU3RhdGU5ID0gUmVhY3QudXNlU3RhdGUoKCkgPT4gU3RyaW5nKCsrZmV0Y2hlcklkKSksX1JlYWN0JHVzZVN0YXRlMTAgPSBfc2xpY2VkVG9BcnJheTIoX1JlYWN0JHVzZVN0YXRlOSwgMSksZmV0Y2hlcktleSA9IF9SZWFjdCR1c2VTdGF0ZTEwWzBdOwogICAgICAgICAgICB2YXIgX1JlYWN0JHVzZVN0YXRlMTEgPSBSZWFjdC51c2VTdGF0ZSgoKSA9PiB7CiAgICAgICAgICAgICAgICAhcm91dGVJZCA/IGZhbHNlID8gMCA6IGludmFyaWFudChmYWxzZSkgOiB2b2lkIDA7CiAgICAgICAgICAgICAgICByZXR1cm4gY3JlYXRlRmV0Y2hlckZvcm0oZmV0Y2hlcktleSwgcm91dGVJZCk7CiAgICAgICAgICAgICAgfSksX1JlYWN0JHVzZVN0YXRlMTIgPSBfc2xpY2VkVG9BcnJheTIoX1JlYWN0JHVzZVN0YXRlMTEsIDEpLEZvcm0gPSBfUmVhY3QkdXNlU3RhdGUxMlswXTsKICAgICAgICAgICAgdmFyIF9SZWFjdCR1c2VTdGF0ZTEzID0gUmVhY3QudXNlU3RhdGUoKCkgPT4gKGhyZWYpID0+IHsKICAgICAgICAgICAgICAgICFyb3V0ZXIgPyBmYWxzZSA/IDAgOiBpbnZhcmlhbnQoZmFsc2UpIDogdm9pZCAwOwogICAgICAgICAgICAgICAgIXJvdXRlSWQgPyBmYWxzZSA/IDAgOiBpbnZhcmlhbnQoZmFsc2UpIDogdm9pZCAwOwogICAgICAgICAgICAgICAgcm91dGVyLmZldGNoKGZldGNoZXJLZXksIHJvdXRlSWQsIGhyZWYpOwogICAgICAgICAgICAgIH0pLF9SZWFjdCR1c2VTdGF0ZTE0ID0gX3NsaWNlZFRvQXJyYXkyKF9SZWFjdCR1c2VTdGF0ZTEzLCAxKSxsb2FkID0gX1JlYWN0JHVzZVN0YXRlMTRbMF07CiAgICAgICAgICAgIHZhciBzdWJtaXQgPSB1c2VTdWJtaXRJbXBsKGZldGNoZXJLZXksIHJvdXRlSWQpOwogICAgICAgICAgICB2YXIgZmV0Y2hlciA9IHJvdXRlci5nZXRGZXRjaGVyKGZldGNoZXJLZXkpOwogICAgICAgICAgICB2YXIgZmV0Y2hlcldpdGhDb21wb25lbnRzID0gUmVhY3QudXNlTWVtbygoKSA9PiByZWFjdF9yb3V0ZXJfZG9tX2Rpc3RfZXh0ZW5kcyh7CiAgICAgICAgICAgICAgRm9ybTogRm9ybSwKICAgICAgICAgICAgICBzdWJtaXQ6IHN1Ym1pdCwKICAgICAgICAgICAgICBsb2FkOiBsb2FkCiAgICAgICAgICAgIH0sIGZldGNoZXIpLCBbZmV0Y2hlciwgRm9ybSwgc3VibWl0LCBsb2FkXSk7CiAgICAgICAgICAgIFJlYWN0LnVzZUVmZmVjdCgoKSA9PiB7CiAgICAgICAgICAgICAgLy8gSXMgdGhpcyBidXN0ZWQgd2hlbiB0aGUgUmVhY3QgdGVhbSBnZXRzIHJlYWwgd2VpcmQgYW5kIGNhbGxzIGVmZmVjdHMKICAgICAgICAgICAgICAvLyB0d2ljZSBvbiBtb3VudD8gIFdlIHJlYWxseSBqdXN0IG5lZWQgdG8gZ2FyYmFnZSBjb2xsZWN0IGhlcmUgd2hlbiB0aGlzCiAgICAgICAgICAgICAgLy8gZmV0Y2hlciBpcyBubyBsb25nZXIgYXJvdW5kLgogICAgICAgICAgICAgIHJldHVybiAoKSA9PiB7CiAgICAgICAgICAgICAgICBpZiAoIXJvdXRlcikgewogICAgICAgICAgICAgICAgICBjb25zb2xlLndhcm4oIk5vIGZldGNoZXIgYXZhaWxhYmxlIHRvIGNsZWFuIHVwIGZyb20gdXNlRmV0Y2hlcigpIik7CiAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICByb3V0ZXIuZGVsZXRlRmV0Y2hlcihmZXRjaGVyS2V5KTsKICAgICAgICAgICAgICB9OwogICAgICAgICAgICB9LCBbcm91dGVyLCBmZXRjaGVyS2V5XSk7CiAgICAgICAgICAgIHJldHVybiBmZXRjaGVyV2l0aENvbXBvbmVudHM7CiAgICAgICAgICB9CiAgICAgICAgICAvKioKICAgICAgICAgICAqIFByb3ZpZGVzIGFsbCBmZXRjaGVycyBjdXJyZW50bHkgb24gdGhlIHBhZ2UuIFVzZWZ1bCBmb3IgbGF5b3V0cyBhbmQgcGFyZW50CiAgICAgICAgICAgKiByb3V0ZXMgdGhhdCBuZWVkIHRvIHByb3ZpZGUgcGVuZGluZy9vcHRpbWlzdGljIFVJIHJlZ2FyZGluZyB0aGUgZmV0Y2guCiAgICAgICAgICAgKi8KCiAgICAgICAgICBmdW5jdGlvbiB1c2VGZXRjaGVycygpIHsKICAgICAgICAgICAgdmFyIHN0YXRlID0gZGlzdF91c2VEYXRhUm91dGVyU3RhdGUoZGlzdF9EYXRhUm91dGVyU3RhdGVIb29rLlVzZUZldGNoZXJzKTsKICAgICAgICAgICAgcmV0dXJuIF90b0NvbnN1bWFibGVBcnJheTIoc3RhdGUuZmV0Y2hlcnMudmFsdWVzKCkpOwogICAgICAgICAgfQogICAgICAgICAgdmFyIFNDUk9MTF9SRVNUT1JBVElPTl9TVE9SQUdFX0tFWSA9ICJyZWFjdC1yb3V0ZXItc2Nyb2xsLXBvc2l0aW9ucyI7CiAgICAgICAgICB2YXIgc2F2ZWRTY3JvbGxQb3NpdGlvbnMgPSB7fTsKICAgICAgICAgIC8qKgogICAgICAgICAgICogV2hlbiByZW5kZXJlZCBpbnNpZGUgYSBSb3V0ZXJQcm92aWRlciwgd2lsbCByZXN0b3JlIHNjcm9sbCBwb3NpdGlvbnMgb24gbmF2aWdhdGlvbnMKICAgICAgICAgICAqLwoKICAgICAgICAgIGZ1bmN0aW9uIHVzZVNjcm9sbFJlc3RvcmF0aW9uKF90ZW1wMykgewogICAgICAgICAgICB2YXIgX3JlZjM0ID0KCgogICAgICAgICAgICAgIF90ZW1wMyA9PT0gdm9pZCAwID8ge30gOiBfdGVtcDMsZ2V0S2V5ID0gX3JlZjM0LmdldEtleSxzdG9yYWdlS2V5ID0gX3JlZjM0LnN0b3JhZ2VLZXk7CiAgICAgICAgICAgIHZhciBfZGlzdF91c2VEYXRhUm91dGVyQ28zID0KCiAgICAgICAgICAgICAgZGlzdF91c2VEYXRhUm91dGVyQ29udGV4dChkaXN0X0RhdGFSb3V0ZXJIb29rLlVzZVNjcm9sbFJlc3RvcmF0aW9uKSxyb3V0ZXIgPSBfZGlzdF91c2VEYXRhUm91dGVyQ28zLnJvdXRlcjsKICAgICAgICAgICAgdmFyIF9kaXN0X3VzZURhdGFSb3V0ZXJTdCA9CgoKICAgICAgICAgICAgICBkaXN0X3VzZURhdGFSb3V0ZXJTdGF0ZShkaXN0X0RhdGFSb3V0ZXJTdGF0ZUhvb2suVXNlU2Nyb2xsUmVzdG9yYXRpb24pLHJlc3RvcmVTY3JvbGxQb3NpdGlvbiA9IF9kaXN0X3VzZURhdGFSb3V0ZXJTdC5yZXN0b3JlU2Nyb2xsUG9zaXRpb24scHJldmVudFNjcm9sbFJlc2V0ID0gX2Rpc3RfdXNlRGF0YVJvdXRlclN0LnByZXZlbnRTY3JvbGxSZXNldDsKICAgICAgICAgICAgdmFyIGxvY2F0aW9uID0gdXNlTG9jYXRpb24oKTsKICAgICAgICAgICAgdmFyIG1hdGNoZXMgPSB1c2VNYXRjaGVzKCk7CiAgICAgICAgICAgIHZhciBuYXZpZ2F0aW9uID0gdXNlTmF2aWdhdGlvbigpOyAvLyBUcmlnZ2VyIG1hbnVhbCBzY3JvbGwgcmVzdG9yYXRpb24gd2hpbGUgd2UncmUgYWN0aXZlCgogICAgICAgICAgICBSZWFjdC51c2VFZmZlY3QoKCkgPT4gewogICAgICAgICAgICAgIHdpbmRvdy5oaXN0b3J5LnNjcm9sbFJlc3RvcmF0aW9uID0gIm1hbnVhbCI7CiAgICAgICAgICAgICAgcmV0dXJuICgpID0+IHsKICAgICAgICAgICAgICAgIHdpbmRvdy5oaXN0b3J5LnNjcm9sbFJlc3RvcmF0aW9uID0gImF1dG8iOwogICAgICAgICAgICAgIH07CiAgICAgICAgICAgIH0sIFtdKTsgLy8gU2F2ZSBwb3NpdGlvbnMgb24gdW5sb2FkCgogICAgICAgICAgICB1c2VCZWZvcmVVbmxvYWQoUmVhY3QudXNlQ2FsbGJhY2soKCkgPT4gewogICAgICAgICAgICAgIGlmIChuYXZpZ2F0aW9uLnN0YXRlID09PSAiaWRsZSIpIHsKICAgICAgICAgICAgICAgIHZhciBrZXkgPSAoZ2V0S2V5ID8gZ2V0S2V5KGxvY2F0aW9uLCBtYXRjaGVzKSA6IG51bGwpIHx8IGxvY2F0aW9uLmtleTsKICAgICAgICAgICAgICAgIHNhdmVkU2Nyb2xsUG9zaXRpb25zW2tleV0gPSB3aW5kb3cuc2Nyb2xsWTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIHNlc3Npb25TdG9yYWdlLnNldEl0ZW0oc3RvcmFnZUtleSB8fCBTQ1JPTExfUkVTVE9SQVRJT05fU1RPUkFHRV9LRVksIEpTT04uc3RyaW5naWZ5KHNhdmVkU2Nyb2xsUG9zaXRpb25zKSk7CiAgICAgICAgICAgICAgd2luZG93Lmhpc3Rvcnkuc2Nyb2xsUmVzdG9yYXRpb24gPSAiYXV0byI7CiAgICAgICAgICAgIH0sIFtzdG9yYWdlS2V5LCBnZXRLZXksIG5hdmlnYXRpb24uc3RhdGUsIGxvY2F0aW9uLCBtYXRjaGVzXSkpOyAvLyBSZWFkIGluIGFueSBzYXZlZCBzY3JvbGwgbG9jYXRpb25zCgogICAgICAgICAgICBpZiAodHlwZW9mIGRvY3VtZW50ICE9PSAidW5kZWZpbmVkIikgewogICAgICAgICAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSByZWFjdC1ob29rcy9ydWxlcy1vZi1ob29rcwogICAgICAgICAgICAgIFJlYWN0LnVzZUxheW91dEVmZmVjdCgoKSA9PiB7CiAgICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgICB2YXIgc2Vzc2lvblBvc2l0aW9ucyA9IHNlc3Npb25TdG9yYWdlLmdldEl0ZW0oc3RvcmFnZUtleSB8fCBTQ1JPTExfUkVTVE9SQVRJT05fU1RPUkFHRV9LRVkpOwoKICAgICAgICAgICAgICAgICAgaWYgKHNlc3Npb25Qb3NpdGlvbnMpIHsKICAgICAgICAgICAgICAgICAgICBzYXZlZFNjcm9sbFBvc2l0aW9ucyA9IEpTT04ucGFyc2Uoc2Vzc2lvblBvc2l0aW9ucyk7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICAgICAgICAgICAgLy8gbm8tb3AsIHVzZSBkZWZhdWx0IGVtcHR5IG9iamVjdAogICAgICAgICAgICAgICAgfX0sIFtzdG9yYWdlS2V5XSk7IC8vIEVuYWJsZSBzY3JvbGwgcmVzdG9yYXRpb24gaW4gdGhlIHJvdXRlcgogICAgICAgICAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSByZWFjdC1ob29rcy9ydWxlcy1vZi1ob29rcwoKICAgICAgICAgICAgICBSZWFjdC51c2VMYXlvdXRFZmZlY3QoKCkgPT4gewogICAgICAgICAgICAgICAgdmFyIGRpc2FibGVTY3JvbGxSZXN0b3JhdGlvbiA9IHJvdXRlciA9PSBudWxsID8gdm9pZCAwIDogcm91dGVyLmVuYWJsZVNjcm9sbFJlc3RvcmF0aW9uKHNhdmVkU2Nyb2xsUG9zaXRpb25zLCAoKSA9PiB3aW5kb3cuc2Nyb2xsWSwgZ2V0S2V5KTsKICAgICAgICAgICAgICAgIHJldHVybiAoKSA9PiBkaXNhYmxlU2Nyb2xsUmVzdG9yYXRpb24gJiYgZGlzYWJsZVNjcm9sbFJlc3RvcmF0aW9uKCk7CiAgICAgICAgICAgICAgfSwgW3JvdXRlciwgZ2V0S2V5XSk7IC8vIFJlc3RvcmUgc2Nyb2xsaW5nIHdoZW4gc3RhdGUucmVzdG9yZVNjcm9sbFBvc2l0aW9uIGNoYW5nZXMKICAgICAgICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgcmVhY3QtaG9va3MvcnVsZXMtb2YtaG9va3MKCiAgICAgICAgICAgICAgUmVhY3QudXNlTGF5b3V0RWZmZWN0KCgpID0+IHsKICAgICAgICAgICAgICAgIC8vIEV4cGxpY2l0IGZhbHNlIG1lYW5zIGRvbid0IGRvIGFueXRoaW5nICh1c2VkIGZvciBzdWJtaXNzaW9ucykKICAgICAgICAgICAgICAgIGlmIChyZXN0b3JlU2Nyb2xsUG9zaXRpb24gPT09IGZhbHNlKSB7CiAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgIH0gLy8gYmVlbiBoZXJlIGJlZm9yZSwgc2Nyb2xsIHRvIGl0CgoKICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgcmVzdG9yZVNjcm9sbFBvc2l0aW9uID09PSAibnVtYmVyIikgewogICAgICAgICAgICAgICAgICB3aW5kb3cuc2Nyb2xsVG8oMCwgcmVzdG9yZVNjcm9sbFBvc2l0aW9uKTsKICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgfSAvLyB0cnkgdG8gc2Nyb2xsIHRvIHRoZSBoYXNoCgoKICAgICAgICAgICAgICAgIGlmIChsb2NhdGlvbi5oYXNoKSB7CiAgICAgICAgICAgICAgICAgIHZhciBlbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGxvY2F0aW9uLmhhc2guc2xpY2UoMSkpOwoKICAgICAgICAgICAgICAgICAgaWYgKGVsKSB7CiAgICAgICAgICAgICAgICAgICAgZWwuc2Nyb2xsSW50b1ZpZXcoKTsKICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0gLy8gRG9uJ3QgcmVzZXQgaWYgdGhpcyBuYXZpZ2F0aW9uIG9wdGVkIG91dAoKCiAgICAgICAgICAgICAgICBpZiAocHJldmVudFNjcm9sbFJlc2V0ID09PSB0cnVlKSB7CiAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgIH0gLy8gb3RoZXJ3aXNlIGdvIHRvIHRoZSB0b3Agb24gbmV3IGxvY2F0aW9ucwoKCiAgICAgICAgICAgICAgICB3aW5kb3cuc2Nyb2xsVG8oMCwgMCk7CiAgICAgICAgICAgICAgfSwgW2xvY2F0aW9uLCByZXN0b3JlU2Nyb2xsUG9zaXRpb24sIHByZXZlbnRTY3JvbGxSZXNldF0pOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICAvKioKICAgICAgICAgICAqIFNldHVwIGEgY2FsbGJhY2sgdG8gYmUgZmlyZWQgb24gdGhlIHdpbmRvdydzIGBiZWZvcmV1bmxvYWRgIGV2ZW50LiBUaGlzIGlzCiAgICAgICAgICAgKiB1c2VmdWwgZm9yIHNhdmluZyBzb21lIGRhdGEgdG8gYHdpbmRvdy5sb2NhbFN0b3JhZ2VgIGp1c3QgYmVmb3JlIHRoZSBwYWdlCiAgICAgICAgICAgKiByZWZyZXNoZXMuCiAgICAgICAgICAgKgogICAgICAgICAgICogTm90ZTogVGhlIGBjYWxsYmFja2AgYXJndW1lbnQgc2hvdWxkIGJlIGEgZnVuY3Rpb24gY3JlYXRlZCB3aXRoCiAgICAgICAgICAgKiBgUmVhY3QudXNlQ2FsbGJhY2soKWAuCiAgICAgICAgICAgKi8KCgogICAgICAgICAgZnVuY3Rpb24gdXNlQmVmb3JlVW5sb2FkKGNhbGxiYWNrLCBvcHRpb25zKSB7CiAgICAgICAgICAgIHZhciBfcmVmMzUgPQoKICAgICAgICAgICAgICBvcHRpb25zIHx8IHt9LGNhcHR1cmUgPSBfcmVmMzUuY2FwdHVyZTsKICAgICAgICAgICAgUmVhY3QudXNlRWZmZWN0KCgpID0+IHsKICAgICAgICAgICAgICB2YXIgb3B0cyA9IGNhcHR1cmUgIT0gbnVsbCA/IHsKICAgICAgICAgICAgICAgIGNhcHR1cmU6IGNhcHR1cmUKICAgICAgICAgICAgICB9IDogdW5kZWZpbmVkOwogICAgICAgICAgICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCJiZWZvcmV1bmxvYWQiLCBjYWxsYmFjaywgb3B0cyk7CiAgICAgICAgICAgICAgcmV0dXJuICgpID0+IHsKICAgICAgICAgICAgICAgIHdpbmRvdy5yZW1vdmVFdmVudExpc3RlbmVyKCJiZWZvcmV1bmxvYWQiLCBjYWxsYmFjaywgb3B0cyk7CiAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgfSwgW2NhbGxiYWNrLCBjYXB0dXJlXSk7CiAgICAgICAgICB9CiAgICAgICAgICAvKioKICAgICAgICAgICAqIFdyYXBwZXIgYXJvdW5kIHVzZUJsb2NrZXIgdG8gc2hvdyBhIHdpbmRvdy5jb25maXJtIHByb21wdCB0byB1c2VycyBpbnN0ZWFkCiAgICAgICAgICAgKiBvZiBidWlsZGluZyBhIGN1c3RvbSBVSSB3aXRoIHVzZUJsb2NrZXIuCiAgICAgICAgICAgKgogICAgICAgICAgICogV2FybmluZzogVGhpcyBoYXMgKmEgbG90IG9mIHJvdWdoIGVkZ2VzKiBhbmQgYmVoYXZlcyB2ZXJ5IGRpZmZlcmVudGx5IChhbmQKICAgICAgICAgICAqIHZlcnkgaW5jb3JyZWN0bHkgaW4gc29tZSBjYXNlcykgYWNyb3NzIGJyb3dzZXJzIGlmIHVzZXIgY2xpY2sgYWRkaXRpb24KICAgICAgICAgICAqIGJhY2svZm9yd2FyZCBuYXZpZ2F0aW9ucyB3aGlsZSB0aGUgY29uZmlybSBpcyBvcGVuLiAgVXNlIGF0IHlvdXIgb3duIHJpc2suCiAgICAgICAgICAgKi8KCiAgICAgICAgICBmdW5jdGlvbiB1c2VQcm9tcHQoX3JlZjgpIHsKICAgICAgICAgICAgdmFyCiAgICAgICAgICAgICAgd2hlbiA9CgogICAgICAgICAgICAgIF9yZWY4LndoZW4sbWVzc2FnZSA9IF9yZWY4Lm1lc3NhZ2U7CiAgICAgICAgICAgIHZhciBibG9ja2VyID0gdW5zdGFibGVfdXNlQmxvY2tlcih3aGVuKTsKICAgICAgICAgICAgUmVhY3QudXNlRWZmZWN0KCgpID0+IHsKICAgICAgICAgICAgICBpZiAoYmxvY2tlci5zdGF0ZSA9PT0gImJsb2NrZWQiICYmICF3aGVuKSB7CiAgICAgICAgICAgICAgICBibG9ja2VyLnJlc2V0KCk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LCBbYmxvY2tlciwgd2hlbl0pOwogICAgICAgICAgICBSZWFjdC51c2VFZmZlY3QoKCkgPT4gewogICAgICAgICAgICAgIGlmIChibG9ja2VyLnN0YXRlID09PSAiYmxvY2tlZCIpIHsKICAgICAgICAgICAgICAgIHZhciBwcm9jZWVkID0gd2luZG93LmNvbmZpcm0obWVzc2FnZSk7CgogICAgICAgICAgICAgICAgaWYgKHByb2NlZWQpIHsKICAgICAgICAgICAgICAgICAgc2V0VGltZW91dChibG9ja2VyLnByb2NlZWQsIDApOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgYmxvY2tlci5yZXNldCgpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwgW2Jsb2NrZXIsIG1lc3NhZ2VdKTsKICAgICAgICAgIH0KICAgICAgICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCiAgICAgICAgICAvLyNyZWdpb24gVXRpbHMKICAgICAgICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCgogICAgICAgICAgZnVuY3Rpb24gZGlzdF93YXJuaW5nKGNvbmQsIG1lc3NhZ2UpIHsKICAgICAgICAgICAgaWYgKCFjb25kKSB7CiAgICAgICAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG5vLWNvbnNvbGUKICAgICAgICAgICAgICBpZiAodHlwZW9mIGNvbnNvbGUgIT09ICJ1bmRlZmluZWQiKSBjb25zb2xlLndhcm4obWVzc2FnZSk7CgogICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAvLyBXZWxjb21lIHRvIGRlYnVnZ2luZyBSZWFjdCBSb3V0ZXIhCiAgICAgICAgICAgICAgICAvLwogICAgICAgICAgICAgICAgLy8gVGhpcyBlcnJvciBpcyB0aHJvd24gYXMgYSBjb252ZW5pZW5jZSBzbyB5b3UgY2FuIG1vcmUgZWFzaWx5CiAgICAgICAgICAgICAgICAvLyBmaW5kIHRoZSBzb3VyY2UgZm9yIGEgd2FybmluZyB0aGF0IGFwcGVhcnMgaW4gdGhlIGNvbnNvbGUgYnkKICAgICAgICAgICAgICAgIC8vIGVuYWJsaW5nICJwYXVzZSBvbiBleGNlcHRpb25zIiBpbiB5b3VyIEphdmFTY3JpcHQgZGVidWdnZXIuCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IobWVzc2FnZSk7IC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBuby1lbXB0eQogICAgICAgICAgICAgIH0gY2F0Y2ggKGUpIHt9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0gLy8jZW5kcmVnaW9uCgoKCgogICAgICAgICAgOyAvLyBDT05DQVRFTkFURUQgTU9EVUxFOiAuL3NyYy9yZWxheS9jb21wb25lbnRzL0xheW91dC50c3gKCgoKCiAgICAgICAgICB2YXIgTGF5b3V0ID0gZnVuY3Rpb24gTGF5b3V0KF9yZWYpIHt2YXIgcGFnZXMgPSBfcmVmLnBhZ2VzOwogICAgICAgICAgICB2YXIgb3V0bGV0ID0gLyojX19QVVJFX18qLwogICAgICAgICAgICByZWFjdC5jcmVhdGVFbGVtZW50KHJlYWN0LkZyYWdtZW50LCBudWxsLCAvKiNfX1BVUkVfXyovCiAgICAgICAgICAgIHJlYWN0LmNyZWF0ZUVsZW1lbnQoImRpdiIsIHsgaWQ6ICJub3RpZmljYXRpb25zQ29udGFpbmVyIiB9KSwgLyojX19QVVJFX18qLwogICAgICAgICAgICByZWFjdC5jcmVhdGVFbGVtZW50KCJkaXYiLCB7IGlkOiAicmVsYXlDb250YWluZXIiIH0sIC8qI19fUFVSRV9fKi8KICAgICAgICAgICAgcmVhY3QuY3JlYXRlRWxlbWVudChPdXRsZXQsIG51bGwpKSk7CgoKCgogICAgICAgICAgICBpZiAocGFnZXMubGVuZ3RoIDw9IDEpIHsKICAgICAgICAgICAgICByZXR1cm4gb3V0bGV0OwogICAgICAgICAgICB9CgogICAgICAgICAgICByZXR1cm4gLyojX19QVVJFX18qLygKICAgICAgICAgICAgICByZWFjdC5jcmVhdGVFbGVtZW50KHJlYWN0LkZyYWdtZW50LCBudWxsLAogICAgICAgICAgICAgICIgIiwgLyojX19QVVJFX18qLwogICAgICAgICAgICAgIHJlYWN0LmNyZWF0ZUVsZW1lbnQoIm5hdiIsIG51bGwsIC8qI19fUFVSRV9fKi8KICAgICAgICAgICAgICByZWFjdC5jcmVhdGVFbGVtZW50KCJkaXYiLCB7IGNsYXNzTmFtZTogInRvcEJhciIgfSwKICAgICAgICAgICAgICAiICIsCiAgICAgICAgICAgICAgcGFnZXMubWFwKGZ1bmN0aW9uIChwKSB7cmV0dXJuIC8qI19fUFVSRV9fKi8oCiAgICAgICAgICAgICAgICAgIHJlYWN0LmNyZWF0ZUVsZW1lbnQoImRpdiIsIHsga2V5OiAiIi5jb25jYXQocC5maWxlLCAiICIpLmNvbmNhdChwLnBhZ2UpLCBjbGFzc05hbWU6ICJ0YWJFbnRyeSIgfSwgLyojX19QVVJFX18qLwogICAgICAgICAgICAgICAgICByZWFjdC5jcmVhdGVFbGVtZW50KE5hdkxpbmssIHsgdG86ICIvIiArIHAuZmlsZSB9LCBwLnBhZ2UpLCAiICIpKTt9KSkpLAoKCgogICAgICAgICAgICAgICIgIiwKICAgICAgICAgICAgICBvdXRsZXQpKTsKCgogICAgICAgICAgfTsKCiAgICAgICAgICAvKiBoYXJtb255IGRlZmF1bHQgZXhwb3J0ICovdmFyIGNvbXBvbmVudHNfTGF5b3V0ID0gTGF5b3V0OwogICAgICAgICAgOyAvLyBDT05DQVRFTkFURUQgTU9EVUxFOiAuL3NyYy9yZWxheS9hcGkvQXBpUmVxdWVzdC50c3gKICAgICAgICAgIGZ1bmN0aW9uIF90eXBlb2Yob2JqKSB7IkBiYWJlbC9oZWxwZXJzIC0gdHlwZW9mIjtyZXR1cm4gX3R5cGVvZiA9ICJmdW5jdGlvbiIgPT0gdHlwZW9mIFN5bWJvbCAmJiAic3ltYm9sIiA9PSB0eXBlb2YgU3ltYm9sLml0ZXJhdG9yID8gZnVuY3Rpb24gKG9iaikge3JldHVybiB0eXBlb2Ygb2JqO30gOiBmdW5jdGlvbiAob2JqKSB7cmV0dXJuIG9iaiAmJiAiZnVuY3Rpb24iID09IHR5cGVvZiBTeW1ib2wgJiYgb2JqLmNvbnN0cnVjdG9yID09PSBTeW1ib2wgJiYgb2JqICE9PSBTeW1ib2wucHJvdG90eXBlID8gInN5bWJvbCIgOiB0eXBlb2Ygb2JqO30sIF90eXBlb2Yob2JqKTt9ZnVuY3Rpb24gX3JlZ2VuZXJhdG9yUnVudGltZSgpIHsidXNlIHN0cmljdCI7CiAgICAgICAgICAgIC8qISByZWdlbmVyYXRvci1ydW50aW1lIC0tIENvcHlyaWdodCAoYykgMjAxNC1wcmVzZW50LCBGYWNlYm9vaywgSW5jLiAtLSBsaWNlbnNlIChNSVQpOiBodHRwczovL2dpdGh1Yi5jb20vZmFjZWJvb2svcmVnZW5lcmF0b3IvYmxvYi9tYWluL0xJQ0VOU0UgKi9fcmVnZW5lcmF0b3JSdW50aW1lID0gZnVuY3Rpb24gX3JlZ2VuZXJhdG9yUnVudGltZSgpIHtyZXR1cm4gZXhwb3J0czt9O3ZhciBleHBvcnRzID0ge30sT3AgPSBPYmplY3QucHJvdG90eXBlLGhhc093biA9IE9wLmhhc093blByb3BlcnR5LGRlZmluZVByb3BlcnR5ID0gT2JqZWN0LmRlZmluZVByb3BlcnR5IHx8IGZ1bmN0aW9uIChvYmosIGtleSwgZGVzYykge29ialtrZXldID0gZGVzYy52YWx1ZTt9LCRTeW1ib2wgPSAiZnVuY3Rpb24iID09IHR5cGVvZiBTeW1ib2wgPyBTeW1ib2wgOiB7fSxpdGVyYXRvclN5bWJvbCA9ICRTeW1ib2wuaXRlcmF0b3IgfHwgIkBAaXRlcmF0b3IiLGFzeW5jSXRlcmF0b3JTeW1ib2wgPSAkU3ltYm9sLmFzeW5jSXRlcmF0b3IgfHwgIkBAYXN5bmNJdGVyYXRvciIsdG9TdHJpbmdUYWdTeW1ib2wgPSAkU3ltYm9sLnRvU3RyaW5nVGFnIHx8ICJAQHRvU3RyaW5nVGFnIjtmdW5jdGlvbiBkZWZpbmUob2JqLCBrZXksIHZhbHVlKSB7cmV0dXJuIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvYmosIGtleSwgeyB2YWx1ZTogdmFsdWUsIGVudW1lcmFibGU6ICEwLCBjb25maWd1cmFibGU6ICEwLCB3cml0YWJsZTogITAgfSksIG9ialtrZXldO310cnkge2RlZmluZSh7fSwgIiIpO30gY2F0Y2ggKGVycikge2RlZmluZSA9IGZ1bmN0aW9uIGRlZmluZShvYmosIGtleSwgdmFsdWUpIHtyZXR1cm4gb2JqW2tleV0gPSB2YWx1ZTt9O31mdW5jdGlvbiB3cmFwKGlubmVyRm4sIG91dGVyRm4sIHNlbGYsIHRyeUxvY3NMaXN0KSB7dmFyIHByb3RvR2VuZXJhdG9yID0gb3V0ZXJGbiAmJiBvdXRlckZuLnByb3RvdHlwZSBpbnN0YW5jZW9mIEdlbmVyYXRvciA/IG91dGVyRm4gOiBHZW5lcmF0b3IsZ2VuZXJhdG9yID0gT2JqZWN0LmNyZWF0ZShwcm90b0dlbmVyYXRvci5wcm90b3R5cGUpLGNvbnRleHQgPSBuZXcgQ29udGV4dCh0cnlMb2NzTGlzdCB8fCBbXSk7cmV0dXJuIGRlZmluZVByb3BlcnR5KGdlbmVyYXRvciwgIl9pbnZva2UiLCB7IHZhbHVlOiBtYWtlSW52b2tlTWV0aG9kKGlubmVyRm4sIHNlbGYsIGNvbnRleHQpIH0pLCBnZW5lcmF0b3I7fWZ1bmN0aW9uIHRyeUNhdGNoKGZuLCBvYmosIGFyZykge3RyeSB7cmV0dXJuIHsgdHlwZTogIm5vcm1hbCIsIGFyZzogZm4uY2FsbChvYmosIGFyZykgfTt9IGNhdGNoIChlcnIpIHtyZXR1cm4geyB0eXBlOiAidGhyb3ciLCBhcmc6IGVyciB9O319ZXhwb3J0cy53cmFwID0gd3JhcDt2YXIgQ29udGludWVTZW50aW5lbCA9IHt9O2Z1bmN0aW9uIEdlbmVyYXRvcigpIHt9ZnVuY3Rpb24gR2VuZXJhdG9yRnVuY3Rpb24oKSB7fWZ1bmN0aW9uIEdlbmVyYXRvckZ1bmN0aW9uUHJvdG90eXBlKCkge312YXIgSXRlcmF0b3JQcm90b3R5cGUgPSB7fTtkZWZpbmUoSXRlcmF0b3JQcm90b3R5cGUsIGl0ZXJhdG9yU3ltYm9sLCBmdW5jdGlvbiAoKSB7cmV0dXJuIHRoaXM7fSk7dmFyIGdldFByb3RvID0gT2JqZWN0LmdldFByb3RvdHlwZU9mLE5hdGl2ZUl0ZXJhdG9yUHJvdG90eXBlID0gZ2V0UHJvdG8gJiYgZ2V0UHJvdG8oZ2V0UHJvdG8odmFsdWVzKFtdKSkpO05hdGl2ZUl0ZXJhdG9yUHJvdG90eXBlICYmIE5hdGl2ZUl0ZXJhdG9yUHJvdG90eXBlICE9PSBPcCAmJiBoYXNPd24uY2FsbChOYXRpdmVJdGVyYXRvclByb3RvdHlwZSwgaXRlcmF0b3JTeW1ib2wpICYmIChJdGVyYXRvclByb3RvdHlwZSA9IE5hdGl2ZUl0ZXJhdG9yUHJvdG90eXBlKTt2YXIgR3AgPSBHZW5lcmF0b3JGdW5jdGlvblByb3RvdHlwZS5wcm90b3R5cGUgPSBHZW5lcmF0b3IucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZShJdGVyYXRvclByb3RvdHlwZSk7ZnVuY3Rpb24gZGVmaW5lSXRlcmF0b3JNZXRob2RzKHByb3RvdHlwZSkge1sibmV4dCIsICJ0aHJvdyIsICJyZXR1cm4iXS5mb3JFYWNoKGZ1bmN0aW9uIChtZXRob2QpIHtkZWZpbmUocHJvdG90eXBlLCBtZXRob2QsIGZ1bmN0aW9uIChhcmcpIHtyZXR1cm4gdGhpcy5faW52b2tlKG1ldGhvZCwgYXJnKTt9KTt9KTt9ZnVuY3Rpb24gQXN5bmNJdGVyYXRvcihnZW5lcmF0b3IsIFByb21pc2VJbXBsKSB7ZnVuY3Rpb24gaW52b2tlKG1ldGhvZCwgYXJnLCByZXNvbHZlLCByZWplY3QpIHt2YXIgcmVjb3JkID0gdHJ5Q2F0Y2goZ2VuZXJhdG9yW21ldGhvZF0sIGdlbmVyYXRvciwgYXJnKTtpZiAoInRocm93IiAhPT0gcmVjb3JkLnR5cGUpIHt2YXIgcmVzdWx0ID0gcmVjb3JkLmFyZyx2YWx1ZSA9IHJlc3VsdC52YWx1ZTtyZXR1cm4gdmFsdWUgJiYgIm9iamVjdCIgPT0gX3R5cGVvZih2YWx1ZSkgJiYgaGFzT3duLmNhbGwodmFsdWUsICJfX2F3YWl0IikgPyBQcm9taXNlSW1wbC5yZXNvbHZlKHZhbHVlLl9fYXdhaXQpLnRoZW4oZnVuY3Rpb24gKHZhbHVlKSB7aW52b2tlKCJuZXh0IiwgdmFsdWUsIHJlc29sdmUsIHJlamVjdCk7fSwgZnVuY3Rpb24gKGVycikge2ludm9rZSgidGhyb3ciLCBlcnIsIHJlc29sdmUsIHJlamVjdCk7fSkgOiBQcm9taXNlSW1wbC5yZXNvbHZlKHZhbHVlKS50aGVuKGZ1bmN0aW9uICh1bndyYXBwZWQpIHtyZXN1bHQudmFsdWUgPSB1bndyYXBwZWQsIHJlc29sdmUocmVzdWx0KTt9LCBmdW5jdGlvbiAoZXJyb3IpIHtyZXR1cm4gaW52b2tlKCJ0aHJvdyIsIGVycm9yLCByZXNvbHZlLCByZWplY3QpO30pO31yZWplY3QocmVjb3JkLmFyZyk7fXZhciBwcmV2aW91c1Byb21pc2U7ZGVmaW5lUHJvcGVydHkodGhpcywgIl9pbnZva2UiLCB7IHZhbHVlOiBmdW5jdGlvbiB2YWx1ZShtZXRob2QsIGFyZykge2Z1bmN0aW9uIGNhbGxJbnZva2VXaXRoTWV0aG9kQW5kQXJnKCkge3JldHVybiBuZXcgUHJvbWlzZUltcGwoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge2ludm9rZShtZXRob2QsIGFyZywgcmVzb2x2ZSwgcmVqZWN0KTt9KTt9cmV0dXJuIHByZXZpb3VzUHJvbWlzZSA9IHByZXZpb3VzUHJvbWlzZSA/IHByZXZpb3VzUHJvbWlzZS50aGVuKGNhbGxJbnZva2VXaXRoTWV0aG9kQW5kQXJnLCBjYWxsSW52b2tlV2l0aE1ldGhvZEFuZEFyZykgOiBjYWxsSW52b2tlV2l0aE1ldGhvZEFuZEFyZygpO30gfSk7fWZ1bmN0aW9uIG1ha2VJbnZva2VNZXRob2QoaW5uZXJGbiwgc2VsZiwgY29udGV4dCkge3ZhciBzdGF0ZSA9ICJzdXNwZW5kZWRTdGFydCI7cmV0dXJuIGZ1bmN0aW9uIChtZXRob2QsIGFyZykge2lmICgiZXhlY3V0aW5nIiA9PT0gc3RhdGUpIHRocm93IG5ldyBFcnJvcigiR2VuZXJhdG9yIGlzIGFscmVhZHkgcnVubmluZyIpO2lmICgiY29tcGxldGVkIiA9PT0gc3RhdGUpIHtpZiAoInRocm93IiA9PT0gbWV0aG9kKSB0aHJvdyBhcmc7cmV0dXJuIGRvbmVSZXN1bHQoKTt9Zm9yIChjb250ZXh0Lm1ldGhvZCA9IG1ldGhvZCwgY29udGV4dC5hcmcgPSBhcmc7Oykge3ZhciBkZWxlZ2F0ZSA9IGNvbnRleHQuZGVsZWdhdGU7aWYgKGRlbGVnYXRlKSB7dmFyIGRlbGVnYXRlUmVzdWx0ID0gbWF5YmVJbnZva2VEZWxlZ2F0ZShkZWxlZ2F0ZSwgY29udGV4dCk7aWYgKGRlbGVnYXRlUmVzdWx0KSB7aWYgKGRlbGVnYXRlUmVzdWx0ID09PSBDb250aW51ZVNlbnRpbmVsKSBjb250aW51ZTtyZXR1cm4gZGVsZWdhdGVSZXN1bHQ7fX1pZiAoIm5leHQiID09PSBjb250ZXh0Lm1ldGhvZCkgY29udGV4dC5zZW50ID0gY29udGV4dC5fc2VudCA9IGNvbnRleHQuYXJnO2Vsc2UgaWYgKCJ0aHJvdyIgPT09IGNvbnRleHQubWV0aG9kKSB7aWYgKCJzdXNwZW5kZWRTdGFydCIgPT09IHN0YXRlKSB0aHJvdyBzdGF0ZSA9ICJjb21wbGV0ZWQiLCBjb250ZXh0LmFyZztjb250ZXh0LmRpc3BhdGNoRXhjZXB0aW9uKGNvbnRleHQuYXJnKTt9IGVsc2UgInJldHVybiIgPT09IGNvbnRleHQubWV0aG9kICYmIGNvbnRleHQuYWJydXB0KCJyZXR1cm4iLCBjb250ZXh0LmFyZyk7c3RhdGUgPSAiZXhlY3V0aW5nIjt2YXIgcmVjb3JkID0gdHJ5Q2F0Y2goaW5uZXJGbiwgc2VsZiwgY29udGV4dCk7aWYgKCJub3JtYWwiID09PSByZWNvcmQudHlwZSkge2lmIChzdGF0ZSA9IGNvbnRleHQuZG9uZSA/ICJjb21wbGV0ZWQiIDogInN1c3BlbmRlZFlpZWxkIiwgcmVjb3JkLmFyZyA9PT0gQ29udGludWVTZW50aW5lbCkgY29udGludWU7cmV0dXJuIHsgdmFsdWU6IHJlY29yZC5hcmcsIGRvbmU6IGNvbnRleHQuZG9uZSB9O30idGhyb3ciID09PSByZWNvcmQudHlwZSAmJiAoc3RhdGUgPSAiY29tcGxldGVkIiwgY29udGV4dC5tZXRob2QgPSAidGhyb3ciLCBjb250ZXh0LmFyZyA9IHJlY29yZC5hcmcpO319O31mdW5jdGlvbiBtYXliZUludm9rZURlbGVnYXRlKGRlbGVnYXRlLCBjb250ZXh0KSB7dmFyIG1ldGhvZE5hbWUgPSBjb250ZXh0Lm1ldGhvZCxtZXRob2QgPSBkZWxlZ2F0ZS5pdGVyYXRvclttZXRob2ROYW1lXTtpZiAodW5kZWZpbmVkID09PSBtZXRob2QpIHJldHVybiBjb250ZXh0LmRlbGVnYXRlID0gbnVsbCwgInRocm93IiA9PT0gbWV0aG9kTmFtZSAmJiBkZWxlZ2F0ZS5pdGVyYXRvclsicmV0dXJuIl0gJiYgKGNvbnRleHQubWV0aG9kID0gInJldHVybiIsIGNvbnRleHQuYXJnID0gdW5kZWZpbmVkLCBtYXliZUludm9rZURlbGVnYXRlKGRlbGVnYXRlLCBjb250ZXh0KSwgInRocm93IiA9PT0gY29udGV4dC5tZXRob2QpIHx8ICJyZXR1cm4iICE9PSBtZXRob2ROYW1lICYmIChjb250ZXh0Lm1ldGhvZCA9ICJ0aHJvdyIsIGNvbnRleHQuYXJnID0gbmV3IFR5cGVFcnJvcigiVGhlIGl0ZXJhdG9yIGRvZXMgbm90IHByb3ZpZGUgYSAnIiArIG1ldGhvZE5hbWUgKyAiJyBtZXRob2QiKSksIENvbnRpbnVlU2VudGluZWw7dmFyIHJlY29yZCA9IHRyeUNhdGNoKG1ldGhvZCwgZGVsZWdhdGUuaXRlcmF0b3IsIGNvbnRleHQuYXJnKTtpZiAoInRocm93IiA9PT0gcmVjb3JkLnR5cGUpIHJldHVybiBjb250ZXh0Lm1ldGhvZCA9ICJ0aHJvdyIsIGNvbnRleHQuYXJnID0gcmVjb3JkLmFyZywgY29udGV4dC5kZWxlZ2F0ZSA9IG51bGwsIENvbnRpbnVlU2VudGluZWw7dmFyIGluZm8gPSByZWNvcmQuYXJnO3JldHVybiBpbmZvID8gaW5mby5kb25lID8gKGNvbnRleHRbZGVsZWdhdGUucmVzdWx0TmFtZV0gPSBpbmZvLnZhbHVlLCBjb250ZXh0Lm5leHQgPSBkZWxlZ2F0ZS5uZXh0TG9jLCAicmV0dXJuIiAhPT0gY29udGV4dC5tZXRob2QgJiYgKGNvbnRleHQubWV0aG9kID0gIm5leHQiLCBjb250ZXh0LmFyZyA9IHVuZGVmaW5lZCksIGNvbnRleHQuZGVsZWdhdGUgPSBudWxsLCBDb250aW51ZVNlbnRpbmVsKSA6IGluZm8gOiAoY29udGV4dC5tZXRob2QgPSAidGhyb3ciLCBjb250ZXh0LmFyZyA9IG5ldyBUeXBlRXJyb3IoIml0ZXJhdG9yIHJlc3VsdCBpcyBub3QgYW4gb2JqZWN0IiksIGNvbnRleHQuZGVsZWdhdGUgPSBudWxsLCBDb250aW51ZVNlbnRpbmVsKTt9ZnVuY3Rpb24gcHVzaFRyeUVudHJ5KGxvY3MpIHt2YXIgZW50cnkgPSB7IHRyeUxvYzogbG9jc1swXSB9OzEgaW4gbG9jcyAmJiAoZW50cnkuY2F0Y2hMb2MgPSBsb2NzWzFdKSwgMiBpbiBsb2NzICYmIChlbnRyeS5maW5hbGx5TG9jID0gbG9jc1syXSwgZW50cnkuYWZ0ZXJMb2MgPSBsb2NzWzNdKSwgdGhpcy50cnlFbnRyaWVzLnB1c2goZW50cnkpO31mdW5jdGlvbiByZXNldFRyeUVudHJ5KGVudHJ5KSB7dmFyIHJlY29yZCA9IGVudHJ5LmNvbXBsZXRpb24gfHwge307cmVjb3JkLnR5cGUgPSAibm9ybWFsIiwgZGVsZXRlIHJlY29yZC5hcmcsIGVudHJ5LmNvbXBsZXRpb24gPSByZWNvcmQ7fWZ1bmN0aW9uIENvbnRleHQodHJ5TG9jc0xpc3QpIHt0aGlzLnRyeUVudHJpZXMgPSBbeyB0cnlMb2M6ICJyb290IiB9XSwgdHJ5TG9jc0xpc3QuZm9yRWFjaChwdXNoVHJ5RW50cnksIHRoaXMpLCB0aGlzLnJlc2V0KCEwKTt9ZnVuY3Rpb24gdmFsdWVzKGl0ZXJhYmxlKSB7aWYgKGl0ZXJhYmxlKSB7dmFyIGl0ZXJhdG9yTWV0aG9kID0gaXRlcmFibGVbaXRlcmF0b3JTeW1ib2xdO2lmIChpdGVyYXRvck1ldGhvZCkgcmV0dXJuIGl0ZXJhdG9yTWV0aG9kLmNhbGwoaXRlcmFibGUpO2lmICgiZnVuY3Rpb24iID09IHR5cGVvZiBpdGVyYWJsZS5uZXh0KSByZXR1cm4gaXRlcmFibGU7aWYgKCFpc05hTihpdGVyYWJsZS5sZW5ndGgpKSB7dmFyIGkgPSAtMSxuZXh0ID0gZnVuY3Rpb24gbmV4dCgpIHtmb3IgKDsgKytpIDwgaXRlcmFibGUubGVuZ3RoOykgaWYgKGhhc093bi5jYWxsKGl0ZXJhYmxlLCBpKSkgcmV0dXJuIG5leHQudmFsdWUgPSBpdGVyYWJsZVtpXSwgbmV4dC5kb25lID0gITEsIG5leHQ7cmV0dXJuIG5leHQudmFsdWUgPSB1bmRlZmluZWQsIG5leHQuZG9uZSA9ICEwLCBuZXh0O307cmV0dXJuIG5leHQubmV4dCA9IG5leHQ7fX1yZXR1cm4geyBuZXh0OiBkb25lUmVzdWx0IH07fWZ1bmN0aW9uIGRvbmVSZXN1bHQoKSB7cmV0dXJuIHsgdmFsdWU6IHVuZGVmaW5lZCwgZG9uZTogITAgfTt9cmV0dXJuIEdlbmVyYXRvckZ1bmN0aW9uLnByb3RvdHlwZSA9IEdlbmVyYXRvckZ1bmN0aW9uUHJvdG90eXBlLCBkZWZpbmVQcm9wZXJ0eShHcCwgImNvbnN0cnVjdG9yIiwgeyB2YWx1ZTogR2VuZXJhdG9yRnVuY3Rpb25Qcm90b3R5cGUsIGNvbmZpZ3VyYWJsZTogITAgfSksIGRlZmluZVByb3BlcnR5KEdlbmVyYXRvckZ1bmN0aW9uUHJvdG90eXBlLCAiY29uc3RydWN0b3IiLCB7IHZhbHVlOiBHZW5lcmF0b3JGdW5jdGlvbiwgY29uZmlndXJhYmxlOiAhMCB9KSwgR2VuZXJhdG9yRnVuY3Rpb24uZGlzcGxheU5hbWUgPSBkZWZpbmUoR2VuZXJhdG9yRnVuY3Rpb25Qcm90b3R5cGUsIHRvU3RyaW5nVGFnU3ltYm9sLCAiR2VuZXJhdG9yRnVuY3Rpb24iKSwgZXhwb3J0cy5pc0dlbmVyYXRvckZ1bmN0aW9uID0gZnVuY3Rpb24gKGdlbkZ1bikge3ZhciBjdG9yID0gImZ1bmN0aW9uIiA9PSB0eXBlb2YgZ2VuRnVuICYmIGdlbkZ1bi5jb25zdHJ1Y3RvcjtyZXR1cm4gISFjdG9yICYmIChjdG9yID09PSBHZW5lcmF0b3JGdW5jdGlvbiB8fCAiR2VuZXJhdG9yRnVuY3Rpb24iID09PSAoY3Rvci5kaXNwbGF5TmFtZSB8fCBjdG9yLm5hbWUpKTt9LCBleHBvcnRzLm1hcmsgPSBmdW5jdGlvbiAoZ2VuRnVuKSB7cmV0dXJuIE9iamVjdC5zZXRQcm90b3R5cGVPZiA/IE9iamVjdC5zZXRQcm90b3R5cGVPZihnZW5GdW4sIEdlbmVyYXRvckZ1bmN0aW9uUHJvdG90eXBlKSA6IChnZW5GdW4uX19wcm90b19fID0gR2VuZXJhdG9yRnVuY3Rpb25Qcm90b3R5cGUsIGRlZmluZShnZW5GdW4sIHRvU3RyaW5nVGFnU3ltYm9sLCAiR2VuZXJhdG9yRnVuY3Rpb24iKSksIGdlbkZ1bi5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKEdwKSwgZ2VuRnVuO30sIGV4cG9ydHMuYXdyYXAgPSBmdW5jdGlvbiAoYXJnKSB7cmV0dXJuIHsgX19hd2FpdDogYXJnIH07fSwgZGVmaW5lSXRlcmF0b3JNZXRob2RzKEFzeW5jSXRlcmF0b3IucHJvdG90eXBlKSwgZGVmaW5lKEFzeW5jSXRlcmF0b3IucHJvdG90eXBlLCBhc3luY0l0ZXJhdG9yU3ltYm9sLCBmdW5jdGlvbiAoKSB7cmV0dXJuIHRoaXM7fSksIGV4cG9ydHMuQXN5bmNJdGVyYXRvciA9IEFzeW5jSXRlcmF0b3IsIGV4cG9ydHMuYXN5bmMgPSBmdW5jdGlvbiAoaW5uZXJGbiwgb3V0ZXJGbiwgc2VsZiwgdHJ5TG9jc0xpc3QsIFByb21pc2VJbXBsKSB7dm9pZCAwID09PSBQcm9taXNlSW1wbCAmJiAoUHJvbWlzZUltcGwgPSBQcm9taXNlKTt2YXIgaXRlciA9IG5ldyBBc3luY0l0ZXJhdG9yKHdyYXAoaW5uZXJGbiwgb3V0ZXJGbiwgc2VsZiwgdHJ5TG9jc0xpc3QpLCBQcm9taXNlSW1wbCk7cmV0dXJuIGV4cG9ydHMuaXNHZW5lcmF0b3JGdW5jdGlvbihvdXRlckZuKSA/IGl0ZXIgOiBpdGVyLm5leHQoKS50aGVuKGZ1bmN0aW9uIChyZXN1bHQpIHtyZXR1cm4gcmVzdWx0LmRvbmUgPyByZXN1bHQudmFsdWUgOiBpdGVyLm5leHQoKTt9KTt9LCBkZWZpbmVJdGVyYXRvck1ldGhvZHMoR3ApLCBkZWZpbmUoR3AsIHRvU3RyaW5nVGFnU3ltYm9sLCAiR2VuZXJhdG9yIiksIGRlZmluZShHcCwgaXRlcmF0b3JTeW1ib2wsIGZ1bmN0aW9uICgpIHtyZXR1cm4gdGhpczt9KSwgZGVmaW5lKEdwLCAidG9TdHJpbmciLCBmdW5jdGlvbiAoKSB7cmV0dXJuICJbb2JqZWN0IEdlbmVyYXRvcl0iO30pLCBleHBvcnRzLmtleXMgPSBmdW5jdGlvbiAodmFsKSB7dmFyIG9iamVjdCA9IE9iamVjdCh2YWwpLGtleXMgPSBbXTtmb3IgKHZhciBrZXkgaW4gb2JqZWN0KSBrZXlzLnB1c2goa2V5KTtyZXR1cm4ga2V5cy5yZXZlcnNlKCksIGZ1bmN0aW9uIG5leHQoKSB7Zm9yICg7IGtleXMubGVuZ3RoOykge3ZhciBrZXkgPSBrZXlzLnBvcCgpO2lmIChrZXkgaW4gb2JqZWN0KSByZXR1cm4gbmV4dC52YWx1ZSA9IGtleSwgbmV4dC5kb25lID0gITEsIG5leHQ7fXJldHVybiBuZXh0LmRvbmUgPSAhMCwgbmV4dDt9O30sIGV4cG9ydHMudmFsdWVzID0gdmFsdWVzLCBDb250ZXh0LnByb3RvdHlwZSA9IHsgY29uc3RydWN0b3I6IENvbnRleHQsIHJlc2V0OiBmdW5jdGlvbiByZXNldChza2lwVGVtcFJlc2V0KSB7aWYgKHRoaXMucHJldiA9IDAsIHRoaXMubmV4dCA9IDAsIHRoaXMuc2VudCA9IHRoaXMuX3NlbnQgPSB1bmRlZmluZWQsIHRoaXMuZG9uZSA9ICExLCB0aGlzLmRlbGVnYXRlID0gbnVsbCwgdGhpcy5tZXRob2QgPSAibmV4dCIsIHRoaXMuYXJnID0gdW5kZWZpbmVkLCB0aGlzLnRyeUVudHJpZXMuZm9yRWFjaChyZXNldFRyeUVudHJ5KSwgIXNraXBUZW1wUmVzZXQpIGZvciAodmFyIG5hbWUgaW4gdGhpcykgInQiID09PSBuYW1lLmNoYXJBdCgwKSAmJiBoYXNPd24uY2FsbCh0aGlzLCBuYW1lKSAmJiAhaXNOYU4oK25hbWUuc2xpY2UoMSkpICYmICh0aGlzW25hbWVdID0gdW5kZWZpbmVkKTt9LCBzdG9wOiBmdW5jdGlvbiBzdG9wKCkge3RoaXMuZG9uZSA9ICEwO3ZhciByb290UmVjb3JkID0gdGhpcy50cnlFbnRyaWVzWzBdLmNvbXBsZXRpb247aWYgKCJ0aHJvdyIgPT09IHJvb3RSZWNvcmQudHlwZSkgdGhyb3cgcm9vdFJlY29yZC5hcmc7cmV0dXJuIHRoaXMucnZhbDt9LCBkaXNwYXRjaEV4Y2VwdGlvbjogZnVuY3Rpb24gZGlzcGF0Y2hFeGNlcHRpb24oZXhjZXB0aW9uKSB7aWYgKHRoaXMuZG9uZSkgdGhyb3cgZXhjZXB0aW9uO3ZhciBjb250ZXh0ID0gdGhpcztmdW5jdGlvbiBoYW5kbGUobG9jLCBjYXVnaHQpIHtyZXR1cm4gcmVjb3JkLnR5cGUgPSAidGhyb3ciLCByZWNvcmQuYXJnID0gZXhjZXB0aW9uLCBjb250ZXh0Lm5leHQgPSBsb2MsIGNhdWdodCAmJiAoY29udGV4dC5tZXRob2QgPSAibmV4dCIsIGNvbnRleHQuYXJnID0gdW5kZWZpbmVkKSwgISFjYXVnaHQ7fWZvciAodmFyIGkgPSB0aGlzLnRyeUVudHJpZXMubGVuZ3RoIC0gMTsgaSA+PSAwOyAtLWkpIHt2YXIgZW50cnkgPSB0aGlzLnRyeUVudHJpZXNbaV0scmVjb3JkID0gZW50cnkuY29tcGxldGlvbjtpZiAoInJvb3QiID09PSBlbnRyeS50cnlMb2MpIHJldHVybiBoYW5kbGUoImVuZCIpO2lmIChlbnRyeS50cnlMb2MgPD0gdGhpcy5wcmV2KSB7dmFyIGhhc0NhdGNoID0gaGFzT3duLmNhbGwoZW50cnksICJjYXRjaExvYyIpLGhhc0ZpbmFsbHkgPSBoYXNPd24uY2FsbChlbnRyeSwgImZpbmFsbHlMb2MiKTtpZiAoaGFzQ2F0Y2ggJiYgaGFzRmluYWxseSkge2lmICh0aGlzLnByZXYgPCBlbnRyeS5jYXRjaExvYykgcmV0dXJuIGhhbmRsZShlbnRyeS5jYXRjaExvYywgITApO2lmICh0aGlzLnByZXYgPCBlbnRyeS5maW5hbGx5TG9jKSByZXR1cm4gaGFuZGxlKGVudHJ5LmZpbmFsbHlMb2MpO30gZWxzZSBpZiAoaGFzQ2F0Y2gpIHtpZiAodGhpcy5wcmV2IDwgZW50cnkuY2F0Y2hMb2MpIHJldHVybiBoYW5kbGUoZW50cnkuY2F0Y2hMb2MsICEwKTt9IGVsc2Uge2lmICghaGFzRmluYWxseSkgdGhyb3cgbmV3IEVycm9yKCJ0cnkgc3RhdGVtZW50IHdpdGhvdXQgY2F0Y2ggb3IgZmluYWxseSIpO2lmICh0aGlzLnByZXYgPCBlbnRyeS5maW5hbGx5TG9jKSByZXR1cm4gaGFuZGxlKGVudHJ5LmZpbmFsbHlMb2MpO319fX0sIGFicnVwdDogZnVuY3Rpb24gYWJydXB0KHR5cGUsIGFyZykge2ZvciAodmFyIGkgPSB0aGlzLnRyeUVudHJpZXMubGVuZ3RoIC0gMTsgaSA+PSAwOyAtLWkpIHt2YXIgZW50cnkgPSB0aGlzLnRyeUVudHJpZXNbaV07aWYgKGVudHJ5LnRyeUxvYyA8PSB0aGlzLnByZXYgJiYgaGFzT3duLmNhbGwoZW50cnksICJmaW5hbGx5TG9jIikgJiYgdGhpcy5wcmV2IDwgZW50cnkuZmluYWxseUxvYykge3ZhciBmaW5hbGx5RW50cnkgPSBlbnRyeTticmVhazt9fWZpbmFsbHlFbnRyeSAmJiAoImJyZWFrIiA9PT0gdHlwZSB8fCAiY29udGludWUiID09PSB0eXBlKSAmJiBmaW5hbGx5RW50cnkudHJ5TG9jIDw9IGFyZyAmJiBhcmcgPD0gZmluYWxseUVudHJ5LmZpbmFsbHlMb2MgJiYgKGZpbmFsbHlFbnRyeSA9IG51bGwpO3ZhciByZWNvcmQgPSBmaW5hbGx5RW50cnkgPyBmaW5hbGx5RW50cnkuY29tcGxldGlvbiA6IHt9O3JldHVybiByZWNvcmQudHlwZSA9IHR5cGUsIHJlY29yZC5hcmcgPSBhcmcsIGZpbmFsbHlFbnRyeSA/ICh0aGlzLm1ldGhvZCA9ICJuZXh0IiwgdGhpcy5uZXh0ID0gZmluYWxseUVudHJ5LmZpbmFsbHlMb2MsIENvbnRpbnVlU2VudGluZWwpIDogdGhpcy5jb21wbGV0ZShyZWNvcmQpO30sIGNvbXBsZXRlOiBmdW5jdGlvbiBjb21wbGV0ZShyZWNvcmQsIGFmdGVyTG9jKSB7aWYgKCJ0aHJvdyIgPT09IHJlY29yZC50eXBlKSB0aHJvdyByZWNvcmQuYXJnO3JldHVybiAiYnJlYWsiID09PSByZWNvcmQudHlwZSB8fCAiY29udGludWUiID09PSByZWNvcmQudHlwZSA/IHRoaXMubmV4dCA9IHJlY29yZC5hcmcgOiAicmV0dXJuIiA9PT0gcmVjb3JkLnR5cGUgPyAodGhpcy5ydmFsID0gdGhpcy5hcmcgPSByZWNvcmQuYXJnLCB0aGlzLm1ldGhvZCA9ICJyZXR1cm4iLCB0aGlzLm5leHQgPSAiZW5kIikgOiAibm9ybWFsIiA9PT0gcmVjb3JkLnR5cGUgJiYgYWZ0ZXJMb2MgJiYgKHRoaXMubmV4dCA9IGFmdGVyTG9jKSwgQ29udGludWVTZW50aW5lbDt9LCBmaW5pc2g6IGZ1bmN0aW9uIGZpbmlzaChmaW5hbGx5TG9jKSB7Zm9yICh2YXIgaSA9IHRoaXMudHJ5RW50cmllcy5sZW5ndGggLSAxOyBpID49IDA7IC0taSkge3ZhciBlbnRyeSA9IHRoaXMudHJ5RW50cmllc1tpXTtpZiAoZW50cnkuZmluYWxseUxvYyA9PT0gZmluYWxseUxvYykgcmV0dXJuIHRoaXMuY29tcGxldGUoZW50cnkuY29tcGxldGlvbiwgZW50cnkuYWZ0ZXJMb2MpLCByZXNldFRyeUVudHJ5KGVudHJ5KSwgQ29udGludWVTZW50aW5lbDt9fSwgImNhdGNoIjogZnVuY3Rpb24gX2NhdGNoKHRyeUxvYykge2ZvciAodmFyIGkgPSB0aGlzLnRyeUVudHJpZXMubGVuZ3RoIC0gMTsgaSA+PSAwOyAtLWkpIHt2YXIgZW50cnkgPSB0aGlzLnRyeUVudHJpZXNbaV07aWYgKGVudHJ5LnRyeUxvYyA9PT0gdHJ5TG9jKSB7dmFyIHJlY29yZCA9IGVudHJ5LmNvbXBsZXRpb247aWYgKCJ0aHJvdyIgPT09IHJlY29yZC50eXBlKSB7dmFyIHRocm93biA9IHJlY29yZC5hcmc7cmVzZXRUcnlFbnRyeShlbnRyeSk7fXJldHVybiB0aHJvd247fX10aHJvdyBuZXcgRXJyb3IoImlsbGVnYWwgY2F0Y2ggYXR0ZW1wdCIpO30sIGRlbGVnYXRlWWllbGQ6IGZ1bmN0aW9uIGRlbGVnYXRlWWllbGQoaXRlcmFibGUsIHJlc3VsdE5hbWUsIG5leHRMb2MpIHtyZXR1cm4gdGhpcy5kZWxlZ2F0ZSA9IHsgaXRlcmF0b3I6IHZhbHVlcyhpdGVyYWJsZSksIHJlc3VsdE5hbWU6IHJlc3VsdE5hbWUsIG5leHRMb2M6IG5leHRMb2MgfSwgIm5leHQiID09PSB0aGlzLm1ldGhvZCAmJiAodGhpcy5hcmcgPSB1bmRlZmluZWQpLCBDb250aW51ZVNlbnRpbmVsO30gfSwgZXhwb3J0czt9ZnVuY3Rpb24gYXN5bmNHZW5lcmF0b3JTdGVwKGdlbiwgcmVzb2x2ZSwgcmVqZWN0LCBfbmV4dCwgX3Rocm93LCBrZXksIGFyZykge3RyeSB7dmFyIGluZm8gPSBnZW5ba2V5XShhcmcpO3ZhciB2YWx1ZSA9IGluZm8udmFsdWU7fSBjYXRjaCAoZXJyb3IpIHtyZWplY3QoZXJyb3IpO3JldHVybjt9aWYgKGluZm8uZG9uZSkge3Jlc29sdmUodmFsdWUpO30gZWxzZSB7UHJvbWlzZS5yZXNvbHZlKHZhbHVlKS50aGVuKF9uZXh0LCBfdGhyb3cpO319ZnVuY3Rpb24gX2FzeW5jVG9HZW5lcmF0b3IoZm4pIHtyZXR1cm4gZnVuY3Rpb24gKCkge3ZhciBzZWxmID0gdGhpcyxhcmdzID0gYXJndW1lbnRzO3JldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7dmFyIGdlbiA9IGZuLmFwcGx5KHNlbGYsIGFyZ3MpO2Z1bmN0aW9uIF9uZXh0KHZhbHVlKSB7YXN5bmNHZW5lcmF0b3JTdGVwKGdlbiwgcmVzb2x2ZSwgcmVqZWN0LCBfbmV4dCwgX3Rocm93LCAibmV4dCIsIHZhbHVlKTt9ZnVuY3Rpb24gX3Rocm93KGVycikge2FzeW5jR2VuZXJhdG9yU3RlcChnZW4sIHJlc29sdmUsIHJlamVjdCwgX25leHQsIF90aHJvdywgInRocm93IiwgZXJyKTt9X25leHQodW5kZWZpbmVkKTt9KTt9O30KICAgICAgICAgIGZ1bmN0aW9uIGFkZE5vdGlmaWNhdGlvbihub3RpZmljYXRpb24pIHsKICAgICAgICAgICAgdmFyIGVsZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpOwogICAgICAgICAgICBlbGUuY2xhc3NOYW1lID0gIm5vdGlmaWNhdGlvbiI7CiAgICAgICAgICAgIGVsZS5hZGRFdmVudExpc3RlbmVyKCJhbmltYXRpb25lbmQiLCBmdW5jdGlvbiAoKSB7cmV0dXJuIGVsZS5yZW1vdmUoKTt9KTsKICAgICAgICAgICAgZWxlLmlubmVyVGV4dCA9IG5vdGlmaWNhdGlvbjsKCiAgICAgICAgICAgIHZhciBjb250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgibm90aWZpY2F0aW9uc0NvbnRhaW5lciIpOwoKICAgICAgICAgICAgaWYgKCFjb250YWluZXIpIHsKICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGNvbnRhaW5lci5hcHBlbmRDaGlsZChlbGUpOwogICAgICAgICAgfQoKICAgICAgICAgIGZ1bmN0aW9uIHNhdmVTZXR0aW5ncygKICAgICAgICAgIHByb3BlcnRpZXMpCiAgICAgICAgICB7CiAgICAgICAgICAgIHJldHVybiBzZXRQcm9wZXJ0aWVzKAogICAgICAgICAgICBwcm9wZXJ0aWVzLgogICAgICAgICAgICBmaWx0ZXIoZnVuY3Rpb24gKHApIHsKICAgICAgICAgICAgICBpZiAocC5wcmV2aW91c1ZhbHVlID09PSBwLnZhbHVlKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBwLnByZXZpb3VzVmFsdWUgPSBwLnZhbHVlOwogICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICB9KS4KICAgICAgICAgICAgbWFwKGZ1bmN0aW9uIChwcm9wKSB7cmV0dXJuIFtwcm9wLnByZWZlcmVuY2UsIHByb3AudmFsdWUudHJpbSgpXTt9KSk7CgogICAgICAgICAgfQoKICAgICAgICAgIGZ1bmN0aW9uIHNldFByb3BlcnRpZXMoCiAgICAgICAgICBwcm9wZXJ0aWVzKQogICAgICAgICAgewogICAgICAgICAgICByZXR1cm4gcnVuUmVsYXkoInNldFByb3BlcnRpZXMiLCBKU09OLnN0cmluZ2lmeShwcm9wZXJ0aWVzKSkudGhlbihmdW5jdGlvbiAodmFsKSB7cmV0dXJuICgKICAgICAgICAgICAgICAgIEpTT04ucGFyc2UodmFsKSk7fSk7CgogICAgICAgICAgfWZ1bmN0aW9uCgogICAgICAgICAgcnVuUmVsYXkoX3gsIF94Mikge3JldHVybiBfcnVuUmVsYXkuYXBwbHkodGhpcywgYXJndW1lbnRzKTt9ZnVuY3Rpb24gX3J1blJlbGF5KCkge19ydW5SZWxheSA9IF9hc3luY1RvR2VuZXJhdG9yKCAvKiNfX1BVUkVfXyovX3JlZ2VuZXJhdG9yUnVudGltZSgpLm1hcmsoZnVuY3Rpb24gX2NhbGxlZShmb3JtTmFtZSwgcGFyYW0pIHtyZXR1cm4gX3JlZ2VuZXJhdG9yUnVudGltZSgpLndyYXAoZnVuY3Rpb24gX2NhbGxlZSQoX2NvbnRleHQpIHt3aGlsZSAoMSkgc3dpdGNoIChfY29udGV4dC5wcmV2ID0gX2NvbnRleHQubmV4dCkge2Nhc2UgMDpyZXR1cm4gX2NvbnRleHQuYWJydXB0KCJyZXR1cm4iLAogICAgICAgICAgICAgICAgICAgIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlKSB7CiAgICAgICAgICAgICAgICAgICAgICB2YXIgeGhyID0gbmV3IFhNTEh0dHBSZXF1ZXN0KCk7CiAgICAgICAgICAgICAgICAgICAgICB4aHIucmVzcG9uc2VUeXBlID0gInRleHQiOwogICAgICAgICAgICAgICAgICAgICAgeGhyLm9wZW4oIlBPU1QiLCBkb2N1bWVudC5sb2NhdGlvbi5ocmVmLCB0cnVlKTsKICAgICAgICAgICAgICAgICAgICAgIHhoci5zZXRSZXF1ZXN0SGVhZGVyKCJDb250ZW50LVR5cGUiLCAiYXBwbGljYXRpb24veC13d3ctZm9ybS11cmxlbmNvZGVkIik7CiAgICAgICAgICAgICAgICAgICAgICB4aHIuc2VuZChmb3JtTmFtZSArICI9IiArIGVuY29kZVVSSUNvbXBvbmVudChwYXJhbSkpOwogICAgICAgICAgICAgICAgICAgICAgeGhyLm9ucmVhZHlzdGF0ZWNoYW5nZSA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHhoci5yZWFkeVN0YXRlICE9IDQgfHwgeGhyLnN0YXR1cyAhPSAyMDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUoeGhyLnJlc3BvbnNlVGV4dCk7CiAgICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgICAgIH0pKTtjYXNlIDE6Y2FzZSAiZW5kIjpyZXR1cm4gX2NvbnRleHQuc3RvcCgpO319LCBfY2FsbGVlKTt9KSk7cmV0dXJuIF9ydW5SZWxheS5hcHBseSh0aGlzLCBhcmd1bWVudHMpO30KICAgICAgICAgIDsgLy8gQ09OQ0FURU5BVEVEIE1PRFVMRTogLi9zcmMvcmVsYXkvYXBpL1NldHRpbmdWYWxpZGF0b3IudHN4CiAgICAgICAgICBmdW5jdGlvbiBTZXR0aW5nVmFsaWRhdG9yX3R5cGVvZihvYmopIHsiQGJhYmVsL2hlbHBlcnMgLSB0eXBlb2YiO3JldHVybiBTZXR0aW5nVmFsaWRhdG9yX3R5cGVvZiA9ICJmdW5jdGlvbiIgPT0gdHlwZW9mIFN5bWJvbCAmJiAic3ltYm9sIiA9PSB0eXBlb2YgU3ltYm9sLml0ZXJhdG9yID8gZnVuY3Rpb24gKG9iaikge3JldHVybiB0eXBlb2Ygb2JqO30gOiBmdW5jdGlvbiAob2JqKSB7cmV0dXJuIG9iaiAmJiAiZnVuY3Rpb24iID09IHR5cGVvZiBTeW1ib2wgJiYgb2JqLmNvbnN0cnVjdG9yID09PSBTeW1ib2wgJiYgb2JqICE9PSBTeW1ib2wucHJvdG90eXBlID8gInN5bWJvbCIgOiB0eXBlb2Ygb2JqO30sIFNldHRpbmdWYWxpZGF0b3JfdHlwZW9mKG9iaik7fWZ1bmN0aW9uIF9zbGljZWRUb0FycmF5KGFyciwgaSkge3JldHVybiBfYXJyYXlXaXRoSG9sZXMoYXJyKSB8fCBfaXRlcmFibGVUb0FycmF5TGltaXQoYXJyLCBpKSB8fCBfdW5zdXBwb3J0ZWRJdGVyYWJsZVRvQXJyYXkoYXJyLCBpKSB8fCBfbm9uSXRlcmFibGVSZXN0KCk7fWZ1bmN0aW9uIF9ub25JdGVyYWJsZVJlc3QoKSB7dGhyb3cgbmV3IFR5cGVFcnJvcigiSW52YWxpZCBhdHRlbXB0IHRvIGRlc3RydWN0dXJlIG5vbi1pdGVyYWJsZSBpbnN0YW5jZS5cbkluIG9yZGVyIHRvIGJlIGl0ZXJhYmxlLCBub24tYXJyYXkgb2JqZWN0cyBtdXN0IGhhdmUgYSBbU3ltYm9sLml0ZXJhdG9yXSgpIG1ldGhvZC4iKTt9ZnVuY3Rpb24gX2l0ZXJhYmxlVG9BcnJheUxpbWl0KGFyciwgaSkge3ZhciBfaSA9IG51bGwgPT0gYXJyID8gbnVsbCA6ICJ1bmRlZmluZWQiICE9IHR5cGVvZiBTeW1ib2wgJiYgYXJyW1N5bWJvbC5pdGVyYXRvcl0gfHwgYXJyWyJAQGl0ZXJhdG9yIl07aWYgKG51bGwgIT0gX2kpIHt2YXIgX3MsX2UsX3gsX3IsX2FyciA9IFtdLF9uID0gITAsX2QgPSAhMTt0cnkge2lmIChfeCA9IChfaSA9IF9pLmNhbGwoYXJyKSkubmV4dCwgMCA9PT0gaSkge2lmIChPYmplY3QoX2kpICE9PSBfaSkgcmV0dXJuO19uID0gITE7fSBlbHNlIGZvciAoOyAhKF9uID0gKF9zID0gX3guY2FsbChfaSkpLmRvbmUpICYmIChfYXJyLnB1c2goX3MudmFsdWUpLCBfYXJyLmxlbmd0aCAhPT0gaSk7IF9uID0gITApO30gY2F0Y2ggKGVycikge19kID0gITAsIF9lID0gZXJyO30gZmluYWxseSB7dHJ5IHtpZiAoIV9uICYmIG51bGwgIT0gX2lbInJldHVybiJdICYmIChfciA9IF9pWyJyZXR1cm4iXSgpLCBPYmplY3QoX3IpICE9PSBfcikpIHJldHVybjt9IGZpbmFsbHkge2lmIChfZCkgdGhyb3cgX2U7fX1yZXR1cm4gX2Fycjt9fWZ1bmN0aW9uIF9hcnJheVdpdGhIb2xlcyhhcnIpIHtpZiAoQXJyYXkuaXNBcnJheShhcnIpKSByZXR1cm4gYXJyO31mdW5jdGlvbiBfY3JlYXRlRm9yT2ZJdGVyYXRvckhlbHBlcihvLCBhbGxvd0FycmF5TGlrZSkge3ZhciBpdCA9IHR5cGVvZiBTeW1ib2wgIT09ICJ1bmRlZmluZWQiICYmIG9bU3ltYm9sLml0ZXJhdG9yXSB8fCBvWyJAQGl0ZXJhdG9yIl07aWYgKCFpdCkge2lmIChBcnJheS5pc0FycmF5KG8pIHx8IChpdCA9IF91bnN1cHBvcnRlZEl0ZXJhYmxlVG9BcnJheShvKSkgfHwgYWxsb3dBcnJheUxpa2UgJiYgbyAmJiB0eXBlb2Ygby5sZW5ndGggPT09ICJudW1iZXIiKSB7aWYgKGl0KSBvID0gaXQ7dmFyIGkgPSAwO3ZhciBGID0gZnVuY3Rpb24gRigpIHt9O3JldHVybiB7IHM6IEYsIG46IGZ1bmN0aW9uIG4oKSB7aWYgKGkgPj0gby5sZW5ndGgpIHJldHVybiB7IGRvbmU6IHRydWUgfTtyZXR1cm4geyBkb25lOiBmYWxzZSwgdmFsdWU6IG9baSsrXSB9O30sIGU6IGZ1bmN0aW9uIGUoX2UyKSB7dGhyb3cgX2UyO30sIGY6IEYgfTt9dGhyb3cgbmV3IFR5cGVFcnJvcigiSW52YWxpZCBhdHRlbXB0IHRvIGl0ZXJhdGUgbm9uLWl0ZXJhYmxlIGluc3RhbmNlLlxuSW4gb3JkZXIgdG8gYmUgaXRlcmFibGUsIG5vbi1hcnJheSBvYmplY3RzIG11c3QgaGF2ZSBhIFtTeW1ib2wuaXRlcmF0b3JdKCkgbWV0aG9kLiIpO312YXIgbm9ybWFsQ29tcGxldGlvbiA9IHRydWUsZGlkRXJyID0gZmFsc2UsZXJyO3JldHVybiB7IHM6IGZ1bmN0aW9uIHMoKSB7aXQgPSBpdC5jYWxsKG8pO30sIG46IGZ1bmN0aW9uIG4oKSB7dmFyIHN0ZXAgPSBpdC5uZXh0KCk7bm9ybWFsQ29tcGxldGlvbiA9IHN0ZXAuZG9uZTtyZXR1cm4gc3RlcDt9LCBlOiBmdW5jdGlvbiBlKF9lMykge2RpZEVyciA9IHRydWU7ZXJyID0gX2UzO30sIGY6IGZ1bmN0aW9uIGYoKSB7dHJ5IHtpZiAoIW5vcm1hbENvbXBsZXRpb24gJiYgaXRbInJldHVybiJdICE9IG51bGwpIGl0WyJyZXR1cm4iXSgpO30gZmluYWxseSB7aWYgKGRpZEVycikgdGhyb3cgZXJyO319IH07fWZ1bmN0aW9uIF91bnN1cHBvcnRlZEl0ZXJhYmxlVG9BcnJheShvLCBtaW5MZW4pIHtpZiAoIW8pIHJldHVybjtpZiAodHlwZW9mIG8gPT09ICJzdHJpbmciKSByZXR1cm4gX2FycmF5TGlrZVRvQXJyYXkobywgbWluTGVuKTt2YXIgbiA9IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChvKS5zbGljZSg4LCAtMSk7aWYgKG4gPT09ICJPYmplY3QiICYmIG8uY29uc3RydWN0b3IpIG4gPSBvLmNvbnN0cnVjdG9yLm5hbWU7aWYgKG4gPT09ICJNYXAiIHx8IG4gPT09ICJTZXQiKSByZXR1cm4gQXJyYXkuZnJvbShvKTtpZiAobiA9PT0gIkFyZ3VtZW50cyIgfHwgL14oPzpVaXxJKW50KD86OHwxNnwzMikoPzpDbGFtcGVkKT9BcnJheSQvLnRlc3QobikpIHJldHVybiBfYXJyYXlMaWtlVG9BcnJheShvLCBtaW5MZW4pO31mdW5jdGlvbiBfYXJyYXlMaWtlVG9BcnJheShhcnIsIGxlbikge2lmIChsZW4gPT0gbnVsbCB8fCBsZW4gPiBhcnIubGVuZ3RoKSBsZW4gPSBhcnIubGVuZ3RoO2ZvciAodmFyIGkgPSAwLCBhcnIyID0gbmV3IEFycmF5KGxlbik7IGkgPCBsZW47IGkrKykgYXJyMltpXSA9IGFycltpXTtyZXR1cm4gYXJyMjt9ZnVuY3Rpb24gX2NsYXNzQ2FsbENoZWNrKGluc3RhbmNlLCBDb25zdHJ1Y3Rvcikge2lmICghKGluc3RhbmNlIGluc3RhbmNlb2YgQ29uc3RydWN0b3IpKSB7dGhyb3cgbmV3IFR5cGVFcnJvcigiQ2Fubm90IGNhbGwgYSBjbGFzcyBhcyBhIGZ1bmN0aW9uIik7fX1mdW5jdGlvbiBfZGVmaW5lUHJvcGVydGllcyh0YXJnZXQsIHByb3BzKSB7Zm9yICh2YXIgaSA9IDA7IGkgPCBwcm9wcy5sZW5ndGg7IGkrKykge3ZhciBkZXNjcmlwdG9yID0gcHJvcHNbaV07ZGVzY3JpcHRvci5lbnVtZXJhYmxlID0gZGVzY3JpcHRvci5lbnVtZXJhYmxlIHx8IGZhbHNlO2Rlc2NyaXB0b3IuY29uZmlndXJhYmxlID0gdHJ1ZTtpZiAoInZhbHVlIiBpbiBkZXNjcmlwdG9yKSBkZXNjcmlwdG9yLndyaXRhYmxlID0gdHJ1ZTtPYmplY3QuZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBfdG9Qcm9wZXJ0eUtleShkZXNjcmlwdG9yLmtleSksIGRlc2NyaXB0b3IpO319ZnVuY3Rpb24gX2NyZWF0ZUNsYXNzKENvbnN0cnVjdG9yLCBwcm90b1Byb3BzLCBzdGF0aWNQcm9wcykge2lmIChwcm90b1Byb3BzKSBfZGVmaW5lUHJvcGVydGllcyhDb25zdHJ1Y3Rvci5wcm90b3R5cGUsIHByb3RvUHJvcHMpO2lmIChzdGF0aWNQcm9wcykgX2RlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IsIHN0YXRpY1Byb3BzKTtPYmplY3QuZGVmaW5lUHJvcGVydHkoQ29uc3RydWN0b3IsICJwcm90b3R5cGUiLCB7IHdyaXRhYmxlOiBmYWxzZSB9KTtyZXR1cm4gQ29uc3RydWN0b3I7fWZ1bmN0aW9uIF9kZWZpbmVQcm9wZXJ0eShvYmosIGtleSwgdmFsdWUpIHtrZXkgPSBfdG9Qcm9wZXJ0eUtleShrZXkpO2lmIChrZXkgaW4gb2JqKSB7T2JqZWN0LmRlZmluZVByb3BlcnR5KG9iaiwga2V5LCB7IHZhbHVlOiB2YWx1ZSwgZW51bWVyYWJsZTogdHJ1ZSwgY29uZmlndXJhYmxlOiB0cnVlLCB3cml0YWJsZTogdHJ1ZSB9KTt9IGVsc2Uge29ialtrZXldID0gdmFsdWU7fXJldHVybiBvYmo7fWZ1bmN0aW9uIF90b1Byb3BlcnR5S2V5KGFyZykge3ZhciBrZXkgPSBfdG9QcmltaXRpdmUoYXJnLCAic3RyaW5nIik7cmV0dXJuIFNldHRpbmdWYWxpZGF0b3JfdHlwZW9mKGtleSkgPT09ICJzeW1ib2wiID8ga2V5IDogU3RyaW5nKGtleSk7fWZ1bmN0aW9uIF90b1ByaW1pdGl2ZShpbnB1dCwgaGludCkge2lmIChTZXR0aW5nVmFsaWRhdG9yX3R5cGVvZihpbnB1dCkgIT09ICJvYmplY3QiIHx8IGlucHV0ID09PSBudWxsKSByZXR1cm4gaW5wdXQ7dmFyIHByaW0gPSBpbnB1dFtTeW1ib2wudG9QcmltaXRpdmVdO2lmIChwcmltICE9PSB1bmRlZmluZWQpIHt2YXIgcmVzID0gcHJpbS5jYWxsKGlucHV0LCBoaW50IHx8ICJkZWZhdWx0Iik7aWYgKFNldHRpbmdWYWxpZGF0b3JfdHlwZW9mKHJlcykgIT09ICJvYmplY3QiKSByZXR1cm4gcmVzO3Rocm93IG5ldyBUeXBlRXJyb3IoIkBAdG9QcmltaXRpdmUgbXVzdCByZXR1cm4gYSBwcmltaXRpdmUgdmFsdWUuIik7fXJldHVybiAoaGludCA9PT0gInN0cmluZyIgPyBTdHJpbmcgOiBOdW1iZXIpKGlucHV0KTt9dmFyCgoKICAgICAgICAgIFNldHRpbmdWYWxpZGF0b3IgPSAvKiNfX1BVUkVfXyovZnVuY3Rpb24gKCkge2Z1bmN0aW9uIFNldHRpbmdWYWxpZGF0b3IoKSB7X2NsYXNzQ2FsbENoZWNrKHRoaXMsIFNldHRpbmdWYWxpZGF0b3IpO19kZWZpbmVQcm9wZXJ0eSh0aGlzLCAic2V0dGluZ3MiLAogICAgICAgICAgICAgIFtdKTtfZGVmaW5lUHJvcGVydHkodGhpcywgIm9iamVjdCIsCiAgICAgICAgICAgICAge30pO31fY3JlYXRlQ2xhc3MoU2V0dGluZ1ZhbGlkYXRvciwgW3sga2V5OiAiYWRkU2V0dGluZyIsIHZhbHVlOgoKICAgICAgICAgICAgICBmdW5jdGlvbiBhZGRTZXR0aW5nKHNldHRpbmcsIHNldFN0YXRlKSB7CiAgICAgICAgICAgICAgICB0aGlzLnNldHRpbmdzLnB1c2goW3NldHRpbmcsIHNldFN0YXRlXSk7CiAgICAgICAgICAgICAgfSB9LCB7IGtleTogInVwZGF0ZVNldHRpbmciLCB2YWx1ZToKCiAgICAgICAgICAgICAgZnVuY3Rpb24gdXBkYXRlU2V0dGluZyhzZXR0aW5nKSB7CiAgICAgICAgICAgICAgICB0aGlzLm9iamVjdFtzZXR0aW5nLnByZWZlcmVuY2VdID0gc2V0dGluZy52YWx1ZTsKICAgICAgICAgICAgICAgIHRoaXMuZG9WYWxpZGF0ZXMoKTsKICAgICAgICAgICAgICB9IH0sIHsga2V5OiAidXBkYXRlT2JqZWN0IiwgdmFsdWU6CgogICAgICAgICAgICAgIGZ1bmN0aW9uIHVwZGF0ZU9iamVjdCgpIHt2YXIgX2l0ZXJhdG9yID0gX2NyZWF0ZUZvck9mSXRlcmF0b3JIZWxwZXIoCiAgICAgICAgICAgICAgICAgIHRoaXMuc2V0dGluZ3MpLF9zdGVwO3RyeSB7Zm9yIChfaXRlcmF0b3IucygpOyAhKF9zdGVwID0gX2l0ZXJhdG9yLm4oKSkuZG9uZTspIHt2YXIgX3N0ZXAkdmFsdWUgPSBfc2xpY2VkVG9BcnJheShfc3RlcC52YWx1ZSwgMSksc2V0dGluZyA9IF9zdGVwJHZhbHVlWzBdOwogICAgICAgICAgICAgICAgICAgIHRoaXMub2JqZWN0W3NldHRpbmcucHJlZmVyZW5jZV0gPSBzZXR0aW5nLnZhbHVlOwogICAgICAgICAgICAgICAgICB9fSBjYXRjaCAoZXJyKSB7X2l0ZXJhdG9yLmUoZXJyKTt9IGZpbmFsbHkge19pdGVyYXRvci5mKCk7fQogICAgICAgICAgICAgIH0gfSwgeyBrZXk6ICJkb1ZhbGlkYXRlcyIsIHZhbHVlOgoKICAgICAgICAgICAgICBmdW5jdGlvbiBkb1ZhbGlkYXRlcygpIHt2YXIgX2l0ZXJhdG9yMiA9IF9jcmVhdGVGb3JPZkl0ZXJhdG9ySGVscGVyKAogICAgICAgICAgICAgICAgICB0aGlzLnNldHRpbmdzKSxfc3RlcDI7dHJ5IHtmb3IgKF9pdGVyYXRvcjIucygpOyAhKF9zdGVwMiA9IF9pdGVyYXRvcjIubigpKS5kb25lOykge3ZhciBfc3RlcDIkdmFsdWUgPSBfc2xpY2VkVG9BcnJheShfc3RlcDIudmFsdWUsIDIpLHNldHRpbmcgPSBfc3RlcDIkdmFsdWVbMF0sc2V0VmFsaWQgPSBfc3RlcDIkdmFsdWVbMV07CiAgICAgICAgICAgICAgICAgICAgc2V0VmFsaWQodGhpcy5pc1ZhbGlkKHNldHRpbmcpKTsKICAgICAgICAgICAgICAgICAgfX0gY2F0Y2ggKGVycikge19pdGVyYXRvcjIuZShlcnIpO30gZmluYWxseSB7X2l0ZXJhdG9yMi5mKCk7fQogICAgICAgICAgICAgIH0gfSwgeyBrZXk6ICJpc1ZhbGlkIiwgdmFsdWU6CgogICAgICAgICAgICAgIGZ1bmN0aW9uIGlzVmFsaWQoc2V0dGluZykgewogICAgICAgICAgICAgICAgcmV0dXJuICgKICAgICAgICAgICAgICAgICAgc2V0dGluZy52YWxpZGF0ZSA9PSBudWxsIHx8IHNldHRpbmcudmFsaWRhdGUoc2V0dGluZy52YWx1ZSwgdGhpcy5vYmplY3QpKTsKCiAgICAgICAgICAgICAgfSB9XSk7cmV0dXJuIFNldHRpbmdWYWxpZGF0b3I7fSgpOwoKCiAgICAgICAgICAvKiBoYXJtb255IGRlZmF1bHQgZXhwb3J0ICovdmFyIGFwaV9TZXR0aW5nVmFsaWRhdG9yID0gU2V0dGluZ1ZhbGlkYXRvcjsKICAgICAgICAgIDsgLy8gQ09OQ0FURU5BVEVEIE1PRFVMRTogLi9zcmMvcmVsYXkvY29tcG9uZW50cy9JbnRlcnJ1cHQudHN4CgoKCgogICAgICAgICAgZnVuY3Rpb24gSW50ZXJydXB0KF9yZWYpIHt2YXIgYnV0dG9uID0gX3JlZi5idXR0b247CiAgICAgICAgICAgIHJldHVybiAvKiNfX1BVUkVfXyovKAogICAgICAgICAgICAgIHJlYWN0LmNyZWF0ZUVsZW1lbnQoImlucHV0IiwgewogICAgICAgICAgICAgICAgY2xhc3NOYW1lOiAiaW50ZXJydXB0IiwKICAgICAgICAgICAgICAgIHR5cGU6ICJzdWJtaXQiLAogICAgICAgICAgICAgICAgdmFsdWU6IGJ1dHRvbi5uYW1lLAogICAgICAgICAgICAgICAgImRhdGEtbmFtZSI6IGJ1dHRvbi5uYW1lLAogICAgICAgICAgICAgICAgb25DbGljazogZnVuY3Rpb24gb25DbGljaygpIHsKICAgICAgICAgICAgICAgICAgc2V0UHJvcGVydGllcygKICAgICAgICAgICAgICAgICAgYnV0dG9uLmFjdGlvbnMubWFwKGZ1bmN0aW9uIChfcmVmMikge3ZhciBwcmVmZXJlbmNlID0gX3JlZjIucHJlZmVyZW5jZSx2YWx1ZSA9IF9yZWYyLnZhbHVlO3JldHVybiBbcHJlZmVyZW5jZSwgdmFsdWVdO30pKS4KICAgICAgICAgICAgICAgICAgdGhlbihmdW5jdGlvbiAoKSB7cmV0dXJuIGFkZE5vdGlmaWNhdGlvbihidXR0b24ubm90aWZpY2F0aW9uIHx8ICJJbnRlcnJ1cHRlZCEiKTt9KTsKICAgICAgICAgICAgICAgIH0gfSkpOwoKCiAgICAgICAgICB9CgogICAgICAgICAgLyogaGFybW9ueSBkZWZhdWx0IGV4cG9ydCAqL3ZhciBjb21wb25lbnRzX0ludGVycnVwdCA9IEludGVycnVwdDsKICAgICAgICAgIDsgLy8gQ09OQ0FURU5BVEVEIE1PRFVMRTogLi9zcmMvcmVsYXkvdHlwZXMvVHlwZXMudHN4CgoKICAgICAgICAgIHZhciBSZWxheUNvbXBvbmVudFR5cGU7KGZ1bmN0aW9uIChSZWxheUNvbXBvbmVudFR5cGUpIHtSZWxheUNvbXBvbmVudFR5cGVbIkJPT0xFQU4iXSA9ICJib29sZWFuIjtSZWxheUNvbXBvbmVudFR5cGVbIkRST1BET1dOIl0gPSAiZHJvcGRvd24iO1JlbGF5Q29tcG9uZW50VHlwZVsiU1RSSU5HIl0gPSAic3RyaW5nIjtSZWxheUNvbXBvbmVudFR5cGVbIkhUTUwiXSA9ICJodG1sIjtSZWxheUNvbXBvbmVudFR5cGVbIklOVEVSUlVQVCJdID0gImludGVycnVwdCI7UmVsYXlDb21wb25lbnRUeXBlWyJUQUdTIl0gPSAidGFncyI7fSkoUmVsYXlDb21wb25lbnRUeXBlIHx8IChSZWxheUNvbXBvbmVudFR5cGUgPSB7fSkpOwogICAgICAgICAgOyAvLyBDT05DQVRFTkFURUQgTU9EVUxFOiAuL3NyYy9yZWxheS9jb21wb25lbnRzL3NldHRpbmdzL0Jvb2xlYW5JbnB1dC50c3gKICAgICAgICAgIGZ1bmN0aW9uIEJvb2xlYW5JbnB1dF9zbGljZWRUb0FycmF5KGFyciwgaSkge3JldHVybiBCb29sZWFuSW5wdXRfYXJyYXlXaXRoSG9sZXMoYXJyKSB8fCBCb29sZWFuSW5wdXRfaXRlcmFibGVUb0FycmF5TGltaXQoYXJyLCBpKSB8fCBCb29sZWFuSW5wdXRfdW5zdXBwb3J0ZWRJdGVyYWJsZVRvQXJyYXkoYXJyLCBpKSB8fCBCb29sZWFuSW5wdXRfbm9uSXRlcmFibGVSZXN0KCk7fWZ1bmN0aW9uIEJvb2xlYW5JbnB1dF9ub25JdGVyYWJsZVJlc3QoKSB7dGhyb3cgbmV3IFR5cGVFcnJvcigiSW52YWxpZCBhdHRlbXB0IHRvIGRlc3RydWN0dXJlIG5vbi1pdGVyYWJsZSBpbnN0YW5jZS5cbkluIG9yZGVyIHRvIGJlIGl0ZXJhYmxlLCBub24tYXJyYXkgb2JqZWN0cyBtdXN0IGhhdmUgYSBbU3ltYm9sLml0ZXJhdG9yXSgpIG1ldGhvZC4iKTt9ZnVuY3Rpb24gQm9vbGVhbklucHV0X3Vuc3VwcG9ydGVkSXRlcmFibGVUb0FycmF5KG8sIG1pbkxlbikge2lmICghbykgcmV0dXJuO2lmICh0eXBlb2YgbyA9PT0gInN0cmluZyIpIHJldHVybiBCb29sZWFuSW5wdXRfYXJyYXlMaWtlVG9BcnJheShvLCBtaW5MZW4pO3ZhciBuID0gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKG8pLnNsaWNlKDgsIC0xKTtpZiAobiA9PT0gIk9iamVjdCIgJiYgby5jb25zdHJ1Y3RvcikgbiA9IG8uY29uc3RydWN0b3IubmFtZTtpZiAobiA9PT0gIk1hcCIgfHwgbiA9PT0gIlNldCIpIHJldHVybiBBcnJheS5mcm9tKG8pO2lmIChuID09PSAiQXJndW1lbnRzIiB8fCAvXig/OlVpfEkpbnQoPzo4fDE2fDMyKSg/OkNsYW1wZWQpP0FycmF5JC8udGVzdChuKSkgcmV0dXJuIEJvb2xlYW5JbnB1dF9hcnJheUxpa2VUb0FycmF5KG8sIG1pbkxlbik7fWZ1bmN0aW9uIEJvb2xlYW5JbnB1dF9hcnJheUxpa2VUb0FycmF5KGFyciwgbGVuKSB7aWYgKGxlbiA9PSBudWxsIHx8IGxlbiA+IGFyci5sZW5ndGgpIGxlbiA9IGFyci5sZW5ndGg7Zm9yICh2YXIgaSA9IDAsIGFycjIgPSBuZXcgQXJyYXkobGVuKTsgaSA8IGxlbjsgaSsrKSBhcnIyW2ldID0gYXJyW2ldO3JldHVybiBhcnIyO31mdW5jdGlvbiBCb29sZWFuSW5wdXRfaXRlcmFibGVUb0FycmF5TGltaXQoYXJyLCBpKSB7dmFyIF9pID0gbnVsbCA9PSBhcnIgPyBudWxsIDogInVuZGVmaW5lZCIgIT0gdHlwZW9mIFN5bWJvbCAmJiBhcnJbU3ltYm9sLml0ZXJhdG9yXSB8fCBhcnJbIkBAaXRlcmF0b3IiXTtpZiAobnVsbCAhPSBfaSkge3ZhciBfcyxfZSxfeCxfcixfYXJyID0gW10sX24gPSAhMCxfZCA9ICExO3RyeSB7aWYgKF94ID0gKF9pID0gX2kuY2FsbChhcnIpKS5uZXh0LCAwID09PSBpKSB7aWYgKE9iamVjdChfaSkgIT09IF9pKSByZXR1cm47X24gPSAhMTt9IGVsc2UgZm9yICg7ICEoX24gPSAoX3MgPSBfeC5jYWxsKF9pKSkuZG9uZSkgJiYgKF9hcnIucHVzaChfcy52YWx1ZSksIF9hcnIubGVuZ3RoICE9PSBpKTsgX24gPSAhMCk7fSBjYXRjaCAoZXJyKSB7X2QgPSAhMCwgX2UgPSBlcnI7fSBmaW5hbGx5IHt0cnkge2lmICghX24gJiYgbnVsbCAhPSBfaVsicmV0dXJuIl0gJiYgKF9yID0gX2lbInJldHVybiJdKCksIE9iamVjdChfcikgIT09IF9yKSkgcmV0dXJuO30gZmluYWxseSB7aWYgKF9kKSB0aHJvdyBfZTt9fXJldHVybiBfYXJyO319ZnVuY3Rpb24gQm9vbGVhbklucHV0X2FycmF5V2l0aEhvbGVzKGFycikge2lmIChBcnJheS5pc0FycmF5KGFycikpIHJldHVybiBhcnI7fQoKCgogICAgICAgICAgZnVuY3Rpb24gQm9vbGVhbklucHV0KF9yZWYpIHt2YXIgYnV0dG9uID0gX3JlZi5idXR0b247CiAgICAgICAgICAgIHZhciBfdXNlU3RhdGUgPSAoMCwgcmVhY3QudXNlU3RhdGUpKGJ1dHRvbi52YWx1ZSA9PT0gInRydWUiKSxfdXNlU3RhdGUyID0gQm9vbGVhbklucHV0X3NsaWNlZFRvQXJyYXkoX3VzZVN0YXRlLCAyKSx2YWx1ZSA9IF91c2VTdGF0ZTJbMF0sc2V0VmFsdWUgPSBfdXNlU3RhdGUyWzFdOwoKICAgICAgICAgICAgcmV0dXJuIC8qI19fUFVSRV9fKi8oCiAgICAgICAgICAgICAgcmVhY3QuY3JlYXRlRWxlbWVudCgibGFiZWwiLCB7IGNsYXNzTmFtZTogImNoZWNrY29udGFpbmVyIiB9LCAvKiNfX1BVUkVfXyovCiAgICAgICAgICAgICAgcmVhY3QuY3JlYXRlRWxlbWVudCgiaW5wdXQiLCB7IHR5cGU6ICJoaWRkZW4iLCBuYW1lOiBidXR0b24ubmFtZSwgdmFsdWU6IGJ1dHRvbi52YWx1ZSB9KSwgLyojX19QVVJFX18qLwogICAgICAgICAgICAgIHJlYWN0LmNyZWF0ZUVsZW1lbnQoImRpdiIsIHsKICAgICAgICAgICAgICAgIGNsYXNzTmFtZTogInRvZ2dsZS10cmFjayIsCiAgICAgICAgICAgICAgICBvbkNsaWNrOiBmdW5jdGlvbiBvbkNsaWNrKCkgewogICAgICAgICAgICAgICAgICBzZXRWYWx1ZSghdmFsdWUpOwogICAgICAgICAgICAgICAgICBidXR0b24uc2V0VmFsdWUoKCF2YWx1ZSkudG9TdHJpbmcoKSk7CiAgICAgICAgICAgICAgICB9IH0sIC8qI19fUFVSRV9fKi8KCiAgICAgICAgICAgICAgcmVhY3QuY3JlYXRlRWxlbWVudCgic3BhbiIsIHsgY2xhc3NOYW1lOiAidG9nZ2xlLWluZGljYXRvciIgfSwgLyojX19QVVJFX18qLwogICAgICAgICAgICAgIHJlYWN0LmNyZWF0ZUVsZW1lbnQoInNwYW4iLCB7IGNsYXNzTmFtZTogImNoZWNrTWFyayIgfSwgLyojX19QVVJFX18qLwogICAgICAgICAgICAgIHJlYWN0LmNyZWF0ZUVsZW1lbnQoInN2ZyIsIHsKICAgICAgICAgICAgICAgIHZpZXdCb3g6ICIwIDAgMjQgMjQiLAogICAgICAgICAgICAgICAgaWQ6ICJnaHEtc3ZnLWNoZWNrIiwKICAgICAgICAgICAgICAgIHJvbGU6ICJwcmVzZW50YXRpb24iLAogICAgICAgICAgICAgICAgImFyaWEtaGlkZGVuIjogInRydWUiIH0sIC8qI19fUFVSRV9fKi8KCiAgICAgICAgICAgICAgcmVhY3QuY3JlYXRlRWxlbWVudCgicGF0aCIsIHsgZDogIk05Ljg2IDE4YTEgMSAwIDAxLS43My0uMzJsLTQuODYtNS4xN2ExLjAwMSAxLjAwMSAwIDAxMS40Ni0xLjM3bDQuMTIgNC4zOSA4LjQxLTkuMmExIDEgMCAxMTEuNDggMS4zNGwtOS4xNCAxMGExIDEgMCAwMS0uNzMuMzNoLS4wMXoiIH0pKSkpKSkpOwoKCgoKCgogICAgICAgICAgfQoKICAgICAgICAgIC8qCiAgICAgICAgICA8ZGl2CiAgICAgICAgICAgIGNsYXNzPSJjaGVja21hcmsiCiAgICAgICAgICAgIG9uQ2xpY2s9eygpID0+IHsKICAgICAgICAgICAgICBzZXRWYWx1ZSghdmFsdWUpOwogICAgICAgICAgICB9fQogICAgICAgICAgLz4KICAgICAgICAgICAqLwogICAgICAgICAgLyogaGFybW9ueSBkZWZhdWx0IGV4cG9ydCAqL3ZhciBzZXR0aW5nc19Cb29sZWFuSW5wdXQgPSBCb29sZWFuSW5wdXQ7CiAgICAgICAgICA7IC8vIENPTkNBVEVOQVRFRCBNT0RVTEU6IC4vc3JjL3JlbGF5L2NvbXBvbmVudHMvc2V0dGluZ3MvRHJvcGRvd25JbnB1dC50c3gKCgoKICAgICAgICAgIGZ1bmN0aW9uIERyb3Bkb3duSW5wdXQoX3JlZikge3ZhciBidXR0b24gPSBfcmVmLmJ1dHRvbjsKICAgICAgICAgICAgcmV0dXJuIC8qI19fUFVSRV9fKi8oCiAgICAgICAgICAgICAgcmVhY3QuY3JlYXRlRWxlbWVudCgic2VsZWN0IiwgewogICAgICAgICAgICAgICAgY2xhc3NOYW1lOiAiZHJvcGRvd25jb250YWluZXIiLAogICAgICAgICAgICAgICAgbmFtZTogYnV0dG9uLm5hbWUsCiAgICAgICAgICAgICAgICBkZWZhdWx0VmFsdWU6IGJ1dHRvbi52YWx1ZSwKICAgICAgICAgICAgICAgIG9uQ2hhbmdlOiBmdW5jdGlvbiBvbkNoYW5nZShlKSB7cmV0dXJuIGJ1dHRvbi5zZXRWYWx1ZShlLnRhcmdldC52YWx1ZSk7fSB9LAoKICAgICAgICAgICAgICBidXR0b24uZHJvcGRvd24ubWFwKGZ1bmN0aW9uIChvcHRpb24sIGluZGV4KSB7CiAgICAgICAgICAgICAgICByZXR1cm4gLyojX19QVVJFX18qLygKICAgICAgICAgICAgICAgICAgcmVhY3QuY3JlYXRlRWxlbWVudCgib3B0aW9uIiwgeyBrZXk6IGluZGV4LCB2YWx1ZTogb3B0aW9uLnZhbHVlIH0sCiAgICAgICAgICAgICAgICAgIG9wdGlvbi5kaXNwbGF5IHx8IG9wdGlvbi52YWx1ZSkpOwoKCiAgICAgICAgICAgICAgfSkpKTsKCgogICAgICAgICAgfQoKICAgICAgICAgIC8qIGhhcm1vbnkgZGVmYXVsdCBleHBvcnQgKi92YXIgc2V0dGluZ3NfRHJvcGRvd25JbnB1dCA9IERyb3Bkb3duSW5wdXQ7CiAgICAgICAgICA7IC8vIENPTkNBVEVOQVRFRCBNT0RVTEU6IC4vc3JjL3JlbGF5L2NvbXBvbmVudHMvc2V0dGluZ3MvU3RyaW5nSW5wdXQudHN4CgoKCiAgICAgICAgICBmdW5jdGlvbiBTdHJpbmdJbnB1dChfcmVmKSB7dmFyIGJ1dHRvbiA9IF9yZWYuYnV0dG9uOwogICAgICAgICAgICByZXR1cm4gLyojX19QVVJFX18qLygKICAgICAgICAgICAgICByZWFjdC5jcmVhdGVFbGVtZW50KCJpbnB1dCIsIHsKICAgICAgICAgICAgICAgIGNsYXNzTmFtZTogInN0cmluZ2NvbnRhaW5lciIsCiAgICAgICAgICAgICAgICBuYW1lOiBidXR0b24ubmFtZSwKICAgICAgICAgICAgICAgIGRlZmF1bHRWYWx1ZTogYnV0dG9uLnZhbHVlLAogICAgICAgICAgICAgICAgcGxhY2Vob2xkZXI6IGJ1dHRvbi5wbGFjZWhvbGRlclRleHQgPyBidXR0b24ucGxhY2Vob2xkZXJUZXh0IDogIiIsCiAgICAgICAgICAgICAgICBvbkNoYW5nZTogZnVuY3Rpb24gb25DaGFuZ2UoZSkge3JldHVybiBidXR0b24uc2V0VmFsdWUoZS50YXJnZXQudmFsdWUpO30gfSkpOwoKCiAgICAgICAgICB9CgogICAgICAgICAgLyogaGFybW9ueSBkZWZhdWx0IGV4cG9ydCAqL3ZhciBzZXR0aW5nc19TdHJpbmdJbnB1dCA9IFN0cmluZ0lucHV0OwogICAgICAgICAgOyAvLyBDT05DQVRFTkFURUQgTU9EVUxFOiAuL3NyYy9yZWxheS9jb21wb25lbnRzL3NldHRpbmdzL1RhZ3NJbnB1dC50c3gKICAgICAgICAgIGZ1bmN0aW9uIF90b0NvbnN1bWFibGVBcnJheShhcnIpIHtyZXR1cm4gX2FycmF5V2l0aG91dEhvbGVzKGFycikgfHwgX2l0ZXJhYmxlVG9BcnJheShhcnIpIHx8IFRhZ3NJbnB1dF91bnN1cHBvcnRlZEl0ZXJhYmxlVG9BcnJheShhcnIpIHx8IF9ub25JdGVyYWJsZVNwcmVhZCgpO31mdW5jdGlvbiBfbm9uSXRlcmFibGVTcHJlYWQoKSB7dGhyb3cgbmV3IFR5cGVFcnJvcigiSW52YWxpZCBhdHRlbXB0IHRvIHNwcmVhZCBub24taXRlcmFibGUgaW5zdGFuY2UuXG5JbiBvcmRlciB0byBiZSBpdGVyYWJsZSwgbm9uLWFycmF5IG9iamVjdHMgbXVzdCBoYXZlIGEgW1N5bWJvbC5pdGVyYXRvcl0oKSBtZXRob2QuIik7fWZ1bmN0aW9uIF9pdGVyYWJsZVRvQXJyYXkoaXRlcikge2lmICh0eXBlb2YgU3ltYm9sICE9PSAidW5kZWZpbmVkIiAmJiBpdGVyW1N5bWJvbC5pdGVyYXRvcl0gIT0gbnVsbCB8fCBpdGVyWyJAQGl0ZXJhdG9yIl0gIT0gbnVsbCkgcmV0dXJuIEFycmF5LmZyb20oaXRlcik7fWZ1bmN0aW9uIF9hcnJheVdpdGhvdXRIb2xlcyhhcnIpIHtpZiAoQXJyYXkuaXNBcnJheShhcnIpKSByZXR1cm4gVGFnc0lucHV0X2FycmF5TGlrZVRvQXJyYXkoYXJyKTt9ZnVuY3Rpb24gVGFnc0lucHV0X3NsaWNlZFRvQXJyYXkoYXJyLCBpKSB7cmV0dXJuIFRhZ3NJbnB1dF9hcnJheVdpdGhIb2xlcyhhcnIpIHx8IFRhZ3NJbnB1dF9pdGVyYWJsZVRvQXJyYXlMaW1pdChhcnIsIGkpIHx8IFRhZ3NJbnB1dF91bnN1cHBvcnRlZEl0ZXJhYmxlVG9BcnJheShhcnIsIGkpIHx8IFRhZ3NJbnB1dF9ub25JdGVyYWJsZVJlc3QoKTt9ZnVuY3Rpb24gVGFnc0lucHV0X25vbkl0ZXJhYmxlUmVzdCgpIHt0aHJvdyBuZXcgVHlwZUVycm9yKCJJbnZhbGlkIGF0dGVtcHQgdG8gZGVzdHJ1Y3R1cmUgbm9uLWl0ZXJhYmxlIGluc3RhbmNlLlxuSW4gb3JkZXIgdG8gYmUgaXRlcmFibGUsIG5vbi1hcnJheSBvYmplY3RzIG11c3QgaGF2ZSBhIFtTeW1ib2wuaXRlcmF0b3JdKCkgbWV0aG9kLiIpO31mdW5jdGlvbiBUYWdzSW5wdXRfdW5zdXBwb3J0ZWRJdGVyYWJsZVRvQXJyYXkobywgbWluTGVuKSB7aWYgKCFvKSByZXR1cm47aWYgKHR5cGVvZiBvID09PSAic3RyaW5nIikgcmV0dXJuIFRhZ3NJbnB1dF9hcnJheUxpa2VUb0FycmF5KG8sIG1pbkxlbik7dmFyIG4gPSBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwobykuc2xpY2UoOCwgLTEpO2lmIChuID09PSAiT2JqZWN0IiAmJiBvLmNvbnN0cnVjdG9yKSBuID0gby5jb25zdHJ1Y3Rvci5uYW1lO2lmIChuID09PSAiTWFwIiB8fCBuID09PSAiU2V0IikgcmV0dXJuIEFycmF5LmZyb20obyk7aWYgKG4gPT09ICJBcmd1bWVudHMiIHx8IC9eKD86VWl8SSludCg/Ojh8MTZ8MzIpKD86Q2xhbXBlZCk/QXJyYXkkLy50ZXN0KG4pKSByZXR1cm4gVGFnc0lucHV0X2FycmF5TGlrZVRvQXJyYXkobywgbWluTGVuKTt9ZnVuY3Rpb24gVGFnc0lucHV0X2FycmF5TGlrZVRvQXJyYXkoYXJyLCBsZW4pIHtpZiAobGVuID09IG51bGwgfHwgbGVuID4gYXJyLmxlbmd0aCkgbGVuID0gYXJyLmxlbmd0aDtmb3IgKHZhciBpID0gMCwgYXJyMiA9IG5ldyBBcnJheShsZW4pOyBpIDwgbGVuOyBpKyspIGFycjJbaV0gPSBhcnJbaV07cmV0dXJuIGFycjI7fWZ1bmN0aW9uIFRhZ3NJbnB1dF9pdGVyYWJsZVRvQXJyYXlMaW1pdChhcnIsIGkpIHt2YXIgX2kgPSBudWxsID09IGFyciA/IG51bGwgOiAidW5kZWZpbmVkIiAhPSB0eXBlb2YgU3ltYm9sICYmIGFycltTeW1ib2wuaXRlcmF0b3JdIHx8IGFyclsiQEBpdGVyYXRvciJdO2lmIChudWxsICE9IF9pKSB7dmFyIF9zLF9lLF94LF9yLF9hcnIgPSBbXSxfbiA9ICEwLF9kID0gITE7dHJ5IHtpZiAoX3ggPSAoX2kgPSBfaS5jYWxsKGFycikpLm5leHQsIDAgPT09IGkpIHtpZiAoT2JqZWN0KF9pKSAhPT0gX2kpIHJldHVybjtfbiA9ICExO30gZWxzZSBmb3IgKDsgIShfbiA9IChfcyA9IF94LmNhbGwoX2kpKS5kb25lKSAmJiAoX2Fyci5wdXNoKF9zLnZhbHVlKSwgX2Fyci5sZW5ndGggIT09IGkpOyBfbiA9ICEwKTt9IGNhdGNoIChlcnIpIHtfZCA9ICEwLCBfZSA9IGVycjt9IGZpbmFsbHkge3RyeSB7aWYgKCFfbiAmJiBudWxsICE9IF9pWyJyZXR1cm4iXSAmJiAoX3IgPSBfaVsicmV0dXJuIl0oKSwgT2JqZWN0KF9yKSAhPT0gX3IpKSByZXR1cm47fSBmaW5hbGx5IHtpZiAoX2QpIHRocm93IF9lO319cmV0dXJuIF9hcnI7fX1mdW5jdGlvbiBUYWdzSW5wdXRfYXJyYXlXaXRoSG9sZXMoYXJyKSB7aWYgKEFycmF5LmlzQXJyYXkoYXJyKSkgcmV0dXJuIGFycjt9CgoKICAgICAgICAgIHZhciBDbG9zZUljb24gPSBmdW5jdGlvbiBDbG9zZUljb24oKSB7CiAgICAgICAgICAgIHJldHVybiAvKiNfX1BVUkVfXyovKAogICAgICAgICAgICAgIHJlYWN0LmNyZWF0ZUVsZW1lbnQoInN2ZyIsIHsgaGVpZ2h0OiAiMjAiLCB3aWR0aDogIjIwIiwgdmlld0JveDogIjAgMCAyMCAyMCIgfSwgLyojX19QVVJFX18qLwogICAgICAgICAgICAgIHJlYWN0LmNyZWF0ZUVsZW1lbnQoInBhdGgiLCB7IGQ6ICJNMTQuMzQ4IDE0Ljg0OWMtMC40NjkgMC40NjktMS4yMjkgMC40NjktMS42OTcgMGwtMi42NTEtMy4wMzAtMi42NTEgMy4wMjljLTAuNDY5IDAuNDY5LTEuMjI5IDAuNDY5LTEuNjk3IDAtMC40NjktMC40NjktMC40NjktMS4yMjkgMC0xLjY5N2wyLjc1OC0zLjE1LTIuNzU5LTMuMTUyYy0wLjQ2OS0wLjQ2OS0wLjQ2OS0xLjIyOCAwLTEuNjk3czEuMjI4LTAuNDY5IDEuNjk3IDBsMi42NTIgMy4wMzEgMi42NTEtMy4wMzFjMC40NjktMC40NjkgMS4yMjgtMC40NjkgMS42OTcgMHMwLjQ2OSAxLjIyOSAwIDEuNjk3bC0yLjc1OCAzLjE1MiAyLjc1OCAzLjE1YzAuNDY5IDAuNDY5IDAuNDY5IDEuMjI5IDAgMS42OTh6IiB9KSkpOwoKCiAgICAgICAgICB9OwoKICAgICAgICAgIHZhciBtYXBWYWx1ZXNUb0Rpc3BsYXkgPSBmdW5jdGlvbiBtYXBWYWx1ZXNUb0Rpc3BsYXkoYnV0dG9uLCB2YWx1ZXMpIHsKICAgICAgICAgICAgdmFyIHRhZ3MgPSBbXTsKCiAgICAgICAgICAgIHZhbHVlcy5mb3JFYWNoKGZ1bmN0aW9uICh2KSB7CiAgICAgICAgICAgICAgaWYgKGJ1dHRvbi5kcm9wZG93biA9PSBudWxsKSB7CiAgICAgICAgICAgICAgICB0YWdzLnB1c2goeyBkaXNwbGF5OiB2LCB2YWx1ZTogdiB9KTsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIHZhciBkcm9wID0gYnV0dG9uLmRyb3Bkb3duLmZpbmQoCiAgICAgICAgICAgICAgZnVuY3Rpb24gKGQpIHtyZXR1cm4gZC52YWx1ZS50b0xvd2VyQ2FzZSgpID09IHYudG9Mb3dlckNhc2UoKTt9KTsKCgogICAgICAgICAgICAgIGlmIChkcm9wID09IG51bGwpIHsKICAgICAgICAgICAgICAgIHRhZ3MucHVzaCh7IGRpc3BsYXk6IHYsIHZhbHVlOiB2IH0pOwogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgdGFncy5wdXNoKGRyb3ApOwogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIHJldHVybiB0YWdzOwogICAgICAgICAgfTsKCiAgICAgICAgICB2YXIgVGFnc0lucHV0ID0gZnVuY3Rpb24gVGFnc0lucHV0KF9yZWYpIHt2YXIgYnV0dG9uID0gX3JlZi5idXR0b247CiAgICAgICAgICAgIHZhciBfUmVhY3QkdXNlU3RhdGUgPSByZWFjdC51c2VTdGF0ZSgKICAgICAgICAgICAgICBtYXBWYWx1ZXNUb0Rpc3BsYXkoCiAgICAgICAgICAgICAgYnV0dG9uLAogICAgICAgICAgICAgIGJ1dHRvbi52YWx1ZS5zcGxpdChidXR0b24udGFnc1NlcGVyYXRvcikuZmlsdGVyKGZ1bmN0aW9uIChzKSB7cmV0dXJuIHMubGVuZ3RoID4gMDt9KSkpLF9SZWFjdCR1c2VTdGF0ZTIgPSBUYWdzSW5wdXRfc2xpY2VkVG9BcnJheShfUmVhY3QkdXNlU3RhdGUsIDIpLHRhZ3MgPSBfUmVhY3QkdXNlU3RhdGUyWzBdLHNldFRhZ3MgPSBfUmVhY3QkdXNlU3RhdGUyWzFdOwoKCgogICAgICAgICAgICB2YXIgYWRkVGFnID0gZnVuY3Rpb24gYWRkVGFnKHRhZykgewogICAgICAgICAgICAgIHNldFNlYXJjaFZhbHVlKCIiKTsKICAgICAgICAgICAgICBzZXRUYWdzKFtdLmNvbmNhdChfdG9Db25zdW1hYmxlQXJyYXkodGFncyksIFt0YWddKSk7CgogICAgICAgICAgICAgIHZhciB2YWxzID0gYnV0dG9uLnZhbHVlLgogICAgICAgICAgICAgIHNwbGl0KGJ1dHRvbi50YWdzU2VwZXJhdG9yKS4KICAgICAgICAgICAgICBmaWx0ZXIoZnVuY3Rpb24gKHMpIHtyZXR1cm4gcy5sZW5ndGggPiAwO30pOwogICAgICAgICAgICAgIHZhbHMucHVzaCh0YWcudmFsdWUpOwoKICAgICAgICAgICAgICBidXR0b24uc2V0VmFsdWUodmFscy5qb2luKGJ1dHRvbi50YWdzU2VwZXJhdG9yKSk7CiAgICAgICAgICAgIH07CgogICAgICAgICAgICAvLyBBZGQgb3IgcmVtb3ZlIHRhZ3MgYnkgdXNpbmcgdGhlIGtleQogICAgICAgICAgICB2YXIgaGFuZGxlVGFncyA9IGZ1bmN0aW9uIGhhbmRsZVRhZ3MoZXZlbnQpIHsKICAgICAgICAgICAgICBpZiAoZXZlbnQua2V5ID09PSAiRW50ZXIiICYmIGV2ZW50LmN1cnJlbnRUYXJnZXQudmFsdWUgIT09ICIiKSB7CiAgICAgICAgICAgICAgICB2YXIgZHJvcGRvd25WYWx1ZSA9CiAgICAgICAgICAgICAgICBidXR0b24uZHJvcGRvd24gIT0gbnVsbCA/CiAgICAgICAgICAgICAgICBidXR0b24uZHJvcGRvd24uZmluZCgKICAgICAgICAgICAgICAgIGZ1bmN0aW9uIChkKSB7cmV0dXJuICgKICAgICAgICAgICAgICAgICAgICBkLmRpc3BsYXkudG9Mb3dlckNhc2UoKSA9PQogICAgICAgICAgICAgICAgICAgIGV2ZW50LmN1cnJlbnRUYXJnZXQudmFsdWUudG9Mb3dlckNhc2UoKSk7fSkgOgoKICAgICAgICAgICAgICAgIG51bGw7CgogICAgICAgICAgICAgICAgaWYgKGJ1dHRvbi5kcm9wZG93biAhPSBudWxsICYmIGRyb3Bkb3duVmFsdWUgPT0gbnVsbCkgewogICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgdmFyIHZhbCA9CiAgICAgICAgICAgICAgICBkcm9wZG93blZhbHVlICE9IG51bGwgPyBkcm9wZG93blZhbHVlLnZhbHVlIDogZXZlbnQuY3VycmVudFRhcmdldC52YWx1ZTsKCiAgICAgICAgICAgICAgICBpZiAoIWJ1dHRvbi5hbGxvd0R1cGxpY2F0ZVRhZ3MpIHsKICAgICAgICAgICAgICAgICAgaWYgKAogICAgICAgICAgICAgICAgICBidXR0b24udmFsdWUuCiAgICAgICAgICAgICAgICAgIHNwbGl0KGJ1dHRvbi50YWdzU2VwZXJhdG9yKS4KICAgICAgICAgICAgICAgICAgZmluZChmdW5jdGlvbiAoZCkge3JldHVybiBkLnRvTG93ZXJDYXNlKCkgPT0gdmFsLnRvTG93ZXJDYXNlKCk7fSkgIT0gbnVsbCkKICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGFkZFRhZygKICAgICAgICAgICAgICAgIGRyb3Bkb3duVmFsdWUgIT0gbnVsbCA/IGRyb3Bkb3duVmFsdWUgOiB7IGRpc3BsYXk6IHZhbCwgdmFsdWU6IHZhbCB9KTsKCiAgICAgICAgICAgICAgfSBlbHNlIGlmICgKICAgICAgICAgICAgICBldmVudC5rZXkgPT09ICJCYWNrc3BhY2UiICYmCiAgICAgICAgICAgICAgdGFncy5sZW5ndGggJiYKICAgICAgICAgICAgICBldmVudC5jdXJyZW50VGFyZ2V0LnZhbHVlLmxlbmd0aCA9PSAwKQogICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIHNldFNlYXJjaFZhbHVlKHRhZ3NbdGFncy5sZW5ndGggLSAxXS5kaXNwbGF5KTsKCiAgICAgICAgICAgICAgICB2YXIgdGFnc0NvcHkgPSBfdG9Db25zdW1hYmxlQXJyYXkodGFncyk7CiAgICAgICAgICAgICAgICB0YWdzQ29weS5wb3AoKTsKICAgICAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgICAgICAgICBzZXRUYWdzKHRhZ3NDb3B5KTsKCiAgICAgICAgICAgICAgICB2YXIgdmFscyA9IGJ1dHRvbi52YWx1ZS4KICAgICAgICAgICAgICAgIHNwbGl0KGJ1dHRvbi50YWdzU2VwZXJhdG9yKS4KICAgICAgICAgICAgICAgIGZpbHRlcihmdW5jdGlvbiAocykge3JldHVybiBzLmxlbmd0aCA+IDA7fSk7CiAgICAgICAgICAgICAgICB2YWxzLnBvcCgpOwogICAgICAgICAgICAgICAgYnV0dG9uLnNldFZhbHVlKHZhbHMuam9pbihidXR0b24udGFnc1NlcGVyYXRvcikpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfTsKCiAgICAgICAgICAgIC8vUmVtb3ZlIHRhZ3MgYnkgY2xpY2tpbmcgdGhlIGNyb3NzIHNpZ24KICAgICAgICAgICAgdmFyIHJlbW92ZVRhZ3MgPSBmdW5jdGlvbiByZW1vdmVUYWdzKGluZGV4KSB7CiAgICAgICAgICAgICAgc2V0TGFzdEluc2VydGVkKC0xKTsKICAgICAgICAgICAgICBzZXRUYWdzKF90b0NvbnN1bWFibGVBcnJheSh0YWdzLmZpbHRlcihmdW5jdGlvbiAodGFnLCBpbmQpIHtyZXR1cm4gaW5kICE9PSBpbmRleDt9KSkpOwoKICAgICAgICAgICAgICB2YXIgdmFscyA9IGJ1dHRvbi52YWx1ZS4KICAgICAgICAgICAgICBzcGxpdChidXR0b24udGFnc1NlcGVyYXRvcikuCiAgICAgICAgICAgICAgZmlsdGVyKGZ1bmN0aW9uIChzKSB7cmV0dXJuIHMubGVuZ3RoID4gMDt9KS4KICAgICAgICAgICAgICBmaWx0ZXIoZnVuY3Rpb24gKHYsIGluZCkge3JldHVybiBpbmQgIT09IGluZGV4O30pOwoKICAgICAgICAgICAgICBidXR0b24uc2V0VmFsdWUodmFscy5qb2luKGJ1dHRvbi50YWdzU2VwZXJhdG9yKSk7CiAgICAgICAgICAgIH07CgogICAgICAgICAgICB2YXIgX3VzZVN0YXRlID0gKDAsIHJlYWN0LnVzZVN0YXRlKShmYWxzZSksX3VzZVN0YXRlMiA9IFRhZ3NJbnB1dF9zbGljZWRUb0FycmF5KF91c2VTdGF0ZSwgMiksc2hvd01lbnUgPSBfdXNlU3RhdGUyWzBdLHNldFNob3dNZW51ID0gX3VzZVN0YXRlMlsxXTsKICAgICAgICAgICAgdmFyIF91c2VTdGF0ZTMgPSAoMCwgcmVhY3QudXNlU3RhdGUpKCIiKSxfdXNlU3RhdGU0ID0gVGFnc0lucHV0X3NsaWNlZFRvQXJyYXkoX3VzZVN0YXRlMywgMiksc2VhcmNoVmFsdWUgPSBfdXNlU3RhdGU0WzBdLHNldFNlYXJjaFZhbHVlID0gX3VzZVN0YXRlNFsxXTsKICAgICAgICAgICAgdmFyIHNlYXJjaFJlZiA9IC8qI19fUFVSRV9fKi9yZWFjdC5jcmVhdGVSZWYoKTsKICAgICAgICAgICAgdmFyIHNlYXJjaENvbnRhaW5lclJlZiA9IC8qI19fUFVSRV9fKi9yZWFjdC5jcmVhdGVSZWYoKTsKICAgICAgICAgICAgdmFyIGlucHV0UmVmID0gLyojX19QVVJFX18qL3JlYWN0LmNyZWF0ZVJlZigpOwogICAgICAgICAgICB2YXIgX3VzZVN0YXRlNSA9ICgwLCByZWFjdC51c2VTdGF0ZSkoLTEpLF91c2VTdGF0ZTYgPSBUYWdzSW5wdXRfc2xpY2VkVG9BcnJheShfdXNlU3RhdGU1LCAyKSxpbnNlcnRJbmRleEF0ID0gX3VzZVN0YXRlNlswXSxzZXRJbnNlcnRJbmRleEF0ID0gX3VzZVN0YXRlNlsxXTsKICAgICAgICAgICAgdmFyIF91c2VTdGF0ZTcgPSAoMCwgcmVhY3QudXNlU3RhdGUpKC0xKSxfdXNlU3RhdGU4ID0gVGFnc0lucHV0X3NsaWNlZFRvQXJyYXkoX3VzZVN0YXRlNywgMiksZHJhZ2dlZEl0ZW0gPSBfdXNlU3RhdGU4WzBdLHNldERyYWdnZWRJdGVtID0gX3VzZVN0YXRlOFsxXTsKICAgICAgICAgICAgdmFyIF91c2VTdGF0ZTkgPSAoMCwgcmVhY3QudXNlU3RhdGUpKC0xKSxfdXNlU3RhdGUxMCA9IFRhZ3NJbnB1dF9zbGljZWRUb0FycmF5KF91c2VTdGF0ZTksIDIpLGxhc3RJbnNlcnRlZCA9IF91c2VTdGF0ZTEwWzBdLHNldExhc3RJbnNlcnRlZCA9IF91c2VTdGF0ZTEwWzFdOwogICAgICAgICAgICB2YXIgX3VzZVN0YXRlMTEgPSAoMCwgcmVhY3QudXNlU3RhdGUpKDApLF91c2VTdGF0ZTEyID0gVGFnc0lucHV0X3NsaWNlZFRvQXJyYXkoX3VzZVN0YXRlMTEsIDIpLGRyYWdnZWRXaWR0aCA9IF91c2VTdGF0ZTEyWzBdLHNldERyYWdnZWRXaWR0aCA9IF91c2VTdGF0ZTEyWzFdOwogICAgICAgICAgICB2YXIgX3VzZVN0YXRlMTMgPSAoMCwgcmVhY3QudXNlU3RhdGUpKDApLF91c2VTdGF0ZTE0ID0gVGFnc0lucHV0X3NsaWNlZFRvQXJyYXkoX3VzZVN0YXRlMTMsIDIpLGRyYWdnZWRIZWlnaHQgPSBfdXNlU3RhdGUxNFswXSxzZXREcmFnZ2VkSGVpZ2h0ID0gX3VzZVN0YXRlMTRbMV07CgogICAgICAgICAgICAoMCwgcmVhY3QudXNlRWZmZWN0KShmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgaWYgKHNob3dNZW51ICYmIHNlYXJjaFJlZi5jdXJyZW50KSB7CiAgICAgICAgICAgICAgICBzZWFyY2hSZWYuY3VycmVudC5mb2N1cygpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwgW3Nob3dNZW51XSk7CgogICAgICAgICAgICB2YXIgb25BZGRUYWcgPSBmdW5jdGlvbiBvbkFkZFRhZyhvcHRpb24pIHsKICAgICAgICAgICAgICBpZiAoCiAgICAgICAgICAgICAgIWJ1dHRvbi5hbGxvd0R1cGxpY2F0ZVRhZ3MgJiYKICAgICAgICAgICAgICB0YWdzLmZpbmQoZnVuY3Rpb24gKHQpIHsKICAgICAgICAgICAgICAgIHQudmFsdWUgPT0gb3B0aW9uLnZhbHVlOwogICAgICAgICAgICAgIH0pKQogICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIGFkZFRhZyhvcHRpb24pOwoKICAgICAgICAgICAgICBpZiAoc2VhcmNoUmVmLmN1cnJlbnQgIT0gZG9jdW1lbnQuYWN0aXZlRWxlbWVudCkgewogICAgICAgICAgICAgICAgc2V0U2hvd01lbnUoZmFsc2UpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfTsKCiAgICAgICAgICAgIHZhciBvblNlYXJjaCA9IGZ1bmN0aW9uIG9uU2VhcmNoKGUpIHsKICAgICAgICAgICAgICBzZXRTZWFyY2hWYWx1ZShlLnRhcmdldC52YWx1ZSk7CiAgICAgICAgICAgIH07CgogICAgICAgICAgICB2YXIgZ2V0T3B0aW9ucyA9IGZ1bmN0aW9uIGdldE9wdGlvbnMoKSB7CiAgICAgICAgICAgICAgdmFyIG9wdHMgPSBidXR0b24uYWxsb3dEdXBsaWNhdGVUYWdzID8KICAgICAgICAgICAgICBidXR0b24uZHJvcGRvd24gOgogICAgICAgICAgICAgIGJ1dHRvbi5kcm9wZG93bi5maWx0ZXIoZnVuY3Rpb24gKGQpIHtyZXR1cm4gIXRhZ3MuaW5jbHVkZXMoZCk7fSk7CgogICAgICAgICAgICAgIGlmICghc2VhcmNoVmFsdWUpIHsKICAgICAgICAgICAgICAgIHJldHVybiBvcHRzOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgcmV0dXJuIG9wdHMuZmlsdGVyKAogICAgICAgICAgICAgIGZ1bmN0aW9uIChvcHRpb24pIHtyZXR1cm4gKAogICAgICAgICAgICAgICAgICBvcHRpb24uZGlzcGxheS50b0xvd2VyQ2FzZSgpLmluZGV4T2Yoc2VhcmNoVmFsdWUudG9Mb3dlckNhc2UoKSkgPj0gMCk7fSk7CgogICAgICAgICAgICB9OwoKICAgICAgICAgICAgdmFyIGRyb3Bkb3duRm9jdXNIYW5kbGVyID0gZnVuY3Rpb24gZHJvcGRvd25Gb2N1c0hhbmRsZXIoKSB7CiAgICAgICAgICAgICAgaWYgKHNlYXJjaENvbnRhaW5lclJlZi5jdXJyZW50ID09IG51bGwpIHsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIGlmICghKGRvY3VtZW50LmFjdGl2ZUVsZW1lbnQgaW5zdGFuY2VvZiBOb2RlKSkgewogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgaWYgKHNlYXJjaENvbnRhaW5lclJlZi5jdXJyZW50LmNvbnRhaW5zKGRvY3VtZW50LmFjdGl2ZUVsZW1lbnQpKSB7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBzZXRTaG93TWVudShmYWxzZSk7CiAgICAgICAgICAgIH07CgogICAgICAgICAgICAoMCwgcmVhY3QudXNlRWZmZWN0KShmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoImNsaWNrIiwgZnVuY3Rpb24gKCkge3JldHVybiBkcm9wZG93bkZvY3VzSGFuZGxlcigpO30pOwoKICAgICAgICAgICAgICByZXR1cm4gZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgd2luZG93LnJlbW92ZUV2ZW50TGlzdGVuZXIoImNsaWNrIiwgZnVuY3Rpb24gKCkge3JldHVybiBkcm9wZG93bkZvY3VzSGFuZGxlcigpO30pOwogICAgICAgICAgICAgIH07CiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgdmFyIHVwZGF0ZUluZGV4SW5zZXJ0ID0gZnVuY3Rpb24gdXBkYXRlSW5kZXhJbnNlcnQoZSkge3ZhciBfdGFnJGdldEF0dHJpYnV0ZTsKICAgICAgICAgICAgICBpZiAoaW5wdXRSZWYuY3VycmVudCA9PSBudWxsKSB7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICB2YXIgdGFnID0gZS5jdXJyZW50VGFyZ2V0OwogICAgICAgICAgICAgIHZhciB0YWdJZCA9ICsoKF90YWckZ2V0QXR0cmlidXRlID0gdGFnLmdldEF0dHJpYnV0ZSgiZGF0YS1rZXkiKSkgIT09IG51bGwgJiYgX3RhZyRnZXRBdHRyaWJ1dGUgIT09IHZvaWQgMCA/IF90YWckZ2V0QXR0cmlidXRlIDogLTEwKTsKCiAgICAgICAgICAgICAgdmFyIGIgPQogICAgICAgICAgICAgIHRhZy5xdWVyeVNlbGVjdG9yKCIuc2V0dGluZ1RhZ1NpbmdsZSIpLgogICAgICAgICAgICAgIGdldEJvdW5kaW5nQ2xpZW50UmVjdCgpOwogICAgICAgICAgICAgIHZhciBvZmZzZXQgPSBlLmNsaWVudFggLSAoYi5sZWZ0ICsgYi53aWR0aCAvIDIpOwoKICAgICAgICAgICAgICBpZiAob2Zmc2V0ID49IDApIHsKICAgICAgICAgICAgICAgIHRhZ0lkKys7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBzZXRJbnNlcnRJbmRleEF0KHRhZ0lkKTsKICAgICAgICAgICAgfTsKCiAgICAgICAgICAgIHZhciBkcmFnRW5kID0gZnVuY3Rpb24gZHJhZ0VuZCgpIHsKICAgICAgICAgICAgICBpZiAoZHJhZ2dlZEl0ZW0gPT0gLTEpIHsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIGlmIChpbnNlcnRJbmRleEF0IC0gMSAhPSBkcmFnZ2VkSXRlbSAmJiBpbnNlcnRJbmRleEF0ICE9IGRyYWdnZWRJdGVtKSB7CiAgICAgICAgICAgICAgICB2YXIgbmV3SW5kZXggPSBpbnNlcnRJbmRleEF0OwogICAgICAgICAgICAgICAgdmFyIG5ld1RhZ3MgPSBfdG9Db25zdW1hYmxlQXJyYXkodGFncyk7CiAgICAgICAgICAgICAgICBuZXdUYWdzLnNwbGljZShkcmFnZ2VkSXRlbSwgMSk7CiAgICAgICAgICAgICAgICBuZXdUYWdzLnNwbGljZSgKICAgICAgICAgICAgICAgIG5ld0luZGV4IC0gKGRyYWdnZWRJdGVtIDwgbmV3SW5kZXggPyAxIDogMCksCiAgICAgICAgICAgICAgICAwLAogICAgICAgICAgICAgICAgdGFnc1tkcmFnZ2VkSXRlbV0pOwoKCiAgICAgICAgICAgICAgICBzZXRUYWdzKG5ld1RhZ3MpOwogICAgICAgICAgICAgICAgc2V0TGFzdEluc2VydGVkKG5ld0luZGV4IC0gKGRyYWdnZWRJdGVtIDwgbmV3SW5kZXggPyAxIDogMCkpOwogICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBzZXRMYXN0SW5zZXJ0ZWQoLTEpOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgc2V0RHJhZ2dlZEl0ZW0oLTEpOwogICAgICAgICAgICAgIHNldEluc2VydEluZGV4QXQoLTEpOwogICAgICAgICAgICB9OwoKICAgICAgICAgICAgdmFyIHN0cmluZ1RvQ29sb3VyID0gZnVuY3Rpb24gc3RyaW5nVG9Db2xvdXIoc3RyKSB7CiAgICAgICAgICAgICAgdmFyIGhhc2ggPSAwOwoKICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHN0ci5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAgaGFzaCA9IHN0ci5jaGFyQ29kZUF0KGkpICsgKChoYXNoIDw8IDUpIC0gaGFzaCk7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICB2YXIgY29sb3VyID0gIiMiOwoKICAgICAgICAgICAgICBmb3IgKHZhciBfaTIgPSAwOyBfaTIgPCAzOyBfaTIrKykgewogICAgICAgICAgICAgICAgdmFyIHZhbHVlID0gaGFzaCA+PiBfaTIgKiA4ICYgMHhmZjsKICAgICAgICAgICAgICAgIGNvbG91ciArPSAoIjAwIiArIHZhbHVlLnRvU3RyaW5nKDE2KSkuc3Vic3RyKC0yKTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIHJldHVybiBjb2xvdXI7CiAgICAgICAgICAgIH07CgogICAgICAgICAgICByZXR1cm4gLyojX19QVVJFX18qLygKICAgICAgICAgICAgICByZWFjdC5jcmVhdGVFbGVtZW50KCJkaXYiLCB7IGNsYXNzTmFtZTogInNldHRpbmdUYWciLCByZWY6IGlucHV0UmVmIH0sCiAgICAgICAgICAgICAgdGFncy5tYXAoZnVuY3Rpb24gKHRhZywgaW5kZXgpIHtyZXR1cm4gLyojX19QVVJFX18qLygKICAgICAgICAgICAgICAgICAgcmVhY3QuY3JlYXRlRWxlbWVudChyZWFjdC5GcmFnbWVudCwgeyBrZXk6ICIiLmNvbmNhdCh0YWcuZGlzcGxheSwgIiAiKS5jb25jYXQodGFnLnZhbHVlLCAiICIpLmNvbmNhdChpbmRleCkgfSwKICAgICAgICAgICAgICAgICAgZHJhZ2dlZEl0ZW0gPj0gMCAmJgogICAgICAgICAgICAgICAgICBpbmRleCA9PSAwICYmCiAgICAgICAgICAgICAgICAgIGluZGV4ID09IGluc2VydEluZGV4QXQgJiYKICAgICAgICAgICAgICAgICAgaW5zZXJ0SW5kZXhBdCAhPSBkcmFnZ2VkSXRlbSAmJgogICAgICAgICAgICAgICAgICBkcmFnZ2VkSXRlbSAhPSBpbnNlcnRJbmRleEF0IC0gMSA/IC8qI19fUFVSRV9fKi8KICAgICAgICAgICAgICAgICAgcmVhY3QuY3JlYXRlRWxlbWVudCgiZGl2IiwgewogICAgICAgICAgICAgICAgICAgIGNsYXNzTmFtZTogImhpbnRUYWdEcm9wIiwKICAgICAgICAgICAgICAgICAgICBvbkRyYWdPdmVyOiBmdW5jdGlvbiBvbkRyYWdPdmVyKGUpIHsKICAgICAgICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTsKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHN0eWxlOiB7CiAgICAgICAgICAgICAgICAgICAgICB3aWR0aDogZHJhZ2dlZFdpZHRoICsgInB4IiwKICAgICAgICAgICAgICAgICAgICAgIGhlaWdodDogZHJhZ2dlZEhlaWdodCArICJweCIKICAgICAgICAgICAgICAgICAgICB9IH0pIDogLyojX19QVVJFX18qLwoKCiAgICAgICAgICAgICAgICAgIHJlYWN0LmNyZWF0ZUVsZW1lbnQocmVhY3QuRnJhZ21lbnQsIG51bGwpLAoKICAgICAgICAgICAgICAgICAgZHJhZ2dlZEl0ZW0gPT0gaW5kZXggPyAvKiNfX1BVUkVfXyovCiAgICAgICAgICAgICAgICAgIHJlYWN0LmNyZWF0ZUVsZW1lbnQoImRpdiIsIHsKICAgICAgICAgICAgICAgICAgICBjbGFzc05hbWU6ICJoaW50VGFnRHJvcCBoaW50VGFnRHJvcE9yaWdpbmFsIiwKICAgICAgICAgICAgICAgICAgICBvbkRyYWdPdmVyOiBmdW5jdGlvbiBvbkRyYWdPdmVyKGUpIHsKICAgICAgICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTsKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHN0eWxlOiB7CiAgICAgICAgICAgICAgICAgICAgICB3aWR0aDogZHJhZ2dlZFdpZHRoICsgInB4IiwKICAgICAgICAgICAgICAgICAgICAgIGhlaWdodDogZHJhZ2dlZEhlaWdodCArICJweCIsCiAgICAgICAgICAgICAgICAgICAgICBkaXNwbGF5OgogICAgICAgICAgICAgICAgICAgICAgaW5zZXJ0SW5kZXhBdCA9PSBpbmRleCB8fCBpbnNlcnRJbmRleEF0IC0gMSA9PSBpbmRleCA/CiAgICAgICAgICAgICAgICAgICAgICAiaW5saW5lIiA6CiAgICAgICAgICAgICAgICAgICAgICAibm9uZSIKICAgICAgICAgICAgICAgICAgICB9IH0pIDogLyojX19QVVJFX18qLwoKCiAgICAgICAgICAgICAgICAgIHJlYWN0LmNyZWF0ZUVsZW1lbnQocmVhY3QuRnJhZ21lbnQsIG51bGwpLCAvKiNfX1BVUkVfXyovCgogICAgICAgICAgICAgICAgICByZWFjdC5jcmVhdGVFbGVtZW50KCJkaXYiLCB7CiAgICAgICAgICAgICAgICAgICAgZHJhZ2dhYmxlOiB0cnVlLAogICAgICAgICAgICAgICAgICAgIG9uRHJhZ1N0YXJ0OiBmdW5jdGlvbiBvbkRyYWdTdGFydChlKSB7CiAgICAgICAgICAgICAgICAgICAgICB2YXIgaW5kID0gaW5kZXg7CiAgICAgICAgICAgICAgICAgICAgICB2YXIgd2lkID0gZS5jdXJyZW50VGFyZ2V0LmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLndpZHRoIC0gMTA7CiAgICAgICAgICAgICAgICAgICAgICB2YXIgaGVpZ2h0ID0gZS5jdXJyZW50VGFyZ2V0LmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLmhlaWdodCAtIDI7CgogICAgICAgICAgICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHNldEluc2VydEluZGV4QXQoaW5kKTsKICAgICAgICAgICAgICAgICAgICAgICAgc2V0RHJhZ2dlZEl0ZW0oaW5kKTsKICAgICAgICAgICAgICAgICAgICAgICAgc2V0RHJhZ2dlZFdpZHRoKHdpZCk7CiAgICAgICAgICAgICAgICAgICAgICAgIHNldERyYWdnZWRIZWlnaHQoaGVpZ2h0KTsKICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgb25EcmFnRW5kOiBmdW5jdGlvbiBvbkRyYWdFbmQoKSB7CiAgICAgICAgICAgICAgICAgICAgICBkcmFnRW5kKCk7CiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBvbkRyYWdPdmVyOiBmdW5jdGlvbiBvbkRyYWdPdmVyKGUpIHsKICAgICAgICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTsKCiAgICAgICAgICAgICAgICAgICAgICB1cGRhdGVJbmRleEluc2VydChlKTsKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgICJkYXRhLWtleSI6IGluZGV4LAogICAgICAgICAgICAgICAgICAgIGNsYXNzTmFtZTogInRhZ0NvbnRhaW5lciIgKyAoZHJhZ2dlZEl0ZW0gPT0gaW5kZXggPyAiIGhpZGRlbiIgOiAiIikgfSwgLyojX19QVVJFX18qLwoKICAgICAgICAgICAgICAgICAgcmVhY3QuY3JlYXRlRWxlbWVudCgiZGl2IiwgewogICAgICAgICAgICAgICAgICAgIGNsYXNzTmFtZToKICAgICAgICAgICAgICAgICAgICAic2V0dGluZ1RhZ1NpbmdsZSIgKyAoCiAgICAgICAgICAgICAgICAgICAgaW5kZXggPT0gZHJhZ2dlZEl0ZW0gPyAiIGRyYWdnZWRJdGVtIiA6ICIiKSArICgKICAgICAgICAgICAgICAgICAgICBsYXN0SW5zZXJ0ZWQgPT0gaW5kZXggPyAiIHJlYXJyYW5nZWRUYWciIDogIiIpLAoKICAgICAgICAgICAgICAgICAgICBzdHlsZTogewogICAgICAgICAgICAgICAgICAgICAgYmFja2dyb3VuZENvbG9yOiAiIi5jb25jYXQoc3RyaW5nVG9Db2xvdXIoIiIuY29uY2F0KAogICAgICAgICAgICAgICAgICAgICAgdGFnLmRpc3BsYXksICIgIikuY29uY2F0KHRhZy52YWx1ZSkpLCAiMjIiKQoKICAgICAgICAgICAgICAgICAgICB9IH0sIC8qI19fUFVSRV9fKi8KCiAgICAgICAgICAgICAgICAgIHJlYWN0LmNyZWF0ZUVsZW1lbnQoInNwYW4iLCBudWxsLCB0YWcuZGlzcGxheSksIC8qI19fUFVSRV9fKi8KICAgICAgICAgICAgICAgICAgcmVhY3QuY3JlYXRlRWxlbWVudCgiZGl2IiwgewogICAgICAgICAgICAgICAgICAgIGNsYXNzTmFtZTogInNldHRpbmdUYWdDbG9zZSIsCiAgICAgICAgICAgICAgICAgICAgb25DbGljazogZnVuY3Rpb24gb25DbGljaygpIHtyZXR1cm4gcmVtb3ZlVGFncyhpbmRleCk7fSB9LCAvKiNfX1BVUkVfXyovCgogICAgICAgICAgICAgICAgICByZWFjdC5jcmVhdGVFbGVtZW50KENsb3NlSWNvbiwgbnVsbCkpKSksCgoKCiAgICAgICAgICAgICAgICAgIGRyYWdnZWRJdGVtID49IDAgJiYKICAgICAgICAgICAgICAgICAgaW5kZXggKyAxID09IGluc2VydEluZGV4QXQgJiYKICAgICAgICAgICAgICAgICAgZHJhZ2dlZEl0ZW0gKyAxICE9IGluc2VydEluZGV4QXQgJiYKICAgICAgICAgICAgICAgICAgZHJhZ2dlZEl0ZW0gIT0gaW5zZXJ0SW5kZXhBdCA/IC8qI19fUFVSRV9fKi8KICAgICAgICAgICAgICAgICAgcmVhY3QuY3JlYXRlRWxlbWVudCgiZGl2IiwgewogICAgICAgICAgICAgICAgICAgIGNsYXNzTmFtZTogImhpbnRUYWdEcm9wIiwKICAgICAgICAgICAgICAgICAgICBvbkRyYWdPdmVyOiBmdW5jdGlvbiBvbkRyYWdPdmVyKGUpIHsKICAgICAgICAgICAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTsKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIHN0eWxlOiB7CiAgICAgICAgICAgICAgICAgICAgICB3aWR0aDogZHJhZ2dlZFdpZHRoICsgInB4IiwKICAgICAgICAgICAgICAgICAgICAgIGhlaWdodDogZHJhZ2dlZEhlaWdodCArICJweCIKICAgICAgICAgICAgICAgICAgICB9IH0pIDogLyojX19QVVJFX18qLwoKCiAgICAgICAgICAgICAgICAgIHJlYWN0LmNyZWF0ZUVsZW1lbnQocmVhY3QuRnJhZ21lbnQsIG51bGwpKSk7fSksIC8qI19fUFVSRV9fKi8KCgoKICAgICAgICAgICAgICByZWFjdC5jcmVhdGVFbGVtZW50KCJkaXYiLCB7CiAgICAgICAgICAgICAgICByZWY6IHNlYXJjaENvbnRhaW5lclJlZiwKICAgICAgICAgICAgICAgIGNsYXNzTmFtZToKICAgICAgICAgICAgICAgICJzZXR0aW5nVGFnSW5wdXQiICsgKAogICAgICAgICAgICAgICAgYnV0dG9uLm1heFRhZ3MgJiYgdGFncy5sZW5ndGggPj0gcGFyc2VJbnQoYnV0dG9uLm1heFRhZ3MpID8KICAgICAgICAgICAgICAgICIgaGlkZGVuIiA6CiAgICAgICAgICAgICAgICAiIikgfSwgLyojX19QVVJFX18qLwoKCiAgICAgICAgICAgICAgcmVhY3QuY3JlYXRlRWxlbWVudCgiZGl2IiwgbnVsbCwgLyojX19QVVJFX18qLwogICAgICAgICAgICAgIHJlYWN0LmNyZWF0ZUVsZW1lbnQoImlucHV0IiwgewogICAgICAgICAgICAgICAgdHlwZTogInRleHQiLAogICAgICAgICAgICAgICAgb25DaGFuZ2U6IG9uU2VhcmNoLAogICAgICAgICAgICAgICAgcGxhY2Vob2xkZXI6IGJ1dHRvbi5wbGFjZWhvbGRlclRleHQgPyBidXR0b24ucGxhY2Vob2xkZXJUZXh0IDogIiIsCiAgICAgICAgICAgICAgICB2YWx1ZTogc2VhcmNoVmFsdWUsCiAgICAgICAgICAgICAgICByZWY6IHNlYXJjaFJlZiwKICAgICAgICAgICAgICAgIG9uRm9jdXM6IGZ1bmN0aW9uIG9uRm9jdXMoKSB7cmV0dXJuIHNldFNob3dNZW51KHRydWUpO30sCiAgICAgICAgICAgICAgICBvbktleURvd246IGZ1bmN0aW9uIG9uS2V5RG93bihldmVudCkge3JldHVybiBoYW5kbGVUYWdzKGV2ZW50KTt9LAogICAgICAgICAgICAgICAgc2l6ZTogMTAgfSkpLAoKCgogICAgICAgICAgICAgIGJ1dHRvbi5kcm9wZG93biA9PSBudWxsID8gLyojX19QVVJFX18qLwogICAgICAgICAgICAgIHJlYWN0LmNyZWF0ZUVsZW1lbnQocmVhY3QuRnJhZ21lbnQsIG51bGwpIDogLyojX19QVVJFX18qLwoKICAgICAgICAgICAgICByZWFjdC5jcmVhdGVFbGVtZW50KHJlYWN0LkZyYWdtZW50LCBudWxsLAogICAgICAgICAgICAgIHNob3dNZW51ICYmIGdldE9wdGlvbnMoKS5sZW5ndGggPiAwICYmIC8qI19fUFVSRV9fKi8KICAgICAgICAgICAgICByZWFjdC5jcmVhdGVFbGVtZW50KCJkaXYiLCB7IGNsYXNzTmFtZTogImRyb3Bkb3duTWVudSIgfSwKICAgICAgICAgICAgICBnZXRPcHRpb25zKCkubWFwKGZ1bmN0aW9uIChvcHRpb24sIGluZGV4KSB7cmV0dXJuIC8qI19fUFVSRV9fKi8oCiAgICAgICAgICAgICAgICAgIHJlYWN0LmNyZWF0ZUVsZW1lbnQoImRpdiIsIHsKICAgICAgICAgICAgICAgICAgICBrZXk6IGluZGV4LAogICAgICAgICAgICAgICAgICAgIG9uQ2xpY2s6IGZ1bmN0aW9uIG9uQ2xpY2soKSB7cmV0dXJuIG9uQWRkVGFnKG9wdGlvbik7fSwKICAgICAgICAgICAgICAgICAgICBjbGFzc05hbWU6ICJkcm9wZG93bkl0ZW0iIH0sCgogICAgICAgICAgICAgICAgICBvcHRpb24uZGlzcGxheSkpO30pKSkpKSk7CgoKCgoKCgoKCiAgICAgICAgICB9OwoKICAgICAgICAgIC8qIGhhcm1vbnkgZGVmYXVsdCBleHBvcnQgKi92YXIgc2V0dGluZ3NfVGFnc0lucHV0ID0gVGFnc0lucHV0OwogICAgICAgICAgOyAvLyBDT05DQVRFTkFURUQgTU9EVUxFOiAuL3NyYy9yZWxheS9jb21wb25lbnRzL3NldHRpbmdzL1NldHRpbmcudHN4CiAgICAgICAgICBmdW5jdGlvbiBTZXR0aW5nX3NsaWNlZFRvQXJyYXkoYXJyLCBpKSB7cmV0dXJuIFNldHRpbmdfYXJyYXlXaXRoSG9sZXMoYXJyKSB8fCBTZXR0aW5nX2l0ZXJhYmxlVG9BcnJheUxpbWl0KGFyciwgaSkgfHwgU2V0dGluZ191bnN1cHBvcnRlZEl0ZXJhYmxlVG9BcnJheShhcnIsIGkpIHx8IFNldHRpbmdfbm9uSXRlcmFibGVSZXN0KCk7fWZ1bmN0aW9uIFNldHRpbmdfbm9uSXRlcmFibGVSZXN0KCkge3Rocm93IG5ldyBUeXBlRXJyb3IoIkludmFsaWQgYXR0ZW1wdCB0byBkZXN0cnVjdHVyZSBub24taXRlcmFibGUgaW5zdGFuY2UuXG5JbiBvcmRlciB0byBiZSBpdGVyYWJsZSwgbm9uLWFycmF5IG9iamVjdHMgbXVzdCBoYXZlIGEgW1N5bWJvbC5pdGVyYXRvcl0oKSBtZXRob2QuIik7fWZ1bmN0aW9uIFNldHRpbmdfdW5zdXBwb3J0ZWRJdGVyYWJsZVRvQXJyYXkobywgbWluTGVuKSB7aWYgKCFvKSByZXR1cm47aWYgKHR5cGVvZiBvID09PSAic3RyaW5nIikgcmV0dXJuIFNldHRpbmdfYXJyYXlMaWtlVG9BcnJheShvLCBtaW5MZW4pO3ZhciBuID0gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKG8pLnNsaWNlKDgsIC0xKTtpZiAobiA9PT0gIk9iamVjdCIgJiYgby5jb25zdHJ1Y3RvcikgbiA9IG8uY29uc3RydWN0b3IubmFtZTtpZiAobiA9PT0gIk1hcCIgfHwgbiA9PT0gIlNldCIpIHJldHVybiBBcnJheS5mcm9tKG8pO2lmIChuID09PSAiQXJndW1lbnRzIiB8fCAvXig/OlVpfEkpbnQoPzo4fDE2fDMyKSg/OkNsYW1wZWQpP0FycmF5JC8udGVzdChuKSkgcmV0dXJuIFNldHRpbmdfYXJyYXlMaWtlVG9BcnJheShvLCBtaW5MZW4pO31mdW5jdGlvbiBTZXR0aW5nX2FycmF5TGlrZVRvQXJyYXkoYXJyLCBsZW4pIHtpZiAobGVuID09IG51bGwgfHwgbGVuID4gYXJyLmxlbmd0aCkgbGVuID0gYXJyLmxlbmd0aDtmb3IgKHZhciBpID0gMCwgYXJyMiA9IG5ldyBBcnJheShsZW4pOyBpIDwgbGVuOyBpKyspIGFycjJbaV0gPSBhcnJbaV07cmV0dXJuIGFycjI7fWZ1bmN0aW9uIFNldHRpbmdfaXRlcmFibGVUb0FycmF5TGltaXQoYXJyLCBpKSB7dmFyIF9pID0gbnVsbCA9PSBhcnIgPyBudWxsIDogInVuZGVmaW5lZCIgIT0gdHlwZW9mIFN5bWJvbCAmJiBhcnJbU3ltYm9sLml0ZXJhdG9yXSB8fCBhcnJbIkBAaXRlcmF0b3IiXTtpZiAobnVsbCAhPSBfaSkge3ZhciBfcyxfZSxfeCxfcixfYXJyID0gW10sX24gPSAhMCxfZCA9ICExO3RyeSB7aWYgKF94ID0gKF9pID0gX2kuY2FsbChhcnIpKS5uZXh0LCAwID09PSBpKSB7aWYgKE9iamVjdChfaSkgIT09IF9pKSByZXR1cm47X24gPSAhMTt9IGVsc2UgZm9yICg7ICEoX24gPSAoX3MgPSBfeC5jYWxsKF9pKSkuZG9uZSkgJiYgKF9hcnIucHVzaChfcy52YWx1ZSksIF9hcnIubGVuZ3RoICE9PSBpKTsgX24gPSAhMCk7fSBjYXRjaCAoZXJyKSB7X2QgPSAhMCwgX2UgPSBlcnI7fSBmaW5hbGx5IHt0cnkge2lmICghX24gJiYgbnVsbCAhPSBfaVsicmV0dXJuIl0gJiYgKF9yID0gX2lbInJldHVybiJdKCksIE9iamVjdChfcikgIT09IF9yKSkgcmV0dXJuO30gZmluYWxseSB7aWYgKF9kKSB0aHJvdyBfZTt9fXJldHVybiBfYXJyO319ZnVuY3Rpb24gU2V0dGluZ19hcnJheVdpdGhIb2xlcyhhcnIpIHtpZiAoQXJyYXkuaXNBcnJheShhcnIpKSByZXR1cm4gYXJyO30KCgoKCgoKCiAgICAgICAgICBmdW5jdGlvbiBTZXR0aW5nKF9yZWYpCgoKCgoKICAgICAgICAgIHt2YXIgYnV0dG9uID0gX3JlZi5idXR0b24sdmFsaWRhdG9yID0gX3JlZi52YWxpZGF0b3I7CiAgICAgICAgICAgIHZhciBfdXNlU3RhdGUgPSAoMCwgcmVhY3QudXNlU3RhdGUpKHZhbGlkYXRvci5pc1ZhbGlkKGJ1dHRvbikpLF91c2VTdGF0ZTIgPSBTZXR0aW5nX3NsaWNlZFRvQXJyYXkoX3VzZVN0YXRlLCAyKSx2YWxpZCA9IF91c2VTdGF0ZTJbMF0sc2V0VmFsaWQgPSBfdXNlU3RhdGUyWzFdOwoKICAgICAgICAgICAgYnV0dG9uLnNldFZhbHVlID0gZnVuY3Rpb24gKHZhbCkgewogICAgICAgICAgICAgIGJ1dHRvbi52YWx1ZSA9IHZhbDsKICAgICAgICAgICAgICB2YWxpZGF0b3IudXBkYXRlU2V0dGluZyhidXR0b24pOwogICAgICAgICAgICB9OwoKICAgICAgICAgICAgdmFsaWRhdG9yLmFkZFNldHRpbmcoYnV0dG9uLCBzZXRWYWxpZCk7CgogICAgICAgICAgICByZXR1cm4gLyojX19QVVJFX18qLygKICAgICAgICAgICAgICByZWFjdC5jcmVhdGVFbGVtZW50KCJ0ciIsIHsgY2xhc3NOYW1lOiAidXNlclByZWZlcmVuY2UiLCAiZGF0YS1uYW1lIjogYnV0dG9uLm5hbWUgfSwgLyojX19QVVJFX18qLwogICAgICAgICAgICAgIHJlYWN0LmNyZWF0ZUVsZW1lbnQoInRkIiwgeyBjbGFzc05hbWU6ICJzZXR0aW5nIiB9LAogICAgICAgICAgICAgIGJ1dHRvbi5uYW1lLCAvKiNfX1BVUkVfXyovCiAgICAgICAgICAgICAgcmVhY3QuY3JlYXRlRWxlbWVudCgiZGl2IiwgeyBjbGFzc05hbWU6ICJzZXR0aW5nTmFtZUhvdmVyIiB9LCBidXR0b24ucHJlZmVyZW5jZSkpLCAvKiNfX1BVUkVfXyovCgogICAgICAgICAgICAgIHJlYWN0LmNyZWF0ZUVsZW1lbnQoInRkIiwgeyBjbGFzc05hbWU6IHZhbGlkID8gInNldHRpbmdJbnB1dCIgOiAic2V0dGluZ0lucHV0IGludmFsaWQtc2V0dGluZyIgfSwKICAgICAgICAgICAgICBidXR0b24udHlwZSA9PT0gUmVsYXlDb21wb25lbnRUeXBlLkJPT0xFQU4gPyAvKiNfX1BVUkVfXyovCiAgICAgICAgICAgICAgcmVhY3QuY3JlYXRlRWxlbWVudChzZXR0aW5nc19Cb29sZWFuSW5wdXQsIHsgYnV0dG9uOiBidXR0b24gfSkgOgogICAgICAgICAgICAgIGJ1dHRvbi50eXBlID09PSBSZWxheUNvbXBvbmVudFR5cGUuRFJPUERPV04gPyAvKiNfX1BVUkVfXyovCiAgICAgICAgICAgICAgcmVhY3QuY3JlYXRlRWxlbWVudChzZXR0aW5nc19Ecm9wZG93bklucHV0LCB7IGJ1dHRvbjogYnV0dG9uIH0pIDoKICAgICAgICAgICAgICBidXR0b24udHlwZSA9PSBSZWxheUNvbXBvbmVudFR5cGUuVEFHUyA/IC8qI19fUFVSRV9fKi8KICAgICAgICAgICAgICByZWFjdC5jcmVhdGVFbGVtZW50KHNldHRpbmdzX1RhZ3NJbnB1dCwgeyBidXR0b246IGJ1dHRvbiB9KSA6IC8qI19fUFVSRV9fKi8KCiAgICAgICAgICAgICAgcmVhY3QuY3JlYXRlRWxlbWVudChzZXR0aW5nc19TdHJpbmdJbnB1dCwgeyBidXR0b246IGJ1dHRvbiB9KSwKCiAgICAgICAgICAgICAgYnV0dG9uLmludmFsaWRSZWFzb24gIT0gbnVsbCA/IC8qI19fUFVSRV9fKi8KICAgICAgICAgICAgICByZWFjdC5jcmVhdGVFbGVtZW50KCJkaXYiLCB7IGNsYXNzTmFtZTogImludmFsaWQtcmVhc29uIiwgaGlkZGVuOiB2YWxpZCB9LCAvKiNfX1BVUkVfXyovCiAgICAgICAgICAgICAgcmVhY3QuY3JlYXRlRWxlbWVudCgic21hbGwiLCBudWxsLCBidXR0b24uaW52YWxpZFJlYXNvbikpIDogLyojX19QVVJFX18qLwoKCiAgICAgICAgICAgICAgcmVhY3QuY3JlYXRlRWxlbWVudChyZWFjdC5GcmFnbWVudCwgbnVsbCksIC8qI19fUFVSRV9fKi8KCgogICAgICAgICAgICAgIHJlYWN0LmNyZWF0ZUVsZW1lbnQoImRpdiIsIHsgY2xhc3NOYW1lOiAiaG92ZXJCb3giIH0sIC8qI19fUFVSRV9fKi8KICAgICAgICAgICAgICByZWFjdC5jcmVhdGVFbGVtZW50KCJzbWFsbCIsIHsgY2xhc3NOYW1lOiAic2V0dGluZ0RlZmF1bHRIb3ZlciIgfSwKICAgICAgICAgICAgICBidXR0b25bImRlZmF1bHQiXSAhPSBudWxsID8KICAgICAgICAgICAgICAiRGVmYXVsdDogIiArICgKICAgICAgICAgICAgICBidXR0b25bImRlZmF1bHQiXSA9PSAiIiA/ICI8RW1wdHk+IiA6IGJ1dHRvblsiZGVmYXVsdCJdKSA6CiAgICAgICAgICAgICAgIkRlZmF1bHQgbm90IHNldCIpKSksIC8qI19fUFVSRV9fKi8KCgoKICAgICAgICAgICAgICByZWFjdC5jcmVhdGVFbGVtZW50KCJ0ZCIsIG51bGwsIGJ1dHRvbi5kZXNjcmlwdGlvbikpKTsKCgogICAgICAgICAgfQoKICAgICAgICAgIC8qIGhhcm1vbnkgZGVmYXVsdCBleHBvcnQgKi92YXIgc2V0dGluZ3NfU2V0dGluZyA9IFNldHRpbmc7CiAgICAgICAgICA7IC8vIENPTkNBVEVOQVRFRCBNT0RVTEU6IC4vc3JjL3JlbGF5L3JvdXRlcy9SZWxheVBhZ2UudHN4CiAgICAgICAgICBmdW5jdGlvbiBSZWxheVBhZ2VfY3JlYXRlRm9yT2ZJdGVyYXRvckhlbHBlcihvLCBhbGxvd0FycmF5TGlrZSkge3ZhciBpdCA9IHR5cGVvZiBTeW1ib2wgIT09ICJ1bmRlZmluZWQiICYmIG9bU3ltYm9sLml0ZXJhdG9yXSB8fCBvWyJAQGl0ZXJhdG9yIl07aWYgKCFpdCkge2lmIChBcnJheS5pc0FycmF5KG8pIHx8IChpdCA9IFJlbGF5UGFnZV91bnN1cHBvcnRlZEl0ZXJhYmxlVG9BcnJheShvKSkgfHwgYWxsb3dBcnJheUxpa2UgJiYgbyAmJiB0eXBlb2Ygby5sZW5ndGggPT09ICJudW1iZXIiKSB7aWYgKGl0KSBvID0gaXQ7dmFyIGkgPSAwO3ZhciBGID0gZnVuY3Rpb24gRigpIHt9O3JldHVybiB7IHM6IEYsIG46IGZ1bmN0aW9uIG4oKSB7aWYgKGkgPj0gby5sZW5ndGgpIHJldHVybiB7IGRvbmU6IHRydWUgfTtyZXR1cm4geyBkb25lOiBmYWxzZSwgdmFsdWU6IG9baSsrXSB9O30sIGU6IGZ1bmN0aW9uIGUoX2UpIHt0aHJvdyBfZTt9LCBmOiBGIH07fXRocm93IG5ldyBUeXBlRXJyb3IoIkludmFsaWQgYXR0ZW1wdCB0byBpdGVyYXRlIG5vbi1pdGVyYWJsZSBpbnN0YW5jZS5cbkluIG9yZGVyIHRvIGJlIGl0ZXJhYmxlLCBub24tYXJyYXkgb2JqZWN0cyBtdXN0IGhhdmUgYSBbU3ltYm9sLml0ZXJhdG9yXSgpIG1ldGhvZC4iKTt9dmFyIG5vcm1hbENvbXBsZXRpb24gPSB0cnVlLGRpZEVyciA9IGZhbHNlLGVycjtyZXR1cm4geyBzOiBmdW5jdGlvbiBzKCkge2l0ID0gaXQuY2FsbChvKTt9LCBuOiBmdW5jdGlvbiBuKCkge3ZhciBzdGVwID0gaXQubmV4dCgpO25vcm1hbENvbXBsZXRpb24gPSBzdGVwLmRvbmU7cmV0dXJuIHN0ZXA7fSwgZTogZnVuY3Rpb24gZShfZTIpIHtkaWRFcnIgPSB0cnVlO2VyciA9IF9lMjt9LCBmOiBmdW5jdGlvbiBmKCkge3RyeSB7aWYgKCFub3JtYWxDb21wbGV0aW9uICYmIGl0WyJyZXR1cm4iXSAhPSBudWxsKSBpdFsicmV0dXJuIl0oKTt9IGZpbmFsbHkge2lmIChkaWRFcnIpIHRocm93IGVycjt9fSB9O31mdW5jdGlvbiBSZWxheVBhZ2VfdW5zdXBwb3J0ZWRJdGVyYWJsZVRvQXJyYXkobywgbWluTGVuKSB7aWYgKCFvKSByZXR1cm47aWYgKHR5cGVvZiBvID09PSAic3RyaW5nIikgcmV0dXJuIFJlbGF5UGFnZV9hcnJheUxpa2VUb0FycmF5KG8sIG1pbkxlbik7dmFyIG4gPSBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwobykuc2xpY2UoOCwgLTEpO2lmIChuID09PSAiT2JqZWN0IiAmJiBvLmNvbnN0cnVjdG9yKSBuID0gby5jb25zdHJ1Y3Rvci5uYW1lO2lmIChuID09PSAiTWFwIiB8fCBuID09PSAiU2V0IikgcmV0dXJuIEFycmF5LmZyb20obyk7aWYgKG4gPT09ICJBcmd1bWVudHMiIHx8IC9eKD86VWl8SSludCg/Ojh8MTZ8MzIpKD86Q2xhbXBlZCk/QXJyYXkkLy50ZXN0KG4pKSByZXR1cm4gUmVsYXlQYWdlX2FycmF5TGlrZVRvQXJyYXkobywgbWluTGVuKTt9ZnVuY3Rpb24gUmVsYXlQYWdlX2FycmF5TGlrZVRvQXJyYXkoYXJyLCBsZW4pIHtpZiAobGVuID09IG51bGwgfHwgbGVuID4gYXJyLmxlbmd0aCkgbGVuID0gYXJyLmxlbmd0aDtmb3IgKHZhciBpID0gMCwgYXJyMiA9IG5ldyBBcnJheShsZW4pOyBpIDwgbGVuOyBpKyspIGFycjJbaV0gPSBhcnJbaV07cmV0dXJuIGFycjI7fQoKCgoKCgogICAgICAgICAgZnVuY3Rpb24gUmVsYXlQYWdlKF9yZWYpCgoKCiAgICAgICAgICB7dmFyIGNvbXBvbmVudHMgPSBfcmVmLmNvbXBvbmVudHM7CiAgICAgICAgICAgIHZhciBncm91cHMgPSBbXTsKICAgICAgICAgICAgdmFyIGN1cnJlbnRHcm91cCA9IG51bGw7dmFyIF9pdGVyYXRvciA9IFJlbGF5UGFnZV9jcmVhdGVGb3JPZkl0ZXJhdG9ySGVscGVyKAoKICAgICAgICAgICAgICBjb21wb25lbnRzKSxfc3RlcDt0cnkge2ZvciAoX2l0ZXJhdG9yLnMoKTsgIShfc3RlcCA9IF9pdGVyYXRvci5uKCkpLmRvbmU7KSB7dmFyIGNvbXBvbmVudCA9IF9zdGVwLnZhbHVlOwogICAgICAgICAgICAgICAgaWYgKAogICAgICAgICAgICAgICAgY29tcG9uZW50LnR5cGUgPT0gUmVsYXlDb21wb25lbnRUeXBlLkhUTUwgfHwKICAgICAgICAgICAgICAgIGNvbXBvbmVudC50eXBlID09IFJlbGF5Q29tcG9uZW50VHlwZS5JTlRFUlJVUFQpCiAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgIGdyb3Vwcy5wdXNoKGNvbXBvbmVudCk7CiAgICAgICAgICAgICAgICAgIGN1cnJlbnRHcm91cCA9IG51bGw7CiAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGlmIChjdXJyZW50R3JvdXAgPT0gbnVsbCkgewogICAgICAgICAgICAgICAgICBjdXJyZW50R3JvdXAgPSBbXTsKICAgICAgICAgICAgICAgICAgZ3JvdXBzLnB1c2goY3VycmVudEdyb3VwKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBjdXJyZW50R3JvdXAucHVzaChjb21wb25lbnQpOwogICAgICAgICAgICAgIH19IGNhdGNoIChlcnIpIHtfaXRlcmF0b3IuZShlcnIpO30gZmluYWxseSB7X2l0ZXJhdG9yLmYoKTt9CgogICAgICAgICAgICB2YXIgZWxlbWVudHMgPSBbXTsKICAgICAgICAgICAgdmFyIHZhbGlkYXRvciA9IG5ldyBhcGlfU2V0dGluZ1ZhbGlkYXRvcigpOwoKICAgICAgICAgICAgZ3JvdXBzLmZvckVhY2goZnVuY3Rpb24gKGNvbXBvbmVudHMsIGluZGV4KSB7CiAgICAgICAgICAgICAgaWYgKGNvbXBvbmVudHMudHlwZSA9PSBSZWxheUNvbXBvbmVudFR5cGUuSFRNTCkgewogICAgICAgICAgICAgICAgdmFyIGh0bWwgPSBjb21wb25lbnRzOwoKICAgICAgICAgICAgICAgIGlmIChodG1sLmRhdGEgPT0gbnVsbCkgewogICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgZWxlbWVudHMucHVzaCggLyojX19QVVJFX18qLwogICAgICAgICAgICAgICAgcmVhY3QuY3JlYXRlRWxlbWVudCgiZGl2IiwgewogICAgICAgICAgICAgICAgICBrZXk6ICJIVE1MICIuY29uY2F0KGluZGV4KSwKICAgICAgICAgICAgICAgICAgZGFuZ2Vyb3VzbHlTZXRJbm5lckhUTUw6IHsKICAgICAgICAgICAgICAgICAgICBfX2h0bWw6IGNvbXBvbmVudHMuZGF0YQogICAgICAgICAgICAgICAgICB9IH0pKTsKCgogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgaWYgKGNvbXBvbmVudHMudHlwZSA9PSBSZWxheUNvbXBvbmVudFR5cGUuSU5URVJSVVBUKSB7CiAgICAgICAgICAgICAgICBlbGVtZW50cy5wdXNoKCAvKiNfX1BVUkVfXyovCiAgICAgICAgICAgICAgICByZWFjdC5jcmVhdGVFbGVtZW50KGNvbXBvbmVudHNfSW50ZXJydXB0LCB7CiAgICAgICAgICAgICAgICAgIGtleTogIkludGVycnVwdCAiLmNvbmNhdChpbmRleCksCiAgICAgICAgICAgICAgICAgIGJ1dHRvbjogY29tcG9uZW50cyB9KSk7CgoKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIHZhciBidXR0b25zID0gY29tcG9uZW50czsKCiAgICAgICAgICAgICAgZWxlbWVudHMucHVzaCggLyojX19QVVJFX18qLwogICAgICAgICAgICAgIHJlYWN0LmNyZWF0ZUVsZW1lbnQoInRhYmxlIiwgeyBrZXk6ICJUYWJsZSAiLmNvbmNhdChpbmRleCksIGNsYXNzTmFtZTogInJlbGF5VGFibGUiIH0sIC8qI19fUFVSRV9fKi8KICAgICAgICAgICAgICByZWFjdC5jcmVhdGVFbGVtZW50KCJ0Ym9keSIsIG51bGwsCiAgICAgICAgICAgICAgYnV0dG9ucy5tYXAoZnVuY3Rpb24gKHNldHRpbmcsIGluZGV4KSB7cmV0dXJuIC8qI19fUFVSRV9fKi8oCiAgICAgICAgICAgICAgICAgIHJlYWN0LmNyZWF0ZUVsZW1lbnQoc2V0dGluZ3NfU2V0dGluZywgewogICAgICAgICAgICAgICAgICAgIGtleTogIlNldHRpbmcgIi5jb25jYXQoc2V0dGluZy5uYW1lLCAiICIpLmNvbmNhdChzZXR0aW5nLnByZWZlcmVuY2UsICIgIikuY29uY2F0KGluZGV4KSwKICAgICAgICAgICAgICAgICAgICBidXR0b246IHNldHRpbmcsCiAgICAgICAgICAgICAgICAgICAgdmFsaWRhdG9yOiB2YWxpZGF0b3IgfSkpO30pKSkpOwoKCgoKCiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgdmFsaWRhdG9yLnVwZGF0ZU9iamVjdCgpOwoKICAgICAgICAgICAgLy8gSWYgd2UgaGF2ZSBubyBzZXR0aW5ncyBpbiB3aGljaCB3ZSdkIHNhdmUgc3R1ZmYsIGRvbid0IGJvdGhlciByZW5kZXJpbmcgc2F2ZSBidXR0b24KICAgICAgICAgICAgaWYgKAogICAgICAgICAgICBjb21wb25lbnRzLmZpbmQoZnVuY3Rpb24gKGMpIHtyZXR1cm4gYy5wcmVmZXJlbmNlICE9IG51bGw7fSkgPT0gbnVsbCkKICAgICAgICAgICAgewogICAgICAgICAgICAgIHJldHVybiAvKiNfX1BVUkVfXyovcmVhY3QuY3JlYXRlRWxlbWVudChyZWFjdC5GcmFnbWVudCwgbnVsbCwgZWxlbWVudHMpOwogICAgICAgICAgICB9CgogICAgICAgICAgICByZXR1cm4gLyojX19QVVJFX18qLygKICAgICAgICAgICAgICByZWFjdC5jcmVhdGVFbGVtZW50KHJlYWN0LkZyYWdtZW50LCBudWxsLAogICAgICAgICAgICAgICIgIiwKICAgICAgICAgICAgICBlbGVtZW50cywgIiAiLCAvKiNfX1BVUkVfXyovcmVhY3QuY3JlYXRlRWxlbWVudCgiYnIiLCBudWxsKSwgLyojX19QVVJFX18qLwogICAgICAgICAgICAgIHJlYWN0LmNyZWF0ZUVsZW1lbnQoImlucHV0IiwgewogICAgICAgICAgICAgICAgY2xhc3NOYW1lOiAic2F2ZSIsCiAgICAgICAgICAgICAgICBvbkNsaWNrOiBmdW5jdGlvbiBvbkNsaWNrKCkge3JldHVybiAoCiAgICAgICAgICAgICAgICAgICAgc2F2ZVNldHRpbmdzKAogICAgICAgICAgICAgICAgICAgIGNvbXBvbmVudHMuZmlsdGVyKAogICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uIChiKSB7cmV0dXJuIGIucHJlZmVyZW5jZSAhPSBudWxsO30pKS4KCiAgICAgICAgICAgICAgICAgICAgdGhlbihmdW5jdGlvbiAobm90aWZzKSB7dmFyIF9pdGVyYXRvcjIgPSBSZWxheVBhZ2VfY3JlYXRlRm9yT2ZJdGVyYXRvckhlbHBlcigKICAgICAgICAgICAgICAgICAgICAgICAgbm90aWZzKSxfc3RlcDI7dHJ5IHtmb3IgKF9pdGVyYXRvcjIucygpOyAhKF9zdGVwMiA9IF9pdGVyYXRvcjIubigpKS5kb25lOykge3ZhciBub3RpZiA9IF9zdGVwMi52YWx1ZTsKICAgICAgICAgICAgICAgICAgICAgICAgICBhZGROb3RpZmljYXRpb24obm90aWYpOwogICAgICAgICAgICAgICAgICAgICAgICB9fSBjYXRjaCAoZXJyKSB7X2l0ZXJhdG9yMi5lKGVycik7fSBmaW5hbGx5IHtfaXRlcmF0b3IyLmYoKTt9CiAgICAgICAgICAgICAgICAgICAgfSkpO30sCgogICAgICAgICAgICAgICAgdHlwZTogInN1Ym1pdCIsCiAgICAgICAgICAgICAgICB2YWx1ZTogIlNhdmUgQ2hhbmdlcyIgfSkpKTsKCgoKICAgICAgICAgIH0KCiAgICAgICAgICAvKiBoYXJtb255IGRlZmF1bHQgZXhwb3J0ICovdmFyIHJvdXRlc19SZWxheVBhZ2UgPSBSZWxheVBhZ2U7CiAgICAgICAgICA7IC8vIENPTkNBVEVOQVRFRCBNT0RVTEU6IC4vc3JjL3JlbGF5L0FwcC50c3gKCgoKCgoKICAgICAgICAgIGZ1bmN0aW9uIEFwcChfcmVmKSB7dmFyIHBhZ2VzID0gX3JlZi5wYWdlczsKICAgICAgICAgICAgcmV0dXJuIC8qI19fUFVSRV9fKi8oCiAgICAgICAgICAgICAgcmVhY3QuY3JlYXRlRWxlbWVudChNZW1vcnlSb3V0ZXIsIG51bGwsCiAgICAgICAgICAgICAgIiAiLCAvKiNfX1BVUkVfXyovCiAgICAgICAgICAgICAgcmVhY3QuY3JlYXRlRWxlbWVudChSb3V0ZXMsIG51bGwsCiAgICAgICAgICAgICAgIiAiLCAvKiNfX1BVUkVfXyovCiAgICAgICAgICAgICAgcmVhY3QuY3JlYXRlRWxlbWVudChSb3V0ZSwgeyBlbGVtZW50OiAvKiNfX1BVUkVfXyovcmVhY3QuY3JlYXRlRWxlbWVudChjb21wb25lbnRzX0xheW91dCwgeyBwYWdlczogcGFnZXMgfSkgfSwKICAgICAgICAgICAgICAiICIsIC8qI19fUFVSRV9fKi8KICAgICAgICAgICAgICByZWFjdC5jcmVhdGVFbGVtZW50KFJvdXRlLCB7CiAgICAgICAgICAgICAgICBwYXRoOiAiLyIsCiAgICAgICAgICAgICAgICBlbGVtZW50OiAvKiNfX1BVUkVfXyovcmVhY3QuY3JlYXRlRWxlbWVudChOYXZpZ2F0ZSwgeyB0bzogIi8iICsgcGFnZXNbMF0uZmlsZSwgcmVwbGFjZTogdHJ1ZSB9KSB9KSwKICAgICAgICAgICAgICAiICIsCiAgICAgICAgICAgICAgcGFnZXMubWFwKGZ1bmN0aW9uIChwKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gLyojX19QVVJFX18qLygKICAgICAgICAgICAgICAgICAgcmVhY3QuY3JlYXRlRWxlbWVudChSb3V0ZSwgewogICAgICAgICAgICAgICAgICAgIGtleTogIiIuY29uY2F0KHAuZmlsZSwgIiAiKS5jb25jYXQocC5wYWdlKSwKICAgICAgICAgICAgICAgICAgICBwYXRoOiAiLyIgKyBwLmZpbGUsCiAgICAgICAgICAgICAgICAgICAgZWxlbWVudDogLyojX19QVVJFX18qL3JlYWN0LmNyZWF0ZUVsZW1lbnQocm91dGVzX1JlbGF5UGFnZSwgeyBjb21wb25lbnRzOiBwLmNvbXBvbmVudHMgfSkgfSkpOwoKCiAgICAgICAgICAgICAgfSksICIgIiksCiAgICAgICAgICAgICAgIiAiKSwKICAgICAgICAgICAgICAiICIpKTsKCgogICAgICAgICAgfQoKICAgICAgICAgIC8qIGhhcm1vbnkgZGVmYXVsdCBleHBvcnQgKi92YXIgcmVsYXlfQXBwID0gQXBwOwoKICAgICAgICAgIC8qKiovfSwKCiAgICAgICAgLyoqKi80NDg6CiAgICAgICAgLyoqKi8oX191bnVzZWRfd2VicGFja19tb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pID0+IHsKCiAgICAgICAgICAvKioKICAgICAgICAgICAqIEBsaWNlbnNlIFJlYWN0CiAgICAgICAgICAgKiByZWFjdC1kb20ucHJvZHVjdGlvbi5taW4uanMKICAgICAgICAgICAqCiAgICAgICAgICAgKiBDb3B5cmlnaHQgKGMpIEZhY2Vib29rLCBJbmMuIGFuZCBpdHMgYWZmaWxpYXRlcy4KICAgICAgICAgICAqCiAgICAgICAgICAgKiBUaGlzIHNvdXJjZSBjb2RlIGlzIGxpY2Vuc2VkIHVuZGVyIHRoZSBNSVQgbGljZW5zZSBmb3VuZCBpbiB0aGUKICAgICAgICAgICAqIExJQ0VOU0UgZmlsZSBpbiB0aGUgcm9vdCBkaXJlY3Rvcnkgb2YgdGhpcyBzb3VyY2UgdHJlZS4KICAgICAgICAgICAqLwogICAgICAgICAgLyoKICAgICAgICAgICBNb2Rlcm5penIgMy4wLjBwcmUgKEN1c3RvbSBCdWlsZCkgfCBNSVQKICAgICAgICAgICovCiAgICAgICAgICB2YXIgYWEgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDI5NCksY2EgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDg0MCk7ZnVuY3Rpb24gcChhKSB7Zm9yICh2YXIgYiA9ICJodHRwczovL3JlYWN0anMub3JnL2RvY3MvZXJyb3ItZGVjb2Rlci5odG1sP2ludmFyaWFudD0iICsgYSwgYyA9IDE7IGMgPCBhcmd1bWVudHMubGVuZ3RoOyBjKyspIGIgKz0gIiZhcmdzW109IiArIGVuY29kZVVSSUNvbXBvbmVudChhcmd1bWVudHNbY10pO3JldHVybiAiTWluaWZpZWQgUmVhY3QgZXJyb3IgIyIgKyBhICsgIjsgdmlzaXQgIiArIGIgKyAiIGZvciB0aGUgZnVsbCBtZXNzYWdlIG9yIHVzZSB0aGUgbm9uLW1pbmlmaWVkIGRldiBlbnZpcm9ubWVudCBmb3IgZnVsbCBlcnJvcnMgYW5kIGFkZGl0aW9uYWwgaGVscGZ1bCB3YXJuaW5ncy4iO312YXIgZGEgPSBuZXcgU2V0KCksZWEgPSB7fTtmdW5jdGlvbiBmYShhLCBiKSB7aGEoYSwgYik7aGEoYSArICJDYXB0dXJlIiwgYik7fQogICAgICAgICAgZnVuY3Rpb24gaGEoYSwgYikge2VhW2FdID0gYjtmb3IgKGEgPSAwOyBhIDwgYi5sZW5ndGg7IGErKykgZGEuYWRkKGJbYV0pO30KICAgICAgICAgIHZhciBpYSA9ICEoInVuZGVmaW5lZCIgPT09IHR5cGVvZiB3aW5kb3cgfHwgInVuZGVmaW5lZCIgPT09IHR5cGVvZiB3aW5kb3cuZG9jdW1lbnQgfHwgInVuZGVmaW5lZCIgPT09IHR5cGVvZiB3aW5kb3cuZG9jdW1lbnQuY3JlYXRlRWxlbWVudCksamEgPSBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LGthID0gL15bOkEtWl9hLXpcdTAwQzAtXHUwMEQ2XHUwMEQ4LVx1MDBGNlx1MDBGOC1cdTAyRkZcdTAzNzAtXHUwMzdEXHUwMzdGLVx1MUZGRlx1MjAwQy1cdTIwMERcdTIwNzAtXHUyMThGXHUyQzAwLVx1MkZFRlx1MzAwMS1cdUQ3RkZcdUY5MDAtXHVGRENGXHVGREYwLVx1RkZGRF1bOkEtWl9hLXpcdTAwQzAtXHUwMEQ2XHUwMEQ4LVx1MDBGNlx1MDBGOC1cdTAyRkZcdTAzNzAtXHUwMzdEXHUwMzdGLVx1MUZGRlx1MjAwQy1cdTIwMERcdTIwNzAtXHUyMThGXHUyQzAwLVx1MkZFRlx1MzAwMS1cdUQ3RkZcdUY5MDAtXHVGRENGXHVGREYwLVx1RkZGRFwtLjAtOVx1MDBCN1x1MDMwMC1cdTAzNkZcdTIwM0YtXHUyMDQwXSokLyxsYSA9CiAgICAgICAgICAgIHt9LG1hID0ge307ZnVuY3Rpb24gb2EoYSkge2lmIChqYS5jYWxsKG1hLCBhKSkgcmV0dXJuICEwO2lmIChqYS5jYWxsKGxhLCBhKSkgcmV0dXJuICExO2lmIChrYS50ZXN0KGEpKSByZXR1cm4gbWFbYV0gPSAhMDtsYVthXSA9ICEwO3JldHVybiAhMTt9ZnVuY3Rpb24gcGEoYSwgYiwgYywgZCkge2lmIChudWxsICE9PSBjICYmIDAgPT09IGMudHlwZSkgcmV0dXJuICExO3N3aXRjaCAodHlwZW9mIGIpIHtjYXNlICJmdW5jdGlvbiI6Y2FzZSAic3ltYm9sIjpyZXR1cm4gITA7Y2FzZSAiYm9vbGVhbiI6aWYgKGQpIHJldHVybiAhMTtpZiAobnVsbCAhPT0gYykgcmV0dXJuICFjLmFjY2VwdHNCb29sZWFuczthID0gYS50b0xvd2VyQ2FzZSgpLnNsaWNlKDAsIDUpO3JldHVybiAiZGF0YS0iICE9PSBhICYmICJhcmlhLSIgIT09IGE7ZGVmYXVsdDpyZXR1cm4gITE7fX0KICAgICAgICAgIGZ1bmN0aW9uIHFhKGEsIGIsIGMsIGQpIHtpZiAobnVsbCA9PT0gYiB8fCAidW5kZWZpbmVkIiA9PT0gdHlwZW9mIGIgfHwgcGEoYSwgYiwgYywgZCkpIHJldHVybiAhMDtpZiAoZCkgcmV0dXJuICExO2lmIChudWxsICE9PSBjKSBzd2l0Y2ggKGMudHlwZSkge2Nhc2UgMzpyZXR1cm4gIWI7Y2FzZSA0OnJldHVybiAhMSA9PT0gYjtjYXNlIDU6cmV0dXJuIGlzTmFOKGIpO2Nhc2UgNjpyZXR1cm4gaXNOYU4oYikgfHwgMSA+IGI7fXJldHVybiAhMTt9ZnVuY3Rpb24gdihhLCBiLCBjLCBkLCBlLCBmLCBnKSB7dGhpcy5hY2NlcHRzQm9vbGVhbnMgPSAyID09PSBiIHx8IDMgPT09IGIgfHwgNCA9PT0gYjt0aGlzLmF0dHJpYnV0ZU5hbWUgPSBkO3RoaXMuYXR0cmlidXRlTmFtZXNwYWNlID0gZTt0aGlzLm11c3RVc2VQcm9wZXJ0eSA9IGM7dGhpcy5wcm9wZXJ0eU5hbWUgPSBhO3RoaXMudHlwZSA9IGI7dGhpcy5zYW5pdGl6ZVVSTCA9IGY7dGhpcy5yZW1vdmVFbXB0eVN0cmluZyA9IGc7fXZhciB6ID0ge307CiAgICAgICAgICAiY2hpbGRyZW4gZGFuZ2Vyb3VzbHlTZXRJbm5lckhUTUwgZGVmYXVsdFZhbHVlIGRlZmF1bHRDaGVja2VkIGlubmVySFRNTCBzdXBwcmVzc0NvbnRlbnRFZGl0YWJsZVdhcm5pbmcgc3VwcHJlc3NIeWRyYXRpb25XYXJuaW5nIHN0eWxlIi5zcGxpdCgiICIpLmZvckVhY2goZnVuY3Rpb24gKGEpIHt6W2FdID0gbmV3IHYoYSwgMCwgITEsIGEsIG51bGwsICExLCAhMSk7fSk7W1siYWNjZXB0Q2hhcnNldCIsICJhY2NlcHQtY2hhcnNldCJdLCBbImNsYXNzTmFtZSIsICJjbGFzcyJdLCBbImh0bWxGb3IiLCAiZm9yIl0sIFsiaHR0cEVxdWl2IiwgImh0dHAtZXF1aXYiXV0uZm9yRWFjaChmdW5jdGlvbiAoYSkge3ZhciBiID0gYVswXTt6W2JdID0gbmV3IHYoYiwgMSwgITEsIGFbMV0sIG51bGwsICExLCAhMSk7fSk7WyJjb250ZW50RWRpdGFibGUiLCAiZHJhZ2dhYmxlIiwgInNwZWxsQ2hlY2siLCAidmFsdWUiXS5mb3JFYWNoKGZ1bmN0aW9uIChhKSB7elthXSA9IG5ldyB2KGEsIDIsICExLCBhLnRvTG93ZXJDYXNlKCksIG51bGwsICExLCAhMSk7fSk7CiAgICAgICAgICBbImF1dG9SZXZlcnNlIiwgImV4dGVybmFsUmVzb3VyY2VzUmVxdWlyZWQiLCAiZm9jdXNhYmxlIiwgInByZXNlcnZlQWxwaGEiXS5mb3JFYWNoKGZ1bmN0aW9uIChhKSB7elthXSA9IG5ldyB2KGEsIDIsICExLCBhLCBudWxsLCAhMSwgITEpO30pOyJhbGxvd0Z1bGxTY3JlZW4gYXN5bmMgYXV0b0ZvY3VzIGF1dG9QbGF5IGNvbnRyb2xzIGRlZmF1bHQgZGVmZXIgZGlzYWJsZWQgZGlzYWJsZVBpY3R1cmVJblBpY3R1cmUgZGlzYWJsZVJlbW90ZVBsYXliYWNrIGZvcm1Ob1ZhbGlkYXRlIGhpZGRlbiBsb29wIG5vTW9kdWxlIG5vVmFsaWRhdGUgb3BlbiBwbGF5c0lubGluZSByZWFkT25seSByZXF1aXJlZCByZXZlcnNlZCBzY29wZWQgc2VhbWxlc3MgaXRlbVNjb3BlIi5zcGxpdCgiICIpLmZvckVhY2goZnVuY3Rpb24gKGEpIHt6W2FdID0gbmV3IHYoYSwgMywgITEsIGEudG9Mb3dlckNhc2UoKSwgbnVsbCwgITEsICExKTt9KTsKICAgICAgICAgIFsiY2hlY2tlZCIsICJtdWx0aXBsZSIsICJtdXRlZCIsICJzZWxlY3RlZCJdLmZvckVhY2goZnVuY3Rpb24gKGEpIHt6W2FdID0gbmV3IHYoYSwgMywgITAsIGEsIG51bGwsICExLCAhMSk7fSk7WyJjYXB0dXJlIiwgImRvd25sb2FkIl0uZm9yRWFjaChmdW5jdGlvbiAoYSkge3pbYV0gPSBuZXcgdihhLCA0LCAhMSwgYSwgbnVsbCwgITEsICExKTt9KTtbImNvbHMiLCAicm93cyIsICJzaXplIiwgInNwYW4iXS5mb3JFYWNoKGZ1bmN0aW9uIChhKSB7elthXSA9IG5ldyB2KGEsIDYsICExLCBhLCBudWxsLCAhMSwgITEpO30pO1sicm93U3BhbiIsICJzdGFydCJdLmZvckVhY2goZnVuY3Rpb24gKGEpIHt6W2FdID0gbmV3IHYoYSwgNSwgITEsIGEudG9Mb3dlckNhc2UoKSwgbnVsbCwgITEsICExKTt9KTt2YXIgcmEgPSAvW1wtOl0oW2Etel0pL2c7ZnVuY3Rpb24gc2EoYSkge3JldHVybiBhWzFdLnRvVXBwZXJDYXNlKCk7fQogICAgICAgICAgImFjY2VudC1oZWlnaHQgYWxpZ25tZW50LWJhc2VsaW5lIGFyYWJpYy1mb3JtIGJhc2VsaW5lLXNoaWZ0IGNhcC1oZWlnaHQgY2xpcC1wYXRoIGNsaXAtcnVsZSBjb2xvci1pbnRlcnBvbGF0aW9uIGNvbG9yLWludGVycG9sYXRpb24tZmlsdGVycyBjb2xvci1wcm9maWxlIGNvbG9yLXJlbmRlcmluZyBkb21pbmFudC1iYXNlbGluZSBlbmFibGUtYmFja2dyb3VuZCBmaWxsLW9wYWNpdHkgZmlsbC1ydWxlIGZsb29kLWNvbG9yIGZsb29kLW9wYWNpdHkgZm9udC1mYW1pbHkgZm9udC1zaXplIGZvbnQtc2l6ZS1hZGp1c3QgZm9udC1zdHJldGNoIGZvbnQtc3R5bGUgZm9udC12YXJpYW50IGZvbnQtd2VpZ2h0IGdseXBoLW5hbWUgZ2x5cGgtb3JpZW50YXRpb24taG9yaXpvbnRhbCBnbHlwaC1vcmllbnRhdGlvbi12ZXJ0aWNhbCBob3Jpei1hZHYteCBob3Jpei1vcmlnaW4teCBpbWFnZS1yZW5kZXJpbmcgbGV0dGVyLXNwYWNpbmcgbGlnaHRpbmctY29sb3IgbWFya2VyLWVuZCBtYXJrZXItbWlkIG1hcmtlci1zdGFydCBvdmVybGluZS1wb3NpdGlvbiBvdmVybGluZS10aGlja25lc3MgcGFpbnQtb3JkZXIgcGFub3NlLTEgcG9pbnRlci1ldmVudHMgcmVuZGVyaW5nLWludGVudCBzaGFwZS1yZW5kZXJpbmcgc3RvcC1jb2xvciBzdG9wLW9wYWNpdHkgc3RyaWtldGhyb3VnaC1wb3NpdGlvbiBzdHJpa2V0aHJvdWdoLXRoaWNrbmVzcyBzdHJva2UtZGFzaGFycmF5IHN0cm9rZS1kYXNob2Zmc2V0IHN0cm9rZS1saW5lY2FwIHN0cm9rZS1saW5lam9pbiBzdHJva2UtbWl0ZXJsaW1pdCBzdHJva2Utb3BhY2l0eSBzdHJva2Utd2lkdGggdGV4dC1hbmNob3IgdGV4dC1kZWNvcmF0aW9uIHRleHQtcmVuZGVyaW5nIHVuZGVybGluZS1wb3NpdGlvbiB1bmRlcmxpbmUtdGhpY2tuZXNzIHVuaWNvZGUtYmlkaSB1bmljb2RlLXJhbmdlIHVuaXRzLXBlci1lbSB2LWFscGhhYmV0aWMgdi1oYW5naW5nIHYtaWRlb2dyYXBoaWMgdi1tYXRoZW1hdGljYWwgdmVjdG9yLWVmZmVjdCB2ZXJ0LWFkdi15IHZlcnQtb3JpZ2luLXggdmVydC1vcmlnaW4teSB3b3JkLXNwYWNpbmcgd3JpdGluZy1tb2RlIHhtbG5zOnhsaW5rIHgtaGVpZ2h0Ii5zcGxpdCgiICIpLmZvckVhY2goZnVuY3Rpb24gKGEpIHt2YXIgYiA9IGEucmVwbGFjZShyYSwKICAgICAgICAgICAgc2EpO3pbYl0gPSBuZXcgdihiLCAxLCAhMSwgYSwgbnVsbCwgITEsICExKTt9KTsieGxpbms6YWN0dWF0ZSB4bGluazphcmNyb2xlIHhsaW5rOnJvbGUgeGxpbms6c2hvdyB4bGluazp0aXRsZSB4bGluazp0eXBlIi5zcGxpdCgiICIpLmZvckVhY2goZnVuY3Rpb24gKGEpIHt2YXIgYiA9IGEucmVwbGFjZShyYSwgc2EpO3pbYl0gPSBuZXcgdihiLCAxLCAhMSwgYSwgImh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiLCAhMSwgITEpO30pO1sieG1sOmJhc2UiLCAieG1sOmxhbmciLCAieG1sOnNwYWNlIl0uZm9yRWFjaChmdW5jdGlvbiAoYSkge3ZhciBiID0gYS5yZXBsYWNlKHJhLCBzYSk7eltiXSA9IG5ldyB2KGIsIDEsICExLCBhLCAiaHR0cDovL3d3dy53My5vcmcvWE1MLzE5OTgvbmFtZXNwYWNlIiwgITEsICExKTt9KTtbInRhYkluZGV4IiwgImNyb3NzT3JpZ2luIl0uZm9yRWFjaChmdW5jdGlvbiAoYSkge3pbYV0gPSBuZXcgdihhLCAxLCAhMSwgYS50b0xvd2VyQ2FzZSgpLCBudWxsLCAhMSwgITEpO30pOwogICAgICAgICAgei54bGlua0hyZWYgPSBuZXcgdigieGxpbmtIcmVmIiwgMSwgITEsICJ4bGluazpocmVmIiwgImh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiLCAhMCwgITEpO1sic3JjIiwgImhyZWYiLCAiYWN0aW9uIiwgImZvcm1BY3Rpb24iXS5mb3JFYWNoKGZ1bmN0aW9uIChhKSB7elthXSA9IG5ldyB2KGEsIDEsICExLCBhLnRvTG93ZXJDYXNlKCksIG51bGwsICEwLCAhMCk7fSk7CiAgICAgICAgICBmdW5jdGlvbiB0YShhLCBiLCBjLCBkKSB7dmFyIGUgPSB6Lmhhc093blByb3BlcnR5KGIpID8geltiXSA6IG51bGw7aWYgKG51bGwgIT09IGUgPyAwICE9PSBlLnR5cGUgOiBkIHx8ICEoMiA8IGIubGVuZ3RoKSB8fCAibyIgIT09IGJbMF0gJiYgIk8iICE9PSBiWzBdIHx8ICJuIiAhPT0gYlsxXSAmJiAiTiIgIT09IGJbMV0pIHFhKGIsIGMsIGUsIGQpICYmIChjID0gbnVsbCksIGQgfHwgbnVsbCA9PT0gZSA/IG9hKGIpICYmIChudWxsID09PSBjID8gYS5yZW1vdmVBdHRyaWJ1dGUoYikgOiBhLnNldEF0dHJpYnV0ZShiLCAiIiArIGMpKSA6IGUubXVzdFVzZVByb3BlcnR5ID8gYVtlLnByb3BlcnR5TmFtZV0gPSBudWxsID09PSBjID8gMyA9PT0gZS50eXBlID8gITEgOiAiIiA6IGMgOiAoYiA9IGUuYXR0cmlidXRlTmFtZSwgZCA9IGUuYXR0cmlidXRlTmFtZXNwYWNlLCBudWxsID09PSBjID8gYS5yZW1vdmVBdHRyaWJ1dGUoYikgOiAoZSA9IGUudHlwZSwgYyA9IDMgPT09IGUgfHwgNCA9PT0gZSAmJiAhMCA9PT0gYyA/ICIiIDogIiIgKyBjLCBkID8gYS5zZXRBdHRyaWJ1dGVOUyhkLCBiLCBjKSA6IGEuc2V0QXR0cmlidXRlKGIsIGMpKSk7fQogICAgICAgICAgdmFyIHVhID0gYWEuX19TRUNSRVRfSU5URVJOQUxTX0RPX05PVF9VU0VfT1JfWU9VX1dJTExfQkVfRklSRUQsdmEgPSBTeW1ib2wuZm9yKCJyZWFjdC5lbGVtZW50Iiksd2EgPSBTeW1ib2wuZm9yKCJyZWFjdC5wb3J0YWwiKSx5YSA9IFN5bWJvbC5mb3IoInJlYWN0LmZyYWdtZW50IiksemEgPSBTeW1ib2wuZm9yKCJyZWFjdC5zdHJpY3RfbW9kZSIpLEFhID0gU3ltYm9sLmZvcigicmVhY3QucHJvZmlsZXIiKSxCYSA9IFN5bWJvbC5mb3IoInJlYWN0LnByb3ZpZGVyIiksQ2EgPSBTeW1ib2wuZm9yKCJyZWFjdC5jb250ZXh0IiksRGEgPSBTeW1ib2wuZm9yKCJyZWFjdC5mb3J3YXJkX3JlZiIpLEVhID0gU3ltYm9sLmZvcigicmVhY3Quc3VzcGVuc2UiKSxGYSA9IFN5bWJvbC5mb3IoInJlYWN0LnN1c3BlbnNlX2xpc3QiKSxHYSA9IFN5bWJvbC5mb3IoInJlYWN0Lm1lbW8iKSxIYSA9IFN5bWJvbC5mb3IoInJlYWN0LmxhenkiKTtTeW1ib2wuZm9yKCJyZWFjdC5zY29wZSIpO1N5bWJvbC5mb3IoInJlYWN0LmRlYnVnX3RyYWNlX21vZGUiKTsKICAgICAgICAgIHZhciBJYSA9IFN5bWJvbC5mb3IoInJlYWN0Lm9mZnNjcmVlbiIpO1N5bWJvbC5mb3IoInJlYWN0LmxlZ2FjeV9oaWRkZW4iKTtTeW1ib2wuZm9yKCJyZWFjdC5jYWNoZSIpO1N5bWJvbC5mb3IoInJlYWN0LnRyYWNpbmdfbWFya2VyIik7dmFyIEphID0gU3ltYm9sLml0ZXJhdG9yO2Z1bmN0aW9uIEthKGEpIHtpZiAobnVsbCA9PT0gYSB8fCAib2JqZWN0IiAhPT0gdHlwZW9mIGEpIHJldHVybiBudWxsO2EgPSBKYSAmJiBhW0phXSB8fCBhWyJAQGl0ZXJhdG9yIl07cmV0dXJuICJmdW5jdGlvbiIgPT09IHR5cGVvZiBhID8gYSA6IG51bGw7fXZhciBBID0gT2JqZWN0LmFzc2lnbixMYTtmdW5jdGlvbiBNYShhKSB7aWYgKHZvaWQgMCA9PT0gTGEpIHRyeSB7dGhyb3cgRXJyb3IoKTt9IGNhdGNoIChjKSB7dmFyIGIgPSBjLnN0YWNrLnRyaW0oKS5tYXRjaCgvXG4oICooYXQgKT8pLyk7TGEgPSBiICYmIGJbMV0gfHwgIiI7fXJldHVybiAiXG4iICsgTGEgKyBhO312YXIgTmEgPSAhMTsKICAgICAgICAgIGZ1bmN0aW9uIE9hKGEsIGIpIHtpZiAoIWEgfHwgTmEpIHJldHVybiAiIjtOYSA9ICEwO3ZhciBjID0gRXJyb3IucHJlcGFyZVN0YWNrVHJhY2U7RXJyb3IucHJlcGFyZVN0YWNrVHJhY2UgPSB2b2lkIDA7dHJ5IHtpZiAoYikge2lmIChiID0gZnVuY3Rpb24gYigpIHt0aHJvdyBFcnJvcigpO30sIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShiLnByb3RvdHlwZSwgInByb3BzIiwgeyBzZXQ6IGZ1bmN0aW9uIHNldCgpIHt0aHJvdyBFcnJvcigpO30gfSksICJvYmplY3QiID09PSB0eXBlb2YgUmVmbGVjdCAmJiBSZWZsZWN0LmNvbnN0cnVjdCkge3RyeSB7UmVmbGVjdC5jb25zdHJ1Y3QoYiwgW10pO30gY2F0Y2ggKGwpIHt2YXIgZCA9IGw7fVJlZmxlY3QuY29uc3RydWN0KGEsIFtdLCBiKTt9IGVsc2Uge3RyeSB7Yi5jYWxsKCk7fSBjYXRjaCAobCkge2QgPSBsO31hLmNhbGwoYi5wcm90b3R5cGUpO319IGVsc2Uge3RyeSB7dGhyb3cgRXJyb3IoKTt9IGNhdGNoIChsKSB7ZCA9IGw7fWEoKTt9fSBjYXRjaCAobCkge2lmIChsICYmIGQgJiYgInN0cmluZyIgPT09IHR5cGVvZiBsLnN0YWNrKSB7Zm9yICh2YXIgZSA9IGwuc3RhY2suc3BsaXQoIlxuIiksCiAgICAgICAgICAgICAgICAgIGYgPSBkLnN0YWNrLnNwbGl0KCJcbiIpLCBnID0gZS5sZW5ndGggLSAxLCBoID0gZi5sZW5ndGggLSAxOyAxIDw9IGcgJiYgMCA8PSBoICYmIGVbZ10gIT09IGZbaF07KSBoLS07Zm9yICg7IDEgPD0gZyAmJiAwIDw9IGg7IGctLSwgaC0tKSBpZiAoZVtnXSAhPT0gZltoXSkge2lmICgxICE9PSBnIHx8IDEgIT09IGgpIHtkbyBpZiAoZy0tLCBoLS0sIDAgPiBoIHx8IGVbZ10gIT09IGZbaF0pIHt2YXIgayA9ICJcbiIgKyBlW2ddLnJlcGxhY2UoIiBhdCBuZXcgIiwgIiBhdCAiKTthLmRpc3BsYXlOYW1lICYmIGsuaW5jbHVkZXMoIjxhbm9ueW1vdXM+IikgJiYgKGsgPSBrLnJlcGxhY2UoIjxhbm9ueW1vdXM+IiwgYS5kaXNwbGF5TmFtZSkpO3JldHVybiBrO30gd2hpbGUgKDEgPD0gZyAmJiAwIDw9IGgpO31icmVhazt9fX0gZmluYWxseSB7TmEgPSAhMSwgRXJyb3IucHJlcGFyZVN0YWNrVHJhY2UgPSBjO31yZXR1cm4gKGEgPSBhID8gYS5kaXNwbGF5TmFtZSB8fCBhLm5hbWUgOiAiIikgPyBNYShhKSA6ICIiO30KICAgICAgICAgIGZ1bmN0aW9uIFBhKGEpIHtzd2l0Y2ggKGEudGFnKSB7Y2FzZSA1OnJldHVybiBNYShhLnR5cGUpO2Nhc2UgMTY6cmV0dXJuIE1hKCJMYXp5Iik7Y2FzZSAxMzpyZXR1cm4gTWEoIlN1c3BlbnNlIik7Y2FzZSAxOTpyZXR1cm4gTWEoIlN1c3BlbnNlTGlzdCIpO2Nhc2UgMDpjYXNlIDI6Y2FzZSAxNTpyZXR1cm4gYSA9IE9hKGEudHlwZSwgITEpLCBhO2Nhc2UgMTE6cmV0dXJuIGEgPSBPYShhLnR5cGUucmVuZGVyLCAhMSksIGE7Y2FzZSAxOnJldHVybiBhID0gT2EoYS50eXBlLCAhMCksIGE7ZGVmYXVsdDpyZXR1cm4gIiI7fX0KICAgICAgICAgIGZ1bmN0aW9uIFFhKGEpIHtpZiAobnVsbCA9PSBhKSByZXR1cm4gbnVsbDtpZiAoImZ1bmN0aW9uIiA9PT0gdHlwZW9mIGEpIHJldHVybiBhLmRpc3BsYXlOYW1lIHx8IGEubmFtZSB8fCBudWxsO2lmICgic3RyaW5nIiA9PT0gdHlwZW9mIGEpIHJldHVybiBhO3N3aXRjaCAoYSkge2Nhc2UgeWE6cmV0dXJuICJGcmFnbWVudCI7Y2FzZSB3YTpyZXR1cm4gIlBvcnRhbCI7Y2FzZSBBYTpyZXR1cm4gIlByb2ZpbGVyIjtjYXNlIHphOnJldHVybiAiU3RyaWN0TW9kZSI7Y2FzZSBFYTpyZXR1cm4gIlN1c3BlbnNlIjtjYXNlIEZhOnJldHVybiAiU3VzcGVuc2VMaXN0Ijt9aWYgKCJvYmplY3QiID09PSB0eXBlb2YgYSkgc3dpdGNoIChhLiQkdHlwZW9mKSB7Y2FzZSBDYTpyZXR1cm4gKGEuZGlzcGxheU5hbWUgfHwgIkNvbnRleHQiKSArICIuQ29uc3VtZXIiO2Nhc2UgQmE6cmV0dXJuIChhLl9jb250ZXh0LmRpc3BsYXlOYW1lIHx8ICJDb250ZXh0IikgKyAiLlByb3ZpZGVyIjtjYXNlIERhOnZhciBiID0gYS5yZW5kZXI7YSA9IGEuZGlzcGxheU5hbWU7YSB8fCAoYSA9IGIuZGlzcGxheU5hbWUgfHwKICAgICAgICAgICAgICAgIGIubmFtZSB8fCAiIiwgYSA9ICIiICE9PSBhID8gIkZvcndhcmRSZWYoIiArIGEgKyAiKSIgOiAiRm9yd2FyZFJlZiIpO3JldHVybiBhO2Nhc2UgR2E6cmV0dXJuIGIgPSBhLmRpc3BsYXlOYW1lIHx8IG51bGwsIG51bGwgIT09IGIgPyBiIDogUWEoYS50eXBlKSB8fCAiTWVtbyI7Y2FzZSBIYTpiID0gYS5fcGF5bG9hZDthID0gYS5faW5pdDt0cnkge3JldHVybiBRYShhKGIpKTt9IGNhdGNoIChjKSB7fX1yZXR1cm4gbnVsbDt9CiAgICAgICAgICBmdW5jdGlvbiBSYShhKSB7dmFyIGIgPSBhLnR5cGU7c3dpdGNoIChhLnRhZykge2Nhc2UgMjQ6cmV0dXJuICJDYWNoZSI7Y2FzZSA5OnJldHVybiAoYi5kaXNwbGF5TmFtZSB8fCAiQ29udGV4dCIpICsgIi5Db25zdW1lciI7Y2FzZSAxMDpyZXR1cm4gKGIuX2NvbnRleHQuZGlzcGxheU5hbWUgfHwgIkNvbnRleHQiKSArICIuUHJvdmlkZXIiO2Nhc2UgMTg6cmV0dXJuICJEZWh5ZHJhdGVkRnJhZ21lbnQiO2Nhc2UgMTE6cmV0dXJuIGEgPSBiLnJlbmRlciwgYSA9IGEuZGlzcGxheU5hbWUgfHwgYS5uYW1lIHx8ICIiLCBiLmRpc3BsYXlOYW1lIHx8ICgiIiAhPT0gYSA/ICJGb3J3YXJkUmVmKCIgKyBhICsgIikiIDogIkZvcndhcmRSZWYiKTtjYXNlIDc6cmV0dXJuICJGcmFnbWVudCI7Y2FzZSA1OnJldHVybiBiO2Nhc2UgNDpyZXR1cm4gIlBvcnRhbCI7Y2FzZSAzOnJldHVybiAiUm9vdCI7Y2FzZSA2OnJldHVybiAiVGV4dCI7Y2FzZSAxNjpyZXR1cm4gUWEoYik7Y2FzZSA4OnJldHVybiBiID09PSB6YSA/ICJTdHJpY3RNb2RlIiA6ICJNb2RlIjtjYXNlIDIyOnJldHVybiAiT2Zmc2NyZWVuIjsKICAgICAgICAgICAgICBjYXNlIDEyOnJldHVybiAiUHJvZmlsZXIiO2Nhc2UgMjE6cmV0dXJuICJTY29wZSI7Y2FzZSAxMzpyZXR1cm4gIlN1c3BlbnNlIjtjYXNlIDE5OnJldHVybiAiU3VzcGVuc2VMaXN0IjtjYXNlIDI1OnJldHVybiAiVHJhY2luZ01hcmtlciI7Y2FzZSAxOmNhc2UgMDpjYXNlIDE3OmNhc2UgMjpjYXNlIDE0OmNhc2UgMTU6aWYgKCJmdW5jdGlvbiIgPT09IHR5cGVvZiBiKSByZXR1cm4gYi5kaXNwbGF5TmFtZSB8fCBiLm5hbWUgfHwgbnVsbDtpZiAoInN0cmluZyIgPT09IHR5cGVvZiBiKSByZXR1cm4gYjt9cmV0dXJuIG51bGw7fWZ1bmN0aW9uIFNhKGEpIHtzd2l0Y2ggKHR5cGVvZiBhKSB7Y2FzZSAiYm9vbGVhbiI6Y2FzZSAibnVtYmVyIjpjYXNlICJzdHJpbmciOmNhc2UgInVuZGVmaW5lZCI6cmV0dXJuIGE7Y2FzZSAib2JqZWN0IjpyZXR1cm4gYTtkZWZhdWx0OnJldHVybiAiIjt9fQogICAgICAgICAgZnVuY3Rpb24gVGEoYSkge3ZhciBiID0gYS50eXBlO3JldHVybiAoYSA9IGEubm9kZU5hbWUpICYmICJpbnB1dCIgPT09IGEudG9Mb3dlckNhc2UoKSAmJiAoImNoZWNrYm94IiA9PT0gYiB8fCAicmFkaW8iID09PSBiKTt9CiAgICAgICAgICBmdW5jdGlvbiBVYShhKSB7dmFyIGIgPSBUYShhKSA/ICJjaGVja2VkIiA6ICJ2YWx1ZSIsYyA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IoYS5jb25zdHJ1Y3Rvci5wcm90b3R5cGUsIGIpLGQgPSAiIiArIGFbYl07aWYgKCFhLmhhc093blByb3BlcnR5KGIpICYmICJ1bmRlZmluZWQiICE9PSB0eXBlb2YgYyAmJiAiZnVuY3Rpb24iID09PSB0eXBlb2YgYy5nZXQgJiYgImZ1bmN0aW9uIiA9PT0gdHlwZW9mIGMuc2V0KSB7dmFyIGUgPSBjLmdldCxmID0gYy5zZXQ7T2JqZWN0LmRlZmluZVByb3BlcnR5KGEsIGIsIHsgY29uZmlndXJhYmxlOiAhMCwgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7cmV0dXJuIGUuY2FsbCh0aGlzKTt9LCBzZXQ6IGZ1bmN0aW9uIHNldChhKSB7ZCA9ICIiICsgYTtmLmNhbGwodGhpcywgYSk7fSB9KTtPYmplY3QuZGVmaW5lUHJvcGVydHkoYSwgYiwgeyBlbnVtZXJhYmxlOiBjLmVudW1lcmFibGUgfSk7cmV0dXJuIHsgZ2V0VmFsdWU6IGZ1bmN0aW9uIGdldFZhbHVlKCkge3JldHVybiBkO30sIHNldFZhbHVlOiBmdW5jdGlvbiBzZXRWYWx1ZShhKSB7ZCA9ICIiICsgYTt9LCBzdG9wVHJhY2tpbmc6IGZ1bmN0aW9uIHN0b3BUcmFja2luZygpIHthLl92YWx1ZVRyYWNrZXIgPQogICAgICAgICAgICAgICAgICBudWxsO2RlbGV0ZSBhW2JdO30gfTt9fWZ1bmN0aW9uIFZhKGEpIHthLl92YWx1ZVRyYWNrZXIgfHwgKGEuX3ZhbHVlVHJhY2tlciA9IFVhKGEpKTt9ZnVuY3Rpb24gV2EoYSkge2lmICghYSkgcmV0dXJuICExO3ZhciBiID0gYS5fdmFsdWVUcmFja2VyO2lmICghYikgcmV0dXJuICEwO3ZhciBjID0gYi5nZXRWYWx1ZSgpO3ZhciBkID0gIiI7YSAmJiAoZCA9IFRhKGEpID8gYS5jaGVja2VkID8gInRydWUiIDogImZhbHNlIiA6IGEudmFsdWUpO2EgPSBkO3JldHVybiBhICE9PSBjID8gKGIuc2V0VmFsdWUoYSksICEwKSA6ICExO31mdW5jdGlvbiBYYShhKSB7YSA9IGEgfHwgKCJ1bmRlZmluZWQiICE9PSB0eXBlb2YgZG9jdW1lbnQgPyBkb2N1bWVudCA6IHZvaWQgMCk7aWYgKCJ1bmRlZmluZWQiID09PSB0eXBlb2YgYSkgcmV0dXJuIG51bGw7dHJ5IHtyZXR1cm4gYS5hY3RpdmVFbGVtZW50IHx8IGEuYm9keTt9IGNhdGNoIChiKSB7cmV0dXJuIGEuYm9keTt9fQogICAgICAgICAgZnVuY3Rpb24gWWEoYSwgYikge3ZhciBjID0gYi5jaGVja2VkO3JldHVybiBBKHt9LCBiLCB7IGRlZmF1bHRDaGVja2VkOiB2b2lkIDAsIGRlZmF1bHRWYWx1ZTogdm9pZCAwLCB2YWx1ZTogdm9pZCAwLCBjaGVja2VkOiBudWxsICE9IGMgPyBjIDogYS5fd3JhcHBlclN0YXRlLmluaXRpYWxDaGVja2VkIH0pO31mdW5jdGlvbiBaYShhLCBiKSB7dmFyIGMgPSBudWxsID09IGIuZGVmYXVsdFZhbHVlID8gIiIgOiBiLmRlZmF1bHRWYWx1ZSxkID0gbnVsbCAhPSBiLmNoZWNrZWQgPyBiLmNoZWNrZWQgOiBiLmRlZmF1bHRDaGVja2VkO2MgPSBTYShudWxsICE9IGIudmFsdWUgPyBiLnZhbHVlIDogYyk7YS5fd3JhcHBlclN0YXRlID0geyBpbml0aWFsQ2hlY2tlZDogZCwgaW5pdGlhbFZhbHVlOiBjLCBjb250cm9sbGVkOiAiY2hlY2tib3giID09PSBiLnR5cGUgfHwgInJhZGlvIiA9PT0gYi50eXBlID8gbnVsbCAhPSBiLmNoZWNrZWQgOiBudWxsICE9IGIudmFsdWUgfTt9ZnVuY3Rpb24gYWIoYSwgYikge2IgPSBiLmNoZWNrZWQ7bnVsbCAhPSBiICYmIHRhKGEsICJjaGVja2VkIiwgYiwgITEpO30KICAgICAgICAgIGZ1bmN0aW9uIGJiKGEsIGIpIHthYihhLCBiKTt2YXIgYyA9IFNhKGIudmFsdWUpLGQgPSBiLnR5cGU7aWYgKG51bGwgIT0gYykge2lmICgibnVtYmVyIiA9PT0gZCkge2lmICgwID09PSBjICYmICIiID09PSBhLnZhbHVlIHx8IGEudmFsdWUgIT0gYykgYS52YWx1ZSA9ICIiICsgYzt9IGVsc2UgYS52YWx1ZSAhPT0gIiIgKyBjICYmIChhLnZhbHVlID0gIiIgKyBjKTt9IGVsc2UgaWYgKCJzdWJtaXQiID09PSBkIHx8ICJyZXNldCIgPT09IGQpIHthLnJlbW92ZUF0dHJpYnV0ZSgidmFsdWUiKTtyZXR1cm47fWIuaGFzT3duUHJvcGVydHkoInZhbHVlIikgPyBjYihhLCBiLnR5cGUsIGMpIDogYi5oYXNPd25Qcm9wZXJ0eSgiZGVmYXVsdFZhbHVlIikgJiYgY2IoYSwgYi50eXBlLCBTYShiLmRlZmF1bHRWYWx1ZSkpO251bGwgPT0gYi5jaGVja2VkICYmIG51bGwgIT0gYi5kZWZhdWx0Q2hlY2tlZCAmJiAoYS5kZWZhdWx0Q2hlY2tlZCA9ICEhYi5kZWZhdWx0Q2hlY2tlZCk7fQogICAgICAgICAgZnVuY3Rpb24gZGIoYSwgYiwgYykge2lmIChiLmhhc093blByb3BlcnR5KCJ2YWx1ZSIpIHx8IGIuaGFzT3duUHJvcGVydHkoImRlZmF1bHRWYWx1ZSIpKSB7dmFyIGQgPSBiLnR5cGU7aWYgKCEoInN1Ym1pdCIgIT09IGQgJiYgInJlc2V0IiAhPT0gZCB8fCB2b2lkIDAgIT09IGIudmFsdWUgJiYgbnVsbCAhPT0gYi52YWx1ZSkpIHJldHVybjtiID0gIiIgKyBhLl93cmFwcGVyU3RhdGUuaW5pdGlhbFZhbHVlO2MgfHwgYiA9PT0gYS52YWx1ZSB8fCAoYS52YWx1ZSA9IGIpO2EuZGVmYXVsdFZhbHVlID0gYjt9YyA9IGEubmFtZTsiIiAhPT0gYyAmJiAoYS5uYW1lID0gIiIpO2EuZGVmYXVsdENoZWNrZWQgPSAhIWEuX3dyYXBwZXJTdGF0ZS5pbml0aWFsQ2hlY2tlZDsiIiAhPT0gYyAmJiAoYS5uYW1lID0gYyk7fQogICAgICAgICAgZnVuY3Rpb24gY2IoYSwgYiwgYykge2lmICgibnVtYmVyIiAhPT0gYiB8fCBYYShhLm93bmVyRG9jdW1lbnQpICE9PSBhKSBudWxsID09IGMgPyBhLmRlZmF1bHRWYWx1ZSA9ICIiICsgYS5fd3JhcHBlclN0YXRlLmluaXRpYWxWYWx1ZSA6IGEuZGVmYXVsdFZhbHVlICE9PSAiIiArIGMgJiYgKGEuZGVmYXVsdFZhbHVlID0gIiIgKyBjKTt9dmFyIGViID0gQXJyYXkuaXNBcnJheTsKICAgICAgICAgIGZ1bmN0aW9uIGZiKGEsIGIsIGMsIGQpIHthID0gYS5vcHRpb25zO2lmIChiKSB7YiA9IHt9O2ZvciAodmFyIGUgPSAwOyBlIDwgYy5sZW5ndGg7IGUrKykgYlsiJCIgKyBjW2VdXSA9ICEwO2ZvciAoYyA9IDA7IGMgPCBhLmxlbmd0aDsgYysrKSBlID0gYi5oYXNPd25Qcm9wZXJ0eSgiJCIgKyBhW2NdLnZhbHVlKSwgYVtjXS5zZWxlY3RlZCAhPT0gZSAmJiAoYVtjXS5zZWxlY3RlZCA9IGUpLCBlICYmIGQgJiYgKGFbY10uZGVmYXVsdFNlbGVjdGVkID0gITApO30gZWxzZSB7YyA9ICIiICsgU2EoYyk7YiA9IG51bGw7Zm9yIChlID0gMDsgZSA8IGEubGVuZ3RoOyBlKyspIHtpZiAoYVtlXS52YWx1ZSA9PT0gYykge2FbZV0uc2VsZWN0ZWQgPSAhMDtkICYmIChhW2VdLmRlZmF1bHRTZWxlY3RlZCA9ICEwKTtyZXR1cm47fW51bGwgIT09IGIgfHwgYVtlXS5kaXNhYmxlZCB8fCAoYiA9IGFbZV0pO31udWxsICE9PSBiICYmIChiLnNlbGVjdGVkID0gITApO319CiAgICAgICAgICBmdW5jdGlvbiBnYihhLCBiKSB7aWYgKG51bGwgIT0gYi5kYW5nZXJvdXNseVNldElubmVySFRNTCkgdGhyb3cgRXJyb3IocCg5MSkpO3JldHVybiBBKHt9LCBiLCB7IHZhbHVlOiB2b2lkIDAsIGRlZmF1bHRWYWx1ZTogdm9pZCAwLCBjaGlsZHJlbjogIiIgKyBhLl93cmFwcGVyU3RhdGUuaW5pdGlhbFZhbHVlIH0pO31mdW5jdGlvbiBoYihhLCBiKSB7dmFyIGMgPSBiLnZhbHVlO2lmIChudWxsID09IGMpIHtjID0gYi5jaGlsZHJlbjtiID0gYi5kZWZhdWx0VmFsdWU7aWYgKG51bGwgIT0gYykge2lmIChudWxsICE9IGIpIHRocm93IEVycm9yKHAoOTIpKTtpZiAoZWIoYykpIHtpZiAoMSA8IGMubGVuZ3RoKSB0aHJvdyBFcnJvcihwKDkzKSk7YyA9IGNbMF07fWIgPSBjO31udWxsID09IGIgJiYgKGIgPSAiIik7YyA9IGI7fWEuX3dyYXBwZXJTdGF0ZSA9IHsgaW5pdGlhbFZhbHVlOiBTYShjKSB9O30KICAgICAgICAgIGZ1bmN0aW9uIGliKGEsIGIpIHt2YXIgYyA9IFNhKGIudmFsdWUpLGQgPSBTYShiLmRlZmF1bHRWYWx1ZSk7bnVsbCAhPSBjICYmIChjID0gIiIgKyBjLCBjICE9PSBhLnZhbHVlICYmIChhLnZhbHVlID0gYyksIG51bGwgPT0gYi5kZWZhdWx0VmFsdWUgJiYgYS5kZWZhdWx0VmFsdWUgIT09IGMgJiYgKGEuZGVmYXVsdFZhbHVlID0gYykpO251bGwgIT0gZCAmJiAoYS5kZWZhdWx0VmFsdWUgPSAiIiArIGQpO31mdW5jdGlvbiBqYihhKSB7dmFyIGIgPSBhLnRleHRDb250ZW50O2IgPT09IGEuX3dyYXBwZXJTdGF0ZS5pbml0aWFsVmFsdWUgJiYgIiIgIT09IGIgJiYgbnVsbCAhPT0gYiAmJiAoYS52YWx1ZSA9IGIpO31mdW5jdGlvbiBrYihhKSB7c3dpdGNoIChhKSB7Y2FzZSAic3ZnIjpyZXR1cm4gImh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIjtjYXNlICJtYXRoIjpyZXR1cm4gImh0dHA6Ly93d3cudzMub3JnLzE5OTgvTWF0aC9NYXRoTUwiO2RlZmF1bHQ6cmV0dXJuICJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hodG1sIjt9fQogICAgICAgICAgZnVuY3Rpb24gbGIoYSwgYikge3JldHVybiBudWxsID09IGEgfHwgImh0dHA6Ly93d3cudzMub3JnLzE5OTkveGh0bWwiID09PSBhID8ga2IoYikgOiAiaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciID09PSBhICYmICJmb3JlaWduT2JqZWN0IiA9PT0gYiA/ICJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hodG1sIiA6IGE7fQogICAgICAgICAgdmFyIG1iLG5iID0gZnVuY3Rpb24gKGEpIHtyZXR1cm4gInVuZGVmaW5lZCIgIT09IHR5cGVvZiBNU0FwcCAmJiBNU0FwcC5leGVjVW5zYWZlTG9jYWxGdW5jdGlvbiA/IGZ1bmN0aW9uIChiLCBjLCBkLCBlKSB7TVNBcHAuZXhlY1Vuc2FmZUxvY2FsRnVuY3Rpb24oZnVuY3Rpb24gKCkge3JldHVybiBhKGIsIGMsIGQsIGUpO30pO30gOiBhO30oZnVuY3Rpb24gKGEsIGIpIHtpZiAoImh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiAhPT0gYS5uYW1lc3BhY2VVUkkgfHwgImlubmVySFRNTCIgaW4gYSkgYS5pbm5lckhUTUwgPSBiO2Vsc2Uge21iID0gbWIgfHwgZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2Iik7bWIuaW5uZXJIVE1MID0gIjxzdmc+IiArIGIudmFsdWVPZigpLnRvU3RyaW5nKCkgKyAiPC9zdmc+Ijtmb3IgKGIgPSBtYi5maXJzdENoaWxkOyBhLmZpcnN0Q2hpbGQ7KSBhLnJlbW92ZUNoaWxkKGEuZmlyc3RDaGlsZCk7Zm9yICg7IGIuZmlyc3RDaGlsZDspIGEuYXBwZW5kQ2hpbGQoYi5maXJzdENoaWxkKTt9fSk7CiAgICAgICAgICBmdW5jdGlvbiBvYihhLCBiKSB7aWYgKGIpIHt2YXIgYyA9IGEuZmlyc3RDaGlsZDtpZiAoYyAmJiBjID09PSBhLmxhc3RDaGlsZCAmJiAzID09PSBjLm5vZGVUeXBlKSB7Yy5ub2RlVmFsdWUgPSBiO3JldHVybjt9fWEudGV4dENvbnRlbnQgPSBiO30KICAgICAgICAgIHZhciBwYiA9IHsgYW5pbWF0aW9uSXRlcmF0aW9uQ291bnQ6ICEwLCBhc3BlY3RSYXRpbzogITAsIGJvcmRlckltYWdlT3V0c2V0OiAhMCwgYm9yZGVySW1hZ2VTbGljZTogITAsIGJvcmRlckltYWdlV2lkdGg6ICEwLCBib3hGbGV4OiAhMCwgYm94RmxleEdyb3VwOiAhMCwgYm94T3JkaW5hbEdyb3VwOiAhMCwgY29sdW1uQ291bnQ6ICEwLCBjb2x1bW5zOiAhMCwgZmxleDogITAsIGZsZXhHcm93OiAhMCwgZmxleFBvc2l0aXZlOiAhMCwgZmxleFNocmluazogITAsIGZsZXhOZWdhdGl2ZTogITAsIGZsZXhPcmRlcjogITAsIGdyaWRBcmVhOiAhMCwgZ3JpZFJvdzogITAsIGdyaWRSb3dFbmQ6ICEwLCBncmlkUm93U3BhbjogITAsIGdyaWRSb3dTdGFydDogITAsIGdyaWRDb2x1bW46ICEwLCBncmlkQ29sdW1uRW5kOiAhMCwgZ3JpZENvbHVtblNwYW46ICEwLCBncmlkQ29sdW1uU3RhcnQ6ICEwLCBmb250V2VpZ2h0OiAhMCwgbGluZUNsYW1wOiAhMCwgbGluZUhlaWdodDogITAsIG9wYWNpdHk6ICEwLCBvcmRlcjogITAsIG9ycGhhbnM6ICEwLCB0YWJTaXplOiAhMCwgd2lkb3dzOiAhMCwgekluZGV4OiAhMCwKICAgICAgICAgICAgICB6b29tOiAhMCwgZmlsbE9wYWNpdHk6ICEwLCBmbG9vZE9wYWNpdHk6ICEwLCBzdG9wT3BhY2l0eTogITAsIHN0cm9rZURhc2hhcnJheTogITAsIHN0cm9rZURhc2hvZmZzZXQ6ICEwLCBzdHJva2VNaXRlcmxpbWl0OiAhMCwgc3Ryb2tlT3BhY2l0eTogITAsIHN0cm9rZVdpZHRoOiAhMCB9LHFiID0gWyJXZWJraXQiLCAibXMiLCAiTW96IiwgIk8iXTtPYmplY3Qua2V5cyhwYikuZm9yRWFjaChmdW5jdGlvbiAoYSkge3FiLmZvckVhY2goZnVuY3Rpb24gKGIpIHtiID0gYiArIGEuY2hhckF0KDApLnRvVXBwZXJDYXNlKCkgKyBhLnN1YnN0cmluZygxKTtwYltiXSA9IHBiW2FdO30pO30pO2Z1bmN0aW9uIHJiKGEsIGIsIGMpIHtyZXR1cm4gbnVsbCA9PSBiIHx8ICJib29sZWFuIiA9PT0gdHlwZW9mIGIgfHwgIiIgPT09IGIgPyAiIiA6IGMgfHwgIm51bWJlciIgIT09IHR5cGVvZiBiIHx8IDAgPT09IGIgfHwgcGIuaGFzT3duUHJvcGVydHkoYSkgJiYgcGJbYV0gPyAoIiIgKyBiKS50cmltKCkgOiBiICsgInB4Ijt9CiAgICAgICAgICBmdW5jdGlvbiBzYihhLCBiKSB7YSA9IGEuc3R5bGU7Zm9yICh2YXIgYyBpbiBiKSBpZiAoYi5oYXNPd25Qcm9wZXJ0eShjKSkge3ZhciBkID0gMCA9PT0gYy5pbmRleE9mKCItLSIpLGUgPSByYihjLCBiW2NdLCBkKTsiZmxvYXQiID09PSBjICYmIChjID0gImNzc0Zsb2F0Iik7ZCA/IGEuc2V0UHJvcGVydHkoYywgZSkgOiBhW2NdID0gZTt9fXZhciB0YiA9IEEoeyBtZW51aXRlbTogITAgfSwgeyBhcmVhOiAhMCwgYmFzZTogITAsIGJyOiAhMCwgY29sOiAhMCwgZW1iZWQ6ICEwLCBocjogITAsIGltZzogITAsIGlucHV0OiAhMCwga2V5Z2VuOiAhMCwgbGluazogITAsIG1ldGE6ICEwLCBwYXJhbTogITAsIHNvdXJjZTogITAsIHRyYWNrOiAhMCwgd2JyOiAhMCB9KTsKICAgICAgICAgIGZ1bmN0aW9uIHViKGEsIGIpIHtpZiAoYikge2lmICh0YlthXSAmJiAobnVsbCAhPSBiLmNoaWxkcmVuIHx8IG51bGwgIT0gYi5kYW5nZXJvdXNseVNldElubmVySFRNTCkpIHRocm93IEVycm9yKHAoMTM3LCBhKSk7aWYgKG51bGwgIT0gYi5kYW5nZXJvdXNseVNldElubmVySFRNTCkge2lmIChudWxsICE9IGIuY2hpbGRyZW4pIHRocm93IEVycm9yKHAoNjApKTtpZiAoIm9iamVjdCIgIT09IHR5cGVvZiBiLmRhbmdlcm91c2x5U2V0SW5uZXJIVE1MIHx8ICEoIl9faHRtbCIgaW4gYi5kYW5nZXJvdXNseVNldElubmVySFRNTCkpIHRocm93IEVycm9yKHAoNjEpKTt9aWYgKG51bGwgIT0gYi5zdHlsZSAmJiAib2JqZWN0IiAhPT0gdHlwZW9mIGIuc3R5bGUpIHRocm93IEVycm9yKHAoNjIpKTt9fQogICAgICAgICAgZnVuY3Rpb24gdmIoYSwgYikge2lmICgtMSA9PT0gYS5pbmRleE9mKCItIikpIHJldHVybiAic3RyaW5nIiA9PT0gdHlwZW9mIGIuaXM7c3dpdGNoIChhKSB7Y2FzZSAiYW5ub3RhdGlvbi14bWwiOmNhc2UgImNvbG9yLXByb2ZpbGUiOmNhc2UgImZvbnQtZmFjZSI6Y2FzZSAiZm9udC1mYWNlLXNyYyI6Y2FzZSAiZm9udC1mYWNlLXVyaSI6Y2FzZSAiZm9udC1mYWNlLWZvcm1hdCI6Y2FzZSAiZm9udC1mYWNlLW5hbWUiOmNhc2UgIm1pc3NpbmctZ2x5cGgiOnJldHVybiAhMTtkZWZhdWx0OnJldHVybiAhMDt9fXZhciB3YiA9IG51bGw7ZnVuY3Rpb24geGIoYSkge2EgPSBhLnRhcmdldCB8fCBhLnNyY0VsZW1lbnQgfHwgd2luZG93O2EuY29ycmVzcG9uZGluZ1VzZUVsZW1lbnQgJiYgKGEgPSBhLmNvcnJlc3BvbmRpbmdVc2VFbGVtZW50KTtyZXR1cm4gMyA9PT0gYS5ub2RlVHlwZSA/IGEucGFyZW50Tm9kZSA6IGE7fXZhciB5YiA9IG51bGwsemIgPSBudWxsLEFiID0gbnVsbDsKICAgICAgICAgIGZ1bmN0aW9uIEJiKGEpIHtpZiAoYSA9IENiKGEpKSB7aWYgKCJmdW5jdGlvbiIgIT09IHR5cGVvZiB5YikgdGhyb3cgRXJyb3IocCgyODApKTt2YXIgYiA9IGEuc3RhdGVOb2RlO2IgJiYgKGIgPSBEYihiKSwgeWIoYS5zdGF0ZU5vZGUsIGEudHlwZSwgYikpO319ZnVuY3Rpb24gRWIoYSkge3piID8gQWIgPyBBYi5wdXNoKGEpIDogQWIgPSBbYV0gOiB6YiA9IGE7fWZ1bmN0aW9uIEZiKCkge2lmICh6Yikge3ZhciBhID0gemIsYiA9IEFiO0FiID0gemIgPSBudWxsO0JiKGEpO2lmIChiKSBmb3IgKGEgPSAwOyBhIDwgYi5sZW5ndGg7IGErKykgQmIoYlthXSk7fX1mdW5jdGlvbiBHYihhLCBiKSB7cmV0dXJuIGEoYik7fWZ1bmN0aW9uIEhiKCkge312YXIgSWIgPSAhMTtmdW5jdGlvbiBKYihhLCBiLCBjKSB7aWYgKEliKSByZXR1cm4gYShiLCBjKTtJYiA9ICEwO3RyeSB7cmV0dXJuIEdiKGEsIGIsIGMpO30gZmluYWxseSB7aWYgKEliID0gITEsIG51bGwgIT09IHpiIHx8IG51bGwgIT09IEFiKSBIYigpLCBGYigpO319CiAgICAgICAgICBmdW5jdGlvbiBLYihhLCBiKSB7dmFyIGMgPSBhLnN0YXRlTm9kZTtpZiAobnVsbCA9PT0gYykgcmV0dXJuIG51bGw7dmFyIGQgPSBEYihjKTtpZiAobnVsbCA9PT0gZCkgcmV0dXJuIG51bGw7YyA9IGRbYl07YTogc3dpdGNoIChiKSB7Y2FzZSAib25DbGljayI6Y2FzZSAib25DbGlja0NhcHR1cmUiOmNhc2UgIm9uRG91YmxlQ2xpY2siOmNhc2UgIm9uRG91YmxlQ2xpY2tDYXB0dXJlIjpjYXNlICJvbk1vdXNlRG93biI6Y2FzZSAib25Nb3VzZURvd25DYXB0dXJlIjpjYXNlICJvbk1vdXNlTW92ZSI6Y2FzZSAib25Nb3VzZU1vdmVDYXB0dXJlIjpjYXNlICJvbk1vdXNlVXAiOmNhc2UgIm9uTW91c2VVcENhcHR1cmUiOmNhc2UgIm9uTW91c2VFbnRlciI6KGQgPSAhZC5kaXNhYmxlZCkgfHwgKGEgPSBhLnR5cGUsIGQgPSAhKCJidXR0b24iID09PSBhIHx8ICJpbnB1dCIgPT09IGEgfHwgInNlbGVjdCIgPT09IGEgfHwgInRleHRhcmVhIiA9PT0gYSkpO2EgPSAhZDticmVhayBhO2RlZmF1bHQ6YSA9ICExO31pZiAoYSkgcmV0dXJuIG51bGw7aWYgKGMgJiYgImZ1bmN0aW9uIiAhPT0KICAgICAgICAgICAgdHlwZW9mIGMpIHRocm93IEVycm9yKHAoMjMxLCBiLCB0eXBlb2YgYykpO3JldHVybiBjO312YXIgTGIgPSAhMTtpZiAoaWEpIHRyeSB7dmFyIE1iID0ge307T2JqZWN0LmRlZmluZVByb3BlcnR5KE1iLCAicGFzc2l2ZSIsIHsgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7TGIgPSAhMDt9IH0pO3dpbmRvdy5hZGRFdmVudExpc3RlbmVyKCJ0ZXN0IiwgTWIsIE1iKTt3aW5kb3cucmVtb3ZlRXZlbnRMaXN0ZW5lcigidGVzdCIsIE1iLCBNYik7fSBjYXRjaCAoYSkge0xiID0gITE7fWZ1bmN0aW9uIE5iKGEsIGIsIGMsIGQsIGUsIGYsIGcsIGgsIGspIHt2YXIgbCA9IEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGFyZ3VtZW50cywgMyk7dHJ5IHtiLmFwcGx5KGMsIGwpO30gY2F0Y2ggKG0pIHt0aGlzLm9uRXJyb3IobSk7fX12YXIgT2IgPSAhMSxQYiA9IG51bGwsUWIgPSAhMSxSYiA9IG51bGwsU2IgPSB7IG9uRXJyb3I6IGZ1bmN0aW9uIG9uRXJyb3IoYSkge09iID0gITA7UGIgPSBhO30gfTtmdW5jdGlvbiBUYihhLCBiLCBjLCBkLCBlLCBmLCBnLCBoLCBrKSB7T2IgPSAhMTtQYiA9IG51bGw7TmIuYXBwbHkoU2IsIGFyZ3VtZW50cyk7fQogICAgICAgICAgZnVuY3Rpb24gVWIoYSwgYiwgYywgZCwgZSwgZiwgZywgaCwgaykge1RiLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7aWYgKE9iKSB7aWYgKE9iKSB7dmFyIGwgPSBQYjtPYiA9ICExO1BiID0gbnVsbDt9IGVsc2UgdGhyb3cgRXJyb3IocCgxOTgpKTtRYiB8fCAoUWIgPSAhMCwgUmIgPSBsKTt9fWZ1bmN0aW9uIFZiKGEpIHt2YXIgYiA9IGEsYyA9IGE7aWYgKGEuYWx0ZXJuYXRlKSBmb3IgKDsgYi5yZXR1cm47KSBiID0gYi5yZXR1cm47ZWxzZSB7YSA9IGI7ZG8gYiA9IGEsIDAgIT09IChiLmZsYWdzICYgNDA5OCkgJiYgKGMgPSBiLnJldHVybiksIGEgPSBiLnJldHVybjsgd2hpbGUgKGEpO31yZXR1cm4gMyA9PT0gYi50YWcgPyBjIDogbnVsbDt9ZnVuY3Rpb24gV2IoYSkge2lmICgxMyA9PT0gYS50YWcpIHt2YXIgYiA9IGEubWVtb2l6ZWRTdGF0ZTtudWxsID09PSBiICYmIChhID0gYS5hbHRlcm5hdGUsIG51bGwgIT09IGEgJiYgKGIgPSBhLm1lbW9pemVkU3RhdGUpKTtpZiAobnVsbCAhPT0gYikgcmV0dXJuIGIuZGVoeWRyYXRlZDt9cmV0dXJuIG51bGw7fWZ1bmN0aW9uIFhiKGEpIHtpZiAoVmIoYSkgIT09IGEpIHRocm93IEVycm9yKHAoMTg4KSk7fQogICAgICAgICAgZnVuY3Rpb24gWWIoYSkge3ZhciBiID0gYS5hbHRlcm5hdGU7aWYgKCFiKSB7YiA9IFZiKGEpO2lmIChudWxsID09PSBiKSB0aHJvdyBFcnJvcihwKDE4OCkpO3JldHVybiBiICE9PSBhID8gbnVsbCA6IGE7fWZvciAodmFyIGMgPSBhLCBkID0gYjs7KSB7dmFyIGUgPSBjLnJldHVybjtpZiAobnVsbCA9PT0gZSkgYnJlYWs7dmFyIGYgPSBlLmFsdGVybmF0ZTtpZiAobnVsbCA9PT0gZikge2QgPSBlLnJldHVybjtpZiAobnVsbCAhPT0gZCkge2MgPSBkO2NvbnRpbnVlO31icmVhazt9aWYgKGUuY2hpbGQgPT09IGYuY2hpbGQpIHtmb3IgKGYgPSBlLmNoaWxkOyBmOykge2lmIChmID09PSBjKSByZXR1cm4gWGIoZSksIGE7aWYgKGYgPT09IGQpIHJldHVybiBYYihlKSwgYjtmID0gZi5zaWJsaW5nO310aHJvdyBFcnJvcihwKDE4OCkpO31pZiAoYy5yZXR1cm4gIT09IGQucmV0dXJuKSBjID0gZSwgZCA9IGY7ZWxzZSB7Zm9yICh2YXIgZyA9ICExLCBoID0gZS5jaGlsZDsgaDspIHtpZiAoaCA9PT0gYykge2cgPSAhMDtjID0gZTtkID0gZjticmVhazt9aWYgKGggPT09IGQpIHtnID0gITA7ZCA9IGU7YyA9IGY7YnJlYWs7fWggPSBoLnNpYmxpbmc7fWlmICghZykge2ZvciAoaCA9IGYuY2hpbGQ7IGg7KSB7aWYgKGggPT09CiAgICAgICAgICAgICAgICAgICAgYykge2cgPSAhMDtjID0gZjtkID0gZTticmVhazt9aWYgKGggPT09IGQpIHtnID0gITA7ZCA9IGY7YyA9IGU7YnJlYWs7fWggPSBoLnNpYmxpbmc7fWlmICghZykgdGhyb3cgRXJyb3IocCgxODkpKTt9fWlmIChjLmFsdGVybmF0ZSAhPT0gZCkgdGhyb3cgRXJyb3IocCgxOTApKTt9aWYgKDMgIT09IGMudGFnKSB0aHJvdyBFcnJvcihwKDE4OCkpO3JldHVybiBjLnN0YXRlTm9kZS5jdXJyZW50ID09PSBjID8gYSA6IGI7fWZ1bmN0aW9uIFpiKGEpIHthID0gWWIoYSk7cmV0dXJuIG51bGwgIT09IGEgPyAkYihhKSA6IG51bGw7fWZ1bmN0aW9uICRiKGEpIHtpZiAoNSA9PT0gYS50YWcgfHwgNiA9PT0gYS50YWcpIHJldHVybiBhO2ZvciAoYSA9IGEuY2hpbGQ7IG51bGwgIT09IGE7KSB7dmFyIGIgPSAkYihhKTtpZiAobnVsbCAhPT0gYikgcmV0dXJuIGI7YSA9IGEuc2libGluZzt9cmV0dXJuIG51bGw7fQogICAgICAgICAgdmFyIGFjID0gY2EudW5zdGFibGVfc2NoZWR1bGVDYWxsYmFjayxiYyA9IGNhLnVuc3RhYmxlX2NhbmNlbENhbGxiYWNrLGNjID0gY2EudW5zdGFibGVfc2hvdWxkWWllbGQsZGMgPSBjYS51bnN0YWJsZV9yZXF1ZXN0UGFpbnQsQiA9IGNhLnVuc3RhYmxlX25vdyxlYyA9IGNhLnVuc3RhYmxlX2dldEN1cnJlbnRQcmlvcml0eUxldmVsLGZjID0gY2EudW5zdGFibGVfSW1tZWRpYXRlUHJpb3JpdHksZ2MgPSBjYS51bnN0YWJsZV9Vc2VyQmxvY2tpbmdQcmlvcml0eSxoYyA9IGNhLnVuc3RhYmxlX05vcm1hbFByaW9yaXR5LGljID0gY2EudW5zdGFibGVfTG93UHJpb3JpdHksamMgPSBjYS51bnN0YWJsZV9JZGxlUHJpb3JpdHksa2MgPSBudWxsLGxjID0gbnVsbDtmdW5jdGlvbiBtYyhhKSB7aWYgKGxjICYmICJmdW5jdGlvbiIgPT09IHR5cGVvZiBsYy5vbkNvbW1pdEZpYmVyUm9vdCkgdHJ5IHtsYy5vbkNvbW1pdEZpYmVyUm9vdChrYywgYSwgdm9pZCAwLCAxMjggPT09IChhLmN1cnJlbnQuZmxhZ3MgJiAxMjgpKTt9IGNhdGNoIChiKSB7fX0KICAgICAgICAgIHZhciBvYyA9IE1hdGguY2x6MzIgPyBNYXRoLmNsejMyIDogbmMscGMgPSBNYXRoLmxvZyxxYyA9IE1hdGguTE4yO2Z1bmN0aW9uIG5jKGEpIHthID4+Pj0gMDtyZXR1cm4gMCA9PT0gYSA/IDMyIDogMzEgLSAocGMoYSkgLyBxYyB8IDApIHwgMDt9dmFyIHJjID0gNjQsc2MgPSA0MTk0MzA0OwogICAgICAgICAgZnVuY3Rpb24gdGMoYSkge3N3aXRjaCAoYSAmIC1hKSB7Y2FzZSAxOnJldHVybiAxO2Nhc2UgMjpyZXR1cm4gMjtjYXNlIDQ6cmV0dXJuIDQ7Y2FzZSA4OnJldHVybiA4O2Nhc2UgMTY6cmV0dXJuIDE2O2Nhc2UgMzI6cmV0dXJuIDMyO2Nhc2UgNjQ6Y2FzZSAxMjg6Y2FzZSAyNTY6Y2FzZSA1MTI6Y2FzZSAxMDI0OmNhc2UgMjA0ODpjYXNlIDQwOTY6Y2FzZSA4MTkyOmNhc2UgMTYzODQ6Y2FzZSAzMjc2ODpjYXNlIDY1NTM2OmNhc2UgMTMxMDcyOmNhc2UgMjYyMTQ0OmNhc2UgNTI0Mjg4OmNhc2UgMTA0ODU3NjpjYXNlIDIwOTcxNTI6cmV0dXJuIGEgJiA0MTk0MjQwO2Nhc2UgNDE5NDMwNDpjYXNlIDgzODg2MDg6Y2FzZSAxNjc3NzIxNjpjYXNlIDMzNTU0NDMyOmNhc2UgNjcxMDg4NjQ6cmV0dXJuIGEgJiAxMzAwMjM0MjQ7Y2FzZSAxMzQyMTc3Mjg6cmV0dXJuIDEzNDIxNzcyODtjYXNlIDI2ODQzNTQ1NjpyZXR1cm4gMjY4NDM1NDU2O2Nhc2UgNTM2ODcwOTEyOnJldHVybiA1MzY4NzA5MTI7Y2FzZSAxMDczNzQxODI0OnJldHVybiAxMDczNzQxODI0OwogICAgICAgICAgICAgIGRlZmF1bHQ6cmV0dXJuIGE7fX1mdW5jdGlvbiB1YyhhLCBiKSB7dmFyIGMgPSBhLnBlbmRpbmdMYW5lcztpZiAoMCA9PT0gYykgcmV0dXJuIDA7dmFyIGQgPSAwLGUgPSBhLnN1c3BlbmRlZExhbmVzLGYgPSBhLnBpbmdlZExhbmVzLGcgPSBjICYgMjY4NDM1NDU1O2lmICgwICE9PSBnKSB7dmFyIGggPSBnICYgfmU7MCAhPT0gaCA/IGQgPSB0YyhoKSA6IChmICY9IGcsIDAgIT09IGYgJiYgKGQgPSB0YyhmKSkpO30gZWxzZSBnID0gYyAmIH5lLCAwICE9PSBnID8gZCA9IHRjKGcpIDogMCAhPT0gZiAmJiAoZCA9IHRjKGYpKTtpZiAoMCA9PT0gZCkgcmV0dXJuIDA7aWYgKDAgIT09IGIgJiYgYiAhPT0gZCAmJiAwID09PSAoYiAmIGUpICYmIChlID0gZCAmIC1kLCBmID0gYiAmIC1iLCBlID49IGYgfHwgMTYgPT09IGUgJiYgMCAhPT0gKGYgJiA0MTk0MjQwKSkpIHJldHVybiBiOzAgIT09IChkICYgNCkgJiYgKGQgfD0gYyAmIDE2KTtiID0gYS5lbnRhbmdsZWRMYW5lcztpZiAoMCAhPT0gYikgZm9yIChhID0gYS5lbnRhbmdsZW1lbnRzLCBiICY9IGQ7IDAgPCBiOykgYyA9IDMxIC0gb2MoYiksIGUgPSAxIDw8IGMsIGQgfD0gYVtjXSwgYiAmPSB+ZTtyZXR1cm4gZDt9CiAgICAgICAgICBmdW5jdGlvbiB2YyhhLCBiKSB7c3dpdGNoIChhKSB7Y2FzZSAxOmNhc2UgMjpjYXNlIDQ6cmV0dXJuIGIgKyAyNTA7Y2FzZSA4OmNhc2UgMTY6Y2FzZSAzMjpjYXNlIDY0OmNhc2UgMTI4OmNhc2UgMjU2OmNhc2UgNTEyOmNhc2UgMTAyNDpjYXNlIDIwNDg6Y2FzZSA0MDk2OmNhc2UgODE5MjpjYXNlIDE2Mzg0OmNhc2UgMzI3Njg6Y2FzZSA2NTUzNjpjYXNlIDEzMTA3MjpjYXNlIDI2MjE0NDpjYXNlIDUyNDI4ODpjYXNlIDEwNDg1NzY6Y2FzZSAyMDk3MTUyOnJldHVybiBiICsgNUUzO2Nhc2UgNDE5NDMwNDpjYXNlIDgzODg2MDg6Y2FzZSAxNjc3NzIxNjpjYXNlIDMzNTU0NDMyOmNhc2UgNjcxMDg4NjQ6cmV0dXJuIC0xO2Nhc2UgMTM0MjE3NzI4OmNhc2UgMjY4NDM1NDU2OmNhc2UgNTM2ODcwOTEyOmNhc2UgMTA3Mzc0MTgyNDpyZXR1cm4gLTE7ZGVmYXVsdDpyZXR1cm4gLTE7fX0KICAgICAgICAgIGZ1bmN0aW9uIHdjKGEsIGIpIHtmb3IgKHZhciBjID0gYS5zdXNwZW5kZWRMYW5lcywgZCA9IGEucGluZ2VkTGFuZXMsIGUgPSBhLmV4cGlyYXRpb25UaW1lcywgZiA9IGEucGVuZGluZ0xhbmVzOyAwIDwgZjspIHt2YXIgZyA9IDMxIC0gb2MoZiksaCA9IDEgPDwgZyxrID0gZVtnXTtpZiAoLTEgPT09IGspIHtpZiAoMCA9PT0gKGggJiBjKSB8fCAwICE9PSAoaCAmIGQpKSBlW2ddID0gdmMoaCwgYik7fSBlbHNlIGsgPD0gYiAmJiAoYS5leHBpcmVkTGFuZXMgfD0gaCk7ZiAmPSB+aDt9fWZ1bmN0aW9uIHhjKGEpIHthID0gYS5wZW5kaW5nTGFuZXMgJiAtMTA3Mzc0MTgyNTtyZXR1cm4gMCAhPT0gYSA/IGEgOiBhICYgMTA3Mzc0MTgyNCA/IDEwNzM3NDE4MjQgOiAwO31mdW5jdGlvbiB5YygpIHt2YXIgYSA9IHJjO3JjIDw8PSAxOzAgPT09IChyYyAmIDQxOTQyNDApICYmIChyYyA9IDY0KTtyZXR1cm4gYTt9ZnVuY3Rpb24gemMoYSkge2ZvciAodmFyIGIgPSBbXSwgYyA9IDA7IDMxID4gYzsgYysrKSBiLnB1c2goYSk7cmV0dXJuIGI7fQogICAgICAgICAgZnVuY3Rpb24gQWMoYSwgYiwgYykge2EucGVuZGluZ0xhbmVzIHw9IGI7NTM2ODcwOTEyICE9PSBiICYmIChhLnN1c3BlbmRlZExhbmVzID0gMCwgYS5waW5nZWRMYW5lcyA9IDApO2EgPSBhLmV2ZW50VGltZXM7YiA9IDMxIC0gb2MoYik7YVtiXSA9IGM7fWZ1bmN0aW9uIEJjKGEsIGIpIHt2YXIgYyA9IGEucGVuZGluZ0xhbmVzICYgfmI7YS5wZW5kaW5nTGFuZXMgPSBiO2Euc3VzcGVuZGVkTGFuZXMgPSAwO2EucGluZ2VkTGFuZXMgPSAwO2EuZXhwaXJlZExhbmVzICY9IGI7YS5tdXRhYmxlUmVhZExhbmVzICY9IGI7YS5lbnRhbmdsZWRMYW5lcyAmPSBiO2IgPSBhLmVudGFuZ2xlbWVudHM7dmFyIGQgPSBhLmV2ZW50VGltZXM7Zm9yIChhID0gYS5leHBpcmF0aW9uVGltZXM7IDAgPCBjOykge3ZhciBlID0gMzEgLSBvYyhjKSxmID0gMSA8PCBlO2JbZV0gPSAwO2RbZV0gPSAtMTthW2VdID0gLTE7YyAmPSB+Zjt9fQogICAgICAgICAgZnVuY3Rpb24gQ2MoYSwgYikge3ZhciBjID0gYS5lbnRhbmdsZWRMYW5lcyB8PSBiO2ZvciAoYSA9IGEuZW50YW5nbGVtZW50czsgYzspIHt2YXIgZCA9IDMxIC0gb2MoYyksZSA9IDEgPDwgZDtlICYgYiB8IGFbZF0gJiBiICYmIChhW2RdIHw9IGIpO2MgJj0gfmU7fX12YXIgQyA9IDA7ZnVuY3Rpb24gRGMoYSkge2EgJj0gLWE7cmV0dXJuIDEgPCBhID8gNCA8IGEgPyAwICE9PSAoYSAmIDI2ODQzNTQ1NSkgPyAxNiA6IDUzNjg3MDkxMiA6IDQgOiAxO312YXIgRWMsRmMsR2MsSGMsSWMsSmMgPSAhMSxLYyA9IFtdLExjID0gbnVsbCxNYyA9IG51bGwsTmMgPSBudWxsLE9jID0gbmV3IE1hcCgpLFBjID0gbmV3IE1hcCgpLFFjID0gW10sUmMgPSAibW91c2Vkb3duIG1vdXNldXAgdG91Y2hjYW5jZWwgdG91Y2hlbmQgdG91Y2hzdGFydCBhdXhjbGljayBkYmxjbGljayBwb2ludGVyY2FuY2VsIHBvaW50ZXJkb3duIHBvaW50ZXJ1cCBkcmFnZW5kIGRyYWdzdGFydCBkcm9wIGNvbXBvc2l0aW9uZW5kIGNvbXBvc2l0aW9uc3RhcnQga2V5ZG93biBrZXlwcmVzcyBrZXl1cCBpbnB1dCB0ZXh0SW5wdXQgY29weSBjdXQgcGFzdGUgY2xpY2sgY2hhbmdlIGNvbnRleHRtZW51IHJlc2V0IHN1Ym1pdCIuc3BsaXQoIiAiKTsKICAgICAgICAgIGZ1bmN0aW9uIFNjKGEsIGIpIHtzd2l0Y2ggKGEpIHtjYXNlICJmb2N1c2luIjpjYXNlICJmb2N1c291dCI6TGMgPSBudWxsO2JyZWFrO2Nhc2UgImRyYWdlbnRlciI6Y2FzZSAiZHJhZ2xlYXZlIjpNYyA9IG51bGw7YnJlYWs7Y2FzZSAibW91c2VvdmVyIjpjYXNlICJtb3VzZW91dCI6TmMgPSBudWxsO2JyZWFrO2Nhc2UgInBvaW50ZXJvdmVyIjpjYXNlICJwb2ludGVyb3V0IjpPYy5kZWxldGUoYi5wb2ludGVySWQpO2JyZWFrO2Nhc2UgImdvdHBvaW50ZXJjYXB0dXJlIjpjYXNlICJsb3N0cG9pbnRlcmNhcHR1cmUiOlBjLmRlbGV0ZShiLnBvaW50ZXJJZCk7fX0KICAgICAgICAgIGZ1bmN0aW9uIFRjKGEsIGIsIGMsIGQsIGUsIGYpIHtpZiAobnVsbCA9PT0gYSB8fCBhLm5hdGl2ZUV2ZW50ICE9PSBmKSByZXR1cm4gYSA9IHsgYmxvY2tlZE9uOiBiLCBkb21FdmVudE5hbWU6IGMsIGV2ZW50U3lzdGVtRmxhZ3M6IGQsIG5hdGl2ZUV2ZW50OiBmLCB0YXJnZXRDb250YWluZXJzOiBbZV0gfSwgbnVsbCAhPT0gYiAmJiAoYiA9IENiKGIpLCBudWxsICE9PSBiICYmIEZjKGIpKSwgYTthLmV2ZW50U3lzdGVtRmxhZ3MgfD0gZDtiID0gYS50YXJnZXRDb250YWluZXJzO251bGwgIT09IGUgJiYgLTEgPT09IGIuaW5kZXhPZihlKSAmJiBiLnB1c2goZSk7cmV0dXJuIGE7fQogICAgICAgICAgZnVuY3Rpb24gVWMoYSwgYiwgYywgZCwgZSkge3N3aXRjaCAoYikge2Nhc2UgImZvY3VzaW4iOnJldHVybiBMYyA9IFRjKExjLCBhLCBiLCBjLCBkLCBlKSwgITA7Y2FzZSAiZHJhZ2VudGVyIjpyZXR1cm4gTWMgPSBUYyhNYywgYSwgYiwgYywgZCwgZSksICEwO2Nhc2UgIm1vdXNlb3ZlciI6cmV0dXJuIE5jID0gVGMoTmMsIGEsIGIsIGMsIGQsIGUpLCAhMDtjYXNlICJwb2ludGVyb3ZlciI6dmFyIGYgPSBlLnBvaW50ZXJJZDtPYy5zZXQoZiwgVGMoT2MuZ2V0KGYpIHx8IG51bGwsIGEsIGIsIGMsIGQsIGUpKTtyZXR1cm4gITA7Y2FzZSAiZ290cG9pbnRlcmNhcHR1cmUiOnJldHVybiBmID0gZS5wb2ludGVySWQsIFBjLnNldChmLCBUYyhQYy5nZXQoZikgfHwgbnVsbCwgYSwgYiwgYywgZCwgZSkpLCAhMDt9cmV0dXJuICExO30KICAgICAgICAgIGZ1bmN0aW9uIFZjKGEpIHt2YXIgYiA9IFdjKGEudGFyZ2V0KTtpZiAobnVsbCAhPT0gYikge3ZhciBjID0gVmIoYik7aWYgKG51bGwgIT09IGMpIGlmIChiID0gYy50YWcsIDEzID09PSBiKSB7aWYgKGIgPSBXYihjKSwgbnVsbCAhPT0gYikge2EuYmxvY2tlZE9uID0gYjtJYyhhLnByaW9yaXR5LCBmdW5jdGlvbiAoKSB7R2MoYyk7fSk7cmV0dXJuO319IGVsc2UgaWYgKDMgPT09IGIgJiYgYy5zdGF0ZU5vZGUuY3VycmVudC5tZW1vaXplZFN0YXRlLmlzRGVoeWRyYXRlZCkge2EuYmxvY2tlZE9uID0gMyA9PT0gYy50YWcgPyBjLnN0YXRlTm9kZS5jb250YWluZXJJbmZvIDogbnVsbDtyZXR1cm47fX1hLmJsb2NrZWRPbiA9IG51bGw7fQogICAgICAgICAgZnVuY3Rpb24gWGMoYSkge2lmIChudWxsICE9PSBhLmJsb2NrZWRPbikgcmV0dXJuICExO2ZvciAodmFyIGIgPSBhLnRhcmdldENvbnRhaW5lcnM7IDAgPCBiLmxlbmd0aDspIHt2YXIgYyA9IFljKGEuZG9tRXZlbnROYW1lLCBhLmV2ZW50U3lzdGVtRmxhZ3MsIGJbMF0sIGEubmF0aXZlRXZlbnQpO2lmIChudWxsID09PSBjKSB7YyA9IGEubmF0aXZlRXZlbnQ7dmFyIGQgPSBuZXcgYy5jb25zdHJ1Y3RvcihjLnR5cGUsIGMpO3diID0gZDtjLnRhcmdldC5kaXNwYXRjaEV2ZW50KGQpO3diID0gbnVsbDt9IGVsc2UgcmV0dXJuIGIgPSBDYihjKSwgbnVsbCAhPT0gYiAmJiBGYyhiKSwgYS5ibG9ja2VkT24gPSBjLCAhMTtiLnNoaWZ0KCk7fXJldHVybiAhMDt9ZnVuY3Rpb24gWmMoYSwgYiwgYykge1hjKGEpICYmIGMuZGVsZXRlKGIpO31mdW5jdGlvbiAkYygpIHtKYyA9ICExO251bGwgIT09IExjICYmIFhjKExjKSAmJiAoTGMgPSBudWxsKTtudWxsICE9PSBNYyAmJiBYYyhNYykgJiYgKE1jID0gbnVsbCk7bnVsbCAhPT0gTmMgJiYgWGMoTmMpICYmIChOYyA9IG51bGwpO09jLmZvckVhY2goWmMpO1BjLmZvckVhY2goWmMpO30KICAgICAgICAgIGZ1bmN0aW9uIGFkKGEsIGIpIHthLmJsb2NrZWRPbiA9PT0gYiAmJiAoYS5ibG9ja2VkT24gPSBudWxsLCBKYyB8fCAoSmMgPSAhMCwgY2EudW5zdGFibGVfc2NoZWR1bGVDYWxsYmFjayhjYS51bnN0YWJsZV9Ob3JtYWxQcmlvcml0eSwgJGMpKSk7fQogICAgICAgICAgZnVuY3Rpb24gYmQoYSkge2Z1bmN0aW9uIGIoYikge3JldHVybiBhZChiLCBhKTt9aWYgKDAgPCBLYy5sZW5ndGgpIHthZChLY1swXSwgYSk7Zm9yICh2YXIgYyA9IDE7IGMgPCBLYy5sZW5ndGg7IGMrKykge3ZhciBkID0gS2NbY107ZC5ibG9ja2VkT24gPT09IGEgJiYgKGQuYmxvY2tlZE9uID0gbnVsbCk7fX1udWxsICE9PSBMYyAmJiBhZChMYywgYSk7bnVsbCAhPT0gTWMgJiYgYWQoTWMsIGEpO251bGwgIT09IE5jICYmIGFkKE5jLCBhKTtPYy5mb3JFYWNoKGIpO1BjLmZvckVhY2goYik7Zm9yIChjID0gMDsgYyA8IFFjLmxlbmd0aDsgYysrKSBkID0gUWNbY10sIGQuYmxvY2tlZE9uID09PSBhICYmIChkLmJsb2NrZWRPbiA9IG51bGwpO2ZvciAoOyAwIDwgUWMubGVuZ3RoICYmIChjID0gUWNbMF0sIG51bGwgPT09IGMuYmxvY2tlZE9uKTspIFZjKGMpLCBudWxsID09PSBjLmJsb2NrZWRPbiAmJiBRYy5zaGlmdCgpO312YXIgY2QgPSB1YS5SZWFjdEN1cnJlbnRCYXRjaENvbmZpZyxkZCA9ICEwOwogICAgICAgICAgZnVuY3Rpb24gZWQoYSwgYiwgYywgZCkge3ZhciBlID0gQyxmID0gY2QudHJhbnNpdGlvbjtjZC50cmFuc2l0aW9uID0gbnVsbDt0cnkge0MgPSAxLCBmZChhLCBiLCBjLCBkKTt9IGZpbmFsbHkge0MgPSBlLCBjZC50cmFuc2l0aW9uID0gZjt9fWZ1bmN0aW9uIGdkKGEsIGIsIGMsIGQpIHt2YXIgZSA9IEMsZiA9IGNkLnRyYW5zaXRpb247Y2QudHJhbnNpdGlvbiA9IG51bGw7dHJ5IHtDID0gNCwgZmQoYSwgYiwgYywgZCk7fSBmaW5hbGx5IHtDID0gZSwgY2QudHJhbnNpdGlvbiA9IGY7fX0KICAgICAgICAgIGZ1bmN0aW9uIGZkKGEsIGIsIGMsIGQpIHtpZiAoZGQpIHt2YXIgZSA9IFljKGEsIGIsIGMsIGQpO2lmIChudWxsID09PSBlKSBoZChhLCBiLCBkLCBpZCwgYyksIFNjKGEsIGQpO2Vsc2UgaWYgKFVjKGUsIGEsIGIsIGMsIGQpKSBkLnN0b3BQcm9wYWdhdGlvbigpO2Vsc2UgaWYgKFNjKGEsIGQpLCBiICYgNCAmJiAtMSA8IFJjLmluZGV4T2YoYSkpIHtmb3IgKDsgbnVsbCAhPT0gZTspIHt2YXIgZiA9IENiKGUpO251bGwgIT09IGYgJiYgRWMoZik7ZiA9IFljKGEsIGIsIGMsIGQpO251bGwgPT09IGYgJiYgaGQoYSwgYiwgZCwgaWQsIGMpO2lmIChmID09PSBlKSBicmVhaztlID0gZjt9bnVsbCAhPT0gZSAmJiBkLnN0b3BQcm9wYWdhdGlvbigpO30gZWxzZSBoZChhLCBiLCBkLCBudWxsLCBjKTt9fXZhciBpZCA9IG51bGw7CiAgICAgICAgICBmdW5jdGlvbiBZYyhhLCBiLCBjLCBkKSB7aWQgPSBudWxsO2EgPSB4YihkKTthID0gV2MoYSk7aWYgKG51bGwgIT09IGEpIGlmIChiID0gVmIoYSksIG51bGwgPT09IGIpIGEgPSBudWxsO2Vsc2UgaWYgKGMgPSBiLnRhZywgMTMgPT09IGMpIHthID0gV2IoYik7aWYgKG51bGwgIT09IGEpIHJldHVybiBhO2EgPSBudWxsO30gZWxzZSBpZiAoMyA9PT0gYykge2lmIChiLnN0YXRlTm9kZS5jdXJyZW50Lm1lbW9pemVkU3RhdGUuaXNEZWh5ZHJhdGVkKSByZXR1cm4gMyA9PT0gYi50YWcgPyBiLnN0YXRlTm9kZS5jb250YWluZXJJbmZvIDogbnVsbDthID0gbnVsbDt9IGVsc2UgYiAhPT0gYSAmJiAoYSA9IG51bGwpO2lkID0gYTtyZXR1cm4gbnVsbDt9CiAgICAgICAgICBmdW5jdGlvbiBqZChhKSB7c3dpdGNoIChhKSB7Y2FzZSAiY2FuY2VsIjpjYXNlICJjbGljayI6Y2FzZSAiY2xvc2UiOmNhc2UgImNvbnRleHRtZW51IjpjYXNlICJjb3B5IjpjYXNlICJjdXQiOmNhc2UgImF1eGNsaWNrIjpjYXNlICJkYmxjbGljayI6Y2FzZSAiZHJhZ2VuZCI6Y2FzZSAiZHJhZ3N0YXJ0IjpjYXNlICJkcm9wIjpjYXNlICJmb2N1c2luIjpjYXNlICJmb2N1c291dCI6Y2FzZSAiaW5wdXQiOmNhc2UgImludmFsaWQiOmNhc2UgImtleWRvd24iOmNhc2UgImtleXByZXNzIjpjYXNlICJrZXl1cCI6Y2FzZSAibW91c2Vkb3duIjpjYXNlICJtb3VzZXVwIjpjYXNlICJwYXN0ZSI6Y2FzZSAicGF1c2UiOmNhc2UgInBsYXkiOmNhc2UgInBvaW50ZXJjYW5jZWwiOmNhc2UgInBvaW50ZXJkb3duIjpjYXNlICJwb2ludGVydXAiOmNhc2UgInJhdGVjaGFuZ2UiOmNhc2UgInJlc2V0IjpjYXNlICJyZXNpemUiOmNhc2UgInNlZWtlZCI6Y2FzZSAic3VibWl0IjpjYXNlICJ0b3VjaGNhbmNlbCI6Y2FzZSAidG91Y2hlbmQiOmNhc2UgInRvdWNoc3RhcnQiOmNhc2UgInZvbHVtZWNoYW5nZSI6Y2FzZSAiY2hhbmdlIjpjYXNlICJzZWxlY3Rpb25jaGFuZ2UiOmNhc2UgInRleHRJbnB1dCI6Y2FzZSAiY29tcG9zaXRpb25zdGFydCI6Y2FzZSAiY29tcG9zaXRpb25lbmQiOmNhc2UgImNvbXBvc2l0aW9udXBkYXRlIjpjYXNlICJiZWZvcmVibHVyIjpjYXNlICJhZnRlcmJsdXIiOmNhc2UgImJlZm9yZWlucHV0IjpjYXNlICJibHVyIjpjYXNlICJmdWxsc2NyZWVuY2hhbmdlIjpjYXNlICJmb2N1cyI6Y2FzZSAiaGFzaGNoYW5nZSI6Y2FzZSAicG9wc3RhdGUiOmNhc2UgInNlbGVjdCI6Y2FzZSAic2VsZWN0c3RhcnQiOnJldHVybiAxO2Nhc2UgImRyYWciOmNhc2UgImRyYWdlbnRlciI6Y2FzZSAiZHJhZ2V4aXQiOmNhc2UgImRyYWdsZWF2ZSI6Y2FzZSAiZHJhZ292ZXIiOmNhc2UgIm1vdXNlbW92ZSI6Y2FzZSAibW91c2VvdXQiOmNhc2UgIm1vdXNlb3ZlciI6Y2FzZSAicG9pbnRlcm1vdmUiOmNhc2UgInBvaW50ZXJvdXQiOmNhc2UgInBvaW50ZXJvdmVyIjpjYXNlICJzY3JvbGwiOmNhc2UgInRvZ2dsZSI6Y2FzZSAidG91Y2htb3ZlIjpjYXNlICJ3aGVlbCI6Y2FzZSAibW91c2VlbnRlciI6Y2FzZSAibW91c2VsZWF2ZSI6Y2FzZSAicG9pbnRlcmVudGVyIjpjYXNlICJwb2ludGVybGVhdmUiOnJldHVybiA0OwogICAgICAgICAgICAgIGNhc2UgIm1lc3NhZ2UiOnN3aXRjaCAoZWMoKSkge2Nhc2UgZmM6cmV0dXJuIDE7Y2FzZSBnYzpyZXR1cm4gNDtjYXNlIGhjOmNhc2UgaWM6cmV0dXJuIDE2O2Nhc2UgamM6cmV0dXJuIDUzNjg3MDkxMjtkZWZhdWx0OnJldHVybiAxNjt9ZGVmYXVsdDpyZXR1cm4gMTY7fX12YXIga2QgPSBudWxsLGxkID0gbnVsbCxtZCA9IG51bGw7ZnVuY3Rpb24gbmQoKSB7aWYgKG1kKSByZXR1cm4gbWQ7dmFyIGEsYiA9IGxkLGMgPSBiLmxlbmd0aCxkLGUgPSAidmFsdWUiIGluIGtkID8ga2QudmFsdWUgOiBrZC50ZXh0Q29udGVudCxmID0gZS5sZW5ndGg7Zm9yIChhID0gMDsgYSA8IGMgJiYgYlthXSA9PT0gZVthXTsgYSsrKTt2YXIgZyA9IGMgLSBhO2ZvciAoZCA9IDE7IGQgPD0gZyAmJiBiW2MgLSBkXSA9PT0gZVtmIC0gZF07IGQrKyk7cmV0dXJuIG1kID0gZS5zbGljZShhLCAxIDwgZCA/IDEgLSBkIDogdm9pZCAwKTt9CiAgICAgICAgICBmdW5jdGlvbiBvZChhKSB7dmFyIGIgPSBhLmtleUNvZGU7ImNoYXJDb2RlIiBpbiBhID8gKGEgPSBhLmNoYXJDb2RlLCAwID09PSBhICYmIDEzID09PSBiICYmIChhID0gMTMpKSA6IGEgPSBiOzEwID09PSBhICYmIChhID0gMTMpO3JldHVybiAzMiA8PSBhIHx8IDEzID09PSBhID8gYSA6IDA7fWZ1bmN0aW9uIHBkKCkge3JldHVybiAhMDt9ZnVuY3Rpb24gcWQoKSB7cmV0dXJuICExO30KICAgICAgICAgIGZ1bmN0aW9uIHJkKGEpIHtmdW5jdGlvbiBiKGIsIGQsIGUsIGYsIGcpIHt0aGlzLl9yZWFjdE5hbWUgPSBiO3RoaXMuX3RhcmdldEluc3QgPSBlO3RoaXMudHlwZSA9IGQ7dGhpcy5uYXRpdmVFdmVudCA9IGY7dGhpcy50YXJnZXQgPSBnO3RoaXMuY3VycmVudFRhcmdldCA9IG51bGw7Zm9yICh2YXIgYyBpbiBhKSBhLmhhc093blByb3BlcnR5KGMpICYmIChiID0gYVtjXSwgdGhpc1tjXSA9IGIgPyBiKGYpIDogZltjXSk7dGhpcy5pc0RlZmF1bHRQcmV2ZW50ZWQgPSAobnVsbCAhPSBmLmRlZmF1bHRQcmV2ZW50ZWQgPyBmLmRlZmF1bHRQcmV2ZW50ZWQgOiAhMSA9PT0gZi5yZXR1cm5WYWx1ZSkgPyBwZCA6IHFkO3RoaXMuaXNQcm9wYWdhdGlvblN0b3BwZWQgPSBxZDtyZXR1cm4gdGhpczt9QShiLnByb3RvdHlwZSwgeyBwcmV2ZW50RGVmYXVsdDogZnVuY3Rpb24gcHJldmVudERlZmF1bHQoKSB7dGhpcy5kZWZhdWx0UHJldmVudGVkID0gITA7dmFyIGEgPSB0aGlzLm5hdGl2ZUV2ZW50O2EgJiYgKGEucHJldmVudERlZmF1bHQgPyBhLnByZXZlbnREZWZhdWx0KCkgOiAidW5rbm93biIgIT09IHR5cGVvZiBhLnJldHVyblZhbHVlICYmICgKICAgICAgICAgICAgICAgIGEucmV0dXJuVmFsdWUgPSAhMSksIHRoaXMuaXNEZWZhdWx0UHJldmVudGVkID0gcGQpO30sIHN0b3BQcm9wYWdhdGlvbjogZnVuY3Rpb24gc3RvcFByb3BhZ2F0aW9uKCkge3ZhciBhID0gdGhpcy5uYXRpdmVFdmVudDthICYmIChhLnN0b3BQcm9wYWdhdGlvbiA/IGEuc3RvcFByb3BhZ2F0aW9uKCkgOiAidW5rbm93biIgIT09IHR5cGVvZiBhLmNhbmNlbEJ1YmJsZSAmJiAoYS5jYW5jZWxCdWJibGUgPSAhMCksIHRoaXMuaXNQcm9wYWdhdGlvblN0b3BwZWQgPSBwZCk7fSwgcGVyc2lzdDogZnVuY3Rpb24gcGVyc2lzdCgpIHt9LCBpc1BlcnNpc3RlbnQ6IHBkIH0pO3JldHVybiBiO30KICAgICAgICAgIHZhciBzZCA9IHsgZXZlbnRQaGFzZTogMCwgYnViYmxlczogMCwgY2FuY2VsYWJsZTogMCwgdGltZVN0YW1wOiBmdW5jdGlvbiB0aW1lU3RhbXAoYSkge3JldHVybiBhLnRpbWVTdGFtcCB8fCBEYXRlLm5vdygpO30sIGRlZmF1bHRQcmV2ZW50ZWQ6IDAsIGlzVHJ1c3RlZDogMCB9LHRkID0gcmQoc2QpLHVkID0gQSh7fSwgc2QsIHsgdmlldzogMCwgZGV0YWlsOiAwIH0pLHZkID0gcmQodWQpLHdkLHhkLHlkLEFkID0gQSh7fSwgdWQsIHsgc2NyZWVuWDogMCwgc2NyZWVuWTogMCwgY2xpZW50WDogMCwgY2xpZW50WTogMCwgcGFnZVg6IDAsIHBhZ2VZOiAwLCBjdHJsS2V5OiAwLCBzaGlmdEtleTogMCwgYWx0S2V5OiAwLCBtZXRhS2V5OiAwLCBnZXRNb2RpZmllclN0YXRlOiB6ZCwgYnV0dG9uOiAwLCBidXR0b25zOiAwLCByZWxhdGVkVGFyZ2V0OiBmdW5jdGlvbiByZWxhdGVkVGFyZ2V0KGEpIHtyZXR1cm4gdm9pZCAwID09PSBhLnJlbGF0ZWRUYXJnZXQgPyBhLmZyb21FbGVtZW50ID09PSBhLnNyY0VsZW1lbnQgPyBhLnRvRWxlbWVudCA6IGEuZnJvbUVsZW1lbnQgOiBhLnJlbGF0ZWRUYXJnZXQ7fSwgbW92ZW1lbnRYOiBmdW5jdGlvbiBtb3ZlbWVudFgoYSkge2lmICgibW92ZW1lbnRYIiBpbgogICAgICAgICAgICAgICAgYSkgcmV0dXJuIGEubW92ZW1lbnRYO2EgIT09IHlkICYmICh5ZCAmJiAibW91c2Vtb3ZlIiA9PT0gYS50eXBlID8gKHdkID0gYS5zY3JlZW5YIC0geWQuc2NyZWVuWCwgeGQgPSBhLnNjcmVlblkgLSB5ZC5zY3JlZW5ZKSA6IHhkID0gd2QgPSAwLCB5ZCA9IGEpO3JldHVybiB3ZDt9LCBtb3ZlbWVudFk6IGZ1bmN0aW9uIG1vdmVtZW50WShhKSB7cmV0dXJuICJtb3ZlbWVudFkiIGluIGEgPyBhLm1vdmVtZW50WSA6IHhkO30gfSksQmQgPSByZChBZCksQ2QgPSBBKHt9LCBBZCwgeyBkYXRhVHJhbnNmZXI6IDAgfSksRGQgPSByZChDZCksRWQgPSBBKHt9LCB1ZCwgeyByZWxhdGVkVGFyZ2V0OiAwIH0pLEZkID0gcmQoRWQpLEdkID0gQSh7fSwgc2QsIHsgYW5pbWF0aW9uTmFtZTogMCwgZWxhcHNlZFRpbWU6IDAsIHBzZXVkb0VsZW1lbnQ6IDAgfSksSGQgPSByZChHZCksSWQgPSBBKHt9LCBzZCwgeyBjbGlwYm9hcmREYXRhOiBmdW5jdGlvbiBjbGlwYm9hcmREYXRhKGEpIHtyZXR1cm4gImNsaXBib2FyZERhdGEiIGluIGEgPyBhLmNsaXBib2FyZERhdGEgOiB3aW5kb3cuY2xpcGJvYXJkRGF0YTt9IH0pLEpkID0gcmQoSWQpLEtkID0gQSh7fSwgc2QsIHsgZGF0YTogMCB9KSxMZCA9IHJkKEtkKSxNZCA9IHsgRXNjOiAiRXNjYXBlIiwKICAgICAgICAgICAgICBTcGFjZWJhcjogIiAiLCBMZWZ0OiAiQXJyb3dMZWZ0IiwgVXA6ICJBcnJvd1VwIiwgUmlnaHQ6ICJBcnJvd1JpZ2h0IiwgRG93bjogIkFycm93RG93biIsIERlbDogIkRlbGV0ZSIsIFdpbjogIk9TIiwgTWVudTogIkNvbnRleHRNZW51IiwgQXBwczogIkNvbnRleHRNZW51IiwgU2Nyb2xsOiAiU2Nyb2xsTG9jayIsIE1velByaW50YWJsZUtleTogIlVuaWRlbnRpZmllZCIgfSxOZCA9IHsgODogIkJhY2tzcGFjZSIsIDk6ICJUYWIiLCAxMjogIkNsZWFyIiwgMTM6ICJFbnRlciIsIDE2OiAiU2hpZnQiLCAxNzogIkNvbnRyb2wiLCAxODogIkFsdCIsIDE5OiAiUGF1c2UiLCAyMDogIkNhcHNMb2NrIiwgMjc6ICJFc2NhcGUiLCAzMjogIiAiLCAzMzogIlBhZ2VVcCIsIDM0OiAiUGFnZURvd24iLCAzNTogIkVuZCIsIDM2OiAiSG9tZSIsIDM3OiAiQXJyb3dMZWZ0IiwgMzg6ICJBcnJvd1VwIiwgMzk6ICJBcnJvd1JpZ2h0IiwgNDA6ICJBcnJvd0Rvd24iLCA0NTogIkluc2VydCIsIDQ2OiAiRGVsZXRlIiwgMTEyOiAiRjEiLCAxMTM6ICJGMiIsIDExNDogIkYzIiwgMTE1OiAiRjQiLCAxMTY6ICJGNSIsIDExNzogIkY2IiwgMTE4OiAiRjciLAogICAgICAgICAgICAgIDExOTogIkY4IiwgMTIwOiAiRjkiLCAxMjE6ICJGMTAiLCAxMjI6ICJGMTEiLCAxMjM6ICJGMTIiLCAxNDQ6ICJOdW1Mb2NrIiwgMTQ1OiAiU2Nyb2xsTG9jayIsIDIyNDogIk1ldGEiIH0sT2QgPSB7IEFsdDogImFsdEtleSIsIENvbnRyb2w6ICJjdHJsS2V5IiwgTWV0YTogIm1ldGFLZXkiLCBTaGlmdDogInNoaWZ0S2V5IiB9O2Z1bmN0aW9uIFBkKGEpIHt2YXIgYiA9IHRoaXMubmF0aXZlRXZlbnQ7cmV0dXJuIGIuZ2V0TW9kaWZpZXJTdGF0ZSA/IGIuZ2V0TW9kaWZpZXJTdGF0ZShhKSA6IChhID0gT2RbYV0pID8gISFiW2FdIDogITE7fWZ1bmN0aW9uIHpkKCkge3JldHVybiBQZDt9CiAgICAgICAgICB2YXIgUWQgPSBBKHt9LCB1ZCwgeyBrZXk6IGZ1bmN0aW9uIGtleShhKSB7aWYgKGEua2V5KSB7dmFyIGIgPSBNZFthLmtleV0gfHwgYS5rZXk7aWYgKCJVbmlkZW50aWZpZWQiICE9PSBiKSByZXR1cm4gYjt9cmV0dXJuICJrZXlwcmVzcyIgPT09IGEudHlwZSA/IChhID0gb2QoYSksIDEzID09PSBhID8gIkVudGVyIiA6IFN0cmluZy5mcm9tQ2hhckNvZGUoYSkpIDogImtleWRvd24iID09PSBhLnR5cGUgfHwgImtleXVwIiA9PT0gYS50eXBlID8gTmRbYS5rZXlDb2RlXSB8fCAiVW5pZGVudGlmaWVkIiA6ICIiO30sIGNvZGU6IDAsIGxvY2F0aW9uOiAwLCBjdHJsS2V5OiAwLCBzaGlmdEtleTogMCwgYWx0S2V5OiAwLCBtZXRhS2V5OiAwLCByZXBlYXQ6IDAsIGxvY2FsZTogMCwgZ2V0TW9kaWZpZXJTdGF0ZTogemQsIGNoYXJDb2RlOiBmdW5jdGlvbiBjaGFyQ29kZShhKSB7cmV0dXJuICJrZXlwcmVzcyIgPT09IGEudHlwZSA/IG9kKGEpIDogMDt9LCBrZXlDb2RlOiBmdW5jdGlvbiBrZXlDb2RlKGEpIHtyZXR1cm4gImtleWRvd24iID09PSBhLnR5cGUgfHwgImtleXVwIiA9PT0gYS50eXBlID8gYS5rZXlDb2RlIDogMDt9LCB3aGljaDogZnVuY3Rpb24gd2hpY2goYSkge3JldHVybiAia2V5cHJlc3MiID09PQogICAgICAgICAgICAgICAgYS50eXBlID8gb2QoYSkgOiAia2V5ZG93biIgPT09IGEudHlwZSB8fCAia2V5dXAiID09PSBhLnR5cGUgPyBhLmtleUNvZGUgOiAwO30gfSksUmQgPSByZChRZCksU2QgPSBBKHt9LCBBZCwgeyBwb2ludGVySWQ6IDAsIHdpZHRoOiAwLCBoZWlnaHQ6IDAsIHByZXNzdXJlOiAwLCB0YW5nZW50aWFsUHJlc3N1cmU6IDAsIHRpbHRYOiAwLCB0aWx0WTogMCwgdHdpc3Q6IDAsIHBvaW50ZXJUeXBlOiAwLCBpc1ByaW1hcnk6IDAgfSksVGQgPSByZChTZCksVWQgPSBBKHt9LCB1ZCwgeyB0b3VjaGVzOiAwLCB0YXJnZXRUb3VjaGVzOiAwLCBjaGFuZ2VkVG91Y2hlczogMCwgYWx0S2V5OiAwLCBtZXRhS2V5OiAwLCBjdHJsS2V5OiAwLCBzaGlmdEtleTogMCwgZ2V0TW9kaWZpZXJTdGF0ZTogemQgfSksVmQgPSByZChVZCksV2QgPSBBKHt9LCBzZCwgeyBwcm9wZXJ0eU5hbWU6IDAsIGVsYXBzZWRUaW1lOiAwLCBwc2V1ZG9FbGVtZW50OiAwIH0pLFhkID0gcmQoV2QpLFlkID0gQSh7fSwgQWQsIHsgZGVsdGFYOiBmdW5jdGlvbiBkZWx0YVgoYSkge3JldHVybiAiZGVsdGFYIiBpbiBhID8gYS5kZWx0YVggOiAid2hlZWxEZWx0YVgiIGluIGEgPyAtYS53aGVlbERlbHRhWCA6IDA7fSwKICAgICAgICAgICAgICBkZWx0YVk6IGZ1bmN0aW9uIGRlbHRhWShhKSB7cmV0dXJuICJkZWx0YVkiIGluIGEgPyBhLmRlbHRhWSA6ICJ3aGVlbERlbHRhWSIgaW4gYSA/IC1hLndoZWVsRGVsdGFZIDogIndoZWVsRGVsdGEiIGluIGEgPyAtYS53aGVlbERlbHRhIDogMDt9LCBkZWx0YVo6IDAsIGRlbHRhTW9kZTogMCB9KSxaZCA9IHJkKFlkKSwkZCA9IFs5LCAxMywgMjcsIDMyXSxhZSA9IGlhICYmICJDb21wb3NpdGlvbkV2ZW50IiBpbiB3aW5kb3csYmUgPSBudWxsO2lhICYmICJkb2N1bWVudE1vZGUiIGluIGRvY3VtZW50ICYmIChiZSA9IGRvY3VtZW50LmRvY3VtZW50TW9kZSk7dmFyIGNlID0gaWEgJiYgIlRleHRFdmVudCIgaW4gd2luZG93ICYmICFiZSxkZSA9IGlhICYmICghYWUgfHwgYmUgJiYgOCA8IGJlICYmIDExID49IGJlKSxlZSA9IFN0cmluZy5mcm9tQ2hhckNvZGUoMzIpLGZlID0gITE7CiAgICAgICAgICBmdW5jdGlvbiBnZShhLCBiKSB7c3dpdGNoIChhKSB7Y2FzZSAia2V5dXAiOnJldHVybiAtMSAhPT0gJGQuaW5kZXhPZihiLmtleUNvZGUpO2Nhc2UgImtleWRvd24iOnJldHVybiAyMjkgIT09IGIua2V5Q29kZTtjYXNlICJrZXlwcmVzcyI6Y2FzZSAibW91c2Vkb3duIjpjYXNlICJmb2N1c291dCI6cmV0dXJuICEwO2RlZmF1bHQ6cmV0dXJuICExO319ZnVuY3Rpb24gaGUoYSkge2EgPSBhLmRldGFpbDtyZXR1cm4gIm9iamVjdCIgPT09IHR5cGVvZiBhICYmICJkYXRhIiBpbiBhID8gYS5kYXRhIDogbnVsbDt9dmFyIGllID0gITE7ZnVuY3Rpb24gamUoYSwgYikge3N3aXRjaCAoYSkge2Nhc2UgImNvbXBvc2l0aW9uZW5kIjpyZXR1cm4gaGUoYik7Y2FzZSAia2V5cHJlc3MiOmlmICgzMiAhPT0gYi53aGljaCkgcmV0dXJuIG51bGw7ZmUgPSAhMDtyZXR1cm4gZWU7Y2FzZSAidGV4dElucHV0IjpyZXR1cm4gYSA9IGIuZGF0YSwgYSA9PT0gZWUgJiYgZmUgPyBudWxsIDogYTtkZWZhdWx0OnJldHVybiBudWxsO319CiAgICAgICAgICBmdW5jdGlvbiBrZShhLCBiKSB7aWYgKGllKSByZXR1cm4gImNvbXBvc2l0aW9uZW5kIiA9PT0gYSB8fCAhYWUgJiYgZ2UoYSwgYikgPyAoYSA9IG5kKCksIG1kID0gbGQgPSBrZCA9IG51bGwsIGllID0gITEsIGEpIDogbnVsbDtzd2l0Y2ggKGEpIHtjYXNlICJwYXN0ZSI6cmV0dXJuIG51bGw7Y2FzZSAia2V5cHJlc3MiOmlmICghKGIuY3RybEtleSB8fCBiLmFsdEtleSB8fCBiLm1ldGFLZXkpIHx8IGIuY3RybEtleSAmJiBiLmFsdEtleSkge2lmIChiLmNoYXIgJiYgMSA8IGIuY2hhci5sZW5ndGgpIHJldHVybiBiLmNoYXI7aWYgKGIud2hpY2gpIHJldHVybiBTdHJpbmcuZnJvbUNoYXJDb2RlKGIud2hpY2gpO31yZXR1cm4gbnVsbDtjYXNlICJjb21wb3NpdGlvbmVuZCI6cmV0dXJuIGRlICYmICJrbyIgIT09IGIubG9jYWxlID8gbnVsbCA6IGIuZGF0YTtkZWZhdWx0OnJldHVybiBudWxsO319CiAgICAgICAgICB2YXIgbGUgPSB7IGNvbG9yOiAhMCwgZGF0ZTogITAsIGRhdGV0aW1lOiAhMCwgImRhdGV0aW1lLWxvY2FsIjogITAsIGVtYWlsOiAhMCwgbW9udGg6ICEwLCBudW1iZXI6ICEwLCBwYXNzd29yZDogITAsIHJhbmdlOiAhMCwgc2VhcmNoOiAhMCwgdGVsOiAhMCwgdGV4dDogITAsIHRpbWU6ICEwLCB1cmw6ICEwLCB3ZWVrOiAhMCB9O2Z1bmN0aW9uIG1lKGEpIHt2YXIgYiA9IGEgJiYgYS5ub2RlTmFtZSAmJiBhLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCk7cmV0dXJuICJpbnB1dCIgPT09IGIgPyAhIWxlW2EudHlwZV0gOiAidGV4dGFyZWEiID09PSBiID8gITAgOiAhMTt9ZnVuY3Rpb24gbmUoYSwgYiwgYywgZCkge0ViKGQpO2IgPSBvZShiLCAib25DaGFuZ2UiKTswIDwgYi5sZW5ndGggJiYgKGMgPSBuZXcgdGQoIm9uQ2hhbmdlIiwgImNoYW5nZSIsIG51bGwsIGMsIGQpLCBhLnB1c2goeyBldmVudDogYywgbGlzdGVuZXJzOiBiIH0pKTt9dmFyIHBlID0gbnVsbCxxZSA9IG51bGw7ZnVuY3Rpb24gcmUoYSkge3NlKGEsIDApO31mdW5jdGlvbiB0ZShhKSB7dmFyIGIgPSB1ZShhKTtpZiAoV2EoYikpIHJldHVybiBhO30KICAgICAgICAgIGZ1bmN0aW9uIHZlKGEsIGIpIHtpZiAoImNoYW5nZSIgPT09IGEpIHJldHVybiBiO312YXIgd2UgPSAhMTtpZiAoaWEpIHt2YXIgeGU7aWYgKGlhKSB7dmFyIHllID0gKCJvbmlucHV0IiBpbiBkb2N1bWVudCk7aWYgKCF5ZSkge3ZhciB6ZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpO3plLnNldEF0dHJpYnV0ZSgib25pbnB1dCIsICJyZXR1cm47Iik7eWUgPSAiZnVuY3Rpb24iID09PSB0eXBlb2YgemUub25pbnB1dDt9eGUgPSB5ZTt9IGVsc2UgeGUgPSAhMTt3ZSA9IHhlICYmICghZG9jdW1lbnQuZG9jdW1lbnRNb2RlIHx8IDkgPCBkb2N1bWVudC5kb2N1bWVudE1vZGUpO31mdW5jdGlvbiBBZSgpIHtwZSAmJiAocGUuZGV0YWNoRXZlbnQoIm9ucHJvcGVydHljaGFuZ2UiLCBCZSksIHFlID0gcGUgPSBudWxsKTt9ZnVuY3Rpb24gQmUoYSkge2lmICgidmFsdWUiID09PSBhLnByb3BlcnR5TmFtZSAmJiB0ZShxZSkpIHt2YXIgYiA9IFtdO25lKGIsIHFlLCBhLCB4YihhKSk7SmIocmUsIGIpO319CiAgICAgICAgICBmdW5jdGlvbiBDZShhLCBiLCBjKSB7ImZvY3VzaW4iID09PSBhID8gKEFlKCksIHBlID0gYiwgcWUgPSBjLCBwZS5hdHRhY2hFdmVudCgib25wcm9wZXJ0eWNoYW5nZSIsIEJlKSkgOiAiZm9jdXNvdXQiID09PSBhICYmIEFlKCk7fWZ1bmN0aW9uIERlKGEpIHtpZiAoInNlbGVjdGlvbmNoYW5nZSIgPT09IGEgfHwgImtleXVwIiA9PT0gYSB8fCAia2V5ZG93biIgPT09IGEpIHJldHVybiB0ZShxZSk7fWZ1bmN0aW9uIEVlKGEsIGIpIHtpZiAoImNsaWNrIiA9PT0gYSkgcmV0dXJuIHRlKGIpO31mdW5jdGlvbiBGZShhLCBiKSB7aWYgKCJpbnB1dCIgPT09IGEgfHwgImNoYW5nZSIgPT09IGEpIHJldHVybiB0ZShiKTt9ZnVuY3Rpb24gR2UoYSwgYikge3JldHVybiBhID09PSBiICYmICgwICE9PSBhIHx8IDEgLyBhID09PSAxIC8gYikgfHwgYSAhPT0gYSAmJiBiICE9PSBiO312YXIgSGUgPSAiZnVuY3Rpb24iID09PSB0eXBlb2YgT2JqZWN0LmlzID8gT2JqZWN0LmlzIDogR2U7CiAgICAgICAgICBmdW5jdGlvbiBJZShhLCBiKSB7aWYgKEhlKGEsIGIpKSByZXR1cm4gITA7aWYgKCJvYmplY3QiICE9PSB0eXBlb2YgYSB8fCBudWxsID09PSBhIHx8ICJvYmplY3QiICE9PSB0eXBlb2YgYiB8fCBudWxsID09PSBiKSByZXR1cm4gITE7dmFyIGMgPSBPYmplY3Qua2V5cyhhKSxkID0gT2JqZWN0LmtleXMoYik7aWYgKGMubGVuZ3RoICE9PSBkLmxlbmd0aCkgcmV0dXJuICExO2ZvciAoZCA9IDA7IGQgPCBjLmxlbmd0aDsgZCsrKSB7dmFyIGUgPSBjW2RdO2lmICghamEuY2FsbChiLCBlKSB8fCAhSGUoYVtlXSwgYltlXSkpIHJldHVybiAhMTt9cmV0dXJuICEwO31mdW5jdGlvbiBKZShhKSB7Zm9yICg7IGEgJiYgYS5maXJzdENoaWxkOykgYSA9IGEuZmlyc3RDaGlsZDtyZXR1cm4gYTt9CiAgICAgICAgICBmdW5jdGlvbiBLZShhLCBiKSB7dmFyIGMgPSBKZShhKTthID0gMDtmb3IgKHZhciBkOyBjOykge2lmICgzID09PSBjLm5vZGVUeXBlKSB7ZCA9IGEgKyBjLnRleHRDb250ZW50Lmxlbmd0aDtpZiAoYSA8PSBiICYmIGQgPj0gYikgcmV0dXJuIHsgbm9kZTogYywgb2Zmc2V0OiBiIC0gYSB9O2EgPSBkO31hOiB7Zm9yICg7IGM7KSB7aWYgKGMubmV4dFNpYmxpbmcpIHtjID0gYy5uZXh0U2libGluZzticmVhayBhO31jID0gYy5wYXJlbnROb2RlO31jID0gdm9pZCAwO31jID0gSmUoYyk7fX1mdW5jdGlvbiBMZShhLCBiKSB7cmV0dXJuIGEgJiYgYiA/IGEgPT09IGIgPyAhMCA6IGEgJiYgMyA9PT0gYS5ub2RlVHlwZSA/ICExIDogYiAmJiAzID09PSBiLm5vZGVUeXBlID8gTGUoYSwgYi5wYXJlbnROb2RlKSA6ICJjb250YWlucyIgaW4gYSA/IGEuY29udGFpbnMoYikgOiBhLmNvbXBhcmVEb2N1bWVudFBvc2l0aW9uID8gISEoYS5jb21wYXJlRG9jdW1lbnRQb3NpdGlvbihiKSAmIDE2KSA6ICExIDogITE7fQogICAgICAgICAgZnVuY3Rpb24gTWUoKSB7Zm9yICh2YXIgYSA9IHdpbmRvdywgYiA9IFhhKCk7IGIgaW5zdGFuY2VvZiBhLkhUTUxJRnJhbWVFbGVtZW50Oykge3RyeSB7dmFyIGMgPSAic3RyaW5nIiA9PT0gdHlwZW9mIGIuY29udGVudFdpbmRvdy5sb2NhdGlvbi5ocmVmO30gY2F0Y2ggKGQpIHtjID0gITE7fWlmIChjKSBhID0gYi5jb250ZW50V2luZG93O2Vsc2UgYnJlYWs7YiA9IFhhKGEuZG9jdW1lbnQpO31yZXR1cm4gYjt9ZnVuY3Rpb24gTmUoYSkge3ZhciBiID0gYSAmJiBhLm5vZGVOYW1lICYmIGEubm9kZU5hbWUudG9Mb3dlckNhc2UoKTtyZXR1cm4gYiAmJiAoImlucHV0IiA9PT0gYiAmJiAoInRleHQiID09PSBhLnR5cGUgfHwgInNlYXJjaCIgPT09IGEudHlwZSB8fCAidGVsIiA9PT0gYS50eXBlIHx8ICJ1cmwiID09PSBhLnR5cGUgfHwgInBhc3N3b3JkIiA9PT0gYS50eXBlKSB8fCAidGV4dGFyZWEiID09PSBiIHx8ICJ0cnVlIiA9PT0gYS5jb250ZW50RWRpdGFibGUpO30KICAgICAgICAgIGZ1bmN0aW9uIE9lKGEpIHt2YXIgYiA9IE1lKCksYyA9IGEuZm9jdXNlZEVsZW0sZCA9IGEuc2VsZWN0aW9uUmFuZ2U7aWYgKGIgIT09IGMgJiYgYyAmJiBjLm93bmVyRG9jdW1lbnQgJiYgTGUoYy5vd25lckRvY3VtZW50LmRvY3VtZW50RWxlbWVudCwgYykpIHtpZiAobnVsbCAhPT0gZCAmJiBOZShjKSkgaWYgKGIgPSBkLnN0YXJ0LCBhID0gZC5lbmQsIHZvaWQgMCA9PT0gYSAmJiAoYSA9IGIpLCAic2VsZWN0aW9uU3RhcnQiIGluIGMpIGMuc2VsZWN0aW9uU3RhcnQgPSBiLCBjLnNlbGVjdGlvbkVuZCA9IE1hdGgubWluKGEsIGMudmFsdWUubGVuZ3RoKTtlbHNlIGlmIChhID0gKGIgPSBjLm93bmVyRG9jdW1lbnQgfHwgZG9jdW1lbnQpICYmIGIuZGVmYXVsdFZpZXcgfHwgd2luZG93LCBhLmdldFNlbGVjdGlvbikge2EgPSBhLmdldFNlbGVjdGlvbigpO3ZhciBlID0gYy50ZXh0Q29udGVudC5sZW5ndGgsZiA9IE1hdGgubWluKGQuc3RhcnQsIGUpO2QgPSB2b2lkIDAgPT09IGQuZW5kID8gZiA6IE1hdGgubWluKGQuZW5kLCBlKTshYS5leHRlbmQgJiYgZiA+IGQgJiYgKGUgPSBkLCBkID0gZiwgZiA9IGUpO2UgPSBLZShjLCBmKTt2YXIgZyA9IEtlKGMsCiAgICAgICAgICAgICAgICBkKTtlICYmIGcgJiYgKDEgIT09IGEucmFuZ2VDb3VudCB8fCBhLmFuY2hvck5vZGUgIT09IGUubm9kZSB8fCBhLmFuY2hvck9mZnNldCAhPT0gZS5vZmZzZXQgfHwgYS5mb2N1c05vZGUgIT09IGcubm9kZSB8fCBhLmZvY3VzT2Zmc2V0ICE9PSBnLm9mZnNldCkgJiYgKGIgPSBiLmNyZWF0ZVJhbmdlKCksIGIuc2V0U3RhcnQoZS5ub2RlLCBlLm9mZnNldCksIGEucmVtb3ZlQWxsUmFuZ2VzKCksIGYgPiBkID8gKGEuYWRkUmFuZ2UoYiksIGEuZXh0ZW5kKGcubm9kZSwgZy5vZmZzZXQpKSA6IChiLnNldEVuZChnLm5vZGUsIGcub2Zmc2V0KSwgYS5hZGRSYW5nZShiKSkpO31iID0gW107Zm9yIChhID0gYzsgYSA9IGEucGFyZW50Tm9kZTspIDEgPT09IGEubm9kZVR5cGUgJiYgYi5wdXNoKHsgZWxlbWVudDogYSwgbGVmdDogYS5zY3JvbGxMZWZ0LCB0b3A6IGEuc2Nyb2xsVG9wIH0pOyJmdW5jdGlvbiIgPT09IHR5cGVvZiBjLmZvY3VzICYmIGMuZm9jdXMoKTtmb3IgKGMgPSAwOyBjIDwgYi5sZW5ndGg7IGMrKykgYSA9IGJbY10sIGEuZWxlbWVudC5zY3JvbGxMZWZ0ID0gYS5sZWZ0LCBhLmVsZW1lbnQuc2Nyb2xsVG9wID0gYS50b3A7fX0KICAgICAgICAgIHZhciBQZSA9IGlhICYmICJkb2N1bWVudE1vZGUiIGluIGRvY3VtZW50ICYmIDExID49IGRvY3VtZW50LmRvY3VtZW50TW9kZSxRZSA9IG51bGwsUmUgPSBudWxsLFNlID0gbnVsbCxUZSA9ICExOwogICAgICAgICAgZnVuY3Rpb24gVWUoYSwgYiwgYykge3ZhciBkID0gYy53aW5kb3cgPT09IGMgPyBjLmRvY3VtZW50IDogOSA9PT0gYy5ub2RlVHlwZSA/IGMgOiBjLm93bmVyRG9jdW1lbnQ7VGUgfHwgbnVsbCA9PSBRZSB8fCBRZSAhPT0gWGEoZCkgfHwgKGQgPSBRZSwgInNlbGVjdGlvblN0YXJ0IiBpbiBkICYmIE5lKGQpID8gZCA9IHsgc3RhcnQ6IGQuc2VsZWN0aW9uU3RhcnQsIGVuZDogZC5zZWxlY3Rpb25FbmQgfSA6IChkID0gKGQub3duZXJEb2N1bWVudCAmJiBkLm93bmVyRG9jdW1lbnQuZGVmYXVsdFZpZXcgfHwgd2luZG93KS5nZXRTZWxlY3Rpb24oKSwgZCA9IHsgYW5jaG9yTm9kZTogZC5hbmNob3JOb2RlLCBhbmNob3JPZmZzZXQ6IGQuYW5jaG9yT2Zmc2V0LCBmb2N1c05vZGU6IGQuZm9jdXNOb2RlLCBmb2N1c09mZnNldDogZC5mb2N1c09mZnNldCB9KSwgU2UgJiYgSWUoU2UsIGQpIHx8IChTZSA9IGQsIGQgPSBvZShSZSwgIm9uU2VsZWN0IiksIDAgPCBkLmxlbmd0aCAmJiAoYiA9IG5ldyB0ZCgib25TZWxlY3QiLCAic2VsZWN0IiwgbnVsbCwgYiwgYyksIGEucHVzaCh7IGV2ZW50OiBiLCBsaXN0ZW5lcnM6IGQgfSksIGIudGFyZ2V0ID0gUWUpKSk7fQogICAgICAgICAgZnVuY3Rpb24gVmUoYSwgYikge3ZhciBjID0ge307Y1thLnRvTG93ZXJDYXNlKCldID0gYi50b0xvd2VyQ2FzZSgpO2NbIldlYmtpdCIgKyBhXSA9ICJ3ZWJraXQiICsgYjtjWyJNb3oiICsgYV0gPSAibW96IiArIGI7cmV0dXJuIGM7fXZhciBXZSA9IHsgYW5pbWF0aW9uZW5kOiBWZSgiQW5pbWF0aW9uIiwgIkFuaW1hdGlvbkVuZCIpLCBhbmltYXRpb25pdGVyYXRpb246IFZlKCJBbmltYXRpb24iLCAiQW5pbWF0aW9uSXRlcmF0aW9uIiksIGFuaW1hdGlvbnN0YXJ0OiBWZSgiQW5pbWF0aW9uIiwgIkFuaW1hdGlvblN0YXJ0IiksIHRyYW5zaXRpb25lbmQ6IFZlKCJUcmFuc2l0aW9uIiwgIlRyYW5zaXRpb25FbmQiKSB9LFhlID0ge30sWWUgPSB7fTsKICAgICAgICAgIGlhICYmIChZZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpLnN0eWxlLCAiQW5pbWF0aW9uRXZlbnQiIGluIHdpbmRvdyB8fCAoZGVsZXRlIFdlLmFuaW1hdGlvbmVuZC5hbmltYXRpb24sIGRlbGV0ZSBXZS5hbmltYXRpb25pdGVyYXRpb24uYW5pbWF0aW9uLCBkZWxldGUgV2UuYW5pbWF0aW9uc3RhcnQuYW5pbWF0aW9uKSwgIlRyYW5zaXRpb25FdmVudCIgaW4gd2luZG93IHx8IGRlbGV0ZSBXZS50cmFuc2l0aW9uZW5kLnRyYW5zaXRpb24pO2Z1bmN0aW9uIFplKGEpIHtpZiAoWGVbYV0pIHJldHVybiBYZVthXTtpZiAoIVdlW2FdKSByZXR1cm4gYTt2YXIgYiA9IFdlW2FdLGM7Zm9yIChjIGluIGIpIGlmIChiLmhhc093blByb3BlcnR5KGMpICYmIGMgaW4gWWUpIHJldHVybiBYZVthXSA9IGJbY107cmV0dXJuIGE7fXZhciAkZSA9IFplKCJhbmltYXRpb25lbmQiKSxhZiA9IFplKCJhbmltYXRpb25pdGVyYXRpb24iKSxiZiA9IFplKCJhbmltYXRpb25zdGFydCIpLGNmID0gWmUoInRyYW5zaXRpb25lbmQiKSxkZiA9IG5ldyBNYXAoKSxlZiA9ICJhYm9ydCBhdXhDbGljayBjYW5jZWwgY2FuUGxheSBjYW5QbGF5VGhyb3VnaCBjbGljayBjbG9zZSBjb250ZXh0TWVudSBjb3B5IGN1dCBkcmFnIGRyYWdFbmQgZHJhZ0VudGVyIGRyYWdFeGl0IGRyYWdMZWF2ZSBkcmFnT3ZlciBkcmFnU3RhcnQgZHJvcCBkdXJhdGlvbkNoYW5nZSBlbXB0aWVkIGVuY3J5cHRlZCBlbmRlZCBlcnJvciBnb3RQb2ludGVyQ2FwdHVyZSBpbnB1dCBpbnZhbGlkIGtleURvd24ga2V5UHJlc3Mga2V5VXAgbG9hZCBsb2FkZWREYXRhIGxvYWRlZE1ldGFkYXRhIGxvYWRTdGFydCBsb3N0UG9pbnRlckNhcHR1cmUgbW91c2VEb3duIG1vdXNlTW92ZSBtb3VzZU91dCBtb3VzZU92ZXIgbW91c2VVcCBwYXN0ZSBwYXVzZSBwbGF5IHBsYXlpbmcgcG9pbnRlckNhbmNlbCBwb2ludGVyRG93biBwb2ludGVyTW92ZSBwb2ludGVyT3V0IHBvaW50ZXJPdmVyIHBvaW50ZXJVcCBwcm9ncmVzcyByYXRlQ2hhbmdlIHJlc2V0IHJlc2l6ZSBzZWVrZWQgc2Vla2luZyBzdGFsbGVkIHN1Ym1pdCBzdXNwZW5kIHRpbWVVcGRhdGUgdG91Y2hDYW5jZWwgdG91Y2hFbmQgdG91Y2hTdGFydCB2b2x1bWVDaGFuZ2Ugc2Nyb2xsIHRvZ2dsZSB0b3VjaE1vdmUgd2FpdGluZyB3aGVlbCIuc3BsaXQoIiAiKTsKICAgICAgICAgIGZ1bmN0aW9uIGZmKGEsIGIpIHtkZi5zZXQoYSwgYik7ZmEoYiwgW2FdKTt9Zm9yICh2YXIgZ2YgPSAwOyBnZiA8IGVmLmxlbmd0aDsgZ2YrKykge3ZhciBoZiA9IGVmW2dmXSxqZiA9IGhmLnRvTG93ZXJDYXNlKCksa2YgPSBoZlswXS50b1VwcGVyQ2FzZSgpICsgaGYuc2xpY2UoMSk7ZmYoamYsICJvbiIgKyBrZik7fWZmKCRlLCAib25BbmltYXRpb25FbmQiKTtmZihhZiwgIm9uQW5pbWF0aW9uSXRlcmF0aW9uIik7ZmYoYmYsICJvbkFuaW1hdGlvblN0YXJ0Iik7ZmYoImRibGNsaWNrIiwgIm9uRG91YmxlQ2xpY2siKTtmZigiZm9jdXNpbiIsICJvbkZvY3VzIik7ZmYoImZvY3Vzb3V0IiwgIm9uQmx1ciIpO2ZmKGNmLCAib25UcmFuc2l0aW9uRW5kIik7aGEoIm9uTW91c2VFbnRlciIsIFsibW91c2VvdXQiLCAibW91c2VvdmVyIl0pO2hhKCJvbk1vdXNlTGVhdmUiLCBbIm1vdXNlb3V0IiwgIm1vdXNlb3ZlciJdKTtoYSgib25Qb2ludGVyRW50ZXIiLCBbInBvaW50ZXJvdXQiLCAicG9pbnRlcm92ZXIiXSk7CiAgICAgICAgICBoYSgib25Qb2ludGVyTGVhdmUiLCBbInBvaW50ZXJvdXQiLCAicG9pbnRlcm92ZXIiXSk7ZmEoIm9uQ2hhbmdlIiwgImNoYW5nZSBjbGljayBmb2N1c2luIGZvY3Vzb3V0IGlucHV0IGtleWRvd24ga2V5dXAgc2VsZWN0aW9uY2hhbmdlIi5zcGxpdCgiICIpKTtmYSgib25TZWxlY3QiLCAiZm9jdXNvdXQgY29udGV4dG1lbnUgZHJhZ2VuZCBmb2N1c2luIGtleWRvd24ga2V5dXAgbW91c2Vkb3duIG1vdXNldXAgc2VsZWN0aW9uY2hhbmdlIi5zcGxpdCgiICIpKTtmYSgib25CZWZvcmVJbnB1dCIsIFsiY29tcG9zaXRpb25lbmQiLCAia2V5cHJlc3MiLCAidGV4dElucHV0IiwgInBhc3RlIl0pO2ZhKCJvbkNvbXBvc2l0aW9uRW5kIiwgImNvbXBvc2l0aW9uZW5kIGZvY3Vzb3V0IGtleWRvd24ga2V5cHJlc3Mga2V5dXAgbW91c2Vkb3duIi5zcGxpdCgiICIpKTtmYSgib25Db21wb3NpdGlvblN0YXJ0IiwgImNvbXBvc2l0aW9uc3RhcnQgZm9jdXNvdXQga2V5ZG93biBrZXlwcmVzcyBrZXl1cCBtb3VzZWRvd24iLnNwbGl0KCIgIikpOwogICAgICAgICAgZmEoIm9uQ29tcG9zaXRpb25VcGRhdGUiLCAiY29tcG9zaXRpb251cGRhdGUgZm9jdXNvdXQga2V5ZG93biBrZXlwcmVzcyBrZXl1cCBtb3VzZWRvd24iLnNwbGl0KCIgIikpO3ZhciBsZiA9ICJhYm9ydCBjYW5wbGF5IGNhbnBsYXl0aHJvdWdoIGR1cmF0aW9uY2hhbmdlIGVtcHRpZWQgZW5jcnlwdGVkIGVuZGVkIGVycm9yIGxvYWRlZGRhdGEgbG9hZGVkbWV0YWRhdGEgbG9hZHN0YXJ0IHBhdXNlIHBsYXkgcGxheWluZyBwcm9ncmVzcyByYXRlY2hhbmdlIHJlc2l6ZSBzZWVrZWQgc2Vla2luZyBzdGFsbGVkIHN1c3BlbmQgdGltZXVwZGF0ZSB2b2x1bWVjaGFuZ2Ugd2FpdGluZyIuc3BsaXQoIiAiKSxtZiA9IG5ldyBTZXQoImNhbmNlbCBjbG9zZSBpbnZhbGlkIGxvYWQgc2Nyb2xsIHRvZ2dsZSIuc3BsaXQoIiAiKS5jb25jYXQobGYpKTsKICAgICAgICAgIGZ1bmN0aW9uIG5mKGEsIGIsIGMpIHt2YXIgZCA9IGEudHlwZSB8fCAidW5rbm93bi1ldmVudCI7YS5jdXJyZW50VGFyZ2V0ID0gYztVYihkLCBiLCB2b2lkIDAsIGEpO2EuY3VycmVudFRhcmdldCA9IG51bGw7fQogICAgICAgICAgZnVuY3Rpb24gc2UoYSwgYikge2IgPSAwICE9PSAoYiAmIDQpO2ZvciAodmFyIGMgPSAwOyBjIDwgYS5sZW5ndGg7IGMrKykge3ZhciBkID0gYVtjXSxlID0gZC5ldmVudDtkID0gZC5saXN0ZW5lcnM7YToge3ZhciBmID0gdm9pZCAwO2lmIChiKSBmb3IgKHZhciBnID0gZC5sZW5ndGggLSAxOyAwIDw9IGc7IGctLSkge3ZhciBoID0gZFtnXSxrID0gaC5pbnN0YW5jZSxsID0gaC5jdXJyZW50VGFyZ2V0O2ggPSBoLmxpc3RlbmVyO2lmIChrICE9PSBmICYmIGUuaXNQcm9wYWdhdGlvblN0b3BwZWQoKSkgYnJlYWsgYTtuZihlLCBoLCBsKTtmID0gazt9IGVsc2UgZm9yIChnID0gMDsgZyA8IGQubGVuZ3RoOyBnKyspIHtoID0gZFtnXTtrID0gaC5pbnN0YW5jZTtsID0gaC5jdXJyZW50VGFyZ2V0O2ggPSBoLmxpc3RlbmVyO2lmIChrICE9PSBmICYmIGUuaXNQcm9wYWdhdGlvblN0b3BwZWQoKSkgYnJlYWsgYTtuZihlLCBoLCBsKTtmID0gazt9fX1pZiAoUWIpIHRocm93IGEgPSBSYiwgUWIgPSAhMSwgUmIgPSBudWxsLCBhO30KICAgICAgICAgIGZ1bmN0aW9uIEQoYSwgYikge3ZhciBjID0gYltvZl07dm9pZCAwID09PSBjICYmIChjID0gYltvZl0gPSBuZXcgU2V0KCkpO3ZhciBkID0gYSArICJfX2J1YmJsZSI7Yy5oYXMoZCkgfHwgKHBmKGIsIGEsIDIsICExKSwgYy5hZGQoZCkpO31mdW5jdGlvbiBxZihhLCBiLCBjKSB7dmFyIGQgPSAwO2IgJiYgKGQgfD0gNCk7cGYoYywgYSwgZCwgYik7fXZhciByZiA9ICJfcmVhY3RMaXN0ZW5pbmciICsgTWF0aC5yYW5kb20oKS50b1N0cmluZygzNikuc2xpY2UoMik7ZnVuY3Rpb24gc2YoYSkge2lmICghYVtyZl0pIHthW3JmXSA9ICEwO2RhLmZvckVhY2goZnVuY3Rpb24gKGIpIHsic2VsZWN0aW9uY2hhbmdlIiAhPT0gYiAmJiAobWYuaGFzKGIpIHx8IHFmKGIsICExLCBhKSwgcWYoYiwgITAsIGEpKTt9KTt2YXIgYiA9IDkgPT09IGEubm9kZVR5cGUgPyBhIDogYS5vd25lckRvY3VtZW50O251bGwgPT09IGIgfHwgYltyZl0gfHwgKGJbcmZdID0gITAsIHFmKCJzZWxlY3Rpb25jaGFuZ2UiLCAhMSwgYikpO319CiAgICAgICAgICBmdW5jdGlvbiBwZihhLCBiLCBjLCBkKSB7c3dpdGNoIChqZChiKSkge2Nhc2UgMTp2YXIgZSA9IGVkO2JyZWFrO2Nhc2UgNDplID0gZ2Q7YnJlYWs7ZGVmYXVsdDplID0gZmQ7fWMgPSBlLmJpbmQobnVsbCwgYiwgYywgYSk7ZSA9IHZvaWQgMDshTGIgfHwgInRvdWNoc3RhcnQiICE9PSBiICYmICJ0b3VjaG1vdmUiICE9PSBiICYmICJ3aGVlbCIgIT09IGIgfHwgKGUgPSAhMCk7ZCA/IHZvaWQgMCAhPT0gZSA/IGEuYWRkRXZlbnRMaXN0ZW5lcihiLCBjLCB7IGNhcHR1cmU6ICEwLCBwYXNzaXZlOiBlIH0pIDogYS5hZGRFdmVudExpc3RlbmVyKGIsIGMsICEwKSA6IHZvaWQgMCAhPT0gZSA/IGEuYWRkRXZlbnRMaXN0ZW5lcihiLCBjLCB7IHBhc3NpdmU6IGUgfSkgOiBhLmFkZEV2ZW50TGlzdGVuZXIoYiwgYywgITEpO30KICAgICAgICAgIGZ1bmN0aW9uIGhkKGEsIGIsIGMsIGQsIGUpIHt2YXIgZiA9IGQ7aWYgKDAgPT09IChiICYgMSkgJiYgMCA9PT0gKGIgJiAyKSAmJiBudWxsICE9PSBkKSBhOiBmb3IgKDs7KSB7aWYgKG51bGwgPT09IGQpIHJldHVybjt2YXIgZyA9IGQudGFnO2lmICgzID09PSBnIHx8IDQgPT09IGcpIHt2YXIgaCA9IGQuc3RhdGVOb2RlLmNvbnRhaW5lckluZm87aWYgKGggPT09IGUgfHwgOCA9PT0gaC5ub2RlVHlwZSAmJiBoLnBhcmVudE5vZGUgPT09IGUpIGJyZWFrO2lmICg0ID09PSBnKSBmb3IgKGcgPSBkLnJldHVybjsgbnVsbCAhPT0gZzspIHt2YXIgayA9IGcudGFnO2lmICgzID09PSBrIHx8IDQgPT09IGspIGlmIChrID0gZy5zdGF0ZU5vZGUuY29udGFpbmVySW5mbywgayA9PT0gZSB8fCA4ID09PSBrLm5vZGVUeXBlICYmIGsucGFyZW50Tm9kZSA9PT0gZSkgcmV0dXJuO2cgPSBnLnJldHVybjt9Zm9yICg7IG51bGwgIT09IGg7KSB7ZyA9IFdjKGgpO2lmIChudWxsID09PSBnKSByZXR1cm47ayA9IGcudGFnO2lmICg1ID09PSBrIHx8IDYgPT09IGspIHtkID0gZiA9IGc7Y29udGludWUgYTt9aCA9IGgucGFyZW50Tm9kZTt9fWQgPSBkLnJldHVybjt9SmIoZnVuY3Rpb24gKCkge3ZhciBkID0gZixlID0geGIoYyksZyA9IFtdOwogICAgICAgICAgICAgIGE6IHt2YXIgaCA9IGRmLmdldChhKTtpZiAodm9pZCAwICE9PSBoKSB7dmFyIGsgPSB0ZCxuID0gYTtzd2l0Y2ggKGEpIHtjYXNlICJrZXlwcmVzcyI6aWYgKDAgPT09IG9kKGMpKSBicmVhayBhO2Nhc2UgImtleWRvd24iOmNhc2UgImtleXVwIjprID0gUmQ7YnJlYWs7Y2FzZSAiZm9jdXNpbiI6biA9ICJmb2N1cyI7ayA9IEZkO2JyZWFrO2Nhc2UgImZvY3Vzb3V0IjpuID0gImJsdXIiO2sgPSBGZDticmVhaztjYXNlICJiZWZvcmVibHVyIjpjYXNlICJhZnRlcmJsdXIiOmsgPSBGZDticmVhaztjYXNlICJjbGljayI6aWYgKDIgPT09IGMuYnV0dG9uKSBicmVhayBhO2Nhc2UgImF1eGNsaWNrIjpjYXNlICJkYmxjbGljayI6Y2FzZSAibW91c2Vkb3duIjpjYXNlICJtb3VzZW1vdmUiOmNhc2UgIm1vdXNldXAiOmNhc2UgIm1vdXNlb3V0IjpjYXNlICJtb3VzZW92ZXIiOmNhc2UgImNvbnRleHRtZW51IjprID0gQmQ7YnJlYWs7Y2FzZSAiZHJhZyI6Y2FzZSAiZHJhZ2VuZCI6Y2FzZSAiZHJhZ2VudGVyIjpjYXNlICJkcmFnZXhpdCI6Y2FzZSAiZHJhZ2xlYXZlIjpjYXNlICJkcmFnb3ZlciI6Y2FzZSAiZHJhZ3N0YXJ0IjpjYXNlICJkcm9wIjprID0KICAgICAgICAgICAgICAgICAgICAgIERkO2JyZWFrO2Nhc2UgInRvdWNoY2FuY2VsIjpjYXNlICJ0b3VjaGVuZCI6Y2FzZSAidG91Y2htb3ZlIjpjYXNlICJ0b3VjaHN0YXJ0IjprID0gVmQ7YnJlYWs7Y2FzZSAkZTpjYXNlIGFmOmNhc2UgYmY6ayA9IEhkO2JyZWFrO2Nhc2UgY2Y6ayA9IFhkO2JyZWFrO2Nhc2UgInNjcm9sbCI6ayA9IHZkO2JyZWFrO2Nhc2UgIndoZWVsIjprID0gWmQ7YnJlYWs7Y2FzZSAiY29weSI6Y2FzZSAiY3V0IjpjYXNlICJwYXN0ZSI6ayA9IEpkO2JyZWFrO2Nhc2UgImdvdHBvaW50ZXJjYXB0dXJlIjpjYXNlICJsb3N0cG9pbnRlcmNhcHR1cmUiOmNhc2UgInBvaW50ZXJjYW5jZWwiOmNhc2UgInBvaW50ZXJkb3duIjpjYXNlICJwb2ludGVybW92ZSI6Y2FzZSAicG9pbnRlcm91dCI6Y2FzZSAicG9pbnRlcm92ZXIiOmNhc2UgInBvaW50ZXJ1cCI6ayA9IFRkO312YXIgdCA9IDAgIT09IChiICYgNCksSiA9ICF0ICYmICJzY3JvbGwiID09PSBhLHggPSB0ID8gbnVsbCAhPT0gaCA/IGggKyAiQ2FwdHVyZSIgOiBudWxsIDogaDt0ID0gW107Zm9yICh2YXIgdyA9IGQsIHU7IG51bGwgIT09CiAgICAgICAgICAgICAgICAgIHc7KSB7dSA9IHc7dmFyIEYgPSB1LnN0YXRlTm9kZTs1ID09PSB1LnRhZyAmJiBudWxsICE9PSBGICYmICh1ID0gRiwgbnVsbCAhPT0geCAmJiAoRiA9IEtiKHcsIHgpLCBudWxsICE9IEYgJiYgdC5wdXNoKHRmKHcsIEYsIHUpKSkpO2lmIChKKSBicmVhazt3ID0gdy5yZXR1cm47fTAgPCB0Lmxlbmd0aCAmJiAoaCA9IG5ldyBrKGgsIG4sIG51bGwsIGMsIGUpLCBnLnB1c2goeyBldmVudDogaCwgbGlzdGVuZXJzOiB0IH0pKTt9fWlmICgwID09PSAoYiAmIDcpKSB7YToge2ggPSAibW91c2VvdmVyIiA9PT0gYSB8fCAicG9pbnRlcm92ZXIiID09PSBhO2sgPSAibW91c2VvdXQiID09PSBhIHx8ICJwb2ludGVyb3V0IiA9PT0gYTtpZiAoaCAmJiBjICE9PSB3YiAmJiAobiA9IGMucmVsYXRlZFRhcmdldCB8fCBjLmZyb21FbGVtZW50KSAmJiAoV2MobikgfHwgblt1Zl0pKSBicmVhayBhO2lmIChrIHx8IGgpIHtoID0gZS53aW5kb3cgPT09IGUgPyBlIDogKGggPSBlLm93bmVyRG9jdW1lbnQpID8gaC5kZWZhdWx0VmlldyB8fCBoLnBhcmVudFdpbmRvdyA6IHdpbmRvdztpZiAoaykge2lmIChuID0gYy5yZWxhdGVkVGFyZ2V0IHx8IGMudG9FbGVtZW50LCBrID0gZCwgbiA9IG4gPyBXYyhuKSA6IG51bGwsIG51bGwgIT09CiAgICAgICAgICAgICAgICAgICAgICBuICYmIChKID0gVmIobiksIG4gIT09IEogfHwgNSAhPT0gbi50YWcgJiYgNiAhPT0gbi50YWcpKSBuID0gbnVsbDt9IGVsc2UgayA9IG51bGwsIG4gPSBkO2lmIChrICE9PSBuKSB7dCA9IEJkO0YgPSAib25Nb3VzZUxlYXZlIjt4ID0gIm9uTW91c2VFbnRlciI7dyA9ICJtb3VzZSI7aWYgKCJwb2ludGVyb3V0IiA9PT0gYSB8fCAicG9pbnRlcm92ZXIiID09PSBhKSB0ID0gVGQsIEYgPSAib25Qb2ludGVyTGVhdmUiLCB4ID0gIm9uUG9pbnRlckVudGVyIiwgdyA9ICJwb2ludGVyIjtKID0gbnVsbCA9PSBrID8gaCA6IHVlKGspO3UgPSBudWxsID09IG4gPyBoIDogdWUobik7aCA9IG5ldyB0KEYsIHcgKyAibGVhdmUiLCBrLCBjLCBlKTtoLnRhcmdldCA9IEo7aC5yZWxhdGVkVGFyZ2V0ID0gdTtGID0gbnVsbDtXYyhlKSA9PT0gZCAmJiAodCA9IG5ldyB0KHgsIHcgKyAiZW50ZXIiLCBuLCBjLCBlKSwgdC50YXJnZXQgPSB1LCB0LnJlbGF0ZWRUYXJnZXQgPSBKLCBGID0gdCk7SiA9IEY7aWYgKGsgJiYgbikgYjoge3QgPSBrO3ggPSBuO3cgPSAwO2ZvciAodSA9IHQ7IHU7IHUgPSB2Zih1KSkgdysrO3UgPSAwO2ZvciAoRiA9IHg7IEY7IEYgPSB2ZihGKSkgdSsrO2ZvciAoOyAwIDwgdyAtIHU7KSB0ID0gdmYodCksIHctLTtmb3IgKDsgMCA8IHUgLSB3OykgeCA9CiAgICAgICAgICAgICAgICAgICAgICAgIHZmKHgpLCB1LS07Zm9yICg7IHctLTspIHtpZiAodCA9PT0geCB8fCBudWxsICE9PSB4ICYmIHQgPT09IHguYWx0ZXJuYXRlKSBicmVhayBiO3QgPSB2Zih0KTt4ID0gdmYoeCk7fXQgPSBudWxsO30gZWxzZSB0ID0gbnVsbDtudWxsICE9PSBrICYmIHdmKGcsIGgsIGssIHQsICExKTtudWxsICE9PSBuICYmIG51bGwgIT09IEogJiYgd2YoZywgSiwgbiwgdCwgITApO319fWE6IHtoID0gZCA/IHVlKGQpIDogd2luZG93O2sgPSBoLm5vZGVOYW1lICYmIGgubm9kZU5hbWUudG9Mb3dlckNhc2UoKTtpZiAoInNlbGVjdCIgPT09IGsgfHwgImlucHV0IiA9PT0gayAmJiAiZmlsZSIgPT09IGgudHlwZSkgdmFyIG5hID0gdmU7ZWxzZSBpZiAobWUoaCkpIHtpZiAod2UpIG5hID0gRmU7ZWxzZSB7bmEgPSBEZTt2YXIgeGEgPSBDZTt9fSBlbHNlIChrID0gaC5ub2RlTmFtZSkgJiYgImlucHV0IiA9PT0gay50b0xvd2VyQ2FzZSgpICYmICgiY2hlY2tib3giID09PSBoLnR5cGUgfHwgInJhZGlvIiA9PT0gaC50eXBlKSAmJiAobmEgPSBFZSk7aWYgKG5hICYmIChuYSA9IG5hKGEsIGQpKSkge25lKGcsIG5hLCBjLCBlKTticmVhayBhO314YSAmJiB4YShhLCBoLCBkKTsiZm9jdXNvdXQiID09PSBhICYmICh4YSA9IGguX3dyYXBwZXJTdGF0ZSkgJiYKICAgICAgICAgICAgICAgICAgeGEuY29udHJvbGxlZCAmJiAibnVtYmVyIiA9PT0gaC50eXBlICYmIGNiKGgsICJudW1iZXIiLCBoLnZhbHVlKTt9eGEgPSBkID8gdWUoZCkgOiB3aW5kb3c7c3dpdGNoIChhKSB7Y2FzZSAiZm9jdXNpbiI6aWYgKG1lKHhhKSB8fCAidHJ1ZSIgPT09IHhhLmNvbnRlbnRFZGl0YWJsZSkgUWUgPSB4YSwgUmUgPSBkLCBTZSA9IG51bGw7YnJlYWs7Y2FzZSAiZm9jdXNvdXQiOlNlID0gUmUgPSBRZSA9IG51bGw7YnJlYWs7Y2FzZSAibW91c2Vkb3duIjpUZSA9ICEwO2JyZWFrO2Nhc2UgImNvbnRleHRtZW51IjpjYXNlICJtb3VzZXVwIjpjYXNlICJkcmFnZW5kIjpUZSA9ICExO1VlKGcsIGMsIGUpO2JyZWFrO2Nhc2UgInNlbGVjdGlvbmNoYW5nZSI6aWYgKFBlKSBicmVhaztjYXNlICJrZXlkb3duIjpjYXNlICJrZXl1cCI6VWUoZywgYywgZSk7fXZhciAkYTtpZiAoYWUpIGI6IHtzd2l0Y2ggKGEpIHtjYXNlICJjb21wb3NpdGlvbnN0YXJ0Ijp2YXIgYmEgPSAib25Db21wb3NpdGlvblN0YXJ0IjticmVhayBiO2Nhc2UgImNvbXBvc2l0aW9uZW5kIjpiYSA9ICJvbkNvbXBvc2l0aW9uRW5kIjsKICAgICAgICAgICAgICAgICAgICAgIGJyZWFrIGI7Y2FzZSAiY29tcG9zaXRpb251cGRhdGUiOmJhID0gIm9uQ29tcG9zaXRpb25VcGRhdGUiO2JyZWFrIGI7fWJhID0gdm9pZCAwO30gZWxzZSBpZSA/IGdlKGEsIGMpICYmIChiYSA9ICJvbkNvbXBvc2l0aW9uRW5kIikgOiAia2V5ZG93biIgPT09IGEgJiYgMjI5ID09PSBjLmtleUNvZGUgJiYgKGJhID0gIm9uQ29tcG9zaXRpb25TdGFydCIpO2JhICYmIChkZSAmJiAia28iICE9PSBjLmxvY2FsZSAmJiAoaWUgfHwgIm9uQ29tcG9zaXRpb25TdGFydCIgIT09IGJhID8gIm9uQ29tcG9zaXRpb25FbmQiID09PSBiYSAmJiBpZSAmJiAoJGEgPSBuZCgpKSA6IChrZCA9IGUsIGxkID0gInZhbHVlIiBpbiBrZCA/IGtkLnZhbHVlIDoga2QudGV4dENvbnRlbnQsIGllID0gITApKSwgeGEgPSBvZShkLCBiYSksIDAgPCB4YS5sZW5ndGggJiYgKGJhID0gbmV3IExkKGJhLCBhLCBudWxsLCBjLCBlKSwgZy5wdXNoKHsgZXZlbnQ6IGJhLCBsaXN0ZW5lcnM6IHhhIH0pLCAkYSA/IGJhLmRhdGEgPSAkYSA6ICgkYSA9IGhlKGMpLCBudWxsICE9PSAkYSAmJiAoYmEuZGF0YSA9ICRhKSkpKTtpZiAoJGEgPSBjZSA/IGplKGEsIGMpIDoga2UoYSwgYykpIGQgPSBvZShkLCAib25CZWZvcmVJbnB1dCIpLAogICAgICAgICAgICAgICAgMCA8IGQubGVuZ3RoICYmIChlID0gbmV3IExkKCJvbkJlZm9yZUlucHV0IiwgImJlZm9yZWlucHV0IiwgbnVsbCwgYywgZSksIGcucHVzaCh7IGV2ZW50OiBlLCBsaXN0ZW5lcnM6IGQgfSksIGUuZGF0YSA9ICRhKTt9c2UoZywgYik7fSk7fWZ1bmN0aW9uIHRmKGEsIGIsIGMpIHtyZXR1cm4geyBpbnN0YW5jZTogYSwgbGlzdGVuZXI6IGIsIGN1cnJlbnRUYXJnZXQ6IGMgfTt9ZnVuY3Rpb24gb2UoYSwgYikge2ZvciAodmFyIGMgPSBiICsgIkNhcHR1cmUiLCBkID0gW107IG51bGwgIT09IGE7KSB7dmFyIGUgPSBhLGYgPSBlLnN0YXRlTm9kZTs1ID09PSBlLnRhZyAmJiBudWxsICE9PSBmICYmIChlID0gZiwgZiA9IEtiKGEsIGMpLCBudWxsICE9IGYgJiYgZC51bnNoaWZ0KHRmKGEsIGYsIGUpKSwgZiA9IEtiKGEsIGIpLCBudWxsICE9IGYgJiYgZC5wdXNoKHRmKGEsIGYsIGUpKSk7YSA9IGEucmV0dXJuO31yZXR1cm4gZDt9ZnVuY3Rpb24gdmYoYSkge2lmIChudWxsID09PSBhKSByZXR1cm4gbnVsbDtkbyBhID0gYS5yZXR1cm47IHdoaWxlIChhICYmIDUgIT09IGEudGFnKTtyZXR1cm4gYSA/IGEgOiBudWxsO30KICAgICAgICAgIGZ1bmN0aW9uIHdmKGEsIGIsIGMsIGQsIGUpIHtmb3IgKHZhciBmID0gYi5fcmVhY3ROYW1lLCBnID0gW107IG51bGwgIT09IGMgJiYgYyAhPT0gZDspIHt2YXIgaCA9IGMsayA9IGguYWx0ZXJuYXRlLGwgPSBoLnN0YXRlTm9kZTtpZiAobnVsbCAhPT0gayAmJiBrID09PSBkKSBicmVhazs1ID09PSBoLnRhZyAmJiBudWxsICE9PSBsICYmIChoID0gbCwgZSA/IChrID0gS2IoYywgZiksIG51bGwgIT0gayAmJiBnLnVuc2hpZnQodGYoYywgaywgaCkpKSA6IGUgfHwgKGsgPSBLYihjLCBmKSwgbnVsbCAhPSBrICYmIGcucHVzaCh0ZihjLCBrLCBoKSkpKTtjID0gYy5yZXR1cm47fTAgIT09IGcubGVuZ3RoICYmIGEucHVzaCh7IGV2ZW50OiBiLCBsaXN0ZW5lcnM6IGcgfSk7fXZhciB4ZiA9IC9cclxuPy9nLHlmID0gL1x1MDAwMHxcdUZGRkQvZztmdW5jdGlvbiB6ZihhKSB7cmV0dXJuICgic3RyaW5nIiA9PT0gdHlwZW9mIGEgPyBhIDogIiIgKyBhKS5yZXBsYWNlKHhmLCAiXG4iKS5yZXBsYWNlKHlmLCAiIik7fWZ1bmN0aW9uIEFmKGEsIGIsIGMpIHtiID0gemYoYik7aWYgKHpmKGEpICE9PSBiICYmIGMpIHRocm93IEVycm9yKHAoNDI1KSk7fWZ1bmN0aW9uIEJmKCkge30KICAgICAgICAgIHZhciBDZiA9IG51bGwsRGYgPSBudWxsO2Z1bmN0aW9uIEVmKGEsIGIpIHtyZXR1cm4gInRleHRhcmVhIiA9PT0gYSB8fCAibm9zY3JpcHQiID09PSBhIHx8ICJzdHJpbmciID09PSB0eXBlb2YgYi5jaGlsZHJlbiB8fCAibnVtYmVyIiA9PT0gdHlwZW9mIGIuY2hpbGRyZW4gfHwgIm9iamVjdCIgPT09IHR5cGVvZiBiLmRhbmdlcm91c2x5U2V0SW5uZXJIVE1MICYmIG51bGwgIT09IGIuZGFuZ2Vyb3VzbHlTZXRJbm5lckhUTUwgJiYgbnVsbCAhPSBiLmRhbmdlcm91c2x5U2V0SW5uZXJIVE1MLl9faHRtbDt9CiAgICAgICAgICB2YXIgRmYgPSAiZnVuY3Rpb24iID09PSB0eXBlb2Ygc2V0VGltZW91dCA/IHNldFRpbWVvdXQgOiB2b2lkIDAsR2YgPSAiZnVuY3Rpb24iID09PSB0eXBlb2YgY2xlYXJUaW1lb3V0ID8gY2xlYXJUaW1lb3V0IDogdm9pZCAwLEhmID0gImZ1bmN0aW9uIiA9PT0gdHlwZW9mIFByb21pc2UgPyBQcm9taXNlIDogdm9pZCAwLEpmID0gImZ1bmN0aW9uIiA9PT0gdHlwZW9mIHF1ZXVlTWljcm90YXNrID8gcXVldWVNaWNyb3Rhc2sgOiAidW5kZWZpbmVkIiAhPT0gdHlwZW9mIEhmID8gZnVuY3Rpb24gKGEpIHtyZXR1cm4gSGYucmVzb2x2ZShudWxsKS50aGVuKGEpLmNhdGNoKElmKTt9IDogRmY7ZnVuY3Rpb24gSWYoYSkge3NldFRpbWVvdXQoZnVuY3Rpb24gKCkge3Rocm93IGE7fSk7fQogICAgICAgICAgZnVuY3Rpb24gS2YoYSwgYikge3ZhciBjID0gYixkID0gMDtkbyB7dmFyIGUgPSBjLm5leHRTaWJsaW5nO2EucmVtb3ZlQ2hpbGQoYyk7aWYgKGUgJiYgOCA9PT0gZS5ub2RlVHlwZSkgaWYgKGMgPSBlLmRhdGEsICIvJCIgPT09IGMpIHtpZiAoMCA9PT0gZCkge2EucmVtb3ZlQ2hpbGQoZSk7YmQoYik7cmV0dXJuO31kLS07fSBlbHNlICIkIiAhPT0gYyAmJiAiJD8iICE9PSBjICYmICIkISIgIT09IGMgfHwgZCsrO2MgPSBlO30gd2hpbGUgKGMpO2JkKGIpO31mdW5jdGlvbiBMZihhKSB7Zm9yICg7IG51bGwgIT0gYTsgYSA9IGEubmV4dFNpYmxpbmcpIHt2YXIgYiA9IGEubm9kZVR5cGU7aWYgKDEgPT09IGIgfHwgMyA9PT0gYikgYnJlYWs7aWYgKDggPT09IGIpIHtiID0gYS5kYXRhO2lmICgiJCIgPT09IGIgfHwgIiQhIiA9PT0gYiB8fCAiJD8iID09PSBiKSBicmVhaztpZiAoIi8kIiA9PT0gYikgcmV0dXJuIG51bGw7fX1yZXR1cm4gYTt9CiAgICAgICAgICBmdW5jdGlvbiBNZihhKSB7YSA9IGEucHJldmlvdXNTaWJsaW5nO2ZvciAodmFyIGIgPSAwOyBhOykge2lmICg4ID09PSBhLm5vZGVUeXBlKSB7dmFyIGMgPSBhLmRhdGE7aWYgKCIkIiA9PT0gYyB8fCAiJCEiID09PSBjIHx8ICIkPyIgPT09IGMpIHtpZiAoMCA9PT0gYikgcmV0dXJuIGE7Yi0tO30gZWxzZSAiLyQiID09PSBjICYmIGIrKzt9YSA9IGEucHJldmlvdXNTaWJsaW5nO31yZXR1cm4gbnVsbDt9dmFyIE5mID0gTWF0aC5yYW5kb20oKS50b1N0cmluZygzNikuc2xpY2UoMiksT2YgPSAiX19yZWFjdEZpYmVyJCIgKyBOZixQZiA9ICJfX3JlYWN0UHJvcHMkIiArIE5mLHVmID0gIl9fcmVhY3RDb250YWluZXIkIiArIE5mLG9mID0gIl9fcmVhY3RFdmVudHMkIiArIE5mLFFmID0gIl9fcmVhY3RMaXN0ZW5lcnMkIiArIE5mLFJmID0gIl9fcmVhY3RIYW5kbGVzJCIgKyBOZjsKICAgICAgICAgIGZ1bmN0aW9uIFdjKGEpIHt2YXIgYiA9IGFbT2ZdO2lmIChiKSByZXR1cm4gYjtmb3IgKHZhciBjID0gYS5wYXJlbnROb2RlOyBjOykge2lmIChiID0gY1t1Zl0gfHwgY1tPZl0pIHtjID0gYi5hbHRlcm5hdGU7aWYgKG51bGwgIT09IGIuY2hpbGQgfHwgbnVsbCAhPT0gYyAmJiBudWxsICE9PSBjLmNoaWxkKSBmb3IgKGEgPSBNZihhKTsgbnVsbCAhPT0gYTspIHtpZiAoYyA9IGFbT2ZdKSByZXR1cm4gYzthID0gTWYoYSk7fXJldHVybiBiO31hID0gYztjID0gYS5wYXJlbnROb2RlO31yZXR1cm4gbnVsbDt9ZnVuY3Rpb24gQ2IoYSkge2EgPSBhW09mXSB8fCBhW3VmXTtyZXR1cm4gIWEgfHwgNSAhPT0gYS50YWcgJiYgNiAhPT0gYS50YWcgJiYgMTMgIT09IGEudGFnICYmIDMgIT09IGEudGFnID8gbnVsbCA6IGE7fWZ1bmN0aW9uIHVlKGEpIHtpZiAoNSA9PT0gYS50YWcgfHwgNiA9PT0gYS50YWcpIHJldHVybiBhLnN0YXRlTm9kZTt0aHJvdyBFcnJvcihwKDMzKSk7fWZ1bmN0aW9uIERiKGEpIHtyZXR1cm4gYVtQZl0gfHwgbnVsbDt9dmFyIFNmID0gW10sVGYgPSAtMTtmdW5jdGlvbiBVZihhKSB7cmV0dXJuIHsgY3VycmVudDogYSB9O30KICAgICAgICAgIGZ1bmN0aW9uIEUoYSkgezAgPiBUZiB8fCAoYS5jdXJyZW50ID0gU2ZbVGZdLCBTZltUZl0gPSBudWxsLCBUZi0tKTt9ZnVuY3Rpb24gRyhhLCBiKSB7VGYrKztTZltUZl0gPSBhLmN1cnJlbnQ7YS5jdXJyZW50ID0gYjt9dmFyIFZmID0ge30sSCA9IFVmKFZmKSxXZiA9IFVmKCExKSxYZiA9IFZmO2Z1bmN0aW9uIFlmKGEsIGIpIHt2YXIgYyA9IGEudHlwZS5jb250ZXh0VHlwZXM7aWYgKCFjKSByZXR1cm4gVmY7dmFyIGQgPSBhLnN0YXRlTm9kZTtpZiAoZCAmJiBkLl9fcmVhY3RJbnRlcm5hbE1lbW9pemVkVW5tYXNrZWRDaGlsZENvbnRleHQgPT09IGIpIHJldHVybiBkLl9fcmVhY3RJbnRlcm5hbE1lbW9pemVkTWFza2VkQ2hpbGRDb250ZXh0O3ZhciBlID0ge30sZjtmb3IgKGYgaW4gYykgZVtmXSA9IGJbZl07ZCAmJiAoYSA9IGEuc3RhdGVOb2RlLCBhLl9fcmVhY3RJbnRlcm5hbE1lbW9pemVkVW5tYXNrZWRDaGlsZENvbnRleHQgPSBiLCBhLl9fcmVhY3RJbnRlcm5hbE1lbW9pemVkTWFza2VkQ2hpbGRDb250ZXh0ID0gZSk7cmV0dXJuIGU7fQogICAgICAgICAgZnVuY3Rpb24gWmYoYSkge2EgPSBhLmNoaWxkQ29udGV4dFR5cGVzO3JldHVybiBudWxsICE9PSBhICYmIHZvaWQgMCAhPT0gYTt9ZnVuY3Rpb24gJGYoKSB7RShXZik7RShIKTt9ZnVuY3Rpb24gYWcoYSwgYiwgYykge2lmIChILmN1cnJlbnQgIT09IFZmKSB0aHJvdyBFcnJvcihwKDE2OCkpO0coSCwgYik7RyhXZiwgYyk7fWZ1bmN0aW9uIGJnKGEsIGIsIGMpIHt2YXIgZCA9IGEuc3RhdGVOb2RlO2IgPSBiLmNoaWxkQ29udGV4dFR5cGVzO2lmICgiZnVuY3Rpb24iICE9PSB0eXBlb2YgZC5nZXRDaGlsZENvbnRleHQpIHJldHVybiBjO2QgPSBkLmdldENoaWxkQ29udGV4dCgpO2ZvciAodmFyIGUgaW4gZCkgaWYgKCEoZSBpbiBiKSkgdGhyb3cgRXJyb3IocCgxMDgsIFJhKGEpIHx8ICJVbmtub3duIiwgZSkpO3JldHVybiBBKHt9LCBjLCBkKTt9CiAgICAgICAgICBmdW5jdGlvbiBjZyhhKSB7YSA9IChhID0gYS5zdGF0ZU5vZGUpICYmIGEuX19yZWFjdEludGVybmFsTWVtb2l6ZWRNZXJnZWRDaGlsZENvbnRleHQgfHwgVmY7WGYgPSBILmN1cnJlbnQ7RyhILCBhKTtHKFdmLCBXZi5jdXJyZW50KTtyZXR1cm4gITA7fWZ1bmN0aW9uIGRnKGEsIGIsIGMpIHt2YXIgZCA9IGEuc3RhdGVOb2RlO2lmICghZCkgdGhyb3cgRXJyb3IocCgxNjkpKTtjID8gKGEgPSBiZyhhLCBiLCBYZiksIGQuX19yZWFjdEludGVybmFsTWVtb2l6ZWRNZXJnZWRDaGlsZENvbnRleHQgPSBhLCBFKFdmKSwgRShIKSwgRyhILCBhKSkgOiBFKFdmKTtHKFdmLCBjKTt9dmFyIGVnID0gbnVsbCxmZyA9ICExLGdnID0gITE7ZnVuY3Rpb24gaGcoYSkge251bGwgPT09IGVnID8gZWcgPSBbYV0gOiBlZy5wdXNoKGEpO31mdW5jdGlvbiBpZyhhKSB7ZmcgPSAhMDtoZyhhKTt9CiAgICAgICAgICBmdW5jdGlvbiBqZygpIHtpZiAoIWdnICYmIG51bGwgIT09IGVnKSB7Z2cgPSAhMDt2YXIgYSA9IDAsYiA9IEM7dHJ5IHt2YXIgYyA9IGVnO2ZvciAoQyA9IDE7IGEgPCBjLmxlbmd0aDsgYSsrKSB7dmFyIGQgPSBjW2FdO2RvIGQgPSBkKCEwKTsgd2hpbGUgKG51bGwgIT09IGQpO31lZyA9IG51bGw7ZmcgPSAhMTt9IGNhdGNoIChlKSB7dGhyb3cgbnVsbCAhPT0gZWcgJiYgKGVnID0gZWcuc2xpY2UoYSArIDEpKSwgYWMoZmMsIGpnKSwgZTt9IGZpbmFsbHkge0MgPSBiLCBnZyA9ICExO319cmV0dXJuIG51bGw7fXZhciBrZyA9IFtdLGxnID0gMCxtZyA9IG51bGwsbmcgPSAwLG9nID0gW10scGcgPSAwLHFnID0gbnVsbCxyZyA9IDEsc2cgPSAiIjtmdW5jdGlvbiB0ZyhhLCBiKSB7a2dbbGcrK10gPSBuZztrZ1tsZysrXSA9IG1nO21nID0gYTtuZyA9IGI7fQogICAgICAgICAgZnVuY3Rpb24gdWcoYSwgYiwgYykge29nW3BnKytdID0gcmc7b2dbcGcrK10gPSBzZztvZ1twZysrXSA9IHFnO3FnID0gYTt2YXIgZCA9IHJnO2EgPSBzZzt2YXIgZSA9IDMyIC0gb2MoZCkgLSAxO2QgJj0gfigxIDw8IGUpO2MgKz0gMTt2YXIgZiA9IDMyIC0gb2MoYikgKyBlO2lmICgzMCA8IGYpIHt2YXIgZyA9IGUgLSBlICUgNTtmID0gKGQgJiAoMSA8PCBnKSAtIDEpLnRvU3RyaW5nKDMyKTtkID4+PSBnO2UgLT0gZztyZyA9IDEgPDwgMzIgLSBvYyhiKSArIGUgfCBjIDw8IGUgfCBkO3NnID0gZiArIGE7fSBlbHNlIHJnID0gMSA8PCBmIHwgYyA8PCBlIHwgZCwgc2cgPSBhO31mdW5jdGlvbiB2ZyhhKSB7bnVsbCAhPT0gYS5yZXR1cm4gJiYgKHRnKGEsIDEpLCB1ZyhhLCAxLCAwKSk7fWZ1bmN0aW9uIHdnKGEpIHtmb3IgKDsgYSA9PT0gbWc7KSBtZyA9IGtnWy0tbGddLCBrZ1tsZ10gPSBudWxsLCBuZyA9IGtnWy0tbGddLCBrZ1tsZ10gPSBudWxsO2ZvciAoOyBhID09PSBxZzspIHFnID0gb2dbLS1wZ10sIG9nW3BnXSA9IG51bGwsIHNnID0gb2dbLS1wZ10sIG9nW3BnXSA9IG51bGwsIHJnID0gb2dbLS1wZ10sIG9nW3BnXSA9IG51bGw7fXZhciB4ZyA9IG51bGwseWcgPSBudWxsLEkgPSAhMSx6ZyA9IG51bGw7CiAgICAgICAgICBmdW5jdGlvbiBBZyhhLCBiKSB7dmFyIGMgPSBCZyg1LCBudWxsLCBudWxsLCAwKTtjLmVsZW1lbnRUeXBlID0gIkRFTEVURUQiO2Muc3RhdGVOb2RlID0gYjtjLnJldHVybiA9IGE7YiA9IGEuZGVsZXRpb25zO251bGwgPT09IGIgPyAoYS5kZWxldGlvbnMgPSBbY10sIGEuZmxhZ3MgfD0gMTYpIDogYi5wdXNoKGMpO30KICAgICAgICAgIGZ1bmN0aW9uIENnKGEsIGIpIHtzd2l0Y2ggKGEudGFnKSB7Y2FzZSA1OnZhciBjID0gYS50eXBlO2IgPSAxICE9PSBiLm5vZGVUeXBlIHx8IGMudG9Mb3dlckNhc2UoKSAhPT0gYi5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpID8gbnVsbCA6IGI7cmV0dXJuIG51bGwgIT09IGIgPyAoYS5zdGF0ZU5vZGUgPSBiLCB4ZyA9IGEsIHlnID0gTGYoYi5maXJzdENoaWxkKSwgITApIDogITE7Y2FzZSA2OnJldHVybiBiID0gIiIgPT09IGEucGVuZGluZ1Byb3BzIHx8IDMgIT09IGIubm9kZVR5cGUgPyBudWxsIDogYiwgbnVsbCAhPT0gYiA/IChhLnN0YXRlTm9kZSA9IGIsIHhnID0gYSwgeWcgPSBudWxsLCAhMCkgOiAhMTtjYXNlIDEzOnJldHVybiBiID0gOCAhPT0gYi5ub2RlVHlwZSA/IG51bGwgOiBiLCBudWxsICE9PSBiID8gKGMgPSBudWxsICE9PSBxZyA/IHsgaWQ6IHJnLCBvdmVyZmxvdzogc2cgfSA6IG51bGwsIGEubWVtb2l6ZWRTdGF0ZSA9IHsgZGVoeWRyYXRlZDogYiwgdHJlZUNvbnRleHQ6IGMsIHJldHJ5TGFuZTogMTA3Mzc0MTgyNCB9LCBjID0gQmcoMTgsIG51bGwsIG51bGwsIDApLCBjLnN0YXRlTm9kZSA9IGIsIGMucmV0dXJuID0gYSwgYS5jaGlsZCA9IGMsIHhnID0gYSwgeWcgPQogICAgICAgICAgICAgICAgbnVsbCwgITApIDogITE7ZGVmYXVsdDpyZXR1cm4gITE7fX1mdW5jdGlvbiBEZyhhKSB7cmV0dXJuIDAgIT09IChhLm1vZGUgJiAxKSAmJiAwID09PSAoYS5mbGFncyAmIDEyOCk7fWZ1bmN0aW9uIEVnKGEpIHtpZiAoSSkge3ZhciBiID0geWc7aWYgKGIpIHt2YXIgYyA9IGI7aWYgKCFDZyhhLCBiKSkge2lmIChEZyhhKSkgdGhyb3cgRXJyb3IocCg0MTgpKTtiID0gTGYoYy5uZXh0U2libGluZyk7dmFyIGQgPSB4ZztiICYmIENnKGEsIGIpID8gQWcoZCwgYykgOiAoYS5mbGFncyA9IGEuZmxhZ3MgJiAtNDA5NyB8IDIsIEkgPSAhMSwgeGcgPSBhKTt9fSBlbHNlIHtpZiAoRGcoYSkpIHRocm93IEVycm9yKHAoNDE4KSk7YS5mbGFncyA9IGEuZmxhZ3MgJiAtNDA5NyB8IDI7SSA9ICExO3hnID0gYTt9fX1mdW5jdGlvbiBGZyhhKSB7Zm9yIChhID0gYS5yZXR1cm47IG51bGwgIT09IGEgJiYgNSAhPT0gYS50YWcgJiYgMyAhPT0gYS50YWcgJiYgMTMgIT09IGEudGFnOykgYSA9IGEucmV0dXJuO3hnID0gYTt9CiAgICAgICAgICBmdW5jdGlvbiBHZyhhKSB7aWYgKGEgIT09IHhnKSByZXR1cm4gITE7aWYgKCFJKSByZXR1cm4gRmcoYSksIEkgPSAhMCwgITE7dmFyIGI7KGIgPSAzICE9PSBhLnRhZykgJiYgIShiID0gNSAhPT0gYS50YWcpICYmIChiID0gYS50eXBlLCBiID0gImhlYWQiICE9PSBiICYmICJib2R5IiAhPT0gYiAmJiAhRWYoYS50eXBlLCBhLm1lbW9pemVkUHJvcHMpKTtpZiAoYiAmJiAoYiA9IHlnKSkge2lmIChEZyhhKSkgdGhyb3cgSGcoKSwgRXJyb3IocCg0MTgpKTtmb3IgKDsgYjspIEFnKGEsIGIpLCBiID0gTGYoYi5uZXh0U2libGluZyk7fUZnKGEpO2lmICgxMyA9PT0gYS50YWcpIHthID0gYS5tZW1vaXplZFN0YXRlO2EgPSBudWxsICE9PSBhID8gYS5kZWh5ZHJhdGVkIDogbnVsbDtpZiAoIWEpIHRocm93IEVycm9yKHAoMzE3KSk7YToge2EgPSBhLm5leHRTaWJsaW5nO2ZvciAoYiA9IDA7IGE7KSB7aWYgKDggPT09IGEubm9kZVR5cGUpIHt2YXIgYyA9IGEuZGF0YTtpZiAoIi8kIiA9PT0gYykge2lmICgwID09PSBiKSB7eWcgPSBMZihhLm5leHRTaWJsaW5nKTticmVhayBhO31iLS07fSBlbHNlICIkIiAhPT0gYyAmJiAiJCEiICE9PSBjICYmICIkPyIgIT09IGMgfHwgYisrO31hID0gYS5uZXh0U2libGluZzt9eWcgPQogICAgICAgICAgICAgICAgbnVsbDt9fSBlbHNlIHlnID0geGcgPyBMZihhLnN0YXRlTm9kZS5uZXh0U2libGluZykgOiBudWxsO3JldHVybiAhMDt9ZnVuY3Rpb24gSGcoKSB7Zm9yICh2YXIgYSA9IHlnOyBhOykgYSA9IExmKGEubmV4dFNpYmxpbmcpO31mdW5jdGlvbiBJZygpIHt5ZyA9IHhnID0gbnVsbDtJID0gITE7fWZ1bmN0aW9uIEpnKGEpIHtudWxsID09PSB6ZyA/IHpnID0gW2FdIDogemcucHVzaChhKTt9dmFyIEtnID0gdWEuUmVhY3RDdXJyZW50QmF0Y2hDb25maWc7ZnVuY3Rpb24gTGcoYSwgYikge2lmIChhICYmIGEuZGVmYXVsdFByb3BzKSB7YiA9IEEoe30sIGIpO2EgPSBhLmRlZmF1bHRQcm9wcztmb3IgKHZhciBjIGluIGEpIHZvaWQgMCA9PT0gYltjXSAmJiAoYltjXSA9IGFbY10pO3JldHVybiBiO31yZXR1cm4gYjt9dmFyIE1nID0gVWYobnVsbCksTmcgPSBudWxsLE9nID0gbnVsbCxQZyA9IG51bGw7ZnVuY3Rpb24gUWcoKSB7UGcgPSBPZyA9IE5nID0gbnVsbDt9ZnVuY3Rpb24gUmcoYSkge3ZhciBiID0gTWcuY3VycmVudDtFKE1nKTthLl9jdXJyZW50VmFsdWUgPSBiO30KICAgICAgICAgIGZ1bmN0aW9uIFNnKGEsIGIsIGMpIHtmb3IgKDsgbnVsbCAhPT0gYTspIHt2YXIgZCA9IGEuYWx0ZXJuYXRlOyhhLmNoaWxkTGFuZXMgJiBiKSAhPT0gYiA/IChhLmNoaWxkTGFuZXMgfD0gYiwgbnVsbCAhPT0gZCAmJiAoZC5jaGlsZExhbmVzIHw9IGIpKSA6IG51bGwgIT09IGQgJiYgKGQuY2hpbGRMYW5lcyAmIGIpICE9PSBiICYmIChkLmNoaWxkTGFuZXMgfD0gYik7aWYgKGEgPT09IGMpIGJyZWFrO2EgPSBhLnJldHVybjt9fWZ1bmN0aW9uIFRnKGEsIGIpIHtOZyA9IGE7UGcgPSBPZyA9IG51bGw7YSA9IGEuZGVwZW5kZW5jaWVzO251bGwgIT09IGEgJiYgbnVsbCAhPT0gYS5maXJzdENvbnRleHQgJiYgKDAgIT09IChhLmxhbmVzICYgYikgJiYgKFVnID0gITApLCBhLmZpcnN0Q29udGV4dCA9IG51bGwpO30KICAgICAgICAgIGZ1bmN0aW9uIFZnKGEpIHt2YXIgYiA9IGEuX2N1cnJlbnRWYWx1ZTtpZiAoUGcgIT09IGEpIGlmIChhID0geyBjb250ZXh0OiBhLCBtZW1vaXplZFZhbHVlOiBiLCBuZXh0OiBudWxsIH0sIG51bGwgPT09IE9nKSB7aWYgKG51bGwgPT09IE5nKSB0aHJvdyBFcnJvcihwKDMwOCkpO09nID0gYTtOZy5kZXBlbmRlbmNpZXMgPSB7IGxhbmVzOiAwLCBmaXJzdENvbnRleHQ6IGEgfTt9IGVsc2UgT2cgPSBPZy5uZXh0ID0gYTtyZXR1cm4gYjt9dmFyIFdnID0gbnVsbDtmdW5jdGlvbiBYZyhhKSB7bnVsbCA9PT0gV2cgPyBXZyA9IFthXSA6IFdnLnB1c2goYSk7fWZ1bmN0aW9uIFlnKGEsIGIsIGMsIGQpIHt2YXIgZSA9IGIuaW50ZXJsZWF2ZWQ7bnVsbCA9PT0gZSA/IChjLm5leHQgPSBjLCBYZyhiKSkgOiAoYy5uZXh0ID0gZS5uZXh0LCBlLm5leHQgPSBjKTtiLmludGVybGVhdmVkID0gYztyZXR1cm4gWmcoYSwgZCk7fQogICAgICAgICAgZnVuY3Rpb24gWmcoYSwgYikge2EubGFuZXMgfD0gYjt2YXIgYyA9IGEuYWx0ZXJuYXRlO251bGwgIT09IGMgJiYgKGMubGFuZXMgfD0gYik7YyA9IGE7Zm9yIChhID0gYS5yZXR1cm47IG51bGwgIT09IGE7KSBhLmNoaWxkTGFuZXMgfD0gYiwgYyA9IGEuYWx0ZXJuYXRlLCBudWxsICE9PSBjICYmIChjLmNoaWxkTGFuZXMgfD0gYiksIGMgPSBhLCBhID0gYS5yZXR1cm47cmV0dXJuIDMgPT09IGMudGFnID8gYy5zdGF0ZU5vZGUgOiBudWxsO312YXIgJGcgPSAhMTtmdW5jdGlvbiBhaChhKSB7YS51cGRhdGVRdWV1ZSA9IHsgYmFzZVN0YXRlOiBhLm1lbW9pemVkU3RhdGUsIGZpcnN0QmFzZVVwZGF0ZTogbnVsbCwgbGFzdEJhc2VVcGRhdGU6IG51bGwsIHNoYXJlZDogeyBwZW5kaW5nOiBudWxsLCBpbnRlcmxlYXZlZDogbnVsbCwgbGFuZXM6IDAgfSwgZWZmZWN0czogbnVsbCB9O30KICAgICAgICAgIGZ1bmN0aW9uIGJoKGEsIGIpIHthID0gYS51cGRhdGVRdWV1ZTtiLnVwZGF0ZVF1ZXVlID09PSBhICYmIChiLnVwZGF0ZVF1ZXVlID0geyBiYXNlU3RhdGU6IGEuYmFzZVN0YXRlLCBmaXJzdEJhc2VVcGRhdGU6IGEuZmlyc3RCYXNlVXBkYXRlLCBsYXN0QmFzZVVwZGF0ZTogYS5sYXN0QmFzZVVwZGF0ZSwgc2hhcmVkOiBhLnNoYXJlZCwgZWZmZWN0czogYS5lZmZlY3RzIH0pO31mdW5jdGlvbiBjaChhLCBiKSB7cmV0dXJuIHsgZXZlbnRUaW1lOiBhLCBsYW5lOiBiLCB0YWc6IDAsIHBheWxvYWQ6IG51bGwsIGNhbGxiYWNrOiBudWxsLCBuZXh0OiBudWxsIH07fQogICAgICAgICAgZnVuY3Rpb24gZGgoYSwgYiwgYykge3ZhciBkID0gYS51cGRhdGVRdWV1ZTtpZiAobnVsbCA9PT0gZCkgcmV0dXJuIG51bGw7ZCA9IGQuc2hhcmVkO2lmICgwICE9PSAoSyAmIDIpKSB7dmFyIGUgPSBkLnBlbmRpbmc7bnVsbCA9PT0gZSA/IGIubmV4dCA9IGIgOiAoYi5uZXh0ID0gZS5uZXh0LCBlLm5leHQgPSBiKTtkLnBlbmRpbmcgPSBiO3JldHVybiBaZyhhLCBjKTt9ZSA9IGQuaW50ZXJsZWF2ZWQ7bnVsbCA9PT0gZSA/IChiLm5leHQgPSBiLCBYZyhkKSkgOiAoYi5uZXh0ID0gZS5uZXh0LCBlLm5leHQgPSBiKTtkLmludGVybGVhdmVkID0gYjtyZXR1cm4gWmcoYSwgYyk7fWZ1bmN0aW9uIGVoKGEsIGIsIGMpIHtiID0gYi51cGRhdGVRdWV1ZTtpZiAobnVsbCAhPT0gYiAmJiAoYiA9IGIuc2hhcmVkLCAwICE9PSAoYyAmIDQxOTQyNDApKSkge3ZhciBkID0gYi5sYW5lcztkICY9IGEucGVuZGluZ0xhbmVzO2MgfD0gZDtiLmxhbmVzID0gYztDYyhhLCBjKTt9fQogICAgICAgICAgZnVuY3Rpb24gZmgoYSwgYikge3ZhciBjID0gYS51cGRhdGVRdWV1ZSxkID0gYS5hbHRlcm5hdGU7aWYgKG51bGwgIT09IGQgJiYgKGQgPSBkLnVwZGF0ZVF1ZXVlLCBjID09PSBkKSkge3ZhciBlID0gbnVsbCxmID0gbnVsbDtjID0gYy5maXJzdEJhc2VVcGRhdGU7aWYgKG51bGwgIT09IGMpIHtkbyB7dmFyIGcgPSB7IGV2ZW50VGltZTogYy5ldmVudFRpbWUsIGxhbmU6IGMubGFuZSwgdGFnOiBjLnRhZywgcGF5bG9hZDogYy5wYXlsb2FkLCBjYWxsYmFjazogYy5jYWxsYmFjaywgbmV4dDogbnVsbCB9O251bGwgPT09IGYgPyBlID0gZiA9IGcgOiBmID0gZi5uZXh0ID0gZztjID0gYy5uZXh0O30gd2hpbGUgKG51bGwgIT09IGMpO251bGwgPT09IGYgPyBlID0gZiA9IGIgOiBmID0gZi5uZXh0ID0gYjt9IGVsc2UgZSA9IGYgPSBiO2MgPSB7IGJhc2VTdGF0ZTogZC5iYXNlU3RhdGUsIGZpcnN0QmFzZVVwZGF0ZTogZSwgbGFzdEJhc2VVcGRhdGU6IGYsIHNoYXJlZDogZC5zaGFyZWQsIGVmZmVjdHM6IGQuZWZmZWN0cyB9O2EudXBkYXRlUXVldWUgPSBjO3JldHVybjt9YSA9IGMubGFzdEJhc2VVcGRhdGU7bnVsbCA9PT0gYSA/IGMuZmlyc3RCYXNlVXBkYXRlID0gYiA6IGEubmV4dCA9CiAgICAgICAgICAgIGI7Yy5sYXN0QmFzZVVwZGF0ZSA9IGI7fQogICAgICAgICAgZnVuY3Rpb24gZ2goYSwgYiwgYywgZCkge3ZhciBlID0gYS51cGRhdGVRdWV1ZTskZyA9ICExO3ZhciBmID0gZS5maXJzdEJhc2VVcGRhdGUsZyA9IGUubGFzdEJhc2VVcGRhdGUsaCA9IGUuc2hhcmVkLnBlbmRpbmc7aWYgKG51bGwgIT09IGgpIHtlLnNoYXJlZC5wZW5kaW5nID0gbnVsbDt2YXIgayA9IGgsbCA9IGsubmV4dDtrLm5leHQgPSBudWxsO251bGwgPT09IGcgPyBmID0gbCA6IGcubmV4dCA9IGw7ZyA9IGs7dmFyIG0gPSBhLmFsdGVybmF0ZTtudWxsICE9PSBtICYmIChtID0gbS51cGRhdGVRdWV1ZSwgaCA9IG0ubGFzdEJhc2VVcGRhdGUsIGggIT09IGcgJiYgKG51bGwgPT09IGggPyBtLmZpcnN0QmFzZVVwZGF0ZSA9IGwgOiBoLm5leHQgPSBsLCBtLmxhc3RCYXNlVXBkYXRlID0gaykpO31pZiAobnVsbCAhPT0gZikge3ZhciBxID0gZS5iYXNlU3RhdGU7ZyA9IDA7bSA9IGwgPSBrID0gbnVsbDtoID0gZjtkbyB7dmFyIHIgPSBoLmxhbmUseSA9IGguZXZlbnRUaW1lO2lmICgoZCAmIHIpID09PSByKSB7bnVsbCAhPT0gbSAmJiAobSA9IG0ubmV4dCA9IHsgZXZlbnRUaW1lOiB5LCBsYW5lOiAwLCB0YWc6IGgudGFnLCBwYXlsb2FkOiBoLnBheWxvYWQsIGNhbGxiYWNrOiBoLmNhbGxiYWNrLAogICAgICAgICAgICAgICAgICAgIG5leHQ6IG51bGwgfSk7YToge3ZhciBuID0gYSx0ID0gaDtyID0gYjt5ID0gYztzd2l0Y2ggKHQudGFnKSB7Y2FzZSAxOm4gPSB0LnBheWxvYWQ7aWYgKCJmdW5jdGlvbiIgPT09IHR5cGVvZiBuKSB7cSA9IG4uY2FsbCh5LCBxLCByKTticmVhayBhO31xID0gbjticmVhayBhO2Nhc2UgMzpuLmZsYWdzID0gbi5mbGFncyAmIC02NTUzNyB8IDEyODtjYXNlIDA6biA9IHQucGF5bG9hZDtyID0gImZ1bmN0aW9uIiA9PT0gdHlwZW9mIG4gPyBuLmNhbGwoeSwgcSwgcikgOiBuO2lmIChudWxsID09PSByIHx8IHZvaWQgMCA9PT0gcikgYnJlYWsgYTtxID0gQSh7fSwgcSwgcik7YnJlYWsgYTtjYXNlIDI6JGcgPSAhMDt9fW51bGwgIT09IGguY2FsbGJhY2sgJiYgMCAhPT0gaC5sYW5lICYmIChhLmZsYWdzIHw9IDY0LCByID0gZS5lZmZlY3RzLCBudWxsID09PSByID8gZS5lZmZlY3RzID0gW2hdIDogci5wdXNoKGgpKTt9IGVsc2UgeSA9IHsgZXZlbnRUaW1lOiB5LCBsYW5lOiByLCB0YWc6IGgudGFnLCBwYXlsb2FkOiBoLnBheWxvYWQsIGNhbGxiYWNrOiBoLmNhbGxiYWNrLCBuZXh0OiBudWxsIH0sIG51bGwgPT09IG0gPyAobCA9IG0gPSB5LCBrID0gcSkgOiBtID0gbS5uZXh0ID0geSwgZyB8PSByOwogICAgICAgICAgICAgICAgaCA9IGgubmV4dDtpZiAobnVsbCA9PT0gaCkgaWYgKGggPSBlLnNoYXJlZC5wZW5kaW5nLCBudWxsID09PSBoKSBicmVhaztlbHNlIHIgPSBoLCBoID0gci5uZXh0LCByLm5leHQgPSBudWxsLCBlLmxhc3RCYXNlVXBkYXRlID0gciwgZS5zaGFyZWQucGVuZGluZyA9IG51bGw7fSB3aGlsZSAoMSk7bnVsbCA9PT0gbSAmJiAoayA9IHEpO2UuYmFzZVN0YXRlID0gaztlLmZpcnN0QmFzZVVwZGF0ZSA9IGw7ZS5sYXN0QmFzZVVwZGF0ZSA9IG07YiA9IGUuc2hhcmVkLmludGVybGVhdmVkO2lmIChudWxsICE9PSBiKSB7ZSA9IGI7ZG8gZyB8PSBlLmxhbmUsIGUgPSBlLm5leHQ7IHdoaWxlIChlICE9PSBiKTt9IGVsc2UgbnVsbCA9PT0gZiAmJiAoZS5zaGFyZWQubGFuZXMgPSAwKTtoaCB8PSBnO2EubGFuZXMgPSBnO2EubWVtb2l6ZWRTdGF0ZSA9IHE7fX0KICAgICAgICAgIGZ1bmN0aW9uIGloKGEsIGIsIGMpIHthID0gYi5lZmZlY3RzO2IuZWZmZWN0cyA9IG51bGw7aWYgKG51bGwgIT09IGEpIGZvciAoYiA9IDA7IGIgPCBhLmxlbmd0aDsgYisrKSB7dmFyIGQgPSBhW2JdLGUgPSBkLmNhbGxiYWNrO2lmIChudWxsICE9PSBlKSB7ZC5jYWxsYmFjayA9IG51bGw7ZCA9IGM7aWYgKCJmdW5jdGlvbiIgIT09IHR5cGVvZiBlKSB0aHJvdyBFcnJvcihwKDE5MSwgZSkpO2UuY2FsbChkKTt9fX12YXIgamggPSBuZXcgYWEuQ29tcG9uZW50KCkucmVmcztmdW5jdGlvbiBraChhLCBiLCBjLCBkKSB7YiA9IGEubWVtb2l6ZWRTdGF0ZTtjID0gYyhkLCBiKTtjID0gbnVsbCA9PT0gYyB8fCB2b2lkIDAgPT09IGMgPyBiIDogQSh7fSwgYiwgYyk7YS5tZW1vaXplZFN0YXRlID0gYzswID09PSBhLmxhbmVzICYmIChhLnVwZGF0ZVF1ZXVlLmJhc2VTdGF0ZSA9IGMpO30KICAgICAgICAgIHZhciBuaCA9IHsgaXNNb3VudGVkOiBmdW5jdGlvbiBpc01vdW50ZWQoYSkge3JldHVybiAoYSA9IGEuX3JlYWN0SW50ZXJuYWxzKSA/IFZiKGEpID09PSBhIDogITE7fSwgZW5xdWV1ZVNldFN0YXRlOiBmdW5jdGlvbiBlbnF1ZXVlU2V0U3RhdGUoYSwgYiwgYykge2EgPSBhLl9yZWFjdEludGVybmFsczt2YXIgZCA9IEwoKSxlID0gbGgoYSksZiA9IGNoKGQsIGUpO2YucGF5bG9hZCA9IGI7dm9pZCAwICE9PSBjICYmIG51bGwgIT09IGMgJiYgKGYuY2FsbGJhY2sgPSBjKTtiID0gZGgoYSwgZiwgZSk7bnVsbCAhPT0gYiAmJiAobWgoYiwgYSwgZSwgZCksIGVoKGIsIGEsIGUpKTt9LCBlbnF1ZXVlUmVwbGFjZVN0YXRlOiBmdW5jdGlvbiBlbnF1ZXVlUmVwbGFjZVN0YXRlKGEsIGIsIGMpIHthID0gYS5fcmVhY3RJbnRlcm5hbHM7dmFyIGQgPSBMKCksZSA9IGxoKGEpLGYgPSBjaChkLCBlKTtmLnRhZyA9IDE7Zi5wYXlsb2FkID0gYjt2b2lkIDAgIT09IGMgJiYgbnVsbCAhPT0gYyAmJiAoZi5jYWxsYmFjayA9IGMpO2IgPSBkaChhLCBmLCBlKTtudWxsICE9PSBiICYmIChtaChiLCBhLCBlLCBkKSwgZWgoYiwgYSwgZSkpO30sIGVucXVldWVGb3JjZVVwZGF0ZTogZnVuY3Rpb24gZW5xdWV1ZUZvcmNlVXBkYXRlKGEsIGIpIHthID0gYS5fcmVhY3RJbnRlcm5hbHM7dmFyIGMgPSBMKCksZCA9CiAgICAgICAgICAgICAgICBsaChhKSxlID0gY2goYywgZCk7ZS50YWcgPSAyO3ZvaWQgMCAhPT0gYiAmJiBudWxsICE9PSBiICYmIChlLmNhbGxiYWNrID0gYik7YiA9IGRoKGEsIGUsIGQpO251bGwgIT09IGIgJiYgKG1oKGIsIGEsIGQsIGMpLCBlaChiLCBhLCBkKSk7fSB9O2Z1bmN0aW9uIG9oKGEsIGIsIGMsIGQsIGUsIGYsIGcpIHthID0gYS5zdGF0ZU5vZGU7cmV0dXJuICJmdW5jdGlvbiIgPT09IHR5cGVvZiBhLnNob3VsZENvbXBvbmVudFVwZGF0ZSA/IGEuc2hvdWxkQ29tcG9uZW50VXBkYXRlKGQsIGYsIGcpIDogYi5wcm90b3R5cGUgJiYgYi5wcm90b3R5cGUuaXNQdXJlUmVhY3RDb21wb25lbnQgPyAhSWUoYywgZCkgfHwgIUllKGUsIGYpIDogITA7fQogICAgICAgICAgZnVuY3Rpb24gcGgoYSwgYiwgYykge3ZhciBkID0gITEsZSA9IFZmO3ZhciBmID0gYi5jb250ZXh0VHlwZTsib2JqZWN0IiA9PT0gdHlwZW9mIGYgJiYgbnVsbCAhPT0gZiA/IGYgPSBWZyhmKSA6IChlID0gWmYoYikgPyBYZiA6IEguY3VycmVudCwgZCA9IGIuY29udGV4dFR5cGVzLCBmID0gKGQgPSBudWxsICE9PSBkICYmIHZvaWQgMCAhPT0gZCkgPyBZZihhLCBlKSA6IFZmKTtiID0gbmV3IGIoYywgZik7YS5tZW1vaXplZFN0YXRlID0gbnVsbCAhPT0gYi5zdGF0ZSAmJiB2b2lkIDAgIT09IGIuc3RhdGUgPyBiLnN0YXRlIDogbnVsbDtiLnVwZGF0ZXIgPSBuaDthLnN0YXRlTm9kZSA9IGI7Yi5fcmVhY3RJbnRlcm5hbHMgPSBhO2QgJiYgKGEgPSBhLnN0YXRlTm9kZSwgYS5fX3JlYWN0SW50ZXJuYWxNZW1vaXplZFVubWFza2VkQ2hpbGRDb250ZXh0ID0gZSwgYS5fX3JlYWN0SW50ZXJuYWxNZW1vaXplZE1hc2tlZENoaWxkQ29udGV4dCA9IGYpO3JldHVybiBiO30KICAgICAgICAgIGZ1bmN0aW9uIHFoKGEsIGIsIGMsIGQpIHthID0gYi5zdGF0ZTsiZnVuY3Rpb24iID09PSB0eXBlb2YgYi5jb21wb25lbnRXaWxsUmVjZWl2ZVByb3BzICYmIGIuY29tcG9uZW50V2lsbFJlY2VpdmVQcm9wcyhjLCBkKTsiZnVuY3Rpb24iID09PSB0eXBlb2YgYi5VTlNBRkVfY29tcG9uZW50V2lsbFJlY2VpdmVQcm9wcyAmJiBiLlVOU0FGRV9jb21wb25lbnRXaWxsUmVjZWl2ZVByb3BzKGMsIGQpO2Iuc3RhdGUgIT09IGEgJiYgbmguZW5xdWV1ZVJlcGxhY2VTdGF0ZShiLCBiLnN0YXRlLCBudWxsKTt9CiAgICAgICAgICBmdW5jdGlvbiByaChhLCBiLCBjLCBkKSB7dmFyIGUgPSBhLnN0YXRlTm9kZTtlLnByb3BzID0gYztlLnN0YXRlID0gYS5tZW1vaXplZFN0YXRlO2UucmVmcyA9IGpoO2FoKGEpO3ZhciBmID0gYi5jb250ZXh0VHlwZTsib2JqZWN0IiA9PT0gdHlwZW9mIGYgJiYgbnVsbCAhPT0gZiA/IGUuY29udGV4dCA9IFZnKGYpIDogKGYgPSBaZihiKSA/IFhmIDogSC5jdXJyZW50LCBlLmNvbnRleHQgPSBZZihhLCBmKSk7ZS5zdGF0ZSA9IGEubWVtb2l6ZWRTdGF0ZTtmID0gYi5nZXREZXJpdmVkU3RhdGVGcm9tUHJvcHM7ImZ1bmN0aW9uIiA9PT0gdHlwZW9mIGYgJiYgKGtoKGEsIGIsIGYsIGMpLCBlLnN0YXRlID0gYS5tZW1vaXplZFN0YXRlKTsiZnVuY3Rpb24iID09PSB0eXBlb2YgYi5nZXREZXJpdmVkU3RhdGVGcm9tUHJvcHMgfHwgImZ1bmN0aW9uIiA9PT0gdHlwZW9mIGUuZ2V0U25hcHNob3RCZWZvcmVVcGRhdGUgfHwgImZ1bmN0aW9uIiAhPT0gdHlwZW9mIGUuVU5TQUZFX2NvbXBvbmVudFdpbGxNb3VudCAmJiAiZnVuY3Rpb24iICE9PSB0eXBlb2YgZS5jb21wb25lbnRXaWxsTW91bnQgfHwgKGIgPSBlLnN0YXRlLAogICAgICAgICAgICAiZnVuY3Rpb24iID09PSB0eXBlb2YgZS5jb21wb25lbnRXaWxsTW91bnQgJiYgZS5jb21wb25lbnRXaWxsTW91bnQoKSwgImZ1bmN0aW9uIiA9PT0gdHlwZW9mIGUuVU5TQUZFX2NvbXBvbmVudFdpbGxNb3VudCAmJiBlLlVOU0FGRV9jb21wb25lbnRXaWxsTW91bnQoKSwgYiAhPT0gZS5zdGF0ZSAmJiBuaC5lbnF1ZXVlUmVwbGFjZVN0YXRlKGUsIGUuc3RhdGUsIG51bGwpLCBnaChhLCBjLCBlLCBkKSwgZS5zdGF0ZSA9IGEubWVtb2l6ZWRTdGF0ZSk7ImZ1bmN0aW9uIiA9PT0gdHlwZW9mIGUuY29tcG9uZW50RGlkTW91bnQgJiYgKGEuZmxhZ3MgfD0gNDE5NDMwOCk7fQogICAgICAgICAgZnVuY3Rpb24gc2goYSwgYiwgYykge2EgPSBjLnJlZjtpZiAobnVsbCAhPT0gYSAmJiAiZnVuY3Rpb24iICE9PSB0eXBlb2YgYSAmJiAib2JqZWN0IiAhPT0gdHlwZW9mIGEpIHtpZiAoYy5fb3duZXIpIHtjID0gYy5fb3duZXI7aWYgKGMpIHtpZiAoMSAhPT0gYy50YWcpIHRocm93IEVycm9yKHAoMzA5KSk7dmFyIGQgPSBjLnN0YXRlTm9kZTt9aWYgKCFkKSB0aHJvdyBFcnJvcihwKDE0NywgYSkpO3ZhciBlID0gZCxmID0gIiIgKyBhO2lmIChudWxsICE9PSBiICYmIG51bGwgIT09IGIucmVmICYmICJmdW5jdGlvbiIgPT09IHR5cGVvZiBiLnJlZiAmJiBiLnJlZi5fc3RyaW5nUmVmID09PSBmKSByZXR1cm4gYi5yZWY7YiA9IGZ1bmN0aW9uIGIoYSkge3ZhciBiID0gZS5yZWZzO2IgPT09IGpoICYmIChiID0gZS5yZWZzID0ge30pO251bGwgPT09IGEgPyBkZWxldGUgYltmXSA6IGJbZl0gPSBhO307Yi5fc3RyaW5nUmVmID0gZjtyZXR1cm4gYjt9aWYgKCJzdHJpbmciICE9PSB0eXBlb2YgYSkgdGhyb3cgRXJyb3IocCgyODQpKTtpZiAoIWMuX293bmVyKSB0aHJvdyBFcnJvcihwKDI5MCwgYSkpO31yZXR1cm4gYTt9CiAgICAgICAgICBmdW5jdGlvbiB0aChhLCBiKSB7YSA9IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChiKTt0aHJvdyBFcnJvcihwKDMxLCAiW29iamVjdCBPYmplY3RdIiA9PT0gYSA/ICJvYmplY3Qgd2l0aCBrZXlzIHsiICsgT2JqZWN0LmtleXMoYikuam9pbigiLCAiKSArICJ9IiA6IGEpKTt9ZnVuY3Rpb24gdWgoYSkge3ZhciBiID0gYS5faW5pdDtyZXR1cm4gYihhLl9wYXlsb2FkKTt9CiAgICAgICAgICBmdW5jdGlvbiB2aChhKSB7ZnVuY3Rpb24gYihiLCBjKSB7aWYgKGEpIHt2YXIgZCA9IGIuZGVsZXRpb25zO251bGwgPT09IGQgPyAoYi5kZWxldGlvbnMgPSBbY10sIGIuZmxhZ3MgfD0gMTYpIDogZC5wdXNoKGMpO319ZnVuY3Rpb24gYyhjLCBkKSB7aWYgKCFhKSByZXR1cm4gbnVsbDtmb3IgKDsgbnVsbCAhPT0gZDspIGIoYywgZCksIGQgPSBkLnNpYmxpbmc7cmV0dXJuIG51bGw7fWZ1bmN0aW9uIGQoYSwgYikge2ZvciAoYSA9IG5ldyBNYXAoKTsgbnVsbCAhPT0gYjspIG51bGwgIT09IGIua2V5ID8gYS5zZXQoYi5rZXksIGIpIDogYS5zZXQoYi5pbmRleCwgYiksIGIgPSBiLnNpYmxpbmc7cmV0dXJuIGE7fWZ1bmN0aW9uIGUoYSwgYikge2EgPSB3aChhLCBiKTthLmluZGV4ID0gMDthLnNpYmxpbmcgPSBudWxsO3JldHVybiBhO31mdW5jdGlvbiBmKGIsIGMsIGQpIHtiLmluZGV4ID0gZDtpZiAoIWEpIHJldHVybiBiLmZsYWdzIHw9IDEwNDg1NzYsIGM7ZCA9IGIuYWx0ZXJuYXRlO2lmIChudWxsICE9PSBkKSByZXR1cm4gZCA9IGQuaW5kZXgsIGQgPCBjID8gKGIuZmxhZ3MgfD0gMiwgYykgOiBkO2IuZmxhZ3MgfD0gMjtyZXR1cm4gYzt9ZnVuY3Rpb24gZyhiKSB7YSAmJgogICAgICAgICAgICAgIG51bGwgPT09IGIuYWx0ZXJuYXRlICYmIChiLmZsYWdzIHw9IDIpO3JldHVybiBiO31mdW5jdGlvbiBoKGEsIGIsIGMsIGQpIHtpZiAobnVsbCA9PT0gYiB8fCA2ICE9PSBiLnRhZykgcmV0dXJuIGIgPSB4aChjLCBhLm1vZGUsIGQpLCBiLnJldHVybiA9IGEsIGI7YiA9IGUoYiwgYyk7Yi5yZXR1cm4gPSBhO3JldHVybiBiO31mdW5jdGlvbiBrKGEsIGIsIGMsIGQpIHt2YXIgZiA9IGMudHlwZTtpZiAoZiA9PT0geWEpIHJldHVybiBtKGEsIGIsIGMucHJvcHMuY2hpbGRyZW4sIGQsIGMua2V5KTtpZiAobnVsbCAhPT0gYiAmJiAoYi5lbGVtZW50VHlwZSA9PT0gZiB8fCAib2JqZWN0IiA9PT0gdHlwZW9mIGYgJiYgbnVsbCAhPT0gZiAmJiBmLiQkdHlwZW9mID09PSBIYSAmJiB1aChmKSA9PT0gYi50eXBlKSkgcmV0dXJuIGQgPSBlKGIsIGMucHJvcHMpLCBkLnJlZiA9IHNoKGEsIGIsIGMpLCBkLnJldHVybiA9IGEsIGQ7ZCA9IHloKGMudHlwZSwgYy5rZXksIGMucHJvcHMsIG51bGwsIGEubW9kZSwgZCk7ZC5yZWYgPSBzaChhLCBiLCBjKTtkLnJldHVybiA9IGE7cmV0dXJuIGQ7fWZ1bmN0aW9uIGwoYSwgYiwgYywgZCkge2lmIChudWxsID09PSBiIHx8IDQgIT09IGIudGFnIHx8CiAgICAgICAgICAgICAgYi5zdGF0ZU5vZGUuY29udGFpbmVySW5mbyAhPT0gYy5jb250YWluZXJJbmZvIHx8IGIuc3RhdGVOb2RlLmltcGxlbWVudGF0aW9uICE9PSBjLmltcGxlbWVudGF0aW9uKSByZXR1cm4gYiA9IHpoKGMsIGEubW9kZSwgZCksIGIucmV0dXJuID0gYSwgYjtiID0gZShiLCBjLmNoaWxkcmVuIHx8IFtdKTtiLnJldHVybiA9IGE7cmV0dXJuIGI7fWZ1bmN0aW9uIG0oYSwgYiwgYywgZCwgZikge2lmIChudWxsID09PSBiIHx8IDcgIT09IGIudGFnKSByZXR1cm4gYiA9IEFoKGMsIGEubW9kZSwgZCwgZiksIGIucmV0dXJuID0gYSwgYjtiID0gZShiLCBjKTtiLnJldHVybiA9IGE7cmV0dXJuIGI7fWZ1bmN0aW9uIHEoYSwgYiwgYykge2lmICgic3RyaW5nIiA9PT0gdHlwZW9mIGIgJiYgIiIgIT09IGIgfHwgIm51bWJlciIgPT09IHR5cGVvZiBiKSByZXR1cm4gYiA9IHhoKCIiICsgYiwgYS5tb2RlLCBjKSwgYi5yZXR1cm4gPSBhLCBiO2lmICgib2JqZWN0IiA9PT0gdHlwZW9mIGIgJiYgbnVsbCAhPT0gYikge3N3aXRjaCAoYi4kJHR5cGVvZikge2Nhc2UgdmE6cmV0dXJuIGMgPSB5aChiLnR5cGUsIGIua2V5LCBiLnByb3BzLCBudWxsLCBhLm1vZGUsIGMpLAogICAgICAgICAgICAgICAgICAgIGMucmVmID0gc2goYSwgbnVsbCwgYiksIGMucmV0dXJuID0gYSwgYztjYXNlIHdhOnJldHVybiBiID0gemgoYiwgYS5tb2RlLCBjKSwgYi5yZXR1cm4gPSBhLCBiO2Nhc2UgSGE6dmFyIGQgPSBiLl9pbml0O3JldHVybiBxKGEsIGQoYi5fcGF5bG9hZCksIGMpO31pZiAoZWIoYikgfHwgS2EoYikpIHJldHVybiBiID0gQWgoYiwgYS5tb2RlLCBjLCBudWxsKSwgYi5yZXR1cm4gPSBhLCBiO3RoKGEsIGIpO31yZXR1cm4gbnVsbDt9ZnVuY3Rpb24gcihhLCBiLCBjLCBkKSB7dmFyIGUgPSBudWxsICE9PSBiID8gYi5rZXkgOiBudWxsO2lmICgic3RyaW5nIiA9PT0gdHlwZW9mIGMgJiYgIiIgIT09IGMgfHwgIm51bWJlciIgPT09IHR5cGVvZiBjKSByZXR1cm4gbnVsbCAhPT0gZSA/IG51bGwgOiBoKGEsIGIsICIiICsgYywgZCk7aWYgKCJvYmplY3QiID09PSB0eXBlb2YgYyAmJiBudWxsICE9PSBjKSB7c3dpdGNoIChjLiQkdHlwZW9mKSB7Y2FzZSB2YTpyZXR1cm4gYy5rZXkgPT09IGUgPyBrKGEsIGIsIGMsIGQpIDogbnVsbDtjYXNlIHdhOnJldHVybiBjLmtleSA9PT0gZSA/IGwoYSwgYiwgYywgZCkgOiBudWxsO2Nhc2UgSGE6cmV0dXJuIGUgPSBjLl9pbml0LCByKGEsCiAgICAgICAgICAgICAgICAgICAgYiwgZShjLl9wYXlsb2FkKSwgZCk7fWlmIChlYihjKSB8fCBLYShjKSkgcmV0dXJuIG51bGwgIT09IGUgPyBudWxsIDogbShhLCBiLCBjLCBkLCBudWxsKTt0aChhLCBjKTt9cmV0dXJuIG51bGw7fWZ1bmN0aW9uIHkoYSwgYiwgYywgZCwgZSkge2lmICgic3RyaW5nIiA9PT0gdHlwZW9mIGQgJiYgIiIgIT09IGQgfHwgIm51bWJlciIgPT09IHR5cGVvZiBkKSByZXR1cm4gYSA9IGEuZ2V0KGMpIHx8IG51bGwsIGgoYiwgYSwgIiIgKyBkLCBlKTtpZiAoIm9iamVjdCIgPT09IHR5cGVvZiBkICYmIG51bGwgIT09IGQpIHtzd2l0Y2ggKGQuJCR0eXBlb2YpIHtjYXNlIHZhOnJldHVybiBhID0gYS5nZXQobnVsbCA9PT0gZC5rZXkgPyBjIDogZC5rZXkpIHx8IG51bGwsIGsoYiwgYSwgZCwgZSk7Y2FzZSB3YTpyZXR1cm4gYSA9IGEuZ2V0KG51bGwgPT09IGQua2V5ID8gYyA6IGQua2V5KSB8fCBudWxsLCBsKGIsIGEsIGQsIGUpO2Nhc2UgSGE6dmFyIGYgPSBkLl9pbml0O3JldHVybiB5KGEsIGIsIGMsIGYoZC5fcGF5bG9hZCksIGUpO31pZiAoZWIoZCkgfHwgS2EoZCkpIHJldHVybiBhID0gYS5nZXQoYykgfHwgbnVsbCwgbShiLCBhLCBkLCBlLCBudWxsKTt0aChiLCBkKTt9cmV0dXJuIG51bGw7fQogICAgICAgICAgICBmdW5jdGlvbiBuKGUsIGcsIGgsIGspIHtmb3IgKHZhciBsID0gbnVsbCwgbSA9IG51bGwsIHUgPSBnLCB3ID0gZyA9IDAsIHggPSBudWxsOyBudWxsICE9PSB1ICYmIHcgPCBoLmxlbmd0aDsgdysrKSB7dS5pbmRleCA+IHcgPyAoeCA9IHUsIHUgPSBudWxsKSA6IHggPSB1LnNpYmxpbmc7dmFyIG4gPSByKGUsIHUsIGhbd10sIGspO2lmIChudWxsID09PSBuKSB7bnVsbCA9PT0gdSAmJiAodSA9IHgpO2JyZWFrO31hICYmIHUgJiYgbnVsbCA9PT0gbi5hbHRlcm5hdGUgJiYgYihlLCB1KTtnID0gZihuLCBnLCB3KTtudWxsID09PSBtID8gbCA9IG4gOiBtLnNpYmxpbmcgPSBuO20gPSBuO3UgPSB4O31pZiAodyA9PT0gaC5sZW5ndGgpIHJldHVybiBjKGUsIHUpLCBJICYmIHRnKGUsIHcpLCBsO2lmIChudWxsID09PSB1KSB7Zm9yICg7IHcgPCBoLmxlbmd0aDsgdysrKSB1ID0gcShlLCBoW3ddLCBrKSwgbnVsbCAhPT0gdSAmJiAoZyA9IGYodSwgZywgdyksIG51bGwgPT09IG0gPyBsID0gdSA6IG0uc2libGluZyA9IHUsIG0gPSB1KTtJICYmIHRnKGUsIHcpO3JldHVybiBsO31mb3IgKHUgPSBkKGUsIHUpOyB3IDwgaC5sZW5ndGg7IHcrKykgeCA9IHkodSwgZSwgdywgaFt3XSwgayksIG51bGwgIT09IHggJiYgKGEgJiYgbnVsbCAhPT0geC5hbHRlcm5hdGUgJiYgdS5kZWxldGUobnVsbCA9PT0KICAgICAgICAgICAgICB4LmtleSA/IHcgOiB4LmtleSksIGcgPSBmKHgsIGcsIHcpLCBudWxsID09PSBtID8gbCA9IHggOiBtLnNpYmxpbmcgPSB4LCBtID0geCk7YSAmJiB1LmZvckVhY2goZnVuY3Rpb24gKGEpIHtyZXR1cm4gYihlLCBhKTt9KTtJICYmIHRnKGUsIHcpO3JldHVybiBsO31mdW5jdGlvbiB0KGUsIGcsIGgsIGspIHt2YXIgbCA9IEthKGgpO2lmICgiZnVuY3Rpb24iICE9PSB0eXBlb2YgbCkgdGhyb3cgRXJyb3IocCgxNTApKTtoID0gbC5jYWxsKGgpO2lmIChudWxsID09IGgpIHRocm93IEVycm9yKHAoMTUxKSk7Zm9yICh2YXIgdSA9IGwgPSBudWxsLCBtID0gZywgdyA9IGcgPSAwLCB4ID0gbnVsbCwgbiA9IGgubmV4dCgpOyBudWxsICE9PSBtICYmICFuLmRvbmU7IHcrKywgbiA9IGgubmV4dCgpKSB7bS5pbmRleCA+IHcgPyAoeCA9IG0sIG0gPSBudWxsKSA6IHggPSBtLnNpYmxpbmc7dmFyIHQgPSByKGUsIG0sIG4udmFsdWUsIGspO2lmIChudWxsID09PSB0KSB7bnVsbCA9PT0gbSAmJiAobSA9IHgpO2JyZWFrO31hICYmIG0gJiYgbnVsbCA9PT0gdC5hbHRlcm5hdGUgJiYgYihlLCBtKTtnID0gZih0LCBnLCB3KTtudWxsID09PSB1ID8gbCA9IHQgOiB1LnNpYmxpbmcgPSB0O3UgPSB0O20gPSB4O31pZiAobi5kb25lKSByZXR1cm4gYyhlLAogICAgICAgICAgICAgIG0pLCBJICYmIHRnKGUsIHcpLCBsO2lmIChudWxsID09PSBtKSB7Zm9yICg7ICFuLmRvbmU7IHcrKywgbiA9IGgubmV4dCgpKSBuID0gcShlLCBuLnZhbHVlLCBrKSwgbnVsbCAhPT0gbiAmJiAoZyA9IGYobiwgZywgdyksIG51bGwgPT09IHUgPyBsID0gbiA6IHUuc2libGluZyA9IG4sIHUgPSBuKTtJICYmIHRnKGUsIHcpO3JldHVybiBsO31mb3IgKG0gPSBkKGUsIG0pOyAhbi5kb25lOyB3KyssIG4gPSBoLm5leHQoKSkgbiA9IHkobSwgZSwgdywgbi52YWx1ZSwgayksIG51bGwgIT09IG4gJiYgKGEgJiYgbnVsbCAhPT0gbi5hbHRlcm5hdGUgJiYgbS5kZWxldGUobnVsbCA9PT0gbi5rZXkgPyB3IDogbi5rZXkpLCBnID0gZihuLCBnLCB3KSwgbnVsbCA9PT0gdSA/IGwgPSBuIDogdS5zaWJsaW5nID0gbiwgdSA9IG4pO2EgJiYgbS5mb3JFYWNoKGZ1bmN0aW9uIChhKSB7cmV0dXJuIGIoZSwgYSk7fSk7SSAmJiB0ZyhlLCB3KTtyZXR1cm4gbDt9ZnVuY3Rpb24gSihhLCBkLCBmLCBoKSB7Im9iamVjdCIgPT09IHR5cGVvZiBmICYmIG51bGwgIT09IGYgJiYgZi50eXBlID09PSB5YSAmJiBudWxsID09PSBmLmtleSAmJiAoZiA9IGYucHJvcHMuY2hpbGRyZW4pO2lmICgib2JqZWN0IiA9PT0gdHlwZW9mIGYgJiYgbnVsbCAhPT0gZikge3N3aXRjaCAoZi4kJHR5cGVvZikge2Nhc2UgdmE6YToge2ZvciAodmFyIGsgPQogICAgICAgICAgICAgICAgICAgICAgICBmLmtleSwgbCA9IGQ7IG51bGwgIT09IGw7KSB7aWYgKGwua2V5ID09PSBrKSB7ayA9IGYudHlwZTtpZiAoayA9PT0geWEpIHtpZiAoNyA9PT0gbC50YWcpIHtjKGEsIGwuc2libGluZyk7ZCA9IGUobCwgZi5wcm9wcy5jaGlsZHJlbik7ZC5yZXR1cm4gPSBhO2EgPSBkO2JyZWFrIGE7fX0gZWxzZSBpZiAobC5lbGVtZW50VHlwZSA9PT0gayB8fCAib2JqZWN0IiA9PT0gdHlwZW9mIGsgJiYgbnVsbCAhPT0gayAmJiBrLiQkdHlwZW9mID09PSBIYSAmJiB1aChrKSA9PT0gbC50eXBlKSB7YyhhLCBsLnNpYmxpbmcpO2QgPSBlKGwsIGYucHJvcHMpO2QucmVmID0gc2goYSwgbCwgZik7ZC5yZXR1cm4gPSBhO2EgPSBkO2JyZWFrIGE7fWMoYSwgbCk7YnJlYWs7fSBlbHNlIGIoYSwgbCk7bCA9IGwuc2libGluZzt9Zi50eXBlID09PSB5YSA/IChkID0gQWgoZi5wcm9wcy5jaGlsZHJlbiwgYS5tb2RlLCBoLCBmLmtleSksIGQucmV0dXJuID0gYSwgYSA9IGQpIDogKGggPSB5aChmLnR5cGUsIGYua2V5LCBmLnByb3BzLCBudWxsLCBhLm1vZGUsIGgpLCBoLnJlZiA9IHNoKGEsIGQsIGYpLCBoLnJldHVybiA9IGEsIGEgPSBoKTt9cmV0dXJuIGcoYSk7Y2FzZSB3YTphOiB7Zm9yIChsID0gZi5rZXk7IG51bGwgIT09CiAgICAgICAgICAgICAgICAgICAgICBkOykge2lmIChkLmtleSA9PT0gbCkge2lmICg0ID09PSBkLnRhZyAmJiBkLnN0YXRlTm9kZS5jb250YWluZXJJbmZvID09PSBmLmNvbnRhaW5lckluZm8gJiYgZC5zdGF0ZU5vZGUuaW1wbGVtZW50YXRpb24gPT09IGYuaW1wbGVtZW50YXRpb24pIHtjKGEsIGQuc2libGluZyk7ZCA9IGUoZCwgZi5jaGlsZHJlbiB8fCBbXSk7ZC5yZXR1cm4gPSBhO2EgPSBkO2JyZWFrIGE7fSBlbHNlIHtjKGEsIGQpO2JyZWFrO319IGVsc2UgYihhLCBkKTtkID0gZC5zaWJsaW5nO31kID0gemgoZiwgYS5tb2RlLCBoKTtkLnJldHVybiA9IGE7YSA9IGQ7fXJldHVybiBnKGEpO2Nhc2UgSGE6cmV0dXJuIGwgPSBmLl9pbml0LCBKKGEsIGQsIGwoZi5fcGF5bG9hZCksIGgpO31pZiAoZWIoZikpIHJldHVybiBuKGEsIGQsIGYsIGgpO2lmIChLYShmKSkgcmV0dXJuIHQoYSwgZCwgZiwgaCk7dGgoYSwgZik7fXJldHVybiAic3RyaW5nIiA9PT0gdHlwZW9mIGYgJiYgIiIgIT09IGYgfHwgIm51bWJlciIgPT09IHR5cGVvZiBmID8gKGYgPSAiIiArIGYsIG51bGwgIT09IGQgJiYgNiA9PT0gZC50YWcgPyAoYyhhLCBkLnNpYmxpbmcpLCBkID0gZShkLCBmKSwgZC5yZXR1cm4gPSBhLCBhID0gZCkgOiAoCiAgICAgICAgICAgICAgYyhhLCBkKSwgZCA9IHhoKGYsIGEubW9kZSwgaCksIGQucmV0dXJuID0gYSwgYSA9IGQpLCBnKGEpKSA6IGMoYSwgZCk7fXJldHVybiBKO312YXIgQmggPSB2aCghMCksQ2ggPSB2aCghMSksRGggPSB7fSxFaCA9IFVmKERoKSxGaCA9IFVmKERoKSxHaCA9IFVmKERoKTtmdW5jdGlvbiBIaChhKSB7aWYgKGEgPT09IERoKSB0aHJvdyBFcnJvcihwKDE3NCkpO3JldHVybiBhO31mdW5jdGlvbiBJaChhLCBiKSB7RyhHaCwgYik7RyhGaCwgYSk7RyhFaCwgRGgpO2EgPSBiLm5vZGVUeXBlO3N3aXRjaCAoYSkge2Nhc2UgOTpjYXNlIDExOmIgPSAoYiA9IGIuZG9jdW1lbnRFbGVtZW50KSA/IGIubmFtZXNwYWNlVVJJIDogbGIobnVsbCwgIiIpO2JyZWFrO2RlZmF1bHQ6YSA9IDggPT09IGEgPyBiLnBhcmVudE5vZGUgOiBiLCBiID0gYS5uYW1lc3BhY2VVUkkgfHwgbnVsbCwgYSA9IGEudGFnTmFtZSwgYiA9IGxiKGIsIGEpO31FKEVoKTtHKEVoLCBiKTt9ZnVuY3Rpb24gSmgoKSB7RShFaCk7RShGaCk7RShHaCk7fQogICAgICAgICAgZnVuY3Rpb24gS2goYSkge0hoKEdoLmN1cnJlbnQpO3ZhciBiID0gSGgoRWguY3VycmVudCk7dmFyIGMgPSBsYihiLCBhLnR5cGUpO2IgIT09IGMgJiYgKEcoRmgsIGEpLCBHKEVoLCBjKSk7fWZ1bmN0aW9uIExoKGEpIHtGaC5jdXJyZW50ID09PSBhICYmIChFKEVoKSwgRShGaCkpO312YXIgTSA9IFVmKDApOwogICAgICAgICAgZnVuY3Rpb24gTWgoYSkge2ZvciAodmFyIGIgPSBhOyBudWxsICE9PSBiOykge2lmICgxMyA9PT0gYi50YWcpIHt2YXIgYyA9IGIubWVtb2l6ZWRTdGF0ZTtpZiAobnVsbCAhPT0gYyAmJiAoYyA9IGMuZGVoeWRyYXRlZCwgbnVsbCA9PT0gYyB8fCAiJD8iID09PSBjLmRhdGEgfHwgIiQhIiA9PT0gYy5kYXRhKSkgcmV0dXJuIGI7fSBlbHNlIGlmICgxOSA9PT0gYi50YWcgJiYgdm9pZCAwICE9PSBiLm1lbW9pemVkUHJvcHMucmV2ZWFsT3JkZXIpIHtpZiAoMCAhPT0gKGIuZmxhZ3MgJiAxMjgpKSByZXR1cm4gYjt9IGVsc2UgaWYgKG51bGwgIT09IGIuY2hpbGQpIHtiLmNoaWxkLnJldHVybiA9IGI7YiA9IGIuY2hpbGQ7Y29udGludWU7fWlmIChiID09PSBhKSBicmVhaztmb3IgKDsgbnVsbCA9PT0gYi5zaWJsaW5nOykge2lmIChudWxsID09PSBiLnJldHVybiB8fCBiLnJldHVybiA9PT0gYSkgcmV0dXJuIG51bGw7YiA9IGIucmV0dXJuO31iLnNpYmxpbmcucmV0dXJuID0gYi5yZXR1cm47YiA9IGIuc2libGluZzt9cmV0dXJuIG51bGw7fXZhciBOaCA9IFtdOwogICAgICAgICAgZnVuY3Rpb24gT2goKSB7Zm9yICh2YXIgYSA9IDA7IGEgPCBOaC5sZW5ndGg7IGErKykgTmhbYV0uX3dvcmtJblByb2dyZXNzVmVyc2lvblByaW1hcnkgPSBudWxsO05oLmxlbmd0aCA9IDA7fXZhciBQaCA9IHVhLlJlYWN0Q3VycmVudERpc3BhdGNoZXIsUWggPSB1YS5SZWFjdEN1cnJlbnRCYXRjaENvbmZpZyxSaCA9IDAsTiA9IG51bGwsTyA9IG51bGwsUCA9IG51bGwsU2ggPSAhMSxUaCA9ICExLFVoID0gMCxWaCA9IDA7ZnVuY3Rpb24gUSgpIHt0aHJvdyBFcnJvcihwKDMyMSkpO31mdW5jdGlvbiBXaChhLCBiKSB7aWYgKG51bGwgPT09IGIpIHJldHVybiAhMTtmb3IgKHZhciBjID0gMDsgYyA8IGIubGVuZ3RoICYmIGMgPCBhLmxlbmd0aDsgYysrKSBpZiAoIUhlKGFbY10sIGJbY10pKSByZXR1cm4gITE7cmV0dXJuICEwO30KICAgICAgICAgIGZ1bmN0aW9uIFhoKGEsIGIsIGMsIGQsIGUsIGYpIHtSaCA9IGY7TiA9IGI7Yi5tZW1vaXplZFN0YXRlID0gbnVsbDtiLnVwZGF0ZVF1ZXVlID0gbnVsbDtiLmxhbmVzID0gMDtQaC5jdXJyZW50ID0gbnVsbCA9PT0gYSB8fCBudWxsID09PSBhLm1lbW9pemVkU3RhdGUgPyBZaCA6IFpoO2EgPSBjKGQsIGUpO2lmIChUaCkge2YgPSAwO2RvIHtUaCA9ICExO1VoID0gMDtpZiAoMjUgPD0gZikgdGhyb3cgRXJyb3IocCgzMDEpKTtmICs9IDE7UCA9IE8gPSBudWxsO2IudXBkYXRlUXVldWUgPSBudWxsO1BoLmN1cnJlbnQgPSAkaDthID0gYyhkLCBlKTt9IHdoaWxlIChUaCk7fVBoLmN1cnJlbnQgPSBhaTtiID0gbnVsbCAhPT0gTyAmJiBudWxsICE9PSBPLm5leHQ7UmggPSAwO1AgPSBPID0gTiA9IG51bGw7U2ggPSAhMTtpZiAoYikgdGhyb3cgRXJyb3IocCgzMDApKTtyZXR1cm4gYTt9ZnVuY3Rpb24gYmkoKSB7dmFyIGEgPSAwICE9PSBVaDtVaCA9IDA7cmV0dXJuIGE7fQogICAgICAgICAgZnVuY3Rpb24gY2koKSB7dmFyIGEgPSB7IG1lbW9pemVkU3RhdGU6IG51bGwsIGJhc2VTdGF0ZTogbnVsbCwgYmFzZVF1ZXVlOiBudWxsLCBxdWV1ZTogbnVsbCwgbmV4dDogbnVsbCB9O251bGwgPT09IFAgPyBOLm1lbW9pemVkU3RhdGUgPSBQID0gYSA6IFAgPSBQLm5leHQgPSBhO3JldHVybiBQO31mdW5jdGlvbiBkaSgpIHtpZiAobnVsbCA9PT0gTykge3ZhciBhID0gTi5hbHRlcm5hdGU7YSA9IG51bGwgIT09IGEgPyBhLm1lbW9pemVkU3RhdGUgOiBudWxsO30gZWxzZSBhID0gTy5uZXh0O3ZhciBiID0gbnVsbCA9PT0gUCA/IE4ubWVtb2l6ZWRTdGF0ZSA6IFAubmV4dDtpZiAobnVsbCAhPT0gYikgUCA9IGIsIE8gPSBhO2Vsc2Uge2lmIChudWxsID09PSBhKSB0aHJvdyBFcnJvcihwKDMxMCkpO08gPSBhO2EgPSB7IG1lbW9pemVkU3RhdGU6IE8ubWVtb2l6ZWRTdGF0ZSwgYmFzZVN0YXRlOiBPLmJhc2VTdGF0ZSwgYmFzZVF1ZXVlOiBPLmJhc2VRdWV1ZSwgcXVldWU6IE8ucXVldWUsIG5leHQ6IG51bGwgfTtudWxsID09PSBQID8gTi5tZW1vaXplZFN0YXRlID0gUCA9IGEgOiBQID0gUC5uZXh0ID0gYTt9cmV0dXJuIFA7fQogICAgICAgICAgZnVuY3Rpb24gZWkoYSwgYikge3JldHVybiAiZnVuY3Rpb24iID09PSB0eXBlb2YgYiA/IGIoYSkgOiBiO30KICAgICAgICAgIGZ1bmN0aW9uIGZpKGEpIHt2YXIgYiA9IGRpKCksYyA9IGIucXVldWU7aWYgKG51bGwgPT09IGMpIHRocm93IEVycm9yKHAoMzExKSk7Yy5sYXN0UmVuZGVyZWRSZWR1Y2VyID0gYTt2YXIgZCA9IE8sZSA9IGQuYmFzZVF1ZXVlLGYgPSBjLnBlbmRpbmc7aWYgKG51bGwgIT09IGYpIHtpZiAobnVsbCAhPT0gZSkge3ZhciBnID0gZS5uZXh0O2UubmV4dCA9IGYubmV4dDtmLm5leHQgPSBnO31kLmJhc2VRdWV1ZSA9IGUgPSBmO2MucGVuZGluZyA9IG51bGw7fWlmIChudWxsICE9PSBlKSB7ZiA9IGUubmV4dDtkID0gZC5iYXNlU3RhdGU7dmFyIGggPSBnID0gbnVsbCxrID0gbnVsbCxsID0gZjtkbyB7dmFyIG0gPSBsLmxhbmU7aWYgKChSaCAmIG0pID09PSBtKSBudWxsICE9PSBrICYmIChrID0gay5uZXh0ID0geyBsYW5lOiAwLCBhY3Rpb246IGwuYWN0aW9uLCBoYXNFYWdlclN0YXRlOiBsLmhhc0VhZ2VyU3RhdGUsIGVhZ2VyU3RhdGU6IGwuZWFnZXJTdGF0ZSwgbmV4dDogbnVsbCB9KSwgZCA9IGwuaGFzRWFnZXJTdGF0ZSA/IGwuZWFnZXJTdGF0ZSA6IGEoZCwgbC5hY3Rpb24pO2Vsc2Uge3ZhciBxID0geyBsYW5lOiBtLCBhY3Rpb246IGwuYWN0aW9uLCBoYXNFYWdlclN0YXRlOiBsLmhhc0VhZ2VyU3RhdGUsCiAgICAgICAgICAgICAgICAgICAgZWFnZXJTdGF0ZTogbC5lYWdlclN0YXRlLCBuZXh0OiBudWxsIH07bnVsbCA9PT0gayA/IChoID0gayA9IHEsIGcgPSBkKSA6IGsgPSBrLm5leHQgPSBxO04ubGFuZXMgfD0gbTtoaCB8PSBtO31sID0gbC5uZXh0O30gd2hpbGUgKG51bGwgIT09IGwgJiYgbCAhPT0gZik7bnVsbCA9PT0gayA/IGcgPSBkIDogay5uZXh0ID0gaDtIZShkLCBiLm1lbW9pemVkU3RhdGUpIHx8IChVZyA9ICEwKTtiLm1lbW9pemVkU3RhdGUgPSBkO2IuYmFzZVN0YXRlID0gZztiLmJhc2VRdWV1ZSA9IGs7Yy5sYXN0UmVuZGVyZWRTdGF0ZSA9IGQ7fWEgPSBjLmludGVybGVhdmVkO2lmIChudWxsICE9PSBhKSB7ZSA9IGE7ZG8gZiA9IGUubGFuZSwgTi5sYW5lcyB8PSBmLCBoaCB8PSBmLCBlID0gZS5uZXh0OyB3aGlsZSAoZSAhPT0gYSk7fSBlbHNlIG51bGwgPT09IGUgJiYgKGMubGFuZXMgPSAwKTtyZXR1cm4gW2IubWVtb2l6ZWRTdGF0ZSwgYy5kaXNwYXRjaF07fQogICAgICAgICAgZnVuY3Rpb24gZ2koYSkge3ZhciBiID0gZGkoKSxjID0gYi5xdWV1ZTtpZiAobnVsbCA9PT0gYykgdGhyb3cgRXJyb3IocCgzMTEpKTtjLmxhc3RSZW5kZXJlZFJlZHVjZXIgPSBhO3ZhciBkID0gYy5kaXNwYXRjaCxlID0gYy5wZW5kaW5nLGYgPSBiLm1lbW9pemVkU3RhdGU7aWYgKG51bGwgIT09IGUpIHtjLnBlbmRpbmcgPSBudWxsO3ZhciBnID0gZSA9IGUubmV4dDtkbyBmID0gYShmLCBnLmFjdGlvbiksIGcgPSBnLm5leHQ7IHdoaWxlIChnICE9PSBlKTtIZShmLCBiLm1lbW9pemVkU3RhdGUpIHx8IChVZyA9ICEwKTtiLm1lbW9pemVkU3RhdGUgPSBmO251bGwgPT09IGIuYmFzZVF1ZXVlICYmIChiLmJhc2VTdGF0ZSA9IGYpO2MubGFzdFJlbmRlcmVkU3RhdGUgPSBmO31yZXR1cm4gW2YsIGRdO31mdW5jdGlvbiBoaSgpIHt9CiAgICAgICAgICBmdW5jdGlvbiBpaShhLCBiKSB7dmFyIGMgPSBOLGQgPSBkaSgpLGUgPSBiKCksZiA9ICFIZShkLm1lbW9pemVkU3RhdGUsIGUpO2YgJiYgKGQubWVtb2l6ZWRTdGF0ZSA9IGUsIFVnID0gITApO2QgPSBkLnF1ZXVlO2ppKGtpLmJpbmQobnVsbCwgYywgZCwgYSksIFthXSk7aWYgKGQuZ2V0U25hcHNob3QgIT09IGIgfHwgZiB8fCBudWxsICE9PSBQICYmIFAubWVtb2l6ZWRTdGF0ZS50YWcgJiAxKSB7Yy5mbGFncyB8PSAyMDQ4O2xpKDksIG1pLmJpbmQobnVsbCwgYywgZCwgZSwgYiksIHZvaWQgMCwgbnVsbCk7aWYgKG51bGwgPT09IFIpIHRocm93IEVycm9yKHAoMzQ5KSk7MCAhPT0gKFJoICYgMzApIHx8IG5pKGMsIGIsIGUpO31yZXR1cm4gZTt9ZnVuY3Rpb24gbmkoYSwgYiwgYykge2EuZmxhZ3MgfD0gMTYzODQ7YSA9IHsgZ2V0U25hcHNob3Q6IGIsIHZhbHVlOiBjIH07YiA9IE4udXBkYXRlUXVldWU7bnVsbCA9PT0gYiA/IChiID0geyBsYXN0RWZmZWN0OiBudWxsLCBzdG9yZXM6IG51bGwgfSwgTi51cGRhdGVRdWV1ZSA9IGIsIGIuc3RvcmVzID0gW2FdKSA6IChjID0gYi5zdG9yZXMsIG51bGwgPT09IGMgPyBiLnN0b3JlcyA9IFthXSA6IGMucHVzaChhKSk7fQogICAgICAgICAgZnVuY3Rpb24gbWkoYSwgYiwgYywgZCkge2IudmFsdWUgPSBjO2IuZ2V0U25hcHNob3QgPSBkO29pKGIpICYmIHBpKGEpO31mdW5jdGlvbiBraShhLCBiLCBjKSB7cmV0dXJuIGMoZnVuY3Rpb24gKCkge29pKGIpICYmIHBpKGEpO30pO31mdW5jdGlvbiBvaShhKSB7dmFyIGIgPSBhLmdldFNuYXBzaG90O2EgPSBhLnZhbHVlO3RyeSB7dmFyIGMgPSBiKCk7cmV0dXJuICFIZShhLCBjKTt9IGNhdGNoIChkKSB7cmV0dXJuICEwO319ZnVuY3Rpb24gcGkoYSkge3ZhciBiID0gWmcoYSwgMSk7bnVsbCAhPT0gYiAmJiBtaChiLCBhLCAxLCAtMSk7fQogICAgICAgICAgZnVuY3Rpb24gcWkoYSkge3ZhciBiID0gY2koKTsiZnVuY3Rpb24iID09PSB0eXBlb2YgYSAmJiAoYSA9IGEoKSk7Yi5tZW1vaXplZFN0YXRlID0gYi5iYXNlU3RhdGUgPSBhO2EgPSB7IHBlbmRpbmc6IG51bGwsIGludGVybGVhdmVkOiBudWxsLCBsYW5lczogMCwgZGlzcGF0Y2g6IG51bGwsIGxhc3RSZW5kZXJlZFJlZHVjZXI6IGVpLCBsYXN0UmVuZGVyZWRTdGF0ZTogYSB9O2IucXVldWUgPSBhO2EgPSBhLmRpc3BhdGNoID0gcmkuYmluZChudWxsLCBOLCBhKTtyZXR1cm4gW2IubWVtb2l6ZWRTdGF0ZSwgYV07fQogICAgICAgICAgZnVuY3Rpb24gbGkoYSwgYiwgYywgZCkge2EgPSB7IHRhZzogYSwgY3JlYXRlOiBiLCBkZXN0cm95OiBjLCBkZXBzOiBkLCBuZXh0OiBudWxsIH07YiA9IE4udXBkYXRlUXVldWU7bnVsbCA9PT0gYiA/IChiID0geyBsYXN0RWZmZWN0OiBudWxsLCBzdG9yZXM6IG51bGwgfSwgTi51cGRhdGVRdWV1ZSA9IGIsIGIubGFzdEVmZmVjdCA9IGEubmV4dCA9IGEpIDogKGMgPSBiLmxhc3RFZmZlY3QsIG51bGwgPT09IGMgPyBiLmxhc3RFZmZlY3QgPSBhLm5leHQgPSBhIDogKGQgPSBjLm5leHQsIGMubmV4dCA9IGEsIGEubmV4dCA9IGQsIGIubGFzdEVmZmVjdCA9IGEpKTtyZXR1cm4gYTt9ZnVuY3Rpb24gc2koKSB7cmV0dXJuIGRpKCkubWVtb2l6ZWRTdGF0ZTt9ZnVuY3Rpb24gdGkoYSwgYiwgYywgZCkge3ZhciBlID0gY2koKTtOLmZsYWdzIHw9IGE7ZS5tZW1vaXplZFN0YXRlID0gbGkoMSB8IGIsIGMsIHZvaWQgMCwgdm9pZCAwID09PSBkID8gbnVsbCA6IGQpO30KICAgICAgICAgIGZ1bmN0aW9uIHVpKGEsIGIsIGMsIGQpIHt2YXIgZSA9IGRpKCk7ZCA9IHZvaWQgMCA9PT0gZCA/IG51bGwgOiBkO3ZhciBmID0gdm9pZCAwO2lmIChudWxsICE9PSBPKSB7dmFyIGcgPSBPLm1lbW9pemVkU3RhdGU7ZiA9IGcuZGVzdHJveTtpZiAobnVsbCAhPT0gZCAmJiBXaChkLCBnLmRlcHMpKSB7ZS5tZW1vaXplZFN0YXRlID0gbGkoYiwgYywgZiwgZCk7cmV0dXJuO319Ti5mbGFncyB8PSBhO2UubWVtb2l6ZWRTdGF0ZSA9IGxpKDEgfCBiLCBjLCBmLCBkKTt9ZnVuY3Rpb24gdmkoYSwgYikge3JldHVybiB0aSg4MzkwNjU2LCA4LCBhLCBiKTt9ZnVuY3Rpb24gamkoYSwgYikge3JldHVybiB1aSgyMDQ4LCA4LCBhLCBiKTt9ZnVuY3Rpb24gd2koYSwgYikge3JldHVybiB1aSg0LCAyLCBhLCBiKTt9ZnVuY3Rpb24geGkoYSwgYikge3JldHVybiB1aSg0LCA0LCBhLCBiKTt9CiAgICAgICAgICBmdW5jdGlvbiB5aShhLCBiKSB7aWYgKCJmdW5jdGlvbiIgPT09IHR5cGVvZiBiKSByZXR1cm4gYSA9IGEoKSwgYihhKSwgZnVuY3Rpb24gKCkge2IobnVsbCk7fTtpZiAobnVsbCAhPT0gYiAmJiB2b2lkIDAgIT09IGIpIHJldHVybiBhID0gYSgpLCBiLmN1cnJlbnQgPSBhLCBmdW5jdGlvbiAoKSB7Yi5jdXJyZW50ID0gbnVsbDt9O31mdW5jdGlvbiB6aShhLCBiLCBjKSB7YyA9IG51bGwgIT09IGMgJiYgdm9pZCAwICE9PSBjID8gYy5jb25jYXQoW2FdKSA6IG51bGw7cmV0dXJuIHVpKDQsIDQsIHlpLmJpbmQobnVsbCwgYiwgYSksIGMpO31mdW5jdGlvbiBBaSgpIHt9ZnVuY3Rpb24gQmkoYSwgYikge3ZhciBjID0gZGkoKTtiID0gdm9pZCAwID09PSBiID8gbnVsbCA6IGI7dmFyIGQgPSBjLm1lbW9pemVkU3RhdGU7aWYgKG51bGwgIT09IGQgJiYgbnVsbCAhPT0gYiAmJiBXaChiLCBkWzFdKSkgcmV0dXJuIGRbMF07Yy5tZW1vaXplZFN0YXRlID0gW2EsIGJdO3JldHVybiBhO30KICAgICAgICAgIGZ1bmN0aW9uIENpKGEsIGIpIHt2YXIgYyA9IGRpKCk7YiA9IHZvaWQgMCA9PT0gYiA/IG51bGwgOiBiO3ZhciBkID0gYy5tZW1vaXplZFN0YXRlO2lmIChudWxsICE9PSBkICYmIG51bGwgIT09IGIgJiYgV2goYiwgZFsxXSkpIHJldHVybiBkWzBdO2EgPSBhKCk7Yy5tZW1vaXplZFN0YXRlID0gW2EsIGJdO3JldHVybiBhO31mdW5jdGlvbiBEaShhLCBiLCBjKSB7aWYgKDAgPT09IChSaCAmIDIxKSkgcmV0dXJuIGEuYmFzZVN0YXRlICYmIChhLmJhc2VTdGF0ZSA9ICExLCBVZyA9ICEwKSwgYS5tZW1vaXplZFN0YXRlID0gYztIZShjLCBiKSB8fCAoYyA9IHljKCksIE4ubGFuZXMgfD0gYywgaGggfD0gYywgYS5iYXNlU3RhdGUgPSAhMCk7cmV0dXJuIGI7fWZ1bmN0aW9uIEVpKGEsIGIpIHt2YXIgYyA9IEM7QyA9IDAgIT09IGMgJiYgNCA+IGMgPyBjIDogNDthKCEwKTt2YXIgZCA9IFFoLnRyYW5zaXRpb247UWgudHJhbnNpdGlvbiA9IHt9O3RyeSB7YSghMSksIGIoKTt9IGZpbmFsbHkge0MgPSBjLCBRaC50cmFuc2l0aW9uID0gZDt9fWZ1bmN0aW9uIEZpKCkge3JldHVybiBkaSgpLm1lbW9pemVkU3RhdGU7fQogICAgICAgICAgZnVuY3Rpb24gR2koYSwgYiwgYykge3ZhciBkID0gbGgoYSk7YyA9IHsgbGFuZTogZCwgYWN0aW9uOiBjLCBoYXNFYWdlclN0YXRlOiAhMSwgZWFnZXJTdGF0ZTogbnVsbCwgbmV4dDogbnVsbCB9O2lmIChIaShhKSkgSWkoYiwgYyk7ZWxzZSBpZiAoYyA9IFlnKGEsIGIsIGMsIGQpLCBudWxsICE9PSBjKSB7dmFyIGUgPSBMKCk7bWgoYywgYSwgZCwgZSk7SmkoYywgYiwgZCk7fX0KICAgICAgICAgIGZ1bmN0aW9uIHJpKGEsIGIsIGMpIHt2YXIgZCA9IGxoKGEpLGUgPSB7IGxhbmU6IGQsIGFjdGlvbjogYywgaGFzRWFnZXJTdGF0ZTogITEsIGVhZ2VyU3RhdGU6IG51bGwsIG5leHQ6IG51bGwgfTtpZiAoSGkoYSkpIElpKGIsIGUpO2Vsc2Uge3ZhciBmID0gYS5hbHRlcm5hdGU7aWYgKDAgPT09IGEubGFuZXMgJiYgKG51bGwgPT09IGYgfHwgMCA9PT0gZi5sYW5lcykgJiYgKGYgPSBiLmxhc3RSZW5kZXJlZFJlZHVjZXIsIG51bGwgIT09IGYpKSB0cnkge3ZhciBnID0gYi5sYXN0UmVuZGVyZWRTdGF0ZSxoID0gZihnLCBjKTtlLmhhc0VhZ2VyU3RhdGUgPSAhMDtlLmVhZ2VyU3RhdGUgPSBoO2lmIChIZShoLCBnKSkge3ZhciBrID0gYi5pbnRlcmxlYXZlZDtudWxsID09PSBrID8gKGUubmV4dCA9IGUsIFhnKGIpKSA6IChlLm5leHQgPSBrLm5leHQsIGsubmV4dCA9IGUpO2IuaW50ZXJsZWF2ZWQgPSBlO3JldHVybjt9fSBjYXRjaCAobCkge30gZmluYWxseSB7fWMgPSBZZyhhLCBiLCBlLCBkKTtudWxsICE9PSBjICYmIChlID0gTCgpLCBtaChjLCBhLCBkLCBlKSwgSmkoYywgYiwgZCkpO319CiAgICAgICAgICBmdW5jdGlvbiBIaShhKSB7dmFyIGIgPSBhLmFsdGVybmF0ZTtyZXR1cm4gYSA9PT0gTiB8fCBudWxsICE9PSBiICYmIGIgPT09IE47fWZ1bmN0aW9uIElpKGEsIGIpIHtUaCA9IFNoID0gITA7dmFyIGMgPSBhLnBlbmRpbmc7bnVsbCA9PT0gYyA/IGIubmV4dCA9IGIgOiAoYi5uZXh0ID0gYy5uZXh0LCBjLm5leHQgPSBiKTthLnBlbmRpbmcgPSBiO31mdW5jdGlvbiBKaShhLCBiLCBjKSB7aWYgKDAgIT09IChjICYgNDE5NDI0MCkpIHt2YXIgZCA9IGIubGFuZXM7ZCAmPSBhLnBlbmRpbmdMYW5lcztjIHw9IGQ7Yi5sYW5lcyA9IGM7Q2MoYSwgYyk7fX0KICAgICAgICAgIHZhciBhaSA9IHsgcmVhZENvbnRleHQ6IFZnLCB1c2VDYWxsYmFjazogUSwgdXNlQ29udGV4dDogUSwgdXNlRWZmZWN0OiBRLCB1c2VJbXBlcmF0aXZlSGFuZGxlOiBRLCB1c2VJbnNlcnRpb25FZmZlY3Q6IFEsIHVzZUxheW91dEVmZmVjdDogUSwgdXNlTWVtbzogUSwgdXNlUmVkdWNlcjogUSwgdXNlUmVmOiBRLCB1c2VTdGF0ZTogUSwgdXNlRGVidWdWYWx1ZTogUSwgdXNlRGVmZXJyZWRWYWx1ZTogUSwgdXNlVHJhbnNpdGlvbjogUSwgdXNlTXV0YWJsZVNvdXJjZTogUSwgdXNlU3luY0V4dGVybmFsU3RvcmU6IFEsIHVzZUlkOiBRLCB1bnN0YWJsZV9pc05ld1JlY29uY2lsZXI6ICExIH0sWWggPSB7IHJlYWRDb250ZXh0OiBWZywgdXNlQ2FsbGJhY2s6IGZ1bmN0aW9uIHVzZUNhbGxiYWNrKGEsIGIpIHtjaSgpLm1lbW9pemVkU3RhdGUgPSBbYSwgdm9pZCAwID09PSBiID8gbnVsbCA6IGJdO3JldHVybiBhO30sIHVzZUNvbnRleHQ6IFZnLCB1c2VFZmZlY3Q6IHZpLCB1c2VJbXBlcmF0aXZlSGFuZGxlOiBmdW5jdGlvbiB1c2VJbXBlcmF0aXZlSGFuZGxlKGEsIGIsIGMpIHtjID0gbnVsbCAhPT0gYyAmJiB2b2lkIDAgIT09IGMgPyBjLmNvbmNhdChbYV0pIDogbnVsbDtyZXR1cm4gdGkoNDE5NDMwOCwKICAgICAgICAgICAgICAgIDQsIHlpLmJpbmQobnVsbCwgYiwgYSksIGMpO30sIHVzZUxheW91dEVmZmVjdDogZnVuY3Rpb24gdXNlTGF5b3V0RWZmZWN0KGEsIGIpIHtyZXR1cm4gdGkoNDE5NDMwOCwgNCwgYSwgYik7fSwgdXNlSW5zZXJ0aW9uRWZmZWN0OiBmdW5jdGlvbiB1c2VJbnNlcnRpb25FZmZlY3QoYSwgYikge3JldHVybiB0aSg0LCAyLCBhLCBiKTt9LCB1c2VNZW1vOiBmdW5jdGlvbiB1c2VNZW1vKGEsIGIpIHt2YXIgYyA9IGNpKCk7YiA9IHZvaWQgMCA9PT0gYiA/IG51bGwgOiBiO2EgPSBhKCk7Yy5tZW1vaXplZFN0YXRlID0gW2EsIGJdO3JldHVybiBhO30sIHVzZVJlZHVjZXI6IGZ1bmN0aW9uIHVzZVJlZHVjZXIoYSwgYiwgYykge3ZhciBkID0gY2koKTtiID0gdm9pZCAwICE9PSBjID8gYyhiKSA6IGI7ZC5tZW1vaXplZFN0YXRlID0gZC5iYXNlU3RhdGUgPSBiO2EgPSB7IHBlbmRpbmc6IG51bGwsIGludGVybGVhdmVkOiBudWxsLCBsYW5lczogMCwgZGlzcGF0Y2g6IG51bGwsIGxhc3RSZW5kZXJlZFJlZHVjZXI6IGEsIGxhc3RSZW5kZXJlZFN0YXRlOiBiIH07ZC5xdWV1ZSA9IGE7YSA9IGEuZGlzcGF0Y2ggPSBHaS5iaW5kKG51bGwsIE4sIGEpO3JldHVybiBbZC5tZW1vaXplZFN0YXRlLCBhXTt9LCB1c2VSZWY6IGZ1bmN0aW9uIHVzZVJlZihhKSB7dmFyIGIgPQogICAgICAgICAgICAgICAgY2koKTthID0geyBjdXJyZW50OiBhIH07cmV0dXJuIGIubWVtb2l6ZWRTdGF0ZSA9IGE7fSwgdXNlU3RhdGU6IHFpLCB1c2VEZWJ1Z1ZhbHVlOiBBaSwgdXNlRGVmZXJyZWRWYWx1ZTogZnVuY3Rpb24gdXNlRGVmZXJyZWRWYWx1ZShhKSB7cmV0dXJuIGNpKCkubWVtb2l6ZWRTdGF0ZSA9IGE7fSwgdXNlVHJhbnNpdGlvbjogZnVuY3Rpb24gdXNlVHJhbnNpdGlvbigpIHt2YXIgYSA9IHFpKCExKSxiID0gYVswXTthID0gRWkuYmluZChudWxsLCBhWzFdKTtjaSgpLm1lbW9pemVkU3RhdGUgPSBhO3JldHVybiBbYiwgYV07fSwgdXNlTXV0YWJsZVNvdXJjZTogZnVuY3Rpb24gdXNlTXV0YWJsZVNvdXJjZSgpIHt9LCB1c2VTeW5jRXh0ZXJuYWxTdG9yZTogZnVuY3Rpb24gdXNlU3luY0V4dGVybmFsU3RvcmUoYSwgYiwgYykge3ZhciBkID0gTixlID0gY2koKTtpZiAoSSkge2lmICh2b2lkIDAgPT09IGMpIHRocm93IEVycm9yKHAoNDA3KSk7YyA9IGMoKTt9IGVsc2Uge2MgPSBiKCk7aWYgKG51bGwgPT09IFIpIHRocm93IEVycm9yKHAoMzQ5KSk7MCAhPT0gKFJoICYgMzApIHx8IG5pKGQsIGIsIGMpO31lLm1lbW9pemVkU3RhdGUgPSBjO3ZhciBmID0geyB2YWx1ZTogYywgZ2V0U25hcHNob3Q6IGIgfTtlLnF1ZXVlID0gZjt2aShraS5iaW5kKG51bGwsIGQsCiAgICAgICAgICAgICAgICBmLCBhKSwgW2FdKTtkLmZsYWdzIHw9IDIwNDg7bGkoOSwgbWkuYmluZChudWxsLCBkLCBmLCBjLCBiKSwgdm9pZCAwLCBudWxsKTtyZXR1cm4gYzt9LCB1c2VJZDogZnVuY3Rpb24gdXNlSWQoKSB7dmFyIGEgPSBjaSgpLGIgPSBSLmlkZW50aWZpZXJQcmVmaXg7aWYgKEkpIHt2YXIgYyA9IHNnO3ZhciBkID0gcmc7YyA9IChkICYgfigxIDw8IDMyIC0gb2MoZCkgLSAxKSkudG9TdHJpbmcoMzIpICsgYztiID0gIjoiICsgYiArICJSIiArIGM7YyA9IFVoKys7MCA8IGMgJiYgKGIgKz0gIkgiICsgYy50b1N0cmluZygzMikpO2IgKz0gIjoiO30gZWxzZSBjID0gVmgrKywgYiA9ICI6IiArIGIgKyAiciIgKyBjLnRvU3RyaW5nKDMyKSArICI6IjtyZXR1cm4gYS5tZW1vaXplZFN0YXRlID0gYjt9LCB1bnN0YWJsZV9pc05ld1JlY29uY2lsZXI6ICExIH0sWmggPSB7IHJlYWRDb250ZXh0OiBWZywgdXNlQ2FsbGJhY2s6IEJpLCB1c2VDb250ZXh0OiBWZywgdXNlRWZmZWN0OiBqaSwgdXNlSW1wZXJhdGl2ZUhhbmRsZTogemksIHVzZUluc2VydGlvbkVmZmVjdDogd2ksIHVzZUxheW91dEVmZmVjdDogeGksIHVzZU1lbW86IENpLCB1c2VSZWR1Y2VyOiBmaSwgdXNlUmVmOiBzaSwgdXNlU3RhdGU6IGZ1bmN0aW9uIHVzZVN0YXRlKCkge3JldHVybiBmaShlaSk7fSwKICAgICAgICAgICAgICB1c2VEZWJ1Z1ZhbHVlOiBBaSwgdXNlRGVmZXJyZWRWYWx1ZTogZnVuY3Rpb24gdXNlRGVmZXJyZWRWYWx1ZShhKSB7dmFyIGIgPSBkaSgpO3JldHVybiBEaShiLCBPLm1lbW9pemVkU3RhdGUsIGEpO30sIHVzZVRyYW5zaXRpb246IGZ1bmN0aW9uIHVzZVRyYW5zaXRpb24oKSB7dmFyIGEgPSBmaShlaSlbMF0sYiA9IGRpKCkubWVtb2l6ZWRTdGF0ZTtyZXR1cm4gW2EsIGJdO30sIHVzZU11dGFibGVTb3VyY2U6IGhpLCB1c2VTeW5jRXh0ZXJuYWxTdG9yZTogaWksIHVzZUlkOiBGaSwgdW5zdGFibGVfaXNOZXdSZWNvbmNpbGVyOiAhMSB9LCRoID0geyByZWFkQ29udGV4dDogVmcsIHVzZUNhbGxiYWNrOiBCaSwgdXNlQ29udGV4dDogVmcsIHVzZUVmZmVjdDogamksIHVzZUltcGVyYXRpdmVIYW5kbGU6IHppLCB1c2VJbnNlcnRpb25FZmZlY3Q6IHdpLCB1c2VMYXlvdXRFZmZlY3Q6IHhpLCB1c2VNZW1vOiBDaSwgdXNlUmVkdWNlcjogZ2ksIHVzZVJlZjogc2ksIHVzZVN0YXRlOiBmdW5jdGlvbiB1c2VTdGF0ZSgpIHtyZXR1cm4gZ2koZWkpO30sIHVzZURlYnVnVmFsdWU6IEFpLCB1c2VEZWZlcnJlZFZhbHVlOiBmdW5jdGlvbiB1c2VEZWZlcnJlZFZhbHVlKGEpIHt2YXIgYiA9IGRpKCk7cmV0dXJuIG51bGwgPT09CiAgICAgICAgICAgICAgICBPID8gYi5tZW1vaXplZFN0YXRlID0gYSA6IERpKGIsIE8ubWVtb2l6ZWRTdGF0ZSwgYSk7fSwgdXNlVHJhbnNpdGlvbjogZnVuY3Rpb24gdXNlVHJhbnNpdGlvbigpIHt2YXIgYSA9IGdpKGVpKVswXSxiID0gZGkoKS5tZW1vaXplZFN0YXRlO3JldHVybiBbYSwgYl07fSwgdXNlTXV0YWJsZVNvdXJjZTogaGksIHVzZVN5bmNFeHRlcm5hbFN0b3JlOiBpaSwgdXNlSWQ6IEZpLCB1bnN0YWJsZV9pc05ld1JlY29uY2lsZXI6ICExIH07ZnVuY3Rpb24gS2koYSwgYikge3RyeSB7dmFyIGMgPSAiIixkID0gYjtkbyBjICs9IFBhKGQpLCBkID0gZC5yZXR1cm47IHdoaWxlIChkKTt2YXIgZSA9IGM7fSBjYXRjaCAoZikge2UgPSAiXG5FcnJvciBnZW5lcmF0aW5nIHN0YWNrOiAiICsgZi5tZXNzYWdlICsgIlxuIiArIGYuc3RhY2s7fXJldHVybiB7IHZhbHVlOiBhLCBzb3VyY2U6IGIsIHN0YWNrOiBlLCBkaWdlc3Q6IG51bGwgfTt9ZnVuY3Rpb24gTGkoYSwgYiwgYykge3JldHVybiB7IHZhbHVlOiBhLCBzb3VyY2U6IG51bGwsIHN0YWNrOiBudWxsICE9IGMgPyBjIDogbnVsbCwgZGlnZXN0OiBudWxsICE9IGIgPyBiIDogbnVsbCB9O30KICAgICAgICAgIGZ1bmN0aW9uIE1pKGEsIGIpIHt0cnkge2NvbnNvbGUuZXJyb3IoYi52YWx1ZSk7fSBjYXRjaCAoYykge3NldFRpbWVvdXQoZnVuY3Rpb24gKCkge3Rocm93IGM7fSk7fX12YXIgTmkgPSAiZnVuY3Rpb24iID09PSB0eXBlb2YgV2Vha01hcCA/IFdlYWtNYXAgOiBNYXA7ZnVuY3Rpb24gT2koYSwgYiwgYykge2MgPSBjaCgtMSwgYyk7Yy50YWcgPSAzO2MucGF5bG9hZCA9IHsgZWxlbWVudDogbnVsbCB9O3ZhciBkID0gYi52YWx1ZTtjLmNhbGxiYWNrID0gZnVuY3Rpb24gKCkge1BpIHx8IChQaSA9ICEwLCBRaSA9IGQpO01pKGEsIGIpO307cmV0dXJuIGM7fQogICAgICAgICAgZnVuY3Rpb24gUmkoYSwgYiwgYykge2MgPSBjaCgtMSwgYyk7Yy50YWcgPSAzO3ZhciBkID0gYS50eXBlLmdldERlcml2ZWRTdGF0ZUZyb21FcnJvcjtpZiAoImZ1bmN0aW9uIiA9PT0gdHlwZW9mIGQpIHt2YXIgZSA9IGIudmFsdWU7Yy5wYXlsb2FkID0gZnVuY3Rpb24gKCkge3JldHVybiBkKGUpO307Yy5jYWxsYmFjayA9IGZ1bmN0aW9uICgpIHtNaShhLCBiKTt9O312YXIgZiA9IGEuc3RhdGVOb2RlO251bGwgIT09IGYgJiYgImZ1bmN0aW9uIiA9PT0gdHlwZW9mIGYuY29tcG9uZW50RGlkQ2F0Y2ggJiYgKGMuY2FsbGJhY2sgPSBmdW5jdGlvbiAoKSB7TWkoYSwgYik7ImZ1bmN0aW9uIiAhPT0gdHlwZW9mIGQgJiYgKG51bGwgPT09IFNpID8gU2kgPSBuZXcgU2V0KFt0aGlzXSkgOiBTaS5hZGQodGhpcykpO3ZhciBjID0gYi5zdGFjazt0aGlzLmNvbXBvbmVudERpZENhdGNoKGIudmFsdWUsIHsgY29tcG9uZW50U3RhY2s6IG51bGwgIT09IGMgPyBjIDogIiIgfSk7fSk7cmV0dXJuIGM7fQogICAgICAgICAgZnVuY3Rpb24gVGkoYSwgYiwgYykge3ZhciBkID0gYS5waW5nQ2FjaGU7aWYgKG51bGwgPT09IGQpIHtkID0gYS5waW5nQ2FjaGUgPSBuZXcgTmkoKTt2YXIgZSA9IG5ldyBTZXQoKTtkLnNldChiLCBlKTt9IGVsc2UgZSA9IGQuZ2V0KGIpLCB2b2lkIDAgPT09IGUgJiYgKGUgPSBuZXcgU2V0KCksIGQuc2V0KGIsIGUpKTtlLmhhcyhjKSB8fCAoZS5hZGQoYyksIGEgPSBVaS5iaW5kKG51bGwsIGEsIGIsIGMpLCBiLnRoZW4oYSwgYSkpO31mdW5jdGlvbiBWaShhKSB7ZG8ge3ZhciBiO2lmIChiID0gMTMgPT09IGEudGFnKSBiID0gYS5tZW1vaXplZFN0YXRlLCBiID0gbnVsbCAhPT0gYiA/IG51bGwgIT09IGIuZGVoeWRyYXRlZCA/ICEwIDogITEgOiAhMDtpZiAoYikgcmV0dXJuIGE7YSA9IGEucmV0dXJuO30gd2hpbGUgKG51bGwgIT09IGEpO3JldHVybiBudWxsO30KICAgICAgICAgIGZ1bmN0aW9uIFdpKGEsIGIsIGMsIGQsIGUpIHtpZiAoMCA9PT0gKGEubW9kZSAmIDEpKSByZXR1cm4gYSA9PT0gYiA/IGEuZmxhZ3MgfD0gNjU1MzYgOiAoYS5mbGFncyB8PSAxMjgsIGMuZmxhZ3MgfD0gMTMxMDcyLCBjLmZsYWdzICY9IC01MjgwNSwgMSA9PT0gYy50YWcgJiYgKG51bGwgPT09IGMuYWx0ZXJuYXRlID8gYy50YWcgPSAxNyA6IChiID0gY2goLTEsIDEpLCBiLnRhZyA9IDIsIGRoKGMsIGIsIDEpKSksIGMubGFuZXMgfD0gMSksIGE7YS5mbGFncyB8PSA2NTUzNjthLmxhbmVzID0gZTtyZXR1cm4gYTt9dmFyIFhpID0gdWEuUmVhY3RDdXJyZW50T3duZXIsVWcgPSAhMTtmdW5jdGlvbiBZaShhLCBiLCBjLCBkKSB7Yi5jaGlsZCA9IG51bGwgPT09IGEgPyBDaChiLCBudWxsLCBjLCBkKSA6IEJoKGIsIGEuY2hpbGQsIGMsIGQpO30KICAgICAgICAgIGZ1bmN0aW9uIFppKGEsIGIsIGMsIGQsIGUpIHtjID0gYy5yZW5kZXI7dmFyIGYgPSBiLnJlZjtUZyhiLCBlKTtkID0gWGgoYSwgYiwgYywgZCwgZiwgZSk7YyA9IGJpKCk7aWYgKG51bGwgIT09IGEgJiYgIVVnKSByZXR1cm4gYi51cGRhdGVRdWV1ZSA9IGEudXBkYXRlUXVldWUsIGIuZmxhZ3MgJj0gLTIwNTMsIGEubGFuZXMgJj0gfmUsICRpKGEsIGIsIGUpO0kgJiYgYyAmJiB2ZyhiKTtiLmZsYWdzIHw9IDE7WWkoYSwgYiwgZCwgZSk7cmV0dXJuIGIuY2hpbGQ7fQogICAgICAgICAgZnVuY3Rpb24gYWooYSwgYiwgYywgZCwgZSkge2lmIChudWxsID09PSBhKSB7dmFyIGYgPSBjLnR5cGU7aWYgKCJmdW5jdGlvbiIgPT09IHR5cGVvZiBmICYmICFiaihmKSAmJiB2b2lkIDAgPT09IGYuZGVmYXVsdFByb3BzICYmIG51bGwgPT09IGMuY29tcGFyZSAmJiB2b2lkIDAgPT09IGMuZGVmYXVsdFByb3BzKSByZXR1cm4gYi50YWcgPSAxNSwgYi50eXBlID0gZiwgY2ooYSwgYiwgZiwgZCwgZSk7YSA9IHloKGMudHlwZSwgbnVsbCwgZCwgYiwgYi5tb2RlLCBlKTthLnJlZiA9IGIucmVmO2EucmV0dXJuID0gYjtyZXR1cm4gYi5jaGlsZCA9IGE7fWYgPSBhLmNoaWxkO2lmICgwID09PSAoYS5sYW5lcyAmIGUpKSB7dmFyIGcgPSBmLm1lbW9pemVkUHJvcHM7YyA9IGMuY29tcGFyZTtjID0gbnVsbCAhPT0gYyA/IGMgOiBJZTtpZiAoYyhnLCBkKSAmJiBhLnJlZiA9PT0gYi5yZWYpIHJldHVybiAkaShhLCBiLCBlKTt9Yi5mbGFncyB8PSAxO2EgPSB3aChmLCBkKTthLnJlZiA9IGIucmVmO2EucmV0dXJuID0gYjtyZXR1cm4gYi5jaGlsZCA9IGE7fQogICAgICAgICAgZnVuY3Rpb24gY2ooYSwgYiwgYywgZCwgZSkge2lmIChudWxsICE9PSBhKSB7dmFyIGYgPSBhLm1lbW9pemVkUHJvcHM7aWYgKEllKGYsIGQpICYmIGEucmVmID09PSBiLnJlZikgaWYgKFVnID0gITEsIGIucGVuZGluZ1Byb3BzID0gZCA9IGYsIDAgIT09IChhLmxhbmVzICYgZSkpIDAgIT09IChhLmZsYWdzICYgMTMxMDcyKSAmJiAoVWcgPSAhMCk7ZWxzZSByZXR1cm4gYi5sYW5lcyA9IGEubGFuZXMsICRpKGEsIGIsIGUpO31yZXR1cm4gZGooYSwgYiwgYywgZCwgZSk7fQogICAgICAgICAgZnVuY3Rpb24gZWooYSwgYiwgYykge3ZhciBkID0gYi5wZW5kaW5nUHJvcHMsZSA9IGQuY2hpbGRyZW4sZiA9IG51bGwgIT09IGEgPyBhLm1lbW9pemVkU3RhdGUgOiBudWxsO2lmICgiaGlkZGVuIiA9PT0gZC5tb2RlKSB7aWYgKDAgPT09IChiLm1vZGUgJiAxKSkgYi5tZW1vaXplZFN0YXRlID0geyBiYXNlTGFuZXM6IDAsIGNhY2hlUG9vbDogbnVsbCwgdHJhbnNpdGlvbnM6IG51bGwgfSwgRyhmaiwgZ2opLCBnaiB8PSBjO2Vsc2Uge2lmICgwID09PSAoYyAmIDEwNzM3NDE4MjQpKSByZXR1cm4gYSA9IG51bGwgIT09IGYgPyBmLmJhc2VMYW5lcyB8IGMgOiBjLCBiLmxhbmVzID0gYi5jaGlsZExhbmVzID0gMTA3Mzc0MTgyNCwgYi5tZW1vaXplZFN0YXRlID0geyBiYXNlTGFuZXM6IGEsIGNhY2hlUG9vbDogbnVsbCwgdHJhbnNpdGlvbnM6IG51bGwgfSwgYi51cGRhdGVRdWV1ZSA9IG51bGwsIEcoZmosIGdqKSwgZ2ogfD0gYSwgbnVsbDtiLm1lbW9pemVkU3RhdGUgPSB7IGJhc2VMYW5lczogMCwgY2FjaGVQb29sOiBudWxsLCB0cmFuc2l0aW9uczogbnVsbCB9O2QgPSBudWxsICE9PSBmID8gZi5iYXNlTGFuZXMgOiBjO0coZmosIGdqKTtnaiB8PSBkO319IGVsc2UgbnVsbCAhPT0KICAgICAgICAgICAgZiA/IChkID0gZi5iYXNlTGFuZXMgfCBjLCBiLm1lbW9pemVkU3RhdGUgPSBudWxsKSA6IGQgPSBjLCBHKGZqLCBnaiksIGdqIHw9IGQ7WWkoYSwgYiwgZSwgYyk7cmV0dXJuIGIuY2hpbGQ7fWZ1bmN0aW9uIGhqKGEsIGIpIHt2YXIgYyA9IGIucmVmO2lmIChudWxsID09PSBhICYmIG51bGwgIT09IGMgfHwgbnVsbCAhPT0gYSAmJiBhLnJlZiAhPT0gYykgYi5mbGFncyB8PSA1MTIsIGIuZmxhZ3MgfD0gMjA5NzE1Mjt9ZnVuY3Rpb24gZGooYSwgYiwgYywgZCwgZSkge3ZhciBmID0gWmYoYykgPyBYZiA6IEguY3VycmVudDtmID0gWWYoYiwgZik7VGcoYiwgZSk7YyA9IFhoKGEsIGIsIGMsIGQsIGYsIGUpO2QgPSBiaSgpO2lmIChudWxsICE9PSBhICYmICFVZykgcmV0dXJuIGIudXBkYXRlUXVldWUgPSBhLnVwZGF0ZVF1ZXVlLCBiLmZsYWdzICY9IC0yMDUzLCBhLmxhbmVzICY9IH5lLCAkaShhLCBiLCBlKTtJICYmIGQgJiYgdmcoYik7Yi5mbGFncyB8PSAxO1lpKGEsIGIsIGMsIGUpO3JldHVybiBiLmNoaWxkO30KICAgICAgICAgIGZ1bmN0aW9uIGlqKGEsIGIsIGMsIGQsIGUpIHtpZiAoWmYoYykpIHt2YXIgZiA9ICEwO2NnKGIpO30gZWxzZSBmID0gITE7VGcoYiwgZSk7aWYgKG51bGwgPT09IGIuc3RhdGVOb2RlKSBqaihhLCBiKSwgcGgoYiwgYywgZCksIHJoKGIsIGMsIGQsIGUpLCBkID0gITA7ZWxzZSBpZiAobnVsbCA9PT0gYSkge3ZhciBnID0gYi5zdGF0ZU5vZGUsaCA9IGIubWVtb2l6ZWRQcm9wcztnLnByb3BzID0gaDt2YXIgayA9IGcuY29udGV4dCxsID0gYy5jb250ZXh0VHlwZTsib2JqZWN0IiA9PT0gdHlwZW9mIGwgJiYgbnVsbCAhPT0gbCA/IGwgPSBWZyhsKSA6IChsID0gWmYoYykgPyBYZiA6IEguY3VycmVudCwgbCA9IFlmKGIsIGwpKTt2YXIgbSA9IGMuZ2V0RGVyaXZlZFN0YXRlRnJvbVByb3BzLHEgPSAiZnVuY3Rpb24iID09PSB0eXBlb2YgbSB8fCAiZnVuY3Rpb24iID09PSB0eXBlb2YgZy5nZXRTbmFwc2hvdEJlZm9yZVVwZGF0ZTtxIHx8ICJmdW5jdGlvbiIgIT09IHR5cGVvZiBnLlVOU0FGRV9jb21wb25lbnRXaWxsUmVjZWl2ZVByb3BzICYmICJmdW5jdGlvbiIgIT09IHR5cGVvZiBnLmNvbXBvbmVudFdpbGxSZWNlaXZlUHJvcHMgfHwKICAgICAgICAgICAgICAoaCAhPT0gZCB8fCBrICE9PSBsKSAmJiBxaChiLCBnLCBkLCBsKTskZyA9ICExO3ZhciByID0gYi5tZW1vaXplZFN0YXRlO2cuc3RhdGUgPSByO2doKGIsIGQsIGcsIGUpO2sgPSBiLm1lbW9pemVkU3RhdGU7aCAhPT0gZCB8fCByICE9PSBrIHx8IFdmLmN1cnJlbnQgfHwgJGcgPyAoImZ1bmN0aW9uIiA9PT0gdHlwZW9mIG0gJiYgKGtoKGIsIGMsIG0sIGQpLCBrID0gYi5tZW1vaXplZFN0YXRlKSwgKGggPSAkZyB8fCBvaChiLCBjLCBoLCBkLCByLCBrLCBsKSkgPyAocSB8fCAiZnVuY3Rpb24iICE9PSB0eXBlb2YgZy5VTlNBRkVfY29tcG9uZW50V2lsbE1vdW50ICYmICJmdW5jdGlvbiIgIT09IHR5cGVvZiBnLmNvbXBvbmVudFdpbGxNb3VudCB8fCAoImZ1bmN0aW9uIiA9PT0gdHlwZW9mIGcuY29tcG9uZW50V2lsbE1vdW50ICYmIGcuY29tcG9uZW50V2lsbE1vdW50KCksICJmdW5jdGlvbiIgPT09IHR5cGVvZiBnLlVOU0FGRV9jb21wb25lbnRXaWxsTW91bnQgJiYgZy5VTlNBRkVfY29tcG9uZW50V2lsbE1vdW50KCkpLCAiZnVuY3Rpb24iID09PSB0eXBlb2YgZy5jb21wb25lbnREaWRNb3VudCAmJiAoYi5mbGFncyB8PSA0MTk0MzA4KSkgOiAoCiAgICAgICAgICAgICAgImZ1bmN0aW9uIiA9PT0gdHlwZW9mIGcuY29tcG9uZW50RGlkTW91bnQgJiYgKGIuZmxhZ3MgfD0gNDE5NDMwOCksIGIubWVtb2l6ZWRQcm9wcyA9IGQsIGIubWVtb2l6ZWRTdGF0ZSA9IGspLCBnLnByb3BzID0gZCwgZy5zdGF0ZSA9IGssIGcuY29udGV4dCA9IGwsIGQgPSBoKSA6ICgiZnVuY3Rpb24iID09PSB0eXBlb2YgZy5jb21wb25lbnREaWRNb3VudCAmJiAoYi5mbGFncyB8PSA0MTk0MzA4KSwgZCA9ICExKTt9IGVsc2Uge2cgPSBiLnN0YXRlTm9kZTtiaChhLCBiKTtoID0gYi5tZW1vaXplZFByb3BzO2wgPSBiLnR5cGUgPT09IGIuZWxlbWVudFR5cGUgPyBoIDogTGcoYi50eXBlLCBoKTtnLnByb3BzID0gbDtxID0gYi5wZW5kaW5nUHJvcHM7ciA9IGcuY29udGV4dDtrID0gYy5jb250ZXh0VHlwZTsib2JqZWN0IiA9PT0gdHlwZW9mIGsgJiYgbnVsbCAhPT0gayA/IGsgPSBWZyhrKSA6IChrID0gWmYoYykgPyBYZiA6IEguY3VycmVudCwgayA9IFlmKGIsIGspKTt2YXIgeSA9IGMuZ2V0RGVyaXZlZFN0YXRlRnJvbVByb3BzOyhtID0gImZ1bmN0aW9uIiA9PT0gdHlwZW9mIHkgfHwgImZ1bmN0aW9uIiA9PT0gdHlwZW9mIGcuZ2V0U25hcHNob3RCZWZvcmVVcGRhdGUpIHx8CiAgICAgICAgICAgICAgImZ1bmN0aW9uIiAhPT0gdHlwZW9mIGcuVU5TQUZFX2NvbXBvbmVudFdpbGxSZWNlaXZlUHJvcHMgJiYgImZ1bmN0aW9uIiAhPT0gdHlwZW9mIGcuY29tcG9uZW50V2lsbFJlY2VpdmVQcm9wcyB8fCAoaCAhPT0gcSB8fCByICE9PSBrKSAmJiBxaChiLCBnLCBkLCBrKTskZyA9ICExO3IgPSBiLm1lbW9pemVkU3RhdGU7Zy5zdGF0ZSA9IHI7Z2goYiwgZCwgZywgZSk7dmFyIG4gPSBiLm1lbW9pemVkU3RhdGU7aCAhPT0gcSB8fCByICE9PSBuIHx8IFdmLmN1cnJlbnQgfHwgJGcgPyAoImZ1bmN0aW9uIiA9PT0gdHlwZW9mIHkgJiYgKGtoKGIsIGMsIHksIGQpLCBuID0gYi5tZW1vaXplZFN0YXRlKSwgKGwgPSAkZyB8fCBvaChiLCBjLCBsLCBkLCByLCBuLCBrKSB8fCAhMSkgPyAobSB8fCAiZnVuY3Rpb24iICE9PSB0eXBlb2YgZy5VTlNBRkVfY29tcG9uZW50V2lsbFVwZGF0ZSAmJiAiZnVuY3Rpb24iICE9PSB0eXBlb2YgZy5jb21wb25lbnRXaWxsVXBkYXRlIHx8ICgiZnVuY3Rpb24iID09PSB0eXBlb2YgZy5jb21wb25lbnRXaWxsVXBkYXRlICYmIGcuY29tcG9uZW50V2lsbFVwZGF0ZShkLCBuLCBrKSwgImZ1bmN0aW9uIiA9PT0gdHlwZW9mIGcuVU5TQUZFX2NvbXBvbmVudFdpbGxVcGRhdGUgJiYKICAgICAgICAgICAgICBnLlVOU0FGRV9jb21wb25lbnRXaWxsVXBkYXRlKGQsIG4sIGspKSwgImZ1bmN0aW9uIiA9PT0gdHlwZW9mIGcuY29tcG9uZW50RGlkVXBkYXRlICYmIChiLmZsYWdzIHw9IDQpLCAiZnVuY3Rpb24iID09PSB0eXBlb2YgZy5nZXRTbmFwc2hvdEJlZm9yZVVwZGF0ZSAmJiAoYi5mbGFncyB8PSAxMDI0KSkgOiAoImZ1bmN0aW9uIiAhPT0gdHlwZW9mIGcuY29tcG9uZW50RGlkVXBkYXRlIHx8IGggPT09IGEubWVtb2l6ZWRQcm9wcyAmJiByID09PSBhLm1lbW9pemVkU3RhdGUgfHwgKGIuZmxhZ3MgfD0gNCksICJmdW5jdGlvbiIgIT09IHR5cGVvZiBnLmdldFNuYXBzaG90QmVmb3JlVXBkYXRlIHx8IGggPT09IGEubWVtb2l6ZWRQcm9wcyAmJiByID09PSBhLm1lbW9pemVkU3RhdGUgfHwgKGIuZmxhZ3MgfD0gMTAyNCksIGIubWVtb2l6ZWRQcm9wcyA9IGQsIGIubWVtb2l6ZWRTdGF0ZSA9IG4pLCBnLnByb3BzID0gZCwgZy5zdGF0ZSA9IG4sIGcuY29udGV4dCA9IGssIGQgPSBsKSA6ICgiZnVuY3Rpb24iICE9PSB0eXBlb2YgZy5jb21wb25lbnREaWRVcGRhdGUgfHwgaCA9PT0gYS5tZW1vaXplZFByb3BzICYmIHIgPT09CiAgICAgICAgICAgICAgYS5tZW1vaXplZFN0YXRlIHx8IChiLmZsYWdzIHw9IDQpLCAiZnVuY3Rpb24iICE9PSB0eXBlb2YgZy5nZXRTbmFwc2hvdEJlZm9yZVVwZGF0ZSB8fCBoID09PSBhLm1lbW9pemVkUHJvcHMgJiYgciA9PT0gYS5tZW1vaXplZFN0YXRlIHx8IChiLmZsYWdzIHw9IDEwMjQpLCBkID0gITEpO31yZXR1cm4ga2ooYSwgYiwgYywgZCwgZiwgZSk7fQogICAgICAgICAgZnVuY3Rpb24ga2ooYSwgYiwgYywgZCwgZSwgZikge2hqKGEsIGIpO3ZhciBnID0gMCAhPT0gKGIuZmxhZ3MgJiAxMjgpO2lmICghZCAmJiAhZykgcmV0dXJuIGUgJiYgZGcoYiwgYywgITEpLCAkaShhLCBiLCBmKTtkID0gYi5zdGF0ZU5vZGU7WGkuY3VycmVudCA9IGI7dmFyIGggPSBnICYmICJmdW5jdGlvbiIgIT09IHR5cGVvZiBjLmdldERlcml2ZWRTdGF0ZUZyb21FcnJvciA/IG51bGwgOiBkLnJlbmRlcigpO2IuZmxhZ3MgfD0gMTtudWxsICE9PSBhICYmIGcgPyAoYi5jaGlsZCA9IEJoKGIsIGEuY2hpbGQsIG51bGwsIGYpLCBiLmNoaWxkID0gQmgoYiwgbnVsbCwgaCwgZikpIDogWWkoYSwgYiwgaCwgZik7Yi5tZW1vaXplZFN0YXRlID0gZC5zdGF0ZTtlICYmIGRnKGIsIGMsICEwKTtyZXR1cm4gYi5jaGlsZDt9ZnVuY3Rpb24gbGooYSkge3ZhciBiID0gYS5zdGF0ZU5vZGU7Yi5wZW5kaW5nQ29udGV4dCA/IGFnKGEsIGIucGVuZGluZ0NvbnRleHQsIGIucGVuZGluZ0NvbnRleHQgIT09IGIuY29udGV4dCkgOiBiLmNvbnRleHQgJiYgYWcoYSwgYi5jb250ZXh0LCAhMSk7SWgoYSwgYi5jb250YWluZXJJbmZvKTt9CiAgICAgICAgICBmdW5jdGlvbiBtaihhLCBiLCBjLCBkLCBlKSB7SWcoKTtKZyhlKTtiLmZsYWdzIHw9IDI1NjtZaShhLCBiLCBjLCBkKTtyZXR1cm4gYi5jaGlsZDt9dmFyIG5qID0geyBkZWh5ZHJhdGVkOiBudWxsLCB0cmVlQ29udGV4dDogbnVsbCwgcmV0cnlMYW5lOiAwIH07ZnVuY3Rpb24gb2ooYSkge3JldHVybiB7IGJhc2VMYW5lczogYSwgY2FjaGVQb29sOiBudWxsLCB0cmFuc2l0aW9uczogbnVsbCB9O30KICAgICAgICAgIGZ1bmN0aW9uIHBqKGEsIGIsIGMpIHt2YXIgZCA9IGIucGVuZGluZ1Byb3BzLGUgPSBNLmN1cnJlbnQsZiA9ICExLGcgPSAwICE9PSAoYi5mbGFncyAmIDEyOCksaDsoaCA9IGcpIHx8IChoID0gbnVsbCAhPT0gYSAmJiBudWxsID09PSBhLm1lbW9pemVkU3RhdGUgPyAhMSA6IDAgIT09IChlICYgMikpO2lmIChoKSBmID0gITAsIGIuZmxhZ3MgJj0gLTEyOTtlbHNlIGlmIChudWxsID09PSBhIHx8IG51bGwgIT09IGEubWVtb2l6ZWRTdGF0ZSkgZSB8PSAxO0coTSwgZSAmIDEpO2lmIChudWxsID09PSBhKSB7RWcoYik7YSA9IGIubWVtb2l6ZWRTdGF0ZTtpZiAobnVsbCAhPT0gYSAmJiAoYSA9IGEuZGVoeWRyYXRlZCwgbnVsbCAhPT0gYSkpIHJldHVybiAwID09PSAoYi5tb2RlICYgMSkgPyBiLmxhbmVzID0gMSA6ICIkISIgPT09IGEuZGF0YSA/IGIubGFuZXMgPSA4IDogYi5sYW5lcyA9IDEwNzM3NDE4MjQsIG51bGw7ZyA9IGQuY2hpbGRyZW47YSA9IGQuZmFsbGJhY2s7cmV0dXJuIGYgPyAoZCA9IGIubW9kZSwgZiA9IGIuY2hpbGQsIGcgPSB7IG1vZGU6ICJoaWRkZW4iLCBjaGlsZHJlbjogZyB9LCAwID09PSAoZCAmIDEpICYmIG51bGwgIT09IGYgPyAoZi5jaGlsZExhbmVzID0gMCwgZi5wZW5kaW5nUHJvcHMgPQogICAgICAgICAgICAgIGcpIDogZiA9IHFqKGcsIGQsIDAsIG51bGwpLCBhID0gQWgoYSwgZCwgYywgbnVsbCksIGYucmV0dXJuID0gYiwgYS5yZXR1cm4gPSBiLCBmLnNpYmxpbmcgPSBhLCBiLmNoaWxkID0gZiwgYi5jaGlsZC5tZW1vaXplZFN0YXRlID0gb2ooYyksIGIubWVtb2l6ZWRTdGF0ZSA9IG5qLCBhKSA6IHJqKGIsIGcpO31lID0gYS5tZW1vaXplZFN0YXRlO2lmIChudWxsICE9PSBlICYmIChoID0gZS5kZWh5ZHJhdGVkLCBudWxsICE9PSBoKSkgcmV0dXJuIHNqKGEsIGIsIGcsIGQsIGgsIGUsIGMpO2lmIChmKSB7ZiA9IGQuZmFsbGJhY2s7ZyA9IGIubW9kZTtlID0gYS5jaGlsZDtoID0gZS5zaWJsaW5nO3ZhciBrID0geyBtb2RlOiAiaGlkZGVuIiwgY2hpbGRyZW46IGQuY2hpbGRyZW4gfTswID09PSAoZyAmIDEpICYmIGIuY2hpbGQgIT09IGUgPyAoZCA9IGIuY2hpbGQsIGQuY2hpbGRMYW5lcyA9IDAsIGQucGVuZGluZ1Byb3BzID0gaywgYi5kZWxldGlvbnMgPSBudWxsKSA6IChkID0gd2goZSwgayksIGQuc3VidHJlZUZsYWdzID0gZS5zdWJ0cmVlRmxhZ3MgJiAxNDY4MDA2NCk7bnVsbCAhPT0gaCA/IGYgPSB3aChoLCBmKSA6IChmID0gQWgoZiwgZywgYywgbnVsbCksIGYuZmxhZ3MgfD0gMik7Zi5yZXR1cm4gPQogICAgICAgICAgICAgIGI7ZC5yZXR1cm4gPSBiO2Quc2libGluZyA9IGY7Yi5jaGlsZCA9IGQ7ZCA9IGY7ZiA9IGIuY2hpbGQ7ZyA9IGEuY2hpbGQubWVtb2l6ZWRTdGF0ZTtnID0gbnVsbCA9PT0gZyA/IG9qKGMpIDogeyBiYXNlTGFuZXM6IGcuYmFzZUxhbmVzIHwgYywgY2FjaGVQb29sOiBudWxsLCB0cmFuc2l0aW9uczogZy50cmFuc2l0aW9ucyB9O2YubWVtb2l6ZWRTdGF0ZSA9IGc7Zi5jaGlsZExhbmVzID0gYS5jaGlsZExhbmVzICYgfmM7Yi5tZW1vaXplZFN0YXRlID0gbmo7cmV0dXJuIGQ7fWYgPSBhLmNoaWxkO2EgPSBmLnNpYmxpbmc7ZCA9IHdoKGYsIHsgbW9kZTogInZpc2libGUiLCBjaGlsZHJlbjogZC5jaGlsZHJlbiB9KTswID09PSAoYi5tb2RlICYgMSkgJiYgKGQubGFuZXMgPSBjKTtkLnJldHVybiA9IGI7ZC5zaWJsaW5nID0gbnVsbDtudWxsICE9PSBhICYmIChjID0gYi5kZWxldGlvbnMsIG51bGwgPT09IGMgPyAoYi5kZWxldGlvbnMgPSBbYV0sIGIuZmxhZ3MgfD0gMTYpIDogYy5wdXNoKGEpKTtiLmNoaWxkID0gZDtiLm1lbW9pemVkU3RhdGUgPSBudWxsO3JldHVybiBkO30KICAgICAgICAgIGZ1bmN0aW9uIHJqKGEsIGIpIHtiID0gcWooeyBtb2RlOiAidmlzaWJsZSIsIGNoaWxkcmVuOiBiIH0sIGEubW9kZSwgMCwgbnVsbCk7Yi5yZXR1cm4gPSBhO3JldHVybiBhLmNoaWxkID0gYjt9ZnVuY3Rpb24gdGooYSwgYiwgYywgZCkge251bGwgIT09IGQgJiYgSmcoZCk7QmgoYiwgYS5jaGlsZCwgbnVsbCwgYyk7YSA9IHJqKGIsIGIucGVuZGluZ1Byb3BzLmNoaWxkcmVuKTthLmZsYWdzIHw9IDI7Yi5tZW1vaXplZFN0YXRlID0gbnVsbDtyZXR1cm4gYTt9CiAgICAgICAgICBmdW5jdGlvbiBzaihhLCBiLCBjLCBkLCBlLCBmLCBnKSB7aWYgKGMpIHtpZiAoYi5mbGFncyAmIDI1NikgcmV0dXJuIGIuZmxhZ3MgJj0gLTI1NywgZCA9IExpKEVycm9yKHAoNDIyKSkpLCB0aihhLCBiLCBnLCBkKTtpZiAobnVsbCAhPT0gYi5tZW1vaXplZFN0YXRlKSByZXR1cm4gYi5jaGlsZCA9IGEuY2hpbGQsIGIuZmxhZ3MgfD0gMTI4LCBudWxsO2YgPSBkLmZhbGxiYWNrO2UgPSBiLm1vZGU7ZCA9IHFqKHsgbW9kZTogInZpc2libGUiLCBjaGlsZHJlbjogZC5jaGlsZHJlbiB9LCBlLCAwLCBudWxsKTtmID0gQWgoZiwgZSwgZywgbnVsbCk7Zi5mbGFncyB8PSAyO2QucmV0dXJuID0gYjtmLnJldHVybiA9IGI7ZC5zaWJsaW5nID0gZjtiLmNoaWxkID0gZDswICE9PSAoYi5tb2RlICYgMSkgJiYgQmgoYiwgYS5jaGlsZCwgbnVsbCwgZyk7Yi5jaGlsZC5tZW1vaXplZFN0YXRlID0gb2ooZyk7Yi5tZW1vaXplZFN0YXRlID0gbmo7cmV0dXJuIGY7fWlmICgwID09PSAoYi5tb2RlICYgMSkpIHJldHVybiB0aihhLCBiLCBnLCBudWxsKTtpZiAoIiQhIiA9PT0gZS5kYXRhKSB7ZCA9IGUubmV4dFNpYmxpbmcgJiYgZS5uZXh0U2libGluZy5kYXRhc2V0OwogICAgICAgICAgICAgIGlmIChkKSB2YXIgaCA9IGQuZGdzdDtkID0gaDtmID0gRXJyb3IocCg0MTkpKTtkID0gTGkoZiwgZCwgdm9pZCAwKTtyZXR1cm4gdGooYSwgYiwgZywgZCk7fWggPSAwICE9PSAoZyAmIGEuY2hpbGRMYW5lcyk7aWYgKFVnIHx8IGgpIHtkID0gUjtpZiAobnVsbCAhPT0gZCkge3N3aXRjaCAoZyAmIC1nKSB7Y2FzZSA0OmUgPSAyO2JyZWFrO2Nhc2UgMTY6ZSA9IDg7YnJlYWs7Y2FzZSA2NDpjYXNlIDEyODpjYXNlIDI1NjpjYXNlIDUxMjpjYXNlIDEwMjQ6Y2FzZSAyMDQ4OmNhc2UgNDA5NjpjYXNlIDgxOTI6Y2FzZSAxNjM4NDpjYXNlIDMyNzY4OmNhc2UgNjU1MzY6Y2FzZSAxMzEwNzI6Y2FzZSAyNjIxNDQ6Y2FzZSA1MjQyODg6Y2FzZSAxMDQ4NTc2OmNhc2UgMjA5NzE1MjpjYXNlIDQxOTQzMDQ6Y2FzZSA4Mzg4NjA4OmNhc2UgMTY3NzcyMTY6Y2FzZSAzMzU1NDQzMjpjYXNlIDY3MTA4ODY0OmUgPSAzMjticmVhaztjYXNlIDUzNjg3MDkxMjplID0gMjY4NDM1NDU2O2JyZWFrO2RlZmF1bHQ6ZSA9IDA7fWUgPSAwICE9PSAoZSAmIChkLnN1c3BlbmRlZExhbmVzIHwgZykpID8gMCA6IGU7CiAgICAgICAgICAgICAgICAwICE9PSBlICYmIGUgIT09IGYucmV0cnlMYW5lICYmIChmLnJldHJ5TGFuZSA9IGUsIFpnKGEsIGUpLCBtaChkLCBhLCBlLCAtMSkpO311aigpO2QgPSBMaShFcnJvcihwKDQyMSkpKTtyZXR1cm4gdGooYSwgYiwgZywgZCk7fWlmICgiJD8iID09PSBlLmRhdGEpIHJldHVybiBiLmZsYWdzIHw9IDEyOCwgYi5jaGlsZCA9IGEuY2hpbGQsIGIgPSB2ai5iaW5kKG51bGwsIGEpLCBlLl9yZWFjdFJldHJ5ID0gYiwgbnVsbDthID0gZi50cmVlQ29udGV4dDt5ZyA9IExmKGUubmV4dFNpYmxpbmcpO3hnID0gYjtJID0gITA7emcgPSBudWxsO251bGwgIT09IGEgJiYgKG9nW3BnKytdID0gcmcsIG9nW3BnKytdID0gc2csIG9nW3BnKytdID0gcWcsIHJnID0gYS5pZCwgc2cgPSBhLm92ZXJmbG93LCBxZyA9IGIpO2IgPSByaihiLCBkLmNoaWxkcmVuKTtiLmZsYWdzIHw9IDQwOTY7cmV0dXJuIGI7fWZ1bmN0aW9uIHdqKGEsIGIsIGMpIHthLmxhbmVzIHw9IGI7dmFyIGQgPSBhLmFsdGVybmF0ZTtudWxsICE9PSBkICYmIChkLmxhbmVzIHw9IGIpO1NnKGEucmV0dXJuLCBiLCBjKTt9CiAgICAgICAgICBmdW5jdGlvbiB4aihhLCBiLCBjLCBkLCBlKSB7dmFyIGYgPSBhLm1lbW9pemVkU3RhdGU7bnVsbCA9PT0gZiA/IGEubWVtb2l6ZWRTdGF0ZSA9IHsgaXNCYWNrd2FyZHM6IGIsIHJlbmRlcmluZzogbnVsbCwgcmVuZGVyaW5nU3RhcnRUaW1lOiAwLCBsYXN0OiBkLCB0YWlsOiBjLCB0YWlsTW9kZTogZSB9IDogKGYuaXNCYWNrd2FyZHMgPSBiLCBmLnJlbmRlcmluZyA9IG51bGwsIGYucmVuZGVyaW5nU3RhcnRUaW1lID0gMCwgZi5sYXN0ID0gZCwgZi50YWlsID0gYywgZi50YWlsTW9kZSA9IGUpO30KICAgICAgICAgIGZ1bmN0aW9uIHlqKGEsIGIsIGMpIHt2YXIgZCA9IGIucGVuZGluZ1Byb3BzLGUgPSBkLnJldmVhbE9yZGVyLGYgPSBkLnRhaWw7WWkoYSwgYiwgZC5jaGlsZHJlbiwgYyk7ZCA9IE0uY3VycmVudDtpZiAoMCAhPT0gKGQgJiAyKSkgZCA9IGQgJiAxIHwgMiwgYi5mbGFncyB8PSAxMjg7ZWxzZSB7aWYgKG51bGwgIT09IGEgJiYgMCAhPT0gKGEuZmxhZ3MgJiAxMjgpKSBhOiBmb3IgKGEgPSBiLmNoaWxkOyBudWxsICE9PSBhOykge2lmICgxMyA9PT0gYS50YWcpIG51bGwgIT09IGEubWVtb2l6ZWRTdGF0ZSAmJiB3aihhLCBjLCBiKTtlbHNlIGlmICgxOSA9PT0gYS50YWcpIHdqKGEsIGMsIGIpO2Vsc2UgaWYgKG51bGwgIT09IGEuY2hpbGQpIHthLmNoaWxkLnJldHVybiA9IGE7YSA9IGEuY2hpbGQ7Y29udGludWU7fWlmIChhID09PSBiKSBicmVhayBhO2ZvciAoOyBudWxsID09PSBhLnNpYmxpbmc7KSB7aWYgKG51bGwgPT09IGEucmV0dXJuIHx8IGEucmV0dXJuID09PSBiKSBicmVhayBhO2EgPSBhLnJldHVybjt9YS5zaWJsaW5nLnJldHVybiA9IGEucmV0dXJuO2EgPSBhLnNpYmxpbmc7fWQgJj0gMTt9RyhNLCBkKTtpZiAoMCA9PT0gKGIubW9kZSAmIDEpKSBiLm1lbW9pemVkU3RhdGUgPQogICAgICAgICAgICBudWxsO2Vsc2Ugc3dpdGNoIChlKSB7Y2FzZSAiZm9yd2FyZHMiOmMgPSBiLmNoaWxkO2ZvciAoZSA9IG51bGw7IG51bGwgIT09IGM7KSBhID0gYy5hbHRlcm5hdGUsIG51bGwgIT09IGEgJiYgbnVsbCA9PT0gTWgoYSkgJiYgKGUgPSBjKSwgYyA9IGMuc2libGluZztjID0gZTtudWxsID09PSBjID8gKGUgPSBiLmNoaWxkLCBiLmNoaWxkID0gbnVsbCkgOiAoZSA9IGMuc2libGluZywgYy5zaWJsaW5nID0gbnVsbCk7eGooYiwgITEsIGUsIGMsIGYpO2JyZWFrO2Nhc2UgImJhY2t3YXJkcyI6YyA9IG51bGw7ZSA9IGIuY2hpbGQ7Zm9yIChiLmNoaWxkID0gbnVsbDsgbnVsbCAhPT0gZTspIHthID0gZS5hbHRlcm5hdGU7aWYgKG51bGwgIT09IGEgJiYgbnVsbCA9PT0gTWgoYSkpIHtiLmNoaWxkID0gZTticmVhazt9YSA9IGUuc2libGluZztlLnNpYmxpbmcgPSBjO2MgPSBlO2UgPSBhO314aihiLCAhMCwgYywgbnVsbCwgZik7YnJlYWs7Y2FzZSAidG9nZXRoZXIiOnhqKGIsICExLCBudWxsLCBudWxsLCB2b2lkIDApO2JyZWFrO2RlZmF1bHQ6Yi5tZW1vaXplZFN0YXRlID0gbnVsbDt9cmV0dXJuIGIuY2hpbGQ7fQogICAgICAgICAgZnVuY3Rpb24gamooYSwgYikgezAgPT09IChiLm1vZGUgJiAxKSAmJiBudWxsICE9PSBhICYmIChhLmFsdGVybmF0ZSA9IG51bGwsIGIuYWx0ZXJuYXRlID0gbnVsbCwgYi5mbGFncyB8PSAyKTt9ZnVuY3Rpb24gJGkoYSwgYiwgYykge251bGwgIT09IGEgJiYgKGIuZGVwZW5kZW5jaWVzID0gYS5kZXBlbmRlbmNpZXMpO2hoIHw9IGIubGFuZXM7aWYgKDAgPT09IChjICYgYi5jaGlsZExhbmVzKSkgcmV0dXJuIG51bGw7aWYgKG51bGwgIT09IGEgJiYgYi5jaGlsZCAhPT0gYS5jaGlsZCkgdGhyb3cgRXJyb3IocCgxNTMpKTtpZiAobnVsbCAhPT0gYi5jaGlsZCkge2EgPSBiLmNoaWxkO2MgPSB3aChhLCBhLnBlbmRpbmdQcm9wcyk7Yi5jaGlsZCA9IGM7Zm9yIChjLnJldHVybiA9IGI7IG51bGwgIT09IGEuc2libGluZzspIGEgPSBhLnNpYmxpbmcsIGMgPSBjLnNpYmxpbmcgPSB3aChhLCBhLnBlbmRpbmdQcm9wcyksIGMucmV0dXJuID0gYjtjLnNpYmxpbmcgPSBudWxsO31yZXR1cm4gYi5jaGlsZDt9CiAgICAgICAgICBmdW5jdGlvbiB6aihhLCBiLCBjKSB7c3dpdGNoIChiLnRhZykge2Nhc2UgMzpsaihiKTtJZygpO2JyZWFrO2Nhc2UgNTpLaChiKTticmVhaztjYXNlIDE6WmYoYi50eXBlKSAmJiBjZyhiKTticmVhaztjYXNlIDQ6SWgoYiwgYi5zdGF0ZU5vZGUuY29udGFpbmVySW5mbyk7YnJlYWs7Y2FzZSAxMDp2YXIgZCA9IGIudHlwZS5fY29udGV4dCxlID0gYi5tZW1vaXplZFByb3BzLnZhbHVlO0coTWcsIGQuX2N1cnJlbnRWYWx1ZSk7ZC5fY3VycmVudFZhbHVlID0gZTticmVhaztjYXNlIDEzOmQgPSBiLm1lbW9pemVkU3RhdGU7aWYgKG51bGwgIT09IGQpIHtpZiAobnVsbCAhPT0gZC5kZWh5ZHJhdGVkKSByZXR1cm4gRyhNLCBNLmN1cnJlbnQgJiAxKSwgYi5mbGFncyB8PSAxMjgsIG51bGw7aWYgKDAgIT09IChjICYgYi5jaGlsZC5jaGlsZExhbmVzKSkgcmV0dXJuIHBqKGEsIGIsIGMpO0coTSwgTS5jdXJyZW50ICYgMSk7YSA9ICRpKGEsIGIsIGMpO3JldHVybiBudWxsICE9PSBhID8gYS5zaWJsaW5nIDogbnVsbDt9RyhNLCBNLmN1cnJlbnQgJiAxKTticmVhaztjYXNlIDE5OmQgPSAwICE9PSAoYyAmCiAgICAgICAgICAgICAgICBiLmNoaWxkTGFuZXMpO2lmICgwICE9PSAoYS5mbGFncyAmIDEyOCkpIHtpZiAoZCkgcmV0dXJuIHlqKGEsIGIsIGMpO2IuZmxhZ3MgfD0gMTI4O31lID0gYi5tZW1vaXplZFN0YXRlO251bGwgIT09IGUgJiYgKGUucmVuZGVyaW5nID0gbnVsbCwgZS50YWlsID0gbnVsbCwgZS5sYXN0RWZmZWN0ID0gbnVsbCk7RyhNLCBNLmN1cnJlbnQpO2lmIChkKSBicmVhaztlbHNlIHJldHVybiBudWxsO2Nhc2UgMjI6Y2FzZSAyMzpyZXR1cm4gYi5sYW5lcyA9IDAsIGVqKGEsIGIsIGMpO31yZXR1cm4gJGkoYSwgYiwgYyk7fXZhciBBaiwgQmosIENqLCBEajsKICAgICAgICAgIEFqID0gZnVuY3Rpb24gQWooYSwgYikge2ZvciAodmFyIGMgPSBiLmNoaWxkOyBudWxsICE9PSBjOykge2lmICg1ID09PSBjLnRhZyB8fCA2ID09PSBjLnRhZykgYS5hcHBlbmRDaGlsZChjLnN0YXRlTm9kZSk7ZWxzZSBpZiAoNCAhPT0gYy50YWcgJiYgbnVsbCAhPT0gYy5jaGlsZCkge2MuY2hpbGQucmV0dXJuID0gYztjID0gYy5jaGlsZDtjb250aW51ZTt9aWYgKGMgPT09IGIpIGJyZWFrO2ZvciAoOyBudWxsID09PSBjLnNpYmxpbmc7KSB7aWYgKG51bGwgPT09IGMucmV0dXJuIHx8IGMucmV0dXJuID09PSBiKSByZXR1cm47YyA9IGMucmV0dXJuO31jLnNpYmxpbmcucmV0dXJuID0gYy5yZXR1cm47YyA9IGMuc2libGluZzt9fTtCaiA9IGZ1bmN0aW9uIEJqKCkge307CiAgICAgICAgICBDaiA9IGZ1bmN0aW9uIENqKGEsIGIsIGMsIGQpIHt2YXIgZSA9IGEubWVtb2l6ZWRQcm9wcztpZiAoZSAhPT0gZCkge2EgPSBiLnN0YXRlTm9kZTtIaChFaC5jdXJyZW50KTt2YXIgZiA9IG51bGw7c3dpdGNoIChjKSB7Y2FzZSAiaW5wdXQiOmUgPSBZYShhLCBlKTtkID0gWWEoYSwgZCk7ZiA9IFtdO2JyZWFrO2Nhc2UgInNlbGVjdCI6ZSA9IEEoe30sIGUsIHsgdmFsdWU6IHZvaWQgMCB9KTtkID0gQSh7fSwgZCwgeyB2YWx1ZTogdm9pZCAwIH0pO2YgPSBbXTticmVhaztjYXNlICJ0ZXh0YXJlYSI6ZSA9IGdiKGEsIGUpO2QgPSBnYihhLCBkKTtmID0gW107YnJlYWs7ZGVmYXVsdDoiZnVuY3Rpb24iICE9PSB0eXBlb2YgZS5vbkNsaWNrICYmICJmdW5jdGlvbiIgPT09IHR5cGVvZiBkLm9uQ2xpY2sgJiYgKGEub25jbGljayA9IEJmKTt9dWIoYywgZCk7dmFyIGc7YyA9IG51bGw7Zm9yIChsIGluIGUpIGlmICghZC5oYXNPd25Qcm9wZXJ0eShsKSAmJiBlLmhhc093blByb3BlcnR5KGwpICYmIG51bGwgIT0gZVtsXSkgaWYgKCJzdHlsZSIgPT09IGwpIHt2YXIgaCA9IGVbbF07Zm9yIChnIGluIGgpIGguaGFzT3duUHJvcGVydHkoZykgJiYgKAogICAgICAgICAgICAgICAgYyB8fCAoYyA9IHt9KSwgY1tnXSA9ICIiKTt9IGVsc2UgImRhbmdlcm91c2x5U2V0SW5uZXJIVE1MIiAhPT0gbCAmJiAiY2hpbGRyZW4iICE9PSBsICYmICJzdXBwcmVzc0NvbnRlbnRFZGl0YWJsZVdhcm5pbmciICE9PSBsICYmICJzdXBwcmVzc0h5ZHJhdGlvbldhcm5pbmciICE9PSBsICYmICJhdXRvRm9jdXMiICE9PSBsICYmIChlYS5oYXNPd25Qcm9wZXJ0eShsKSA/IGYgfHwgKGYgPSBbXSkgOiAoZiA9IGYgfHwgW10pLnB1c2gobCwgbnVsbCkpO2ZvciAobCBpbiBkKSB7dmFyIGsgPSBkW2xdO2ggPSBudWxsICE9IGUgPyBlW2xdIDogdm9pZCAwO2lmIChkLmhhc093blByb3BlcnR5KGwpICYmIGsgIT09IGggJiYgKG51bGwgIT0gayB8fCBudWxsICE9IGgpKSBpZiAoInN0eWxlIiA9PT0gbCkge2lmIChoKSB7Zm9yIChnIGluIGgpICFoLmhhc093blByb3BlcnR5KGcpIHx8IGsgJiYgay5oYXNPd25Qcm9wZXJ0eShnKSB8fCAoYyB8fCAoYyA9IHt9KSwgY1tnXSA9ICIiKTtmb3IgKGcgaW4gaykgay5oYXNPd25Qcm9wZXJ0eShnKSAmJiBoW2ddICE9PSBrW2ddICYmIChjIHx8IChjID0ge30pLCBjW2ddID0ga1tnXSk7fSBlbHNlIGMgfHwgKGYgfHwgKGYgPSBbXSksIGYucHVzaChsLAogICAgICAgICAgICAgICAgICBjKSksIGMgPSBrO30gZWxzZSAiZGFuZ2Vyb3VzbHlTZXRJbm5lckhUTUwiID09PSBsID8gKGsgPSBrID8gay5fX2h0bWwgOiB2b2lkIDAsIGggPSBoID8gaC5fX2h0bWwgOiB2b2lkIDAsIG51bGwgIT0gayAmJiBoICE9PSBrICYmIChmID0gZiB8fCBbXSkucHVzaChsLCBrKSkgOiAiY2hpbGRyZW4iID09PSBsID8gInN0cmluZyIgIT09IHR5cGVvZiBrICYmICJudW1iZXIiICE9PSB0eXBlb2YgayB8fCAoZiA9IGYgfHwgW10pLnB1c2gobCwgIiIgKyBrKSA6ICJzdXBwcmVzc0NvbnRlbnRFZGl0YWJsZVdhcm5pbmciICE9PSBsICYmICJzdXBwcmVzc0h5ZHJhdGlvbldhcm5pbmciICE9PSBsICYmIChlYS5oYXNPd25Qcm9wZXJ0eShsKSA/IChudWxsICE9IGsgJiYgIm9uU2Nyb2xsIiA9PT0gbCAmJiBEKCJzY3JvbGwiLCBhKSwgZiB8fCBoID09PSBrIHx8IChmID0gW10pKSA6IChmID0gZiB8fCBbXSkucHVzaChsLCBrKSk7fWMgJiYgKGYgPSBmIHx8IFtdKS5wdXNoKCJzdHlsZSIsIGMpO3ZhciBsID0gZjtpZiAoYi51cGRhdGVRdWV1ZSA9IGwpIGIuZmxhZ3MgfD0gNDt9fTtEaiA9IGZ1bmN0aW9uIERqKGEsIGIsIGMsIGQpIHtjICE9PSBkICYmIChiLmZsYWdzIHw9IDQpO307CiAgICAgICAgICBmdW5jdGlvbiBFaihhLCBiKSB7aWYgKCFJKSBzd2l0Y2ggKGEudGFpbE1vZGUpIHtjYXNlICJoaWRkZW4iOmIgPSBhLnRhaWw7Zm9yICh2YXIgYyA9IG51bGw7IG51bGwgIT09IGI7KSBudWxsICE9PSBiLmFsdGVybmF0ZSAmJiAoYyA9IGIpLCBiID0gYi5zaWJsaW5nO251bGwgPT09IGMgPyBhLnRhaWwgPSBudWxsIDogYy5zaWJsaW5nID0gbnVsbDticmVhaztjYXNlICJjb2xsYXBzZWQiOmMgPSBhLnRhaWw7Zm9yICh2YXIgZCA9IG51bGw7IG51bGwgIT09IGM7KSBudWxsICE9PSBjLmFsdGVybmF0ZSAmJiAoZCA9IGMpLCBjID0gYy5zaWJsaW5nO251bGwgPT09IGQgPyBiIHx8IG51bGwgPT09IGEudGFpbCA/IGEudGFpbCA9IG51bGwgOiBhLnRhaWwuc2libGluZyA9IG51bGwgOiBkLnNpYmxpbmcgPSBudWxsO319CiAgICAgICAgICBmdW5jdGlvbiBTKGEpIHt2YXIgYiA9IG51bGwgIT09IGEuYWx0ZXJuYXRlICYmIGEuYWx0ZXJuYXRlLmNoaWxkID09PSBhLmNoaWxkLGMgPSAwLGQgPSAwO2lmIChiKSBmb3IgKHZhciBlID0gYS5jaGlsZDsgbnVsbCAhPT0gZTspIGMgfD0gZS5sYW5lcyB8IGUuY2hpbGRMYW5lcywgZCB8PSBlLnN1YnRyZWVGbGFncyAmIDE0NjgwMDY0LCBkIHw9IGUuZmxhZ3MgJiAxNDY4MDA2NCwgZS5yZXR1cm4gPSBhLCBlID0gZS5zaWJsaW5nO2Vsc2UgZm9yIChlID0gYS5jaGlsZDsgbnVsbCAhPT0gZTspIGMgfD0gZS5sYW5lcyB8IGUuY2hpbGRMYW5lcywgZCB8PSBlLnN1YnRyZWVGbGFncywgZCB8PSBlLmZsYWdzLCBlLnJldHVybiA9IGEsIGUgPSBlLnNpYmxpbmc7YS5zdWJ0cmVlRmxhZ3MgfD0gZDthLmNoaWxkTGFuZXMgPSBjO3JldHVybiBiO30KICAgICAgICAgIGZ1bmN0aW9uIEZqKGEsIGIsIGMpIHt2YXIgZCA9IGIucGVuZGluZ1Byb3BzO3dnKGIpO3N3aXRjaCAoYi50YWcpIHtjYXNlIDI6Y2FzZSAxNjpjYXNlIDE1OmNhc2UgMDpjYXNlIDExOmNhc2UgNzpjYXNlIDg6Y2FzZSAxMjpjYXNlIDk6Y2FzZSAxNDpyZXR1cm4gUyhiKSwgbnVsbDtjYXNlIDE6cmV0dXJuIFpmKGIudHlwZSkgJiYgJGYoKSwgUyhiKSwgbnVsbDtjYXNlIDM6ZCA9IGIuc3RhdGVOb2RlO0poKCk7RShXZik7RShIKTtPaCgpO2QucGVuZGluZ0NvbnRleHQgJiYgKGQuY29udGV4dCA9IGQucGVuZGluZ0NvbnRleHQsIGQucGVuZGluZ0NvbnRleHQgPSBudWxsKTtpZiAobnVsbCA9PT0gYSB8fCBudWxsID09PSBhLmNoaWxkKSBHZyhiKSA/IGIuZmxhZ3MgfD0gNCA6IG51bGwgPT09IGEgfHwgYS5tZW1vaXplZFN0YXRlLmlzRGVoeWRyYXRlZCAmJiAwID09PSAoYi5mbGFncyAmIDI1NikgfHwgKGIuZmxhZ3MgfD0gMTAyNCwgbnVsbCAhPT0gemcgJiYgKEdqKHpnKSwgemcgPSBudWxsKSk7QmooYSwgYik7UyhiKTtyZXR1cm4gbnVsbDtjYXNlIDU6TGgoYik7dmFyIGUgPSBIaChHaC5jdXJyZW50KTsKICAgICAgICAgICAgICAgIGMgPSBiLnR5cGU7aWYgKG51bGwgIT09IGEgJiYgbnVsbCAhPSBiLnN0YXRlTm9kZSkgQ2ooYSwgYiwgYywgZCwgZSksIGEucmVmICE9PSBiLnJlZiAmJiAoYi5mbGFncyB8PSA1MTIsIGIuZmxhZ3MgfD0gMjA5NzE1Mik7ZWxzZSB7aWYgKCFkKSB7aWYgKG51bGwgPT09IGIuc3RhdGVOb2RlKSB0aHJvdyBFcnJvcihwKDE2NikpO1MoYik7cmV0dXJuIG51bGw7fWEgPSBIaChFaC5jdXJyZW50KTtpZiAoR2coYikpIHtkID0gYi5zdGF0ZU5vZGU7YyA9IGIudHlwZTt2YXIgZiA9IGIubWVtb2l6ZWRQcm9wcztkW09mXSA9IGI7ZFtQZl0gPSBmO2EgPSAwICE9PSAoYi5tb2RlICYgMSk7c3dpdGNoIChjKSB7Y2FzZSAiZGlhbG9nIjpEKCJjYW5jZWwiLCBkKTtEKCJjbG9zZSIsIGQpO2JyZWFrO2Nhc2UgImlmcmFtZSI6Y2FzZSAib2JqZWN0IjpjYXNlICJlbWJlZCI6RCgibG9hZCIsIGQpO2JyZWFrO2Nhc2UgInZpZGVvIjpjYXNlICJhdWRpbyI6Zm9yIChlID0gMDsgZSA8IGxmLmxlbmd0aDsgZSsrKSBEKGxmW2VdLCBkKTticmVhaztjYXNlICJzb3VyY2UiOkQoImVycm9yIiwgZCk7YnJlYWs7Y2FzZSAiaW1nIjpjYXNlICJpbWFnZSI6Y2FzZSAibGluayI6RCgiZXJyb3IiLAogICAgICAgICAgICAgICAgICAgICAgICBkKTtEKCJsb2FkIiwgZCk7YnJlYWs7Y2FzZSAiZGV0YWlscyI6RCgidG9nZ2xlIiwgZCk7YnJlYWs7Y2FzZSAiaW5wdXQiOlphKGQsIGYpO0QoImludmFsaWQiLCBkKTticmVhaztjYXNlICJzZWxlY3QiOmQuX3dyYXBwZXJTdGF0ZSA9IHsgd2FzTXVsdGlwbGU6ICEhZi5tdWx0aXBsZSB9O0QoImludmFsaWQiLCBkKTticmVhaztjYXNlICJ0ZXh0YXJlYSI6aGIoZCwgZiksIEQoImludmFsaWQiLCBkKTt9dWIoYywgZik7ZSA9IG51bGw7Zm9yICh2YXIgZyBpbiBmKSBpZiAoZi5oYXNPd25Qcm9wZXJ0eShnKSkge3ZhciBoID0gZltnXTsiY2hpbGRyZW4iID09PSBnID8gInN0cmluZyIgPT09IHR5cGVvZiBoID8gZC50ZXh0Q29udGVudCAhPT0gaCAmJiAoITAgIT09IGYuc3VwcHJlc3NIeWRyYXRpb25XYXJuaW5nICYmIEFmKGQudGV4dENvbnRlbnQsIGgsIGEpLCBlID0gWyJjaGlsZHJlbiIsIGhdKSA6ICJudW1iZXIiID09PSB0eXBlb2YgaCAmJiBkLnRleHRDb250ZW50ICE9PSAiIiArIGggJiYgKCEwICE9PSBmLnN1cHByZXNzSHlkcmF0aW9uV2FybmluZyAmJiBBZihkLnRleHRDb250ZW50LAogICAgICAgICAgICAgICAgICAgICAgaCwgYSksIGUgPSBbImNoaWxkcmVuIiwgIiIgKyBoXSkgOiBlYS5oYXNPd25Qcm9wZXJ0eShnKSAmJiBudWxsICE9IGggJiYgIm9uU2Nyb2xsIiA9PT0gZyAmJiBEKCJzY3JvbGwiLCBkKTt9c3dpdGNoIChjKSB7Y2FzZSAiaW5wdXQiOlZhKGQpO2RiKGQsIGYsICEwKTticmVhaztjYXNlICJ0ZXh0YXJlYSI6VmEoZCk7amIoZCk7YnJlYWs7Y2FzZSAic2VsZWN0IjpjYXNlICJvcHRpb24iOmJyZWFrO2RlZmF1bHQ6ImZ1bmN0aW9uIiA9PT0gdHlwZW9mIGYub25DbGljayAmJiAoZC5vbmNsaWNrID0gQmYpO31kID0gZTtiLnVwZGF0ZVF1ZXVlID0gZDtudWxsICE9PSBkICYmIChiLmZsYWdzIHw9IDQpO30gZWxzZSB7ZyA9IDkgPT09IGUubm9kZVR5cGUgPyBlIDogZS5vd25lckRvY3VtZW50OyJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hodG1sIiA9PT0gYSAmJiAoYSA9IGtiKGMpKTsiaHR0cDovL3d3dy53My5vcmcvMTk5OS94aHRtbCIgPT09IGEgPyAic2NyaXB0IiA9PT0gYyA/IChhID0gZy5jcmVhdGVFbGVtZW50KCJkaXYiKSwgYS5pbm5lckhUTUwgPSAiPHNjcmlwdD5ceDNjL3NjcmlwdD4iLCBhID0gYS5yZW1vdmVDaGlsZChhLmZpcnN0Q2hpbGQpKSA6CiAgICAgICAgICAgICAgICAgICAgInN0cmluZyIgPT09IHR5cGVvZiBkLmlzID8gYSA9IGcuY3JlYXRlRWxlbWVudChjLCB7IGlzOiBkLmlzIH0pIDogKGEgPSBnLmNyZWF0ZUVsZW1lbnQoYyksICJzZWxlY3QiID09PSBjICYmIChnID0gYSwgZC5tdWx0aXBsZSA/IGcubXVsdGlwbGUgPSAhMCA6IGQuc2l6ZSAmJiAoZy5zaXplID0gZC5zaXplKSkpIDogYSA9IGcuY3JlYXRlRWxlbWVudE5TKGEsIGMpO2FbT2ZdID0gYjthW1BmXSA9IGQ7QWooYSwgYiwgITEsICExKTtiLnN0YXRlTm9kZSA9IGE7YToge2cgPSB2YihjLCBkKTtzd2l0Y2ggKGMpIHtjYXNlICJkaWFsb2ciOkQoImNhbmNlbCIsIGEpO0QoImNsb3NlIiwgYSk7ZSA9IGQ7YnJlYWs7Y2FzZSAiaWZyYW1lIjpjYXNlICJvYmplY3QiOmNhc2UgImVtYmVkIjpEKCJsb2FkIiwgYSk7ZSA9IGQ7YnJlYWs7Y2FzZSAidmlkZW8iOmNhc2UgImF1ZGlvIjpmb3IgKGUgPSAwOyBlIDwgbGYubGVuZ3RoOyBlKyspIEQobGZbZV0sIGEpO2UgPSBkO2JyZWFrO2Nhc2UgInNvdXJjZSI6RCgiZXJyb3IiLCBhKTtlID0gZDticmVhaztjYXNlICJpbWciOmNhc2UgImltYWdlIjpjYXNlICJsaW5rIjpEKCJlcnJvciIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgYSk7RCgibG9hZCIsIGEpO2UgPSBkO2JyZWFrO2Nhc2UgImRldGFpbHMiOkQoInRvZ2dsZSIsIGEpO2UgPSBkO2JyZWFrO2Nhc2UgImlucHV0IjpaYShhLCBkKTtlID0gWWEoYSwgZCk7RCgiaW52YWxpZCIsIGEpO2JyZWFrO2Nhc2UgIm9wdGlvbiI6ZSA9IGQ7YnJlYWs7Y2FzZSAic2VsZWN0IjphLl93cmFwcGVyU3RhdGUgPSB7IHdhc011bHRpcGxlOiAhIWQubXVsdGlwbGUgfTtlID0gQSh7fSwgZCwgeyB2YWx1ZTogdm9pZCAwIH0pO0QoImludmFsaWQiLCBhKTticmVhaztjYXNlICJ0ZXh0YXJlYSI6aGIoYSwgZCk7ZSA9IGdiKGEsIGQpO0QoImludmFsaWQiLCBhKTticmVhaztkZWZhdWx0OmUgPSBkO311YihjLCBlKTtoID0gZTtmb3IgKGYgaW4gaCkgaWYgKGguaGFzT3duUHJvcGVydHkoZikpIHt2YXIgayA9IGhbZl07InN0eWxlIiA9PT0gZiA/IHNiKGEsIGspIDogImRhbmdlcm91c2x5U2V0SW5uZXJIVE1MIiA9PT0gZiA/IChrID0gayA/IGsuX19odG1sIDogdm9pZCAwLCBudWxsICE9IGsgJiYgbmIoYSwgaykpIDogImNoaWxkcmVuIiA9PT0gZiA/ICJzdHJpbmciID09PSB0eXBlb2YgayA/ICgidGV4dGFyZWEiICE9PQogICAgICAgICAgICAgICAgICAgICAgICBjIHx8ICIiICE9PSBrKSAmJiBvYihhLCBrKSA6ICJudW1iZXIiID09PSB0eXBlb2YgayAmJiBvYihhLCAiIiArIGspIDogInN1cHByZXNzQ29udGVudEVkaXRhYmxlV2FybmluZyIgIT09IGYgJiYgInN1cHByZXNzSHlkcmF0aW9uV2FybmluZyIgIT09IGYgJiYgImF1dG9Gb2N1cyIgIT09IGYgJiYgKGVhLmhhc093blByb3BlcnR5KGYpID8gbnVsbCAhPSBrICYmICJvblNjcm9sbCIgPT09IGYgJiYgRCgic2Nyb2xsIiwgYSkgOiBudWxsICE9IGsgJiYgdGEoYSwgZiwgaywgZykpO31zd2l0Y2ggKGMpIHtjYXNlICJpbnB1dCI6VmEoYSk7ZGIoYSwgZCwgITEpO2JyZWFrO2Nhc2UgInRleHRhcmVhIjpWYShhKTtqYihhKTticmVhaztjYXNlICJvcHRpb24iOm51bGwgIT0gZC52YWx1ZSAmJiBhLnNldEF0dHJpYnV0ZSgidmFsdWUiLCAiIiArIFNhKGQudmFsdWUpKTticmVhaztjYXNlICJzZWxlY3QiOmEubXVsdGlwbGUgPSAhIWQubXVsdGlwbGU7ZiA9IGQudmFsdWU7bnVsbCAhPSBmID8gZmIoYSwgISFkLm11bHRpcGxlLCBmLCAhMSkgOiBudWxsICE9IGQuZGVmYXVsdFZhbHVlICYmIGZiKGEsICEhZC5tdWx0aXBsZSwgZC5kZWZhdWx0VmFsdWUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgITApO2JyZWFrO2RlZmF1bHQ6ImZ1bmN0aW9uIiA9PT0gdHlwZW9mIGUub25DbGljayAmJiAoYS5vbmNsaWNrID0gQmYpO31zd2l0Y2ggKGMpIHtjYXNlICJidXR0b24iOmNhc2UgImlucHV0IjpjYXNlICJzZWxlY3QiOmNhc2UgInRleHRhcmVhIjpkID0gISFkLmF1dG9Gb2N1czticmVhayBhO2Nhc2UgImltZyI6ZCA9ICEwO2JyZWFrIGE7ZGVmYXVsdDpkID0gITE7fX1kICYmIChiLmZsYWdzIHw9IDQpO31udWxsICE9PSBiLnJlZiAmJiAoYi5mbGFncyB8PSA1MTIsIGIuZmxhZ3MgfD0gMjA5NzE1Mik7fVMoYik7cmV0dXJuIG51bGw7Y2FzZSA2OmlmIChhICYmIG51bGwgIT0gYi5zdGF0ZU5vZGUpIERqKGEsIGIsIGEubWVtb2l6ZWRQcm9wcywgZCk7ZWxzZSB7aWYgKCJzdHJpbmciICE9PSB0eXBlb2YgZCAmJiBudWxsID09PSBiLnN0YXRlTm9kZSkgdGhyb3cgRXJyb3IocCgxNjYpKTtjID0gSGgoR2guY3VycmVudCk7SGgoRWguY3VycmVudCk7aWYgKEdnKGIpKSB7ZCA9IGIuc3RhdGVOb2RlO2MgPSBiLm1lbW9pemVkUHJvcHM7ZFtPZl0gPSBiO2lmIChmID0gZC5ub2RlVmFsdWUgIT09IGMpIGlmIChhID0KICAgICAgICAgICAgICAgICAgICB4ZywgbnVsbCAhPT0gYSkgc3dpdGNoIChhLnRhZykge2Nhc2UgMzpBZihkLm5vZGVWYWx1ZSwgYywgMCAhPT0gKGEubW9kZSAmIDEpKTticmVhaztjYXNlIDU6ITAgIT09IGEubWVtb2l6ZWRQcm9wcy5zdXBwcmVzc0h5ZHJhdGlvbldhcm5pbmcgJiYgQWYoZC5ub2RlVmFsdWUsIGMsIDAgIT09IChhLm1vZGUgJiAxKSk7fWYgJiYgKGIuZmxhZ3MgfD0gNCk7fSBlbHNlIGQgPSAoOSA9PT0gYy5ub2RlVHlwZSA/IGMgOiBjLm93bmVyRG9jdW1lbnQpLmNyZWF0ZVRleHROb2RlKGQpLCBkW09mXSA9IGIsIGIuc3RhdGVOb2RlID0gZDt9UyhiKTtyZXR1cm4gbnVsbDtjYXNlIDEzOkUoTSk7ZCA9IGIubWVtb2l6ZWRTdGF0ZTtpZiAobnVsbCA9PT0gYSB8fCBudWxsICE9PSBhLm1lbW9pemVkU3RhdGUgJiYgbnVsbCAhPT0gYS5tZW1vaXplZFN0YXRlLmRlaHlkcmF0ZWQpIHtpZiAoSSAmJiBudWxsICE9PSB5ZyAmJiAwICE9PSAoYi5tb2RlICYgMSkgJiYgMCA9PT0gKGIuZmxhZ3MgJiAxMjgpKSBIZygpLCBJZygpLCBiLmZsYWdzIHw9IDk4NTYwLCBmID0gITE7ZWxzZSBpZiAoZiA9IEdnKGIpLCBudWxsICE9PSBkICYmIG51bGwgIT09IGQuZGVoeWRyYXRlZCkge2lmIChudWxsID09PQogICAgICAgICAgICAgICAgICAgIGEpIHtpZiAoIWYpIHRocm93IEVycm9yKHAoMzE4KSk7ZiA9IGIubWVtb2l6ZWRTdGF0ZTtmID0gbnVsbCAhPT0gZiA/IGYuZGVoeWRyYXRlZCA6IG51bGw7aWYgKCFmKSB0aHJvdyBFcnJvcihwKDMxNykpO2ZbT2ZdID0gYjt9IGVsc2UgSWcoKSwgMCA9PT0gKGIuZmxhZ3MgJiAxMjgpICYmIChiLm1lbW9pemVkU3RhdGUgPSBudWxsKSwgYi5mbGFncyB8PSA0O1MoYik7ZiA9ICExO30gZWxzZSBudWxsICE9PSB6ZyAmJiAoR2ooemcpLCB6ZyA9IG51bGwpLCBmID0gITA7aWYgKCFmKSByZXR1cm4gYi5mbGFncyAmIDY1NTM2ID8gYiA6IG51bGw7fWlmICgwICE9PSAoYi5mbGFncyAmIDEyOCkpIHJldHVybiBiLmxhbmVzID0gYywgYjtkID0gbnVsbCAhPT0gZDtkICE9PSAobnVsbCAhPT0gYSAmJiBudWxsICE9PSBhLm1lbW9pemVkU3RhdGUpICYmIGQgJiYgKGIuY2hpbGQuZmxhZ3MgfD0gODE5MiwgMCAhPT0gKGIubW9kZSAmIDEpICYmIChudWxsID09PSBhIHx8IDAgIT09IChNLmN1cnJlbnQgJiAxKSA/IDAgPT09IFQgJiYgKFQgPSAzKSA6IHVqKCkpKTtudWxsICE9PSBiLnVwZGF0ZVF1ZXVlICYmIChiLmZsYWdzIHw9IDQpO1MoYik7cmV0dXJuIG51bGw7Y2FzZSA0OnJldHVybiBKaCgpLAogICAgICAgICAgICAgICAgQmooYSwgYiksIG51bGwgPT09IGEgJiYgc2YoYi5zdGF0ZU5vZGUuY29udGFpbmVySW5mbyksIFMoYiksIG51bGw7Y2FzZSAxMDpyZXR1cm4gUmcoYi50eXBlLl9jb250ZXh0KSwgUyhiKSwgbnVsbDtjYXNlIDE3OnJldHVybiBaZihiLnR5cGUpICYmICRmKCksIFMoYiksIG51bGw7Y2FzZSAxOTpFKE0pO2YgPSBiLm1lbW9pemVkU3RhdGU7aWYgKG51bGwgPT09IGYpIHJldHVybiBTKGIpLCBudWxsO2QgPSAwICE9PSAoYi5mbGFncyAmIDEyOCk7ZyA9IGYucmVuZGVyaW5nO2lmIChudWxsID09PSBnKSB7aWYgKGQpIEVqKGYsICExKTtlbHNlIHtpZiAoMCAhPT0gVCB8fCBudWxsICE9PSBhICYmIDAgIT09IChhLmZsYWdzICYgMTI4KSkgZm9yIChhID0gYi5jaGlsZDsgbnVsbCAhPT0gYTspIHtnID0gTWgoYSk7aWYgKG51bGwgIT09IGcpIHtiLmZsYWdzIHw9IDEyODtFaihmLCAhMSk7ZCA9IGcudXBkYXRlUXVldWU7bnVsbCAhPT0gZCAmJiAoYi51cGRhdGVRdWV1ZSA9IGQsIGIuZmxhZ3MgfD0gNCk7Yi5zdWJ0cmVlRmxhZ3MgPSAwO2QgPSBjO2ZvciAoYyA9IGIuY2hpbGQ7IG51bGwgIT09IGM7KSBmID0gYywgYSA9IGQsIGYuZmxhZ3MgJj0gMTQ2ODAwNjYsCiAgICAgICAgICAgICAgICAgICAgICAgIGcgPSBmLmFsdGVybmF0ZSwgbnVsbCA9PT0gZyA/IChmLmNoaWxkTGFuZXMgPSAwLCBmLmxhbmVzID0gYSwgZi5jaGlsZCA9IG51bGwsIGYuc3VidHJlZUZsYWdzID0gMCwgZi5tZW1vaXplZFByb3BzID0gbnVsbCwgZi5tZW1vaXplZFN0YXRlID0gbnVsbCwgZi51cGRhdGVRdWV1ZSA9IG51bGwsIGYuZGVwZW5kZW5jaWVzID0gbnVsbCwgZi5zdGF0ZU5vZGUgPSBudWxsKSA6IChmLmNoaWxkTGFuZXMgPSBnLmNoaWxkTGFuZXMsIGYubGFuZXMgPSBnLmxhbmVzLCBmLmNoaWxkID0gZy5jaGlsZCwgZi5zdWJ0cmVlRmxhZ3MgPSAwLCBmLmRlbGV0aW9ucyA9IG51bGwsIGYubWVtb2l6ZWRQcm9wcyA9IGcubWVtb2l6ZWRQcm9wcywgZi5tZW1vaXplZFN0YXRlID0gZy5tZW1vaXplZFN0YXRlLCBmLnVwZGF0ZVF1ZXVlID0gZy51cGRhdGVRdWV1ZSwgZi50eXBlID0gZy50eXBlLCBhID0gZy5kZXBlbmRlbmNpZXMsIGYuZGVwZW5kZW5jaWVzID0gbnVsbCA9PT0gYSA/IG51bGwgOiB7IGxhbmVzOiBhLmxhbmVzLCBmaXJzdENvbnRleHQ6IGEuZmlyc3RDb250ZXh0IH0pLCBjID0gYy5zaWJsaW5nO0coTSwgTS5jdXJyZW50ICYgMSB8IDIpO3JldHVybiBiLmNoaWxkO31hID0KICAgICAgICAgICAgICAgICAgICAgIGEuc2libGluZzt9bnVsbCAhPT0gZi50YWlsICYmIEIoKSA+IEhqICYmIChiLmZsYWdzIHw9IDEyOCwgZCA9ICEwLCBFaihmLCAhMSksIGIubGFuZXMgPSA0MTk0MzA0KTt9fSBlbHNlIHtpZiAoIWQpIGlmIChhID0gTWgoZyksIG51bGwgIT09IGEpIHtpZiAoYi5mbGFncyB8PSAxMjgsIGQgPSAhMCwgYyA9IGEudXBkYXRlUXVldWUsIG51bGwgIT09IGMgJiYgKGIudXBkYXRlUXVldWUgPSBjLCBiLmZsYWdzIHw9IDQpLCBFaihmLCAhMCksIG51bGwgPT09IGYudGFpbCAmJiAiaGlkZGVuIiA9PT0gZi50YWlsTW9kZSAmJiAhZy5hbHRlcm5hdGUgJiYgIUkpIHJldHVybiBTKGIpLCBudWxsO30gZWxzZSAyICogQigpIC0gZi5yZW5kZXJpbmdTdGFydFRpbWUgPiBIaiAmJiAxMDczNzQxODI0ICE9PSBjICYmIChiLmZsYWdzIHw9IDEyOCwgZCA9ICEwLCBFaihmLCAhMSksIGIubGFuZXMgPSA0MTk0MzA0KTtmLmlzQmFja3dhcmRzID8gKGcuc2libGluZyA9IGIuY2hpbGQsIGIuY2hpbGQgPSBnKSA6IChjID0gZi5sYXN0LCBudWxsICE9PSBjID8gYy5zaWJsaW5nID0gZyA6IGIuY2hpbGQgPSBnLCBmLmxhc3QgPSBnKTt9aWYgKG51bGwgIT09IGYudGFpbCkgcmV0dXJuIGIgPSBmLnRhaWwsIGYucmVuZGVyaW5nID0KICAgICAgICAgICAgICAgIGIsIGYudGFpbCA9IGIuc2libGluZywgZi5yZW5kZXJpbmdTdGFydFRpbWUgPSBCKCksIGIuc2libGluZyA9IG51bGwsIGMgPSBNLmN1cnJlbnQsIEcoTSwgZCA/IGMgJiAxIHwgMiA6IGMgJiAxKSwgYjtTKGIpO3JldHVybiBudWxsO2Nhc2UgMjI6Y2FzZSAyMzpyZXR1cm4gSWooKSwgZCA9IG51bGwgIT09IGIubWVtb2l6ZWRTdGF0ZSwgbnVsbCAhPT0gYSAmJiBudWxsICE9PSBhLm1lbW9pemVkU3RhdGUgIT09IGQgJiYgKGIuZmxhZ3MgfD0gODE5MiksIGQgJiYgMCAhPT0gKGIubW9kZSAmIDEpID8gMCAhPT0gKGdqICYgMTA3Mzc0MTgyNCkgJiYgKFMoYiksIGIuc3VidHJlZUZsYWdzICYgNiAmJiAoYi5mbGFncyB8PSA4MTkyKSkgOiBTKGIpLCBudWxsO2Nhc2UgMjQ6cmV0dXJuIG51bGw7Y2FzZSAyNTpyZXR1cm4gbnVsbDt9dGhyb3cgRXJyb3IocCgxNTYsIGIudGFnKSk7fQogICAgICAgICAgZnVuY3Rpb24gSmooYSwgYikge3dnKGIpO3N3aXRjaCAoYi50YWcpIHtjYXNlIDE6cmV0dXJuIFpmKGIudHlwZSkgJiYgJGYoKSwgYSA9IGIuZmxhZ3MsIGEgJiA2NTUzNiA/IChiLmZsYWdzID0gYSAmIC02NTUzNyB8IDEyOCwgYikgOiBudWxsO2Nhc2UgMzpyZXR1cm4gSmgoKSwgRShXZiksIEUoSCksIE9oKCksIGEgPSBiLmZsYWdzLCAwICE9PSAoYSAmIDY1NTM2KSAmJiAwID09PSAoYSAmIDEyOCkgPyAoYi5mbGFncyA9IGEgJiAtNjU1MzcgfCAxMjgsIGIpIDogbnVsbDtjYXNlIDU6cmV0dXJuIExoKGIpLCBudWxsO2Nhc2UgMTM6RShNKTthID0gYi5tZW1vaXplZFN0YXRlO2lmIChudWxsICE9PSBhICYmIG51bGwgIT09IGEuZGVoeWRyYXRlZCkge2lmIChudWxsID09PSBiLmFsdGVybmF0ZSkgdGhyb3cgRXJyb3IocCgzNDApKTtJZygpO31hID0gYi5mbGFncztyZXR1cm4gYSAmIDY1NTM2ID8gKGIuZmxhZ3MgPSBhICYgLTY1NTM3IHwgMTI4LCBiKSA6IG51bGw7Y2FzZSAxOTpyZXR1cm4gRShNKSwgbnVsbDtjYXNlIDQ6cmV0dXJuIEpoKCksIG51bGw7Y2FzZSAxMDpyZXR1cm4gUmcoYi50eXBlLl9jb250ZXh0KSwgbnVsbDtjYXNlIDIyOmNhc2UgMjM6cmV0dXJuIElqKCksCiAgICAgICAgICAgICAgICBudWxsO2Nhc2UgMjQ6cmV0dXJuIG51bGw7ZGVmYXVsdDpyZXR1cm4gbnVsbDt9fXZhciBLaiA9ICExLFUgPSAhMSxMaiA9ICJmdW5jdGlvbiIgPT09IHR5cGVvZiBXZWFrU2V0ID8gV2Vha1NldCA6IFNldCxWID0gbnVsbDtmdW5jdGlvbiBNaihhLCBiKSB7dmFyIGMgPSBhLnJlZjtpZiAobnVsbCAhPT0gYykgaWYgKCJmdW5jdGlvbiIgPT09IHR5cGVvZiBjKSB0cnkge2MobnVsbCk7fSBjYXRjaCAoZCkge1coYSwgYiwgZCk7fSBlbHNlIGMuY3VycmVudCA9IG51bGw7fWZ1bmN0aW9uIE5qKGEsIGIsIGMpIHt0cnkge2MoKTt9IGNhdGNoIChkKSB7VyhhLCBiLCBkKTt9fXZhciBPaiA9ICExOwogICAgICAgICAgZnVuY3Rpb24gUGooYSwgYikge0NmID0gZGQ7YSA9IE1lKCk7aWYgKE5lKGEpKSB7aWYgKCJzZWxlY3Rpb25TdGFydCIgaW4gYSkgdmFyIGMgPSB7IHN0YXJ0OiBhLnNlbGVjdGlvblN0YXJ0LCBlbmQ6IGEuc2VsZWN0aW9uRW5kIH07ZWxzZSBhOiB7YyA9IChjID0gYS5vd25lckRvY3VtZW50KSAmJiBjLmRlZmF1bHRWaWV3IHx8IHdpbmRvdzt2YXIgZCA9IGMuZ2V0U2VsZWN0aW9uICYmIGMuZ2V0U2VsZWN0aW9uKCk7aWYgKGQgJiYgMCAhPT0gZC5yYW5nZUNvdW50KSB7YyA9IGQuYW5jaG9yTm9kZTt2YXIgZSA9IGQuYW5jaG9yT2Zmc2V0LGYgPSBkLmZvY3VzTm9kZTtkID0gZC5mb2N1c09mZnNldDt0cnkge2Mubm9kZVR5cGUsIGYubm9kZVR5cGU7fSBjYXRjaCAoRikge2MgPSBudWxsO2JyZWFrIGE7fXZhciBnID0gMCxoID0gLTEsayA9IC0xLGwgPSAwLG0gPSAwLHEgPSBhLHIgPSBudWxsO2I6IGZvciAoOzspIHtmb3IgKHZhciB5OzspIHtxICE9PSBjIHx8IDAgIT09IGUgJiYgMyAhPT0gcS5ub2RlVHlwZSB8fCAoaCA9IGcgKyBlKTtxICE9PSBmIHx8IDAgIT09IGQgJiYgMyAhPT0gcS5ub2RlVHlwZSB8fCAoayA9IGcgKyBkKTszID09PSBxLm5vZGVUeXBlICYmIChnICs9CiAgICAgICAgICAgICAgICAgICAgICBxLm5vZGVWYWx1ZS5sZW5ndGgpO2lmIChudWxsID09PSAoeSA9IHEuZmlyc3RDaGlsZCkpIGJyZWFrO3IgPSBxO3EgPSB5O31mb3IgKDs7KSB7aWYgKHEgPT09IGEpIGJyZWFrIGI7ciA9PT0gYyAmJiArK2wgPT09IGUgJiYgKGggPSBnKTtyID09PSBmICYmICsrbSA9PT0gZCAmJiAoayA9IGcpO2lmIChudWxsICE9PSAoeSA9IHEubmV4dFNpYmxpbmcpKSBicmVhaztxID0gcjtyID0gcS5wYXJlbnROb2RlO31xID0geTt9YyA9IC0xID09PSBoIHx8IC0xID09PSBrID8gbnVsbCA6IHsgc3RhcnQ6IGgsIGVuZDogayB9O30gZWxzZSBjID0gbnVsbDt9YyA9IGMgfHwgeyBzdGFydDogMCwgZW5kOiAwIH07fSBlbHNlIGMgPSBudWxsO0RmID0geyBmb2N1c2VkRWxlbTogYSwgc2VsZWN0aW9uUmFuZ2U6IGMgfTtkZCA9ICExO2ZvciAoViA9IGI7IG51bGwgIT09IFY7KSBpZiAoYiA9IFYsIGEgPSBiLmNoaWxkLCAwICE9PSAoYi5zdWJ0cmVlRmxhZ3MgJiAxMDI4KSAmJiBudWxsICE9PSBhKSBhLnJldHVybiA9IGIsIFYgPSBhO2Vsc2UgZm9yICg7IG51bGwgIT09IFY7KSB7YiA9IFY7dHJ5IHt2YXIgbiA9IGIuYWx0ZXJuYXRlO2lmICgwICE9PSAoYi5mbGFncyAmIDEwMjQpKSBzd2l0Y2ggKGIudGFnKSB7Y2FzZSAwOmNhc2UgMTE6Y2FzZSAxNTpicmVhazsKICAgICAgICAgICAgICAgICAgY2FzZSAxOmlmIChudWxsICE9PSBuKSB7dmFyIHQgPSBuLm1lbW9pemVkUHJvcHMsSiA9IG4ubWVtb2l6ZWRTdGF0ZSx4ID0gYi5zdGF0ZU5vZGUsdyA9IHguZ2V0U25hcHNob3RCZWZvcmVVcGRhdGUoYi5lbGVtZW50VHlwZSA9PT0gYi50eXBlID8gdCA6IExnKGIudHlwZSwgdCksIEopO3guX19yZWFjdEludGVybmFsU25hcHNob3RCZWZvcmVVcGRhdGUgPSB3O31icmVhaztjYXNlIDM6dmFyIHUgPSBiLnN0YXRlTm9kZS5jb250YWluZXJJbmZvOzEgPT09IHUubm9kZVR5cGUgPyB1LnRleHRDb250ZW50ID0gIiIgOiA5ID09PSB1Lm5vZGVUeXBlICYmIHUuZG9jdW1lbnRFbGVtZW50ICYmIHUucmVtb3ZlQ2hpbGQodS5kb2N1bWVudEVsZW1lbnQpO2JyZWFrO2Nhc2UgNTpjYXNlIDY6Y2FzZSA0OmNhc2UgMTc6YnJlYWs7ZGVmYXVsdDp0aHJvdyBFcnJvcihwKDE2MykpO319IGNhdGNoIChGKSB7VyhiLCBiLnJldHVybiwgRik7fWEgPSBiLnNpYmxpbmc7aWYgKG51bGwgIT09IGEpIHthLnJldHVybiA9IGIucmV0dXJuO1YgPSBhO2JyZWFrO31WID0gYi5yZXR1cm47fW4gPSBPajtPaiA9ICExO3JldHVybiBuO30KICAgICAgICAgIGZ1bmN0aW9uIFFqKGEsIGIsIGMpIHt2YXIgZCA9IGIudXBkYXRlUXVldWU7ZCA9IG51bGwgIT09IGQgPyBkLmxhc3RFZmZlY3QgOiBudWxsO2lmIChudWxsICE9PSBkKSB7dmFyIGUgPSBkID0gZC5uZXh0O2RvIHtpZiAoKGUudGFnICYgYSkgPT09IGEpIHt2YXIgZiA9IGUuZGVzdHJveTtlLmRlc3Ryb3kgPSB2b2lkIDA7dm9pZCAwICE9PSBmICYmIE5qKGIsIGMsIGYpO31lID0gZS5uZXh0O30gd2hpbGUgKGUgIT09IGQpO319ZnVuY3Rpb24gUmooYSwgYikge2IgPSBiLnVwZGF0ZVF1ZXVlO2IgPSBudWxsICE9PSBiID8gYi5sYXN0RWZmZWN0IDogbnVsbDtpZiAobnVsbCAhPT0gYikge3ZhciBjID0gYiA9IGIubmV4dDtkbyB7aWYgKChjLnRhZyAmIGEpID09PSBhKSB7dmFyIGQgPSBjLmNyZWF0ZTtjLmRlc3Ryb3kgPSBkKCk7fWMgPSBjLm5leHQ7fSB3aGlsZSAoYyAhPT0gYik7fX1mdW5jdGlvbiBTaihhKSB7dmFyIGIgPSBhLnJlZjtpZiAobnVsbCAhPT0gYikge3ZhciBjID0gYS5zdGF0ZU5vZGU7c3dpdGNoIChhLnRhZykge2Nhc2UgNTphID0gYzticmVhaztkZWZhdWx0OmEgPSBjO30iZnVuY3Rpb24iID09PSB0eXBlb2YgYiA/IGIoYSkgOiBiLmN1cnJlbnQgPSBhO319CiAgICAgICAgICBmdW5jdGlvbiBUaihhKSB7dmFyIGIgPSBhLmFsdGVybmF0ZTtudWxsICE9PSBiICYmIChhLmFsdGVybmF0ZSA9IG51bGwsIFRqKGIpKTthLmNoaWxkID0gbnVsbDthLmRlbGV0aW9ucyA9IG51bGw7YS5zaWJsaW5nID0gbnVsbDs1ID09PSBhLnRhZyAmJiAoYiA9IGEuc3RhdGVOb2RlLCBudWxsICE9PSBiICYmIChkZWxldGUgYltPZl0sIGRlbGV0ZSBiW1BmXSwgZGVsZXRlIGJbb2ZdLCBkZWxldGUgYltRZl0sIGRlbGV0ZSBiW1JmXSkpO2Euc3RhdGVOb2RlID0gbnVsbDthLnJldHVybiA9IG51bGw7YS5kZXBlbmRlbmNpZXMgPSBudWxsO2EubWVtb2l6ZWRQcm9wcyA9IG51bGw7YS5tZW1vaXplZFN0YXRlID0gbnVsbDthLnBlbmRpbmdQcm9wcyA9IG51bGw7YS5zdGF0ZU5vZGUgPSBudWxsO2EudXBkYXRlUXVldWUgPSBudWxsO31mdW5jdGlvbiBVaihhKSB7cmV0dXJuIDUgPT09IGEudGFnIHx8IDMgPT09IGEudGFnIHx8IDQgPT09IGEudGFnO30KICAgICAgICAgIGZ1bmN0aW9uIFZqKGEpIHthOiBmb3IgKDs7KSB7Zm9yICg7IG51bGwgPT09IGEuc2libGluZzspIHtpZiAobnVsbCA9PT0gYS5yZXR1cm4gfHwgVWooYS5yZXR1cm4pKSByZXR1cm4gbnVsbDthID0gYS5yZXR1cm47fWEuc2libGluZy5yZXR1cm4gPSBhLnJldHVybjtmb3IgKGEgPSBhLnNpYmxpbmc7IDUgIT09IGEudGFnICYmIDYgIT09IGEudGFnICYmIDE4ICE9PSBhLnRhZzspIHtpZiAoYS5mbGFncyAmIDIpIGNvbnRpbnVlIGE7aWYgKG51bGwgPT09IGEuY2hpbGQgfHwgNCA9PT0gYS50YWcpIGNvbnRpbnVlIGE7ZWxzZSBhLmNoaWxkLnJldHVybiA9IGEsIGEgPSBhLmNoaWxkO31pZiAoIShhLmZsYWdzICYgMikpIHJldHVybiBhLnN0YXRlTm9kZTt9fQogICAgICAgICAgZnVuY3Rpb24gV2ooYSwgYiwgYykge3ZhciBkID0gYS50YWc7aWYgKDUgPT09IGQgfHwgNiA9PT0gZCkgYSA9IGEuc3RhdGVOb2RlLCBiID8gOCA9PT0gYy5ub2RlVHlwZSA/IGMucGFyZW50Tm9kZS5pbnNlcnRCZWZvcmUoYSwgYikgOiBjLmluc2VydEJlZm9yZShhLCBiKSA6ICg4ID09PSBjLm5vZGVUeXBlID8gKGIgPSBjLnBhcmVudE5vZGUsIGIuaW5zZXJ0QmVmb3JlKGEsIGMpKSA6IChiID0gYywgYi5hcHBlbmRDaGlsZChhKSksIGMgPSBjLl9yZWFjdFJvb3RDb250YWluZXIsIG51bGwgIT09IGMgJiYgdm9pZCAwICE9PSBjIHx8IG51bGwgIT09IGIub25jbGljayB8fCAoYi5vbmNsaWNrID0gQmYpKTtlbHNlIGlmICg0ICE9PSBkICYmIChhID0gYS5jaGlsZCwgbnVsbCAhPT0gYSkpIGZvciAoV2ooYSwgYiwgYyksIGEgPSBhLnNpYmxpbmc7IG51bGwgIT09IGE7KSBXaihhLCBiLCBjKSwgYSA9IGEuc2libGluZzt9CiAgICAgICAgICBmdW5jdGlvbiBYaihhLCBiLCBjKSB7dmFyIGQgPSBhLnRhZztpZiAoNSA9PT0gZCB8fCA2ID09PSBkKSBhID0gYS5zdGF0ZU5vZGUsIGIgPyBjLmluc2VydEJlZm9yZShhLCBiKSA6IGMuYXBwZW5kQ2hpbGQoYSk7ZWxzZSBpZiAoNCAhPT0gZCAmJiAoYSA9IGEuY2hpbGQsIG51bGwgIT09IGEpKSBmb3IgKFhqKGEsIGIsIGMpLCBhID0gYS5zaWJsaW5nOyBudWxsICE9PSBhOykgWGooYSwgYiwgYyksIGEgPSBhLnNpYmxpbmc7fXZhciBYID0gbnVsbCxZaiA9ICExO2Z1bmN0aW9uIFpqKGEsIGIsIGMpIHtmb3IgKGMgPSBjLmNoaWxkOyBudWxsICE9PSBjOykgYWsoYSwgYiwgYyksIGMgPSBjLnNpYmxpbmc7fQogICAgICAgICAgZnVuY3Rpb24gYWsoYSwgYiwgYykge2lmIChsYyAmJiAiZnVuY3Rpb24iID09PSB0eXBlb2YgbGMub25Db21taXRGaWJlclVubW91bnQpIHRyeSB7bGMub25Db21taXRGaWJlclVubW91bnQoa2MsIGMpO30gY2F0Y2ggKGgpIHt9c3dpdGNoIChjLnRhZykge2Nhc2UgNTpVIHx8IE1qKGMsIGIpO2Nhc2UgNjp2YXIgZCA9IFgsZSA9IFlqO1ggPSBudWxsO1pqKGEsIGIsIGMpO1ggPSBkO1lqID0gZTtudWxsICE9PSBYICYmIChZaiA/IChhID0gWCwgYyA9IGMuc3RhdGVOb2RlLCA4ID09PSBhLm5vZGVUeXBlID8gYS5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKGMpIDogYS5yZW1vdmVDaGlsZChjKSkgOiBYLnJlbW92ZUNoaWxkKGMuc3RhdGVOb2RlKSk7YnJlYWs7Y2FzZSAxODpudWxsICE9PSBYICYmIChZaiA/IChhID0gWCwgYyA9IGMuc3RhdGVOb2RlLCA4ID09PSBhLm5vZGVUeXBlID8gS2YoYS5wYXJlbnROb2RlLCBjKSA6IDEgPT09IGEubm9kZVR5cGUgJiYgS2YoYSwgYyksIGJkKGEpKSA6IEtmKFgsIGMuc3RhdGVOb2RlKSk7YnJlYWs7Y2FzZSA0OmQgPSBYO2UgPSBZajtYID0gYy5zdGF0ZU5vZGUuY29udGFpbmVySW5mbztZaiA9ICEwOwogICAgICAgICAgICAgICAgWmooYSwgYiwgYyk7WCA9IGQ7WWogPSBlO2JyZWFrO2Nhc2UgMDpjYXNlIDExOmNhc2UgMTQ6Y2FzZSAxNTppZiAoIVUgJiYgKGQgPSBjLnVwZGF0ZVF1ZXVlLCBudWxsICE9PSBkICYmIChkID0gZC5sYXN0RWZmZWN0LCBudWxsICE9PSBkKSkpIHtlID0gZCA9IGQubmV4dDtkbyB7dmFyIGYgPSBlLGcgPSBmLmRlc3Ryb3k7ZiA9IGYudGFnO3ZvaWQgMCAhPT0gZyAmJiAoMCAhPT0gKGYgJiAyKSA/IE5qKGMsIGIsIGcpIDogMCAhPT0gKGYgJiA0KSAmJiBOaihjLCBiLCBnKSk7ZSA9IGUubmV4dDt9IHdoaWxlIChlICE9PSBkKTt9WmooYSwgYiwgYyk7YnJlYWs7Y2FzZSAxOmlmICghVSAmJiAoTWooYywgYiksIGQgPSBjLnN0YXRlTm9kZSwgImZ1bmN0aW9uIiA9PT0gdHlwZW9mIGQuY29tcG9uZW50V2lsbFVubW91bnQpKSB0cnkge2QucHJvcHMgPSBjLm1lbW9pemVkUHJvcHMsIGQuc3RhdGUgPSBjLm1lbW9pemVkU3RhdGUsIGQuY29tcG9uZW50V2lsbFVubW91bnQoKTt9IGNhdGNoIChoKSB7VyhjLCBiLCBoKTt9WmooYSwgYiwgYyk7YnJlYWs7Y2FzZSAyMTpaaihhLCBiLCBjKTticmVhaztjYXNlIDIyOmMubW9kZSAmIDEgPyAoVSA9IChkID0gVSkgfHwgbnVsbCAhPT0KICAgICAgICAgICAgICAgIGMubWVtb2l6ZWRTdGF0ZSwgWmooYSwgYiwgYyksIFUgPSBkKSA6IFpqKGEsIGIsIGMpO2JyZWFrO2RlZmF1bHQ6WmooYSwgYiwgYyk7fX1mdW5jdGlvbiBiayhhKSB7dmFyIGIgPSBhLnVwZGF0ZVF1ZXVlO2lmIChudWxsICE9PSBiKSB7YS51cGRhdGVRdWV1ZSA9IG51bGw7dmFyIGMgPSBhLnN0YXRlTm9kZTtudWxsID09PSBjICYmIChjID0gYS5zdGF0ZU5vZGUgPSBuZXcgTGooKSk7Yi5mb3JFYWNoKGZ1bmN0aW9uIChiKSB7dmFyIGQgPSBjay5iaW5kKG51bGwsIGEsIGIpO2MuaGFzKGIpIHx8IChjLmFkZChiKSwgYi50aGVuKGQsIGQpKTt9KTt9fQogICAgICAgICAgZnVuY3Rpb24gZGsoYSwgYikge3ZhciBjID0gYi5kZWxldGlvbnM7aWYgKG51bGwgIT09IGMpIGZvciAodmFyIGQgPSAwOyBkIDwgYy5sZW5ndGg7IGQrKykge3ZhciBlID0gY1tkXTt0cnkge3ZhciBmID0gYSxnID0gYixoID0gZzthOiBmb3IgKDsgbnVsbCAhPT0gaDspIHtzd2l0Y2ggKGgudGFnKSB7Y2FzZSA1OlggPSBoLnN0YXRlTm9kZTtZaiA9ICExO2JyZWFrIGE7Y2FzZSAzOlggPSBoLnN0YXRlTm9kZS5jb250YWluZXJJbmZvO1lqID0gITA7YnJlYWsgYTtjYXNlIDQ6WCA9IGguc3RhdGVOb2RlLmNvbnRhaW5lckluZm87WWogPSAhMDticmVhayBhO31oID0gaC5yZXR1cm47fWlmIChudWxsID09PSBYKSB0aHJvdyBFcnJvcihwKDE2MCkpO2FrKGYsIGcsIGUpO1ggPSBudWxsO1lqID0gITE7dmFyIGsgPSBlLmFsdGVybmF0ZTtudWxsICE9PSBrICYmIChrLnJldHVybiA9IG51bGwpO2UucmV0dXJuID0gbnVsbDt9IGNhdGNoIChsKSB7VyhlLCBiLCBsKTt9fWlmIChiLnN1YnRyZWVGbGFncyAmIDEyODU0KSBmb3IgKGIgPSBiLmNoaWxkOyBudWxsICE9PSBiOykgZWsoYiwgYSksIGIgPSBiLnNpYmxpbmc7fQogICAgICAgICAgZnVuY3Rpb24gZWsoYSwgYikge3ZhciBjID0gYS5hbHRlcm5hdGUsZCA9IGEuZmxhZ3M7c3dpdGNoIChhLnRhZykge2Nhc2UgMDpjYXNlIDExOmNhc2UgMTQ6Y2FzZSAxNTpkayhiLCBhKTtmayhhKTtpZiAoZCAmIDQpIHt0cnkge1FqKDMsIGEsIGEucmV0dXJuKSwgUmooMywgYSk7fSBjYXRjaCAodCkge1coYSwgYS5yZXR1cm4sIHQpO310cnkge1FqKDUsIGEsIGEucmV0dXJuKTt9IGNhdGNoICh0KSB7VyhhLCBhLnJldHVybiwgdCk7fX1icmVhaztjYXNlIDE6ZGsoYiwgYSk7ZmsoYSk7ZCAmIDUxMiAmJiBudWxsICE9PSBjICYmIE1qKGMsIGMucmV0dXJuKTticmVhaztjYXNlIDU6ZGsoYiwgYSk7ZmsoYSk7ZCAmIDUxMiAmJiBudWxsICE9PSBjICYmIE1qKGMsIGMucmV0dXJuKTtpZiAoYS5mbGFncyAmIDMyKSB7dmFyIGUgPSBhLnN0YXRlTm9kZTt0cnkge29iKGUsICIiKTt9IGNhdGNoICh0KSB7VyhhLCBhLnJldHVybiwgdCk7fX1pZiAoZCAmIDQgJiYgKGUgPSBhLnN0YXRlTm9kZSwgbnVsbCAhPSBlKSkge3ZhciBmID0gYS5tZW1vaXplZFByb3BzLGcgPSBudWxsICE9PSBjID8gYy5tZW1vaXplZFByb3BzIDogZixoID0gYS50eXBlLGsgPSBhLnVwZGF0ZVF1ZXVlOwogICAgICAgICAgICAgICAgICBhLnVwZGF0ZVF1ZXVlID0gbnVsbDtpZiAobnVsbCAhPT0gaykgdHJ5IHsiaW5wdXQiID09PSBoICYmICJyYWRpbyIgPT09IGYudHlwZSAmJiBudWxsICE9IGYubmFtZSAmJiBhYihlLCBmKTt2YihoLCBnKTt2YXIgbCA9IHZiKGgsIGYpO2ZvciAoZyA9IDA7IGcgPCBrLmxlbmd0aDsgZyArPSAyKSB7dmFyIG0gPSBrW2ddLHEgPSBrW2cgKyAxXTsic3R5bGUiID09PSBtID8gc2IoZSwgcSkgOiAiZGFuZ2Vyb3VzbHlTZXRJbm5lckhUTUwiID09PSBtID8gbmIoZSwgcSkgOiAiY2hpbGRyZW4iID09PSBtID8gb2IoZSwgcSkgOiB0YShlLCBtLCBxLCBsKTt9c3dpdGNoIChoKSB7Y2FzZSAiaW5wdXQiOmJiKGUsIGYpO2JyZWFrO2Nhc2UgInRleHRhcmVhIjppYihlLCBmKTticmVhaztjYXNlICJzZWxlY3QiOnZhciByID0gZS5fd3JhcHBlclN0YXRlLndhc011bHRpcGxlO2UuX3dyYXBwZXJTdGF0ZS53YXNNdWx0aXBsZSA9ICEhZi5tdWx0aXBsZTt2YXIgeSA9IGYudmFsdWU7bnVsbCAhPSB5ID8gZmIoZSwgISFmLm11bHRpcGxlLCB5LCAhMSkgOiByICE9PSAhIWYubXVsdGlwbGUgJiYgKG51bGwgIT0gZi5kZWZhdWx0VmFsdWUgPyBmYihlLCAhIWYubXVsdGlwbGUsCiAgICAgICAgICAgICAgICAgICAgICAgIGYuZGVmYXVsdFZhbHVlLCAhMCkgOiBmYihlLCAhIWYubXVsdGlwbGUsIGYubXVsdGlwbGUgPyBbXSA6ICIiLCAhMSkpO31lW1BmXSA9IGY7fSBjYXRjaCAodCkge1coYSwgYS5yZXR1cm4sIHQpO319YnJlYWs7Y2FzZSA2OmRrKGIsIGEpO2ZrKGEpO2lmIChkICYgNCkge2lmIChudWxsID09PSBhLnN0YXRlTm9kZSkgdGhyb3cgRXJyb3IocCgxNjIpKTtlID0gYS5zdGF0ZU5vZGU7ZiA9IGEubWVtb2l6ZWRQcm9wczt0cnkge2Uubm9kZVZhbHVlID0gZjt9IGNhdGNoICh0KSB7VyhhLCBhLnJldHVybiwgdCk7fX1icmVhaztjYXNlIDM6ZGsoYiwgYSk7ZmsoYSk7aWYgKGQgJiA0ICYmIG51bGwgIT09IGMgJiYgYy5tZW1vaXplZFN0YXRlLmlzRGVoeWRyYXRlZCkgdHJ5IHtiZChiLmNvbnRhaW5lckluZm8pO30gY2F0Y2ggKHQpIHtXKGEsIGEucmV0dXJuLCB0KTt9YnJlYWs7Y2FzZSA0OmRrKGIsIGEpO2ZrKGEpO2JyZWFrO2Nhc2UgMTM6ZGsoYiwgYSk7ZmsoYSk7ZSA9IGEuY2hpbGQ7ZS5mbGFncyAmIDgxOTIgJiYgKGYgPSBudWxsICE9PSBlLm1lbW9pemVkU3RhdGUsIGUuc3RhdGVOb2RlLmlzSGlkZGVuID0gZiwgIWYgfHwKICAgICAgICAgICAgICAgIG51bGwgIT09IGUuYWx0ZXJuYXRlICYmIG51bGwgIT09IGUuYWx0ZXJuYXRlLm1lbW9pemVkU3RhdGUgfHwgKGdrID0gQigpKSk7ZCAmIDQgJiYgYmsoYSk7YnJlYWs7Y2FzZSAyMjptID0gbnVsbCAhPT0gYyAmJiBudWxsICE9PSBjLm1lbW9pemVkU3RhdGU7YS5tb2RlICYgMSA/IChVID0gKGwgPSBVKSB8fCBtLCBkayhiLCBhKSwgVSA9IGwpIDogZGsoYiwgYSk7ZmsoYSk7aWYgKGQgJiA4MTkyKSB7bCA9IG51bGwgIT09IGEubWVtb2l6ZWRTdGF0ZTtpZiAoKGEuc3RhdGVOb2RlLmlzSGlkZGVuID0gbCkgJiYgIW0gJiYgMCAhPT0gKGEubW9kZSAmIDEpKSBmb3IgKFYgPSBhLCBtID0gYS5jaGlsZDsgbnVsbCAhPT0gbTspIHtmb3IgKHEgPSBWID0gbTsgbnVsbCAhPT0gVjspIHtyID0gVjt5ID0gci5jaGlsZDtzd2l0Y2ggKHIudGFnKSB7Y2FzZSAwOmNhc2UgMTE6Y2FzZSAxNDpjYXNlIDE1OlFqKDQsIHIsIHIucmV0dXJuKTticmVhaztjYXNlIDE6TWoociwgci5yZXR1cm4pO3ZhciBuID0gci5zdGF0ZU5vZGU7aWYgKCJmdW5jdGlvbiIgPT09IHR5cGVvZiBuLmNvbXBvbmVudFdpbGxVbm1vdW50KSB7ZCA9IHI7YyA9IHIucmV0dXJuO3RyeSB7YiA9IGQsIG4ucHJvcHMgPQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBiLm1lbW9pemVkUHJvcHMsIG4uc3RhdGUgPSBiLm1lbW9pemVkU3RhdGUsIG4uY29tcG9uZW50V2lsbFVubW91bnQoKTt9IGNhdGNoICh0KSB7VyhkLCBjLCB0KTt9fWJyZWFrO2Nhc2UgNTpNaihyLCByLnJldHVybik7YnJlYWs7Y2FzZSAyMjppZiAobnVsbCAhPT0gci5tZW1vaXplZFN0YXRlKSB7aGsocSk7Y29udGludWU7fX1udWxsICE9PSB5ID8gKHkucmV0dXJuID0gciwgViA9IHkpIDogaGsocSk7fW0gPSBtLnNpYmxpbmc7fWE6IGZvciAobSA9IG51bGwsIHEgPSBhOzspIHtpZiAoNSA9PT0gcS50YWcpIHtpZiAobnVsbCA9PT0gbSkge20gPSBxO3RyeSB7ZSA9IHEuc3RhdGVOb2RlLCBsID8gKGYgPSBlLnN0eWxlLCAiZnVuY3Rpb24iID09PSB0eXBlb2YgZi5zZXRQcm9wZXJ0eSA/IGYuc2V0UHJvcGVydHkoImRpc3BsYXkiLCAibm9uZSIsICJpbXBvcnRhbnQiKSA6IGYuZGlzcGxheSA9ICJub25lIikgOiAoaCA9IHEuc3RhdGVOb2RlLCBrID0gcS5tZW1vaXplZFByb3BzLnN0eWxlLCBnID0gdm9pZCAwICE9PSBrICYmIG51bGwgIT09IGsgJiYgay5oYXNPd25Qcm9wZXJ0eSgiZGlzcGxheSIpID8gay5kaXNwbGF5IDogbnVsbCwgaC5zdHlsZS5kaXNwbGF5ID0KICAgICAgICAgICAgICAgICAgICAgICAgICByYigiZGlzcGxheSIsIGcpKTt9IGNhdGNoICh0KSB7VyhhLCBhLnJldHVybiwgdCk7fX19IGVsc2UgaWYgKDYgPT09IHEudGFnKSB7aWYgKG51bGwgPT09IG0pIHRyeSB7cS5zdGF0ZU5vZGUubm9kZVZhbHVlID0gbCA/ICIiIDogcS5tZW1vaXplZFByb3BzO30gY2F0Y2ggKHQpIHtXKGEsIGEucmV0dXJuLCB0KTt9fSBlbHNlIGlmICgoMjIgIT09IHEudGFnICYmIDIzICE9PSBxLnRhZyB8fCBudWxsID09PSBxLm1lbW9pemVkU3RhdGUgfHwgcSA9PT0gYSkgJiYgbnVsbCAhPT0gcS5jaGlsZCkge3EuY2hpbGQucmV0dXJuID0gcTtxID0gcS5jaGlsZDtjb250aW51ZTt9aWYgKHEgPT09IGEpIGJyZWFrIGE7Zm9yICg7IG51bGwgPT09IHEuc2libGluZzspIHtpZiAobnVsbCA9PT0gcS5yZXR1cm4gfHwgcS5yZXR1cm4gPT09IGEpIGJyZWFrIGE7bSA9PT0gcSAmJiAobSA9IG51bGwpO3EgPSBxLnJldHVybjt9bSA9PT0gcSAmJiAobSA9IG51bGwpO3Euc2libGluZy5yZXR1cm4gPSBxLnJldHVybjtxID0gcS5zaWJsaW5nO319YnJlYWs7Y2FzZSAxOTpkayhiLCBhKTtmayhhKTtkICYgNCAmJiBiayhhKTticmVhaztjYXNlIDIxOmJyZWFrO2RlZmF1bHQ6ZGsoYiwKICAgICAgICAgICAgICAgIGEpLCBmayhhKTt9fWZ1bmN0aW9uIGZrKGEpIHt2YXIgYiA9IGEuZmxhZ3M7aWYgKGIgJiAyKSB7dHJ5IHthOiB7Zm9yICh2YXIgYyA9IGEucmV0dXJuOyBudWxsICE9PSBjOykge2lmIChVaihjKSkge3ZhciBkID0gYzticmVhayBhO31jID0gYy5yZXR1cm47fXRocm93IEVycm9yKHAoMTYwKSk7fXN3aXRjaCAoZC50YWcpIHtjYXNlIDU6dmFyIGUgPSBkLnN0YXRlTm9kZTtkLmZsYWdzICYgMzIgJiYgKG9iKGUsICIiKSwgZC5mbGFncyAmPSAtMzMpO3ZhciBmID0gVmooYSk7WGooYSwgZiwgZSk7YnJlYWs7Y2FzZSAzOmNhc2UgNDp2YXIgZyA9IGQuc3RhdGVOb2RlLmNvbnRhaW5lckluZm8saCA9IFZqKGEpO1dqKGEsIGgsIGcpO2JyZWFrO2RlZmF1bHQ6dGhyb3cgRXJyb3IocCgxNjEpKTt9fSBjYXRjaCAoaykge1coYSwgYS5yZXR1cm4sIGspO31hLmZsYWdzICY9IC0zO31iICYgNDA5NiAmJiAoYS5mbGFncyAmPSAtNDA5Nyk7fWZ1bmN0aW9uIGlrKGEsIGIsIGMpIHtWID0gYTtqayhhLCBiLCBjKTt9CiAgICAgICAgICBmdW5jdGlvbiBqayhhLCBiLCBjKSB7Zm9yICh2YXIgZCA9IDAgIT09IChhLm1vZGUgJiAxKTsgbnVsbCAhPT0gVjspIHt2YXIgZSA9IFYsZiA9IGUuY2hpbGQ7aWYgKDIyID09PSBlLnRhZyAmJiBkKSB7dmFyIGcgPSBudWxsICE9PSBlLm1lbW9pemVkU3RhdGUgfHwgS2o7aWYgKCFnKSB7dmFyIGggPSBlLmFsdGVybmF0ZSxrID0gbnVsbCAhPT0gaCAmJiBudWxsICE9PSBoLm1lbW9pemVkU3RhdGUgfHwgVTtoID0gS2o7dmFyIGwgPSBVO0tqID0gZztpZiAoKFUgPSBrKSAmJiAhbCkgZm9yIChWID0gZTsgbnVsbCAhPT0gVjspIGcgPSBWLCBrID0gZy5jaGlsZCwgMjIgPT09IGcudGFnICYmIG51bGwgIT09IGcubWVtb2l6ZWRTdGF0ZSA/IGtrKGUpIDogbnVsbCAhPT0gayA/IChrLnJldHVybiA9IGcsIFYgPSBrKSA6IGtrKGUpO2ZvciAoOyBudWxsICE9PSBmOykgViA9IGYsIGprKGYsIGIsIGMpLCBmID0gZi5zaWJsaW5nO1YgPSBlO0tqID0gaDtVID0gbDt9bGsoYSwgYiwgYyk7fSBlbHNlIDAgIT09IChlLnN1YnRyZWVGbGFncyAmIDg3NzIpICYmIG51bGwgIT09IGYgPyAoZi5yZXR1cm4gPSBlLCBWID0gZikgOiBsayhhLCBiLCBjKTt9fQogICAgICAgICAgZnVuY3Rpb24gbGsoYSkge2ZvciAoOyBudWxsICE9PSBWOykge3ZhciBiID0gVjtpZiAoMCAhPT0gKGIuZmxhZ3MgJiA4NzcyKSkge3ZhciBjID0gYi5hbHRlcm5hdGU7dHJ5IHtpZiAoMCAhPT0gKGIuZmxhZ3MgJiA4NzcyKSkgc3dpdGNoIChiLnRhZykge2Nhc2UgMDpjYXNlIDExOmNhc2UgMTU6VSB8fCBSaig1LCBiKTticmVhaztjYXNlIDE6dmFyIGQgPSBiLnN0YXRlTm9kZTtpZiAoYi5mbGFncyAmIDQgJiYgIVUpIGlmIChudWxsID09PSBjKSBkLmNvbXBvbmVudERpZE1vdW50KCk7ZWxzZSB7dmFyIGUgPSBiLmVsZW1lbnRUeXBlID09PSBiLnR5cGUgPyBjLm1lbW9pemVkUHJvcHMgOiBMZyhiLnR5cGUsIGMubWVtb2l6ZWRQcm9wcyk7ZC5jb21wb25lbnREaWRVcGRhdGUoZSwgYy5tZW1vaXplZFN0YXRlLCBkLl9fcmVhY3RJbnRlcm5hbFNuYXBzaG90QmVmb3JlVXBkYXRlKTt9dmFyIGYgPSBiLnVwZGF0ZVF1ZXVlO251bGwgIT09IGYgJiYgaWgoYiwgZiwgZCk7YnJlYWs7Y2FzZSAzOnZhciBnID0gYi51cGRhdGVRdWV1ZTtpZiAobnVsbCAhPT0gZykge2MgPSBudWxsO2lmIChudWxsICE9PSBiLmNoaWxkKSBzd2l0Y2ggKGIuY2hpbGQudGFnKSB7Y2FzZSA1OmMgPQogICAgICAgICAgICAgICAgICAgICAgICAgICAgYi5jaGlsZC5zdGF0ZU5vZGU7YnJlYWs7Y2FzZSAxOmMgPSBiLmNoaWxkLnN0YXRlTm9kZTt9aWgoYiwgZywgYyk7fWJyZWFrO2Nhc2UgNTp2YXIgaCA9IGIuc3RhdGVOb2RlO2lmIChudWxsID09PSBjICYmIGIuZmxhZ3MgJiA0KSB7YyA9IGg7dmFyIGsgPSBiLm1lbW9pemVkUHJvcHM7c3dpdGNoIChiLnR5cGUpIHtjYXNlICJidXR0b24iOmNhc2UgImlucHV0IjpjYXNlICJzZWxlY3QiOmNhc2UgInRleHRhcmVhIjprLmF1dG9Gb2N1cyAmJiBjLmZvY3VzKCk7YnJlYWs7Y2FzZSAiaW1nIjprLnNyYyAmJiAoYy5zcmMgPSBrLnNyYyk7fX1icmVhaztjYXNlIDY6YnJlYWs7Y2FzZSA0OmJyZWFrO2Nhc2UgMTI6YnJlYWs7Y2FzZSAxMzppZiAobnVsbCA9PT0gYi5tZW1vaXplZFN0YXRlKSB7dmFyIGwgPSBiLmFsdGVybmF0ZTtpZiAobnVsbCAhPT0gbCkge3ZhciBtID0gbC5tZW1vaXplZFN0YXRlO2lmIChudWxsICE9PSBtKSB7dmFyIHEgPSBtLmRlaHlkcmF0ZWQ7bnVsbCAhPT0gcSAmJiBiZChxKTt9fX1icmVhaztjYXNlIDE5OmNhc2UgMTc6Y2FzZSAyMTpjYXNlIDIyOmNhc2UgMjM6Y2FzZSAyNTpicmVhazsKICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OnRocm93IEVycm9yKHAoMTYzKSk7fVUgfHwgYi5mbGFncyAmIDUxMiAmJiBTaihiKTt9IGNhdGNoIChyKSB7VyhiLCBiLnJldHVybiwgcik7fX1pZiAoYiA9PT0gYSkge1YgPSBudWxsO2JyZWFrO31jID0gYi5zaWJsaW5nO2lmIChudWxsICE9PSBjKSB7Yy5yZXR1cm4gPSBiLnJldHVybjtWID0gYzticmVhazt9ViA9IGIucmV0dXJuO319ZnVuY3Rpb24gaGsoYSkge2ZvciAoOyBudWxsICE9PSBWOykge3ZhciBiID0gVjtpZiAoYiA9PT0gYSkge1YgPSBudWxsO2JyZWFrO312YXIgYyA9IGIuc2libGluZztpZiAobnVsbCAhPT0gYykge2MucmV0dXJuID0gYi5yZXR1cm47ViA9IGM7YnJlYWs7fVYgPSBiLnJldHVybjt9fQogICAgICAgICAgZnVuY3Rpb24ga2soYSkge2ZvciAoOyBudWxsICE9PSBWOykge3ZhciBiID0gVjt0cnkge3N3aXRjaCAoYi50YWcpIHtjYXNlIDA6Y2FzZSAxMTpjYXNlIDE1OnZhciBjID0gYi5yZXR1cm47dHJ5IHtSaig0LCBiKTt9IGNhdGNoIChrKSB7VyhiLCBjLCBrKTt9YnJlYWs7Y2FzZSAxOnZhciBkID0gYi5zdGF0ZU5vZGU7aWYgKCJmdW5jdGlvbiIgPT09IHR5cGVvZiBkLmNvbXBvbmVudERpZE1vdW50KSB7dmFyIGUgPSBiLnJldHVybjt0cnkge2QuY29tcG9uZW50RGlkTW91bnQoKTt9IGNhdGNoIChrKSB7VyhiLCBlLCBrKTt9fXZhciBmID0gYi5yZXR1cm47dHJ5IHtTaihiKTt9IGNhdGNoIChrKSB7VyhiLCBmLCBrKTt9YnJlYWs7Y2FzZSA1OnZhciBnID0gYi5yZXR1cm47dHJ5IHtTaihiKTt9IGNhdGNoIChrKSB7VyhiLCBnLCBrKTt9fX0gY2F0Y2ggKGspIHtXKGIsIGIucmV0dXJuLCBrKTt9aWYgKGIgPT09IGEpIHtWID0gbnVsbDticmVhazt9dmFyIGggPSBiLnNpYmxpbmc7aWYgKG51bGwgIT09IGgpIHtoLnJldHVybiA9IGIucmV0dXJuO1YgPSBoO2JyZWFrO31WID0gYi5yZXR1cm47fX0KICAgICAgICAgIHZhciBtayA9IE1hdGguY2VpbCxuayA9IHVhLlJlYWN0Q3VycmVudERpc3BhdGNoZXIsb2sgPSB1YS5SZWFjdEN1cnJlbnRPd25lcixwayA9IHVhLlJlYWN0Q3VycmVudEJhdGNoQ29uZmlnLEsgPSAwLFIgPSBudWxsLFkgPSBudWxsLFogPSAwLGdqID0gMCxmaiA9IFVmKDApLFQgPSAwLHFrID0gbnVsbCxoaCA9IDAscmsgPSAwLHNrID0gMCx0ayA9IG51bGwsdWsgPSBudWxsLGdrID0gMCxIaiA9IEluZmluaXR5LHZrID0gbnVsbCxQaSA9ICExLFFpID0gbnVsbCxTaSA9IG51bGwsd2sgPSAhMSx4ayA9IG51bGwseWsgPSAwLHprID0gMCxBayA9IG51bGwsQmsgPSAtMSxDayA9IDA7ZnVuY3Rpb24gTCgpIHtyZXR1cm4gMCAhPT0gKEsgJiA2KSA/IEIoKSA6IC0xICE9PSBCayA/IEJrIDogQmsgPSBCKCk7fQogICAgICAgICAgZnVuY3Rpb24gbGgoYSkge2lmICgwID09PSAoYS5tb2RlICYgMSkpIHJldHVybiAxO2lmICgwICE9PSAoSyAmIDIpICYmIDAgIT09IFopIHJldHVybiBaICYgLVo7aWYgKG51bGwgIT09IEtnLnRyYW5zaXRpb24pIHJldHVybiAwID09PSBDayAmJiAoQ2sgPSB5YygpKSwgQ2s7YSA9IEM7aWYgKDAgIT09IGEpIHJldHVybiBhO2EgPSB3aW5kb3cuZXZlbnQ7YSA9IHZvaWQgMCA9PT0gYSA/IDE2IDogamQoYS50eXBlKTtyZXR1cm4gYTt9ZnVuY3Rpb24gbWgoYSwgYiwgYywgZCkge2lmICg1MCA8IHprKSB0aHJvdyB6ayA9IDAsIEFrID0gbnVsbCwgRXJyb3IocCgxODUpKTtBYyhhLCBjLCBkKTtpZiAoMCA9PT0gKEsgJiAyKSB8fCBhICE9PSBSKSBhID09PSBSICYmICgwID09PSAoSyAmIDIpICYmIChyayB8PSBjKSwgNCA9PT0gVCAmJiBEayhhLCBaKSksIEVrKGEsIGQpLCAxID09PSBjICYmIDAgPT09IEsgJiYgMCA9PT0gKGIubW9kZSAmIDEpICYmIChIaiA9IEIoKSArIDUwMCwgZmcgJiYgamcoKSk7fQogICAgICAgICAgZnVuY3Rpb24gRWsoYSwgYikge3ZhciBjID0gYS5jYWxsYmFja05vZGU7d2MoYSwgYik7dmFyIGQgPSB1YyhhLCBhID09PSBSID8gWiA6IDApO2lmICgwID09PSBkKSBudWxsICE9PSBjICYmIGJjKGMpLCBhLmNhbGxiYWNrTm9kZSA9IG51bGwsIGEuY2FsbGJhY2tQcmlvcml0eSA9IDA7ZWxzZSBpZiAoYiA9IGQgJiAtZCwgYS5jYWxsYmFja1ByaW9yaXR5ICE9PSBiKSB7bnVsbCAhPSBjICYmIGJjKGMpO2lmICgxID09PSBiKSAwID09PSBhLnRhZyA/IGlnKEZrLmJpbmQobnVsbCwgYSkpIDogaGcoRmsuYmluZChudWxsLCBhKSksIEpmKGZ1bmN0aW9uICgpIHswID09PSAoSyAmIDYpICYmIGpnKCk7fSksIGMgPSBudWxsO2Vsc2Uge3N3aXRjaCAoRGMoZCkpIHtjYXNlIDE6YyA9IGZjO2JyZWFrO2Nhc2UgNDpjID0gZ2M7YnJlYWs7Y2FzZSAxNjpjID0gaGM7YnJlYWs7Y2FzZSA1MzY4NzA5MTI6YyA9IGpjO2JyZWFrO2RlZmF1bHQ6YyA9IGhjO31jID0gR2soYywgSGsuYmluZChudWxsLCBhKSk7fWEuY2FsbGJhY2tQcmlvcml0eSA9IGI7YS5jYWxsYmFja05vZGUgPSBjO319CiAgICAgICAgICBmdW5jdGlvbiBIayhhLCBiKSB7QmsgPSAtMTtDayA9IDA7aWYgKDAgIT09IChLICYgNikpIHRocm93IEVycm9yKHAoMzI3KSk7dmFyIGMgPSBhLmNhbGxiYWNrTm9kZTtpZiAoSWsoKSAmJiBhLmNhbGxiYWNrTm9kZSAhPT0gYykgcmV0dXJuIG51bGw7dmFyIGQgPSB1YyhhLCBhID09PSBSID8gWiA6IDApO2lmICgwID09PSBkKSByZXR1cm4gbnVsbDtpZiAoMCAhPT0gKGQgJiAzMCkgfHwgMCAhPT0gKGQgJiBhLmV4cGlyZWRMYW5lcykgfHwgYikgYiA9IEprKGEsIGQpO2Vsc2Uge2IgPSBkO3ZhciBlID0gSztLIHw9IDI7dmFyIGYgPSBLaygpO2lmIChSICE9PSBhIHx8IFogIT09IGIpIHZrID0gbnVsbCwgSGogPSBCKCkgKyA1MDAsIExrKGEsIGIpO2RvIHRyeSB7TWsoKTticmVhazt9IGNhdGNoIChoKSB7TmsoYSwgaCk7fSB3aGlsZSAoMSk7UWcoKTtuay5jdXJyZW50ID0gZjtLID0gZTtudWxsICE9PSBZID8gYiA9IDAgOiAoUiA9IG51bGwsIFogPSAwLCBiID0gVCk7fWlmICgwICE9PSBiKSB7MiA9PT0gYiAmJiAoZSA9IHhjKGEpLCAwICE9PSBlICYmIChkID0gZSwgYiA9IE9rKGEsIGUpKSk7aWYgKDEgPT09IGIpIHRocm93IGMgPSBxaywgTGsoYSwgMCksIERrKGEsIGQpLCBFayhhLCBCKCkpLCBjO2lmICg2ID09PSBiKSBEayhhLCBkKTtlbHNlCiAgICAgICAgICAgICAge2UgPSBhLmN1cnJlbnQuYWx0ZXJuYXRlO2lmICgwID09PSAoZCAmIDMwKSAmJiAhUGsoZSkgJiYgKGIgPSBKayhhLCBkKSwgMiA9PT0gYiAmJiAoZiA9IHhjKGEpLCAwICE9PSBmICYmIChkID0gZiwgYiA9IE9rKGEsIGYpKSksIDEgPT09IGIpKSB0aHJvdyBjID0gcWssIExrKGEsIDApLCBEayhhLCBkKSwgRWsoYSwgQigpKSwgYzthLmZpbmlzaGVkV29yayA9IGU7YS5maW5pc2hlZExhbmVzID0gZDtzd2l0Y2ggKGIpIHtjYXNlIDA6Y2FzZSAxOnRocm93IEVycm9yKHAoMzQ1KSk7Y2FzZSAyOlFrKGEsIHVrLCB2ayk7YnJlYWs7Y2FzZSAzOkRrKGEsIGQpO2lmICgoZCAmIDEzMDAyMzQyNCkgPT09IGQgJiYgKGIgPSBnayArIDUwMCAtIEIoKSwgMTAgPCBiKSkge2lmICgwICE9PSB1YyhhLCAwKSkgYnJlYWs7ZSA9IGEuc3VzcGVuZGVkTGFuZXM7aWYgKChlICYgZCkgIT09IGQpIHtMKCk7YS5waW5nZWRMYW5lcyB8PSBhLnN1c3BlbmRlZExhbmVzICYgZTticmVhazt9YS50aW1lb3V0SGFuZGxlID0gRmYoUWsuYmluZChudWxsLCBhLCB1aywgdmspLCBiKTticmVhazt9UWsoYSwgdWssIHZrKTticmVhaztjYXNlIDQ6RGsoYSwgZCk7aWYgKChkICYgNDE5NDI0MCkgPT09CiAgICAgICAgICAgICAgICAgICAgZCkgYnJlYWs7YiA9IGEuZXZlbnRUaW1lcztmb3IgKGUgPSAtMTsgMCA8IGQ7KSB7dmFyIGcgPSAzMSAtIG9jKGQpO2YgPSAxIDw8IGc7ZyA9IGJbZ107ZyA+IGUgJiYgKGUgPSBnKTtkICY9IH5mO31kID0gZTtkID0gQigpIC0gZDtkID0gKDEyMCA+IGQgPyAxMjAgOiA0ODAgPiBkID8gNDgwIDogMTA4MCA+IGQgPyAxMDgwIDogMTkyMCA+IGQgPyAxOTIwIDogM0UzID4gZCA/IDNFMyA6IDQzMjAgPiBkID8gNDMyMCA6IDE5NjAgKiBtayhkIC8gMTk2MCkpIC0gZDtpZiAoMTAgPCBkKSB7YS50aW1lb3V0SGFuZGxlID0gRmYoUWsuYmluZChudWxsLCBhLCB1aywgdmspLCBkKTticmVhazt9UWsoYSwgdWssIHZrKTticmVhaztjYXNlIDU6UWsoYSwgdWssIHZrKTticmVhaztkZWZhdWx0OnRocm93IEVycm9yKHAoMzI5KSk7fX19RWsoYSwgQigpKTtyZXR1cm4gYS5jYWxsYmFja05vZGUgPT09IGMgPyBIay5iaW5kKG51bGwsIGEpIDogbnVsbDt9CiAgICAgICAgICBmdW5jdGlvbiBPayhhLCBiKSB7dmFyIGMgPSB0azthLmN1cnJlbnQubWVtb2l6ZWRTdGF0ZS5pc0RlaHlkcmF0ZWQgJiYgKExrKGEsIGIpLmZsYWdzIHw9IDI1Nik7YSA9IEprKGEsIGIpOzIgIT09IGEgJiYgKGIgPSB1aywgdWsgPSBjLCBudWxsICE9PSBiICYmIEdqKGIpKTtyZXR1cm4gYTt9ZnVuY3Rpb24gR2ooYSkge251bGwgPT09IHVrID8gdWsgPSBhIDogdWsucHVzaC5hcHBseSh1aywgYSk7fQogICAgICAgICAgZnVuY3Rpb24gUGsoYSkge2ZvciAodmFyIGIgPSBhOzspIHtpZiAoYi5mbGFncyAmIDE2Mzg0KSB7dmFyIGMgPSBiLnVwZGF0ZVF1ZXVlO2lmIChudWxsICE9PSBjICYmIChjID0gYy5zdG9yZXMsIG51bGwgIT09IGMpKSBmb3IgKHZhciBkID0gMDsgZCA8IGMubGVuZ3RoOyBkKyspIHt2YXIgZSA9IGNbZF0sZiA9IGUuZ2V0U25hcHNob3Q7ZSA9IGUudmFsdWU7dHJ5IHtpZiAoIUhlKGYoKSwgZSkpIHJldHVybiAhMTt9IGNhdGNoIChnKSB7cmV0dXJuICExO319fWMgPSBiLmNoaWxkO2lmIChiLnN1YnRyZWVGbGFncyAmIDE2Mzg0ICYmIG51bGwgIT09IGMpIGMucmV0dXJuID0gYiwgYiA9IGM7ZWxzZSB7aWYgKGIgPT09IGEpIGJyZWFrO2ZvciAoOyBudWxsID09PSBiLnNpYmxpbmc7KSB7aWYgKG51bGwgPT09IGIucmV0dXJuIHx8IGIucmV0dXJuID09PSBhKSByZXR1cm4gITA7YiA9IGIucmV0dXJuO31iLnNpYmxpbmcucmV0dXJuID0gYi5yZXR1cm47YiA9IGIuc2libGluZzt9fXJldHVybiAhMDt9CiAgICAgICAgICBmdW5jdGlvbiBEayhhLCBiKSB7YiAmPSB+c2s7YiAmPSB+cms7YS5zdXNwZW5kZWRMYW5lcyB8PSBiO2EucGluZ2VkTGFuZXMgJj0gfmI7Zm9yIChhID0gYS5leHBpcmF0aW9uVGltZXM7IDAgPCBiOykge3ZhciBjID0gMzEgLSBvYyhiKSxkID0gMSA8PCBjO2FbY10gPSAtMTtiICY9IH5kO319ZnVuY3Rpb24gRmsoYSkge2lmICgwICE9PSAoSyAmIDYpKSB0aHJvdyBFcnJvcihwKDMyNykpO0lrKCk7dmFyIGIgPSB1YyhhLCAwKTtpZiAoMCA9PT0gKGIgJiAxKSkgcmV0dXJuIEVrKGEsIEIoKSksIG51bGw7dmFyIGMgPSBKayhhLCBiKTtpZiAoMCAhPT0gYS50YWcgJiYgMiA9PT0gYykge3ZhciBkID0geGMoYSk7MCAhPT0gZCAmJiAoYiA9IGQsIGMgPSBPayhhLCBkKSk7fWlmICgxID09PSBjKSB0aHJvdyBjID0gcWssIExrKGEsIDApLCBEayhhLCBiKSwgRWsoYSwgQigpKSwgYztpZiAoNiA9PT0gYykgdGhyb3cgRXJyb3IocCgzNDUpKTthLmZpbmlzaGVkV29yayA9IGEuY3VycmVudC5hbHRlcm5hdGU7YS5maW5pc2hlZExhbmVzID0gYjtRayhhLCB1aywgdmspO0VrKGEsIEIoKSk7cmV0dXJuIG51bGw7fQogICAgICAgICAgZnVuY3Rpb24gUmsoYSwgYikge3ZhciBjID0gSztLIHw9IDE7dHJ5IHtyZXR1cm4gYShiKTt9IGZpbmFsbHkge0sgPSBjLCAwID09PSBLICYmIChIaiA9IEIoKSArIDUwMCwgZmcgJiYgamcoKSk7fX1mdW5jdGlvbiBTayhhKSB7bnVsbCAhPT0geGsgJiYgMCA9PT0geGsudGFnICYmIDAgPT09IChLICYgNikgJiYgSWsoKTt2YXIgYiA9IEs7SyB8PSAxO3ZhciBjID0gcGsudHJhbnNpdGlvbixkID0gQzt0cnkge2lmIChway50cmFuc2l0aW9uID0gbnVsbCwgQyA9IDEsIGEpIHJldHVybiBhKCk7fSBmaW5hbGx5IHtDID0gZCwgcGsudHJhbnNpdGlvbiA9IGMsIEsgPSBiLCAwID09PSAoSyAmIDYpICYmIGpnKCk7fX1mdW5jdGlvbiBJaigpIHtnaiA9IGZqLmN1cnJlbnQ7RShmaik7fQogICAgICAgICAgZnVuY3Rpb24gTGsoYSwgYikge2EuZmluaXNoZWRXb3JrID0gbnVsbDthLmZpbmlzaGVkTGFuZXMgPSAwO3ZhciBjID0gYS50aW1lb3V0SGFuZGxlOy0xICE9PSBjICYmIChhLnRpbWVvdXRIYW5kbGUgPSAtMSwgR2YoYykpO2lmIChudWxsICE9PSBZKSBmb3IgKGMgPSBZLnJldHVybjsgbnVsbCAhPT0gYzspIHt2YXIgZCA9IGM7d2coZCk7c3dpdGNoIChkLnRhZykge2Nhc2UgMTpkID0gZC50eXBlLmNoaWxkQ29udGV4dFR5cGVzO251bGwgIT09IGQgJiYgdm9pZCAwICE9PSBkICYmICRmKCk7YnJlYWs7Y2FzZSAzOkpoKCk7RShXZik7RShIKTtPaCgpO2JyZWFrO2Nhc2UgNTpMaChkKTticmVhaztjYXNlIDQ6SmgoKTticmVhaztjYXNlIDEzOkUoTSk7YnJlYWs7Y2FzZSAxOTpFKE0pO2JyZWFrO2Nhc2UgMTA6UmcoZC50eXBlLl9jb250ZXh0KTticmVhaztjYXNlIDIyOmNhc2UgMjM6SWooKTt9YyA9IGMucmV0dXJuO31SID0gYTtZID0gYSA9IHdoKGEuY3VycmVudCwgbnVsbCk7WiA9IGdqID0gYjtUID0gMDtxayA9IG51bGw7c2sgPSByayA9IGhoID0gMDt1ayA9IHRrID0gbnVsbDtpZiAobnVsbCAhPT0gV2cpIHtmb3IgKGIgPQogICAgICAgICAgICAgIDA7IGIgPCBXZy5sZW5ndGg7IGIrKykgaWYgKGMgPSBXZ1tiXSwgZCA9IGMuaW50ZXJsZWF2ZWQsIG51bGwgIT09IGQpIHtjLmludGVybGVhdmVkID0gbnVsbDt2YXIgZSA9IGQubmV4dCxmID0gYy5wZW5kaW5nO2lmIChudWxsICE9PSBmKSB7dmFyIGcgPSBmLm5leHQ7Zi5uZXh0ID0gZTtkLm5leHQgPSBnO31jLnBlbmRpbmcgPSBkO31XZyA9IG51bGw7fXJldHVybiBhO30KICAgICAgICAgIGZ1bmN0aW9uIE5rKGEsIGIpIHtkbyB7dmFyIGMgPSBZO3RyeSB7UWcoKTtQaC5jdXJyZW50ID0gYWk7aWYgKFNoKSB7Zm9yICh2YXIgZCA9IE4ubWVtb2l6ZWRTdGF0ZTsgbnVsbCAhPT0gZDspIHt2YXIgZSA9IGQucXVldWU7bnVsbCAhPT0gZSAmJiAoZS5wZW5kaW5nID0gbnVsbCk7ZCA9IGQubmV4dDt9U2ggPSAhMTt9UmggPSAwO1AgPSBPID0gTiA9IG51bGw7VGggPSAhMTtVaCA9IDA7b2suY3VycmVudCA9IG51bGw7aWYgKG51bGwgPT09IGMgfHwgbnVsbCA9PT0gYy5yZXR1cm4pIHtUID0gMTtxayA9IGI7WSA9IG51bGw7YnJlYWs7fWE6IHt2YXIgZiA9IGEsZyA9IGMucmV0dXJuLGggPSBjLGsgPSBiO2IgPSBaO2guZmxhZ3MgfD0gMzI3Njg7aWYgKG51bGwgIT09IGsgJiYgIm9iamVjdCIgPT09IHR5cGVvZiBrICYmICJmdW5jdGlvbiIgPT09IHR5cGVvZiBrLnRoZW4pIHt2YXIgbCA9IGssbSA9IGgscSA9IG0udGFnO2lmICgwID09PSAobS5tb2RlICYgMSkgJiYgKDAgPT09IHEgfHwgMTEgPT09IHEgfHwgMTUgPT09IHEpKSB7dmFyIHIgPSBtLmFsdGVybmF0ZTtyID8gKG0udXBkYXRlUXVldWUgPSByLnVwZGF0ZVF1ZXVlLCBtLm1lbW9pemVkU3RhdGUgPSByLm1lbW9pemVkU3RhdGUsCiAgICAgICAgICAgICAgICAgICAgICBtLmxhbmVzID0gci5sYW5lcykgOiAobS51cGRhdGVRdWV1ZSA9IG51bGwsIG0ubWVtb2l6ZWRTdGF0ZSA9IG51bGwpO312YXIgeSA9IFZpKGcpO2lmIChudWxsICE9PSB5KSB7eS5mbGFncyAmPSAtMjU3O1dpKHksIGcsIGgsIGYsIGIpO3kubW9kZSAmIDEgJiYgVGkoZiwgbCwgYik7YiA9IHk7ayA9IGw7dmFyIG4gPSBiLnVwZGF0ZVF1ZXVlO2lmIChudWxsID09PSBuKSB7dmFyIHQgPSBuZXcgU2V0KCk7dC5hZGQoayk7Yi51cGRhdGVRdWV1ZSA9IHQ7fSBlbHNlIG4uYWRkKGspO2JyZWFrIGE7fSBlbHNlIHtpZiAoMCA9PT0gKGIgJiAxKSkge1RpKGYsIGwsIGIpO3VqKCk7YnJlYWsgYTt9ayA9IEVycm9yKHAoNDI2KSk7fX0gZWxzZSBpZiAoSSAmJiBoLm1vZGUgJiAxKSB7dmFyIEogPSBWaShnKTtpZiAobnVsbCAhPT0gSikgezAgPT09IChKLmZsYWdzICYgNjU1MzYpICYmIChKLmZsYWdzIHw9IDI1Nik7V2koSiwgZywgaCwgZiwgYik7SmcoS2koaywgaCkpO2JyZWFrIGE7fX1mID0gayA9IEtpKGssIGgpOzQgIT09IFQgJiYgKFQgPSAyKTtudWxsID09PSB0ayA/IHRrID0gW2ZdIDogdGsucHVzaChmKTtmID0gZztkbyB7c3dpdGNoIChmLnRhZykge2Nhc2UgMzpmLmZsYWdzIHw9IDY1NTM2OwogICAgICAgICAgICAgICAgICAgICAgICBiICY9IC1iO2YubGFuZXMgfD0gYjt2YXIgeCA9IE9pKGYsIGssIGIpO2ZoKGYsIHgpO2JyZWFrIGE7Y2FzZSAxOmggPSBrO3ZhciB3ID0gZi50eXBlLHUgPSBmLnN0YXRlTm9kZTtpZiAoMCA9PT0gKGYuZmxhZ3MgJiAxMjgpICYmICgiZnVuY3Rpb24iID09PSB0eXBlb2Ygdy5nZXREZXJpdmVkU3RhdGVGcm9tRXJyb3IgfHwgbnVsbCAhPT0gdSAmJiAiZnVuY3Rpb24iID09PSB0eXBlb2YgdS5jb21wb25lbnREaWRDYXRjaCAmJiAobnVsbCA9PT0gU2kgfHwgIVNpLmhhcyh1KSkpKSB7Zi5mbGFncyB8PSA2NTUzNjtiICY9IC1iO2YubGFuZXMgfD0gYjt2YXIgRiA9IFJpKGYsIGgsIGIpO2ZoKGYsIEYpO2JyZWFrIGE7fX1mID0gZi5yZXR1cm47fSB3aGlsZSAobnVsbCAhPT0gZik7fVRrKGMpO30gY2F0Y2ggKG5hKSB7YiA9IG5hO1kgPT09IGMgJiYgbnVsbCAhPT0gYyAmJiAoWSA9IGMgPSBjLnJldHVybik7Y29udGludWU7fWJyZWFrO30gd2hpbGUgKDEpO31mdW5jdGlvbiBLaygpIHt2YXIgYSA9IG5rLmN1cnJlbnQ7bmsuY3VycmVudCA9IGFpO3JldHVybiBudWxsID09PSBhID8gYWkgOiBhO30KICAgICAgICAgIGZ1bmN0aW9uIHVqKCkge2lmICgwID09PSBUIHx8IDMgPT09IFQgfHwgMiA9PT0gVCkgVCA9IDQ7bnVsbCA9PT0gUiB8fCAwID09PSAoaGggJiAyNjg0MzU0NTUpICYmIDAgPT09IChyayAmIDI2ODQzNTQ1NSkgfHwgRGsoUiwgWik7fWZ1bmN0aW9uIEprKGEsIGIpIHt2YXIgYyA9IEs7SyB8PSAyO3ZhciBkID0gS2soKTtpZiAoUiAhPT0gYSB8fCBaICE9PSBiKSB2ayA9IG51bGwsIExrKGEsIGIpO2RvIHRyeSB7VWsoKTticmVhazt9IGNhdGNoIChlKSB7TmsoYSwgZSk7fSB3aGlsZSAoMSk7UWcoKTtLID0gYztuay5jdXJyZW50ID0gZDtpZiAobnVsbCAhPT0gWSkgdGhyb3cgRXJyb3IocCgyNjEpKTtSID0gbnVsbDtaID0gMDtyZXR1cm4gVDt9ZnVuY3Rpb24gVWsoKSB7Zm9yICg7IG51bGwgIT09IFk7KSBWayhZKTt9ZnVuY3Rpb24gTWsoKSB7Zm9yICg7IG51bGwgIT09IFkgJiYgIWNjKCk7KSBWayhZKTt9ZnVuY3Rpb24gVmsoYSkge3ZhciBiID0gV2soYS5hbHRlcm5hdGUsIGEsIGdqKTthLm1lbW9pemVkUHJvcHMgPSBhLnBlbmRpbmdQcm9wcztudWxsID09PSBiID8gVGsoYSkgOiBZID0gYjtvay5jdXJyZW50ID0gbnVsbDt9CiAgICAgICAgICBmdW5jdGlvbiBUayhhKSB7dmFyIGIgPSBhO2RvIHt2YXIgYyA9IGIuYWx0ZXJuYXRlO2EgPSBiLnJldHVybjtpZiAoMCA9PT0gKGIuZmxhZ3MgJiAzMjc2OCkpIHtpZiAoYyA9IEZqKGMsIGIsIGdqKSwgbnVsbCAhPT0gYykge1kgPSBjO3JldHVybjt9fSBlbHNlIHtjID0gSmooYywgYik7aWYgKG51bGwgIT09IGMpIHtjLmZsYWdzICY9IDMyNzY3O1kgPSBjO3JldHVybjt9aWYgKG51bGwgIT09IGEpIGEuZmxhZ3MgfD0gMzI3NjgsIGEuc3VidHJlZUZsYWdzID0gMCwgYS5kZWxldGlvbnMgPSBudWxsO2Vsc2Uge1QgPSA2O1kgPSBudWxsO3JldHVybjt9fWIgPSBiLnNpYmxpbmc7aWYgKG51bGwgIT09IGIpIHtZID0gYjtyZXR1cm47fVkgPSBiID0gYTt9IHdoaWxlIChudWxsICE9PSBiKTswID09PSBUICYmIChUID0gNSk7fWZ1bmN0aW9uIFFrKGEsIGIsIGMpIHt2YXIgZCA9IEMsZSA9IHBrLnRyYW5zaXRpb247dHJ5IHtway50cmFuc2l0aW9uID0gbnVsbCwgQyA9IDEsIFhrKGEsIGIsIGMsIGQpO30gZmluYWxseSB7cGsudHJhbnNpdGlvbiA9IGUsIEMgPSBkO31yZXR1cm4gbnVsbDt9CiAgICAgICAgICBmdW5jdGlvbiBYayhhLCBiLCBjLCBkKSB7ZG8gSWsoKTsgd2hpbGUgKG51bGwgIT09IHhrKTtpZiAoMCAhPT0gKEsgJiA2KSkgdGhyb3cgRXJyb3IocCgzMjcpKTtjID0gYS5maW5pc2hlZFdvcms7dmFyIGUgPSBhLmZpbmlzaGVkTGFuZXM7aWYgKG51bGwgPT09IGMpIHJldHVybiBudWxsO2EuZmluaXNoZWRXb3JrID0gbnVsbDthLmZpbmlzaGVkTGFuZXMgPSAwO2lmIChjID09PSBhLmN1cnJlbnQpIHRocm93IEVycm9yKHAoMTc3KSk7YS5jYWxsYmFja05vZGUgPSBudWxsO2EuY2FsbGJhY2tQcmlvcml0eSA9IDA7dmFyIGYgPSBjLmxhbmVzIHwgYy5jaGlsZExhbmVzO0JjKGEsIGYpO2EgPT09IFIgJiYgKFkgPSBSID0gbnVsbCwgWiA9IDApOzAgPT09IChjLnN1YnRyZWVGbGFncyAmIDIwNjQpICYmIDAgPT09IChjLmZsYWdzICYgMjA2NCkgfHwgd2sgfHwgKHdrID0gITAsIEdrKGhjLCBmdW5jdGlvbiAoKSB7SWsoKTtyZXR1cm4gbnVsbDt9KSk7ZiA9IDAgIT09IChjLmZsYWdzICYgMTU5OTApO2lmICgwICE9PSAoYy5zdWJ0cmVlRmxhZ3MgJiAxNTk5MCkgfHwgZikge2YgPSBway50cmFuc2l0aW9uO3BrLnRyYW5zaXRpb24gPSBudWxsOwogICAgICAgICAgICAgIHZhciBnID0gQztDID0gMTt2YXIgaCA9IEs7SyB8PSA0O29rLmN1cnJlbnQgPSBudWxsO1BqKGEsIGMpO2VrKGMsIGEpO09lKERmKTtkZCA9ICEhQ2Y7RGYgPSBDZiA9IG51bGw7YS5jdXJyZW50ID0gYztpayhjLCBhLCBlKTtkYygpO0sgPSBoO0MgPSBnO3BrLnRyYW5zaXRpb24gPSBmO30gZWxzZSBhLmN1cnJlbnQgPSBjO3drICYmICh3ayA9ICExLCB4ayA9IGEsIHlrID0gZSk7ZiA9IGEucGVuZGluZ0xhbmVzOzAgPT09IGYgJiYgKFNpID0gbnVsbCk7bWMoYy5zdGF0ZU5vZGUsIGQpO0VrKGEsIEIoKSk7aWYgKG51bGwgIT09IGIpIGZvciAoZCA9IGEub25SZWNvdmVyYWJsZUVycm9yLCBjID0gMDsgYyA8IGIubGVuZ3RoOyBjKyspIGUgPSBiW2NdLCBkKGUudmFsdWUsIHsgY29tcG9uZW50U3RhY2s6IGUuc3RhY2ssIGRpZ2VzdDogZS5kaWdlc3QgfSk7aWYgKFBpKSB0aHJvdyBQaSA9ICExLCBhID0gUWksIFFpID0gbnVsbCwgYTswICE9PSAoeWsgJiAxKSAmJiAwICE9PSBhLnRhZyAmJiBJaygpO2YgPSBhLnBlbmRpbmdMYW5lczswICE9PSAoZiAmIDEpID8gYSA9PT0gQWsgPyB6aysrIDogKHprID0gMCwgQWsgPSBhKSA6IHprID0gMDtqZygpO3JldHVybiBudWxsO30KICAgICAgICAgIGZ1bmN0aW9uIElrKCkge2lmIChudWxsICE9PSB4aykge3ZhciBhID0gRGMoeWspLGIgPSBway50cmFuc2l0aW9uLGMgPSBDO3RyeSB7cGsudHJhbnNpdGlvbiA9IG51bGw7QyA9IDE2ID4gYSA/IDE2IDogYTtpZiAobnVsbCA9PT0geGspIHZhciBkID0gITE7ZWxzZSB7YSA9IHhrO3hrID0gbnVsbDt5ayA9IDA7aWYgKDAgIT09IChLICYgNikpIHRocm93IEVycm9yKHAoMzMxKSk7dmFyIGUgPSBLO0sgfD0gNDtmb3IgKFYgPSBhLmN1cnJlbnQ7IG51bGwgIT09IFY7KSB7dmFyIGYgPSBWLGcgPSBmLmNoaWxkO2lmICgwICE9PSAoVi5mbGFncyAmIDE2KSkge3ZhciBoID0gZi5kZWxldGlvbnM7aWYgKG51bGwgIT09IGgpIHtmb3IgKHZhciBrID0gMDsgayA8IGgubGVuZ3RoOyBrKyspIHt2YXIgbCA9IGhba107Zm9yIChWID0gbDsgbnVsbCAhPT0gVjspIHt2YXIgbSA9IFY7c3dpdGNoIChtLnRhZykge2Nhc2UgMDpjYXNlIDExOmNhc2UgMTU6UWooOCwgbSwgZik7fXZhciBxID0gbS5jaGlsZDtpZiAobnVsbCAhPT0gcSkgcS5yZXR1cm4gPSBtLCBWID0gcTtlbHNlIGZvciAoOyBudWxsICE9PSBWOykge20gPSBWO3ZhciByID0gbS5zaWJsaW5nLHkgPSBtLnJldHVybjtUaihtKTtpZiAobSA9PT0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbCkge1YgPSBudWxsO2JyZWFrO31pZiAobnVsbCAhPT0gcikge3IucmV0dXJuID0geTtWID0gcjticmVhazt9ViA9IHk7fX19dmFyIG4gPSBmLmFsdGVybmF0ZTtpZiAobnVsbCAhPT0gbikge3ZhciB0ID0gbi5jaGlsZDtpZiAobnVsbCAhPT0gdCkge24uY2hpbGQgPSBudWxsO2RvIHt2YXIgSiA9IHQuc2libGluZzt0LnNpYmxpbmcgPSBudWxsO3QgPSBKO30gd2hpbGUgKG51bGwgIT09IHQpO319ViA9IGY7fX1pZiAoMCAhPT0gKGYuc3VidHJlZUZsYWdzICYgMjA2NCkgJiYgbnVsbCAhPT0gZykgZy5yZXR1cm4gPSBmLCBWID0gZztlbHNlIGI6IGZvciAoOyBudWxsICE9PSBWOykge2YgPSBWO2lmICgwICE9PSAoZi5mbGFncyAmIDIwNDgpKSBzd2l0Y2ggKGYudGFnKSB7Y2FzZSAwOmNhc2UgMTE6Y2FzZSAxNTpRaig5LCBmLCBmLnJldHVybik7fXZhciB4ID0gZi5zaWJsaW5nO2lmIChudWxsICE9PSB4KSB7eC5yZXR1cm4gPSBmLnJldHVybjtWID0geDticmVhayBiO31WID0gZi5yZXR1cm47fX12YXIgdyA9IGEuY3VycmVudDtmb3IgKFYgPSB3OyBudWxsICE9PSBWOykge2cgPSBWO3ZhciB1ID0gZy5jaGlsZDtpZiAoMCAhPT0gKGcuc3VidHJlZUZsYWdzICYgMjA2NCkgJiYgbnVsbCAhPT0KICAgICAgICAgICAgICAgICAgICB1KSB1LnJldHVybiA9IGcsIFYgPSB1O2Vsc2UgYjogZm9yIChnID0gdzsgbnVsbCAhPT0gVjspIHtoID0gVjtpZiAoMCAhPT0gKGguZmxhZ3MgJiAyMDQ4KSkgdHJ5IHtzd2l0Y2ggKGgudGFnKSB7Y2FzZSAwOmNhc2UgMTE6Y2FzZSAxNTpSaig5LCBoKTt9fSBjYXRjaCAobmEpIHtXKGgsIGgucmV0dXJuLCBuYSk7fWlmIChoID09PSBnKSB7ViA9IG51bGw7YnJlYWsgYjt9dmFyIEYgPSBoLnNpYmxpbmc7aWYgKG51bGwgIT09IEYpIHtGLnJldHVybiA9IGgucmV0dXJuO1YgPSBGO2JyZWFrIGI7fVYgPSBoLnJldHVybjt9fUsgPSBlO2pnKCk7aWYgKGxjICYmICJmdW5jdGlvbiIgPT09IHR5cGVvZiBsYy5vblBvc3RDb21taXRGaWJlclJvb3QpIHRyeSB7bGMub25Qb3N0Q29tbWl0RmliZXJSb290KGtjLCBhKTt9IGNhdGNoIChuYSkge31kID0gITA7fXJldHVybiBkO30gZmluYWxseSB7QyA9IGMsIHBrLnRyYW5zaXRpb24gPSBiO319cmV0dXJuICExO31mdW5jdGlvbiBZayhhLCBiLCBjKSB7YiA9IEtpKGMsIGIpO2IgPSBPaShhLCBiLCAxKTthID0gZGgoYSwgYiwgMSk7YiA9IEwoKTtudWxsICE9PSBhICYmIChBYyhhLCAxLCBiKSwgRWsoYSwgYikpO30KICAgICAgICAgIGZ1bmN0aW9uIFcoYSwgYiwgYykge2lmICgzID09PSBhLnRhZykgWWsoYSwgYSwgYyk7ZWxzZSBmb3IgKDsgbnVsbCAhPT0gYjspIHtpZiAoMyA9PT0gYi50YWcpIHtZayhiLCBhLCBjKTticmVhazt9IGVsc2UgaWYgKDEgPT09IGIudGFnKSB7dmFyIGQgPSBiLnN0YXRlTm9kZTtpZiAoImZ1bmN0aW9uIiA9PT0gdHlwZW9mIGIudHlwZS5nZXREZXJpdmVkU3RhdGVGcm9tRXJyb3IgfHwgImZ1bmN0aW9uIiA9PT0gdHlwZW9mIGQuY29tcG9uZW50RGlkQ2F0Y2ggJiYgKG51bGwgPT09IFNpIHx8ICFTaS5oYXMoZCkpKSB7YSA9IEtpKGMsIGEpO2EgPSBSaShiLCBhLCAxKTtiID0gZGgoYiwgYSwgMSk7YSA9IEwoKTtudWxsICE9PSBiICYmIChBYyhiLCAxLCBhKSwgRWsoYiwgYSkpO2JyZWFrO319YiA9IGIucmV0dXJuO319CiAgICAgICAgICBmdW5jdGlvbiBVaShhLCBiLCBjKSB7dmFyIGQgPSBhLnBpbmdDYWNoZTtudWxsICE9PSBkICYmIGQuZGVsZXRlKGIpO2IgPSBMKCk7YS5waW5nZWRMYW5lcyB8PSBhLnN1c3BlbmRlZExhbmVzICYgYztSID09PSBhICYmIChaICYgYykgPT09IGMgJiYgKDQgPT09IFQgfHwgMyA9PT0gVCAmJiAoWiAmIDEzMDAyMzQyNCkgPT09IFogJiYgNTAwID4gQigpIC0gZ2sgPyBMayhhLCAwKSA6IHNrIHw9IGMpO0VrKGEsIGIpO31mdW5jdGlvbiBaayhhLCBiKSB7MCA9PT0gYiAmJiAoMCA9PT0gKGEubW9kZSAmIDEpID8gYiA9IDEgOiAoYiA9IHNjLCBzYyA8PD0gMSwgMCA9PT0gKHNjICYgMTMwMDIzNDI0KSAmJiAoc2MgPSA0MTk0MzA0KSkpO3ZhciBjID0gTCgpO2EgPSBaZyhhLCBiKTtudWxsICE9PSBhICYmIChBYyhhLCBiLCBjKSwgRWsoYSwgYykpO31mdW5jdGlvbiB2aihhKSB7dmFyIGIgPSBhLm1lbW9pemVkU3RhdGUsYyA9IDA7bnVsbCAhPT0gYiAmJiAoYyA9IGIucmV0cnlMYW5lKTtaayhhLCBjKTt9CiAgICAgICAgICBmdW5jdGlvbiBjayhhLCBiKSB7dmFyIGMgPSAwO3N3aXRjaCAoYS50YWcpIHtjYXNlIDEzOnZhciBkID0gYS5zdGF0ZU5vZGU7dmFyIGUgPSBhLm1lbW9pemVkU3RhdGU7bnVsbCAhPT0gZSAmJiAoYyA9IGUucmV0cnlMYW5lKTticmVhaztjYXNlIDE5OmQgPSBhLnN0YXRlTm9kZTticmVhaztkZWZhdWx0OnRocm93IEVycm9yKHAoMzE0KSk7fW51bGwgIT09IGQgJiYgZC5kZWxldGUoYik7WmsoYSwgYyk7fXZhciBXazsKICAgICAgICAgIFdrID0gZnVuY3Rpb24gV2soYSwgYiwgYykge2lmIChudWxsICE9PSBhKSB7aWYgKGEubWVtb2l6ZWRQcm9wcyAhPT0gYi5wZW5kaW5nUHJvcHMgfHwgV2YuY3VycmVudCkgVWcgPSAhMDtlbHNlIHtpZiAoMCA9PT0gKGEubGFuZXMgJiBjKSAmJiAwID09PSAoYi5mbGFncyAmIDEyOCkpIHJldHVybiBVZyA9ICExLCB6aihhLCBiLCBjKTtVZyA9IDAgIT09IChhLmZsYWdzICYgMTMxMDcyKSA/ICEwIDogITE7fX0gZWxzZSBVZyA9ICExLCBJICYmIDAgIT09IChiLmZsYWdzICYgMTA0ODU3NikgJiYgdWcoYiwgbmcsIGIuaW5kZXgpO2IubGFuZXMgPSAwO3N3aXRjaCAoYi50YWcpIHtjYXNlIDI6dmFyIGQgPSBiLnR5cGU7amooYSwgYik7YSA9IGIucGVuZGluZ1Byb3BzO3ZhciBlID0gWWYoYiwgSC5jdXJyZW50KTtUZyhiLCBjKTtlID0gWGgobnVsbCwgYiwgZCwgYSwgZSwgYyk7dmFyIGYgPSBiaSgpO2IuZmxhZ3MgfD0gMTsib2JqZWN0IiA9PT0gdHlwZW9mIGUgJiYgbnVsbCAhPT0gZSAmJiAiZnVuY3Rpb24iID09PSB0eXBlb2YgZS5yZW5kZXIgJiYgdm9pZCAwID09PSBlLiQkdHlwZW9mID8gKGIudGFnID0gMSwgYi5tZW1vaXplZFN0YXRlID0gbnVsbCwgYi51cGRhdGVRdWV1ZSA9CiAgICAgICAgICAgICAgICBudWxsLCBaZihkKSA/IChmID0gITAsIGNnKGIpKSA6IGYgPSAhMSwgYi5tZW1vaXplZFN0YXRlID0gbnVsbCAhPT0gZS5zdGF0ZSAmJiB2b2lkIDAgIT09IGUuc3RhdGUgPyBlLnN0YXRlIDogbnVsbCwgYWgoYiksIGUudXBkYXRlciA9IG5oLCBiLnN0YXRlTm9kZSA9IGUsIGUuX3JlYWN0SW50ZXJuYWxzID0gYiwgcmgoYiwgZCwgYSwgYyksIGIgPSBraihudWxsLCBiLCBkLCAhMCwgZiwgYykpIDogKGIudGFnID0gMCwgSSAmJiBmICYmIHZnKGIpLCBZaShudWxsLCBiLCBlLCBjKSwgYiA9IGIuY2hpbGQpO3JldHVybiBiO2Nhc2UgMTY6ZCA9IGIuZWxlbWVudFR5cGU7YToge2pqKGEsIGIpO2EgPSBiLnBlbmRpbmdQcm9wcztlID0gZC5faW5pdDtkID0gZShkLl9wYXlsb2FkKTtiLnR5cGUgPSBkO2UgPSBiLnRhZyA9ICRrKGQpO2EgPSBMZyhkLCBhKTtzd2l0Y2ggKGUpIHtjYXNlIDA6YiA9IGRqKG51bGwsIGIsIGQsIGEsIGMpO2JyZWFrIGE7Y2FzZSAxOmIgPSBpaihudWxsLCBiLCBkLCBhLCBjKTticmVhayBhO2Nhc2UgMTE6YiA9IFppKG51bGwsIGIsIGQsIGEsIGMpO2JyZWFrIGE7Y2FzZSAxNDpiID0gYWoobnVsbCwgYiwgZCwgTGcoZC50eXBlLCBhKSwgYyk7YnJlYWsgYTt9dGhyb3cgRXJyb3IocCgzMDYsCiAgICAgICAgICAgICAgICAgIGQsICIiKSk7fXJldHVybiBiO2Nhc2UgMDpyZXR1cm4gZCA9IGIudHlwZSwgZSA9IGIucGVuZGluZ1Byb3BzLCBlID0gYi5lbGVtZW50VHlwZSA9PT0gZCA/IGUgOiBMZyhkLCBlKSwgZGooYSwgYiwgZCwgZSwgYyk7Y2FzZSAxOnJldHVybiBkID0gYi50eXBlLCBlID0gYi5wZW5kaW5nUHJvcHMsIGUgPSBiLmVsZW1lbnRUeXBlID09PSBkID8gZSA6IExnKGQsIGUpLCBpaihhLCBiLCBkLCBlLCBjKTtjYXNlIDM6YToge2xqKGIpO2lmIChudWxsID09PSBhKSB0aHJvdyBFcnJvcihwKDM4NykpO2QgPSBiLnBlbmRpbmdQcm9wcztmID0gYi5tZW1vaXplZFN0YXRlO2UgPSBmLmVsZW1lbnQ7YmgoYSwgYik7Z2goYiwgZCwgbnVsbCwgYyk7dmFyIGcgPSBiLm1lbW9pemVkU3RhdGU7ZCA9IGcuZWxlbWVudDtpZiAoZi5pc0RlaHlkcmF0ZWQpIHtpZiAoZiA9IHsgZWxlbWVudDogZCwgaXNEZWh5ZHJhdGVkOiAhMSwgY2FjaGU6IGcuY2FjaGUsIHBlbmRpbmdTdXNwZW5zZUJvdW5kYXJpZXM6IGcucGVuZGluZ1N1c3BlbnNlQm91bmRhcmllcywgdHJhbnNpdGlvbnM6IGcudHJhbnNpdGlvbnMgfSwgYi51cGRhdGVRdWV1ZS5iYXNlU3RhdGUgPQogICAgICAgICAgICAgICAgICAgIGYsIGIubWVtb2l6ZWRTdGF0ZSA9IGYsIGIuZmxhZ3MgJiAyNTYpIHtlID0gS2koRXJyb3IocCg0MjMpKSwgYik7YiA9IG1qKGEsIGIsIGQsIGMsIGUpO2JyZWFrIGE7fSBlbHNlIGlmIChkICE9PSBlKSB7ZSA9IEtpKEVycm9yKHAoNDI0KSksIGIpO2IgPSBtaihhLCBiLCBkLCBjLCBlKTticmVhayBhO30gZWxzZSBmb3IgKHlnID0gTGYoYi5zdGF0ZU5vZGUuY29udGFpbmVySW5mby5maXJzdENoaWxkKSwgeGcgPSBiLCBJID0gITAsIHpnID0gbnVsbCwgYyA9IENoKGIsIG51bGwsIGQsIGMpLCBiLmNoaWxkID0gYzsgYzspIGMuZmxhZ3MgPSBjLmZsYWdzICYgLTMgfCA0MDk2LCBjID0gYy5zaWJsaW5nO30gZWxzZSB7SWcoKTtpZiAoZCA9PT0gZSkge2IgPSAkaShhLCBiLCBjKTticmVhayBhO31ZaShhLCBiLCBkLCBjKTt9YiA9IGIuY2hpbGQ7fXJldHVybiBiO2Nhc2UgNTpyZXR1cm4gS2goYiksIG51bGwgPT09IGEgJiYgRWcoYiksIGQgPSBiLnR5cGUsIGUgPSBiLnBlbmRpbmdQcm9wcywgZiA9IG51bGwgIT09IGEgPyBhLm1lbW9pemVkUHJvcHMgOiBudWxsLCBnID0gZS5jaGlsZHJlbiwgRWYoZCwgZSkgPyBnID0gbnVsbCA6IG51bGwgIT09IGYgJiYgRWYoZCwgZikgJiYgKGIuZmxhZ3MgfD0gMzIpLAogICAgICAgICAgICAgICAgaGooYSwgYiksIFlpKGEsIGIsIGcsIGMpLCBiLmNoaWxkO2Nhc2UgNjpyZXR1cm4gbnVsbCA9PT0gYSAmJiBFZyhiKSwgbnVsbDtjYXNlIDEzOnJldHVybiBwaihhLCBiLCBjKTtjYXNlIDQ6cmV0dXJuIEloKGIsIGIuc3RhdGVOb2RlLmNvbnRhaW5lckluZm8pLCBkID0gYi5wZW5kaW5nUHJvcHMsIG51bGwgPT09IGEgPyBiLmNoaWxkID0gQmgoYiwgbnVsbCwgZCwgYykgOiBZaShhLCBiLCBkLCBjKSwgYi5jaGlsZDtjYXNlIDExOnJldHVybiBkID0gYi50eXBlLCBlID0gYi5wZW5kaW5nUHJvcHMsIGUgPSBiLmVsZW1lbnRUeXBlID09PSBkID8gZSA6IExnKGQsIGUpLCBaaShhLCBiLCBkLCBlLCBjKTtjYXNlIDc6cmV0dXJuIFlpKGEsIGIsIGIucGVuZGluZ1Byb3BzLCBjKSwgYi5jaGlsZDtjYXNlIDg6cmV0dXJuIFlpKGEsIGIsIGIucGVuZGluZ1Byb3BzLmNoaWxkcmVuLCBjKSwgYi5jaGlsZDtjYXNlIDEyOnJldHVybiBZaShhLCBiLCBiLnBlbmRpbmdQcm9wcy5jaGlsZHJlbiwgYyksIGIuY2hpbGQ7Y2FzZSAxMDphOiB7ZCA9IGIudHlwZS5fY29udGV4dDtlID0gYi5wZW5kaW5nUHJvcHM7ZiA9IGIubWVtb2l6ZWRQcm9wczsKICAgICAgICAgICAgICAgICAgZyA9IGUudmFsdWU7RyhNZywgZC5fY3VycmVudFZhbHVlKTtkLl9jdXJyZW50VmFsdWUgPSBnO2lmIChudWxsICE9PSBmKSBpZiAoSGUoZi52YWx1ZSwgZykpIHtpZiAoZi5jaGlsZHJlbiA9PT0gZS5jaGlsZHJlbiAmJiAhV2YuY3VycmVudCkge2IgPSAkaShhLCBiLCBjKTticmVhayBhO319IGVsc2UgZm9yIChmID0gYi5jaGlsZCwgbnVsbCAhPT0gZiAmJiAoZi5yZXR1cm4gPSBiKTsgbnVsbCAhPT0gZjspIHt2YXIgaCA9IGYuZGVwZW5kZW5jaWVzO2lmIChudWxsICE9PSBoKSB7ZyA9IGYuY2hpbGQ7Zm9yICh2YXIgayA9IGguZmlyc3RDb250ZXh0OyBudWxsICE9PSBrOykge2lmIChrLmNvbnRleHQgPT09IGQpIHtpZiAoMSA9PT0gZi50YWcpIHtrID0gY2goLTEsIGMgJiAtYyk7ay50YWcgPSAyO3ZhciBsID0gZi51cGRhdGVRdWV1ZTtpZiAobnVsbCAhPT0gbCkge2wgPSBsLnNoYXJlZDt2YXIgbSA9IGwucGVuZGluZztudWxsID09PSBtID8gay5uZXh0ID0gayA6IChrLm5leHQgPSBtLm5leHQsIG0ubmV4dCA9IGspO2wucGVuZGluZyA9IGs7fX1mLmxhbmVzIHw9IGM7ayA9IGYuYWx0ZXJuYXRlO251bGwgIT09IGsgJiYgKGsubGFuZXMgfD0gYyk7U2coZi5yZXR1cm4sCiAgICAgICAgICAgICAgICAgICAgICAgICAgYywgYik7aC5sYW5lcyB8PSBjO2JyZWFrO31rID0gay5uZXh0O319IGVsc2UgaWYgKDEwID09PSBmLnRhZykgZyA9IGYudHlwZSA9PT0gYi50eXBlID8gbnVsbCA6IGYuY2hpbGQ7ZWxzZSBpZiAoMTggPT09IGYudGFnKSB7ZyA9IGYucmV0dXJuO2lmIChudWxsID09PSBnKSB0aHJvdyBFcnJvcihwKDM0MSkpO2cubGFuZXMgfD0gYztoID0gZy5hbHRlcm5hdGU7bnVsbCAhPT0gaCAmJiAoaC5sYW5lcyB8PSBjKTtTZyhnLCBjLCBiKTtnID0gZi5zaWJsaW5nO30gZWxzZSBnID0gZi5jaGlsZDtpZiAobnVsbCAhPT0gZykgZy5yZXR1cm4gPSBmO2Vsc2UgZm9yIChnID0gZjsgbnVsbCAhPT0gZzspIHtpZiAoZyA9PT0gYikge2cgPSBudWxsO2JyZWFrO31mID0gZy5zaWJsaW5nO2lmIChudWxsICE9PSBmKSB7Zi5yZXR1cm4gPSBnLnJldHVybjtnID0gZjticmVhazt9ZyA9IGcucmV0dXJuO31mID0gZzt9WWkoYSwgYiwgZS5jaGlsZHJlbiwgYyk7YiA9IGIuY2hpbGQ7fXJldHVybiBiO2Nhc2UgOTpyZXR1cm4gZSA9IGIudHlwZSwgZCA9IGIucGVuZGluZ1Byb3BzLmNoaWxkcmVuLCBUZyhiLCBjKSwgZSA9IFZnKGUpLCBkID0gZChlKSwgYi5mbGFncyB8PSAxLCBZaShhLCBiLCBkLCBjKSwKICAgICAgICAgICAgICAgIGIuY2hpbGQ7Y2FzZSAxNDpyZXR1cm4gZCA9IGIudHlwZSwgZSA9IExnKGQsIGIucGVuZGluZ1Byb3BzKSwgZSA9IExnKGQudHlwZSwgZSksIGFqKGEsIGIsIGQsIGUsIGMpO2Nhc2UgMTU6cmV0dXJuIGNqKGEsIGIsIGIudHlwZSwgYi5wZW5kaW5nUHJvcHMsIGMpO2Nhc2UgMTc6cmV0dXJuIGQgPSBiLnR5cGUsIGUgPSBiLnBlbmRpbmdQcm9wcywgZSA9IGIuZWxlbWVudFR5cGUgPT09IGQgPyBlIDogTGcoZCwgZSksIGpqKGEsIGIpLCBiLnRhZyA9IDEsIFpmKGQpID8gKGEgPSAhMCwgY2coYikpIDogYSA9ICExLCBUZyhiLCBjKSwgcGgoYiwgZCwgZSksIHJoKGIsIGQsIGUsIGMpLCBraihudWxsLCBiLCBkLCAhMCwgYSwgYyk7Y2FzZSAxOTpyZXR1cm4geWooYSwgYiwgYyk7Y2FzZSAyMjpyZXR1cm4gZWooYSwgYiwgYyk7fXRocm93IEVycm9yKHAoMTU2LCBiLnRhZykpO307ZnVuY3Rpb24gR2soYSwgYikge3JldHVybiBhYyhhLCBiKTt9CiAgICAgICAgICBmdW5jdGlvbiBhbChhLCBiLCBjLCBkKSB7dGhpcy50YWcgPSBhO3RoaXMua2V5ID0gYzt0aGlzLnNpYmxpbmcgPSB0aGlzLmNoaWxkID0gdGhpcy5yZXR1cm4gPSB0aGlzLnN0YXRlTm9kZSA9IHRoaXMudHlwZSA9IHRoaXMuZWxlbWVudFR5cGUgPSBudWxsO3RoaXMuaW5kZXggPSAwO3RoaXMucmVmID0gbnVsbDt0aGlzLnBlbmRpbmdQcm9wcyA9IGI7dGhpcy5kZXBlbmRlbmNpZXMgPSB0aGlzLm1lbW9pemVkU3RhdGUgPSB0aGlzLnVwZGF0ZVF1ZXVlID0gdGhpcy5tZW1vaXplZFByb3BzID0gbnVsbDt0aGlzLm1vZGUgPSBkO3RoaXMuc3VidHJlZUZsYWdzID0gdGhpcy5mbGFncyA9IDA7dGhpcy5kZWxldGlvbnMgPSBudWxsO3RoaXMuY2hpbGRMYW5lcyA9IHRoaXMubGFuZXMgPSAwO3RoaXMuYWx0ZXJuYXRlID0gbnVsbDt9ZnVuY3Rpb24gQmcoYSwgYiwgYywgZCkge3JldHVybiBuZXcgYWwoYSwgYiwgYywgZCk7fWZ1bmN0aW9uIGJqKGEpIHthID0gYS5wcm90b3R5cGU7cmV0dXJuICEoIWEgfHwgIWEuaXNSZWFjdENvbXBvbmVudCk7fQogICAgICAgICAgZnVuY3Rpb24gJGsoYSkge2lmICgiZnVuY3Rpb24iID09PSB0eXBlb2YgYSkgcmV0dXJuIGJqKGEpID8gMSA6IDA7aWYgKHZvaWQgMCAhPT0gYSAmJiBudWxsICE9PSBhKSB7YSA9IGEuJCR0eXBlb2Y7aWYgKGEgPT09IERhKSByZXR1cm4gMTE7aWYgKGEgPT09IEdhKSByZXR1cm4gMTQ7fXJldHVybiAyO30KICAgICAgICAgIGZ1bmN0aW9uIHdoKGEsIGIpIHt2YXIgYyA9IGEuYWx0ZXJuYXRlO251bGwgPT09IGMgPyAoYyA9IEJnKGEudGFnLCBiLCBhLmtleSwgYS5tb2RlKSwgYy5lbGVtZW50VHlwZSA9IGEuZWxlbWVudFR5cGUsIGMudHlwZSA9IGEudHlwZSwgYy5zdGF0ZU5vZGUgPSBhLnN0YXRlTm9kZSwgYy5hbHRlcm5hdGUgPSBhLCBhLmFsdGVybmF0ZSA9IGMpIDogKGMucGVuZGluZ1Byb3BzID0gYiwgYy50eXBlID0gYS50eXBlLCBjLmZsYWdzID0gMCwgYy5zdWJ0cmVlRmxhZ3MgPSAwLCBjLmRlbGV0aW9ucyA9IG51bGwpO2MuZmxhZ3MgPSBhLmZsYWdzICYgMTQ2ODAwNjQ7Yy5jaGlsZExhbmVzID0gYS5jaGlsZExhbmVzO2MubGFuZXMgPSBhLmxhbmVzO2MuY2hpbGQgPSBhLmNoaWxkO2MubWVtb2l6ZWRQcm9wcyA9IGEubWVtb2l6ZWRQcm9wcztjLm1lbW9pemVkU3RhdGUgPSBhLm1lbW9pemVkU3RhdGU7Yy51cGRhdGVRdWV1ZSA9IGEudXBkYXRlUXVldWU7YiA9IGEuZGVwZW5kZW5jaWVzO2MuZGVwZW5kZW5jaWVzID0gbnVsbCA9PT0gYiA/IG51bGwgOiB7IGxhbmVzOiBiLmxhbmVzLCBmaXJzdENvbnRleHQ6IGIuZmlyc3RDb250ZXh0IH07CiAgICAgICAgICAgIGMuc2libGluZyA9IGEuc2libGluZztjLmluZGV4ID0gYS5pbmRleDtjLnJlZiA9IGEucmVmO3JldHVybiBjO30KICAgICAgICAgIGZ1bmN0aW9uIHloKGEsIGIsIGMsIGQsIGUsIGYpIHt2YXIgZyA9IDI7ZCA9IGE7aWYgKCJmdW5jdGlvbiIgPT09IHR5cGVvZiBhKSBiaihhKSAmJiAoZyA9IDEpO2Vsc2UgaWYgKCJzdHJpbmciID09PSB0eXBlb2YgYSkgZyA9IDU7ZWxzZSBhOiBzd2l0Y2ggKGEpIHtjYXNlIHlhOnJldHVybiBBaChjLmNoaWxkcmVuLCBlLCBmLCBiKTtjYXNlIHphOmcgPSA4O2UgfD0gODticmVhaztjYXNlIEFhOnJldHVybiBhID0gQmcoMTIsIGMsIGIsIGUgfCAyKSwgYS5lbGVtZW50VHlwZSA9IEFhLCBhLmxhbmVzID0gZiwgYTtjYXNlIEVhOnJldHVybiBhID0gQmcoMTMsIGMsIGIsIGUpLCBhLmVsZW1lbnRUeXBlID0gRWEsIGEubGFuZXMgPSBmLCBhO2Nhc2UgRmE6cmV0dXJuIGEgPSBCZygxOSwgYywgYiwgZSksIGEuZWxlbWVudFR5cGUgPSBGYSwgYS5sYW5lcyA9IGYsIGE7Y2FzZSBJYTpyZXR1cm4gcWooYywgZSwgZiwgYik7ZGVmYXVsdDppZiAoIm9iamVjdCIgPT09IHR5cGVvZiBhICYmIG51bGwgIT09IGEpIHN3aXRjaCAoYS4kJHR5cGVvZikge2Nhc2UgQmE6ZyA9IDEwO2JyZWFrIGE7Y2FzZSBDYTpnID0gOTticmVhayBhO2Nhc2UgRGE6ZyA9IDExOwogICAgICAgICAgICAgICAgICAgIGJyZWFrIGE7Y2FzZSBHYTpnID0gMTQ7YnJlYWsgYTtjYXNlIEhhOmcgPSAxNjtkID0gbnVsbDticmVhayBhO310aHJvdyBFcnJvcihwKDEzMCwgbnVsbCA9PSBhID8gYSA6IHR5cGVvZiBhLCAiIikpO31iID0gQmcoZywgYywgYiwgZSk7Yi5lbGVtZW50VHlwZSA9IGE7Yi50eXBlID0gZDtiLmxhbmVzID0gZjtyZXR1cm4gYjt9ZnVuY3Rpb24gQWgoYSwgYiwgYywgZCkge2EgPSBCZyg3LCBhLCBkLCBiKTthLmxhbmVzID0gYztyZXR1cm4gYTt9ZnVuY3Rpb24gcWooYSwgYiwgYywgZCkge2EgPSBCZygyMiwgYSwgZCwgYik7YS5lbGVtZW50VHlwZSA9IElhO2EubGFuZXMgPSBjO2Euc3RhdGVOb2RlID0geyBpc0hpZGRlbjogITEgfTtyZXR1cm4gYTt9ZnVuY3Rpb24geGgoYSwgYiwgYykge2EgPSBCZyg2LCBhLCBudWxsLCBiKTthLmxhbmVzID0gYztyZXR1cm4gYTt9CiAgICAgICAgICBmdW5jdGlvbiB6aChhLCBiLCBjKSB7YiA9IEJnKDQsIG51bGwgIT09IGEuY2hpbGRyZW4gPyBhLmNoaWxkcmVuIDogW10sIGEua2V5LCBiKTtiLmxhbmVzID0gYztiLnN0YXRlTm9kZSA9IHsgY29udGFpbmVySW5mbzogYS5jb250YWluZXJJbmZvLCBwZW5kaW5nQ2hpbGRyZW46IG51bGwsIGltcGxlbWVudGF0aW9uOiBhLmltcGxlbWVudGF0aW9uIH07cmV0dXJuIGI7fQogICAgICAgICAgZnVuY3Rpb24gYmwoYSwgYiwgYywgZCwgZSkge3RoaXMudGFnID0gYjt0aGlzLmNvbnRhaW5lckluZm8gPSBhO3RoaXMuZmluaXNoZWRXb3JrID0gdGhpcy5waW5nQ2FjaGUgPSB0aGlzLmN1cnJlbnQgPSB0aGlzLnBlbmRpbmdDaGlsZHJlbiA9IG51bGw7dGhpcy50aW1lb3V0SGFuZGxlID0gLTE7dGhpcy5jYWxsYmFja05vZGUgPSB0aGlzLnBlbmRpbmdDb250ZXh0ID0gdGhpcy5jb250ZXh0ID0gbnVsbDt0aGlzLmNhbGxiYWNrUHJpb3JpdHkgPSAwO3RoaXMuZXZlbnRUaW1lcyA9IHpjKDApO3RoaXMuZXhwaXJhdGlvblRpbWVzID0gemMoLTEpO3RoaXMuZW50YW5nbGVkTGFuZXMgPSB0aGlzLmZpbmlzaGVkTGFuZXMgPSB0aGlzLm11dGFibGVSZWFkTGFuZXMgPSB0aGlzLmV4cGlyZWRMYW5lcyA9IHRoaXMucGluZ2VkTGFuZXMgPSB0aGlzLnN1c3BlbmRlZExhbmVzID0gdGhpcy5wZW5kaW5nTGFuZXMgPSAwO3RoaXMuZW50YW5nbGVtZW50cyA9IHpjKDApO3RoaXMuaWRlbnRpZmllclByZWZpeCA9IGQ7dGhpcy5vblJlY292ZXJhYmxlRXJyb3IgPSBlO3RoaXMubXV0YWJsZVNvdXJjZUVhZ2VySHlkcmF0aW9uRGF0YSA9CiAgICAgICAgICAgIG51bGw7fWZ1bmN0aW9uIGNsKGEsIGIsIGMsIGQsIGUsIGYsIGcsIGgsIGspIHthID0gbmV3IGJsKGEsIGIsIGMsIGgsIGspOzEgPT09IGIgPyAoYiA9IDEsICEwID09PSBmICYmIChiIHw9IDgpKSA6IGIgPSAwO2YgPSBCZygzLCBudWxsLCBudWxsLCBiKTthLmN1cnJlbnQgPSBmO2Yuc3RhdGVOb2RlID0gYTtmLm1lbW9pemVkU3RhdGUgPSB7IGVsZW1lbnQ6IGQsIGlzRGVoeWRyYXRlZDogYywgY2FjaGU6IG51bGwsIHRyYW5zaXRpb25zOiBudWxsLCBwZW5kaW5nU3VzcGVuc2VCb3VuZGFyaWVzOiBudWxsIH07YWgoZik7cmV0dXJuIGE7fWZ1bmN0aW9uIGRsKGEsIGIsIGMpIHt2YXIgZCA9IDMgPCBhcmd1bWVudHMubGVuZ3RoICYmIHZvaWQgMCAhPT0gYXJndW1lbnRzWzNdID8gYXJndW1lbnRzWzNdIDogbnVsbDtyZXR1cm4geyAkJHR5cGVvZjogd2EsIGtleTogbnVsbCA9PSBkID8gbnVsbCA6ICIiICsgZCwgY2hpbGRyZW46IGEsIGNvbnRhaW5lckluZm86IGIsIGltcGxlbWVudGF0aW9uOiBjIH07fQogICAgICAgICAgZnVuY3Rpb24gZWwoYSkge2lmICghYSkgcmV0dXJuIFZmO2EgPSBhLl9yZWFjdEludGVybmFsczthOiB7aWYgKFZiKGEpICE9PSBhIHx8IDEgIT09IGEudGFnKSB0aHJvdyBFcnJvcihwKDE3MCkpO3ZhciBiID0gYTtkbyB7c3dpdGNoIChiLnRhZykge2Nhc2UgMzpiID0gYi5zdGF0ZU5vZGUuY29udGV4dDticmVhayBhO2Nhc2UgMTppZiAoWmYoYi50eXBlKSkge2IgPSBiLnN0YXRlTm9kZS5fX3JlYWN0SW50ZXJuYWxNZW1vaXplZE1lcmdlZENoaWxkQ29udGV4dDticmVhayBhO319YiA9IGIucmV0dXJuO30gd2hpbGUgKG51bGwgIT09IGIpO3Rocm93IEVycm9yKHAoMTcxKSk7fWlmICgxID09PSBhLnRhZykge3ZhciBjID0gYS50eXBlO2lmIChaZihjKSkgcmV0dXJuIGJnKGEsIGMsIGIpO31yZXR1cm4gYjt9CiAgICAgICAgICBmdW5jdGlvbiBmbChhLCBiLCBjLCBkLCBlLCBmLCBnLCBoLCBrKSB7YSA9IGNsKGMsIGQsICEwLCBhLCBlLCBmLCBnLCBoLCBrKTthLmNvbnRleHQgPSBlbChudWxsKTtjID0gYS5jdXJyZW50O2QgPSBMKCk7ZSA9IGxoKGMpO2YgPSBjaChkLCBlKTtmLmNhbGxiYWNrID0gdm9pZCAwICE9PSBiICYmIG51bGwgIT09IGIgPyBiIDogbnVsbDtkaChjLCBmLCBlKTthLmN1cnJlbnQubGFuZXMgPSBlO0FjKGEsIGUsIGQpO0VrKGEsIGQpO3JldHVybiBhO31mdW5jdGlvbiBnbChhLCBiLCBjLCBkKSB7dmFyIGUgPSBiLmN1cnJlbnQsZiA9IEwoKSxnID0gbGgoZSk7YyA9IGVsKGMpO251bGwgPT09IGIuY29udGV4dCA/IGIuY29udGV4dCA9IGMgOiBiLnBlbmRpbmdDb250ZXh0ID0gYztiID0gY2goZiwgZyk7Yi5wYXlsb2FkID0geyBlbGVtZW50OiBhIH07ZCA9IHZvaWQgMCA9PT0gZCA/IG51bGwgOiBkO251bGwgIT09IGQgJiYgKGIuY2FsbGJhY2sgPSBkKTthID0gZGgoZSwgYiwgZyk7bnVsbCAhPT0gYSAmJiAobWgoYSwgZSwgZywgZiksIGVoKGEsIGUsIGcpKTtyZXR1cm4gZzt9CiAgICAgICAgICBmdW5jdGlvbiBobChhKSB7YSA9IGEuY3VycmVudDtpZiAoIWEuY2hpbGQpIHJldHVybiBudWxsO3N3aXRjaCAoYS5jaGlsZC50YWcpIHtjYXNlIDU6cmV0dXJuIGEuY2hpbGQuc3RhdGVOb2RlO2RlZmF1bHQ6cmV0dXJuIGEuY2hpbGQuc3RhdGVOb2RlO319ZnVuY3Rpb24gaWwoYSwgYikge2EgPSBhLm1lbW9pemVkU3RhdGU7aWYgKG51bGwgIT09IGEgJiYgbnVsbCAhPT0gYS5kZWh5ZHJhdGVkKSB7dmFyIGMgPSBhLnJldHJ5TGFuZTthLnJldHJ5TGFuZSA9IDAgIT09IGMgJiYgYyA8IGIgPyBjIDogYjt9fWZ1bmN0aW9uIGpsKGEsIGIpIHtpbChhLCBiKTsoYSA9IGEuYWx0ZXJuYXRlKSAmJiBpbChhLCBiKTt9ZnVuY3Rpb24ga2woKSB7cmV0dXJuIG51bGw7fXZhciBsbCA9ICJmdW5jdGlvbiIgPT09IHR5cGVvZiByZXBvcnRFcnJvciA/IHJlcG9ydEVycm9yIDogZnVuY3Rpb24gKGEpIHtjb25zb2xlLmVycm9yKGEpO307ZnVuY3Rpb24gbWwoYSkge3RoaXMuX2ludGVybmFsUm9vdCA9IGE7fQogICAgICAgICAgbmwucHJvdG90eXBlLnJlbmRlciA9IG1sLnByb3RvdHlwZS5yZW5kZXIgPSBmdW5jdGlvbiAoYSkge3ZhciBiID0gdGhpcy5faW50ZXJuYWxSb290O2lmIChudWxsID09PSBiKSB0aHJvdyBFcnJvcihwKDQwOSkpO2dsKGEsIGIsIG51bGwsIG51bGwpO307bmwucHJvdG90eXBlLnVubW91bnQgPSBtbC5wcm90b3R5cGUudW5tb3VudCA9IGZ1bmN0aW9uICgpIHt2YXIgYSA9IHRoaXMuX2ludGVybmFsUm9vdDtpZiAobnVsbCAhPT0gYSkge3RoaXMuX2ludGVybmFsUm9vdCA9IG51bGw7dmFyIGIgPSBhLmNvbnRhaW5lckluZm87U2soZnVuY3Rpb24gKCkge2dsKG51bGwsIGEsIG51bGwsIG51bGwpO30pO2JbdWZdID0gbnVsbDt9fTtmdW5jdGlvbiBubChhKSB7dGhpcy5faW50ZXJuYWxSb290ID0gYTt9CiAgICAgICAgICBubC5wcm90b3R5cGUudW5zdGFibGVfc2NoZWR1bGVIeWRyYXRpb24gPSBmdW5jdGlvbiAoYSkge2lmIChhKSB7dmFyIGIgPSBIYygpO2EgPSB7IGJsb2NrZWRPbjogbnVsbCwgdGFyZ2V0OiBhLCBwcmlvcml0eTogYiB9O2ZvciAodmFyIGMgPSAwOyBjIDwgUWMubGVuZ3RoICYmIDAgIT09IGIgJiYgYiA8IFFjW2NdLnByaW9yaXR5OyBjKyspO1FjLnNwbGljZShjLCAwLCBhKTswID09PSBjICYmIFZjKGEpO319O2Z1bmN0aW9uIG9sKGEpIHtyZXR1cm4gISghYSB8fCAxICE9PSBhLm5vZGVUeXBlICYmIDkgIT09IGEubm9kZVR5cGUgJiYgMTEgIT09IGEubm9kZVR5cGUpO31mdW5jdGlvbiBwbChhKSB7cmV0dXJuICEoIWEgfHwgMSAhPT0gYS5ub2RlVHlwZSAmJiA5ICE9PSBhLm5vZGVUeXBlICYmIDExICE9PSBhLm5vZGVUeXBlICYmICg4ICE9PSBhLm5vZGVUeXBlIHx8ICIgcmVhY3QtbW91bnQtcG9pbnQtdW5zdGFibGUgIiAhPT0gYS5ub2RlVmFsdWUpKTt9ZnVuY3Rpb24gcWwoKSB7fQogICAgICAgICAgZnVuY3Rpb24gcmwoYSwgYiwgYywgZCwgZSkge2lmIChlKSB7aWYgKCJmdW5jdGlvbiIgPT09IHR5cGVvZiBkKSB7dmFyIGYgPSBkO2QgPSBmdW5jdGlvbiBkKCkge3ZhciBhID0gaGwoZyk7Zi5jYWxsKGEpO307fXZhciBnID0gZmwoYiwgZCwgYSwgMCwgbnVsbCwgITEsICExLCAiIiwgcWwpO2EuX3JlYWN0Um9vdENvbnRhaW5lciA9IGc7YVt1Zl0gPSBnLmN1cnJlbnQ7c2YoOCA9PT0gYS5ub2RlVHlwZSA/IGEucGFyZW50Tm9kZSA6IGEpO1NrKCk7cmV0dXJuIGc7fWZvciAoOyBlID0gYS5sYXN0Q2hpbGQ7KSBhLnJlbW92ZUNoaWxkKGUpO2lmICgiZnVuY3Rpb24iID09PSB0eXBlb2YgZCkge3ZhciBoID0gZDtkID0gZnVuY3Rpb24gZCgpIHt2YXIgYSA9IGhsKGspO2guY2FsbChhKTt9O312YXIgayA9IGNsKGEsIDAsICExLCBudWxsLCBudWxsLCAhMSwgITEsICIiLCBxbCk7YS5fcmVhY3RSb290Q29udGFpbmVyID0gazthW3VmXSA9IGsuY3VycmVudDtzZig4ID09PSBhLm5vZGVUeXBlID8gYS5wYXJlbnROb2RlIDogYSk7U2soZnVuY3Rpb24gKCkge2dsKGIsIGssIGMsIGQpO30pO3JldHVybiBrO30KICAgICAgICAgIGZ1bmN0aW9uIHNsKGEsIGIsIGMsIGQsIGUpIHt2YXIgZiA9IGMuX3JlYWN0Um9vdENvbnRhaW5lcjtpZiAoZikge3ZhciBnID0gZjtpZiAoImZ1bmN0aW9uIiA9PT0gdHlwZW9mIGUpIHt2YXIgaCA9IGU7ZSA9IGZ1bmN0aW9uIGUoKSB7dmFyIGEgPSBobChnKTtoLmNhbGwoYSk7fTt9Z2woYiwgZywgYSwgZSk7fSBlbHNlIGcgPSBybChjLCBiLCBhLCBlLCBkKTtyZXR1cm4gaGwoZyk7fUVjID0gZnVuY3Rpb24gRWMoYSkge3N3aXRjaCAoYS50YWcpIHtjYXNlIDM6dmFyIGIgPSBhLnN0YXRlTm9kZTtpZiAoYi5jdXJyZW50Lm1lbW9pemVkU3RhdGUuaXNEZWh5ZHJhdGVkKSB7dmFyIGMgPSB0YyhiLnBlbmRpbmdMYW5lcyk7MCAhPT0gYyAmJiAoQ2MoYiwgYyB8IDEpLCBFayhiLCBCKCkpLCAwID09PSAoSyAmIDYpICYmIChIaiA9IEIoKSArIDUwMCwgamcoKSkpO31icmVhaztjYXNlIDEzOlNrKGZ1bmN0aW9uICgpIHt2YXIgYiA9IFpnKGEsIDEpO2lmIChudWxsICE9PSBiKSB7dmFyIGMgPSBMKCk7bWgoYiwgYSwgMSwgYyk7fX0pLCBqbChhLCAxKTt9fTsKICAgICAgICAgIEZjID0gZnVuY3Rpb24gRmMoYSkge2lmICgxMyA9PT0gYS50YWcpIHt2YXIgYiA9IFpnKGEsIDEzNDIxNzcyOCk7aWYgKG51bGwgIT09IGIpIHt2YXIgYyA9IEwoKTttaChiLCBhLCAxMzQyMTc3MjgsIGMpO31qbChhLCAxMzQyMTc3MjgpO319O0djID0gZnVuY3Rpb24gR2MoYSkge2lmICgxMyA9PT0gYS50YWcpIHt2YXIgYiA9IGxoKGEpLGMgPSBaZyhhLCBiKTtpZiAobnVsbCAhPT0gYykge3ZhciBkID0gTCgpO21oKGMsIGEsIGIsIGQpO31qbChhLCBiKTt9fTtIYyA9IGZ1bmN0aW9uIEhjKCkge3JldHVybiBDO307SWMgPSBmdW5jdGlvbiBJYyhhLCBiKSB7dmFyIGMgPSBDO3RyeSB7cmV0dXJuIEMgPSBhLCBiKCk7fSBmaW5hbGx5IHtDID0gYzt9fTsKICAgICAgICAgIHliID0gZnVuY3Rpb24geWIoYSwgYiwgYykge3N3aXRjaCAoYikge2Nhc2UgImlucHV0IjpiYihhLCBjKTtiID0gYy5uYW1lO2lmICgicmFkaW8iID09PSBjLnR5cGUgJiYgbnVsbCAhPSBiKSB7Zm9yIChjID0gYTsgYy5wYXJlbnROb2RlOykgYyA9IGMucGFyZW50Tm9kZTtjID0gYy5xdWVyeVNlbGVjdG9yQWxsKCJpbnB1dFtuYW1lPSIgKyBKU09OLnN0cmluZ2lmeSgiIiArIGIpICsgJ11bdHlwZT0icmFkaW8iXScpO2ZvciAoYiA9IDA7IGIgPCBjLmxlbmd0aDsgYisrKSB7dmFyIGQgPSBjW2JdO2lmIChkICE9PSBhICYmIGQuZm9ybSA9PT0gYS5mb3JtKSB7dmFyIGUgPSBEYihkKTtpZiAoIWUpIHRocm93IEVycm9yKHAoOTApKTtXYShkKTtiYihkLCBlKTt9fX1icmVhaztjYXNlICJ0ZXh0YXJlYSI6aWIoYSwgYyk7YnJlYWs7Y2FzZSAic2VsZWN0IjpiID0gYy52YWx1ZSwgbnVsbCAhPSBiICYmIGZiKGEsICEhYy5tdWx0aXBsZSwgYiwgITEpO319O0diID0gUms7SGIgPSBTazsKICAgICAgICAgIHZhciB0bCA9IHsgdXNpbmdDbGllbnRFbnRyeVBvaW50OiAhMSwgRXZlbnRzOiBbQ2IsIHVlLCBEYiwgRWIsIEZiLCBSa10gfSx1bCA9IHsgZmluZEZpYmVyQnlIb3N0SW5zdGFuY2U6IFdjLCBidW5kbGVUeXBlOiAwLCB2ZXJzaW9uOiAiMTguMi4wIiwgcmVuZGVyZXJQYWNrYWdlTmFtZTogInJlYWN0LWRvbSIgfTsKICAgICAgICAgIHZhciB2bCA9IHsgYnVuZGxlVHlwZTogdWwuYnVuZGxlVHlwZSwgdmVyc2lvbjogdWwudmVyc2lvbiwgcmVuZGVyZXJQYWNrYWdlTmFtZTogdWwucmVuZGVyZXJQYWNrYWdlTmFtZSwgcmVuZGVyZXJDb25maWc6IHVsLnJlbmRlcmVyQ29uZmlnLCBvdmVycmlkZUhvb2tTdGF0ZTogbnVsbCwgb3ZlcnJpZGVIb29rU3RhdGVEZWxldGVQYXRoOiBudWxsLCBvdmVycmlkZUhvb2tTdGF0ZVJlbmFtZVBhdGg6IG51bGwsIG92ZXJyaWRlUHJvcHM6IG51bGwsIG92ZXJyaWRlUHJvcHNEZWxldGVQYXRoOiBudWxsLCBvdmVycmlkZVByb3BzUmVuYW1lUGF0aDogbnVsbCwgc2V0RXJyb3JIYW5kbGVyOiBudWxsLCBzZXRTdXNwZW5zZUhhbmRsZXI6IG51bGwsIHNjaGVkdWxlVXBkYXRlOiBudWxsLCBjdXJyZW50RGlzcGF0Y2hlclJlZjogdWEuUmVhY3RDdXJyZW50RGlzcGF0Y2hlciwgZmluZEhvc3RJbnN0YW5jZUJ5RmliZXI6IGZ1bmN0aW9uIGZpbmRIb3N0SW5zdGFuY2VCeUZpYmVyKGEpIHthID0gWmIoYSk7cmV0dXJuIG51bGwgPT09IGEgPyBudWxsIDogYS5zdGF0ZU5vZGU7fSwgZmluZEZpYmVyQnlIb3N0SW5zdGFuY2U6IHVsLmZpbmRGaWJlckJ5SG9zdEluc3RhbmNlIHx8CiAgICAgICAgICAgIGtsLCBmaW5kSG9zdEluc3RhbmNlc0ZvclJlZnJlc2g6IG51bGwsIHNjaGVkdWxlUmVmcmVzaDogbnVsbCwgc2NoZWR1bGVSb290OiBudWxsLCBzZXRSZWZyZXNoSGFuZGxlcjogbnVsbCwgZ2V0Q3VycmVudEZpYmVyOiBudWxsLCByZWNvbmNpbGVyVmVyc2lvbjogIjE4LjIuMC1uZXh0LTllM2I3NzJiOC0yMDIyMDYwOCIgfTtpZiAoInVuZGVmaW5lZCIgIT09IHR5cGVvZiBfX1JFQUNUX0RFVlRPT0xTX0dMT0JBTF9IT09LX18pIHt2YXIgd2wgPSBfX1JFQUNUX0RFVlRPT0xTX0dMT0JBTF9IT09LX187aWYgKCF3bC5pc0Rpc2FibGVkICYmIHdsLnN1cHBvcnRzRmliZXIpIHRyeSB7a2MgPSB3bC5pbmplY3QodmwpLCBsYyA9IHdsO30gY2F0Y2ggKGEpIHt9fWV4cG9ydHMuX19TRUNSRVRfSU5URVJOQUxTX0RPX05PVF9VU0VfT1JfWU9VX1dJTExfQkVfRklSRUQgPSB0bDsKICAgICAgICAgIGV4cG9ydHMuY3JlYXRlUG9ydGFsID0gZnVuY3Rpb24gKGEsIGIpIHt2YXIgYyA9IDIgPCBhcmd1bWVudHMubGVuZ3RoICYmIHZvaWQgMCAhPT0gYXJndW1lbnRzWzJdID8gYXJndW1lbnRzWzJdIDogbnVsbDtpZiAoIW9sKGIpKSB0aHJvdyBFcnJvcihwKDIwMCkpO3JldHVybiBkbChhLCBiLCBudWxsLCBjKTt9O2V4cG9ydHMuY3JlYXRlUm9vdCA9IGZ1bmN0aW9uIChhLCBiKSB7aWYgKCFvbChhKSkgdGhyb3cgRXJyb3IocCgyOTkpKTt2YXIgYyA9ICExLGQgPSAiIixlID0gbGw7bnVsbCAhPT0gYiAmJiB2b2lkIDAgIT09IGIgJiYgKCEwID09PSBiLnVuc3RhYmxlX3N0cmljdE1vZGUgJiYgKGMgPSAhMCksIHZvaWQgMCAhPT0gYi5pZGVudGlmaWVyUHJlZml4ICYmIChkID0gYi5pZGVudGlmaWVyUHJlZml4KSwgdm9pZCAwICE9PSBiLm9uUmVjb3ZlcmFibGVFcnJvciAmJiAoZSA9IGIub25SZWNvdmVyYWJsZUVycm9yKSk7YiA9IGNsKGEsIDEsICExLCBudWxsLCBudWxsLCBjLCAhMSwgZCwgZSk7YVt1Zl0gPSBiLmN1cnJlbnQ7c2YoOCA9PT0gYS5ub2RlVHlwZSA/IGEucGFyZW50Tm9kZSA6IGEpO3JldHVybiBuZXcgbWwoYik7fTsKICAgICAgICAgIGV4cG9ydHMuZmluZERPTU5vZGUgPSBmdW5jdGlvbiAoYSkge2lmIChudWxsID09IGEpIHJldHVybiBudWxsO2lmICgxID09PSBhLm5vZGVUeXBlKSByZXR1cm4gYTt2YXIgYiA9IGEuX3JlYWN0SW50ZXJuYWxzO2lmICh2b2lkIDAgPT09IGIpIHtpZiAoImZ1bmN0aW9uIiA9PT0gdHlwZW9mIGEucmVuZGVyKSB0aHJvdyBFcnJvcihwKDE4OCkpO2EgPSBPYmplY3Qua2V5cyhhKS5qb2luKCIsIik7dGhyb3cgRXJyb3IocCgyNjgsIGEpKTt9YSA9IFpiKGIpO2EgPSBudWxsID09PSBhID8gbnVsbCA6IGEuc3RhdGVOb2RlO3JldHVybiBhO307ZXhwb3J0cy5mbHVzaFN5bmMgPSBmdW5jdGlvbiAoYSkge3JldHVybiBTayhhKTt9O2V4cG9ydHMuaHlkcmF0ZSA9IGZ1bmN0aW9uIChhLCBiLCBjKSB7aWYgKCFwbChiKSkgdGhyb3cgRXJyb3IocCgyMDApKTtyZXR1cm4gc2wobnVsbCwgYSwgYiwgITAsIGMpO307CiAgICAgICAgICBleHBvcnRzLmh5ZHJhdGVSb290ID0gZnVuY3Rpb24gKGEsIGIsIGMpIHtpZiAoIW9sKGEpKSB0aHJvdyBFcnJvcihwKDQwNSkpO3ZhciBkID0gbnVsbCAhPSBjICYmIGMuaHlkcmF0ZWRTb3VyY2VzIHx8IG51bGwsZSA9ICExLGYgPSAiIixnID0gbGw7bnVsbCAhPT0gYyAmJiB2b2lkIDAgIT09IGMgJiYgKCEwID09PSBjLnVuc3RhYmxlX3N0cmljdE1vZGUgJiYgKGUgPSAhMCksIHZvaWQgMCAhPT0gYy5pZGVudGlmaWVyUHJlZml4ICYmIChmID0gYy5pZGVudGlmaWVyUHJlZml4KSwgdm9pZCAwICE9PSBjLm9uUmVjb3ZlcmFibGVFcnJvciAmJiAoZyA9IGMub25SZWNvdmVyYWJsZUVycm9yKSk7YiA9IGZsKGIsIG51bGwsIGEsIDEsIG51bGwgIT0gYyA/IGMgOiBudWxsLCBlLCAhMSwgZiwgZyk7YVt1Zl0gPSBiLmN1cnJlbnQ7c2YoYSk7aWYgKGQpIGZvciAoYSA9IDA7IGEgPCBkLmxlbmd0aDsgYSsrKSBjID0gZFthXSwgZSA9IGMuX2dldFZlcnNpb24sIGUgPSBlKGMuX3NvdXJjZSksIG51bGwgPT0gYi5tdXRhYmxlU291cmNlRWFnZXJIeWRyYXRpb25EYXRhID8gYi5tdXRhYmxlU291cmNlRWFnZXJIeWRyYXRpb25EYXRhID0gW2MsIGVdIDogYi5tdXRhYmxlU291cmNlRWFnZXJIeWRyYXRpb25EYXRhLnB1c2goYywKICAgICAgICAgICAgZSk7cmV0dXJuIG5ldyBubChiKTt9O2V4cG9ydHMucmVuZGVyID0gZnVuY3Rpb24gKGEsIGIsIGMpIHtpZiAoIXBsKGIpKSB0aHJvdyBFcnJvcihwKDIwMCkpO3JldHVybiBzbChudWxsLCBhLCBiLCAhMSwgYyk7fTtleHBvcnRzLnVubW91bnRDb21wb25lbnRBdE5vZGUgPSBmdW5jdGlvbiAoYSkge2lmICghcGwoYSkpIHRocm93IEVycm9yKHAoNDApKTtyZXR1cm4gYS5fcmVhY3RSb290Q29udGFpbmVyID8gKFNrKGZ1bmN0aW9uICgpIHtzbChudWxsLCBudWxsLCBhLCAhMSwgZnVuY3Rpb24gKCkge2EuX3JlYWN0Um9vdENvbnRhaW5lciA9IG51bGw7YVt1Zl0gPSBudWxsO30pO30pLCAhMCkgOiAhMTt9O2V4cG9ydHMudW5zdGFibGVfYmF0Y2hlZFVwZGF0ZXMgPSBSazsKICAgICAgICAgIGV4cG9ydHMudW5zdGFibGVfcmVuZGVyU3VidHJlZUludG9Db250YWluZXIgPSBmdW5jdGlvbiAoYSwgYiwgYywgZCkge2lmICghcGwoYykpIHRocm93IEVycm9yKHAoMjAwKSk7aWYgKG51bGwgPT0gYSB8fCB2b2lkIDAgPT09IGEuX3JlYWN0SW50ZXJuYWxzKSB0aHJvdyBFcnJvcihwKDM4KSk7cmV0dXJuIHNsKGEsIGIsIGMsICExLCBkKTt9O2V4cG9ydHMudmVyc2lvbiA9ICIxOC4yLjAtbmV4dC05ZTNiNzcyYjgtMjAyMjA2MDgiOwoKCiAgICAgICAgICAvKioqL30sCgogICAgICAgIC8qKiovNzQ1OgogICAgICAgIC8qKiovKF9fdW51c2VkX3dlYnBhY2tfbW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSA9PiB7CgogICAgICAgICAgdmFyIF9fd2VicGFja191bnVzZWRfZXhwb3J0X187CgoKICAgICAgICAgIHZhciBtID0gX193ZWJwYWNrX3JlcXVpcmVfXyg5MzUpOwogICAgICAgICAgaWYgKHRydWUpIHsKICAgICAgICAgICAgZXhwb3J0cy5zID0gbS5jcmVhdGVSb290OwogICAgICAgICAgICBfX3dlYnBhY2tfdW51c2VkX2V4cG9ydF9fID0gbS5oeWRyYXRlUm9vdDsKICAgICAgICAgIH0gZWxzZSB7dmFyIGk7fQoKCiAgICAgICAgICAvKioqL30sCgogICAgICAgIC8qKiovOTM1OgogICAgICAgIC8qKiovKG1vZHVsZSwgX191bnVzZWRfd2VicGFja19leHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSA9PiB7CgoKCiAgICAgICAgICBmdW5jdGlvbiBjaGVja0RDRSgpIHsKICAgICAgICAgICAgLyogZ2xvYmFsIF9fUkVBQ1RfREVWVE9PTFNfR0xPQkFMX0hPT0tfXyAqLwogICAgICAgICAgICBpZiAoCiAgICAgICAgICAgIHR5cGVvZiBfX1JFQUNUX0RFVlRPT0xTX0dMT0JBTF9IT09LX18gPT09ICd1bmRlZmluZWQnIHx8CiAgICAgICAgICAgIHR5cGVvZiBfX1JFQUNUX0RFVlRPT0xTX0dMT0JBTF9IT09LX18uY2hlY2tEQ0UgIT09ICdmdW5jdGlvbicpCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKGZhbHNlKSB7fQogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgIC8vIFZlcmlmeSB0aGF0IHRoZSBjb2RlIGFib3ZlIGhhcyBiZWVuIGRlYWQgY29kZSBlbGltaW5hdGVkIChEQ0UnZCkuCiAgICAgICAgICAgICAgX19SRUFDVF9ERVZUT09MU19HTE9CQUxfSE9PS19fLmNoZWNrRENFKGNoZWNrRENFKTsKICAgICAgICAgICAgfSBjYXRjaCAoZXJyKSB7CiAgICAgICAgICAgICAgLy8gRGV2VG9vbHMgc2hvdWxkbid0IGNyYXNoIFJlYWN0LCBubyBtYXR0ZXIgd2hhdC4KICAgICAgICAgICAgICAvLyBXZSBzaG91bGQgc3RpbGwgcmVwb3J0IGluIGNhc2Ugd2UgYnJlYWsgdGhpcyBjb2RlLgogICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQoKICAgICAgICAgIGlmICh0cnVlKSB7CiAgICAgICAgICAgIC8vIERDRSBjaGVjayBzaG91bGQgaGFwcGVuIGJlZm9yZSBSZWFjdERPTSBidW5kbGUgZXhlY3V0ZXMgc28gdGhhdAogICAgICAgICAgICAvLyBEZXZUb29scyBjYW4gcmVwb3J0IGJhZCBtaW5pZmljYXRpb24gZHVyaW5nIGluamVjdGlvbi4KICAgICAgICAgICAgY2hlY2tEQ0UoKTsKICAgICAgICAgICAgbW9kdWxlLmV4cG9ydHMgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDQ0OCk7CiAgICAgICAgICB9IGVsc2Uge30KCgogICAgICAgICAgLyoqKi99LAoKICAgICAgICAvKioqLzQwODoKICAgICAgICAvKioqLyhfX3VudXNlZF93ZWJwYWNrX21vZHVsZSwgZXhwb3J0cykgPT4gewoKICAgICAgICAgIC8qKgogICAgICAgICAgICogQGxpY2Vuc2UgUmVhY3QKICAgICAgICAgICAqIHJlYWN0LnByb2R1Y3Rpb24ubWluLmpzCiAgICAgICAgICAgKgogICAgICAgICAgICogQ29weXJpZ2h0IChjKSBGYWNlYm9vaywgSW5jLiBhbmQgaXRzIGFmZmlsaWF0ZXMuCiAgICAgICAgICAgKgogICAgICAgICAgICogVGhpcyBzb3VyY2UgY29kZSBpcyBsaWNlbnNlZCB1bmRlciB0aGUgTUlUIGxpY2Vuc2UgZm91bmQgaW4gdGhlCiAgICAgICAgICAgKiBMSUNFTlNFIGZpbGUgaW4gdGhlIHJvb3QgZGlyZWN0b3J5IG9mIHRoaXMgc291cmNlIHRyZWUuCiAgICAgICAgICAgKi8KICAgICAgICAgIHZhciBsID0gU3ltYm9sLmZvcigicmVhY3QuZWxlbWVudCIpLG4gPSBTeW1ib2wuZm9yKCJyZWFjdC5wb3J0YWwiKSxwID0gU3ltYm9sLmZvcigicmVhY3QuZnJhZ21lbnQiKSxxID0gU3ltYm9sLmZvcigicmVhY3Quc3RyaWN0X21vZGUiKSxyID0gU3ltYm9sLmZvcigicmVhY3QucHJvZmlsZXIiKSx0ID0gU3ltYm9sLmZvcigicmVhY3QucHJvdmlkZXIiKSx1ID0gU3ltYm9sLmZvcigicmVhY3QuY29udGV4dCIpLHYgPSBTeW1ib2wuZm9yKCJyZWFjdC5mb3J3YXJkX3JlZiIpLHcgPSBTeW1ib2wuZm9yKCJyZWFjdC5zdXNwZW5zZSIpLHggPSBTeW1ib2wuZm9yKCJyZWFjdC5tZW1vIikseSA9IFN5bWJvbC5mb3IoInJlYWN0LmxhenkiKSx6ID0gU3ltYm9sLml0ZXJhdG9yO2Z1bmN0aW9uIEEoYSkge2lmIChudWxsID09PSBhIHx8ICJvYmplY3QiICE9PSB0eXBlb2YgYSkgcmV0dXJuIG51bGw7YSA9IHogJiYgYVt6XSB8fCBhWyJAQGl0ZXJhdG9yIl07cmV0dXJuICJmdW5jdGlvbiIgPT09IHR5cGVvZiBhID8gYSA6IG51bGw7fQogICAgICAgICAgdmFyIEIgPSB7IGlzTW91bnRlZDogZnVuY3Rpb24gaXNNb3VudGVkKCkge3JldHVybiAhMTt9LCBlbnF1ZXVlRm9yY2VVcGRhdGU6IGZ1bmN0aW9uIGVucXVldWVGb3JjZVVwZGF0ZSgpIHt9LCBlbnF1ZXVlUmVwbGFjZVN0YXRlOiBmdW5jdGlvbiBlbnF1ZXVlUmVwbGFjZVN0YXRlKCkge30sIGVucXVldWVTZXRTdGF0ZTogZnVuY3Rpb24gZW5xdWV1ZVNldFN0YXRlKCkge30gfSxDID0gT2JqZWN0LmFzc2lnbixEID0ge307ZnVuY3Rpb24gRShhLCBiLCBlKSB7dGhpcy5wcm9wcyA9IGE7dGhpcy5jb250ZXh0ID0gYjt0aGlzLnJlZnMgPSBEO3RoaXMudXBkYXRlciA9IGUgfHwgQjt9RS5wcm90b3R5cGUuaXNSZWFjdENvbXBvbmVudCA9IHt9OwogICAgICAgICAgRS5wcm90b3R5cGUuc2V0U3RhdGUgPSBmdW5jdGlvbiAoYSwgYikge2lmICgib2JqZWN0IiAhPT0gdHlwZW9mIGEgJiYgImZ1bmN0aW9uIiAhPT0gdHlwZW9mIGEgJiYgbnVsbCAhPSBhKSB0aHJvdyBFcnJvcigic2V0U3RhdGUoLi4uKTogdGFrZXMgYW4gb2JqZWN0IG9mIHN0YXRlIHZhcmlhYmxlcyB0byB1cGRhdGUgb3IgYSBmdW5jdGlvbiB3aGljaCByZXR1cm5zIGFuIG9iamVjdCBvZiBzdGF0ZSB2YXJpYWJsZXMuIik7dGhpcy51cGRhdGVyLmVucXVldWVTZXRTdGF0ZSh0aGlzLCBhLCBiLCAic2V0U3RhdGUiKTt9O0UucHJvdG90eXBlLmZvcmNlVXBkYXRlID0gZnVuY3Rpb24gKGEpIHt0aGlzLnVwZGF0ZXIuZW5xdWV1ZUZvcmNlVXBkYXRlKHRoaXMsIGEsICJmb3JjZVVwZGF0ZSIpO307ZnVuY3Rpb24gRigpIHt9Ri5wcm90b3R5cGUgPSBFLnByb3RvdHlwZTtmdW5jdGlvbiBHKGEsIGIsIGUpIHt0aGlzLnByb3BzID0gYTt0aGlzLmNvbnRleHQgPSBiO3RoaXMucmVmcyA9IEQ7dGhpcy51cGRhdGVyID0gZSB8fCBCO312YXIgSCA9IEcucHJvdG90eXBlID0gbmV3IEYoKTsKICAgICAgICAgIEguY29uc3RydWN0b3IgPSBHO0MoSCwgRS5wcm90b3R5cGUpO0guaXNQdXJlUmVhY3RDb21wb25lbnQgPSAhMDt2YXIgSSA9IEFycmF5LmlzQXJyYXksSiA9IE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHksSyA9IHsgY3VycmVudDogbnVsbCB9LEwgPSB7IGtleTogITAsIHJlZjogITAsIF9fc2VsZjogITAsIF9fc291cmNlOiAhMCB9OwogICAgICAgICAgZnVuY3Rpb24gTShhLCBiLCBlKSB7dmFyIGQsYyA9IHt9LGsgPSBudWxsLGggPSBudWxsO2lmIChudWxsICE9IGIpIGZvciAoZCBpbiB2b2lkIDAgIT09IGIucmVmICYmIChoID0gYi5yZWYpLCB2b2lkIDAgIT09IGIua2V5ICYmIChrID0gIiIgKyBiLmtleSksIGIpIEouY2FsbChiLCBkKSAmJiAhTC5oYXNPd25Qcm9wZXJ0eShkKSAmJiAoY1tkXSA9IGJbZF0pO3ZhciBnID0gYXJndW1lbnRzLmxlbmd0aCAtIDI7aWYgKDEgPT09IGcpIGMuY2hpbGRyZW4gPSBlO2Vsc2UgaWYgKDEgPCBnKSB7Zm9yICh2YXIgZiA9IEFycmF5KGcpLCBtID0gMDsgbSA8IGc7IG0rKykgZlttXSA9IGFyZ3VtZW50c1ttICsgMl07Yy5jaGlsZHJlbiA9IGY7fWlmIChhICYmIGEuZGVmYXVsdFByb3BzKSBmb3IgKGQgaW4gZyA9IGEuZGVmYXVsdFByb3BzLCBnKSB2b2lkIDAgPT09IGNbZF0gJiYgKGNbZF0gPSBnW2RdKTtyZXR1cm4geyAkJHR5cGVvZjogbCwgdHlwZTogYSwga2V5OiBrLCByZWY6IGgsIHByb3BzOiBjLCBfb3duZXI6IEsuY3VycmVudCB9O30KICAgICAgICAgIGZ1bmN0aW9uIE4oYSwgYikge3JldHVybiB7ICQkdHlwZW9mOiBsLCB0eXBlOiBhLnR5cGUsIGtleTogYiwgcmVmOiBhLnJlZiwgcHJvcHM6IGEucHJvcHMsIF9vd25lcjogYS5fb3duZXIgfTt9ZnVuY3Rpb24gTyhhKSB7cmV0dXJuICJvYmplY3QiID09PSB0eXBlb2YgYSAmJiBudWxsICE9PSBhICYmIGEuJCR0eXBlb2YgPT09IGw7fWZ1bmN0aW9uIGVzY2FwZShhKSB7dmFyIGIgPSB7ICI9IjogIj0wIiwgIjoiOiAiPTIiIH07cmV0dXJuICIkIiArIGEucmVwbGFjZSgvWz06XS9nLCBmdW5jdGlvbiAoYSkge3JldHVybiBiW2FdO30pO312YXIgUCA9IC9cLysvZztmdW5jdGlvbiBRKGEsIGIpIHtyZXR1cm4gIm9iamVjdCIgPT09IHR5cGVvZiBhICYmIG51bGwgIT09IGEgJiYgbnVsbCAhPSBhLmtleSA/IGVzY2FwZSgiIiArIGEua2V5KSA6IGIudG9TdHJpbmcoMzYpO30KICAgICAgICAgIGZ1bmN0aW9uIFIoYSwgYiwgZSwgZCwgYykge3ZhciBrID0gdHlwZW9mIGE7aWYgKCJ1bmRlZmluZWQiID09PSBrIHx8ICJib29sZWFuIiA9PT0gaykgYSA9IG51bGw7dmFyIGggPSAhMTtpZiAobnVsbCA9PT0gYSkgaCA9ICEwO2Vsc2Ugc3dpdGNoIChrKSB7Y2FzZSAic3RyaW5nIjpjYXNlICJudW1iZXIiOmggPSAhMDticmVhaztjYXNlICJvYmplY3QiOnN3aXRjaCAoYS4kJHR5cGVvZikge2Nhc2UgbDpjYXNlIG46aCA9ICEwO319aWYgKGgpIHJldHVybiBoID0gYSwgYyA9IGMoaCksIGEgPSAiIiA9PT0gZCA/ICIuIiArIFEoaCwgMCkgOiBkLCBJKGMpID8gKGUgPSAiIiwgbnVsbCAhPSBhICYmIChlID0gYS5yZXBsYWNlKFAsICIkJi8iKSArICIvIiksIFIoYywgYiwgZSwgIiIsIGZ1bmN0aW9uIChhKSB7cmV0dXJuIGE7fSkpIDogbnVsbCAhPSBjICYmIChPKGMpICYmIChjID0gTihjLCBlICsgKCFjLmtleSB8fCBoICYmIGgua2V5ID09PSBjLmtleSA/ICIiIDogKCIiICsgYy5rZXkpLnJlcGxhY2UoUCwgIiQmLyIpICsgIi8iKSArIGEpKSwgYi5wdXNoKGMpKSwgMTtoID0gMDtkID0gIiIgPT09IGQgPyAiLiIgOiBkICsgIjoiO2lmIChJKGEpKSBmb3IgKHZhciBnID0gMDsgZyA8IGEubGVuZ3RoOyBnKyspIHtrID0KICAgICAgICAgICAgICBhW2ddO3ZhciBmID0gZCArIFEoaywgZyk7aCArPSBSKGssIGIsIGUsIGYsIGMpO30gZWxzZSBpZiAoZiA9IEEoYSksICJmdW5jdGlvbiIgPT09IHR5cGVvZiBmKSBmb3IgKGEgPSBmLmNhbGwoYSksIGcgPSAwOyAhKGsgPSBhLm5leHQoKSkuZG9uZTspIGsgPSBrLnZhbHVlLCBmID0gZCArIFEoaywgZysrKSwgaCArPSBSKGssIGIsIGUsIGYsIGMpO2Vsc2UgaWYgKCJvYmplY3QiID09PSBrKSB0aHJvdyBiID0gU3RyaW5nKGEpLCBFcnJvcigiT2JqZWN0cyBhcmUgbm90IHZhbGlkIGFzIGEgUmVhY3QgY2hpbGQgKGZvdW5kOiAiICsgKCJbb2JqZWN0IE9iamVjdF0iID09PSBiID8gIm9iamVjdCB3aXRoIGtleXMgeyIgKyBPYmplY3Qua2V5cyhhKS5qb2luKCIsICIpICsgIn0iIDogYikgKyAiKS4gSWYgeW91IG1lYW50IHRvIHJlbmRlciBhIGNvbGxlY3Rpb24gb2YgY2hpbGRyZW4sIHVzZSBhbiBhcnJheSBpbnN0ZWFkLiIpO3JldHVybiBoO30KICAgICAgICAgIGZ1bmN0aW9uIFMoYSwgYiwgZSkge2lmIChudWxsID09IGEpIHJldHVybiBhO3ZhciBkID0gW10sYyA9IDA7UihhLCBkLCAiIiwgIiIsIGZ1bmN0aW9uIChhKSB7cmV0dXJuIGIuY2FsbChlLCBhLCBjKyspO30pO3JldHVybiBkO31mdW5jdGlvbiBUKGEpIHtpZiAoLTEgPT09IGEuX3N0YXR1cykge3ZhciBiID0gYS5fcmVzdWx0O2IgPSBiKCk7Yi50aGVuKGZ1bmN0aW9uIChiKSB7aWYgKDAgPT09IGEuX3N0YXR1cyB8fCAtMSA9PT0gYS5fc3RhdHVzKSBhLl9zdGF0dXMgPSAxLCBhLl9yZXN1bHQgPSBiO30sIGZ1bmN0aW9uIChiKSB7aWYgKDAgPT09IGEuX3N0YXR1cyB8fCAtMSA9PT0gYS5fc3RhdHVzKSBhLl9zdGF0dXMgPSAyLCBhLl9yZXN1bHQgPSBiO30pOy0xID09PSBhLl9zdGF0dXMgJiYgKGEuX3N0YXR1cyA9IDAsIGEuX3Jlc3VsdCA9IGIpO31pZiAoMSA9PT0gYS5fc3RhdHVzKSByZXR1cm4gYS5fcmVzdWx0LmRlZmF1bHQ7dGhyb3cgYS5fcmVzdWx0O30KICAgICAgICAgIHZhciBVID0geyBjdXJyZW50OiBudWxsIH0sViA9IHsgdHJhbnNpdGlvbjogbnVsbCB9LFcgPSB7IFJlYWN0Q3VycmVudERpc3BhdGNoZXI6IFUsIFJlYWN0Q3VycmVudEJhdGNoQ29uZmlnOiBWLCBSZWFjdEN1cnJlbnRPd25lcjogSyB9O2V4cG9ydHMuQ2hpbGRyZW4gPSB7IG1hcDogUywgZm9yRWFjaDogZnVuY3Rpb24gZm9yRWFjaChhLCBiLCBlKSB7UyhhLCBmdW5jdGlvbiAoKSB7Yi5hcHBseSh0aGlzLCBhcmd1bWVudHMpO30sIGUpO30sIGNvdW50OiBmdW5jdGlvbiBjb3VudChhKSB7dmFyIGIgPSAwO1MoYSwgZnVuY3Rpb24gKCkge2IrKzt9KTtyZXR1cm4gYjt9LCB0b0FycmF5OiBmdW5jdGlvbiB0b0FycmF5KGEpIHtyZXR1cm4gUyhhLCBmdW5jdGlvbiAoYSkge3JldHVybiBhO30pIHx8IFtdO30sIG9ubHk6IGZ1bmN0aW9uIG9ubHkoYSkge2lmICghTyhhKSkgdGhyb3cgRXJyb3IoIlJlYWN0LkNoaWxkcmVuLm9ubHkgZXhwZWN0ZWQgdG8gcmVjZWl2ZSBhIHNpbmdsZSBSZWFjdCBlbGVtZW50IGNoaWxkLiIpO3JldHVybiBhO30gfTtleHBvcnRzLkNvbXBvbmVudCA9IEU7ZXhwb3J0cy5GcmFnbWVudCA9IHA7CiAgICAgICAgICBleHBvcnRzLlByb2ZpbGVyID0gcjtleHBvcnRzLlB1cmVDb21wb25lbnQgPSBHO2V4cG9ydHMuU3RyaWN0TW9kZSA9IHE7ZXhwb3J0cy5TdXNwZW5zZSA9IHc7ZXhwb3J0cy5fX1NFQ1JFVF9JTlRFUk5BTFNfRE9fTk9UX1VTRV9PUl9ZT1VfV0lMTF9CRV9GSVJFRCA9IFc7CiAgICAgICAgICBleHBvcnRzLmNsb25lRWxlbWVudCA9IGZ1bmN0aW9uIChhLCBiLCBlKSB7aWYgKG51bGwgPT09IGEgfHwgdm9pZCAwID09PSBhKSB0aHJvdyBFcnJvcigiUmVhY3QuY2xvbmVFbGVtZW50KC4uLik6IFRoZSBhcmd1bWVudCBtdXN0IGJlIGEgUmVhY3QgZWxlbWVudCwgYnV0IHlvdSBwYXNzZWQgIiArIGEgKyAiLiIpO3ZhciBkID0gQyh7fSwgYS5wcm9wcyksYyA9IGEua2V5LGsgPSBhLnJlZixoID0gYS5fb3duZXI7aWYgKG51bGwgIT0gYikge3ZvaWQgMCAhPT0gYi5yZWYgJiYgKGsgPSBiLnJlZiwgaCA9IEsuY3VycmVudCk7dm9pZCAwICE9PSBiLmtleSAmJiAoYyA9ICIiICsgYi5rZXkpO2lmIChhLnR5cGUgJiYgYS50eXBlLmRlZmF1bHRQcm9wcykgdmFyIGcgPSBhLnR5cGUuZGVmYXVsdFByb3BzO2ZvciAoZiBpbiBiKSBKLmNhbGwoYiwgZikgJiYgIUwuaGFzT3duUHJvcGVydHkoZikgJiYgKGRbZl0gPSB2b2lkIDAgPT09IGJbZl0gJiYgdm9pZCAwICE9PSBnID8gZ1tmXSA6IGJbZl0pO312YXIgZiA9IGFyZ3VtZW50cy5sZW5ndGggLSAyO2lmICgxID09PSBmKSBkLmNoaWxkcmVuID0gZTtlbHNlIGlmICgxIDwgZikge2cgPSBBcnJheShmKTsKICAgICAgICAgICAgICBmb3IgKHZhciBtID0gMDsgbSA8IGY7IG0rKykgZ1ttXSA9IGFyZ3VtZW50c1ttICsgMl07ZC5jaGlsZHJlbiA9IGc7fXJldHVybiB7ICQkdHlwZW9mOiBsLCB0eXBlOiBhLnR5cGUsIGtleTogYywgcmVmOiBrLCBwcm9wczogZCwgX293bmVyOiBoIH07fTtleHBvcnRzLmNyZWF0ZUNvbnRleHQgPSBmdW5jdGlvbiAoYSkge2EgPSB7ICQkdHlwZW9mOiB1LCBfY3VycmVudFZhbHVlOiBhLCBfY3VycmVudFZhbHVlMjogYSwgX3RocmVhZENvdW50OiAwLCBQcm92aWRlcjogbnVsbCwgQ29uc3VtZXI6IG51bGwsIF9kZWZhdWx0VmFsdWU6IG51bGwsIF9nbG9iYWxOYW1lOiBudWxsIH07YS5Qcm92aWRlciA9IHsgJCR0eXBlb2Y6IHQsIF9jb250ZXh0OiBhIH07cmV0dXJuIGEuQ29uc3VtZXIgPSBhO307ZXhwb3J0cy5jcmVhdGVFbGVtZW50ID0gTTtleHBvcnRzLmNyZWF0ZUZhY3RvcnkgPSBmdW5jdGlvbiAoYSkge3ZhciBiID0gTS5iaW5kKG51bGwsIGEpO2IudHlwZSA9IGE7cmV0dXJuIGI7fTtleHBvcnRzLmNyZWF0ZVJlZiA9IGZ1bmN0aW9uICgpIHtyZXR1cm4geyBjdXJyZW50OiBudWxsIH07fTsKICAgICAgICAgIGV4cG9ydHMuZm9yd2FyZFJlZiA9IGZ1bmN0aW9uIChhKSB7cmV0dXJuIHsgJCR0eXBlb2Y6IHYsIHJlbmRlcjogYSB9O307ZXhwb3J0cy5pc1ZhbGlkRWxlbWVudCA9IE87ZXhwb3J0cy5sYXp5ID0gZnVuY3Rpb24gKGEpIHtyZXR1cm4geyAkJHR5cGVvZjogeSwgX3BheWxvYWQ6IHsgX3N0YXR1czogLTEsIF9yZXN1bHQ6IGEgfSwgX2luaXQ6IFQgfTt9O2V4cG9ydHMubWVtbyA9IGZ1bmN0aW9uIChhLCBiKSB7cmV0dXJuIHsgJCR0eXBlb2Y6IHgsIHR5cGU6IGEsIGNvbXBhcmU6IHZvaWQgMCA9PT0gYiA/IG51bGwgOiBiIH07fTtleHBvcnRzLnN0YXJ0VHJhbnNpdGlvbiA9IGZ1bmN0aW9uIChhKSB7dmFyIGIgPSBWLnRyYW5zaXRpb247Vi50cmFuc2l0aW9uID0ge307dHJ5IHthKCk7fSBmaW5hbGx5IHtWLnRyYW5zaXRpb24gPSBiO319O2V4cG9ydHMudW5zdGFibGVfYWN0ID0gZnVuY3Rpb24gKCkge3Rocm93IEVycm9yKCJhY3QoLi4uKSBpcyBub3Qgc3VwcG9ydGVkIGluIHByb2R1Y3Rpb24gYnVpbGRzIG9mIFJlYWN0LiIpO307CiAgICAgICAgICBleHBvcnRzLnVzZUNhbGxiYWNrID0gZnVuY3Rpb24gKGEsIGIpIHtyZXR1cm4gVS5jdXJyZW50LnVzZUNhbGxiYWNrKGEsIGIpO307ZXhwb3J0cy51c2VDb250ZXh0ID0gZnVuY3Rpb24gKGEpIHtyZXR1cm4gVS5jdXJyZW50LnVzZUNvbnRleHQoYSk7fTtleHBvcnRzLnVzZURlYnVnVmFsdWUgPSBmdW5jdGlvbiAoKSB7fTtleHBvcnRzLnVzZURlZmVycmVkVmFsdWUgPSBmdW5jdGlvbiAoYSkge3JldHVybiBVLmN1cnJlbnQudXNlRGVmZXJyZWRWYWx1ZShhKTt9O2V4cG9ydHMudXNlRWZmZWN0ID0gZnVuY3Rpb24gKGEsIGIpIHtyZXR1cm4gVS5jdXJyZW50LnVzZUVmZmVjdChhLCBiKTt9O2V4cG9ydHMudXNlSWQgPSBmdW5jdGlvbiAoKSB7cmV0dXJuIFUuY3VycmVudC51c2VJZCgpO307ZXhwb3J0cy51c2VJbXBlcmF0aXZlSGFuZGxlID0gZnVuY3Rpb24gKGEsIGIsIGUpIHtyZXR1cm4gVS5jdXJyZW50LnVzZUltcGVyYXRpdmVIYW5kbGUoYSwgYiwgZSk7fTsKICAgICAgICAgIGV4cG9ydHMudXNlSW5zZXJ0aW9uRWZmZWN0ID0gZnVuY3Rpb24gKGEsIGIpIHtyZXR1cm4gVS5jdXJyZW50LnVzZUluc2VydGlvbkVmZmVjdChhLCBiKTt9O2V4cG9ydHMudXNlTGF5b3V0RWZmZWN0ID0gZnVuY3Rpb24gKGEsIGIpIHtyZXR1cm4gVS5jdXJyZW50LnVzZUxheW91dEVmZmVjdChhLCBiKTt9O2V4cG9ydHMudXNlTWVtbyA9IGZ1bmN0aW9uIChhLCBiKSB7cmV0dXJuIFUuY3VycmVudC51c2VNZW1vKGEsIGIpO307ZXhwb3J0cy51c2VSZWR1Y2VyID0gZnVuY3Rpb24gKGEsIGIsIGUpIHtyZXR1cm4gVS5jdXJyZW50LnVzZVJlZHVjZXIoYSwgYiwgZSk7fTtleHBvcnRzLnVzZVJlZiA9IGZ1bmN0aW9uIChhKSB7cmV0dXJuIFUuY3VycmVudC51c2VSZWYoYSk7fTtleHBvcnRzLnVzZVN0YXRlID0gZnVuY3Rpb24gKGEpIHtyZXR1cm4gVS5jdXJyZW50LnVzZVN0YXRlKGEpO307ZXhwb3J0cy51c2VTeW5jRXh0ZXJuYWxTdG9yZSA9IGZ1bmN0aW9uIChhLCBiLCBlKSB7cmV0dXJuIFUuY3VycmVudC51c2VTeW5jRXh0ZXJuYWxTdG9yZShhLCBiLCBlKTt9OwogICAgICAgICAgZXhwb3J0cy51c2VUcmFuc2l0aW9uID0gZnVuY3Rpb24gKCkge3JldHVybiBVLmN1cnJlbnQudXNlVHJhbnNpdGlvbigpO307ZXhwb3J0cy52ZXJzaW9uID0gIjE4LjIuMCI7CgoKICAgICAgICAgIC8qKiovfSwKCiAgICAgICAgLyoqKi8yOTQ6CiAgICAgICAgLyoqKi8obW9kdWxlLCBfX3VudXNlZF93ZWJwYWNrX2V4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pID0+IHsKCgoKICAgICAgICAgIGlmICh0cnVlKSB7CiAgICAgICAgICAgIG1vZHVsZS5leHBvcnRzID0gX193ZWJwYWNrX3JlcXVpcmVfXyg0MDgpOwogICAgICAgICAgfSBlbHNlIHt9CgoKICAgICAgICAgIC8qKiovfSwKCiAgICAgICAgLyoqKi81MzoKICAgICAgICAvKioqLyhfX3VudXNlZF93ZWJwYWNrX21vZHVsZSwgZXhwb3J0cykgPT4gewoKICAgICAgICAgIC8qKgogICAgICAgICAgICogQGxpY2Vuc2UgUmVhY3QKICAgICAgICAgICAqIHNjaGVkdWxlci5wcm9kdWN0aW9uLm1pbi5qcwogICAgICAgICAgICoKICAgICAgICAgICAqIENvcHlyaWdodCAoYykgRmFjZWJvb2ssIEluYy4gYW5kIGl0cyBhZmZpbGlhdGVzLgogICAgICAgICAgICoKICAgICAgICAgICAqIFRoaXMgc291cmNlIGNvZGUgaXMgbGljZW5zZWQgdW5kZXIgdGhlIE1JVCBsaWNlbnNlIGZvdW5kIGluIHRoZQogICAgICAgICAgICogTElDRU5TRSBmaWxlIGluIHRoZSByb290IGRpcmVjdG9yeSBvZiB0aGlzIHNvdXJjZSB0cmVlLgogICAgICAgICAgICovCiAgICAgICAgICBmdW5jdGlvbiBmKGEsIGIpIHt2YXIgYyA9IGEubGVuZ3RoO2EucHVzaChiKTthOiBmb3IgKDsgMCA8IGM7KSB7dmFyIGQgPSBjIC0gMSA+Pj4gMSxlID0gYVtkXTtpZiAoMCA8IGcoZSwgYikpIGFbZF0gPSBiLCBhW2NdID0gZSwgYyA9IGQ7ZWxzZSBicmVhayBhO319ZnVuY3Rpb24gaChhKSB7cmV0dXJuIDAgPT09IGEubGVuZ3RoID8gbnVsbCA6IGFbMF07fWZ1bmN0aW9uIGsoYSkge2lmICgwID09PSBhLmxlbmd0aCkgcmV0dXJuIG51bGw7dmFyIGIgPSBhWzBdLGMgPSBhLnBvcCgpO2lmIChjICE9PSBiKSB7YVswXSA9IGM7YTogZm9yICh2YXIgZCA9IDAsIGUgPSBhLmxlbmd0aCwgdyA9IGUgPj4+IDE7IGQgPCB3Oykge3ZhciBtID0gMiAqIChkICsgMSkgLSAxLEMgPSBhW21dLG4gPSBtICsgMSx4ID0gYVtuXTtpZiAoMCA+IGcoQywgYykpIG4gPCBlICYmIDAgPiBnKHgsIEMpID8gKGFbZF0gPSB4LCBhW25dID0gYywgZCA9IG4pIDogKGFbZF0gPSBDLCBhW21dID0gYywgZCA9IG0pO2Vsc2UgaWYgKG4gPCBlICYmIDAgPiBnKHgsIGMpKSBhW2RdID0geCwgYVtuXSA9IGMsIGQgPSBuO2Vsc2UgYnJlYWsgYTt9fXJldHVybiBiO30KICAgICAgICAgIGZ1bmN0aW9uIGcoYSwgYikge3ZhciBjID0gYS5zb3J0SW5kZXggLSBiLnNvcnRJbmRleDtyZXR1cm4gMCAhPT0gYyA/IGMgOiBhLmlkIC0gYi5pZDt9aWYgKCJvYmplY3QiID09PSB0eXBlb2YgcGVyZm9ybWFuY2UgJiYgImZ1bmN0aW9uIiA9PT0gdHlwZW9mIHBlcmZvcm1hbmNlLm5vdykge3ZhciBsID0gcGVyZm9ybWFuY2U7ZXhwb3J0cy51bnN0YWJsZV9ub3cgPSBmdW5jdGlvbiAoKSB7cmV0dXJuIGwubm93KCk7fTt9IGVsc2Uge3ZhciBwID0gRGF0ZSxxID0gcC5ub3coKTtleHBvcnRzLnVuc3RhYmxlX25vdyA9IGZ1bmN0aW9uICgpIHtyZXR1cm4gcC5ub3coKSAtIHE7fTt9dmFyIHIgPSBbXSx0ID0gW10sdSA9IDEsdiA9IG51bGwseSA9IDMseiA9ICExLEEgPSAhMSxCID0gITEsRCA9ICJmdW5jdGlvbiIgPT09IHR5cGVvZiBzZXRUaW1lb3V0ID8gc2V0VGltZW91dCA6IG51bGwsRSA9ICJmdW5jdGlvbiIgPT09IHR5cGVvZiBjbGVhclRpbWVvdXQgPyBjbGVhclRpbWVvdXQgOiBudWxsLEYgPSAidW5kZWZpbmVkIiAhPT0gdHlwZW9mIHNldEltbWVkaWF0ZSA/IHNldEltbWVkaWF0ZSA6IG51bGw7CiAgICAgICAgICAidW5kZWZpbmVkIiAhPT0gdHlwZW9mIG5hdmlnYXRvciAmJiB2b2lkIDAgIT09IG5hdmlnYXRvci5zY2hlZHVsaW5nICYmIHZvaWQgMCAhPT0gbmF2aWdhdG9yLnNjaGVkdWxpbmcuaXNJbnB1dFBlbmRpbmcgJiYgbmF2aWdhdG9yLnNjaGVkdWxpbmcuaXNJbnB1dFBlbmRpbmcuYmluZChuYXZpZ2F0b3Iuc2NoZWR1bGluZyk7ZnVuY3Rpb24gRyhhKSB7Zm9yICh2YXIgYiA9IGgodCk7IG51bGwgIT09IGI7KSB7aWYgKG51bGwgPT09IGIuY2FsbGJhY2spIGsodCk7ZWxzZSBpZiAoYi5zdGFydFRpbWUgPD0gYSkgayh0KSwgYi5zb3J0SW5kZXggPSBiLmV4cGlyYXRpb25UaW1lLCBmKHIsIGIpO2Vsc2UgYnJlYWs7YiA9IGgodCk7fX1mdW5jdGlvbiBIKGEpIHtCID0gITE7RyhhKTtpZiAoIUEpIGlmIChudWxsICE9PSBoKHIpKSBBID0gITAsIEkoSik7ZWxzZSB7dmFyIGIgPSBoKHQpO251bGwgIT09IGIgJiYgSyhILCBiLnN0YXJ0VGltZSAtIGEpO319CiAgICAgICAgICBmdW5jdGlvbiBKKGEsIGIpIHtBID0gITE7QiAmJiAoQiA9ICExLCBFKEwpLCBMID0gLTEpO3ogPSAhMDt2YXIgYyA9IHk7dHJ5IHtHKGIpO2ZvciAodiA9IGgocik7IG51bGwgIT09IHYgJiYgKCEodi5leHBpcmF0aW9uVGltZSA+IGIpIHx8IGEgJiYgIU0oKSk7KSB7dmFyIGQgPSB2LmNhbGxiYWNrO2lmICgiZnVuY3Rpb24iID09PSB0eXBlb2YgZCkge3YuY2FsbGJhY2sgPSBudWxsO3kgPSB2LnByaW9yaXR5TGV2ZWw7dmFyIGUgPSBkKHYuZXhwaXJhdGlvblRpbWUgPD0gYik7YiA9IGV4cG9ydHMudW5zdGFibGVfbm93KCk7ImZ1bmN0aW9uIiA9PT0gdHlwZW9mIGUgPyB2LmNhbGxiYWNrID0gZSA6IHYgPT09IGgocikgJiYgayhyKTtHKGIpO30gZWxzZSBrKHIpO3YgPSBoKHIpO31pZiAobnVsbCAhPT0gdikgdmFyIHcgPSAhMDtlbHNlIHt2YXIgbSA9IGgodCk7bnVsbCAhPT0gbSAmJiBLKEgsIG0uc3RhcnRUaW1lIC0gYik7dyA9ICExO31yZXR1cm4gdzt9IGZpbmFsbHkge3YgPSBudWxsLCB5ID0gYywgeiA9ICExO319dmFyIE4gPSAhMSxPID0gbnVsbCxMID0gLTEsUCA9IDUsUSA9IC0xOwogICAgICAgICAgZnVuY3Rpb24gTSgpIHtyZXR1cm4gZXhwb3J0cy51bnN0YWJsZV9ub3coKSAtIFEgPCBQID8gITEgOiAhMDt9ZnVuY3Rpb24gUigpIHtpZiAobnVsbCAhPT0gTykge3ZhciBhID0gZXhwb3J0cy51bnN0YWJsZV9ub3coKTtRID0gYTt2YXIgYiA9ICEwO3RyeSB7YiA9IE8oITAsIGEpO30gZmluYWxseSB7YiA/IFMoKSA6IChOID0gITEsIE8gPSBudWxsKTt9fSBlbHNlIE4gPSAhMTt9dmFyIFM7aWYgKCJmdW5jdGlvbiIgPT09IHR5cGVvZiBGKSBTID0gZnVuY3Rpb24gUygpIHtGKFIpO307ZWxzZSBpZiAoInVuZGVmaW5lZCIgIT09IHR5cGVvZiBNZXNzYWdlQ2hhbm5lbCkge3ZhciBUID0gbmV3IE1lc3NhZ2VDaGFubmVsKCksVSA9IFQucG9ydDI7VC5wb3J0MS5vbm1lc3NhZ2UgPSBSO1MgPSBmdW5jdGlvbiBTKCkge1UucG9zdE1lc3NhZ2UobnVsbCk7fTt9IGVsc2UgUyA9IGZ1bmN0aW9uIFMoKSB7RChSLCAwKTt9O2Z1bmN0aW9uIEkoYSkge08gPSBhO04gfHwgKE4gPSAhMCwgUygpKTt9ZnVuY3Rpb24gSyhhLCBiKSB7TCA9IEQoZnVuY3Rpb24gKCkge2EoZXhwb3J0cy51bnN0YWJsZV9ub3coKSk7fSwgYik7fQogICAgICAgICAgZXhwb3J0cy51bnN0YWJsZV9JZGxlUHJpb3JpdHkgPSA1O2V4cG9ydHMudW5zdGFibGVfSW1tZWRpYXRlUHJpb3JpdHkgPSAxO2V4cG9ydHMudW5zdGFibGVfTG93UHJpb3JpdHkgPSA0O2V4cG9ydHMudW5zdGFibGVfTm9ybWFsUHJpb3JpdHkgPSAzO2V4cG9ydHMudW5zdGFibGVfUHJvZmlsaW5nID0gbnVsbDtleHBvcnRzLnVuc3RhYmxlX1VzZXJCbG9ja2luZ1ByaW9yaXR5ID0gMjtleHBvcnRzLnVuc3RhYmxlX2NhbmNlbENhbGxiYWNrID0gZnVuY3Rpb24gKGEpIHthLmNhbGxiYWNrID0gbnVsbDt9O2V4cG9ydHMudW5zdGFibGVfY29udGludWVFeGVjdXRpb24gPSBmdW5jdGlvbiAoKSB7QSB8fCB6IHx8IChBID0gITAsIEkoSikpO307CiAgICAgICAgICBleHBvcnRzLnVuc3RhYmxlX2ZvcmNlRnJhbWVSYXRlID0gZnVuY3Rpb24gKGEpIHswID4gYSB8fCAxMjUgPCBhID8gY29uc29sZS5lcnJvcigiZm9yY2VGcmFtZVJhdGUgdGFrZXMgYSBwb3NpdGl2ZSBpbnQgYmV0d2VlbiAwIGFuZCAxMjUsIGZvcmNpbmcgZnJhbWUgcmF0ZXMgaGlnaGVyIHRoYW4gMTI1IGZwcyBpcyBub3Qgc3VwcG9ydGVkIikgOiBQID0gMCA8IGEgPyBNYXRoLmZsb29yKDFFMyAvIGEpIDogNTt9O2V4cG9ydHMudW5zdGFibGVfZ2V0Q3VycmVudFByaW9yaXR5TGV2ZWwgPSBmdW5jdGlvbiAoKSB7cmV0dXJuIHk7fTtleHBvcnRzLnVuc3RhYmxlX2dldEZpcnN0Q2FsbGJhY2tOb2RlID0gZnVuY3Rpb24gKCkge3JldHVybiBoKHIpO307ZXhwb3J0cy51bnN0YWJsZV9uZXh0ID0gZnVuY3Rpb24gKGEpIHtzd2l0Y2ggKHkpIHtjYXNlIDE6Y2FzZSAyOmNhc2UgMzp2YXIgYiA9IDM7YnJlYWs7ZGVmYXVsdDpiID0geTt9dmFyIGMgPSB5O3kgPSBiO3RyeSB7cmV0dXJuIGEoKTt9IGZpbmFsbHkge3kgPSBjO319O2V4cG9ydHMudW5zdGFibGVfcGF1c2VFeGVjdXRpb24gPSBmdW5jdGlvbiAoKSB7fTsKICAgICAgICAgIGV4cG9ydHMudW5zdGFibGVfcmVxdWVzdFBhaW50ID0gZnVuY3Rpb24gKCkge307ZXhwb3J0cy51bnN0YWJsZV9ydW5XaXRoUHJpb3JpdHkgPSBmdW5jdGlvbiAoYSwgYikge3N3aXRjaCAoYSkge2Nhc2UgMTpjYXNlIDI6Y2FzZSAzOmNhc2UgNDpjYXNlIDU6YnJlYWs7ZGVmYXVsdDphID0gMzt9dmFyIGMgPSB5O3kgPSBhO3RyeSB7cmV0dXJuIGIoKTt9IGZpbmFsbHkge3kgPSBjO319OwogICAgICAgICAgZXhwb3J0cy51bnN0YWJsZV9zY2hlZHVsZUNhbGxiYWNrID0gZnVuY3Rpb24gKGEsIGIsIGMpIHt2YXIgZCA9IGV4cG9ydHMudW5zdGFibGVfbm93KCk7Im9iamVjdCIgPT09IHR5cGVvZiBjICYmIG51bGwgIT09IGMgPyAoYyA9IGMuZGVsYXksIGMgPSAibnVtYmVyIiA9PT0gdHlwZW9mIGMgJiYgMCA8IGMgPyBkICsgYyA6IGQpIDogYyA9IGQ7c3dpdGNoIChhKSB7Y2FzZSAxOnZhciBlID0gLTE7YnJlYWs7Y2FzZSAyOmUgPSAyNTA7YnJlYWs7Y2FzZSA1OmUgPSAxMDczNzQxODIzO2JyZWFrO2Nhc2UgNDplID0gMUU0O2JyZWFrO2RlZmF1bHQ6ZSA9IDVFMzt9ZSA9IGMgKyBlO2EgPSB7IGlkOiB1KyssIGNhbGxiYWNrOiBiLCBwcmlvcml0eUxldmVsOiBhLCBzdGFydFRpbWU6IGMsIGV4cGlyYXRpb25UaW1lOiBlLCBzb3J0SW5kZXg6IC0xIH07YyA+IGQgPyAoYS5zb3J0SW5kZXggPSBjLCBmKHQsIGEpLCBudWxsID09PSBoKHIpICYmIGEgPT09IGgodCkgJiYgKEIgPyAoRShMKSwgTCA9IC0xKSA6IEIgPSAhMCwgSyhILCBjIC0gZCkpKSA6IChhLnNvcnRJbmRleCA9IGUsIGYociwgYSksIEEgfHwgeiB8fCAoQSA9ICEwLCBJKEopKSk7cmV0dXJuIGE7fTsKICAgICAgICAgIGV4cG9ydHMudW5zdGFibGVfc2hvdWxkWWllbGQgPSBNO2V4cG9ydHMudW5zdGFibGVfd3JhcENhbGxiYWNrID0gZnVuY3Rpb24gKGEpIHt2YXIgYiA9IHk7cmV0dXJuIGZ1bmN0aW9uICgpIHt2YXIgYyA9IHk7eSA9IGI7dHJ5IHtyZXR1cm4gYS5hcHBseSh0aGlzLCBhcmd1bWVudHMpO30gZmluYWxseSB7eSA9IGM7fX07fTsKCgogICAgICAgICAgLyoqKi99LAoKICAgICAgICAvKioqLzg0MDoKICAgICAgICAvKioqLyhtb2R1bGUsIF9fdW51c2VkX3dlYnBhY2tfZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgPT4gewoKCgogICAgICAgICAgaWYgKHRydWUpIHsKICAgICAgICAgICAgbW9kdWxlLmV4cG9ydHMgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDUzKTsKICAgICAgICAgIH0gZWxzZSB7fQoKCiAgICAgICAgICAvKioqL30KCiAgICAgICAgLyoqKioqKi8gfTsKICAgICAgLyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi8KICAgICAgLyoqKioqKi8gLy8gVGhlIG1vZHVsZSBjYWNoZQogICAgICAvKioqKioqL3ZhciBfX3dlYnBhY2tfbW9kdWxlX2NhY2hlX18gPSB7fTsKICAgICAgLyoqKioqKi8KICAgICAgLyoqKioqKi8gLy8gVGhlIHJlcXVpcmUgZnVuY3Rpb24KICAgICAgLyoqKioqKi9mdW5jdGlvbiBfX3dlYnBhY2tfcmVxdWlyZV9fKG1vZHVsZUlkKSB7CiAgICAgICAgLyoqKioqKi8gLy8gQ2hlY2sgaWYgbW9kdWxlIGlzIGluIGNhY2hlCiAgICAgICAgLyoqKioqKi92YXIgY2FjaGVkTW9kdWxlID0gX193ZWJwYWNrX21vZHVsZV9jYWNoZV9fW21vZHVsZUlkXTsKICAgICAgICAvKioqKioqL2lmIChjYWNoZWRNb2R1bGUgIT09IHVuZGVmaW5lZCkgewogICAgICAgICAgLyoqKioqKi9yZXR1cm4gY2FjaGVkTW9kdWxlLmV4cG9ydHM7CiAgICAgICAgICAvKioqKioqL30KICAgICAgICAvKioqKioqLyAvLyBDcmVhdGUgYSBuZXcgbW9kdWxlIChhbmQgcHV0IGl0IGludG8gdGhlIGNhY2hlKQogICAgICAgIC8qKioqKiovdmFyIG1vZHVsZSA9IF9fd2VicGFja19tb2R1bGVfY2FjaGVfX1ttb2R1bGVJZF0gPSB7CiAgICAgICAgICAvKioqKioqLyAvLyBubyBtb2R1bGUuaWQgbmVlZGVkCiAgICAgICAgICAvKioqKioqLyAvLyBubyBtb2R1bGUubG9hZGVkIG5lZWRlZAogICAgICAgICAgLyoqKioqKi9leHBvcnRzOiB7fQogICAgICAgICAgLyoqKioqKi8gfTsKICAgICAgICAvKioqKioqLwogICAgICAgIC8qKioqKiovIC8vIEV4ZWN1dGUgdGhlIG1vZHVsZSBmdW5jdGlvbgogICAgICAgIC8qKioqKiovX193ZWJwYWNrX21vZHVsZXNfX1ttb2R1bGVJZF0obW9kdWxlLCBtb2R1bGUuZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXyk7CiAgICAgICAgLyoqKioqKi8KICAgICAgICAvKioqKioqLyAvLyBSZXR1cm4gdGhlIGV4cG9ydHMgb2YgdGhlIG1vZHVsZQogICAgICAgIC8qKioqKiovcmV0dXJuIG1vZHVsZS5leHBvcnRzOwogICAgICAgIC8qKioqKiovfQogICAgICAvKioqKioqLwogICAgICAvKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqLwogICAgICAvKioqKioqLyAvKiB3ZWJwYWNrL3J1bnRpbWUvY3JlYXRlIGZha2UgbmFtZXNwYWNlIG9iamVjdCAqLwogICAgICAvKioqKioqLygoKSA9PiB7CiAgICAgICAgLyoqKioqKi92YXIgZ2V0UHJvdG8gPSBPYmplY3QuZ2V0UHJvdG90eXBlT2YgPyAob2JqKSA9PiBPYmplY3QuZ2V0UHJvdG90eXBlT2Yob2JqKSA6IChvYmopID0+IG9iai5fX3Byb3RvX187CiAgICAgICAgLyoqKioqKi92YXIgbGVhZlByb3RvdHlwZXM7CiAgICAgICAgLyoqKioqKi8gLy8gY3JlYXRlIGEgZmFrZSBuYW1lc3BhY2Ugb2JqZWN0CiAgICAgICAgLyoqKioqKi8gLy8gbW9kZSAmIDE6IHZhbHVlIGlzIGEgbW9kdWxlIGlkLCByZXF1aXJlIGl0CiAgICAgICAgLyoqKioqKi8gLy8gbW9kZSAmIDI6IG1lcmdlIGFsbCBwcm9wZXJ0aWVzIG9mIHZhbHVlIGludG8gdGhlIG5zCiAgICAgICAgLyoqKioqKi8gLy8gbW9kZSAmIDQ6IHJldHVybiB2YWx1ZSB3aGVuIGFscmVhZHkgbnMgb2JqZWN0CiAgICAgICAgLyoqKioqKi8gLy8gbW9kZSAmIDE2OiByZXR1cm4gdmFsdWUgd2hlbiBpdCdzIFByb21pc2UtbGlrZQogICAgICAgIC8qKioqKiovIC8vIG1vZGUgJiA4fDE6IGJlaGF2ZSBsaWtlIHJlcXVpcmUKICAgICAgICAvKioqKioqL19fd2VicGFja19yZXF1aXJlX18udCA9IGZ1bmN0aW9uICh2YWx1ZSwgbW9kZSkgewogICAgICAgICAgLyoqKioqKi9pZiAobW9kZSAmIDEpIHZhbHVlID0gdGhpcyh2YWx1ZSk7CiAgICAgICAgICAvKioqKioqL2lmIChtb2RlICYgOCkgcmV0dXJuIHZhbHVlOwogICAgICAgICAgLyoqKioqKi9pZiAodHlwZW9mIHZhbHVlID09PSAnb2JqZWN0JyAmJiB2YWx1ZSkgewogICAgICAgICAgICAvKioqKioqL2lmIChtb2RlICYgNCAmJiB2YWx1ZS5fX2VzTW9kdWxlKSByZXR1cm4gdmFsdWU7CiAgICAgICAgICAgIC8qKioqKiovaWYgKG1vZGUgJiAxNiAmJiB0eXBlb2YgdmFsdWUudGhlbiA9PT0gJ2Z1bmN0aW9uJykgcmV0dXJuIHZhbHVlOwogICAgICAgICAgICAvKioqKioqL30KICAgICAgICAgIC8qKioqKiovdmFyIG5zID0gT2JqZWN0LmNyZWF0ZShudWxsKTsKICAgICAgICAgIC8qKioqKiovX193ZWJwYWNrX3JlcXVpcmVfXy5yKG5zKTsKICAgICAgICAgIC8qKioqKiovdmFyIGRlZiA9IHt9OwogICAgICAgICAgLyoqKioqKi9sZWFmUHJvdG90eXBlcyA9IGxlYWZQcm90b3R5cGVzIHx8IFtudWxsLCBnZXRQcm90byh7fSksIGdldFByb3RvKFtdKSwgZ2V0UHJvdG8oZ2V0UHJvdG8pXTsKICAgICAgICAgIC8qKioqKiovZm9yICh2YXIgY3VycmVudCA9IG1vZGUgJiAyICYmIHZhbHVlOyB0eXBlb2YgY3VycmVudCA9PSAnb2JqZWN0JyAmJiAhfmxlYWZQcm90b3R5cGVzLmluZGV4T2YoY3VycmVudCk7IGN1cnJlbnQgPSBnZXRQcm90byhjdXJyZW50KSkgewogICAgICAgICAgICAvKioqKioqL09iamVjdC5nZXRPd25Qcm9wZXJ0eU5hbWVzKGN1cnJlbnQpLmZvckVhY2goKGtleSkgPT4gZGVmW2tleV0gPSAoKSA9PiB2YWx1ZVtrZXldKTsKICAgICAgICAgICAgLyoqKioqKi99CiAgICAgICAgICAvKioqKioqL2RlZlsnZGVmYXVsdCddID0gKCkgPT4gdmFsdWU7CiAgICAgICAgICAvKioqKioqL19fd2VicGFja19yZXF1aXJlX18uZChucywgZGVmKTsKICAgICAgICAgIC8qKioqKiovcmV0dXJuIG5zOwogICAgICAgICAgLyoqKioqKi99OwogICAgICAgIC8qKioqKiovfSkoKTsKICAgICAgLyoqKioqKi8KICAgICAgLyoqKioqKi8gLyogd2VicGFjay9ydW50aW1lL2RlZmluZSBwcm9wZXJ0eSBnZXR0ZXJzICovCiAgICAgIC8qKioqKiovKCgpID0+IHsKICAgICAgICAvKioqKioqLyAvLyBkZWZpbmUgZ2V0dGVyIGZ1bmN0aW9ucyBmb3IgaGFybW9ueSBleHBvcnRzCiAgICAgICAgLyoqKioqKi9fX3dlYnBhY2tfcmVxdWlyZV9fLmQgPSAoZXhwb3J0cywgZGVmaW5pdGlvbikgPT4gewogICAgICAgICAgLyoqKioqKi9mb3IgKHZhciBrZXkgaW4gZGVmaW5pdGlvbikgewogICAgICAgICAgICAvKioqKioqL2lmIChfX3dlYnBhY2tfcmVxdWlyZV9fLm8oZGVmaW5pdGlvbiwga2V5KSAmJiAhX193ZWJwYWNrX3JlcXVpcmVfXy5vKGV4cG9ydHMsIGtleSkpIHsKICAgICAgICAgICAgICAvKioqKioqL09iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBrZXksIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBkZWZpbml0aW9uW2tleV0gfSk7CiAgICAgICAgICAgICAgLyoqKioqKi99CiAgICAgICAgICAgIC8qKioqKiovfQogICAgICAgICAgLyoqKioqKi99OwogICAgICAgIC8qKioqKiovfSkoKTsKICAgICAgLyoqKioqKi8KICAgICAgLyoqKioqKi8gLyogd2VicGFjay9ydW50aW1lL2hhc093blByb3BlcnR5IHNob3J0aGFuZCAqLwogICAgICAvKioqKioqLygoKSA9PiB7CiAgICAgICAgLyoqKioqKi9fX3dlYnBhY2tfcmVxdWlyZV9fLm8gPSAob2JqLCBwcm9wKSA9PiBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwob2JqLCBwcm9wKTsKICAgICAgICAvKioqKioqL30pKCk7CiAgICAgIC8qKioqKiovCiAgICAgIC8qKioqKiovIC8qIHdlYnBhY2svcnVudGltZS9tYWtlIG5hbWVzcGFjZSBvYmplY3QgKi8KICAgICAgLyoqKioqKi8oKCkgPT4gewogICAgICAgIC8qKioqKiovIC8vIGRlZmluZSBfX2VzTW9kdWxlIG9uIGV4cG9ydHMKICAgICAgICAvKioqKioqL19fd2VicGFja19yZXF1aXJlX18uciA9IChleHBvcnRzKSA9PiB7CiAgICAgICAgICAvKioqKioqL2lmICh0eXBlb2YgU3ltYm9sICE9PSAndW5kZWZpbmVkJyAmJiBTeW1ib2wudG9TdHJpbmdUYWcpIHsKICAgICAgICAgICAgLyoqKioqKi9PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgU3ltYm9sLnRvU3RyaW5nVGFnLCB7IHZhbHVlOiAnTW9kdWxlJyB9KTsKICAgICAgICAgICAgLyoqKioqKi99CiAgICAgICAgICAvKioqKioqL09iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAnX19lc01vZHVsZScsIHsgdmFsdWU6IHRydWUgfSk7CiAgICAgICAgICAvKioqKioqL307CiAgICAgICAgLyoqKioqKi99KSgpOwogICAgICAvKioqKioqLwogICAgICAvKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqLwogICAgICB2YXIgX193ZWJwYWNrX2V4cG9ydHNfXyA9IHt9OwogICAgICAvLyBUaGlzIGVudHJ5IG5lZWQgdG8gYmUgd3JhcHBlZCBpbiBhbiBJSUZFIGJlY2F1c2UgaXQgbmVlZCB0byBiZSBpc29sYXRlZCBhZ2FpbnN0IG90aGVyIG1vZHVsZXMgaW4gdGhlIGNodW5rLgogICAgICAoKCkgPT4gewogICAgICAgIF9fd2VicGFja19yZXF1aXJlX18ucihfX3dlYnBhY2tfZXhwb3J0c19fKTsKICAgICAgICAvKiBoYXJtb255IGltcG9ydCAqL3ZhciBfQXBwX19XRUJQQUNLX0lNUE9SVEVEX01PRFVMRV8wX18gPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDg4Nyk7CiAgICAgICAgLyogaGFybW9ueSBpbXBvcnQgKi92YXIgcmVhY3RfZG9tX2NsaWVudF9fV0VCUEFDS19JTVBPUlRFRF9NT0RVTEVfMV9fID0gX193ZWJwYWNrX3JlcXVpcmVfXyg3NDUpOwogICAgICAgIC8qIGhhcm1vbnkgaW1wb3J0ICovdmFyIHJlYWN0X19XRUJQQUNLX0lNUE9SVEVEX01PRFVMRV8yX18gPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDI5NCk7CiAgICAgICAgZnVuY3Rpb24gX2NyZWF0ZUZvck9mSXRlcmF0b3JIZWxwZXIobywgYWxsb3dBcnJheUxpa2UpIHt2YXIgaXQgPSB0eXBlb2YgU3ltYm9sICE9PSAidW5kZWZpbmVkIiAmJiBvW1N5bWJvbC5pdGVyYXRvcl0gfHwgb1siQEBpdGVyYXRvciJdO2lmICghaXQpIHtpZiAoQXJyYXkuaXNBcnJheShvKSB8fCAoaXQgPSBfdW5zdXBwb3J0ZWRJdGVyYWJsZVRvQXJyYXkobykpIHx8IGFsbG93QXJyYXlMaWtlICYmIG8gJiYgdHlwZW9mIG8ubGVuZ3RoID09PSAibnVtYmVyIikge2lmIChpdCkgbyA9IGl0O3ZhciBpID0gMDt2YXIgRiA9IGZ1bmN0aW9uIEYoKSB7fTtyZXR1cm4geyBzOiBGLCBuOiBmdW5jdGlvbiBuKCkge2lmIChpID49IG8ubGVuZ3RoKSByZXR1cm4geyBkb25lOiB0cnVlIH07cmV0dXJuIHsgZG9uZTogZmFsc2UsIHZhbHVlOiBvW2krK10gfTt9LCBlOiBmdW5jdGlvbiBlKF9lKSB7dGhyb3cgX2U7fSwgZjogRiB9O310aHJvdyBuZXcgVHlwZUVycm9yKCJJbnZhbGlkIGF0dGVtcHQgdG8gaXRlcmF0ZSBub24taXRlcmFibGUgaW5zdGFuY2UuXG5JbiBvcmRlciB0byBiZSBpdGVyYWJsZSwgbm9uLWFycmF5IG9iamVjdHMgbXVzdCBoYXZlIGEgW1N5bWJvbC5pdGVyYXRvcl0oKSBtZXRob2QuIik7fXZhciBub3JtYWxDb21wbGV0aW9uID0gdHJ1ZSxkaWRFcnIgPSBmYWxzZSxlcnI7cmV0dXJuIHsgczogZnVuY3Rpb24gcygpIHtpdCA9IGl0LmNhbGwobyk7fSwgbjogZnVuY3Rpb24gbigpIHt2YXIgc3RlcCA9IGl0Lm5leHQoKTtub3JtYWxDb21wbGV0aW9uID0gc3RlcC5kb25lO3JldHVybiBzdGVwO30sIGU6IGZ1bmN0aW9uIGUoX2UyKSB7ZGlkRXJyID0gdHJ1ZTtlcnIgPSBfZTI7fSwgZjogZnVuY3Rpb24gZigpIHt0cnkge2lmICghbm9ybWFsQ29tcGxldGlvbiAmJiBpdFsicmV0dXJuIl0gIT0gbnVsbCkgaXRbInJldHVybiJdKCk7fSBmaW5hbGx5IHtpZiAoZGlkRXJyKSB0aHJvdyBlcnI7fX0gfTt9ZnVuY3Rpb24gX3Vuc3VwcG9ydGVkSXRlcmFibGVUb0FycmF5KG8sIG1pbkxlbikge2lmICghbykgcmV0dXJuO2lmICh0eXBlb2YgbyA9PT0gInN0cmluZyIpIHJldHVybiBfYXJyYXlMaWtlVG9BcnJheShvLCBtaW5MZW4pO3ZhciBuID0gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKG8pLnNsaWNlKDgsIC0xKTtpZiAobiA9PT0gIk9iamVjdCIgJiYgby5jb25zdHJ1Y3RvcikgbiA9IG8uY29uc3RydWN0b3IubmFtZTtpZiAobiA9PT0gIk1hcCIgfHwgbiA9PT0gIlNldCIpIHJldHVybiBBcnJheS5mcm9tKG8pO2lmIChuID09PSAiQXJndW1lbnRzIiB8fCAvXig/OlVpfEkpbnQoPzo4fDE2fDMyKSg/OkNsYW1wZWQpP0FycmF5JC8udGVzdChuKSkgcmV0dXJuIF9hcnJheUxpa2VUb0FycmF5KG8sIG1pbkxlbik7fWZ1bmN0aW9uIF9hcnJheUxpa2VUb0FycmF5KGFyciwgbGVuKSB7aWYgKGxlbiA9PSBudWxsIHx8IGxlbiA+IGFyci5sZW5ndGgpIGxlbiA9IGFyci5sZW5ndGg7Zm9yICh2YXIgaSA9IDAsIGFycjIgPSBuZXcgQXJyYXkobGVuKTsgaSA8IGxlbjsgaSsrKSBhcnIyW2ldID0gYXJyW2ldO3JldHVybiBhcnIyO30KCgoKCgogICAgICAgIGdldERhdGEoZnVuY3Rpb24gKHBhZ2VzKSB7dmFyIF9pdGVyYXRvciA9IF9jcmVhdGVGb3JPZkl0ZXJhdG9ySGVscGVyKAogICAgICAgICAgICBwYWdlcyksX3N0ZXA7dHJ5IHtmb3IgKF9pdGVyYXRvci5zKCk7ICEoX3N0ZXAgPSBfaXRlcmF0b3IubigpKS5kb25lOykge3ZhciBwYWdlID0gX3N0ZXAudmFsdWU7CiAgICAgICAgICAgICAgZm9yICh2YXIgX2kgPSAwLCBfYXJyID0gcGFnZS5jb21wb25lbnRzOyBfaSA8IF9hcnIubGVuZ3RoOyBfaSsrKSB7dmFyIGNvbXBvbmVudCA9IF9hcnJbX2ldOwogICAgICAgICAgICAgICAgY29tcG9uZW50LnByZXZpb3VzVmFsdWUgPSBjb21wb25lbnQudmFsdWU7CgogICAgICAgICAgICAgICAgaWYgKGNvbXBvbmVudC52YWxpZGF0ZSAhPSBudWxsKSB7CiAgICAgICAgICAgICAgICAgIGNvbXBvbmVudC52YWxpZGF0ZSA9IGV2YWwoY29tcG9uZW50LnZhbGlkYXRlKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH19IGNhdGNoIChlcnIpIHtfaXRlcmF0b3IuZShlcnIpO30gZmluYWxseSB7X2l0ZXJhdG9yLmYoKTt9CgogICAgICAgICAgdmFyIGNvbnRhaW5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJyb290Iik7CiAgICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25vLW5vbi1udWxsLWFzc2VydGlvbgogICAgICAgICAgdmFyIHJvb3QgPSAoMCwgcmVhY3RfZG9tX2NsaWVudF9fV0VCUEFDS19JTVBPUlRFRF9NT0RVTEVfMV9fIC8qIC5jcmVhdGVSb290ICovLnMpKGNvbnRhaW5lcik7CiAgICAgICAgICByb290LnJlbmRlciggLyojX19QVVJFX18qL3JlYWN0X19XRUJQQUNLX0lNUE9SVEVEX01PRFVMRV8yX18uY3JlYXRlRWxlbWVudChfQXBwX19XRUJQQUNLX0lNUE9SVEVEX01PRFVMRV8wX18gLyogWyJkZWZhdWx0Il0gKi8uWiwgeyBwYWdlczogcGFnZXMgfSkpOwogICAgICAgIH0pOwogICAgICB9KSgpOwoKICAgICAgLyoqKioqKi9yZXR1cm4gX193ZWJwYWNrX2V4cG9ydHNfXzsKICAgICAgLyoqKioqKi99KSgpKTsKCn0pOw==";

/***/ }),

/***/ 171:
/***/ ((module) => {

module.exports = "#relayContainer{margin:1rem;font-family:Arial,Helvetica,sans-serif}#notificationsContainer{pointer-events:none;position:fixed;top:5%;left:70%;transform:translateX(-50%);z-index:999}img{display:block;margin:auto}input.stringcontainer{background-color:#fff;border-radius:5px;border:1px solid #121943;height:24px;margin:auto;display:flex;padding-left:5px}input.interrupt{width:100%;border-color:darkred;background-color:#f1948a;color:darkred;margin:10px 0px;cursor:pointer}input.interrupt:hover{background-color:#f5867a}input.interrupt:active{background-color:#f77163}input.save,input.interrupt{margin:auto;display:block;font-size:x-large;padding:5px 25px;border-radius:10px}.notification{border:3px solid #00529b;background-color:#bde5f8;width:fit-content;margin-right:auto;margin-left:auto;border-radius:40px;color:#00529b;padding:7px 60px;animation:2s fadeOut 5s 1 forwards;cursor:default;pointer-events:auto}@keyframes fadeOut{0%{opacity:1}99%{height:100%}100%{opacity:0;height:0}}td{padding:.5rem}.toggle{align-items:center;border-radius:100px;display:flex;font-weight:700;margin-bottom:16px}.toggle:last-of-type{margin:0}.toggle__input{clip:rect(0 0 0 0);clip-path:inset(50%);height:1px;overflow:hidden;position:absolute;white-space:nowrap;width:1px}.toggle__input:not([disabled]):active+.toggle-track,.toggle__input:not([disabled]):focus+.toggle-track{border:1px solid rgba(0,0,0,0);box-shadow:0px 0px 0px 2px #121943}.toggle__input:disabled+.toggle-track{cursor:not-allowed;opacity:.7}.toggle-track{background:#fff;border:1px solid #5a72b5;border-radius:100px;cursor:pointer;display:flex;height:30px;margin-left:5%;position:relative;width:60px}.toggle-indicator{align-items:center;background:#121943;border-radius:24px;bottom:2px;display:flex;height:24px;justify-content:center;left:2px;outline:solid 2px rgba(0,0,0,0);position:absolute;transition:.4s;width:24px}.checkMark{fill:#fff;height:20px;width:20px;opacity:0;transition:opacity .4s ease-in-out}.dropdowncontainer{padding:8px 16px;border:1px solid rgba(0,0,0,0);border-color:#000}input[value=true]+.toggle-track .toggle-indicator{background:#121943;transform:translateX(30px)}input[value=true]+.toggle-track .toggle-indicator .checkMark{opacity:1;transition:opacity .4s ease-in-out}@media screen and (-ms-high-contrast: active){.toggle-track{border-radius:0;background-color:red}}.topBar{display:flex}.tabEntry{margin-right:10px;border-radius:10px;background-color:#333}.relayTable{padding-bottom:10px}.tabEntry a{display:block;color:#fff;text-align:center;padding:6px;text-decoration:none}.tabEntry a[aria-current=page]{background-color:#00529b;border-radius:10px}.tabEntry a:hover[aria-current=page]{background-color:#002c53;border-radius:10px}.tabEntry a:hover{background-color:#111;border-radius:10px}.setting{position:relative}.setting .settingNameHover{visibility:hidden;background-color:#cacaca;color:#000;text-align:center;border-radius:6px;border-color:#000;position:absolute;z-index:1}.setting:hover .settingNameHover{visibility:visible;padding:5px;margin-left:15px}.hoverBox{position:relative;white-space:nowrap}.settingInput .settingDefaultHover{visibility:hidden;color:#666;position:absolute;z-index:1;left:50%;transform:translateX(-50%)}.settingInput:hover .settingDefaultHover{visibility:visible}.invalid-setting input,.invalid-setting select,.invalid-setting .toggle-track{background:pink !important}.invalid-reason{text-align:center}.invalid-reason small{padding:0px 5px;border-radius:10px;color:red}.settingTag{display:flex;flex-wrap:wrap;overflow:hidden;color:#000;margin:5px}input{outline:none}.settingTagClose{cursor:pointer}.settingTagSingle{display:inline-flex;border:1.5px solid #764abc;padding:2px 0px 0px 5px;border-radius:5px;white-space:nowrap;color:#764abc;margin-right:5px;margin-bottom:5px;cursor:grab;position:relative}.dropdownMenu{position:absolute;transform:translateY(4px);border:1px solid #ccc;border-radius:5px;overflow-y:auto;overflow-x:clip;overflow-wrap:break-word;max-height:250px;background-color:#fff;z-index:99;user-select:none}.dropdownItem{padding:3px;cursor:pointer;padding-left:.2em}.dropdownMenu>div+div{border-top:1px solid #d6d6d6}.dropdownItem:hover{background-color:rgba(159,195,248,.4392156863)}.userPreference td:first-child{width:15%}.userPreference td:nth-child(2){width:20%}.hintTagDrop{width:40px;min-height:100%;height:20px;background-image:linear-gradient(rgb(162, 162, 162), transparent);border-radius:5px;padding:0px 0px 0px 5px;margin-right:5px;margin-bottom:2px}.hintTagDropOriginal{background-image:linear-gradient(rgb(176, 94, 168), transparent)}.tagContainer{display:flex;flex-wrap:wrap;overflow:hidden}.draggedItem{opacity:40%}.hidden{display:none}.rearrangedTag{animation:fadeIn 1s}@keyframes fadeIn{from{opacity:.2}to{opacity:1}}\n";

/***/ }),

/***/ 530:
/***/ ((module) => {

module.exports = require("kolmafia");

/***/ })

/******/ 	});
/************************************************************************/
/******/ 	// The module cache
/******/ 	var __webpack_module_cache__ = {};
/******/ 	
/******/ 	// The require function
/******/ 	function __webpack_require__(moduleId) {
/******/ 		// Check if module is in cache
/******/ 		var cachedModule = __webpack_module_cache__[moduleId];
/******/ 		if (cachedModule !== undefined) {
/******/ 			return cachedModule.exports;
/******/ 		}
/******/ 		// Create a new module (and put it into the cache)
/******/ 		var module = __webpack_module_cache__[moduleId] = {
/******/ 			// no module.id needed
/******/ 			// no module.loaded needed
/******/ 			exports: {}
/******/ 		};
/******/ 	
/******/ 		// Execute the module function
/******/ 		__webpack_modules__[moduleId](module, module.exports, __webpack_require__);
/******/ 	
/******/ 		// Return the exports of the module
/******/ 		return module.exports;
/******/ 	}
/******/ 	
/************************************************************************/
/******/ 	/* webpack/runtime/compat get default export */
/******/ 	(() => {
/******/ 		// getDefaultExport function for compatibility with non-harmony modules
/******/ 		__webpack_require__.n = (module) => {
/******/ 			var getter = module && module.__esModule ?
/******/ 				() => (module['default']) :
/******/ 				() => (module);
/******/ 			__webpack_require__.d(getter, { a: getter });
/******/ 			return getter;
/******/ 		};
/******/ 	})();
/******/ 	
/******/ 	/* webpack/runtime/define property getters */
/******/ 	(() => {
/******/ 		// define getter functions for harmony exports
/******/ 		__webpack_require__.d = (exports, definition) => {
/******/ 			for(var key in definition) {
/******/ 				if(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {
/******/ 					Object.defineProperty(exports, key, { enumerable: true, get: definition[key] });
/******/ 				}
/******/ 			}
/******/ 		};
/******/ 	})();
/******/ 	
/******/ 	/* webpack/runtime/hasOwnProperty shorthand */
/******/ 	(() => {
/******/ 		__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))
/******/ 	})();
/******/ 	
/******/ 	/* webpack/runtime/make namespace object */
/******/ 	(() => {
/******/ 		// define __esModule on exports
/******/ 		__webpack_require__.r = (exports) => {
/******/ 			if(typeof Symbol !== 'undefined' && Symbol.toStringTag) {
/******/ 				Object.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });
/******/ 			}
/******/ 			Object.defineProperty(exports, '__esModule', { value: true });
/******/ 		};
/******/ 	})();
/******/ 	
/************************************************************************/
var __webpack_exports__ = {};
// This entry need to be wrapped in an IIFE because it need to be isolated against other modules in the chunk.
(() => {
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "main": () => (/* binding */ main)
/* harmony export */ });
/* harmony import */ var kolmafia__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(530);
/* harmony import */ var kolmafia__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(kolmafia__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var _RelayUtils__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(616);
function _createForOfIteratorHelper(o, allowArrayLike) {var it = typeof Symbol !== "undefined" && o[Symbol.iterator] || o["@@iterator"];if (!it) {if (Array.isArray(o) || (it = _unsupportedIterableToArray(o)) || allowArrayLike && o && typeof o.length === "number") {if (it) o = it;var i = 0;var F = function F() {};return { s: F, n: function n() {if (i >= o.length) return { done: true };return { done: false, value: o[i++] };}, e: function e(_e) {throw _e;}, f: F };}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");}var normalCompletion = true,didErr = false,err;return { s: function s() {it = it.call(o);}, n: function n() {var step = it.next();normalCompletion = step.done;return step;}, e: function e(_e2) {didErr = true;err = _e2;}, f: function f() {try {if (!normalCompletion && it.return != null) it.return();} finally {if (didErr) throw err;}} };}function _unsupportedIterableToArray(o, minLen) {if (!o) return;if (typeof o === "string") return _arrayLikeToArray(o, minLen);var n = Object.prototype.toString.call(o).slice(8, -1);if (n === "Object" && o.constructor) n = o.constructor.name;if (n === "Map" || n === "Set") return Array.from(o);if (n === "Arguments" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen);}function _arrayLikeToArray(arr, len) {if (len == null || len > arr.length) len = arr.length;for (var i = 0, arr2 = new Array(len); i < len; i++) arr2[i] = arr[i];return arr2;}



function main() {for (var _len = arguments.length, pagesToLoad = new Array(_len), _key = 0; _key < _len; _key++) {pagesToLoad[_key] = arguments[_key];}
  if ((0,_RelayUtils__WEBPACK_IMPORTED_MODULE_1__/* .handleApiRequest */ .SU)()) {
    return;
  }

  if (pagesToLoad.length == 0) {
    // Find any 'page' or 'pages' parameters
    pagesToLoad = ((0,kolmafia__WEBPACK_IMPORTED_MODULE_0__.formFields)()["page"] || (0,kolmafia__WEBPACK_IMPORTED_MODULE_0__.formFields)()["pages"] || "").
    split(",").
    filter((s) => s.length > 0);
  }

  var pages = [];
  var extraHtml;

  if (pagesToLoad.length > 0) {
    var cssFile;var _iterator = _createForOfIteratorHelper(
      pagesToLoad),_step;try {for (_iterator.s(); !(_step = _iterator.n()).done;) {var pageName = _step.value;
        try {var _extraHtml$css;
          var page = null;

          // If the parameter is a string, then try to load from file
          if (typeof pageName == "string") {
            cssFile = (0,_RelayUtils__WEBPACK_IMPORTED_MODULE_1__/* .parseCssFromFile */ .$p)(pageName);
            page = (0,_RelayUtils__WEBPACK_IMPORTED_MODULE_1__/* .parsePageFromFile */ .jU)(pageName);
          } else {
            page = pageName;
          }

          if (page == null) {
            continue;
          }

          // Assume at this point it must be a RelayPage
          pages.push(page);

          if (cssFile == null) {
            continue;
          }

          if (extraHtml == null) {
            extraHtml = { cssFiles: [] };
          }

          extraHtml.css = ((_extraHtml$css = extraHtml.css) !== null && _extraHtml$css !== void 0 ? _extraHtml$css : "") + cssFile;
        } catch (e) {
          (0,kolmafia__WEBPACK_IMPORTED_MODULE_0__.write)(
          "<h2>An error occured while trying to load " + (
          typeof pageName == "string" ?
          (0,_RelayUtils__WEBPACK_IMPORTED_MODULE_1__/* .getPagePath */ .mn)(pageName) + ", is your json properly formatted?" :
          "a relay page") +
          "</h2>");


          if (e) {
            (0,kolmafia__WEBPACK_IMPORTED_MODULE_0__.write)("<br>");
            (0,kolmafia__WEBPACK_IMPORTED_MODULE_0__.write)(e);

            if (e.stack) {
              for (var _i = 0, _arr = e.stack.split("\n"); _i < _arr.length; _i++) {var s = _arr[_i];
                while (s.match(/\t|\r/)) {
                  s = s.replace(/\t|\r/, "");
                }

                (0,kolmafia__WEBPACK_IMPORTED_MODULE_0__.write)("<br>");
                (0,kolmafia__WEBPACK_IMPORTED_MODULE_0__.write)(s);
              }
            }
          }
          return;
        }
      }} catch (err) {_iterator.e(err);} finally {_iterator.f();}
  }

  if (pages.length == 0) {
    (0,kolmafia__WEBPACK_IMPORTED_MODULE_0__.write)(
    "<h3>The relay script could not find any pages to load, either invalid/missing pages were provided or nothing was.</h3>");

    return;
  }

  (0,kolmafia__WEBPACK_IMPORTED_MODULE_0__.write)((0,_RelayUtils__WEBPACK_IMPORTED_MODULE_1__/* .generateHTML */ .ar)(pages, extraHtml));
}
})();

var __webpack_export_target__ = exports;
for(var i in __webpack_exports__) __webpack_export_target__[i] = __webpack_exports__[i];
if(__webpack_exports__.__esModule) Object.defineProperty(__webpack_export_target__, "__esModule", { value: true });
/******/ })()
;