/******/ (() => { // webpackBootstrap
/******/ 	"use strict";
/******/ 	var __webpack_modules__ = ({

/***/ 616:
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "$p": () => (/* binding */ parseCssFromFile),
/* harmony export */   "ar": () => (/* binding */ generateHTML),
/* harmony export */   "jU": () => (/* binding */ parsePageFromFile),
/* harmony export */   "k7": () => (/* binding */ handledApiRequest),
/* harmony export */   "mn": () => (/* binding */ getPagePath)
/* harmony export */ });
/* unused harmony exports validateComponents, parsePageFromJson */
/* harmony import */ var kolmafia__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(530);
/* harmony import */ var kolmafia__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(kolmafia__WEBPACK_IMPORTED_MODULE_0__);
function _slicedToArray(arr, i) {return _arrayWithHoles(arr) || _iterableToArrayLimit(arr, i) || _unsupportedIterableToArray(arr, i) || _nonIterableRest();}function _nonIterableRest() {throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");}function _iterableToArrayLimit(arr, i) {var _i = null == arr ? null : "undefined" != typeof Symbol && arr[Symbol.iterator] || arr["@@iterator"];if (null != _i) {var _s,_e,_x,_r,_arr = [],_n = !0,_d = !1;try {if (_x = (_i = _i.call(arr)).next, 0 === i) {if (Object(_i) !== _i) return;_n = !1;} else for (; !(_n = (_s = _x.call(_i)).done) && (_arr.push(_s.value), _arr.length !== i); _n = !0) {;}} catch (err) {_d = !0, _e = err;} finally {try {if (!_n && null != _i.return && (_r = _i.return(), Object(_r) !== _r)) return;} finally {if (_d) throw _e;}}return _arr;}}function _arrayWithHoles(arr) {if (Array.isArray(arr)) return arr;}function _toConsumableArray(arr) {return _arrayWithoutHoles(arr) || _iterableToArray(arr) || _unsupportedIterableToArray(arr) || _nonIterableSpread();}function _nonIterableSpread() {throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");}function _iterableToArray(iter) {if (typeof Symbol !== "undefined" && iter[Symbol.iterator] != null || iter["@@iterator"] != null) return Array.from(iter);}function _arrayWithoutHoles(arr) {if (Array.isArray(arr)) return _arrayLikeToArray(arr);}function _createForOfIteratorHelper(o, allowArrayLike) {var it = typeof Symbol !== "undefined" && o[Symbol.iterator] || o["@@iterator"];if (!it) {if (Array.isArray(o) || (it = _unsupportedIterableToArray(o)) || allowArrayLike && o && typeof o.length === "number") {if (it) o = it;var i = 0;var F = function F() {};return { s: F, n: function n() {if (i >= o.length) return { done: true };return { done: false, value: o[i++] };}, e: function e(_e2) {throw _e2;}, f: F };}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");}var normalCompletion = true,didErr = false,err;return { s: function s() {it = it.call(o);}, n: function n() {var step = it.next();normalCompletion = step.done;return step;}, e: function e(_e3) {didErr = true;err = _e3;}, f: function f() {try {if (!normalCompletion && it.return != null) it.return();} finally {if (didErr) throw err;}} };}function _unsupportedIterableToArray(o, minLen) {if (!o) return;if (typeof o === "string") return _arrayLikeToArray(o, minLen);var n = Object.prototype.toString.call(o).slice(8, -1);if (n === "Object" && o.constructor) n = o.constructor.name;if (n === "Map" || n === "Set") return Array.from(o);if (n === "Arguments" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen);}function _arrayLikeToArray(arr, len) {if (len == null || len > arr.length) len = arr.length;for (var i = 0, arr2 = new Array(len); i < len; i++) {arr2[i] = arr[i];}return arr2;}








function handledApiRequest() {
  var fields = (0,kolmafia__WEBPACK_IMPORTED_MODULE_0__.formFields)();

  if (fields["api"] == null) {
    return false;
  }
  var returns = eval(fields["api"]) || "";
  // We include the ' ' because otherwise the browser doesn't like an empty page
  (0,kolmafia__WEBPACK_IMPORTED_MODULE_0__.write)(returns + (returns ? "" : " "));

  return true;
}

function validateComponents(components) {var _iterator = _createForOfIteratorHelper(
    components),_step;try {for (_iterator.s(); !(_step = _iterator.n()).done;) {var _button$name;var component = _step.value;
      var button = component;

      if (button.preference == null) {
        continue;
      }

      button.name = (_button$name = button.name) !== null && _button$name !== void 0 ? _button$name : button.preference;

      if (button.validate != null) {
        try {
          eval(button.validate);
        } catch (e) {
          (0,kolmafia__WEBPACK_IMPORTED_MODULE_0__.print)("Unable to load ".concat(button.name, "'s validator '").concat(button.validate, "'"));
          button.validate = null;
        }
      }

      if (button.value != null) {
        continue;
      }

      var val = void 0;

      if ((0,kolmafia__WEBPACK_IMPORTED_MODULE_0__.propertyExists)(button.preference)) {
        val = (0,kolmafia__WEBPACK_IMPORTED_MODULE_0__.getProperty)(button.preference);
      } else if (button.default != null) {
        val = button.default;
      } else {
        if (button.type == "dropdown") {
          val = button.dropdown[0].value;
        } else if (button.type == "boolean") {
          val = "true";
        } else {
          val = "";
        }
      }

      button.value = val;
    }} catch (err) {_iterator.e(err);} finally {_iterator.f();}
}

function generateHTML(
pages,
extraHtml)
{
  pages = pages.filter((p) => p != null);var _iterator2 = _createForOfIteratorHelper(

    pages),_step2;try {for (_iterator2.s(); !(_step2 = _iterator2.n()).done;) {var page = _step2.value;
      validateComponents(page.components);
    }} catch (err) {_iterator2.e(err);} finally {_iterator2.f();}

  var buffer = [];

  var cssFiles = [];

  if (extraHtml && extraHtml.cssFiles) {
    cssFiles.push.apply(cssFiles, _toConsumableArray(extraHtml.cssFiles));
  }

  buffer.push("<head>");

  cssFiles.forEach((s) => {
    buffer.push("<link rel=\"stylesheet\" src=\"".concat(s, "\">"));
  });

  buffer.push("<style>");
  buffer.push("".concat(__webpack_require__(171)));

  if (extraHtml && extraHtml.css) {
    buffer.push(extraHtml.css);
  }

  buffer.push("</style>");

  buffer.push("</head>");

  buffer.push('<div id="root"></div>');

  buffer.push("<script>");

  // add script that react calls when loaded to get kol data
  buffer.push("let getData = function(callback) {callback(".concat(
  JSON.stringify(pages), ")}"));


  // close notifications when they are clicked on
  buffer.push("document.onclick = (e) => {\n    if(e.target.classList.contains('notification')) e.target.remove();\n  }");



  buffer.push("</script>");

  // include react script
  buffer.push("<script src=\"".concat(
  __webpack_require__(832), "\"></script>"));


  return buffer.join("\n");
}

function getPagePath(file) {
  var fileName = file.includes("/") ?
  file :
  "relay/shared_relay/pages/" + file + ".json";

  if (!fileName.endsWith(".json") && (0,kolmafia__WEBPACK_IMPORTED_MODULE_0__.fileToBuffer)(fileName).length == 0) {
    fileName += ".json";
  }

  return fileName;
}

/**
 * Parses from relay/shared_relay/pages/ if no slashes are in the name, otherwise expects a valid json file
 */
function parsePageFromFile(file) {
  var data = (0,kolmafia__WEBPACK_IMPORTED_MODULE_0__.fileToBuffer)(getPagePath(file));

  return parsePageFromJson(file, data);
}

function parseCssFromFile(file) {
  var fileName = file.includes("/") ?
  file :
  "shared_relay/pages/" + file + ".css";

  if (!fileName.endsWith(".css")) {
    fileName += ".css";
  }

  var data = (0,kolmafia__WEBPACK_IMPORTED_MODULE_0__.fileToBuffer)(fileName);

  if (data.length == 0) {
    return null;
  }

  return fileName;
}

function parsePageFromJson(id, jsonData) {
  if (jsonData.length == 0) {
    return null;
  }

  var subpage = JSON.parse(jsonData);

  subpage.file = id;

  for (var _i = 0, _arr = subpage.components; _i < _arr.length; _i++) {var _button$dropdown;var button = _arr[_i];
    if (button.type != "dropdown") {
      continue;
    }

    if (button.dropdown == null) {
      button.dropdown = [];
    } else if (typeof button.dropdown[0] == "string") {
      button.dropdown = button.dropdown.map((s) => {
        return {
          display: s,
          value: s
        };
      });
    }

    if (button.dropdownFiller == null) {
      continue;
    }

    var data =
    eval(button.dropdownFiller).
    map((_ref) => {var _ref2 = _slicedToArray(_ref, 2),display = _ref2[0],value = _ref2[1];
      return {
        display: display,
        value: value
      };
    });

    (_button$dropdown = button.dropdown).push.apply(_button$dropdown, _toConsumableArray(data));
  }

  return subpage;
}

/***/ }),

/***/ 832:
/***/ ((module) => {

module.exports = "data:application/javascript;base64,ZnVuY3Rpb24gX2NyZWF0ZUZvck9mSXRlcmF0b3JIZWxwZXIyKG8sIGFsbG93QXJyYXlMaWtlKSB7dmFyIGl0ID0gdHlwZW9mIFN5bWJvbCAhPT0gInVuZGVmaW5lZCIgJiYgb1tTeW1ib2wuaXRlcmF0b3JdIHx8IG9bIkBAaXRlcmF0b3IiXTtpZiAoIWl0KSB7aWYgKEFycmF5LmlzQXJyYXkobykgfHwgKGl0ID0gX3Vuc3VwcG9ydGVkSXRlcmFibGVUb0FycmF5MihvKSkgfHwgYWxsb3dBcnJheUxpa2UgJiYgbyAmJiB0eXBlb2Ygby5sZW5ndGggPT09ICJudW1iZXIiKSB7aWYgKGl0KSBvID0gaXQ7dmFyIGkgPSAwO3ZhciBGID0gZnVuY3Rpb24gRigpIHt9O3JldHVybiB7IHM6IEYsIG46IGZ1bmN0aW9uIG4oKSB7aWYgKGkgPj0gby5sZW5ndGgpIHJldHVybiB7IGRvbmU6IHRydWUgfTtyZXR1cm4geyBkb25lOiBmYWxzZSwgdmFsdWU6IG9baSsrXSB9O30sIGU6IGZ1bmN0aW9uIGUoX2U0KSB7dGhyb3cgX2U0O30sIGY6IEYgfTt9dGhyb3cgbmV3IFR5cGVFcnJvcigiSW52YWxpZCBhdHRlbXB0IHRvIGl0ZXJhdGUgbm9uLWl0ZXJhYmxlIGluc3RhbmNlLlxuSW4gb3JkZXIgdG8gYmUgaXRlcmFibGUsIG5vbi1hcnJheSBvYmplY3RzIG11c3QgaGF2ZSBhIFtTeW1ib2wuaXRlcmF0b3JdKCkgbWV0aG9kLiIpO312YXIgbm9ybWFsQ29tcGxldGlvbiA9IHRydWUsZGlkRXJyID0gZmFsc2UsZXJyO3JldHVybiB7IHM6IGZ1bmN0aW9uIHMoKSB7aXQgPSBpdC5jYWxsKG8pO30sIG46IGZ1bmN0aW9uIG4oKSB7dmFyIHN0ZXAgPSBpdC5uZXh0KCk7bm9ybWFsQ29tcGxldGlvbiA9IHN0ZXAuZG9uZTtyZXR1cm4gc3RlcDt9LCBlOiBmdW5jdGlvbiBlKF9lNSkge2RpZEVyciA9IHRydWU7ZXJyID0gX2U1O30sIGY6IGZ1bmN0aW9uIGYoKSB7dHJ5IHtpZiAoIW5vcm1hbENvbXBsZXRpb24gJiYgaXQucmV0dXJuICE9IG51bGwpIGl0LnJldHVybigpO30gZmluYWxseSB7aWYgKGRpZEVycikgdGhyb3cgZXJyO319IH07fWZ1bmN0aW9uIF9yZWdlbmVyYXRvclJ1bnRpbWUyKCkgeyJ1c2Ugc3RyaWN0IjsKLyohIHJlZ2VuZXJhdG9yLXJ1bnRpbWUgLS0gQ29weXJpZ2h0IChjKSAyMDE0LXByZXNlbnQsIEZhY2Vib29rLCBJbmMuIC0tIGxpY2Vuc2UgKE1JVCk6IGh0dHBzOi8vZ2l0aHViLmNvbS9mYWNlYm9vay9yZWdlbmVyYXRvci9ibG9iL21haW4vTElDRU5TRSAqL19yZWdlbmVyYXRvclJ1bnRpbWUyID0gZnVuY3Rpb24gX3JlZ2VuZXJhdG9yUnVudGltZTIoKSB7cmV0dXJuIGV4cG9ydHM7fTt2YXIgZXhwb3J0cyA9IHt9LE9wID0gT2JqZWN0LnByb3RvdHlwZSxoYXNPd24gPSBPcC5oYXNPd25Qcm9wZXJ0eSxkZWZpbmVQcm9wZXJ0eSA9IE9iamVjdC5kZWZpbmVQcm9wZXJ0eSB8fCBmdW5jdGlvbiAob2JqLCBrZXksIGRlc2MpIHtvYmpba2V5XSA9IGRlc2MudmFsdWU7fSwkU3ltYm9sID0gImZ1bmN0aW9uIiA9PSB0eXBlb2YgU3ltYm9sID8gU3ltYm9sIDoge30saXRlcmF0b3JTeW1ib2wgPSAkU3ltYm9sLml0ZXJhdG9yIHx8ICJAQGl0ZXJhdG9yIixhc3luY0l0ZXJhdG9yU3ltYm9sID0gJFN5bWJvbC5hc3luY0l0ZXJhdG9yIHx8ICJAQGFzeW5jSXRlcmF0b3IiLHRvU3RyaW5nVGFnU3ltYm9sID0gJFN5bWJvbC50b1N0cmluZ1RhZyB8fCAiQEB0b1N0cmluZ1RhZyI7ZnVuY3Rpb24gZGVmaW5lKG9iaiwga2V5LCB2YWx1ZSkge3JldHVybiBPYmplY3QuZGVmaW5lUHJvcGVydHkob2JqLCBrZXksIHsgdmFsdWU6IHZhbHVlLCBlbnVtZXJhYmxlOiAhMCwgY29uZmlndXJhYmxlOiAhMCwgd3JpdGFibGU6ICEwIH0pLCBvYmpba2V5XTt9dHJ5IHtkZWZpbmUoe30sICIiKTt9IGNhdGNoIChlcnIpIHtkZWZpbmUgPSBmdW5jdGlvbiBkZWZpbmUob2JqLCBrZXksIHZhbHVlKSB7cmV0dXJuIG9ialtrZXldID0gdmFsdWU7fTt9ZnVuY3Rpb24gd3JhcChpbm5lckZuLCBvdXRlckZuLCBzZWxmLCB0cnlMb2NzTGlzdCkge3ZhciBwcm90b0dlbmVyYXRvciA9IG91dGVyRm4gJiYgb3V0ZXJGbi5wcm90b3R5cGUgaW5zdGFuY2VvZiBHZW5lcmF0b3IgPyBvdXRlckZuIDogR2VuZXJhdG9yLGdlbmVyYXRvciA9IE9iamVjdC5jcmVhdGUocHJvdG9HZW5lcmF0b3IucHJvdG90eXBlKSxjb250ZXh0ID0gbmV3IENvbnRleHQodHJ5TG9jc0xpc3QgfHwgW10pO3JldHVybiBkZWZpbmVQcm9wZXJ0eShnZW5lcmF0b3IsICJfaW52b2tlIiwgeyB2YWx1ZTogbWFrZUludm9rZU1ldGhvZChpbm5lckZuLCBzZWxmLCBjb250ZXh0KSB9KSwgZ2VuZXJhdG9yO31mdW5jdGlvbiB0cnlDYXRjaChmbiwgb2JqLCBhcmcpIHt0cnkge3JldHVybiB7IHR5cGU6ICJub3JtYWwiLCBhcmc6IGZuLmNhbGwob2JqLCBhcmcpIH07fSBjYXRjaCAoZXJyKSB7cmV0dXJuIHsgdHlwZTogInRocm93IiwgYXJnOiBlcnIgfTt9fWV4cG9ydHMud3JhcCA9IHdyYXA7dmFyIENvbnRpbnVlU2VudGluZWwgPSB7fTtmdW5jdGlvbiBHZW5lcmF0b3IoKSB7fWZ1bmN0aW9uIEdlbmVyYXRvckZ1bmN0aW9uKCkge31mdW5jdGlvbiBHZW5lcmF0b3JGdW5jdGlvblByb3RvdHlwZSgpIHt9dmFyIEl0ZXJhdG9yUHJvdG90eXBlID0ge307ZGVmaW5lKEl0ZXJhdG9yUHJvdG90eXBlLCBpdGVyYXRvclN5bWJvbCwgZnVuY3Rpb24gKCkge3JldHVybiB0aGlzO30pO3ZhciBnZXRQcm90byA9IE9iamVjdC5nZXRQcm90b3R5cGVPZixOYXRpdmVJdGVyYXRvclByb3RvdHlwZSA9IGdldFByb3RvICYmIGdldFByb3RvKGdldFByb3RvKHZhbHVlcyhbXSkpKTtOYXRpdmVJdGVyYXRvclByb3RvdHlwZSAmJiBOYXRpdmVJdGVyYXRvclByb3RvdHlwZSAhPT0gT3AgJiYgaGFzT3duLmNhbGwoTmF0aXZlSXRlcmF0b3JQcm90b3R5cGUsIGl0ZXJhdG9yU3ltYm9sKSAmJiAoSXRlcmF0b3JQcm90b3R5cGUgPSBOYXRpdmVJdGVyYXRvclByb3RvdHlwZSk7dmFyIEdwID0gR2VuZXJhdG9yRnVuY3Rpb25Qcm90b3R5cGUucHJvdG90eXBlID0gR2VuZXJhdG9yLnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoSXRlcmF0b3JQcm90b3R5cGUpO2Z1bmN0aW9uIGRlZmluZUl0ZXJhdG9yTWV0aG9kcyhwcm90b3R5cGUpIHtbIm5leHQiLCAidGhyb3ciLCAicmV0dXJuIl0uZm9yRWFjaChmdW5jdGlvbiAobWV0aG9kKSB7ZGVmaW5lKHByb3RvdHlwZSwgbWV0aG9kLCBmdW5jdGlvbiAoYXJnKSB7cmV0dXJuIHRoaXMuX2ludm9rZShtZXRob2QsIGFyZyk7fSk7fSk7fWZ1bmN0aW9uIEFzeW5jSXRlcmF0b3IoZ2VuZXJhdG9yLCBQcm9taXNlSW1wbCkge2Z1bmN0aW9uIGludm9rZShtZXRob2QsIGFyZywgcmVzb2x2ZSwgcmVqZWN0KSB7dmFyIHJlY29yZCA9IHRyeUNhdGNoKGdlbmVyYXRvclttZXRob2RdLCBnZW5lcmF0b3IsIGFyZyk7aWYgKCJ0aHJvdyIgIT09IHJlY29yZC50eXBlKSB7dmFyIHJlc3VsdCA9IHJlY29yZC5hcmcsdmFsdWUgPSByZXN1bHQudmFsdWU7cmV0dXJuIHZhbHVlICYmICJvYmplY3QiID09IHR5cGVvZiB2YWx1ZSAmJiBoYXNPd24uY2FsbCh2YWx1ZSwgIl9fYXdhaXQiKSA/IFByb21pc2VJbXBsLnJlc29sdmUodmFsdWUuX19hd2FpdCkudGhlbihmdW5jdGlvbiAodmFsdWUpIHtpbnZva2UoIm5leHQiLCB2YWx1ZSwgcmVzb2x2ZSwgcmVqZWN0KTt9LCBmdW5jdGlvbiAoZXJyKSB7aW52b2tlKCJ0aHJvdyIsIGVyciwgcmVzb2x2ZSwgcmVqZWN0KTt9KSA6IFByb21pc2VJbXBsLnJlc29sdmUodmFsdWUpLnRoZW4oZnVuY3Rpb24gKHVud3JhcHBlZCkge3Jlc3VsdC52YWx1ZSA9IHVud3JhcHBlZCwgcmVzb2x2ZShyZXN1bHQpO30sIGZ1bmN0aW9uIChlcnJvcikge3JldHVybiBpbnZva2UoInRocm93IiwgZXJyb3IsIHJlc29sdmUsIHJlamVjdCk7fSk7fXJlamVjdChyZWNvcmQuYXJnKTt9dmFyIHByZXZpb3VzUHJvbWlzZTtkZWZpbmVQcm9wZXJ0eSh0aGlzLCAiX2ludm9rZSIsIHsgdmFsdWU6IGZ1bmN0aW9uIHZhbHVlKG1ldGhvZCwgYXJnKSB7ZnVuY3Rpb24gY2FsbEludm9rZVdpdGhNZXRob2RBbmRBcmcoKSB7cmV0dXJuIG5ldyBQcm9taXNlSW1wbChmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7aW52b2tlKG1ldGhvZCwgYXJnLCByZXNvbHZlLCByZWplY3QpO30pO31yZXR1cm4gcHJldmlvdXNQcm9taXNlID0gcHJldmlvdXNQcm9taXNlID8gcHJldmlvdXNQcm9taXNlLnRoZW4oY2FsbEludm9rZVdpdGhNZXRob2RBbmRBcmcsIGNhbGxJbnZva2VXaXRoTWV0aG9kQW5kQXJnKSA6IGNhbGxJbnZva2VXaXRoTWV0aG9kQW5kQXJnKCk7fSB9KTt9ZnVuY3Rpb24gbWFrZUludm9rZU1ldGhvZChpbm5lckZuLCBzZWxmLCBjb250ZXh0KSB7dmFyIHN0YXRlID0gInN1c3BlbmRlZFN0YXJ0IjtyZXR1cm4gZnVuY3Rpb24gKG1ldGhvZCwgYXJnKSB7aWYgKCJleGVjdXRpbmciID09PSBzdGF0ZSkgdGhyb3cgbmV3IEVycm9yKCJHZW5lcmF0b3IgaXMgYWxyZWFkeSBydW5uaW5nIik7aWYgKCJjb21wbGV0ZWQiID09PSBzdGF0ZSkge2lmICgidGhyb3ciID09PSBtZXRob2QpIHRocm93IGFyZztyZXR1cm4gZG9uZVJlc3VsdCgpO31mb3IgKGNvbnRleHQubWV0aG9kID0gbWV0aG9kLCBjb250ZXh0LmFyZyA9IGFyZzs7KSB7dmFyIGRlbGVnYXRlID0gY29udGV4dC5kZWxlZ2F0ZTtpZiAoZGVsZWdhdGUpIHt2YXIgZGVsZWdhdGVSZXN1bHQgPSBtYXliZUludm9rZURlbGVnYXRlKGRlbGVnYXRlLCBjb250ZXh0KTtpZiAoZGVsZWdhdGVSZXN1bHQpIHtpZiAoZGVsZWdhdGVSZXN1bHQgPT09IENvbnRpbnVlU2VudGluZWwpIGNvbnRpbnVlO3JldHVybiBkZWxlZ2F0ZVJlc3VsdDt9fWlmICgibmV4dCIgPT09IGNvbnRleHQubWV0aG9kKSBjb250ZXh0LnNlbnQgPSBjb250ZXh0Ll9zZW50ID0gY29udGV4dC5hcmc7ZWxzZSBpZiAoInRocm93IiA9PT0gY29udGV4dC5tZXRob2QpIHtpZiAoInN1c3BlbmRlZFN0YXJ0IiA9PT0gc3RhdGUpIHRocm93IHN0YXRlID0gImNvbXBsZXRlZCIsIGNvbnRleHQuYXJnO2NvbnRleHQuZGlzcGF0Y2hFeGNlcHRpb24oY29udGV4dC5hcmcpO30gZWxzZSAicmV0dXJuIiA9PT0gY29udGV4dC5tZXRob2QgJiYgY29udGV4dC5hYnJ1cHQoInJldHVybiIsIGNvbnRleHQuYXJnKTtzdGF0ZSA9ICJleGVjdXRpbmciO3ZhciByZWNvcmQgPSB0cnlDYXRjaChpbm5lckZuLCBzZWxmLCBjb250ZXh0KTtpZiAoIm5vcm1hbCIgPT09IHJlY29yZC50eXBlKSB7aWYgKHN0YXRlID0gY29udGV4dC5kb25lID8gImNvbXBsZXRlZCIgOiAic3VzcGVuZGVkWWllbGQiLCByZWNvcmQuYXJnID09PSBDb250aW51ZVNlbnRpbmVsKSBjb250aW51ZTtyZXR1cm4geyB2YWx1ZTogcmVjb3JkLmFyZywgZG9uZTogY29udGV4dC5kb25lIH07fSJ0aHJvdyIgPT09IHJlY29yZC50eXBlICYmIChzdGF0ZSA9ICJjb21wbGV0ZWQiLCBjb250ZXh0Lm1ldGhvZCA9ICJ0aHJvdyIsIGNvbnRleHQuYXJnID0gcmVjb3JkLmFyZyk7fX07fWZ1bmN0aW9uIG1heWJlSW52b2tlRGVsZWdhdGUoZGVsZWdhdGUsIGNvbnRleHQpIHt2YXIgbWV0aG9kTmFtZSA9IGNvbnRleHQubWV0aG9kLG1ldGhvZCA9IGRlbGVnYXRlLml0ZXJhdG9yW21ldGhvZE5hbWVdO2lmICh1bmRlZmluZWQgPT09IG1ldGhvZCkgcmV0dXJuIGNvbnRleHQuZGVsZWdhdGUgPSBudWxsLCAidGhyb3ciID09PSBtZXRob2ROYW1lICYmIGRlbGVnYXRlLml0ZXJhdG9yLnJldHVybiAmJiAoY29udGV4dC5tZXRob2QgPSAicmV0dXJuIiwgY29udGV4dC5hcmcgPSB1bmRlZmluZWQsIG1heWJlSW52b2tlRGVsZWdhdGUoZGVsZWdhdGUsIGNvbnRleHQpLCAidGhyb3ciID09PSBjb250ZXh0Lm1ldGhvZCkgfHwgInJldHVybiIgIT09IG1ldGhvZE5hbWUgJiYgKGNvbnRleHQubWV0aG9kID0gInRocm93IiwgY29udGV4dC5hcmcgPSBuZXcgVHlwZUVycm9yKCJUaGUgaXRlcmF0b3IgZG9lcyBub3QgcHJvdmlkZSBhICciICsgbWV0aG9kTmFtZSArICInIG1ldGhvZCIpKSwgQ29udGludWVTZW50aW5lbDt2YXIgcmVjb3JkID0gdHJ5Q2F0Y2gobWV0aG9kLCBkZWxlZ2F0ZS5pdGVyYXRvciwgY29udGV4dC5hcmcpO2lmICgidGhyb3ciID09PSByZWNvcmQudHlwZSkgcmV0dXJuIGNvbnRleHQubWV0aG9kID0gInRocm93IiwgY29udGV4dC5hcmcgPSByZWNvcmQuYXJnLCBjb250ZXh0LmRlbGVnYXRlID0gbnVsbCwgQ29udGludWVTZW50aW5lbDt2YXIgaW5mbyA9IHJlY29yZC5hcmc7cmV0dXJuIGluZm8gPyBpbmZvLmRvbmUgPyAoY29udGV4dFtkZWxlZ2F0ZS5yZXN1bHROYW1lXSA9IGluZm8udmFsdWUsIGNvbnRleHQubmV4dCA9IGRlbGVnYXRlLm5leHRMb2MsICJyZXR1cm4iICE9PSBjb250ZXh0Lm1ldGhvZCAmJiAoY29udGV4dC5tZXRob2QgPSAibmV4dCIsIGNvbnRleHQuYXJnID0gdW5kZWZpbmVkKSwgY29udGV4dC5kZWxlZ2F0ZSA9IG51bGwsIENvbnRpbnVlU2VudGluZWwpIDogaW5mbyA6IChjb250ZXh0Lm1ldGhvZCA9ICJ0aHJvdyIsIGNvbnRleHQuYXJnID0gbmV3IFR5cGVFcnJvcigiaXRlcmF0b3IgcmVzdWx0IGlzIG5vdCBhbiBvYmplY3QiKSwgY29udGV4dC5kZWxlZ2F0ZSA9IG51bGwsIENvbnRpbnVlU2VudGluZWwpO31mdW5jdGlvbiBwdXNoVHJ5RW50cnkobG9jcykge3ZhciBlbnRyeSA9IHsgdHJ5TG9jOiBsb2NzWzBdIH07MSBpbiBsb2NzICYmIChlbnRyeS5jYXRjaExvYyA9IGxvY3NbMV0pLCAyIGluIGxvY3MgJiYgKGVudHJ5LmZpbmFsbHlMb2MgPSBsb2NzWzJdLCBlbnRyeS5hZnRlckxvYyA9IGxvY3NbM10pLCB0aGlzLnRyeUVudHJpZXMucHVzaChlbnRyeSk7fWZ1bmN0aW9uIHJlc2V0VHJ5RW50cnkoZW50cnkpIHt2YXIgcmVjb3JkID0gZW50cnkuY29tcGxldGlvbiB8fCB7fTtyZWNvcmQudHlwZSA9ICJub3JtYWwiLCBkZWxldGUgcmVjb3JkLmFyZywgZW50cnkuY29tcGxldGlvbiA9IHJlY29yZDt9ZnVuY3Rpb24gQ29udGV4dCh0cnlMb2NzTGlzdCkge3RoaXMudHJ5RW50cmllcyA9IFt7IHRyeUxvYzogInJvb3QiIH1dLCB0cnlMb2NzTGlzdC5mb3JFYWNoKHB1c2hUcnlFbnRyeSwgdGhpcyksIHRoaXMucmVzZXQoITApO31mdW5jdGlvbiB2YWx1ZXMoaXRlcmFibGUpIHtpZiAoaXRlcmFibGUpIHt2YXIgaXRlcmF0b3JNZXRob2QgPSBpdGVyYWJsZVtpdGVyYXRvclN5bWJvbF07aWYgKGl0ZXJhdG9yTWV0aG9kKSByZXR1cm4gaXRlcmF0b3JNZXRob2QuY2FsbChpdGVyYWJsZSk7aWYgKCJmdW5jdGlvbiIgPT0gdHlwZW9mIGl0ZXJhYmxlLm5leHQpIHJldHVybiBpdGVyYWJsZTtpZiAoIWlzTmFOKGl0ZXJhYmxlLmxlbmd0aCkpIHt2YXIgaSA9IC0xLG5leHQgPSBmdW5jdGlvbiBuZXh0KCkge2ZvciAoOyArK2kgPCBpdGVyYWJsZS5sZW5ndGg7KSB7aWYgKGhhc093bi5jYWxsKGl0ZXJhYmxlLCBpKSkgcmV0dXJuIG5leHQudmFsdWUgPSBpdGVyYWJsZVtpXSwgbmV4dC5kb25lID0gITEsIG5leHQ7fXJldHVybiBuZXh0LnZhbHVlID0gdW5kZWZpbmVkLCBuZXh0LmRvbmUgPSAhMCwgbmV4dDt9O3JldHVybiBuZXh0Lm5leHQgPSBuZXh0O319cmV0dXJuIHsgbmV4dDogZG9uZVJlc3VsdCB9O31mdW5jdGlvbiBkb25lUmVzdWx0KCkge3JldHVybiB7IHZhbHVlOiB1bmRlZmluZWQsIGRvbmU6ICEwIH07fXJldHVybiBHZW5lcmF0b3JGdW5jdGlvbi5wcm90b3R5cGUgPSBHZW5lcmF0b3JGdW5jdGlvblByb3RvdHlwZSwgZGVmaW5lUHJvcGVydHkoR3AsICJjb25zdHJ1Y3RvciIsIHsgdmFsdWU6IEdlbmVyYXRvckZ1bmN0aW9uUHJvdG90eXBlLCBjb25maWd1cmFibGU6ICEwIH0pLCBkZWZpbmVQcm9wZXJ0eShHZW5lcmF0b3JGdW5jdGlvblByb3RvdHlwZSwgImNvbnN0cnVjdG9yIiwgeyB2YWx1ZTogR2VuZXJhdG9yRnVuY3Rpb24sIGNvbmZpZ3VyYWJsZTogITAgfSksIEdlbmVyYXRvckZ1bmN0aW9uLmRpc3BsYXlOYW1lID0gZGVmaW5lKEdlbmVyYXRvckZ1bmN0aW9uUHJvdG90eXBlLCB0b1N0cmluZ1RhZ1N5bWJvbCwgIkdlbmVyYXRvckZ1bmN0aW9uIiksIGV4cG9ydHMuaXNHZW5lcmF0b3JGdW5jdGlvbiA9IGZ1bmN0aW9uIChnZW5GdW4pIHt2YXIgY3RvciA9ICJmdW5jdGlvbiIgPT0gdHlwZW9mIGdlbkZ1biAmJiBnZW5GdW4uY29uc3RydWN0b3I7cmV0dXJuICEhY3RvciAmJiAoY3RvciA9PT0gR2VuZXJhdG9yRnVuY3Rpb24gfHwgIkdlbmVyYXRvckZ1bmN0aW9uIiA9PT0gKGN0b3IuZGlzcGxheU5hbWUgfHwgY3Rvci5uYW1lKSk7fSwgZXhwb3J0cy5tYXJrID0gZnVuY3Rpb24gKGdlbkZ1bikge3JldHVybiBPYmplY3Quc2V0UHJvdG90eXBlT2YgPyBPYmplY3Quc2V0UHJvdG90eXBlT2YoZ2VuRnVuLCBHZW5lcmF0b3JGdW5jdGlvblByb3RvdHlwZSkgOiAoZ2VuRnVuLl9fcHJvdG9fXyA9IEdlbmVyYXRvckZ1bmN0aW9uUHJvdG90eXBlLCBkZWZpbmUoZ2VuRnVuLCB0b1N0cmluZ1RhZ1N5bWJvbCwgIkdlbmVyYXRvckZ1bmN0aW9uIikpLCBnZW5GdW4ucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZShHcCksIGdlbkZ1bjt9LCBleHBvcnRzLmF3cmFwID0gZnVuY3Rpb24gKGFyZykge3JldHVybiB7IF9fYXdhaXQ6IGFyZyB9O30sIGRlZmluZUl0ZXJhdG9yTWV0aG9kcyhBc3luY0l0ZXJhdG9yLnByb3RvdHlwZSksIGRlZmluZShBc3luY0l0ZXJhdG9yLnByb3RvdHlwZSwgYXN5bmNJdGVyYXRvclN5bWJvbCwgZnVuY3Rpb24gKCkge3JldHVybiB0aGlzO30pLCBleHBvcnRzLkFzeW5jSXRlcmF0b3IgPSBBc3luY0l0ZXJhdG9yLCBleHBvcnRzLmFzeW5jID0gZnVuY3Rpb24gKGlubmVyRm4sIG91dGVyRm4sIHNlbGYsIHRyeUxvY3NMaXN0LCBQcm9taXNlSW1wbCkge3ZvaWQgMCA9PT0gUHJvbWlzZUltcGwgJiYgKFByb21pc2VJbXBsID0gUHJvbWlzZSk7dmFyIGl0ZXIgPSBuZXcgQXN5bmNJdGVyYXRvcih3cmFwKGlubmVyRm4sIG91dGVyRm4sIHNlbGYsIHRyeUxvY3NMaXN0KSwgUHJvbWlzZUltcGwpO3JldHVybiBleHBvcnRzLmlzR2VuZXJhdG9yRnVuY3Rpb24ob3V0ZXJGbikgPyBpdGVyIDogaXRlci5uZXh0KCkudGhlbihmdW5jdGlvbiAocmVzdWx0KSB7cmV0dXJuIHJlc3VsdC5kb25lID8gcmVzdWx0LnZhbHVlIDogaXRlci5uZXh0KCk7fSk7fSwgZGVmaW5lSXRlcmF0b3JNZXRob2RzKEdwKSwgZGVmaW5lKEdwLCB0b1N0cmluZ1RhZ1N5bWJvbCwgIkdlbmVyYXRvciIpLCBkZWZpbmUoR3AsIGl0ZXJhdG9yU3ltYm9sLCBmdW5jdGlvbiAoKSB7cmV0dXJuIHRoaXM7fSksIGRlZmluZShHcCwgInRvU3RyaW5nIiwgZnVuY3Rpb24gKCkge3JldHVybiAiW29iamVjdCBHZW5lcmF0b3JdIjt9KSwgZXhwb3J0cy5rZXlzID0gZnVuY3Rpb24gKHZhbCkge3ZhciBvYmplY3QgPSBPYmplY3QodmFsKSxrZXlzID0gW107Zm9yICh2YXIga2V5IGluIG9iamVjdCkge2tleXMucHVzaChrZXkpO31yZXR1cm4ga2V5cy5yZXZlcnNlKCksIGZ1bmN0aW9uIG5leHQoKSB7Zm9yICg7IGtleXMubGVuZ3RoOykge3ZhciBrZXkgPSBrZXlzLnBvcCgpO2lmIChrZXkgaW4gb2JqZWN0KSByZXR1cm4gbmV4dC52YWx1ZSA9IGtleSwgbmV4dC5kb25lID0gITEsIG5leHQ7fXJldHVybiBuZXh0LmRvbmUgPSAhMCwgbmV4dDt9O30sIGV4cG9ydHMudmFsdWVzID0gdmFsdWVzLCBDb250ZXh0LnByb3RvdHlwZSA9IHsgY29uc3RydWN0b3I6IENvbnRleHQsIHJlc2V0OiBmdW5jdGlvbiByZXNldChza2lwVGVtcFJlc2V0KSB7aWYgKHRoaXMucHJldiA9IDAsIHRoaXMubmV4dCA9IDAsIHRoaXMuc2VudCA9IHRoaXMuX3NlbnQgPSB1bmRlZmluZWQsIHRoaXMuZG9uZSA9ICExLCB0aGlzLmRlbGVnYXRlID0gbnVsbCwgdGhpcy5tZXRob2QgPSAibmV4dCIsIHRoaXMuYXJnID0gdW5kZWZpbmVkLCB0aGlzLnRyeUVudHJpZXMuZm9yRWFjaChyZXNldFRyeUVudHJ5KSwgIXNraXBUZW1wUmVzZXQpIGZvciAodmFyIG5hbWUgaW4gdGhpcykgeyJ0IiA9PT0gbmFtZS5jaGFyQXQoMCkgJiYgaGFzT3duLmNhbGwodGhpcywgbmFtZSkgJiYgIWlzTmFOKCtuYW1lLnNsaWNlKDEpKSAmJiAodGhpc1tuYW1lXSA9IHVuZGVmaW5lZCk7fX0sIHN0b3A6IGZ1bmN0aW9uIHN0b3AoKSB7dGhpcy5kb25lID0gITA7dmFyIHJvb3RSZWNvcmQgPSB0aGlzLnRyeUVudHJpZXNbMF0uY29tcGxldGlvbjtpZiAoInRocm93IiA9PT0gcm9vdFJlY29yZC50eXBlKSB0aHJvdyByb290UmVjb3JkLmFyZztyZXR1cm4gdGhpcy5ydmFsO30sIGRpc3BhdGNoRXhjZXB0aW9uOiBmdW5jdGlvbiBkaXNwYXRjaEV4Y2VwdGlvbihleGNlcHRpb24pIHtpZiAodGhpcy5kb25lKSB0aHJvdyBleGNlcHRpb247dmFyIGNvbnRleHQgPSB0aGlzO2Z1bmN0aW9uIGhhbmRsZShsb2MsIGNhdWdodCkge3JldHVybiByZWNvcmQudHlwZSA9ICJ0aHJvdyIsIHJlY29yZC5hcmcgPSBleGNlcHRpb24sIGNvbnRleHQubmV4dCA9IGxvYywgY2F1Z2h0ICYmIChjb250ZXh0Lm1ldGhvZCA9ICJuZXh0IiwgY29udGV4dC5hcmcgPSB1bmRlZmluZWQpLCAhIWNhdWdodDt9Zm9yICh2YXIgaSA9IHRoaXMudHJ5RW50cmllcy5sZW5ndGggLSAxOyBpID49IDA7IC0taSkge3ZhciBlbnRyeSA9IHRoaXMudHJ5RW50cmllc1tpXSxyZWNvcmQgPSBlbnRyeS5jb21wbGV0aW9uO2lmICgicm9vdCIgPT09IGVudHJ5LnRyeUxvYykgcmV0dXJuIGhhbmRsZSgiZW5kIik7aWYgKGVudHJ5LnRyeUxvYyA8PSB0aGlzLnByZXYpIHt2YXIgaGFzQ2F0Y2ggPSBoYXNPd24uY2FsbChlbnRyeSwgImNhdGNoTG9jIiksaGFzRmluYWxseSA9IGhhc093bi5jYWxsKGVudHJ5LCAiZmluYWxseUxvYyIpO2lmIChoYXNDYXRjaCAmJiBoYXNGaW5hbGx5KSB7aWYgKHRoaXMucHJldiA8IGVudHJ5LmNhdGNoTG9jKSByZXR1cm4gaGFuZGxlKGVudHJ5LmNhdGNoTG9jLCAhMCk7aWYgKHRoaXMucHJldiA8IGVudHJ5LmZpbmFsbHlMb2MpIHJldHVybiBoYW5kbGUoZW50cnkuZmluYWxseUxvYyk7fSBlbHNlIGlmIChoYXNDYXRjaCkge2lmICh0aGlzLnByZXYgPCBlbnRyeS5jYXRjaExvYykgcmV0dXJuIGhhbmRsZShlbnRyeS5jYXRjaExvYywgITApO30gZWxzZSB7aWYgKCFoYXNGaW5hbGx5KSB0aHJvdyBuZXcgRXJyb3IoInRyeSBzdGF0ZW1lbnQgd2l0aG91dCBjYXRjaCBvciBmaW5hbGx5Iik7aWYgKHRoaXMucHJldiA8IGVudHJ5LmZpbmFsbHlMb2MpIHJldHVybiBoYW5kbGUoZW50cnkuZmluYWxseUxvYyk7fX19fSwgYWJydXB0OiBmdW5jdGlvbiBhYnJ1cHQodHlwZSwgYXJnKSB7Zm9yICh2YXIgaSA9IHRoaXMudHJ5RW50cmllcy5sZW5ndGggLSAxOyBpID49IDA7IC0taSkge3ZhciBlbnRyeSA9IHRoaXMudHJ5RW50cmllc1tpXTtpZiAoZW50cnkudHJ5TG9jIDw9IHRoaXMucHJldiAmJiBoYXNPd24uY2FsbChlbnRyeSwgImZpbmFsbHlMb2MiKSAmJiB0aGlzLnByZXYgPCBlbnRyeS5maW5hbGx5TG9jKSB7dmFyIGZpbmFsbHlFbnRyeSA9IGVudHJ5O2JyZWFrO319ZmluYWxseUVudHJ5ICYmICgiYnJlYWsiID09PSB0eXBlIHx8ICJjb250aW51ZSIgPT09IHR5cGUpICYmIGZpbmFsbHlFbnRyeS50cnlMb2MgPD0gYXJnICYmIGFyZyA8PSBmaW5hbGx5RW50cnkuZmluYWxseUxvYyAmJiAoZmluYWxseUVudHJ5ID0gbnVsbCk7dmFyIHJlY29yZCA9IGZpbmFsbHlFbnRyeSA/IGZpbmFsbHlFbnRyeS5jb21wbGV0aW9uIDoge307cmV0dXJuIHJlY29yZC50eXBlID0gdHlwZSwgcmVjb3JkLmFyZyA9IGFyZywgZmluYWxseUVudHJ5ID8gKHRoaXMubWV0aG9kID0gIm5leHQiLCB0aGlzLm5leHQgPSBmaW5hbGx5RW50cnkuZmluYWxseUxvYywgQ29udGludWVTZW50aW5lbCkgOiB0aGlzLmNvbXBsZXRlKHJlY29yZCk7fSwgY29tcGxldGU6IGZ1bmN0aW9uIGNvbXBsZXRlKHJlY29yZCwgYWZ0ZXJMb2MpIHtpZiAoInRocm93IiA9PT0gcmVjb3JkLnR5cGUpIHRocm93IHJlY29yZC5hcmc7cmV0dXJuICJicmVhayIgPT09IHJlY29yZC50eXBlIHx8ICJjb250aW51ZSIgPT09IHJlY29yZC50eXBlID8gdGhpcy5uZXh0ID0gcmVjb3JkLmFyZyA6ICJyZXR1cm4iID09PSByZWNvcmQudHlwZSA/ICh0aGlzLnJ2YWwgPSB0aGlzLmFyZyA9IHJlY29yZC5hcmcsIHRoaXMubWV0aG9kID0gInJldHVybiIsIHRoaXMubmV4dCA9ICJlbmQiKSA6ICJub3JtYWwiID09PSByZWNvcmQudHlwZSAmJiBhZnRlckxvYyAmJiAodGhpcy5uZXh0ID0gYWZ0ZXJMb2MpLCBDb250aW51ZVNlbnRpbmVsO30sIGZpbmlzaDogZnVuY3Rpb24gZmluaXNoKGZpbmFsbHlMb2MpIHtmb3IgKHZhciBpID0gdGhpcy50cnlFbnRyaWVzLmxlbmd0aCAtIDE7IGkgPj0gMDsgLS1pKSB7dmFyIGVudHJ5ID0gdGhpcy50cnlFbnRyaWVzW2ldO2lmIChlbnRyeS5maW5hbGx5TG9jID09PSBmaW5hbGx5TG9jKSByZXR1cm4gdGhpcy5jb21wbGV0ZShlbnRyeS5jb21wbGV0aW9uLCBlbnRyeS5hZnRlckxvYyksIHJlc2V0VHJ5RW50cnkoZW50cnkpLCBDb250aW51ZVNlbnRpbmVsO319LCBjYXRjaDogZnVuY3Rpb24gX2NhdGNoKHRyeUxvYykge2ZvciAodmFyIGkgPSB0aGlzLnRyeUVudHJpZXMubGVuZ3RoIC0gMTsgaSA+PSAwOyAtLWkpIHt2YXIgZW50cnkgPSB0aGlzLnRyeUVudHJpZXNbaV07aWYgKGVudHJ5LnRyeUxvYyA9PT0gdHJ5TG9jKSB7dmFyIHJlY29yZCA9IGVudHJ5LmNvbXBsZXRpb247aWYgKCJ0aHJvdyIgPT09IHJlY29yZC50eXBlKSB7dmFyIHRocm93biA9IHJlY29yZC5hcmc7cmVzZXRUcnlFbnRyeShlbnRyeSk7fXJldHVybiB0aHJvd247fX10aHJvdyBuZXcgRXJyb3IoImlsbGVnYWwgY2F0Y2ggYXR0ZW1wdCIpO30sIGRlbGVnYXRlWWllbGQ6IGZ1bmN0aW9uIGRlbGVnYXRlWWllbGQoaXRlcmFibGUsIHJlc3VsdE5hbWUsIG5leHRMb2MpIHtyZXR1cm4gdGhpcy5kZWxlZ2F0ZSA9IHsgaXRlcmF0b3I6IHZhbHVlcyhpdGVyYWJsZSksIHJlc3VsdE5hbWU6IHJlc3VsdE5hbWUsIG5leHRMb2M6IG5leHRMb2MgfSwgIm5leHQiID09PSB0aGlzLm1ldGhvZCAmJiAodGhpcy5hcmcgPSB1bmRlZmluZWQpLCBDb250aW51ZVNlbnRpbmVsO30gfSwgZXhwb3J0czt9ZnVuY3Rpb24gYXN5bmNHZW5lcmF0b3JTdGVwKGdlbiwgcmVzb2x2ZSwgcmVqZWN0LCBfbmV4dCwgX3Rocm93LCBrZXksIGFyZykge3RyeSB7dmFyIGluZm8gPSBnZW5ba2V5XShhcmcpO3ZhciB2YWx1ZSA9IGluZm8udmFsdWU7fSBjYXRjaCAoZXJyb3IpIHtyZWplY3QoZXJyb3IpO3JldHVybjt9aWYgKGluZm8uZG9uZSkge3Jlc29sdmUodmFsdWUpO30gZWxzZSB7UHJvbWlzZS5yZXNvbHZlKHZhbHVlKS50aGVuKF9uZXh0LCBfdGhyb3cpO319ZnVuY3Rpb24gX2FzeW5jVG9HZW5lcmF0b3IyKGZuKSB7cmV0dXJuIGZ1bmN0aW9uICgpIHt2YXIgc2VsZiA9IHRoaXMsYXJncyA9IGFyZ3VtZW50cztyZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge3ZhciBnZW4gPSBmbi5hcHBseShzZWxmLCBhcmdzKTtmdW5jdGlvbiBfbmV4dCh2YWx1ZSkge2FzeW5jR2VuZXJhdG9yU3RlcChnZW4sIHJlc29sdmUsIHJlamVjdCwgX25leHQsIF90aHJvdywgIm5leHQiLCB2YWx1ZSk7fWZ1bmN0aW9uIF90aHJvdyhlcnIpIHthc3luY0dlbmVyYXRvclN0ZXAoZ2VuLCByZXNvbHZlLCByZWplY3QsIF9uZXh0LCBfdGhyb3csICJ0aHJvdyIsIGVycik7fV9uZXh0KHVuZGVmaW5lZCk7fSk7fTt9ZnVuY3Rpb24gX2RlZmluZVByb3BlcnR5MihvYmosIGtleSwgdmFsdWUpIHtrZXkgPSBfdG9Qcm9wZXJ0eUtleTIoa2V5KTtpZiAoa2V5IGluIG9iaikge09iamVjdC5kZWZpbmVQcm9wZXJ0eShvYmosIGtleSwgeyB2YWx1ZTogdmFsdWUsIGVudW1lcmFibGU6IHRydWUsIGNvbmZpZ3VyYWJsZTogdHJ1ZSwgd3JpdGFibGU6IHRydWUgfSk7fSBlbHNlIHtvYmpba2V5XSA9IHZhbHVlO31yZXR1cm4gb2JqO31mdW5jdGlvbiBfZGVmaW5lUHJvcGVydGllcyh0YXJnZXQsIHByb3BzKSB7Zm9yICh2YXIgaSA9IDA7IGkgPCBwcm9wcy5sZW5ndGg7IGkrKykge3ZhciBkZXNjcmlwdG9yID0gcHJvcHNbaV07ZGVzY3JpcHRvci5lbnVtZXJhYmxlID0gZGVzY3JpcHRvci5lbnVtZXJhYmxlIHx8IGZhbHNlO2Rlc2NyaXB0b3IuY29uZmlndXJhYmxlID0gdHJ1ZTtpZiAoInZhbHVlIiBpbiBkZXNjcmlwdG9yKSBkZXNjcmlwdG9yLndyaXRhYmxlID0gdHJ1ZTtPYmplY3QuZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBfdG9Qcm9wZXJ0eUtleTIoZGVzY3JpcHRvci5rZXkpLCBkZXNjcmlwdG9yKTt9fWZ1bmN0aW9uIF9jcmVhdGVDbGFzczIoQ29uc3RydWN0b3IsIHByb3RvUHJvcHMsIHN0YXRpY1Byb3BzKSB7aWYgKHByb3RvUHJvcHMpIF9kZWZpbmVQcm9wZXJ0aWVzKENvbnN0cnVjdG9yLnByb3RvdHlwZSwgcHJvdG9Qcm9wcyk7aWYgKHN0YXRpY1Byb3BzKSBfZGVmaW5lUHJvcGVydGllcyhDb25zdHJ1Y3Rvciwgc3RhdGljUHJvcHMpO09iamVjdC5kZWZpbmVQcm9wZXJ0eShDb25zdHJ1Y3RvciwgInByb3RvdHlwZSIsIHsgd3JpdGFibGU6IGZhbHNlIH0pO3JldHVybiBDb25zdHJ1Y3Rvcjt9ZnVuY3Rpb24gX3RvUHJvcGVydHlLZXkyKGFyZykge3ZhciBrZXkgPSBfdG9QcmltaXRpdmUyKGFyZywgInN0cmluZyIpO3JldHVybiB0eXBlb2Yga2V5ID09PSAic3ltYm9sIiA/IGtleSA6IFN0cmluZyhrZXkpO31mdW5jdGlvbiBfdG9QcmltaXRpdmUyKGlucHV0LCBoaW50KSB7aWYgKHR5cGVvZiBpbnB1dCAhPT0gIm9iamVjdCIgfHwgaW5wdXQgPT09IG51bGwpIHJldHVybiBpbnB1dDt2YXIgcHJpbSA9IGlucHV0W1N5bWJvbC50b1ByaW1pdGl2ZV07aWYgKHByaW0gIT09IHVuZGVmaW5lZCkge3ZhciByZXMgPSBwcmltLmNhbGwoaW5wdXQsIGhpbnQgfHwgImRlZmF1bHQiKTtpZiAodHlwZW9mIHJlcyAhPT0gIm9iamVjdCIpIHJldHVybiByZXM7dGhyb3cgbmV3IFR5cGVFcnJvcigiQEB0b1ByaW1pdGl2ZSBtdXN0IHJldHVybiBhIHByaW1pdGl2ZSB2YWx1ZS4iKTt9cmV0dXJuIChoaW50ID09PSAic3RyaW5nIiA/IFN0cmluZyA6IE51bWJlcikoaW5wdXQpO31mdW5jdGlvbiBfY2xhc3NDYWxsQ2hlY2syKGluc3RhbmNlLCBDb25zdHJ1Y3Rvcikge2lmICghKGluc3RhbmNlIGluc3RhbmNlb2YgQ29uc3RydWN0b3IpKSB7dGhyb3cgbmV3IFR5cGVFcnJvcigiQ2Fubm90IGNhbGwgYSBjbGFzcyBhcyBhIGZ1bmN0aW9uIik7fX1mdW5jdGlvbiBfaW5oZXJpdHMoc3ViQ2xhc3MsIHN1cGVyQ2xhc3MpIHtpZiAodHlwZW9mIHN1cGVyQ2xhc3MgIT09ICJmdW5jdGlvbiIgJiYgc3VwZXJDbGFzcyAhPT0gbnVsbCkge3Rocm93IG5ldyBUeXBlRXJyb3IoIlN1cGVyIGV4cHJlc3Npb24gbXVzdCBlaXRoZXIgYmUgbnVsbCBvciBhIGZ1bmN0aW9uIik7fXN1YkNsYXNzLnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoc3VwZXJDbGFzcyAmJiBzdXBlckNsYXNzLnByb3RvdHlwZSwgeyBjb25zdHJ1Y3RvcjogeyB2YWx1ZTogc3ViQ2xhc3MsIHdyaXRhYmxlOiB0cnVlLCBjb25maWd1cmFibGU6IHRydWUgfSB9KTtPYmplY3QuZGVmaW5lUHJvcGVydHkoc3ViQ2xhc3MsICJwcm90b3R5cGUiLCB7IHdyaXRhYmxlOiBmYWxzZSB9KTtpZiAoc3VwZXJDbGFzcykgX3NldFByb3RvdHlwZU9mKHN1YkNsYXNzLCBzdXBlckNsYXNzKTt9ZnVuY3Rpb24gX2NyZWF0ZVN1cGVyKERlcml2ZWQpIHt2YXIgaGFzTmF0aXZlUmVmbGVjdENvbnN0cnVjdCA9IF9pc05hdGl2ZVJlZmxlY3RDb25zdHJ1Y3QoKTtyZXR1cm4gZnVuY3Rpb24gX2NyZWF0ZVN1cGVySW50ZXJuYWwoKSB7dmFyIFN1cGVyID0gX2dldFByb3RvdHlwZU9mKERlcml2ZWQpLHJlc3VsdDtpZiAoaGFzTmF0aXZlUmVmbGVjdENvbnN0cnVjdCkge3ZhciBOZXdUYXJnZXQgPSBfZ2V0UHJvdG90eXBlT2YodGhpcykuY29uc3RydWN0b3I7cmVzdWx0ID0gUmVmbGVjdC5jb25zdHJ1Y3QoU3VwZXIsIGFyZ3VtZW50cywgTmV3VGFyZ2V0KTt9IGVsc2Uge3Jlc3VsdCA9IFN1cGVyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7fXJldHVybiBfcG9zc2libGVDb25zdHJ1Y3RvclJldHVybih0aGlzLCByZXN1bHQpO307fWZ1bmN0aW9uIF9wb3NzaWJsZUNvbnN0cnVjdG9yUmV0dXJuKHNlbGYsIGNhbGwpIHtpZiAoY2FsbCAmJiAodHlwZW9mIGNhbGwgPT09ICJvYmplY3QiIHx8IHR5cGVvZiBjYWxsID09PSAiZnVuY3Rpb24iKSkge3JldHVybiBjYWxsO30gZWxzZSBpZiAoY2FsbCAhPT0gdm9pZCAwKSB7dGhyb3cgbmV3IFR5cGVFcnJvcigiRGVyaXZlZCBjb25zdHJ1Y3RvcnMgbWF5IG9ubHkgcmV0dXJuIG9iamVjdCBvciB1bmRlZmluZWQiKTt9cmV0dXJuIF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoc2VsZik7fWZ1bmN0aW9uIF9hc3NlcnRUaGlzSW5pdGlhbGl6ZWQoc2VsZikge2lmIChzZWxmID09PSB2b2lkIDApIHt0aHJvdyBuZXcgUmVmZXJlbmNlRXJyb3IoInRoaXMgaGFzbid0IGJlZW4gaW5pdGlhbGlzZWQgLSBzdXBlcigpIGhhc24ndCBiZWVuIGNhbGxlZCIpO31yZXR1cm4gc2VsZjt9ZnVuY3Rpb24gX3dyYXBOYXRpdmVTdXBlcihDbGFzcykge3ZhciBfY2FjaGUgPSB0eXBlb2YgTWFwID09PSAiZnVuY3Rpb24iID8gbmV3IE1hcCgpIDogdW5kZWZpbmVkO193cmFwTmF0aXZlU3VwZXIgPSBmdW5jdGlvbiBfd3JhcE5hdGl2ZVN1cGVyKENsYXNzKSB7aWYgKENsYXNzID09PSBudWxsIHx8ICFfaXNOYXRpdmVGdW5jdGlvbihDbGFzcykpIHJldHVybiBDbGFzcztpZiAodHlwZW9mIENsYXNzICE9PSAiZnVuY3Rpb24iKSB7dGhyb3cgbmV3IFR5cGVFcnJvcigiU3VwZXIgZXhwcmVzc2lvbiBtdXN0IGVpdGhlciBiZSBudWxsIG9yIGEgZnVuY3Rpb24iKTt9aWYgKHR5cGVvZiBfY2FjaGUgIT09ICJ1bmRlZmluZWQiKSB7aWYgKF9jYWNoZS5oYXMoQ2xhc3MpKSByZXR1cm4gX2NhY2hlLmdldChDbGFzcyk7X2NhY2hlLnNldChDbGFzcywgV3JhcHBlcik7fWZ1bmN0aW9uIFdyYXBwZXIoKSB7cmV0dXJuIF9jb25zdHJ1Y3QoQ2xhc3MsIGFyZ3VtZW50cywgX2dldFByb3RvdHlwZU9mKHRoaXMpLmNvbnN0cnVjdG9yKTt9V3JhcHBlci5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKENsYXNzLnByb3RvdHlwZSwgeyBjb25zdHJ1Y3RvcjogeyB2YWx1ZTogV3JhcHBlciwgZW51bWVyYWJsZTogZmFsc2UsIHdyaXRhYmxlOiB0cnVlLCBjb25maWd1cmFibGU6IHRydWUgfSB9KTtyZXR1cm4gX3NldFByb3RvdHlwZU9mKFdyYXBwZXIsIENsYXNzKTt9O3JldHVybiBfd3JhcE5hdGl2ZVN1cGVyKENsYXNzKTt9ZnVuY3Rpb24gX2NvbnN0cnVjdChQYXJlbnQsIGFyZ3MsIENsYXNzKSB7aWYgKF9pc05hdGl2ZVJlZmxlY3RDb25zdHJ1Y3QoKSkge19jb25zdHJ1Y3QgPSBSZWZsZWN0LmNvbnN0cnVjdC5iaW5kKCk7fSBlbHNlIHtfY29uc3RydWN0ID0gZnVuY3Rpb24gX2NvbnN0cnVjdChQYXJlbnQsIGFyZ3MsIENsYXNzKSB7dmFyIGEgPSBbbnVsbF07YS5wdXNoLmFwcGx5KGEsIGFyZ3MpO3ZhciBDb25zdHJ1Y3RvciA9IEZ1bmN0aW9uLmJpbmQuYXBwbHkoUGFyZW50LCBhKTt2YXIgaW5zdGFuY2UgPSBuZXcgQ29uc3RydWN0b3IoKTtpZiAoQ2xhc3MpIF9zZXRQcm90b3R5cGVPZihpbnN0YW5jZSwgQ2xhc3MucHJvdG90eXBlKTtyZXR1cm4gaW5zdGFuY2U7fTt9cmV0dXJuIF9jb25zdHJ1Y3QuYXBwbHkobnVsbCwgYXJndW1lbnRzKTt9ZnVuY3Rpb24gX2lzTmF0aXZlUmVmbGVjdENvbnN0cnVjdCgpIHtpZiAodHlwZW9mIFJlZmxlY3QgPT09ICJ1bmRlZmluZWQiIHx8ICFSZWZsZWN0LmNvbnN0cnVjdCkgcmV0dXJuIGZhbHNlO2lmIChSZWZsZWN0LmNvbnN0cnVjdC5zaGFtKSByZXR1cm4gZmFsc2U7aWYgKHR5cGVvZiBQcm94eSA9PT0gImZ1bmN0aW9uIikgcmV0dXJuIHRydWU7dHJ5IHtCb29sZWFuLnByb3RvdHlwZS52YWx1ZU9mLmNhbGwoUmVmbGVjdC5jb25zdHJ1Y3QoQm9vbGVhbiwgW10sIGZ1bmN0aW9uICgpIHt9KSk7cmV0dXJuIHRydWU7fSBjYXRjaCAoZSkge3JldHVybiBmYWxzZTt9fWZ1bmN0aW9uIF9pc05hdGl2ZUZ1bmN0aW9uKGZuKSB7cmV0dXJuIEZ1bmN0aW9uLnRvU3RyaW5nLmNhbGwoZm4pLmluZGV4T2YoIltuYXRpdmUgY29kZV0iKSAhPT0gLTE7fWZ1bmN0aW9uIF9zZXRQcm90b3R5cGVPZihvLCBwKSB7X3NldFByb3RvdHlwZU9mID0gT2JqZWN0LnNldFByb3RvdHlwZU9mID8gT2JqZWN0LnNldFByb3RvdHlwZU9mLmJpbmQoKSA6IGZ1bmN0aW9uIF9zZXRQcm90b3R5cGVPZihvLCBwKSB7by5fX3Byb3RvX18gPSBwO3JldHVybiBvO307cmV0dXJuIF9zZXRQcm90b3R5cGVPZihvLCBwKTt9ZnVuY3Rpb24gX2dldFByb3RvdHlwZU9mKG8pIHtfZ2V0UHJvdG90eXBlT2YgPSBPYmplY3Quc2V0UHJvdG90eXBlT2YgPyBPYmplY3QuZ2V0UHJvdG90eXBlT2YuYmluZCgpIDogZnVuY3Rpb24gX2dldFByb3RvdHlwZU9mKG8pIHtyZXR1cm4gby5fX3Byb3RvX18gfHwgT2JqZWN0LmdldFByb3RvdHlwZU9mKG8pO307cmV0dXJuIF9nZXRQcm90b3R5cGVPZihvKTt9ZnVuY3Rpb24gX3NsaWNlZFRvQXJyYXkyKGFyciwgaSkge3JldHVybiBfYXJyYXlXaXRoSG9sZXMyKGFycikgfHwgX2l0ZXJhYmxlVG9BcnJheUxpbWl0MihhcnIsIGkpIHx8IF91bnN1cHBvcnRlZEl0ZXJhYmxlVG9BcnJheTIoYXJyLCBpKSB8fCBfbm9uSXRlcmFibGVSZXN0MigpO31mdW5jdGlvbiBfbm9uSXRlcmFibGVSZXN0MigpIHt0aHJvdyBuZXcgVHlwZUVycm9yKCJJbnZhbGlkIGF0dGVtcHQgdG8gZGVzdHJ1Y3R1cmUgbm9uLWl0ZXJhYmxlIGluc3RhbmNlLlxuSW4gb3JkZXIgdG8gYmUgaXRlcmFibGUsIG5vbi1hcnJheSBvYmplY3RzIG11c3QgaGF2ZSBhIFtTeW1ib2wuaXRlcmF0b3JdKCkgbWV0aG9kLiIpO31mdW5jdGlvbiBfaXRlcmFibGVUb0FycmF5TGltaXQyKGFyciwgaSkge3ZhciBfaSA9IG51bGwgPT0gYXJyID8gbnVsbCA6ICJ1bmRlZmluZWQiICE9IHR5cGVvZiBTeW1ib2wgJiYgYXJyW1N5bWJvbC5pdGVyYXRvcl0gfHwgYXJyWyJAQGl0ZXJhdG9yIl07aWYgKG51bGwgIT0gX2kpIHt2YXIgX3MsX2UsX3gsX3IsX2FyciA9IFtdLF9uID0gITAsX2QgPSAhMTt0cnkge2lmIChfeCA9IChfaSA9IF9pLmNhbGwoYXJyKSkubmV4dCwgMCA9PT0gaSkge2lmIChPYmplY3QoX2kpICE9PSBfaSkgcmV0dXJuO19uID0gITE7fSBlbHNlIGZvciAoOyAhKF9uID0gKF9zID0gX3guY2FsbChfaSkpLmRvbmUpICYmIChfYXJyLnB1c2goX3MudmFsdWUpLCBfYXJyLmxlbmd0aCAhPT0gaSk7IF9uID0gITApIHs7fX0gY2F0Y2ggKGVycikge19kID0gITAsIF9lID0gZXJyO30gZmluYWxseSB7dHJ5IHtpZiAoIV9uICYmIG51bGwgIT0gX2kucmV0dXJuICYmIChfciA9IF9pLnJldHVybigpLCBPYmplY3QoX3IpICE9PSBfcikpIHJldHVybjt9IGZpbmFsbHkge2lmIChfZCkgdGhyb3cgX2U7fX1yZXR1cm4gX2Fycjt9fWZ1bmN0aW9uIF9hcnJheVdpdGhIb2xlczIoYXJyKSB7aWYgKEFycmF5LmlzQXJyYXkoYXJyKSkgcmV0dXJuIGFycjt9ZnVuY3Rpb24gX3RvQ29uc3VtYWJsZUFycmF5MihhcnIpIHtyZXR1cm4gX2FycmF5V2l0aG91dEhvbGVzMihhcnIpIHx8IF9pdGVyYWJsZVRvQXJyYXkyKGFycikgfHwgX3Vuc3VwcG9ydGVkSXRlcmFibGVUb0FycmF5MihhcnIpIHx8IF9ub25JdGVyYWJsZVNwcmVhZDIoKTt9ZnVuY3Rpb24gX25vbkl0ZXJhYmxlU3ByZWFkMigpIHt0aHJvdyBuZXcgVHlwZUVycm9yKCJJbnZhbGlkIGF0dGVtcHQgdG8gc3ByZWFkIG5vbi1pdGVyYWJsZSBpbnN0YW5jZS5cbkluIG9yZGVyIHRvIGJlIGl0ZXJhYmxlLCBub24tYXJyYXkgb2JqZWN0cyBtdXN0IGhhdmUgYSBbU3ltYm9sLml0ZXJhdG9yXSgpIG1ldGhvZC4iKTt9ZnVuY3Rpb24gX3Vuc3VwcG9ydGVkSXRlcmFibGVUb0FycmF5MihvLCBtaW5MZW4pIHtpZiAoIW8pIHJldHVybjtpZiAodHlwZW9mIG8gPT09ICJzdHJpbmciKSByZXR1cm4gX2FycmF5TGlrZVRvQXJyYXkyKG8sIG1pbkxlbik7dmFyIG4gPSBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwobykuc2xpY2UoOCwgLTEpO2lmIChuID09PSAiT2JqZWN0IiAmJiBvLmNvbnN0cnVjdG9yKSBuID0gby5jb25zdHJ1Y3Rvci5uYW1lO2lmIChuID09PSAiTWFwIiB8fCBuID09PSAiU2V0IikgcmV0dXJuIEFycmF5LmZyb20obyk7aWYgKG4gPT09ICJBcmd1bWVudHMiIHx8IC9eKD86VWl8SSludCg/Ojh8MTZ8MzIpKD86Q2xhbXBlZCk/QXJyYXkkLy50ZXN0KG4pKSByZXR1cm4gX2FycmF5TGlrZVRvQXJyYXkyKG8sIG1pbkxlbik7fWZ1bmN0aW9uIF9pdGVyYWJsZVRvQXJyYXkyKGl0ZXIpIHtpZiAodHlwZW9mIFN5bWJvbCAhPT0gInVuZGVmaW5lZCIgJiYgaXRlcltTeW1ib2wuaXRlcmF0b3JdICE9IG51bGwgfHwgaXRlclsiQEBpdGVyYXRvciJdICE9IG51bGwpIHJldHVybiBBcnJheS5mcm9tKGl0ZXIpO31mdW5jdGlvbiBfYXJyYXlXaXRob3V0SG9sZXMyKGFycikge2lmIChBcnJheS5pc0FycmF5KGFycikpIHJldHVybiBfYXJyYXlMaWtlVG9BcnJheTIoYXJyKTt9ZnVuY3Rpb24gX2FycmF5TGlrZVRvQXJyYXkyKGFyciwgbGVuKSB7aWYgKGxlbiA9PSBudWxsIHx8IGxlbiA+IGFyci5sZW5ndGgpIGxlbiA9IGFyci5sZW5ndGg7Zm9yICh2YXIgaSA9IDAsIGFycjIgPSBuZXcgQXJyYXkobGVuKTsgaSA8IGxlbjsgaSsrKSB7YXJyMltpXSA9IGFycltpXTt9cmV0dXJuIGFycjI7fShmdW5jdGlvbiB3ZWJwYWNrVW5pdmVyc2FsTW9kdWxlRGVmaW5pdGlvbihyb290LCBmYWN0b3J5KSB7aWYgKHR5cGVvZiBleHBvcnRzID09PSAnb2JqZWN0JyAmJiB0eXBlb2YgbW9kdWxlID09PSAnb2JqZWN0JykKICBtb2R1bGUuZXhwb3J0cyA9IGZhY3RvcnkoKTtlbHNlCiAgaWYgKHR5cGVvZiBkZWZpbmUgPT09ICdmdW5jdGlvbicgJiYgZGVmaW5lLmFtZCkKICBkZWZpbmUoW10sIGZhY3RvcnkpO2Vsc2UKICB7CiAgICB2YXIgYSA9IGZhY3RvcnkoKTsKICAgIGZvciAodmFyIGkgaW4gYSkgeyh0eXBlb2YgZXhwb3J0cyA9PT0gJ29iamVjdCcgPyBleHBvcnRzIDogcm9vdClbaV0gPSBhW2ldO30KICB9Cn0pKHNlbGYsICgpID0+IHsKICByZXR1cm4gKC8qKioqKiovKCgpID0+IHsvLyB3ZWJwYWNrQm9vdHN0cmFwCiAgICAgIC8qKioqKiovInVzZSBzdHJpY3QiOwogICAgICAvKioqKioqL3ZhciBfX3dlYnBhY2tfbW9kdWxlc19fID0gewoKICAgICAgICAvKioqLzI0MjoKICAgICAgICAvKioqLyhfX3VudXNlZF93ZWJwYWNrX21vZHVsZSwgX193ZWJwYWNrX2V4cG9ydHNfXywgX193ZWJwYWNrX3JlcXVpcmVfXykgPT4gewoKCiAgICAgICAgICAvLyBFWFBPUlRTCiAgICAgICAgICBfX3dlYnBhY2tfcmVxdWlyZV9fLmQoX193ZWJwYWNrX2V4cG9ydHNfXywgewogICAgICAgICAgICAiWiI6ICgpID0+IC8qIGJpbmRpbmcgKi9yZWxheV9BcHAKICAgICAgICAgIH0pOwoKICAgICAgICAgIDsgLy8gQ09OQ0FURU5BVEVEIE1PRFVMRTogLi9ub2RlX21vZHVsZXMvQHJlbWl4LXJ1bi9yb3V0ZXIvZGlzdC9yb3V0ZXIuanMKICAgICAgICAgIC8qKgogICAgICAgICAgICogQHJlbWl4LXJ1bi9yb3V0ZXIgdjEuMC40CiAgICAgICAgICAgKgogICAgICAgICAgICogQ29weXJpZ2h0IChjKSBSZW1peCBTb2Z0d2FyZSBJbmMuCiAgICAgICAgICAgKgogICAgICAgICAgICogVGhpcyBzb3VyY2UgY29kZSBpcyBsaWNlbnNlZCB1bmRlciB0aGUgTUlUIGxpY2Vuc2UgZm91bmQgaW4gdGhlCiAgICAgICAgICAgKiBMSUNFTlNFLm1kIGZpbGUgaW4gdGhlIHJvb3QgZGlyZWN0b3J5IG9mIHRoaXMgc291cmNlIHRyZWUuCiAgICAgICAgICAgKgogICAgICAgICAgICogQGxpY2Vuc2UgTUlUCiAgICAgICAgICAgKi8KICAgICAgICAgIGZ1bmN0aW9uIF9leHRlbmRzKCkgewogICAgICAgICAgICBfZXh0ZW5kcyA9IE9iamVjdC5hc3NpZ24gPyBPYmplY3QuYXNzaWduLmJpbmQoKSA6IGZ1bmN0aW9uICh0YXJnZXQpIHsKICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMTsgaSA8IGFyZ3VtZW50cy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAgdmFyIHNvdXJjZSA9IGFyZ3VtZW50c1tpXTsKCiAgICAgICAgICAgICAgICBmb3IgKHZhciBrZXkgaW4gc291cmNlKSB7CiAgICAgICAgICAgICAgICAgIGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoc291cmNlLCBrZXkpKSB7CiAgICAgICAgICAgICAgICAgICAgdGFyZ2V0W2tleV0gPSBzb3VyY2Vba2V5XTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgcmV0dXJuIHRhcmdldDsKICAgICAgICAgICAgfTsKICAgICAgICAgICAgcmV0dXJuIF9leHRlbmRzLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgICAgICB9CgogICAgICAgICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KICAgICAgICAgIC8vI3JlZ2lvbiBUeXBlcyBhbmQgQ29uc3RhbnRzCiAgICAgICAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwoKICAgICAgICAgIC8qKgogICAgICAgICAgICogQWN0aW9ucyByZXByZXNlbnQgdGhlIHR5cGUgb2YgY2hhbmdlIHRvIGEgbG9jYXRpb24gdmFsdWUuCiAgICAgICAgICAgKi8KICAgICAgICAgIHZhciBBY3Rpb247CgogICAgICAgICAgKGZ1bmN0aW9uIChBY3Rpb24pIHsKICAgICAgICAgICAgLyoqCiAgICAgICAgICAgICAqIEEgUE9QIGluZGljYXRlcyBhIGNoYW5nZSB0byBhbiBhcmJpdHJhcnkgaW5kZXggaW4gdGhlIGhpc3Rvcnkgc3RhY2ssIHN1Y2gKICAgICAgICAgICAgICogYXMgYSBiYWNrIG9yIGZvcndhcmQgbmF2aWdhdGlvbi4gSXQgZG9lcyBub3QgZGVzY3JpYmUgdGhlIGRpcmVjdGlvbiBvZiB0aGUKICAgICAgICAgICAgICogbmF2aWdhdGlvbiwgb25seSB0aGF0IHRoZSBjdXJyZW50IGluZGV4IGNoYW5nZWQuCiAgICAgICAgICAgICAqCiAgICAgICAgICAgICAqIE5vdGU6IFRoaXMgaXMgdGhlIGRlZmF1bHQgYWN0aW9uIGZvciBuZXdseSBjcmVhdGVkIGhpc3Rvcnkgb2JqZWN0cy4KICAgICAgICAgICAgICovCiAgICAgICAgICAgIEFjdGlvblsiUG9wIl0gPSAiUE9QIjsKICAgICAgICAgICAgLyoqCiAgICAgICAgICAgICAqIEEgUFVTSCBpbmRpY2F0ZXMgYSBuZXcgZW50cnkgYmVpbmcgYWRkZWQgdG8gdGhlIGhpc3Rvcnkgc3RhY2ssIHN1Y2ggYXMgd2hlbgogICAgICAgICAgICAgKiBhIGxpbmsgaXMgY2xpY2tlZCBhbmQgYSBuZXcgcGFnZSBsb2Fkcy4gV2hlbiB0aGlzIGhhcHBlbnMsIGFsbCBzdWJzZXF1ZW50CiAgICAgICAgICAgICAqIGVudHJpZXMgaW4gdGhlIHN0YWNrIGFyZSBsb3N0LgogICAgICAgICAgICAgKi8KCiAgICAgICAgICAgIEFjdGlvblsiUHVzaCJdID0gIlBVU0giOwogICAgICAgICAgICAvKioKICAgICAgICAgICAgICogQSBSRVBMQUNFIGluZGljYXRlcyB0aGUgZW50cnkgYXQgdGhlIGN1cnJlbnQgaW5kZXggaW4gdGhlIGhpc3Rvcnkgc3RhY2sKICAgICAgICAgICAgICogYmVpbmcgcmVwbGFjZWQgYnkgYSBuZXcgb25lLgogICAgICAgICAgICAgKi8KCiAgICAgICAgICAgIEFjdGlvblsiUmVwbGFjZSJdID0gIlJFUExBQ0UiOwogICAgICAgICAgfSkoQWN0aW9uIHx8IChBY3Rpb24gPSB7fSkpOwoKICAgICAgICAgIHZhciBQb3BTdGF0ZUV2ZW50VHlwZSA9ICJwb3BzdGF0ZSI7CiAgICAgICAgICAvKioKICAgICAgICAgICAqIE1lbW9yeSBoaXN0b3J5IHN0b3JlcyB0aGUgY3VycmVudCBsb2NhdGlvbiBpbiBtZW1vcnkuIEl0IGlzIGRlc2lnbmVkIGZvciB1c2UKICAgICAgICAgICAqIGluIHN0YXRlZnVsIG5vbi1icm93c2VyIGVudmlyb25tZW50cyBsaWtlIHRlc3RzIGFuZCBSZWFjdCBOYXRpdmUuCiAgICAgICAgICAgKi8KCiAgICAgICAgICBmdW5jdGlvbiByb3V0ZXJfY3JlYXRlTWVtb3J5SGlzdG9yeShvcHRpb25zKSB7CiAgICAgICAgICAgIGlmIChvcHRpb25zID09PSB2b2lkIDApIHsKICAgICAgICAgICAgICBvcHRpb25zID0ge307CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHZhciBfb3B0aW9ucyA9CgoKCiAgICAgICAgICAgICAgb3B0aW9ucyxfb3B0aW9ucyRpbml0aWFsRW50cmkgPSBfb3B0aW9ucy5pbml0aWFsRW50cmllcyxpbml0aWFsRW50cmllcyA9IF9vcHRpb25zJGluaXRpYWxFbnRyaSA9PT0gdm9pZCAwID8gWyIvIl0gOiBfb3B0aW9ucyRpbml0aWFsRW50cmksaW5pdGlhbEluZGV4ID0gX29wdGlvbnMuaW5pdGlhbEluZGV4LF9vcHRpb25zJHY1Q29tcGF0ID0gX29wdGlvbnMudjVDb21wYXQsdjVDb21wYXQgPSBfb3B0aW9ucyR2NUNvbXBhdCA9PT0gdm9pZCAwID8gZmFsc2UgOiBfb3B0aW9ucyR2NUNvbXBhdDsKICAgICAgICAgICAgdmFyIGVudHJpZXM7IC8vIERlY2xhcmUgc28gd2UgY2FuIGFjY2VzcyBmcm9tIGNyZWF0ZU1lbW9yeUxvY2F0aW9uCgogICAgICAgICAgICBlbnRyaWVzID0gaW5pdGlhbEVudHJpZXMubWFwKChlbnRyeSwgaW5kZXgpID0+IGNyZWF0ZU1lbW9yeUxvY2F0aW9uKGVudHJ5LCB0eXBlb2YgZW50cnkgPT09ICJzdHJpbmciID8gbnVsbCA6IGVudHJ5LnN0YXRlLCBpbmRleCA9PT0gMCA/ICJkZWZhdWx0IiA6IHVuZGVmaW5lZCkpOwogICAgICAgICAgICB2YXIgaW5kZXggPSBjbGFtcEluZGV4KGluaXRpYWxJbmRleCA9PSBudWxsID8gZW50cmllcy5sZW5ndGggLSAxIDogaW5pdGlhbEluZGV4KTsKICAgICAgICAgICAgdmFyIGFjdGlvbiA9IEFjdGlvbi5Qb3A7CiAgICAgICAgICAgIHZhciBsaXN0ZW5lciA9IG51bGw7CgogICAgICAgICAgICBmdW5jdGlvbiBjbGFtcEluZGV4KG4pIHsKICAgICAgICAgICAgICByZXR1cm4gTWF0aC5taW4oTWF0aC5tYXgobiwgMCksIGVudHJpZXMubGVuZ3RoIC0gMSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGZ1bmN0aW9uIGdldEN1cnJlbnRMb2NhdGlvbigpIHsKICAgICAgICAgICAgICByZXR1cm4gZW50cmllc1tpbmRleF07CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGZ1bmN0aW9uIGNyZWF0ZU1lbW9yeUxvY2F0aW9uKHRvLCBzdGF0ZSwga2V5KSB7CiAgICAgICAgICAgICAgaWYgKHN0YXRlID09PSB2b2lkIDApIHsKICAgICAgICAgICAgICAgIHN0YXRlID0gbnVsbDsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIHZhciBsb2NhdGlvbiA9IGNyZWF0ZUxvY2F0aW9uKGVudHJpZXMgPyBnZXRDdXJyZW50TG9jYXRpb24oKS5wYXRobmFtZSA6ICIvIiwgdG8sIHN0YXRlLCBrZXkpOwogICAgICAgICAgICAgIHdhcm5pbmckMShsb2NhdGlvbi5wYXRobmFtZS5jaGFyQXQoMCkgPT09ICIvIiwgInJlbGF0aXZlIHBhdGhuYW1lcyBhcmUgbm90IHN1cHBvcnRlZCBpbiBtZW1vcnkgaGlzdG9yeTogIiArIEpTT04uc3RyaW5naWZ5KHRvKSk7CiAgICAgICAgICAgICAgcmV0dXJuIGxvY2F0aW9uOwogICAgICAgICAgICB9CgogICAgICAgICAgICB2YXIgaGlzdG9yeSA9IHsKICAgICAgICAgICAgICBnZXQgaW5kZXgoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gaW5kZXg7CiAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgZ2V0IGFjdGlvbigpIHsKICAgICAgICAgICAgICAgIHJldHVybiBhY3Rpb247CiAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgZ2V0IGxvY2F0aW9uKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIGdldEN1cnJlbnRMb2NhdGlvbigpOwogICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgIGNyZWF0ZUhyZWY6IGZ1bmN0aW9uIGNyZWF0ZUhyZWYodG8pIHsKICAgICAgICAgICAgICAgIHJldHVybiB0eXBlb2YgdG8gPT09ICJzdHJpbmciID8gdG8gOiByb3V0ZXJfY3JlYXRlUGF0aCh0byk7CiAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgZW5jb2RlTG9jYXRpb246IGZ1bmN0aW9uIGVuY29kZUxvY2F0aW9uKHRvKSB7CiAgICAgICAgICAgICAgICB2YXIgcGF0aCA9IHR5cGVvZiB0byA9PT0gInN0cmluZyIgPyBwYXJzZVBhdGgodG8pIDogdG87CiAgICAgICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgICBwYXRobmFtZTogcGF0aC5wYXRobmFtZSB8fCAiIiwKICAgICAgICAgICAgICAgICAgc2VhcmNoOiBwYXRoLnNlYXJjaCB8fCAiIiwKICAgICAgICAgICAgICAgICAgaGFzaDogcGF0aC5oYXNoIHx8ICIiCiAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgIHB1c2g6IGZ1bmN0aW9uIHB1c2godG8sIHN0YXRlKSB7CiAgICAgICAgICAgICAgICBhY3Rpb24gPSBBY3Rpb24uUHVzaDsKICAgICAgICAgICAgICAgIHZhciBuZXh0TG9jYXRpb24gPSBjcmVhdGVNZW1vcnlMb2NhdGlvbih0bywgc3RhdGUpOwogICAgICAgICAgICAgICAgaW5kZXggKz0gMTsKICAgICAgICAgICAgICAgIGVudHJpZXMuc3BsaWNlKGluZGV4LCBlbnRyaWVzLmxlbmd0aCwgbmV4dExvY2F0aW9uKTsKCiAgICAgICAgICAgICAgICBpZiAodjVDb21wYXQgJiYgbGlzdGVuZXIpIHsKICAgICAgICAgICAgICAgICAgbGlzdGVuZXIoewogICAgICAgICAgICAgICAgICAgIGFjdGlvbjogYWN0aW9uLAogICAgICAgICAgICAgICAgICAgIGxvY2F0aW9uOiBuZXh0TG9jYXRpb24KICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgcmVwbGFjZTogZnVuY3Rpb24gcmVwbGFjZSh0bywgc3RhdGUpIHsKICAgICAgICAgICAgICAgIGFjdGlvbiA9IEFjdGlvbi5SZXBsYWNlOwogICAgICAgICAgICAgICAgdmFyIG5leHRMb2NhdGlvbiA9IGNyZWF0ZU1lbW9yeUxvY2F0aW9uKHRvLCBzdGF0ZSk7CiAgICAgICAgICAgICAgICBlbnRyaWVzW2luZGV4XSA9IG5leHRMb2NhdGlvbjsKCiAgICAgICAgICAgICAgICBpZiAodjVDb21wYXQgJiYgbGlzdGVuZXIpIHsKICAgICAgICAgICAgICAgICAgbGlzdGVuZXIoewogICAgICAgICAgICAgICAgICAgIGFjdGlvbjogYWN0aW9uLAogICAgICAgICAgICAgICAgICAgIGxvY2F0aW9uOiBuZXh0TG9jYXRpb24KICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgZ286IGZ1bmN0aW9uIGdvKGRlbHRhKSB7CiAgICAgICAgICAgICAgICBhY3Rpb24gPSBBY3Rpb24uUG9wOwogICAgICAgICAgICAgICAgaW5kZXggPSBjbGFtcEluZGV4KGluZGV4ICsgZGVsdGEpOwoKICAgICAgICAgICAgICAgIGlmIChsaXN0ZW5lcikgewogICAgICAgICAgICAgICAgICBsaXN0ZW5lcih7CiAgICAgICAgICAgICAgICAgICAgYWN0aW9uOiBhY3Rpb24sCiAgICAgICAgICAgICAgICAgICAgbG9jYXRpb246IGdldEN1cnJlbnRMb2NhdGlvbigpCiAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgIGxpc3RlbjogZnVuY3Rpb24gbGlzdGVuKGZuKSB7CiAgICAgICAgICAgICAgICBsaXN0ZW5lciA9IGZuOwogICAgICAgICAgICAgICAgcmV0dXJuICgpID0+IHsKICAgICAgICAgICAgICAgICAgbGlzdGVuZXIgPSBudWxsOwogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICB9OwogICAgICAgICAgICByZXR1cm4gaGlzdG9yeTsKICAgICAgICAgIH0KICAgICAgICAgIC8qKgogICAgICAgICAgICogQnJvd3NlciBoaXN0b3J5IHN0b3JlcyB0aGUgbG9jYXRpb24gaW4gcmVndWxhciBVUkxzLiBUaGlzIGlzIHRoZSBzdGFuZGFyZCBmb3IKICAgICAgICAgICAqIG1vc3Qgd2ViIGFwcHMsIGJ1dCBpdCByZXF1aXJlcyBzb21lIGNvbmZpZ3VyYXRpb24gb24gdGhlIHNlcnZlciB0byBlbnN1cmUgeW91CiAgICAgICAgICAgKiBzZXJ2ZSB0aGUgc2FtZSBhcHAgYXQgbXVsdGlwbGUgVVJMcy4KICAgICAgICAgICAqCiAgICAgICAgICAgKiBAc2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9yZW1peC1ydW4vaGlzdG9yeS90cmVlL21haW4vZG9jcy9hcGktcmVmZXJlbmNlLm1kI2NyZWF0ZWJyb3dzZXJoaXN0b3J5CiAgICAgICAgICAgKi8KCiAgICAgICAgICBmdW5jdGlvbiByb3V0ZXJfY3JlYXRlQnJvd3Nlckhpc3Rvcnkob3B0aW9ucykgewogICAgICAgICAgICBpZiAob3B0aW9ucyA9PT0gdm9pZCAwKSB7CiAgICAgICAgICAgICAgb3B0aW9ucyA9IHt9OwogICAgICAgICAgICB9CgogICAgICAgICAgICBmdW5jdGlvbiBjcmVhdGVCcm93c2VyTG9jYXRpb24od2luZG93LCBnbG9iYWxIaXN0b3J5KSB7CiAgICAgICAgICAgICAgdmFyIF93aW5kb3ckbG9jYXRpb24gPQoKCgogICAgICAgICAgICAgICAgd2luZG93LmxvY2F0aW9uLHBhdGhuYW1lID0gX3dpbmRvdyRsb2NhdGlvbi5wYXRobmFtZSxzZWFyY2ggPSBfd2luZG93JGxvY2F0aW9uLnNlYXJjaCxoYXNoID0gX3dpbmRvdyRsb2NhdGlvbi5oYXNoOwogICAgICAgICAgICAgIHJldHVybiBjcmVhdGVMb2NhdGlvbigiIiwgewogICAgICAgICAgICAgICAgcGF0aG5hbWU6IHBhdGhuYW1lLAogICAgICAgICAgICAgICAgc2VhcmNoOiBzZWFyY2gsCiAgICAgICAgICAgICAgICBoYXNoOiBoYXNoCiAgICAgICAgICAgICAgfSwgLy8gc3RhdGUgZGVmYXVsdHMgdG8gYG51bGxgIGJlY2F1c2UgYHdpbmRvdy5oaXN0b3J5LnN0YXRlYCBkb2VzCiAgICAgICAgICAgICAgZ2xvYmFsSGlzdG9yeS5zdGF0ZSAmJiBnbG9iYWxIaXN0b3J5LnN0YXRlLnVzciB8fCBudWxsLCBnbG9iYWxIaXN0b3J5LnN0YXRlICYmIGdsb2JhbEhpc3Rvcnkuc3RhdGUua2V5IHx8ICJkZWZhdWx0Iik7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGZ1bmN0aW9uIGNyZWF0ZUJyb3dzZXJIcmVmKHdpbmRvdywgdG8pIHsKICAgICAgICAgICAgICByZXR1cm4gdHlwZW9mIHRvID09PSAic3RyaW5nIiA/IHRvIDogcm91dGVyX2NyZWF0ZVBhdGgodG8pOwogICAgICAgICAgICB9CgogICAgICAgICAgICByZXR1cm4gZ2V0VXJsQmFzZWRIaXN0b3J5KGNyZWF0ZUJyb3dzZXJMb2NhdGlvbiwgY3JlYXRlQnJvd3NlckhyZWYsIG51bGwsIG9wdGlvbnMpOwogICAgICAgICAgfQogICAgICAgICAgLyoqCiAgICAgICAgICAgKiBIYXNoIGhpc3Rvcnkgc3RvcmVzIHRoZSBsb2NhdGlvbiBpbiB3aW5kb3cubG9jYXRpb24uaGFzaC4gVGhpcyBtYWtlcyBpdCBpZGVhbAogICAgICAgICAgICogZm9yIHNpdHVhdGlvbnMgd2hlcmUgeW91IGRvbid0IHdhbnQgdG8gc2VuZCB0aGUgbG9jYXRpb24gdG8gdGhlIHNlcnZlciBmb3IKICAgICAgICAgICAqIHNvbWUgcmVhc29uLCBlaXRoZXIgYmVjYXVzZSB5b3UgZG8gY2Fubm90IGNvbmZpZ3VyZSBpdCBvciB0aGUgVVJMIHNwYWNlIGlzCiAgICAgICAgICAgKiByZXNlcnZlZCBmb3Igc29tZXRoaW5nIGVsc2UuCiAgICAgICAgICAgKgogICAgICAgICAgICogQHNlZSBodHRwczovL2dpdGh1Yi5jb20vcmVtaXgtcnVuL2hpc3RvcnkvdHJlZS9tYWluL2RvY3MvYXBpLXJlZmVyZW5jZS5tZCNjcmVhdGVoYXNoaGlzdG9yeQogICAgICAgICAgICovCgogICAgICAgICAgZnVuY3Rpb24gcm91dGVyX2NyZWF0ZUhhc2hIaXN0b3J5KG9wdGlvbnMpIHsKICAgICAgICAgICAgaWYgKG9wdGlvbnMgPT09IHZvaWQgMCkgewogICAgICAgICAgICAgIG9wdGlvbnMgPSB7fTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgZnVuY3Rpb24gY3JlYXRlSGFzaExvY2F0aW9uKHdpbmRvdywgZ2xvYmFsSGlzdG9yeSkgewogICAgICAgICAgICAgIHZhciBfcGFyc2VQYXRoID0KCgoKICAgICAgICAgICAgICAgIHBhcnNlUGF0aCh3aW5kb3cubG9jYXRpb24uaGFzaC5zdWJzdHIoMSkpLF9wYXJzZVBhdGgkcGF0aG5hbWUgPSBfcGFyc2VQYXRoLnBhdGhuYW1lLHBhdGhuYW1lID0gX3BhcnNlUGF0aCRwYXRobmFtZSA9PT0gdm9pZCAwID8gIi8iIDogX3BhcnNlUGF0aCRwYXRobmFtZSxfcGFyc2VQYXRoJHNlYXJjaCA9IF9wYXJzZVBhdGguc2VhcmNoLHNlYXJjaCA9IF9wYXJzZVBhdGgkc2VhcmNoID09PSB2b2lkIDAgPyAiIiA6IF9wYXJzZVBhdGgkc2VhcmNoLF9wYXJzZVBhdGgkaGFzaCA9IF9wYXJzZVBhdGguaGFzaCxoYXNoID0gX3BhcnNlUGF0aCRoYXNoID09PSB2b2lkIDAgPyAiIiA6IF9wYXJzZVBhdGgkaGFzaDsKICAgICAgICAgICAgICByZXR1cm4gY3JlYXRlTG9jYXRpb24oIiIsIHsKICAgICAgICAgICAgICAgIHBhdGhuYW1lOiBwYXRobmFtZSwKICAgICAgICAgICAgICAgIHNlYXJjaDogc2VhcmNoLAogICAgICAgICAgICAgICAgaGFzaDogaGFzaAogICAgICAgICAgICAgIH0sIC8vIHN0YXRlIGRlZmF1bHRzIHRvIGBudWxsYCBiZWNhdXNlIGB3aW5kb3cuaGlzdG9yeS5zdGF0ZWAgZG9lcwogICAgICAgICAgICAgIGdsb2JhbEhpc3Rvcnkuc3RhdGUgJiYgZ2xvYmFsSGlzdG9yeS5zdGF0ZS51c3IgfHwgbnVsbCwgZ2xvYmFsSGlzdG9yeS5zdGF0ZSAmJiBnbG9iYWxIaXN0b3J5LnN0YXRlLmtleSB8fCAiZGVmYXVsdCIpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBmdW5jdGlvbiBjcmVhdGVIYXNoSHJlZih3aW5kb3csIHRvKSB7CiAgICAgICAgICAgICAgdmFyIGJhc2UgPSB3aW5kb3cuZG9jdW1lbnQucXVlcnlTZWxlY3RvcigiYmFzZSIpOwogICAgICAgICAgICAgIHZhciBocmVmID0gIiI7CgogICAgICAgICAgICAgIGlmIChiYXNlICYmIGJhc2UuZ2V0QXR0cmlidXRlKCJocmVmIikpIHsKICAgICAgICAgICAgICAgIHZhciB1cmwgPSB3aW5kb3cubG9jYXRpb24uaHJlZjsKICAgICAgICAgICAgICAgIHZhciBoYXNoSW5kZXggPSB1cmwuaW5kZXhPZigiIyIpOwogICAgICAgICAgICAgICAgaHJlZiA9IGhhc2hJbmRleCA9PT0gLTEgPyB1cmwgOiB1cmwuc2xpY2UoMCwgaGFzaEluZGV4KTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIHJldHVybiBocmVmICsgIiMiICsgKHR5cGVvZiB0byA9PT0gInN0cmluZyIgPyB0byA6IHJvdXRlcl9jcmVhdGVQYXRoKHRvKSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGZ1bmN0aW9uIHZhbGlkYXRlSGFzaExvY2F0aW9uKGxvY2F0aW9uLCB0bykgewogICAgICAgICAgICAgIHdhcm5pbmckMShsb2NhdGlvbi5wYXRobmFtZS5jaGFyQXQoMCkgPT09ICIvIiwgInJlbGF0aXZlIHBhdGhuYW1lcyBhcmUgbm90IHN1cHBvcnRlZCBpbiBoYXNoIGhpc3RvcnkucHVzaCgiICsgSlNPTi5zdHJpbmdpZnkodG8pICsgIikiKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuIGdldFVybEJhc2VkSGlzdG9yeShjcmVhdGVIYXNoTG9jYXRpb24sIGNyZWF0ZUhhc2hIcmVmLCB2YWxpZGF0ZUhhc2hMb2NhdGlvbiwgb3B0aW9ucyk7CiAgICAgICAgICB9IC8vI2VuZHJlZ2lvbgogICAgICAgICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KICAgICAgICAgIC8vI3JlZ2lvbiBVVElMUwogICAgICAgICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KCiAgICAgICAgICBmdW5jdGlvbiB3YXJuaW5nJDEoY29uZCwgbWVzc2FnZSkgewogICAgICAgICAgICBpZiAoIWNvbmQpIHsKICAgICAgICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tY29uc29sZQogICAgICAgICAgICAgIGlmICh0eXBlb2YgY29uc29sZSAhPT0gInVuZGVmaW5lZCIpIGNvbnNvbGUud2FybihtZXNzYWdlKTsKCiAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIC8vIFdlbGNvbWUgdG8gZGVidWdnaW5nIGhpc3RvcnkhCiAgICAgICAgICAgICAgICAvLwogICAgICAgICAgICAgICAgLy8gVGhpcyBlcnJvciBpcyB0aHJvd24gYXMgYSBjb252ZW5pZW5jZSBzbyB5b3UgY2FuIG1vcmUgZWFzaWx5CiAgICAgICAgICAgICAgICAvLyBmaW5kIHRoZSBzb3VyY2UgZm9yIGEgd2FybmluZyB0aGF0IGFwcGVhcnMgaW4gdGhlIGNvbnNvbGUgYnkKICAgICAgICAgICAgICAgIC8vIGVuYWJsaW5nICJwYXVzZSBvbiBleGNlcHRpb25zIiBpbiB5b3VyIEphdmFTY3JpcHQgZGVidWdnZXIuCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IobWVzc2FnZSk7IC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBuby1lbXB0eQogICAgICAgICAgICAgIH0gY2F0Y2ggKGUpIHt9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KCiAgICAgICAgICBmdW5jdGlvbiBjcmVhdGVLZXkoKSB7CiAgICAgICAgICAgIHJldHVybiBNYXRoLnJhbmRvbSgpLnRvU3RyaW5nKDM2KS5zdWJzdHIoMiwgOCk7CiAgICAgICAgICB9CiAgICAgICAgICAvKioKICAgICAgICAgICAqIEZvciBicm93c2VyLWJhc2VkIGhpc3Rvcmllcywgd2UgY29tYmluZSB0aGUgc3RhdGUgYW5kIGtleSBpbnRvIGFuIG9iamVjdAogICAgICAgICAgICovCgoKICAgICAgICAgIGZ1bmN0aW9uIGdldEhpc3RvcnlTdGF0ZShsb2NhdGlvbikgewogICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgIHVzcjogbG9jYXRpb24uc3RhdGUsCiAgICAgICAgICAgICAga2V5OiBsb2NhdGlvbi5rZXkKICAgICAgICAgICAgfTsKICAgICAgICAgIH0KICAgICAgICAgIC8qKgogICAgICAgICAgICogQ3JlYXRlcyBhIExvY2F0aW9uIG9iamVjdCB3aXRoIGEgdW5pcXVlIGtleSBmcm9tIHRoZSBnaXZlbiBQYXRoCiAgICAgICAgICAgKi8KCgogICAgICAgICAgZnVuY3Rpb24gY3JlYXRlTG9jYXRpb24oY3VycmVudCwgdG8sIHN0YXRlLCBrZXkpIHsKICAgICAgICAgICAgaWYgKHN0YXRlID09PSB2b2lkIDApIHsKICAgICAgICAgICAgICBzdGF0ZSA9IG51bGw7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHZhciBsb2NhdGlvbiA9IF9leHRlbmRzKHsKICAgICAgICAgICAgICBwYXRobmFtZTogdHlwZW9mIGN1cnJlbnQgPT09ICJzdHJpbmciID8gY3VycmVudCA6IGN1cnJlbnQucGF0aG5hbWUsCiAgICAgICAgICAgICAgc2VhcmNoOiAiIiwKICAgICAgICAgICAgICBoYXNoOiAiIgogICAgICAgICAgICB9LCB0eXBlb2YgdG8gPT09ICJzdHJpbmciID8gcGFyc2VQYXRoKHRvKSA6IHRvLCB7CiAgICAgICAgICAgICAgc3RhdGU6IHN0YXRlLAogICAgICAgICAgICAgIC8vIFRPRE86IFRoaXMgY291bGQgYmUgY2xlYW5lZCB1cC4gIHB1c2gvcmVwbGFjZSBzaG91bGQgcHJvYmFibHkganVzdCB0YWtlCiAgICAgICAgICAgICAgLy8gZnVsbCBMb2NhdGlvbnMgbm93IGFuZCBhdm9pZCB0aGUgbmVlZCB0byBydW4gdGhyb3VnaCB0aGlzIGZsb3cgYXQgYWxsCiAgICAgICAgICAgICAgLy8gQnV0IHRoYXQncyBhIHByZXR0eSBiaWcgcmVmYWN0b3IgdG8gdGhlIGN1cnJlbnQgdGVzdCBzdWl0ZSBzbyBnb2luZyB0bwogICAgICAgICAgICAgIC8vIGtlZXAgYXMgaXMgZm9yIHRoZSB0aW1lIGJlaW5nIGFuZCBqdXN0IGxldCBhbnkgaW5jb21pbmcga2V5cyB0YWtlIHByZWNlZGVuY2UKICAgICAgICAgICAgICBrZXk6IHRvICYmIHRvLmtleSB8fCBrZXkgfHwgY3JlYXRlS2V5KCkKICAgICAgICAgICAgfSk7CgogICAgICAgICAgICByZXR1cm4gbG9jYXRpb247CiAgICAgICAgICB9CiAgICAgICAgICAvKioKICAgICAgICAgICAqIENyZWF0ZXMgYSBzdHJpbmcgVVJMIHBhdGggZnJvbSB0aGUgZ2l2ZW4gcGF0aG5hbWUsIHNlYXJjaCwgYW5kIGhhc2ggY29tcG9uZW50cy4KICAgICAgICAgICAqLwoKICAgICAgICAgIGZ1bmN0aW9uIHJvdXRlcl9jcmVhdGVQYXRoKF9yZWYpIHsKICAgICAgICAgICAgdmFyIF9yZWYkcGF0aG5hbWUgPQoKCgogICAgICAgICAgICAgIF9yZWYucGF0aG5hbWUscGF0aG5hbWUgPSBfcmVmJHBhdGhuYW1lID09PSB2b2lkIDAgPyAiLyIgOiBfcmVmJHBhdGhuYW1lLF9yZWYkc2VhcmNoID0gX3JlZi5zZWFyY2gsc2VhcmNoID0gX3JlZiRzZWFyY2ggPT09IHZvaWQgMCA/ICIiIDogX3JlZiRzZWFyY2gsX3JlZiRoYXNoID0gX3JlZi5oYXNoLGhhc2ggPSBfcmVmJGhhc2ggPT09IHZvaWQgMCA/ICIiIDogX3JlZiRoYXNoOwogICAgICAgICAgICBpZiAoc2VhcmNoICYmIHNlYXJjaCAhPT0gIj8iKSBwYXRobmFtZSArPSBzZWFyY2guY2hhckF0KDApID09PSAiPyIgPyBzZWFyY2ggOiAiPyIgKyBzZWFyY2g7CiAgICAgICAgICAgIGlmIChoYXNoICYmIGhhc2ggIT09ICIjIikgcGF0aG5hbWUgKz0gaGFzaC5jaGFyQXQoMCkgPT09ICIjIiA/IGhhc2ggOiAiIyIgKyBoYXNoOwogICAgICAgICAgICByZXR1cm4gcGF0aG5hbWU7CiAgICAgICAgICB9CiAgICAgICAgICAvKioKICAgICAgICAgICAqIFBhcnNlcyBhIHN0cmluZyBVUkwgcGF0aCBpbnRvIGl0cyBzZXBhcmF0ZSBwYXRobmFtZSwgc2VhcmNoLCBhbmQgaGFzaCBjb21wb25lbnRzLgogICAgICAgICAgICovCgogICAgICAgICAgZnVuY3Rpb24gcGFyc2VQYXRoKHBhdGgpIHsKICAgICAgICAgICAgdmFyIHBhcnNlZFBhdGggPSB7fTsKCiAgICAgICAgICAgIGlmIChwYXRoKSB7CiAgICAgICAgICAgICAgdmFyIGhhc2hJbmRleCA9IHBhdGguaW5kZXhPZigiIyIpOwoKICAgICAgICAgICAgICBpZiAoaGFzaEluZGV4ID49IDApIHsKICAgICAgICAgICAgICAgIHBhcnNlZFBhdGguaGFzaCA9IHBhdGguc3Vic3RyKGhhc2hJbmRleCk7CiAgICAgICAgICAgICAgICBwYXRoID0gcGF0aC5zdWJzdHIoMCwgaGFzaEluZGV4KTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIHZhciBzZWFyY2hJbmRleCA9IHBhdGguaW5kZXhPZigiPyIpOwoKICAgICAgICAgICAgICBpZiAoc2VhcmNoSW5kZXggPj0gMCkgewogICAgICAgICAgICAgICAgcGFyc2VkUGF0aC5zZWFyY2ggPSBwYXRoLnN1YnN0cihzZWFyY2hJbmRleCk7CiAgICAgICAgICAgICAgICBwYXRoID0gcGF0aC5zdWJzdHIoMCwgc2VhcmNoSW5kZXgpOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgaWYgKHBhdGgpIHsKICAgICAgICAgICAgICAgIHBhcnNlZFBhdGgucGF0aG5hbWUgPSBwYXRoOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuIHBhcnNlZFBhdGg7CiAgICAgICAgICB9CiAgICAgICAgICBmdW5jdGlvbiBjcmVhdGVVUkwobG9jYXRpb24pIHsKICAgICAgICAgICAgLy8gd2luZG93LmxvY2F0aW9uLm9yaWdpbiBpcyAibnVsbCIgKHRoZSBsaXRlcmFsIHN0cmluZyB2YWx1ZSkgaW4gRmlyZWZveAogICAgICAgICAgICAvLyB1bmRlciBjZXJ0YWluIGNvbmRpdGlvbnMsIG5vdGFibHkgd2hlbiBzZXJ2aW5nIGZyb20gYSBsb2NhbCBIVE1MIGZpbGUKICAgICAgICAgICAgLy8gU2VlIGh0dHBzOi8vYnVnemlsbGEubW96aWxsYS5vcmcvc2hvd19idWcuY2dpP2lkPTg3ODI5NwogICAgICAgICAgICB2YXIgYmFzZSA9IHR5cGVvZiB3aW5kb3cgIT09ICJ1bmRlZmluZWQiICYmIHR5cGVvZiB3aW5kb3cubG9jYXRpb24gIT09ICJ1bmRlZmluZWQiICYmIHdpbmRvdy5sb2NhdGlvbi5vcmlnaW4gIT09ICJudWxsIiA/IHdpbmRvdy5sb2NhdGlvbi5vcmlnaW4gOiAidW5rbm93bjovL3Vua25vd24iOwogICAgICAgICAgICB2YXIgaHJlZiA9IHR5cGVvZiBsb2NhdGlvbiA9PT0gInN0cmluZyIgPyBsb2NhdGlvbiA6IHJvdXRlcl9jcmVhdGVQYXRoKGxvY2F0aW9uKTsKICAgICAgICAgICAgcmV0dXJuIG5ldyBVUkwoaHJlZiwgYmFzZSk7CiAgICAgICAgICB9CgogICAgICAgICAgZnVuY3Rpb24gZ2V0VXJsQmFzZWRIaXN0b3J5KGdldExvY2F0aW9uLCBfY3JlYXRlSHJlZiwgdmFsaWRhdGVMb2NhdGlvbiwgb3B0aW9ucykgewogICAgICAgICAgICBpZiAob3B0aW9ucyA9PT0gdm9pZCAwKSB7CiAgICAgICAgICAgICAgb3B0aW9ucyA9IHt9OwogICAgICAgICAgICB9CgogICAgICAgICAgICB2YXIgX29wdGlvbnMyID0KCgogICAgICAgICAgICAgIG9wdGlvbnMsX29wdGlvbnMyJHdpbmRvdyA9IF9vcHRpb25zMi53aW5kb3csd2luZG93ID0gX29wdGlvbnMyJHdpbmRvdyA9PT0gdm9pZCAwID8gZG9jdW1lbnQuZGVmYXVsdFZpZXcgOiBfb3B0aW9uczIkd2luZG93LF9vcHRpb25zMiR2NUNvbXBhdCA9IF9vcHRpb25zMi52NUNvbXBhdCx2NUNvbXBhdCA9IF9vcHRpb25zMiR2NUNvbXBhdCA9PT0gdm9pZCAwID8gZmFsc2UgOiBfb3B0aW9uczIkdjVDb21wYXQ7CiAgICAgICAgICAgIHZhciBnbG9iYWxIaXN0b3J5ID0gd2luZG93Lmhpc3Rvcnk7CiAgICAgICAgICAgIHZhciBhY3Rpb24gPSBBY3Rpb24uUG9wOwogICAgICAgICAgICB2YXIgbGlzdGVuZXIgPSBudWxsOwoKICAgICAgICAgICAgZnVuY3Rpb24gaGFuZGxlUG9wKCkgewogICAgICAgICAgICAgIGFjdGlvbiA9IEFjdGlvbi5Qb3A7CgogICAgICAgICAgICAgIGlmIChsaXN0ZW5lcikgewogICAgICAgICAgICAgICAgbGlzdGVuZXIoewogICAgICAgICAgICAgICAgICBhY3Rpb246IGFjdGlvbiwKICAgICAgICAgICAgICAgICAgbG9jYXRpb246IGhpc3RvcnkubG9jYXRpb24KICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgZnVuY3Rpb24gcHVzaCh0bywgc3RhdGUpIHsKICAgICAgICAgICAgICBhY3Rpb24gPSBBY3Rpb24uUHVzaDsKICAgICAgICAgICAgICB2YXIgbG9jYXRpb24gPSBjcmVhdGVMb2NhdGlvbihoaXN0b3J5LmxvY2F0aW9uLCB0bywgc3RhdGUpOwogICAgICAgICAgICAgIGlmICh2YWxpZGF0ZUxvY2F0aW9uKSB2YWxpZGF0ZUxvY2F0aW9uKGxvY2F0aW9uLCB0byk7CiAgICAgICAgICAgICAgdmFyIGhpc3RvcnlTdGF0ZSA9IGdldEhpc3RvcnlTdGF0ZShsb2NhdGlvbik7CiAgICAgICAgICAgICAgdmFyIHVybCA9IGhpc3RvcnkuY3JlYXRlSHJlZihsb2NhdGlvbik7IC8vIHRyeS4uLmNhdGNoIGJlY2F1c2UgaU9TIGxpbWl0cyB1cyB0byAxMDAgcHVzaFN0YXRlIGNhbGxzIDovCgogICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICBnbG9iYWxIaXN0b3J5LnB1c2hTdGF0ZShoaXN0b3J5U3RhdGUsICIiLCB1cmwpOwogICAgICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgICAgICAgICAvLyBUaGV5IGFyZSBnb2luZyB0byBsb3NlIHN0YXRlIGhlcmUsIGJ1dCB0aGVyZSBpcyBubyByZWFsCiAgICAgICAgICAgICAgICAvLyB3YXkgdG8gd2FybiB0aGVtIGFib3V0IGl0IHNpbmNlIHRoZSBwYWdlIHdpbGwgcmVmcmVzaC4uLgogICAgICAgICAgICAgICAgd2luZG93LmxvY2F0aW9uLmFzc2lnbih1cmwpOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgaWYgKHY1Q29tcGF0ICYmIGxpc3RlbmVyKSB7CiAgICAgICAgICAgICAgICBsaXN0ZW5lcih7CiAgICAgICAgICAgICAgICAgIGFjdGlvbjogYWN0aW9uLAogICAgICAgICAgICAgICAgICBsb2NhdGlvbjogaGlzdG9yeS5sb2NhdGlvbgogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICBmdW5jdGlvbiByZXBsYWNlKHRvLCBzdGF0ZSkgewogICAgICAgICAgICAgIGFjdGlvbiA9IEFjdGlvbi5SZXBsYWNlOwogICAgICAgICAgICAgIHZhciBsb2NhdGlvbiA9IGNyZWF0ZUxvY2F0aW9uKGhpc3RvcnkubG9jYXRpb24sIHRvLCBzdGF0ZSk7CiAgICAgICAgICAgICAgaWYgKHZhbGlkYXRlTG9jYXRpb24pIHZhbGlkYXRlTG9jYXRpb24obG9jYXRpb24sIHRvKTsKICAgICAgICAgICAgICB2YXIgaGlzdG9yeVN0YXRlID0gZ2V0SGlzdG9yeVN0YXRlKGxvY2F0aW9uKTsKICAgICAgICAgICAgICB2YXIgdXJsID0gaGlzdG9yeS5jcmVhdGVIcmVmKGxvY2F0aW9uKTsKICAgICAgICAgICAgICBnbG9iYWxIaXN0b3J5LnJlcGxhY2VTdGF0ZShoaXN0b3J5U3RhdGUsICIiLCB1cmwpOwoKICAgICAgICAgICAgICBpZiAodjVDb21wYXQgJiYgbGlzdGVuZXIpIHsKICAgICAgICAgICAgICAgIGxpc3RlbmVyKHsKICAgICAgICAgICAgICAgICAgYWN0aW9uOiBhY3Rpb24sCiAgICAgICAgICAgICAgICAgIGxvY2F0aW9uOiBoaXN0b3J5LmxvY2F0aW9uCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHZhciBoaXN0b3J5ID0gewogICAgICAgICAgICAgIGdldCBhY3Rpb24oKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gYWN0aW9uOwogICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgIGdldCBsb2NhdGlvbigpIHsKICAgICAgICAgICAgICAgIHJldHVybiBnZXRMb2NhdGlvbih3aW5kb3csIGdsb2JhbEhpc3RvcnkpOwogICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgIGxpc3RlbjogZnVuY3Rpb24gbGlzdGVuKGZuKSB7CiAgICAgICAgICAgICAgICBpZiAobGlzdGVuZXIpIHsKICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJBIGhpc3Rvcnkgb25seSBhY2NlcHRzIG9uZSBhY3RpdmUgbGlzdGVuZXIiKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcihQb3BTdGF0ZUV2ZW50VHlwZSwgaGFuZGxlUG9wKTsKICAgICAgICAgICAgICAgIGxpc3RlbmVyID0gZm47CiAgICAgICAgICAgICAgICByZXR1cm4gKCkgPT4gewogICAgICAgICAgICAgICAgICB3aW5kb3cucmVtb3ZlRXZlbnRMaXN0ZW5lcihQb3BTdGF0ZUV2ZW50VHlwZSwgaGFuZGxlUG9wKTsKICAgICAgICAgICAgICAgICAgbGlzdGVuZXIgPSBudWxsOwogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICBjcmVhdGVIcmVmOiBmdW5jdGlvbiBjcmVhdGVIcmVmKHRvKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gX2NyZWF0ZUhyZWYod2luZG93LCB0byk7CiAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgZW5jb2RlTG9jYXRpb246IGZ1bmN0aW9uIGVuY29kZUxvY2F0aW9uKHRvKSB7CiAgICAgICAgICAgICAgICAvLyBFbmNvZGUgYSBMb2NhdGlvbiB0aGUgc2FtZSB3YXkgd2luZG93LmxvY2F0aW9uIHdvdWxkCiAgICAgICAgICAgICAgICB2YXIgdXJsID0gY3JlYXRlVVJMKHR5cGVvZiB0byA9PT0gInN0cmluZyIgPyB0byA6IHJvdXRlcl9jcmVhdGVQYXRoKHRvKSk7CiAgICAgICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgICBwYXRobmFtZTogdXJsLnBhdGhuYW1lLAogICAgICAgICAgICAgICAgICBzZWFyY2g6IHVybC5zZWFyY2gsCiAgICAgICAgICAgICAgICAgIGhhc2g6IHVybC5oYXNoCiAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgIHB1c2g6IHB1c2gsCiAgICAgICAgICAgICAgcmVwbGFjZTogcmVwbGFjZSwKCiAgICAgICAgICAgICAgZ286IGZ1bmN0aW9uIGdvKG4pIHsKICAgICAgICAgICAgICAgIHJldHVybiBnbG9iYWxIaXN0b3J5LmdvKG4pOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgIH07CiAgICAgICAgICAgIHJldHVybiBoaXN0b3J5OwogICAgICAgICAgfSAvLyNlbmRyZWdpb24KCiAgICAgICAgICB2YXIgUmVzdWx0VHlwZTsKCiAgICAgICAgICAoZnVuY3Rpb24gKFJlc3VsdFR5cGUpIHsKICAgICAgICAgICAgUmVzdWx0VHlwZVsiZGF0YSJdID0gImRhdGEiOwogICAgICAgICAgICBSZXN1bHRUeXBlWyJkZWZlcnJlZCJdID0gImRlZmVycmVkIjsKICAgICAgICAgICAgUmVzdWx0VHlwZVsicmVkaXJlY3QiXSA9ICJyZWRpcmVjdCI7CiAgICAgICAgICAgIFJlc3VsdFR5cGVbImVycm9yIl0gPSAiZXJyb3IiOwogICAgICAgICAgfSkoUmVzdWx0VHlwZSB8fCAoUmVzdWx0VHlwZSA9IHt9KSk7CgogICAgICAgICAgZnVuY3Rpb24gaXNJbmRleFJvdXRlKHJvdXRlKSB7CiAgICAgICAgICAgIHJldHVybiByb3V0ZS5pbmRleCA9PT0gdHJ1ZTsKICAgICAgICAgIH0gLy8gV2FsayB0aGUgcm91dGUgdHJlZSBnZW5lcmF0aW5nIHVuaXF1ZSBJRHMgd2hlcmUgbmVjZXNzYXJ5IHNvIHdlIGFyZSB3b3JraW5nCiAgICAgICAgICAvLyBzb2xlbHkgd2l0aCBBZ25vc3RpY0RhdGFSb3V0ZU9iamVjdCdzIHdpdGhpbiB0aGUgUm91dGVyCgoKICAgICAgICAgIGZ1bmN0aW9uIGNvbnZlcnRSb3V0ZXNUb0RhdGFSb3V0ZXMocm91dGVzLCBwYXJlbnRQYXRoLCBhbGxJZHMpIHsKICAgICAgICAgICAgaWYgKHBhcmVudFBhdGggPT09IHZvaWQgMCkgewogICAgICAgICAgICAgIHBhcmVudFBhdGggPSBbXTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKGFsbElkcyA9PT0gdm9pZCAwKSB7CiAgICAgICAgICAgICAgYWxsSWRzID0gbmV3IFNldCgpOwogICAgICAgICAgICB9CgogICAgICAgICAgICByZXR1cm4gcm91dGVzLm1hcCgocm91dGUsIGluZGV4KSA9PiB7CiAgICAgICAgICAgICAgdmFyIHRyZWVQYXRoID0gW10uY29uY2F0KF90b0NvbnN1bWFibGVBcnJheTIocGFyZW50UGF0aCksIFtpbmRleF0pOwogICAgICAgICAgICAgIHZhciBpZCA9IHR5cGVvZiByb3V0ZS5pZCA9PT0gInN0cmluZyIgPyByb3V0ZS5pZCA6IHRyZWVQYXRoLmpvaW4oIi0iKTsKICAgICAgICAgICAgICByb3V0ZXJfaW52YXJpYW50KHJvdXRlLmluZGV4ICE9PSB0cnVlIHx8ICFyb3V0ZS5jaGlsZHJlbiwgIkNhbm5vdCBzcGVjaWZ5IGNoaWxkcmVuIG9uIGFuIGluZGV4IHJvdXRlIik7CiAgICAgICAgICAgICAgcm91dGVyX2ludmFyaWFudCghYWxsSWRzLmhhcyhpZCksICJGb3VuZCBhIHJvdXRlIGlkIGNvbGxpc2lvbiBvbiBpZCBcIiIgKyBpZCArICJcIi4gIFJvdXRlICIgKyAiaWQncyBtdXN0IGJlIGdsb2JhbGx5IHVuaXF1ZSB3aXRoaW4gRGF0YSBSb3V0ZXIgdXNhZ2VzIik7CiAgICAgICAgICAgICAgYWxsSWRzLmFkZChpZCk7CgogICAgICAgICAgICAgIGlmIChpc0luZGV4Um91dGUocm91dGUpKSB7CiAgICAgICAgICAgICAgICB2YXIgaW5kZXhSb3V0ZSA9IF9leHRlbmRzKHt9LCByb3V0ZSwgewogICAgICAgICAgICAgICAgICBpZDogaWQKICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICAgIHJldHVybiBpbmRleFJvdXRlOwogICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICB2YXIgcGF0aE9yTGF5b3V0Um91dGUgPSBfZXh0ZW5kcyh7fSwgcm91dGUsIHsKICAgICAgICAgICAgICAgICAgaWQ6IGlkLAogICAgICAgICAgICAgICAgICBjaGlsZHJlbjogcm91dGUuY2hpbGRyZW4gPyBjb252ZXJ0Um91dGVzVG9EYXRhUm91dGVzKHJvdXRlLmNoaWxkcmVuLCB0cmVlUGF0aCwgYWxsSWRzKSA6IHVuZGVmaW5lZAogICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgICAgcmV0dXJuIHBhdGhPckxheW91dFJvdXRlOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgICB9CiAgICAgICAgICAvKioKICAgICAgICAgICAqIE1hdGNoZXMgdGhlIGdpdmVuIHJvdXRlcyB0byBhIGxvY2F0aW9uIGFuZCByZXR1cm5zIHRoZSBtYXRjaCBkYXRhLgogICAgICAgICAgICoKICAgICAgICAgICAqIEBzZWUgaHR0cHM6Ly9yZWFjdHJvdXRlci5jb20vZG9jcy9lbi92Ni91dGlscy9tYXRjaC1yb3V0ZXMKICAgICAgICAgICAqLwoKICAgICAgICAgIGZ1bmN0aW9uIG1hdGNoUm91dGVzKHJvdXRlcywgbG9jYXRpb25BcmcsIGJhc2VuYW1lKSB7CiAgICAgICAgICAgIGlmIChiYXNlbmFtZSA9PT0gdm9pZCAwKSB7CiAgICAgICAgICAgICAgYmFzZW5hbWUgPSAiLyI7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHZhciBsb2NhdGlvbiA9IHR5cGVvZiBsb2NhdGlvbkFyZyA9PT0gInN0cmluZyIgPyBwYXJzZVBhdGgobG9jYXRpb25BcmcpIDogbG9jYXRpb25Bcmc7CiAgICAgICAgICAgIHZhciBwYXRobmFtZSA9IHN0cmlwQmFzZW5hbWUobG9jYXRpb24ucGF0aG5hbWUgfHwgIi8iLCBiYXNlbmFtZSk7CgogICAgICAgICAgICBpZiAocGF0aG5hbWUgPT0gbnVsbCkgewogICAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgICAgICB9CgogICAgICAgICAgICB2YXIgYnJhbmNoZXMgPSBmbGF0dGVuUm91dGVzKHJvdXRlcyk7CiAgICAgICAgICAgIHJhbmtSb3V0ZUJyYW5jaGVzKGJyYW5jaGVzKTsKICAgICAgICAgICAgdmFyIG1hdGNoZXMgPSBudWxsOwoKICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IG1hdGNoZXMgPT0gbnVsbCAmJiBpIDwgYnJhbmNoZXMubGVuZ3RoOyArK2kpIHsKICAgICAgICAgICAgICBtYXRjaGVzID0gbWF0Y2hSb3V0ZUJyYW5jaChicmFuY2hlc1tpXSwgLy8gSW5jb21pbmcgcGF0aG5hbWVzIGFyZSBnZW5lcmFsbHkgZW5jb2RlZCBmcm9tIGVpdGhlciB3aW5kb3cubG9jYXRpb24KICAgICAgICAgICAgICAvLyBvciBmcm9tIHJvdXRlci5uYXZpZ2F0ZSwgYnV0IHdlIHdhbnQgdG8gbWF0Y2ggYWdhaW5zdCB0aGUgdW5lbmNvZGVkCiAgICAgICAgICAgICAgLy8gcGF0aHMgaW4gdGhlIHJvdXRlIGRlZmluaXRpb25zLiAgTWVtb3J5IHJvdXRlciBsb2NhdGlvbnMgd29uJ3QgYmUKICAgICAgICAgICAgICAvLyBlbmNvZGVkIGhlcmUgYnV0IHRoZXJlIGFsc28gc2hvdWxkbid0IGJlIGFueXRoaW5nIHRvIGRlY29kZSBzbyB0aGlzCiAgICAgICAgICAgICAgLy8gc2hvdWxkIGJlIGEgc2FmZSBvcGVyYXRpb24uICBUaGlzIGF2b2lkcyBuZWVkaW5nIG1hdGNoUm91dGVzIHRvIGJlCiAgICAgICAgICAgICAgLy8gaGlzdG9yeS1hd2FyZS4KICAgICAgICAgICAgICBzYWZlbHlEZWNvZGVVUkkocGF0aG5hbWUpKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuIG1hdGNoZXM7CiAgICAgICAgICB9CgogICAgICAgICAgZnVuY3Rpb24gZmxhdHRlblJvdXRlcyhyb3V0ZXMsIGJyYW5jaGVzLCBwYXJlbnRzTWV0YSwgcGFyZW50UGF0aCkgewogICAgICAgICAgICBpZiAoYnJhbmNoZXMgPT09IHZvaWQgMCkgewogICAgICAgICAgICAgIGJyYW5jaGVzID0gW107CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChwYXJlbnRzTWV0YSA9PT0gdm9pZCAwKSB7CiAgICAgICAgICAgICAgcGFyZW50c01ldGEgPSBbXTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKHBhcmVudFBhdGggPT09IHZvaWQgMCkgewogICAgICAgICAgICAgIHBhcmVudFBhdGggPSAiIjsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcm91dGVzLmZvckVhY2goKHJvdXRlLCBpbmRleCkgPT4gewogICAgICAgICAgICAgIHZhciBtZXRhID0gewogICAgICAgICAgICAgICAgcmVsYXRpdmVQYXRoOiByb3V0ZS5wYXRoIHx8ICIiLAogICAgICAgICAgICAgICAgY2FzZVNlbnNpdGl2ZTogcm91dGUuY2FzZVNlbnNpdGl2ZSA9PT0gdHJ1ZSwKICAgICAgICAgICAgICAgIGNoaWxkcmVuSW5kZXg6IGluZGV4LAogICAgICAgICAgICAgICAgcm91dGU6IHJvdXRlCiAgICAgICAgICAgICAgfTsKCiAgICAgICAgICAgICAgaWYgKG1ldGEucmVsYXRpdmVQYXRoLnN0YXJ0c1dpdGgoIi8iKSkgewogICAgICAgICAgICAgICAgcm91dGVyX2ludmFyaWFudChtZXRhLnJlbGF0aXZlUGF0aC5zdGFydHNXaXRoKHBhcmVudFBhdGgpLCAiQWJzb2x1dGUgcm91dGUgcGF0aCBcIiIgKyBtZXRhLnJlbGF0aXZlUGF0aCArICJcIiBuZXN0ZWQgdW5kZXIgcGF0aCAiICsgKCJcIiIgKyBwYXJlbnRQYXRoICsgIlwiIGlzIG5vdCB2YWxpZC4gQW4gYWJzb2x1dGUgY2hpbGQgcm91dGUgcGF0aCAiKSArICJtdXN0IHN0YXJ0IHdpdGggdGhlIGNvbWJpbmVkIHBhdGggb2YgYWxsIGl0cyBwYXJlbnQgcm91dGVzLiIpOwogICAgICAgICAgICAgICAgbWV0YS5yZWxhdGl2ZVBhdGggPSBtZXRhLnJlbGF0aXZlUGF0aC5zbGljZShwYXJlbnRQYXRoLmxlbmd0aCk7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICB2YXIgcGF0aCA9IHJvdXRlcl9qb2luUGF0aHMoW3BhcmVudFBhdGgsIG1ldGEucmVsYXRpdmVQYXRoXSk7CiAgICAgICAgICAgICAgdmFyIHJvdXRlc01ldGEgPSBwYXJlbnRzTWV0YS5jb25jYXQobWV0YSk7IC8vIEFkZCB0aGUgY2hpbGRyZW4gYmVmb3JlIGFkZGluZyB0aGlzIHJvdXRlIHRvIHRoZSBhcnJheSBzbyB3ZSB0cmF2ZXJzZSB0aGUKICAgICAgICAgICAgICAvLyByb3V0ZSB0cmVlIGRlcHRoLWZpcnN0IGFuZCBjaGlsZCByb3V0ZXMgYXBwZWFyIGJlZm9yZSB0aGVpciBwYXJlbnRzIGluCiAgICAgICAgICAgICAgLy8gdGhlICJmbGF0dGVuZWQiIHZlcnNpb24uCgogICAgICAgICAgICAgIGlmIChyb3V0ZS5jaGlsZHJlbiAmJiByb3V0ZS5jaGlsZHJlbi5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgICAgICByb3V0ZXJfaW52YXJpYW50KCAvLyBPdXIgdHlwZXMga25vdyBiZXR0ZXIsIGJ1dCBydW50aW1lIEpTIG1heSBub3QhCiAgICAgICAgICAgICAgICAvLyBAdHMtZXhwZWN0LWVycm9yCiAgICAgICAgICAgICAgICByb3V0ZS5pbmRleCAhPT0gdHJ1ZSwgIkluZGV4IHJvdXRlcyBtdXN0IG5vdCBoYXZlIGNoaWxkIHJvdXRlcy4gUGxlYXNlIHJlbW92ZSAiICsgKCJhbGwgY2hpbGQgcm91dGVzIGZyb20gcm91dGUgcGF0aCBcIiIgKyBwYXRoICsgIlwiLiIpKTsKICAgICAgICAgICAgICAgIGZsYXR0ZW5Sb3V0ZXMocm91dGUuY2hpbGRyZW4sIGJyYW5jaGVzLCByb3V0ZXNNZXRhLCBwYXRoKTsKICAgICAgICAgICAgICB9IC8vIFJvdXRlcyB3aXRob3V0IGEgcGF0aCBzaG91bGRuJ3QgZXZlciBtYXRjaCBieSB0aGVtc2VsdmVzIHVubGVzcyB0aGV5IGFyZQogICAgICAgICAgICAgIC8vIGluZGV4IHJvdXRlcywgc28gZG9uJ3QgYWRkIHRoZW0gdG8gdGhlIGxpc3Qgb2YgcG9zc2libGUgYnJhbmNoZXMuCgoKICAgICAgICAgICAgICBpZiAocm91dGUucGF0aCA9PSBudWxsICYmICFyb3V0ZS5pbmRleCkgewogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgYnJhbmNoZXMucHVzaCh7CiAgICAgICAgICAgICAgICBwYXRoOiBwYXRoLAogICAgICAgICAgICAgICAgc2NvcmU6IGNvbXB1dGVTY29yZShwYXRoLCByb3V0ZS5pbmRleCksCiAgICAgICAgICAgICAgICByb3V0ZXNNZXRhOiByb3V0ZXNNZXRhCiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICByZXR1cm4gYnJhbmNoZXM7CiAgICAgICAgICB9CgogICAgICAgICAgZnVuY3Rpb24gcmFua1JvdXRlQnJhbmNoZXMoYnJhbmNoZXMpIHsKICAgICAgICAgICAgYnJhbmNoZXMuc29ydCgoYSwgYikgPT4gYS5zY29yZSAhPT0gYi5zY29yZSA/IGIuc2NvcmUgLSBhLnNjb3JlIC8vIEhpZ2hlciBzY29yZSBmaXJzdAogICAgICAgICAgICA6IGNvbXBhcmVJbmRleGVzKGEucm91dGVzTWV0YS5tYXAoKG1ldGEpID0+IG1ldGEuY2hpbGRyZW5JbmRleCksIGIucm91dGVzTWV0YS5tYXAoKG1ldGEpID0+IG1ldGEuY2hpbGRyZW5JbmRleCkpKTsKICAgICAgICAgIH0KCiAgICAgICAgICB2YXIgcGFyYW1SZSA9IC9eOlx3KyQvOwogICAgICAgICAgdmFyIGR5bmFtaWNTZWdtZW50VmFsdWUgPSAzOwogICAgICAgICAgdmFyIGluZGV4Um91dGVWYWx1ZSA9IDI7CiAgICAgICAgICB2YXIgZW1wdHlTZWdtZW50VmFsdWUgPSAxOwogICAgICAgICAgdmFyIHN0YXRpY1NlZ21lbnRWYWx1ZSA9IDEwOwogICAgICAgICAgdmFyIHNwbGF0UGVuYWx0eSA9IC0yOwoKICAgICAgICAgIHZhciBpc1NwbGF0ID0gKHMpID0+IHMgPT09ICIqIjsKCiAgICAgICAgICBmdW5jdGlvbiBjb21wdXRlU2NvcmUocGF0aCwgaW5kZXgpIHsKICAgICAgICAgICAgdmFyIHNlZ21lbnRzID0gcGF0aC5zcGxpdCgiLyIpOwogICAgICAgICAgICB2YXIgaW5pdGlhbFNjb3JlID0gc2VnbWVudHMubGVuZ3RoOwoKICAgICAgICAgICAgaWYgKHNlZ21lbnRzLnNvbWUoaXNTcGxhdCkpIHsKICAgICAgICAgICAgICBpbml0aWFsU2NvcmUgKz0gc3BsYXRQZW5hbHR5OwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoaW5kZXgpIHsKICAgICAgICAgICAgICBpbml0aWFsU2NvcmUgKz0gaW5kZXhSb3V0ZVZhbHVlOwogICAgICAgICAgICB9CgogICAgICAgICAgICByZXR1cm4gc2VnbWVudHMuZmlsdGVyKChzKSA9PiAhaXNTcGxhdChzKSkucmVkdWNlKChzY29yZSwgc2VnbWVudCkgPT4gc2NvcmUgKyAocGFyYW1SZS50ZXN0KHNlZ21lbnQpID8gZHluYW1pY1NlZ21lbnRWYWx1ZSA6IHNlZ21lbnQgPT09ICIiID8gZW1wdHlTZWdtZW50VmFsdWUgOiBzdGF0aWNTZWdtZW50VmFsdWUpLCBpbml0aWFsU2NvcmUpOwogICAgICAgICAgfQoKICAgICAgICAgIGZ1bmN0aW9uIGNvbXBhcmVJbmRleGVzKGEsIGIpIHsKICAgICAgICAgICAgdmFyIHNpYmxpbmdzID0gYS5sZW5ndGggPT09IGIubGVuZ3RoICYmIGEuc2xpY2UoMCwgLTEpLmV2ZXJ5KChuLCBpKSA9PiBuID09PSBiW2ldKTsKICAgICAgICAgICAgcmV0dXJuIHNpYmxpbmdzID8gLy8gSWYgdHdvIHJvdXRlcyBhcmUgc2libGluZ3MsIHdlIHNob3VsZCB0cnkgdG8gbWF0Y2ggdGhlIGVhcmxpZXIgc2libGluZwogICAgICAgICAgICAvLyBmaXJzdC4gVGhpcyBhbGxvd3MgcGVvcGxlIHRvIGhhdmUgZmluZS1ncmFpbmVkIGNvbnRyb2wgb3ZlciB0aGUgbWF0Y2hpbmcKICAgICAgICAgICAgLy8gYmVoYXZpb3IgYnkgc2ltcGx5IHB1dHRpbmcgcm91dGVzIHdpdGggaWRlbnRpY2FsIHBhdGhzIGluIHRoZSBvcmRlciB0aGV5CiAgICAgICAgICAgIC8vIHdhbnQgdGhlbSB0cmllZC4KICAgICAgICAgICAgYVthLmxlbmd0aCAtIDFdIC0gYltiLmxlbmd0aCAtIDFdIDogLy8gT3RoZXJ3aXNlLCBpdCBkb2Vzbid0IHJlYWxseSBtYWtlIHNlbnNlIHRvIHJhbmsgbm9uLXNpYmxpbmdzIGJ5IGluZGV4LAogICAgICAgICAgICAvLyBzbyB0aGV5IHNvcnQgZXF1YWxseS4KICAgICAgICAgICAgMDsKICAgICAgICAgIH0KCiAgICAgICAgICBmdW5jdGlvbiBtYXRjaFJvdXRlQnJhbmNoKGJyYW5jaCwgcGF0aG5hbWUpIHsKICAgICAgICAgICAgdmFyCiAgICAgICAgICAgIHJvdXRlc01ldGEgPQogICAgICAgICAgICBicmFuY2gucm91dGVzTWV0YTsKICAgICAgICAgICAgdmFyIG1hdGNoZWRQYXJhbXMgPSB7fTsKICAgICAgICAgICAgdmFyIG1hdGNoZWRQYXRobmFtZSA9ICIvIjsKICAgICAgICAgICAgdmFyIG1hdGNoZXMgPSBbXTsKCiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgcm91dGVzTWV0YS5sZW5ndGg7ICsraSkgewogICAgICAgICAgICAgIHZhciBtZXRhID0gcm91dGVzTWV0YVtpXTsKICAgICAgICAgICAgICB2YXIgZW5kID0gaSA9PT0gcm91dGVzTWV0YS5sZW5ndGggLSAxOwogICAgICAgICAgICAgIHZhciByZW1haW5pbmdQYXRobmFtZSA9IG1hdGNoZWRQYXRobmFtZSA9PT0gIi8iID8gcGF0aG5hbWUgOiBwYXRobmFtZS5zbGljZShtYXRjaGVkUGF0aG5hbWUubGVuZ3RoKSB8fCAiLyI7CiAgICAgICAgICAgICAgdmFyIG1hdGNoID0gcm91dGVyX21hdGNoUGF0aCh7CiAgICAgICAgICAgICAgICBwYXRoOiBtZXRhLnJlbGF0aXZlUGF0aCwKICAgICAgICAgICAgICAgIGNhc2VTZW5zaXRpdmU6IG1ldGEuY2FzZVNlbnNpdGl2ZSwKICAgICAgICAgICAgICAgIGVuZDogZW5kCiAgICAgICAgICAgICAgfSwgcmVtYWluaW5nUGF0aG5hbWUpOwogICAgICAgICAgICAgIGlmICghbWF0Y2gpIHJldHVybiBudWxsOwogICAgICAgICAgICAgIE9iamVjdC5hc3NpZ24obWF0Y2hlZFBhcmFtcywgbWF0Y2gucGFyYW1zKTsKICAgICAgICAgICAgICB2YXIgcm91dGUgPSBtZXRhLnJvdXRlOwogICAgICAgICAgICAgIG1hdGNoZXMucHVzaCh7CiAgICAgICAgICAgICAgICAvLyBUT0RPOiBDYW4gdGhpcyBhcyBiZSBhdm9pZGVkPwogICAgICAgICAgICAgICAgcGFyYW1zOiBtYXRjaGVkUGFyYW1zLAogICAgICAgICAgICAgICAgcGF0aG5hbWU6IHJvdXRlcl9qb2luUGF0aHMoW21hdGNoZWRQYXRobmFtZSwgbWF0Y2gucGF0aG5hbWVdKSwKICAgICAgICAgICAgICAgIHBhdGhuYW1lQmFzZTogbm9ybWFsaXplUGF0aG5hbWUocm91dGVyX2pvaW5QYXRocyhbbWF0Y2hlZFBhdGhuYW1lLCBtYXRjaC5wYXRobmFtZUJhc2VdKSksCiAgICAgICAgICAgICAgICByb3V0ZTogcm91dGUKICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgaWYgKG1hdGNoLnBhdGhuYW1lQmFzZSAhPT0gIi8iKSB7CiAgICAgICAgICAgICAgICBtYXRjaGVkUGF0aG5hbWUgPSByb3V0ZXJfam9pblBhdGhzKFttYXRjaGVkUGF0aG5hbWUsIG1hdGNoLnBhdGhuYW1lQmFzZV0pOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuIG1hdGNoZXM7CiAgICAgICAgICB9CiAgICAgICAgICAvKioKICAgICAgICAgICAqIFJldHVybnMgYSBwYXRoIHdpdGggcGFyYW1zIGludGVycG9sYXRlZC4KICAgICAgICAgICAqCiAgICAgICAgICAgKiBAc2VlIGh0dHBzOi8vcmVhY3Ryb3V0ZXIuY29tL2RvY3MvZW4vdjYvdXRpbHMvZ2VuZXJhdGUtcGF0aAogICAgICAgICAgICovCgoKICAgICAgICAgIGZ1bmN0aW9uIGdlbmVyYXRlUGF0aChwYXRoLCBwYXJhbXMpIHsKICAgICAgICAgICAgaWYgKHBhcmFtcyA9PT0gdm9pZCAwKSB7CiAgICAgICAgICAgICAgcGFyYW1zID0ge307CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybiBwYXRoLnJlcGxhY2UoLzooXHcrKS9nLCAoXywga2V5KSA9PiB7CiAgICAgICAgICAgICAgcm91dGVyX2ludmFyaWFudChwYXJhbXNba2V5XSAhPSBudWxsLCAiTWlzc2luZyBcIjoiICsga2V5ICsgIlwiIHBhcmFtIik7CiAgICAgICAgICAgICAgcmV0dXJuIHBhcmFtc1trZXldOwogICAgICAgICAgICB9KS5yZXBsYWNlKC8oXC8/KVwqLywgKF8sIHByZWZpeCwgX18sIHN0cikgPT4gewogICAgICAgICAgICAgIHZhciBzdGFyID0gIioiOwoKICAgICAgICAgICAgICBpZiAocGFyYW1zW3N0YXJdID09IG51bGwpIHsKICAgICAgICAgICAgICAgIC8vIElmIG5vIHNwbGF0IHdhcyBwcm92aWRlZCwgdHJpbSB0aGUgdHJhaWxpbmcgc2xhc2ggX3VubGVzc18gaXQncwogICAgICAgICAgICAgICAgLy8gdGhlIGVudGlyZSBwYXRoCiAgICAgICAgICAgICAgICByZXR1cm4gc3RyID09PSAiLyoiID8gIi8iIDogIiI7CiAgICAgICAgICAgICAgfSAvLyBBcHBseSB0aGUgc3BsYXQKCgogICAgICAgICAgICAgIHJldHVybiAiIiArIHByZWZpeCArIHBhcmFtc1tzdGFyXTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9CiAgICAgICAgICAvKioKICAgICAgICAgICAqIFBlcmZvcm1zIHBhdHRlcm4gbWF0Y2hpbmcgb24gYSBVUkwgcGF0aG5hbWUgYW5kIHJldHVybnMgaW5mb3JtYXRpb24gYWJvdXQKICAgICAgICAgICAqIHRoZSBtYXRjaC4KICAgICAgICAgICAqCiAgICAgICAgICAgKiBAc2VlIGh0dHBzOi8vcmVhY3Ryb3V0ZXIuY29tL2RvY3MvZW4vdjYvdXRpbHMvbWF0Y2gtcGF0aAogICAgICAgICAgICovCgogICAgICAgICAgZnVuY3Rpb24gcm91dGVyX21hdGNoUGF0aChwYXR0ZXJuLCBwYXRobmFtZSkgewogICAgICAgICAgICBpZiAodHlwZW9mIHBhdHRlcm4gPT09ICJzdHJpbmciKSB7CiAgICAgICAgICAgICAgcGF0dGVybiA9IHsKICAgICAgICAgICAgICAgIHBhdGg6IHBhdHRlcm4sCiAgICAgICAgICAgICAgICBjYXNlU2Vuc2l0aXZlOiBmYWxzZSwKICAgICAgICAgICAgICAgIGVuZDogdHJ1ZQogICAgICAgICAgICAgIH07CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHZhciBfY29tcGlsZVBhdGggPSBjb21waWxlUGF0aChwYXR0ZXJuLnBhdGgsIHBhdHRlcm4uY2FzZVNlbnNpdGl2ZSwgcGF0dGVybi5lbmQpLF9jb21waWxlUGF0aDIgPSBfc2xpY2VkVG9BcnJheTIoX2NvbXBpbGVQYXRoLCAyKSxtYXRjaGVyID0gX2NvbXBpbGVQYXRoMlswXSxwYXJhbU5hbWVzID0gX2NvbXBpbGVQYXRoMlsxXTsKICAgICAgICAgICAgdmFyIG1hdGNoID0gcGF0aG5hbWUubWF0Y2gobWF0Y2hlcik7CiAgICAgICAgICAgIGlmICghbWF0Y2gpIHJldHVybiBudWxsOwogICAgICAgICAgICB2YXIgbWF0Y2hlZFBhdGhuYW1lID0gbWF0Y2hbMF07CiAgICAgICAgICAgIHZhciBwYXRobmFtZUJhc2UgPSBtYXRjaGVkUGF0aG5hbWUucmVwbGFjZSgvKC4pXC8rJC8sICIkMSIpOwogICAgICAgICAgICB2YXIgY2FwdHVyZUdyb3VwcyA9IG1hdGNoLnNsaWNlKDEpOwogICAgICAgICAgICB2YXIgcGFyYW1zID0gcGFyYW1OYW1lcy5yZWR1Y2UoKG1lbW8sIHBhcmFtTmFtZSwgaW5kZXgpID0+IHsKICAgICAgICAgICAgICAvLyBXZSBuZWVkIHRvIGNvbXB1dGUgdGhlIHBhdGhuYW1lQmFzZSBoZXJlIHVzaW5nIHRoZSByYXcgc3BsYXQgdmFsdWUKICAgICAgICAgICAgICAvLyBpbnN0ZWFkIG9mIHVzaW5nIHBhcmFtc1siKiJdIGxhdGVyIGJlY2F1c2UgaXQgd2lsbCBiZSBkZWNvZGVkIHRoZW4KICAgICAgICAgICAgICBpZiAocGFyYW1OYW1lID09PSAiKiIpIHsKICAgICAgICAgICAgICAgIHZhciBzcGxhdFZhbHVlID0gY2FwdHVyZUdyb3Vwc1tpbmRleF0gfHwgIiI7CiAgICAgICAgICAgICAgICBwYXRobmFtZUJhc2UgPSBtYXRjaGVkUGF0aG5hbWUuc2xpY2UoMCwgbWF0Y2hlZFBhdGhuYW1lLmxlbmd0aCAtIHNwbGF0VmFsdWUubGVuZ3RoKS5yZXBsYWNlKC8oLilcLyskLywgIiQxIik7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBtZW1vW3BhcmFtTmFtZV0gPSBzYWZlbHlEZWNvZGVVUklDb21wb25lbnQoY2FwdHVyZUdyb3Vwc1tpbmRleF0gfHwgIiIsIHBhcmFtTmFtZSk7CiAgICAgICAgICAgICAgcmV0dXJuIG1lbW87CiAgICAgICAgICAgIH0sIHt9KTsKICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICBwYXJhbXM6IHBhcmFtcywKICAgICAgICAgICAgICBwYXRobmFtZTogbWF0Y2hlZFBhdGhuYW1lLAogICAgICAgICAgICAgIHBhdGhuYW1lQmFzZTogcGF0aG5hbWVCYXNlLAogICAgICAgICAgICAgIHBhdHRlcm46IHBhdHRlcm4KICAgICAgICAgICAgfTsKICAgICAgICAgIH0KCiAgICAgICAgICBmdW5jdGlvbiBjb21waWxlUGF0aChwYXRoLCBjYXNlU2Vuc2l0aXZlLCBlbmQpIHsKICAgICAgICAgICAgaWYgKGNhc2VTZW5zaXRpdmUgPT09IHZvaWQgMCkgewogICAgICAgICAgICAgIGNhc2VTZW5zaXRpdmUgPSBmYWxzZTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKGVuZCA9PT0gdm9pZCAwKSB7CiAgICAgICAgICAgICAgZW5kID0gdHJ1ZTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgd2FybmluZyhwYXRoID09PSAiKiIgfHwgIXBhdGguZW5kc1dpdGgoIioiKSB8fCBwYXRoLmVuZHNXaXRoKCIvKiIpLCAiUm91dGUgcGF0aCBcIiIgKyBwYXRoICsgIlwiIHdpbGwgYmUgdHJlYXRlZCBhcyBpZiBpdCB3ZXJlICIgKyAoIlwiIiArIHBhdGgucmVwbGFjZSgvXCokLywgIi8qIikgKyAiXCIgYmVjYXVzZSB0aGUgYCpgIGNoYXJhY3RlciBtdXN0ICIpICsgImFsd2F5cyBmb2xsb3cgYSBgL2AgaW4gdGhlIHBhdHRlcm4uIFRvIGdldCByaWQgb2YgdGhpcyB3YXJuaW5nLCAiICsgKCJwbGVhc2UgY2hhbmdlIHRoZSByb3V0ZSBwYXRoIHRvIFwiIiArIHBhdGgucmVwbGFjZSgvXCokLywgIi8qIikgKyAiXCIuIikpOwogICAgICAgICAgICB2YXIgcGFyYW1OYW1lcyA9IFtdOwogICAgICAgICAgICB2YXIgcmVnZXhwU291cmNlID0gIl4iICsgcGF0aC5yZXBsYWNlKC9cLypcKj8kLywgIiIpIC8vIElnbm9yZSB0cmFpbGluZyAvIGFuZCAvKiwgd2UnbGwgaGFuZGxlIGl0IGJlbG93CiAgICAgICAgICAgIC5yZXBsYWNlKC9eXC8qLywgIi8iKSAvLyBNYWtlIHN1cmUgaXQgaGFzIGEgbGVhZGluZyAvCiAgICAgICAgICAgIC5yZXBsYWNlKC9bXFwuKiteJD97fXwoKVtcXV0vZywgIlxcJCYiKSAvLyBFc2NhcGUgc3BlY2lhbCByZWdleCBjaGFycwogICAgICAgICAgICAucmVwbGFjZSgvOihcdyspL2csIChfLCBwYXJhbU5hbWUpID0+IHsKICAgICAgICAgICAgICBwYXJhbU5hbWVzLnB1c2gocGFyYW1OYW1lKTsKICAgICAgICAgICAgICByZXR1cm4gIihbXlxcL10rKSI7CiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgaWYgKHBhdGguZW5kc1dpdGgoIioiKSkgewogICAgICAgICAgICAgIHBhcmFtTmFtZXMucHVzaCgiKiIpOwogICAgICAgICAgICAgIHJlZ2V4cFNvdXJjZSArPSBwYXRoID09PSAiKiIgfHwgcGF0aCA9PT0gIi8qIiA/ICIoLiopJCIgLy8gQWxyZWFkeSBtYXRjaGVkIHRoZSBpbml0aWFsIC8sIGp1c3QgbWF0Y2ggdGhlIHJlc3QKICAgICAgICAgICAgICA6ICIoPzpcXC8oLispfFxcLyopJCI7IC8vIERvbid0IGluY2x1ZGUgdGhlIC8gaW4gcGFyYW1zWyIqIl0KICAgICAgICAgICAgfSBlbHNlIGlmIChlbmQpIHsKICAgICAgICAgICAgICAvLyBXaGVuIG1hdGNoaW5nIHRvIHRoZSBlbmQsIGlnbm9yZSB0cmFpbGluZyBzbGFzaGVzCiAgICAgICAgICAgICAgcmVnZXhwU291cmNlICs9ICJcXC8qJCI7CiAgICAgICAgICAgIH0gZWxzZSBpZiAocGF0aCAhPT0gIiIgJiYgcGF0aCAhPT0gIi8iKSB7CiAgICAgICAgICAgICAgLy8gSWYgb3VyIHBhdGggaXMgbm9uLWVtcHR5IGFuZCBjb250YWlucyBhbnl0aGluZyBiZXlvbmQgYW4gaW5pdGlhbCBzbGFzaCwKICAgICAgICAgICAgICAvLyB0aGVuIHdlIGhhdmUgX3NvbWVfIGZvcm0gb2YgcGF0aCBpbiBvdXIgcmVnZXggc28gd2Ugc2hvdWxkIGV4cGVjdCB0bwogICAgICAgICAgICAgIC8vIG1hdGNoIG9ubHkgaWYgd2UgZmluZCB0aGUgZW5kIG9mIHRoaXMgcGF0aCBzZWdtZW50LiAgTG9vayBmb3IgYW4gb3B0aW9uYWwKICAgICAgICAgICAgICAvLyBub24tY2FwdHVyZWQgdHJhaWxpbmcgc2xhc2ggKHRvIG1hdGNoIGEgcG9ydGlvbiBvZiB0aGUgVVJMKSBvciB0aGUgZW5kCiAgICAgICAgICAgICAgLy8gb2YgdGhlIHBhdGggKGlmIHdlJ3ZlIG1hdGNoZWQgdG8gdGhlIGVuZCkuICBXZSB1c2VkIHRvIGRvIHRoaXMgd2l0aCBhCiAgICAgICAgICAgICAgLy8gd29yZCBib3VuZGFyeSBidXQgdGhhdCBnaXZlcyBmYWxzZSBwb3NpdGl2ZXMgb24gcm91dGVzIGxpa2UKICAgICAgICAgICAgICAvLyAvdXNlci1wcmVmZXJlbmNlcyBzaW5jZSBgLWAgY291bnRzIGFzIGEgd29yZCBib3VuZGFyeS4KICAgICAgICAgICAgICByZWdleHBTb3VyY2UgKz0gIig/Oig/PVxcL3wkKSkiOwogICAgICAgICAgICB9IGVsc2UgOwoKICAgICAgICAgICAgdmFyIG1hdGNoZXIgPSBuZXcgUmVnRXhwKHJlZ2V4cFNvdXJjZSwgY2FzZVNlbnNpdGl2ZSA/IHVuZGVmaW5lZCA6ICJpIik7CiAgICAgICAgICAgIHJldHVybiBbbWF0Y2hlciwgcGFyYW1OYW1lc107CiAgICAgICAgICB9CgogICAgICAgICAgZnVuY3Rpb24gc2FmZWx5RGVjb2RlVVJJKHZhbHVlKSB7CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgcmV0dXJuIGRlY29kZVVSSSh2YWx1ZSk7CiAgICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgICAgICAgd2FybmluZyhmYWxzZSwgIlRoZSBVUkwgcGF0aCBcIiIgKyB2YWx1ZSArICJcIiBjb3VsZCBub3QgYmUgZGVjb2RlZCBiZWNhdXNlIGl0IGlzIGlzIGEgIiArICJtYWxmb3JtZWQgVVJMIHNlZ21lbnQuIFRoaXMgaXMgcHJvYmFibHkgZHVlIHRvIGEgYmFkIHBlcmNlbnQgIiArICgiZW5jb2RpbmcgKCIgKyBlcnJvciArICIpLiIpKTsKICAgICAgICAgICAgICByZXR1cm4gdmFsdWU7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KCiAgICAgICAgICBmdW5jdGlvbiBzYWZlbHlEZWNvZGVVUklDb21wb25lbnQodmFsdWUsIHBhcmFtTmFtZSkgewogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgIHJldHVybiBkZWNvZGVVUklDb21wb25lbnQodmFsdWUpOwogICAgICAgICAgICB9IGNhdGNoIChlcnJvcikgewogICAgICAgICAgICAgIHdhcm5pbmcoZmFsc2UsICJUaGUgdmFsdWUgZm9yIHRoZSBVUkwgcGFyYW0gXCIiICsgcGFyYW1OYW1lICsgIlwiIHdpbGwgbm90IGJlIGRlY29kZWQgYmVjYXVzZSIgKyAoIiB0aGUgc3RyaW5nIFwiIiArIHZhbHVlICsgIlwiIGlzIGEgbWFsZm9ybWVkIFVSTCBzZWdtZW50LiBUaGlzIGlzIHByb2JhYmx5IikgKyAoIiBkdWUgdG8gYSBiYWQgcGVyY2VudCBlbmNvZGluZyAoIiArIGVycm9yICsgIikuIikpOwogICAgICAgICAgICAgIHJldHVybiB2YWx1ZTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgLyoqCiAgICAgICAgICAgKiBAcHJpdmF0ZQogICAgICAgICAgICovCgoKICAgICAgICAgIGZ1bmN0aW9uIHN0cmlwQmFzZW5hbWUocGF0aG5hbWUsIGJhc2VuYW1lKSB7CiAgICAgICAgICAgIGlmIChiYXNlbmFtZSA9PT0gIi8iKSByZXR1cm4gcGF0aG5hbWU7CgogICAgICAgICAgICBpZiAoIXBhdGhuYW1lLnRvTG93ZXJDYXNlKCkuc3RhcnRzV2l0aChiYXNlbmFtZS50b0xvd2VyQ2FzZSgpKSkgewogICAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgICAgICB9IC8vIFdlIHdhbnQgdG8gbGVhdmUgdHJhaWxpbmcgc2xhc2ggYmVoYXZpb3IgaW4gdGhlIHVzZXIncyBjb250cm9sLCBzbyBpZiB0aGV5CiAgICAgICAgICAgIC8vIHNwZWNpZnkgYSBiYXNlbmFtZSB3aXRoIGEgdHJhaWxpbmcgc2xhc2gsIHdlIHNob3VsZCBzdXBwb3J0IGl0CgoKICAgICAgICAgICAgdmFyIHN0YXJ0SW5kZXggPSBiYXNlbmFtZS5lbmRzV2l0aCgiLyIpID8gYmFzZW5hbWUubGVuZ3RoIC0gMSA6IGJhc2VuYW1lLmxlbmd0aDsKICAgICAgICAgICAgdmFyIG5leHRDaGFyID0gcGF0aG5hbWUuY2hhckF0KHN0YXJ0SW5kZXgpOwoKICAgICAgICAgICAgaWYgKG5leHRDaGFyICYmIG5leHRDaGFyICE9PSAiLyIpIHsKICAgICAgICAgICAgICAvLyBwYXRobmFtZSBkb2VzIG5vdCBzdGFydCB3aXRoIGJhc2VuYW1lLwogICAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgICAgICB9CgogICAgICAgICAgICByZXR1cm4gcGF0aG5hbWUuc2xpY2Uoc3RhcnRJbmRleCkgfHwgIi8iOwogICAgICAgICAgfQogICAgICAgICAgZnVuY3Rpb24gcm91dGVyX2ludmFyaWFudCh2YWx1ZSwgbWVzc2FnZSkgewogICAgICAgICAgICBpZiAodmFsdWUgPT09IGZhbHNlIHx8IHZhbHVlID09PSBudWxsIHx8IHR5cGVvZiB2YWx1ZSA9PT0gInVuZGVmaW5lZCIpIHsKICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IobWVzc2FnZSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIC8qKgogICAgICAgICAgICogQHByaXZhdGUKICAgICAgICAgICAqLwoKICAgICAgICAgIGZ1bmN0aW9uIHdhcm5pbmcoY29uZCwgbWVzc2FnZSkgewogICAgICAgICAgICBpZiAoIWNvbmQpIHsKICAgICAgICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tY29uc29sZQogICAgICAgICAgICAgIGlmICh0eXBlb2YgY29uc29sZSAhPT0gInVuZGVmaW5lZCIpIGNvbnNvbGUud2FybihtZXNzYWdlKTsKCiAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIC8vIFdlbGNvbWUgdG8gZGVidWdnaW5nIFJlYWN0IFJvdXRlciEKICAgICAgICAgICAgICAgIC8vCiAgICAgICAgICAgICAgICAvLyBUaGlzIGVycm9yIGlzIHRocm93biBhcyBhIGNvbnZlbmllbmNlIHNvIHlvdSBjYW4gbW9yZSBlYXNpbHkKICAgICAgICAgICAgICAgIC8vIGZpbmQgdGhlIHNvdXJjZSBmb3IgYSB3YXJuaW5nIHRoYXQgYXBwZWFycyBpbiB0aGUgY29uc29sZSBieQogICAgICAgICAgICAgICAgLy8gZW5hYmxpbmcgInBhdXNlIG9uIGV4Y2VwdGlvbnMiIGluIHlvdXIgSmF2YVNjcmlwdCBkZWJ1Z2dlci4KICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihtZXNzYWdlKTsgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG5vLWVtcHR5CiAgICAgICAgICAgICAgfSBjYXRjaCAoZSkge30KICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgLyoqCiAgICAgICAgICAgKiBSZXR1cm5zIGEgcmVzb2x2ZWQgcGF0aCBvYmplY3QgcmVsYXRpdmUgdG8gdGhlIGdpdmVuIHBhdGhuYW1lLgogICAgICAgICAgICoKICAgICAgICAgICAqIEBzZWUgaHR0cHM6Ly9yZWFjdHJvdXRlci5jb20vZG9jcy9lbi92Ni91dGlscy9yZXNvbHZlLXBhdGgKICAgICAgICAgICAqLwoKICAgICAgICAgIGZ1bmN0aW9uIHJlc29sdmVQYXRoKHRvLCBmcm9tUGF0aG5hbWUpIHsKICAgICAgICAgICAgaWYgKGZyb21QYXRobmFtZSA9PT0gdm9pZCAwKSB7CiAgICAgICAgICAgICAgZnJvbVBhdGhuYW1lID0gIi8iOwogICAgICAgICAgICB9CgogICAgICAgICAgICB2YXIgX3JlZjExID0KCgoKICAgICAgICAgICAgICB0eXBlb2YgdG8gPT09ICJzdHJpbmciID8gcGFyc2VQYXRoKHRvKSA6IHRvLHRvUGF0aG5hbWUgPSBfcmVmMTEucGF0aG5hbWUsX3JlZjExJHNlYXJjaCA9IF9yZWYxMS5zZWFyY2gsc2VhcmNoID0gX3JlZjExJHNlYXJjaCA9PT0gdm9pZCAwID8gIiIgOiBfcmVmMTEkc2VhcmNoLF9yZWYxMSRoYXNoID0gX3JlZjExLmhhc2gsaGFzaCA9IF9yZWYxMSRoYXNoID09PSB2b2lkIDAgPyAiIiA6IF9yZWYxMSRoYXNoOwogICAgICAgICAgICB2YXIgcGF0aG5hbWUgPSB0b1BhdGhuYW1lID8gdG9QYXRobmFtZS5zdGFydHNXaXRoKCIvIikgPyB0b1BhdGhuYW1lIDogcmVzb2x2ZVBhdGhuYW1lKHRvUGF0aG5hbWUsIGZyb21QYXRobmFtZSkgOiBmcm9tUGF0aG5hbWU7CiAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgcGF0aG5hbWU6IHBhdGhuYW1lLAogICAgICAgICAgICAgIHNlYXJjaDogbm9ybWFsaXplU2VhcmNoKHNlYXJjaCksCiAgICAgICAgICAgICAgaGFzaDogbm9ybWFsaXplSGFzaChoYXNoKQogICAgICAgICAgICB9OwogICAgICAgICAgfQoKICAgICAgICAgIGZ1bmN0aW9uIHJlc29sdmVQYXRobmFtZShyZWxhdGl2ZVBhdGgsIGZyb21QYXRobmFtZSkgewogICAgICAgICAgICB2YXIgc2VnbWVudHMgPSBmcm9tUGF0aG5hbWUucmVwbGFjZSgvXC8rJC8sICIiKS5zcGxpdCgiLyIpOwogICAgICAgICAgICB2YXIgcmVsYXRpdmVTZWdtZW50cyA9IHJlbGF0aXZlUGF0aC5zcGxpdCgiLyIpOwogICAgICAgICAgICByZWxhdGl2ZVNlZ21lbnRzLmZvckVhY2goKHNlZ21lbnQpID0+IHsKICAgICAgICAgICAgICBpZiAoc2VnbWVudCA9PT0gIi4uIikgewogICAgICAgICAgICAgICAgLy8gS2VlcCB0aGUgcm9vdCAiIiBzZWdtZW50IHNvIHRoZSBwYXRobmFtZSBzdGFydHMgYXQgLwogICAgICAgICAgICAgICAgaWYgKHNlZ21lbnRzLmxlbmd0aCA+IDEpIHNlZ21lbnRzLnBvcCgpOwogICAgICAgICAgICAgIH0gZWxzZSBpZiAoc2VnbWVudCAhPT0gIi4iKSB7CiAgICAgICAgICAgICAgICBzZWdtZW50cy5wdXNoKHNlZ21lbnQpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIHJldHVybiBzZWdtZW50cy5sZW5ndGggPiAxID8gc2VnbWVudHMuam9pbigiLyIpIDogIi8iOwogICAgICAgICAgfQoKICAgICAgICAgIGZ1bmN0aW9uIGdldEludmFsaWRQYXRoRXJyb3IoY2hhciwgZmllbGQsIGRlc3QsIHBhdGgpIHsKICAgICAgICAgICAgcmV0dXJuICJDYW5ub3QgaW5jbHVkZSBhICciICsgY2hhciArICInIGNoYXJhY3RlciBpbiBhIG1hbnVhbGx5IHNwZWNpZmllZCAiICsgKCJgdG8uIiArIGZpZWxkICsgImAgZmllbGQgWyIgKyBKU09OLnN0cmluZ2lmeShwYXRoKSArICJdLiAgUGxlYXNlIHNlcGFyYXRlIGl0IG91dCB0byB0aGUgIikgKyAoImB0by4iICsgZGVzdCArICJgIGZpZWxkLiBBbHRlcm5hdGl2ZWx5IHlvdSBtYXkgcHJvdmlkZSB0aGUgZnVsbCBwYXRoIGFzICIpICsgImEgc3RyaW5nIGluIDxMaW5rIHRvPVwiLi4uXCI+IGFuZCB0aGUgcm91dGVyIHdpbGwgcGFyc2UgaXQgZm9yIHlvdS4iOwogICAgICAgICAgfQogICAgICAgICAgLyoqCiAgICAgICAgICAgKiBAcHJpdmF0ZQogICAgICAgICAgICoKICAgICAgICAgICAqIFdoZW4gcHJvY2Vzc2luZyByZWxhdGl2ZSBuYXZpZ2F0aW9uIHdlIHdhbnQgdG8gaWdub3JlIGFuY2VzdG9yIHJvdXRlcyB0aGF0CiAgICAgICAgICAgKiBkbyBub3QgY29udHJpYnV0ZSB0byB0aGUgcGF0aCwgc3VjaCB0aGF0IGluZGV4L3BhdGhsZXNzIGxheW91dCByb3V0ZXMgZG9uJ3QKICAgICAgICAgICAqIGludGVyZmVyZS4KICAgICAgICAgICAqCiAgICAgICAgICAgKiBGb3IgZXhhbXBsZSwgd2hlbiBtb3ZpbmcgYSByb3V0ZSBlbGVtZW50IGludG8gYW4gaW5kZXggcm91dGUgYW5kL29yIGEKICAgICAgICAgICAqIHBhdGhsZXNzIGxheW91dCByb3V0ZSwgcmVsYXRpdmUgbGluayBiZWhhdmlvciBjb250YWluZWQgd2l0aGluIHNob3VsZCBzdGF5CiAgICAgICAgICAgKiB0aGUgc2FtZS4gIEJvdGggb2YgdGhlIGZvbGxvd2luZyBleGFtcGxlcyBzaG91bGQgbGluayBiYWNrIHRvIHRoZSByb290OgogICAgICAgICAgICoKICAgICAgICAgICAqICAgPFJvdXRlIHBhdGg9Ii8iPgogICAgICAgICAgICogICAgIDxSb3V0ZSBwYXRoPSJhY2NvdW50cyIgZWxlbWVudD17PExpbmsgdG89Ii4uIn0+CiAgICAgICAgICAgKiAgIDwvUm91dGU+CiAgICAgICAgICAgKgogICAgICAgICAgICogICA8Um91dGUgcGF0aD0iLyI+CiAgICAgICAgICAgKiAgICAgPFJvdXRlIHBhdGg9ImFjY291bnRzIj4KICAgICAgICAgICAqICAgICAgIDxSb3V0ZSBlbGVtZW50PXs8QWNjb3VudHNMYXlvdXQgLz59PiAgICAgICAvLyA8LS0gRG9lcyBub3QgY29udHJpYnV0ZQogICAgICAgICAgICogICAgICAgICA8Um91dGUgaW5kZXggZWxlbWVudD17PExpbmsgdG89Ii4uIn0gLz4gIC8vIDwtLSBEb2VzIG5vdCBjb250cmlidXRlCiAgICAgICAgICAgKiAgICAgICA8L1JvdXRlCiAgICAgICAgICAgKiAgICAgPC9Sb3V0ZT4KICAgICAgICAgICAqICAgPC9Sb3V0ZT4KICAgICAgICAgICAqLwoKCiAgICAgICAgICBmdW5jdGlvbiBnZXRQYXRoQ29udHJpYnV0aW5nTWF0Y2hlcyhtYXRjaGVzKSB7CiAgICAgICAgICAgIHJldHVybiBtYXRjaGVzLmZpbHRlcigobWF0Y2gsIGluZGV4KSA9PiBpbmRleCA9PT0gMCB8fCBtYXRjaC5yb3V0ZS5wYXRoICYmIG1hdGNoLnJvdXRlLnBhdGgubGVuZ3RoID4gMCk7CiAgICAgICAgICB9CiAgICAgICAgICAvKioKICAgICAgICAgICAqIEBwcml2YXRlCiAgICAgICAgICAgKi8KCiAgICAgICAgICBmdW5jdGlvbiByZXNvbHZlVG8odG9BcmcsIHJvdXRlUGF0aG5hbWVzLCBsb2NhdGlvblBhdGhuYW1lLCBpc1BhdGhSZWxhdGl2ZSkgewogICAgICAgICAgICBpZiAoaXNQYXRoUmVsYXRpdmUgPT09IHZvaWQgMCkgewogICAgICAgICAgICAgIGlzUGF0aFJlbGF0aXZlID0gZmFsc2U7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHZhciB0bzsKCiAgICAgICAgICAgIGlmICh0eXBlb2YgdG9BcmcgPT09ICJzdHJpbmciKSB7CiAgICAgICAgICAgICAgdG8gPSBwYXJzZVBhdGgodG9BcmcpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIHRvID0gX2V4dGVuZHMoe30sIHRvQXJnKTsKICAgICAgICAgICAgICByb3V0ZXJfaW52YXJpYW50KCF0by5wYXRobmFtZSB8fCAhdG8ucGF0aG5hbWUuaW5jbHVkZXMoIj8iKSwgZ2V0SW52YWxpZFBhdGhFcnJvcigiPyIsICJwYXRobmFtZSIsICJzZWFyY2giLCB0bykpOwogICAgICAgICAgICAgIHJvdXRlcl9pbnZhcmlhbnQoIXRvLnBhdGhuYW1lIHx8ICF0by5wYXRobmFtZS5pbmNsdWRlcygiIyIpLCBnZXRJbnZhbGlkUGF0aEVycm9yKCIjIiwgInBhdGhuYW1lIiwgImhhc2giLCB0bykpOwogICAgICAgICAgICAgIHJvdXRlcl9pbnZhcmlhbnQoIXRvLnNlYXJjaCB8fCAhdG8uc2VhcmNoLmluY2x1ZGVzKCIjIiksIGdldEludmFsaWRQYXRoRXJyb3IoIiMiLCAic2VhcmNoIiwgImhhc2giLCB0bykpOwogICAgICAgICAgICB9CgogICAgICAgICAgICB2YXIgaXNFbXB0eVBhdGggPSB0b0FyZyA9PT0gIiIgfHwgdG8ucGF0aG5hbWUgPT09ICIiOwogICAgICAgICAgICB2YXIgdG9QYXRobmFtZSA9IGlzRW1wdHlQYXRoID8gIi8iIDogdG8ucGF0aG5hbWU7CiAgICAgICAgICAgIHZhciBmcm9tOyAvLyBSb3V0aW5nIGlzIHJlbGF0aXZlIHRvIHRoZSBjdXJyZW50IHBhdGhuYW1lIGlmIGV4cGxpY2l0bHkgcmVxdWVzdGVkLgogICAgICAgICAgICAvLwogICAgICAgICAgICAvLyBJZiBhIHBhdGhuYW1lIGlzIGV4cGxpY2l0bHkgcHJvdmlkZWQgaW4gYHRvYCwgaXQgc2hvdWxkIGJlIHJlbGF0aXZlIHRvIHRoZQogICAgICAgICAgICAvLyByb3V0ZSBjb250ZXh0LiBUaGlzIGlzIGV4cGxhaW5lZCBpbiBgTm90ZSBvbiBgPExpbmsgdG8+YCB2YWx1ZXNgIGluIG91cgogICAgICAgICAgICAvLyBtaWdyYXRpb24gZ3VpZGUgZnJvbSB2NSBhcyBhIG1lYW5zIG9mIGRpc2FtYmlndWF0aW9uIGJldHdlZW4gYHRvYCB2YWx1ZXMKICAgICAgICAgICAgLy8gdGhhdCBiZWdpbiB3aXRoIGAvYCBhbmQgdGhvc2UgdGhhdCBkbyBub3QuIEhvd2V2ZXIsIHRoaXMgaXMgcHJvYmxlbWF0aWMgZm9yCiAgICAgICAgICAgIC8vIGB0b2AgdmFsdWVzIHRoYXQgZG8gbm90IHByb3ZpZGUgYSBwYXRobmFtZS4gYHRvYCBjYW4gc2ltcGx5IGJlIGEgc2VhcmNoIG9yCiAgICAgICAgICAgIC8vIGhhc2ggc3RyaW5nLCBpbiB3aGljaCBjYXNlIHdlIHNob3VsZCBhc3N1bWUgdGhhdCB0aGUgbmF2aWdhdGlvbiBpcyByZWxhdGl2ZQogICAgICAgICAgICAvLyB0byB0aGUgY3VycmVudCBsb2NhdGlvbidzIHBhdGhuYW1lIGFuZCAqbm90KiB0aGUgcm91dGUgcGF0aG5hbWUuCgogICAgICAgICAgICBpZiAoaXNQYXRoUmVsYXRpdmUgfHwgdG9QYXRobmFtZSA9PSBudWxsKSB7CiAgICAgICAgICAgICAgZnJvbSA9IGxvY2F0aW9uUGF0aG5hbWU7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgdmFyIHJvdXRlUGF0aG5hbWVJbmRleCA9IHJvdXRlUGF0aG5hbWVzLmxlbmd0aCAtIDE7CgogICAgICAgICAgICAgIGlmICh0b1BhdGhuYW1lLnN0YXJ0c1dpdGgoIi4uIikpIHsKICAgICAgICAgICAgICAgIHZhciB0b1NlZ21lbnRzID0gdG9QYXRobmFtZS5zcGxpdCgiLyIpOyAvLyBFYWNoIGxlYWRpbmcgLi4gc2VnbWVudCBtZWFucyAiZ28gdXAgb25lIHJvdXRlIiBpbnN0ZWFkIG9mICJnbyB1cCBvbmUKICAgICAgICAgICAgICAgIC8vIFVSTCBzZWdtZW50Ii4gIFRoaXMgaXMgYSBrZXkgZGlmZmVyZW5jZSBmcm9tIGhvdyA8YSBocmVmPiB3b3JrcyBhbmQgYQogICAgICAgICAgICAgICAgLy8gbWFqb3IgcmVhc29uIHdlIGNhbGwgdGhpcyBhICJ0byIgdmFsdWUgaW5zdGVhZCBvZiBhICJocmVmIi4KCiAgICAgICAgICAgICAgICB3aGlsZSAodG9TZWdtZW50c1swXSA9PT0gIi4uIikgewogICAgICAgICAgICAgICAgICB0b1NlZ21lbnRzLnNoaWZ0KCk7CiAgICAgICAgICAgICAgICAgIHJvdXRlUGF0aG5hbWVJbmRleCAtPSAxOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHRvLnBhdGhuYW1lID0gdG9TZWdtZW50cy5qb2luKCIvIik7CiAgICAgICAgICAgICAgfSAvLyBJZiB0aGVyZSBhcmUgbW9yZSAiLi4iIHNlZ21lbnRzIHRoYW4gcGFyZW50IHJvdXRlcywgcmVzb2x2ZSByZWxhdGl2ZSB0bwogICAgICAgICAgICAgIC8vIHRoZSByb290IC8gVVJMLgoKCiAgICAgICAgICAgICAgZnJvbSA9IHJvdXRlUGF0aG5hbWVJbmRleCA+PSAwID8gcm91dGVQYXRobmFtZXNbcm91dGVQYXRobmFtZUluZGV4XSA6ICIvIjsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdmFyIHBhdGggPSByZXNvbHZlUGF0aCh0bywgZnJvbSk7IC8vIEVuc3VyZSB0aGUgcGF0aG5hbWUgaGFzIGEgdHJhaWxpbmcgc2xhc2ggaWYgdGhlIG9yaWdpbmFsICJ0byIgaGFkIG9uZQoKICAgICAgICAgICAgdmFyIGhhc0V4cGxpY2l0VHJhaWxpbmdTbGFzaCA9IHRvUGF0aG5hbWUgJiYgdG9QYXRobmFtZSAhPT0gIi8iICYmIHRvUGF0aG5hbWUuZW5kc1dpdGgoIi8iKTsgLy8gT3IgaWYgdGhpcyB3YXMgYSBsaW5rIHRvIHRoZSBjdXJyZW50IHBhdGggd2hpY2ggaGFzIGEgdHJhaWxpbmcgc2xhc2gKCiAgICAgICAgICAgIHZhciBoYXNDdXJyZW50VHJhaWxpbmdTbGFzaCA9IChpc0VtcHR5UGF0aCB8fCB0b1BhdGhuYW1lID09PSAiLiIpICYmIGxvY2F0aW9uUGF0aG5hbWUuZW5kc1dpdGgoIi8iKTsKCiAgICAgICAgICAgIGlmICghcGF0aC5wYXRobmFtZS5lbmRzV2l0aCgiLyIpICYmIChoYXNFeHBsaWNpdFRyYWlsaW5nU2xhc2ggfHwgaGFzQ3VycmVudFRyYWlsaW5nU2xhc2gpKSB7CiAgICAgICAgICAgICAgcGF0aC5wYXRobmFtZSArPSAiLyI7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybiBwYXRoOwogICAgICAgICAgfQogICAgICAgICAgLyoqCiAgICAgICAgICAgKiBAcHJpdmF0ZQogICAgICAgICAgICovCgogICAgICAgICAgZnVuY3Rpb24gZ2V0VG9QYXRobmFtZSh0bykgewogICAgICAgICAgICAvLyBFbXB0eSBzdHJpbmdzIHNob3VsZCBiZSB0cmVhdGVkIHRoZSBzYW1lIGFzIC8gcGF0aHMKICAgICAgICAgICAgcmV0dXJuIHRvID09PSAiIiB8fCB0by5wYXRobmFtZSA9PT0gIiIgPyAiLyIgOiB0eXBlb2YgdG8gPT09ICJzdHJpbmciID8gcGFyc2VQYXRoKHRvKS5wYXRobmFtZSA6IHRvLnBhdGhuYW1lOwogICAgICAgICAgfQogICAgICAgICAgLyoqCiAgICAgICAgICAgKiBAcHJpdmF0ZQogICAgICAgICAgICovCgogICAgICAgICAgdmFyIHJvdXRlcl9qb2luUGF0aHMgPSAocGF0aHMpID0+IHBhdGhzLmpvaW4oIi8iKS5yZXBsYWNlKC9cL1wvKy9nLCAiLyIpOwogICAgICAgICAgLyoqCiAgICAgICAgICAgKiBAcHJpdmF0ZQogICAgICAgICAgICovCgogICAgICAgICAgdmFyIG5vcm1hbGl6ZVBhdGhuYW1lID0gKHBhdGhuYW1lKSA9PiBwYXRobmFtZS5yZXBsYWNlKC9cLyskLywgIiIpLnJlcGxhY2UoL15cLyovLCAiLyIpOwogICAgICAgICAgLyoqCiAgICAgICAgICAgKiBAcHJpdmF0ZQogICAgICAgICAgICovCgogICAgICAgICAgdmFyIG5vcm1hbGl6ZVNlYXJjaCA9IChzZWFyY2gpID0+ICFzZWFyY2ggfHwgc2VhcmNoID09PSAiPyIgPyAiIiA6IHNlYXJjaC5zdGFydHNXaXRoKCI/IikgPyBzZWFyY2ggOiAiPyIgKyBzZWFyY2g7CiAgICAgICAgICAvKioKICAgICAgICAgICAqIEBwcml2YXRlCiAgICAgICAgICAgKi8KCiAgICAgICAgICB2YXIgbm9ybWFsaXplSGFzaCA9IChoYXNoKSA9PiAhaGFzaCB8fCBoYXNoID09PSAiIyIgPyAiIiA6IGhhc2guc3RhcnRzV2l0aCgiIyIpID8gaGFzaCA6ICIjIiArIGhhc2g7CiAgICAgICAgICAvKioKICAgICAgICAgICAqIFRoaXMgaXMgYSBzaG9ydGN1dCBmb3IgY3JlYXRpbmcgYGFwcGxpY2F0aW9uL2pzb25gIHJlc3BvbnNlcy4gQ29udmVydHMgYGRhdGFgCiAgICAgICAgICAgKiB0byBKU09OIGFuZCBzZXRzIHRoZSBgQ29udGVudC1UeXBlYCBoZWFkZXIuCiAgICAgICAgICAgKi8KCiAgICAgICAgICB2YXIganNvbiA9IGZ1bmN0aW9uIGpzb24oZGF0YSwgaW5pdCkgewogICAgICAgICAgICBpZiAoaW5pdCA9PT0gdm9pZCAwKSB7CiAgICAgICAgICAgICAgaW5pdCA9IHt9OwogICAgICAgICAgICB9CgogICAgICAgICAgICB2YXIgcmVzcG9uc2VJbml0ID0gdHlwZW9mIGluaXQgPT09ICJudW1iZXIiID8gewogICAgICAgICAgICAgIHN0YXR1czogaW5pdAogICAgICAgICAgICB9IDogaW5pdDsKICAgICAgICAgICAgdmFyIGhlYWRlcnMgPSBuZXcgSGVhZGVycyhyZXNwb25zZUluaXQuaGVhZGVycyk7CgogICAgICAgICAgICBpZiAoIWhlYWRlcnMuaGFzKCJDb250ZW50LVR5cGUiKSkgewogICAgICAgICAgICAgIGhlYWRlcnMuc2V0KCJDb250ZW50LVR5cGUiLCAiYXBwbGljYXRpb24vanNvbjsgY2hhcnNldD11dGYtOCIpOwogICAgICAgICAgICB9CgogICAgICAgICAgICByZXR1cm4gbmV3IFJlc3BvbnNlKEpTT04uc3RyaW5naWZ5KGRhdGEpLCBfZXh0ZW5kcyh7fSwgcmVzcG9uc2VJbml0LCB7CiAgICAgICAgICAgICAgaGVhZGVyczogaGVhZGVycwogICAgICAgICAgICB9KSk7CiAgICAgICAgICB9O3ZhcgogICAgICAgICAgcm91dGVyX0Fib3J0ZWREZWZlcnJlZEVycm9yID0gLyojX19QVVJFX18qL2Z1bmN0aW9uIChfRXJyb3IpIHtfaW5oZXJpdHMocm91dGVyX0Fib3J0ZWREZWZlcnJlZEVycm9yLCBfRXJyb3IpO3ZhciBfc3VwZXIgPSBfY3JlYXRlU3VwZXIocm91dGVyX0Fib3J0ZWREZWZlcnJlZEVycm9yKTtmdW5jdGlvbiByb3V0ZXJfQWJvcnRlZERlZmVycmVkRXJyb3IoKSB7X2NsYXNzQ2FsbENoZWNrMih0aGlzLCByb3V0ZXJfQWJvcnRlZERlZmVycmVkRXJyb3IpO3JldHVybiBfc3VwZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKTt9cmV0dXJuIF9jcmVhdGVDbGFzczIocm91dGVyX0Fib3J0ZWREZWZlcnJlZEVycm9yKTt9KCAvKiNfX1BVUkVfXyovX3dyYXBOYXRpdmVTdXBlcihFcnJvcikpO3ZhcgogICAgICAgICAgRGVmZXJyZWREYXRhID0gLyojX19QVVJFX18qL2Z1bmN0aW9uICgpIHsKICAgICAgICAgICAgZnVuY3Rpb24gRGVmZXJyZWREYXRhKGRhdGEpIHtfY2xhc3NDYWxsQ2hlY2syKHRoaXMsIERlZmVycmVkRGF0YSk7CiAgICAgICAgICAgICAgdGhpcy5wZW5kaW5nS2V5cyA9IG5ldyBTZXQoKTsKICAgICAgICAgICAgICB0aGlzLnN1YnNjcmliZXIgPSB1bmRlZmluZWQ7CiAgICAgICAgICAgICAgcm91dGVyX2ludmFyaWFudChkYXRhICYmIHR5cGVvZiBkYXRhID09PSAib2JqZWN0IiAmJiAhQXJyYXkuaXNBcnJheShkYXRhKSwgImRlZmVyKCkgb25seSBhY2NlcHRzIHBsYWluIG9iamVjdHMiKTsgLy8gU2V0IHVwIGFuIEFib3J0Q29udHJvbGxlciArIFByb21pc2Ugd2UgY2FuIHJhY2UgYWdhaW5zdCB0byBleGl0IGVhcmx5CiAgICAgICAgICAgICAgLy8gY2FuY2VsbGF0aW9uCgogICAgICAgICAgICAgIHZhciByZWplY3Q7CiAgICAgICAgICAgICAgdGhpcy5hYm9ydFByb21pc2UgPSBuZXcgUHJvbWlzZSgoXywgcikgPT4gcmVqZWN0ID0gcik7CiAgICAgICAgICAgICAgdGhpcy5jb250cm9sbGVyID0gbmV3IEFib3J0Q29udHJvbGxlcigpOwoKICAgICAgICAgICAgICB2YXIgb25BYm9ydCA9ICgpID0+IHJlamVjdChuZXcgcm91dGVyX0Fib3J0ZWREZWZlcnJlZEVycm9yKCJEZWZlcnJlZCBkYXRhIGFib3J0ZWQiKSk7CgogICAgICAgICAgICAgIHRoaXMudW5saXN0ZW5BYm9ydFNpZ25hbCA9ICgpID0+IHRoaXMuY29udHJvbGxlci5zaWduYWwucmVtb3ZlRXZlbnRMaXN0ZW5lcigiYWJvcnQiLCBvbkFib3J0KTsKCiAgICAgICAgICAgICAgdGhpcy5jb250cm9sbGVyLnNpZ25hbC5hZGRFdmVudExpc3RlbmVyKCJhYm9ydCIsIG9uQWJvcnQpOwogICAgICAgICAgICAgIHRoaXMuZGF0YSA9IE9iamVjdC5lbnRyaWVzKGRhdGEpLnJlZHVjZSgoYWNjLCBfcmVmKSA9PiB7CiAgICAgICAgICAgICAgICB2YXIgX3JlZjEyID0gX3NsaWNlZFRvQXJyYXkyKF9yZWYsIDIpLGtleSA9IF9yZWYxMlswXSx2YWx1ZSA9IF9yZWYxMlsxXTsKICAgICAgICAgICAgICAgIHJldHVybiBPYmplY3QuYXNzaWduKGFjYywgX2RlZmluZVByb3BlcnR5Mih7fSwKICAgICAgICAgICAgICAgIGtleSwgdGhpcy50cmFja1Byb21pc2Uoa2V5LCB2YWx1ZSkpKTsKCiAgICAgICAgICAgICAgfSwge30pOwogICAgICAgICAgICB9X2NyZWF0ZUNsYXNzMihEZWZlcnJlZERhdGEsIFt7IGtleTogInRyYWNrUHJvbWlzZSIsIHZhbHVlOgoKICAgICAgICAgICAgICBmdW5jdGlvbiB0cmFja1Byb21pc2Uoa2V5LCB2YWx1ZSkgewogICAgICAgICAgICAgICAgaWYgKCEodmFsdWUgaW5zdGFuY2VvZiBQcm9taXNlKSkgewogICAgICAgICAgICAgICAgICByZXR1cm4gdmFsdWU7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgdGhpcy5wZW5kaW5nS2V5cy5hZGQoa2V5KTsgLy8gV2Ugc3RvcmUgYSBsaXR0bGUgd3JhcHBlciBwcm9taXNlIHRoYXQgd2lsbCBiZSBleHRlbmRlZCB3aXRoCiAgICAgICAgICAgICAgICAvLyBfZGF0YS9fZXJyb3IgcHJvcHMgdXBvbiByZXNvbHZlL3JlamVjdAoKICAgICAgICAgICAgICAgIHZhciBwcm9taXNlID0gUHJvbWlzZS5yYWNlKFt2YWx1ZSwgdGhpcy5hYm9ydFByb21pc2VdKS50aGVuKChkYXRhKSA9PiB0aGlzLm9uU2V0dGxlKHByb21pc2UsIGtleSwgbnVsbCwgZGF0YSksIChlcnJvcikgPT4gdGhpcy5vblNldHRsZShwcm9taXNlLCBrZXksIGVycm9yKSk7IC8vIFJlZ2lzdGVyIHJlamVjdGlvbiBsaXN0ZW5lcnMgdG8gYXZvaWQgdW5jYXVnaHQgcHJvbWlzZSByZWplY3Rpb25zIG9uCiAgICAgICAgICAgICAgICAvLyBlcnJvcnMgb3IgYWJvcnRlZCBkZWZlcnJlZCB2YWx1ZXMKCiAgICAgICAgICAgICAgICBwcm9taXNlLmNhdGNoKCgpID0+IHt9KTsKICAgICAgICAgICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShwcm9taXNlLCAiX3RyYWNrZWQiLCB7CiAgICAgICAgICAgICAgICAgIGdldDogKCkgPT4gdHJ1ZQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICByZXR1cm4gcHJvbWlzZTsKICAgICAgICAgICAgICB9IH0sIHsga2V5OiAib25TZXR0bGUiLCB2YWx1ZToKCiAgICAgICAgICAgICAgZnVuY3Rpb24gb25TZXR0bGUocHJvbWlzZSwga2V5LCBlcnJvciwgZGF0YSkgewogICAgICAgICAgICAgICAgaWYgKHRoaXMuY29udHJvbGxlci5zaWduYWwuYWJvcnRlZCAmJiBlcnJvciBpbnN0YW5jZW9mIHJvdXRlcl9BYm9ydGVkRGVmZXJyZWRFcnJvcikgewogICAgICAgICAgICAgICAgICB0aGlzLnVubGlzdGVuQWJvcnRTaWduYWwoKTsKICAgICAgICAgICAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHByb21pc2UsICJfZXJyb3IiLCB7CiAgICAgICAgICAgICAgICAgICAgZ2V0OiAoKSA9PiBlcnJvcgogICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KGVycm9yKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICB0aGlzLnBlbmRpbmdLZXlzLmRlbGV0ZShrZXkpOwoKICAgICAgICAgICAgICAgIGlmICh0aGlzLmRvbmUpIHsKICAgICAgICAgICAgICAgICAgLy8gTm90aGluZyBsZWZ0IHRvIGFib3J0IQogICAgICAgICAgICAgICAgICB0aGlzLnVubGlzdGVuQWJvcnRTaWduYWwoKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICB2YXIgc3Vic2NyaWJlciA9IHRoaXMuc3Vic2NyaWJlcjsKCiAgICAgICAgICAgICAgICBpZiAoZXJyb3IpIHsKICAgICAgICAgICAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHByb21pc2UsICJfZXJyb3IiLCB7CiAgICAgICAgICAgICAgICAgICAgZ2V0OiAoKSA9PiBlcnJvcgogICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgc3Vic2NyaWJlciAmJiBzdWJzY3JpYmVyKGZhbHNlKTsKICAgICAgICAgICAgICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KGVycm9yKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkocHJvbWlzZSwgIl9kYXRhIiwgewogICAgICAgICAgICAgICAgICBnZXQ6ICgpID0+IGRhdGEKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgc3Vic2NyaWJlciAmJiBzdWJzY3JpYmVyKGZhbHNlKTsKICAgICAgICAgICAgICAgIHJldHVybiBkYXRhOwogICAgICAgICAgICAgIH0gfSwgeyBrZXk6ICJzdWJzY3JpYmUiLCB2YWx1ZToKCiAgICAgICAgICAgICAgZnVuY3Rpb24gc3Vic2NyaWJlKGZuKSB7CiAgICAgICAgICAgICAgICB0aGlzLnN1YnNjcmliZXIgPSBmbjsKICAgICAgICAgICAgICB9IH0sIHsga2V5OiAiY2FuY2VsIiwgdmFsdWU6CgogICAgICAgICAgICAgIGZ1bmN0aW9uIGNhbmNlbCgpIHsKICAgICAgICAgICAgICAgIHRoaXMuY29udHJvbGxlci5hYm9ydCgpOwogICAgICAgICAgICAgICAgdGhpcy5wZW5kaW5nS2V5cy5mb3JFYWNoKCh2LCBrKSA9PiB0aGlzLnBlbmRpbmdLZXlzLmRlbGV0ZShrKSk7CiAgICAgICAgICAgICAgICB2YXIgc3Vic2NyaWJlciA9IHRoaXMuc3Vic2NyaWJlcjsKICAgICAgICAgICAgICAgIHN1YnNjcmliZXIgJiYgc3Vic2NyaWJlcih0cnVlKTsKICAgICAgICAgICAgICB9IH0sIHsga2V5OiAicmVzb2x2ZURhdGEiLCB2YWx1ZTogZnVuY3Rpb24gKCkge3ZhciBfcmVzb2x2ZURhdGEgPSBfYXN5bmNUb0dlbmVyYXRvcjIoIC8qI19fUFVSRV9fKi9fcmVnZW5lcmF0b3JSdW50aW1lMigpLm1hcmsoCgogICAgICAgICAgICAgICAgZnVuY3Rpb24gX2NhbGxlZTQoc2lnbmFsKSB7dmFyIGFib3J0ZWQsIG9uQWJvcnQ7cmV0dXJuIF9yZWdlbmVyYXRvclJ1bnRpbWUyKCkud3JhcChmdW5jdGlvbiBfY2FsbGVlNCQoX2NvbnRleHQ0KSB7d2hpbGUgKDEpIHtzd2l0Y2ggKF9jb250ZXh0NC5wcmV2ID0gX2NvbnRleHQ0Lm5leHQpIHtjYXNlIDA6CiAgICAgICAgICAgICAgICAgICAgICAgICAgYWJvcnRlZCA9IGZhbHNlO2lmICgKCiAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5kb25lKSB7X2NvbnRleHQ0Lm5leHQgPSA3O2JyZWFrO30KICAgICAgICAgICAgICAgICAgICAgICAgICBvbkFib3J0ID0gKCkgPT4gdGhpcy5jYW5jZWwoKTsKCiAgICAgICAgICAgICAgICAgICAgICAgICAgc2lnbmFsLmFkZEV2ZW50TGlzdGVuZXIoImFib3J0Iiwgb25BYm9ydCk7X2NvbnRleHQ0Lm5leHQgPSA2O3JldHVybiAoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnN1YnNjcmliZSgoYWJvcnRlZCkgPT4gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNpZ25hbC5yZW1vdmVFdmVudExpc3RlbmVyKCJhYm9ydCIsIG9uQWJvcnQpOwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoYWJvcnRlZCB8fCB0aGlzLmRvbmUpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUoYWJvcnRlZCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pKTtjYXNlIDY6YWJvcnRlZCA9IF9jb250ZXh0NC5zZW50O2Nhc2UgNzpyZXR1cm4gX2NvbnRleHQ0LmFicnVwdCgicmV0dXJuIiwKCgogICAgICAgICAgICAgICAgICAgICAgICAgIGFib3J0ZWQpO2Nhc2UgODpjYXNlICJlbmQiOnJldHVybiBfY29udGV4dDQuc3RvcCgpO319fSwgX2NhbGxlZTQsIHRoaXMpO30pKTtmdW5jdGlvbiByZXNvbHZlRGF0YShfeDUpIHtyZXR1cm4gX3Jlc29sdmVEYXRhLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7fXJldHVybiByZXNvbHZlRGF0YTt9KCkgfSwgeyBrZXk6ICJkb25lIiwgZ2V0OgoKCiAgICAgICAgICAgICAgZnVuY3Rpb24gZ2V0KCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMucGVuZGluZ0tleXMuc2l6ZSA9PT0gMDsKICAgICAgICAgICAgICB9IH0sIHsga2V5OiAidW53cmFwcGVkRGF0YSIsIGdldDoKCiAgICAgICAgICAgICAgZnVuY3Rpb24gZ2V0KCkgewogICAgICAgICAgICAgICAgcm91dGVyX2ludmFyaWFudCh0aGlzLmRhdGEgIT09IG51bGwgJiYgdGhpcy5kb25lLCAiQ2FuIG9ubHkgdW53cmFwIGRhdGEgb24gaW5pdGlhbGl6ZWQgYW5kIHNldHRsZWQgZGVmZXJyZWRzIik7CiAgICAgICAgICAgICAgICByZXR1cm4gT2JqZWN0LmVudHJpZXModGhpcy5kYXRhKS5yZWR1Y2UoKGFjYywgX3JlZjIpID0+IHsKICAgICAgICAgICAgICAgICAgdmFyIF9yZWYxMyA9IF9zbGljZWRUb0FycmF5MihfcmVmMiwgMiksa2V5ID0gX3JlZjEzWzBdLHZhbHVlID0gX3JlZjEzWzFdOwogICAgICAgICAgICAgICAgICByZXR1cm4gT2JqZWN0LmFzc2lnbihhY2MsIF9kZWZpbmVQcm9wZXJ0eTIoe30sCiAgICAgICAgICAgICAgICAgIGtleSwgdW53cmFwVHJhY2tlZFByb21pc2UodmFsdWUpKSk7CgogICAgICAgICAgICAgICAgfSwge30pOwogICAgICAgICAgICAgIH0gfV0pO3JldHVybiBEZWZlcnJlZERhdGE7fSgpOwoKCgogICAgICAgICAgZnVuY3Rpb24gaXNUcmFja2VkUHJvbWlzZSh2YWx1ZSkgewogICAgICAgICAgICByZXR1cm4gdmFsdWUgaW5zdGFuY2VvZiBQcm9taXNlICYmIHZhbHVlLl90cmFja2VkID09PSB0cnVlOwogICAgICAgICAgfQoKICAgICAgICAgIGZ1bmN0aW9uIHVud3JhcFRyYWNrZWRQcm9taXNlKHZhbHVlKSB7CiAgICAgICAgICAgIGlmICghaXNUcmFja2VkUHJvbWlzZSh2YWx1ZSkpIHsKICAgICAgICAgICAgICByZXR1cm4gdmFsdWU7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmICh2YWx1ZS5fZXJyb3IpIHsKICAgICAgICAgICAgICB0aHJvdyB2YWx1ZS5fZXJyb3I7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybiB2YWx1ZS5fZGF0YTsKICAgICAgICAgIH0KCiAgICAgICAgICBmdW5jdGlvbiBkZWZlcihkYXRhKSB7CiAgICAgICAgICAgIHJldHVybiBuZXcgRGVmZXJyZWREYXRhKGRhdGEpOwogICAgICAgICAgfQogICAgICAgICAgLyoqCiAgICAgICAgICAgKiBBIHJlZGlyZWN0IHJlc3BvbnNlLiBTZXRzIHRoZSBzdGF0dXMgY29kZSBhbmQgdGhlIGBMb2NhdGlvbmAgaGVhZGVyLgogICAgICAgICAgICogRGVmYXVsdHMgdG8gIjMwMiBGb3VuZCIuCiAgICAgICAgICAgKi8KCiAgICAgICAgICB2YXIgcmVkaXJlY3QgPSBmdW5jdGlvbiByZWRpcmVjdCh1cmwsIGluaXQpIHsKICAgICAgICAgICAgaWYgKGluaXQgPT09IHZvaWQgMCkgewogICAgICAgICAgICAgIGluaXQgPSAzMDI7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHZhciByZXNwb25zZUluaXQgPSBpbml0OwoKICAgICAgICAgICAgaWYgKHR5cGVvZiByZXNwb25zZUluaXQgPT09ICJudW1iZXIiKSB7CiAgICAgICAgICAgICAgcmVzcG9uc2VJbml0ID0gewogICAgICAgICAgICAgICAgc3RhdHVzOiByZXNwb25zZUluaXQKICAgICAgICAgICAgICB9OwogICAgICAgICAgICB9IGVsc2UgaWYgKHR5cGVvZiByZXNwb25zZUluaXQuc3RhdHVzID09PSAidW5kZWZpbmVkIikgewogICAgICAgICAgICAgIHJlc3BvbnNlSW5pdC5zdGF0dXMgPSAzMDI7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHZhciBoZWFkZXJzID0gbmV3IEhlYWRlcnMocmVzcG9uc2VJbml0LmhlYWRlcnMpOwogICAgICAgICAgICBoZWFkZXJzLnNldCgiTG9jYXRpb24iLCB1cmwpOwogICAgICAgICAgICByZXR1cm4gbmV3IFJlc3BvbnNlKG51bGwsIF9leHRlbmRzKHt9LCByZXNwb25zZUluaXQsIHsKICAgICAgICAgICAgICBoZWFkZXJzOiBoZWFkZXJzCiAgICAgICAgICAgIH0pKTsKICAgICAgICAgIH07CiAgICAgICAgICAvKioKICAgICAgICAgICAqIEBwcml2YXRlCiAgICAgICAgICAgKiBVdGlsaXR5IGNsYXNzIHdlIHVzZSB0byBob2xkIGF1dG8tdW53cmFwcGVkIDR4eC81eHggUmVzcG9uc2UgYm9kaWVzCiAgICAgICAgICAgKi92YXIKCiAgICAgICAgICByb3V0ZXJfRXJyb3JSZXNwb25zZSA9IC8qI19fUFVSRV9fKi9fY3JlYXRlQ2xhc3MyKAogICAgICAgICAgZnVuY3Rpb24gcm91dGVyX0Vycm9yUmVzcG9uc2Uoc3RhdHVzLCBzdGF0dXNUZXh0LCBkYXRhLCBpbnRlcm5hbCkge19jbGFzc0NhbGxDaGVjazIodGhpcywgcm91dGVyX0Vycm9yUmVzcG9uc2UpOwogICAgICAgICAgICBpZiAoaW50ZXJuYWwgPT09IHZvaWQgMCkgewogICAgICAgICAgICAgIGludGVybmFsID0gZmFsc2U7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHRoaXMuc3RhdHVzID0gc3RhdHVzOwogICAgICAgICAgICB0aGlzLnN0YXR1c1RleHQgPSBzdGF0dXNUZXh0IHx8ICIiOwogICAgICAgICAgICB0aGlzLmludGVybmFsID0gaW50ZXJuYWw7CgogICAgICAgICAgICBpZiAoZGF0YSBpbnN0YW5jZW9mIEVycm9yKSB7CiAgICAgICAgICAgICAgdGhpcy5kYXRhID0gZGF0YS50b1N0cmluZygpOwogICAgICAgICAgICAgIHRoaXMuZXJyb3IgPSBkYXRhOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIHRoaXMuZGF0YSA9IGRhdGE7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0pOwoKCiAgICAgICAgICAvKioKICAgICAgICAgICAqIENoZWNrIGlmIHRoZSBnaXZlbiBlcnJvciBpcyBhbiBFcnJvclJlc3BvbnNlIGdlbmVyYXRlZCBmcm9tIGEgNHh4LzV4eAogICAgICAgICAgICogUmVzcG9uc2UgdGhyb3cgZnJvbSBhbiBhY3Rpb24vbG9hZGVyCiAgICAgICAgICAgKi8KCiAgICAgICAgICBmdW5jdGlvbiBpc1JvdXRlRXJyb3JSZXNwb25zZShlKSB7CiAgICAgICAgICAgIHJldHVybiBlIGluc3RhbmNlb2Ygcm91dGVyX0Vycm9yUmVzcG9uc2U7CiAgICAgICAgICB9CgogICAgICAgICAgdmFyIHZhbGlkQWN0aW9uTWV0aG9kc0FyciA9IFsicG9zdCIsICJwdXQiLCAicGF0Y2giLCAiZGVsZXRlIl07CiAgICAgICAgICB2YXIgdmFsaWRBY3Rpb25NZXRob2RzID0gbmV3IFNldCh2YWxpZEFjdGlvbk1ldGhvZHNBcnIpOwogICAgICAgICAgdmFyIHZhbGlkUmVxdWVzdE1ldGhvZHNBcnIgPSBbImdldCJdLmNvbmNhdCh2YWxpZEFjdGlvbk1ldGhvZHNBcnIpOwogICAgICAgICAgdmFyIHZhbGlkUmVxdWVzdE1ldGhvZHMgPSBuZXcgU2V0KHZhbGlkUmVxdWVzdE1ldGhvZHNBcnIpOwogICAgICAgICAgdmFyIHJlZGlyZWN0U3RhdHVzQ29kZXMgPSBuZXcgU2V0KFszMDEsIDMwMiwgMzAzLCAzMDcsIDMwOF0pOwogICAgICAgICAgdmFyIHJlZGlyZWN0UHJlc2VydmVNZXRob2RTdGF0dXNDb2RlcyA9IG5ldyBTZXQoWzMwNywgMzA4XSk7CiAgICAgICAgICB2YXIgSURMRV9OQVZJR0FUSU9OID0gewogICAgICAgICAgICBzdGF0ZTogImlkbGUiLAogICAgICAgICAgICBsb2NhdGlvbjogdW5kZWZpbmVkLAogICAgICAgICAgICBmb3JtTWV0aG9kOiB1bmRlZmluZWQsCiAgICAgICAgICAgIGZvcm1BY3Rpb246IHVuZGVmaW5lZCwKICAgICAgICAgICAgZm9ybUVuY1R5cGU6IHVuZGVmaW5lZCwKICAgICAgICAgICAgZm9ybURhdGE6IHVuZGVmaW5lZAogICAgICAgICAgfTsKICAgICAgICAgIHZhciBJRExFX0ZFVENIRVIgPSB7CiAgICAgICAgICAgIHN0YXRlOiAiaWRsZSIsCiAgICAgICAgICAgIGRhdGE6IHVuZGVmaW5lZCwKICAgICAgICAgICAgZm9ybU1ldGhvZDogdW5kZWZpbmVkLAogICAgICAgICAgICBmb3JtQWN0aW9uOiB1bmRlZmluZWQsCiAgICAgICAgICAgIGZvcm1FbmNUeXBlOiB1bmRlZmluZWQsCiAgICAgICAgICAgIGZvcm1EYXRhOiB1bmRlZmluZWQKICAgICAgICAgIH07CiAgICAgICAgICB2YXIgaXNCcm93c2VyID0gdHlwZW9mIHdpbmRvdyAhPT0gInVuZGVmaW5lZCIgJiYgdHlwZW9mIHdpbmRvdy5kb2N1bWVudCAhPT0gInVuZGVmaW5lZCIgJiYgdHlwZW9mIHdpbmRvdy5kb2N1bWVudC5jcmVhdGVFbGVtZW50ICE9PSAidW5kZWZpbmVkIjsKICAgICAgICAgIHZhciBpc1NlcnZlciA9ICFpc0Jyb3dzZXI7IC8vI2VuZHJlZ2lvbgogICAgICAgICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KICAgICAgICAgIC8vI3JlZ2lvbiBjcmVhdGVSb3V0ZXIKICAgICAgICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCgogICAgICAgICAgLyoqCiAgICAgICAgICAgKiBDcmVhdGUgYSByb3V0ZXIgYW5kIGxpc3RlbiB0byBoaXN0b3J5IFBPUCBuYXZpZ2F0aW9ucwogICAgICAgICAgICovCgogICAgICAgICAgZnVuY3Rpb24gcm91dGVyX2NyZWF0ZVJvdXRlcihpbml0KSB7CiAgICAgICAgICAgIHJvdXRlcl9pbnZhcmlhbnQoaW5pdC5yb3V0ZXMubGVuZ3RoID4gMCwgIllvdSBtdXN0IHByb3ZpZGUgYSBub24tZW1wdHkgcm91dGVzIGFycmF5IHRvIGNyZWF0ZVJvdXRlciIpOwogICAgICAgICAgICB2YXIgZGF0YVJvdXRlcyA9IGNvbnZlcnRSb3V0ZXNUb0RhdGFSb3V0ZXMoaW5pdC5yb3V0ZXMpOyAvLyBDbGVhbnVwIGZ1bmN0aW9uIGZvciBoaXN0b3J5CgogICAgICAgICAgICB2YXIgdW5saXN0ZW5IaXN0b3J5ID0gbnVsbDsgLy8gRXh0ZXJuYWxseS1wcm92aWRlZCBmdW5jdGlvbnMgdG8gY2FsbCBvbiBhbGwgc3RhdGUgY2hhbmdlcwoKICAgICAgICAgICAgdmFyIHN1YnNjcmliZXJzID0gbmV3IFNldCgpOyAvLyBFeHRlcm5hbGx5LXByb3ZpZGVkIG9iamVjdCB0byBob2xkIHNjcm9sbCByZXN0b3JhdGlvbiBsb2NhdGlvbnMgZHVyaW5nIHJvdXRpbmcKCiAgICAgICAgICAgIHZhciBzYXZlZFNjcm9sbFBvc2l0aW9ucyA9IG51bGw7IC8vIEV4dGVybmFsbHktcHJvdmlkZWQgZnVuY3Rpb24gdG8gZ2V0IHNjcm9sbCByZXN0b3JhdGlvbiBrZXlzCgogICAgICAgICAgICB2YXIgZ2V0U2Nyb2xsUmVzdG9yYXRpb25LZXkgPSBudWxsOyAvLyBFeHRlcm5hbGx5LXByb3ZpZGVkIGZ1bmN0aW9uIHRvIGdldCBjdXJyZW50IHNjcm9sbCBwb3NpdGlvbgoKICAgICAgICAgICAgdmFyIGdldFNjcm9sbFBvc2l0aW9uID0gbnVsbDsgLy8gT25lLXRpbWUgZmxhZyB0byBjb250cm9sIHRoZSBpbml0aWFsIGh5ZHJhdGlvbiBzY3JvbGwgcmVzdG9yYXRpb24uICBCZWNhdXNlCiAgICAgICAgICAgIC8vIHdlIGRvbid0IGdldCB0aGUgc2F2ZWQgcG9zaXRpb25zIGZyb20gPFNjcm9sbFJlc3RvcmF0aW9uIC8+IHVudGlsIF9hZnRlcl8KICAgICAgICAgICAgLy8gdGhlIGluaXRpYWwgcmVuZGVyLCB3ZSBuZWVkIHRvIG1hbnVhbGx5IHRyaWdnZXIgYSBzZXBhcmF0ZSB1cGRhdGVTdGF0ZSB0bwogICAgICAgICAgICAvLyBzZW5kIGFsb25nIHRoZSByZXN0b3JlU2Nyb2xsUG9zaXRpb24KCiAgICAgICAgICAgIHZhciBpbml0aWFsU2Nyb2xsUmVzdG9yZWQgPSBmYWxzZTsKICAgICAgICAgICAgdmFyIGluaXRpYWxNYXRjaGVzID0gbWF0Y2hSb3V0ZXMoZGF0YVJvdXRlcywgaW5pdC5oaXN0b3J5LmxvY2F0aW9uLCBpbml0LmJhc2VuYW1lKTsKICAgICAgICAgICAgdmFyIGluaXRpYWxFcnJvcnMgPSBudWxsOwoKICAgICAgICAgICAgaWYgKGluaXRpYWxNYXRjaGVzID09IG51bGwpIHsKICAgICAgICAgICAgICAvLyBJZiB3ZSBkbyBub3QgbWF0Y2ggYSB1c2VyLXByb3ZpZGVkLXJvdXRlLCBmYWxsIGJhY2sgdG8gdGhlIHJvb3QKICAgICAgICAgICAgICAvLyB0byBhbGxvdyB0aGUgZXJyb3IgYm91bmRhcnkgdG8gdGFrZSBvdmVyCiAgICAgICAgICAgICAgdmFyIGVycm9yID0gZ2V0SW50ZXJuYWxSb3V0ZXJFcnJvcig0MDQsIHsKICAgICAgICAgICAgICAgIHBhdGhuYW1lOiBpbml0Lmhpc3RvcnkubG9jYXRpb24ucGF0aG5hbWUKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICB2YXIgX2dldFNob3J0Q2lyY3VpdE1hdGNoID0KCgogICAgICAgICAgICAgICAgZ2V0U2hvcnRDaXJjdWl0TWF0Y2hlcyhkYXRhUm91dGVzKSxtYXRjaGVzID0gX2dldFNob3J0Q2lyY3VpdE1hdGNoLm1hdGNoZXMscm91dGUgPSBfZ2V0U2hvcnRDaXJjdWl0TWF0Y2gucm91dGU7CiAgICAgICAgICAgICAgaW5pdGlhbE1hdGNoZXMgPSBtYXRjaGVzOwogICAgICAgICAgICAgIGluaXRpYWxFcnJvcnMgPSBfZGVmaW5lUHJvcGVydHkyKHt9LAogICAgICAgICAgICAgIHJvdXRlLmlkLCBlcnJvcik7CgogICAgICAgICAgICB9CgogICAgICAgICAgICB2YXIgaW5pdGlhbGl6ZWQgPSAhaW5pdGlhbE1hdGNoZXMuc29tZSgobSkgPT4gbS5yb3V0ZS5sb2FkZXIpIHx8IGluaXQuaHlkcmF0aW9uRGF0YSAhPSBudWxsOwogICAgICAgICAgICB2YXIgcm91dGVyOwogICAgICAgICAgICB2YXIgc3RhdGUgPSB7CiAgICAgICAgICAgICAgaGlzdG9yeUFjdGlvbjogaW5pdC5oaXN0b3J5LmFjdGlvbiwKICAgICAgICAgICAgICBsb2NhdGlvbjogaW5pdC5oaXN0b3J5LmxvY2F0aW9uLAogICAgICAgICAgICAgIG1hdGNoZXM6IGluaXRpYWxNYXRjaGVzLAogICAgICAgICAgICAgIGluaXRpYWxpemVkOiBpbml0aWFsaXplZCwKICAgICAgICAgICAgICBuYXZpZ2F0aW9uOiBJRExFX05BVklHQVRJT04sCiAgICAgICAgICAgICAgcmVzdG9yZVNjcm9sbFBvc2l0aW9uOiBudWxsLAogICAgICAgICAgICAgIHByZXZlbnRTY3JvbGxSZXNldDogZmFsc2UsCiAgICAgICAgICAgICAgcmV2YWxpZGF0aW9uOiAiaWRsZSIsCiAgICAgICAgICAgICAgbG9hZGVyRGF0YTogaW5pdC5oeWRyYXRpb25EYXRhICYmIGluaXQuaHlkcmF0aW9uRGF0YS5sb2FkZXJEYXRhIHx8IHt9LAogICAgICAgICAgICAgIGFjdGlvbkRhdGE6IGluaXQuaHlkcmF0aW9uRGF0YSAmJiBpbml0Lmh5ZHJhdGlvbkRhdGEuYWN0aW9uRGF0YSB8fCBudWxsLAogICAgICAgICAgICAgIGVycm9yczogaW5pdC5oeWRyYXRpb25EYXRhICYmIGluaXQuaHlkcmF0aW9uRGF0YS5lcnJvcnMgfHwgaW5pdGlhbEVycm9ycywKICAgICAgICAgICAgICBmZXRjaGVyczogbmV3IE1hcCgpCiAgICAgICAgICAgIH07IC8vIC0tIFN0YXRlZnVsIGludGVybmFsIHZhcmlhYmxlcyB0byBtYW5hZ2UgbmF2aWdhdGlvbnMgLS0KICAgICAgICAgICAgLy8gQ3VycmVudCBuYXZpZ2F0aW9uIGluIHByb2dyZXNzICh0byBiZSBjb21taXR0ZWQgaW4gY29tcGxldGVOYXZpZ2F0aW9uKQoKICAgICAgICAgICAgdmFyIHBlbmRpbmdBY3Rpb24gPSBBY3Rpb24uUG9wOyAvLyBTaG91bGQgdGhlIGN1cnJlbnQgbmF2aWdhdGlvbiBwcmV2ZW50IHRoZSBzY3JvbGwgcmVzZXQgaWYgc2Nyb2xsIGNhbm5vdAogICAgICAgICAgICAvLyBiZSByZXN0b3JlZD8KCiAgICAgICAgICAgIHZhciBwZW5kaW5nUHJldmVudFNjcm9sbFJlc2V0ID0gZmFsc2U7IC8vIEFib3J0Q29udHJvbGxlciBmb3IgdGhlIGFjdGl2ZSBuYXZpZ2F0aW9uCgogICAgICAgICAgICB2YXIgcGVuZGluZ05hdmlnYXRpb25Db250cm9sbGVyOyAvLyBXZSB1c2UgdGhpcyB0byBhdm9pZCB0b3VjaGluZyBoaXN0b3J5IGluIGNvbXBsZXRlTmF2aWdhdGlvbiBpZiBhCiAgICAgICAgICAgIC8vIHJldmFsaWRhdGlvbiBpcyBlbnRpcmVseSB1bmludGVycnVwdGVkCgogICAgICAgICAgICB2YXIgaXNVbmludGVycnVwdGVkUmV2YWxpZGF0aW9uID0gZmFsc2U7IC8vIFVzZSB0aGlzIGludGVybmFsIGZsYWcgdG8gZm9yY2UgcmV2YWxpZGF0aW9uIG9mIGFsbCBsb2FkZXJzOgogICAgICAgICAgICAvLyAgLSBzdWJtaXNzaW9ucyAoY29tcGxldGVkIG9yIGludGVycnVwdGVkKQogICAgICAgICAgICAvLyAgLSB1c2VSZXZhbGlkYXRlKCkKICAgICAgICAgICAgLy8gIC0gWC1SZW1peC1SZXZhbGlkYXRlIChmcm9tIHJlZGlyZWN0KQoKICAgICAgICAgICAgdmFyIGlzUmV2YWxpZGF0aW9uUmVxdWlyZWQgPSBmYWxzZTsgLy8gVXNlIHRoaXMgaW50ZXJuYWwgYXJyYXkgdG8gY2FwdHVyZSByb3V0ZXMgdGhhdCByZXF1aXJlIHJldmFsaWRhdGlvbiBkdWUKICAgICAgICAgICAgLy8gdG8gYSBjYW5jZWxsZWQgZGVmZXJyZWQgb24gYWN0aW9uIHN1Ym1pc3Npb24KCiAgICAgICAgICAgIHZhciBjYW5jZWxsZWREZWZlcnJlZFJvdXRlcyA9IFtdOyAvLyBVc2UgdGhpcyBpbnRlcm5hbCBhcnJheSB0byBjYXB0dXJlIGZldGNoZXIgbG9hZHMgdGhhdCB3ZXJlIGNhbmNlbGxlZCBieSBhbgogICAgICAgICAgICAvLyBhY3Rpb24gbmF2aWdhdGlvbiBhbmQgcmVxdWlyZSByZXZhbGlkYXRpb24KCiAgICAgICAgICAgIHZhciBjYW5jZWxsZWRGZXRjaGVyTG9hZHMgPSBbXTsgLy8gQWJvcnRDb250cm9sbGVycyBmb3IgYW55IGluLWZsaWdodCBmZXRjaGVycwoKICAgICAgICAgICAgdmFyIGZldGNoQ29udHJvbGxlcnMgPSBuZXcgTWFwKCk7IC8vIFRyYWNrIGxvYWRzIGJhc2VkIG9uIHRoZSBvcmRlciBpbiB3aGljaCB0aGV5IHN0YXJ0ZWQKCiAgICAgICAgICAgIHZhciBpbmNyZW1lbnRpbmdMb2FkSWQgPSAwOyAvLyBUcmFjayB0aGUgb3V0c3RhbmRpbmcgcGVuZGluZyBuYXZpZ2F0aW9uIGRhdGEgbG9hZCB0byBiZSBjb21wYXJlZCBhZ2FpbnN0CiAgICAgICAgICAgIC8vIHRoZSBnbG9iYWxseSBpbmNyZW1lbnRpbmcgbG9hZCB3aGVuIGEgZmV0Y2hlciBsb2FkIGxhbmRzIGFmdGVyIGEgY29tcGxldGVkCiAgICAgICAgICAgIC8vIG5hdmlnYXRpb24KCiAgICAgICAgICAgIHZhciBwZW5kaW5nTmF2aWdhdGlvbkxvYWRJZCA9IC0xOyAvLyBGZXRjaGVycyB0aGF0IHRyaWdnZXJlZCBkYXRhIHJlbG9hZHMgYXMgYSByZXN1bHQgb2YgdGhlaXIgYWN0aW9ucwoKICAgICAgICAgICAgdmFyIGZldGNoUmVsb2FkSWRzID0gbmV3IE1hcCgpOyAvLyBGZXRjaGVycyB0aGF0IHRyaWdnZXJlZCByZWRpcmVjdCBuYXZpZ2F0aW9ucyBmcm9tIHRoZWlyIGFjdGlvbnMKCiAgICAgICAgICAgIHZhciBmZXRjaFJlZGlyZWN0SWRzID0gbmV3IFNldCgpOyAvLyBNb3N0IHJlY2VudCBocmVmL21hdGNoIGZvciBmZXRjaGVyLmxvYWQgY2FsbHMgZm9yIGZldGNoZXJzCgogICAgICAgICAgICB2YXIgZmV0Y2hMb2FkTWF0Y2hlcyA9IG5ldyBNYXAoKTsgLy8gU3RvcmUgRGVmZXJyZWREYXRhIGluc3RhbmNlcyBmb3IgYWN0aXZlIHJvdXRlIG1hdGNoZXMuICBXaGVuIGEKICAgICAgICAgICAgLy8gcm91dGUgbG9hZGVyIHJldHVybnMgZGVmZXIoKSB3ZSBzdGljayBvbmUgaW4gaGVyZS4gIFRoZW4sIHdoZW4gYSBuZXN0ZWQKICAgICAgICAgICAgLy8gcHJvbWlzZSByZXNvbHZlcyB3ZSB1cGRhdGUgbG9hZGVyRGF0YS4gIElmIGEgbmV3IG5hdmlnYXRpb24gc3RhcnRzIHdlCiAgICAgICAgICAgIC8vIGNhbmNlbCBhY3RpdmUgZGVmZXJyZWRzIGZvciBlbGltaW5hdGVkIHJvdXRlcy4KCiAgICAgICAgICAgIHZhciBhY3RpdmVEZWZlcnJlZHMgPSBuZXcgTWFwKCk7IC8vIEluaXRpYWxpemUgdGhlIHJvdXRlciwgYWxsIHNpZGUgZWZmZWN0cyBzaG91bGQgYmUga2lja2VkIG9mZiBmcm9tIGhlcmUuCiAgICAgICAgICAgIC8vIEltcGxlbWVudGVkIGFzIGEgRmx1ZW50IEFQSSBmb3IgZWFzZSBvZjoKICAgICAgICAgICAgLy8gICBsZXQgcm91dGVyID0gY3JlYXRlUm91dGVyKGluaXQpLmluaXRpYWxpemUoKTsKCiAgICAgICAgICAgIGZ1bmN0aW9uIGluaXRpYWxpemUoKSB7CiAgICAgICAgICAgICAgLy8gSWYgaGlzdG9yeSBpbmZvcm1zIHVzIG9mIGEgUE9QIG5hdmlnYXRpb24sIHN0YXJ0IHRoZSBuYXZpZ2F0aW9uIGJ1dCBkbyBub3QgdXBkYXRlCiAgICAgICAgICAgICAgLy8gc3RhdGUuICBXZSdsbCB1cGRhdGUgb3VyIG93biBzdGF0ZSBvbmNlIHRoZSBuYXZpZ2F0aW9uIGNvbXBsZXRlcwogICAgICAgICAgICAgIHVubGlzdGVuSGlzdG9yeSA9IGluaXQuaGlzdG9yeS5saXN0ZW4oKF9yZWYpID0+IHsKICAgICAgICAgICAgICAgIHZhcgogICAgICAgICAgICAgICAgICBoaXN0b3J5QWN0aW9uID0KCiAgICAgICAgICAgICAgICAgIF9yZWYuYWN0aW9uLGxvY2F0aW9uID0gX3JlZi5sb2NhdGlvbjsKICAgICAgICAgICAgICAgIHJldHVybiBzdGFydE5hdmlnYXRpb24oaGlzdG9yeUFjdGlvbiwgbG9jYXRpb24pOwogICAgICAgICAgICAgIH0pOyAvLyBLaWNrIG9mZiBpbml0aWFsIGRhdGEgbG9hZCBpZiBuZWVkZWQuICBVc2UgUG9wIHRvIGF2b2lkIG1vZGlmeWluZyBoaXN0b3J5CgogICAgICAgICAgICAgIGlmICghc3RhdGUuaW5pdGlhbGl6ZWQpIHsKICAgICAgICAgICAgICAgIHN0YXJ0TmF2aWdhdGlvbihBY3Rpb24uUG9wLCBzdGF0ZS5sb2NhdGlvbik7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICByZXR1cm4gcm91dGVyOwogICAgICAgICAgICB9IC8vIENsZWFuIHVwIGEgcm91dGVyIGFuZCBpdCdzIHNpZGUgZWZmZWN0cwoKCiAgICAgICAgICAgIGZ1bmN0aW9uIGRpc3Bvc2UoKSB7CiAgICAgICAgICAgICAgaWYgKHVubGlzdGVuSGlzdG9yeSkgewogICAgICAgICAgICAgICAgdW5saXN0ZW5IaXN0b3J5KCk7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBzdWJzY3JpYmVycy5jbGVhcigpOwogICAgICAgICAgICAgIHBlbmRpbmdOYXZpZ2F0aW9uQ29udHJvbGxlciAmJiBwZW5kaW5nTmF2aWdhdGlvbkNvbnRyb2xsZXIuYWJvcnQoKTsKICAgICAgICAgICAgICBzdGF0ZS5mZXRjaGVycy5mb3JFYWNoKChfLCBrZXkpID0+IGRlbGV0ZUZldGNoZXIoa2V5KSk7CiAgICAgICAgICAgIH0gLy8gU3Vic2NyaWJlIHRvIHN0YXRlIHVwZGF0ZXMgZm9yIHRoZSByb3V0ZXIKCgogICAgICAgICAgICBmdW5jdGlvbiBzdWJzY3JpYmUoZm4pIHsKICAgICAgICAgICAgICBzdWJzY3JpYmVycy5hZGQoZm4pOwogICAgICAgICAgICAgIHJldHVybiAoKSA9PiBzdWJzY3JpYmVycy5kZWxldGUoZm4pOwogICAgICAgICAgICB9IC8vIFVwZGF0ZSBvdXIgc3RhdGUgYW5kIG5vdGlmeSB0aGUgY2FsbGluZyBjb250ZXh0IG9mIHRoZSBjaGFuZ2UKCgogICAgICAgICAgICBmdW5jdGlvbiB1cGRhdGVTdGF0ZShuZXdTdGF0ZSkgewogICAgICAgICAgICAgIHN0YXRlID0gX2V4dGVuZHMoe30sIHN0YXRlLCBuZXdTdGF0ZSk7CiAgICAgICAgICAgICAgc3Vic2NyaWJlcnMuZm9yRWFjaCgoc3Vic2NyaWJlcikgPT4gc3Vic2NyaWJlcihzdGF0ZSkpOwogICAgICAgICAgICB9IC8vIENvbXBsZXRlIGEgbmF2aWdhdGlvbiByZXR1cm5pbmcgdGhlIHN0YXRlLm5hdmlnYXRpb24gYmFjayB0byB0aGUgSURMRV9OQVZJR0FUSU9OCiAgICAgICAgICAgIC8vIGFuZCBzZXR0aW5nIHN0YXRlLltoaXN0b3J5QWN0aW9uL2xvY2F0aW9uL21hdGNoZXNdIHRvIHRoZSBuZXcgcm91dGUuCiAgICAgICAgICAgIC8vIC0gTG9jYXRpb24gaXMgYSByZXF1aXJlZCBwYXJhbQogICAgICAgICAgICAvLyAtIE5hdmlnYXRpb24gd2lsbCBhbHdheXMgYmUgc2V0IHRvIElETEVfTkFWSUdBVElPTgogICAgICAgICAgICAvLyAtIENhbiBwYXNzIGFueSBvdGhlciBzdGF0ZSBpbiBuZXdTdGF0ZQoKCiAgICAgICAgICAgIGZ1bmN0aW9uIGNvbXBsZXRlTmF2aWdhdGlvbihsb2NhdGlvbiwgbmV3U3RhdGUpIHsKICAgICAgICAgICAgICB2YXIgX3N0YXRlJG5hdmlnYXRpb24kZm9yOwoKICAgICAgICAgICAgICAvLyBEZWR1Y2UgaWYgd2UncmUgaW4gYSBsb2FkaW5nL2FjdGlvblJlbG9hZCBzdGF0ZToKICAgICAgICAgICAgICAvLyAtIFdlIGhhdmUgY29tbWl0dGVkIGFjdGlvbkRhdGEgaW4gdGhlIHN0b3JlCiAgICAgICAgICAgICAgLy8gLSBUaGUgY3VycmVudCBuYXZpZ2F0aW9uIHdhcyBhIHN1Ym1pc3Npb24KICAgICAgICAgICAgICAvLyAtIFdlJ3JlIHBhc3QgdGhlIHN1Ym1pdHRpbmcgc3RhdGUgYW5kIGludG8gdGhlIGxvYWRpbmcgc3RhdGUKICAgICAgICAgICAgICAvLyAtIFRoZSBsb2NhdGlvbiB3ZSd2ZSBmaW5pc2hlZCBsb2FkaW5nIGlzIGRpZmZlcmVudCBmcm9tIHRoZSBzdWJtaXNzaW9uCiAgICAgICAgICAgICAgLy8gICBsb2NhdGlvbiwgaW5kaWNhdGluZyB3ZSByZWRpcmVjdGVkIGZyb20gdGhlIGFjdGlvbiAoYXZvaWRzIGZhbHNlCiAgICAgICAgICAgICAgLy8gICBwb3NpdGl2ZXMgZm9yIGxvYWRpbmcvc3VibWlzc2lvblJlZGlyZWN0IHdoZW4gYWN0aW9uRGF0YSByZXR1cm5lZAogICAgICAgICAgICAgIC8vICAgb24gYSBwcmlvciBzdWJtaXNzaW9uKQogICAgICAgICAgICAgIHZhciBpc0FjdGlvblJlbG9hZCA9IHN0YXRlLmFjdGlvbkRhdGEgIT0gbnVsbCAmJiBzdGF0ZS5uYXZpZ2F0aW9uLmZvcm1NZXRob2QgIT0gbnVsbCAmJiBzdGF0ZS5uYXZpZ2F0aW9uLnN0YXRlID09PSAibG9hZGluZyIgJiYgKChfc3RhdGUkbmF2aWdhdGlvbiRmb3IgPSBzdGF0ZS5uYXZpZ2F0aW9uLmZvcm1BY3Rpb24pID09IG51bGwgPyB2b2lkIDAgOiBfc3RhdGUkbmF2aWdhdGlvbiRmb3Iuc3BsaXQoIj8iKVswXSkgPT09IGxvY2F0aW9uLnBhdGhuYW1lOyAvLyBBbHdheXMgcHJlc2VydmUgYW55IGV4aXN0aW5nIGxvYWRlckRhdGEgZnJvbSByZS11c2VkIHJvdXRlcwoKICAgICAgICAgICAgICB2YXIgbmV3TG9hZGVyRGF0YSA9IG5ld1N0YXRlLmxvYWRlckRhdGEgPyB7CiAgICAgICAgICAgICAgICBsb2FkZXJEYXRhOiBtZXJnZUxvYWRlckRhdGEoc3RhdGUubG9hZGVyRGF0YSwgbmV3U3RhdGUubG9hZGVyRGF0YSwgbmV3U3RhdGUubWF0Y2hlcyB8fCBbXSkKICAgICAgICAgICAgICB9IDoge307CiAgICAgICAgICAgICAgdXBkYXRlU3RhdGUoX2V4dGVuZHMoe30sIGlzQWN0aW9uUmVsb2FkID8ge30gOiB7CiAgICAgICAgICAgICAgICBhY3Rpb25EYXRhOiBudWxsCiAgICAgICAgICAgICAgfSwgbmV3U3RhdGUsIG5ld0xvYWRlckRhdGEsIHsKICAgICAgICAgICAgICAgIGhpc3RvcnlBY3Rpb246IHBlbmRpbmdBY3Rpb24sCiAgICAgICAgICAgICAgICBsb2NhdGlvbjogbG9jYXRpb24sCiAgICAgICAgICAgICAgICBpbml0aWFsaXplZDogdHJ1ZSwKICAgICAgICAgICAgICAgIG5hdmlnYXRpb246IElETEVfTkFWSUdBVElPTiwKICAgICAgICAgICAgICAgIHJldmFsaWRhdGlvbjogImlkbGUiLAogICAgICAgICAgICAgICAgLy8gRG9uJ3QgcmVzdG9yZSBvbiBzdWJtaXNzaW9uIG5hdmlnYXRpb25zCiAgICAgICAgICAgICAgICByZXN0b3JlU2Nyb2xsUG9zaXRpb246IHN0YXRlLm5hdmlnYXRpb24uZm9ybURhdGEgPyBmYWxzZSA6IGdldFNhdmVkU2Nyb2xsUG9zaXRpb24obG9jYXRpb24sIG5ld1N0YXRlLm1hdGNoZXMgfHwgc3RhdGUubWF0Y2hlcyksCiAgICAgICAgICAgICAgICBwcmV2ZW50U2Nyb2xsUmVzZXQ6IHBlbmRpbmdQcmV2ZW50U2Nyb2xsUmVzZXQKICAgICAgICAgICAgICB9KSk7CgogICAgICAgICAgICAgIGlmIChpc1VuaW50ZXJydXB0ZWRSZXZhbGlkYXRpb24pIDtlbHNlIGlmIChwZW5kaW5nQWN0aW9uID09PSBBY3Rpb24uUG9wKSA7ZWxzZSBpZiAocGVuZGluZ0FjdGlvbiA9PT0gQWN0aW9uLlB1c2gpIHsKICAgICAgICAgICAgICAgIGluaXQuaGlzdG9yeS5wdXNoKGxvY2F0aW9uLCBsb2NhdGlvbi5zdGF0ZSk7CiAgICAgICAgICAgICAgfSBlbHNlIGlmIChwZW5kaW5nQWN0aW9uID09PSBBY3Rpb24uUmVwbGFjZSkgewogICAgICAgICAgICAgICAgaW5pdC5oaXN0b3J5LnJlcGxhY2UobG9jYXRpb24sIGxvY2F0aW9uLnN0YXRlKTsKICAgICAgICAgICAgICB9IC8vIFJlc2V0IHN0YXRlZnVsIG5hdmlnYXRpb24gdmFycwoKCiAgICAgICAgICAgICAgcGVuZGluZ0FjdGlvbiA9IEFjdGlvbi5Qb3A7CiAgICAgICAgICAgICAgcGVuZGluZ1ByZXZlbnRTY3JvbGxSZXNldCA9IGZhbHNlOwogICAgICAgICAgICAgIGlzVW5pbnRlcnJ1cHRlZFJldmFsaWRhdGlvbiA9IGZhbHNlOwogICAgICAgICAgICAgIGlzUmV2YWxpZGF0aW9uUmVxdWlyZWQgPSBmYWxzZTsKICAgICAgICAgICAgICBjYW5jZWxsZWREZWZlcnJlZFJvdXRlcyA9IFtdOwogICAgICAgICAgICAgIGNhbmNlbGxlZEZldGNoZXJMb2FkcyA9IFtdOwogICAgICAgICAgICB9IC8vIFRyaWdnZXIgYSBuYXZpZ2F0aW9uIGV2ZW50LCB3aGljaCBjYW4gZWl0aGVyIGJlIGEgbnVtZXJpY2FsIFBPUCBvciBhIFBVU0gKICAgICAgICAgICAgLy8gcmVwbGFjZSB3aXRoIGFuIG9wdGlvbmFsIHN1Ym1pc3Npb24KICAgICAgICAgICAgZnVuY3Rpb24KCiAgICAgICAgICAgIG5hdmlnYXRlKF94NiwgX3g3KSB7cmV0dXJuIF9uYXZpZ2F0ZS5hcHBseSh0aGlzLCBhcmd1bWVudHMpO30KCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKICAgICAgICAgICAgLy8gUmV2YWxpZGF0ZSBhbGwgY3VycmVudCBsb2FkZXJzLiAgSWYgYSBuYXZpZ2F0aW9uIGlzIGluIHByb2dyZXNzIG9yIGlmIHRoaXMKICAgICAgICAgICAgLy8gaXMgaW50ZXJydXB0ZWQgYnkgYSBuYXZpZ2F0aW9uLCBhbGxvdyB0aGlzIHRvICJzdWNjZWVkIiBieSBjYWxsaW5nIGFsbAogICAgICAgICAgICAvLyBsb2FkZXJzIGR1cmluZyB0aGUgbmV4dCBsb2FkZXIgcm91bmQKICAgICAgICAgICAgZnVuY3Rpb24gX25hdmlnYXRlKCkge19uYXZpZ2F0ZSA9IF9hc3luY1RvR2VuZXJhdG9yMiggLyojX19QVVJFX18qL19yZWdlbmVyYXRvclJ1bnRpbWUyKCkubWFyayhmdW5jdGlvbiBfY2FsbGVlNSh0bywgb3B0cykge3ZhciBfbm9ybWFsaXplTmF2aWdhdGVPcHQyLCBwYXRoLCBzdWJtaXNzaW9uLCBlcnJvciwgbG9jYXRpb24sIGhpc3RvcnlBY3Rpb24sIHByZXZlbnRTY3JvbGxSZXNldDtyZXR1cm4gX3JlZ2VuZXJhdG9yUnVudGltZTIoKS53cmFwKGZ1bmN0aW9uIF9jYWxsZWU1JChfY29udGV4dDUpIHt3aGlsZSAoMSkge3N3aXRjaCAoX2NvbnRleHQ1LnByZXYgPSBfY29udGV4dDUubmV4dCkge2Nhc2UgMDppZiAoISh0eXBlb2YgdG8gPT09ICJudW1iZXIiKSkge19jb250ZXh0NS5uZXh0ID0gMzticmVhazt9aW5pdC5oaXN0b3J5LmdvKHRvKTtyZXR1cm4gX2NvbnRleHQ1LmFicnVwdCgicmV0dXJuIik7Y2FzZSAzOl9ub3JtYWxpemVOYXZpZ2F0ZU9wdDIgPSBub3JtYWxpemVOYXZpZ2F0ZU9wdGlvbnModG8sIG9wdHMpLCBwYXRoID0gX25vcm1hbGl6ZU5hdmlnYXRlT3B0Mi5wYXRoLCBzdWJtaXNzaW9uID0gX25vcm1hbGl6ZU5hdmlnYXRlT3B0Mi5zdWJtaXNzaW9uLCBlcnJvciA9IF9ub3JtYWxpemVOYXZpZ2F0ZU9wdDIuZXJyb3I7bG9jYXRpb24gPSBjcmVhdGVMb2NhdGlvbihzdGF0ZS5sb2NhdGlvbiwgcGF0aCwgb3B0cyAmJiBvcHRzLnN0YXRlKTsgLy8gV2hlbiB1c2luZyBuYXZpZ2F0ZSBhcyBhIFBVU0gvUkVQTEFDRSB3ZSBhcmVuJ3QgcmVhZGluZyBhbiBhbHJlYWR5LWVuY29kZWQKICAgICAgICAgICAgICAgICAgICAgICAgLy8gVVJMIGZyb20gd2luZG93LmxvY2F0aW9uLCBzbyB3ZSBuZWVkIHRvIGVuY29kZSBpdCBoZXJlIHNvIHRoZSBiZWhhdmlvcgogICAgICAgICAgICAgICAgICAgICAgICAvLyByZW1haW5zIHRoZSBzYW1lIGFzIFBPUCBhbmQgbm9uLWRhdGEtcm91dGVyIHVzYWdlcy4gIG5ldyBVUkwoKSBkb2VzIGFsbAogICAgICAgICAgICAgICAgICAgICAgICAvLyB0aGUgc2FtZSBlbmNvZGluZyB3ZSdkIGdldCBmcm9tIGEgaGlzdG9yeS5wdXNoU3RhdGUvd2luZG93LmxvY2F0aW9uIHJlYWQKICAgICAgICAgICAgICAgICAgICAgICAgLy8gd2l0aG91dCBoYXZpbmcgdG8gdG91Y2ggaGlzdG9yeQogICAgICAgICAgICAgICAgICAgICAgICBsb2NhdGlvbiA9IF9leHRlbmRzKHt9LCBsb2NhdGlvbiwgaW5pdC5oaXN0b3J5LmVuY29kZUxvY2F0aW9uKGxvY2F0aW9uKSk7aGlzdG9yeUFjdGlvbiA9IChvcHRzICYmIG9wdHMucmVwbGFjZSkgPT09IHRydWUgfHwgc3VibWlzc2lvbiAhPSBudWxsID8gQWN0aW9uLlJlcGxhY2UgOiBBY3Rpb24uUHVzaDtwcmV2ZW50U2Nyb2xsUmVzZXQgPSBvcHRzICYmICJwcmV2ZW50U2Nyb2xsUmVzZXQiIGluIG9wdHMgPyBvcHRzLnByZXZlbnRTY3JvbGxSZXNldCA9PT0gdHJ1ZSA6IHVuZGVmaW5lZDtfY29udGV4dDUubmV4dCA9IDEwO3JldHVybiBzdGFydE5hdmlnYXRpb24oaGlzdG9yeUFjdGlvbiwgbG9jYXRpb24sIHsgc3VibWlzc2lvbjogc3VibWlzc2lvbiwgLy8gU2VuZCB0aHJvdWdoIHRoZSBmb3JtRGF0YSBzZXJpYWxpemF0aW9uIGVycm9yIGlmIHdlIGhhdmUgb25lIHNvIHdlIGNhbgogICAgICAgICAgICAgICAgICAgICAgICAgIC8vIHJlbmRlciBhdCB0aGUgcmlnaHQgZXJyb3IgYm91bmRhcnkgYWZ0ZXIgd2UgbWF0Y2ggcm91dGVzCiAgICAgICAgICAgICAgICAgICAgICAgICAgcGVuZGluZ0Vycm9yOiBlcnJvciwgcHJldmVudFNjcm9sbFJlc2V0OiBwcmV2ZW50U2Nyb2xsUmVzZXQsIHJlcGxhY2U6IG9wdHMgJiYgb3B0cy5yZXBsYWNlIH0pO2Nhc2UgMTA6cmV0dXJuIF9jb250ZXh0NS5hYnJ1cHQoInJldHVybiIsIF9jb250ZXh0NS5zZW50KTtjYXNlIDExOmNhc2UgImVuZCI6cmV0dXJuIF9jb250ZXh0NS5zdG9wKCk7fX19LCBfY2FsbGVlNSk7fSkpO3JldHVybiBfbmF2aWdhdGUuYXBwbHkodGhpcywgYXJndW1lbnRzKTt9ZnVuY3Rpb24gcmV2YWxpZGF0ZSgpIHtpbnRlcnJ1cHRBY3RpdmVMb2FkcygpO3VwZGF0ZVN0YXRlKHsgcmV2YWxpZGF0aW9uOiAibG9hZGluZyIgfSk7IC8vIElmIHdlJ3JlIGN1cnJlbnRseSBzdWJtaXR0aW5nIGFuIGFjdGlvbiwgd2UgZG9uJ3QgbmVlZCB0byBzdGFydCBhIG5ldwogICAgICAgICAgICAgIC8vIG5hdmlnYXRpb24sIHdlJ2xsIGp1c3QgbGV0IHRoZSBmb2xsb3cgdXAgbG9hZGVyIGV4ZWN1dGlvbiBjYWxsIGFsbCBsb2FkZXJzCiAgICAgICAgICAgICAgaWYgKHN0YXRlLm5hdmlnYXRpb24uc3RhdGUgPT09ICJzdWJtaXR0aW5nIikgewogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgIH0gLy8gSWYgd2UncmUgY3VycmVudGx5IGluIGFuIGlkbGUgc3RhdGUsIHN0YXJ0IGEgbmV3IG5hdmlnYXRpb24gZm9yIHRoZSBjdXJyZW50CiAgICAgICAgICAgICAgLy8gYWN0aW9uL2xvY2F0aW9uIGFuZCBtYXJrIGl0IGFzIHVuaW50ZXJydXB0ZWQsIHdoaWNoIHdpbGwgc2tpcCB0aGUgaGlzdG9yeQogICAgICAgICAgICAgIC8vIHVwZGF0ZSBpbiBjb21wbGV0ZU5hdmlnYXRpb24KCgogICAgICAgICAgICAgIGlmIChzdGF0ZS5uYXZpZ2F0aW9uLnN0YXRlID09PSAiaWRsZSIpIHsKICAgICAgICAgICAgICAgIHN0YXJ0TmF2aWdhdGlvbihzdGF0ZS5oaXN0b3J5QWN0aW9uLCBzdGF0ZS5sb2NhdGlvbiwgewogICAgICAgICAgICAgICAgICBzdGFydFVuaW50ZXJydXB0ZWRSZXZhbGlkYXRpb246IHRydWUKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgIH0gLy8gT3RoZXJ3aXNlLCBpZiB3ZSdyZSBjdXJyZW50bHkgaW4gYSBsb2FkaW5nIHN0YXRlLCBqdXN0IHN0YXJ0IGEgbmV3CiAgICAgICAgICAgICAgLy8gbmF2aWdhdGlvbiB0byB0aGUgbmF2aWdhdGlvbi5sb2NhdGlvbiBidXQgZG8gbm90IHRyaWdnZXIgYW4gdW5pbnRlcnJ1cHRlZAogICAgICAgICAgICAgIC8vIHJldmFsaWRhdGlvbiBzbyB0aGF0IGhpc3RvcnkgY29ycmVjdGx5IHVwZGF0ZXMgb25jZSB0aGUgbmF2aWdhdGlvbiBjb21wbGV0ZXMKCgogICAgICAgICAgICAgIHN0YXJ0TmF2aWdhdGlvbihwZW5kaW5nQWN0aW9uIHx8IHN0YXRlLmhpc3RvcnlBY3Rpb24sIHN0YXRlLm5hdmlnYXRpb24ubG9jYXRpb24sIHsKICAgICAgICAgICAgICAgIG92ZXJyaWRlTmF2aWdhdGlvbjogc3RhdGUubmF2aWdhdGlvbgogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9IC8vIFN0YXJ0IGEgbmF2aWdhdGlvbiB0byB0aGUgZ2l2ZW4gYWN0aW9uL2xvY2F0aW9uLiAgQ2FuIG9wdGlvbmFsbHkgcHJvdmlkZSBhCiAgICAgICAgICAgIC8vIG92ZXJyaWRlTmF2aWdhdGlvbiB3aGljaCB3aWxsIG92ZXJyaWRlIHRoZSBub3JtYWxMb2FkIGluIHRoZSBjYXNlIG9mIGEgcmVkaXJlY3QKICAgICAgICAgICAgLy8gbmF2aWdhdGlvbgogICAgICAgICAgICBmdW5jdGlvbgoKICAgICAgICAgICAgc3RhcnROYXZpZ2F0aW9uKF94OCwgX3g5LCBfeDEwKSB7cmV0dXJuIF9zdGFydE5hdmlnYXRpb24uYXBwbHkodGhpcywgYXJndW1lbnRzKTt9CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgogICAgICAgICAgICAvLyBDYWxsIHRoZSBhY3Rpb24gbWF0Y2hlZCBieSB0aGUgbGVhZiByb3V0ZSBmb3IgdGhpcyBuYXZpZ2F0aW9uIGFuZCBoYW5kbGUKICAgICAgICAgICAgLy8gcmVkaXJlY3RzL2Vycm9ycwogICAgICAgICAgICBmdW5jdGlvbiBfc3RhcnROYXZpZ2F0aW9uKCkge19zdGFydE5hdmlnYXRpb24gPSBfYXN5bmNUb0dlbmVyYXRvcjIoIC8qI19fUFVSRV9fKi9fcmVnZW5lcmF0b3JSdW50aW1lMigpLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTYoaGlzdG9yeUFjdGlvbiwgbG9jYXRpb24sIG9wdHMpIHt2YXIgbG9hZGluZ05hdmlnYXRpb24sIG1hdGNoZXMsIF9lcnJvciwgX2dldFNob3J0Q2lyY3VpdE1hdGNoMiwgbm90Rm91bmRNYXRjaGVzLCBfcm91dGUsIHJlcXVlc3QsIHBlbmRpbmdBY3Rpb25EYXRhLCBwZW5kaW5nRXJyb3IsIGFjdGlvbk91dHB1dCwgbmF2aWdhdGlvbiwgX3lpZWxkJGhhbmRsZUxvYWRlcnMsIHNob3J0Q2lyY3VpdGVkLCBsb2FkZXJEYXRhLCBlcnJvcnM7cmV0dXJuIF9yZWdlbmVyYXRvclJ1bnRpbWUyKCkud3JhcChmdW5jdGlvbiBfY2FsbGVlNiQoX2NvbnRleHQ2KSB7d2hpbGUgKDEpIHtzd2l0Y2ggKF9jb250ZXh0Ni5wcmV2ID0gX2NvbnRleHQ2Lm5leHQpIHtjYXNlIDA6IC8vIEFib3J0IGFueSBpbi1wcm9ncmVzcyBuYXZpZ2F0aW9ucyBhbmQgc3RhcnQgYSBuZXcgb25lLiBVbnNldCBhbnkgb25nb2luZwogICAgICAgICAgICAgICAgICAgICAgICAvLyB1bmludGVycnVwdGVkIHJldmFsaWRhdGlvbnMgdW5sZXNzIHRvbGQgb3RoZXJ3aXNlLCBzaW5jZSB3ZSB3YW50IHRoaXMKICAgICAgICAgICAgICAgICAgICAgICAgLy8gbmV3IG5hdmlnYXRpb24gdG8gdXBkYXRlIGhpc3Rvcnkgbm9ybWFsbHkKICAgICAgICAgICAgICAgICAgICAgICAgcGVuZGluZ05hdmlnYXRpb25Db250cm9sbGVyICYmIHBlbmRpbmdOYXZpZ2F0aW9uQ29udHJvbGxlci5hYm9ydCgpO3BlbmRpbmdOYXZpZ2F0aW9uQ29udHJvbGxlciA9IG51bGw7cGVuZGluZ0FjdGlvbiA9IGhpc3RvcnlBY3Rpb247aXNVbmludGVycnVwdGVkUmV2YWxpZGF0aW9uID0gKG9wdHMgJiYgb3B0cy5zdGFydFVuaW50ZXJydXB0ZWRSZXZhbGlkYXRpb24pID09PSB0cnVlOyAvLyBTYXZlIHRoZSBjdXJyZW50IHNjcm9sbCBwb3NpdGlvbiBldmVyeSB0aW1lIHdlIHN0YXJ0IGEgbmV3IG5hdmlnYXRpb24sCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIGFuZCB0cmFjayB3aGV0aGVyIHdlIHNob3VsZCByZXNldCBzY3JvbGwgb24gY29tcGxldGlvbgogICAgICAgICAgICAgICAgICAgICAgICBzYXZlU2Nyb2xsUG9zaXRpb24oc3RhdGUubG9jYXRpb24sIHN0YXRlLm1hdGNoZXMpO3BlbmRpbmdQcmV2ZW50U2Nyb2xsUmVzZXQgPSAob3B0cyAmJiBvcHRzLnByZXZlbnRTY3JvbGxSZXNldCkgPT09IHRydWU7bG9hZGluZ05hdmlnYXRpb24gPSBvcHRzICYmIG9wdHMub3ZlcnJpZGVOYXZpZ2F0aW9uO21hdGNoZXMgPSBtYXRjaFJvdXRlcyhkYXRhUm91dGVzLCBsb2NhdGlvbiwgaW5pdC5iYXNlbmFtZSk7IC8vIFNob3J0IGNpcmN1aXQgd2l0aCBhIDQwNCBvbiB0aGUgcm9vdCBlcnJvciBib3VuZGFyeSBpZiB3ZSBtYXRjaCBub3RoaW5nCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChtYXRjaGVzKSB7X2NvbnRleHQ2Lm5leHQgPSAxNDticmVhazt9X2Vycm9yID0gZ2V0SW50ZXJuYWxSb3V0ZXJFcnJvcig0MDQsIHsgcGF0aG5hbWU6IGxvY2F0aW9uLnBhdGhuYW1lIH0pO19nZXRTaG9ydENpcmN1aXRNYXRjaDIgPSBnZXRTaG9ydENpcmN1aXRNYXRjaGVzKGRhdGFSb3V0ZXMpLCBub3RGb3VuZE1hdGNoZXMgPSBfZ2V0U2hvcnRDaXJjdWl0TWF0Y2gyLm1hdGNoZXMsIF9yb3V0ZSA9IF9nZXRTaG9ydENpcmN1aXRNYXRjaDIucm91dGU7IC8vIENhbmNlbCBhbGwgcGVuZGluZyBkZWZlcnJlZCBvbiA0MDRzIHNpbmNlIHdlIGRvbid0IGtlZXAgYW55IHJvdXRlcwogICAgICAgICAgICAgICAgICAgICAgICBjYW5jZWxBY3RpdmVEZWZlcnJlZHMoKTtjb21wbGV0ZU5hdmlnYXRpb24obG9jYXRpb24sIHsgbWF0Y2hlczogbm90Rm91bmRNYXRjaGVzLCBsb2FkZXJEYXRhOiB7fSwgZXJyb3JzOiBfZGVmaW5lUHJvcGVydHkyKHt9LCBfcm91dGUuaWQsIF9lcnJvcikgfSk7cmV0dXJuIF9jb250ZXh0Ni5hYnJ1cHQoInJldHVybiIpO2Nhc2UgMTQ6aWYgKCFpc0hhc2hDaGFuZ2VPbmx5KHN0YXRlLmxvY2F0aW9uLCBsb2NhdGlvbikpIHtfY29udGV4dDYubmV4dCA9IDE3O2JyZWFrO31jb21wbGV0ZU5hdmlnYXRpb24obG9jYXRpb24sIHsgbWF0Y2hlczogbWF0Y2hlcyB9KTtyZXR1cm4gX2NvbnRleHQ2LmFicnVwdCgicmV0dXJuIik7Y2FzZSAxNzogLy8gQ3JlYXRlIGEgY29udHJvbGxlci9SZXF1ZXN0IGZvciB0aGlzIG5hdmlnYXRpb24KICAgICAgICAgICAgICAgICAgICAgICAgcGVuZGluZ05hdmlnYXRpb25Db250cm9sbGVyID0gbmV3IEFib3J0Q29udHJvbGxlcigpO3JlcXVlc3QgPSBjcmVhdGVSZXF1ZXN0KGxvY2F0aW9uLCBwZW5kaW5nTmF2aWdhdGlvbkNvbnRyb2xsZXIuc2lnbmFsLCBvcHRzICYmIG9wdHMuc3VibWlzc2lvbik7aWYgKCEob3B0cyAmJiBvcHRzLnBlbmRpbmdFcnJvcikpIHtfY29udGV4dDYubmV4dCA9IDIzO2JyZWFrO30gLy8gSWYgd2UgaGF2ZSBhIHBlbmRpbmdFcnJvciwgaXQgbWVhbnMgdGhlIHVzZXIgYXR0ZW1wdGVkIGEgR0VUIHN1Ym1pc3Npb24KICAgICAgICAgICAgICAgICAgICAgICAgLy8gd2l0aCBiaW5hcnkgRm9ybURhdGEgc28gYXNzaWduIGhlcmUgYW5kIHNraXAgdG8gaGFuZGxlTG9hZGVycy4gIFRoYXQKICAgICAgICAgICAgICAgICAgICAgICAgLy8gd2F5IHdlIGhhbmRsZSBjYWxsaW5nIGxvYWRlcnMgYWJvdmUgdGhlIGJvdW5kYXJ5IGV0Yy4gIEl0J3Mgbm90IHJlYWxseQogICAgICAgICAgICAgICAgICAgICAgICAvLyBkaWZmZXJlbnQgZnJvbSBhbiBhY3Rpb25FcnJvciBpbiB0aGF0IHNlbnNlLgogICAgICAgICAgICAgICAgICAgICAgICBwZW5kaW5nRXJyb3IgPSBfZGVmaW5lUHJvcGVydHkyKHt9LCBmaW5kTmVhcmVzdEJvdW5kYXJ5KG1hdGNoZXMpLnJvdXRlLmlkLCBvcHRzLnBlbmRpbmdFcnJvcik7X2NvbnRleHQ2Lm5leHQgPSAzMzticmVhaztjYXNlIDIzOmlmICghKG9wdHMgJiYgb3B0cy5zdWJtaXNzaW9uKSkge19jb250ZXh0Ni5uZXh0ID0gMzM7YnJlYWs7fV9jb250ZXh0Ni5uZXh0ID0gMjY7cmV0dXJuIGhhbmRsZUFjdGlvbihyZXF1ZXN0LCBsb2NhdGlvbiwgb3B0cy5zdWJtaXNzaW9uLCBtYXRjaGVzLCB7IHJlcGxhY2U6IG9wdHMucmVwbGFjZSB9KTtjYXNlIDI2OmFjdGlvbk91dHB1dCA9IF9jb250ZXh0Ni5zZW50O2lmICghYWN0aW9uT3V0cHV0LnNob3J0Q2lyY3VpdGVkKSB7X2NvbnRleHQ2Lm5leHQgPSAyOTticmVhazt9cmV0dXJuIF9jb250ZXh0Ni5hYnJ1cHQoInJldHVybiIpO2Nhc2UgMjk6cGVuZGluZ0FjdGlvbkRhdGEgPSBhY3Rpb25PdXRwdXQucGVuZGluZ0FjdGlvbkRhdGE7cGVuZGluZ0Vycm9yID0gYWN0aW9uT3V0cHV0LnBlbmRpbmdBY3Rpb25FcnJvcjtuYXZpZ2F0aW9uID0gX2V4dGVuZHMoeyBzdGF0ZTogImxvYWRpbmciLCBsb2NhdGlvbjogbG9jYXRpb24gfSwgb3B0cy5zdWJtaXNzaW9uKTtsb2FkaW5nTmF2aWdhdGlvbiA9IG5hdmlnYXRpb247Y2FzZSAzMzpfY29udGV4dDYubmV4dCA9IDM1O3JldHVybiBoYW5kbGVMb2FkZXJzKHJlcXVlc3QsIGxvY2F0aW9uLCBtYXRjaGVzLCBsb2FkaW5nTmF2aWdhdGlvbiwgb3B0cyAmJiBvcHRzLnN1Ym1pc3Npb24sIG9wdHMgJiYgb3B0cy5yZXBsYWNlLCBwZW5kaW5nQWN0aW9uRGF0YSwgcGVuZGluZ0Vycm9yKTtjYXNlIDM1Ol95aWVsZCRoYW5kbGVMb2FkZXJzID0gX2NvbnRleHQ2LnNlbnQ7c2hvcnRDaXJjdWl0ZWQgPSBfeWllbGQkaGFuZGxlTG9hZGVycy5zaG9ydENpcmN1aXRlZDtsb2FkZXJEYXRhID0gX3lpZWxkJGhhbmRsZUxvYWRlcnMubG9hZGVyRGF0YTtlcnJvcnMgPSBfeWllbGQkaGFuZGxlTG9hZGVycy5lcnJvcnM7aWYgKCFzaG9ydENpcmN1aXRlZCkge19jb250ZXh0Ni5uZXh0ID0gNDE7YnJlYWs7fXJldHVybiBfY29udGV4dDYuYWJydXB0KCJyZXR1cm4iKTtjYXNlIDQxOiAvLyBDbGVhbiB1cCBub3cgdGhhdCB0aGUgYWN0aW9uL2xvYWRlcnMgaGF2ZSBjb21wbGV0ZWQuICBEb24ndCBjbGVhbiB1cCBpZgogICAgICAgICAgICAgICAgICAgICAgICAvLyB3ZSBzaG9ydCBjaXJjdWl0ZWQgYmVjYXVzZSBwZW5kaW5nTmF2aWdhdGlvbkNvbnRyb2xsZXIgd2lsbCBoYXZlIGFscmVhZHkKICAgICAgICAgICAgICAgICAgICAgICAgLy8gYmVlbiBhc3NpZ25lZCB0byBhIG5ldyBjb250cm9sbGVyIGZvciB0aGUgbmV4dCBuYXZpZ2F0aW9uCiAgICAgICAgICAgICAgICAgICAgICAgIHBlbmRpbmdOYXZpZ2F0aW9uQ29udHJvbGxlciA9IG51bGw7Y29tcGxldGVOYXZpZ2F0aW9uKGxvY2F0aW9uLCB7IG1hdGNoZXM6IG1hdGNoZXMsIGxvYWRlckRhdGE6IGxvYWRlckRhdGEsIGVycm9yczogZXJyb3JzIH0pO2Nhc2UgNDM6Y2FzZSAiZW5kIjpyZXR1cm4gX2NvbnRleHQ2LnN0b3AoKTt9fX0sIF9jYWxsZWU2KTt9KSk7cmV0dXJuIF9zdGFydE5hdmlnYXRpb24uYXBwbHkodGhpcywgYXJndW1lbnRzKTt9ZnVuY3Rpb24gaGFuZGxlQWN0aW9uKF94MTEsIF94MTIsIF94MTMsIF94MTQsIF94MTUpIHtyZXR1cm4gX2hhbmRsZUFjdGlvbi5hcHBseSh0aGlzLCBhcmd1bWVudHMpO30KCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCiAgICAgICAgICAgIC8vIENhbGwgYWxsIGFwcGxpY2FibGUgbG9hZGVycyBmb3IgdGhlIGdpdmVuIG1hdGNoZXMsIGhhbmRsaW5nIHJlZGlyZWN0cywKICAgICAgICAgICAgLy8gZXJyb3JzLCBldGMuCiAgICAgICAgICAgIGZ1bmN0aW9uIF9oYW5kbGVBY3Rpb24oKSB7X2hhbmRsZUFjdGlvbiA9IF9hc3luY1RvR2VuZXJhdG9yMiggLyojX19QVVJFX18qL19yZWdlbmVyYXRvclJ1bnRpbWUyKCkubWFyayhmdW5jdGlvbiBfY2FsbGVlNyhyZXF1ZXN0LCBsb2NhdGlvbiwgc3VibWlzc2lvbiwgbWF0Y2hlcywgb3B0cykge3ZhciBuYXZpZ2F0aW9uLCByZXN1bHQsIGFjdGlvbk1hdGNoLCBib3VuZGFyeU1hdGNoO3JldHVybiBfcmVnZW5lcmF0b3JSdW50aW1lMigpLndyYXAoZnVuY3Rpb24gX2NhbGxlZTckKF9jb250ZXh0Nykge3doaWxlICgxKSB7c3dpdGNoIChfY29udGV4dDcucHJldiA9IF9jb250ZXh0Ny5uZXh0KSB7Y2FzZSAwOmludGVycnVwdEFjdGl2ZUxvYWRzKCk7IC8vIFB1dCB1cyBpbiBhIHN1Ym1pdHRpbmcgc3RhdGUKICAgICAgICAgICAgICAgICAgICAgICAgbmF2aWdhdGlvbiA9IF9leHRlbmRzKHsgc3RhdGU6ICJzdWJtaXR0aW5nIiwgbG9jYXRpb246IGxvY2F0aW9uIH0sIHN1Ym1pc3Npb24pO3VwZGF0ZVN0YXRlKHsgbmF2aWdhdGlvbjogbmF2aWdhdGlvbiB9KTsgLy8gQ2FsbCBvdXIgYWN0aW9uIGFuZCBnZXQgdGhlIHJlc3VsdAogICAgICAgICAgICAgICAgICAgICAgICBhY3Rpb25NYXRjaCA9IGdldFRhcmdldE1hdGNoKG1hdGNoZXMsIGxvY2F0aW9uKTtpZiAoYWN0aW9uTWF0Y2gucm91dGUuYWN0aW9uKSB7X2NvbnRleHQ3Lm5leHQgPSA4O2JyZWFrO31yZXN1bHQgPSB7IHR5cGU6IFJlc3VsdFR5cGUuZXJyb3IsIGVycm9yOiBnZXRJbnRlcm5hbFJvdXRlckVycm9yKDQwNSwgeyBtZXRob2Q6IHJlcXVlc3QubWV0aG9kLCBwYXRobmFtZTogbG9jYXRpb24ucGF0aG5hbWUsIHJvdXRlSWQ6IGFjdGlvbk1hdGNoLnJvdXRlLmlkIH0pIH07X2NvbnRleHQ3Lm5leHQgPSAxMzticmVhaztjYXNlIDg6X2NvbnRleHQ3Lm5leHQgPSAxMDtyZXR1cm4gY2FsbExvYWRlck9yQWN0aW9uKCJhY3Rpb24iLCByZXF1ZXN0LCBhY3Rpb25NYXRjaCwgbWF0Y2hlcywgcm91dGVyLmJhc2VuYW1lKTtjYXNlIDEwOnJlc3VsdCA9IF9jb250ZXh0Ny5zZW50O2lmICghcmVxdWVzdC5zaWduYWwuYWJvcnRlZCkge19jb250ZXh0Ny5uZXh0ID0gMTM7YnJlYWs7fXJldHVybiBfY29udGV4dDcuYWJydXB0KCJyZXR1cm4iLCB7IHNob3J0Q2lyY3VpdGVkOiB0cnVlIH0pO2Nhc2UgMTM6aWYgKCFpc1JlZGlyZWN0UmVzdWx0KHJlc3VsdCkpIHtfY29udGV4dDcubmV4dCA9IDE3O2JyZWFrO31fY29udGV4dDcubmV4dCA9IDE2O3JldHVybiBzdGFydFJlZGlyZWN0TmF2aWdhdGlvbihzdGF0ZSwgcmVzdWx0LCBvcHRzICYmIG9wdHMucmVwbGFjZSA9PT0gdHJ1ZSk7Y2FzZSAxNjpyZXR1cm4gX2NvbnRleHQ3LmFicnVwdCgicmV0dXJuIiwgeyBzaG9ydENpcmN1aXRlZDogdHJ1ZSB9KTtjYXNlIDE3OmlmICghaXNFcnJvclJlc3VsdChyZXN1bHQpKSB7X2NvbnRleHQ3Lm5leHQgPSAyMTticmVhazt9IC8vIFN0b3JlIG9mZiB0aGUgcGVuZGluZyBlcnJvciAtIHdlIHVzZSBpdCB0byBkZXRlcm1pbmUgd2hpY2ggbG9hZGVycwogICAgICAgICAgICAgICAgICAgICAgICAvLyB0byBjYWxsIGFuZCB3aWxsIGNvbW1pdCBpdCB3aGVuIHdlIGNvbXBsZXRlIHRoZSBuYXZpZ2F0aW9uCiAgICAgICAgICAgICAgICAgICAgICAgIGJvdW5kYXJ5TWF0Y2ggPSBmaW5kTmVhcmVzdEJvdW5kYXJ5KG1hdGNoZXMsIGFjdGlvbk1hdGNoLnJvdXRlLmlkKTsgLy8gQnkgZGVmYXVsdCwgYWxsIHN1Ym1pc3Npb25zIGFyZSBSRVBMQUNFIG5hdmlnYXRpb25zLCBidXQgaWYgdGhlCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIGFjdGlvbiB0aHJldyBhbiBlcnJvciB0aGF0J2xsIGJlIHJlbmRlcmVkIGluIGFuIGVycm9yRWxlbWVudCwgd2UgZmFsbAogICAgICAgICAgICAgICAgICAgICAgICAvLyBiYWNrIHRvIFBVU0ggc28gdGhhdCB0aGUgdXNlciBjYW4gdXNlIHRoZSBiYWNrIGJ1dHRvbiB0byBnZXQgYmFjayB0bwogICAgICAgICAgICAgICAgICAgICAgICAvLyB0aGUgcHJlLXN1Ym1pc3Npb24gZm9ybSBsb2NhdGlvbiB0byB0cnkgYWdhaW4KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKChvcHRzICYmIG9wdHMucmVwbGFjZSkgIT09IHRydWUpIHtwZW5kaW5nQWN0aW9uID0gQWN0aW9uLlB1c2g7fXJldHVybiBfY29udGV4dDcuYWJydXB0KCJyZXR1cm4iLCB7IHBlbmRpbmdBY3Rpb25FcnJvcjogX2RlZmluZVByb3BlcnR5Mih7fSwgYm91bmRhcnlNYXRjaC5yb3V0ZS5pZCwgcmVzdWx0LmVycm9yKSB9KTtjYXNlIDIxOmlmICghaXNEZWZlcnJlZFJlc3VsdChyZXN1bHQpKSB7X2NvbnRleHQ3Lm5leHQgPSAyMzticmVhazt9dGhyb3cgbmV3IEVycm9yKCJkZWZlcigpIGlzIG5vdCBzdXBwb3J0ZWQgaW4gYWN0aW9ucyIpO2Nhc2UgMjM6cmV0dXJuIF9jb250ZXh0Ny5hYnJ1cHQoInJldHVybiIsIHsgcGVuZGluZ0FjdGlvbkRhdGE6IF9kZWZpbmVQcm9wZXJ0eTIoe30sIGFjdGlvbk1hdGNoLnJvdXRlLmlkLCByZXN1bHQuZGF0YSkgfSk7Y2FzZSAyNDpjYXNlICJlbmQiOnJldHVybiBfY29udGV4dDcuc3RvcCgpO319fSwgX2NhbGxlZTcpO30pKTtyZXR1cm4gX2hhbmRsZUFjdGlvbi5hcHBseSh0aGlzLCBhcmd1bWVudHMpO31mdW5jdGlvbiBoYW5kbGVMb2FkZXJzKF94MTYsIF94MTcsIF94MTgsIF94MTksIF94MjAsIF94MjEsIF94MjIsIF94MjMpIHtyZXR1cm4gX2hhbmRsZUxvYWRlcnMuYXBwbHkodGhpcywgYXJndW1lbnRzKTt9ZnVuY3Rpb24gX2hhbmRsZUxvYWRlcnMoKSB7X2hhbmRsZUxvYWRlcnMgPSBfYXN5bmNUb0dlbmVyYXRvcjIoIC8qI19fUFVSRV9fKi9fcmVnZW5lcmF0b3JSdW50aW1lMigpLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTgocmVxdWVzdCwgbG9jYXRpb24sIG1hdGNoZXMsIG92ZXJyaWRlTmF2aWdhdGlvbiwgc3VibWlzc2lvbiwgcmVwbGFjZSwgcGVuZGluZ0FjdGlvbkRhdGEsIHBlbmRpbmdFcnJvcikge3ZhciBsb2FkaW5nTmF2aWdhdGlvbiwgbmF2aWdhdGlvbiwgX2dldE1hdGNoZXNUb0xvYWQsIF9nZXRNYXRjaGVzVG9Mb2FkMiwgbWF0Y2hlc1RvTG9hZCwgcmV2YWxpZGF0aW5nRmV0Y2hlcnMsIF95aWVsZCRjYWxsTG9hZGVyc0FuZCwgcmVzdWx0cywgbG9hZGVyUmVzdWx0cywgZmV0Y2hlclJlc3VsdHMsIHJlZGlyZWN0LCBfcHJvY2Vzc0xvYWRlckRhdGEsIGxvYWRlckRhdGEsIGVycm9ycywgZGlkQWJvcnRGZXRjaExvYWRzO3JldHVybiBfcmVnZW5lcmF0b3JSdW50aW1lMigpLndyYXAoZnVuY3Rpb24gX2NhbGxlZTgkKF9jb250ZXh0OCkge3doaWxlICgxKSB7c3dpdGNoIChfY29udGV4dDgucHJldiA9IF9jb250ZXh0OC5uZXh0KSB7Y2FzZSAwOiAvLyBGaWd1cmUgb3V0IHRoZSByaWdodCBuYXZpZ2F0aW9uIHdlIHdhbnQgdG8gdXNlIGZvciBkYXRhIGxvYWRpbmcKICAgICAgICAgICAgICAgICAgICAgICAgbG9hZGluZ05hdmlnYXRpb24gPSBvdmVycmlkZU5hdmlnYXRpb247aWYgKCFsb2FkaW5nTmF2aWdhdGlvbikge25hdmlnYXRpb24gPSB7IHN0YXRlOiAibG9hZGluZyIsIGxvY2F0aW9uOiBsb2NhdGlvbiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvcm1NZXRob2Q6IHVuZGVmaW5lZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvcm1BY3Rpb246IHVuZGVmaW5lZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvcm1FbmNUeXBlOiB1bmRlZmluZWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3JtRGF0YTogdW5kZWZpbmVkCiAgICAgICAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgICAgICAgICAgICBsb2FkaW5nTmF2aWdhdGlvbiA9IG5hdmlnYXRpb247CiAgICAgICAgICAgICAgICAgICAgICAgIH1fZ2V0TWF0Y2hlc1RvTG9hZCA9CgogICAgICAgICAgICAgICAgICAgICAgICBnZXRNYXRjaGVzVG9Mb2FkKHN0YXRlLCBtYXRjaGVzLCBzdWJtaXNzaW9uLCBsb2NhdGlvbiwgaXNSZXZhbGlkYXRpb25SZXF1aXJlZCwgY2FuY2VsbGVkRGVmZXJyZWRSb3V0ZXMsIGNhbmNlbGxlZEZldGNoZXJMb2FkcywgcGVuZGluZ0FjdGlvbkRhdGEsIHBlbmRpbmdFcnJvciwgZmV0Y2hMb2FkTWF0Y2hlcyksIF9nZXRNYXRjaGVzVG9Mb2FkMiA9IF9zbGljZWRUb0FycmF5MihfZ2V0TWF0Y2hlc1RvTG9hZCwgMiksIG1hdGNoZXNUb0xvYWQgPSBfZ2V0TWF0Y2hlc1RvTG9hZDJbMF0sIHJldmFsaWRhdGluZ0ZldGNoZXJzID0gX2dldE1hdGNoZXNUb0xvYWQyWzFdOyAvLyBDYW5jZWwgcGVuZGluZyBkZWZlcnJlZHMgZm9yIG5vLWxvbmdlci1tYXRjaGVkIHJvdXRlcyBvciByb3V0ZXMgd2UncmUKICAgICAgICAgICAgICAgICAgICAgICAgLy8gYWJvdXQgdG8gcmVsb2FkLiAgTm90ZSB0aGF0IGlmIHRoaXMgaXMgYW4gYWN0aW9uIHJlbG9hZCB3ZSB3b3VsZCBoYXZlCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIGFscmVhZHkgY2FuY2VsbGVkIGFsbCBwZW5kaW5nIGRlZmVycmVkcyBzbyB0aGlzIHdvdWxkIGJlIGEgbm8tb3AKCiAgICAgICAgICAgICAgICAgICAgICAgIGNhbmNlbEFjdGl2ZURlZmVycmVkcygocm91dGVJZCkgPT4gIShtYXRjaGVzICYmIG1hdGNoZXMuc29tZSgobSkgPT4gbS5yb3V0ZS5pZCA9PT0gcm91dGVJZCkpIHx8IG1hdGNoZXNUb0xvYWQgJiYgbWF0Y2hlc1RvTG9hZC5zb21lKChtKSA9PiBtLnJvdXRlLmlkID09PSByb3V0ZUlkKSk7IC8vIFNob3J0IGNpcmN1aXQgaWYgd2UgaGF2ZSBubyBsb2FkZXJzIHRvIHJ1bgogICAgICAgICAgICAgICAgICAgICAgICBpZiAoISgKICAgICAgICAgICAgICAgICAgICAgICAgbWF0Y2hlc1RvTG9hZC5sZW5ndGggPT09IDAgJiYgcmV2YWxpZGF0aW5nRmV0Y2hlcnMubGVuZ3RoID09PSAwKSkge19jb250ZXh0OC5uZXh0ID0gNzticmVhazt9CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbXBsZXRlTmF2aWdhdGlvbihsb2NhdGlvbiwgewogICAgICAgICAgICAgICAgICAgICAgICAgIG1hdGNoZXM6IG1hdGNoZXMsCiAgICAgICAgICAgICAgICAgICAgICAgICAgbG9hZGVyRGF0YTogbWVyZ2VMb2FkZXJEYXRhKHN0YXRlLmxvYWRlckRhdGEsIHt9LCBtYXRjaGVzKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBDb21taXQgcGVuZGluZyBlcnJvciBpZiB3ZSdyZSBzaG9ydCBjaXJjdWl0aW5nCiAgICAgICAgICAgICAgICAgICAgICAgICAgZXJyb3JzOiBwZW5kaW5nRXJyb3IgfHwgbnVsbCwKICAgICAgICAgICAgICAgICAgICAgICAgICBhY3Rpb25EYXRhOiBwZW5kaW5nQWN0aW9uRGF0YSB8fCBudWxsCiAgICAgICAgICAgICAgICAgICAgICAgIH0pO3JldHVybiBfY29udGV4dDguYWJydXB0KCJyZXR1cm4iLAogICAgICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgc2hvcnRDaXJjdWl0ZWQ6IHRydWUKICAgICAgICAgICAgICAgICAgICAgICAgfSk7Y2FzZSA3OgogICAgICAgICAgICAgICAgICAgICAgICAvLyBJZiB0aGlzIGlzIGFuIHVuaW50ZXJydXB0ZWQgcmV2YWxpZGF0aW9uLCB3ZSByZW1haW4gaW4gb3VyIGN1cnJlbnQgaWRsZQogICAgICAgICAgICAgICAgICAgICAgICAvLyBzdGF0ZS4gIElmIG5vdCwgd2UgbmVlZCB0byBzd2l0Y2ggdG8gb3VyIGxvYWRpbmcgc3RhdGUgYW5kIGxvYWQgZGF0YSwKICAgICAgICAgICAgICAgICAgICAgICAgLy8gcHJlc2VydmluZyBhbnkgbmV3IGFjdGlvbiBkYXRhIG9yIGV4aXN0aW5nIGFjdGlvbiBkYXRhIChpbiB0aGUgY2FzZSBvZgogICAgICAgICAgICAgICAgICAgICAgICAvLyBhIHJldmFsaWRhdGlvbiBpbnRlcnJ1cHRpbmcgYW4gYWN0aW9uUmVsb2FkKQoKCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghaXNVbmludGVycnVwdGVkUmV2YWxpZGF0aW9uKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgcmV2YWxpZGF0aW5nRmV0Y2hlcnMuZm9yRWFjaCgoX3JlZjIpID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBfcmVmMTQgPSBfc2xpY2VkVG9BcnJheTIoX3JlZjIsIDEpLGtleSA9IF9yZWYxNFswXTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBmZXRjaGVyID0gc3RhdGUuZmV0Y2hlcnMuZ2V0KGtleSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgcmV2YWxpZGF0aW5nRmV0Y2hlciA9IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhdGU6ICJsb2FkaW5nIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YTogZmV0Y2hlciAmJiBmZXRjaGVyLmRhdGEsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvcm1NZXRob2Q6IHVuZGVmaW5lZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9ybUFjdGlvbjogdW5kZWZpbmVkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3JtRW5jVHlwZTogdW5kZWZpbmVkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3JtRGF0YTogdW5kZWZpbmVkCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhdGUuZmV0Y2hlcnMuc2V0KGtleSwgcmV2YWxpZGF0aW5nRmV0Y2hlcik7CiAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgdXBkYXRlU3RhdGUoX2V4dGVuZHMoewogICAgICAgICAgICAgICAgICAgICAgICAgICAgbmF2aWdhdGlvbjogbG9hZGluZ05hdmlnYXRpb24sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhY3Rpb25EYXRhOiBwZW5kaW5nQWN0aW9uRGF0YSB8fCBzdGF0ZS5hY3Rpb25EYXRhIHx8IG51bGwKICAgICAgICAgICAgICAgICAgICAgICAgICB9LCByZXZhbGlkYXRpbmdGZXRjaGVycy5sZW5ndGggPiAwID8gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgZmV0Y2hlcnM6IG5ldyBNYXAoc3RhdGUuZmV0Y2hlcnMpCiAgICAgICAgICAgICAgICAgICAgICAgICAgfSA6IHt9KSk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgIHBlbmRpbmdOYXZpZ2F0aW9uTG9hZElkID0gKytpbmNyZW1lbnRpbmdMb2FkSWQ7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldmFsaWRhdGluZ0ZldGNoZXJzLmZvckVhY2goKF9yZWYzKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIF9yZWYxNSA9IF9zbGljZWRUb0FycmF5MihfcmVmMywgMSksa2V5ID0gX3JlZjE1WzBdOwogICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmZXRjaENvbnRyb2xsZXJzLnNldChrZXksIHBlbmRpbmdOYXZpZ2F0aW9uQ29udHJvbGxlcik7CiAgICAgICAgICAgICAgICAgICAgICAgIH0pO19jb250ZXh0OC5uZXh0ID0gMTI7cmV0dXJuICgKCgoKCiAgICAgICAgICAgICAgICAgICAgICAgICAgY2FsbExvYWRlcnNBbmRNYXliZVJlc29sdmVEYXRhKHN0YXRlLm1hdGNoZXMsIG1hdGNoZXMsIG1hdGNoZXNUb0xvYWQsIHJldmFsaWRhdGluZ0ZldGNoZXJzLCByZXF1ZXN0KSk7Y2FzZSAxMjpfeWllbGQkY2FsbExvYWRlcnNBbmQgPSBfY29udGV4dDguc2VudDtyZXN1bHRzID0gX3lpZWxkJGNhbGxMb2FkZXJzQW5kLnJlc3VsdHM7bG9hZGVyUmVzdWx0cyA9IF95aWVsZCRjYWxsTG9hZGVyc0FuZC5sb2FkZXJSZXN1bHRzO2ZldGNoZXJSZXN1bHRzID0gX3lpZWxkJGNhbGxMb2FkZXJzQW5kLmZldGNoZXJSZXN1bHRzO2lmICghCgogICAgICAgICAgICAgICAgICAgICAgICByZXF1ZXN0LnNpZ25hbC5hYm9ydGVkKSB7X2NvbnRleHQ4Lm5leHQgPSAxODticmVhazt9cmV0dXJuIF9jb250ZXh0OC5hYnJ1cHQoInJldHVybiIsCiAgICAgICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgICBzaG9ydENpcmN1aXRlZDogdHJ1ZQogICAgICAgICAgICAgICAgICAgICAgICB9KTtjYXNlIDE4OgogICAgICAgICAgICAgICAgICAgICAgICAvLyBDbGVhbiB1cCBfYWZ0ZXJfIGxvYWRlcnMgaGF2ZSBjb21wbGV0ZWQuICBEb24ndCBjbGVhbiB1cCBpZiB3ZSBzaG9ydAogICAgICAgICAgICAgICAgICAgICAgICAvLyBjaXJjdWl0ZWQgYmVjYXVzZSBmZXRjaENvbnRyb2xsZXJzIHdvdWxkIGhhdmUgYmVlbiBhYm9ydGVkIGFuZAogICAgICAgICAgICAgICAgICAgICAgICAvLyByZWFzc2lnbmVkIHRvIG5ldyBjb250cm9sbGVycyBmb3IgdGhlIG5leHQgbmF2aWdhdGlvbgoKCiAgICAgICAgICAgICAgICAgICAgICAgIHJldmFsaWRhdGluZ0ZldGNoZXJzLmZvckVhY2goKF9yZWY0KSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIF9yZWYxNiA9IF9zbGljZWRUb0FycmF5MihfcmVmNCwgMSksa2V5ID0gX3JlZjE2WzBdOwogICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmZXRjaENvbnRyb2xsZXJzLmRlbGV0ZShrZXkpOwogICAgICAgICAgICAgICAgICAgICAgICB9KTsgLy8gSWYgYW55IGxvYWRlcnMgcmV0dXJuZWQgYSByZWRpcmVjdCBSZXNwb25zZSwgc3RhcnQgYSBuZXcgUkVQTEFDRSBuYXZpZ2F0aW9uCgogICAgICAgICAgICAgICAgICAgICAgICByZWRpcmVjdCA9IGZpbmRSZWRpcmVjdChyZXN1bHRzKTtpZiAoIQoKICAgICAgICAgICAgICAgICAgICAgICAgcmVkaXJlY3QpIHtfY29udGV4dDgubmV4dCA9IDI0O2JyZWFrO31fY29udGV4dDgubmV4dCA9IDIzO3JldHVybiAoCiAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhcnRSZWRpcmVjdE5hdmlnYXRpb24oc3RhdGUsIHJlZGlyZWN0LCByZXBsYWNlKSk7Y2FzZSAyMzpyZXR1cm4gX2NvbnRleHQ4LmFicnVwdCgicmV0dXJuIiwKICAgICAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICAgIHNob3J0Q2lyY3VpdGVkOiB0cnVlCiAgICAgICAgICAgICAgICAgICAgICAgIH0pO2Nhc2UgMjQ6CiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFByb2Nlc3MgYW5kIGNvbW1pdCBvdXRwdXQgZnJvbSBsb2FkZXJzCiAgICAgICAgICAgICAgICAgICAgICAgIF9wcm9jZXNzTG9hZGVyRGF0YSA9CgoKCgogICAgICAgICAgICAgICAgICAgICAgICBwcm9jZXNzTG9hZGVyRGF0YShzdGF0ZSwgbWF0Y2hlcywgbWF0Y2hlc1RvTG9hZCwgbG9hZGVyUmVzdWx0cywgcGVuZGluZ0Vycm9yLCByZXZhbGlkYXRpbmdGZXRjaGVycywgZmV0Y2hlclJlc3VsdHMsIGFjdGl2ZURlZmVycmVkcyksIGxvYWRlckRhdGEgPSBfcHJvY2Vzc0xvYWRlckRhdGEubG9hZGVyRGF0YSwgZXJyb3JzID0gX3Byb2Nlc3NMb2FkZXJEYXRhLmVycm9yczsgLy8gV2lyZSB1cCBzdWJzY3JpYmVycyB0byB1cGRhdGUgbG9hZGVyRGF0YSBhcyBwcm9taXNlcyBzZXR0bGUKCiAgICAgICAgICAgICAgICAgICAgICAgIGFjdGl2ZURlZmVycmVkcy5mb3JFYWNoKChkZWZlcnJlZERhdGEsIHJvdXRlSWQpID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgICBkZWZlcnJlZERhdGEuc3Vic2NyaWJlKChhYm9ydGVkKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBOb3RlOiBObyBuZWVkIHRvIHVwZGF0ZVN0YXRlIGhlcmUgc2luY2UgdGhlIFRyYWNrZWRQcm9taXNlIG9uCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBsb2FkZXJEYXRhIGlzIHN0YWJsZSBhY3Jvc3MgcmVzb2x2ZS9yZWplY3QKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIFJlbW92ZSB0aGlzIGluc3RhbmNlIGlmIHdlIHdlcmUgYWJvcnRlZCBvciBpZiBwcm9taXNlcyBoYXZlIHNldHRsZWQKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChhYm9ydGVkIHx8IGRlZmVycmVkRGF0YS5kb25lKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFjdGl2ZURlZmVycmVkcy5kZWxldGUocm91dGVJZCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgICBtYXJrRmV0Y2hSZWRpcmVjdHNEb25lKCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGRpZEFib3J0RmV0Y2hMb2FkcyA9IGFib3J0U3RhbGVGZXRjaExvYWRzKHBlbmRpbmdOYXZpZ2F0aW9uTG9hZElkKTtyZXR1cm4gX2NvbnRleHQ4LmFicnVwdCgicmV0dXJuIiwKICAgICAgICAgICAgICAgICAgICAgICAgX2V4dGVuZHMoewogICAgICAgICAgICAgICAgICAgICAgICAgIGxvYWRlckRhdGE6IGxvYWRlckRhdGEsCiAgICAgICAgICAgICAgICAgICAgICAgICAgZXJyb3JzOiBlcnJvcnMKICAgICAgICAgICAgICAgICAgICAgICAgfSwgZGlkQWJvcnRGZXRjaExvYWRzIHx8IHJldmFsaWRhdGluZ0ZldGNoZXJzLmxlbmd0aCA+IDAgPyB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgZmV0Y2hlcnM6IG5ldyBNYXAoc3RhdGUuZmV0Y2hlcnMpCiAgICAgICAgICAgICAgICAgICAgICAgIH0gOiB7fSkpO2Nhc2UgMjk6Y2FzZSAiZW5kIjpyZXR1cm4gX2NvbnRleHQ4LnN0b3AoKTt9fX0sIF9jYWxsZWU4KTt9KSk7cmV0dXJuIF9oYW5kbGVMb2FkZXJzLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7fQoKCiAgICAgICAgICAgIGZ1bmN0aW9uIGdldEZldGNoZXIoa2V5KSB7CiAgICAgICAgICAgICAgcmV0dXJuIHN0YXRlLmZldGNoZXJzLmdldChrZXkpIHx8IElETEVfRkVUQ0hFUjsKICAgICAgICAgICAgfSAvLyBUcmlnZ2VyIGEgZmV0Y2hlciBsb2FkL3N1Ym1pdCBmb3IgdGhlIGdpdmVuIGZldGNoZXIga2V5CgoKICAgICAgICAgICAgZnVuY3Rpb24gZmV0Y2goa2V5LCByb3V0ZUlkLCBocmVmLCBvcHRzKSB7CiAgICAgICAgICAgICAgaWYgKGlzU2VydmVyKSB7CiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoInJvdXRlci5mZXRjaCgpIHdhcyBjYWxsZWQgZHVyaW5nIHRoZSBzZXJ2ZXIgcmVuZGVyLCBidXQgaXQgc2hvdWxkbid0IGJlLiAiICsgIllvdSBhcmUgbGlrZWx5IGNhbGxpbmcgYSB1c2VGZXRjaGVyKCkgbWV0aG9kIGluIHRoZSBib2R5IG9mIHlvdXIgY29tcG9uZW50LiAiICsgIlRyeSBtb3ZpbmcgaXQgdG8gYSB1c2VFZmZlY3Qgb3IgYSBjYWxsYmFjay4iKTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIGlmIChmZXRjaENvbnRyb2xsZXJzLmhhcyhrZXkpKSBhYm9ydEZldGNoZXIoa2V5KTsKICAgICAgICAgICAgICB2YXIgbWF0Y2hlcyA9IG1hdGNoUm91dGVzKGRhdGFSb3V0ZXMsIGhyZWYsIGluaXQuYmFzZW5hbWUpOwoKICAgICAgICAgICAgICBpZiAoIW1hdGNoZXMpIHsKICAgICAgICAgICAgICAgIHNldEZldGNoZXJFcnJvcihrZXksIHJvdXRlSWQsIGdldEludGVybmFsUm91dGVyRXJyb3IoNDA0LCB7CiAgICAgICAgICAgICAgICAgIHBhdGhuYW1lOiBocmVmCiAgICAgICAgICAgICAgICB9KSk7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICB2YXIgX25vcm1hbGl6ZU5hdmlnYXRlT3B0ID0KCgogICAgICAgICAgICAgICAgbm9ybWFsaXplTmF2aWdhdGVPcHRpb25zKGhyZWYsIG9wdHMsIHRydWUpLHBhdGggPSBfbm9ybWFsaXplTmF2aWdhdGVPcHQucGF0aCxzdWJtaXNzaW9uID0gX25vcm1hbGl6ZU5hdmlnYXRlT3B0LnN1Ym1pc3Npb247CiAgICAgICAgICAgICAgdmFyIG1hdGNoID0gZ2V0VGFyZ2V0TWF0Y2gobWF0Y2hlcywgcGF0aCk7CgogICAgICAgICAgICAgIGlmIChzdWJtaXNzaW9uKSB7CiAgICAgICAgICAgICAgICBoYW5kbGVGZXRjaGVyQWN0aW9uKGtleSwgcm91dGVJZCwgcGF0aCwgbWF0Y2gsIG1hdGNoZXMsIHN1Ym1pc3Npb24pOwogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgIH0gLy8gU3RvcmUgb2ZmIHRoZSBtYXRjaCBzbyB3ZSBjYW4gY2FsbCBpdCdzIHNob3VsZFJldmFsaWRhdGUgb24gc3Vic2VxdWVudAogICAgICAgICAgICAgIC8vIHJldmFsaWRhdGlvbnMKCgogICAgICAgICAgICAgIGZldGNoTG9hZE1hdGNoZXMuc2V0KGtleSwgW3BhdGgsIG1hdGNoLCBtYXRjaGVzXSk7CiAgICAgICAgICAgICAgaGFuZGxlRmV0Y2hlckxvYWRlcihrZXksIHJvdXRlSWQsIHBhdGgsIG1hdGNoLCBtYXRjaGVzKTsKICAgICAgICAgICAgfSAvLyBDYWxsIHRoZSBhY3Rpb24gZm9yIHRoZSBtYXRjaGVkIGZldGNoZXIuc3VibWl0KCksIGFuZCB0aGVuIGhhbmRsZSByZWRpcmVjdHMsCiAgICAgICAgICAgIC8vIGVycm9ycywgYW5kIHJldmFsaWRhdGlvbgogICAgICAgICAgICBmdW5jdGlvbgoKICAgICAgICAgICAgaGFuZGxlRmV0Y2hlckFjdGlvbihfeDI0LCBfeDI1LCBfeDI2LCBfeDI3LCBfeDI4LCBfeDI5KSB7cmV0dXJuIF9oYW5kbGVGZXRjaGVyQWN0aW9uLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7fQoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKICAgICAgICAgICAgLy8gQ2FsbCB0aGUgbWF0Y2hlZCBsb2FkZXIgZm9yIGZldGNoZXIubG9hZCgpLCBoYW5kbGluZyByZWRpcmVjdHMsIGVycm9ycywgZXRjLgogICAgICAgICAgICBmdW5jdGlvbiBfaGFuZGxlRmV0Y2hlckFjdGlvbigpIHtfaGFuZGxlRmV0Y2hlckFjdGlvbiA9IF9hc3luY1RvR2VuZXJhdG9yMiggLyojX19QVVJFX18qL19yZWdlbmVyYXRvclJ1bnRpbWUyKCkubWFyayhmdW5jdGlvbiBfY2FsbGVlOShrZXksIHJvdXRlSWQsIHBhdGgsIG1hdGNoLCByZXF1ZXN0TWF0Y2hlcywgc3VibWlzc2lvbikge3ZhciBfZXJyb3IyLCBleGlzdGluZ0ZldGNoZXIsIGZldGNoZXIsIGFib3J0Q29udHJvbGxlciwgZmV0Y2hSZXF1ZXN0LCBhY3Rpb25SZXN1bHQsIGxvYWRpbmdGZXRjaGVyLCBuZXh0TG9jYXRpb24sIHJldmFsaWRhdGlvblJlcXVlc3QsIG1hdGNoZXMsIGxvYWRJZCwgbG9hZEZldGNoZXIsIF9nZXRNYXRjaGVzVG9Mb2FkMywgX2dldE1hdGNoZXNUb0xvYWQ0LCBtYXRjaGVzVG9Mb2FkLCByZXZhbGlkYXRpbmdGZXRjaGVycywgX3lpZWxkJGNhbGxMb2FkZXJzQW5kMiwgcmVzdWx0cywgbG9hZGVyUmVzdWx0cywgZmV0Y2hlclJlc3VsdHMsIHJlZGlyZWN0LCBfcHJvY2Vzc0xvYWRlckRhdGEyLCBsb2FkZXJEYXRhLCBlcnJvcnMsIGRvbmVGZXRjaGVyLCBkaWRBYm9ydEZldGNoTG9hZHM7cmV0dXJuIF9yZWdlbmVyYXRvclJ1bnRpbWUyKCkud3JhcChmdW5jdGlvbiBfY2FsbGVlOSQoX2NvbnRleHQ5KSB7d2hpbGUgKDEpIHtzd2l0Y2ggKF9jb250ZXh0OS5wcmV2ID0gX2NvbnRleHQ5Lm5leHQpIHtjYXNlIDA6aW50ZXJydXB0QWN0aXZlTG9hZHMoKTtmZXRjaExvYWRNYXRjaGVzLmRlbGV0ZShrZXkpO2lmIChtYXRjaC5yb3V0ZS5hY3Rpb24pIHtfY29udGV4dDkubmV4dCA9IDY7YnJlYWs7fV9lcnJvcjIgPSBnZXRJbnRlcm5hbFJvdXRlckVycm9yKDQwNSwgeyBtZXRob2Q6IHN1Ym1pc3Npb24uZm9ybU1ldGhvZCwgcGF0aG5hbWU6IHBhdGgsIHJvdXRlSWQ6IHJvdXRlSWQgfSk7c2V0RmV0Y2hlckVycm9yKGtleSwgcm91dGVJZCwgX2Vycm9yMik7cmV0dXJuIF9jb250ZXh0OS5hYnJ1cHQoInJldHVybiIpO2Nhc2UgNjogLy8gUHV0IHRoaXMgZmV0Y2hlciBpbnRvIGl0J3Mgc3VibWl0dGluZyBzdGF0ZQogICAgICAgICAgICAgICAgICAgICAgICBleGlzdGluZ0ZldGNoZXIgPSBzdGF0ZS5mZXRjaGVycy5nZXQoa2V5KTtmZXRjaGVyID0gX2V4dGVuZHMoeyBzdGF0ZTogInN1Ym1pdHRpbmciIH0sIHN1Ym1pc3Npb24sIHsgZGF0YTogZXhpc3RpbmdGZXRjaGVyICYmIGV4aXN0aW5nRmV0Y2hlci5kYXRhIH0pO3N0YXRlLmZldGNoZXJzLnNldChrZXksIGZldGNoZXIpO3VwZGF0ZVN0YXRlKHsgZmV0Y2hlcnM6IG5ldyBNYXAoc3RhdGUuZmV0Y2hlcnMpIH0pOyAvLyBDYWxsIHRoZSBhY3Rpb24gZm9yIHRoZSBmZXRjaGVyCiAgICAgICAgICAgICAgICAgICAgICAgIGFib3J0Q29udHJvbGxlciA9IG5ldyBBYm9ydENvbnRyb2xsZXIoKTtmZXRjaFJlcXVlc3QgPSBjcmVhdGVSZXF1ZXN0KHBhdGgsIGFib3J0Q29udHJvbGxlci5zaWduYWwsIHN1Ym1pc3Npb24pO2ZldGNoQ29udHJvbGxlcnMuc2V0KGtleSwgYWJvcnRDb250cm9sbGVyKTtfY29udGV4dDkubmV4dCA9IDE1O3JldHVybiBjYWxsTG9hZGVyT3JBY3Rpb24oImFjdGlvbiIsIGZldGNoUmVxdWVzdCwgbWF0Y2gsIHJlcXVlc3RNYXRjaGVzLCByb3V0ZXIuYmFzZW5hbWUpO2Nhc2UgMTU6YWN0aW9uUmVzdWx0ID0gX2NvbnRleHQ5LnNlbnQ7aWYgKCFmZXRjaFJlcXVlc3Quc2lnbmFsLmFib3J0ZWQpIHtfY29udGV4dDkubmV4dCA9IDE5O2JyZWFrO30gLy8gV2UgY2FuIGRlbGV0ZSB0aGlzIHNvIGxvbmcgYXMgd2Ugd2VyZW4ndCBhYm9ydGVkIGJ5IG91IG91ciBvd24gZmV0Y2hlcgogICAgICAgICAgICAgICAgICAgICAgICAvLyByZS1zdWJtaXQgd2hpY2ggd291bGQgaGF2ZSBwdXQgX25ld18gY29udHJvbGxlciBpcyBpbiBmZXRjaENvbnRyb2xsZXJzCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChmZXRjaENvbnRyb2xsZXJzLmdldChrZXkpID09PSBhYm9ydENvbnRyb2xsZXIpIHtmZXRjaENvbnRyb2xsZXJzLmRlbGV0ZShrZXkpO31yZXR1cm4gX2NvbnRleHQ5LmFicnVwdCgicmV0dXJuIik7Y2FzZSAxOTppZiAoIWlzUmVkaXJlY3RSZXN1bHQoYWN0aW9uUmVzdWx0KSkge19jb250ZXh0OS5uZXh0ID0gMjY7YnJlYWs7fWZldGNoQ29udHJvbGxlcnMuZGVsZXRlKGtleSk7ZmV0Y2hSZWRpcmVjdElkcy5hZGQoa2V5KTtsb2FkaW5nRmV0Y2hlciA9IF9leHRlbmRzKHsgc3RhdGU6ICJsb2FkaW5nIiB9LCBzdWJtaXNzaW9uLCB7IGRhdGE6IHVuZGVmaW5lZCB9KTtzdGF0ZS5mZXRjaGVycy5zZXQoa2V5LCBsb2FkaW5nRmV0Y2hlcik7dXBkYXRlU3RhdGUoeyBmZXRjaGVyczogbmV3IE1hcChzdGF0ZS5mZXRjaGVycykgfSk7cmV0dXJuIF9jb250ZXh0OS5hYnJ1cHQoInJldHVybiIsIHN0YXJ0UmVkaXJlY3ROYXZpZ2F0aW9uKHN0YXRlLCBhY3Rpb25SZXN1bHQpKTtjYXNlIDI2OmlmICghaXNFcnJvclJlc3VsdChhY3Rpb25SZXN1bHQpKSB7X2NvbnRleHQ5Lm5leHQgPSAyOTticmVhazt9c2V0RmV0Y2hlckVycm9yKGtleSwgcm91dGVJZCwgYWN0aW9uUmVzdWx0LmVycm9yKTtyZXR1cm4gX2NvbnRleHQ5LmFicnVwdCgicmV0dXJuIik7Y2FzZSAyOTppZiAoaXNEZWZlcnJlZFJlc3VsdChhY3Rpb25SZXN1bHQpKSB7cm91dGVyX2ludmFyaWFudChmYWxzZSwgImRlZmVyKCkgaXMgbm90IHN1cHBvcnRlZCBpbiBhY3Rpb25zIik7fSAvLyBTdGFydCB0aGUgZGF0YSBsb2FkIGZvciBjdXJyZW50IG1hdGNoZXMsIG9yIHRoZSBuZXh0IGxvY2F0aW9uIGlmIHdlJ3JlCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIGluIHRoZSBtaWRkbGUgb2YgYSBuYXZpZ2F0aW9uCiAgICAgICAgICAgICAgICAgICAgICAgIG5leHRMb2NhdGlvbiA9IHN0YXRlLm5hdmlnYXRpb24ubG9jYXRpb24gfHwgc3RhdGUubG9jYXRpb247cmV2YWxpZGF0aW9uUmVxdWVzdCA9IGNyZWF0ZVJlcXVlc3QobmV4dExvY2F0aW9uLCBhYm9ydENvbnRyb2xsZXIuc2lnbmFsKTttYXRjaGVzID0gc3RhdGUubmF2aWdhdGlvbi5zdGF0ZSAhPT0gImlkbGUiID8gbWF0Y2hSb3V0ZXMoZGF0YVJvdXRlcywgc3RhdGUubmF2aWdhdGlvbi5sb2NhdGlvbiwgaW5pdC5iYXNlbmFtZSkgOiBzdGF0ZS5tYXRjaGVzO3JvdXRlcl9pbnZhcmlhbnQobWF0Y2hlcywgIkRpZG4ndCBmaW5kIGFueSBtYXRjaGVzIGFmdGVyIGZldGNoZXIgYWN0aW9uIik7bG9hZElkID0gKytpbmNyZW1lbnRpbmdMb2FkSWQ7ZmV0Y2hSZWxvYWRJZHMuc2V0KGtleSwgbG9hZElkKTtsb2FkRmV0Y2hlciA9IF9leHRlbmRzKHsgc3RhdGU6ICJsb2FkaW5nIiwgZGF0YTogYWN0aW9uUmVzdWx0LmRhdGEgfSwgc3VibWlzc2lvbik7c3RhdGUuZmV0Y2hlcnMuc2V0KGtleSwgbG9hZEZldGNoZXIpO19nZXRNYXRjaGVzVG9Mb2FkMyA9IGdldE1hdGNoZXNUb0xvYWQoc3RhdGUsIG1hdGNoZXMsIHN1Ym1pc3Npb24sIG5leHRMb2NhdGlvbiwgaXNSZXZhbGlkYXRpb25SZXF1aXJlZCwgY2FuY2VsbGVkRGVmZXJyZWRSb3V0ZXMsIGNhbmNlbGxlZEZldGNoZXJMb2FkcywgX2RlZmluZVByb3BlcnR5Mih7fSwgbWF0Y2gucm91dGUuaWQsIGFjdGlvblJlc3VsdC5kYXRhKSwgdW5kZWZpbmVkLCAvLyBObyBuZWVkIHRvIHNlbmQgdGhyb3VnaCBlcnJvcnMgc2luY2Ugd2Ugc2hvcnQgY2lyY3VpdCBhYm92ZQogICAgICAgICAgICAgICAgICAgICAgICBmZXRjaExvYWRNYXRjaGVzKSwgX2dldE1hdGNoZXNUb0xvYWQ0ID0gX3NsaWNlZFRvQXJyYXkyKF9nZXRNYXRjaGVzVG9Mb2FkMywgMiksIG1hdGNoZXNUb0xvYWQgPSBfZ2V0TWF0Y2hlc1RvTG9hZDRbMF0sIHJldmFsaWRhdGluZ0ZldGNoZXJzID0gX2dldE1hdGNoZXNUb0xvYWQ0WzFdOyAvLyBQdXQgYWxsIHJldmFsaWRhdGluZyBmZXRjaGVycyBpbnRvIHRoZSBsb2FkaW5nIHN0YXRlLCBleGNlcHQgZm9yIHRoZQogICAgICAgICAgICAgICAgICAgICAgICAvLyBjdXJyZW50IGZldGNoZXIgd2hpY2ggd2Ugd2FudCB0byBrZWVwIGluIGl0J3MgY3VycmVudCBsb2FkaW5nIHN0YXRlIHdoaWNoCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIGNvbnRhaW5zIGl0J3MgYWN0aW9uIHN1Ym1pc3Npb24gaW5mbyArIGFjdGlvbiBkYXRhCiAgICAgICAgICAgICAgICAgICAgICAgIHJldmFsaWRhdGluZ0ZldGNoZXJzLmZpbHRlcigoX3JlZjUpID0+IHt2YXIgX3JlZjE3ID0gX3NsaWNlZFRvQXJyYXkyKF9yZWY1LCAxKSxzdGFsZUtleSA9IF9yZWYxN1swXTtyZXR1cm4gc3RhbGVLZXkgIT09IGtleTt9KS5mb3JFYWNoKChfcmVmNikgPT4ge3ZhciBfcmVmMTggPSBfc2xpY2VkVG9BcnJheTIoX3JlZjYsIDEpLHN0YWxlS2V5ID0gX3JlZjE4WzBdO3ZhciBleGlzdGluZ0ZldGNoZXIgPSBzdGF0ZS5mZXRjaGVycy5nZXQoc3RhbGVLZXkpO3ZhciByZXZhbGlkYXRpbmdGZXRjaGVyID0geyBzdGF0ZTogImxvYWRpbmciLCBkYXRhOiBleGlzdGluZ0ZldGNoZXIgJiYgZXhpc3RpbmdGZXRjaGVyLmRhdGEsIGZvcm1NZXRob2Q6IHVuZGVmaW5lZCwgZm9ybUFjdGlvbjogdW5kZWZpbmVkLCBmb3JtRW5jVHlwZTogdW5kZWZpbmVkLCBmb3JtRGF0YTogdW5kZWZpbmVkIH07c3RhdGUuZmV0Y2hlcnMuc2V0KHN0YWxlS2V5LCByZXZhbGlkYXRpbmdGZXRjaGVyKTtmZXRjaENvbnRyb2xsZXJzLnNldChzdGFsZUtleSwgYWJvcnRDb250cm9sbGVyKTt9KTt1cGRhdGVTdGF0ZSh7IGZldGNoZXJzOiBuZXcgTWFwKHN0YXRlLmZldGNoZXJzKSB9KTtfY29udGV4dDkubmV4dCA9IDQzO3JldHVybiBjYWxsTG9hZGVyc0FuZE1heWJlUmVzb2x2ZURhdGEoc3RhdGUubWF0Y2hlcywgbWF0Y2hlcywgbWF0Y2hlc1RvTG9hZCwgcmV2YWxpZGF0aW5nRmV0Y2hlcnMsIHJldmFsaWRhdGlvblJlcXVlc3QpO2Nhc2UgNDM6X3lpZWxkJGNhbGxMb2FkZXJzQW5kMiA9IF9jb250ZXh0OS5zZW50O3Jlc3VsdHMgPSBfeWllbGQkY2FsbExvYWRlcnNBbmQyLnJlc3VsdHM7bG9hZGVyUmVzdWx0cyA9IF95aWVsZCRjYWxsTG9hZGVyc0FuZDIubG9hZGVyUmVzdWx0cztmZXRjaGVyUmVzdWx0cyA9IF95aWVsZCRjYWxsTG9hZGVyc0FuZDIuZmV0Y2hlclJlc3VsdHM7aWYgKCFhYm9ydENvbnRyb2xsZXIuc2lnbmFsLmFib3J0ZWQpIHtfY29udGV4dDkubmV4dCA9IDQ5O2JyZWFrO31yZXR1cm4gX2NvbnRleHQ5LmFicnVwdCgicmV0dXJuIik7Y2FzZSA0OTpmZXRjaFJlbG9hZElkcy5kZWxldGUoa2V5KTtmZXRjaENvbnRyb2xsZXJzLmRlbGV0ZShrZXkpO3JldmFsaWRhdGluZ0ZldGNoZXJzLmZvckVhY2goKF9yZWY3KSA9PiB7dmFyIF9yZWYxOSA9IF9zbGljZWRUb0FycmF5MihfcmVmNywgMSksc3RhbGVLZXkgPSBfcmVmMTlbMF07cmV0dXJuIGZldGNoQ29udHJvbGxlcnMuZGVsZXRlKHN0YWxlS2V5KTt9KTtyZWRpcmVjdCA9IGZpbmRSZWRpcmVjdChyZXN1bHRzKTtpZiAoIXJlZGlyZWN0KSB7X2NvbnRleHQ5Lm5leHQgPSA1NTticmVhazt9cmV0dXJuIF9jb250ZXh0OS5hYnJ1cHQoInJldHVybiIsIHN0YXJ0UmVkaXJlY3ROYXZpZ2F0aW9uKHN0YXRlLCByZWRpcmVjdCkpO2Nhc2UgNTU6IC8vIFByb2Nlc3MgYW5kIGNvbW1pdCBvdXRwdXQgZnJvbSBsb2FkZXJzCiAgICAgICAgICAgICAgICAgICAgICAgIF9wcm9jZXNzTG9hZGVyRGF0YTIgPSBwcm9jZXNzTG9hZGVyRGF0YShzdGF0ZSwgc3RhdGUubWF0Y2hlcywgbWF0Y2hlc1RvTG9hZCwgbG9hZGVyUmVzdWx0cywgdW5kZWZpbmVkLCByZXZhbGlkYXRpbmdGZXRjaGVycywgZmV0Y2hlclJlc3VsdHMsIGFjdGl2ZURlZmVycmVkcyksIGxvYWRlckRhdGEgPSBfcHJvY2Vzc0xvYWRlckRhdGEyLmxvYWRlckRhdGEsIGVycm9ycyA9IF9wcm9jZXNzTG9hZGVyRGF0YTIuZXJyb3JzO2RvbmVGZXRjaGVyID0geyBzdGF0ZTogImlkbGUiLCBkYXRhOiBhY3Rpb25SZXN1bHQuZGF0YSwgZm9ybU1ldGhvZDogdW5kZWZpbmVkLCBmb3JtQWN0aW9uOiB1bmRlZmluZWQsIGZvcm1FbmNUeXBlOiB1bmRlZmluZWQsIGZvcm1EYXRhOiB1bmRlZmluZWQgfTtzdGF0ZS5mZXRjaGVycy5zZXQoa2V5LCBkb25lRmV0Y2hlcik7ZGlkQWJvcnRGZXRjaExvYWRzID0gYWJvcnRTdGFsZUZldGNoTG9hZHMobG9hZElkKTsgLy8gSWYgd2UgYXJlIGN1cnJlbnRseSBpbiBhIG5hdmlnYXRpb24gbG9hZGluZyBzdGF0ZSBhbmQgdGhpcyBmZXRjaGVyIGlzCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIG1vcmUgcmVjZW50IHRoYW4gdGhlIG5hdmlnYXRpb24sIHdlIHdhbnQgdGhlIG5ld2VyIGRhdGEgc28gYWJvcnQgdGhlCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIG5hdmlnYXRpb24gYW5kIGNvbXBsZXRlIGl0IHdpdGggdGhlIGZldGNoZXIgZGF0YQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoc3RhdGUubmF2aWdhdGlvbi5zdGF0ZSA9PT0gImxvYWRpbmciICYmIGxvYWRJZCA+IHBlbmRpbmdOYXZpZ2F0aW9uTG9hZElkKSB7cm91dGVyX2ludmFyaWFudChwZW5kaW5nQWN0aW9uLCAiRXhwZWN0ZWQgcGVuZGluZyBhY3Rpb24iKTtwZW5kaW5nTmF2aWdhdGlvbkNvbnRyb2xsZXIgJiYgcGVuZGluZ05hdmlnYXRpb25Db250cm9sbGVyLmFib3J0KCk7Y29tcGxldGVOYXZpZ2F0aW9uKHN0YXRlLm5hdmlnYXRpb24ubG9jYXRpb24sIHsgbWF0Y2hlczogbWF0Y2hlcywgbG9hZGVyRGF0YTogbG9hZGVyRGF0YSwgZXJyb3JzOiBlcnJvcnMsIGZldGNoZXJzOiBuZXcgTWFwKHN0YXRlLmZldGNoZXJzKSB9KTt9IGVsc2Ugey8vIG90aGVyd2lzZSBqdXN0IHVwZGF0ZSB3aXRoIHRoZSBmZXRjaGVyIGRhdGEsIHByZXNlcnZpbmcgYW55IGV4aXN0aW5nCiAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gbG9hZGVyRGF0YSBmb3IgbG9hZGVycyB0aGF0IGRpZCBub3QgbmVlZCB0byByZWxvYWQuICBXZSBoYXZlIHRvCiAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gbWFudWFsbHkgbWVyZ2UgaGVyZSBzaW5jZSB3ZSBhcmVuJ3QgZ29pbmcgdGhyb3VnaCBjb21wbGV0ZU5hdmlnYXRpb24KICAgICAgICAgICAgICAgICAgICAgICAgICB1cGRhdGVTdGF0ZShfZXh0ZW5kcyh7IGVycm9yczogZXJyb3JzLCBsb2FkZXJEYXRhOiBtZXJnZUxvYWRlckRhdGEoc3RhdGUubG9hZGVyRGF0YSwgbG9hZGVyRGF0YSwgbWF0Y2hlcykgfSwgZGlkQWJvcnRGZXRjaExvYWRzID8geyBmZXRjaGVyczogbmV3IE1hcChzdGF0ZS5mZXRjaGVycykgfSA6IHt9KSk7aXNSZXZhbGlkYXRpb25SZXF1aXJlZCA9IGZhbHNlO31jYXNlIDYwOmNhc2UgImVuZCI6cmV0dXJuIF9jb250ZXh0OS5zdG9wKCk7fX19LCBfY2FsbGVlOSk7fSkpO3JldHVybiBfaGFuZGxlRmV0Y2hlckFjdGlvbi5hcHBseSh0aGlzLCBhcmd1bWVudHMpO31mdW5jdGlvbiBoYW5kbGVGZXRjaGVyTG9hZGVyKF94MzAsIF94MzEsIF94MzIsIF94MzMsIF94MzQpIHtyZXR1cm4gX2hhbmRsZUZldGNoZXJMb2FkZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKTt9CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKICAgICAgICAgICAgLyoqCiAgICAgICAgICAgICAqIFV0aWxpdHkgZnVuY3Rpb24gdG8gaGFuZGxlIHJlZGlyZWN0cyByZXR1cm5lZCBmcm9tIGFuIGFjdGlvbiBvciBsb2FkZXIuCiAgICAgICAgICAgICAqIE5vcm1hbGx5LCBhIHJlZGlyZWN0ICJyZXBsYWNlcyIgdGhlIG5hdmlnYXRpb24gdGhhdCB0cmlnZ2VyZWQgaXQuICBTbywgZm9yCiAgICAgICAgICAgICAqIGV4YW1wbGU6CiAgICAgICAgICAgICAqCiAgICAgICAgICAgICAqICAtIHVzZXIgaXMgb24gL2EKICAgICAgICAgICAgICogIC0gdXNlciBjbGlja3MgYSBsaW5rIHRvIC9iCiAgICAgICAgICAgICAqICAtIGxvYWRlciBmb3IgL2IgcmVkaXJlY3RzIHRvIC9jCiAgICAgICAgICAgICAqCiAgICAgICAgICAgICAqIEluIGEgbm9uLUpTIGFwcCB0aGUgYnJvd3NlciB3b3VsZCB0cmFjayB0aGUgaW4tZmxpZ2h0IG5hdmlnYXRpb24gdG8gL2IgYW5kCiAgICAgICAgICAgICAqIHRoZW4gcmVwbGFjZSBpdCB3aXRoIC9jIHdoZW4gaXQgZW5jb3VudGVyZWQgdGhlIHJlZGlyZWN0IHJlc3BvbnNlLiAgSW4KICAgICAgICAgICAgICogdGhlIGVuZCBpdCB3b3VsZCBvbmx5IGV2ZXIgdXBkYXRlIHRoZSBVUkwgYmFyIHdpdGggL2MuCiAgICAgICAgICAgICAqCiAgICAgICAgICAgICAqIEluIGNsaWVudC1zaWRlIHJvdXRpbmcgdXNpbmcgcHVzaFN0YXRlL3JlcGxhY2VTdGF0ZSwgd2UgYWltIHRvIGVtdWxhdGUKICAgICAgICAgICAgICogdGhpcyBiZWhhdmlvciBhbmQgd2UgYWxzbyBkbyBub3QgdXBkYXRlIGhpc3RvcnkgdW50aWwgdGhlIGVuZCBvZiB0aGUKICAgICAgICAgICAgICogbmF2aWdhdGlvbiAoaW5jbHVkaW5nIHByb2Nlc3NlZCByZWRpcmVjdHMpLiAgVGhpcyBtZWFucyB0aGF0IHdlIG5ldmVyCiAgICAgICAgICAgICAqIGFjdHVhbGx5IHRvdWNoIGhpc3RvcnkgdW50aWwgd2UndmUgcHJvY2Vzc2VkIHJlZGlyZWN0cywgc28gd2UganVzdCB1c2UKICAgICAgICAgICAgICogdGhlIGhpc3RvcnkgYWN0aW9uIGZyb20gdGhlIG9yaWdpbmFsIG5hdmlnYXRpb24gKFBVU0ggb3IgUkVQTEFDRSkuCiAgICAgICAgICAgICAqL2Z1bmN0aW9uIF9oYW5kbGVGZXRjaGVyTG9hZGVyKCkge19oYW5kbGVGZXRjaGVyTG9hZGVyID0gX2FzeW5jVG9HZW5lcmF0b3IyKCAvKiNfX1BVUkVfXyovX3JlZ2VuZXJhdG9yUnVudGltZTIoKS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUxMChrZXksIHJvdXRlSWQsIHBhdGgsIG1hdGNoLCBtYXRjaGVzKSB7dmFyIGV4aXN0aW5nRmV0Y2hlciwgbG9hZGluZ0ZldGNoZXIsIGFib3J0Q29udHJvbGxlciwgZmV0Y2hSZXF1ZXN0LCByZXN1bHQsIGJvdW5kYXJ5TWF0Y2gsIGRvbmVGZXRjaGVyO3JldHVybiBfcmVnZW5lcmF0b3JSdW50aW1lMigpLndyYXAoZnVuY3Rpb24gX2NhbGxlZTEwJChfY29udGV4dDEwKSB7d2hpbGUgKDEpIHtzd2l0Y2ggKF9jb250ZXh0MTAucHJldiA9IF9jb250ZXh0MTAubmV4dCkge2Nhc2UgMDpleGlzdGluZ0ZldGNoZXIgPSBzdGF0ZS5mZXRjaGVycy5nZXQoa2V5KTsgLy8gUHV0IHRoaXMgZmV0Y2hlciBpbnRvIGl0J3MgbG9hZGluZyBzdGF0ZQogICAgICAgICAgICAgICAgICAgICAgICBsb2FkaW5nRmV0Y2hlciA9IHsgc3RhdGU6ICJsb2FkaW5nIiwgZm9ybU1ldGhvZDogdW5kZWZpbmVkLCBmb3JtQWN0aW9uOiB1bmRlZmluZWQsIGZvcm1FbmNUeXBlOiB1bmRlZmluZWQsIGZvcm1EYXRhOiB1bmRlZmluZWQsIGRhdGE6IGV4aXN0aW5nRmV0Y2hlciAmJiBleGlzdGluZ0ZldGNoZXIuZGF0YSB9O3N0YXRlLmZldGNoZXJzLnNldChrZXksIGxvYWRpbmdGZXRjaGVyKTt1cGRhdGVTdGF0ZSh7IGZldGNoZXJzOiBuZXcgTWFwKHN0YXRlLmZldGNoZXJzKSB9KTsgLy8gQ2FsbCB0aGUgbG9hZGVyIGZvciB0aGlzIGZldGNoZXIgcm91dGUgbWF0Y2gKICAgICAgICAgICAgICAgICAgICAgICAgYWJvcnRDb250cm9sbGVyID0gbmV3IEFib3J0Q29udHJvbGxlcigpO2ZldGNoUmVxdWVzdCA9IGNyZWF0ZVJlcXVlc3QocGF0aCwgYWJvcnRDb250cm9sbGVyLnNpZ25hbCk7ZmV0Y2hDb250cm9sbGVycy5zZXQoa2V5LCBhYm9ydENvbnRyb2xsZXIpO19jb250ZXh0MTAubmV4dCA9IDk7cmV0dXJuIGNhbGxMb2FkZXJPckFjdGlvbigibG9hZGVyIiwgZmV0Y2hSZXF1ZXN0LCBtYXRjaCwgbWF0Y2hlcywgcm91dGVyLmJhc2VuYW1lKTtjYXNlIDk6cmVzdWx0ID0gX2NvbnRleHQxMC5zZW50O2lmICghaXNEZWZlcnJlZFJlc3VsdChyZXN1bHQpKSB7X2NvbnRleHQxMC5uZXh0ID0gMTc7YnJlYWs7fV9jb250ZXh0MTAubmV4dCA9IDEzO3JldHVybiByZXNvbHZlRGVmZXJyZWREYXRhKHJlc3VsdCwgZmV0Y2hSZXF1ZXN0LnNpZ25hbCwgdHJ1ZSk7Y2FzZSAxMzpfY29udGV4dDEwLnQwID0gX2NvbnRleHQxMC5zZW50O2lmIChfY29udGV4dDEwLnQwKSB7X2NvbnRleHQxMC5uZXh0ID0gMTY7YnJlYWs7fV9jb250ZXh0MTAudDAgPSByZXN1bHQ7Y2FzZSAxNjpyZXN1bHQgPSBfY29udGV4dDEwLnQwO2Nhc2UgMTc6IC8vIFdlIGNhbiBkZWxldGUgdGhpcyBzbyBsb25nIGFzIHdlIHdlcmVuJ3QgYWJvcnRlZCBieSBvdSBvdXIgb3duIGZldGNoZXIKICAgICAgICAgICAgICAgICAgICAgICAgLy8gcmUtbG9hZCB3aGljaCB3b3VsZCBoYXZlIHB1dCBfbmV3XyBjb250cm9sbGVyIGlzIGluIGZldGNoQ29udHJvbGxlcnMKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGZldGNoQ29udHJvbGxlcnMuZ2V0KGtleSkgPT09IGFib3J0Q29udHJvbGxlcikge2ZldGNoQ29udHJvbGxlcnMuZGVsZXRlKGtleSk7fWlmICghZmV0Y2hSZXF1ZXN0LnNpZ25hbC5hYm9ydGVkKSB7X2NvbnRleHQxMC5uZXh0ID0gMjA7YnJlYWs7fXJldHVybiBfY29udGV4dDEwLmFicnVwdCgicmV0dXJuIik7Y2FzZSAyMDppZiAoIWlzUmVkaXJlY3RSZXN1bHQocmVzdWx0KSkge19jb250ZXh0MTAubmV4dCA9IDI0O2JyZWFrO31fY29udGV4dDEwLm5leHQgPSAyMztyZXR1cm4gc3RhcnRSZWRpcmVjdE5hdmlnYXRpb24oc3RhdGUsIHJlc3VsdCk7Y2FzZSAyMzpyZXR1cm4gX2NvbnRleHQxMC5hYnJ1cHQoInJldHVybiIpO2Nhc2UgMjQ6aWYgKCFpc0Vycm9yUmVzdWx0KHJlc3VsdCkpIHtfY29udGV4dDEwLm5leHQgPSAyOTticmVhazt9Ym91bmRhcnlNYXRjaCA9IGZpbmROZWFyZXN0Qm91bmRhcnkoc3RhdGUubWF0Y2hlcywgcm91dGVJZCk7c3RhdGUuZmV0Y2hlcnMuZGVsZXRlKGtleSk7IC8vIFRPRE86IEluIHJlbWl4LCB0aGlzIHdvdWxkIHJlc2V0IHRvIElETEVfTkFWSUdBVElPTiBpZiBpdCB3YXMgYSBjYXRjaCAtCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIGRvIHdlIG5lZWQgdG8gYmVoYXZlIGFueSBkaWZmZXJlbnRseSB3aXRoIG91ciBub24tcmVkaXJlY3QgZXJyb3JzPwogICAgICAgICAgICAgICAgICAgICAgICAvLyBXaGF0IGlmIGl0IHdhcyBhIG5vbi1yZWRpcmVjdCBSZXNwb25zZT8KICAgICAgICAgICAgICAgICAgICAgICAgdXBkYXRlU3RhdGUoeyBmZXRjaGVyczogbmV3IE1hcChzdGF0ZS5mZXRjaGVycyksIGVycm9yczogX2RlZmluZVByb3BlcnR5Mih7fSwgYm91bmRhcnlNYXRjaC5yb3V0ZS5pZCwgcmVzdWx0LmVycm9yKSB9KTtyZXR1cm4gX2NvbnRleHQxMC5hYnJ1cHQoInJldHVybiIpO2Nhc2UgMjk6cm91dGVyX2ludmFyaWFudCghaXNEZWZlcnJlZFJlc3VsdChyZXN1bHQpLCAiVW5oYW5kbGVkIGZldGNoZXIgZGVmZXJyZWQgZGF0YSIpOyAvLyBQdXQgdGhlIGZldGNoZXIgYmFjayBpbnRvIGFuIGlkbGUgc3RhdGUKICAgICAgICAgICAgICAgICAgICAgICAgZG9uZUZldGNoZXIgPSB7IHN0YXRlOiAiaWRsZSIsIGRhdGE6IHJlc3VsdC5kYXRhLCBmb3JtTWV0aG9kOiB1bmRlZmluZWQsIGZvcm1BY3Rpb246IHVuZGVmaW5lZCwgZm9ybUVuY1R5cGU6IHVuZGVmaW5lZCwgZm9ybURhdGE6IHVuZGVmaW5lZCB9O3N0YXRlLmZldGNoZXJzLnNldChrZXksIGRvbmVGZXRjaGVyKTt1cGRhdGVTdGF0ZSh7IGZldGNoZXJzOiBuZXcgTWFwKHN0YXRlLmZldGNoZXJzKSB9KTtjYXNlIDMzOmNhc2UgImVuZCI6cmV0dXJuIF9jb250ZXh0MTAuc3RvcCgpO319fSwgX2NhbGxlZTEwKTt9KSk7cmV0dXJuIF9oYW5kbGVGZXRjaGVyTG9hZGVyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7fWZ1bmN0aW9uIHN0YXJ0UmVkaXJlY3ROYXZpZ2F0aW9uKF94MzUsIF94MzYsIF94MzcpIHtyZXR1cm4gX3N0YXJ0UmVkaXJlY3ROYXZpZ2F0aW9uLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7fWZ1bmN0aW9uIF9zdGFydFJlZGlyZWN0TmF2aWdhdGlvbigpIHtfc3RhcnRSZWRpcmVjdE5hdmlnYXRpb24gPSBfYXN5bmNUb0dlbmVyYXRvcjIoIC8qI19fUFVSRV9fKi9fcmVnZW5lcmF0b3JSdW50aW1lMigpLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTExKHN0YXRlLCByZWRpcmVjdCwgcmVwbGFjZSkge3ZhciByZWRpcmVjdExvY2F0aW9uLCByZWRpcmVjdEhpc3RvcnlBY3Rpb24sIF9zdGF0ZSRuYXZpZ2F0aW9uLCBmb3JtTWV0aG9kLCBmb3JtQWN0aW9uLCBmb3JtRW5jVHlwZSwgZm9ybURhdGE7cmV0dXJuIF9yZWdlbmVyYXRvclJ1bnRpbWUyKCkud3JhcChmdW5jdGlvbiBfY2FsbGVlMTEkKF9jb250ZXh0MTEpIHt3aGlsZSAoMSkge3N3aXRjaCAoX2NvbnRleHQxMS5wcmV2ID0gX2NvbnRleHQxMS5uZXh0KSB7Y2FzZSAwOmlmIChyZWRpcmVjdC5yZXZhbGlkYXRlKSB7aXNSZXZhbGlkYXRpb25SZXF1aXJlZCA9IHRydWU7fXJlZGlyZWN0TG9jYXRpb24gPSBjcmVhdGVMb2NhdGlvbihzdGF0ZS5sb2NhdGlvbiwgcmVkaXJlY3QubG9jYXRpb24pOwogICAgICAgICAgICAgICAgICAgICAgICByb3V0ZXJfaW52YXJpYW50KHJlZGlyZWN0TG9jYXRpb24sICJFeHBlY3RlZCBhIGxvY2F0aW9uIG9uIHRoZSByZWRpcmVjdCBuYXZpZ2F0aW9uIik7aWYgKCEoCgogICAgICAgICAgICAgICAgICAgICAgICByZWRpcmVjdC5leHRlcm5hbCAmJiB0eXBlb2Ygd2luZG93ICE9PSAidW5kZWZpbmVkIiAmJiB0eXBlb2Ygd2luZG93LmxvY2F0aW9uICE9PSAidW5kZWZpbmVkIikpIHtfY29udGV4dDExLm5leHQgPSA2O2JyZWFrO30KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJlcGxhY2UpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICB3aW5kb3cubG9jYXRpb24ucmVwbGFjZShyZWRpcmVjdC5sb2NhdGlvbik7CiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgd2luZG93LmxvY2F0aW9uLmFzc2lnbihyZWRpcmVjdC5sb2NhdGlvbik7CiAgICAgICAgICAgICAgICAgICAgICAgIH1yZXR1cm4gX2NvbnRleHQxMS5hYnJ1cHQoInJldHVybiIpO2Nhc2UgNjoKCgogICAgICAgICAgICAgICAgICAgICAgICAvLyBUaGVyZSdzIG5vIG5lZWQgdG8gYWJvcnQgb24gcmVkaXJlY3RzLCBzaW5jZSB3ZSBkb24ndCBkZXRlY3QgdGhlCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIHJlZGlyZWN0IHVudGlsIHRoZSBhY3Rpb24vbG9hZGVycyBoYXZlIHNldHRsZWQKCgogICAgICAgICAgICAgICAgICAgICAgICBwZW5kaW5nTmF2aWdhdGlvbkNvbnRyb2xsZXIgPSBudWxsOwogICAgICAgICAgICAgICAgICAgICAgICByZWRpcmVjdEhpc3RvcnlBY3Rpb24gPSByZXBsYWNlID09PSB0cnVlID8gQWN0aW9uLlJlcGxhY2UgOiBBY3Rpb24uUHVzaDtfc3RhdGUkbmF2aWdhdGlvbiA9CgoKCgoKICAgICAgICAgICAgICAgICAgICAgICAgc3RhdGUubmF2aWdhdGlvbiwgZm9ybU1ldGhvZCA9IF9zdGF0ZSRuYXZpZ2F0aW9uLmZvcm1NZXRob2QsIGZvcm1BY3Rpb24gPSBfc3RhdGUkbmF2aWdhdGlvbi5mb3JtQWN0aW9uLCBmb3JtRW5jVHlwZSA9IF9zdGF0ZSRuYXZpZ2F0aW9uLmZvcm1FbmNUeXBlLCBmb3JtRGF0YSA9IF9zdGF0ZSRuYXZpZ2F0aW9uLmZvcm1EYXRhOyAvLyBJZiB0aGlzIHdhcyBhIDMwNy8zMDggc3VibWlzc2lvbiB3ZSB3YW50IHRvIHByZXNlcnZlIHRoZSBIVFRQIG1ldGhvZCBhbmQKICAgICAgICAgICAgICAgICAgICAgICAgLy8gcmUtc3VibWl0IHRoZSBQT1NUL1BVVC9QQVRDSC9ERUxFVEUgYXMgYSBzdWJtaXNzaW9uIG5hdmlnYXRpb24gdG8gdGhlCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIHJlZGlyZWN0ZWQgbG9jYXRpb24KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCEoCiAgICAgICAgICAgICAgICAgICAgICAgIHJlZGlyZWN0UHJlc2VydmVNZXRob2RTdGF0dXNDb2Rlcy5oYXMocmVkaXJlY3Quc3RhdHVzKSAmJiBmb3JtTWV0aG9kICYmIGlzU3VibWlzc2lvbk1ldGhvZChmb3JtTWV0aG9kKSAmJiBmb3JtRW5jVHlwZSAmJiBmb3JtRGF0YSkpIHtfY29udGV4dDExLm5leHQgPSAxNDticmVhazt9X2NvbnRleHQxMS5uZXh0ID0gMTI7cmV0dXJuICgKICAgICAgICAgICAgICAgICAgICAgICAgICBzdGFydE5hdmlnYXRpb24ocmVkaXJlY3RIaXN0b3J5QWN0aW9uLCByZWRpcmVjdExvY2F0aW9uLCB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdWJtaXNzaW9uOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvcm1NZXRob2Q6IGZvcm1NZXRob2QsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvcm1BY3Rpb246IHJlZGlyZWN0LmxvY2F0aW9uLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3JtRW5jVHlwZTogZm9ybUVuY1R5cGUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvcm1EYXRhOiBmb3JtRGF0YQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgIH0pKTtjYXNlIDEyOl9jb250ZXh0MTEubmV4dCA9IDE2O2JyZWFrO2Nhc2UgMTQ6X2NvbnRleHQxMS5uZXh0ID0gMTY7cmV0dXJuICgKCgoKICAgICAgICAgICAgICAgICAgICAgICAgICBzdGFydE5hdmlnYXRpb24ocmVkaXJlY3RIaXN0b3J5QWN0aW9uLCByZWRpcmVjdExvY2F0aW9uLCB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvdmVycmlkZU5hdmlnYXRpb246IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhdGU6ICJsb2FkaW5nIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9jYXRpb246IHJlZGlyZWN0TG9jYXRpb24sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvcm1NZXRob2Q6IGZvcm1NZXRob2QgfHwgdW5kZWZpbmVkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3JtQWN0aW9uOiBmb3JtQWN0aW9uIHx8IHVuZGVmaW5lZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9ybUVuY1R5cGU6IGZvcm1FbmNUeXBlIHx8IHVuZGVmaW5lZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9ybURhdGE6IGZvcm1EYXRhIHx8IHVuZGVmaW5lZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgIH0pKTtjYXNlIDE2OmNhc2UgImVuZCI6cmV0dXJuIF9jb250ZXh0MTEuc3RvcCgpO319fSwgX2NhbGxlZTExKTt9KSk7cmV0dXJuIF9zdGFydFJlZGlyZWN0TmF2aWdhdGlvbi5hcHBseSh0aGlzLCBhcmd1bWVudHMpO31mdW5jdGlvbgoKCgogICAgICAgICAgICBjYWxsTG9hZGVyc0FuZE1heWJlUmVzb2x2ZURhdGEoX3gzOCwgX3gzOSwgX3g0MCwgX3g0MSwgX3g0Mikge3JldHVybiBfY2FsbExvYWRlcnNBbmRNYXliZVJlc29sdmVEYXRhLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7fWZ1bmN0aW9uIF9jYWxsTG9hZGVyc0FuZE1heWJlUmVzb2x2ZURhdGEoKSB7X2NhbGxMb2FkZXJzQW5kTWF5YmVSZXNvbHZlRGF0YSA9IF9hc3luY1RvR2VuZXJhdG9yMiggLyojX19QVVJFX18qL19yZWdlbmVyYXRvclJ1bnRpbWUyKCkubWFyayhmdW5jdGlvbiBfY2FsbGVlMTIoY3VycmVudE1hdGNoZXMsIG1hdGNoZXMsIG1hdGNoZXNUb0xvYWQsIGZldGNoZXJzVG9Mb2FkLCByZXF1ZXN0KSB7dmFyIHJlc3VsdHMsIGxvYWRlclJlc3VsdHMsIGZldGNoZXJSZXN1bHRzO3JldHVybiBfcmVnZW5lcmF0b3JSdW50aW1lMigpLndyYXAoZnVuY3Rpb24gX2NhbGxlZTEyJChfY29udGV4dDEyKSB7d2hpbGUgKDEpIHtzd2l0Y2ggKF9jb250ZXh0MTIucHJldiA9IF9jb250ZXh0MTIubmV4dCkge2Nhc2UgMDpfY29udGV4dDEyLm5leHQgPSAyO3JldHVybiAoCgoKCiAgICAgICAgICAgICAgICAgICAgICAgICAgUHJvbWlzZS5hbGwoW10uY29uY2F0KF90b0NvbnN1bWFibGVBcnJheTIobWF0Y2hlc1RvTG9hZC5tYXAoKG1hdGNoKSA9PiBjYWxsTG9hZGVyT3JBY3Rpb24oImxvYWRlciIsIHJlcXVlc3QsIG1hdGNoLCBtYXRjaGVzLCByb3V0ZXIuYmFzZW5hbWUpKSksIF90b0NvbnN1bWFibGVBcnJheTIoZmV0Y2hlcnNUb0xvYWQubWFwKChfcmVmOCkgPT4gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIF9yZWYyMCA9IF9zbGljZWRUb0FycmF5MihfcmVmOCwgNCksaHJlZiA9IF9yZWYyMFsxXSxtYXRjaCA9IF9yZWYyMFsyXSxmZXRjaE1hdGNoZXMgPSBfcmVmMjBbM107CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gY2FsbExvYWRlck9yQWN0aW9uKCJsb2FkZXIiLCBjcmVhdGVSZXF1ZXN0KGhyZWYsIHJlcXVlc3Quc2lnbmFsKSwgbWF0Y2gsIGZldGNoTWF0Y2hlcywgcm91dGVyLmJhc2VuYW1lKTsKICAgICAgICAgICAgICAgICAgICAgICAgICB9KSkpKSk7Y2FzZSAyOnJlc3VsdHMgPSBfY29udGV4dDEyLnNlbnQ7CiAgICAgICAgICAgICAgICAgICAgICAgIGxvYWRlclJlc3VsdHMgPSByZXN1bHRzLnNsaWNlKDAsIG1hdGNoZXNUb0xvYWQubGVuZ3RoKTsKICAgICAgICAgICAgICAgICAgICAgICAgZmV0Y2hlclJlc3VsdHMgPSByZXN1bHRzLnNsaWNlKG1hdGNoZXNUb0xvYWQubGVuZ3RoKTtfY29udGV4dDEyLm5leHQgPSA3O3JldHVybiAoCiAgICAgICAgICAgICAgICAgICAgICAgICAgUHJvbWlzZS5hbGwoW3Jlc29sdmVEZWZlcnJlZFJlc3VsdHMoY3VycmVudE1hdGNoZXMsIG1hdGNoZXNUb0xvYWQsIGxvYWRlclJlc3VsdHMsIHJlcXVlc3Quc2lnbmFsLCBmYWxzZSwgc3RhdGUubG9hZGVyRGF0YSksIHJlc29sdmVEZWZlcnJlZFJlc3VsdHMoY3VycmVudE1hdGNoZXMsIGZldGNoZXJzVG9Mb2FkLm1hcCgoX3JlZjkpID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBfcmVmMjEgPSBfc2xpY2VkVG9BcnJheTIoX3JlZjksIDMpLG1hdGNoID0gX3JlZjIxWzJdOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG1hdGNoOwogICAgICAgICAgICAgICAgICAgICAgICAgIH0pLCBmZXRjaGVyUmVzdWx0cywgcmVxdWVzdC5zaWduYWwsIHRydWUpXSkpO2Nhc2UgNzpyZXR1cm4gX2NvbnRleHQxMi5hYnJ1cHQoInJldHVybiIsCiAgICAgICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgICByZXN1bHRzOiByZXN1bHRzLAogICAgICAgICAgICAgICAgICAgICAgICAgIGxvYWRlclJlc3VsdHM6IGxvYWRlclJlc3VsdHMsCiAgICAgICAgICAgICAgICAgICAgICAgICAgZmV0Y2hlclJlc3VsdHM6IGZldGNoZXJSZXN1bHRzCiAgICAgICAgICAgICAgICAgICAgICAgIH0pO2Nhc2UgODpjYXNlICJlbmQiOnJldHVybiBfY29udGV4dDEyLnN0b3AoKTt9fX0sIF9jYWxsZWUxMik7fSkpO3JldHVybiBfY2FsbExvYWRlcnNBbmRNYXliZVJlc29sdmVEYXRhLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7fQoKCiAgICAgICAgICAgIGZ1bmN0aW9uIGludGVycnVwdEFjdGl2ZUxvYWRzKCkge3ZhciBfY2FuY2VsbGVkRGVmZXJyZWRSb3U7CiAgICAgICAgICAgICAgLy8gRXZlcnkgaW50ZXJydXB0aW9uIHRyaWdnZXJzIGEgcmV2YWxpZGF0aW9uCiAgICAgICAgICAgICAgaXNSZXZhbGlkYXRpb25SZXF1aXJlZCA9IHRydWU7IC8vIENhbmNlbCBwZW5kaW5nIHJvdXRlLWxldmVsIGRlZmVycmVkcyBhbmQgbWFyayBjYW5jZWxsZWQgcm91dGVzIGZvcgogICAgICAgICAgICAgIC8vIHJldmFsaWRhdGlvbgoKICAgICAgICAgICAgICAoX2NhbmNlbGxlZERlZmVycmVkUm91ID0gY2FuY2VsbGVkRGVmZXJyZWRSb3V0ZXMpLnB1c2guYXBwbHkoX2NhbmNlbGxlZERlZmVycmVkUm91LCBfdG9Db25zdW1hYmxlQXJyYXkyKGNhbmNlbEFjdGl2ZURlZmVycmVkcygpKSk7IC8vIEFib3J0IGluLWZsaWdodCBmZXRjaGVyIGxvYWRzCgogICAgICAgICAgICAgIGZldGNoTG9hZE1hdGNoZXMuZm9yRWFjaCgoXywga2V5KSA9PiB7CiAgICAgICAgICAgICAgICBpZiAoZmV0Y2hDb250cm9sbGVycy5oYXMoa2V5KSkgewogICAgICAgICAgICAgICAgICBjYW5jZWxsZWRGZXRjaGVyTG9hZHMucHVzaChrZXkpOwogICAgICAgICAgICAgICAgICBhYm9ydEZldGNoZXIoa2V5KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgZnVuY3Rpb24gc2V0RmV0Y2hlckVycm9yKGtleSwgcm91dGVJZCwgZXJyb3IpIHsKICAgICAgICAgICAgICB2YXIgYm91bmRhcnlNYXRjaCA9IGZpbmROZWFyZXN0Qm91bmRhcnkoc3RhdGUubWF0Y2hlcywgcm91dGVJZCk7CiAgICAgICAgICAgICAgZGVsZXRlRmV0Y2hlcihrZXkpOwogICAgICAgICAgICAgIHVwZGF0ZVN0YXRlKHsKICAgICAgICAgICAgICAgIGVycm9yczogX2RlZmluZVByb3BlcnR5Mih7fSwKICAgICAgICAgICAgICAgIGJvdW5kYXJ5TWF0Y2gucm91dGUuaWQsIGVycm9yKSwKCiAgICAgICAgICAgICAgICBmZXRjaGVyczogbmV3IE1hcChzdGF0ZS5mZXRjaGVycykKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgZnVuY3Rpb24gZGVsZXRlRmV0Y2hlcihrZXkpIHsKICAgICAgICAgICAgICBpZiAoZmV0Y2hDb250cm9sbGVycy5oYXMoa2V5KSkgYWJvcnRGZXRjaGVyKGtleSk7CiAgICAgICAgICAgICAgZmV0Y2hMb2FkTWF0Y2hlcy5kZWxldGUoa2V5KTsKICAgICAgICAgICAgICBmZXRjaFJlbG9hZElkcy5kZWxldGUoa2V5KTsKICAgICAgICAgICAgICBmZXRjaFJlZGlyZWN0SWRzLmRlbGV0ZShrZXkpOwogICAgICAgICAgICAgIHN0YXRlLmZldGNoZXJzLmRlbGV0ZShrZXkpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBmdW5jdGlvbiBhYm9ydEZldGNoZXIoa2V5KSB7CiAgICAgICAgICAgICAgdmFyIGNvbnRyb2xsZXIgPSBmZXRjaENvbnRyb2xsZXJzLmdldChrZXkpOwogICAgICAgICAgICAgIHJvdXRlcl9pbnZhcmlhbnQoY29udHJvbGxlciwgIkV4cGVjdGVkIGZldGNoIGNvbnRyb2xsZXI6ICIgKyBrZXkpOwogICAgICAgICAgICAgIGNvbnRyb2xsZXIuYWJvcnQoKTsKICAgICAgICAgICAgICBmZXRjaENvbnRyb2xsZXJzLmRlbGV0ZShrZXkpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBmdW5jdGlvbiBtYXJrRmV0Y2hlcnNEb25lKGtleXMpIHt2YXIgX2l0ZXJhdG9yMyA9IF9jcmVhdGVGb3JPZkl0ZXJhdG9ySGVscGVyMigKICAgICAgICAgICAgICAgIGtleXMpLF9zdGVwMzt0cnkge2ZvciAoX2l0ZXJhdG9yMy5zKCk7ICEoX3N0ZXAzID0gX2l0ZXJhdG9yMy5uKCkpLmRvbmU7KSB7dmFyIGtleSA9IF9zdGVwMy52YWx1ZTsKICAgICAgICAgICAgICAgICAgdmFyIGZldGNoZXIgPSBnZXRGZXRjaGVyKGtleSk7CiAgICAgICAgICAgICAgICAgIHZhciBkb25lRmV0Y2hlciA9IHsKICAgICAgICAgICAgICAgICAgICBzdGF0ZTogImlkbGUiLAogICAgICAgICAgICAgICAgICAgIGRhdGE6IGZldGNoZXIuZGF0YSwKICAgICAgICAgICAgICAgICAgICBmb3JtTWV0aG9kOiB1bmRlZmluZWQsCiAgICAgICAgICAgICAgICAgICAgZm9ybUFjdGlvbjogdW5kZWZpbmVkLAogICAgICAgICAgICAgICAgICAgIGZvcm1FbmNUeXBlOiB1bmRlZmluZWQsCiAgICAgICAgICAgICAgICAgICAgZm9ybURhdGE6IHVuZGVmaW5lZAogICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgICBzdGF0ZS5mZXRjaGVycy5zZXQoa2V5LCBkb25lRmV0Y2hlcik7CiAgICAgICAgICAgICAgICB9fSBjYXRjaCAoZXJyKSB7X2l0ZXJhdG9yMy5lKGVycik7fSBmaW5hbGx5IHtfaXRlcmF0b3IzLmYoKTt9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGZ1bmN0aW9uIG1hcmtGZXRjaFJlZGlyZWN0c0RvbmUoKSB7CiAgICAgICAgICAgICAgdmFyIGRvbmVLZXlzID0gW107dmFyIF9pdGVyYXRvcjQgPSBfY3JlYXRlRm9yT2ZJdGVyYXRvckhlbHBlcjIoCgogICAgICAgICAgICAgICAgZmV0Y2hSZWRpcmVjdElkcyksX3N0ZXA0O3RyeSB7Zm9yIChfaXRlcmF0b3I0LnMoKTsgIShfc3RlcDQgPSBfaXRlcmF0b3I0Lm4oKSkuZG9uZTspIHt2YXIga2V5ID0gX3N0ZXA0LnZhbHVlOwogICAgICAgICAgICAgICAgICB2YXIgZmV0Y2hlciA9IHN0YXRlLmZldGNoZXJzLmdldChrZXkpOwogICAgICAgICAgICAgICAgICByb3V0ZXJfaW52YXJpYW50KGZldGNoZXIsICJFeHBlY3RlZCBmZXRjaGVyOiAiICsga2V5KTsKCiAgICAgICAgICAgICAgICAgIGlmIChmZXRjaGVyLnN0YXRlID09PSAibG9hZGluZyIpIHsKICAgICAgICAgICAgICAgICAgICBmZXRjaFJlZGlyZWN0SWRzLmRlbGV0ZShrZXkpOwogICAgICAgICAgICAgICAgICAgIGRvbmVLZXlzLnB1c2goa2V5KTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfX0gY2F0Y2ggKGVycikge19pdGVyYXRvcjQuZShlcnIpO30gZmluYWxseSB7X2l0ZXJhdG9yNC5mKCk7fQoKICAgICAgICAgICAgICBtYXJrRmV0Y2hlcnNEb25lKGRvbmVLZXlzKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgZnVuY3Rpb24gYWJvcnRTdGFsZUZldGNoTG9hZHMobGFuZGVkSWQpIHsKICAgICAgICAgICAgICB2YXIgeWVldGVkS2V5cyA9IFtdO3ZhciBfaXRlcmF0b3I1ID0gX2NyZWF0ZUZvck9mSXRlcmF0b3JIZWxwZXIyKAoKICAgICAgICAgICAgICAgIGZldGNoUmVsb2FkSWRzKSxfc3RlcDU7dHJ5IHtmb3IgKF9pdGVyYXRvcjUucygpOyAhKF9zdGVwNSA9IF9pdGVyYXRvcjUubigpKS5kb25lOykge3ZhciBfc3RlcDUkdmFsdWUgPSBfc2xpY2VkVG9BcnJheTIoX3N0ZXA1LnZhbHVlLCAyKSxrZXkgPSBfc3RlcDUkdmFsdWVbMF0saWQgPSBfc3RlcDUkdmFsdWVbMV07CiAgICAgICAgICAgICAgICAgIGlmIChpZCA8IGxhbmRlZElkKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIGZldGNoZXIgPSBzdGF0ZS5mZXRjaGVycy5nZXQoa2V5KTsKICAgICAgICAgICAgICAgICAgICByb3V0ZXJfaW52YXJpYW50KGZldGNoZXIsICJFeHBlY3RlZCBmZXRjaGVyOiAiICsga2V5KTsKCiAgICAgICAgICAgICAgICAgICAgaWYgKGZldGNoZXIuc3RhdGUgPT09ICJsb2FkaW5nIikgewogICAgICAgICAgICAgICAgICAgICAgYWJvcnRGZXRjaGVyKGtleSk7CiAgICAgICAgICAgICAgICAgICAgICBmZXRjaFJlbG9hZElkcy5kZWxldGUoa2V5KTsKICAgICAgICAgICAgICAgICAgICAgIHllZXRlZEtleXMucHVzaChrZXkpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfX0gY2F0Y2ggKGVycikge19pdGVyYXRvcjUuZShlcnIpO30gZmluYWxseSB7X2l0ZXJhdG9yNS5mKCk7fQoKICAgICAgICAgICAgICBtYXJrRmV0Y2hlcnNEb25lKHllZXRlZEtleXMpOwogICAgICAgICAgICAgIHJldHVybiB5ZWV0ZWRLZXlzLmxlbmd0aCA+IDA7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGZ1bmN0aW9uIGNhbmNlbEFjdGl2ZURlZmVycmVkcyhwcmVkaWNhdGUpIHsKICAgICAgICAgICAgICB2YXIgY2FuY2VsbGVkUm91dGVJZHMgPSBbXTsKICAgICAgICAgICAgICBhY3RpdmVEZWZlcnJlZHMuZm9yRWFjaCgoZGZkLCByb3V0ZUlkKSA9PiB7CiAgICAgICAgICAgICAgICBpZiAoIXByZWRpY2F0ZSB8fCBwcmVkaWNhdGUocm91dGVJZCkpIHsKICAgICAgICAgICAgICAgICAgLy8gQ2FuY2VsIHRoZSBkZWZlcnJlZCAtIGJ1dCBkbyBub3QgcmVtb3ZlIGZyb20gYWN0aXZlRGVmZXJyZWRzIGhlcmUgLQogICAgICAgICAgICAgICAgICAvLyB3ZSByZWx5IG9uIHRoZSBzdWJzY3JpYmVycyB0byBkbyB0aGF0IHNvIG91ciB0ZXN0cyBjYW4gYXNzZXJ0IHByb3BlcgogICAgICAgICAgICAgICAgICAvLyBjbGVhbnVwIHZpYSBfaW50ZXJuYWxBY3RpdmVEZWZlcnJlZHMKICAgICAgICAgICAgICAgICAgZGZkLmNhbmNlbCgpOwogICAgICAgICAgICAgICAgICBjYW5jZWxsZWRSb3V0ZUlkcy5wdXNoKHJvdXRlSWQpOwogICAgICAgICAgICAgICAgICBhY3RpdmVEZWZlcnJlZHMuZGVsZXRlKHJvdXRlSWQpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgIHJldHVybiBjYW5jZWxsZWRSb3V0ZUlkczsKICAgICAgICAgICAgfSAvLyBPcHQgaW4gdG8gY2FwdHVyaW5nIGFuZCByZXBvcnRpbmcgc2Nyb2xsIHBvc2l0aW9ucyBkdXJpbmcgbmF2aWdhdGlvbnMsCiAgICAgICAgICAgIC8vIHVzZWQgYnkgdGhlIDxTY3JvbGxSZXN0b3JhdGlvbj4gY29tcG9uZW50CgoKICAgICAgICAgICAgZnVuY3Rpb24gZW5hYmxlU2Nyb2xsUmVzdG9yYXRpb24ocG9zaXRpb25zLCBnZXRQb3NpdGlvbiwgZ2V0S2V5KSB7CiAgICAgICAgICAgICAgc2F2ZWRTY3JvbGxQb3NpdGlvbnMgPSBwb3NpdGlvbnM7CiAgICAgICAgICAgICAgZ2V0U2Nyb2xsUG9zaXRpb24gPSBnZXRQb3NpdGlvbjsKCiAgICAgICAgICAgICAgZ2V0U2Nyb2xsUmVzdG9yYXRpb25LZXkgPSBnZXRLZXkgfHwgKChsb2NhdGlvbikgPT4gbG9jYXRpb24ua2V5KTsgLy8gUGVyZm9ybSBpbml0aWFsIGh5ZHJhdGlvbiBzY3JvbGwgcmVzdG9yYXRpb24sIHNpbmNlIHdlIG1pc3MgdGhlIGJvYXQgb24KICAgICAgICAgICAgICAvLyB0aGUgaW5pdGlhbCB1cGRhdGVTdGF0ZSgpIGJlY2F1c2Ugd2UndmUgbm90IHlldCByZW5kZXJlZCA8U2Nyb2xsUmVzdG9yYXRpb24vPgogICAgICAgICAgICAgIC8vIGFuZCB0aGVyZWZvcmUgaGF2ZSBubyBzYXZlZFNjcm9sbFBvc2l0aW9ucyBhdmFpbGFibGUKCgogICAgICAgICAgICAgIGlmICghaW5pdGlhbFNjcm9sbFJlc3RvcmVkICYmIHN0YXRlLm5hdmlnYXRpb24gPT09IElETEVfTkFWSUdBVElPTikgewogICAgICAgICAgICAgICAgaW5pdGlhbFNjcm9sbFJlc3RvcmVkID0gdHJ1ZTsKICAgICAgICAgICAgICAgIHZhciB5ID0gZ2V0U2F2ZWRTY3JvbGxQb3NpdGlvbihzdGF0ZS5sb2NhdGlvbiwgc3RhdGUubWF0Y2hlcyk7CgogICAgICAgICAgICAgICAgaWYgKHkgIT0gbnVsbCkgewogICAgICAgICAgICAgICAgICB1cGRhdGVTdGF0ZSh7CiAgICAgICAgICAgICAgICAgICAgcmVzdG9yZVNjcm9sbFBvc2l0aW9uOiB5CiAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgcmV0dXJuICgpID0+IHsKICAgICAgICAgICAgICAgIHNhdmVkU2Nyb2xsUG9zaXRpb25zID0gbnVsbDsKICAgICAgICAgICAgICAgIGdldFNjcm9sbFBvc2l0aW9uID0gbnVsbDsKICAgICAgICAgICAgICAgIGdldFNjcm9sbFJlc3RvcmF0aW9uS2V5ID0gbnVsbDsKICAgICAgICAgICAgICB9OwogICAgICAgICAgICB9CgogICAgICAgICAgICBmdW5jdGlvbiBzYXZlU2Nyb2xsUG9zaXRpb24obG9jYXRpb24sIG1hdGNoZXMpIHsKICAgICAgICAgICAgICBpZiAoc2F2ZWRTY3JvbGxQb3NpdGlvbnMgJiYgZ2V0U2Nyb2xsUmVzdG9yYXRpb25LZXkgJiYgZ2V0U2Nyb2xsUG9zaXRpb24pIHsKICAgICAgICAgICAgICAgIHZhciB1c2VyTWF0Y2hlcyA9IG1hdGNoZXMubWFwKChtKSA9PiBjcmVhdGVVc2VNYXRjaGVzTWF0Y2gobSwgc3RhdGUubG9hZGVyRGF0YSkpOwogICAgICAgICAgICAgICAgdmFyIGtleSA9IGdldFNjcm9sbFJlc3RvcmF0aW9uS2V5KGxvY2F0aW9uLCB1c2VyTWF0Y2hlcykgfHwgbG9jYXRpb24ua2V5OwogICAgICAgICAgICAgICAgc2F2ZWRTY3JvbGxQb3NpdGlvbnNba2V5XSA9IGdldFNjcm9sbFBvc2l0aW9uKCk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICBmdW5jdGlvbiBnZXRTYXZlZFNjcm9sbFBvc2l0aW9uKGxvY2F0aW9uLCBtYXRjaGVzKSB7CiAgICAgICAgICAgICAgaWYgKHNhdmVkU2Nyb2xsUG9zaXRpb25zICYmIGdldFNjcm9sbFJlc3RvcmF0aW9uS2V5ICYmIGdldFNjcm9sbFBvc2l0aW9uKSB7CiAgICAgICAgICAgICAgICB2YXIgdXNlck1hdGNoZXMgPSBtYXRjaGVzLm1hcCgobSkgPT4gY3JlYXRlVXNlTWF0Y2hlc01hdGNoKG0sIHN0YXRlLmxvYWRlckRhdGEpKTsKICAgICAgICAgICAgICAgIHZhciBrZXkgPSBnZXRTY3JvbGxSZXN0b3JhdGlvbktleShsb2NhdGlvbiwgdXNlck1hdGNoZXMpIHx8IGxvY2F0aW9uLmtleTsKICAgICAgICAgICAgICAgIHZhciB5ID0gc2F2ZWRTY3JvbGxQb3NpdGlvbnNba2V5XTsKCiAgICAgICAgICAgICAgICBpZiAodHlwZW9mIHkgPT09ICJudW1iZXIiKSB7CiAgICAgICAgICAgICAgICAgIHJldHVybiB5OwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJvdXRlciA9IHsKICAgICAgICAgICAgICBnZXQgYmFzZW5hbWUoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gaW5pdC5iYXNlbmFtZTsKICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICBnZXQgc3RhdGUoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gc3RhdGU7CiAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgZ2V0IHJvdXRlcygpIHsKICAgICAgICAgICAgICAgIHJldHVybiBkYXRhUm91dGVzOwogICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgIGluaXRpYWxpemU6IGluaXRpYWxpemUsCiAgICAgICAgICAgICAgc3Vic2NyaWJlOiBzdWJzY3JpYmUsCiAgICAgICAgICAgICAgZW5hYmxlU2Nyb2xsUmVzdG9yYXRpb246IGVuYWJsZVNjcm9sbFJlc3RvcmF0aW9uLAogICAgICAgICAgICAgIG5hdmlnYXRlOiBuYXZpZ2F0ZSwKICAgICAgICAgICAgICBmZXRjaDogZmV0Y2gsCiAgICAgICAgICAgICAgcmV2YWxpZGF0ZTogcmV2YWxpZGF0ZSwKICAgICAgICAgICAgICAvLyBQYXNzdGhyb3VnaCB0byBoaXN0b3J5LWF3YXJlIGNyZWF0ZUhyZWYgdXNlZCBieSB1c2VIcmVmIHNvIHdlIGdldCBwcm9wZXIKICAgICAgICAgICAgICAvLyBoYXNoLWF3YXJlIFVSTHMgaW4gRE9NIHBhdGhzCiAgICAgICAgICAgICAgY3JlYXRlSHJlZjogKHRvKSA9PiBpbml0Lmhpc3RvcnkuY3JlYXRlSHJlZih0byksCiAgICAgICAgICAgICAgZW5jb2RlTG9jYXRpb246ICh0bykgPT4gaW5pdC5oaXN0b3J5LmVuY29kZUxvY2F0aW9uKHRvKSwKICAgICAgICAgICAgICBnZXRGZXRjaGVyOiBnZXRGZXRjaGVyLAogICAgICAgICAgICAgIGRlbGV0ZUZldGNoZXI6IGRlbGV0ZUZldGNoZXIsCiAgICAgICAgICAgICAgZGlzcG9zZTogZGlzcG9zZSwKICAgICAgICAgICAgICBfaW50ZXJuYWxGZXRjaENvbnRyb2xsZXJzOiBmZXRjaENvbnRyb2xsZXJzLAogICAgICAgICAgICAgIF9pbnRlcm5hbEFjdGl2ZURlZmVycmVkczogYWN0aXZlRGVmZXJyZWRzCiAgICAgICAgICAgIH07CiAgICAgICAgICAgIHJldHVybiByb3V0ZXI7CiAgICAgICAgICB9IC8vI2VuZHJlZ2lvbgogICAgICAgICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KICAgICAgICAgIC8vI3JlZ2lvbiBjcmVhdGVTdGF0aWNIYW5kbGVyCiAgICAgICAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwoKICAgICAgICAgIGZ1bmN0aW9uIHVuc3RhYmxlX2NyZWF0ZVN0YXRpY0hhbmRsZXIocm91dGVzLCBvcHRzKSB7CiAgICAgICAgICAgIHJvdXRlcl9pbnZhcmlhbnQocm91dGVzLmxlbmd0aCA+IDAsICJZb3UgbXVzdCBwcm92aWRlIGEgbm9uLWVtcHR5IHJvdXRlcyBhcnJheSB0byB1bnN0YWJsZV9jcmVhdGVTdGF0aWNIYW5kbGVyIik7CiAgICAgICAgICAgIHZhciBkYXRhUm91dGVzID0gY29udmVydFJvdXRlc1RvRGF0YVJvdXRlcyhyb3V0ZXMpOwogICAgICAgICAgICB2YXIgYmFzZW5hbWUgPSAob3B0cyA/IG9wdHMuYmFzZW5hbWUgOiBudWxsKSB8fCAiLyI7CiAgICAgICAgICAgIC8qKgogICAgICAgICAgICAgKiBUaGUgcXVlcnkoKSBtZXRob2QgaXMgaW50ZW5kZWQgZm9yIGRvY3VtZW50IHJlcXVlc3RzLCBpbiB3aGljaCB3ZSB3YW50IHRvCiAgICAgICAgICAgICAqIGNhbGwgYW4gb3B0aW9uYWwgYWN0aW9uIGFuZCBwb3RlbnRpYWxseSBtdWx0aXBsZSBsb2FkZXJzIGZvciBhbGwgbmVzdGVkCiAgICAgICAgICAgICAqIHJvdXRlcy4gIEl0IHJldHVybnMgYSBTdGF0aWNIYW5kbGVyQ29udGV4dCBvYmplY3QsIHdoaWNoIGlzIHZlcnkgc2ltaWxhcgogICAgICAgICAgICAgKiB0byB0aGUgcm91dGVyIHN0YXRlIChsb2NhdGlvbiwgbG9hZGVyRGF0YSwgYWN0aW9uRGF0YSwgZXJyb3JzLCBldGMuKSBhbmQKICAgICAgICAgICAgICogYWxzbyBhZGRzIFNTUi1zcGVjaWZpYyBpbmZvcm1hdGlvbiBzdWNoIGFzIHRoZSBzdGF0dXNDb2RlIGFuZCBoZWFkZXJzCiAgICAgICAgICAgICAqIGZyb20gYWN0aW9uL2xvYWRlcnMgUmVzcG9uc2VzLgogICAgICAgICAgICAgKgogICAgICAgICAgICAgKiBJdCBfc2hvdWxkXyBuZXZlciB0aHJvdyBhbmQgc2hvdWxkIHJlcG9ydCBhbGwgZXJyb3JzIHRocm91Z2ggdGhlCiAgICAgICAgICAgICAqIHJldHVybmVkIGNvbnRleHQuZXJyb3JzIG9iamVjdCwgcHJvcGVybHkgYXNzb2NpYXRpbmcgZXJyb3JzIHRvIHRoZWlyIGVycm9yCiAgICAgICAgICAgICAqIGJvdW5kYXJ5LiAgQWRkaXRpb25hbGx5LCBpdCB0cmFja3MgX2RlZXBlc3RSZW5kZXJlZEJvdW5kYXJ5SWQgd2hpY2ggY2FuIGJlCiAgICAgICAgICAgICAqIHVzZWQgdG8gZW11bGF0ZSBSZWFjdCBlcnJvciBib3VuZGFyaWVzIGR1cmluZyBTU3IgYnkgcGVyZm9ybWluZyBhIHNlY29uZAogICAgICAgICAgICAgKiBwYXNzIG9ubHkgZG93biB0byB0aGUgYm91bmRhcnlJZC4KICAgICAgICAgICAgICoKICAgICAgICAgICAgICogVGhlIG9uZSBleGNlcHRpb24gd2hlcmUgd2UgZG8gbm90IHJldHVybiBhIFN0YXRpY0hhbmRsZXJDb250ZXh0IGlzIHdoZW4gYQogICAgICAgICAgICAgKiByZWRpcmVjdCByZXNwb25zZSBpcyByZXR1cm5lZCBvciB0aHJvd24gZnJvbSBhbnkgYWN0aW9uL2xvYWRlci4gIFdlCiAgICAgICAgICAgICAqIHByb3BhZ2F0ZSB0aGF0IG91dCBhbmQgcmV0dXJuIHRoZSByYXcgUmVzcG9uc2Ugc28gdGhlIEhUVFAgc2VydmVyIGNhbgogICAgICAgICAgICAgKiByZXR1cm4gaXQgZGlyZWN0bHkuCiAgICAgICAgICAgICAqL2Z1bmN0aW9uCgogICAgICAgICAgICBxdWVyeShfeDQzKSB7cmV0dXJuIF9xdWVyeS5hcHBseSh0aGlzLCBhcmd1bWVudHMpO30KCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKICAgICAgICAgICAgLyoqCiAgICAgICAgICAgICAqIFRoZSBxdWVyeVJvdXRlKCkgbWV0aG9kIGlzIGludGVuZGVkIGZvciB0YXJnZXRlZCByb3V0ZSByZXF1ZXN0cywgZWl0aGVyCiAgICAgICAgICAgICAqIGZvciBmZXRjaCA/X2RhdGEgcmVxdWVzdHMgb3IgcmVzb3VyY2Ugcm91dGUgcmVxdWVzdHMuICBJbiB0aGlzIGNhc2UsIHdlCiAgICAgICAgICAgICAqIGFyZSBvbmx5IGV2ZXIgY2FsbGluZyBhIHNpbmdsZSBhY3Rpb24gb3IgbG9hZGVyLCBhbmQgd2UgYXJlIHJldHVybmluZyB0aGUKICAgICAgICAgICAgICogcmV0dXJuZWQgdmFsdWUgZGlyZWN0bHkuICBJbiBtb3N0IGNhc2VzLCB0aGlzIHdpbGwgYmUgYSBSZXNwb25zZSByZXR1cm5lZAogICAgICAgICAgICAgKiBmcm9tIHRoZSBhY3Rpb24vbG9hZGVyLCBidXQgaXQgbWF5IGJlIGEgcHJpbWl0aXZlIG9yIG90aGVyIHZhbHVlIGFzIHdlbGwgLQogICAgICAgICAgICAgKiBhbmQgaW4gc3VjaCBjYXNlcyB0aGUgY2FsbGluZyBjb250ZXh0IHNob3VsZCBoYW5kbGUgdGhhdCBhY2NvcmRpbmdseS4KICAgICAgICAgICAgICoKICAgICAgICAgICAgICogV2UgZG8gcmVzcGVjdCB0aGUgdGhyb3cvcmV0dXJuIGRpZmZlcmVudGlhdGlvbiwgc28gaWYgYW4gYWN0aW9uL2xvYWRlcgogICAgICAgICAgICAgKiB0aHJvd3MsIHRoZW4gdGhpcyBtZXRob2Qgd2lsbCB0aHJvdyB0aGUgdmFsdWUuICBUaGlzIGlzIGltcG9ydGFudCBzbyB3ZQogICAgICAgICAgICAgKiBjYW4gZG8gcHJvcGVyIGJvdW5kYXJ5IGlkZW50aWZpY2F0aW9uIGluIFJlbWl4IHdoZXJlIGEgdGhyb3duIFJlc3BvbnNlCiAgICAgICAgICAgICAqIG11c3QgZ28gdG8gdGhlIENhdGNoIEJvdW5kYXJ5IGJ1dCBhIHJldHVybmVkIFJlc3BvbnNlIGlzIGhhcHB5LXBhdGguCiAgICAgICAgICAgICAqCiAgICAgICAgICAgICAqIE9uZSB0aGluZyB0byBub3RlIGlzIHRoYXQgYW55IFJvdXRlci1pbml0aWF0ZWQgRXJyb3JzIHRoYXQgbWFrZSBzZW5zZQogICAgICAgICAgICAgKiB0byBhc3NvY2lhdGUgd2l0aCBhIHN0YXR1cyBjb2RlIHdpbGwgYmUgdGhyb3duIGFzIGFuIEVycm9yUmVzcG9uc2UKICAgICAgICAgICAgICogaW5zdGFuY2Ugd2hpY2ggaW5jbHVkZSB0aGUgcmF3IEVycm9yLCBzdWNoIHRoYXQgdGhlIGNhbGxpbmcgY29udGV4dCBjYW4KICAgICAgICAgICAgICogc2VyaWFsaXplIHRoZSBlcnJvciBhcyB0aGV5IHNlZSBmaXQgd2hpbGUgaW5jbHVkaW5nIHRoZSBwcm9wZXIgcmVzcG9uc2UKICAgICAgICAgICAgICogY29kZS4gIEV4YW1wbGVzIGhlcmUgYXJlIDQwNCBhbmQgNDA1IGVycm9ycyB0aGF0IG9jY3VyIHByaW9yIHRvIHJlYWNoaW5nCiAgICAgICAgICAgICAqIGFueSB1c2VyLWRlZmluZWQgbG9hZGVycy4KICAgICAgICAgICAgICovZnVuY3Rpb24gX3F1ZXJ5KCkge19xdWVyeSA9IF9hc3luY1RvR2VuZXJhdG9yMiggLyojX19QVVJFX18qL19yZWdlbmVyYXRvclJ1bnRpbWUyKCkubWFyayhmdW5jdGlvbiBfY2FsbGVlMTMocmVxdWVzdCkge3ZhciB1cmwsIG1ldGhvZCwgbG9jYXRpb24sIG1hdGNoZXMsIGVycm9yLCBfZ2V0U2hvcnRDaXJjdWl0TWF0Y2gzLCBtZXRob2ROb3RBbGxvd2VkTWF0Y2hlcywgcm91dGUsIF9lcnJvcjMsIF9nZXRTaG9ydENpcmN1aXRNYXRjaDQsIG5vdEZvdW5kTWF0Y2hlcywgX3JvdXRlMiwgcmVzdWx0O3JldHVybiBfcmVnZW5lcmF0b3JSdW50aW1lMigpLndyYXAoZnVuY3Rpb24gX2NhbGxlZTEzJChfY29udGV4dDEzKSB7d2hpbGUgKDEpIHtzd2l0Y2ggKF9jb250ZXh0MTMucHJldiA9IF9jb250ZXh0MTMubmV4dCkge2Nhc2UgMDp1cmwgPSBuZXcgVVJMKHJlcXVlc3QudXJsKTttZXRob2QgPSByZXF1ZXN0Lm1ldGhvZC50b0xvd2VyQ2FzZSgpO2xvY2F0aW9uID0gY3JlYXRlTG9jYXRpb24oIiIsIHJvdXRlcl9jcmVhdGVQYXRoKHVybCksIG51bGwsICJkZWZhdWx0Iik7bWF0Y2hlcyA9IG1hdGNoUm91dGVzKGRhdGFSb3V0ZXMsIGxvY2F0aW9uLCBiYXNlbmFtZSk7IC8vIFNTUiBzdXBwb3J0cyBIRUFEIHJlcXVlc3RzIHdoaWxlIFNQQSBkb2Vzbid0CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghKCFpc1ZhbGlkTWV0aG9kKG1ldGhvZCkgJiYgbWV0aG9kICE9PSAiaGVhZCIpKSB7X2NvbnRleHQxMy5uZXh0ID0gMTA7YnJlYWs7fWVycm9yID0gZ2V0SW50ZXJuYWxSb3V0ZXJFcnJvcig0MDUsIHsgbWV0aG9kOiBtZXRob2QgfSk7X2dldFNob3J0Q2lyY3VpdE1hdGNoMyA9IGdldFNob3J0Q2lyY3VpdE1hdGNoZXMoZGF0YVJvdXRlcyksIG1ldGhvZE5vdEFsbG93ZWRNYXRjaGVzID0gX2dldFNob3J0Q2lyY3VpdE1hdGNoMy5tYXRjaGVzLCByb3V0ZSA9IF9nZXRTaG9ydENpcmN1aXRNYXRjaDMucm91dGU7cmV0dXJuIF9jb250ZXh0MTMuYWJydXB0KCJyZXR1cm4iLCB7IGJhc2VuYW1lOiBiYXNlbmFtZSwgbG9jYXRpb246IGxvY2F0aW9uLCBtYXRjaGVzOiBtZXRob2ROb3RBbGxvd2VkTWF0Y2hlcywgbG9hZGVyRGF0YToge30sIGFjdGlvbkRhdGE6IG51bGwsIGVycm9yczogX2RlZmluZVByb3BlcnR5Mih7fSwgcm91dGUuaWQsIGVycm9yKSwgc3RhdHVzQ29kZTogZXJyb3Iuc3RhdHVzLCBsb2FkZXJIZWFkZXJzOiB7fSwgYWN0aW9uSGVhZGVyczoge30gfSk7Y2FzZSAxMDppZiAobWF0Y2hlcykge19jb250ZXh0MTMubmV4dCA9IDE0O2JyZWFrO31fZXJyb3IzID0gZ2V0SW50ZXJuYWxSb3V0ZXJFcnJvcig0MDQsIHsgcGF0aG5hbWU6IGxvY2F0aW9uLnBhdGhuYW1lIH0pO19nZXRTaG9ydENpcmN1aXRNYXRjaDQgPSBnZXRTaG9ydENpcmN1aXRNYXRjaGVzKGRhdGFSb3V0ZXMpLCBub3RGb3VuZE1hdGNoZXMgPSBfZ2V0U2hvcnRDaXJjdWl0TWF0Y2g0Lm1hdGNoZXMsIF9yb3V0ZTIgPSBfZ2V0U2hvcnRDaXJjdWl0TWF0Y2g0LnJvdXRlO3JldHVybiBfY29udGV4dDEzLmFicnVwdCgicmV0dXJuIiwgeyBiYXNlbmFtZTogYmFzZW5hbWUsIGxvY2F0aW9uOiBsb2NhdGlvbiwgbWF0Y2hlczogbm90Rm91bmRNYXRjaGVzLCBsb2FkZXJEYXRhOiB7fSwgYWN0aW9uRGF0YTogbnVsbCwgZXJyb3JzOiBfZGVmaW5lUHJvcGVydHkyKHt9LCBfcm91dGUyLmlkLCBfZXJyb3IzKSwgc3RhdHVzQ29kZTogX2Vycm9yMy5zdGF0dXMsIGxvYWRlckhlYWRlcnM6IHt9LCBhY3Rpb25IZWFkZXJzOiB7fSB9KTtjYXNlIDE0Ol9jb250ZXh0MTMubmV4dCA9IDE2O3JldHVybiBxdWVyeUltcGwocmVxdWVzdCwgbG9jYXRpb24sIG1hdGNoZXMpO2Nhc2UgMTY6cmVzdWx0ID0gX2NvbnRleHQxMy5zZW50O2lmICghKHJlc3VsdCBpbnN0YW5jZW9mIFJlc3BvbnNlKSkge19jb250ZXh0MTMubmV4dCA9IDE5O2JyZWFrO31yZXR1cm4gX2NvbnRleHQxMy5hYnJ1cHQoInJldHVybiIsIHJlc3VsdCk7Y2FzZSAxOTpyZXR1cm4gX2NvbnRleHQxMy5hYnJ1cHQoInJldHVybiIsIF9leHRlbmRzKHsgbG9jYXRpb246IGxvY2F0aW9uLCBiYXNlbmFtZTogYmFzZW5hbWUgfSwgcmVzdWx0KSk7Y2FzZSAyMDpjYXNlICJlbmQiOnJldHVybiBfY29udGV4dDEzLnN0b3AoKTt9fX0sIF9jYWxsZWUxMyk7fSkpO3JldHVybiBfcXVlcnkuYXBwbHkodGhpcywgYXJndW1lbnRzKTt9ZnVuY3Rpb24KCiAgICAgICAgICAgIHF1ZXJ5Um91dGUoX3g0NCwgX3g0NSkge3JldHVybiBfcXVlcnlSb3V0ZS5hcHBseSh0aGlzLCBhcmd1bWVudHMpO31mdW5jdGlvbiBfcXVlcnlSb3V0ZSgpIHtfcXVlcnlSb3V0ZSA9IF9hc3luY1RvR2VuZXJhdG9yMiggLyojX19QVVJFX18qL19yZWdlbmVyYXRvclJ1bnRpbWUyKCkubWFyayhmdW5jdGlvbiBfY2FsbGVlMTQocmVxdWVzdCwgcm91dGVJZCkge3ZhciB1cmwsIG1ldGhvZCwgbG9jYXRpb24sIG1hdGNoZXMsIG1hdGNoLCByZXN1bHQsIGVycm9yLCByb3V0ZURhdGE7cmV0dXJuIF9yZWdlbmVyYXRvclJ1bnRpbWUyKCkud3JhcChmdW5jdGlvbiBfY2FsbGVlMTQkKF9jb250ZXh0MTQpIHt3aGlsZSAoMSkge3N3aXRjaCAoX2NvbnRleHQxNC5wcmV2ID0gX2NvbnRleHQxNC5uZXh0KSB7Y2FzZSAwOgogICAgICAgICAgICAgICAgICAgICAgICB1cmwgPSBuZXcgVVJMKHJlcXVlc3QudXJsKTsKICAgICAgICAgICAgICAgICAgICAgICAgbWV0aG9kID0gcmVxdWVzdC5tZXRob2QudG9Mb3dlckNhc2UoKTsKICAgICAgICAgICAgICAgICAgICAgICAgbG9jYXRpb24gPSBjcmVhdGVMb2NhdGlvbigiIiwgcm91dGVyX2NyZWF0ZVBhdGgodXJsKSwgbnVsbCwgImRlZmF1bHQiKTsKICAgICAgICAgICAgICAgICAgICAgICAgbWF0Y2hlcyA9IG1hdGNoUm91dGVzKGRhdGFSb3V0ZXMsIGxvY2F0aW9uLCBiYXNlbmFtZSk7IC8vIFNTUiBzdXBwb3J0cyBIRUFEIHJlcXVlc3RzIHdoaWxlIFNQQSBkb2Vzbid0CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghKAogICAgICAgICAgICAgICAgICAgICAgICAhaXNWYWxpZE1ldGhvZChtZXRob2QpICYmIG1ldGhvZCAhPT0gImhlYWQiKSkge19jb250ZXh0MTQubmV4dCA9IDg7YnJlYWs7fXRocm93ICgKICAgICAgICAgICAgICAgICAgICAgICAgICBnZXRJbnRlcm5hbFJvdXRlckVycm9yKDQwNSwgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgbWV0aG9kOiBtZXRob2QKICAgICAgICAgICAgICAgICAgICAgICAgICB9KSk7Y2FzZSA4OmlmICgKICAgICAgICAgICAgICAgICAgICAgICAgbWF0Y2hlcykge19jb250ZXh0MTQubmV4dCA9IDEwO2JyZWFrO310aHJvdyAoCiAgICAgICAgICAgICAgICAgICAgICAgICAgZ2V0SW50ZXJuYWxSb3V0ZXJFcnJvcig0MDQsIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhdGhuYW1lOiBsb2NhdGlvbi5wYXRobmFtZQogICAgICAgICAgICAgICAgICAgICAgICAgIH0pKTtjYXNlIDEwOgoKCiAgICAgICAgICAgICAgICAgICAgICAgIG1hdGNoID0gcm91dGVJZCA/IG1hdGNoZXMuZmluZCgobSkgPT4gbS5yb3V0ZS5pZCA9PT0gcm91dGVJZCkgOiBnZXRUYXJnZXRNYXRjaChtYXRjaGVzLCBsb2NhdGlvbik7aWYgKCEoCgogICAgICAgICAgICAgICAgICAgICAgICByb3V0ZUlkICYmICFtYXRjaCkpIHtfY29udGV4dDE0Lm5leHQgPSAxNTticmVhazt9dGhyb3cgKAogICAgICAgICAgICAgICAgICAgICAgICAgIGdldEludGVybmFsUm91dGVyRXJyb3IoNDAzLCB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXRobmFtZTogbG9jYXRpb24ucGF0aG5hbWUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByb3V0ZUlkOiByb3V0ZUlkCiAgICAgICAgICAgICAgICAgICAgICAgICAgfSkpO2Nhc2UgMTU6aWYgKAogICAgICAgICAgICAgICAgICAgICAgICBtYXRjaCkge19jb250ZXh0MTQubmV4dCA9IDE3O2JyZWFrO310aHJvdyAoCgogICAgICAgICAgICAgICAgICAgICAgICAgIGdldEludGVybmFsUm91dGVyRXJyb3IoNDA0LCB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXRobmFtZTogbG9jYXRpb24ucGF0aG5hbWUKICAgICAgICAgICAgICAgICAgICAgICAgICB9KSk7Y2FzZSAxNzpfY29udGV4dDE0Lm5leHQgPSAxOTtyZXR1cm4gKAoKCiAgICAgICAgICAgICAgICAgICAgICAgICAgcXVlcnlJbXBsKHJlcXVlc3QsIGxvY2F0aW9uLCBtYXRjaGVzLCBtYXRjaCkpO2Nhc2UgMTk6cmVzdWx0ID0gX2NvbnRleHQxNC5zZW50O2lmICghKAoKICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0IGluc3RhbmNlb2YgUmVzcG9uc2UpKSB7X2NvbnRleHQxNC5uZXh0ID0gMjI7YnJlYWs7fXJldHVybiBfY29udGV4dDE0LmFicnVwdCgicmV0dXJuIiwKICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0KTtjYXNlIDIyOgoKCiAgICAgICAgICAgICAgICAgICAgICAgIGVycm9yID0gcmVzdWx0LmVycm9ycyA/IE9iamVjdC52YWx1ZXMocmVzdWx0LmVycm9ycylbMF0gOiB1bmRlZmluZWQ7aWYgKCEoCgogICAgICAgICAgICAgICAgICAgICAgICBlcnJvciAhPT0gdW5kZWZpbmVkKSkge19jb250ZXh0MTQubmV4dCA9IDI1O2JyZWFrO310aHJvdyAoCgoKCgogICAgICAgICAgICAgICAgICAgICAgICAgIGVycm9yKTtjYXNlIDI1OgogICAgICAgICAgICAgICAgICAgICAgICAvLyBQaWNrIG9mZiB0aGUgcmlnaHQgc3RhdGUgdmFsdWUgdG8gcmV0dXJuCgoKICAgICAgICAgICAgICAgICAgICAgICAgcm91dGVEYXRhID0gW3Jlc3VsdC5hY3Rpb25EYXRhLCByZXN1bHQubG9hZGVyRGF0YV0uZmluZCgodikgPT4gdik7cmV0dXJuIF9jb250ZXh0MTQuYWJydXB0KCJyZXR1cm4iLAogICAgICAgICAgICAgICAgICAgICAgICBPYmplY3QudmFsdWVzKHJvdXRlRGF0YSB8fCB7fSlbMF0pO2Nhc2UgMjc6Y2FzZSAiZW5kIjpyZXR1cm4gX2NvbnRleHQxNC5zdG9wKCk7fX19LCBfY2FsbGVlMTQpO30pKTtyZXR1cm4gX3F1ZXJ5Um91dGUuYXBwbHkodGhpcywgYXJndW1lbnRzKTt9ZnVuY3Rpb24KCgogICAgICAgICAgICBxdWVyeUltcGwoX3g0NiwgX3g0NywgX3g0OCwgX3g0OSkge3JldHVybiBfcXVlcnlJbXBsLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7fWZ1bmN0aW9uIF9xdWVyeUltcGwoKSB7X3F1ZXJ5SW1wbCA9IF9hc3luY1RvR2VuZXJhdG9yMiggLyojX19QVVJFX18qL19yZWdlbmVyYXRvclJ1bnRpbWUyKCkubWFyayhmdW5jdGlvbiBfY2FsbGVlMTUocmVxdWVzdCwgbG9jYXRpb24sIG1hdGNoZXMsIHJvdXRlTWF0Y2gpIHt2YXIgX3Jlc3VsdCwgcmVzdWx0O3JldHVybiBfcmVnZW5lcmF0b3JSdW50aW1lMigpLndyYXAoZnVuY3Rpb24gX2NhbGxlZTE1JChfY29udGV4dDE1KSB7d2hpbGUgKDEpIHtzd2l0Y2ggKF9jb250ZXh0MTUucHJldiA9IF9jb250ZXh0MTUubmV4dCkge2Nhc2UgMDoKICAgICAgICAgICAgICAgICAgICAgICAgcm91dGVyX2ludmFyaWFudChyZXF1ZXN0LnNpZ25hbCwgInF1ZXJ5KCkvcXVlcnlSb3V0ZSgpIHJlcXVlc3RzIG11c3QgY29udGFpbiBhbiBBYm9ydENvbnRyb2xsZXIgc2lnbmFsIik7X2NvbnRleHQxNS5wcmV2ID0gMTtpZiAoIQoKCiAgICAgICAgICAgICAgICAgICAgICAgIGlzU3VibWlzc2lvbk1ldGhvZChyZXF1ZXN0Lm1ldGhvZC50b0xvd2VyQ2FzZSgpKSkge19jb250ZXh0MTUubmV4dCA9IDc7YnJlYWs7fV9jb250ZXh0MTUubmV4dCA9IDU7cmV0dXJuICgKICAgICAgICAgICAgICAgICAgICAgICAgICBzdWJtaXQocmVxdWVzdCwgbWF0Y2hlcywgcm91dGVNYXRjaCB8fCBnZXRUYXJnZXRNYXRjaChtYXRjaGVzLCBsb2NhdGlvbiksIHJvdXRlTWF0Y2ggIT0gbnVsbCkpO2Nhc2UgNTpfcmVzdWx0ID0gX2NvbnRleHQxNS5zZW50O3JldHVybiBfY29udGV4dDE1LmFicnVwdCgicmV0dXJuIiwKICAgICAgICAgICAgICAgICAgICAgICAgX3Jlc3VsdCk7Y2FzZSA3Ol9jb250ZXh0MTUubmV4dCA9IDk7cmV0dXJuICgKCgogICAgICAgICAgICAgICAgICAgICAgICAgIGxvYWRSb3V0ZURhdGEocmVxdWVzdCwgbWF0Y2hlcywgcm91dGVNYXRjaCkpO2Nhc2UgOTpyZXN1bHQgPSBfY29udGV4dDE1LnNlbnQ7cmV0dXJuIF9jb250ZXh0MTUuYWJydXB0KCJyZXR1cm4iLAogICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQgaW5zdGFuY2VvZiBSZXNwb25zZSA/IHJlc3VsdCA6IF9leHRlbmRzKHt9LCByZXN1bHQsIHsKICAgICAgICAgICAgICAgICAgICAgICAgICBhY3Rpb25EYXRhOiBudWxsLAogICAgICAgICAgICAgICAgICAgICAgICAgIGFjdGlvbkhlYWRlcnM6IHt9CiAgICAgICAgICAgICAgICAgICAgICAgIH0pKTtjYXNlIDEzOl9jb250ZXh0MTUucHJldiA9IDEzO19jb250ZXh0MTUudDAgPSBfY29udGV4dDE1WyJjYXRjaCJdKDEpO2lmICghCgoKCgogICAgICAgICAgICAgICAgICAgICAgICBpc1F1ZXJ5Um91dGVSZXNwb25zZShfY29udGV4dDE1LnQwKSkge19jb250ZXh0MTUubmV4dCA9IDE5O2JyZWFrO31pZiAoISgKICAgICAgICAgICAgICAgICAgICAgICAgX2NvbnRleHQxNS50MC50eXBlID09PSBSZXN1bHRUeXBlLmVycm9yICYmICFpc1JlZGlyZWN0UmVzcG9uc2UoX2NvbnRleHQxNS50MC5yZXNwb25zZSkpKSB7X2NvbnRleHQxNS5uZXh0ID0gMTg7YnJlYWs7fXRocm93ICgKICAgICAgICAgICAgICAgICAgICAgICAgICBfY29udGV4dDE1LnQwLnJlc3BvbnNlKTtjYXNlIDE4OnJldHVybiBfY29udGV4dDE1LmFicnVwdCgicmV0dXJuIiwKCgogICAgICAgICAgICAgICAgICAgICAgICBfY29udGV4dDE1LnQwLnJlc3BvbnNlKTtjYXNlIDE5OmlmICghCgoKCgogICAgICAgICAgICAgICAgICAgICAgICBpc1JlZGlyZWN0UmVzcG9uc2UoX2NvbnRleHQxNS50MCkpIHtfY29udGV4dDE1Lm5leHQgPSAyMTticmVhazt9cmV0dXJuIF9jb250ZXh0MTUuYWJydXB0KCJyZXR1cm4iLCBfY29udGV4dDE1LnQwKTtjYXNlIDIxOnRocm93IF9jb250ZXh0MTUudDA7Y2FzZSAyMjpjYXNlICJlbmQiOnJldHVybiBfY29udGV4dDE1LnN0b3AoKTt9fX0sIF9jYWxsZWUxNSwgbnVsbCwgW1sxLCAxM11dKTt9KSk7cmV0dXJuIF9xdWVyeUltcGwuYXBwbHkodGhpcywgYXJndW1lbnRzKTt9ZnVuY3Rpb24KCgoKCgoKCiAgICAgICAgICAgIHN1Ym1pdChfeDUwLCBfeDUxLCBfeDUyLCBfeDUzKSB7cmV0dXJuIF9zdWJtaXQuYXBwbHkodGhpcywgYXJndW1lbnRzKTt9ZnVuY3Rpb24gX3N1Ym1pdCgpIHtfc3VibWl0ID0gX2FzeW5jVG9HZW5lcmF0b3IyKCAvKiNfX1BVUkVfXyovX3JlZ2VuZXJhdG9yUnVudGltZTIoKS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUxNihyZXF1ZXN0LCBtYXRjaGVzLCBhY3Rpb25NYXRjaCwgaXNSb3V0ZVJlcXVlc3QpIHt2YXIgcmVzdWx0LCBlcnJvciwgbWV0aG9kLCBib3VuZGFyeU1hdGNoLCBfY29udGV4dDE2LCBjb250ZXh0O3JldHVybiBfcmVnZW5lcmF0b3JSdW50aW1lMigpLndyYXAoZnVuY3Rpb24gX2NhbGxlZTE2JChfY29udGV4dDE3KSB7d2hpbGUgKDEpIHtzd2l0Y2ggKF9jb250ZXh0MTcucHJldiA9IF9jb250ZXh0MTcubmV4dCkge2Nhc2UgMDppZiAoCgoKICAgICAgICAgICAgICAgICAgICAgICAgYWN0aW9uTWF0Y2gucm91dGUuYWN0aW9uKSB7X2NvbnRleHQxNy5uZXh0ID0gNzticmVhazt9CiAgICAgICAgICAgICAgICAgICAgICAgIGVycm9yID0gZ2V0SW50ZXJuYWxSb3V0ZXJFcnJvcig0MDUsIHsKICAgICAgICAgICAgICAgICAgICAgICAgICBtZXRob2Q6IHJlcXVlc3QubWV0aG9kLAogICAgICAgICAgICAgICAgICAgICAgICAgIHBhdGhuYW1lOiBjcmVhdGVVUkwocmVxdWVzdC51cmwpLnBhdGhuYW1lLAogICAgICAgICAgICAgICAgICAgICAgICAgIHJvdXRlSWQ6IGFjdGlvbk1hdGNoLnJvdXRlLmlkCiAgICAgICAgICAgICAgICAgICAgICAgIH0pO2lmICghCgogICAgICAgICAgICAgICAgICAgICAgICBpc1JvdXRlUmVxdWVzdCkge19jb250ZXh0MTcubmV4dCA9IDQ7YnJlYWs7fXRocm93ICgKICAgICAgICAgICAgICAgICAgICAgICAgICBlcnJvcik7Y2FzZSA0OgoKCiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdCA9IHsKICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiBSZXN1bHRUeXBlLmVycm9yLAogICAgICAgICAgICAgICAgICAgICAgICAgIGVycm9yOiBlcnJvcgogICAgICAgICAgICAgICAgICAgICAgICB9O19jb250ZXh0MTcubmV4dCA9IDEzO2JyZWFrO2Nhc2UgNzpfY29udGV4dDE3Lm5leHQgPSA5O3JldHVybiAoCgogICAgICAgICAgICAgICAgICAgICAgICAgIGNhbGxMb2FkZXJPckFjdGlvbigiYWN0aW9uIiwgcmVxdWVzdCwgYWN0aW9uTWF0Y2gsIG1hdGNoZXMsIGJhc2VuYW1lLCB0cnVlLCBpc1JvdXRlUmVxdWVzdCkpO2Nhc2UgOTpyZXN1bHQgPSBfY29udGV4dDE3LnNlbnQ7aWYgKCEKCiAgICAgICAgICAgICAgICAgICAgICAgIHJlcXVlc3Quc2lnbmFsLmFib3J0ZWQpIHtfY29udGV4dDE3Lm5leHQgPSAxMzticmVhazt9CiAgICAgICAgICAgICAgICAgICAgICAgIG1ldGhvZCA9IGlzUm91dGVSZXF1ZXN0ID8gInF1ZXJ5Um91dGUiIDogInF1ZXJ5Ijt0aHJvdyAoCiAgICAgICAgICAgICAgICAgICAgICAgICAgbmV3IEVycm9yKG1ldGhvZCArICIoKSBjYWxsIGFib3J0ZWQiKSk7Y2FzZSAxMzppZiAoIQoKCgogICAgICAgICAgICAgICAgICAgICAgICBpc1JlZGlyZWN0UmVzdWx0KHJlc3VsdCkpIHtfY29udGV4dDE3Lm5leHQgPSAxNTticmVhazt9dGhyb3cgKAoKCgoKICAgICAgICAgICAgICAgICAgICAgICAgICBuZXcgUmVzcG9uc2UobnVsbCwgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhdHVzOiByZXN1bHQuc3RhdHVzLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgaGVhZGVyczogewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBMb2NhdGlvbjogcmVzdWx0LmxvY2F0aW9uCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgfSkpO2Nhc2UgMTU6aWYgKCEKCgogICAgICAgICAgICAgICAgICAgICAgICBpc0RlZmVycmVkUmVzdWx0KHJlc3VsdCkpIHtfY29udGV4dDE3Lm5leHQgPSAxNzticmVhazt9dGhyb3cgKAogICAgICAgICAgICAgICAgICAgICAgICAgIG5ldyBFcnJvcigiZGVmZXIoKSBpcyBub3Qgc3VwcG9ydGVkIGluIGFjdGlvbnMiKSk7Y2FzZSAxNzppZiAoIQoKCiAgICAgICAgICAgICAgICAgICAgICAgIGlzUm91dGVSZXF1ZXN0KSB7X2NvbnRleHQxNy5uZXh0ID0gMjE7YnJlYWs7fWlmICghCgoKICAgICAgICAgICAgICAgICAgICAgICAgaXNFcnJvclJlc3VsdChyZXN1bHQpKSB7X2NvbnRleHQxNy5uZXh0ID0gMjA7YnJlYWs7fXRocm93ICgKICAgICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQuZXJyb3IpO2Nhc2UgMjA6cmV0dXJuIF9jb250ZXh0MTcuYWJydXB0KCJyZXR1cm4iLAoKCiAgICAgICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgICBtYXRjaGVzOiBbYWN0aW9uTWF0Y2hdLAogICAgICAgICAgICAgICAgICAgICAgICAgIGxvYWRlckRhdGE6IHt9LAogICAgICAgICAgICAgICAgICAgICAgICAgIGFjdGlvbkRhdGE6IF9kZWZpbmVQcm9wZXJ0eTIoe30sCiAgICAgICAgICAgICAgICAgICAgICAgICAgYWN0aW9uTWF0Y2gucm91dGUuaWQsIHJlc3VsdC5kYXRhKSwKCiAgICAgICAgICAgICAgICAgICAgICAgICAgZXJyb3JzOiBudWxsLAogICAgICAgICAgICAgICAgICAgICAgICAgIC8vIE5vdGU6IHN0YXR1c0NvZGUgKyBoZWFkZXJzIGFyZSB1bnVzZWQgaGVyZSBzaW5jZSBxdWVyeVJvdXRlIHdpbGwKICAgICAgICAgICAgICAgICAgICAgICAgICAvLyByZXR1cm4gdGhlIHJhdyBSZXNwb25zZSBvciB2YWx1ZQogICAgICAgICAgICAgICAgICAgICAgICAgIHN0YXR1c0NvZGU6IDIwMCwKICAgICAgICAgICAgICAgICAgICAgICAgICBsb2FkZXJIZWFkZXJzOiB7fSwKICAgICAgICAgICAgICAgICAgICAgICAgICBhY3Rpb25IZWFkZXJzOiB7fQogICAgICAgICAgICAgICAgICAgICAgICB9KTtjYXNlIDIxOmlmICghCgoKICAgICAgICAgICAgICAgICAgICAgICAgaXNFcnJvclJlc3VsdChyZXN1bHQpKSB7X2NvbnRleHQxNy5uZXh0ID0gMjc7YnJlYWs7fQogICAgICAgICAgICAgICAgICAgICAgICAvLyBTdG9yZSBvZmYgdGhlIHBlbmRpbmcgZXJyb3IgLSB3ZSB1c2UgaXQgdG8gZGV0ZXJtaW5lIHdoaWNoIGxvYWRlcnMKICAgICAgICAgICAgICAgICAgICAgICAgLy8gdG8gY2FsbCBhbmQgd2lsbCBjb21taXQgaXQgd2hlbiB3ZSBjb21wbGV0ZSB0aGUgbmF2aWdhdGlvbgogICAgICAgICAgICAgICAgICAgICAgICBib3VuZGFyeU1hdGNoID0gZmluZE5lYXJlc3RCb3VuZGFyeShtYXRjaGVzLCBhY3Rpb25NYXRjaC5yb3V0ZS5pZCk7X2NvbnRleHQxNy5uZXh0ID0gMjU7cmV0dXJuICgKICAgICAgICAgICAgICAgICAgICAgICAgICBsb2FkUm91dGVEYXRhKHJlcXVlc3QsIG1hdGNoZXMsIHVuZGVmaW5lZCwgX2RlZmluZVByb3BlcnR5Mih7fSwKICAgICAgICAgICAgICAgICAgICAgICAgICBib3VuZGFyeU1hdGNoLnJvdXRlLmlkLCByZXN1bHQuZXJyb3IpKSk7Y2FzZSAyNTpfY29udGV4dDE2ID0gX2NvbnRleHQxNy5zZW50O3JldHVybiBfY29udGV4dDE3LmFicnVwdCgicmV0dXJuIiwKCgogICAgICAgICAgICAgICAgICAgICAgICBfZXh0ZW5kcyh7fSwgX2NvbnRleHQxNiwgewogICAgICAgICAgICAgICAgICAgICAgICAgIHN0YXR1c0NvZGU6IGlzUm91dGVFcnJvclJlc3BvbnNlKHJlc3VsdC5lcnJvcikgPyByZXN1bHQuZXJyb3Iuc3RhdHVzIDogNTAwLAogICAgICAgICAgICAgICAgICAgICAgICAgIGFjdGlvbkRhdGE6IG51bGwsCiAgICAgICAgICAgICAgICAgICAgICAgICAgYWN0aW9uSGVhZGVyczogX2V4dGVuZHMoe30sIHJlc3VsdC5oZWFkZXJzID8gX2RlZmluZVByb3BlcnR5Mih7fSwKICAgICAgICAgICAgICAgICAgICAgICAgICBhY3Rpb25NYXRjaC5yb3V0ZS5pZCwgcmVzdWx0LmhlYWRlcnMpIDoKICAgICAgICAgICAgICAgICAgICAgICAgICB7fSkKICAgICAgICAgICAgICAgICAgICAgICAgfSkpO2Nhc2UgMjc6X2NvbnRleHQxNy5uZXh0ID0gMjk7cmV0dXJuICgKCgogICAgICAgICAgICAgICAgICAgICAgICAgIGxvYWRSb3V0ZURhdGEocmVxdWVzdCwgbWF0Y2hlcykpO2Nhc2UgMjk6Y29udGV4dCA9IF9jb250ZXh0MTcuc2VudDtyZXR1cm4gX2NvbnRleHQxNy5hYnJ1cHQoInJldHVybiIsCiAgICAgICAgICAgICAgICAgICAgICAgIF9leHRlbmRzKHt9LCBjb250ZXh0LCByZXN1bHQuc3RhdHVzQ29kZSA/IHsKICAgICAgICAgICAgICAgICAgICAgICAgICBzdGF0dXNDb2RlOiByZXN1bHQuc3RhdHVzQ29kZQogICAgICAgICAgICAgICAgICAgICAgICB9IDoge30sIHsKICAgICAgICAgICAgICAgICAgICAgICAgICBhY3Rpb25EYXRhOiBfZGVmaW5lUHJvcGVydHkyKHt9LAogICAgICAgICAgICAgICAgICAgICAgICAgIGFjdGlvbk1hdGNoLnJvdXRlLmlkLCByZXN1bHQuZGF0YSksCgogICAgICAgICAgICAgICAgICAgICAgICAgIGFjdGlvbkhlYWRlcnM6IF9leHRlbmRzKHt9LCByZXN1bHQuaGVhZGVycyA/IF9kZWZpbmVQcm9wZXJ0eTIoe30sCiAgICAgICAgICAgICAgICAgICAgICAgICAgYWN0aW9uTWF0Y2gucm91dGUuaWQsIHJlc3VsdC5oZWFkZXJzKSA6CiAgICAgICAgICAgICAgICAgICAgICAgICAge30pCiAgICAgICAgICAgICAgICAgICAgICAgIH0pKTtjYXNlIDMxOmNhc2UgImVuZCI6cmV0dXJuIF9jb250ZXh0MTcuc3RvcCgpO319fSwgX2NhbGxlZTE2KTt9KSk7cmV0dXJuIF9zdWJtaXQuYXBwbHkodGhpcywgYXJndW1lbnRzKTt9ZnVuY3Rpb24KCgogICAgICAgICAgICBsb2FkUm91dGVEYXRhKF94NTQsIF94NTUsIF94NTYsIF94NTcpIHtyZXR1cm4gX2xvYWRSb3V0ZURhdGEuYXBwbHkodGhpcywgYXJndW1lbnRzKTt9ZnVuY3Rpb24gX2xvYWRSb3V0ZURhdGEoKSB7X2xvYWRSb3V0ZURhdGEgPSBfYXN5bmNUb0dlbmVyYXRvcjIoIC8qI19fUFVSRV9fKi9fcmVnZW5lcmF0b3JSdW50aW1lMigpLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTE3KHJlcXVlc3QsIG1hdGNoZXMsIHJvdXRlTWF0Y2gsIHBlbmRpbmdBY3Rpb25FcnJvcikge3ZhciBpc1JvdXRlUmVxdWVzdCwgcmVxdWVzdE1hdGNoZXMsIG1hdGNoZXNUb0xvYWQsIHJlc3VsdHMsIG1ldGhvZCwgY29udGV4dDtyZXR1cm4gX3JlZ2VuZXJhdG9yUnVudGltZTIoKS53cmFwKGZ1bmN0aW9uIF9jYWxsZWUxNyQoX2NvbnRleHQxOCkge3doaWxlICgxKSB7c3dpdGNoIChfY29udGV4dDE4LnByZXYgPSBfY29udGV4dDE4Lm5leHQpIHtjYXNlIDA6CiAgICAgICAgICAgICAgICAgICAgICAgIGlzUm91dGVSZXF1ZXN0ID0gcm91dGVNYXRjaCAhPSBudWxsOyAvLyBTaG9ydCBjaXJjdWl0IGlmIHdlIGhhdmUgbm8gbG9hZGVycyB0byBydW4gKHF1ZXJ5Um91dGUoKSkKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCEoCiAgICAgICAgICAgICAgICAgICAgICAgIGlzUm91dGVSZXF1ZXN0ICYmICEocm91dGVNYXRjaCAhPSBudWxsICYmIHJvdXRlTWF0Y2gucm91dGUubG9hZGVyKSkpIHtfY29udGV4dDE4Lm5leHQgPSAzO2JyZWFrO310aHJvdyAoCiAgICAgICAgICAgICAgICAgICAgICAgICAgZ2V0SW50ZXJuYWxSb3V0ZXJFcnJvcig0MDAsIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1ldGhvZDogcmVxdWVzdC5tZXRob2QsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXRobmFtZTogY3JlYXRlVVJMKHJlcXVlc3QudXJsKS5wYXRobmFtZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJvdXRlSWQ6IHJvdXRlTWF0Y2ggPT0gbnVsbCA/IHZvaWQgMCA6IHJvdXRlTWF0Y2gucm91dGUuaWQKICAgICAgICAgICAgICAgICAgICAgICAgICB9KSk7Y2FzZSAzOgoKCiAgICAgICAgICAgICAgICAgICAgICAgIHJlcXVlc3RNYXRjaGVzID0gcm91dGVNYXRjaCA/IFtyb3V0ZU1hdGNoXSA6IGdldExvYWRlck1hdGNoZXNVbnRpbEJvdW5kYXJ5KG1hdGNoZXMsIE9iamVjdC5rZXlzKHBlbmRpbmdBY3Rpb25FcnJvciB8fCB7fSlbMF0pOwogICAgICAgICAgICAgICAgICAgICAgICBtYXRjaGVzVG9Mb2FkID0gcmVxdWVzdE1hdGNoZXMuZmlsdGVyKChtKSA9PiBtLnJvdXRlLmxvYWRlcik7IC8vIFNob3J0IGNpcmN1aXQgaWYgd2UgaGF2ZSBubyBsb2FkZXJzIHRvIHJ1biAocXVlcnkoKSkKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCEoCiAgICAgICAgICAgICAgICAgICAgICAgIG1hdGNoZXNUb0xvYWQubGVuZ3RoID09PSAwKSkge19jb250ZXh0MTgubmV4dCA9IDc7YnJlYWs7fXJldHVybiBfY29udGV4dDE4LmFicnVwdCgicmV0dXJuIiwKICAgICAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICAgIG1hdGNoZXM6IG1hdGNoZXMsCiAgICAgICAgICAgICAgICAgICAgICAgICAgbG9hZGVyRGF0YToge30sCiAgICAgICAgICAgICAgICAgICAgICAgICAgZXJyb3JzOiBwZW5kaW5nQWN0aW9uRXJyb3IgfHwgbnVsbCwKICAgICAgICAgICAgICAgICAgICAgICAgICBzdGF0dXNDb2RlOiAyMDAsCiAgICAgICAgICAgICAgICAgICAgICAgICAgbG9hZGVySGVhZGVyczoge30KICAgICAgICAgICAgICAgICAgICAgICAgfSk7Y2FzZSA3Ol9jb250ZXh0MTgubmV4dCA9IDk7cmV0dXJuICgKCgogICAgICAgICAgICAgICAgICAgICAgICAgIFByb21pc2UuYWxsKF90b0NvbnN1bWFibGVBcnJheTIobWF0Y2hlc1RvTG9hZC5tYXAoKG1hdGNoKSA9PiBjYWxsTG9hZGVyT3JBY3Rpb24oImxvYWRlciIsIHJlcXVlc3QsIG1hdGNoLCBtYXRjaGVzLCBiYXNlbmFtZSwgdHJ1ZSwgaXNSb3V0ZVJlcXVlc3QpKSkpKTtjYXNlIDk6cmVzdWx0cyA9IF9jb250ZXh0MTguc2VudDtpZiAoIQoKICAgICAgICAgICAgICAgICAgICAgICAgcmVxdWVzdC5zaWduYWwuYWJvcnRlZCkge19jb250ZXh0MTgubmV4dCA9IDEzO2JyZWFrO30KICAgICAgICAgICAgICAgICAgICAgICAgbWV0aG9kID0gaXNSb3V0ZVJlcXVlc3QgPyAicXVlcnlSb3V0ZSIgOiAicXVlcnkiO3Rocm93ICgKICAgICAgICAgICAgICAgICAgICAgICAgICBuZXcgRXJyb3IobWV0aG9kICsgIigpIGNhbGwgYWJvcnRlZCIpKTtjYXNlIDEzOgogICAgICAgICAgICAgICAgICAgICAgICAvLyBDYW4ndCBkbyBhbnl0aGluZyB3aXRoIHRoZXNlIHdpdGhvdXQgdGhlIFJlbWl4IHNpZGUgb2YgdGhpbmdzLCBzbyBqdXN0CiAgICAgICAgICAgICAgICAgICAgICAgIC8vIGNhbmNlbCB0aGVtIGZvciBub3cKCgogICAgICAgICAgICAgICAgICAgICAgICByZXN1bHRzLmZvckVhY2goKHJlc3VsdCkgPT4gewogICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpc0RlZmVycmVkUmVzdWx0KHJlc3VsdCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdC5kZWZlcnJlZERhdGEuY2FuY2VsKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9KTsgLy8gUHJvY2VzcyBhbmQgY29tbWl0IG91dHB1dCBmcm9tIGxvYWRlcnMKCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRleHQgPSBwcm9jZXNzUm91dGVMb2FkZXJEYXRhKG1hdGNoZXMsIG1hdGNoZXNUb0xvYWQsIHJlc3VsdHMsIHBlbmRpbmdBY3Rpb25FcnJvcik7cmV0dXJuIF9jb250ZXh0MTguYWJydXB0KCJyZXR1cm4iLAogICAgICAgICAgICAgICAgICAgICAgICBfZXh0ZW5kcyh7fSwgY29udGV4dCwgewogICAgICAgICAgICAgICAgICAgICAgICAgIG1hdGNoZXM6IG1hdGNoZXMKICAgICAgICAgICAgICAgICAgICAgICAgfSkpO2Nhc2UgMTY6Y2FzZSAiZW5kIjpyZXR1cm4gX2NvbnRleHQxOC5zdG9wKCk7fX19LCBfY2FsbGVlMTcpO30pKTtyZXR1cm4gX2xvYWRSb3V0ZURhdGEuYXBwbHkodGhpcywgYXJndW1lbnRzKTt9CgoKICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICBkYXRhUm91dGVzOiBkYXRhUm91dGVzLAogICAgICAgICAgICAgIHF1ZXJ5OiBxdWVyeSwKICAgICAgICAgICAgICBxdWVyeVJvdXRlOiBxdWVyeVJvdXRlCiAgICAgICAgICAgIH07CiAgICAgICAgICB9IC8vI2VuZHJlZ2lvbgogICAgICAgICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KICAgICAgICAgIC8vI3JlZ2lvbiBIZWxwZXJzCiAgICAgICAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwoKICAgICAgICAgIC8qKgogICAgICAgICAgICogR2l2ZW4gYW4gZXhpc3RpbmcgU3RhdGljSGFuZGxlckNvbnRleHQgYW5kIGFuIGVycm9yIHRocm93biBhdCByZW5kZXIgdGltZSwKICAgICAgICAgICAqIHByb3ZpZGUgYW4gdXBkYXRlZCBTdGF0aWNIYW5kbGVyQ29udGV4dCBzdWl0YWJsZSBmb3IgYSBzZWNvbmQgU1NSIHJlbmRlcgogICAgICAgICAgICovCgogICAgICAgICAgZnVuY3Rpb24gZ2V0U3RhdGljQ29udGV4dEZyb21FcnJvcihyb3V0ZXMsIGNvbnRleHQsIGVycm9yKSB7CiAgICAgICAgICAgIHZhciBuZXdDb250ZXh0ID0gX2V4dGVuZHMoe30sIGNvbnRleHQsIHsKICAgICAgICAgICAgICBzdGF0dXNDb2RlOiA1MDAsCiAgICAgICAgICAgICAgZXJyb3JzOiBfZGVmaW5lUHJvcGVydHkyKHt9LAogICAgICAgICAgICAgIGNvbnRleHQuX2RlZXBlc3RSZW5kZXJlZEJvdW5kYXJ5SWQgfHwgcm91dGVzWzBdLmlkLCBlcnJvcikKCiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgcmV0dXJuIG5ld0NvbnRleHQ7CiAgICAgICAgICB9CgogICAgICAgICAgZnVuY3Rpb24gaXNTdWJtaXNzaW9uTmF2aWdhdGlvbihvcHRzKSB7CiAgICAgICAgICAgIHJldHVybiBvcHRzICE9IG51bGwgJiYgImZvcm1EYXRhIiBpbiBvcHRzOwogICAgICAgICAgfSAvLyBOb3JtYWxpemUgbmF2aWdhdGlvbiBvcHRpb25zIGJ5IGNvbnZlcnRpbmcgZm9ybU1ldGhvZD1HRVQgZm9ybURhdGEgb2JqZWN0cyB0bwogICAgICAgICAgLy8gVVJMU2VhcmNoUGFyYW1zIHNvIHRoZXkgYmVoYXZlIGlkZW50aWNhbGx5IHRvIGxpbmtzIHdpdGggcXVlcnkgcGFyYW1zCgoKICAgICAgICAgIGZ1bmN0aW9uIG5vcm1hbGl6ZU5hdmlnYXRlT3B0aW9ucyh0bywgb3B0cywgaXNGZXRjaGVyKSB7CiAgICAgICAgICAgIGlmIChpc0ZldGNoZXIgPT09IHZvaWQgMCkgewogICAgICAgICAgICAgIGlzRmV0Y2hlciA9IGZhbHNlOwogICAgICAgICAgICB9CgogICAgICAgICAgICB2YXIgcGF0aCA9IHR5cGVvZiB0byA9PT0gInN0cmluZyIgPyB0byA6IHJvdXRlcl9jcmVhdGVQYXRoKHRvKTsgLy8gUmV0dXJuIGxvY2F0aW9uIHZlcmJhdGltIG9uIG5vbi1zdWJtaXNzaW9uIG5hdmlnYXRpb25zCgogICAgICAgICAgICBpZiAoIW9wdHMgfHwgIWlzU3VibWlzc2lvbk5hdmlnYXRpb24ob3B0cykpIHsKICAgICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgcGF0aDogcGF0aAogICAgICAgICAgICAgIH07CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChvcHRzLmZvcm1NZXRob2QgJiYgIWlzVmFsaWRNZXRob2Qob3B0cy5mb3JtTWV0aG9kKSkgewogICAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICBwYXRoOiBwYXRoLAogICAgICAgICAgICAgICAgZXJyb3I6IGdldEludGVybmFsUm91dGVyRXJyb3IoNDA1LCB7CiAgICAgICAgICAgICAgICAgIG1ldGhvZDogb3B0cy5mb3JtTWV0aG9kCiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgIH07CiAgICAgICAgICAgIH0gLy8gQ3JlYXRlIGEgU3VibWlzc2lvbiBvbiBub24tR0VUIG5hdmlnYXRpb25zCgoKICAgICAgICAgICAgaWYgKG9wdHMuZm9ybU1ldGhvZCAmJiBpc1N1Ym1pc3Npb25NZXRob2Qob3B0cy5mb3JtTWV0aG9kKSkgewogICAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICBwYXRoOiBwYXRoLAogICAgICAgICAgICAgICAgc3VibWlzc2lvbjogewogICAgICAgICAgICAgICAgICBmb3JtTWV0aG9kOiBvcHRzLmZvcm1NZXRob2QsCiAgICAgICAgICAgICAgICAgIGZvcm1BY3Rpb246IHN0cmlwSGFzaEZyb21QYXRoKHBhdGgpLAogICAgICAgICAgICAgICAgICBmb3JtRW5jVHlwZTogb3B0cyAmJiBvcHRzLmZvcm1FbmNUeXBlIHx8ICJhcHBsaWNhdGlvbi94LXd3dy1mb3JtLXVybGVuY29kZWQiLAogICAgICAgICAgICAgICAgICBmb3JtRGF0YTogb3B0cy5mb3JtRGF0YQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH07CiAgICAgICAgICAgIH0gLy8gRmxhdHRlbiBzdWJtaXNzaW9uIG9udG8gVVJMU2VhcmNoUGFyYW1zIGZvciBHRVQgc3VibWlzc2lvbnMKCgogICAgICAgICAgICB2YXIgcGFyc2VkUGF0aCA9IHBhcnNlUGF0aChwYXRoKTsKCiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgdmFyIHNlYXJjaFBhcmFtcyA9IGNvbnZlcnRGb3JtRGF0YVRvU2VhcmNoUGFyYW1zKG9wdHMuZm9ybURhdGEpOyAvLyBTaW5jZSBmZXRjaGVyIEdFVCBzdWJtaXNzaW9ucyBvbmx5IHJ1biBhIHNpbmdsZSBsb2FkZXIgKGFzIG9wcG9zZWQgdG8KICAgICAgICAgICAgICAvLyBuYXZpZ2F0aW9uIEdFVCBzdWJtaXNzaW9ucyB3aGljaCBydW4gYWxsIGxvYWRlcnMpLCB3ZSBuZWVkIHRvIHByZXNlcnZlCiAgICAgICAgICAgICAgLy8gYW55IGluY29taW5nID9pbmRleCBwYXJhbXMKCiAgICAgICAgICAgICAgaWYgKGlzRmV0Y2hlciAmJiBwYXJzZWRQYXRoLnNlYXJjaCAmJiBoYXNOYWtlZEluZGV4UXVlcnkocGFyc2VkUGF0aC5zZWFyY2gpKSB7CiAgICAgICAgICAgICAgICBzZWFyY2hQYXJhbXMuYXBwZW5kKCJpbmRleCIsICIiKTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIHBhcnNlZFBhdGguc2VhcmNoID0gIj8iICsgc2VhcmNoUGFyYW1zOwogICAgICAgICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgIHBhdGg6IHBhdGgsCiAgICAgICAgICAgICAgICBlcnJvcjogZ2V0SW50ZXJuYWxSb3V0ZXJFcnJvcig0MDApCiAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICBwYXRoOiByb3V0ZXJfY3JlYXRlUGF0aChwYXJzZWRQYXRoKQogICAgICAgICAgICB9OwogICAgICAgICAgfSAvLyBGaWx0ZXIgb3V0IGFsbCByb3V0ZXMgYmVsb3cgYW55IGNhdWdodCBlcnJvciBhcyB0aGV5IGFyZW4ndCBnb2luZyB0bwogICAgICAgICAgLy8gcmVuZGVyIHNvIHdlIGRvbid0IG5lZWQgdG8gbG9hZCB0aGVtCgoKICAgICAgICAgIGZ1bmN0aW9uIGdldExvYWRlck1hdGNoZXNVbnRpbEJvdW5kYXJ5KG1hdGNoZXMsIGJvdW5kYXJ5SWQpIHsKICAgICAgICAgICAgdmFyIGJvdW5kYXJ5TWF0Y2hlcyA9IG1hdGNoZXM7CgogICAgICAgICAgICBpZiAoYm91bmRhcnlJZCkgewogICAgICAgICAgICAgIHZhciBpbmRleCA9IG1hdGNoZXMuZmluZEluZGV4KChtKSA9PiBtLnJvdXRlLmlkID09PSBib3VuZGFyeUlkKTsKCiAgICAgICAgICAgICAgaWYgKGluZGV4ID49IDApIHsKICAgICAgICAgICAgICAgIGJvdW5kYXJ5TWF0Y2hlcyA9IG1hdGNoZXMuc2xpY2UoMCwgaW5kZXgpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuIGJvdW5kYXJ5TWF0Y2hlczsKICAgICAgICAgIH0KCiAgICAgICAgICBmdW5jdGlvbiBnZXRNYXRjaGVzVG9Mb2FkKHN0YXRlLCBtYXRjaGVzLCBzdWJtaXNzaW9uLCBsb2NhdGlvbiwgaXNSZXZhbGlkYXRpb25SZXF1aXJlZCwgY2FuY2VsbGVkRGVmZXJyZWRSb3V0ZXMsIGNhbmNlbGxlZEZldGNoZXJMb2FkcywgcGVuZGluZ0FjdGlvbkRhdGEsIHBlbmRpbmdFcnJvciwgZmV0Y2hMb2FkTWF0Y2hlcykgewogICAgICAgICAgICB2YXIgYWN0aW9uUmVzdWx0ID0gcGVuZGluZ0Vycm9yID8gT2JqZWN0LnZhbHVlcyhwZW5kaW5nRXJyb3IpWzBdIDogcGVuZGluZ0FjdGlvbkRhdGEgPyBPYmplY3QudmFsdWVzKHBlbmRpbmdBY3Rpb25EYXRhKVswXSA6IG51bGw7IC8vIFBpY2sgbmF2aWdhdGlvbiBtYXRjaGVzIHRoYXQgYXJlIG5ldC1uZXcgb3IgcXVhbGlmeSBmb3IgcmV2YWxpZGF0aW9uCgogICAgICAgICAgICB2YXIgYm91bmRhcnlJZCA9IHBlbmRpbmdFcnJvciA/IE9iamVjdC5rZXlzKHBlbmRpbmdFcnJvcilbMF0gOiB1bmRlZmluZWQ7CiAgICAgICAgICAgIHZhciBib3VuZGFyeU1hdGNoZXMgPSBnZXRMb2FkZXJNYXRjaGVzVW50aWxCb3VuZGFyeShtYXRjaGVzLCBib3VuZGFyeUlkKTsKICAgICAgICAgICAgdmFyIG5hdmlnYXRpb25NYXRjaGVzID0gYm91bmRhcnlNYXRjaGVzLmZpbHRlcigobWF0Y2gsIGluZGV4KSA9PiBtYXRjaC5yb3V0ZS5sb2FkZXIgIT0gbnVsbCAmJiAoaXNOZXdMb2FkZXIoc3RhdGUubG9hZGVyRGF0YSwgc3RhdGUubWF0Y2hlc1tpbmRleF0sIG1hdGNoKSB8fCAvLyBJZiB0aGlzIHJvdXRlIGhhZCBhIHBlbmRpbmcgZGVmZXJyZWQgY2FuY2VsbGVkIGl0IG11c3QgYmUgcmV2YWxpZGF0ZWQKICAgICAgICAgICAgY2FuY2VsbGVkRGVmZXJyZWRSb3V0ZXMuc29tZSgoaWQpID0+IGlkID09PSBtYXRjaC5yb3V0ZS5pZCkgfHwgc2hvdWxkUmV2YWxpZGF0ZUxvYWRlcihzdGF0ZS5sb2NhdGlvbiwgc3RhdGUubWF0Y2hlc1tpbmRleF0sIHN1Ym1pc3Npb24sIGxvY2F0aW9uLCBtYXRjaCwgaXNSZXZhbGlkYXRpb25SZXF1aXJlZCwgYWN0aW9uUmVzdWx0KSkpOyAvLyBQaWNrIGZldGNoZXIubG9hZHMgdGhhdCBuZWVkIHRvIGJlIHJldmFsaWRhdGVkCgogICAgICAgICAgICB2YXIgcmV2YWxpZGF0aW5nRmV0Y2hlcnMgPSBbXTsKICAgICAgICAgICAgZmV0Y2hMb2FkTWF0Y2hlcyAmJiBmZXRjaExvYWRNYXRjaGVzLmZvckVhY2goKF9yZWYxMCwga2V5KSA9PiB7CiAgICAgICAgICAgICAgdmFyIF9yZWYyNCA9IF9zbGljZWRUb0FycmF5MihfcmVmMTAsIDMpLGhyZWYgPSBfcmVmMjRbMF0sbWF0Y2ggPSBfcmVmMjRbMV0sZmV0Y2hNYXRjaGVzID0gX3JlZjI0WzJdOwoKICAgICAgICAgICAgICAvLyBUaGlzIGZldGNoZXIgd2FzIGNhbmNlbGxlZCBmcm9tIGEgcHJpb3IgYWN0aW9uIHN1Ym1pc3Npb24gLSBmb3JjZSByZWxvYWQKICAgICAgICAgICAgICBpZiAoY2FuY2VsbGVkRmV0Y2hlckxvYWRzLmluY2x1ZGVzKGtleSkpIHsKICAgICAgICAgICAgICAgIHJldmFsaWRhdGluZ0ZldGNoZXJzLnB1c2goW2tleSwgaHJlZiwgbWF0Y2gsIGZldGNoTWF0Y2hlc10pOwogICAgICAgICAgICAgIH0gZWxzZSBpZiAoaXNSZXZhbGlkYXRpb25SZXF1aXJlZCkgewogICAgICAgICAgICAgICAgdmFyIHNob3VsZFJldmFsaWRhdGUgPSBzaG91bGRSZXZhbGlkYXRlTG9hZGVyKGhyZWYsIG1hdGNoLCBzdWJtaXNzaW9uLCBocmVmLCBtYXRjaCwgaXNSZXZhbGlkYXRpb25SZXF1aXJlZCwgYWN0aW9uUmVzdWx0KTsKCiAgICAgICAgICAgICAgICBpZiAoc2hvdWxkUmV2YWxpZGF0ZSkgewogICAgICAgICAgICAgICAgICByZXZhbGlkYXRpbmdGZXRjaGVycy5wdXNoKFtrZXksIGhyZWYsIG1hdGNoLCBmZXRjaE1hdGNoZXNdKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICByZXR1cm4gW25hdmlnYXRpb25NYXRjaGVzLCByZXZhbGlkYXRpbmdGZXRjaGVyc107CiAgICAgICAgICB9CgogICAgICAgICAgZnVuY3Rpb24gaXNOZXdMb2FkZXIoY3VycmVudExvYWRlckRhdGEsIGN1cnJlbnRNYXRjaCwgbWF0Y2gpIHsKICAgICAgICAgICAgdmFyIGlzTmV3ID0gLy8gW2FdIC0+IFthLCBiXQogICAgICAgICAgICAhY3VycmVudE1hdGNoIHx8IC8vIFthLCBiXSAtPiBbYSwgY10KICAgICAgICAgICAgbWF0Y2gucm91dGUuaWQgIT09IGN1cnJlbnRNYXRjaC5yb3V0ZS5pZDsgLy8gSGFuZGxlIHRoZSBjYXNlIHRoYXQgd2UgZG9uJ3QgaGF2ZSBkYXRhIGZvciBhIHJlLXVzZWQgcm91dGUsIHBvdGVudGlhbGx5CiAgICAgICAgICAgIC8vIGZyb20gYSBwcmlvciBlcnJvciBvciBmcm9tIGEgY2FuY2VsbGVkIHBlbmRpbmcgZGVmZXJyZWQKCiAgICAgICAgICAgIHZhciBpc01pc3NpbmdEYXRhID0gY3VycmVudExvYWRlckRhdGFbbWF0Y2gucm91dGUuaWRdID09PSB1bmRlZmluZWQ7IC8vIEFsd2F5cyBsb2FkIGlmIHRoaXMgaXMgYSBuZXQtbmV3IHJvdXRlIG9yIHdlIGRvbid0IHlldCBoYXZlIGRhdGEKCiAgICAgICAgICAgIHJldHVybiBpc05ldyB8fCBpc01pc3NpbmdEYXRhOwogICAgICAgICAgfQoKICAgICAgICAgIGZ1bmN0aW9uIGlzTmV3Um91dGVJbnN0YW5jZShjdXJyZW50TWF0Y2gsIG1hdGNoKSB7CiAgICAgICAgICAgIHZhciBjdXJyZW50UGF0aCA9IGN1cnJlbnRNYXRjaC5yb3V0ZS5wYXRoOwogICAgICAgICAgICByZXR1cm4gKC8vIHBhcmFtIGNoYW5nZSBmb3IgdGhpcyBtYXRjaCwgL3VzZXJzLzEyMyAtPiAvdXNlcnMvNDU2CiAgICAgICAgICAgICAgY3VycmVudE1hdGNoLnBhdGhuYW1lICE9PSBtYXRjaC5wYXRobmFtZSB8fCAvLyBzcGxhdCBwYXJhbSBjaGFuZ2VkLCB3aGljaCBpcyBub3QgcHJlc2VudCBpbiBtYXRjaC5wYXRoCiAgICAgICAgICAgICAgLy8gZS5nLiAvZmlsZXMvaW1hZ2VzL2F2YXRhci5qcGcgLT4gZmlsZXMvZmluYW5jZXMueGxzCiAgICAgICAgICAgICAgY3VycmVudFBhdGggJiYgY3VycmVudFBhdGguZW5kc1dpdGgoIioiKSAmJiBjdXJyZW50TWF0Y2gucGFyYW1zWyIqIl0gIT09IG1hdGNoLnBhcmFtc1siKiJdKTsKCiAgICAgICAgICB9CgogICAgICAgICAgZnVuY3Rpb24gc2hvdWxkUmV2YWxpZGF0ZUxvYWRlcihjdXJyZW50TG9jYXRpb24sIGN1cnJlbnRNYXRjaCwgc3VibWlzc2lvbiwgbG9jYXRpb24sIG1hdGNoLCBpc1JldmFsaWRhdGlvblJlcXVpcmVkLCBhY3Rpb25SZXN1bHQpIHsKICAgICAgICAgICAgdmFyIGN1cnJlbnRVcmwgPSBjcmVhdGVVUkwoY3VycmVudExvY2F0aW9uKTsKICAgICAgICAgICAgdmFyIGN1cnJlbnRQYXJhbXMgPSBjdXJyZW50TWF0Y2gucGFyYW1zOwogICAgICAgICAgICB2YXIgbmV4dFVybCA9IGNyZWF0ZVVSTChsb2NhdGlvbik7CiAgICAgICAgICAgIHZhciBuZXh0UGFyYW1zID0gbWF0Y2gucGFyYW1zOyAvLyBUaGlzIGlzIHRoZSBkZWZhdWx0IGltcGxlbWVudGF0aW9uIGFzIHRvIHdoZW4gd2UgcmV2YWxpZGF0ZS4gIElmIHRoZSByb3V0ZQogICAgICAgICAgICAvLyBwcm92aWRlcyBpdCdzIG93biBpbXBsZW1lbnRhdGlvbiwgdGhlbiB3ZSBnaXZlIHRoZW0gZnVsbCBjb250cm9sIGJ1dAogICAgICAgICAgICAvLyBwcm92aWRlIHRoaXMgdmFsdWUgc28gdGhleSBjYW4gbGV2ZXJhZ2UgaXQgaWYgbmVlZGVkIGFmdGVyIHRoZXkgY2hlY2sKICAgICAgICAgICAgLy8gdGhlaXIgb3duIHNwZWNpZmljIHVzZSBjYXNlcwogICAgICAgICAgICAvLyBOb3RlIHRoYXQgZmV0Y2hlcnMgYWx3YXlzIHByb3ZpZGUgdGhlIHNhbWUgY3VycmVudC9uZXh0IGxvY2F0aW9ucyBzbyB0aGUKICAgICAgICAgICAgLy8gVVJMLWJhc2VkIGNoZWNrcyBoZXJlIGRvbid0IGFwcGx5IHRvIGZldGNoZXIgc2hvdWxkUmV2YWxpZGF0ZSBjYWxscwoKICAgICAgICAgICAgdmFyIGRlZmF1bHRTaG91bGRSZXZhbGlkYXRlID0gaXNOZXdSb3V0ZUluc3RhbmNlKGN1cnJlbnRNYXRjaCwgbWF0Y2gpIHx8IC8vIENsaWNrZWQgdGhlIHNhbWUgbGluaywgcmVzdWJtaXR0ZWQgYSBHRVQgZm9ybQogICAgICAgICAgICBjdXJyZW50VXJsLnRvU3RyaW5nKCkgPT09IG5leHRVcmwudG9TdHJpbmcoKSB8fCAvLyBTZWFyY2ggcGFyYW1zIGFmZmVjdCBhbGwgbG9hZGVycwogICAgICAgICAgICBjdXJyZW50VXJsLnNlYXJjaCAhPT0gbmV4dFVybC5zZWFyY2ggfHwgLy8gRm9yY2VkIHJldmFsaWRhdGlvbiBkdWUgdG8gc3VibWlzc2lvbiwgdXNlUmV2YWxpZGF0ZSwgb3IgWC1SZW1peC1SZXZhbGlkYXRlCiAgICAgICAgICAgIGlzUmV2YWxpZGF0aW9uUmVxdWlyZWQ7CgogICAgICAgICAgICBpZiAobWF0Y2gucm91dGUuc2hvdWxkUmV2YWxpZGF0ZSkgewogICAgICAgICAgICAgIHZhciByb3V0ZUNob2ljZSA9IG1hdGNoLnJvdXRlLnNob3VsZFJldmFsaWRhdGUoX2V4dGVuZHMoewogICAgICAgICAgICAgICAgY3VycmVudFVybDogY3VycmVudFVybCwKICAgICAgICAgICAgICAgIGN1cnJlbnRQYXJhbXM6IGN1cnJlbnRQYXJhbXMsCiAgICAgICAgICAgICAgICBuZXh0VXJsOiBuZXh0VXJsLAogICAgICAgICAgICAgICAgbmV4dFBhcmFtczogbmV4dFBhcmFtcwogICAgICAgICAgICAgIH0sIHN1Ym1pc3Npb24sIHsKICAgICAgICAgICAgICAgIGFjdGlvblJlc3VsdDogYWN0aW9uUmVzdWx0LAogICAgICAgICAgICAgICAgZGVmYXVsdFNob3VsZFJldmFsaWRhdGU6IGRlZmF1bHRTaG91bGRSZXZhbGlkYXRlCiAgICAgICAgICAgICAgfSkpOwoKICAgICAgICAgICAgICBpZiAodHlwZW9mIHJvdXRlQ2hvaWNlID09PSAiYm9vbGVhbiIpIHsKICAgICAgICAgICAgICAgIHJldHVybiByb3V0ZUNob2ljZTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybiBkZWZhdWx0U2hvdWxkUmV2YWxpZGF0ZTsKICAgICAgICAgIH1mdW5jdGlvbgoKICAgICAgICAgIGNhbGxMb2FkZXJPckFjdGlvbihfeDU4LCBfeDU5LCBfeDYwLCBfeDYxLCBfeDYyLCBfeDYzLCBfeDY0KSB7cmV0dXJuIF9jYWxsTG9hZGVyT3JBY3Rpb24uYXBwbHkodGhpcywgYXJndW1lbnRzKTt9ZnVuY3Rpb24gX2NhbGxMb2FkZXJPckFjdGlvbigpIHtfY2FsbExvYWRlck9yQWN0aW9uID0gX2FzeW5jVG9HZW5lcmF0b3IyKCAvKiNfX1BVUkVfXyovX3JlZ2VuZXJhdG9yUnVudGltZTIoKS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUxOCh0eXBlLCByZXF1ZXN0LCBtYXRjaCwgbWF0Y2hlcywgYmFzZW5hbWUsIGlzU3RhdGljUmVxdWVzdCwgaXNSb3V0ZVJlcXVlc3QpIHt2YXIgcmVzdWx0VHlwZSwgcmVzdWx0LCByZWplY3QsIGFib3J0UHJvbWlzZSwgb25SZWplY3QsIGhhbmRsZXIsIHN0YXR1cywgbG9jYXRpb24sIGV4dGVybmFsLCBhY3RpdmVNYXRjaGVzLCByb3V0ZVBhdGhuYW1lcywgcmVxdWVzdFBhdGgsIHJlc29sdmVkTG9jYXRpb24sIHBhdGgsIGRhdGEsIGNvbnRlbnRUeXBlO3JldHVybiBfcmVnZW5lcmF0b3JSdW50aW1lMigpLndyYXAoZnVuY3Rpb24gX2NhbGxlZTE4JChfY29udGV4dDE5KSB7d2hpbGUgKDEpIHtzd2l0Y2ggKF9jb250ZXh0MTkucHJldiA9IF9jb250ZXh0MTkubmV4dCkge2Nhc2UgMDoKICAgICAgICAgICAgICAgICAgICAgIGlmIChiYXNlbmFtZSA9PT0gdm9pZCAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGJhc2VuYW1lID0gIi8iOwogICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgIGlmIChpc1N0YXRpY1JlcXVlc3QgPT09IHZvaWQgMCkgewogICAgICAgICAgICAgICAgICAgICAgICBpc1N0YXRpY1JlcXVlc3QgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICBpZiAoaXNSb3V0ZVJlcXVlc3QgPT09IHZvaWQgMCkgewogICAgICAgICAgICAgICAgICAgICAgICBpc1JvdXRlUmVxdWVzdCA9IGZhbHNlOwogICAgICAgICAgICAgICAgICAgICAgfQoKCgoKCiAgICAgICAgICAgICAgICAgICAgICBhYm9ydFByb21pc2UgPSBuZXcgUHJvbWlzZSgoXywgcikgPT4gcmVqZWN0ID0gcik7CgogICAgICAgICAgICAgICAgICAgICAgb25SZWplY3QgPSAoKSA9PiByZWplY3QoKTsKCiAgICAgICAgICAgICAgICAgICAgICByZXF1ZXN0LnNpZ25hbC5hZGRFdmVudExpc3RlbmVyKCJhYm9ydCIsIG9uUmVqZWN0KTtfY29udGV4dDE5LnByZXYgPSA2OwoKCiAgICAgICAgICAgICAgICAgICAgICBoYW5kbGVyID0gbWF0Y2gucm91dGVbdHlwZV07CiAgICAgICAgICAgICAgICAgICAgICByb3V0ZXJfaW52YXJpYW50KGhhbmRsZXIsICJDb3VsZCBub3QgZmluZCB0aGUgIiArIHR5cGUgKyAiIHRvIHJ1biBvbiB0aGUgXCIiICsgbWF0Y2gucm91dGUuaWQgKyAiXCIgcm91dGUiKTtfY29udGV4dDE5Lm5leHQgPSAxMTtyZXR1cm4gKAogICAgICAgICAgICAgICAgICAgICAgICBQcm9taXNlLnJhY2UoW2hhbmRsZXIoewogICAgICAgICAgICAgICAgICAgICAgICAgIHJlcXVlc3Q6IHJlcXVlc3QsCiAgICAgICAgICAgICAgICAgICAgICAgICAgcGFyYW1zOiBtYXRjaC5wYXJhbXMKICAgICAgICAgICAgICAgICAgICAgICAgfSksIGFib3J0UHJvbWlzZV0pKTtjYXNlIDExOnJlc3VsdCA9IF9jb250ZXh0MTkuc2VudDsKICAgICAgICAgICAgICAgICAgICAgIHJvdXRlcl9pbnZhcmlhbnQocmVzdWx0ICE9PSB1bmRlZmluZWQsICJZb3UgZGVmaW5lZCAiICsgKHR5cGUgPT09ICJhY3Rpb24iID8gImFuIGFjdGlvbiIgOiAiYSBsb2FkZXIiKSArICIgZm9yIHJvdXRlICIgKyAoIlwiIiArIG1hdGNoLnJvdXRlLmlkICsgIlwiIGJ1dCBkaWRuJ3QgcmV0dXJuIGFueXRoaW5nIGZyb20geW91ciBgIiArIHR5cGUgKyAiYCAiKSArICJmdW5jdGlvbi4gUGxlYXNlIHJldHVybiBhIHZhbHVlIG9yIGBudWxsYC4iKTtfY29udGV4dDE5Lm5leHQgPSAxOTticmVhaztjYXNlIDE1Ol9jb250ZXh0MTkucHJldiA9IDE1O19jb250ZXh0MTkudDAgPSBfY29udGV4dDE5WyJjYXRjaCJdKDYpOwoKICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdFR5cGUgPSBSZXN1bHRUeXBlLmVycm9yOwogICAgICAgICAgICAgICAgICAgICAgcmVzdWx0ID0gX2NvbnRleHQxOS50MDtjYXNlIDE5Ol9jb250ZXh0MTkucHJldiA9IDE5OwoKICAgICAgICAgICAgICAgICAgICAgIHJlcXVlc3Quc2lnbmFsLnJlbW92ZUV2ZW50TGlzdGVuZXIoImFib3J0Iiwgb25SZWplY3QpO3JldHVybiBfY29udGV4dDE5LmZpbmlzaCgxOSk7Y2FzZSAyMjppZiAoISgKCgogICAgICAgICAgICAgICAgICAgICAgcmVzdWx0IGluc3RhbmNlb2YgUmVzcG9uc2UpKSB7X2NvbnRleHQxOS5uZXh0ID0gNDg7YnJlYWs7fQogICAgICAgICAgICAgICAgICAgICAgc3RhdHVzID0gcmVzdWx0LnN0YXR1czsgLy8gUHJvY2VzcyByZWRpcmVjdHMKICAgICAgICAgICAgICAgICAgICAgIGlmICghCiAgICAgICAgICAgICAgICAgICAgICByZWRpcmVjdFN0YXR1c0NvZGVzLmhhcyhzdGF0dXMpKSB7X2NvbnRleHQxOS5uZXh0ID0gMzM7YnJlYWs7fQogICAgICAgICAgICAgICAgICAgICAgbG9jYXRpb24gPSByZXN1bHQuaGVhZGVycy5nZXQoIkxvY2F0aW9uIik7CiAgICAgICAgICAgICAgICAgICAgICByb3V0ZXJfaW52YXJpYW50KGxvY2F0aW9uLCAiUmVkaXJlY3RzIHJldHVybmVkL3Rocm93biBmcm9tIGxvYWRlcnMvYWN0aW9ucyBtdXN0IGhhdmUgYSBMb2NhdGlvbiBoZWFkZXIiKTsgLy8gQ2hlY2sgaWYgdGhpcyBhbiBleHRlcm5hbCByZWRpcmVjdCB0aGF0IGdvZXMgdG8gYSBuZXcgb3JpZ2luCgogICAgICAgICAgICAgICAgICAgICAgZXh0ZXJuYWwgPSBjcmVhdGVVUkwobG9jYXRpb24pLm9yaWdpbiAhPT0gY3JlYXRlVVJMKCIvIikub3JpZ2luOyAvLyBTdXBwb3J0IHJlbGF0aXZlIHJvdXRpbmcgaW4gaW50ZXJuYWwgcmVkaXJlY3RzCgogICAgICAgICAgICAgICAgICAgICAgaWYgKCFleHRlcm5hbCkgewogICAgICAgICAgICAgICAgICAgICAgICBhY3RpdmVNYXRjaGVzID0gbWF0Y2hlcy5zbGljZSgwLCBtYXRjaGVzLmluZGV4T2YobWF0Y2gpICsgMSk7CiAgICAgICAgICAgICAgICAgICAgICAgIHJvdXRlUGF0aG5hbWVzID0gZ2V0UGF0aENvbnRyaWJ1dGluZ01hdGNoZXMoYWN0aXZlTWF0Y2hlcykubWFwKChtYXRjaCkgPT4gbWF0Y2gucGF0aG5hbWVCYXNlKTsKICAgICAgICAgICAgICAgICAgICAgICAgcmVxdWVzdFBhdGggPSBjcmVhdGVVUkwocmVxdWVzdC51cmwpLnBhdGhuYW1lOwogICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlZExvY2F0aW9uID0gcmVzb2x2ZVRvKGxvY2F0aW9uLCByb3V0ZVBhdGhuYW1lcywgcmVxdWVzdFBhdGgpOwogICAgICAgICAgICAgICAgICAgICAgICByb3V0ZXJfaW52YXJpYW50KHJvdXRlcl9jcmVhdGVQYXRoKHJlc29sdmVkTG9jYXRpb24pLCAiVW5hYmxlIHRvIHJlc29sdmUgcmVkaXJlY3QgbG9jYXRpb246ICIgKyBsb2NhdGlvbik7IC8vIFByZXBlbmQgdGhlIGJhc2VuYW1lIHRvIHRoZSByZWRpcmVjdCBsb2NhdGlvbiBpZiB3ZSBoYXZlIG9uZQoKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGJhc2VuYW1lKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgcGF0aCA9IHJlc29sdmVkTG9jYXRpb24ucGF0aG5hbWU7CiAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZWRMb2NhdGlvbi5wYXRobmFtZSA9IHBhdGggPT09ICIvIiA/IGJhc2VuYW1lIDogcm91dGVyX2pvaW5QYXRocyhbYmFzZW5hbWUsIHBhdGhdKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgbG9jYXRpb24gPSByb3V0ZXJfY3JlYXRlUGF0aChyZXNvbHZlZExvY2F0aW9uKTsKICAgICAgICAgICAgICAgICAgICAgIH0gLy8gRG9uJ3QgcHJvY2VzcyByZWRpcmVjdHMgaW4gdGhlIHJvdXRlciBkdXJpbmcgc3RhdGljIHJlcXVlc3RzIHJlcXVlc3RzLgogICAgICAgICAgICAgICAgICAgICAgLy8gSW5zdGVhZCwgdGhyb3cgdGhlIFJlc3BvbnNlIGFuZCBsZXQgdGhlIHNlcnZlciBoYW5kbGUgaXQgd2l0aCBhbiBIVFRQCiAgICAgICAgICAgICAgICAgICAgICAvLyByZWRpcmVjdC4gIFdlIGFsc28gdXBkYXRlIHRoZSBMb2NhdGlvbiBoZWFkZXIgaW4gcGxhY2UgaW4gdGhpcyBmbG93IHNvCiAgICAgICAgICAgICAgICAgICAgICAvLyBiYXNlbmFtZSBhbmQgcmVsYXRpdmUgcm91dGluZyBpcyB0YWtlbiBpbnRvIGFjY291bnQKICAgICAgICAgICAgICAgICAgICAgIGlmICghCgogICAgICAgICAgICAgICAgICAgICAgaXNTdGF0aWNSZXF1ZXN0KSB7X2NvbnRleHQxOS5uZXh0ID0gMzI7YnJlYWs7fQogICAgICAgICAgICAgICAgICAgICAgcmVzdWx0LmhlYWRlcnMuc2V0KCJMb2NhdGlvbiIsIGxvY2F0aW9uKTt0aHJvdyAoCiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdCk7Y2FzZSAzMjpyZXR1cm4gX2NvbnRleHQxOS5hYnJ1cHQoInJldHVybiIsCgoKICAgICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogUmVzdWx0VHlwZS5yZWRpcmVjdCwKICAgICAgICAgICAgICAgICAgICAgICAgc3RhdHVzOiBzdGF0dXMsCiAgICAgICAgICAgICAgICAgICAgICAgIGxvY2F0aW9uOiBsb2NhdGlvbiwKICAgICAgICAgICAgICAgICAgICAgICAgcmV2YWxpZGF0ZTogcmVzdWx0LmhlYWRlcnMuZ2V0KCJYLVJlbWl4LVJldmFsaWRhdGUiKSAhPT0gbnVsbCwKICAgICAgICAgICAgICAgICAgICAgICAgZXh0ZXJuYWw6IGV4dGVybmFsCiAgICAgICAgICAgICAgICAgICAgICB9KTtjYXNlIDMzOmlmICghCgoKCgoKICAgICAgICAgICAgICAgICAgICAgIGlzUm91dGVSZXF1ZXN0KSB7X2NvbnRleHQxOS5uZXh0ID0gMzU7YnJlYWs7fXRocm93ICgKCiAgICAgICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiByZXN1bHRUeXBlIHx8IFJlc3VsdFR5cGUuZGF0YSwKICAgICAgICAgICAgICAgICAgICAgICAgICByZXNwb25zZTogcmVzdWx0CiAgICAgICAgICAgICAgICAgICAgICAgIH0pO2Nhc2UgMzU6CgoKCiAgICAgICAgICAgICAgICAgICAgICBjb250ZW50VHlwZSA9IHJlc3VsdC5oZWFkZXJzLmdldCgiQ29udGVudC1UeXBlIik7aWYgKCEoCgogICAgICAgICAgICAgICAgICAgICAgY29udGVudFR5cGUgJiYgY29udGVudFR5cGUuc3RhcnRzV2l0aCgiYXBwbGljYXRpb24vanNvbiIpKSkge19jb250ZXh0MTkubmV4dCA9IDQyO2JyZWFrO31fY29udGV4dDE5Lm5leHQgPSAzOTtyZXR1cm4gKAogICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQuanNvbigpKTtjYXNlIDM5OmRhdGEgPSBfY29udGV4dDE5LnNlbnQ7X2NvbnRleHQxOS5uZXh0ID0gNDU7YnJlYWs7Y2FzZSA0MjpfY29udGV4dDE5Lm5leHQgPSA0NDtyZXR1cm4gKAoKICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0LnRleHQoKSk7Y2FzZSA0NDpkYXRhID0gX2NvbnRleHQxOS5zZW50O2Nhc2UgNDU6aWYgKCEoCgoKICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdFR5cGUgPT09IFJlc3VsdFR5cGUuZXJyb3IpKSB7X2NvbnRleHQxOS5uZXh0ID0gNDc7YnJlYWs7fXJldHVybiBfY29udGV4dDE5LmFicnVwdCgicmV0dXJuIiwKICAgICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogcmVzdWx0VHlwZSwKICAgICAgICAgICAgICAgICAgICAgICAgZXJyb3I6IG5ldyByb3V0ZXJfRXJyb3JSZXNwb25zZShzdGF0dXMsIHJlc3VsdC5zdGF0dXNUZXh0LCBkYXRhKSwKICAgICAgICAgICAgICAgICAgICAgICAgaGVhZGVyczogcmVzdWx0LmhlYWRlcnMKICAgICAgICAgICAgICAgICAgICAgIH0pO2Nhc2UgNDc6cmV0dXJuIF9jb250ZXh0MTkuYWJydXB0KCJyZXR1cm4iLAoKCiAgICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6IFJlc3VsdFR5cGUuZGF0YSwKICAgICAgICAgICAgICAgICAgICAgICAgZGF0YTogZGF0YSwKICAgICAgICAgICAgICAgICAgICAgICAgc3RhdHVzQ29kZTogcmVzdWx0LnN0YXR1cywKICAgICAgICAgICAgICAgICAgICAgICAgaGVhZGVyczogcmVzdWx0LmhlYWRlcnMKICAgICAgICAgICAgICAgICAgICAgIH0pO2Nhc2UgNDg6aWYgKCEoCgoKICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdFR5cGUgPT09IFJlc3VsdFR5cGUuZXJyb3IpKSB7X2NvbnRleHQxOS5uZXh0ID0gNTA7YnJlYWs7fXJldHVybiBfY29udGV4dDE5LmFicnVwdCgicmV0dXJuIiwKICAgICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogcmVzdWx0VHlwZSwKICAgICAgICAgICAgICAgICAgICAgICAgZXJyb3I6IHJlc3VsdAogICAgICAgICAgICAgICAgICAgICAgfSk7Y2FzZSA1MDppZiAoISgKCgogICAgICAgICAgICAgICAgICAgICAgcmVzdWx0IGluc3RhbmNlb2YgRGVmZXJyZWREYXRhKSkge19jb250ZXh0MTkubmV4dCA9IDUyO2JyZWFrO31yZXR1cm4gX2NvbnRleHQxOS5hYnJ1cHQoInJldHVybiIsCiAgICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6IFJlc3VsdFR5cGUuZGVmZXJyZWQsCiAgICAgICAgICAgICAgICAgICAgICAgIGRlZmVycmVkRGF0YTogcmVzdWx0CiAgICAgICAgICAgICAgICAgICAgICB9KTtjYXNlIDUyOnJldHVybiBfY29udGV4dDE5LmFicnVwdCgicmV0dXJuIiwKCgogICAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiBSZXN1bHRUeXBlLmRhdGEsCiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGE6IHJlc3VsdAogICAgICAgICAgICAgICAgICAgICAgfSk7Y2FzZSA1MzpjYXNlICJlbmQiOnJldHVybiBfY29udGV4dDE5LnN0b3AoKTt9fX0sIF9jYWxsZWUxOCwgbnVsbCwgW1s2LCAxNSwgMTksIDIyXV0pO30pKTtyZXR1cm4gX2NhbGxMb2FkZXJPckFjdGlvbi5hcHBseSh0aGlzLCBhcmd1bWVudHMpO30KCgogICAgICAgICAgZnVuY3Rpb24gY3JlYXRlUmVxdWVzdChsb2NhdGlvbiwgc2lnbmFsLCBzdWJtaXNzaW9uKSB7CiAgICAgICAgICAgIHZhciB1cmwgPSBjcmVhdGVVUkwoc3RyaXBIYXNoRnJvbVBhdGgobG9jYXRpb24pKS50b1N0cmluZygpOwogICAgICAgICAgICB2YXIgaW5pdCA9IHsKICAgICAgICAgICAgICBzaWduYWw6IHNpZ25hbAogICAgICAgICAgICB9OwoKICAgICAgICAgICAgaWYgKHN1Ym1pc3Npb24pIHsKICAgICAgICAgICAgICB2YXIKICAgICAgICAgICAgICAgIGZvcm1NZXRob2QgPQoKCiAgICAgICAgICAgICAgICBzdWJtaXNzaW9uLmZvcm1NZXRob2QsZm9ybUVuY1R5cGUgPSBzdWJtaXNzaW9uLmZvcm1FbmNUeXBlLGZvcm1EYXRhID0gc3VibWlzc2lvbi5mb3JtRGF0YTsKICAgICAgICAgICAgICBpbml0Lm1ldGhvZCA9IGZvcm1NZXRob2QudG9VcHBlckNhc2UoKTsKICAgICAgICAgICAgICBpbml0LmJvZHkgPSBmb3JtRW5jVHlwZSA9PT0gImFwcGxpY2F0aW9uL3gtd3d3LWZvcm0tdXJsZW5jb2RlZCIgPyBjb252ZXJ0Rm9ybURhdGFUb1NlYXJjaFBhcmFtcyhmb3JtRGF0YSkgOiBmb3JtRGF0YTsKICAgICAgICAgICAgfSAvLyBDb250ZW50LVR5cGUgaXMgaW5mZXJyZWQgKGh0dHBzOi8vZmV0Y2guc3BlYy53aGF0d2cub3JnLyNkb20tcmVxdWVzdCkKCgogICAgICAgICAgICByZXR1cm4gbmV3IFJlcXVlc3QodXJsLCBpbml0KTsKICAgICAgICAgIH0KCiAgICAgICAgICBmdW5jdGlvbiBjb252ZXJ0Rm9ybURhdGFUb1NlYXJjaFBhcmFtcyhmb3JtRGF0YSkgewogICAgICAgICAgICB2YXIgc2VhcmNoUGFyYW1zID0gbmV3IFVSTFNlYXJjaFBhcmFtcygpO3ZhciBfaXRlcmF0b3I2ID0gX2NyZWF0ZUZvck9mSXRlcmF0b3JIZWxwZXIyKAoKICAgICAgICAgICAgICBmb3JtRGF0YS5lbnRyaWVzKCkpLF9zdGVwNjt0cnkge2ZvciAoX2l0ZXJhdG9yNi5zKCk7ICEoX3N0ZXA2ID0gX2l0ZXJhdG9yNi5uKCkpLmRvbmU7KSB7dmFyIF9zdGVwNiR2YWx1ZSA9IF9zbGljZWRUb0FycmF5Mihfc3RlcDYudmFsdWUsIDIpLGtleSA9IF9zdGVwNiR2YWx1ZVswXSx2YWx1ZSA9IF9zdGVwNiR2YWx1ZVsxXTsKICAgICAgICAgICAgICAgIHJvdXRlcl9pbnZhcmlhbnQodHlwZW9mIHZhbHVlID09PSAic3RyaW5nIiwgJ0ZpbGUgaW5wdXRzIGFyZSBub3Qgc3VwcG9ydGVkIHdpdGggZW5jVHlwZSAiYXBwbGljYXRpb24veC13d3ctZm9ybS11cmxlbmNvZGVkIiwgJyArICdwbGVhc2UgdXNlICJtdWx0aXBhcnQvZm9ybS1kYXRhIiBpbnN0ZWFkLicpOwogICAgICAgICAgICAgICAgc2VhcmNoUGFyYW1zLmFwcGVuZChrZXksIHZhbHVlKTsKICAgICAgICAgICAgICB9fSBjYXRjaCAoZXJyKSB7X2l0ZXJhdG9yNi5lKGVycik7fSBmaW5hbGx5IHtfaXRlcmF0b3I2LmYoKTt9CgogICAgICAgICAgICByZXR1cm4gc2VhcmNoUGFyYW1zOwogICAgICAgICAgfQoKICAgICAgICAgIGZ1bmN0aW9uIHByb2Nlc3NSb3V0ZUxvYWRlckRhdGEobWF0Y2hlcywgbWF0Y2hlc1RvTG9hZCwgcmVzdWx0cywgcGVuZGluZ0Vycm9yLCBhY3RpdmVEZWZlcnJlZHMpIHsKICAgICAgICAgICAgLy8gRmlsbCBpbiBsb2FkZXJEYXRhL2Vycm9ycyBmcm9tIG91ciBsb2FkZXJzCiAgICAgICAgICAgIHZhciBsb2FkZXJEYXRhID0ge307CiAgICAgICAgICAgIHZhciBlcnJvcnMgPSBudWxsOwogICAgICAgICAgICB2YXIgc3RhdHVzQ29kZTsKICAgICAgICAgICAgdmFyIGZvdW5kRXJyb3IgPSBmYWxzZTsKICAgICAgICAgICAgdmFyIGxvYWRlckhlYWRlcnMgPSB7fTsgLy8gUHJvY2VzcyBsb2FkZXIgcmVzdWx0cyBpbnRvIHN0YXRlLmxvYWRlckRhdGEvc3RhdGUuZXJyb3JzCgogICAgICAgICAgICByZXN1bHRzLmZvckVhY2goKHJlc3VsdCwgaW5kZXgpID0+IHsKICAgICAgICAgICAgICB2YXIgaWQgPSBtYXRjaGVzVG9Mb2FkW2luZGV4XS5yb3V0ZS5pZDsKICAgICAgICAgICAgICByb3V0ZXJfaW52YXJpYW50KCFpc1JlZGlyZWN0UmVzdWx0KHJlc3VsdCksICJDYW5ub3QgaGFuZGxlIHJlZGlyZWN0IHJlc3VsdHMgaW4gcHJvY2Vzc0xvYWRlckRhdGEiKTsKCiAgICAgICAgICAgICAgaWYgKGlzRXJyb3JSZXN1bHQocmVzdWx0KSkgewogICAgICAgICAgICAgICAgLy8gTG9vayB1cHdhcmRzIGZyb20gdGhlIG1hdGNoZWQgcm91dGUgZm9yIHRoZSBjbG9zZXN0IGFuY2VzdG9yCiAgICAgICAgICAgICAgICAvLyBlcnJvciBib3VuZGFyeSwgZGVmYXVsdGluZyB0byB0aGUgcm9vdCBtYXRjaAogICAgICAgICAgICAgICAgdmFyIGJvdW5kYXJ5TWF0Y2ggPSBmaW5kTmVhcmVzdEJvdW5kYXJ5KG1hdGNoZXMsIGlkKTsKICAgICAgICAgICAgICAgIHZhciBlcnJvciA9IHJlc3VsdC5lcnJvcjsgLy8gSWYgd2UgaGF2ZSBhIHBlbmRpbmcgYWN0aW9uIGVycm9yLCB3ZSByZXBvcnQgaXQgYXQgdGhlIGhpZ2hlc3Qtcm91dGUKICAgICAgICAgICAgICAgIC8vIHRoYXQgdGhyb3dzIGEgbG9hZGVyIGVycm9yLCBhbmQgdGhlbiBjbGVhciBpdCBvdXQgdG8gaW5kaWNhdGUgdGhhdAogICAgICAgICAgICAgICAgLy8gaXQgd2FzIGNvbnN1bWVkCgogICAgICAgICAgICAgICAgaWYgKHBlbmRpbmdFcnJvcikgewogICAgICAgICAgICAgICAgICBlcnJvciA9IE9iamVjdC52YWx1ZXMocGVuZGluZ0Vycm9yKVswXTsKICAgICAgICAgICAgICAgICAgcGVuZGluZ0Vycm9yID0gdW5kZWZpbmVkOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGVycm9ycyA9IE9iamVjdC5hc3NpZ24oZXJyb3JzIHx8IHt9LCBfZGVmaW5lUHJvcGVydHkyKHt9LAogICAgICAgICAgICAgICAgYm91bmRhcnlNYXRjaC5yb3V0ZS5pZCwgZXJyb3IpKTsKICAgICAgICAgICAgICAgIC8vIE9uY2Ugd2UgZmluZCBvdXIgZmlyc3QgKGhpZ2hlc3QpIGVycm9yLCB3ZSBzZXQgdGhlIHN0YXR1cyBjb2RlIGFuZAogICAgICAgICAgICAgICAgLy8gcHJldmVudCBkZWVwZXIgc3RhdHVzIGNvZGVzIGZyb20gb3ZlcnJpZGluZwoKICAgICAgICAgICAgICAgIGlmICghZm91bmRFcnJvcikgewogICAgICAgICAgICAgICAgICBmb3VuZEVycm9yID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgc3RhdHVzQ29kZSA9IGlzUm91dGVFcnJvclJlc3BvbnNlKHJlc3VsdC5lcnJvcikgPyByZXN1bHQuZXJyb3Iuc3RhdHVzIDogNTAwOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGlmIChyZXN1bHQuaGVhZGVycykgewogICAgICAgICAgICAgICAgICBsb2FkZXJIZWFkZXJzW2lkXSA9IHJlc3VsdC5oZWFkZXJzOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0gZWxzZSBpZiAoaXNEZWZlcnJlZFJlc3VsdChyZXN1bHQpKSB7CiAgICAgICAgICAgICAgICBhY3RpdmVEZWZlcnJlZHMgJiYgYWN0aXZlRGVmZXJyZWRzLnNldChpZCwgcmVzdWx0LmRlZmVycmVkRGF0YSk7CiAgICAgICAgICAgICAgICBsb2FkZXJEYXRhW2lkXSA9IHJlc3VsdC5kZWZlcnJlZERhdGEuZGF0YTsgLy8gVE9ETzogQWRkIHN0YXR1c0NvZGUvaGVhZGVycyBvbmNlIHdlIHdpcmUgdXAgc3RyZWFtaW5nIGluIFJlbWl4CiAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGxvYWRlckRhdGFbaWRdID0gcmVzdWx0LmRhdGE7IC8vIEVycm9yIHN0YXR1cyBjb2RlcyBhbHdheXMgb3ZlcnJpZGUgc3VjY2VzcyBzdGF0dXMgY29kZXMsIGJ1dCBpZiBhbGwKICAgICAgICAgICAgICAgIC8vIGxvYWRlcnMgYXJlIHN1Y2Nlc3NmdWwgd2UgdGFrZSB0aGUgZGVlcGVzdCBzdGF0dXMgY29kZS4KCiAgICAgICAgICAgICAgICBpZiAocmVzdWx0LnN0YXR1c0NvZGUgIT0gbnVsbCAmJiByZXN1bHQuc3RhdHVzQ29kZSAhPT0gMjAwICYmICFmb3VuZEVycm9yKSB7CiAgICAgICAgICAgICAgICAgIHN0YXR1c0NvZGUgPSByZXN1bHQuc3RhdHVzQ29kZTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBpZiAocmVzdWx0LmhlYWRlcnMpIHsKICAgICAgICAgICAgICAgICAgbG9hZGVySGVhZGVyc1tpZF0gPSByZXN1bHQuaGVhZGVyczsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOyAvLyBJZiB3ZSBkaWRuJ3QgY29uc3VtZSB0aGUgcGVuZGluZyBhY3Rpb24gZXJyb3IgKGkuZS4sIGFsbCBsb2FkZXJzCiAgICAgICAgICAgIC8vIHJlc29sdmVkKSwgdGhlbiBjb25zdW1lIGl0IGhlcmUKCiAgICAgICAgICAgIGlmIChwZW5kaW5nRXJyb3IpIHsKICAgICAgICAgICAgICBlcnJvcnMgPSBwZW5kaW5nRXJyb3I7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgbG9hZGVyRGF0YTogbG9hZGVyRGF0YSwKICAgICAgICAgICAgICBlcnJvcnM6IGVycm9ycywKICAgICAgICAgICAgICBzdGF0dXNDb2RlOiBzdGF0dXNDb2RlIHx8IDIwMCwKICAgICAgICAgICAgICBsb2FkZXJIZWFkZXJzOiBsb2FkZXJIZWFkZXJzCiAgICAgICAgICAgIH07CiAgICAgICAgICB9CgogICAgICAgICAgZnVuY3Rpb24gcHJvY2Vzc0xvYWRlckRhdGEoc3RhdGUsIG1hdGNoZXMsIG1hdGNoZXNUb0xvYWQsIHJlc3VsdHMsIHBlbmRpbmdFcnJvciwgcmV2YWxpZGF0aW5nRmV0Y2hlcnMsIGZldGNoZXJSZXN1bHRzLCBhY3RpdmVEZWZlcnJlZHMpIHsKICAgICAgICAgICAgdmFyIF9wcm9jZXNzUm91dGVMb2FkZXJEYSA9CgoKICAgICAgICAgICAgICBwcm9jZXNzUm91dGVMb2FkZXJEYXRhKG1hdGNoZXMsIG1hdGNoZXNUb0xvYWQsIHJlc3VsdHMsIHBlbmRpbmdFcnJvciwgYWN0aXZlRGVmZXJyZWRzKSxsb2FkZXJEYXRhID0gX3Byb2Nlc3NSb3V0ZUxvYWRlckRhLmxvYWRlckRhdGEsZXJyb3JzID0gX3Byb2Nlc3NSb3V0ZUxvYWRlckRhLmVycm9yczsgLy8gUHJvY2VzcyByZXN1bHRzIGZyb20gb3VyIHJldmFsaWRhdGluZyBmZXRjaGVycwoKICAgICAgICAgICAgZm9yICh2YXIgaW5kZXggPSAwOyBpbmRleCA8IHJldmFsaWRhdGluZ0ZldGNoZXJzLmxlbmd0aDsgaW5kZXgrKykgewogICAgICAgICAgICAgIHZhciBfcmV2YWxpZGF0aW5nRmV0Y2hlcnMgPSBfc2xpY2VkVG9BcnJheTIocmV2YWxpZGF0aW5nRmV0Y2hlcnNbaW5kZXhdLCAzKSxrZXkgPSBfcmV2YWxpZGF0aW5nRmV0Y2hlcnNbMF0sbWF0Y2ggPSBfcmV2YWxpZGF0aW5nRmV0Y2hlcnNbMl07CiAgICAgICAgICAgICAgcm91dGVyX2ludmFyaWFudChmZXRjaGVyUmVzdWx0cyAhPT0gdW5kZWZpbmVkICYmIGZldGNoZXJSZXN1bHRzW2luZGV4XSAhPT0gdW5kZWZpbmVkLCAiRGlkIG5vdCBmaW5kIGNvcnJlc3BvbmRpbmcgZmV0Y2hlciByZXN1bHQiKTsKICAgICAgICAgICAgICB2YXIgcmVzdWx0ID0gZmV0Y2hlclJlc3VsdHNbaW5kZXhdOyAvLyBQcm9jZXNzIGZldGNoZXIgbm9uLXJlZGlyZWN0IGVycm9ycwoKICAgICAgICAgICAgICBpZiAoaXNFcnJvclJlc3VsdChyZXN1bHQpKSB7CiAgICAgICAgICAgICAgICB2YXIgYm91bmRhcnlNYXRjaCA9IGZpbmROZWFyZXN0Qm91bmRhcnkoc3RhdGUubWF0Y2hlcywgbWF0Y2gucm91dGUuaWQpOwoKICAgICAgICAgICAgICAgIGlmICghKGVycm9ycyAmJiBlcnJvcnNbYm91bmRhcnlNYXRjaC5yb3V0ZS5pZF0pKSB7CiAgICAgICAgICAgICAgICAgIGVycm9ycyA9IF9leHRlbmRzKHt9LCBlcnJvcnMsIF9kZWZpbmVQcm9wZXJ0eTIoe30sCiAgICAgICAgICAgICAgICAgIGJvdW5kYXJ5TWF0Y2gucm91dGUuaWQsIHJlc3VsdC5lcnJvcikpOwoKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBzdGF0ZS5mZXRjaGVycy5kZWxldGUoa2V5KTsKICAgICAgICAgICAgICB9IGVsc2UgaWYgKGlzUmVkaXJlY3RSZXN1bHQocmVzdWx0KSkgewogICAgICAgICAgICAgICAgLy8gU2hvdWxkIG5ldmVyIGdldCBoZXJlLCByZWRpcmVjdHMgc2hvdWxkIGdldCBwcm9jZXNzZWQgYWJvdmUsIGJ1dCB3ZQogICAgICAgICAgICAgICAgLy8ga2VlcCB0aGlzIHRvIHR5cGUgbmFycm93IHRvIGEgc3VjY2VzcyByZXN1bHQgaW4gdGhlIGVsc2UKICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiVW5oYW5kbGVkIGZldGNoZXIgcmV2YWxpZGF0aW9uIHJlZGlyZWN0Iik7CiAgICAgICAgICAgICAgfSBlbHNlIGlmIChpc0RlZmVycmVkUmVzdWx0KHJlc3VsdCkpIHsKICAgICAgICAgICAgICAgIC8vIFNob3VsZCBuZXZlciBnZXQgaGVyZSwgZGVmZXJyZWQgZGF0YSBzaG91bGQgYmUgYXdhaXRlZCBmb3IgZmV0Y2hlcnMKICAgICAgICAgICAgICAgIC8vIGluIHJlc29sdmVEZWZlcnJlZFJlc3VsdHMKICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiVW5oYW5kbGVkIGZldGNoZXIgZGVmZXJyZWQgZGF0YSIpOwogICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICB2YXIgZG9uZUZldGNoZXIgPSB7CiAgICAgICAgICAgICAgICAgIHN0YXRlOiAiaWRsZSIsCiAgICAgICAgICAgICAgICAgIGRhdGE6IHJlc3VsdC5kYXRhLAogICAgICAgICAgICAgICAgICBmb3JtTWV0aG9kOiB1bmRlZmluZWQsCiAgICAgICAgICAgICAgICAgIGZvcm1BY3Rpb246IHVuZGVmaW5lZCwKICAgICAgICAgICAgICAgICAgZm9ybUVuY1R5cGU6IHVuZGVmaW5lZCwKICAgICAgICAgICAgICAgICAgZm9ybURhdGE6IHVuZGVmaW5lZAogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgIHN0YXRlLmZldGNoZXJzLnNldChrZXksIGRvbmVGZXRjaGVyKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgbG9hZGVyRGF0YTogbG9hZGVyRGF0YSwKICAgICAgICAgICAgICBlcnJvcnM6IGVycm9ycwogICAgICAgICAgICB9OwogICAgICAgICAgfQoKICAgICAgICAgIGZ1bmN0aW9uIG1lcmdlTG9hZGVyRGF0YShsb2FkZXJEYXRhLCBuZXdMb2FkZXJEYXRhLCBtYXRjaGVzKSB7CiAgICAgICAgICAgIHZhciBtZXJnZWRMb2FkZXJEYXRhID0gX2V4dGVuZHMoe30sIG5ld0xvYWRlckRhdGEpOwoKICAgICAgICAgICAgbWF0Y2hlcy5mb3JFYWNoKChtYXRjaCkgPT4gewogICAgICAgICAgICAgIHZhciBpZCA9IG1hdGNoLnJvdXRlLmlkOwoKICAgICAgICAgICAgICBpZiAobmV3TG9hZGVyRGF0YVtpZF0gPT09IHVuZGVmaW5lZCAmJiBsb2FkZXJEYXRhW2lkXSAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgICAgICBtZXJnZWRMb2FkZXJEYXRhW2lkXSA9IGxvYWRlckRhdGFbaWRdOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIHJldHVybiBtZXJnZWRMb2FkZXJEYXRhOwogICAgICAgICAgfSAvLyBGaW5kIHRoZSBuZWFyZXN0IGVycm9yIGJvdW5kYXJ5LCBsb29raW5nIHVwd2FyZHMgZnJvbSB0aGUgbGVhZiByb3V0ZSAob3IgdGhlCiAgICAgICAgICAvLyByb3V0ZSBzcGVjaWZpZWQgYnkgcm91dGVJZCkgZm9yIHRoZSBjbG9zZXN0IGFuY2VzdG9yIGVycm9yIGJvdW5kYXJ5LAogICAgICAgICAgLy8gZGVmYXVsdGluZyB0byB0aGUgcm9vdCBtYXRjaAoKCiAgICAgICAgICBmdW5jdGlvbiBmaW5kTmVhcmVzdEJvdW5kYXJ5KG1hdGNoZXMsIHJvdXRlSWQpIHsKICAgICAgICAgICAgdmFyIGVsaWdpYmxlTWF0Y2hlcyA9IHJvdXRlSWQgPyBtYXRjaGVzLnNsaWNlKDAsIG1hdGNoZXMuZmluZEluZGV4KChtKSA9PiBtLnJvdXRlLmlkID09PSByb3V0ZUlkKSArIDEpIDogX3RvQ29uc3VtYWJsZUFycmF5MihtYXRjaGVzKTsKICAgICAgICAgICAgcmV0dXJuIGVsaWdpYmxlTWF0Y2hlcy5yZXZlcnNlKCkuZmluZCgobSkgPT4gbS5yb3V0ZS5oYXNFcnJvckJvdW5kYXJ5ID09PSB0cnVlKSB8fCBtYXRjaGVzWzBdOwogICAgICAgICAgfQoKICAgICAgICAgIGZ1bmN0aW9uIGdldFNob3J0Q2lyY3VpdE1hdGNoZXMocm91dGVzKSB7CiAgICAgICAgICAgIC8vIFByZWZlciBhIHJvb3QgbGF5b3V0IHJvdXRlIGlmIHByZXNlbnQsIG90aGVyd2lzZSBzaGltIGluIGEgcm91dGUgb2JqZWN0CiAgICAgICAgICAgIHZhciByb3V0ZSA9IHJvdXRlcy5maW5kKChyKSA9PiByLmluZGV4IHx8ICFyLnBhdGggfHwgci5wYXRoID09PSAiLyIpIHx8IHsKICAgICAgICAgICAgICBpZDogIl9fc2hpbS1lcnJvci1yb3V0ZV9fIgogICAgICAgICAgICB9OwogICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgIG1hdGNoZXM6IFt7CiAgICAgICAgICAgICAgICBwYXJhbXM6IHt9LAogICAgICAgICAgICAgICAgcGF0aG5hbWU6ICIiLAogICAgICAgICAgICAgICAgcGF0aG5hbWVCYXNlOiAiIiwKICAgICAgICAgICAgICAgIHJvdXRlOiByb3V0ZQogICAgICAgICAgICAgIH1dLAogICAgICAgICAgICAgIHJvdXRlOiByb3V0ZQogICAgICAgICAgICB9OwogICAgICAgICAgfQoKICAgICAgICAgIGZ1bmN0aW9uIGdldEludGVybmFsUm91dGVyRXJyb3Ioc3RhdHVzLCBfdGVtcCkgewogICAgICAgICAgICB2YXIgX3JlZjI1ID0KCgoKCiAgICAgICAgICAgICAgX3RlbXAgPT09IHZvaWQgMCA/IHt9IDogX3RlbXAscGF0aG5hbWUgPSBfcmVmMjUucGF0aG5hbWUscm91dGVJZCA9IF9yZWYyNS5yb3V0ZUlkLG1ldGhvZCA9IF9yZWYyNS5tZXRob2QsbWVzc2FnZSA9IF9yZWYyNS5tZXNzYWdlOwogICAgICAgICAgICB2YXIgc3RhdHVzVGV4dCA9ICJVbmtub3duIFNlcnZlciBFcnJvciI7CiAgICAgICAgICAgIHZhciBlcnJvck1lc3NhZ2UgPSAiVW5rbm93biBAcmVtaXgtcnVuL3JvdXRlciBlcnJvciI7CgogICAgICAgICAgICBpZiAoc3RhdHVzID09PSA0MDApIHsKICAgICAgICAgICAgICBzdGF0dXNUZXh0ID0gIkJhZCBSZXF1ZXN0IjsKCiAgICAgICAgICAgICAgaWYgKG1ldGhvZCAmJiBwYXRobmFtZSAmJiByb3V0ZUlkKSB7CiAgICAgICAgICAgICAgICBlcnJvck1lc3NhZ2UgPSAiWW91IG1hZGUgYSAiICsgbWV0aG9kICsgIiByZXF1ZXN0IHRvIFwiIiArIHBhdGhuYW1lICsgIlwiIGJ1dCAiICsgKCJkaWQgbm90IHByb3ZpZGUgYSBgbG9hZGVyYCBmb3Igcm91dGUgXCIiICsgcm91dGVJZCArICJcIiwgIikgKyAic28gdGhlcmUgaXMgbm8gd2F5IHRvIGhhbmRsZSB0aGUgcmVxdWVzdC4iOwogICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBlcnJvck1lc3NhZ2UgPSAiQ2Fubm90IHN1Ym1pdCBiaW5hcnkgZm9ybSBkYXRhIHVzaW5nIEdFVCI7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2UgaWYgKHN0YXR1cyA9PT0gNDAzKSB7CiAgICAgICAgICAgICAgc3RhdHVzVGV4dCA9ICJGb3JiaWRkZW4iOwogICAgICAgICAgICAgIGVycm9yTWVzc2FnZSA9ICJSb3V0ZSBcIiIgKyByb3V0ZUlkICsgIlwiIGRvZXMgbm90IG1hdGNoIFVSTCBcIiIgKyBwYXRobmFtZSArICJcIiI7CiAgICAgICAgICAgIH0gZWxzZSBpZiAoc3RhdHVzID09PSA0MDQpIHsKICAgICAgICAgICAgICBzdGF0dXNUZXh0ID0gIk5vdCBGb3VuZCI7CiAgICAgICAgICAgICAgZXJyb3JNZXNzYWdlID0gIk5vIHJvdXRlIG1hdGNoZXMgVVJMIFwiIiArIHBhdGhuYW1lICsgIlwiIjsKICAgICAgICAgICAgfSBlbHNlIGlmIChzdGF0dXMgPT09IDQwNSkgewogICAgICAgICAgICAgIHN0YXR1c1RleHQgPSAiTWV0aG9kIE5vdCBBbGxvd2VkIjsKCiAgICAgICAgICAgICAgaWYgKG1ldGhvZCAmJiBwYXRobmFtZSAmJiByb3V0ZUlkKSB7CiAgICAgICAgICAgICAgICBlcnJvck1lc3NhZ2UgPSAiWW91IG1hZGUgYSAiICsgbWV0aG9kLnRvVXBwZXJDYXNlKCkgKyAiIHJlcXVlc3QgdG8gXCIiICsgcGF0aG5hbWUgKyAiXCIgYnV0ICIgKyAoImRpZCBub3QgcHJvdmlkZSBhbiBgYWN0aW9uYCBmb3Igcm91dGUgXCIiICsgcm91dGVJZCArICJcIiwgIikgKyAic28gdGhlcmUgaXMgbm8gd2F5IHRvIGhhbmRsZSB0aGUgcmVxdWVzdC4iOwogICAgICAgICAgICAgIH0gZWxzZSBpZiAobWV0aG9kKSB7CiAgICAgICAgICAgICAgICBlcnJvck1lc3NhZ2UgPSAiSW52YWxpZCByZXF1ZXN0IG1ldGhvZCBcIiIgKyBtZXRob2QudG9VcHBlckNhc2UoKSArICJcIiI7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICByZXR1cm4gbmV3IHJvdXRlcl9FcnJvclJlc3BvbnNlKHN0YXR1cyB8fCA1MDAsIHN0YXR1c1RleHQsIG5ldyBFcnJvcihlcnJvck1lc3NhZ2UpLCB0cnVlKTsKICAgICAgICAgIH0gLy8gRmluZCBhbnkgcmV0dXJuZWQgcmVkaXJlY3QgZXJyb3JzLCBzdGFydGluZyBmcm9tIHRoZSBsb3dlc3QgbWF0Y2gKCgogICAgICAgICAgZnVuY3Rpb24gZmluZFJlZGlyZWN0KHJlc3VsdHMpIHsKICAgICAgICAgICAgZm9yICh2YXIgaSA9IHJlc3VsdHMubGVuZ3RoIC0gMTsgaSA+PSAwOyBpLS0pIHsKICAgICAgICAgICAgICB2YXIgcmVzdWx0ID0gcmVzdWx0c1tpXTsKCiAgICAgICAgICAgICAgaWYgKGlzUmVkaXJlY3RSZXN1bHQocmVzdWx0KSkgewogICAgICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KCiAgICAgICAgICBmdW5jdGlvbiBzdHJpcEhhc2hGcm9tUGF0aChwYXRoKSB7CiAgICAgICAgICAgIHZhciBwYXJzZWRQYXRoID0gdHlwZW9mIHBhdGggPT09ICJzdHJpbmciID8gcGFyc2VQYXRoKHBhdGgpIDogcGF0aDsKICAgICAgICAgICAgcmV0dXJuIHJvdXRlcl9jcmVhdGVQYXRoKF9leHRlbmRzKHt9LCBwYXJzZWRQYXRoLCB7CiAgICAgICAgICAgICAgaGFzaDogIiIKICAgICAgICAgICAgfSkpOwogICAgICAgICAgfQoKICAgICAgICAgIGZ1bmN0aW9uIGlzSGFzaENoYW5nZU9ubHkoYSwgYikgewogICAgICAgICAgICByZXR1cm4gYS5wYXRobmFtZSA9PT0gYi5wYXRobmFtZSAmJiBhLnNlYXJjaCA9PT0gYi5zZWFyY2ggJiYgYS5oYXNoICE9PSBiLmhhc2g7CiAgICAgICAgICB9CgogICAgICAgICAgZnVuY3Rpb24gaXNEZWZlcnJlZFJlc3VsdChyZXN1bHQpIHsKICAgICAgICAgICAgcmV0dXJuIHJlc3VsdC50eXBlID09PSBSZXN1bHRUeXBlLmRlZmVycmVkOwogICAgICAgICAgfQoKICAgICAgICAgIGZ1bmN0aW9uIGlzRXJyb3JSZXN1bHQocmVzdWx0KSB7CiAgICAgICAgICAgIHJldHVybiByZXN1bHQudHlwZSA9PT0gUmVzdWx0VHlwZS5lcnJvcjsKICAgICAgICAgIH0KCiAgICAgICAgICBmdW5jdGlvbiBpc1JlZGlyZWN0UmVzdWx0KHJlc3VsdCkgewogICAgICAgICAgICByZXR1cm4gKHJlc3VsdCAmJiByZXN1bHQudHlwZSkgPT09IFJlc3VsdFR5cGUucmVkaXJlY3Q7CiAgICAgICAgICB9CgogICAgICAgICAgZnVuY3Rpb24gaXNSZWRpcmVjdFJlc3BvbnNlKHJlc3VsdCkgewogICAgICAgICAgICBpZiAoIShyZXN1bHQgaW5zdGFuY2VvZiBSZXNwb25zZSkpIHsKICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHZhciBzdGF0dXMgPSByZXN1bHQuc3RhdHVzOwogICAgICAgICAgICB2YXIgbG9jYXRpb24gPSByZXN1bHQuaGVhZGVycy5nZXQoIkxvY2F0aW9uIik7CiAgICAgICAgICAgIHJldHVybiBzdGF0dXMgPj0gMzAwICYmIHN0YXR1cyA8PSAzOTkgJiYgbG9jYXRpb24gIT0gbnVsbDsKICAgICAgICAgIH0KCiAgICAgICAgICBmdW5jdGlvbiBpc1F1ZXJ5Um91dGVSZXNwb25zZShvYmopIHsKICAgICAgICAgICAgcmV0dXJuIG9iaiAmJiBvYmoucmVzcG9uc2UgaW5zdGFuY2VvZiBSZXNwb25zZSAmJiAob2JqLnR5cGUgPT09IFJlc3VsdFR5cGUuZGF0YSB8fCBSZXN1bHRUeXBlLmVycm9yKTsKICAgICAgICAgIH0KCiAgICAgICAgICBmdW5jdGlvbiBpc1ZhbGlkTWV0aG9kKG1ldGhvZCkgewogICAgICAgICAgICByZXR1cm4gdmFsaWRSZXF1ZXN0TWV0aG9kcy5oYXMobWV0aG9kKTsKICAgICAgICAgIH0KCiAgICAgICAgICBmdW5jdGlvbiBpc1N1Ym1pc3Npb25NZXRob2QobWV0aG9kKSB7CiAgICAgICAgICAgIHJldHVybiB2YWxpZEFjdGlvbk1ldGhvZHMuaGFzKG1ldGhvZCk7CiAgICAgICAgICB9ZnVuY3Rpb24KCiAgICAgICAgICByZXNvbHZlRGVmZXJyZWRSZXN1bHRzKF94NjUsIF94NjYsIF94NjcsIF94NjgsIF94NjksIF94NzApIHtyZXR1cm4gX3Jlc29sdmVEZWZlcnJlZFJlc3VsdHMuYXBwbHkodGhpcywgYXJndW1lbnRzKTt9ZnVuY3Rpb24gX3Jlc29sdmVEZWZlcnJlZFJlc3VsdHMoKSB7X3Jlc29sdmVEZWZlcnJlZFJlc3VsdHMgPSBfYXN5bmNUb0dlbmVyYXRvcjIoIC8qI19fUFVSRV9fKi9fcmVnZW5lcmF0b3JSdW50aW1lMigpLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTE5KGN1cnJlbnRNYXRjaGVzLCBtYXRjaGVzVG9Mb2FkLCByZXN1bHRzLCBzaWduYWwsIGlzRmV0Y2hlciwgY3VycmVudExvYWRlckRhdGEpIHt2YXIgX2xvb3AyLCBpbmRleDtyZXR1cm4gX3JlZ2VuZXJhdG9yUnVudGltZTIoKS53cmFwKGZ1bmN0aW9uIF9jYWxsZWUxOSQoX2NvbnRleHQyMSkge3doaWxlICgxKSB7c3dpdGNoIChfY29udGV4dDIxLnByZXYgPSBfY29udGV4dDIxLm5leHQpIHtjYXNlIDA6X2xvb3AyID0gLyojX19QVVJFX18qL19yZWdlbmVyYXRvclJ1bnRpbWUyKCkubWFyayhmdW5jdGlvbiBfbG9vcDIoCiAgICAgICAgICAgICAgICAgICAgICBpbmRleCkge3ZhciByZXN1bHQsIG1hdGNoLCBjdXJyZW50TWF0Y2gsIGlzUmV2YWxpZGF0aW5nTG9hZGVyO3JldHVybiBfcmVnZW5lcmF0b3JSdW50aW1lMigpLndyYXAoZnVuY3Rpb24gX2xvb3AyJChfY29udGV4dDIwKSB7d2hpbGUgKDEpIHtzd2l0Y2ggKF9jb250ZXh0MjAucHJldiA9IF9jb250ZXh0MjAubmV4dCkge2Nhc2UgMDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQgPSByZXN1bHRzW2luZGV4XTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtYXRjaCA9IG1hdGNoZXNUb0xvYWRbaW5kZXhdOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbnRNYXRjaCA9IGN1cnJlbnRNYXRjaGVzLmZpbmQoKG0pID0+IG0ucm91dGUuaWQgPT09IG1hdGNoLnJvdXRlLmlkKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpc1JldmFsaWRhdGluZ0xvYWRlciA9IGN1cnJlbnRNYXRjaCAhPSBudWxsICYmICFpc05ld1JvdXRlSW5zdGFuY2UoY3VycmVudE1hdGNoLCBtYXRjaCkgJiYgKGN1cnJlbnRMb2FkZXJEYXRhICYmIGN1cnJlbnRMb2FkZXJEYXRhW21hdGNoLnJvdXRlLmlkXSkgIT09IHVuZGVmaW5lZDtpZiAoISgKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaXNEZWZlcnJlZFJlc3VsdChyZXN1bHQpICYmIChpc0ZldGNoZXIgfHwgaXNSZXZhbGlkYXRpbmdMb2FkZXIpKSkge19jb250ZXh0MjAubmV4dCA9IDc7YnJlYWs7fV9jb250ZXh0MjAubmV4dCA9IDc7cmV0dXJuICgKCgoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmVEZWZlcnJlZERhdGEocmVzdWx0LCBzaWduYWwsIGlzRmV0Y2hlcikudGhlbigocmVzdWx0KSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZXN1bHQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXN1bHRzW2luZGV4XSA9IHJlc3VsdCB8fCByZXN1bHRzW2luZGV4XTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSkpO2Nhc2UgNzpjYXNlICJlbmQiOnJldHVybiBfY29udGV4dDIwLnN0b3AoKTt9fX0sIF9sb29wMik7fSk7aW5kZXggPSAwO2Nhc2UgMjppZiAoIShpbmRleCA8IHJlc3VsdHMubGVuZ3RoKSkge19jb250ZXh0MjEubmV4dCA9IDc7YnJlYWs7fXJldHVybiBfY29udGV4dDIxLmRlbGVnYXRlWWllbGQoX2xvb3AyKGluZGV4KSwgInQwIiwgNCk7Y2FzZSA0OmluZGV4Kys7X2NvbnRleHQyMS5uZXh0ID0gMjticmVhaztjYXNlIDc6Y2FzZSAiZW5kIjpyZXR1cm4gX2NvbnRleHQyMS5zdG9wKCk7fX19LCBfY2FsbGVlMTkpO30pKTtyZXR1cm4gX3Jlc29sdmVEZWZlcnJlZFJlc3VsdHMuYXBwbHkodGhpcywgYXJndW1lbnRzKTt9ZnVuY3Rpb24KCgoKCiAgICAgICAgICByZXNvbHZlRGVmZXJyZWREYXRhKF94NzEsIF94NzIsIF94NzMpIHtyZXR1cm4gX3Jlc29sdmVEZWZlcnJlZERhdGEuYXBwbHkodGhpcywgYXJndW1lbnRzKTt9ZnVuY3Rpb24gX3Jlc29sdmVEZWZlcnJlZERhdGEoKSB7X3Jlc29sdmVEZWZlcnJlZERhdGEgPSBfYXN5bmNUb0dlbmVyYXRvcjIoIC8qI19fUFVSRV9fKi9fcmVnZW5lcmF0b3JSdW50aW1lMigpLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTIwKHJlc3VsdCwgc2lnbmFsLCB1bndyYXApIHt2YXIgYWJvcnRlZDtyZXR1cm4gX3JlZ2VuZXJhdG9yUnVudGltZTIoKS53cmFwKGZ1bmN0aW9uIF9jYWxsZWUyMCQoX2NvbnRleHQyMikge3doaWxlICgxKSB7c3dpdGNoIChfY29udGV4dDIyLnByZXYgPSBfY29udGV4dDIyLm5leHQpIHtjYXNlIDA6CiAgICAgICAgICAgICAgICAgICAgICBpZiAodW53cmFwID09PSB2b2lkIDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgdW53cmFwID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgICB9X2NvbnRleHQyMi5uZXh0ID0gMztyZXR1cm4gKAoKICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0LmRlZmVycmVkRGF0YS5yZXNvbHZlRGF0YShzaWduYWwpKTtjYXNlIDM6YWJvcnRlZCA9IF9jb250ZXh0MjIuc2VudDtpZiAoIQoKICAgICAgICAgICAgICAgICAgICAgIGFib3J0ZWQpIHtfY29udGV4dDIyLm5leHQgPSA2O2JyZWFrO31yZXR1cm4gX2NvbnRleHQyMi5hYnJ1cHQoInJldHVybiIpO2Nhc2UgNjppZiAoIQoKCgogICAgICAgICAgICAgICAgICAgICAgdW53cmFwKSB7X2NvbnRleHQyMi5uZXh0ID0gMTQ7YnJlYWs7fV9jb250ZXh0MjIucHJldiA9IDc7cmV0dXJuIF9jb250ZXh0MjIuYWJydXB0KCJyZXR1cm4iLAoKICAgICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogUmVzdWx0VHlwZS5kYXRhLAogICAgICAgICAgICAgICAgICAgICAgICBkYXRhOiByZXN1bHQuZGVmZXJyZWREYXRhLnVud3JhcHBlZERhdGEKICAgICAgICAgICAgICAgICAgICAgIH0pO2Nhc2UgMTE6X2NvbnRleHQyMi5wcmV2ID0gMTE7X2NvbnRleHQyMi50MCA9IF9jb250ZXh0MjJbImNhdGNoIl0oNyk7cmV0dXJuIF9jb250ZXh0MjIuYWJydXB0KCJyZXR1cm4iLAoKCiAgICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6IFJlc3VsdFR5cGUuZXJyb3IsCiAgICAgICAgICAgICAgICAgICAgICAgIGVycm9yOiBfY29udGV4dDIyLnQwCiAgICAgICAgICAgICAgICAgICAgICB9KTtjYXNlIDE0OnJldHVybiBfY29udGV4dDIyLmFicnVwdCgicmV0dXJuIiwKCgoKICAgICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogUmVzdWx0VHlwZS5kYXRhLAogICAgICAgICAgICAgICAgICAgICAgICBkYXRhOiByZXN1bHQuZGVmZXJyZWREYXRhLmRhdGEKICAgICAgICAgICAgICAgICAgICAgIH0pO2Nhc2UgMTU6Y2FzZSAiZW5kIjpyZXR1cm4gX2NvbnRleHQyMi5zdG9wKCk7fX19LCBfY2FsbGVlMjAsIG51bGwsIFtbNywgMTFdXSk7fSkpO3JldHVybiBfcmVzb2x2ZURlZmVycmVkRGF0YS5hcHBseSh0aGlzLCBhcmd1bWVudHMpO30KCgogICAgICAgICAgZnVuY3Rpb24gaGFzTmFrZWRJbmRleFF1ZXJ5KHNlYXJjaCkgewogICAgICAgICAgICByZXR1cm4gbmV3IFVSTFNlYXJjaFBhcmFtcyhzZWFyY2gpLmdldEFsbCgiaW5kZXgiKS5zb21lKCh2KSA9PiB2ID09PSAiIik7CiAgICAgICAgICB9IC8vIE5vdGU6IFRoaXMgc2hvdWxkIG1hdGNoIHRoZSBmb3JtYXQgZXhwb3J0ZWQgYnkgdXNlTWF0Y2hlcywgc28gaWYgeW91IGNoYW5nZQogICAgICAgICAgLy8gdGhpcyBwbGVhc2UgYWxzbyBjaGFuZ2UgdGhhdCA6KSAgRXZlbnR1YWxseSB3ZSdsbCBEUlkgdGhpcyB1cAoKCiAgICAgICAgICBmdW5jdGlvbiBjcmVhdGVVc2VNYXRjaGVzTWF0Y2gobWF0Y2gsIGxvYWRlckRhdGEpIHsKICAgICAgICAgICAgdmFyCiAgICAgICAgICAgICAgcm91dGUgPQoKCiAgICAgICAgICAgICAgbWF0Y2gucm91dGUscGF0aG5hbWUgPSBtYXRjaC5wYXRobmFtZSxwYXJhbXMgPSBtYXRjaC5wYXJhbXM7CiAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgaWQ6IHJvdXRlLmlkLAogICAgICAgICAgICAgIHBhdGhuYW1lOiBwYXRobmFtZSwKICAgICAgICAgICAgICBwYXJhbXM6IHBhcmFtcywKICAgICAgICAgICAgICBkYXRhOiBsb2FkZXJEYXRhW3JvdXRlLmlkXSwKICAgICAgICAgICAgICBoYW5kbGU6IHJvdXRlLmhhbmRsZQogICAgICAgICAgICB9OwogICAgICAgICAgfQoKICAgICAgICAgIGZ1bmN0aW9uIGdldFRhcmdldE1hdGNoKG1hdGNoZXMsIGxvY2F0aW9uKSB7CiAgICAgICAgICAgIHZhciBzZWFyY2ggPSB0eXBlb2YgbG9jYXRpb24gPT09ICJzdHJpbmciID8gcGFyc2VQYXRoKGxvY2F0aW9uKS5zZWFyY2ggOiBsb2NhdGlvbi5zZWFyY2g7CgogICAgICAgICAgICBpZiAobWF0Y2hlc1ttYXRjaGVzLmxlbmd0aCAtIDFdLnJvdXRlLmluZGV4ICYmIGhhc05ha2VkSW5kZXhRdWVyeShzZWFyY2ggfHwgIiIpKSB7CiAgICAgICAgICAgICAgLy8gUmV0dXJuIHRoZSBsZWFmIGluZGV4IHJvdXRlIHdoZW4gaW5kZXggaXMgcHJlc2VudAogICAgICAgICAgICAgIHJldHVybiBtYXRjaGVzW21hdGNoZXMubGVuZ3RoIC0gMV07CiAgICAgICAgICAgIH0gLy8gT3RoZXJ3aXNlIGdyYWIgdGhlIGRlZXBlc3QgInBhdGggY29udHJpYnV0aW5nIiBtYXRjaCAoaWdub3JpbmcgaW5kZXggYW5kCiAgICAgICAgICAgIC8vIHBhdGhsZXNzIGxheW91dCByb3V0ZXMpCgoKICAgICAgICAgICAgdmFyIHBhdGhNYXRjaGVzID0gZ2V0UGF0aENvbnRyaWJ1dGluZ01hdGNoZXMobWF0Y2hlcyk7CiAgICAgICAgICAgIHJldHVybiBwYXRoTWF0Y2hlc1twYXRoTWF0Y2hlcy5sZW5ndGggLSAxXTsKICAgICAgICAgIH0gLy8jZW5kcmVnaW9uCgoKCgogICAgICAgICAgLy8gRVhURVJOQUwgTU9EVUxFOiAuL25vZGVfbW9kdWxlcy9yZWFjdC9pbmRleC5qcwogICAgICAgICAgdmFyIHJlYWN0ID0gX193ZWJwYWNrX3JlcXVpcmVfXygyOTQpOwogICAgICAgICAgdmFyIHJlYWN0X25hbWVzcGFjZU9iamVjdCA9IC8qI19fUFVSRV9fKi9fX3dlYnBhY2tfcmVxdWlyZV9fLnQocmVhY3QsIDIpOwogICAgICAgICAgOyAvLyBDT05DQVRFTkFURUQgTU9EVUxFOiAuL25vZGVfbW9kdWxlcy9yZWFjdC1yb3V0ZXIvZGlzdC9pbmRleC5qcwogICAgICAgICAgLyoqCiAgICAgICAgICAgKiBSZWFjdCBSb3V0ZXIgdjYuNC40CiAgICAgICAgICAgKgogICAgICAgICAgICogQ29weXJpZ2h0IChjKSBSZW1peCBTb2Z0d2FyZSBJbmMuCiAgICAgICAgICAgKgogICAgICAgICAgICogVGhpcyBzb3VyY2UgY29kZSBpcyBsaWNlbnNlZCB1bmRlciB0aGUgTUlUIGxpY2Vuc2UgZm91bmQgaW4gdGhlCiAgICAgICAgICAgKiBMSUNFTlNFLm1kIGZpbGUgaW4gdGhlIHJvb3QgZGlyZWN0b3J5IG9mIHRoaXMgc291cmNlIHRyZWUuCiAgICAgICAgICAgKgogICAgICAgICAgICogQGxpY2Vuc2UgTUlUCiAgICAgICAgICAgKi8KCgoKCiAgICAgICAgICBmdW5jdGlvbiBkaXN0X2V4dGVuZHMoKSB7CiAgICAgICAgICAgIGRpc3RfZXh0ZW5kcyA9IE9iamVjdC5hc3NpZ24gPyBPYmplY3QuYXNzaWduLmJpbmQoKSA6IGZ1bmN0aW9uICh0YXJnZXQpIHsKICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMTsgaSA8IGFyZ3VtZW50cy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAgdmFyIHNvdXJjZSA9IGFyZ3VtZW50c1tpXTsKCiAgICAgICAgICAgICAgICBmb3IgKHZhciBrZXkgaW4gc291cmNlKSB7CiAgICAgICAgICAgICAgICAgIGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoc291cmNlLCBrZXkpKSB7CiAgICAgICAgICAgICAgICAgICAgdGFyZ2V0W2tleV0gPSBzb3VyY2Vba2V5XTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgcmV0dXJuIHRhcmdldDsKICAgICAgICAgICAgfTsKICAgICAgICAgICAgcmV0dXJuIGRpc3RfZXh0ZW5kcy5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICAgICAgfQoKICAgICAgICAgIC8qKgogICAgICAgICAgICogQ29weXJpZ2h0IChjKSBGYWNlYm9vaywgSW5jLiBhbmQgaXRzIGFmZmlsaWF0ZXMuCiAgICAgICAgICAgKgogICAgICAgICAgICogVGhpcyBzb3VyY2UgY29kZSBpcyBsaWNlbnNlZCB1bmRlciB0aGUgTUlUIGxpY2Vuc2UgZm91bmQgaW4gdGhlCiAgICAgICAgICAgKiBMSUNFTlNFIGZpbGUgaW4gdGhlIHJvb3QgZGlyZWN0b3J5IG9mIHRoaXMgc291cmNlIHRyZWUuCiAgICAgICAgICAgKi8KICAgICAgICAgIC8qKgogICAgICAgICAgICogaW5saW5lZCBPYmplY3QuaXMgcG9seWZpbGwgdG8gYXZvaWQgcmVxdWlyaW5nIGNvbnN1bWVycyBzaGlwIHRoZWlyIG93bgogICAgICAgICAgICogaHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvZW4tVVMvZG9jcy9XZWIvSmF2YVNjcmlwdC9SZWZlcmVuY2UvR2xvYmFsX09iamVjdHMvT2JqZWN0L2lzCiAgICAgICAgICAgKi8KCiAgICAgICAgICBmdW5jdGlvbiBpc1BvbHlmaWxsKHgsIHkpIHsKICAgICAgICAgICAgcmV0dXJuIHggPT09IHkgJiYgKHggIT09IDAgfHwgMSAvIHggPT09IDEgLyB5KSB8fCB4ICE9PSB4ICYmIHkgIT09IHkgLy8gZXNsaW50LWRpc2FibGUtbGluZSBuby1zZWxmLWNvbXBhcmUKICAgICAgICAgICAgOwogICAgICAgICAgfQoKICAgICAgICAgIHZhciBpcyA9IHR5cGVvZiBPYmplY3QuaXMgPT09ICJmdW5jdGlvbiIgPyBPYmplY3QuaXMgOiBpc1BvbHlmaWxsOyAvLyBJbnRlbnRpb25hbGx5IG5vdCB1c2luZyBuYW1lZCBpbXBvcnRzIGJlY2F1c2UgUm9sbHVwIHVzZXMgZHluYW1pYwogICAgICAgICAgLy8gZGlzcGF0Y2ggZm9yIENvbW1vbkpTIGludGVyb3AgbmFtZWQgaW1wb3J0cy4KCiAgICAgICAgICB2YXIKICAgICAgICAgICAgdXNlU3RhdGUgPQoKCgogICAgICAgICAgICByZWFjdF9uYW1lc3BhY2VPYmplY3QudXNlU3RhdGUsdXNlRWZmZWN0ID0gcmVhY3RfbmFtZXNwYWNlT2JqZWN0LnVzZUVmZmVjdCx1c2VMYXlvdXRFZmZlY3QgPSByZWFjdF9uYW1lc3BhY2VPYmplY3QudXNlTGF5b3V0RWZmZWN0LHVzZURlYnVnVmFsdWUgPSByZWFjdF9uYW1lc3BhY2VPYmplY3QudXNlRGVidWdWYWx1ZTsKICAgICAgICAgIHZhciBkaWRXYXJuT2xkMThBbHBoYSA9IGZhbHNlOwogICAgICAgICAgdmFyIGRpZFdhcm5VbmNhY2hlZEdldFNuYXBzaG90ID0gZmFsc2U7IC8vIERpc2NsYWltZXI6IFRoaXMgc2hpbSBicmVha3MgbWFueSBvZiB0aGUgcnVsZXMgb2YgUmVhY3QsIGFuZCBvbmx5IHdvcmtzCiAgICAgICAgICAvLyBiZWNhdXNlIG9mIGEgdmVyeSBwYXJ0aWN1bGFyIHNldCBvZiBpbXBsZW1lbnRhdGlvbiBkZXRhaWxzIGFuZCBhc3N1bXB0aW9ucwogICAgICAgICAgLy8gLS0gY2hhbmdlIGFueSBvbmUgb2YgdGhlbSBhbmQgaXQgd2lsbCBicmVhay4gVGhlIG1vc3QgaW1wb3J0YW50IGFzc3VtcHRpb24KICAgICAgICAgIC8vIGlzIHRoYXQgdXBkYXRlcyBhcmUgYWx3YXlzIHN5bmNocm9ub3VzLCBiZWNhdXNlIGNvbmN1cnJlbnQgcmVuZGVyaW5nIGlzCiAgICAgICAgICAvLyBvbmx5IGF2YWlsYWJsZSBpbiB2ZXJzaW9ucyBvZiBSZWFjdCB0aGF0IGFsc28gaGF2ZSBhIGJ1aWx0LWluCiAgICAgICAgICAvLyB1c2VTeW5jRXh0ZXJuYWxTdG9yZSBBUEkuIEFuZCB3ZSBvbmx5IHVzZSB0aGlzIHNoaW0gd2hlbiB0aGUgYnVpbHQtaW4gQVBJCiAgICAgICAgICAvLyBkb2VzIG5vdCBleGlzdC4KICAgICAgICAgIC8vCiAgICAgICAgICAvLyBEbyBub3QgYXNzdW1lIHRoYXQgdGhlIGNsZXZlciBoYWNrcyB1c2VkIGJ5IHRoaXMgaG9vayBhbHNvIHdvcmsgaW4gZ2VuZXJhbC4KICAgICAgICAgIC8vIFRoZSBwb2ludCBvZiB0aGlzIHNoaW0gaXMgdG8gcmVwbGFjZSB0aGUgbmVlZCBmb3IgaGFja3MgYnkgb3RoZXIgbGlicmFyaWVzLgoKICAgICAgICAgIGZ1bmN0aW9uIHVzZVN5bmNFeHRlcm5hbFN0b3JlJDIoc3Vic2NyaWJlLCBnZXRTbmFwc2hvdCwgLy8gTm90ZTogVGhlIHNoaW0gZG9lcyBub3QgdXNlIGdldFNlcnZlclNuYXBzaG90LCBiZWNhdXNlIHByZS0xOCB2ZXJzaW9ucyBvZgogICAgICAgICAgLy8gUmVhY3QgZG8gbm90IGV4cG9zZSBhIHdheSB0byBjaGVjayBpZiB3ZSdyZSBoeWRyYXRpbmcuIFNvIHVzZXJzIG9mIHRoZSBzaGltCiAgICAgICAgICAvLyB3aWxsIG5lZWQgdG8gdHJhY2sgdGhhdCB0aGVtc2VsdmVzIGFuZCByZXR1cm4gdGhlIGNvcnJlY3QgdmFsdWUKICAgICAgICAgIC8vIGZyb20gYGdldFNuYXBzaG90YC4KICAgICAgICAgIGdldFNlcnZlclNuYXBzaG90KSB7CiAgICAgICAgICAgIGlmIChmYWxzZSkge30gLy8gUmVhZCB0aGUgY3VycmVudCBzbmFwc2hvdCBmcm9tIHRoZSBzdG9yZSBvbiBldmVyeSByZW5kZXIuIEFnYWluLCB0aGlzCiAgICAgICAgICAgIC8vIGJyZWFrcyB0aGUgcnVsZXMgb2YgUmVhY3QsIGFuZCBvbmx5IHdvcmtzIGhlcmUgYmVjYXVzZSBvZiBzcGVjaWZpYwogICAgICAgICAgICAvLyBpbXBsZW1lbnRhdGlvbiBkZXRhaWxzLCBtb3N0IGltcG9ydGFudGx5IHRoYXQgdXBkYXRlcyBhcmUKICAgICAgICAgICAgLy8gYWx3YXlzIHN5bmNocm9ub3VzLgoKCiAgICAgICAgICAgIHZhciB2YWx1ZSA9IGdldFNuYXBzaG90KCk7CgogICAgICAgICAgICBpZiAoZmFsc2UpIHt9IC8vIEJlY2F1c2UgdXBkYXRlcyBhcmUgc3luY2hyb25vdXMsIHdlIGRvbid0IHF1ZXVlIHRoZW0uIEluc3RlYWQgd2UgZm9yY2UgYQogICAgICAgICAgICAvLyByZS1yZW5kZXIgd2hlbmV2ZXIgdGhlIHN1YnNjcmliZWQgc3RhdGUgY2hhbmdlcyBieSB1cGRhdGluZyBhbiBzb21lCiAgICAgICAgICAgIC8vIGFyYml0cmFyeSB1c2VTdGF0ZSBob29rLiBUaGVuLCBkdXJpbmcgcmVuZGVyLCB3ZSBjYWxsIGdldFNuYXBzaG90IHRvIHJlYWQKICAgICAgICAgICAgLy8gdGhlIGN1cnJlbnQgdmFsdWUuCiAgICAgICAgICAgIC8vCiAgICAgICAgICAgIC8vIEJlY2F1c2Ugd2UgZG9uJ3QgYWN0dWFsbHkgdXNlIHRoZSBzdGF0ZSByZXR1cm5lZCBieSB0aGUgdXNlU3RhdGUgaG9vaywgd2UKICAgICAgICAgICAgLy8gY2FuIHNhdmUgYSBiaXQgb2YgbWVtb3J5IGJ5IHN0b3Jpbmcgb3RoZXIgc3R1ZmYgaW4gdGhhdCBzbG90LgogICAgICAgICAgICAvLwogICAgICAgICAgICAvLyBUbyBpbXBsZW1lbnQgdGhlIGVhcmx5IGJhaWxvdXQsIHdlIG5lZWQgdG8gdHJhY2sgc29tZSB0aGluZ3Mgb24gYSBtdXRhYmxlCiAgICAgICAgICAgIC8vIG9iamVjdC4gVXN1YWxseSwgd2Ugd291bGQgcHV0IHRoYXQgaW4gYSB1c2VSZWYgaG9vaywgYnV0IHdlIGNhbiBzdGFzaCBpdCBpbgogICAgICAgICAgICAvLyBvdXIgdXNlU3RhdGUgaG9vayBpbnN0ZWFkLgogICAgICAgICAgICAvLwogICAgICAgICAgICAvLyBUbyBmb3JjZSBhIHJlLXJlbmRlciwgd2UgY2FsbCBmb3JjZVVwZGF0ZSh7aW5zdH0pLiBUaGF0IHdvcmtzIGJlY2F1c2UgdGhlCiAgICAgICAgICAgIC8vIG5ldyBvYmplY3QgYWx3YXlzIGZhaWxzIGFuIGVxdWFsaXR5IGNoZWNrLgoKCiAgICAgICAgICAgIHZhciBfdXNlU3RhdGUzID0KCiAgICAgICAgICAgICAgdXNlU3RhdGUoewogICAgICAgICAgICAgICAgaW5zdDogewogICAgICAgICAgICAgICAgICB2YWx1ZTogdmFsdWUsCiAgICAgICAgICAgICAgICAgIGdldFNuYXBzaG90OiBnZXRTbmFwc2hvdAogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0pLF91c2VTdGF0ZTQgPSBfc2xpY2VkVG9BcnJheTIoX3VzZVN0YXRlMywgMiksaW5zdCA9IF91c2VTdGF0ZTRbMF0uaW5zdCxmb3JjZVVwZGF0ZSA9IF91c2VTdGF0ZTRbMV07IC8vIFRyYWNrIHRoZSBsYXRlc3QgZ2V0U25hcHNob3QgZnVuY3Rpb24gd2l0aCBhIHJlZi4gVGhpcyBuZWVkcyB0byBiZSB1cGRhdGVkCiAgICAgICAgICAgIC8vIGluIHRoZSBsYXlvdXQgcGhhc2Ugc28gd2UgY2FuIGFjY2VzcyBpdCBkdXJpbmcgdGhlIHRlYXJpbmcgY2hlY2sgdGhhdAogICAgICAgICAgICAvLyBoYXBwZW5zIG9uIHN1YnNjcmliZS4KCiAgICAgICAgICAgIHVzZUxheW91dEVmZmVjdCgoKSA9PiB7CiAgICAgICAgICAgICAgaW5zdC52YWx1ZSA9IHZhbHVlOwogICAgICAgICAgICAgIGluc3QuZ2V0U25hcHNob3QgPSBnZXRTbmFwc2hvdDsgLy8gV2hlbmV2ZXIgZ2V0U25hcHNob3Qgb3Igc3Vic2NyaWJlIGNoYW5nZXMsIHdlIG5lZWQgdG8gY2hlY2sgaW4gdGhlCiAgICAgICAgICAgICAgLy8gY29tbWl0IHBoYXNlIGlmIHRoZXJlIHdhcyBhbiBpbnRlcmxlYXZlZCBtdXRhdGlvbi4gSW4gY29uY3VycmVudCBtb2RlCiAgICAgICAgICAgICAgLy8gdGhpcyBjYW4gaGFwcGVuIGFsbCB0aGUgdGltZSwgYnV0IGV2ZW4gaW4gc3luY2hyb25vdXMgbW9kZSwgYW4gZWFybGllcgogICAgICAgICAgICAgIC8vIGVmZmVjdCBtYXkgaGF2ZSBtdXRhdGVkIHRoZSBzdG9yZS4KCiAgICAgICAgICAgICAgaWYgKGNoZWNrSWZTbmFwc2hvdENoYW5nZWQoaW5zdCkpIHsKICAgICAgICAgICAgICAgIC8vIEZvcmNlIGEgcmUtcmVuZGVyLgogICAgICAgICAgICAgICAgZm9yY2VVcGRhdGUoewogICAgICAgICAgICAgICAgICBpbnN0OiBpbnN0CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICB9IC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSByZWFjdC1ob29rcy9leGhhdXN0aXZlLWRlcHMKCiAgICAgICAgICAgIH0sIFtzdWJzY3JpYmUsIHZhbHVlLCBnZXRTbmFwc2hvdF0pOwogICAgICAgICAgICB1c2VFZmZlY3QoKCkgPT4gewogICAgICAgICAgICAgIC8vIENoZWNrIGZvciBjaGFuZ2VzIHJpZ2h0IGJlZm9yZSBzdWJzY3JpYmluZy4gU3Vic2VxdWVudCBjaGFuZ2VzIHdpbGwgYmUKICAgICAgICAgICAgICAvLyBkZXRlY3RlZCBpbiB0aGUgc3Vic2NyaXB0aW9uIGhhbmRsZXIuCiAgICAgICAgICAgICAgaWYgKGNoZWNrSWZTbmFwc2hvdENoYW5nZWQoaW5zdCkpIHsKICAgICAgICAgICAgICAgIC8vIEZvcmNlIGEgcmUtcmVuZGVyLgogICAgICAgICAgICAgICAgZm9yY2VVcGRhdGUoewogICAgICAgICAgICAgICAgICBpbnN0OiBpbnN0CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIHZhciBoYW5kbGVTdG9yZUNoYW5nZSA9ICgpID0+IHsKICAgICAgICAgICAgICAgIC8vIFRPRE86IEJlY2F1c2UgdGhlcmUgaXMgbm8gY3Jvc3MtcmVuZGVyZXIgQVBJIGZvciBiYXRjaGluZyB1cGRhdGVzLCBpdCdzCiAgICAgICAgICAgICAgICAvLyB1cCB0byB0aGUgY29uc3VtZXIgb2YgdGhpcyBsaWJyYXJ5IHRvIHdyYXAgdGhlaXIgc3Vic2NyaXB0aW9uIGV2ZW50CiAgICAgICAgICAgICAgICAvLyB3aXRoIHVuc3RhYmxlX2JhdGNoZWRVcGRhdGVzLiBTaG91bGQgd2UgdHJ5IHRvIGRldGVjdCB3aGVuIHRoaXMgaXNuJ3QKICAgICAgICAgICAgICAgIC8vIHRoZSBjYXNlIGFuZCBwcmludCBhIHdhcm5pbmcgaW4gZGV2ZWxvcG1lbnQ/CiAgICAgICAgICAgICAgICAvLyBUaGUgc3RvcmUgY2hhbmdlZC4gQ2hlY2sgaWYgdGhlIHNuYXBzaG90IGNoYW5nZWQgc2luY2UgdGhlIGxhc3QgdGltZSB3ZQogICAgICAgICAgICAgICAgLy8gcmVhZCBmcm9tIHRoZSBzdG9yZS4KICAgICAgICAgICAgICAgIGlmIChjaGVja0lmU25hcHNob3RDaGFuZ2VkKGluc3QpKSB7CiAgICAgICAgICAgICAgICAgIC8vIEZvcmNlIGEgcmUtcmVuZGVyLgogICAgICAgICAgICAgICAgICBmb3JjZVVwZGF0ZSh7CiAgICAgICAgICAgICAgICAgICAgaW5zdDogaW5zdAogICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9OyAvLyBTdWJzY3JpYmUgdG8gdGhlIHN0b3JlIGFuZCByZXR1cm4gYSBjbGVhbi11cCBmdW5jdGlvbi4KCgogICAgICAgICAgICAgIHJldHVybiBzdWJzY3JpYmUoaGFuZGxlU3RvcmVDaGFuZ2UpOyAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgcmVhY3QtaG9va3MvZXhoYXVzdGl2ZS1kZXBzCiAgICAgICAgICAgIH0sIFtzdWJzY3JpYmVdKTsKICAgICAgICAgICAgdXNlRGVidWdWYWx1ZSh2YWx1ZSk7CiAgICAgICAgICAgIHJldHVybiB2YWx1ZTsKICAgICAgICAgIH0KCiAgICAgICAgICBmdW5jdGlvbiBjaGVja0lmU25hcHNob3RDaGFuZ2VkKGluc3QpIHsKICAgICAgICAgICAgdmFyIGxhdGVzdEdldFNuYXBzaG90ID0gaW5zdC5nZXRTbmFwc2hvdDsKICAgICAgICAgICAgdmFyIHByZXZWYWx1ZSA9IGluc3QudmFsdWU7CgogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgIHZhciBuZXh0VmFsdWUgPSBsYXRlc3RHZXRTbmFwc2hvdCgpOwogICAgICAgICAgICAgIHJldHVybiAhaXMocHJldlZhbHVlLCBuZXh0VmFsdWUpOwogICAgICAgICAgICB9IGNhdGNoIChlcnJvcikgewogICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICB9CiAgICAgICAgICB9CgogICAgICAgICAgLyoqCiAgICAgICAgICAgKiBDb3B5cmlnaHQgKGMpIEZhY2Vib29rLCBJbmMuIGFuZCBpdHMgYWZmaWxpYXRlcy4KICAgICAgICAgICAqCiAgICAgICAgICAgKiBUaGlzIHNvdXJjZSBjb2RlIGlzIGxpY2Vuc2VkIHVuZGVyIHRoZSBNSVQgbGljZW5zZSBmb3VuZCBpbiB0aGUKICAgICAgICAgICAqIExJQ0VOU0UgZmlsZSBpbiB0aGUgcm9vdCBkaXJlY3Rvcnkgb2YgdGhpcyBzb3VyY2UgdHJlZS4KICAgICAgICAgICAqCiAgICAgICAgICAgKiBAZmxvdwogICAgICAgICAgICovCiAgICAgICAgICBmdW5jdGlvbiB1c2VTeW5jRXh0ZXJuYWxTdG9yZSQxKHN1YnNjcmliZSwgZ2V0U25hcHNob3QsIGdldFNlcnZlclNuYXBzaG90KSB7CiAgICAgICAgICAgIC8vIE5vdGU6IFRoZSBzaGltIGRvZXMgbm90IHVzZSBnZXRTZXJ2ZXJTbmFwc2hvdCwgYmVjYXVzZSBwcmUtMTggdmVyc2lvbnMgb2YKICAgICAgICAgICAgLy8gUmVhY3QgZG8gbm90IGV4cG9zZSBhIHdheSB0byBjaGVjayBpZiB3ZSdyZSBoeWRyYXRpbmcuIFNvIHVzZXJzIG9mIHRoZSBzaGltCiAgICAgICAgICAgIC8vIHdpbGwgbmVlZCB0byB0cmFjayB0aGF0IHRoZW1zZWx2ZXMgYW5kIHJldHVybiB0aGUgY29ycmVjdCB2YWx1ZQogICAgICAgICAgICAvLyBmcm9tIGBnZXRTbmFwc2hvdGAuCiAgICAgICAgICAgIHJldHVybiBnZXRTbmFwc2hvdCgpOwogICAgICAgICAgfQoKICAgICAgICAgIC8qKgogICAgICAgICAgICogSW5saW5lZCBpbnRvIHRoZSByZWFjdC1yb3V0ZXIgcmVwbyBzaW5jZSB1c2Utc3luYy1leHRlcm5hbC1zdG9yZSBkb2VzIG5vdAogICAgICAgICAgICogcHJvdmlkZSBhIFVNRC1jb21wYXRpYmxlIHBhY2thZ2UsIHNvIHdlIG5lZWQgdGhpcyB0byBiZSBhYmxlIHRvIGRpc3RyaWJ1dGUKICAgICAgICAgICAqIFVNRCByZWFjdC1yb3V0ZXIgYnVuZGxlcwogICAgICAgICAgICovCiAgICAgICAgICB2YXIgY2FuVXNlRE9NID0gISEodHlwZW9mIHdpbmRvdyAhPT0gInVuZGVmaW5lZCIgJiYgdHlwZW9mIHdpbmRvdy5kb2N1bWVudCAhPT0gInVuZGVmaW5lZCIgJiYgdHlwZW9mIHdpbmRvdy5kb2N1bWVudC5jcmVhdGVFbGVtZW50ICE9PSAidW5kZWZpbmVkIik7CiAgICAgICAgICB2YXIgaXNTZXJ2ZXJFbnZpcm9ubWVudCA9ICFjYW5Vc2VET007CiAgICAgICAgICB2YXIgc2hpbSA9IGlzU2VydmVyRW52aXJvbm1lbnQgPyB1c2VTeW5jRXh0ZXJuYWxTdG9yZSQxIDogdXNlU3luY0V4dGVybmFsU3RvcmUkMjsKICAgICAgICAgIHZhciB1c2VTeW5jRXh0ZXJuYWxTdG9yZSA9IHRydWUgPyAoKG1vZHVsZSkgPT4gbW9kdWxlLnVzZVN5bmNFeHRlcm5hbFN0b3JlKShyZWFjdF9uYW1lc3BhY2VPYmplY3QpIDogc2hpbTsKCiAgICAgICAgICAvLyBDb250ZXh0cyBmb3IgZGF0YSByb3V0ZXJzCiAgICAgICAgICB2YXIgRGF0YVN0YXRpY1JvdXRlckNvbnRleHQgPSAvKiNfX1BVUkVfXyovcmVhY3QuY3JlYXRlQ29udGV4dChudWxsKTsKCiAgICAgICAgICBpZiAoZmFsc2UpIHt9CgogICAgICAgICAgdmFyIERhdGFSb3V0ZXJDb250ZXh0ID0gLyojX19QVVJFX18qL3JlYWN0LmNyZWF0ZUNvbnRleHQobnVsbCk7CgogICAgICAgICAgaWYgKGZhbHNlKSB7fQoKICAgICAgICAgIHZhciBEYXRhUm91dGVyU3RhdGVDb250ZXh0ID0gLyojX19QVVJFX18qL3JlYWN0LmNyZWF0ZUNvbnRleHQobnVsbCk7CgogICAgICAgICAgaWYgKGZhbHNlKSB7fQoKICAgICAgICAgIHZhciBBd2FpdENvbnRleHQgPSAvKiNfX1BVUkVfXyovIC8qIHVudXNlZCBwdXJlIGV4cHJlc3Npb24gb3Igc3VwZXIgKi9udWxsICYmIFJlYWN0LmNyZWF0ZUNvbnRleHQobnVsbCk7CgogICAgICAgICAgaWYgKGZhbHNlKSB7fQoKICAgICAgICAgIHZhciBOYXZpZ2F0aW9uQ29udGV4dCA9IC8qI19fUFVSRV9fKi9yZWFjdC5jcmVhdGVDb250ZXh0KG51bGwpOwoKICAgICAgICAgIGlmIChmYWxzZSkge30KCiAgICAgICAgICB2YXIgTG9jYXRpb25Db250ZXh0ID0gLyojX19QVVJFX18qL3JlYWN0LmNyZWF0ZUNvbnRleHQobnVsbCk7CgogICAgICAgICAgaWYgKGZhbHNlKSB7fQoKICAgICAgICAgIHZhciBSb3V0ZUNvbnRleHQgPSAvKiNfX1BVUkVfXyovcmVhY3QuY3JlYXRlQ29udGV4dCh7CiAgICAgICAgICAgIG91dGxldDogbnVsbCwKICAgICAgICAgICAgbWF0Y2hlczogW10KICAgICAgICAgIH0pOwoKICAgICAgICAgIGlmIChmYWxzZSkge30KCiAgICAgICAgICB2YXIgUm91dGVFcnJvckNvbnRleHQgPSAvKiNfX1BVUkVfXyovcmVhY3QuY3JlYXRlQ29udGV4dChudWxsKTsKCiAgICAgICAgICBpZiAoZmFsc2UpIHt9CgogICAgICAgICAgLyoqCiAgICAgICAgICAgKiBSZXR1cm5zIHRoZSBmdWxsIGhyZWYgZm9yIHRoZSBnaXZlbiAidG8iIHZhbHVlLiBUaGlzIGlzIHVzZWZ1bCBmb3IgYnVpbGRpbmcKICAgICAgICAgICAqIGN1c3RvbSBsaW5rcyB0aGF0IGFyZSBhbHNvIGFjY2Vzc2libGUgYW5kIHByZXNlcnZlIHJpZ2h0LWNsaWNrIGJlaGF2aW9yLgogICAgICAgICAgICoKICAgICAgICAgICAqIEBzZWUgaHR0cHM6Ly9yZWFjdHJvdXRlci5jb20vZG9jcy9lbi92Ni9ob29rcy91c2UtaHJlZgogICAgICAgICAgICovCgogICAgICAgICAgZnVuY3Rpb24gdXNlSHJlZih0bywgX3RlbXApIHsKICAgICAgICAgICAgdmFyIF9yZWYyNiA9CgogICAgICAgICAgICAgIF90ZW1wID09PSB2b2lkIDAgPyB7fSA6IF90ZW1wLHJlbGF0aXZlID0gX3JlZjI2LnJlbGF0aXZlOwogICAgICAgICAgICAhdXNlSW5Sb3V0ZXJDb250ZXh0KCkgPyBmYWxzZSA/IDAgOiByb3V0ZXJfaW52YXJpYW50KGZhbHNlKSA6IHZvaWQgMDsKICAgICAgICAgICAgdmFyIF9yZWFjdCR1c2VDb250ZXh0ID0KCgogICAgICAgICAgICAgIHJlYWN0LnVzZUNvbnRleHQoTmF2aWdhdGlvbkNvbnRleHQpLGJhc2VuYW1lID0gX3JlYWN0JHVzZUNvbnRleHQuYmFzZW5hbWUsbmF2aWdhdG9yID0gX3JlYWN0JHVzZUNvbnRleHQubmF2aWdhdG9yOwogICAgICAgICAgICB2YXIgX2Rpc3RfdXNlUmVzb2x2ZWRQYXRoID0KCgoKICAgICAgICAgICAgICBkaXN0X3VzZVJlc29sdmVkUGF0aCh0bywgewogICAgICAgICAgICAgICAgcmVsYXRpdmU6IHJlbGF0aXZlCiAgICAgICAgICAgICAgfSksaGFzaCA9IF9kaXN0X3VzZVJlc29sdmVkUGF0aC5oYXNoLHBhdGhuYW1lID0gX2Rpc3RfdXNlUmVzb2x2ZWRQYXRoLnBhdGhuYW1lLHNlYXJjaCA9IF9kaXN0X3VzZVJlc29sdmVkUGF0aC5zZWFyY2g7CiAgICAgICAgICAgIHZhciBqb2luZWRQYXRobmFtZSA9IHBhdGhuYW1lOyAvLyBJZiB3ZSdyZSBvcGVyYXRpbmcgd2l0aGluIGEgYmFzZW5hbWUsIHByZXBlbmQgaXQgdG8gdGhlIHBhdGhuYW1lIHByaW9yCiAgICAgICAgICAgIC8vIHRvIGNyZWF0aW5nIHRoZSBocmVmLiAgSWYgdGhpcyBpcyBhIHJvb3QgbmF2aWdhdGlvbiwgdGhlbiBqdXN0IHVzZSB0aGUgcmF3CiAgICAgICAgICAgIC8vIGJhc2VuYW1lIHdoaWNoIGFsbG93cyB0aGUgYmFzZW5hbWUgdG8gaGF2ZSBmdWxsIGNvbnRyb2wgb3ZlciB0aGUgcHJlc2VuY2UKICAgICAgICAgICAgLy8gb2YgYSB0cmFpbGluZyBzbGFzaCBvbiByb290IGxpbmtzCgogICAgICAgICAgICBpZiAoYmFzZW5hbWUgIT09ICIvIikgewogICAgICAgICAgICAgIGpvaW5lZFBhdGhuYW1lID0gcGF0aG5hbWUgPT09ICIvIiA/IGJhc2VuYW1lIDogcm91dGVyX2pvaW5QYXRocyhbYmFzZW5hbWUsIHBhdGhuYW1lXSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybiBuYXZpZ2F0b3IuY3JlYXRlSHJlZih7CiAgICAgICAgICAgICAgcGF0aG5hbWU6IGpvaW5lZFBhdGhuYW1lLAogICAgICAgICAgICAgIHNlYXJjaDogc2VhcmNoLAogICAgICAgICAgICAgIGhhc2g6IGhhc2gKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9CiAgICAgICAgICAvKioKICAgICAgICAgICAqIFJldHVybnMgdHJ1ZSBpZiB0aGlzIGNvbXBvbmVudCBpcyBhIGRlc2NlbmRhbnQgb2YgYSA8Um91dGVyPi4KICAgICAgICAgICAqCiAgICAgICAgICAgKiBAc2VlIGh0dHBzOi8vcmVhY3Ryb3V0ZXIuY29tL2RvY3MvZW4vdjYvaG9va3MvdXNlLWluLXJvdXRlci1jb250ZXh0CiAgICAgICAgICAgKi8KCiAgICAgICAgICBmdW5jdGlvbiB1c2VJblJvdXRlckNvbnRleHQoKSB7CiAgICAgICAgICAgIHJldHVybiByZWFjdC51c2VDb250ZXh0KExvY2F0aW9uQ29udGV4dCkgIT0gbnVsbDsKICAgICAgICAgIH0KICAgICAgICAgIC8qKgogICAgICAgICAgICogUmV0dXJucyB0aGUgY3VycmVudCBsb2NhdGlvbiBvYmplY3QsIHdoaWNoIHJlcHJlc2VudHMgdGhlIGN1cnJlbnQgVVJMIGluIHdlYgogICAgICAgICAgICogYnJvd3NlcnMuCiAgICAgICAgICAgKgogICAgICAgICAgICogTm90ZTogSWYgeW91J3JlIHVzaW5nIHRoaXMgaXQgbWF5IG1lYW4geW91J3JlIGRvaW5nIHNvbWUgb2YgeW91ciBvd24KICAgICAgICAgICAqICJyb3V0aW5nIiBpbiB5b3VyIGFwcCwgYW5kIHdlJ2QgbGlrZSB0byBrbm93IHdoYXQgeW91ciB1c2UgY2FzZSBpcy4gV2UgbWF5CiAgICAgICAgICAgKiBiZSBhYmxlIHRvIHByb3ZpZGUgc29tZXRoaW5nIGhpZ2hlci1sZXZlbCB0byBiZXR0ZXIgc3VpdCB5b3VyIG5lZWRzLgogICAgICAgICAgICoKICAgICAgICAgICAqIEBzZWUgaHR0cHM6Ly9yZWFjdHJvdXRlci5jb20vZG9jcy9lbi92Ni9ob29rcy91c2UtbG9jYXRpb24KICAgICAgICAgICAqLwoKICAgICAgICAgIGZ1bmN0aW9uIGRpc3RfdXNlTG9jYXRpb24oKSB7CiAgICAgICAgICAgICF1c2VJblJvdXRlckNvbnRleHQoKSA/IGZhbHNlID8gMCA6IHJvdXRlcl9pbnZhcmlhbnQoZmFsc2UpIDogdm9pZCAwOwogICAgICAgICAgICByZXR1cm4gcmVhY3QudXNlQ29udGV4dChMb2NhdGlvbkNvbnRleHQpLmxvY2F0aW9uOwogICAgICAgICAgfQogICAgICAgICAgLyoqCiAgICAgICAgICAgKiBSZXR1cm5zIHRoZSBjdXJyZW50IG5hdmlnYXRpb24gYWN0aW9uIHdoaWNoIGRlc2NyaWJlcyBob3cgdGhlIHJvdXRlciBjYW1lIHRvCiAgICAgICAgICAgKiB0aGUgY3VycmVudCBsb2NhdGlvbiwgZWl0aGVyIGJ5IGEgcG9wLCBwdXNoLCBvciByZXBsYWNlIG9uIHRoZSBoaXN0b3J5IHN0YWNrLgogICAgICAgICAgICoKICAgICAgICAgICAqIEBzZWUgaHR0cHM6Ly9yZWFjdHJvdXRlci5jb20vZG9jcy9lbi92Ni9ob29rcy91c2UtbmF2aWdhdGlvbi10eXBlCiAgICAgICAgICAgKi8KCiAgICAgICAgICBmdW5jdGlvbiB1c2VOYXZpZ2F0aW9uVHlwZSgpIHsKICAgICAgICAgICAgcmV0dXJuIFJlYWN0LnVzZUNvbnRleHQoTG9jYXRpb25Db250ZXh0KS5uYXZpZ2F0aW9uVHlwZTsKICAgICAgICAgIH0KICAgICAgICAgIC8qKgogICAgICAgICAgICogUmV0dXJucyBhIFBhdGhNYXRjaCBvYmplY3QgaWYgdGhlIGdpdmVuIHBhdHRlcm4gbWF0Y2hlcyB0aGUgY3VycmVudCBVUkwuCiAgICAgICAgICAgKiBUaGlzIGlzIHVzZWZ1bCBmb3IgY29tcG9uZW50cyB0aGF0IG5lZWQgdG8ga25vdyAiYWN0aXZlIiBzdGF0ZSwgZS5nLgogICAgICAgICAgICogPE5hdkxpbms+LgogICAgICAgICAgICoKICAgICAgICAgICAqIEBzZWUgaHR0cHM6Ly9yZWFjdHJvdXRlci5jb20vZG9jcy9lbi92Ni9ob29rcy91c2UtbWF0Y2gKICAgICAgICAgICAqLwoKICAgICAgICAgIGZ1bmN0aW9uIHVzZU1hdGNoKHBhdHRlcm4pIHsKICAgICAgICAgICAgIXVzZUluUm91dGVyQ29udGV4dCgpID8gZmFsc2UgPyAwIDogaW52YXJpYW50KGZhbHNlKSA6IHZvaWQgMDsKICAgICAgICAgICAgdmFyIF9kaXN0X3VzZUxvY2F0aW9uID0KCiAgICAgICAgICAgICAgZGlzdF91c2VMb2NhdGlvbigpLHBhdGhuYW1lID0gX2Rpc3RfdXNlTG9jYXRpb24ucGF0aG5hbWU7CiAgICAgICAgICAgIHJldHVybiBSZWFjdC51c2VNZW1vKCgpID0+IG1hdGNoUGF0aChwYXR0ZXJuLCBwYXRobmFtZSksIFtwYXRobmFtZSwgcGF0dGVybl0pOwogICAgICAgICAgfQogICAgICAgICAgLyoqCiAgICAgICAgICAgKiBUaGUgaW50ZXJmYWNlIGZvciB0aGUgbmF2aWdhdGUoKSBmdW5jdGlvbiByZXR1cm5lZCBmcm9tIHVzZU5hdmlnYXRlKCkuCiAgICAgICAgICAgKi8KCiAgICAgICAgICAvKioKICAgICAgICAgICAqIFJldHVybnMgYW4gaW1wZXJhdGl2ZSBtZXRob2QgZm9yIGNoYW5naW5nIHRoZSBsb2NhdGlvbi4gVXNlZCBieSA8TGluaz5zLCBidXQKICAgICAgICAgICAqIG1heSBhbHNvIGJlIHVzZWQgYnkgb3RoZXIgZWxlbWVudHMgdG8gY2hhbmdlIHRoZSBsb2NhdGlvbi4KICAgICAgICAgICAqCiAgICAgICAgICAgKiBAc2VlIGh0dHBzOi8vcmVhY3Ryb3V0ZXIuY29tL2RvY3MvZW4vdjYvaG9va3MvdXNlLW5hdmlnYXRlCiAgICAgICAgICAgKi8KICAgICAgICAgIGZ1bmN0aW9uIGRpc3RfdXNlTmF2aWdhdGUoKSB7CiAgICAgICAgICAgICF1c2VJblJvdXRlckNvbnRleHQoKSA/IGZhbHNlID8gMCA6IHJvdXRlcl9pbnZhcmlhbnQoZmFsc2UpIDogdm9pZCAwOwogICAgICAgICAgICB2YXIgX3JlYWN0JHVzZUNvbnRleHQyID0KCgogICAgICAgICAgICAgIHJlYWN0LnVzZUNvbnRleHQoTmF2aWdhdGlvbkNvbnRleHQpLGJhc2VuYW1lID0gX3JlYWN0JHVzZUNvbnRleHQyLmJhc2VuYW1lLG5hdmlnYXRvciA9IF9yZWFjdCR1c2VDb250ZXh0Mi5uYXZpZ2F0b3I7CiAgICAgICAgICAgIHZhciBfcmVhY3QkdXNlQ29udGV4dDMgPQoKICAgICAgICAgICAgICByZWFjdC51c2VDb250ZXh0KFJvdXRlQ29udGV4dCksbWF0Y2hlcyA9IF9yZWFjdCR1c2VDb250ZXh0My5tYXRjaGVzOwogICAgICAgICAgICB2YXIgX2Rpc3RfdXNlTG9jYXRpb24yID0KCiAgICAgICAgICAgICAgZGlzdF91c2VMb2NhdGlvbigpLGxvY2F0aW9uUGF0aG5hbWUgPSBfZGlzdF91c2VMb2NhdGlvbjIucGF0aG5hbWU7CiAgICAgICAgICAgIHZhciByb3V0ZVBhdGhuYW1lc0pzb24gPSBKU09OLnN0cmluZ2lmeShnZXRQYXRoQ29udHJpYnV0aW5nTWF0Y2hlcyhtYXRjaGVzKS5tYXAoKG1hdGNoKSA9PiBtYXRjaC5wYXRobmFtZUJhc2UpKTsKICAgICAgICAgICAgdmFyIGFjdGl2ZVJlZiA9IHJlYWN0LnVzZVJlZihmYWxzZSk7CiAgICAgICAgICAgIHJlYWN0LnVzZUVmZmVjdCgoKSA9PiB7CiAgICAgICAgICAgICAgYWN0aXZlUmVmLmN1cnJlbnQgPSB0cnVlOwogICAgICAgICAgICB9KTsKICAgICAgICAgICAgdmFyIG5hdmlnYXRlID0gcmVhY3QudXNlQ2FsbGJhY2soZnVuY3Rpb24gKHRvLCBvcHRpb25zKSB7CiAgICAgICAgICAgICAgaWYgKG9wdGlvbnMgPT09IHZvaWQgMCkgewogICAgICAgICAgICAgICAgb3B0aW9ucyA9IHt9OwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgZmFsc2UgPyAwIDogdm9pZCAwOwogICAgICAgICAgICAgIGlmICghYWN0aXZlUmVmLmN1cnJlbnQpIHJldHVybjsKCiAgICAgICAgICAgICAgaWYgKHR5cGVvZiB0byA9PT0gIm51bWJlciIpIHsKICAgICAgICAgICAgICAgIG5hdmlnYXRvci5nbyh0byk7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICB2YXIgcGF0aCA9IHJlc29sdmVUbyh0bywgSlNPTi5wYXJzZShyb3V0ZVBhdGhuYW1lc0pzb24pLCBsb2NhdGlvblBhdGhuYW1lLCBvcHRpb25zLnJlbGF0aXZlID09PSAicGF0aCIpOyAvLyBJZiB3ZSdyZSBvcGVyYXRpbmcgd2l0aGluIGEgYmFzZW5hbWUsIHByZXBlbmQgaXQgdG8gdGhlIHBhdGhuYW1lIHByaW9yCiAgICAgICAgICAgICAgLy8gdG8gaGFuZGluZyBvZmYgdG8gaGlzdG9yeS4gIElmIHRoaXMgaXMgYSByb290IG5hdmlnYXRpb24sIHRoZW4gd2UKICAgICAgICAgICAgICAvLyBuYXZpZ2F0ZSB0byB0aGUgcmF3IGJhc2VuYW1lIHdoaWNoIGFsbG93cyB0aGUgYmFzZW5hbWUgdG8gaGF2ZSBmdWxsCiAgICAgICAgICAgICAgLy8gY29udHJvbCBvdmVyIHRoZSBwcmVzZW5jZSBvZiBhIHRyYWlsaW5nIHNsYXNoIG9uIHJvb3QgbGlua3MKCiAgICAgICAgICAgICAgaWYgKGJhc2VuYW1lICE9PSAiLyIpIHsKICAgICAgICAgICAgICAgIHBhdGgucGF0aG5hbWUgPSBwYXRoLnBhdGhuYW1lID09PSAiLyIgPyBiYXNlbmFtZSA6IHJvdXRlcl9qb2luUGF0aHMoW2Jhc2VuYW1lLCBwYXRoLnBhdGhuYW1lXSk7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAoISFvcHRpb25zLnJlcGxhY2UgPyBuYXZpZ2F0b3IucmVwbGFjZSA6IG5hdmlnYXRvci5wdXNoKShwYXRoLCBvcHRpb25zLnN0YXRlLCBvcHRpb25zKTsKICAgICAgICAgICAgfSwgW2Jhc2VuYW1lLCBuYXZpZ2F0b3IsIHJvdXRlUGF0aG5hbWVzSnNvbiwgbG9jYXRpb25QYXRobmFtZV0pOwogICAgICAgICAgICByZXR1cm4gbmF2aWdhdGU7CiAgICAgICAgICB9CiAgICAgICAgICB2YXIgT3V0bGV0Q29udGV4dCA9IC8qI19fUFVSRV9fKi9yZWFjdC5jcmVhdGVDb250ZXh0KG51bGwpOwogICAgICAgICAgLyoqCiAgICAgICAgICAgKiBSZXR1cm5zIHRoZSBjb250ZXh0IChpZiBwcm92aWRlZCkgZm9yIHRoZSBjaGlsZCByb3V0ZSBhdCB0aGlzIGxldmVsIG9mIHRoZSByb3V0ZQogICAgICAgICAgICogaGllcmFyY2h5LgogICAgICAgICAgICogQHNlZSBodHRwczovL3JlYWN0cm91dGVyLmNvbS9kb2NzL2VuL3Y2L2hvb2tzL3VzZS1vdXRsZXQtY29udGV4dAogICAgICAgICAgICovCgogICAgICAgICAgZnVuY3Rpb24gdXNlT3V0bGV0Q29udGV4dCgpIHsKICAgICAgICAgICAgcmV0dXJuIFJlYWN0LnVzZUNvbnRleHQoT3V0bGV0Q29udGV4dCk7CiAgICAgICAgICB9CiAgICAgICAgICAvKioKICAgICAgICAgICAqIFJldHVybnMgdGhlIGVsZW1lbnQgZm9yIHRoZSBjaGlsZCByb3V0ZSBhdCB0aGlzIGxldmVsIG9mIHRoZSByb3V0ZQogICAgICAgICAgICogaGllcmFyY2h5LiBVc2VkIGludGVybmFsbHkgYnkgPE91dGxldD4gdG8gcmVuZGVyIGNoaWxkIHJvdXRlcy4KICAgICAgICAgICAqCiAgICAgICAgICAgKiBAc2VlIGh0dHBzOi8vcmVhY3Ryb3V0ZXIuY29tL2RvY3MvZW4vdjYvaG9va3MvdXNlLW91dGxldAogICAgICAgICAgICovCgogICAgICAgICAgZnVuY3Rpb24gdXNlT3V0bGV0KGNvbnRleHQpIHsKICAgICAgICAgICAgdmFyIG91dGxldCA9IHJlYWN0LnVzZUNvbnRleHQoUm91dGVDb250ZXh0KS5vdXRsZXQ7CgogICAgICAgICAgICBpZiAob3V0bGV0KSB7CiAgICAgICAgICAgICAgcmV0dXJuIC8qI19fUFVSRV9fKi9yZWFjdC5jcmVhdGVFbGVtZW50KE91dGxldENvbnRleHQuUHJvdmlkZXIsIHsKICAgICAgICAgICAgICAgIHZhbHVlOiBjb250ZXh0CiAgICAgICAgICAgICAgfSwgb3V0bGV0KTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuIG91dGxldDsKICAgICAgICAgIH0KICAgICAgICAgIC8qKgogICAgICAgICAgICogUmV0dXJucyBhbiBvYmplY3Qgb2Yga2V5L3ZhbHVlIHBhaXJzIG9mIHRoZSBkeW5hbWljIHBhcmFtcyBmcm9tIHRoZSBjdXJyZW50CiAgICAgICAgICAgKiBVUkwgdGhhdCB3ZXJlIG1hdGNoZWQgYnkgdGhlIHJvdXRlIHBhdGguCiAgICAgICAgICAgKgogICAgICAgICAgICogQHNlZSBodHRwczovL3JlYWN0cm91dGVyLmNvbS9kb2NzL2VuL3Y2L2hvb2tzL3VzZS1wYXJhbXMKICAgICAgICAgICAqLwoKICAgICAgICAgIGZ1bmN0aW9uIHVzZVBhcmFtcygpIHsKICAgICAgICAgICAgdmFyIF9SZWFjdCR1c2VDb250ZXh0ID0KCiAgICAgICAgICAgICAgUmVhY3QudXNlQ29udGV4dChSb3V0ZUNvbnRleHQpLG1hdGNoZXMgPSBfUmVhY3QkdXNlQ29udGV4dC5tYXRjaGVzOwogICAgICAgICAgICB2YXIgcm91dGVNYXRjaCA9IG1hdGNoZXNbbWF0Y2hlcy5sZW5ndGggLSAxXTsKICAgICAgICAgICAgcmV0dXJuIHJvdXRlTWF0Y2ggPyByb3V0ZU1hdGNoLnBhcmFtcyA6IHt9OwogICAgICAgICAgfQogICAgICAgICAgLyoqCiAgICAgICAgICAgKiBSZXNvbHZlcyB0aGUgcGF0aG5hbWUgb2YgdGhlIGdpdmVuIGB0b2AgdmFsdWUgYWdhaW5zdCB0aGUgY3VycmVudCBsb2NhdGlvbi4KICAgICAgICAgICAqCiAgICAgICAgICAgKiBAc2VlIGh0dHBzOi8vcmVhY3Ryb3V0ZXIuY29tL2RvY3MvZW4vdjYvaG9va3MvdXNlLXJlc29sdmVkLXBhdGgKICAgICAgICAgICAqLwoKICAgICAgICAgIGZ1bmN0aW9uIGRpc3RfdXNlUmVzb2x2ZWRQYXRoKHRvLCBfdGVtcDIpIHsKICAgICAgICAgICAgdmFyIF9yZWYyNyA9CgogICAgICAgICAgICAgIF90ZW1wMiA9PT0gdm9pZCAwID8ge30gOiBfdGVtcDIscmVsYXRpdmUgPSBfcmVmMjcucmVsYXRpdmU7CiAgICAgICAgICAgIHZhciBfcmVhY3QkdXNlQ29udGV4dDQgPQoKICAgICAgICAgICAgICByZWFjdC51c2VDb250ZXh0KFJvdXRlQ29udGV4dCksbWF0Y2hlcyA9IF9yZWFjdCR1c2VDb250ZXh0NC5tYXRjaGVzOwogICAgICAgICAgICB2YXIgX2Rpc3RfdXNlTG9jYXRpb24zID0KCiAgICAgICAgICAgICAgZGlzdF91c2VMb2NhdGlvbigpLGxvY2F0aW9uUGF0aG5hbWUgPSBfZGlzdF91c2VMb2NhdGlvbjMucGF0aG5hbWU7CiAgICAgICAgICAgIHZhciByb3V0ZVBhdGhuYW1lc0pzb24gPSBKU09OLnN0cmluZ2lmeShnZXRQYXRoQ29udHJpYnV0aW5nTWF0Y2hlcyhtYXRjaGVzKS5tYXAoKG1hdGNoKSA9PiBtYXRjaC5wYXRobmFtZUJhc2UpKTsKICAgICAgICAgICAgcmV0dXJuIHJlYWN0LnVzZU1lbW8oKCkgPT4gcmVzb2x2ZVRvKHRvLCBKU09OLnBhcnNlKHJvdXRlUGF0aG5hbWVzSnNvbiksIGxvY2F0aW9uUGF0aG5hbWUsIHJlbGF0aXZlID09PSAicGF0aCIpLCBbdG8sIHJvdXRlUGF0aG5hbWVzSnNvbiwgbG9jYXRpb25QYXRobmFtZSwgcmVsYXRpdmVdKTsKICAgICAgICAgIH0KICAgICAgICAgIC8qKgogICAgICAgICAgICogUmV0dXJucyB0aGUgZWxlbWVudCBvZiB0aGUgcm91dGUgdGhhdCBtYXRjaGVkIHRoZSBjdXJyZW50IGxvY2F0aW9uLCBwcmVwYXJlZAogICAgICAgICAgICogd2l0aCB0aGUgY29ycmVjdCBjb250ZXh0IHRvIHJlbmRlciB0aGUgcmVtYWluZGVyIG9mIHRoZSByb3V0ZSB0cmVlLiBSb3V0ZQogICAgICAgICAgICogZWxlbWVudHMgaW4gdGhlIHRyZWUgbXVzdCByZW5kZXIgYW4gPE91dGxldD4gdG8gcmVuZGVyIHRoZWlyIGNoaWxkIHJvdXRlJ3MKICAgICAgICAgICAqIGVsZW1lbnQuCiAgICAgICAgICAgKgogICAgICAgICAgICogQHNlZSBodHRwczovL3JlYWN0cm91dGVyLmNvbS9kb2NzL2VuL3Y2L2hvb2tzL3VzZS1yb3V0ZXMKICAgICAgICAgICAqLwoKICAgICAgICAgIGZ1bmN0aW9uIHVzZVJvdXRlcyhyb3V0ZXMsIGxvY2F0aW9uQXJnKSB7CiAgICAgICAgICAgICF1c2VJblJvdXRlckNvbnRleHQoKSA/IGZhbHNlID8gMCA6IHJvdXRlcl9pbnZhcmlhbnQoZmFsc2UpIDogdm9pZCAwOwogICAgICAgICAgICB2YXIgX3JlYWN0JHVzZUNvbnRleHQ1ID0KCiAgICAgICAgICAgICAgcmVhY3QudXNlQ29udGV4dChOYXZpZ2F0aW9uQ29udGV4dCksbmF2aWdhdG9yID0gX3JlYWN0JHVzZUNvbnRleHQ1Lm5hdmlnYXRvcjsKICAgICAgICAgICAgdmFyIGRhdGFSb3V0ZXJTdGF0ZUNvbnRleHQgPSByZWFjdC51c2VDb250ZXh0KERhdGFSb3V0ZXJTdGF0ZUNvbnRleHQpOwogICAgICAgICAgICB2YXIgX3JlYWN0JHVzZUNvbnRleHQ2ID0KCiAgICAgICAgICAgICAgcmVhY3QudXNlQ29udGV4dChSb3V0ZUNvbnRleHQpLHBhcmVudE1hdGNoZXMgPSBfcmVhY3QkdXNlQ29udGV4dDYubWF0Y2hlczsKICAgICAgICAgICAgdmFyIHJvdXRlTWF0Y2ggPSBwYXJlbnRNYXRjaGVzW3BhcmVudE1hdGNoZXMubGVuZ3RoIC0gMV07CiAgICAgICAgICAgIHZhciBwYXJlbnRQYXJhbXMgPSByb3V0ZU1hdGNoID8gcm91dGVNYXRjaC5wYXJhbXMgOiB7fTsKICAgICAgICAgICAgdmFyIHBhcmVudFBhdGhuYW1lID0gcm91dGVNYXRjaCA/IHJvdXRlTWF0Y2gucGF0aG5hbWUgOiAiLyI7CiAgICAgICAgICAgIHZhciBwYXJlbnRQYXRobmFtZUJhc2UgPSByb3V0ZU1hdGNoID8gcm91dGVNYXRjaC5wYXRobmFtZUJhc2UgOiAiLyI7CiAgICAgICAgICAgIHZhciBwYXJlbnRSb3V0ZSA9IHJvdXRlTWF0Y2ggJiYgcm91dGVNYXRjaC5yb3V0ZTsKCiAgICAgICAgICAgIGlmIChmYWxzZSkge30KCiAgICAgICAgICAgIHZhciBsb2NhdGlvbkZyb21Db250ZXh0ID0gZGlzdF91c2VMb2NhdGlvbigpOwogICAgICAgICAgICB2YXIgbG9jYXRpb247CgogICAgICAgICAgICBpZiAobG9jYXRpb25BcmcpIHsKICAgICAgICAgICAgICB2YXIgX3BhcnNlZExvY2F0aW9uQXJnJHBhOwoKICAgICAgICAgICAgICB2YXIgcGFyc2VkTG9jYXRpb25BcmcgPSB0eXBlb2YgbG9jYXRpb25BcmcgPT09ICJzdHJpbmciID8gcGFyc2VQYXRoKGxvY2F0aW9uQXJnKSA6IGxvY2F0aW9uQXJnOwogICAgICAgICAgICAgICEocGFyZW50UGF0aG5hbWVCYXNlID09PSAiLyIgfHwgKChfcGFyc2VkTG9jYXRpb25BcmckcGEgPSBwYXJzZWRMb2NhdGlvbkFyZy5wYXRobmFtZSkgPT0gbnVsbCA/IHZvaWQgMCA6IF9wYXJzZWRMb2NhdGlvbkFyZyRwYS5zdGFydHNXaXRoKHBhcmVudFBhdGhuYW1lQmFzZSkpKSA/IGZhbHNlID8gMCA6IHJvdXRlcl9pbnZhcmlhbnQoZmFsc2UpIDogdm9pZCAwOwogICAgICAgICAgICAgIGxvY2F0aW9uID0gcGFyc2VkTG9jYXRpb25Bcmc7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgbG9jYXRpb24gPSBsb2NhdGlvbkZyb21Db250ZXh0OwogICAgICAgICAgICB9CgogICAgICAgICAgICB2YXIgcGF0aG5hbWUgPSBsb2NhdGlvbi5wYXRobmFtZSB8fCAiLyI7CiAgICAgICAgICAgIHZhciByZW1haW5pbmdQYXRobmFtZSA9IHBhcmVudFBhdGhuYW1lQmFzZSA9PT0gIi8iID8gcGF0aG5hbWUgOiBwYXRobmFtZS5zbGljZShwYXJlbnRQYXRobmFtZUJhc2UubGVuZ3RoKSB8fCAiLyI7CiAgICAgICAgICAgIHZhciBtYXRjaGVzID0gbWF0Y2hSb3V0ZXMocm91dGVzLCB7CiAgICAgICAgICAgICAgcGF0aG5hbWU6IHJlbWFpbmluZ1BhdGhuYW1lCiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgaWYgKGZhbHNlKSB7fQoKICAgICAgICAgICAgdmFyIHJlbmRlcmVkTWF0Y2hlcyA9IF9yZW5kZXJNYXRjaGVzKG1hdGNoZXMgJiYgbWF0Y2hlcy5tYXAoKG1hdGNoKSA9PiBPYmplY3QuYXNzaWduKHt9LCBtYXRjaCwgewogICAgICAgICAgICAgIHBhcmFtczogT2JqZWN0LmFzc2lnbih7fSwgcGFyZW50UGFyYW1zLCBtYXRjaC5wYXJhbXMpLAogICAgICAgICAgICAgIHBhdGhuYW1lOiByb3V0ZXJfam9pblBhdGhzKFtwYXJlbnRQYXRobmFtZUJhc2UsIC8vIFJlLWVuY29kZSBwYXRobmFtZXMgdGhhdCB3ZXJlIGRlY29kZWQgaW5zaWRlIG1hdGNoUm91dGVzCiAgICAgICAgICAgICAgbmF2aWdhdG9yLmVuY29kZUxvY2F0aW9uID8gbmF2aWdhdG9yLmVuY29kZUxvY2F0aW9uKG1hdGNoLnBhdGhuYW1lKS5wYXRobmFtZSA6IG1hdGNoLnBhdGhuYW1lXSksCiAgICAgICAgICAgICAgcGF0aG5hbWVCYXNlOiBtYXRjaC5wYXRobmFtZUJhc2UgPT09ICIvIiA/IHBhcmVudFBhdGhuYW1lQmFzZSA6IHJvdXRlcl9qb2luUGF0aHMoW3BhcmVudFBhdGhuYW1lQmFzZSwgLy8gUmUtZW5jb2RlIHBhdGhuYW1lcyB0aGF0IHdlcmUgZGVjb2RlZCBpbnNpZGUgbWF0Y2hSb3V0ZXMKICAgICAgICAgICAgICBuYXZpZ2F0b3IuZW5jb2RlTG9jYXRpb24gPyBuYXZpZ2F0b3IuZW5jb2RlTG9jYXRpb24obWF0Y2gucGF0aG5hbWVCYXNlKS5wYXRobmFtZSA6IG1hdGNoLnBhdGhuYW1lQmFzZV0pCiAgICAgICAgICAgIH0pKSwgcGFyZW50TWF0Y2hlcywgZGF0YVJvdXRlclN0YXRlQ29udGV4dCB8fCB1bmRlZmluZWQpOyAvLyBXaGVuIGEgdXNlciBwYXNzZXMgaW4gYSBgbG9jYXRpb25BcmdgLCB0aGUgYXNzb2NpYXRlZCByb3V0ZXMgbmVlZCB0bwogICAgICAgICAgICAvLyBiZSB3cmFwcGVkIGluIGEgbmV3IGBMb2NhdGlvbkNvbnRleHQuUHJvdmlkZXJgIGluIG9yZGVyIGZvciBgdXNlTG9jYXRpb25gCiAgICAgICAgICAgIC8vIHRvIHVzZSB0aGUgc2NvcGVkIGxvY2F0aW9uIGluc3RlYWQgb2YgdGhlIGdsb2JhbCBsb2NhdGlvbi4KCgogICAgICAgICAgICBpZiAobG9jYXRpb25BcmcgJiYgcmVuZGVyZWRNYXRjaGVzKSB7CiAgICAgICAgICAgICAgcmV0dXJuIC8qI19fUFVSRV9fKi9yZWFjdC5jcmVhdGVFbGVtZW50KExvY2F0aW9uQ29udGV4dC5Qcm92aWRlciwgewogICAgICAgICAgICAgICAgdmFsdWU6IHsKICAgICAgICAgICAgICAgICAgbG9jYXRpb246IGRpc3RfZXh0ZW5kcyh7CiAgICAgICAgICAgICAgICAgICAgcGF0aG5hbWU6ICIvIiwKICAgICAgICAgICAgICAgICAgICBzZWFyY2g6ICIiLAogICAgICAgICAgICAgICAgICAgIGhhc2g6ICIiLAogICAgICAgICAgICAgICAgICAgIHN0YXRlOiBudWxsLAogICAgICAgICAgICAgICAgICAgIGtleTogImRlZmF1bHQiCiAgICAgICAgICAgICAgICAgIH0sIGxvY2F0aW9uKSwKICAgICAgICAgICAgICAgICAgbmF2aWdhdGlvblR5cGU6IEFjdGlvbi5Qb3AKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9LCByZW5kZXJlZE1hdGNoZXMpOwogICAgICAgICAgICB9CgogICAgICAgICAgICByZXR1cm4gcmVuZGVyZWRNYXRjaGVzOwogICAgICAgICAgfQoKICAgICAgICAgIGZ1bmN0aW9uIERlZmF1bHRFcnJvckVsZW1lbnQoKSB7CiAgICAgICAgICAgIHZhciBlcnJvciA9IHVzZVJvdXRlRXJyb3IoKTsKICAgICAgICAgICAgdmFyIG1lc3NhZ2UgPSBpc1JvdXRlRXJyb3JSZXNwb25zZShlcnJvcikgPyBlcnJvci5zdGF0dXMgKyAiICIgKyBlcnJvci5zdGF0dXNUZXh0IDogZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiBKU09OLnN0cmluZ2lmeShlcnJvcik7CiAgICAgICAgICAgIHZhciBzdGFjayA9IGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5zdGFjayA6IG51bGw7CiAgICAgICAgICAgIHZhciBsaWdodGdyZXkgPSAicmdiYSgyMDAsMjAwLDIwMCwgMC41KSI7CiAgICAgICAgICAgIHZhciBwcmVTdHlsZXMgPSB7CiAgICAgICAgICAgICAgcGFkZGluZzogIjAuNXJlbSIsCiAgICAgICAgICAgICAgYmFja2dyb3VuZENvbG9yOiBsaWdodGdyZXkKICAgICAgICAgICAgfTsKICAgICAgICAgICAgdmFyIGNvZGVTdHlsZXMgPSB7CiAgICAgICAgICAgICAgcGFkZGluZzogIjJweCA0cHgiLAogICAgICAgICAgICAgIGJhY2tncm91bmRDb2xvcjogbGlnaHRncmV5CiAgICAgICAgICAgIH07CiAgICAgICAgICAgIHJldHVybiAvKiNfX1BVUkVfXyovcmVhY3QuY3JlYXRlRWxlbWVudChyZWFjdC5GcmFnbWVudCwgbnVsbCwgLyojX19QVVJFX18qL3JlYWN0LmNyZWF0ZUVsZW1lbnQoImgyIiwgbnVsbCwgIlVuaGFuZGxlZCBUaHJvd24gRXJyb3IhIiksIC8qI19fUFVSRV9fKi9yZWFjdC5jcmVhdGVFbGVtZW50KCJoMyIsIHsKICAgICAgICAgICAgICBzdHlsZTogewogICAgICAgICAgICAgICAgZm9udFN0eWxlOiAiaXRhbGljIgogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwgbWVzc2FnZSksIHN0YWNrID8gLyojX19QVVJFX18qL3JlYWN0LmNyZWF0ZUVsZW1lbnQoInByZSIsIHsKICAgICAgICAgICAgICBzdHlsZTogcHJlU3R5bGVzCiAgICAgICAgICAgIH0sIHN0YWNrKSA6IG51bGwsIC8qI19fUFVSRV9fKi9yZWFjdC5jcmVhdGVFbGVtZW50KCJwIiwgbnVsbCwgIlx1RDgzRFx1RENCRiBIZXkgZGV2ZWxvcGVyIFx1RDgzRFx1REM0QiIpLCAvKiNfX1BVUkVfXyovcmVhY3QuY3JlYXRlRWxlbWVudCgicCIsIG51bGwsICJZb3UgY2FuIHByb3ZpZGUgYSB3YXkgYmV0dGVyIFVYIHRoYW4gdGhpcyB3aGVuIHlvdXIgYXBwIHRocm93cyBlcnJvcnMgYnkgcHJvdmlkaW5nIHlvdXIgb3duXHhBMCIsIC8qI19fUFVSRV9fKi9yZWFjdC5jcmVhdGVFbGVtZW50KCJjb2RlIiwgewogICAgICAgICAgICAgIHN0eWxlOiBjb2RlU3R5bGVzCiAgICAgICAgICAgIH0sICJlcnJvckVsZW1lbnQiKSwgIiBwcm9wcyBvblx4QTAiLCAvKiNfX1BVUkVfXyovcmVhY3QuY3JlYXRlRWxlbWVudCgiY29kZSIsIHsKICAgICAgICAgICAgICBzdHlsZTogY29kZVN0eWxlcwogICAgICAgICAgICB9LCAiPFJvdXRlPiIpKSk7CiAgICAgICAgICB9dmFyCgogICAgICAgICAgUmVuZGVyRXJyb3JCb3VuZGFyeSA9IC8qI19fUFVSRV9fKi9mdW5jdGlvbiAoX3JlYWN0JENvbXBvbmVudCkge19pbmhlcml0cyhSZW5kZXJFcnJvckJvdW5kYXJ5LCBfcmVhY3QkQ29tcG9uZW50KTt2YXIgX3N1cGVyMiA9IF9jcmVhdGVTdXBlcihSZW5kZXJFcnJvckJvdW5kYXJ5KTsKICAgICAgICAgICAgZnVuY3Rpb24gUmVuZGVyRXJyb3JCb3VuZGFyeShwcm9wcykge3ZhciBfdGhpcztfY2xhc3NDYWxsQ2hlY2syKHRoaXMsIFJlbmRlckVycm9yQm91bmRhcnkpOwogICAgICAgICAgICAgIF90aGlzID0gX3N1cGVyMi5jYWxsKHRoaXMsIHByb3BzKTsKICAgICAgICAgICAgICBfdGhpcy5zdGF0ZSA9IHsKICAgICAgICAgICAgICAgIGxvY2F0aW9uOiBwcm9wcy5sb2NhdGlvbiwKICAgICAgICAgICAgICAgIGVycm9yOiBwcm9wcy5lcnJvcgogICAgICAgICAgICAgIH07cmV0dXJuIF90aGlzOwogICAgICAgICAgICB9X2NyZWF0ZUNsYXNzMihSZW5kZXJFcnJvckJvdW5kYXJ5LCBbeyBrZXk6ICJjb21wb25lbnREaWRDYXRjaCIsIHZhbHVlOgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgogICAgICAgICAgICAgIGZ1bmN0aW9uIGNvbXBvbmVudERpZENhdGNoKGVycm9yLCBlcnJvckluZm8pIHsKICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoIlJlYWN0IFJvdXRlciBjYXVnaHQgdGhlIGZvbGxvd2luZyBlcnJvciBkdXJpbmcgcmVuZGVyIiwgZXJyb3IsIGVycm9ySW5mbyk7CiAgICAgICAgICAgICAgfSB9LCB7IGtleTogInJlbmRlciIsIHZhbHVlOgoKICAgICAgICAgICAgICBmdW5jdGlvbiByZW5kZXIoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5zdGF0ZS5lcnJvciA/IC8qI19fUFVSRV9fKi9yZWFjdC5jcmVhdGVFbGVtZW50KFJvdXRlRXJyb3JDb250ZXh0LlByb3ZpZGVyLCB7CiAgICAgICAgICAgICAgICAgIHZhbHVlOiB0aGlzLnN0YXRlLmVycm9yLAogICAgICAgICAgICAgICAgICBjaGlsZHJlbjogdGhpcy5wcm9wcy5jb21wb25lbnQKICAgICAgICAgICAgICAgIH0pIDogdGhpcy5wcm9wcy5jaGlsZHJlbjsKICAgICAgICAgICAgICB9IH1dLCBbeyBrZXk6ICJnZXREZXJpdmVkU3RhdGVGcm9tRXJyb3IiLCB2YWx1ZTogZnVuY3Rpb24gZ2V0RGVyaXZlZFN0YXRlRnJvbUVycm9yKGVycm9yKSB7cmV0dXJuIHsgZXJyb3I6IGVycm9yIH07fSB9LCB7IGtleTogImdldERlcml2ZWRTdGF0ZUZyb21Qcm9wcyIsIHZhbHVlOiBmdW5jdGlvbiBnZXREZXJpdmVkU3RhdGVGcm9tUHJvcHMocHJvcHMsIHN0YXRlKSB7Ly8gV2hlbiB3ZSBnZXQgaW50byBhbiBlcnJvciBzdGF0ZSwgdGhlIHVzZXIgd2lsbCBsaWtlbHkgY2xpY2sgImJhY2siIHRvIHRoZQogICAgICAgICAgICAgICAgLy8gcHJldmlvdXMgcGFnZSB0aGF0IGRpZG4ndCBoYXZlIGFuIGVycm9yLiBCZWNhdXNlIHRoaXMgd3JhcHMgdGhlIGVudGlyZQogICAgICAgICAgICAgICAgLy8gYXBwbGljYXRpb24sIHRoYXQgd2lsbCBoYXZlIG5vIGVmZmVjdC0tdGhlIGVycm9yIHBhZ2UgY29udGludWVzIHRvIGRpc3BsYXkuCiAgICAgICAgICAgICAgICAvLyBUaGlzIGdpdmVzIHVzIGEgbWVjaGFuaXNtIHRvIHJlY292ZXIgZnJvbSB0aGUgZXJyb3Igd2hlbiB0aGUgbG9jYXRpb24gY2hhbmdlcy4KICAgICAgICAgICAgICAgIC8vCiAgICAgICAgICAgICAgICAvLyBXaGV0aGVyIHdlJ3JlIGluIGFuIGVycm9yIHN0YXRlIG9yIG5vdCwgd2UgdXBkYXRlIHRoZSBsb2NhdGlvbiBpbiBzdGF0ZQogICAgICAgICAgICAgICAgLy8gc28gdGhhdCB3aGVuIHdlIGFyZSBpbiBhbiBlcnJvciBzdGF0ZSwgaXQgZ2V0cyByZXNldCB3aGVuIGEgbmV3IGxvY2F0aW9uCiAgICAgICAgICAgICAgICAvLyBjb21lcyBpbiBhbmQgdGhlIHVzZXIgcmVjb3ZlcnMgZnJvbSB0aGUgZXJyb3IuCiAgICAgICAgICAgICAgICBpZiAoc3RhdGUubG9jYXRpb24gIT09IHByb3BzLmxvY2F0aW9uKSB7cmV0dXJuIHsgZXJyb3I6IHByb3BzLmVycm9yLCBsb2NhdGlvbjogcHJvcHMubG9jYXRpb24gfTt9IC8vIElmIHdlJ3JlIG5vdCBjaGFuZ2luZyBsb2NhdGlvbnMsIHByZXNlcnZlIHRoZSBsb2NhdGlvbiBidXQgc3RpbGwgc3VyZmFjZQogICAgICAgICAgICAgICAgLy8gYW55IG5ldyBlcnJvcnMgdGhhdCBtYXkgY29tZSB0aHJvdWdoLiBXZSByZXRhaW4gdGhlIGV4aXN0aW5nIGVycm9yLCB3ZSBkbwogICAgICAgICAgICAgICAgLy8gdGhpcyBiZWNhdXNlIHRoZSBlcnJvciBwcm92aWRlZCBmcm9tIHRoZSBhcHAgc3RhdGUgbWF5IGJlIGNsZWFyZWQgd2l0aG91dAogICAgICAgICAgICAgICAgLy8gdGhlIGxvY2F0aW9uIGNoYW5naW5nLgogICAgICAgICAgICAgICAgcmV0dXJuIHsgZXJyb3I6IHByb3BzLmVycm9yIHx8IHN0YXRlLmVycm9yLCBsb2NhdGlvbjogc3RhdGUubG9jYXRpb24gfTt9IH1dKTtyZXR1cm4gUmVuZGVyRXJyb3JCb3VuZGFyeTt9KHJlYWN0LkNvbXBvbmVudCk7ZnVuY3Rpb24gUmVuZGVyZWRSb3V0ZShfcmVmKSB7dmFyIHJvdXRlQ29udGV4dCA9IF9yZWYucm91dGVDb250ZXh0LG1hdGNoID0gX3JlZi5tYXRjaCxjaGlsZHJlbiA9IF9yZWYuY2hpbGRyZW47dmFyIGRhdGFTdGF0aWNSb3V0ZXJDb250ZXh0ID0gcmVhY3QudXNlQ29udGV4dChEYXRhU3RhdGljUm91dGVyQ29udGV4dCk7IC8vIFRyYWNrIGhvdyBkZWVwIHdlIGdvdCBpbiBvdXIgcmVuZGVyIHBhc3MgdG8gZW11bGF0ZSBTU1IgY29tcG9uZW50RGlkQ2F0Y2gKICAgICAgICAgICAgLy8gaW4gYSBEYXRhU3RhdGljUm91dGVyCiAgICAgICAgICAgIGlmIChkYXRhU3RhdGljUm91dGVyQ29udGV4dCAmJiBtYXRjaC5yb3V0ZS5lcnJvckVsZW1lbnQpIHtkYXRhU3RhdGljUm91dGVyQ29udGV4dC5fZGVlcGVzdFJlbmRlcmVkQm91bmRhcnlJZCA9IG1hdGNoLnJvdXRlLmlkOwogICAgICAgICAgICB9CgogICAgICAgICAgICByZXR1cm4gLyojX19QVVJFX18qL3JlYWN0LmNyZWF0ZUVsZW1lbnQoUm91dGVDb250ZXh0LlByb3ZpZGVyLCB7CiAgICAgICAgICAgICAgdmFsdWU6IHJvdXRlQ29udGV4dAogICAgICAgICAgICB9LCBjaGlsZHJlbik7CiAgICAgICAgICB9CgogICAgICAgICAgZnVuY3Rpb24gX3JlbmRlck1hdGNoZXMobWF0Y2hlcywgcGFyZW50TWF0Y2hlcywgZGF0YVJvdXRlclN0YXRlKSB7CiAgICAgICAgICAgIGlmIChwYXJlbnRNYXRjaGVzID09PSB2b2lkIDApIHsKICAgICAgICAgICAgICBwYXJlbnRNYXRjaGVzID0gW107CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChtYXRjaGVzID09IG51bGwpIHsKICAgICAgICAgICAgICBpZiAoZGF0YVJvdXRlclN0YXRlICE9IG51bGwgJiYgZGF0YVJvdXRlclN0YXRlLmVycm9ycykgewogICAgICAgICAgICAgICAgLy8gRG9uJ3QgYmFpbCBpZiB3ZSBoYXZlIGRhdGEgcm91dGVyIGVycm9ycyBzbyB3ZSBjYW4gcmVuZGVyIHRoZW0gaW4gdGhlCiAgICAgICAgICAgICAgICAvLyBib3VuZGFyeS4gIFVzZSB0aGUgcHJlLW1hdGNoZWQgKG9yIHNoaW1tZWQpIG1hdGNoZXMKICAgICAgICAgICAgICAgIG1hdGNoZXMgPSBkYXRhUm91dGVyU3RhdGUubWF0Y2hlczsKICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICB2YXIgcmVuZGVyZWRNYXRjaGVzID0gbWF0Y2hlczsgLy8gSWYgd2UgaGF2ZSBkYXRhIGVycm9ycywgdHJpbSBtYXRjaGVzIHRvIHRoZSBoaWdoZXN0IGVycm9yIGJvdW5kYXJ5CgogICAgICAgICAgICB2YXIgZXJyb3JzID0gZGF0YVJvdXRlclN0YXRlID09IG51bGwgPyB2b2lkIDAgOiBkYXRhUm91dGVyU3RhdGUuZXJyb3JzOwoKICAgICAgICAgICAgaWYgKGVycm9ycyAhPSBudWxsKSB7CiAgICAgICAgICAgICAgdmFyIGVycm9ySW5kZXggPSByZW5kZXJlZE1hdGNoZXMuZmluZEluZGV4KChtKSA9PiBtLnJvdXRlLmlkICYmIChlcnJvcnMgPT0gbnVsbCA/IHZvaWQgMCA6IGVycm9yc1ttLnJvdXRlLmlkXSkpOwogICAgICAgICAgICAgICEoZXJyb3JJbmRleCA+PSAwKSA/IGZhbHNlID8gMCA6IHJvdXRlcl9pbnZhcmlhbnQoZmFsc2UpIDogdm9pZCAwOwogICAgICAgICAgICAgIHJlbmRlcmVkTWF0Y2hlcyA9IHJlbmRlcmVkTWF0Y2hlcy5zbGljZSgwLCBNYXRoLm1pbihyZW5kZXJlZE1hdGNoZXMubGVuZ3RoLCBlcnJvckluZGV4ICsgMSkpOwogICAgICAgICAgICB9CgogICAgICAgICAgICByZXR1cm4gcmVuZGVyZWRNYXRjaGVzLnJlZHVjZVJpZ2h0KChvdXRsZXQsIG1hdGNoLCBpbmRleCkgPT4gewogICAgICAgICAgICAgIHZhciBlcnJvciA9IG1hdGNoLnJvdXRlLmlkID8gZXJyb3JzID09IG51bGwgPyB2b2lkIDAgOiBlcnJvcnNbbWF0Y2gucm91dGUuaWRdIDogbnVsbDsgLy8gT25seSBkYXRhIHJvdXRlcnMgaGFuZGxlIGVycm9ycwoKICAgICAgICAgICAgICB2YXIgZXJyb3JFbGVtZW50ID0gZGF0YVJvdXRlclN0YXRlID8gbWF0Y2gucm91dGUuZXJyb3JFbGVtZW50IHx8IC8qI19fUFVSRV9fKi9yZWFjdC5jcmVhdGVFbGVtZW50KERlZmF1bHRFcnJvckVsZW1lbnQsIG51bGwpIDogbnVsbDsKCiAgICAgICAgICAgICAgdmFyIGdldENoaWxkcmVuID0gKCkgPT4gLyojX19QVVJFX18qL3JlYWN0LmNyZWF0ZUVsZW1lbnQoUmVuZGVyZWRSb3V0ZSwgewogICAgICAgICAgICAgICAgbWF0Y2g6IG1hdGNoLAogICAgICAgICAgICAgICAgcm91dGVDb250ZXh0OiB7CiAgICAgICAgICAgICAgICAgIG91dGxldDogb3V0bGV0LAogICAgICAgICAgICAgICAgICBtYXRjaGVzOiBwYXJlbnRNYXRjaGVzLmNvbmNhdChyZW5kZXJlZE1hdGNoZXMuc2xpY2UoMCwgaW5kZXggKyAxKSkKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9LCBlcnJvciA/IGVycm9yRWxlbWVudCA6IG1hdGNoLnJvdXRlLmVsZW1lbnQgIT09IHVuZGVmaW5lZCA/IG1hdGNoLnJvdXRlLmVsZW1lbnQgOiBvdXRsZXQpOyAvLyBPbmx5IHdyYXAgaW4gYW4gZXJyb3IgYm91bmRhcnkgd2l0aGluIGRhdGEgcm91dGVyIHVzYWdlcyB3aGVuIHdlIGhhdmUgYW4KICAgICAgICAgICAgICAvLyBlcnJvckVsZW1lbnQgb24gdGhpcyByb3V0ZS4gIE90aGVyd2lzZSBsZXQgaXQgYnViYmxlIHVwIHRvIGFuIGFuY2VzdG9yCiAgICAgICAgICAgICAgLy8gZXJyb3JFbGVtZW50CgoKICAgICAgICAgICAgICByZXR1cm4gZGF0YVJvdXRlclN0YXRlICYmIChtYXRjaC5yb3V0ZS5lcnJvckVsZW1lbnQgfHwgaW5kZXggPT09IDApID8gLyojX19QVVJFX18qL3JlYWN0LmNyZWF0ZUVsZW1lbnQoUmVuZGVyRXJyb3JCb3VuZGFyeSwgewogICAgICAgICAgICAgICAgbG9jYXRpb246IGRhdGFSb3V0ZXJTdGF0ZS5sb2NhdGlvbiwKICAgICAgICAgICAgICAgIGNvbXBvbmVudDogZXJyb3JFbGVtZW50LAogICAgICAgICAgICAgICAgZXJyb3I6IGVycm9yLAogICAgICAgICAgICAgICAgY2hpbGRyZW46IGdldENoaWxkcmVuKCkKICAgICAgICAgICAgICB9KSA6IGdldENoaWxkcmVuKCk7CiAgICAgICAgICAgIH0sIG51bGwpOwogICAgICAgICAgfQogICAgICAgICAgdmFyIERhdGFSb3V0ZXJIb29rOwoKICAgICAgICAgIChmdW5jdGlvbiAoRGF0YVJvdXRlckhvb2spIHsKICAgICAgICAgICAgRGF0YVJvdXRlckhvb2tbIlVzZVJldmFsaWRhdG9yIl0gPSAidXNlUmV2YWxpZGF0b3IiOwogICAgICAgICAgfSkoRGF0YVJvdXRlckhvb2sgfHwgKERhdGFSb3V0ZXJIb29rID0ge30pKTsKCiAgICAgICAgICB2YXIgRGF0YVJvdXRlclN0YXRlSG9vazsKCiAgICAgICAgICAoZnVuY3Rpb24gKERhdGFSb3V0ZXJTdGF0ZUhvb2spIHsKICAgICAgICAgICAgRGF0YVJvdXRlclN0YXRlSG9va1siVXNlTG9hZGVyRGF0YSJdID0gInVzZUxvYWRlckRhdGEiOwogICAgICAgICAgICBEYXRhUm91dGVyU3RhdGVIb29rWyJVc2VBY3Rpb25EYXRhIl0gPSAidXNlQWN0aW9uRGF0YSI7CiAgICAgICAgICAgIERhdGFSb3V0ZXJTdGF0ZUhvb2tbIlVzZVJvdXRlRXJyb3IiXSA9ICJ1c2VSb3V0ZUVycm9yIjsKICAgICAgICAgICAgRGF0YVJvdXRlclN0YXRlSG9va1siVXNlTmF2aWdhdGlvbiJdID0gInVzZU5hdmlnYXRpb24iOwogICAgICAgICAgICBEYXRhUm91dGVyU3RhdGVIb29rWyJVc2VSb3V0ZUxvYWRlckRhdGEiXSA9ICJ1c2VSb3V0ZUxvYWRlckRhdGEiOwogICAgICAgICAgICBEYXRhUm91dGVyU3RhdGVIb29rWyJVc2VNYXRjaGVzIl0gPSAidXNlTWF0Y2hlcyI7CiAgICAgICAgICAgIERhdGFSb3V0ZXJTdGF0ZUhvb2tbIlVzZVJldmFsaWRhdG9yIl0gPSAidXNlUmV2YWxpZGF0b3IiOwogICAgICAgICAgfSkoRGF0YVJvdXRlclN0YXRlSG9vayB8fCAoRGF0YVJvdXRlclN0YXRlSG9vayA9IHt9KSk7CgogICAgICAgICAgZnVuY3Rpb24gZ2V0RGF0YVJvdXRlckNvbnNvbGVFcnJvcihob29rTmFtZSkgewogICAgICAgICAgICByZXR1cm4gaG9va05hbWUgKyAiIG11c3QgYmUgdXNlZCB3aXRoaW4gYSBkYXRhIHJvdXRlci4gIFNlZSBodHRwczovL3JlYWN0cm91dGVyLmNvbS9lbi9tYWluL3JvdXRlcnMvcGlja2luZy1hLXJvdXRlci4iOwogICAgICAgICAgfQoKICAgICAgICAgIGZ1bmN0aW9uIHVzZURhdGFSb3V0ZXJDb250ZXh0KGhvb2tOYW1lKSB7CiAgICAgICAgICAgIHZhciBjdHggPSBSZWFjdC51c2VDb250ZXh0KERhdGFSb3V0ZXJDb250ZXh0KTsKICAgICAgICAgICAgIWN0eCA/IGZhbHNlID8gMCA6IGludmFyaWFudChmYWxzZSkgOiB2b2lkIDA7CiAgICAgICAgICAgIHJldHVybiBjdHg7CiAgICAgICAgICB9CgogICAgICAgICAgZnVuY3Rpb24gdXNlRGF0YVJvdXRlclN0YXRlKGhvb2tOYW1lKSB7CiAgICAgICAgICAgIHZhciBzdGF0ZSA9IHJlYWN0LnVzZUNvbnRleHQoRGF0YVJvdXRlclN0YXRlQ29udGV4dCk7CiAgICAgICAgICAgICFzdGF0ZSA/IGZhbHNlID8gMCA6IHJvdXRlcl9pbnZhcmlhbnQoZmFsc2UpIDogdm9pZCAwOwogICAgICAgICAgICByZXR1cm4gc3RhdGU7CiAgICAgICAgICB9CiAgICAgICAgICAvKioKICAgICAgICAgICAqIFJldHVybnMgdGhlIGN1cnJlbnQgbmF2aWdhdGlvbiwgZGVmYXVsdGluZyB0byBhbiAiaWRsZSIgbmF2aWdhdGlvbiB3aGVuCiAgICAgICAgICAgKiBubyBuYXZpZ2F0aW9uIGlzIGluIHByb2dyZXNzCiAgICAgICAgICAgKi8KCgogICAgICAgICAgZnVuY3Rpb24gZGlzdF91c2VOYXZpZ2F0aW9uKCkgewogICAgICAgICAgICB2YXIgc3RhdGUgPSB1c2VEYXRhUm91dGVyU3RhdGUoRGF0YVJvdXRlclN0YXRlSG9vay5Vc2VOYXZpZ2F0aW9uKTsKICAgICAgICAgICAgcmV0dXJuIHN0YXRlLm5hdmlnYXRpb247CiAgICAgICAgICB9CiAgICAgICAgICAvKioKICAgICAgICAgICAqIFJldHVybnMgYSByZXZhbGlkYXRlIGZ1bmN0aW9uIGZvciBtYW51YWxseSB0cmlnZ2VyaW5nIHJldmFsaWRhdGlvbiwgYXMgd2VsbAogICAgICAgICAgICogYXMgdGhlIGN1cnJlbnQgc3RhdGUgb2YgYW55IG1hbnVhbCByZXZhbGlkYXRpb25zCiAgICAgICAgICAgKi8KCiAgICAgICAgICBmdW5jdGlvbiB1c2VSZXZhbGlkYXRvcigpIHsKICAgICAgICAgICAgdmFyIGRhdGFSb3V0ZXJDb250ZXh0ID0gdXNlRGF0YVJvdXRlckNvbnRleHQoRGF0YVJvdXRlckhvb2suVXNlUmV2YWxpZGF0b3IpOwogICAgICAgICAgICB2YXIgc3RhdGUgPSB1c2VEYXRhUm91dGVyU3RhdGUoRGF0YVJvdXRlclN0YXRlSG9vay5Vc2VSZXZhbGlkYXRvcik7CiAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgcmV2YWxpZGF0ZTogZGF0YVJvdXRlckNvbnRleHQucm91dGVyLnJldmFsaWRhdGUsCiAgICAgICAgICAgICAgc3RhdGU6IHN0YXRlLnJldmFsaWRhdGlvbgogICAgICAgICAgICB9OwogICAgICAgICAgfQogICAgICAgICAgLyoqCiAgICAgICAgICAgKiBSZXR1cm5zIHRoZSBhY3RpdmUgcm91dGUgbWF0Y2hlcywgdXNlZnVsIGZvciBhY2Nlc3NpbmcgbG9hZGVyRGF0YSBmb3IKICAgICAgICAgICAqIHBhcmVudC9jaGlsZCByb3V0ZXMgb3IgdGhlIHJvdXRlICJoYW5kbGUiIHByb3BlcnR5CiAgICAgICAgICAgKi8KCiAgICAgICAgICBmdW5jdGlvbiBkaXN0X3VzZU1hdGNoZXMoKSB7CiAgICAgICAgICAgIHZhciBfdXNlRGF0YVJvdXRlclN0YXRlID0KCgogICAgICAgICAgICAgIHVzZURhdGFSb3V0ZXJTdGF0ZShEYXRhUm91dGVyU3RhdGVIb29rLlVzZU1hdGNoZXMpLG1hdGNoZXMgPSBfdXNlRGF0YVJvdXRlclN0YXRlLm1hdGNoZXMsbG9hZGVyRGF0YSA9IF91c2VEYXRhUm91dGVyU3RhdGUubG9hZGVyRGF0YTsKICAgICAgICAgICAgcmV0dXJuIFJlYWN0LnVzZU1lbW8oKCkgPT4gbWF0Y2hlcy5tYXAoKG1hdGNoKSA9PiB7CiAgICAgICAgICAgICAgdmFyCiAgICAgICAgICAgICAgICBwYXRobmFtZSA9CgogICAgICAgICAgICAgICAgbWF0Y2gucGF0aG5hbWUscGFyYW1zID0gbWF0Y2gucGFyYW1zOyAvLyBOb3RlOiBUaGlzIHN0cnVjdHVyZSBtYXRjaGVzIHRoYXQgY3JlYXRlZCBieSBjcmVhdGVVc2VNYXRjaGVzTWF0Y2gKICAgICAgICAgICAgICAvLyBpbiB0aGUgQHJlbWl4LXJ1bi9yb3V0ZXIgLCBzbyBpZiB5b3UgY2hhbmdlIHRoaXMgcGxlYXNlIGFsc28gY2hhbmdlCiAgICAgICAgICAgICAgLy8gdGhhdCA6KSAgRXZlbnR1YWxseSB3ZSdsbCBEUlkgdGhpcyB1cAoKICAgICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgaWQ6IG1hdGNoLnJvdXRlLmlkLAogICAgICAgICAgICAgICAgcGF0aG5hbWU6IHBhdGhuYW1lLAogICAgICAgICAgICAgICAgcGFyYW1zOiBwYXJhbXMsCiAgICAgICAgICAgICAgICBkYXRhOiBsb2FkZXJEYXRhW21hdGNoLnJvdXRlLmlkXSwKICAgICAgICAgICAgICAgIGhhbmRsZTogbWF0Y2gucm91dGUuaGFuZGxlCiAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgfSksIFttYXRjaGVzLCBsb2FkZXJEYXRhXSk7CiAgICAgICAgICB9CiAgICAgICAgICAvKioKICAgICAgICAgICAqIFJldHVybnMgdGhlIGxvYWRlciBkYXRhIGZvciB0aGUgbmVhcmVzdCBhbmNlc3RvciBSb3V0ZSBsb2FkZXIKICAgICAgICAgICAqLwoKICAgICAgICAgIGZ1bmN0aW9uIHVzZUxvYWRlckRhdGEoKSB7CiAgICAgICAgICAgIHZhciBzdGF0ZSA9IHVzZURhdGFSb3V0ZXJTdGF0ZShEYXRhUm91dGVyU3RhdGVIb29rLlVzZUxvYWRlckRhdGEpOwogICAgICAgICAgICB2YXIgcm91dGUgPSBSZWFjdC51c2VDb250ZXh0KFJvdXRlQ29udGV4dCk7CiAgICAgICAgICAgICFyb3V0ZSA/IGZhbHNlID8gMCA6IGludmFyaWFudChmYWxzZSkgOiB2b2lkIDA7CiAgICAgICAgICAgIHZhciB0aGlzUm91dGUgPSByb3V0ZS5tYXRjaGVzW3JvdXRlLm1hdGNoZXMubGVuZ3RoIC0gMV07CiAgICAgICAgICAgICF0aGlzUm91dGUucm91dGUuaWQgPyBmYWxzZSA/IDAgOiBpbnZhcmlhbnQoZmFsc2UpIDogdm9pZCAwOwogICAgICAgICAgICByZXR1cm4gc3RhdGUubG9hZGVyRGF0YVt0aGlzUm91dGUucm91dGUuaWRdOwogICAgICAgICAgfQogICAgICAgICAgLyoqCiAgICAgICAgICAgKiBSZXR1cm5zIHRoZSBsb2FkZXJEYXRhIGZvciB0aGUgZ2l2ZW4gcm91dGVJZAogICAgICAgICAgICovCgogICAgICAgICAgZnVuY3Rpb24gdXNlUm91dGVMb2FkZXJEYXRhKHJvdXRlSWQpIHsKICAgICAgICAgICAgdmFyIHN0YXRlID0gdXNlRGF0YVJvdXRlclN0YXRlKERhdGFSb3V0ZXJTdGF0ZUhvb2suVXNlUm91dGVMb2FkZXJEYXRhKTsKICAgICAgICAgICAgcmV0dXJuIHN0YXRlLmxvYWRlckRhdGFbcm91dGVJZF07CiAgICAgICAgICB9CiAgICAgICAgICAvKioKICAgICAgICAgICAqIFJldHVybnMgdGhlIGFjdGlvbiBkYXRhIGZvciB0aGUgbmVhcmVzdCBhbmNlc3RvciBSb3V0ZSBhY3Rpb24KICAgICAgICAgICAqLwoKICAgICAgICAgIGZ1bmN0aW9uIHVzZUFjdGlvbkRhdGEoKSB7CiAgICAgICAgICAgIHZhciBzdGF0ZSA9IHVzZURhdGFSb3V0ZXJTdGF0ZShEYXRhUm91dGVyU3RhdGVIb29rLlVzZUFjdGlvbkRhdGEpOwogICAgICAgICAgICB2YXIgcm91dGUgPSBSZWFjdC51c2VDb250ZXh0KFJvdXRlQ29udGV4dCk7CiAgICAgICAgICAgICFyb3V0ZSA/IGZhbHNlID8gMCA6IGludmFyaWFudChmYWxzZSkgOiB2b2lkIDA7CiAgICAgICAgICAgIHJldHVybiBPYmplY3QudmFsdWVzKChzdGF0ZSA9PSBudWxsID8gdm9pZCAwIDogc3RhdGUuYWN0aW9uRGF0YSkgfHwge30pWzBdOwogICAgICAgICAgfQogICAgICAgICAgLyoqCiAgICAgICAgICAgKiBSZXR1cm5zIHRoZSBuZWFyZXN0IGFuY2VzdG9yIFJvdXRlIGVycm9yLCB3aGljaCBjb3VsZCBiZSBhIGxvYWRlci9hY3Rpb24KICAgICAgICAgICAqIGVycm9yIG9yIGEgcmVuZGVyIGVycm9yLiAgVGhpcyBpcyBpbnRlbmRlZCB0byBiZSBjYWxsZWQgZnJvbSB5b3VyCiAgICAgICAgICAgKiBlcnJvckVsZW1lbnQgdG8gZGlzcGxheSBhIHByb3BlciBlcnJvciBtZXNzYWdlLgogICAgICAgICAgICovCgogICAgICAgICAgZnVuY3Rpb24gdXNlUm91dGVFcnJvcigpIHsKICAgICAgICAgICAgdmFyIF9zdGF0ZSRlcnJvcnM7CgogICAgICAgICAgICB2YXIgZXJyb3IgPSByZWFjdC51c2VDb250ZXh0KFJvdXRlRXJyb3JDb250ZXh0KTsKICAgICAgICAgICAgdmFyIHN0YXRlID0gdXNlRGF0YVJvdXRlclN0YXRlKERhdGFSb3V0ZXJTdGF0ZUhvb2suVXNlUm91dGVFcnJvcik7CiAgICAgICAgICAgIHZhciByb3V0ZSA9IHJlYWN0LnVzZUNvbnRleHQoUm91dGVDb250ZXh0KTsKICAgICAgICAgICAgdmFyIHRoaXNSb3V0ZSA9IHJvdXRlLm1hdGNoZXNbcm91dGUubWF0Y2hlcy5sZW5ndGggLSAxXTsgLy8gSWYgdGhpcyB3YXMgYSByZW5kZXIgZXJyb3IsIHdlIHB1dCBpdCBpbiBhIFJvdXRlRXJyb3IgY29udGV4dCBpbnNpZGUKICAgICAgICAgICAgLy8gb2YgUmVuZGVyRXJyb3JCb3VuZGFyeQoKICAgICAgICAgICAgaWYgKGVycm9yKSB7CiAgICAgICAgICAgICAgcmV0dXJuIGVycm9yOwogICAgICAgICAgICB9CgogICAgICAgICAgICAhcm91dGUgPyBmYWxzZSA/IDAgOiByb3V0ZXJfaW52YXJpYW50KGZhbHNlKSA6IHZvaWQgMDsKICAgICAgICAgICAgIXRoaXNSb3V0ZS5yb3V0ZS5pZCA/IGZhbHNlID8gMCA6IHJvdXRlcl9pbnZhcmlhbnQoZmFsc2UpIDogdm9pZCAwOyAvLyBPdGhlcndpc2UgbG9vayBmb3IgZXJyb3JzIGZyb20gb3VyIGRhdGEgcm91dGVyIHN0YXRlCgogICAgICAgICAgICByZXR1cm4gKF9zdGF0ZSRlcnJvcnMgPSBzdGF0ZS5lcnJvcnMpID09IG51bGwgPyB2b2lkIDAgOiBfc3RhdGUkZXJyb3JzW3RoaXNSb3V0ZS5yb3V0ZS5pZF07CiAgICAgICAgICB9CiAgICAgICAgICAvKioKICAgICAgICAgICAqIFJldHVybnMgdGhlIGhhcHB5LXBhdGggZGF0YSBmcm9tIHRoZSBuZWFyZXN0IGFuY2VzdG9yIDxBd2FpdCAvPiB2YWx1ZQogICAgICAgICAgICovCgogICAgICAgICAgZnVuY3Rpb24gdXNlQXN5bmNWYWx1ZSgpIHsKICAgICAgICAgICAgdmFyIHZhbHVlID0gUmVhY3QudXNlQ29udGV4dChBd2FpdENvbnRleHQpOwogICAgICAgICAgICByZXR1cm4gdmFsdWUgPT0gbnVsbCA/IHZvaWQgMCA6IHZhbHVlLl9kYXRhOwogICAgICAgICAgfQogICAgICAgICAgLyoqCiAgICAgICAgICAgKiBSZXR1cm5zIHRoZSBlcnJvciBmcm9tIHRoZSBuZWFyZXN0IGFuY2VzdG9yIDxBd2FpdCAvPiB2YWx1ZQogICAgICAgICAgICovCgogICAgICAgICAgZnVuY3Rpb24gdXNlQXN5bmNFcnJvcigpIHsKICAgICAgICAgICAgdmFyIHZhbHVlID0gUmVhY3QudXNlQ29udGV4dChBd2FpdENvbnRleHQpOwogICAgICAgICAgICByZXR1cm4gdmFsdWUgPT0gbnVsbCA/IHZvaWQgMCA6IHZhbHVlLl9lcnJvcjsKICAgICAgICAgIH0KICAgICAgICAgIHZhciBhbHJlYWR5V2FybmVkID0ge307CgogICAgICAgICAgZnVuY3Rpb24gd2FybmluZ09uY2Uoa2V5LCBjb25kLCBtZXNzYWdlKSB7CiAgICAgICAgICAgIGlmICghY29uZCAmJiAhYWxyZWFkeVdhcm5lZFtrZXldKSB7CiAgICAgICAgICAgICAgYWxyZWFkeVdhcm5lZFtrZXldID0gdHJ1ZTsKICAgICAgICAgICAgICBmYWxzZSA/IDAgOiB2b2lkIDA7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KCiAgICAgICAgICAvKioKICAgICAgICAgICAqIEdpdmVuIGEgUmVtaXggUm91dGVyIGluc3RhbmNlLCByZW5kZXIgdGhlIGFwcHJvcHJpYXRlIFVJCiAgICAgICAgICAgKi8KICAgICAgICAgIGZ1bmN0aW9uIFJvdXRlclByb3ZpZGVyKF9yZWYpIHsKICAgICAgICAgICAgdmFyCiAgICAgICAgICAgICAgZmFsbGJhY2tFbGVtZW50ID0KCiAgICAgICAgICAgICAgX3JlZi5mYWxsYmFja0VsZW1lbnQscm91dGVyID0gX3JlZi5yb3V0ZXI7CiAgICAgICAgICAgIC8vIFN5bmMgcm91dGVyIHN0YXRlIHRvIG91ciBjb21wb25lbnQgc3RhdGUgdG8gZm9yY2UgcmUtcmVuZGVycwogICAgICAgICAgICB2YXIgc3RhdGUgPSB1c2VTeW5jRXh0ZXJuYWxTdG9yZShyb3V0ZXIuc3Vic2NyaWJlLCAoKSA9PiByb3V0ZXIuc3RhdGUsIC8vIFdlIGhhdmUgdG8gcHJvdmlkZSB0aGlzIHNvIFJlYWN0QDE4IGRvZXNuJ3QgY29tcGxhaW4gZHVyaW5nIGh5ZHJhdGlvbiwKICAgICAgICAgICAgLy8gYnV0IHdlIHBhc3Mgb3VyIHNlcmlhbGl6ZWQgaHlkcmF0aW9uIGRhdGEgaW50byB0aGUgcm91dGVyIHNvIHN0YXRlIGhlcmUKICAgICAgICAgICAgLy8gaXMgYWxyZWFkeSBzeW5jZWQgd2l0aCB3aGF0IHRoZSBzZXJ2ZXIgc2F3CiAgICAgICAgICAgICgpID0+IHJvdXRlci5zdGF0ZSk7CiAgICAgICAgICAgIHZhciBuYXZpZ2F0b3IgPSBSZWFjdC51c2VNZW1vKCgpID0+IHsKICAgICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgY3JlYXRlSHJlZjogcm91dGVyLmNyZWF0ZUhyZWYsCiAgICAgICAgICAgICAgICBlbmNvZGVMb2NhdGlvbjogcm91dGVyLmVuY29kZUxvY2F0aW9uLAogICAgICAgICAgICAgICAgZ286IChuKSA9PiByb3V0ZXIubmF2aWdhdGUobiksCiAgICAgICAgICAgICAgICBwdXNoOiAodG8sIHN0YXRlLCBvcHRzKSA9PiByb3V0ZXIubmF2aWdhdGUodG8sIHsKICAgICAgICAgICAgICAgICAgc3RhdGU6IHN0YXRlLAogICAgICAgICAgICAgICAgICBwcmV2ZW50U2Nyb2xsUmVzZXQ6IG9wdHMgPT0gbnVsbCA/IHZvaWQgMCA6IG9wdHMucHJldmVudFNjcm9sbFJlc2V0CiAgICAgICAgICAgICAgICB9KSwKICAgICAgICAgICAgICAgIHJlcGxhY2U6ICh0bywgc3RhdGUsIG9wdHMpID0+IHJvdXRlci5uYXZpZ2F0ZSh0bywgewogICAgICAgICAgICAgICAgICByZXBsYWNlOiB0cnVlLAogICAgICAgICAgICAgICAgICBzdGF0ZTogc3RhdGUsCiAgICAgICAgICAgICAgICAgIHByZXZlbnRTY3JvbGxSZXNldDogb3B0cyA9PSBudWxsID8gdm9pZCAwIDogb3B0cy5wcmV2ZW50U2Nyb2xsUmVzZXQKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgfSwgW3JvdXRlcl0pOwogICAgICAgICAgICB2YXIgYmFzZW5hbWUgPSByb3V0ZXIuYmFzZW5hbWUgfHwgIi8iOwogICAgICAgICAgICByZXR1cm4gLyojX19QVVJFX18qL1JlYWN0LmNyZWF0ZUVsZW1lbnQoRGF0YVJvdXRlckNvbnRleHQuUHJvdmlkZXIsIHsKICAgICAgICAgICAgICB2YWx1ZTogewogICAgICAgICAgICAgICAgcm91dGVyOiByb3V0ZXIsCiAgICAgICAgICAgICAgICBuYXZpZ2F0b3I6IG5hdmlnYXRvciwKICAgICAgICAgICAgICAgIHN0YXRpYzogZmFsc2UsCiAgICAgICAgICAgICAgICAvLyBEbyB3ZSBuZWVkIHRoaXM/CiAgICAgICAgICAgICAgICBiYXNlbmFtZTogYmFzZW5hbWUKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sIC8qI19fUFVSRV9fKi9SZWFjdC5jcmVhdGVFbGVtZW50KERhdGFSb3V0ZXJTdGF0ZUNvbnRleHQuUHJvdmlkZXIsIHsKICAgICAgICAgICAgICB2YWx1ZTogc3RhdGUKICAgICAgICAgICAgfSwgLyojX19QVVJFX18qL1JlYWN0LmNyZWF0ZUVsZW1lbnQoZGlzdF9Sb3V0ZXIsIHsKICAgICAgICAgICAgICBiYXNlbmFtZTogcm91dGVyLmJhc2VuYW1lLAogICAgICAgICAgICAgIGxvY2F0aW9uOiByb3V0ZXIuc3RhdGUubG9jYXRpb24sCiAgICAgICAgICAgICAgbmF2aWdhdGlvblR5cGU6IHJvdXRlci5zdGF0ZS5oaXN0b3J5QWN0aW9uLAogICAgICAgICAgICAgIG5hdmlnYXRvcjogbmF2aWdhdG9yCiAgICAgICAgICAgIH0sIHJvdXRlci5zdGF0ZS5pbml0aWFsaXplZCA/IC8qI19fUFVSRV9fKi9SZWFjdC5jcmVhdGVFbGVtZW50KFJvdXRlcywgbnVsbCkgOiBmYWxsYmFja0VsZW1lbnQpKSk7CiAgICAgICAgICB9CgogICAgICAgICAgLyoqCiAgICAgICAgICAgKiBBIDxSb3V0ZXI+IHRoYXQgc3RvcmVzIGFsbCBlbnRyaWVzIGluIG1lbW9yeS4KICAgICAgICAgICAqCiAgICAgICAgICAgKiBAc2VlIGh0dHBzOi8vcmVhY3Ryb3V0ZXIuY29tL2RvY3MvZW4vdjYvcm91dGVycy9tZW1vcnktcm91dGVyCiAgICAgICAgICAgKi8KICAgICAgICAgIGZ1bmN0aW9uIE1lbW9yeVJvdXRlcihfcmVmMikgewogICAgICAgICAgICB2YXIKICAgICAgICAgICAgICBiYXNlbmFtZSA9CgoKCiAgICAgICAgICAgICAgX3JlZjIuYmFzZW5hbWUsY2hpbGRyZW4gPSBfcmVmMi5jaGlsZHJlbixpbml0aWFsRW50cmllcyA9IF9yZWYyLmluaXRpYWxFbnRyaWVzLGluaXRpYWxJbmRleCA9IF9yZWYyLmluaXRpYWxJbmRleDsKICAgICAgICAgICAgdmFyIGhpc3RvcnlSZWYgPSByZWFjdC51c2VSZWYoKTsKCiAgICAgICAgICAgIGlmIChoaXN0b3J5UmVmLmN1cnJlbnQgPT0gbnVsbCkgewogICAgICAgICAgICAgIGhpc3RvcnlSZWYuY3VycmVudCA9IHJvdXRlcl9jcmVhdGVNZW1vcnlIaXN0b3J5KHsKICAgICAgICAgICAgICAgIGluaXRpYWxFbnRyaWVzOiBpbml0aWFsRW50cmllcywKICAgICAgICAgICAgICAgIGluaXRpYWxJbmRleDogaW5pdGlhbEluZGV4LAogICAgICAgICAgICAgICAgdjVDb21wYXQ6IHRydWUKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdmFyIGhpc3RvcnkgPSBoaXN0b3J5UmVmLmN1cnJlbnQ7CiAgICAgICAgICAgIHZhciBfcmVhY3QkdXNlU3RhdGUgPSByZWFjdC51c2VTdGF0ZSh7CiAgICAgICAgICAgICAgICBhY3Rpb246IGhpc3RvcnkuYWN0aW9uLAogICAgICAgICAgICAgICAgbG9jYXRpb246IGhpc3RvcnkubG9jYXRpb24KICAgICAgICAgICAgICB9KSxfcmVhY3QkdXNlU3RhdGUyID0gX3NsaWNlZFRvQXJyYXkyKF9yZWFjdCR1c2VTdGF0ZSwgMiksc3RhdGUgPSBfcmVhY3QkdXNlU3RhdGUyWzBdLHNldFN0YXRlID0gX3JlYWN0JHVzZVN0YXRlMlsxXTsKICAgICAgICAgICAgcmVhY3QudXNlTGF5b3V0RWZmZWN0KCgpID0+IGhpc3RvcnkubGlzdGVuKHNldFN0YXRlKSwgW2hpc3RvcnldKTsKICAgICAgICAgICAgcmV0dXJuIC8qI19fUFVSRV9fKi9yZWFjdC5jcmVhdGVFbGVtZW50KGRpc3RfUm91dGVyLCB7CiAgICAgICAgICAgICAgYmFzZW5hbWU6IGJhc2VuYW1lLAogICAgICAgICAgICAgIGNoaWxkcmVuOiBjaGlsZHJlbiwKICAgICAgICAgICAgICBsb2NhdGlvbjogc3RhdGUubG9jYXRpb24sCiAgICAgICAgICAgICAgbmF2aWdhdGlvblR5cGU6IHN0YXRlLmFjdGlvbiwKICAgICAgICAgICAgICBuYXZpZ2F0b3I6IGhpc3RvcnkKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9CgogICAgICAgICAgLyoqCiAgICAgICAgICAgKiBDaGFuZ2VzIHRoZSBjdXJyZW50IGxvY2F0aW9uLgogICAgICAgICAgICoKICAgICAgICAgICAqIE5vdGU6IFRoaXMgQVBJIGlzIG1vc3RseSB1c2VmdWwgaW4gUmVhY3QuQ29tcG9uZW50IHN1YmNsYXNzZXMgdGhhdCBhcmUgbm90CiAgICAgICAgICAgKiBhYmxlIHRvIHVzZSBob29rcy4gSW4gZnVuY3Rpb25hbCBjb21wb25lbnRzLCB3ZSByZWNvbW1lbmQgeW91IHVzZSB0aGUKICAgICAgICAgICAqIGB1c2VOYXZpZ2F0ZWAgaG9vayBpbnN0ZWFkLgogICAgICAgICAgICoKICAgICAgICAgICAqIEBzZWUgaHR0cHM6Ly9yZWFjdHJvdXRlci5jb20vZG9jcy9lbi92Ni9jb21wb25lbnRzL25hdmlnYXRlCiAgICAgICAgICAgKi8KICAgICAgICAgIGZ1bmN0aW9uIE5hdmlnYXRlKF9yZWYzKSB7CiAgICAgICAgICAgIHZhcgogICAgICAgICAgICAgIHRvID0KCgoKICAgICAgICAgICAgICBfcmVmMy50byxyZXBsYWNlID0gX3JlZjMucmVwbGFjZSxzdGF0ZSA9IF9yZWYzLnN0YXRlLHJlbGF0aXZlID0gX3JlZjMucmVsYXRpdmU7CiAgICAgICAgICAgICF1c2VJblJvdXRlckNvbnRleHQoKSA/IGZhbHNlID8gMCA6IHJvdXRlcl9pbnZhcmlhbnQoZmFsc2UpIDogdm9pZCAwOwogICAgICAgICAgICBmYWxzZSA/IDAgOiB2b2lkIDA7CiAgICAgICAgICAgIHZhciBkYXRhUm91dGVyU3RhdGUgPSByZWFjdC51c2VDb250ZXh0KERhdGFSb3V0ZXJTdGF0ZUNvbnRleHQpOwogICAgICAgICAgICB2YXIgbmF2aWdhdGUgPSBkaXN0X3VzZU5hdmlnYXRlKCk7CiAgICAgICAgICAgIHJlYWN0LnVzZUVmZmVjdCgoKSA9PiB7CiAgICAgICAgICAgICAgLy8gQXZvaWQga2lja2luZyBvZmYgbXVsdGlwbGUgbmF2aWdhdGlvbnMgaWYgd2UncmUgaW4gdGhlIG1pZGRsZSBvZiBhCiAgICAgICAgICAgICAgLy8gZGF0YS1yb3V0ZXIgbmF2aWdhdGlvbiwgc2luY2UgY29tcG9uZW50cyBnZXQgcmUtcmVuZGVyZWQgd2hlbiB3ZSBlbnRlcgogICAgICAgICAgICAgIC8vIGEgc3VibWl0dGluZy9sb2FkaW5nIHN0YXRlCiAgICAgICAgICAgICAgaWYgKGRhdGFSb3V0ZXJTdGF0ZSAmJiBkYXRhUm91dGVyU3RhdGUubmF2aWdhdGlvbi5zdGF0ZSAhPT0gImlkbGUiKSB7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBuYXZpZ2F0ZSh0bywgewogICAgICAgICAgICAgICAgcmVwbGFjZTogcmVwbGFjZSwKICAgICAgICAgICAgICAgIHN0YXRlOiBzdGF0ZSwKICAgICAgICAgICAgICAgIHJlbGF0aXZlOiByZWxhdGl2ZQogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9KTsKICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgICB9CgogICAgICAgICAgLyoqCiAgICAgICAgICAgKiBSZW5kZXJzIHRoZSBjaGlsZCByb3V0ZSdzIGVsZW1lbnQsIGlmIHRoZXJlIGlzIG9uZS4KICAgICAgICAgICAqCiAgICAgICAgICAgKiBAc2VlIGh0dHBzOi8vcmVhY3Ryb3V0ZXIuY29tL2RvY3MvZW4vdjYvY29tcG9uZW50cy9vdXRsZXQKICAgICAgICAgICAqLwogICAgICAgICAgZnVuY3Rpb24gT3V0bGV0KHByb3BzKSB7CiAgICAgICAgICAgIHJldHVybiB1c2VPdXRsZXQocHJvcHMuY29udGV4dCk7CiAgICAgICAgICB9CgogICAgICAgICAgLyoqCiAgICAgICAgICAgKiBEZWNsYXJlcyBhbiBlbGVtZW50IHRoYXQgc2hvdWxkIGJlIHJlbmRlcmVkIGF0IGEgY2VydGFpbiBVUkwgcGF0aC4KICAgICAgICAgICAqCiAgICAgICAgICAgKiBAc2VlIGh0dHBzOi8vcmVhY3Ryb3V0ZXIuY29tL2RvY3MvZW4vdjYvY29tcG9uZW50cy9yb3V0ZQogICAgICAgICAgICovCiAgICAgICAgICBmdW5jdGlvbiBSb3V0ZShfcHJvcHMpIHsKICAgICAgICAgICAgZmFsc2UgPyAwIDogcm91dGVyX2ludmFyaWFudChmYWxzZSk7CiAgICAgICAgICB9CgogICAgICAgICAgLyoqCiAgICAgICAgICAgKiBQcm92aWRlcyBsb2NhdGlvbiBjb250ZXh0IGZvciB0aGUgcmVzdCBvZiB0aGUgYXBwLgogICAgICAgICAgICoKICAgICAgICAgICAqIE5vdGU6IFlvdSB1c3VhbGx5IHdvbid0IHJlbmRlciBhIDxSb3V0ZXI+IGRpcmVjdGx5LiBJbnN0ZWFkLCB5b3UnbGwgcmVuZGVyIGEKICAgICAgICAgICAqIHJvdXRlciB0aGF0IGlzIG1vcmUgc3BlY2lmaWMgdG8geW91ciBlbnZpcm9ubWVudCBzdWNoIGFzIGEgPEJyb3dzZXJSb3V0ZXI+CiAgICAgICAgICAgKiBpbiB3ZWIgYnJvd3NlcnMgb3IgYSA8U3RhdGljUm91dGVyPiBmb3Igc2VydmVyIHJlbmRlcmluZy4KICAgICAgICAgICAqCiAgICAgICAgICAgKiBAc2VlIGh0dHBzOi8vcmVhY3Ryb3V0ZXIuY29tL2RvY3MvZW4vdjYvcm91dGVycy9yb3V0ZXIKICAgICAgICAgICAqLwogICAgICAgICAgZnVuY3Rpb24gZGlzdF9Sb3V0ZXIoX3JlZjQpIHsKICAgICAgICAgICAgdmFyIF9yZWY0JGJhc2VuYW1lID0KCgoKCgoKICAgICAgICAgICAgICBfcmVmNC5iYXNlbmFtZSxiYXNlbmFtZVByb3AgPSBfcmVmNCRiYXNlbmFtZSA9PT0gdm9pZCAwID8gIi8iIDogX3JlZjQkYmFzZW5hbWUsX3JlZjQkY2hpbGRyZW4gPSBfcmVmNC5jaGlsZHJlbixjaGlsZHJlbiA9IF9yZWY0JGNoaWxkcmVuID09PSB2b2lkIDAgPyBudWxsIDogX3JlZjQkY2hpbGRyZW4sbG9jYXRpb25Qcm9wID0gX3JlZjQubG9jYXRpb24sX3JlZjQkbmF2aWdhdGlvblR5cGUgPSBfcmVmNC5uYXZpZ2F0aW9uVHlwZSxuYXZpZ2F0aW9uVHlwZSA9IF9yZWY0JG5hdmlnYXRpb25UeXBlID09PSB2b2lkIDAgPyBBY3Rpb24uUG9wIDogX3JlZjQkbmF2aWdhdGlvblR5cGUsbmF2aWdhdG9yID0gX3JlZjQubmF2aWdhdG9yLF9yZWY0JHN0YXRpYyA9IF9yZWY0LnN0YXRpYyxzdGF0aWNQcm9wID0gX3JlZjQkc3RhdGljID09PSB2b2lkIDAgPyBmYWxzZSA6IF9yZWY0JHN0YXRpYzsKICAgICAgICAgICAgISF1c2VJblJvdXRlckNvbnRleHQoKSA/IGZhbHNlID8gMCA6IHJvdXRlcl9pbnZhcmlhbnQoZmFsc2UpIDogdm9pZCAwOyAvLyBQcmVzZXJ2ZSB0cmFpbGluZyBzbGFzaGVzIG9uIGJhc2VuYW1lLCBzbyB3ZSBjYW4gbGV0IHRoZSB1c2VyIGNvbnRyb2wKICAgICAgICAgICAgLy8gdGhlIGVuZm9yY2VtZW50IG9mIHRyYWlsaW5nIHNsYXNoZXMgdGhyb3VnaG91dCB0aGUgYXBwCgogICAgICAgICAgICB2YXIgYmFzZW5hbWUgPSBiYXNlbmFtZVByb3AucmVwbGFjZSgvXlwvKi8sICIvIik7CiAgICAgICAgICAgIHZhciBuYXZpZ2F0aW9uQ29udGV4dCA9IHJlYWN0LnVzZU1lbW8oKCkgPT4gKHsKICAgICAgICAgICAgICBiYXNlbmFtZTogYmFzZW5hbWUsCiAgICAgICAgICAgICAgbmF2aWdhdG9yOiBuYXZpZ2F0b3IsCiAgICAgICAgICAgICAgc3RhdGljOiBzdGF0aWNQcm9wCiAgICAgICAgICAgIH0pLCBbYmFzZW5hbWUsIG5hdmlnYXRvciwgc3RhdGljUHJvcF0pOwoKICAgICAgICAgICAgaWYgKHR5cGVvZiBsb2NhdGlvblByb3AgPT09ICJzdHJpbmciKSB7CiAgICAgICAgICAgICAgbG9jYXRpb25Qcm9wID0gcGFyc2VQYXRoKGxvY2F0aW9uUHJvcCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHZhciBfbG9jYXRpb25Qcm9wID0KCgoKCgogICAgICAgICAgICAgIGxvY2F0aW9uUHJvcCxfbG9jYXRpb25Qcm9wJHBhdGhuYW0gPSBfbG9jYXRpb25Qcm9wLnBhdGhuYW1lLHBhdGhuYW1lID0gX2xvY2F0aW9uUHJvcCRwYXRobmFtID09PSB2b2lkIDAgPyAiLyIgOiBfbG9jYXRpb25Qcm9wJHBhdGhuYW0sX2xvY2F0aW9uUHJvcCRzZWFyY2ggPSBfbG9jYXRpb25Qcm9wLnNlYXJjaCxzZWFyY2ggPSBfbG9jYXRpb25Qcm9wJHNlYXJjaCA9PT0gdm9pZCAwID8gIiIgOiBfbG9jYXRpb25Qcm9wJHNlYXJjaCxfbG9jYXRpb25Qcm9wJGhhc2ggPSBfbG9jYXRpb25Qcm9wLmhhc2gsaGFzaCA9IF9sb2NhdGlvblByb3AkaGFzaCA9PT0gdm9pZCAwID8gIiIgOiBfbG9jYXRpb25Qcm9wJGhhc2gsX2xvY2F0aW9uUHJvcCRzdGF0ZSA9IF9sb2NhdGlvblByb3Auc3RhdGUsc3RhdGUgPSBfbG9jYXRpb25Qcm9wJHN0YXRlID09PSB2b2lkIDAgPyBudWxsIDogX2xvY2F0aW9uUHJvcCRzdGF0ZSxfbG9jYXRpb25Qcm9wJGtleSA9IF9sb2NhdGlvblByb3Aua2V5LGtleSA9IF9sb2NhdGlvblByb3Aka2V5ID09PSB2b2lkIDAgPyAiZGVmYXVsdCIgOiBfbG9jYXRpb25Qcm9wJGtleTsKICAgICAgICAgICAgdmFyIGxvY2F0aW9uID0gcmVhY3QudXNlTWVtbygoKSA9PiB7CiAgICAgICAgICAgICAgdmFyIHRyYWlsaW5nUGF0aG5hbWUgPSBzdHJpcEJhc2VuYW1lKHBhdGhuYW1lLCBiYXNlbmFtZSk7CgogICAgICAgICAgICAgIGlmICh0cmFpbGluZ1BhdGhuYW1lID09IG51bGwpIHsKICAgICAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgIHBhdGhuYW1lOiB0cmFpbGluZ1BhdGhuYW1lLAogICAgICAgICAgICAgICAgc2VhcmNoOiBzZWFyY2gsCiAgICAgICAgICAgICAgICBoYXNoOiBoYXNoLAogICAgICAgICAgICAgICAgc3RhdGU6IHN0YXRlLAogICAgICAgICAgICAgICAga2V5OiBrZXkKICAgICAgICAgICAgICB9OwogICAgICAgICAgICB9LCBbYmFzZW5hbWUsIHBhdGhuYW1lLCBzZWFyY2gsIGhhc2gsIHN0YXRlLCBrZXldKTsKICAgICAgICAgICAgZmFsc2UgPyAwIDogdm9pZCAwOwoKICAgICAgICAgICAgaWYgKGxvY2F0aW9uID09IG51bGwpIHsKICAgICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuIC8qI19fUFVSRV9fKi9yZWFjdC5jcmVhdGVFbGVtZW50KE5hdmlnYXRpb25Db250ZXh0LlByb3ZpZGVyLCB7CiAgICAgICAgICAgICAgdmFsdWU6IG5hdmlnYXRpb25Db250ZXh0CiAgICAgICAgICAgIH0sIC8qI19fUFVSRV9fKi9yZWFjdC5jcmVhdGVFbGVtZW50KExvY2F0aW9uQ29udGV4dC5Qcm92aWRlciwgewogICAgICAgICAgICAgIGNoaWxkcmVuOiBjaGlsZHJlbiwKICAgICAgICAgICAgICB2YWx1ZTogewogICAgICAgICAgICAgICAgbG9jYXRpb246IGxvY2F0aW9uLAogICAgICAgICAgICAgICAgbmF2aWdhdGlvblR5cGU6IG5hdmlnYXRpb25UeXBlCiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KSk7CiAgICAgICAgICB9CgogICAgICAgICAgLyoqCiAgICAgICAgICAgKiBBIGNvbnRhaW5lciBmb3IgYSBuZXN0ZWQgdHJlZSBvZiA8Um91dGU+IGVsZW1lbnRzIHRoYXQgcmVuZGVycyB0aGUgYnJhbmNoCiAgICAgICAgICAgKiB0aGF0IGJlc3QgbWF0Y2hlcyB0aGUgY3VycmVudCBsb2NhdGlvbi4KICAgICAgICAgICAqCiAgICAgICAgICAgKiBAc2VlIGh0dHBzOi8vcmVhY3Ryb3V0ZXIuY29tL2RvY3MvZW4vdjYvY29tcG9uZW50cy9yb3V0ZXMKICAgICAgICAgICAqLwogICAgICAgICAgZnVuY3Rpb24gUm91dGVzKF9yZWY1KSB7CiAgICAgICAgICAgIHZhcgogICAgICAgICAgICAgIGNoaWxkcmVuID0KCiAgICAgICAgICAgICAgX3JlZjUuY2hpbGRyZW4sbG9jYXRpb24gPSBfcmVmNS5sb2NhdGlvbjsKICAgICAgICAgICAgdmFyIGRhdGFSb3V0ZXJDb250ZXh0ID0gcmVhY3QudXNlQ29udGV4dChEYXRhUm91dGVyQ29udGV4dCk7IC8vIFdoZW4gaW4gYSBEYXRhUm91dGVyQ29udGV4dCBfd2l0aG91dF8gY2hpbGRyZW4sIHdlIHVzZSB0aGUgcm91dGVyIHJvdXRlcwogICAgICAgICAgICAvLyBkaXJlY3RseS4gIElmIHdlIGhhdmUgY2hpbGRyZW4sIHRoZW4gd2UncmUgaW4gYSBkZXNjZW5kYW50IHRyZWUgYW5kIHdlCiAgICAgICAgICAgIC8vIG5lZWQgdG8gdXNlIGNoaWxkIHJvdXRlcy4KCiAgICAgICAgICAgIHZhciByb3V0ZXMgPSBkYXRhUm91dGVyQ29udGV4dCAmJiAhY2hpbGRyZW4gPyBkYXRhUm91dGVyQ29udGV4dC5yb3V0ZXIucm91dGVzIDogY3JlYXRlUm91dGVzRnJvbUNoaWxkcmVuKGNoaWxkcmVuKTsKICAgICAgICAgICAgcmV0dXJuIHVzZVJvdXRlcyhyb3V0ZXMsIGxvY2F0aW9uKTsKICAgICAgICAgIH0KCiAgICAgICAgICAvKioKICAgICAgICAgICAqIENvbXBvbmVudCB0byB1c2UgZm9yIHJlbmRlcmluZyBsYXppbHkgbG9hZGVkIGRhdGEgZnJvbSByZXR1cm5pbmcgZGVmZXIoKQogICAgICAgICAgICogaW4gYSBsb2FkZXIgZnVuY3Rpb24KICAgICAgICAgICAqLwogICAgICAgICAgZnVuY3Rpb24gQXdhaXQoX3JlZjYpIHsKICAgICAgICAgICAgdmFyCiAgICAgICAgICAgICAgY2hpbGRyZW4gPQoKCiAgICAgICAgICAgICAgX3JlZjYuY2hpbGRyZW4sZXJyb3JFbGVtZW50ID0gX3JlZjYuZXJyb3JFbGVtZW50LHJlc29sdmUgPSBfcmVmNi5yZXNvbHZlOwogICAgICAgICAgICByZXR1cm4gLyojX19QVVJFX18qL1JlYWN0LmNyZWF0ZUVsZW1lbnQoQXdhaXRFcnJvckJvdW5kYXJ5LCB7CiAgICAgICAgICAgICAgcmVzb2x2ZTogcmVzb2x2ZSwKICAgICAgICAgICAgICBlcnJvckVsZW1lbnQ6IGVycm9yRWxlbWVudAogICAgICAgICAgICB9LCAvKiNfX1BVUkVfXyovUmVhY3QuY3JlYXRlRWxlbWVudChSZXNvbHZlQXdhaXQsIG51bGwsIGNoaWxkcmVuKSk7CiAgICAgICAgICB9CiAgICAgICAgICB2YXIgQXdhaXRSZW5kZXJTdGF0dXM7CgogICAgICAgICAgKGZ1bmN0aW9uIChBd2FpdFJlbmRlclN0YXR1cykgewogICAgICAgICAgICBBd2FpdFJlbmRlclN0YXR1c1tBd2FpdFJlbmRlclN0YXR1c1sicGVuZGluZyJdID0gMF0gPSAicGVuZGluZyI7CiAgICAgICAgICAgIEF3YWl0UmVuZGVyU3RhdHVzW0F3YWl0UmVuZGVyU3RhdHVzWyJzdWNjZXNzIl0gPSAxXSA9ICJzdWNjZXNzIjsKICAgICAgICAgICAgQXdhaXRSZW5kZXJTdGF0dXNbQXdhaXRSZW5kZXJTdGF0dXNbImVycm9yIl0gPSAyXSA9ICJlcnJvciI7CiAgICAgICAgICB9KShBd2FpdFJlbmRlclN0YXR1cyB8fCAoQXdhaXRSZW5kZXJTdGF0dXMgPSB7fSkpOwoKICAgICAgICAgIHZhciBuZXZlclNldHRsZWRQcm9taXNlID0gbmV3IFByb21pc2UoKCkgPT4ge30pO3ZhcgoKICAgICAgICAgIEF3YWl0RXJyb3JCb3VuZGFyeSA9IC8qI19fUFVSRV9fKi9mdW5jdGlvbiAoX3JlYWN0JENvbXBvbmVudDIpIHtfaW5oZXJpdHMoQXdhaXRFcnJvckJvdW5kYXJ5LCBfcmVhY3QkQ29tcG9uZW50Mik7dmFyIF9zdXBlcjMgPSBfY3JlYXRlU3VwZXIoQXdhaXRFcnJvckJvdW5kYXJ5KTsKICAgICAgICAgICAgZnVuY3Rpb24gQXdhaXRFcnJvckJvdW5kYXJ5KHByb3BzKSB7dmFyIF90aGlzMjtfY2xhc3NDYWxsQ2hlY2syKHRoaXMsIEF3YWl0RXJyb3JCb3VuZGFyeSk7CiAgICAgICAgICAgICAgX3RoaXMyID0gX3N1cGVyMy5jYWxsKHRoaXMsIHByb3BzKTsKICAgICAgICAgICAgICBfdGhpczIuc3RhdGUgPSB7CiAgICAgICAgICAgICAgICBlcnJvcjogbnVsbAogICAgICAgICAgICAgIH07cmV0dXJuIF90aGlzMjsKICAgICAgICAgICAgfV9jcmVhdGVDbGFzczIoQXdhaXRFcnJvckJvdW5kYXJ5LCBbeyBrZXk6ICJjb21wb25lbnREaWRDYXRjaCIsIHZhbHVlOgoKCgoKCgoKICAgICAgICAgICAgICBmdW5jdGlvbiBjb21wb25lbnREaWRDYXRjaChlcnJvciwgZXJyb3JJbmZvKSB7CiAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKCI8QXdhaXQ+IGNhdWdodCB0aGUgZm9sbG93aW5nIGVycm9yIGR1cmluZyByZW5kZXIiLCBlcnJvciwgZXJyb3JJbmZvKTsKICAgICAgICAgICAgICB9IH0sIHsga2V5OiAicmVuZGVyIiwgdmFsdWU6CgogICAgICAgICAgICAgIGZ1bmN0aW9uIHJlbmRlcigpIHsKICAgICAgICAgICAgICAgIHZhciBfdGhpcyRwcm9wcyA9CgoKCiAgICAgICAgICAgICAgICAgIHRoaXMucHJvcHMsY2hpbGRyZW4gPSBfdGhpcyRwcm9wcy5jaGlsZHJlbixlcnJvckVsZW1lbnQgPSBfdGhpcyRwcm9wcy5lcnJvckVsZW1lbnQscmVzb2x2ZSA9IF90aGlzJHByb3BzLnJlc29sdmU7CiAgICAgICAgICAgICAgICB2YXIgcHJvbWlzZSA9IG51bGw7CiAgICAgICAgICAgICAgICB2YXIgc3RhdHVzID0gQXdhaXRSZW5kZXJTdGF0dXMucGVuZGluZzsKCiAgICAgICAgICAgICAgICBpZiAoIShyZXNvbHZlIGluc3RhbmNlb2YgUHJvbWlzZSkpIHsKICAgICAgICAgICAgICAgICAgLy8gRGlkbid0IGdldCBhIHByb21pc2UgLSBwcm92aWRlIGFzIGEgcmVzb2x2ZWQgcHJvbWlzZQogICAgICAgICAgICAgICAgICBzdGF0dXMgPSBBd2FpdFJlbmRlclN0YXR1cy5zdWNjZXNzOwogICAgICAgICAgICAgICAgICBwcm9taXNlID0gUHJvbWlzZS5yZXNvbHZlKCk7CiAgICAgICAgICAgICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShwcm9taXNlLCAiX3RyYWNrZWQiLCB7CiAgICAgICAgICAgICAgICAgICAgZ2V0OiAoKSA9PiB0cnVlCiAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkocHJvbWlzZSwgIl9kYXRhIiwgewogICAgICAgICAgICAgICAgICAgIGdldDogKCkgPT4gcmVzb2x2ZQogICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAodGhpcy5zdGF0ZS5lcnJvcikgewogICAgICAgICAgICAgICAgICAvLyBDYXVnaHQgYSByZW5kZXIgZXJyb3IsIHByb3ZpZGUgaXQgYXMgYSByZWplY3RlZCBwcm9taXNlCiAgICAgICAgICAgICAgICAgIHN0YXR1cyA9IEF3YWl0UmVuZGVyU3RhdHVzLmVycm9yOwogICAgICAgICAgICAgICAgICB2YXIgcmVuZGVyRXJyb3IgPSB0aGlzLnN0YXRlLmVycm9yOwogICAgICAgICAgICAgICAgICBwcm9taXNlID0gUHJvbWlzZS5yZWplY3QoKS5jYXRjaCgoKSA9PiB7fSk7IC8vIEF2b2lkIHVuaGFuZGxlZCByZWplY3Rpb24gd2FybmluZ3MKCiAgICAgICAgICAgICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShwcm9taXNlLCAiX3RyYWNrZWQiLCB7CiAgICAgICAgICAgICAgICAgICAgZ2V0OiAoKSA9PiB0cnVlCiAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkocHJvbWlzZSwgIl9lcnJvciIsIHsKICAgICAgICAgICAgICAgICAgICBnZXQ6ICgpID0+IHJlbmRlckVycm9yCiAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfSBlbHNlIGlmIChyZXNvbHZlLl90cmFja2VkKSB7CiAgICAgICAgICAgICAgICAgIC8vIEFscmVhZHkgdHJhY2tlZCBwcm9taXNlIC0gY2hlY2sgY29udGVudHMKICAgICAgICAgICAgICAgICAgcHJvbWlzZSA9IHJlc29sdmU7CiAgICAgICAgICAgICAgICAgIHN0YXR1cyA9IHByb21pc2UuX2Vycm9yICE9PSB1bmRlZmluZWQgPyBBd2FpdFJlbmRlclN0YXR1cy5lcnJvciA6IHByb21pc2UuX2RhdGEgIT09IHVuZGVmaW5lZCA/IEF3YWl0UmVuZGVyU3RhdHVzLnN1Y2Nlc3MgOiBBd2FpdFJlbmRlclN0YXR1cy5wZW5kaW5nOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgLy8gUmF3ICh1bnRyYWNrZWQpIHByb21pc2UgLSB0cmFjayBpdAogICAgICAgICAgICAgICAgICBzdGF0dXMgPSBBd2FpdFJlbmRlclN0YXR1cy5wZW5kaW5nOwogICAgICAgICAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkocmVzb2x2ZSwgIl90cmFja2VkIiwgewogICAgICAgICAgICAgICAgICAgIGdldDogKCkgPT4gdHJ1ZQogICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgcHJvbWlzZSA9IHJlc29sdmUudGhlbigoZGF0YSkgPT4gT2JqZWN0LmRlZmluZVByb3BlcnR5KHJlc29sdmUsICJfZGF0YSIsIHsKICAgICAgICAgICAgICAgICAgICBnZXQ6ICgpID0+IGRhdGEKICAgICAgICAgICAgICAgICAgfSksIChlcnJvcikgPT4gT2JqZWN0LmRlZmluZVByb3BlcnR5KHJlc29sdmUsICJfZXJyb3IiLCB7CiAgICAgICAgICAgICAgICAgICAgZ2V0OiAoKSA9PiBlcnJvcgogICAgICAgICAgICAgICAgICB9KSk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgaWYgKHN0YXR1cyA9PT0gQXdhaXRSZW5kZXJTdGF0dXMuZXJyb3IgJiYgcHJvbWlzZS5fZXJyb3IgaW5zdGFuY2VvZiBBYm9ydGVkRGVmZXJyZWRFcnJvcikgewogICAgICAgICAgICAgICAgICAvLyBGcmVlemUgdGhlIFVJIGJ5IHRocm93aW5nIGEgbmV2ZXIgcmVzb2x2ZWQgcHJvbWlzZQogICAgICAgICAgICAgICAgICB0aHJvdyBuZXZlclNldHRsZWRQcm9taXNlOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGlmIChzdGF0dXMgPT09IEF3YWl0UmVuZGVyU3RhdHVzLmVycm9yICYmICFlcnJvckVsZW1lbnQpIHsKICAgICAgICAgICAgICAgICAgLy8gTm8gZXJyb3JFbGVtZW50LCB0aHJvdyB0byB0aGUgbmVhcmVzdCByb3V0ZS1sZXZlbCBlcnJvciBib3VuZGFyeQogICAgICAgICAgICAgICAgICB0aHJvdyBwcm9taXNlLl9lcnJvcjsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBpZiAoc3RhdHVzID09PSBBd2FpdFJlbmRlclN0YXR1cy5lcnJvcikgewogICAgICAgICAgICAgICAgICAvLyBSZW5kZXIgdmlhIG91ciBlcnJvckVsZW1lbnQKICAgICAgICAgICAgICAgICAgcmV0dXJuIC8qI19fUFVSRV9fKi9SZWFjdC5jcmVhdGVFbGVtZW50KEF3YWl0Q29udGV4dC5Qcm92aWRlciwgewogICAgICAgICAgICAgICAgICAgIHZhbHVlOiBwcm9taXNlLAogICAgICAgICAgICAgICAgICAgIGNoaWxkcmVuOiBlcnJvckVsZW1lbnQKICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgaWYgKHN0YXR1cyA9PT0gQXdhaXRSZW5kZXJTdGF0dXMuc3VjY2VzcykgewogICAgICAgICAgICAgICAgICAvLyBSZW5kZXIgY2hpbGRyZW4gd2l0aCByZXNvbHZlZCB2YWx1ZQogICAgICAgICAgICAgICAgICByZXR1cm4gLyojX19QVVJFX18qL1JlYWN0LmNyZWF0ZUVsZW1lbnQoQXdhaXRDb250ZXh0LlByb3ZpZGVyLCB7CiAgICAgICAgICAgICAgICAgICAgdmFsdWU6IHByb21pc2UsCiAgICAgICAgICAgICAgICAgICAgY2hpbGRyZW46IGNoaWxkcmVuCiAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfSAvLyBUaHJvdyB0byB0aGUgc3VzcGVuc2UgYm91bmRhcnkKCgogICAgICAgICAgICAgICAgdGhyb3cgcHJvbWlzZTsKICAgICAgICAgICAgICB9IH1dLCBbeyBrZXk6ICJnZXREZXJpdmVkU3RhdGVGcm9tRXJyb3IiLCB2YWx1ZTogZnVuY3Rpb24gZ2V0RGVyaXZlZFN0YXRlRnJvbUVycm9yKGVycm9yKSB7cmV0dXJuIHsgZXJyb3I6IGVycm9yIH07fSB9XSk7cmV0dXJuIEF3YWl0RXJyb3JCb3VuZGFyeTt9KHJlYWN0LkNvbXBvbmVudCk7CgoKICAgICAgICAgIC8qKgogICAgICAgICAgICogQHByaXZhdGUKICAgICAgICAgICAqIEluZGlyZWN0aW9uIHRvIGxldmVyYWdlIHVzZUFzeW5jVmFsdWUgZm9yIGEgcmVuZGVyLXByb3AgQVBJIG9uIDxBd2FpdD4KICAgICAgICAgICAqLwoKCiAgICAgICAgICBmdW5jdGlvbiBSZXNvbHZlQXdhaXQoX3JlZjcpIHsKICAgICAgICAgICAgdmFyCiAgICAgICAgICAgIGNoaWxkcmVuID0KICAgICAgICAgICAgX3JlZjcuY2hpbGRyZW47CiAgICAgICAgICAgIHZhciBkYXRhID0gdXNlQXN5bmNWYWx1ZSgpOwoKICAgICAgICAgICAgaWYgKHR5cGVvZiBjaGlsZHJlbiA9PT0gImZ1bmN0aW9uIikgewogICAgICAgICAgICAgIHJldHVybiBjaGlsZHJlbihkYXRhKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuIC8qI19fUFVSRV9fKi9SZWFjdC5jcmVhdGVFbGVtZW50KFJlYWN0LkZyYWdtZW50LCBudWxsLCBjaGlsZHJlbik7CiAgICAgICAgICB9IC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KICAgICAgICAgIC8vIFVUSUxTCiAgICAgICAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCgogICAgICAgICAgLyoqCiAgICAgICAgICAgKiBDcmVhdGVzIGEgcm91dGUgY29uZmlnIGZyb20gYSBSZWFjdCAiY2hpbGRyZW4iIG9iamVjdCwgd2hpY2ggaXMgdXN1YWxseQogICAgICAgICAgICogZWl0aGVyIGEgYDxSb3V0ZT5gIGVsZW1lbnQgb3IgYW4gYXJyYXkgb2YgdGhlbS4gVXNlZCBpbnRlcm5hbGx5IGJ5CiAgICAgICAgICAgKiBgPFJvdXRlcz5gIHRvIGNyZWF0ZSBhIHJvdXRlIGNvbmZpZyBmcm9tIGl0cyBjaGlsZHJlbi4KICAgICAgICAgICAqCiAgICAgICAgICAgKiBAc2VlIGh0dHBzOi8vcmVhY3Ryb3V0ZXIuY29tL2RvY3MvZW4vdjYvdXRpbHMvY3JlYXRlLXJvdXRlcy1mcm9tLWNoaWxkcmVuCiAgICAgICAgICAgKi8KCgogICAgICAgICAgZnVuY3Rpb24gY3JlYXRlUm91dGVzRnJvbUNoaWxkcmVuKGNoaWxkcmVuLCBwYXJlbnRQYXRoKSB7CiAgICAgICAgICAgIGlmIChwYXJlbnRQYXRoID09PSB2b2lkIDApIHsKICAgICAgICAgICAgICBwYXJlbnRQYXRoID0gW107CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHZhciByb3V0ZXMgPSBbXTsKICAgICAgICAgICAgcmVhY3QuQ2hpbGRyZW4uZm9yRWFjaChjaGlsZHJlbiwgKGVsZW1lbnQsIGluZGV4KSA9PiB7CiAgICAgICAgICAgICAgaWYgKCEgLyojX19QVVJFX18qL3JlYWN0LmlzVmFsaWRFbGVtZW50KGVsZW1lbnQpKSB7CiAgICAgICAgICAgICAgICAvLyBJZ25vcmUgbm9uLWVsZW1lbnRzLiBUaGlzIGFsbG93cyBwZW9wbGUgdG8gbW9yZSBlYXNpbHkgaW5saW5lCiAgICAgICAgICAgICAgICAvLyBjb25kaXRpb25hbHMgaW4gdGhlaXIgcm91dGUgY29uZmlnLgogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgaWYgKGVsZW1lbnQudHlwZSA9PT0gcmVhY3QuRnJhZ21lbnQpIHsKICAgICAgICAgICAgICAgIC8vIFRyYW5zcGFyZW50bHkgc3VwcG9ydCBSZWFjdC5GcmFnbWVudCBhbmQgaXRzIGNoaWxkcmVuLgogICAgICAgICAgICAgICAgcm91dGVzLnB1c2guYXBwbHkocm91dGVzLCBjcmVhdGVSb3V0ZXNGcm9tQ2hpbGRyZW4oZWxlbWVudC5wcm9wcy5jaGlsZHJlbiwgcGFyZW50UGF0aCkpOwogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgIShlbGVtZW50LnR5cGUgPT09IFJvdXRlKSA/IGZhbHNlID8gMCA6IHJvdXRlcl9pbnZhcmlhbnQoZmFsc2UpIDogdm9pZCAwOwogICAgICAgICAgICAgICEoIWVsZW1lbnQucHJvcHMuaW5kZXggfHwgIWVsZW1lbnQucHJvcHMuY2hpbGRyZW4pID8gZmFsc2UgPyAwIDogcm91dGVyX2ludmFyaWFudChmYWxzZSkgOiB2b2lkIDA7CiAgICAgICAgICAgICAgdmFyIHRyZWVQYXRoID0gW10uY29uY2F0KF90b0NvbnN1bWFibGVBcnJheTIocGFyZW50UGF0aCksIFtpbmRleF0pOwogICAgICAgICAgICAgIHZhciByb3V0ZSA9IHsKICAgICAgICAgICAgICAgIGlkOiBlbGVtZW50LnByb3BzLmlkIHx8IHRyZWVQYXRoLmpvaW4oIi0iKSwKICAgICAgICAgICAgICAgIGNhc2VTZW5zaXRpdmU6IGVsZW1lbnQucHJvcHMuY2FzZVNlbnNpdGl2ZSwKICAgICAgICAgICAgICAgIGVsZW1lbnQ6IGVsZW1lbnQucHJvcHMuZWxlbWVudCwKICAgICAgICAgICAgICAgIGluZGV4OiBlbGVtZW50LnByb3BzLmluZGV4LAogICAgICAgICAgICAgICAgcGF0aDogZWxlbWVudC5wcm9wcy5wYXRoLAogICAgICAgICAgICAgICAgbG9hZGVyOiBlbGVtZW50LnByb3BzLmxvYWRlciwKICAgICAgICAgICAgICAgIGFjdGlvbjogZWxlbWVudC5wcm9wcy5hY3Rpb24sCiAgICAgICAgICAgICAgICBlcnJvckVsZW1lbnQ6IGVsZW1lbnQucHJvcHMuZXJyb3JFbGVtZW50LAogICAgICAgICAgICAgICAgaGFzRXJyb3JCb3VuZGFyeTogZWxlbWVudC5wcm9wcy5lcnJvckVsZW1lbnQgIT0gbnVsbCwKICAgICAgICAgICAgICAgIHNob3VsZFJldmFsaWRhdGU6IGVsZW1lbnQucHJvcHMuc2hvdWxkUmV2YWxpZGF0ZSwKICAgICAgICAgICAgICAgIGhhbmRsZTogZWxlbWVudC5wcm9wcy5oYW5kbGUKICAgICAgICAgICAgICB9OwoKICAgICAgICAgICAgICBpZiAoZWxlbWVudC5wcm9wcy5jaGlsZHJlbikgewogICAgICAgICAgICAgICAgcm91dGUuY2hpbGRyZW4gPSBjcmVhdGVSb3V0ZXNGcm9tQ2hpbGRyZW4oZWxlbWVudC5wcm9wcy5jaGlsZHJlbiwgdHJlZVBhdGgpOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgcm91dGVzLnB1c2gocm91dGUpOwogICAgICAgICAgICB9KTsKICAgICAgICAgICAgcmV0dXJuIHJvdXRlczsKICAgICAgICAgIH0KICAgICAgICAgIC8qKgogICAgICAgICAgICogUmVuZGVycyB0aGUgcmVzdWx0IG9mIGBtYXRjaFJvdXRlcygpYCBpbnRvIGEgUmVhY3QgZWxlbWVudC4KICAgICAgICAgICAqLwoKICAgICAgICAgIGZ1bmN0aW9uIHJlbmRlck1hdGNoZXMobWF0Y2hlcykgewogICAgICAgICAgICByZXR1cm4gX3JlbmRlck1hdGNoZXMobWF0Y2hlcyk7CiAgICAgICAgICB9CiAgICAgICAgICAvKioKICAgICAgICAgICAqIEBwcml2YXRlCiAgICAgICAgICAgKiBXYWxrIHRoZSByb3V0ZSB0cmVlIGFuZCBhZGQgaGFzRXJyb3JCb3VuZGFyeSBpZiBpdCdzIG5vdCBwcm92aWRlZCwgc28gdGhhdAogICAgICAgICAgICogdXNlcnMgcHJvdmlkaW5nIG1hbnVhbCByb3V0ZSBhcnJheXMgY2FuIGp1c3Qgc3BlY2lmeSBlcnJvckVsZW1lbnQKICAgICAgICAgICAqLwoKICAgICAgICAgIGZ1bmN0aW9uIGVuaGFuY2VNYW51YWxSb3V0ZU9iamVjdHMocm91dGVzKSB7CiAgICAgICAgICAgIHJldHVybiByb3V0ZXMubWFwKChyb3V0ZSkgPT4gewogICAgICAgICAgICAgIHZhciByb3V0ZUNsb25lID0gZGlzdF9leHRlbmRzKHt9LCByb3V0ZSk7CgogICAgICAgICAgICAgIGlmIChyb3V0ZUNsb25lLmhhc0Vycm9yQm91bmRhcnkgPT0gbnVsbCkgewogICAgICAgICAgICAgICAgcm91dGVDbG9uZS5oYXNFcnJvckJvdW5kYXJ5ID0gcm91dGVDbG9uZS5lcnJvckVsZW1lbnQgIT0gbnVsbDsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIGlmIChyb3V0ZUNsb25lLmNoaWxkcmVuKSB7CiAgICAgICAgICAgICAgICByb3V0ZUNsb25lLmNoaWxkcmVuID0gZW5oYW5jZU1hbnVhbFJvdXRlT2JqZWN0cyhyb3V0ZUNsb25lLmNoaWxkcmVuKTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIHJldHVybiByb3V0ZUNsb25lOwogICAgICAgICAgICB9KTsKICAgICAgICAgIH0KCiAgICAgICAgICBmdW5jdGlvbiBjcmVhdGVNZW1vcnlSb3V0ZXIocm91dGVzLCBvcHRzKSB7CiAgICAgICAgICAgIHJldHVybiBjcmVhdGVSb3V0ZXIoewogICAgICAgICAgICAgIGJhc2VuYW1lOiBvcHRzID09IG51bGwgPyB2b2lkIDAgOiBvcHRzLmJhc2VuYW1lLAogICAgICAgICAgICAgIGhpc3Rvcnk6IGNyZWF0ZU1lbW9yeUhpc3RvcnkoewogICAgICAgICAgICAgICAgaW5pdGlhbEVudHJpZXM6IG9wdHMgPT0gbnVsbCA/IHZvaWQgMCA6IG9wdHMuaW5pdGlhbEVudHJpZXMsCiAgICAgICAgICAgICAgICBpbml0aWFsSW5kZXg6IG9wdHMgPT0gbnVsbCA/IHZvaWQgMCA6IG9wdHMuaW5pdGlhbEluZGV4CiAgICAgICAgICAgICAgfSksCiAgICAgICAgICAgICAgaHlkcmF0aW9uRGF0YTogb3B0cyA9PSBudWxsID8gdm9pZCAwIDogb3B0cy5oeWRyYXRpb25EYXRhLAogICAgICAgICAgICAgIHJvdXRlczogZW5oYW5jZU1hbnVhbFJvdXRlT2JqZWN0cyhyb3V0ZXMpCiAgICAgICAgICAgIH0pLmluaXRpYWxpemUoKTsKICAgICAgICAgIH0gLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwoKCgoKICAgICAgICAgIDsgLy8gQ09OQ0FURU5BVEVEIE1PRFVMRTogLi9ub2RlX21vZHVsZXMvcmVhY3Qtcm91dGVyLWRvbS9kaXN0L2luZGV4LmpzCiAgICAgICAgICAvKioKICAgICAgICAgICAqIFJlYWN0IFJvdXRlciBET00gdjYuNC40CiAgICAgICAgICAgKgogICAgICAgICAgICogQ29weXJpZ2h0IChjKSBSZW1peCBTb2Z0d2FyZSBJbmMuCiAgICAgICAgICAgKgogICAgICAgICAgICogVGhpcyBzb3VyY2UgY29kZSBpcyBsaWNlbnNlZCB1bmRlciB0aGUgTUlUIGxpY2Vuc2UgZm91bmQgaW4gdGhlCiAgICAgICAgICAgKiBMSUNFTlNFLm1kIGZpbGUgaW4gdGhlIHJvb3QgZGlyZWN0b3J5IG9mIHRoaXMgc291cmNlIHRyZWUuCiAgICAgICAgICAgKgogICAgICAgICAgICogQGxpY2Vuc2UgTUlUCiAgICAgICAgICAgKi8KCgoKCgogICAgICAgICAgZnVuY3Rpb24gcmVhY3Rfcm91dGVyX2RvbV9kaXN0X2V4dGVuZHMoKSB7CiAgICAgICAgICAgIHJlYWN0X3JvdXRlcl9kb21fZGlzdF9leHRlbmRzID0gT2JqZWN0LmFzc2lnbiA/IE9iamVjdC5hc3NpZ24uYmluZCgpIDogZnVuY3Rpb24gKHRhcmdldCkgewogICAgICAgICAgICAgIGZvciAodmFyIGkgPSAxOyBpIDwgYXJndW1lbnRzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAgICB2YXIgc291cmNlID0gYXJndW1lbnRzW2ldOwoKICAgICAgICAgICAgICAgIGZvciAodmFyIGtleSBpbiBzb3VyY2UpIHsKICAgICAgICAgICAgICAgICAgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChzb3VyY2UsIGtleSkpIHsKICAgICAgICAgICAgICAgICAgICB0YXJnZXRba2V5XSA9IHNvdXJjZVtrZXldOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICByZXR1cm4gdGFyZ2V0OwogICAgICAgICAgICB9OwogICAgICAgICAgICByZXR1cm4gcmVhY3Rfcm91dGVyX2RvbV9kaXN0X2V4dGVuZHMuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgICAgIH0KCiAgICAgICAgICBmdW5jdGlvbiBfb2JqZWN0V2l0aG91dFByb3BlcnRpZXNMb29zZShzb3VyY2UsIGV4Y2x1ZGVkKSB7CiAgICAgICAgICAgIGlmIChzb3VyY2UgPT0gbnVsbCkgcmV0dXJuIHt9OwogICAgICAgICAgICB2YXIgdGFyZ2V0ID0ge307CiAgICAgICAgICAgIHZhciBzb3VyY2VLZXlzID0gT2JqZWN0LmtleXMoc291cmNlKTsKICAgICAgICAgICAgdmFyIGtleSwgaTsKCiAgICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCBzb3VyY2VLZXlzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAga2V5ID0gc291cmNlS2V5c1tpXTsKICAgICAgICAgICAgICBpZiAoZXhjbHVkZWQuaW5kZXhPZihrZXkpID49IDApIGNvbnRpbnVlOwogICAgICAgICAgICAgIHRhcmdldFtrZXldID0gc291cmNlW2tleV07CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybiB0YXJnZXQ7CiAgICAgICAgICB9CgogICAgICAgICAgdmFyIGRlZmF1bHRNZXRob2QgPSAiZ2V0IjsKICAgICAgICAgIHZhciBkZWZhdWx0RW5jVHlwZSA9ICJhcHBsaWNhdGlvbi94LXd3dy1mb3JtLXVybGVuY29kZWQiOwogICAgICAgICAgZnVuY3Rpb24gaXNIdG1sRWxlbWVudChvYmplY3QpIHsKICAgICAgICAgICAgcmV0dXJuIG9iamVjdCAhPSBudWxsICYmIHR5cGVvZiBvYmplY3QudGFnTmFtZSA9PT0gInN0cmluZyI7CiAgICAgICAgICB9CiAgICAgICAgICBmdW5jdGlvbiBpc0J1dHRvbkVsZW1lbnQob2JqZWN0KSB7CiAgICAgICAgICAgIHJldHVybiBpc0h0bWxFbGVtZW50KG9iamVjdCkgJiYgb2JqZWN0LnRhZ05hbWUudG9Mb3dlckNhc2UoKSA9PT0gImJ1dHRvbiI7CiAgICAgICAgICB9CiAgICAgICAgICBmdW5jdGlvbiBpc0Zvcm1FbGVtZW50KG9iamVjdCkgewogICAgICAgICAgICByZXR1cm4gaXNIdG1sRWxlbWVudChvYmplY3QpICYmIG9iamVjdC50YWdOYW1lLnRvTG93ZXJDYXNlKCkgPT09ICJmb3JtIjsKICAgICAgICAgIH0KICAgICAgICAgIGZ1bmN0aW9uIGlzSW5wdXRFbGVtZW50KG9iamVjdCkgewogICAgICAgICAgICByZXR1cm4gaXNIdG1sRWxlbWVudChvYmplY3QpICYmIG9iamVjdC50YWdOYW1lLnRvTG93ZXJDYXNlKCkgPT09ICJpbnB1dCI7CiAgICAgICAgICB9CgogICAgICAgICAgZnVuY3Rpb24gaXNNb2RpZmllZEV2ZW50KGV2ZW50KSB7CiAgICAgICAgICAgIHJldHVybiAhIShldmVudC5tZXRhS2V5IHx8IGV2ZW50LmFsdEtleSB8fCBldmVudC5jdHJsS2V5IHx8IGV2ZW50LnNoaWZ0S2V5KTsKICAgICAgICAgIH0KCiAgICAgICAgICBmdW5jdGlvbiBzaG91bGRQcm9jZXNzTGlua0NsaWNrKGV2ZW50LCB0YXJnZXQpIHsKICAgICAgICAgICAgcmV0dXJuIGV2ZW50LmJ1dHRvbiA9PT0gMCAmJiAoIC8vIElnbm9yZSBldmVyeXRoaW5nIGJ1dCBsZWZ0IGNsaWNrcwogICAgICAgICAgICAhdGFyZ2V0IHx8IHRhcmdldCA9PT0gIl9zZWxmIikgJiYgLy8gTGV0IGJyb3dzZXIgaGFuZGxlICJ0YXJnZXQ9X2JsYW5rIiBldGMuCiAgICAgICAgICAgICFpc01vZGlmaWVkRXZlbnQoZXZlbnQpIC8vIElnbm9yZSBjbGlja3Mgd2l0aCBtb2RpZmllciBrZXlzCiAgICAgICAgICAgIDsKICAgICAgICAgIH0KICAgICAgICAgIC8qKgogICAgICAgICAgICogQ3JlYXRlcyBhIFVSTFNlYXJjaFBhcmFtcyBvYmplY3QgdXNpbmcgdGhlIGdpdmVuIGluaXRpYWxpemVyLgogICAgICAgICAgICoKICAgICAgICAgICAqIFRoaXMgaXMgaWRlbnRpY2FsIHRvIGBuZXcgVVJMU2VhcmNoUGFyYW1zKGluaXQpYCBleGNlcHQgaXQgYWxzbwogICAgICAgICAgICogc3VwcG9ydHMgYXJyYXlzIGFzIHZhbHVlcyBpbiB0aGUgb2JqZWN0IGZvcm0gb2YgdGhlIGluaXRpYWxpemVyCiAgICAgICAgICAgKiBpbnN0ZWFkIG9mIGp1c3Qgc3RyaW5ncy4gVGhpcyBpcyBjb252ZW5pZW50IHdoZW4geW91IG5lZWQgbXVsdGlwbGUKICAgICAgICAgICAqIHZhbHVlcyBmb3IgYSBnaXZlbiBrZXksIGJ1dCBkb24ndCB3YW50IHRvIHVzZSBhbiBhcnJheSBpbml0aWFsaXplci4KICAgICAgICAgICAqCiAgICAgICAgICAgKiBGb3IgZXhhbXBsZSwgaW5zdGVhZCBvZjoKICAgICAgICAgICAqCiAgICAgICAgICAgKiAgIGxldCBzZWFyY2hQYXJhbXMgPSBuZXcgVVJMU2VhcmNoUGFyYW1zKFsKICAgICAgICAgICAqICAgICBbJ3NvcnQnLCAnbmFtZSddLAogICAgICAgICAgICogICAgIFsnc29ydCcsICdwcmljZSddCiAgICAgICAgICAgKiAgIF0pOwogICAgICAgICAgICoKICAgICAgICAgICAqIHlvdSBjYW4gZG86CiAgICAgICAgICAgKgogICAgICAgICAgICogICBsZXQgc2VhcmNoUGFyYW1zID0gY3JlYXRlU2VhcmNoUGFyYW1zKHsKICAgICAgICAgICAqICAgICBzb3J0OiBbJ25hbWUnLCAncHJpY2UnXQogICAgICAgICAgICogICB9KTsKICAgICAgICAgICAqLwoKICAgICAgICAgIGZ1bmN0aW9uIGNyZWF0ZVNlYXJjaFBhcmFtcyhpbml0KSB7CiAgICAgICAgICAgIGlmIChpbml0ID09PSB2b2lkIDApIHsKICAgICAgICAgICAgICBpbml0ID0gIiI7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybiBuZXcgVVJMU2VhcmNoUGFyYW1zKHR5cGVvZiBpbml0ID09PSAic3RyaW5nIiB8fCBBcnJheS5pc0FycmF5KGluaXQpIHx8IGluaXQgaW5zdGFuY2VvZiBVUkxTZWFyY2hQYXJhbXMgPyBpbml0IDogT2JqZWN0LmtleXMoaW5pdCkucmVkdWNlKChtZW1vLCBrZXkpID0+IHsKICAgICAgICAgICAgICB2YXIgdmFsdWUgPSBpbml0W2tleV07CiAgICAgICAgICAgICAgcmV0dXJuIG1lbW8uY29uY2F0KEFycmF5LmlzQXJyYXkodmFsdWUpID8gdmFsdWUubWFwKCh2KSA9PiBba2V5LCB2XSkgOiBbW2tleSwgdmFsdWVdXSk7CiAgICAgICAgICAgIH0sIFtdKSk7CiAgICAgICAgICB9CiAgICAgICAgICBmdW5jdGlvbiBnZXRTZWFyY2hQYXJhbXNGb3JMb2NhdGlvbihsb2NhdGlvblNlYXJjaCwgZGVmYXVsdFNlYXJjaFBhcmFtcykgewogICAgICAgICAgICB2YXIgc2VhcmNoUGFyYW1zID0gY3JlYXRlU2VhcmNoUGFyYW1zKGxvY2F0aW9uU2VhcmNoKTt2YXIgX2l0ZXJhdG9yNyA9IF9jcmVhdGVGb3JPZkl0ZXJhdG9ySGVscGVyMigKCiAgICAgICAgICAgICAgZGVmYXVsdFNlYXJjaFBhcmFtcy5rZXlzKCkpLF9zdGVwNzt0cnkge3ZhciBfbG9vcCA9IGZ1bmN0aW9uIF9sb29wKCkge3ZhciBrZXkgPSBfc3RlcDcudmFsdWU7CiAgICAgICAgICAgICAgICBpZiAoIXNlYXJjaFBhcmFtcy5oYXMoa2V5KSkgewogICAgICAgICAgICAgICAgICBkZWZhdWx0U2VhcmNoUGFyYW1zLmdldEFsbChrZXkpLmZvckVhY2goKHZhbHVlKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgc2VhcmNoUGFyYW1zLmFwcGVuZChrZXksIHZhbHVlKTsKICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9fTtmb3IgKF9pdGVyYXRvcjcucygpOyAhKF9zdGVwNyA9IF9pdGVyYXRvcjcubigpKS5kb25lOykge19sb29wKCk7CiAgICAgICAgICAgICAgfX0gY2F0Y2ggKGVycikge19pdGVyYXRvcjcuZShlcnIpO30gZmluYWxseSB7X2l0ZXJhdG9yNy5mKCk7fQoKICAgICAgICAgICAgcmV0dXJuIHNlYXJjaFBhcmFtczsKICAgICAgICAgIH0KICAgICAgICAgIGZ1bmN0aW9uIGdldEZvcm1TdWJtaXNzaW9uSW5mbyh0YXJnZXQsIGRlZmF1bHRBY3Rpb24sIG9wdGlvbnMpIHsKICAgICAgICAgICAgdmFyIG1ldGhvZDsKICAgICAgICAgICAgdmFyIGFjdGlvbjsKICAgICAgICAgICAgdmFyIGVuY1R5cGU7CiAgICAgICAgICAgIHZhciBmb3JtRGF0YTsKCiAgICAgICAgICAgIGlmIChpc0Zvcm1FbGVtZW50KHRhcmdldCkpIHsKICAgICAgICAgICAgICB2YXIgc3VibWlzc2lvblRyaWdnZXIgPSBvcHRpb25zLnN1Ym1pc3Npb25UcmlnZ2VyOwogICAgICAgICAgICAgIG1ldGhvZCA9IG9wdGlvbnMubWV0aG9kIHx8IHRhcmdldC5nZXRBdHRyaWJ1dGUoIm1ldGhvZCIpIHx8IGRlZmF1bHRNZXRob2Q7CiAgICAgICAgICAgICAgYWN0aW9uID0gb3B0aW9ucy5hY3Rpb24gfHwgdGFyZ2V0LmdldEF0dHJpYnV0ZSgiYWN0aW9uIikgfHwgZGVmYXVsdEFjdGlvbjsKICAgICAgICAgICAgICBlbmNUeXBlID0gb3B0aW9ucy5lbmNUeXBlIHx8IHRhcmdldC5nZXRBdHRyaWJ1dGUoImVuY3R5cGUiKSB8fCBkZWZhdWx0RW5jVHlwZTsKICAgICAgICAgICAgICBmb3JtRGF0YSA9IG5ldyBGb3JtRGF0YSh0YXJnZXQpOwoKICAgICAgICAgICAgICBpZiAoc3VibWlzc2lvblRyaWdnZXIgJiYgc3VibWlzc2lvblRyaWdnZXIubmFtZSkgewogICAgICAgICAgICAgICAgZm9ybURhdGEuYXBwZW5kKHN1Ym1pc3Npb25UcmlnZ2VyLm5hbWUsIHN1Ym1pc3Npb25UcmlnZ2VyLnZhbHVlKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZWxzZSBpZiAoaXNCdXR0b25FbGVtZW50KHRhcmdldCkgfHwgaXNJbnB1dEVsZW1lbnQodGFyZ2V0KSAmJiAodGFyZ2V0LnR5cGUgPT09ICJzdWJtaXQiIHx8IHRhcmdldC50eXBlID09PSAiaW1hZ2UiKSkgewogICAgICAgICAgICAgIHZhciBmb3JtID0gdGFyZ2V0LmZvcm07CgogICAgICAgICAgICAgIGlmIChmb3JtID09IG51bGwpIHsKICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiQ2Fubm90IHN1Ym1pdCBhIDxidXR0b24+IG9yIDxpbnB1dCB0eXBlPVwic3VibWl0XCI+IHdpdGhvdXQgYSA8Zm9ybT4iKTsKICAgICAgICAgICAgICB9IC8vIDxidXR0b24+LzxpbnB1dCB0eXBlPSJzdWJtaXQiPiBtYXkgb3ZlcnJpZGUgYXR0cmlidXRlcyBvZiA8Zm9ybT4KCgogICAgICAgICAgICAgIG1ldGhvZCA9IG9wdGlvbnMubWV0aG9kIHx8IHRhcmdldC5nZXRBdHRyaWJ1dGUoImZvcm1tZXRob2QiKSB8fCBmb3JtLmdldEF0dHJpYnV0ZSgibWV0aG9kIikgfHwgZGVmYXVsdE1ldGhvZDsKICAgICAgICAgICAgICBhY3Rpb24gPSBvcHRpb25zLmFjdGlvbiB8fCB0YXJnZXQuZ2V0QXR0cmlidXRlKCJmb3JtYWN0aW9uIikgfHwgZm9ybS5nZXRBdHRyaWJ1dGUoImFjdGlvbiIpIHx8IGRlZmF1bHRBY3Rpb247CiAgICAgICAgICAgICAgZW5jVHlwZSA9IG9wdGlvbnMuZW5jVHlwZSB8fCB0YXJnZXQuZ2V0QXR0cmlidXRlKCJmb3JtZW5jdHlwZSIpIHx8IGZvcm0uZ2V0QXR0cmlidXRlKCJlbmN0eXBlIikgfHwgZGVmYXVsdEVuY1R5cGU7CiAgICAgICAgICAgICAgZm9ybURhdGEgPSBuZXcgRm9ybURhdGEoZm9ybSk7IC8vIEluY2x1ZGUgbmFtZSArIHZhbHVlIGZyb20gYSA8YnV0dG9uPiwgYXBwZW5kaW5nIGluIGNhc2UgdGhlIGJ1dHRvbiBuYW1lCiAgICAgICAgICAgICAgLy8gbWF0Y2hlcyBhbiBleGlzdGluZyBpbnB1dCBuYW1lCgogICAgICAgICAgICAgIGlmICh0YXJnZXQubmFtZSkgewogICAgICAgICAgICAgICAgZm9ybURhdGEuYXBwZW5kKHRhcmdldC5uYW1lLCB0YXJnZXQudmFsdWUpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBlbHNlIGlmIChpc0h0bWxFbGVtZW50KHRhcmdldCkpIHsKICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIkNhbm5vdCBzdWJtaXQgZWxlbWVudCB0aGF0IGlzIG5vdCA8Zm9ybT4sIDxidXR0b24+LCBvciAiICsgIjxpbnB1dCB0eXBlPVwic3VibWl0fGltYWdlXCI+Iik7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgbWV0aG9kID0gb3B0aW9ucy5tZXRob2QgfHwgZGVmYXVsdE1ldGhvZDsKICAgICAgICAgICAgICBhY3Rpb24gPSBvcHRpb25zLmFjdGlvbiB8fCBkZWZhdWx0QWN0aW9uOwogICAgICAgICAgICAgIGVuY1R5cGUgPSBvcHRpb25zLmVuY1R5cGUgfHwgZGVmYXVsdEVuY1R5cGU7CgogICAgICAgICAgICAgIGlmICh0YXJnZXQgaW5zdGFuY2VvZiBGb3JtRGF0YSkgewogICAgICAgICAgICAgICAgZm9ybURhdGEgPSB0YXJnZXQ7CiAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGZvcm1EYXRhID0gbmV3IEZvcm1EYXRhKCk7CgogICAgICAgICAgICAgICAgaWYgKHRhcmdldCBpbnN0YW5jZW9mIFVSTFNlYXJjaFBhcmFtcykge3ZhciBfaXRlcmF0b3I4ID0gX2NyZWF0ZUZvck9mSXRlcmF0b3JIZWxwZXIyKAogICAgICAgICAgICAgICAgICAgIHRhcmdldCksX3N0ZXA4O3RyeSB7Zm9yIChfaXRlcmF0b3I4LnMoKTsgIShfc3RlcDggPSBfaXRlcmF0b3I4Lm4oKSkuZG9uZTspIHt2YXIgX3N0ZXA4JHZhbHVlID0gX3NsaWNlZFRvQXJyYXkyKF9zdGVwOC52YWx1ZSwgMiksbmFtZSA9IF9zdGVwOCR2YWx1ZVswXSx2YWx1ZSA9IF9zdGVwOCR2YWx1ZVsxXTsKICAgICAgICAgICAgICAgICAgICAgIGZvcm1EYXRhLmFwcGVuZChuYW1lLCB2YWx1ZSk7CiAgICAgICAgICAgICAgICAgICAgfX0gY2F0Y2ggKGVycikge19pdGVyYXRvcjguZShlcnIpO30gZmluYWxseSB7X2l0ZXJhdG9yOC5mKCk7fQogICAgICAgICAgICAgICAgfSBlbHNlIGlmICh0YXJnZXQgIT0gbnVsbCkgewogICAgICAgICAgICAgICAgICBmb3IgKHZhciBfaTIgPSAwLCBfT2JqZWN0JGtleXMgPSBPYmplY3Qua2V5cyh0YXJnZXQpOyBfaTIgPCBfT2JqZWN0JGtleXMubGVuZ3RoOyBfaTIrKykge3ZhciBfbmFtZSA9IF9PYmplY3Qka2V5c1tfaTJdOwogICAgICAgICAgICAgICAgICAgIGZvcm1EYXRhLmFwcGVuZChfbmFtZSwgdGFyZ2V0W19uYW1lXSk7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHZhciBfd2luZG93JGxvY2F0aW9uMiA9CgoKICAgICAgICAgICAgICB3aW5kb3cubG9jYXRpb24scHJvdG9jb2wgPSBfd2luZG93JGxvY2F0aW9uMi5wcm90b2NvbCxob3N0ID0gX3dpbmRvdyRsb2NhdGlvbjIuaG9zdDsKICAgICAgICAgICAgdmFyIHVybCA9IG5ldyBVUkwoYWN0aW9uLCBwcm90b2NvbCArICIvLyIgKyBob3N0KTsKICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICB1cmw6IHVybCwKICAgICAgICAgICAgICBtZXRob2Q6IG1ldGhvZCwKICAgICAgICAgICAgICBlbmNUeXBlOiBlbmNUeXBlLAogICAgICAgICAgICAgIGZvcm1EYXRhOiBmb3JtRGF0YQogICAgICAgICAgICB9OwogICAgICAgICAgfQoKICAgICAgICAgIHZhciBfZXhjbHVkZWQgPSBbIm9uQ2xpY2siLCAicmVsYXRpdmUiLCAicmVsb2FkRG9jdW1lbnQiLCAicmVwbGFjZSIsICJzdGF0ZSIsICJ0YXJnZXQiLCAidG8iLCAicHJldmVudFNjcm9sbFJlc2V0Il0sCiAgICAgICAgICAgIF9leGNsdWRlZDIgPSBbImFyaWEtY3VycmVudCIsICJjYXNlU2Vuc2l0aXZlIiwgImNsYXNzTmFtZSIsICJlbmQiLCAic3R5bGUiLCAidG8iLCAiY2hpbGRyZW4iXSwKICAgICAgICAgICAgX2V4Y2x1ZGVkMyA9IC8qIHVudXNlZCBwdXJlIGV4cHJlc3Npb24gb3Igc3VwZXIgKi9udWxsICYmIFsicmVsb2FkRG9jdW1lbnQiLCAicmVwbGFjZSIsICJtZXRob2QiLCAiYWN0aW9uIiwgIm9uU3VibWl0IiwgImZldGNoZXJLZXkiLCAicm91dGVJZCIsICJyZWxhdGl2ZSJdOwogICAgICAgICAgLy8jcmVnaW9uIFJvdXRlcnMKICAgICAgICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCgogICAgICAgICAgZnVuY3Rpb24gY3JlYXRlQnJvd3NlclJvdXRlcihyb3V0ZXMsIG9wdHMpIHsKICAgICAgICAgICAgcmV0dXJuIGNyZWF0ZVJvdXRlcih7CiAgICAgICAgICAgICAgYmFzZW5hbWU6IG9wdHMgPT0gbnVsbCA/IHZvaWQgMCA6IG9wdHMuYmFzZW5hbWUsCiAgICAgICAgICAgICAgaGlzdG9yeTogY3JlYXRlQnJvd3Nlckhpc3RvcnkoewogICAgICAgICAgICAgICAgd2luZG93OiBvcHRzID09IG51bGwgPyB2b2lkIDAgOiBvcHRzLndpbmRvdwogICAgICAgICAgICAgIH0pLAogICAgICAgICAgICAgIGh5ZHJhdGlvbkRhdGE6IChvcHRzID09IG51bGwgPyB2b2lkIDAgOiBvcHRzLmh5ZHJhdGlvbkRhdGEpIHx8IHBhcnNlSHlkcmF0aW9uRGF0YSgpLAogICAgICAgICAgICAgIHJvdXRlczogVU5TQUZFX2VuaGFuY2VNYW51YWxSb3V0ZU9iamVjdHMocm91dGVzKQogICAgICAgICAgICB9KS5pbml0aWFsaXplKCk7CiAgICAgICAgICB9CiAgICAgICAgICBmdW5jdGlvbiBjcmVhdGVIYXNoUm91dGVyKHJvdXRlcywgb3B0cykgewogICAgICAgICAgICByZXR1cm4gY3JlYXRlUm91dGVyKHsKICAgICAgICAgICAgICBiYXNlbmFtZTogb3B0cyA9PSBudWxsID8gdm9pZCAwIDogb3B0cy5iYXNlbmFtZSwKICAgICAgICAgICAgICBoaXN0b3J5OiBjcmVhdGVIYXNoSGlzdG9yeSh7CiAgICAgICAgICAgICAgICB3aW5kb3c6IG9wdHMgPT0gbnVsbCA/IHZvaWQgMCA6IG9wdHMud2luZG93CiAgICAgICAgICAgICAgfSksCiAgICAgICAgICAgICAgaHlkcmF0aW9uRGF0YTogKG9wdHMgPT0gbnVsbCA/IHZvaWQgMCA6IG9wdHMuaHlkcmF0aW9uRGF0YSkgfHwgcGFyc2VIeWRyYXRpb25EYXRhKCksCiAgICAgICAgICAgICAgcm91dGVzOiBVTlNBRkVfZW5oYW5jZU1hbnVhbFJvdXRlT2JqZWN0cyhyb3V0ZXMpCiAgICAgICAgICAgIH0pLmluaXRpYWxpemUoKTsKICAgICAgICAgIH0KCiAgICAgICAgICBmdW5jdGlvbiBwYXJzZUh5ZHJhdGlvbkRhdGEoKSB7CiAgICAgICAgICAgIHZhciBfd2luZG93OwoKICAgICAgICAgICAgdmFyIHN0YXRlID0gKF93aW5kb3cgPSB3aW5kb3cpID09IG51bGwgPyB2b2lkIDAgOiBfd2luZG93Ll9fc3RhdGljUm91dGVySHlkcmF0aW9uRGF0YTsKCiAgICAgICAgICAgIGlmIChzdGF0ZSAmJiBzdGF0ZS5lcnJvcnMpIHsKICAgICAgICAgICAgICBzdGF0ZSA9IHJlYWN0X3JvdXRlcl9kb21fZGlzdF9leHRlbmRzKHt9LCBzdGF0ZSwgewogICAgICAgICAgICAgICAgZXJyb3JzOiBkZXNlcmlhbGl6ZUVycm9ycyhzdGF0ZS5lcnJvcnMpCiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybiBzdGF0ZTsKICAgICAgICAgIH0KCiAgICAgICAgICBmdW5jdGlvbiBkZXNlcmlhbGl6ZUVycm9ycyhlcnJvcnMpIHsKICAgICAgICAgICAgaWYgKCFlcnJvcnMpIHJldHVybiBudWxsOwogICAgICAgICAgICB2YXIgZW50cmllcyA9IE9iamVjdC5lbnRyaWVzKGVycm9ycyk7CiAgICAgICAgICAgIHZhciBzZXJpYWxpemVkID0ge307CgogICAgICAgICAgICBmb3IgKHZhciBfaTMgPSAwLCBfZW50cmllcyA9IGVudHJpZXM7IF9pMyA8IF9lbnRyaWVzLmxlbmd0aDsgX2kzKyspIHt2YXIgX2VudHJpZXMkX2kgPSBfc2xpY2VkVG9BcnJheTIoX2VudHJpZXNbX2kzXSwgMiksa2V5ID0gX2VudHJpZXMkX2lbMF0sdmFsID0gX2VudHJpZXMkX2lbMV07CiAgICAgICAgICAgICAgLy8gSGV5IHlvdSEgIElmIHlvdSBjaGFuZ2UgdGhpcywgcGxlYXNlIGNoYW5nZSB0aGUgY29ycmVzcG9uZGluZyBsb2dpYyBpbgogICAgICAgICAgICAgIC8vIHNlcmlhbGl6ZUVycm9ycyBpbiByZWFjdC1yb3V0ZXItZG9tL3NlcnZlci50c3ggOikKICAgICAgICAgICAgICBpZiAodmFsICYmIHZhbC5fX3R5cGUgPT09ICJSb3V0ZUVycm9yUmVzcG9uc2UiKSB7CiAgICAgICAgICAgICAgICBzZXJpYWxpemVkW2tleV0gPSBuZXcgRXJyb3JSZXNwb25zZSh2YWwuc3RhdHVzLCB2YWwuc3RhdHVzVGV4dCwgdmFsLmRhdGEsIHZhbC5pbnRlcm5hbCA9PT0gdHJ1ZSk7CiAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHNlcmlhbGl6ZWRba2V5XSA9IHZhbDsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybiBzZXJpYWxpemVkOwogICAgICAgICAgfQogICAgICAgICAgLyoqCiAgICAgICAgICAgKiBBIGA8Um91dGVyPmAgZm9yIHVzZSBpbiB3ZWIgYnJvd3NlcnMuIFByb3ZpZGVzIHRoZSBjbGVhbmVzdCBVUkxzLgogICAgICAgICAgICovCgoKICAgICAgICAgIGZ1bmN0aW9uIEJyb3dzZXJSb3V0ZXIoX3JlZikgewogICAgICAgICAgICB2YXIKICAgICAgICAgICAgICBiYXNlbmFtZSA9CgoKICAgICAgICAgICAgICBfcmVmLmJhc2VuYW1lLGNoaWxkcmVuID0gX3JlZi5jaGlsZHJlbix3aW5kb3cgPSBfcmVmLndpbmRvdzsKICAgICAgICAgICAgdmFyIGhpc3RvcnlSZWYgPSBSZWFjdC51c2VSZWYoKTsKCiAgICAgICAgICAgIGlmIChoaXN0b3J5UmVmLmN1cnJlbnQgPT0gbnVsbCkgewogICAgICAgICAgICAgIGhpc3RvcnlSZWYuY3VycmVudCA9IGNyZWF0ZUJyb3dzZXJIaXN0b3J5KHsKICAgICAgICAgICAgICAgIHdpbmRvdzogd2luZG93LAogICAgICAgICAgICAgICAgdjVDb21wYXQ6IHRydWUKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdmFyIGhpc3RvcnkgPSBoaXN0b3J5UmVmLmN1cnJlbnQ7CiAgICAgICAgICAgIHZhciBfUmVhY3QkdXNlU3RhdGUgPSBSZWFjdC51c2VTdGF0ZSh7CiAgICAgICAgICAgICAgICBhY3Rpb246IGhpc3RvcnkuYWN0aW9uLAogICAgICAgICAgICAgICAgbG9jYXRpb246IGhpc3RvcnkubG9jYXRpb24KICAgICAgICAgICAgICB9KSxfUmVhY3QkdXNlU3RhdGUyID0gX3NsaWNlZFRvQXJyYXkyKF9SZWFjdCR1c2VTdGF0ZSwgMiksc3RhdGUgPSBfUmVhY3QkdXNlU3RhdGUyWzBdLHNldFN0YXRlID0gX1JlYWN0JHVzZVN0YXRlMlsxXTsKICAgICAgICAgICAgUmVhY3QudXNlTGF5b3V0RWZmZWN0KCgpID0+IGhpc3RvcnkubGlzdGVuKHNldFN0YXRlKSwgW2hpc3RvcnldKTsKICAgICAgICAgICAgcmV0dXJuIC8qI19fUFVSRV9fKi9SZWFjdC5jcmVhdGVFbGVtZW50KFJvdXRlciwgewogICAgICAgICAgICAgIGJhc2VuYW1lOiBiYXNlbmFtZSwKICAgICAgICAgICAgICBjaGlsZHJlbjogY2hpbGRyZW4sCiAgICAgICAgICAgICAgbG9jYXRpb246IHN0YXRlLmxvY2F0aW9uLAogICAgICAgICAgICAgIG5hdmlnYXRpb25UeXBlOiBzdGF0ZS5hY3Rpb24sCiAgICAgICAgICAgICAgbmF2aWdhdG9yOiBoaXN0b3J5CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfQogICAgICAgICAgLyoqCiAgICAgICAgICAgKiBBIGA8Um91dGVyPmAgZm9yIHVzZSBpbiB3ZWIgYnJvd3NlcnMuIFN0b3JlcyB0aGUgbG9jYXRpb24gaW4gdGhlIGhhc2gKICAgICAgICAgICAqIHBvcnRpb24gb2YgdGhlIFVSTCBzbyBpdCBpcyBub3Qgc2VudCB0byB0aGUgc2VydmVyLgogICAgICAgICAgICovCgogICAgICAgICAgZnVuY3Rpb24gSGFzaFJvdXRlcihfcmVmMikgewogICAgICAgICAgICB2YXIKICAgICAgICAgICAgICBiYXNlbmFtZSA9CgoKICAgICAgICAgICAgICBfcmVmMi5iYXNlbmFtZSxjaGlsZHJlbiA9IF9yZWYyLmNoaWxkcmVuLHdpbmRvdyA9IF9yZWYyLndpbmRvdzsKICAgICAgICAgICAgdmFyIGhpc3RvcnlSZWYgPSBSZWFjdC51c2VSZWYoKTsKCiAgICAgICAgICAgIGlmIChoaXN0b3J5UmVmLmN1cnJlbnQgPT0gbnVsbCkgewogICAgICAgICAgICAgIGhpc3RvcnlSZWYuY3VycmVudCA9IGNyZWF0ZUhhc2hIaXN0b3J5KHsKICAgICAgICAgICAgICAgIHdpbmRvdzogd2luZG93LAogICAgICAgICAgICAgICAgdjVDb21wYXQ6IHRydWUKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdmFyIGhpc3RvcnkgPSBoaXN0b3J5UmVmLmN1cnJlbnQ7CiAgICAgICAgICAgIHZhciBfUmVhY3QkdXNlU3RhdGUzID0gUmVhY3QudXNlU3RhdGUoewogICAgICAgICAgICAgICAgYWN0aW9uOiBoaXN0b3J5LmFjdGlvbiwKICAgICAgICAgICAgICAgIGxvY2F0aW9uOiBoaXN0b3J5LmxvY2F0aW9uCiAgICAgICAgICAgICAgfSksX1JlYWN0JHVzZVN0YXRlNCA9IF9zbGljZWRUb0FycmF5MihfUmVhY3QkdXNlU3RhdGUzLCAyKSxzdGF0ZSA9IF9SZWFjdCR1c2VTdGF0ZTRbMF0sc2V0U3RhdGUgPSBfUmVhY3QkdXNlU3RhdGU0WzFdOwogICAgICAgICAgICBSZWFjdC51c2VMYXlvdXRFZmZlY3QoKCkgPT4gaGlzdG9yeS5saXN0ZW4oc2V0U3RhdGUpLCBbaGlzdG9yeV0pOwogICAgICAgICAgICByZXR1cm4gLyojX19QVVJFX18qL1JlYWN0LmNyZWF0ZUVsZW1lbnQoUm91dGVyLCB7CiAgICAgICAgICAgICAgYmFzZW5hbWU6IGJhc2VuYW1lLAogICAgICAgICAgICAgIGNoaWxkcmVuOiBjaGlsZHJlbiwKICAgICAgICAgICAgICBsb2NhdGlvbjogc3RhdGUubG9jYXRpb24sCiAgICAgICAgICAgICAgbmF2aWdhdGlvblR5cGU6IHN0YXRlLmFjdGlvbiwKICAgICAgICAgICAgICBuYXZpZ2F0b3I6IGhpc3RvcnkKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9CiAgICAgICAgICAvKioKICAgICAgICAgICAqIEEgYDxSb3V0ZXI+YCB0aGF0IGFjY2VwdHMgYSBwcmUtaW5zdGFudGlhdGVkIGhpc3Rvcnkgb2JqZWN0LiBJdCdzIGltcG9ydGFudAogICAgICAgICAgICogdG8gbm90ZSB0aGF0IHVzaW5nIHlvdXIgb3duIGhpc3Rvcnkgb2JqZWN0IGlzIGhpZ2hseSBkaXNjb3VyYWdlZCBhbmQgbWF5IGFkZAogICAgICAgICAgICogdHdvIHZlcnNpb25zIG9mIHRoZSBoaXN0b3J5IGxpYnJhcnkgdG8geW91ciBidW5kbGVzIHVubGVzcyB5b3UgdXNlIHRoZSBzYW1lCiAgICAgICAgICAgKiB2ZXJzaW9uIG9mIHRoZSBoaXN0b3J5IGxpYnJhcnkgdGhhdCBSZWFjdCBSb3V0ZXIgdXNlcyBpbnRlcm5hbGx5LgogICAgICAgICAgICovCgogICAgICAgICAgZnVuY3Rpb24gSGlzdG9yeVJvdXRlcihfcmVmMykgewogICAgICAgICAgICB2YXIKICAgICAgICAgICAgICBiYXNlbmFtZSA9CgoKICAgICAgICAgICAgICBfcmVmMy5iYXNlbmFtZSxjaGlsZHJlbiA9IF9yZWYzLmNoaWxkcmVuLGhpc3RvcnkgPSBfcmVmMy5oaXN0b3J5OwogICAgICAgICAgICB2YXIgX1JlYWN0JHVzZVN0YXRlNSA9IFJlYWN0LnVzZVN0YXRlKHsKICAgICAgICAgICAgICAgIGFjdGlvbjogaGlzdG9yeS5hY3Rpb24sCiAgICAgICAgICAgICAgICBsb2NhdGlvbjogaGlzdG9yeS5sb2NhdGlvbgogICAgICAgICAgICAgIH0pLF9SZWFjdCR1c2VTdGF0ZTYgPSBfc2xpY2VkVG9BcnJheTIoX1JlYWN0JHVzZVN0YXRlNSwgMiksc3RhdGUgPSBfUmVhY3QkdXNlU3RhdGU2WzBdLHNldFN0YXRlID0gX1JlYWN0JHVzZVN0YXRlNlsxXTsKICAgICAgICAgICAgUmVhY3QudXNlTGF5b3V0RWZmZWN0KCgpID0+IGhpc3RvcnkubGlzdGVuKHNldFN0YXRlKSwgW2hpc3RvcnldKTsKICAgICAgICAgICAgcmV0dXJuIC8qI19fUFVSRV9fKi9SZWFjdC5jcmVhdGVFbGVtZW50KFJvdXRlciwgewogICAgICAgICAgICAgIGJhc2VuYW1lOiBiYXNlbmFtZSwKICAgICAgICAgICAgICBjaGlsZHJlbjogY2hpbGRyZW4sCiAgICAgICAgICAgICAgbG9jYXRpb246IHN0YXRlLmxvY2F0aW9uLAogICAgICAgICAgICAgIG5hdmlnYXRpb25UeXBlOiBzdGF0ZS5hY3Rpb24sCiAgICAgICAgICAgICAgbmF2aWdhdG9yOiBoaXN0b3J5CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfQoKICAgICAgICAgIGlmIChmYWxzZSkge30KICAgICAgICAgIC8qKgogICAgICAgICAgICogVGhlIHB1YmxpYyBBUEkgZm9yIHJlbmRlcmluZyBhIGhpc3RvcnktYXdhcmUgPGE+LgogICAgICAgICAgICovCgogICAgICAgICAgdmFyIExpbmsgPSAvKiNfX1BVUkVfXyovcmVhY3QuZm9yd2FyZFJlZihmdW5jdGlvbiBMaW5rV2l0aFJlZihfcmVmNCwgcmVmKSB7CiAgICAgICAgICAgIHZhcgogICAgICAgICAgICAgIG9uQ2xpY2sgPQoKCgoKCgoKICAgICAgICAgICAgICBfcmVmNC5vbkNsaWNrLHJlbGF0aXZlID0gX3JlZjQucmVsYXRpdmUscmVsb2FkRG9jdW1lbnQgPSBfcmVmNC5yZWxvYWREb2N1bWVudCxyZXBsYWNlID0gX3JlZjQucmVwbGFjZSxzdGF0ZSA9IF9yZWY0LnN0YXRlLHRhcmdldCA9IF9yZWY0LnRhcmdldCx0byA9IF9yZWY0LnRvLHByZXZlbnRTY3JvbGxSZXNldCA9IF9yZWY0LnByZXZlbnRTY3JvbGxSZXNldCwKICAgICAgICAgICAgICByZXN0ID0gX29iamVjdFdpdGhvdXRQcm9wZXJ0aWVzTG9vc2UoX3JlZjQsIF9leGNsdWRlZCk7CgogICAgICAgICAgICB2YXIgaHJlZiA9IHVzZUhyZWYodG8sIHsKICAgICAgICAgICAgICByZWxhdGl2ZTogcmVsYXRpdmUKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIHZhciBpbnRlcm5hbE9uQ2xpY2sgPSB1c2VMaW5rQ2xpY2tIYW5kbGVyKHRvLCB7CiAgICAgICAgICAgICAgcmVwbGFjZTogcmVwbGFjZSwKICAgICAgICAgICAgICBzdGF0ZTogc3RhdGUsCiAgICAgICAgICAgICAgdGFyZ2V0OiB0YXJnZXQsCiAgICAgICAgICAgICAgcHJldmVudFNjcm9sbFJlc2V0OiBwcmV2ZW50U2Nyb2xsUmVzZXQsCiAgICAgICAgICAgICAgcmVsYXRpdmU6IHJlbGF0aXZlCiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgZnVuY3Rpb24gaGFuZGxlQ2xpY2soZXZlbnQpIHsKICAgICAgICAgICAgICBpZiAob25DbGljaykgb25DbGljayhldmVudCk7CgogICAgICAgICAgICAgIGlmICghZXZlbnQuZGVmYXVsdFByZXZlbnRlZCkgewogICAgICAgICAgICAgICAgaW50ZXJuYWxPbkNsaWNrKGV2ZW50KTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybiAoCiAgICAgICAgICAgICAgLyojX19QVVJFX18qLwogICAgICAgICAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBqc3gtYTExeS9hbmNob3ItaGFzLWNvbnRlbnQKICAgICAgICAgICAgICByZWFjdC5jcmVhdGVFbGVtZW50KCJhIiwgcmVhY3Rfcm91dGVyX2RvbV9kaXN0X2V4dGVuZHMoe30sIHJlc3QsIHsKICAgICAgICAgICAgICAgIGhyZWY6IGhyZWYsCiAgICAgICAgICAgICAgICBvbkNsaWNrOiByZWxvYWREb2N1bWVudCA/IG9uQ2xpY2sgOiBoYW5kbGVDbGljaywKICAgICAgICAgICAgICAgIHJlZjogcmVmLAogICAgICAgICAgICAgICAgdGFyZ2V0OiB0YXJnZXQKICAgICAgICAgICAgICB9KSkpOwoKICAgICAgICAgIH0pOwoKICAgICAgICAgIGlmIChmYWxzZSkge30KICAgICAgICAgIC8qKgogICAgICAgICAgICogQSA8TGluaz4gd3JhcHBlciB0aGF0IGtub3dzIGlmIGl0J3MgImFjdGl2ZSIgb3Igbm90LgogICAgICAgICAgICovCgoKICAgICAgICAgIHZhciBOYXZMaW5rID0gLyojX19QVVJFX18qL3JlYWN0LmZvcndhcmRSZWYoZnVuY3Rpb24gTmF2TGlua1dpdGhSZWYoX3JlZjUsIHJlZikgewogICAgICAgICAgICB2YXIgX3JlZjUkYXJpYUN1cnJlbnQgPQoKCgoKCgoKICAgICAgICAgICAgICBfcmVmNVsiYXJpYS1jdXJyZW50Il0sYXJpYUN1cnJlbnRQcm9wID0gX3JlZjUkYXJpYUN1cnJlbnQgPT09IHZvaWQgMCA/ICJwYWdlIiA6IF9yZWY1JGFyaWFDdXJyZW50LF9yZWY1JGNhc2VTZW5zaXRpdmUgPSBfcmVmNS5jYXNlU2Vuc2l0aXZlLGNhc2VTZW5zaXRpdmUgPSBfcmVmNSRjYXNlU2Vuc2l0aXZlID09PSB2b2lkIDAgPyBmYWxzZSA6IF9yZWY1JGNhc2VTZW5zaXRpdmUsX3JlZjUkY2xhc3NOYW1lID0gX3JlZjUuY2xhc3NOYW1lLGNsYXNzTmFtZVByb3AgPSBfcmVmNSRjbGFzc05hbWUgPT09IHZvaWQgMCA/ICIiIDogX3JlZjUkY2xhc3NOYW1lLF9yZWY1JGVuZCA9IF9yZWY1LmVuZCxlbmQgPSBfcmVmNSRlbmQgPT09IHZvaWQgMCA/IGZhbHNlIDogX3JlZjUkZW5kLHN0eWxlUHJvcCA9IF9yZWY1LnN0eWxlLHRvID0gX3JlZjUudG8sY2hpbGRyZW4gPSBfcmVmNS5jaGlsZHJlbiwKICAgICAgICAgICAgICByZXN0ID0gX29iamVjdFdpdGhvdXRQcm9wZXJ0aWVzTG9vc2UoX3JlZjUsIF9leGNsdWRlZDIpOwoKICAgICAgICAgICAgdmFyIHBhdGggPSBkaXN0X3VzZVJlc29sdmVkUGF0aCh0bywgewogICAgICAgICAgICAgIHJlbGF0aXZlOiByZXN0LnJlbGF0aXZlCiAgICAgICAgICAgIH0pOwogICAgICAgICAgICB2YXIgbG9jYXRpb24gPSBkaXN0X3VzZUxvY2F0aW9uKCk7CiAgICAgICAgICAgIHZhciByb3V0ZXJTdGF0ZSA9IHJlYWN0LnVzZUNvbnRleHQoRGF0YVJvdXRlclN0YXRlQ29udGV4dCk7CiAgICAgICAgICAgIHZhciBfcmVhY3QkdXNlQ29udGV4dDcgPQoKICAgICAgICAgICAgICByZWFjdC51c2VDb250ZXh0KE5hdmlnYXRpb25Db250ZXh0KSxuYXZpZ2F0b3IgPSBfcmVhY3QkdXNlQ29udGV4dDcubmF2aWdhdG9yOwogICAgICAgICAgICB2YXIgdG9QYXRobmFtZSA9IG5hdmlnYXRvci5lbmNvZGVMb2NhdGlvbiA/IG5hdmlnYXRvci5lbmNvZGVMb2NhdGlvbihwYXRoKS5wYXRobmFtZSA6IHBhdGgucGF0aG5hbWU7CiAgICAgICAgICAgIHZhciBsb2NhdGlvblBhdGhuYW1lID0gbG9jYXRpb24ucGF0aG5hbWU7CiAgICAgICAgICAgIHZhciBuZXh0TG9jYXRpb25QYXRobmFtZSA9IHJvdXRlclN0YXRlICYmIHJvdXRlclN0YXRlLm5hdmlnYXRpb24gJiYgcm91dGVyU3RhdGUubmF2aWdhdGlvbi5sb2NhdGlvbiA/IHJvdXRlclN0YXRlLm5hdmlnYXRpb24ubG9jYXRpb24ucGF0aG5hbWUgOiBudWxsOwoKICAgICAgICAgICAgaWYgKCFjYXNlU2Vuc2l0aXZlKSB7CiAgICAgICAgICAgICAgbG9jYXRpb25QYXRobmFtZSA9IGxvY2F0aW9uUGF0aG5hbWUudG9Mb3dlckNhc2UoKTsKICAgICAgICAgICAgICBuZXh0TG9jYXRpb25QYXRobmFtZSA9IG5leHRMb2NhdGlvblBhdGhuYW1lID8gbmV4dExvY2F0aW9uUGF0aG5hbWUudG9Mb3dlckNhc2UoKSA6IG51bGw7CiAgICAgICAgICAgICAgdG9QYXRobmFtZSA9IHRvUGF0aG5hbWUudG9Mb3dlckNhc2UoKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdmFyIGlzQWN0aXZlID0gbG9jYXRpb25QYXRobmFtZSA9PT0gdG9QYXRobmFtZSB8fCAhZW5kICYmIGxvY2F0aW9uUGF0aG5hbWUuc3RhcnRzV2l0aCh0b1BhdGhuYW1lKSAmJiBsb2NhdGlvblBhdGhuYW1lLmNoYXJBdCh0b1BhdGhuYW1lLmxlbmd0aCkgPT09ICIvIjsKICAgICAgICAgICAgdmFyIGlzUGVuZGluZyA9IG5leHRMb2NhdGlvblBhdGhuYW1lICE9IG51bGwgJiYgKG5leHRMb2NhdGlvblBhdGhuYW1lID09PSB0b1BhdGhuYW1lIHx8ICFlbmQgJiYgbmV4dExvY2F0aW9uUGF0aG5hbWUuc3RhcnRzV2l0aCh0b1BhdGhuYW1lKSAmJiBuZXh0TG9jYXRpb25QYXRobmFtZS5jaGFyQXQodG9QYXRobmFtZS5sZW5ndGgpID09PSAiLyIpOwogICAgICAgICAgICB2YXIgYXJpYUN1cnJlbnQgPSBpc0FjdGl2ZSA/IGFyaWFDdXJyZW50UHJvcCA6IHVuZGVmaW5lZDsKICAgICAgICAgICAgdmFyIGNsYXNzTmFtZTsKCiAgICAgICAgICAgIGlmICh0eXBlb2YgY2xhc3NOYW1lUHJvcCA9PT0gImZ1bmN0aW9uIikgewogICAgICAgICAgICAgIGNsYXNzTmFtZSA9IGNsYXNzTmFtZVByb3AoewogICAgICAgICAgICAgICAgaXNBY3RpdmU6IGlzQWN0aXZlLAogICAgICAgICAgICAgICAgaXNQZW5kaW5nOiBpc1BlbmRpbmcKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAvLyBJZiB0aGUgY2xhc3NOYW1lIHByb3AgaXMgbm90IGEgZnVuY3Rpb24sIHdlIHVzZSBhIGRlZmF1bHQgYGFjdGl2ZWAKICAgICAgICAgICAgICAvLyBjbGFzcyBmb3IgPE5hdkxpbmsgLz5zIHRoYXQgYXJlIGFjdGl2ZS4gSW4gdjUgYGFjdGl2ZWAgd2FzIHRoZSBkZWZhdWx0CiAgICAgICAgICAgICAgLy8gdmFsdWUgZm9yIGBhY3RpdmVDbGFzc05hbWVgLCBidXQgd2UgYXJlIHJlbW92aW5nIHRoYXQgQVBJIGFuZCBjYW4gc3RpbGwKICAgICAgICAgICAgICAvLyB1c2UgdGhlIG9sZCBkZWZhdWx0IGJlaGF2aW9yIGZvciBhIGNsZWFuZXIgdXBncmFkZSBwYXRoIGFuZCBrZWVwIHRoZQogICAgICAgICAgICAgIC8vIHNpbXBsZSBzdHlsaW5nIHJ1bGVzIHdvcmtpbmcgYXMgdGhleSBjdXJyZW50bHkgZG8uCiAgICAgICAgICAgICAgY2xhc3NOYW1lID0gW2NsYXNzTmFtZVByb3AsIGlzQWN0aXZlID8gImFjdGl2ZSIgOiBudWxsLCBpc1BlbmRpbmcgPyAicGVuZGluZyIgOiBudWxsXS5maWx0ZXIoQm9vbGVhbikuam9pbigiICIpOwogICAgICAgICAgICB9CgogICAgICAgICAgICB2YXIgc3R5bGUgPSB0eXBlb2Ygc3R5bGVQcm9wID09PSAiZnVuY3Rpb24iID8gc3R5bGVQcm9wKHsKICAgICAgICAgICAgICBpc0FjdGl2ZTogaXNBY3RpdmUsCiAgICAgICAgICAgICAgaXNQZW5kaW5nOiBpc1BlbmRpbmcKICAgICAgICAgICAgfSkgOiBzdHlsZVByb3A7CiAgICAgICAgICAgIHJldHVybiAvKiNfX1BVUkVfXyovcmVhY3QuY3JlYXRlRWxlbWVudChMaW5rLCByZWFjdF9yb3V0ZXJfZG9tX2Rpc3RfZXh0ZW5kcyh7fSwgcmVzdCwgewogICAgICAgICAgICAgICJhcmlhLWN1cnJlbnQiOiBhcmlhQ3VycmVudCwKICAgICAgICAgICAgICBjbGFzc05hbWU6IGNsYXNzTmFtZSwKICAgICAgICAgICAgICByZWY6IHJlZiwKICAgICAgICAgICAgICBzdHlsZTogc3R5bGUsCiAgICAgICAgICAgICAgdG86IHRvCiAgICAgICAgICAgIH0pLCB0eXBlb2YgY2hpbGRyZW4gPT09ICJmdW5jdGlvbiIgPyBjaGlsZHJlbih7CiAgICAgICAgICAgICAgaXNBY3RpdmU6IGlzQWN0aXZlLAogICAgICAgICAgICAgIGlzUGVuZGluZzogaXNQZW5kaW5nCiAgICAgICAgICAgIH0pIDogY2hpbGRyZW4pOwogICAgICAgICAgfSk7CgogICAgICAgICAgaWYgKGZhbHNlKSB7fQogICAgICAgICAgLyoqCiAgICAgICAgICAgKiBBIGBAcmVtaXgtcnVuL3JvdXRlcmAtYXdhcmUgYDxmb3JtPmAuIEl0IGJlaGF2ZXMgbGlrZSBhIG5vcm1hbCBmb3JtIGV4Y2VwdAogICAgICAgICAgICogdGhhdCB0aGUgaW50ZXJhY3Rpb24gd2l0aCB0aGUgc2VydmVyIGlzIHdpdGggYGZldGNoYCBpbnN0ZWFkIG9mIG5ldyBkb2N1bWVudAogICAgICAgICAgICogcmVxdWVzdHMsIGFsbG93aW5nIGNvbXBvbmVudHMgdG8gYWRkIG5pY2VyIFVYIHRvIHRoZSBwYWdlIGFzIHRoZSBmb3JtIGlzCiAgICAgICAgICAgKiBzdWJtaXR0ZWQgYW5kIHJldHVybnMgd2l0aCBkYXRhLgogICAgICAgICAgICovCgoKICAgICAgICAgIHZhciBGb3JtID0gLyojX19QVVJFX18qLyAvKiB1bnVzZWQgcHVyZSBleHByZXNzaW9uIG9yIHN1cGVyICovbnVsbCAmJiBSZWFjdC5mb3J3YXJkUmVmKChwcm9wcywgcmVmKSA9PiB7CiAgICAgICAgICAgIHJldHVybiAvKiNfX1BVUkVfXyovUmVhY3QuY3JlYXRlRWxlbWVudChGb3JtSW1wbCwgcmVhY3Rfcm91dGVyX2RvbV9kaXN0X2V4dGVuZHMoe30sIHByb3BzLCB7CiAgICAgICAgICAgICAgcmVmOiByZWYKICAgICAgICAgICAgfSkpOwogICAgICAgICAgfSk7CgogICAgICAgICAgaWYgKGZhbHNlKSB7fQoKICAgICAgICAgIHZhciBGb3JtSW1wbCA9IC8qI19fUFVSRV9fKi8gLyogdW51c2VkIHB1cmUgZXhwcmVzc2lvbiBvciBzdXBlciAqL251bGwgJiYgUmVhY3QuZm9yd2FyZFJlZigoX3JlZjYsIGZvcndhcmRlZFJlZikgPT4gewogICAgICAgICAgICB2YXIKICAgICAgICAgICAgICByZWxvYWREb2N1bWVudCA9CgoKCgoKCgogICAgICAgICAgICAgIF9yZWY2LnJlbG9hZERvY3VtZW50LHJlcGxhY2UgPSBfcmVmNi5yZXBsYWNlLF9yZWY2JG1ldGhvZCA9IF9yZWY2Lm1ldGhvZCxtZXRob2QgPSBfcmVmNiRtZXRob2QgPT09IHZvaWQgMCA/IGRlZmF1bHRNZXRob2QgOiBfcmVmNiRtZXRob2QsYWN0aW9uID0gX3JlZjYuYWN0aW9uLG9uU3VibWl0ID0gX3JlZjYub25TdWJtaXQsZmV0Y2hlcktleSA9IF9yZWY2LmZldGNoZXJLZXkscm91dGVJZCA9IF9yZWY2LnJvdXRlSWQscmVsYXRpdmUgPSBfcmVmNi5yZWxhdGl2ZSwKICAgICAgICAgICAgICBwcm9wcyA9IF9vYmplY3RXaXRob3V0UHJvcGVydGllc0xvb3NlKF9yZWY2LCBfZXhjbHVkZWQzKTsKCiAgICAgICAgICAgIHZhciBzdWJtaXQgPSB1c2VTdWJtaXRJbXBsKGZldGNoZXJLZXksIHJvdXRlSWQpOwogICAgICAgICAgICB2YXIgZm9ybU1ldGhvZCA9IG1ldGhvZC50b0xvd2VyQ2FzZSgpID09PSAiZ2V0IiA/ICJnZXQiIDogInBvc3QiOwogICAgICAgICAgICB2YXIgZm9ybUFjdGlvbiA9IHVzZUZvcm1BY3Rpb24oYWN0aW9uLCB7CiAgICAgICAgICAgICAgcmVsYXRpdmU6IHJlbGF0aXZlCiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgdmFyIHN1Ym1pdEhhbmRsZXIgPSAoZXZlbnQpID0+IHsKICAgICAgICAgICAgICBvblN1Ym1pdCAmJiBvblN1Ym1pdChldmVudCk7CiAgICAgICAgICAgICAgaWYgKGV2ZW50LmRlZmF1bHRQcmV2ZW50ZWQpIHJldHVybjsKICAgICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgICAgICAgIHZhciBzdWJtaXR0ZXIgPSBldmVudC5uYXRpdmVFdmVudC5zdWJtaXR0ZXI7CiAgICAgICAgICAgICAgc3VibWl0KHN1Ym1pdHRlciB8fCBldmVudC5jdXJyZW50VGFyZ2V0LCB7CiAgICAgICAgICAgICAgICBtZXRob2Q6IG1ldGhvZCwKICAgICAgICAgICAgICAgIHJlcGxhY2U6IHJlcGxhY2UsCiAgICAgICAgICAgICAgICByZWxhdGl2ZTogcmVsYXRpdmUKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfTsKCiAgICAgICAgICAgIHJldHVybiAvKiNfX1BVUkVfXyovUmVhY3QuY3JlYXRlRWxlbWVudCgiZm9ybSIsIHJlYWN0X3JvdXRlcl9kb21fZGlzdF9leHRlbmRzKHsKICAgICAgICAgICAgICByZWY6IGZvcndhcmRlZFJlZiwKICAgICAgICAgICAgICBtZXRob2Q6IGZvcm1NZXRob2QsCiAgICAgICAgICAgICAgYWN0aW9uOiBmb3JtQWN0aW9uLAogICAgICAgICAgICAgIG9uU3VibWl0OiByZWxvYWREb2N1bWVudCA/IG9uU3VibWl0IDogc3VibWl0SGFuZGxlcgogICAgICAgICAgICB9LCBwcm9wcykpOwogICAgICAgICAgfSk7CgogICAgICAgICAgaWYgKGZhbHNlKSB7fQogICAgICAgICAgLyoqCiAgICAgICAgICAgKiBUaGlzIGNvbXBvbmVudCB3aWxsIGVtdWxhdGUgdGhlIGJyb3dzZXIncyBzY3JvbGwgcmVzdG9yYXRpb24gb24gbG9jYXRpb24KICAgICAgICAgICAqIGNoYW5nZXMuCiAgICAgICAgICAgKi8KCgogICAgICAgICAgZnVuY3Rpb24gU2Nyb2xsUmVzdG9yYXRpb24oX3JlZjcpIHsKICAgICAgICAgICAgdmFyCiAgICAgICAgICAgICAgZ2V0S2V5ID0KCiAgICAgICAgICAgICAgX3JlZjcuZ2V0S2V5LHN0b3JhZ2VLZXkgPSBfcmVmNy5zdG9yYWdlS2V5OwogICAgICAgICAgICB1c2VTY3JvbGxSZXN0b3JhdGlvbih7CiAgICAgICAgICAgICAgZ2V0S2V5OiBnZXRLZXksCiAgICAgICAgICAgICAgc3RvcmFnZUtleTogc3RvcmFnZUtleQogICAgICAgICAgICB9KTsKICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKGZhbHNlKSB7fSAvLyNlbmRyZWdpb24KICAgICAgICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCiAgICAgICAgICAvLyNyZWdpb24gSG9va3MKICAgICAgICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCgoKICAgICAgICAgIHZhciBkaXN0X0RhdGFSb3V0ZXJIb29rOwoKICAgICAgICAgIChmdW5jdGlvbiAoRGF0YVJvdXRlckhvb2spIHsKICAgICAgICAgICAgRGF0YVJvdXRlckhvb2tbIlVzZVNjcm9sbFJlc3RvcmF0aW9uIl0gPSAidXNlU2Nyb2xsUmVzdG9yYXRpb24iOwogICAgICAgICAgICBEYXRhUm91dGVySG9va1siVXNlU3VibWl0SW1wbCJdID0gInVzZVN1Ym1pdEltcGwiOwogICAgICAgICAgICBEYXRhUm91dGVySG9va1siVXNlRmV0Y2hlciJdID0gInVzZUZldGNoZXIiOwogICAgICAgICAgfSkoZGlzdF9EYXRhUm91dGVySG9vayB8fCAoZGlzdF9EYXRhUm91dGVySG9vayA9IHt9KSk7CgogICAgICAgICAgdmFyIGRpc3RfRGF0YVJvdXRlclN0YXRlSG9vazsKCiAgICAgICAgICAoZnVuY3Rpb24gKERhdGFSb3V0ZXJTdGF0ZUhvb2spIHsKICAgICAgICAgICAgRGF0YVJvdXRlclN0YXRlSG9va1siVXNlRmV0Y2hlcnMiXSA9ICJ1c2VGZXRjaGVycyI7CiAgICAgICAgICAgIERhdGFSb3V0ZXJTdGF0ZUhvb2tbIlVzZVNjcm9sbFJlc3RvcmF0aW9uIl0gPSAidXNlU2Nyb2xsUmVzdG9yYXRpb24iOwogICAgICAgICAgfSkoZGlzdF9EYXRhUm91dGVyU3RhdGVIb29rIHx8IChkaXN0X0RhdGFSb3V0ZXJTdGF0ZUhvb2sgPSB7fSkpOwoKICAgICAgICAgIGZ1bmN0aW9uIGRpc3RfZ2V0RGF0YVJvdXRlckNvbnNvbGVFcnJvcihob29rTmFtZSkgewogICAgICAgICAgICByZXR1cm4gaG9va05hbWUgKyAiIG11c3QgYmUgdXNlZCB3aXRoaW4gYSBkYXRhIHJvdXRlci4gIFNlZSBodHRwczovL3JlYWN0cm91dGVyLmNvbS9lbi9tYWluL3JvdXRlcnMvcGlja2luZy1hLXJvdXRlci4iOwogICAgICAgICAgfQoKICAgICAgICAgIGZ1bmN0aW9uIGRpc3RfdXNlRGF0YVJvdXRlckNvbnRleHQoaG9va05hbWUpIHsKICAgICAgICAgICAgdmFyIGN0eCA9IFJlYWN0LnVzZUNvbnRleHQoVU5TQUZFX0RhdGFSb3V0ZXJDb250ZXh0KTsKICAgICAgICAgICAgIWN0eCA/IGZhbHNlID8gMCA6IGludmFyaWFudChmYWxzZSkgOiB2b2lkIDA7CiAgICAgICAgICAgIHJldHVybiBjdHg7CiAgICAgICAgICB9CgogICAgICAgICAgZnVuY3Rpb24gZGlzdF91c2VEYXRhUm91dGVyU3RhdGUoaG9va05hbWUpIHsKICAgICAgICAgICAgdmFyIHN0YXRlID0gUmVhY3QudXNlQ29udGV4dChVTlNBRkVfRGF0YVJvdXRlclN0YXRlQ29udGV4dCk7CiAgICAgICAgICAgICFzdGF0ZSA/IGZhbHNlID8gMCA6IGludmFyaWFudChmYWxzZSkgOiB2b2lkIDA7CiAgICAgICAgICAgIHJldHVybiBzdGF0ZTsKICAgICAgICAgIH0KICAgICAgICAgIC8qKgogICAgICAgICAgICogSGFuZGxlcyB0aGUgY2xpY2sgYmVoYXZpb3IgZm9yIHJvdXRlciBgPExpbms+YCBjb21wb25lbnRzLiBUaGlzIGlzIHVzZWZ1bCBpZgogICAgICAgICAgICogeW91IG5lZWQgdG8gY3JlYXRlIGN1c3RvbSBgPExpbms+YCBjb21wb25lbnRzIHdpdGggdGhlIHNhbWUgY2xpY2sgYmVoYXZpb3Igd2UKICAgICAgICAgICAqIHVzZSBpbiBvdXIgZXhwb3J0ZWQgYDxMaW5rPmAuCiAgICAgICAgICAgKi8KCgogICAgICAgICAgZnVuY3Rpb24gdXNlTGlua0NsaWNrSGFuZGxlcih0bywgX3RlbXApIHsKICAgICAgICAgICAgdmFyIF9yZWYyOCA9CgoKCgoKICAgICAgICAgICAgICBfdGVtcCA9PT0gdm9pZCAwID8ge30gOiBfdGVtcCx0YXJnZXQgPSBfcmVmMjgudGFyZ2V0LHJlcGxhY2VQcm9wID0gX3JlZjI4LnJlcGxhY2Usc3RhdGUgPSBfcmVmMjguc3RhdGUscHJldmVudFNjcm9sbFJlc2V0ID0gX3JlZjI4LnByZXZlbnRTY3JvbGxSZXNldCxyZWxhdGl2ZSA9IF9yZWYyOC5yZWxhdGl2ZTsKICAgICAgICAgICAgdmFyIG5hdmlnYXRlID0gZGlzdF91c2VOYXZpZ2F0ZSgpOwogICAgICAgICAgICB2YXIgbG9jYXRpb24gPSBkaXN0X3VzZUxvY2F0aW9uKCk7CiAgICAgICAgICAgIHZhciBwYXRoID0gZGlzdF91c2VSZXNvbHZlZFBhdGgodG8sIHsKICAgICAgICAgICAgICByZWxhdGl2ZTogcmVsYXRpdmUKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIHJldHVybiByZWFjdC51c2VDYWxsYmFjaygoZXZlbnQpID0+IHsKICAgICAgICAgICAgICBpZiAoc2hvdWxkUHJvY2Vzc0xpbmtDbGljayhldmVudCwgdGFyZ2V0KSkgewogICAgICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTsgLy8gSWYgdGhlIFVSTCBoYXNuJ3QgY2hhbmdlZCwgYSByZWd1bGFyIDxhPiB3aWxsIGRvIGEgcmVwbGFjZSBpbnN0ZWFkIG9mCiAgICAgICAgICAgICAgICAvLyBhIHB1c2gsIHNvIGRvIHRoZSBzYW1lIGhlcmUgdW5sZXNzIHRoZSByZXBsYWNlIHByb3AgaXMgZXhwbGljaXRseSBzZXQKCiAgICAgICAgICAgICAgICB2YXIgcmVwbGFjZSA9IHJlcGxhY2VQcm9wICE9PSB1bmRlZmluZWQgPyByZXBsYWNlUHJvcCA6IHJvdXRlcl9jcmVhdGVQYXRoKGxvY2F0aW9uKSA9PT0gcm91dGVyX2NyZWF0ZVBhdGgocGF0aCk7CiAgICAgICAgICAgICAgICBuYXZpZ2F0ZSh0bywgewogICAgICAgICAgICAgICAgICByZXBsYWNlOiByZXBsYWNlLAogICAgICAgICAgICAgICAgICBzdGF0ZTogc3RhdGUsCiAgICAgICAgICAgICAgICAgIHByZXZlbnRTY3JvbGxSZXNldDogcHJldmVudFNjcm9sbFJlc2V0LAogICAgICAgICAgICAgICAgICByZWxhdGl2ZTogcmVsYXRpdmUKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwgW2xvY2F0aW9uLCBuYXZpZ2F0ZSwgcGF0aCwgcmVwbGFjZVByb3AsIHN0YXRlLCB0YXJnZXQsIHRvLCBwcmV2ZW50U2Nyb2xsUmVzZXQsIHJlbGF0aXZlXSk7CiAgICAgICAgICB9CiAgICAgICAgICAvKioKICAgICAgICAgICAqIEEgY29udmVuaWVudCB3cmFwcGVyIGZvciByZWFkaW5nIGFuZCB3cml0aW5nIHNlYXJjaCBwYXJhbWV0ZXJzIHZpYSB0aGUKICAgICAgICAgICAqIFVSTFNlYXJjaFBhcmFtcyBpbnRlcmZhY2UuCiAgICAgICAgICAgKi8KCiAgICAgICAgICBmdW5jdGlvbiB1c2VTZWFyY2hQYXJhbXMoZGVmYXVsdEluaXQpIHsKICAgICAgICAgICAgZmFsc2UgPyAwIDogdm9pZCAwOwogICAgICAgICAgICB2YXIgZGVmYXVsdFNlYXJjaFBhcmFtc1JlZiA9IFJlYWN0LnVzZVJlZihjcmVhdGVTZWFyY2hQYXJhbXMoZGVmYXVsdEluaXQpKTsKICAgICAgICAgICAgdmFyIGxvY2F0aW9uID0gdXNlTG9jYXRpb24oKTsKICAgICAgICAgICAgdmFyIHNlYXJjaFBhcmFtcyA9IFJlYWN0LnVzZU1lbW8oKCkgPT4gZ2V0U2VhcmNoUGFyYW1zRm9yTG9jYXRpb24obG9jYXRpb24uc2VhcmNoLCBkZWZhdWx0U2VhcmNoUGFyYW1zUmVmLmN1cnJlbnQpLCBbbG9jYXRpb24uc2VhcmNoXSk7CiAgICAgICAgICAgIHZhciBuYXZpZ2F0ZSA9IHVzZU5hdmlnYXRlKCk7CiAgICAgICAgICAgIHZhciBzZXRTZWFyY2hQYXJhbXMgPSBSZWFjdC51c2VDYWxsYmFjaygobmV4dEluaXQsIG5hdmlnYXRlT3B0aW9ucykgPT4gewogICAgICAgICAgICAgIHZhciBuZXdTZWFyY2hQYXJhbXMgPSBjcmVhdGVTZWFyY2hQYXJhbXModHlwZW9mIG5leHRJbml0ID09PSAiZnVuY3Rpb24iID8gbmV4dEluaXQoc2VhcmNoUGFyYW1zKSA6IG5leHRJbml0KTsKICAgICAgICAgICAgICBuYXZpZ2F0ZSgiPyIgKyBuZXdTZWFyY2hQYXJhbXMsIG5hdmlnYXRlT3B0aW9ucyk7CiAgICAgICAgICAgIH0sIFtuYXZpZ2F0ZSwgc2VhcmNoUGFyYW1zXSk7CiAgICAgICAgICAgIHJldHVybiBbc2VhcmNoUGFyYW1zLCBzZXRTZWFyY2hQYXJhbXNdOwogICAgICAgICAgfQogICAgICAgICAgLyoqCiAgICAgICAgICAgKiBSZXR1cm5zIGEgZnVuY3Rpb24gdGhhdCBtYXkgYmUgdXNlZCB0byBwcm9ncmFtbWF0aWNhbGx5IHN1Ym1pdCBhIGZvcm0gKG9yCiAgICAgICAgICAgKiBzb21lIGFyYml0cmFyeSBkYXRhKSB0byB0aGUgc2VydmVyLgogICAgICAgICAgICovCgogICAgICAgICAgZnVuY3Rpb24gdXNlU3VibWl0KCkgewogICAgICAgICAgICByZXR1cm4gdXNlU3VibWl0SW1wbCgpOwogICAgICAgICAgfQoKICAgICAgICAgIGZ1bmN0aW9uIHVzZVN1Ym1pdEltcGwoZmV0Y2hlcktleSwgcm91dGVJZCkgewogICAgICAgICAgICB2YXIgX2Rpc3RfdXNlRGF0YVJvdXRlckNvID0KCiAgICAgICAgICAgICAgZGlzdF91c2VEYXRhUm91dGVyQ29udGV4dChkaXN0X0RhdGFSb3V0ZXJIb29rLlVzZVN1Ym1pdEltcGwpLHJvdXRlciA9IF9kaXN0X3VzZURhdGFSb3V0ZXJDby5yb3V0ZXI7CiAgICAgICAgICAgIHZhciBkZWZhdWx0QWN0aW9uID0gdXNlRm9ybUFjdGlvbigpOwogICAgICAgICAgICByZXR1cm4gUmVhY3QudXNlQ2FsbGJhY2soZnVuY3Rpb24gKHRhcmdldCwgb3B0aW9ucykgewogICAgICAgICAgICAgIGlmIChvcHRpb25zID09PSB2b2lkIDApIHsKICAgICAgICAgICAgICAgIG9wdGlvbnMgPSB7fTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIGlmICh0eXBlb2YgZG9jdW1lbnQgPT09ICJ1bmRlZmluZWQiKSB7CiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIllvdSBhcmUgY2FsbGluZyBzdWJtaXQgZHVyaW5nIHRoZSBzZXJ2ZXIgcmVuZGVyLiAiICsgIlRyeSBjYWxsaW5nIHN1Ym1pdCB3aXRoaW4gYSBgdXNlRWZmZWN0YCBvciBjYWxsYmFjayBpbnN0ZWFkLiIpOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgdmFyIF9nZXRGb3JtU3VibWlzc2lvbkluZiA9CgoKCgogICAgICAgICAgICAgICAgZ2V0Rm9ybVN1Ym1pc3Npb25JbmZvKHRhcmdldCwgZGVmYXVsdEFjdGlvbiwgb3B0aW9ucyksbWV0aG9kID0gX2dldEZvcm1TdWJtaXNzaW9uSW5mLm1ldGhvZCxlbmNUeXBlID0gX2dldEZvcm1TdWJtaXNzaW9uSW5mLmVuY1R5cGUsZm9ybURhdGEgPSBfZ2V0Rm9ybVN1Ym1pc3Npb25JbmYuZm9ybURhdGEsdXJsID0gX2dldEZvcm1TdWJtaXNzaW9uSW5mLnVybDsKICAgICAgICAgICAgICB2YXIgaHJlZiA9IHVybC5wYXRobmFtZSArIHVybC5zZWFyY2g7CiAgICAgICAgICAgICAgdmFyIG9wdHMgPSB7CiAgICAgICAgICAgICAgICByZXBsYWNlOiBvcHRpb25zLnJlcGxhY2UsCiAgICAgICAgICAgICAgICBmb3JtRGF0YTogZm9ybURhdGEsCiAgICAgICAgICAgICAgICBmb3JtTWV0aG9kOiBtZXRob2QsCiAgICAgICAgICAgICAgICBmb3JtRW5jVHlwZTogZW5jVHlwZQogICAgICAgICAgICAgIH07CgogICAgICAgICAgICAgIGlmIChmZXRjaGVyS2V5KSB7CiAgICAgICAgICAgICAgICAhKHJvdXRlSWQgIT0gbnVsbCkgPyBmYWxzZSA/IDAgOiBpbnZhcmlhbnQoZmFsc2UpIDogdm9pZCAwOwogICAgICAgICAgICAgICAgcm91dGVyLmZldGNoKGZldGNoZXJLZXksIHJvdXRlSWQsIGhyZWYsIG9wdHMpOwogICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICByb3V0ZXIubmF2aWdhdGUoaHJlZiwgb3B0cyk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LCBbZGVmYXVsdEFjdGlvbiwgcm91dGVyLCBmZXRjaGVyS2V5LCByb3V0ZUlkXSk7CiAgICAgICAgICB9CgogICAgICAgICAgZnVuY3Rpb24gdXNlRm9ybUFjdGlvbihhY3Rpb24sIF90ZW1wMikgewogICAgICAgICAgICB2YXIgX3JlZjI5ID0KCiAgICAgICAgICAgICAgX3RlbXAyID09PSB2b2lkIDAgPyB7fSA6IF90ZW1wMixyZWxhdGl2ZSA9IF9yZWYyOS5yZWxhdGl2ZTsKICAgICAgICAgICAgdmFyIF9SZWFjdCR1c2VDb250ZXh0MiA9CgogICAgICAgICAgICAgIFJlYWN0LnVzZUNvbnRleHQoVU5TQUZFX05hdmlnYXRpb25Db250ZXh0KSxiYXNlbmFtZSA9IF9SZWFjdCR1c2VDb250ZXh0Mi5iYXNlbmFtZTsKICAgICAgICAgICAgdmFyIHJvdXRlQ29udGV4dCA9IFJlYWN0LnVzZUNvbnRleHQoVU5TQUZFX1JvdXRlQ29udGV4dCk7CiAgICAgICAgICAgICFyb3V0ZUNvbnRleHQgPyBmYWxzZSA/IDAgOiBpbnZhcmlhbnQoZmFsc2UpIDogdm9pZCAwOwogICAgICAgICAgICB2YXIgX3JvdXRlQ29udGV4dCRtYXRjaGVzID0gcm91dGVDb250ZXh0Lm1hdGNoZXMuc2xpY2UoLTEpLF9yb3V0ZUNvbnRleHQkbWF0Y2hlczIgPSBfc2xpY2VkVG9BcnJheTIoX3JvdXRlQ29udGV4dCRtYXRjaGVzLCAxKSxtYXRjaCA9IF9yb3V0ZUNvbnRleHQkbWF0Y2hlczJbMF07CiAgICAgICAgICAgIHZhciByZXNvbHZlZEFjdGlvbiA9IGFjdGlvbiAhPSBudWxsID8gYWN0aW9uIDogIi4iOyAvLyBTaGFsbG93IGNsb25lIHBhdGggc28gd2UgY2FuIG1vZGlmeSBpdCBiZWxvdywgb3RoZXJ3aXNlIHdlIG1vZGlmeSB0aGUKICAgICAgICAgICAgLy8gb2JqZWN0IHJlZmVyZW5jZWQgYnkgdXNlTWVtbyBpbnNpZGUgdXNlUmVzb2x2ZWRQYXRoCgogICAgICAgICAgICB2YXIgcGF0aCA9IHJlYWN0X3JvdXRlcl9kb21fZGlzdF9leHRlbmRzKHt9LCB1c2VSZXNvbHZlZFBhdGgocmVzb2x2ZWRBY3Rpb24sIHsKICAgICAgICAgICAgICByZWxhdGl2ZTogcmVsYXRpdmUKICAgICAgICAgICAgfSkpOyAvLyBQcmV2aW91c2x5IHdlIHNldCB0aGUgZGVmYXVsdCBhY3Rpb24gdG8gIi4iLiBUaGUgcHJvYmxlbSB3aXRoIHRoaXMgaXMgdGhhdAogICAgICAgICAgICAvLyBgdXNlUmVzb2x2ZWRQYXRoKCIuIilgIGV4Y2x1ZGVzIHNlYXJjaCBwYXJhbXMgYW5kIHRoZSBoYXNoIG9mIHRoZSByZXNvbHZlZAogICAgICAgICAgICAvLyBVUkwuIFRoaXMgaXMgdGhlIGludGVuZGVkIGJlaGF2aW9yIG9mIHdoZW4gIi4iIGlzIHNwZWNpZmljYWxseSBwcm92aWRlZCBhcwogICAgICAgICAgICAvLyB0aGUgZm9ybSBhY3Rpb24sIGJ1dCBpbmNvbnNpc3RlbnQgdy8gYnJvd3NlcnMgd2hlbiB0aGUgYWN0aW9uIGlzIG9taXR0ZWQuCiAgICAgICAgICAgIC8vIGh0dHBzOi8vZ2l0aHViLmNvbS9yZW1peC1ydW4vcmVtaXgvaXNzdWVzLzkyNwoKCiAgICAgICAgICAgIHZhciBsb2NhdGlvbiA9IHVzZUxvY2F0aW9uKCk7CgogICAgICAgICAgICBpZiAoYWN0aW9uID09IG51bGwpIHsKICAgICAgICAgICAgICAvLyBTYWZlIHRvIHdyaXRlIHRvIHRoZXNlIGRpcmVjdGx5IGhlcmUgc2luY2UgaWYgYWN0aW9uIHdhcyB1bmRlZmluZWQsIHdlCiAgICAgICAgICAgICAgLy8gd291bGQgaGF2ZSBjYWxsZWQgdXNlUmVzb2x2ZWRQYXRoKCIuIikgd2hpY2ggd2lsbCBuZXZlciBpbmNsdWRlIGEgc2VhcmNoCiAgICAgICAgICAgICAgLy8gb3IgaGFzaAogICAgICAgICAgICAgIHBhdGguc2VhcmNoID0gbG9jYXRpb24uc2VhcmNoOwogICAgICAgICAgICAgIHBhdGguaGFzaCA9IGxvY2F0aW9uLmhhc2g7IC8vIFdoZW4gZ3JhYmJpbmcgc2VhcmNoIHBhcmFtcyBmcm9tIHRoZSBVUkwsIHJlbW92ZSB0aGUgYXV0b21hdGljYWxseQogICAgICAgICAgICAgIC8vIGluc2VydGVkID9pbmRleCBwYXJhbSBzbyB3ZSBtYXRjaCB0aGUgdXNlUmVzb2x2ZWRQYXRoIHNlYXJjaCBiZWhhdmlvcgogICAgICAgICAgICAgIC8vIHdoaWNoIHdvdWxkIG5vdCBpbmNsdWRlID9pbmRleAoKICAgICAgICAgICAgICBpZiAobWF0Y2gucm91dGUuaW5kZXgpIHsKICAgICAgICAgICAgICAgIHZhciBwYXJhbXMgPSBuZXcgVVJMU2VhcmNoUGFyYW1zKHBhdGguc2VhcmNoKTsKICAgICAgICAgICAgICAgIHBhcmFtcy5kZWxldGUoImluZGV4Iik7CiAgICAgICAgICAgICAgICBwYXRoLnNlYXJjaCA9IHBhcmFtcy50b1N0cmluZygpID8gIj8iICsgcGFyYW1zLnRvU3RyaW5nKCkgOiAiIjsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmICgoIWFjdGlvbiB8fCBhY3Rpb24gPT09ICIuIikgJiYgbWF0Y2gucm91dGUuaW5kZXgpIHsKICAgICAgICAgICAgICBwYXRoLnNlYXJjaCA9IHBhdGguc2VhcmNoID8gcGF0aC5zZWFyY2gucmVwbGFjZSgvXlw/LywgIj9pbmRleCYiKSA6ICI/aW5kZXgiOwogICAgICAgICAgICB9IC8vIElmIHdlJ3JlIG9wZXJhdGluZyB3aXRoaW4gYSBiYXNlbmFtZSwgcHJlcGVuZCBpdCB0byB0aGUgcGF0aG5hbWUgcHJpb3IKICAgICAgICAgICAgLy8gdG8gY3JlYXRpbmcgdGhlIGZvcm0gYWN0aW9uLiAgSWYgdGhpcyBpcyBhIHJvb3QgbmF2aWdhdGlvbiwgdGhlbiBqdXN0IHVzZQogICAgICAgICAgICAvLyB0aGUgcmF3IGJhc2VuYW1lIHdoaWNoIGFsbG93cyB0aGUgYmFzZW5hbWUgdG8gaGF2ZSBmdWxsIGNvbnRyb2wgb3ZlciB0aGUKICAgICAgICAgICAgLy8gcHJlc2VuY2Ugb2YgYSB0cmFpbGluZyBzbGFzaCBvbiByb290IGFjdGlvbnMKCgogICAgICAgICAgICBpZiAoYmFzZW5hbWUgIT09ICIvIikgewogICAgICAgICAgICAgIHBhdGgucGF0aG5hbWUgPSBwYXRoLnBhdGhuYW1lID09PSAiLyIgPyBiYXNlbmFtZSA6IGpvaW5QYXRocyhbYmFzZW5hbWUsIHBhdGgucGF0aG5hbWVdKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuIGNyZWF0ZVBhdGgocGF0aCk7CiAgICAgICAgICB9CgogICAgICAgICAgZnVuY3Rpb24gY3JlYXRlRmV0Y2hlckZvcm0oZmV0Y2hlcktleSwgcm91dGVJZCkgewogICAgICAgICAgICB2YXIgRmV0Y2hlckZvcm0gPSAvKiNfX1BVUkVfXyovUmVhY3QuZm9yd2FyZFJlZigocHJvcHMsIHJlZikgPT4gewogICAgICAgICAgICAgIHJldHVybiAvKiNfX1BVUkVfXyovUmVhY3QuY3JlYXRlRWxlbWVudChGb3JtSW1wbCwgcmVhY3Rfcm91dGVyX2RvbV9kaXN0X2V4dGVuZHMoe30sIHByb3BzLCB7CiAgICAgICAgICAgICAgICByZWY6IHJlZiwKICAgICAgICAgICAgICAgIGZldGNoZXJLZXk6IGZldGNoZXJLZXksCiAgICAgICAgICAgICAgICByb3V0ZUlkOiByb3V0ZUlkCiAgICAgICAgICAgICAgfSkpOwogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIGlmIChmYWxzZSkge30KCiAgICAgICAgICAgIHJldHVybiBGZXRjaGVyRm9ybTsKICAgICAgICAgIH0KCiAgICAgICAgICB2YXIgZmV0Y2hlcklkID0gMDsKICAgICAgICAgIC8qKgogICAgICAgICAgICogSW50ZXJhY3RzIHdpdGggcm91dGUgbG9hZGVycyBhbmQgYWN0aW9ucyB3aXRob3V0IGNhdXNpbmcgYSBuYXZpZ2F0aW9uLiBHcmVhdAogICAgICAgICAgICogZm9yIGFueSBpbnRlcmFjdGlvbiB0aGF0IHN0YXlzIG9uIHRoZSBzYW1lIHBhZ2UuCiAgICAgICAgICAgKi8KCiAgICAgICAgICBmdW5jdGlvbiB1c2VGZXRjaGVyKCkgewogICAgICAgICAgICB2YXIgX3JvdXRlJG1hdGNoZXM7CgogICAgICAgICAgICB2YXIgX2Rpc3RfdXNlRGF0YVJvdXRlckNvMiA9CgogICAgICAgICAgICAgIGRpc3RfdXNlRGF0YVJvdXRlckNvbnRleHQoZGlzdF9EYXRhUm91dGVySG9vay5Vc2VGZXRjaGVyKSxyb3V0ZXIgPSBfZGlzdF91c2VEYXRhUm91dGVyQ28yLnJvdXRlcjsKICAgICAgICAgICAgdmFyIHJvdXRlID0gUmVhY3QudXNlQ29udGV4dChVTlNBRkVfUm91dGVDb250ZXh0KTsKICAgICAgICAgICAgIXJvdXRlID8gZmFsc2UgPyAwIDogaW52YXJpYW50KGZhbHNlKSA6IHZvaWQgMDsKICAgICAgICAgICAgdmFyIHJvdXRlSWQgPSAoX3JvdXRlJG1hdGNoZXMgPSByb3V0ZS5tYXRjaGVzW3JvdXRlLm1hdGNoZXMubGVuZ3RoIC0gMV0pID09IG51bGwgPyB2b2lkIDAgOiBfcm91dGUkbWF0Y2hlcy5yb3V0ZS5pZDsKICAgICAgICAgICAgIShyb3V0ZUlkICE9IG51bGwpID8gZmFsc2UgPyAwIDogaW52YXJpYW50KGZhbHNlKSA6IHZvaWQgMDsKICAgICAgICAgICAgdmFyIF9SZWFjdCR1c2VTdGF0ZTcgPSBSZWFjdC51c2VTdGF0ZSgoKSA9PiBTdHJpbmcoKytmZXRjaGVySWQpKSxfUmVhY3QkdXNlU3RhdGU4ID0gX3NsaWNlZFRvQXJyYXkyKF9SZWFjdCR1c2VTdGF0ZTcsIDEpLGZldGNoZXJLZXkgPSBfUmVhY3QkdXNlU3RhdGU4WzBdOwogICAgICAgICAgICB2YXIgX1JlYWN0JHVzZVN0YXRlOSA9IFJlYWN0LnVzZVN0YXRlKCgpID0+IHsKICAgICAgICAgICAgICAgICFyb3V0ZUlkID8gZmFsc2UgPyAwIDogaW52YXJpYW50KGZhbHNlKSA6IHZvaWQgMDsKICAgICAgICAgICAgICAgIHJldHVybiBjcmVhdGVGZXRjaGVyRm9ybShmZXRjaGVyS2V5LCByb3V0ZUlkKTsKICAgICAgICAgICAgICB9KSxfUmVhY3QkdXNlU3RhdGUxMCA9IF9zbGljZWRUb0FycmF5MihfUmVhY3QkdXNlU3RhdGU5LCAxKSxGb3JtID0gX1JlYWN0JHVzZVN0YXRlMTBbMF07CiAgICAgICAgICAgIHZhciBfUmVhY3QkdXNlU3RhdGUxMSA9IFJlYWN0LnVzZVN0YXRlKCgpID0+IChocmVmKSA9PiB7CiAgICAgICAgICAgICAgICAhcm91dGVyID8gZmFsc2UgPyAwIDogaW52YXJpYW50KGZhbHNlKSA6IHZvaWQgMDsKICAgICAgICAgICAgICAgICFyb3V0ZUlkID8gZmFsc2UgPyAwIDogaW52YXJpYW50KGZhbHNlKSA6IHZvaWQgMDsKICAgICAgICAgICAgICAgIHJvdXRlci5mZXRjaChmZXRjaGVyS2V5LCByb3V0ZUlkLCBocmVmKTsKICAgICAgICAgICAgICB9KSxfUmVhY3QkdXNlU3RhdGUxMiA9IF9zbGljZWRUb0FycmF5MihfUmVhY3QkdXNlU3RhdGUxMSwgMSksbG9hZCA9IF9SZWFjdCR1c2VTdGF0ZTEyWzBdOwogICAgICAgICAgICB2YXIgc3VibWl0ID0gdXNlU3VibWl0SW1wbChmZXRjaGVyS2V5LCByb3V0ZUlkKTsKICAgICAgICAgICAgdmFyIGZldGNoZXIgPSByb3V0ZXIuZ2V0RmV0Y2hlcihmZXRjaGVyS2V5KTsKICAgICAgICAgICAgdmFyIGZldGNoZXJXaXRoQ29tcG9uZW50cyA9IFJlYWN0LnVzZU1lbW8oKCkgPT4gcmVhY3Rfcm91dGVyX2RvbV9kaXN0X2V4dGVuZHMoewogICAgICAgICAgICAgIEZvcm06IEZvcm0sCiAgICAgICAgICAgICAgc3VibWl0OiBzdWJtaXQsCiAgICAgICAgICAgICAgbG9hZDogbG9hZAogICAgICAgICAgICB9LCBmZXRjaGVyKSwgW2ZldGNoZXIsIEZvcm0sIHN1Ym1pdCwgbG9hZF0pOwogICAgICAgICAgICBSZWFjdC51c2VFZmZlY3QoKCkgPT4gewogICAgICAgICAgICAgIC8vIElzIHRoaXMgYnVzdGVkIHdoZW4gdGhlIFJlYWN0IHRlYW0gZ2V0cyByZWFsIHdlaXJkIGFuZCBjYWxscyBlZmZlY3RzCiAgICAgICAgICAgICAgLy8gdHdpY2Ugb24gbW91bnQ/ICBXZSByZWFsbHkganVzdCBuZWVkIHRvIGdhcmJhZ2UgY29sbGVjdCBoZXJlIHdoZW4gdGhpcwogICAgICAgICAgICAgIC8vIGZldGNoZXIgaXMgbm8gbG9uZ2VyIGFyb3VuZC4KICAgICAgICAgICAgICByZXR1cm4gKCkgPT4gewogICAgICAgICAgICAgICAgaWYgKCFyb3V0ZXIpIHsKICAgICAgICAgICAgICAgICAgY29uc29sZS53YXJuKCJObyBmZXRjaGVyIGF2YWlsYWJsZSB0byBjbGVhbiB1cCBmcm9tIHVzZUZldGNoZXIoKSIpOwogICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgcm91dGVyLmRlbGV0ZUZldGNoZXIoZmV0Y2hlcktleSk7CiAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgfSwgW3JvdXRlciwgZmV0Y2hlcktleV0pOwogICAgICAgICAgICByZXR1cm4gZmV0Y2hlcldpdGhDb21wb25lbnRzOwogICAgICAgICAgfQogICAgICAgICAgLyoqCiAgICAgICAgICAgKiBQcm92aWRlcyBhbGwgZmV0Y2hlcnMgY3VycmVudGx5IG9uIHRoZSBwYWdlLiBVc2VmdWwgZm9yIGxheW91dHMgYW5kIHBhcmVudAogICAgICAgICAgICogcm91dGVzIHRoYXQgbmVlZCB0byBwcm92aWRlIHBlbmRpbmcvb3B0aW1pc3RpYyBVSSByZWdhcmRpbmcgdGhlIGZldGNoLgogICAgICAgICAgICovCgogICAgICAgICAgZnVuY3Rpb24gdXNlRmV0Y2hlcnMoKSB7CiAgICAgICAgICAgIHZhciBzdGF0ZSA9IGRpc3RfdXNlRGF0YVJvdXRlclN0YXRlKGRpc3RfRGF0YVJvdXRlclN0YXRlSG9vay5Vc2VGZXRjaGVycyk7CiAgICAgICAgICAgIHJldHVybiBfdG9Db25zdW1hYmxlQXJyYXkyKHN0YXRlLmZldGNoZXJzLnZhbHVlcygpKTsKICAgICAgICAgIH0KICAgICAgICAgIHZhciBTQ1JPTExfUkVTVE9SQVRJT05fU1RPUkFHRV9LRVkgPSAicmVhY3Qtcm91dGVyLXNjcm9sbC1wb3NpdGlvbnMiOwogICAgICAgICAgdmFyIHNhdmVkU2Nyb2xsUG9zaXRpb25zID0ge307CiAgICAgICAgICAvKioKICAgICAgICAgICAqIFdoZW4gcmVuZGVyZWQgaW5zaWRlIGEgUm91dGVyUHJvdmlkZXIsIHdpbGwgcmVzdG9yZSBzY3JvbGwgcG9zaXRpb25zIG9uIG5hdmlnYXRpb25zCiAgICAgICAgICAgKi8KCiAgICAgICAgICBmdW5jdGlvbiB1c2VTY3JvbGxSZXN0b3JhdGlvbihfdGVtcDMpIHsKICAgICAgICAgICAgdmFyIF9yZWYzMCA9CgoKICAgICAgICAgICAgICBfdGVtcDMgPT09IHZvaWQgMCA/IHt9IDogX3RlbXAzLGdldEtleSA9IF9yZWYzMC5nZXRLZXksc3RvcmFnZUtleSA9IF9yZWYzMC5zdG9yYWdlS2V5OwogICAgICAgICAgICB2YXIgX2Rpc3RfdXNlRGF0YVJvdXRlckNvMyA9CgogICAgICAgICAgICAgIGRpc3RfdXNlRGF0YVJvdXRlckNvbnRleHQoZGlzdF9EYXRhUm91dGVySG9vay5Vc2VTY3JvbGxSZXN0b3JhdGlvbikscm91dGVyID0gX2Rpc3RfdXNlRGF0YVJvdXRlckNvMy5yb3V0ZXI7CiAgICAgICAgICAgIHZhciBfZGlzdF91c2VEYXRhUm91dGVyU3QgPQoKCiAgICAgICAgICAgICAgZGlzdF91c2VEYXRhUm91dGVyU3RhdGUoZGlzdF9EYXRhUm91dGVyU3RhdGVIb29rLlVzZVNjcm9sbFJlc3RvcmF0aW9uKSxyZXN0b3JlU2Nyb2xsUG9zaXRpb24gPSBfZGlzdF91c2VEYXRhUm91dGVyU3QucmVzdG9yZVNjcm9sbFBvc2l0aW9uLHByZXZlbnRTY3JvbGxSZXNldCA9IF9kaXN0X3VzZURhdGFSb3V0ZXJTdC5wcmV2ZW50U2Nyb2xsUmVzZXQ7CiAgICAgICAgICAgIHZhciBsb2NhdGlvbiA9IHVzZUxvY2F0aW9uKCk7CiAgICAgICAgICAgIHZhciBtYXRjaGVzID0gdXNlTWF0Y2hlcygpOwogICAgICAgICAgICB2YXIgbmF2aWdhdGlvbiA9IHVzZU5hdmlnYXRpb24oKTsgLy8gVHJpZ2dlciBtYW51YWwgc2Nyb2xsIHJlc3RvcmF0aW9uIHdoaWxlIHdlJ3JlIGFjdGl2ZQoKICAgICAgICAgICAgUmVhY3QudXNlRWZmZWN0KCgpID0+IHsKICAgICAgICAgICAgICB3aW5kb3cuaGlzdG9yeS5zY3JvbGxSZXN0b3JhdGlvbiA9ICJtYW51YWwiOwogICAgICAgICAgICAgIHJldHVybiAoKSA9PiB7CiAgICAgICAgICAgICAgICB3aW5kb3cuaGlzdG9yeS5zY3JvbGxSZXN0b3JhdGlvbiA9ICJhdXRvIjsKICAgICAgICAgICAgICB9OwogICAgICAgICAgICB9LCBbXSk7IC8vIFNhdmUgcG9zaXRpb25zIG9uIHVubG9hZAoKICAgICAgICAgICAgdXNlQmVmb3JlVW5sb2FkKFJlYWN0LnVzZUNhbGxiYWNrKCgpID0+IHsKICAgICAgICAgICAgICBpZiAobmF2aWdhdGlvbi5zdGF0ZSA9PT0gImlkbGUiKSB7CiAgICAgICAgICAgICAgICB2YXIga2V5ID0gKGdldEtleSA/IGdldEtleShsb2NhdGlvbiwgbWF0Y2hlcykgOiBudWxsKSB8fCBsb2NhdGlvbi5rZXk7CiAgICAgICAgICAgICAgICBzYXZlZFNjcm9sbFBvc2l0aW9uc1trZXldID0gd2luZG93LnNjcm9sbFk7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBzZXNzaW9uU3RvcmFnZS5zZXRJdGVtKHN0b3JhZ2VLZXkgfHwgU0NST0xMX1JFU1RPUkFUSU9OX1NUT1JBR0VfS0VZLCBKU09OLnN0cmluZ2lmeShzYXZlZFNjcm9sbFBvc2l0aW9ucykpOwogICAgICAgICAgICAgIHdpbmRvdy5oaXN0b3J5LnNjcm9sbFJlc3RvcmF0aW9uID0gImF1dG8iOwogICAgICAgICAgICB9LCBbc3RvcmFnZUtleSwgZ2V0S2V5LCBuYXZpZ2F0aW9uLnN0YXRlLCBsb2NhdGlvbiwgbWF0Y2hlc10pKTsgLy8gUmVhZCBpbiBhbnkgc2F2ZWQgc2Nyb2xsIGxvY2F0aW9ucwoKICAgICAgICAgICAgUmVhY3QudXNlTGF5b3V0RWZmZWN0KCgpID0+IHsKICAgICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgICAgdmFyIHNlc3Npb25Qb3NpdGlvbnMgPSBzZXNzaW9uU3RvcmFnZS5nZXRJdGVtKHN0b3JhZ2VLZXkgfHwgU0NST0xMX1JFU1RPUkFUSU9OX1NUT1JBR0VfS0VZKTsKCiAgICAgICAgICAgICAgICBpZiAoc2Vzc2lvblBvc2l0aW9ucykgewogICAgICAgICAgICAgICAgICBzYXZlZFNjcm9sbFBvc2l0aW9ucyA9IEpTT04ucGFyc2Uoc2Vzc2lvblBvc2l0aW9ucyk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgICAgICAgICAgLy8gbm8tb3AsIHVzZSBkZWZhdWx0IGVtcHR5IG9iamVjdAogICAgICAgICAgICAgIH19LCBbc3RvcmFnZUtleV0pOyAvLyBFbmFibGUgc2Nyb2xsIHJlc3RvcmF0aW9uIGluIHRoZSByb3V0ZXIKCiAgICAgICAgICAgIFJlYWN0LnVzZUxheW91dEVmZmVjdCgoKSA9PiB7CiAgICAgICAgICAgICAgdmFyIGRpc2FibGVTY3JvbGxSZXN0b3JhdGlvbiA9IHJvdXRlciA9PSBudWxsID8gdm9pZCAwIDogcm91dGVyLmVuYWJsZVNjcm9sbFJlc3RvcmF0aW9uKHNhdmVkU2Nyb2xsUG9zaXRpb25zLCAoKSA9PiB3aW5kb3cuc2Nyb2xsWSwgZ2V0S2V5KTsKICAgICAgICAgICAgICByZXR1cm4gKCkgPT4gZGlzYWJsZVNjcm9sbFJlc3RvcmF0aW9uICYmIGRpc2FibGVTY3JvbGxSZXN0b3JhdGlvbigpOwogICAgICAgICAgICB9LCBbcm91dGVyLCBnZXRLZXldKTsgLy8gUmVzdG9yZSBzY3JvbGxpbmcgd2hlbiBzdGF0ZS5yZXN0b3JlU2Nyb2xsUG9zaXRpb24gY2hhbmdlcwoKICAgICAgICAgICAgUmVhY3QudXNlTGF5b3V0RWZmZWN0KCgpID0+IHsKICAgICAgICAgICAgICAvLyBFeHBsaWNpdCBmYWxzZSBtZWFucyBkb24ndCBkbyBhbnl0aGluZyAodXNlZCBmb3Igc3VibWlzc2lvbnMpCiAgICAgICAgICAgICAgaWYgKHJlc3RvcmVTY3JvbGxQb3NpdGlvbiA9PT0gZmFsc2UpIHsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICB9IC8vIGJlZW4gaGVyZSBiZWZvcmUsIHNjcm9sbCB0byBpdAoKCiAgICAgICAgICAgICAgaWYgKHR5cGVvZiByZXN0b3JlU2Nyb2xsUG9zaXRpb24gPT09ICJudW1iZXIiKSB7CiAgICAgICAgICAgICAgICB3aW5kb3cuc2Nyb2xsVG8oMCwgcmVzdG9yZVNjcm9sbFBvc2l0aW9uKTsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICB9IC8vIHRyeSB0byBzY3JvbGwgdG8gdGhlIGhhc2gKCgogICAgICAgICAgICAgIGlmIChsb2NhdGlvbi5oYXNoKSB7CiAgICAgICAgICAgICAgICB2YXIgZWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChsb2NhdGlvbi5oYXNoLnNsaWNlKDEpKTsKCiAgICAgICAgICAgICAgICBpZiAoZWwpIHsKICAgICAgICAgICAgICAgICAgZWwuc2Nyb2xsSW50b1ZpZXcoKTsKICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0gLy8gT3B0IG91dCBvZiBzY3JvbGwgcmVzZXQgaWYgdGhpcyBsaW5rIHJlcXVlc3RlZCBpdAoKCiAgICAgICAgICAgICAgaWYgKHByZXZlbnRTY3JvbGxSZXNldCA9PT0gdHJ1ZSkgewogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgIH0gLy8gb3RoZXJ3aXNlIGdvIHRvIHRoZSB0b3Agb24gbmV3IGxvY2F0aW9ucwoKCiAgICAgICAgICAgICAgd2luZG93LnNjcm9sbFRvKDAsIDApOwogICAgICAgICAgICB9LCBbbG9jYXRpb24sIHJlc3RvcmVTY3JvbGxQb3NpdGlvbiwgcHJldmVudFNjcm9sbFJlc2V0XSk7CiAgICAgICAgICB9CgogICAgICAgICAgZnVuY3Rpb24gdXNlQmVmb3JlVW5sb2FkKGNhbGxiYWNrKSB7CiAgICAgICAgICAgIFJlYWN0LnVzZUVmZmVjdCgoKSA9PiB7CiAgICAgICAgICAgICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoImJlZm9yZXVubG9hZCIsIGNhbGxiYWNrKTsKICAgICAgICAgICAgICByZXR1cm4gKCkgPT4gewogICAgICAgICAgICAgICAgd2luZG93LnJlbW92ZUV2ZW50TGlzdGVuZXIoImJlZm9yZXVubG9hZCIsIGNhbGxiYWNrKTsKICAgICAgICAgICAgICB9OwogICAgICAgICAgICB9LCBbY2FsbGJhY2tdKTsKICAgICAgICAgIH0gLy8jZW5kcmVnaW9uCiAgICAgICAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwogICAgICAgICAgLy8jcmVnaW9uIFV0aWxzCiAgICAgICAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwoKCiAgICAgICAgICBmdW5jdGlvbiBkaXN0X3dhcm5pbmcoY29uZCwgbWVzc2FnZSkgewogICAgICAgICAgICBpZiAoIWNvbmQpIHsKICAgICAgICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tY29uc29sZQogICAgICAgICAgICAgIGlmICh0eXBlb2YgY29uc29sZSAhPT0gInVuZGVmaW5lZCIpIGNvbnNvbGUud2FybihtZXNzYWdlKTsKCiAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIC8vIFdlbGNvbWUgdG8gZGVidWdnaW5nIFJlYWN0IFJvdXRlciEKICAgICAgICAgICAgICAgIC8vCiAgICAgICAgICAgICAgICAvLyBUaGlzIGVycm9yIGlzIHRocm93biBhcyBhIGNvbnZlbmllbmNlIHNvIHlvdSBjYW4gbW9yZSBlYXNpbHkKICAgICAgICAgICAgICAgIC8vIGZpbmQgdGhlIHNvdXJjZSBmb3IgYSB3YXJuaW5nIHRoYXQgYXBwZWFycyBpbiB0aGUgY29uc29sZSBieQogICAgICAgICAgICAgICAgLy8gZW5hYmxpbmcgInBhdXNlIG9uIGV4Y2VwdGlvbnMiIGluIHlvdXIgSmF2YVNjcmlwdCBkZWJ1Z2dlci4KICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihtZXNzYWdlKTsgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG5vLWVtcHR5CiAgICAgICAgICAgICAgfSBjYXRjaCAoZSkge30KICAgICAgICAgICAgfQogICAgICAgICAgfSAvLyNlbmRyZWdpb24KCgoKCiAgICAgICAgICA7IC8vIENPTkNBVEVOQVRFRCBNT0RVTEU6IC4vc3JjL3JlbGF5L2NvbXBvbmVudHMvTGF5b3V0LnRzeAoKCgoKICAgICAgICAgIHZhciBMYXlvdXQgPSBmdW5jdGlvbiBMYXlvdXQoX3JlZikge3ZhciBwYWdlcyA9IF9yZWYucGFnZXM7CiAgICAgICAgICAgIHZhciBvdXRsZXQgPSAvKiNfX1BVUkVfXyovCiAgICAgICAgICAgIHJlYWN0LmNyZWF0ZUVsZW1lbnQocmVhY3QuRnJhZ21lbnQsIG51bGwsIC8qI19fUFVSRV9fKi8KICAgICAgICAgICAgcmVhY3QuY3JlYXRlRWxlbWVudCgiZGl2IiwgeyBpZDogIm5vdGlmaWNhdGlvbnNDb250YWluZXIiIH0pLCAvKiNfX1BVUkVfXyovCiAgICAgICAgICAgIHJlYWN0LmNyZWF0ZUVsZW1lbnQoImRpdiIsIHsgaWQ6ICJyZWxheUNvbnRhaW5lciIgfSwgLyojX19QVVJFX18qLwogICAgICAgICAgICByZWFjdC5jcmVhdGVFbGVtZW50KE91dGxldCwgbnVsbCkpKTsKCgoKCiAgICAgICAgICAgIGlmIChwYWdlcy5sZW5ndGggPD0gMSkgewogICAgICAgICAgICAgIHJldHVybiBvdXRsZXQ7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybiAvKiNfX1BVUkVfXyovKAogICAgICAgICAgICAgIHJlYWN0LmNyZWF0ZUVsZW1lbnQocmVhY3QuRnJhZ21lbnQsIG51bGwsCiAgICAgICAgICAgICAgIiAiLCAvKiNfX1BVUkVfXyovCiAgICAgICAgICAgICAgcmVhY3QuY3JlYXRlRWxlbWVudCgibmF2IiwgbnVsbCwgLyojX19QVVJFX18qLwogICAgICAgICAgICAgIHJlYWN0LmNyZWF0ZUVsZW1lbnQoImRpdiIsIHsgY2xhc3NOYW1lOiAidG9wQmFyIiB9LAogICAgICAgICAgICAgICIgIiwKICAgICAgICAgICAgICBwYWdlcy5tYXAoZnVuY3Rpb24gKHAsIGluZGV4KSB7cmV0dXJuIC8qI19fUFVSRV9fKi8oCiAgICAgICAgICAgICAgICAgIHJlYWN0LmNyZWF0ZUVsZW1lbnQoImRpdiIsIHsga2V5OiBpbmRleCwgY2xhc3NOYW1lOiAidGFiRW50cnkiIH0sIC8qI19fUFVSRV9fKi8KICAgICAgICAgICAgICAgICAgcmVhY3QuY3JlYXRlRWxlbWVudChOYXZMaW5rLCB7IHRvOiAiLyIgKyBwLmZpbGUgfSwgcC5wYWdlKSwgIiAiKSk7fSkpKSwKCgoKICAgICAgICAgICAgICAiICIsCiAgICAgICAgICAgICAgb3V0bGV0KSk7CgoKICAgICAgICAgIH07CgogICAgICAgICAgLyogaGFybW9ueSBkZWZhdWx0IGV4cG9ydCAqL3ZhciBjb21wb25lbnRzX0xheW91dCA9IExheW91dDsKICAgICAgICAgIDsgLy8gQ09OQ0FURU5BVEVEIE1PRFVMRTogLi9zcmMvcmVsYXkvYXBpL0FwaVJlcXVlc3QudHN4CiAgICAgICAgICBmdW5jdGlvbiBfdHlwZW9mKG9iaikgeyJAYmFiZWwvaGVscGVycyAtIHR5cGVvZiI7cmV0dXJuIF90eXBlb2YgPSAiZnVuY3Rpb24iID09IHR5cGVvZiBTeW1ib2wgJiYgInN5bWJvbCIgPT0gdHlwZW9mIFN5bWJvbC5pdGVyYXRvciA/IGZ1bmN0aW9uIChvYmopIHtyZXR1cm4gdHlwZW9mIG9iajt9IDogZnVuY3Rpb24gKG9iaikge3JldHVybiBvYmogJiYgImZ1bmN0aW9uIiA9PSB0eXBlb2YgU3ltYm9sICYmIG9iai5jb25zdHJ1Y3RvciA9PT0gU3ltYm9sICYmIG9iaiAhPT0gU3ltYm9sLnByb3RvdHlwZSA/ICJzeW1ib2wiIDogdHlwZW9mIG9iajt9LCBfdHlwZW9mKG9iaik7fWZ1bmN0aW9uIF9yZWdlbmVyYXRvclJ1bnRpbWUoKSB7InVzZSBzdHJpY3QiOwogICAgICAgICAgICAvKiEgcmVnZW5lcmF0b3ItcnVudGltZSAtLSBDb3B5cmlnaHQgKGMpIDIwMTQtcHJlc2VudCwgRmFjZWJvb2ssIEluYy4gLS0gbGljZW5zZSAoTUlUKTogaHR0cHM6Ly9naXRodWIuY29tL2ZhY2Vib29rL3JlZ2VuZXJhdG9yL2Jsb2IvbWFpbi9MSUNFTlNFICovX3JlZ2VuZXJhdG9yUnVudGltZSA9IGZ1bmN0aW9uIF9yZWdlbmVyYXRvclJ1bnRpbWUoKSB7cmV0dXJuIGV4cG9ydHM7fTt2YXIgZXhwb3J0cyA9IHt9LE9wID0gT2JqZWN0LnByb3RvdHlwZSxoYXNPd24gPSBPcC5oYXNPd25Qcm9wZXJ0eSxkZWZpbmVQcm9wZXJ0eSA9IE9iamVjdC5kZWZpbmVQcm9wZXJ0eSB8fCBmdW5jdGlvbiAob2JqLCBrZXksIGRlc2MpIHtvYmpba2V5XSA9IGRlc2MudmFsdWU7fSwkU3ltYm9sID0gImZ1bmN0aW9uIiA9PSB0eXBlb2YgU3ltYm9sID8gU3ltYm9sIDoge30saXRlcmF0b3JTeW1ib2wgPSAkU3ltYm9sLml0ZXJhdG9yIHx8ICJAQGl0ZXJhdG9yIixhc3luY0l0ZXJhdG9yU3ltYm9sID0gJFN5bWJvbC5hc3luY0l0ZXJhdG9yIHx8ICJAQGFzeW5jSXRlcmF0b3IiLHRvU3RyaW5nVGFnU3ltYm9sID0gJFN5bWJvbC50b1N0cmluZ1RhZyB8fCAiQEB0b1N0cmluZ1RhZyI7ZnVuY3Rpb24gZGVmaW5lKG9iaiwga2V5LCB2YWx1ZSkge3JldHVybiBPYmplY3QuZGVmaW5lUHJvcGVydHkob2JqLCBrZXksIHsgdmFsdWU6IHZhbHVlLCBlbnVtZXJhYmxlOiAhMCwgY29uZmlndXJhYmxlOiAhMCwgd3JpdGFibGU6ICEwIH0pLCBvYmpba2V5XTt9dHJ5IHtkZWZpbmUoe30sICIiKTt9IGNhdGNoIChlcnIpIHtkZWZpbmUgPSBmdW5jdGlvbiBkZWZpbmUob2JqLCBrZXksIHZhbHVlKSB7cmV0dXJuIG9ialtrZXldID0gdmFsdWU7fTt9ZnVuY3Rpb24gd3JhcChpbm5lckZuLCBvdXRlckZuLCBzZWxmLCB0cnlMb2NzTGlzdCkge3ZhciBwcm90b0dlbmVyYXRvciA9IG91dGVyRm4gJiYgb3V0ZXJGbi5wcm90b3R5cGUgaW5zdGFuY2VvZiBHZW5lcmF0b3IgPyBvdXRlckZuIDogR2VuZXJhdG9yLGdlbmVyYXRvciA9IE9iamVjdC5jcmVhdGUocHJvdG9HZW5lcmF0b3IucHJvdG90eXBlKSxjb250ZXh0ID0gbmV3IENvbnRleHQodHJ5TG9jc0xpc3QgfHwgW10pO3JldHVybiBkZWZpbmVQcm9wZXJ0eShnZW5lcmF0b3IsICJfaW52b2tlIiwgeyB2YWx1ZTogbWFrZUludm9rZU1ldGhvZChpbm5lckZuLCBzZWxmLCBjb250ZXh0KSB9KSwgZ2VuZXJhdG9yO31mdW5jdGlvbiB0cnlDYXRjaChmbiwgb2JqLCBhcmcpIHt0cnkge3JldHVybiB7IHR5cGU6ICJub3JtYWwiLCBhcmc6IGZuLmNhbGwob2JqLCBhcmcpIH07fSBjYXRjaCAoZXJyKSB7cmV0dXJuIHsgdHlwZTogInRocm93IiwgYXJnOiBlcnIgfTt9fWV4cG9ydHMud3JhcCA9IHdyYXA7dmFyIENvbnRpbnVlU2VudGluZWwgPSB7fTtmdW5jdGlvbiBHZW5lcmF0b3IoKSB7fWZ1bmN0aW9uIEdlbmVyYXRvckZ1bmN0aW9uKCkge31mdW5jdGlvbiBHZW5lcmF0b3JGdW5jdGlvblByb3RvdHlwZSgpIHt9dmFyIEl0ZXJhdG9yUHJvdG90eXBlID0ge307ZGVmaW5lKEl0ZXJhdG9yUHJvdG90eXBlLCBpdGVyYXRvclN5bWJvbCwgZnVuY3Rpb24gKCkge3JldHVybiB0aGlzO30pO3ZhciBnZXRQcm90byA9IE9iamVjdC5nZXRQcm90b3R5cGVPZixOYXRpdmVJdGVyYXRvclByb3RvdHlwZSA9IGdldFByb3RvICYmIGdldFByb3RvKGdldFByb3RvKHZhbHVlcyhbXSkpKTtOYXRpdmVJdGVyYXRvclByb3RvdHlwZSAmJiBOYXRpdmVJdGVyYXRvclByb3RvdHlwZSAhPT0gT3AgJiYgaGFzT3duLmNhbGwoTmF0aXZlSXRlcmF0b3JQcm90b3R5cGUsIGl0ZXJhdG9yU3ltYm9sKSAmJiAoSXRlcmF0b3JQcm90b3R5cGUgPSBOYXRpdmVJdGVyYXRvclByb3RvdHlwZSk7dmFyIEdwID0gR2VuZXJhdG9yRnVuY3Rpb25Qcm90b3R5cGUucHJvdG90eXBlID0gR2VuZXJhdG9yLnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoSXRlcmF0b3JQcm90b3R5cGUpO2Z1bmN0aW9uIGRlZmluZUl0ZXJhdG9yTWV0aG9kcyhwcm90b3R5cGUpIHtbIm5leHQiLCAidGhyb3ciLCAicmV0dXJuIl0uZm9yRWFjaChmdW5jdGlvbiAobWV0aG9kKSB7ZGVmaW5lKHByb3RvdHlwZSwgbWV0aG9kLCBmdW5jdGlvbiAoYXJnKSB7cmV0dXJuIHRoaXMuX2ludm9rZShtZXRob2QsIGFyZyk7fSk7fSk7fWZ1bmN0aW9uIEFzeW5jSXRlcmF0b3IoZ2VuZXJhdG9yLCBQcm9taXNlSW1wbCkge2Z1bmN0aW9uIGludm9rZShtZXRob2QsIGFyZywgcmVzb2x2ZSwgcmVqZWN0KSB7dmFyIHJlY29yZCA9IHRyeUNhdGNoKGdlbmVyYXRvclttZXRob2RdLCBnZW5lcmF0b3IsIGFyZyk7aWYgKCJ0aHJvdyIgIT09IHJlY29yZC50eXBlKSB7dmFyIHJlc3VsdCA9IHJlY29yZC5hcmcsdmFsdWUgPSByZXN1bHQudmFsdWU7cmV0dXJuIHZhbHVlICYmICJvYmplY3QiID09IF90eXBlb2YodmFsdWUpICYmIGhhc093bi5jYWxsKHZhbHVlLCAiX19hd2FpdCIpID8gUHJvbWlzZUltcGwucmVzb2x2ZSh2YWx1ZS5fX2F3YWl0KS50aGVuKGZ1bmN0aW9uICh2YWx1ZSkge2ludm9rZSgibmV4dCIsIHZhbHVlLCByZXNvbHZlLCByZWplY3QpO30sIGZ1bmN0aW9uIChlcnIpIHtpbnZva2UoInRocm93IiwgZXJyLCByZXNvbHZlLCByZWplY3QpO30pIDogUHJvbWlzZUltcGwucmVzb2x2ZSh2YWx1ZSkudGhlbihmdW5jdGlvbiAodW53cmFwcGVkKSB7cmVzdWx0LnZhbHVlID0gdW53cmFwcGVkLCByZXNvbHZlKHJlc3VsdCk7fSwgZnVuY3Rpb24gKGVycm9yKSB7cmV0dXJuIGludm9rZSgidGhyb3ciLCBlcnJvciwgcmVzb2x2ZSwgcmVqZWN0KTt9KTt9cmVqZWN0KHJlY29yZC5hcmcpO312YXIgcHJldmlvdXNQcm9taXNlO2RlZmluZVByb3BlcnR5KHRoaXMsICJfaW52b2tlIiwgeyB2YWx1ZTogZnVuY3Rpb24gdmFsdWUobWV0aG9kLCBhcmcpIHtmdW5jdGlvbiBjYWxsSW52b2tlV2l0aE1ldGhvZEFuZEFyZygpIHtyZXR1cm4gbmV3IFByb21pc2VJbXBsKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtpbnZva2UobWV0aG9kLCBhcmcsIHJlc29sdmUsIHJlamVjdCk7fSk7fXJldHVybiBwcmV2aW91c1Byb21pc2UgPSBwcmV2aW91c1Byb21pc2UgPyBwcmV2aW91c1Byb21pc2UudGhlbihjYWxsSW52b2tlV2l0aE1ldGhvZEFuZEFyZywgY2FsbEludm9rZVdpdGhNZXRob2RBbmRBcmcpIDogY2FsbEludm9rZVdpdGhNZXRob2RBbmRBcmcoKTt9IH0pO31mdW5jdGlvbiBtYWtlSW52b2tlTWV0aG9kKGlubmVyRm4sIHNlbGYsIGNvbnRleHQpIHt2YXIgc3RhdGUgPSAic3VzcGVuZGVkU3RhcnQiO3JldHVybiBmdW5jdGlvbiAobWV0aG9kLCBhcmcpIHtpZiAoImV4ZWN1dGluZyIgPT09IHN0YXRlKSB0aHJvdyBuZXcgRXJyb3IoIkdlbmVyYXRvciBpcyBhbHJlYWR5IHJ1bm5pbmciKTtpZiAoImNvbXBsZXRlZCIgPT09IHN0YXRlKSB7aWYgKCJ0aHJvdyIgPT09IG1ldGhvZCkgdGhyb3cgYXJnO3JldHVybiBkb25lUmVzdWx0KCk7fWZvciAoY29udGV4dC5tZXRob2QgPSBtZXRob2QsIGNvbnRleHQuYXJnID0gYXJnOzspIHt2YXIgZGVsZWdhdGUgPSBjb250ZXh0LmRlbGVnYXRlO2lmIChkZWxlZ2F0ZSkge3ZhciBkZWxlZ2F0ZVJlc3VsdCA9IG1heWJlSW52b2tlRGVsZWdhdGUoZGVsZWdhdGUsIGNvbnRleHQpO2lmIChkZWxlZ2F0ZVJlc3VsdCkge2lmIChkZWxlZ2F0ZVJlc3VsdCA9PT0gQ29udGludWVTZW50aW5lbCkgY29udGludWU7cmV0dXJuIGRlbGVnYXRlUmVzdWx0O319aWYgKCJuZXh0IiA9PT0gY29udGV4dC5tZXRob2QpIGNvbnRleHQuc2VudCA9IGNvbnRleHQuX3NlbnQgPSBjb250ZXh0LmFyZztlbHNlIGlmICgidGhyb3ciID09PSBjb250ZXh0Lm1ldGhvZCkge2lmICgic3VzcGVuZGVkU3RhcnQiID09PSBzdGF0ZSkgdGhyb3cgc3RhdGUgPSAiY29tcGxldGVkIiwgY29udGV4dC5hcmc7Y29udGV4dC5kaXNwYXRjaEV4Y2VwdGlvbihjb250ZXh0LmFyZyk7fSBlbHNlICJyZXR1cm4iID09PSBjb250ZXh0Lm1ldGhvZCAmJiBjb250ZXh0LmFicnVwdCgicmV0dXJuIiwgY29udGV4dC5hcmcpO3N0YXRlID0gImV4ZWN1dGluZyI7dmFyIHJlY29yZCA9IHRyeUNhdGNoKGlubmVyRm4sIHNlbGYsIGNvbnRleHQpO2lmICgibm9ybWFsIiA9PT0gcmVjb3JkLnR5cGUpIHtpZiAoc3RhdGUgPSBjb250ZXh0LmRvbmUgPyAiY29tcGxldGVkIiA6ICJzdXNwZW5kZWRZaWVsZCIsIHJlY29yZC5hcmcgPT09IENvbnRpbnVlU2VudGluZWwpIGNvbnRpbnVlO3JldHVybiB7IHZhbHVlOiByZWNvcmQuYXJnLCBkb25lOiBjb250ZXh0LmRvbmUgfTt9InRocm93IiA9PT0gcmVjb3JkLnR5cGUgJiYgKHN0YXRlID0gImNvbXBsZXRlZCIsIGNvbnRleHQubWV0aG9kID0gInRocm93IiwgY29udGV4dC5hcmcgPSByZWNvcmQuYXJnKTt9fTt9ZnVuY3Rpb24gbWF5YmVJbnZva2VEZWxlZ2F0ZShkZWxlZ2F0ZSwgY29udGV4dCkge3ZhciBtZXRob2ROYW1lID0gY29udGV4dC5tZXRob2QsbWV0aG9kID0gZGVsZWdhdGUuaXRlcmF0b3JbbWV0aG9kTmFtZV07aWYgKHVuZGVmaW5lZCA9PT0gbWV0aG9kKSByZXR1cm4gY29udGV4dC5kZWxlZ2F0ZSA9IG51bGwsICJ0aHJvdyIgPT09IG1ldGhvZE5hbWUgJiYgZGVsZWdhdGUuaXRlcmF0b3JbInJldHVybiJdICYmIChjb250ZXh0Lm1ldGhvZCA9ICJyZXR1cm4iLCBjb250ZXh0LmFyZyA9IHVuZGVmaW5lZCwgbWF5YmVJbnZva2VEZWxlZ2F0ZShkZWxlZ2F0ZSwgY29udGV4dCksICJ0aHJvdyIgPT09IGNvbnRleHQubWV0aG9kKSB8fCAicmV0dXJuIiAhPT0gbWV0aG9kTmFtZSAmJiAoY29udGV4dC5tZXRob2QgPSAidGhyb3ciLCBjb250ZXh0LmFyZyA9IG5ldyBUeXBlRXJyb3IoIlRoZSBpdGVyYXRvciBkb2VzIG5vdCBwcm92aWRlIGEgJyIgKyBtZXRob2ROYW1lICsgIicgbWV0aG9kIikpLCBDb250aW51ZVNlbnRpbmVsO3ZhciByZWNvcmQgPSB0cnlDYXRjaChtZXRob2QsIGRlbGVnYXRlLml0ZXJhdG9yLCBjb250ZXh0LmFyZyk7aWYgKCJ0aHJvdyIgPT09IHJlY29yZC50eXBlKSByZXR1cm4gY29udGV4dC5tZXRob2QgPSAidGhyb3ciLCBjb250ZXh0LmFyZyA9IHJlY29yZC5hcmcsIGNvbnRleHQuZGVsZWdhdGUgPSBudWxsLCBDb250aW51ZVNlbnRpbmVsO3ZhciBpbmZvID0gcmVjb3JkLmFyZztyZXR1cm4gaW5mbyA/IGluZm8uZG9uZSA/IChjb250ZXh0W2RlbGVnYXRlLnJlc3VsdE5hbWVdID0gaW5mby52YWx1ZSwgY29udGV4dC5uZXh0ID0gZGVsZWdhdGUubmV4dExvYywgInJldHVybiIgIT09IGNvbnRleHQubWV0aG9kICYmIChjb250ZXh0Lm1ldGhvZCA9ICJuZXh0IiwgY29udGV4dC5hcmcgPSB1bmRlZmluZWQpLCBjb250ZXh0LmRlbGVnYXRlID0gbnVsbCwgQ29udGludWVTZW50aW5lbCkgOiBpbmZvIDogKGNvbnRleHQubWV0aG9kID0gInRocm93IiwgY29udGV4dC5hcmcgPSBuZXcgVHlwZUVycm9yKCJpdGVyYXRvciByZXN1bHQgaXMgbm90IGFuIG9iamVjdCIpLCBjb250ZXh0LmRlbGVnYXRlID0gbnVsbCwgQ29udGludWVTZW50aW5lbCk7fWZ1bmN0aW9uIHB1c2hUcnlFbnRyeShsb2NzKSB7dmFyIGVudHJ5ID0geyB0cnlMb2M6IGxvY3NbMF0gfTsxIGluIGxvY3MgJiYgKGVudHJ5LmNhdGNoTG9jID0gbG9jc1sxXSksIDIgaW4gbG9jcyAmJiAoZW50cnkuZmluYWxseUxvYyA9IGxvY3NbMl0sIGVudHJ5LmFmdGVyTG9jID0gbG9jc1szXSksIHRoaXMudHJ5RW50cmllcy5wdXNoKGVudHJ5KTt9ZnVuY3Rpb24gcmVzZXRUcnlFbnRyeShlbnRyeSkge3ZhciByZWNvcmQgPSBlbnRyeS5jb21wbGV0aW9uIHx8IHt9O3JlY29yZC50eXBlID0gIm5vcm1hbCIsIGRlbGV0ZSByZWNvcmQuYXJnLCBlbnRyeS5jb21wbGV0aW9uID0gcmVjb3JkO31mdW5jdGlvbiBDb250ZXh0KHRyeUxvY3NMaXN0KSB7dGhpcy50cnlFbnRyaWVzID0gW3sgdHJ5TG9jOiAicm9vdCIgfV0sIHRyeUxvY3NMaXN0LmZvckVhY2gocHVzaFRyeUVudHJ5LCB0aGlzKSwgdGhpcy5yZXNldCghMCk7fWZ1bmN0aW9uIHZhbHVlcyhpdGVyYWJsZSkge2lmIChpdGVyYWJsZSkge3ZhciBpdGVyYXRvck1ldGhvZCA9IGl0ZXJhYmxlW2l0ZXJhdG9yU3ltYm9sXTtpZiAoaXRlcmF0b3JNZXRob2QpIHJldHVybiBpdGVyYXRvck1ldGhvZC5jYWxsKGl0ZXJhYmxlKTtpZiAoImZ1bmN0aW9uIiA9PSB0eXBlb2YgaXRlcmFibGUubmV4dCkgcmV0dXJuIGl0ZXJhYmxlO2lmICghaXNOYU4oaXRlcmFibGUubGVuZ3RoKSkge3ZhciBpID0gLTEsbmV4dCA9IGZ1bmN0aW9uIG5leHQoKSB7Zm9yICg7ICsraSA8IGl0ZXJhYmxlLmxlbmd0aDspIHtpZiAoaGFzT3duLmNhbGwoaXRlcmFibGUsIGkpKSByZXR1cm4gbmV4dC52YWx1ZSA9IGl0ZXJhYmxlW2ldLCBuZXh0LmRvbmUgPSAhMSwgbmV4dDt9cmV0dXJuIG5leHQudmFsdWUgPSB1bmRlZmluZWQsIG5leHQuZG9uZSA9ICEwLCBuZXh0O307cmV0dXJuIG5leHQubmV4dCA9IG5leHQ7fX1yZXR1cm4geyBuZXh0OiBkb25lUmVzdWx0IH07fWZ1bmN0aW9uIGRvbmVSZXN1bHQoKSB7cmV0dXJuIHsgdmFsdWU6IHVuZGVmaW5lZCwgZG9uZTogITAgfTt9cmV0dXJuIEdlbmVyYXRvckZ1bmN0aW9uLnByb3RvdHlwZSA9IEdlbmVyYXRvckZ1bmN0aW9uUHJvdG90eXBlLCBkZWZpbmVQcm9wZXJ0eShHcCwgImNvbnN0cnVjdG9yIiwgeyB2YWx1ZTogR2VuZXJhdG9yRnVuY3Rpb25Qcm90b3R5cGUsIGNvbmZpZ3VyYWJsZTogITAgfSksIGRlZmluZVByb3BlcnR5KEdlbmVyYXRvckZ1bmN0aW9uUHJvdG90eXBlLCAiY29uc3RydWN0b3IiLCB7IHZhbHVlOiBHZW5lcmF0b3JGdW5jdGlvbiwgY29uZmlndXJhYmxlOiAhMCB9KSwgR2VuZXJhdG9yRnVuY3Rpb24uZGlzcGxheU5hbWUgPSBkZWZpbmUoR2VuZXJhdG9yRnVuY3Rpb25Qcm90b3R5cGUsIHRvU3RyaW5nVGFnU3ltYm9sLCAiR2VuZXJhdG9yRnVuY3Rpb24iKSwgZXhwb3J0cy5pc0dlbmVyYXRvckZ1bmN0aW9uID0gZnVuY3Rpb24gKGdlbkZ1bikge3ZhciBjdG9yID0gImZ1bmN0aW9uIiA9PSB0eXBlb2YgZ2VuRnVuICYmIGdlbkZ1bi5jb25zdHJ1Y3RvcjtyZXR1cm4gISFjdG9yICYmIChjdG9yID09PSBHZW5lcmF0b3JGdW5jdGlvbiB8fCAiR2VuZXJhdG9yRnVuY3Rpb24iID09PSAoY3Rvci5kaXNwbGF5TmFtZSB8fCBjdG9yLm5hbWUpKTt9LCBleHBvcnRzLm1hcmsgPSBmdW5jdGlvbiAoZ2VuRnVuKSB7cmV0dXJuIE9iamVjdC5zZXRQcm90b3R5cGVPZiA/IE9iamVjdC5zZXRQcm90b3R5cGVPZihnZW5GdW4sIEdlbmVyYXRvckZ1bmN0aW9uUHJvdG90eXBlKSA6IChnZW5GdW4uX19wcm90b19fID0gR2VuZXJhdG9yRnVuY3Rpb25Qcm90b3R5cGUsIGRlZmluZShnZW5GdW4sIHRvU3RyaW5nVGFnU3ltYm9sLCAiR2VuZXJhdG9yRnVuY3Rpb24iKSksIGdlbkZ1bi5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKEdwKSwgZ2VuRnVuO30sIGV4cG9ydHMuYXdyYXAgPSBmdW5jdGlvbiAoYXJnKSB7cmV0dXJuIHsgX19hd2FpdDogYXJnIH07fSwgZGVmaW5lSXRlcmF0b3JNZXRob2RzKEFzeW5jSXRlcmF0b3IucHJvdG90eXBlKSwgZGVmaW5lKEFzeW5jSXRlcmF0b3IucHJvdG90eXBlLCBhc3luY0l0ZXJhdG9yU3ltYm9sLCBmdW5jdGlvbiAoKSB7cmV0dXJuIHRoaXM7fSksIGV4cG9ydHMuQXN5bmNJdGVyYXRvciA9IEFzeW5jSXRlcmF0b3IsIGV4cG9ydHMuYXN5bmMgPSBmdW5jdGlvbiAoaW5uZXJGbiwgb3V0ZXJGbiwgc2VsZiwgdHJ5TG9jc0xpc3QsIFByb21pc2VJbXBsKSB7dm9pZCAwID09PSBQcm9taXNlSW1wbCAmJiAoUHJvbWlzZUltcGwgPSBQcm9taXNlKTt2YXIgaXRlciA9IG5ldyBBc3luY0l0ZXJhdG9yKHdyYXAoaW5uZXJGbiwgb3V0ZXJGbiwgc2VsZiwgdHJ5TG9jc0xpc3QpLCBQcm9taXNlSW1wbCk7cmV0dXJuIGV4cG9ydHMuaXNHZW5lcmF0b3JGdW5jdGlvbihvdXRlckZuKSA/IGl0ZXIgOiBpdGVyLm5leHQoKS50aGVuKGZ1bmN0aW9uIChyZXN1bHQpIHtyZXR1cm4gcmVzdWx0LmRvbmUgPyByZXN1bHQudmFsdWUgOiBpdGVyLm5leHQoKTt9KTt9LCBkZWZpbmVJdGVyYXRvck1ldGhvZHMoR3ApLCBkZWZpbmUoR3AsIHRvU3RyaW5nVGFnU3ltYm9sLCAiR2VuZXJhdG9yIiksIGRlZmluZShHcCwgaXRlcmF0b3JTeW1ib2wsIGZ1bmN0aW9uICgpIHtyZXR1cm4gdGhpczt9KSwgZGVmaW5lKEdwLCAidG9TdHJpbmciLCBmdW5jdGlvbiAoKSB7cmV0dXJuICJbb2JqZWN0IEdlbmVyYXRvcl0iO30pLCBleHBvcnRzLmtleXMgPSBmdW5jdGlvbiAodmFsKSB7dmFyIG9iamVjdCA9IE9iamVjdCh2YWwpLGtleXMgPSBbXTtmb3IgKHZhciBrZXkgaW4gb2JqZWN0KSB7a2V5cy5wdXNoKGtleSk7fXJldHVybiBrZXlzLnJldmVyc2UoKSwgZnVuY3Rpb24gbmV4dCgpIHtmb3IgKDsga2V5cy5sZW5ndGg7KSB7dmFyIGtleSA9IGtleXMucG9wKCk7aWYgKGtleSBpbiBvYmplY3QpIHJldHVybiBuZXh0LnZhbHVlID0ga2V5LCBuZXh0LmRvbmUgPSAhMSwgbmV4dDt9cmV0dXJuIG5leHQuZG9uZSA9ICEwLCBuZXh0O307fSwgZXhwb3J0cy52YWx1ZXMgPSB2YWx1ZXMsIENvbnRleHQucHJvdG90eXBlID0geyBjb25zdHJ1Y3RvcjogQ29udGV4dCwgcmVzZXQ6IGZ1bmN0aW9uIHJlc2V0KHNraXBUZW1wUmVzZXQpIHtpZiAodGhpcy5wcmV2ID0gMCwgdGhpcy5uZXh0ID0gMCwgdGhpcy5zZW50ID0gdGhpcy5fc2VudCA9IHVuZGVmaW5lZCwgdGhpcy5kb25lID0gITEsIHRoaXMuZGVsZWdhdGUgPSBudWxsLCB0aGlzLm1ldGhvZCA9ICJuZXh0IiwgdGhpcy5hcmcgPSB1bmRlZmluZWQsIHRoaXMudHJ5RW50cmllcy5mb3JFYWNoKHJlc2V0VHJ5RW50cnkpLCAhc2tpcFRlbXBSZXNldCkgZm9yICh2YXIgbmFtZSBpbiB0aGlzKSB7InQiID09PSBuYW1lLmNoYXJBdCgwKSAmJiBoYXNPd24uY2FsbCh0aGlzLCBuYW1lKSAmJiAhaXNOYU4oK25hbWUuc2xpY2UoMSkpICYmICh0aGlzW25hbWVdID0gdW5kZWZpbmVkKTt9fSwgc3RvcDogZnVuY3Rpb24gc3RvcCgpIHt0aGlzLmRvbmUgPSAhMDt2YXIgcm9vdFJlY29yZCA9IHRoaXMudHJ5RW50cmllc1swXS5jb21wbGV0aW9uO2lmICgidGhyb3ciID09PSByb290UmVjb3JkLnR5cGUpIHRocm93IHJvb3RSZWNvcmQuYXJnO3JldHVybiB0aGlzLnJ2YWw7fSwgZGlzcGF0Y2hFeGNlcHRpb246IGZ1bmN0aW9uIGRpc3BhdGNoRXhjZXB0aW9uKGV4Y2VwdGlvbikge2lmICh0aGlzLmRvbmUpIHRocm93IGV4Y2VwdGlvbjt2YXIgY29udGV4dCA9IHRoaXM7ZnVuY3Rpb24gaGFuZGxlKGxvYywgY2F1Z2h0KSB7cmV0dXJuIHJlY29yZC50eXBlID0gInRocm93IiwgcmVjb3JkLmFyZyA9IGV4Y2VwdGlvbiwgY29udGV4dC5uZXh0ID0gbG9jLCBjYXVnaHQgJiYgKGNvbnRleHQubWV0aG9kID0gIm5leHQiLCBjb250ZXh0LmFyZyA9IHVuZGVmaW5lZCksICEhY2F1Z2h0O31mb3IgKHZhciBpID0gdGhpcy50cnlFbnRyaWVzLmxlbmd0aCAtIDE7IGkgPj0gMDsgLS1pKSB7dmFyIGVudHJ5ID0gdGhpcy50cnlFbnRyaWVzW2ldLHJlY29yZCA9IGVudHJ5LmNvbXBsZXRpb247aWYgKCJyb290IiA9PT0gZW50cnkudHJ5TG9jKSByZXR1cm4gaGFuZGxlKCJlbmQiKTtpZiAoZW50cnkudHJ5TG9jIDw9IHRoaXMucHJldikge3ZhciBoYXNDYXRjaCA9IGhhc093bi5jYWxsKGVudHJ5LCAiY2F0Y2hMb2MiKSxoYXNGaW5hbGx5ID0gaGFzT3duLmNhbGwoZW50cnksICJmaW5hbGx5TG9jIik7aWYgKGhhc0NhdGNoICYmIGhhc0ZpbmFsbHkpIHtpZiAodGhpcy5wcmV2IDwgZW50cnkuY2F0Y2hMb2MpIHJldHVybiBoYW5kbGUoZW50cnkuY2F0Y2hMb2MsICEwKTtpZiAodGhpcy5wcmV2IDwgZW50cnkuZmluYWxseUxvYykgcmV0dXJuIGhhbmRsZShlbnRyeS5maW5hbGx5TG9jKTt9IGVsc2UgaWYgKGhhc0NhdGNoKSB7aWYgKHRoaXMucHJldiA8IGVudHJ5LmNhdGNoTG9jKSByZXR1cm4gaGFuZGxlKGVudHJ5LmNhdGNoTG9jLCAhMCk7fSBlbHNlIHtpZiAoIWhhc0ZpbmFsbHkpIHRocm93IG5ldyBFcnJvcigidHJ5IHN0YXRlbWVudCB3aXRob3V0IGNhdGNoIG9yIGZpbmFsbHkiKTtpZiAodGhpcy5wcmV2IDwgZW50cnkuZmluYWxseUxvYykgcmV0dXJuIGhhbmRsZShlbnRyeS5maW5hbGx5TG9jKTt9fX19LCBhYnJ1cHQ6IGZ1bmN0aW9uIGFicnVwdCh0eXBlLCBhcmcpIHtmb3IgKHZhciBpID0gdGhpcy50cnlFbnRyaWVzLmxlbmd0aCAtIDE7IGkgPj0gMDsgLS1pKSB7dmFyIGVudHJ5ID0gdGhpcy50cnlFbnRyaWVzW2ldO2lmIChlbnRyeS50cnlMb2MgPD0gdGhpcy5wcmV2ICYmIGhhc093bi5jYWxsKGVudHJ5LCAiZmluYWxseUxvYyIpICYmIHRoaXMucHJldiA8IGVudHJ5LmZpbmFsbHlMb2MpIHt2YXIgZmluYWxseUVudHJ5ID0gZW50cnk7YnJlYWs7fX1maW5hbGx5RW50cnkgJiYgKCJicmVhayIgPT09IHR5cGUgfHwgImNvbnRpbnVlIiA9PT0gdHlwZSkgJiYgZmluYWxseUVudHJ5LnRyeUxvYyA8PSBhcmcgJiYgYXJnIDw9IGZpbmFsbHlFbnRyeS5maW5hbGx5TG9jICYmIChmaW5hbGx5RW50cnkgPSBudWxsKTt2YXIgcmVjb3JkID0gZmluYWxseUVudHJ5ID8gZmluYWxseUVudHJ5LmNvbXBsZXRpb24gOiB7fTtyZXR1cm4gcmVjb3JkLnR5cGUgPSB0eXBlLCByZWNvcmQuYXJnID0gYXJnLCBmaW5hbGx5RW50cnkgPyAodGhpcy5tZXRob2QgPSAibmV4dCIsIHRoaXMubmV4dCA9IGZpbmFsbHlFbnRyeS5maW5hbGx5TG9jLCBDb250aW51ZVNlbnRpbmVsKSA6IHRoaXMuY29tcGxldGUocmVjb3JkKTt9LCBjb21wbGV0ZTogZnVuY3Rpb24gY29tcGxldGUocmVjb3JkLCBhZnRlckxvYykge2lmICgidGhyb3ciID09PSByZWNvcmQudHlwZSkgdGhyb3cgcmVjb3JkLmFyZztyZXR1cm4gImJyZWFrIiA9PT0gcmVjb3JkLnR5cGUgfHwgImNvbnRpbnVlIiA9PT0gcmVjb3JkLnR5cGUgPyB0aGlzLm5leHQgPSByZWNvcmQuYXJnIDogInJldHVybiIgPT09IHJlY29yZC50eXBlID8gKHRoaXMucnZhbCA9IHRoaXMuYXJnID0gcmVjb3JkLmFyZywgdGhpcy5tZXRob2QgPSAicmV0dXJuIiwgdGhpcy5uZXh0ID0gImVuZCIpIDogIm5vcm1hbCIgPT09IHJlY29yZC50eXBlICYmIGFmdGVyTG9jICYmICh0aGlzLm5leHQgPSBhZnRlckxvYyksIENvbnRpbnVlU2VudGluZWw7fSwgZmluaXNoOiBmdW5jdGlvbiBmaW5pc2goZmluYWxseUxvYykge2ZvciAodmFyIGkgPSB0aGlzLnRyeUVudHJpZXMubGVuZ3RoIC0gMTsgaSA+PSAwOyAtLWkpIHt2YXIgZW50cnkgPSB0aGlzLnRyeUVudHJpZXNbaV07aWYgKGVudHJ5LmZpbmFsbHlMb2MgPT09IGZpbmFsbHlMb2MpIHJldHVybiB0aGlzLmNvbXBsZXRlKGVudHJ5LmNvbXBsZXRpb24sIGVudHJ5LmFmdGVyTG9jKSwgcmVzZXRUcnlFbnRyeShlbnRyeSksIENvbnRpbnVlU2VudGluZWw7fX0sICJjYXRjaCI6IGZ1bmN0aW9uIF9jYXRjaCh0cnlMb2MpIHtmb3IgKHZhciBpID0gdGhpcy50cnlFbnRyaWVzLmxlbmd0aCAtIDE7IGkgPj0gMDsgLS1pKSB7dmFyIGVudHJ5ID0gdGhpcy50cnlFbnRyaWVzW2ldO2lmIChlbnRyeS50cnlMb2MgPT09IHRyeUxvYykge3ZhciByZWNvcmQgPSBlbnRyeS5jb21wbGV0aW9uO2lmICgidGhyb3ciID09PSByZWNvcmQudHlwZSkge3ZhciB0aHJvd24gPSByZWNvcmQuYXJnO3Jlc2V0VHJ5RW50cnkoZW50cnkpO31yZXR1cm4gdGhyb3duO319dGhyb3cgbmV3IEVycm9yKCJpbGxlZ2FsIGNhdGNoIGF0dGVtcHQiKTt9LCBkZWxlZ2F0ZVlpZWxkOiBmdW5jdGlvbiBkZWxlZ2F0ZVlpZWxkKGl0ZXJhYmxlLCByZXN1bHROYW1lLCBuZXh0TG9jKSB7cmV0dXJuIHRoaXMuZGVsZWdhdGUgPSB7IGl0ZXJhdG9yOiB2YWx1ZXMoaXRlcmFibGUpLCByZXN1bHROYW1lOiByZXN1bHROYW1lLCBuZXh0TG9jOiBuZXh0TG9jIH0sICJuZXh0IiA9PT0gdGhpcy5tZXRob2QgJiYgKHRoaXMuYXJnID0gdW5kZWZpbmVkKSwgQ29udGludWVTZW50aW5lbDt9IH0sIGV4cG9ydHM7fWZ1bmN0aW9uIF9zbGljZWRUb0FycmF5KGFyciwgaSkge3JldHVybiBfYXJyYXlXaXRoSG9sZXMoYXJyKSB8fCBfaXRlcmFibGVUb0FycmF5TGltaXQoYXJyLCBpKSB8fCBfdW5zdXBwb3J0ZWRJdGVyYWJsZVRvQXJyYXkoYXJyLCBpKSB8fCBfbm9uSXRlcmFibGVSZXN0KCk7fWZ1bmN0aW9uIF9ub25JdGVyYWJsZVJlc3QoKSB7dGhyb3cgbmV3IFR5cGVFcnJvcigiSW52YWxpZCBhdHRlbXB0IHRvIGRlc3RydWN0dXJlIG5vbi1pdGVyYWJsZSBpbnN0YW5jZS5cbkluIG9yZGVyIHRvIGJlIGl0ZXJhYmxlLCBub24tYXJyYXkgb2JqZWN0cyBtdXN0IGhhdmUgYSBbU3ltYm9sLml0ZXJhdG9yXSgpIG1ldGhvZC4iKTt9ZnVuY3Rpb24gX3Vuc3VwcG9ydGVkSXRlcmFibGVUb0FycmF5KG8sIG1pbkxlbikge2lmICghbykgcmV0dXJuO2lmICh0eXBlb2YgbyA9PT0gInN0cmluZyIpIHJldHVybiBfYXJyYXlMaWtlVG9BcnJheShvLCBtaW5MZW4pO3ZhciBuID0gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKG8pLnNsaWNlKDgsIC0xKTtpZiAobiA9PT0gIk9iamVjdCIgJiYgby5jb25zdHJ1Y3RvcikgbiA9IG8uY29uc3RydWN0b3IubmFtZTtpZiAobiA9PT0gIk1hcCIgfHwgbiA9PT0gIlNldCIpIHJldHVybiBBcnJheS5mcm9tKG8pO2lmIChuID09PSAiQXJndW1lbnRzIiB8fCAvXig/OlVpfEkpbnQoPzo4fDE2fDMyKSg/OkNsYW1wZWQpP0FycmF5JC8udGVzdChuKSkgcmV0dXJuIF9hcnJheUxpa2VUb0FycmF5KG8sIG1pbkxlbik7fWZ1bmN0aW9uIF9hcnJheUxpa2VUb0FycmF5KGFyciwgbGVuKSB7aWYgKGxlbiA9PSBudWxsIHx8IGxlbiA+IGFyci5sZW5ndGgpIGxlbiA9IGFyci5sZW5ndGg7Zm9yICh2YXIgaSA9IDAsIGFycjIgPSBuZXcgQXJyYXkobGVuKTsgaSA8IGxlbjsgaSsrKSB7YXJyMltpXSA9IGFycltpXTt9cmV0dXJuIGFycjI7fWZ1bmN0aW9uIF9pdGVyYWJsZVRvQXJyYXlMaW1pdChhcnIsIGkpIHt2YXIgX2kgPSBudWxsID09IGFyciA/IG51bGwgOiAidW5kZWZpbmVkIiAhPSB0eXBlb2YgU3ltYm9sICYmIGFycltTeW1ib2wuaXRlcmF0b3JdIHx8IGFyclsiQEBpdGVyYXRvciJdO2lmIChudWxsICE9IF9pKSB7dmFyIF9zLF9lLF94LF9yLF9hcnIgPSBbXSxfbiA9ICEwLF9kID0gITE7dHJ5IHtpZiAoX3ggPSAoX2kgPSBfaS5jYWxsKGFycikpLm5leHQsIDAgPT09IGkpIHtpZiAoT2JqZWN0KF9pKSAhPT0gX2kpIHJldHVybjtfbiA9ICExO30gZWxzZSBmb3IgKDsgIShfbiA9IChfcyA9IF94LmNhbGwoX2kpKS5kb25lKSAmJiAoX2Fyci5wdXNoKF9zLnZhbHVlKSwgX2Fyci5sZW5ndGggIT09IGkpOyBfbiA9ICEwKSB7O319IGNhdGNoIChlcnIpIHtfZCA9ICEwLCBfZSA9IGVycjt9IGZpbmFsbHkge3RyeSB7aWYgKCFfbiAmJiBudWxsICE9IF9pWyJyZXR1cm4iXSAmJiAoX3IgPSBfaVsicmV0dXJuIl0oKSwgT2JqZWN0KF9yKSAhPT0gX3IpKSByZXR1cm47fSBmaW5hbGx5IHtpZiAoX2QpIHRocm93IF9lO319cmV0dXJuIF9hcnI7fX1mdW5jdGlvbiBfYXJyYXlXaXRoSG9sZXMoYXJyKSB7aWYgKEFycmF5LmlzQXJyYXkoYXJyKSkgcmV0dXJuIGFycjt9ZnVuY3Rpb24gYXN5bmNHZW5lcmF0b3JTdGVwKGdlbiwgcmVzb2x2ZSwgcmVqZWN0LCBfbmV4dCwgX3Rocm93LCBrZXksIGFyZykge3RyeSB7dmFyIGluZm8gPSBnZW5ba2V5XShhcmcpO3ZhciB2YWx1ZSA9IGluZm8udmFsdWU7fSBjYXRjaCAoZXJyb3IpIHtyZWplY3QoZXJyb3IpO3JldHVybjt9aWYgKGluZm8uZG9uZSkge3Jlc29sdmUodmFsdWUpO30gZWxzZSB7UHJvbWlzZS5yZXNvbHZlKHZhbHVlKS50aGVuKF9uZXh0LCBfdGhyb3cpO319ZnVuY3Rpb24gX2FzeW5jVG9HZW5lcmF0b3IoZm4pIHtyZXR1cm4gZnVuY3Rpb24gKCkge3ZhciBzZWxmID0gdGhpcyxhcmdzID0gYXJndW1lbnRzO3JldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7dmFyIGdlbiA9IGZuLmFwcGx5KHNlbGYsIGFyZ3MpO2Z1bmN0aW9uIF9uZXh0KHZhbHVlKSB7YXN5bmNHZW5lcmF0b3JTdGVwKGdlbiwgcmVzb2x2ZSwgcmVqZWN0LCBfbmV4dCwgX3Rocm93LCAibmV4dCIsIHZhbHVlKTt9ZnVuY3Rpb24gX3Rocm93KGVycikge2FzeW5jR2VuZXJhdG9yU3RlcChnZW4sIHJlc29sdmUsIHJlamVjdCwgX25leHQsIF90aHJvdywgInRocm93IiwgZXJyKTt9X25leHQodW5kZWZpbmVkKTt9KTt9O31mdW5jdGlvbgogICAgICAgICAgZ2V0UHJvcGVydHkoX3gpIHtyZXR1cm4gX2dldFByb3BlcnR5LmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7fWZ1bmN0aW9uIF9nZXRQcm9wZXJ0eSgpIHtfZ2V0UHJvcGVydHkgPSBfYXN5bmNUb0dlbmVyYXRvciggLyojX19QVVJFX18qL19yZWdlbmVyYXRvclJ1bnRpbWUoKS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUocHJvcGVydHkpIHtyZXR1cm4gX3JlZ2VuZXJhdG9yUnVudGltZSgpLndyYXAoZnVuY3Rpb24gX2NhbGxlZSQoX2NvbnRleHQpIHt3aGlsZSAoMSkge3N3aXRjaCAoX2NvbnRleHQucHJldiA9IF9jb250ZXh0Lm5leHQpIHtjYXNlIDA6cmV0dXJuIF9jb250ZXh0LmFicnVwdCgicmV0dXJuIiwKICAgICAgICAgICAgICAgICAgICAgIHJ1bkphdmFzY3JpcHQoInJlcXVpcmUoYGtvbG1hZmlhYCkuZ2V0UHJvcGVydHkoYCIuY29uY2F0KHByb3BlcnR5LCAiYCk7IikpKTtjYXNlIDE6Y2FzZSAiZW5kIjpyZXR1cm4gX2NvbnRleHQuc3RvcCgpO319fSwgX2NhbGxlZSk7fSkpO3JldHVybiBfZ2V0UHJvcGVydHkuYXBwbHkodGhpcywgYXJndW1lbnRzKTt9CgoKICAgICAgICAgIGZ1bmN0aW9uIGFkZE5vdGlmaWNhdGlvbihub3RpZmljYXRpb24pIHsKICAgICAgICAgICAgdmFyIGVsZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpOwogICAgICAgICAgICBlbGUuY2xhc3NOYW1lID0gIm5vdGlmaWNhdGlvbiI7CiAgICAgICAgICAgIGVsZS5hZGRFdmVudExpc3RlbmVyKCJhbmltYXRpb25lbmQiLCBmdW5jdGlvbiAoKSB7cmV0dXJuIGVsZS5yZW1vdmUoKTt9KTsKICAgICAgICAgICAgZWxlLmlubmVyVGV4dCA9IG5vdGlmaWNhdGlvbjsKCiAgICAgICAgICAgIHZhciBjb250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgibm90aWZpY2F0aW9uc0NvbnRhaW5lciIpOwoKICAgICAgICAgICAgaWYgKCFjb250YWluZXIpIHsKICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGNvbnRhaW5lci5hcHBlbmRDaGlsZChlbGUpOwogICAgICAgICAgfQoKICAgICAgICAgIGZ1bmN0aW9uIHNldFByb3BlcnR5KF94MiwgX3gzKSB7cmV0dXJuIF9zZXRQcm9wZXJ0eS5hcHBseSh0aGlzLCBhcmd1bWVudHMpO31mdW5jdGlvbiBfc2V0UHJvcGVydHkoKSB7X3NldFByb3BlcnR5ID0gX2FzeW5jVG9HZW5lcmF0b3IoIC8qI19fUFVSRV9fKi9fcmVnZW5lcmF0b3JSdW50aW1lKCkubWFyayhmdW5jdGlvbiBfY2FsbGVlMigKICAgICAgICAgICAgcHJvcGVydHksCiAgICAgICAgICAgIHZhbHVlKSB7cmV0dXJuIF9yZWdlbmVyYXRvclJ1bnRpbWUoKS53cmFwKGZ1bmN0aW9uIF9jYWxsZWUyJChfY29udGV4dDIpIHt3aGlsZSAoMSkge3N3aXRjaCAoX2NvbnRleHQyLnByZXYgPSBfY29udGV4dDIubmV4dCkge2Nhc2UgMDpfY29udGV4dDIubmV4dCA9IDI7cmV0dXJuICgKCiAgICAgICAgICAgICAgICAgICAgICAgIHJ1bkphdmFzY3JpcHQoInJlcXVpcmUoXCJrb2xtYWZpYVwiKS5zZXRQcm9wZXJ0eShgIi5jb25jYXQoCiAgICAgICAgICAgICAgICAgICAgICAgIHByb3BlcnR5LCAiYCwgYCIpLmNvbmNhdCh2YWx1ZSwgImApOyIpKSk7Y2FzZSAyOmNhc2UgImVuZCI6cmV0dXJuIF9jb250ZXh0Mi5zdG9wKCk7fX19LCBfY2FsbGVlMik7fSkpO3JldHVybiBfc2V0UHJvcGVydHkuYXBwbHkodGhpcywgYXJndW1lbnRzKTt9CgoKCiAgICAgICAgICBmdW5jdGlvbiBzYXZlU2V0dGluZ3MocHJvcGVydGllcykgewogICAgICAgICAgICByZXR1cm4gc2V0UHJvcGVydGllcygKICAgICAgICAgICAgcHJvcGVydGllcy4KICAgICAgICAgICAgZmlsdGVyKGZ1bmN0aW9uIChwKSB7CiAgICAgICAgICAgICAgaWYgKHAucHJldmlvdXNWYWx1ZSA9PT0gcC52YWx1ZSkgewogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgcC5wcmV2aW91c1ZhbHVlID0gcC52YWx1ZTsKICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgfSkuCiAgICAgICAgICAgIG1hcChmdW5jdGlvbiAocHJvcCkge3JldHVybiBbcHJvcC5wcmVmZXJlbmNlLCBwcm9wLnZhbHVlLnRyaW0oKV07fSkpOwoKICAgICAgICAgIH0KCiAgICAgICAgICBmdW5jdGlvbiBzZXRQcm9wZXJ0aWVzKHByb3BlcnRpZXMpIHsKICAgICAgICAgICAgdmFyIGpzID0KICAgICAgICAgICAgJ2NvbnN0IGNoYW5nZWQgPSBbXTsgY29uc3QgY2hhbmdlID0gKGtleSwgdmFsdWUpID0+IHsgbGV0IHByZXYgPSByZXF1aXJlKCJrb2xtYWZpYSIpLmdldFByb3BlcnR5KGtleSk7IGlmIChwcmV2ID09PSB2YWx1ZSlyZXR1cm47IGNoYW5nZWQucHVzaChba2V5LCBwcmV2LCB2YWx1ZV0pOyByZXF1aXJlKCJrb2xtYWZpYSIpLnNldFByb3BlcnR5KGtleSwgdmFsdWUpO307JzsKCiAgICAgICAgICAgIGpzICs9IHByb3BlcnRpZXMuCiAgICAgICAgICAgIG1hcChmdW5jdGlvbiAoX3JlZikge3ZhciBfcmVmMiA9IF9zbGljZWRUb0FycmF5KF9yZWYsIDIpLGsgPSBfcmVmMlswXSx2ID0gX3JlZjJbMV07CiAgICAgICAgICAgICAgcmV0dXJuICJjaGFuZ2UoYCIuY29uY2F0KGssICJgLCBgIikuY29uY2F0KHYsICJgKTsiKTsKICAgICAgICAgICAgfSkuCiAgICAgICAgICAgIGpvaW4oIlxuIik7CgogICAgICAgICAgICBqcyArPSAiSlNPTi5zdHJpbmdpZnkoY2hhbmdlZCk7IjsKCiAgICAgICAgICAgIHJldHVybiBydW5KYXZhc2NyaXB0KGpzKTsKICAgICAgICAgIH1mdW5jdGlvbgoKICAgICAgICAgIHJ1bkphdmFzY3JpcHQoX3g0KSB7cmV0dXJuIF9ydW5KYXZhc2NyaXB0LmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7fWZ1bmN0aW9uIF9ydW5KYXZhc2NyaXB0KCkge19ydW5KYXZhc2NyaXB0ID0gX2FzeW5jVG9HZW5lcmF0b3IoIC8qI19fUFVSRV9fKi9fcmVnZW5lcmF0b3JSdW50aW1lKCkubWFyayhmdW5jdGlvbiBfY2FsbGVlMyhqYXZhc2NyaXB0KSB7cmV0dXJuIF9yZWdlbmVyYXRvclJ1bnRpbWUoKS53cmFwKGZ1bmN0aW9uIF9jYWxsZWUzJChfY29udGV4dDMpIHt3aGlsZSAoMSkge3N3aXRjaCAoX2NvbnRleHQzLnByZXYgPSBfY29udGV4dDMubmV4dCkge2Nhc2UgMDpyZXR1cm4gX2NvbnRleHQzLmFicnVwdCgicmV0dXJuIiwKICAgICAgICAgICAgICAgICAgICAgIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciB4aHIgPSBuZXcgWE1MSHR0cFJlcXVlc3QoKTsKICAgICAgICAgICAgICAgICAgICAgICAgeGhyLnJlc3BvbnNlVHlwZSA9ICJ0ZXh0IjsKICAgICAgICAgICAgICAgICAgICAgICAgeGhyLm9wZW4oIlBPU1QiLCBkb2N1bWVudC5sb2NhdGlvbi5ocmVmLCB0cnVlKTsKICAgICAgICAgICAgICAgICAgICAgICAgeGhyLnNldFJlcXVlc3RIZWFkZXIoIkNvbnRlbnQtVHlwZSIsICJhcHBsaWNhdGlvbi94LXd3dy1mb3JtLXVybGVuY29kZWQiKTsKICAgICAgICAgICAgICAgICAgICAgICAgeGhyLnNlbmQoImFwaT0iICsgZW5jb2RlVVJJQ29tcG9uZW50KGphdmFzY3JpcHQpKTsKICAgICAgICAgICAgICAgICAgICAgICAgeGhyLm9ucmVhZHlzdGF0ZWNoYW5nZSA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoeGhyLnJlYWR5U3RhdGUgIT0gNCB8fCB4aHIuc3RhdHVzICE9IDIwMCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZSh4aHIucmVzcG9uc2VUZXh0KTsKICAgICAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgICAgICAgIH0pKTtjYXNlIDE6Y2FzZSAiZW5kIjpyZXR1cm4gX2NvbnRleHQzLnN0b3AoKTt9fX0sIF9jYWxsZWUzKTt9KSk7cmV0dXJuIF9ydW5KYXZhc2NyaXB0LmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7fQogICAgICAgICAgOyAvLyBDT05DQVRFTkFURUQgTU9EVUxFOiAuL3NyYy9yZWxheS9hcGkvU2V0dGluZ1ZhbGlkYXRvci50c3gKICAgICAgICAgIGZ1bmN0aW9uIFNldHRpbmdWYWxpZGF0b3JfdHlwZW9mKG9iaikgeyJAYmFiZWwvaGVscGVycyAtIHR5cGVvZiI7cmV0dXJuIFNldHRpbmdWYWxpZGF0b3JfdHlwZW9mID0gImZ1bmN0aW9uIiA9PSB0eXBlb2YgU3ltYm9sICYmICJzeW1ib2wiID09IHR5cGVvZiBTeW1ib2wuaXRlcmF0b3IgPyBmdW5jdGlvbiAob2JqKSB7cmV0dXJuIHR5cGVvZiBvYmo7fSA6IGZ1bmN0aW9uIChvYmopIHtyZXR1cm4gb2JqICYmICJmdW5jdGlvbiIgPT0gdHlwZW9mIFN5bWJvbCAmJiBvYmouY29uc3RydWN0b3IgPT09IFN5bWJvbCAmJiBvYmogIT09IFN5bWJvbC5wcm90b3R5cGUgPyAic3ltYm9sIiA6IHR5cGVvZiBvYmo7fSwgU2V0dGluZ1ZhbGlkYXRvcl90eXBlb2Yob2JqKTt9ZnVuY3Rpb24gU2V0dGluZ1ZhbGlkYXRvcl9zbGljZWRUb0FycmF5KGFyciwgaSkge3JldHVybiBTZXR0aW5nVmFsaWRhdG9yX2FycmF5V2l0aEhvbGVzKGFycikgfHwgU2V0dGluZ1ZhbGlkYXRvcl9pdGVyYWJsZVRvQXJyYXlMaW1pdChhcnIsIGkpIHx8IFNldHRpbmdWYWxpZGF0b3JfdW5zdXBwb3J0ZWRJdGVyYWJsZVRvQXJyYXkoYXJyLCBpKSB8fCBTZXR0aW5nVmFsaWRhdG9yX25vbkl0ZXJhYmxlUmVzdCgpO31mdW5jdGlvbiBTZXR0aW5nVmFsaWRhdG9yX25vbkl0ZXJhYmxlUmVzdCgpIHt0aHJvdyBuZXcgVHlwZUVycm9yKCJJbnZhbGlkIGF0dGVtcHQgdG8gZGVzdHJ1Y3R1cmUgbm9uLWl0ZXJhYmxlIGluc3RhbmNlLlxuSW4gb3JkZXIgdG8gYmUgaXRlcmFibGUsIG5vbi1hcnJheSBvYmplY3RzIG11c3QgaGF2ZSBhIFtTeW1ib2wuaXRlcmF0b3JdKCkgbWV0aG9kLiIpO31mdW5jdGlvbiBTZXR0aW5nVmFsaWRhdG9yX2l0ZXJhYmxlVG9BcnJheUxpbWl0KGFyciwgaSkge3ZhciBfaSA9IG51bGwgPT0gYXJyID8gbnVsbCA6ICJ1bmRlZmluZWQiICE9IHR5cGVvZiBTeW1ib2wgJiYgYXJyW1N5bWJvbC5pdGVyYXRvcl0gfHwgYXJyWyJAQGl0ZXJhdG9yIl07aWYgKG51bGwgIT0gX2kpIHt2YXIgX3MsX2UsX3gsX3IsX2FyciA9IFtdLF9uID0gITAsX2QgPSAhMTt0cnkge2lmIChfeCA9IChfaSA9IF9pLmNhbGwoYXJyKSkubmV4dCwgMCA9PT0gaSkge2lmIChPYmplY3QoX2kpICE9PSBfaSkgcmV0dXJuO19uID0gITE7fSBlbHNlIGZvciAoOyAhKF9uID0gKF9zID0gX3guY2FsbChfaSkpLmRvbmUpICYmIChfYXJyLnB1c2goX3MudmFsdWUpLCBfYXJyLmxlbmd0aCAhPT0gaSk7IF9uID0gITApIHs7fX0gY2F0Y2ggKGVycikge19kID0gITAsIF9lID0gZXJyO30gZmluYWxseSB7dHJ5IHtpZiAoIV9uICYmIG51bGwgIT0gX2lbInJldHVybiJdICYmIChfciA9IF9pWyJyZXR1cm4iXSgpLCBPYmplY3QoX3IpICE9PSBfcikpIHJldHVybjt9IGZpbmFsbHkge2lmIChfZCkgdGhyb3cgX2U7fX1yZXR1cm4gX2Fycjt9fWZ1bmN0aW9uIFNldHRpbmdWYWxpZGF0b3JfYXJyYXlXaXRoSG9sZXMoYXJyKSB7aWYgKEFycmF5LmlzQXJyYXkoYXJyKSkgcmV0dXJuIGFycjt9ZnVuY3Rpb24gX2NyZWF0ZUZvck9mSXRlcmF0b3JIZWxwZXIobywgYWxsb3dBcnJheUxpa2UpIHt2YXIgaXQgPSB0eXBlb2YgU3ltYm9sICE9PSAidW5kZWZpbmVkIiAmJiBvW1N5bWJvbC5pdGVyYXRvcl0gfHwgb1siQEBpdGVyYXRvciJdO2lmICghaXQpIHtpZiAoQXJyYXkuaXNBcnJheShvKSB8fCAoaXQgPSBTZXR0aW5nVmFsaWRhdG9yX3Vuc3VwcG9ydGVkSXRlcmFibGVUb0FycmF5KG8pKSB8fCBhbGxvd0FycmF5TGlrZSAmJiBvICYmIHR5cGVvZiBvLmxlbmd0aCA9PT0gIm51bWJlciIpIHtpZiAoaXQpIG8gPSBpdDt2YXIgaSA9IDA7dmFyIEYgPSBmdW5jdGlvbiBGKCkge307cmV0dXJuIHsgczogRiwgbjogZnVuY3Rpb24gbigpIHtpZiAoaSA+PSBvLmxlbmd0aCkgcmV0dXJuIHsgZG9uZTogdHJ1ZSB9O3JldHVybiB7IGRvbmU6IGZhbHNlLCB2YWx1ZTogb1tpKytdIH07fSwgZTogZnVuY3Rpb24gZShfZTIpIHt0aHJvdyBfZTI7fSwgZjogRiB9O310aHJvdyBuZXcgVHlwZUVycm9yKCJJbnZhbGlkIGF0dGVtcHQgdG8gaXRlcmF0ZSBub24taXRlcmFibGUgaW5zdGFuY2UuXG5JbiBvcmRlciB0byBiZSBpdGVyYWJsZSwgbm9uLWFycmF5IG9iamVjdHMgbXVzdCBoYXZlIGEgW1N5bWJvbC5pdGVyYXRvcl0oKSBtZXRob2QuIik7fXZhciBub3JtYWxDb21wbGV0aW9uID0gdHJ1ZSxkaWRFcnIgPSBmYWxzZSxlcnI7cmV0dXJuIHsgczogZnVuY3Rpb24gcygpIHtpdCA9IGl0LmNhbGwobyk7fSwgbjogZnVuY3Rpb24gbigpIHt2YXIgc3RlcCA9IGl0Lm5leHQoKTtub3JtYWxDb21wbGV0aW9uID0gc3RlcC5kb25lO3JldHVybiBzdGVwO30sIGU6IGZ1bmN0aW9uIGUoX2UzKSB7ZGlkRXJyID0gdHJ1ZTtlcnIgPSBfZTM7fSwgZjogZnVuY3Rpb24gZigpIHt0cnkge2lmICghbm9ybWFsQ29tcGxldGlvbiAmJiBpdFsicmV0dXJuIl0gIT0gbnVsbCkgaXRbInJldHVybiJdKCk7fSBmaW5hbGx5IHtpZiAoZGlkRXJyKSB0aHJvdyBlcnI7fX0gfTt9ZnVuY3Rpb24gU2V0dGluZ1ZhbGlkYXRvcl91bnN1cHBvcnRlZEl0ZXJhYmxlVG9BcnJheShvLCBtaW5MZW4pIHtpZiAoIW8pIHJldHVybjtpZiAodHlwZW9mIG8gPT09ICJzdHJpbmciKSByZXR1cm4gU2V0dGluZ1ZhbGlkYXRvcl9hcnJheUxpa2VUb0FycmF5KG8sIG1pbkxlbik7dmFyIG4gPSBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwobykuc2xpY2UoOCwgLTEpO2lmIChuID09PSAiT2JqZWN0IiAmJiBvLmNvbnN0cnVjdG9yKSBuID0gby5jb25zdHJ1Y3Rvci5uYW1lO2lmIChuID09PSAiTWFwIiB8fCBuID09PSAiU2V0IikgcmV0dXJuIEFycmF5LmZyb20obyk7aWYgKG4gPT09ICJBcmd1bWVudHMiIHx8IC9eKD86VWl8SSludCg/Ojh8MTZ8MzIpKD86Q2xhbXBlZCk/QXJyYXkkLy50ZXN0KG4pKSByZXR1cm4gU2V0dGluZ1ZhbGlkYXRvcl9hcnJheUxpa2VUb0FycmF5KG8sIG1pbkxlbik7fWZ1bmN0aW9uIFNldHRpbmdWYWxpZGF0b3JfYXJyYXlMaWtlVG9BcnJheShhcnIsIGxlbikge2lmIChsZW4gPT0gbnVsbCB8fCBsZW4gPiBhcnIubGVuZ3RoKSBsZW4gPSBhcnIubGVuZ3RoO2ZvciAodmFyIGkgPSAwLCBhcnIyID0gbmV3IEFycmF5KGxlbik7IGkgPCBsZW47IGkrKykge2FycjJbaV0gPSBhcnJbaV07fXJldHVybiBhcnIyO31mdW5jdGlvbiBfY2xhc3NDYWxsQ2hlY2soaW5zdGFuY2UsIENvbnN0cnVjdG9yKSB7aWYgKCEoaW5zdGFuY2UgaW5zdGFuY2VvZiBDb25zdHJ1Y3RvcikpIHt0aHJvdyBuZXcgVHlwZUVycm9yKCJDYW5ub3QgY2FsbCBhIGNsYXNzIGFzIGEgZnVuY3Rpb24iKTt9fWZ1bmN0aW9uIF9kZWZpbmVQcm9wZXJ0aWVzKHRhcmdldCwgcHJvcHMpIHtmb3IgKHZhciBpID0gMDsgaSA8IHByb3BzLmxlbmd0aDsgaSsrKSB7dmFyIGRlc2NyaXB0b3IgPSBwcm9wc1tpXTtkZXNjcmlwdG9yLmVudW1lcmFibGUgPSBkZXNjcmlwdG9yLmVudW1lcmFibGUgfHwgZmFsc2U7ZGVzY3JpcHRvci5jb25maWd1cmFibGUgPSB0cnVlO2lmICgidmFsdWUiIGluIGRlc2NyaXB0b3IpIGRlc2NyaXB0b3Iud3JpdGFibGUgPSB0cnVlO09iamVjdC5kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIF90b1Byb3BlcnR5S2V5KGRlc2NyaXB0b3Iua2V5KSwgZGVzY3JpcHRvcik7fX1mdW5jdGlvbiBfY3JlYXRlQ2xhc3MoQ29uc3RydWN0b3IsIHByb3RvUHJvcHMsIHN0YXRpY1Byb3BzKSB7aWYgKHByb3RvUHJvcHMpIF9kZWZpbmVQcm9wZXJ0aWVzKENvbnN0cnVjdG9yLnByb3RvdHlwZSwgcHJvdG9Qcm9wcyk7aWYgKHN0YXRpY1Byb3BzKSBfZGVmaW5lUHJvcGVydGllcyhDb25zdHJ1Y3Rvciwgc3RhdGljUHJvcHMpO09iamVjdC5kZWZpbmVQcm9wZXJ0eShDb25zdHJ1Y3RvciwgInByb3RvdHlwZSIsIHsgd3JpdGFibGU6IGZhbHNlIH0pO3JldHVybiBDb25zdHJ1Y3Rvcjt9ZnVuY3Rpb24gX2RlZmluZVByb3BlcnR5KG9iaiwga2V5LCB2YWx1ZSkge2tleSA9IF90b1Byb3BlcnR5S2V5KGtleSk7aWYgKGtleSBpbiBvYmopIHtPYmplY3QuZGVmaW5lUHJvcGVydHkob2JqLCBrZXksIHsgdmFsdWU6IHZhbHVlLCBlbnVtZXJhYmxlOiB0cnVlLCBjb25maWd1cmFibGU6IHRydWUsIHdyaXRhYmxlOiB0cnVlIH0pO30gZWxzZSB7b2JqW2tleV0gPSB2YWx1ZTt9cmV0dXJuIG9iajt9ZnVuY3Rpb24gX3RvUHJvcGVydHlLZXkoYXJnKSB7dmFyIGtleSA9IF90b1ByaW1pdGl2ZShhcmcsICJzdHJpbmciKTtyZXR1cm4gU2V0dGluZ1ZhbGlkYXRvcl90eXBlb2Yoa2V5KSA9PT0gInN5bWJvbCIgPyBrZXkgOiBTdHJpbmcoa2V5KTt9ZnVuY3Rpb24gX3RvUHJpbWl0aXZlKGlucHV0LCBoaW50KSB7aWYgKFNldHRpbmdWYWxpZGF0b3JfdHlwZW9mKGlucHV0KSAhPT0gIm9iamVjdCIgfHwgaW5wdXQgPT09IG51bGwpIHJldHVybiBpbnB1dDt2YXIgcHJpbSA9IGlucHV0W1N5bWJvbC50b1ByaW1pdGl2ZV07aWYgKHByaW0gIT09IHVuZGVmaW5lZCkge3ZhciByZXMgPSBwcmltLmNhbGwoaW5wdXQsIGhpbnQgfHwgImRlZmF1bHQiKTtpZiAoU2V0dGluZ1ZhbGlkYXRvcl90eXBlb2YocmVzKSAhPT0gIm9iamVjdCIpIHJldHVybiByZXM7dGhyb3cgbmV3IFR5cGVFcnJvcigiQEB0b1ByaW1pdGl2ZSBtdXN0IHJldHVybiBhIHByaW1pdGl2ZSB2YWx1ZS4iKTt9cmV0dXJuIChoaW50ID09PSAic3RyaW5nIiA/IFN0cmluZyA6IE51bWJlcikoaW5wdXQpO312YXIKCgogICAgICAgICAgU2V0dGluZ1ZhbGlkYXRvciA9IC8qI19fUFVSRV9fKi9mdW5jdGlvbiAoKSB7ZnVuY3Rpb24gU2V0dGluZ1ZhbGlkYXRvcigpIHtfY2xhc3NDYWxsQ2hlY2sodGhpcywgU2V0dGluZ1ZhbGlkYXRvcik7X2RlZmluZVByb3BlcnR5KHRoaXMsICJzZXR0aW5ncyIsCiAgICAgICAgICAgICAgW10pO19kZWZpbmVQcm9wZXJ0eSh0aGlzLCAib2JqZWN0IiwKICAgICAgICAgICAgICB7fSk7fV9jcmVhdGVDbGFzcyhTZXR0aW5nVmFsaWRhdG9yLCBbeyBrZXk6ICJhZGRTZXR0aW5nIiwgdmFsdWU6CgogICAgICAgICAgICAgIGZ1bmN0aW9uIGFkZFNldHRpbmcoc2V0dGluZywgc2V0U3RhdGUpIHsKICAgICAgICAgICAgICAgIHRoaXMuc2V0dGluZ3MucHVzaChbc2V0dGluZywgc2V0U3RhdGVdKTsKICAgICAgICAgICAgICB9IH0sIHsga2V5OiAidXBkYXRlU2V0dGluZyIsIHZhbHVlOgoKICAgICAgICAgICAgICBmdW5jdGlvbiB1cGRhdGVTZXR0aW5nKHNldHRpbmcpIHsKICAgICAgICAgICAgICAgIHRoaXMub2JqZWN0W3NldHRpbmcucHJlZmVyZW5jZV0gPSBzZXR0aW5nLnZhbHVlOwogICAgICAgICAgICAgICAgdGhpcy5kb1ZhbGlkYXRlcygpOwogICAgICAgICAgICAgIH0gfSwgeyBrZXk6ICJ1cGRhdGVPYmplY3QiLCB2YWx1ZToKCiAgICAgICAgICAgICAgZnVuY3Rpb24gdXBkYXRlT2JqZWN0KCkge3ZhciBfaXRlcmF0b3IgPSBfY3JlYXRlRm9yT2ZJdGVyYXRvckhlbHBlcigKICAgICAgICAgICAgICAgICAgdGhpcy5zZXR0aW5ncyksX3N0ZXA7dHJ5IHtmb3IgKF9pdGVyYXRvci5zKCk7ICEoX3N0ZXAgPSBfaXRlcmF0b3IubigpKS5kb25lOykge3ZhciBfc3RlcCR2YWx1ZSA9IFNldHRpbmdWYWxpZGF0b3Jfc2xpY2VkVG9BcnJheShfc3RlcC52YWx1ZSwgMSksc2V0dGluZyA9IF9zdGVwJHZhbHVlWzBdOwogICAgICAgICAgICAgICAgICAgIHRoaXMub2JqZWN0W3NldHRpbmcucHJlZmVyZW5jZV0gPSBzZXR0aW5nLnZhbHVlOwogICAgICAgICAgICAgICAgICB9fSBjYXRjaCAoZXJyKSB7X2l0ZXJhdG9yLmUoZXJyKTt9IGZpbmFsbHkge19pdGVyYXRvci5mKCk7fQogICAgICAgICAgICAgIH0gfSwgeyBrZXk6ICJkb1ZhbGlkYXRlcyIsIHZhbHVlOgoKICAgICAgICAgICAgICBmdW5jdGlvbiBkb1ZhbGlkYXRlcygpIHt2YXIgX2l0ZXJhdG9yMiA9IF9jcmVhdGVGb3JPZkl0ZXJhdG9ySGVscGVyKAogICAgICAgICAgICAgICAgICB0aGlzLnNldHRpbmdzKSxfc3RlcDI7dHJ5IHtmb3IgKF9pdGVyYXRvcjIucygpOyAhKF9zdGVwMiA9IF9pdGVyYXRvcjIubigpKS5kb25lOykge3ZhciBfc3RlcDIkdmFsdWUgPSBTZXR0aW5nVmFsaWRhdG9yX3NsaWNlZFRvQXJyYXkoX3N0ZXAyLnZhbHVlLCAyKSxzZXR0aW5nID0gX3N0ZXAyJHZhbHVlWzBdLHNldFZhbGlkID0gX3N0ZXAyJHZhbHVlWzFdOwogICAgICAgICAgICAgICAgICAgIHNldFZhbGlkKHRoaXMuaXNWYWxpZChzZXR0aW5nKSk7CiAgICAgICAgICAgICAgICAgIH19IGNhdGNoIChlcnIpIHtfaXRlcmF0b3IyLmUoZXJyKTt9IGZpbmFsbHkge19pdGVyYXRvcjIuZigpO30KICAgICAgICAgICAgICB9IH0sIHsga2V5OiAiaXNWYWxpZCIsIHZhbHVlOgoKICAgICAgICAgICAgICBmdW5jdGlvbiBpc1ZhbGlkKHNldHRpbmcpIHsKICAgICAgICAgICAgICAgIHJldHVybiAoCiAgICAgICAgICAgICAgICAgIHNldHRpbmcudmFsaWRhdGUgPT0gbnVsbCB8fCBzZXR0aW5nLnZhbGlkYXRlKHNldHRpbmcudmFsdWUsIHRoaXMub2JqZWN0KSk7CgogICAgICAgICAgICAgIH0gfV0pO3JldHVybiBTZXR0aW5nVmFsaWRhdG9yO30oKTsKCgogICAgICAgICAgLyogaGFybW9ueSBkZWZhdWx0IGV4cG9ydCAqL3ZhciBhcGlfU2V0dGluZ1ZhbGlkYXRvciA9IFNldHRpbmdWYWxpZGF0b3I7CiAgICAgICAgICA7IC8vIENPTkNBVEVOQVRFRCBNT0RVTEU6IC4vc3JjL3JlbGF5L2NvbXBvbmVudHMvSW50ZXJydXB0LnRzeAogICAgICAgICAgZnVuY3Rpb24gSW50ZXJydXB0X3R5cGVvZihvYmopIHsiQGJhYmVsL2hlbHBlcnMgLSB0eXBlb2YiO3JldHVybiBJbnRlcnJ1cHRfdHlwZW9mID0gImZ1bmN0aW9uIiA9PSB0eXBlb2YgU3ltYm9sICYmICJzeW1ib2wiID09IHR5cGVvZiBTeW1ib2wuaXRlcmF0b3IgPyBmdW5jdGlvbiAob2JqKSB7cmV0dXJuIHR5cGVvZiBvYmo7fSA6IGZ1bmN0aW9uIChvYmopIHtyZXR1cm4gb2JqICYmICJmdW5jdGlvbiIgPT0gdHlwZW9mIFN5bWJvbCAmJiBvYmouY29uc3RydWN0b3IgPT09IFN5bWJvbCAmJiBvYmogIT09IFN5bWJvbC5wcm90b3R5cGUgPyAic3ltYm9sIiA6IHR5cGVvZiBvYmo7fSwgSW50ZXJydXB0X3R5cGVvZihvYmopO31mdW5jdGlvbiBfdG9Db25zdW1hYmxlQXJyYXkoYXJyKSB7cmV0dXJuIF9hcnJheVdpdGhvdXRIb2xlcyhhcnIpIHx8IF9pdGVyYWJsZVRvQXJyYXkoYXJyKSB8fCBJbnRlcnJ1cHRfdW5zdXBwb3J0ZWRJdGVyYWJsZVRvQXJyYXkoYXJyKSB8fCBfbm9uSXRlcmFibGVTcHJlYWQoKTt9ZnVuY3Rpb24gX25vbkl0ZXJhYmxlU3ByZWFkKCkge3Rocm93IG5ldyBUeXBlRXJyb3IoIkludmFsaWQgYXR0ZW1wdCB0byBzcHJlYWQgbm9uLWl0ZXJhYmxlIGluc3RhbmNlLlxuSW4gb3JkZXIgdG8gYmUgaXRlcmFibGUsIG5vbi1hcnJheSBvYmplY3RzIG11c3QgaGF2ZSBhIFtTeW1ib2wuaXRlcmF0b3JdKCkgbWV0aG9kLiIpO31mdW5jdGlvbiBJbnRlcnJ1cHRfdW5zdXBwb3J0ZWRJdGVyYWJsZVRvQXJyYXkobywgbWluTGVuKSB7aWYgKCFvKSByZXR1cm47aWYgKHR5cGVvZiBvID09PSAic3RyaW5nIikgcmV0dXJuIEludGVycnVwdF9hcnJheUxpa2VUb0FycmF5KG8sIG1pbkxlbik7dmFyIG4gPSBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwobykuc2xpY2UoOCwgLTEpO2lmIChuID09PSAiT2JqZWN0IiAmJiBvLmNvbnN0cnVjdG9yKSBuID0gby5jb25zdHJ1Y3Rvci5uYW1lO2lmIChuID09PSAiTWFwIiB8fCBuID09PSAiU2V0IikgcmV0dXJuIEFycmF5LmZyb20obyk7aWYgKG4gPT09ICJBcmd1bWVudHMiIHx8IC9eKD86VWl8SSludCg/Ojh8MTZ8MzIpKD86Q2xhbXBlZCk/QXJyYXkkLy50ZXN0KG4pKSByZXR1cm4gSW50ZXJydXB0X2FycmF5TGlrZVRvQXJyYXkobywgbWluTGVuKTt9ZnVuY3Rpb24gX2l0ZXJhYmxlVG9BcnJheShpdGVyKSB7aWYgKHR5cGVvZiBTeW1ib2wgIT09ICJ1bmRlZmluZWQiICYmIGl0ZXJbU3ltYm9sLml0ZXJhdG9yXSAhPSBudWxsIHx8IGl0ZXJbIkBAaXRlcmF0b3IiXSAhPSBudWxsKSByZXR1cm4gQXJyYXkuZnJvbShpdGVyKTt9ZnVuY3Rpb24gX2FycmF5V2l0aG91dEhvbGVzKGFycikge2lmIChBcnJheS5pc0FycmF5KGFycikpIHJldHVybiBJbnRlcnJ1cHRfYXJyYXlMaWtlVG9BcnJheShhcnIpO31mdW5jdGlvbiBJbnRlcnJ1cHRfYXJyYXlMaWtlVG9BcnJheShhcnIsIGxlbikge2lmIChsZW4gPT0gbnVsbCB8fCBsZW4gPiBhcnIubGVuZ3RoKSBsZW4gPSBhcnIubGVuZ3RoO2ZvciAodmFyIGkgPSAwLCBhcnIyID0gbmV3IEFycmF5KGxlbik7IGkgPCBsZW47IGkrKykge2FycjJbaV0gPSBhcnJbaV07fXJldHVybiBhcnIyO31mdW5jdGlvbiBJbnRlcnJ1cHRfZGVmaW5lUHJvcGVydHkob2JqLCBrZXksIHZhbHVlKSB7a2V5ID0gSW50ZXJydXB0X3RvUHJvcGVydHlLZXkoa2V5KTtpZiAoa2V5IGluIG9iaikge09iamVjdC5kZWZpbmVQcm9wZXJ0eShvYmosIGtleSwgeyB2YWx1ZTogdmFsdWUsIGVudW1lcmFibGU6IHRydWUsIGNvbmZpZ3VyYWJsZTogdHJ1ZSwgd3JpdGFibGU6IHRydWUgfSk7fSBlbHNlIHtvYmpba2V5XSA9IHZhbHVlO31yZXR1cm4gb2JqO31mdW5jdGlvbiBJbnRlcnJ1cHRfdG9Qcm9wZXJ0eUtleShhcmcpIHt2YXIga2V5ID0gSW50ZXJydXB0X3RvUHJpbWl0aXZlKGFyZywgInN0cmluZyIpO3JldHVybiBJbnRlcnJ1cHRfdHlwZW9mKGtleSkgPT09ICJzeW1ib2wiID8ga2V5IDogU3RyaW5nKGtleSk7fWZ1bmN0aW9uIEludGVycnVwdF90b1ByaW1pdGl2ZShpbnB1dCwgaGludCkge2lmIChJbnRlcnJ1cHRfdHlwZW9mKGlucHV0KSAhPT0gIm9iamVjdCIgfHwgaW5wdXQgPT09IG51bGwpIHJldHVybiBpbnB1dDt2YXIgcHJpbSA9IGlucHV0W1N5bWJvbC50b1ByaW1pdGl2ZV07aWYgKHByaW0gIT09IHVuZGVmaW5lZCkge3ZhciByZXMgPSBwcmltLmNhbGwoaW5wdXQsIGhpbnQgfHwgImRlZmF1bHQiKTtpZiAoSW50ZXJydXB0X3R5cGVvZihyZXMpICE9PSAib2JqZWN0IikgcmV0dXJuIHJlczt0aHJvdyBuZXcgVHlwZUVycm9yKCJAQHRvUHJpbWl0aXZlIG11c3QgcmV0dXJuIGEgcHJpbWl0aXZlIHZhbHVlLiIpO31yZXR1cm4gKGhpbnQgPT09ICJzdHJpbmciID8gU3RyaW5nIDogTnVtYmVyKShpbnB1dCk7fQoKCgogICAgICAgICAgZnVuY3Rpb24gSW50ZXJydXB0KF9yZWYpIHt2YXIgYnV0dG9uID0gX3JlZi5idXR0b247CiAgICAgICAgICAgIHZhciBDU1NzdHJpbmcgPSBmdW5jdGlvbiBDU1NzdHJpbmcoc3RyaW5nKSB7CiAgICAgICAgICAgICAgdmFyIGNzc19qc29uID0gIntcIiIuY29uY2F0KHN0cmluZy4KICAgICAgICAgICAgICByZXBsYWNlKC87IC9nLCAnIiwgIicpLgogICAgICAgICAgICAgIHJlcGxhY2UoLzogL2csICciOiAiJykuCiAgICAgICAgICAgICAgcmVwbGFjZSgiOyIsICIiKSwgIlwifSIpOwoKICAgICAgICAgICAgICB2YXIgb2JqID0gSlNPTi5wYXJzZShjc3NfanNvbik7CgogICAgICAgICAgICAgIHZhciBrZXlWYWx1ZXMgPSBPYmplY3Qua2V5cyhvYmopLm1hcChmdW5jdGlvbiAoa2V5KSB7CiAgICAgICAgICAgICAgICB2YXIgY2FtZWxDYXNlZCA9IGtleS5yZXBsYWNlKC8tW2Etel0vZywgZnVuY3Rpb24gKGcpIHtyZXR1cm4gZ1sxXS50b1VwcGVyQ2FzZSgpO30pOwogICAgICAgICAgICAgICAgcmV0dXJuIEludGVycnVwdF9kZWZpbmVQcm9wZXJ0eSh7fSwgY2FtZWxDYXNlZCwgb2JqW2tleV0pOwogICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICByZXR1cm4gT2JqZWN0LmFzc2lnbi5hcHBseShPYmplY3QsIFt7fV0uY29uY2F0KF90b0NvbnN1bWFibGVBcnJheShrZXlWYWx1ZXMpKSk7CiAgICAgICAgICAgIH07CgogICAgICAgICAgICByZXR1cm4gLyojX19QVVJFX18qLygKICAgICAgICAgICAgICByZWFjdC5jcmVhdGVFbGVtZW50KCJpbnB1dCIsIHsKICAgICAgICAgICAgICAgIGNsYXNzTmFtZTogImludGVycnVwdCIsCiAgICAgICAgICAgICAgICBzdHlsZTogYnV0dG9uLmNzcyA/IENTU3N0cmluZyhidXR0b24uY3NzKSA6IG51bGwsCiAgICAgICAgICAgICAgICB0eXBlOiAic3VibWl0IiwKICAgICAgICAgICAgICAgIHZhbHVlOiBidXR0b24ubmFtZSwKICAgICAgICAgICAgICAgIG9uQ2xpY2s6IGZ1bmN0aW9uIG9uQ2xpY2soKSB7CiAgICAgICAgICAgICAgICAgIHNldFByb3BlcnRpZXMoCiAgICAgICAgICAgICAgICAgIGJ1dHRvbi5hY3Rpb25zLm1hcChmdW5jdGlvbiAoX3JlZjMpIHt2YXIgcHJlZmVyZW5jZSA9IF9yZWYzLnByZWZlcmVuY2UsdmFsdWUgPSBfcmVmMy52YWx1ZTtyZXR1cm4gW3ByZWZlcmVuY2UsIHZhbHVlXTt9KSkuCiAgICAgICAgICAgICAgICAgIHRoZW4oZnVuY3Rpb24gKCkge3JldHVybiBhZGROb3RpZmljYXRpb24oYnV0dG9uLm5vdGlmaWNhdGlvbiB8fCAiSW50ZXJydXB0ZWQhIik7fSk7CiAgICAgICAgICAgICAgICB9IH0pKTsKCgogICAgICAgICAgfQoKICAgICAgICAgIC8qIGhhcm1vbnkgZGVmYXVsdCBleHBvcnQgKi92YXIgY29tcG9uZW50c19JbnRlcnJ1cHQgPSBJbnRlcnJ1cHQ7CiAgICAgICAgICA7IC8vIENPTkNBVEVOQVRFRCBNT0RVTEU6IC4vc3JjL3JlbGF5L3R5cGVzL1R5cGVzLnRzeAoKCiAgICAgICAgICB2YXIgUmVsYXlDb21wb25lbnRUeXBlOyhmdW5jdGlvbiAoUmVsYXlDb21wb25lbnRUeXBlKSB7UmVsYXlDb21wb25lbnRUeXBlWyJCT09MRUFOIl0gPSAiYm9vbGVhbiI7UmVsYXlDb21wb25lbnRUeXBlWyJEUk9QRE9XTiJdID0gImRyb3Bkb3duIjtSZWxheUNvbXBvbmVudFR5cGVbIlNUUklORyJdID0gInN0cmluZyI7UmVsYXlDb21wb25lbnRUeXBlWyJIVE1MIl0gPSAiaHRtbCI7UmVsYXlDb21wb25lbnRUeXBlWyJJTlRFUlJVUFQiXSA9ICJpbnRlcnJ1cHQiO30pKFJlbGF5Q29tcG9uZW50VHlwZSB8fCAoUmVsYXlDb21wb25lbnRUeXBlID0ge30pKTsKICAgICAgICAgIDsgLy8gQ09OQ0FURU5BVEVEIE1PRFVMRTogLi9zcmMvcmVsYXkvY29tcG9uZW50cy9zZXR0aW5ncy9Cb29sZWFuSW5wdXQudHN4CiAgICAgICAgICBmdW5jdGlvbiBCb29sZWFuSW5wdXRfc2xpY2VkVG9BcnJheShhcnIsIGkpIHtyZXR1cm4gQm9vbGVhbklucHV0X2FycmF5V2l0aEhvbGVzKGFycikgfHwgQm9vbGVhbklucHV0X2l0ZXJhYmxlVG9BcnJheUxpbWl0KGFyciwgaSkgfHwgQm9vbGVhbklucHV0X3Vuc3VwcG9ydGVkSXRlcmFibGVUb0FycmF5KGFyciwgaSkgfHwgQm9vbGVhbklucHV0X25vbkl0ZXJhYmxlUmVzdCgpO31mdW5jdGlvbiBCb29sZWFuSW5wdXRfbm9uSXRlcmFibGVSZXN0KCkge3Rocm93IG5ldyBUeXBlRXJyb3IoIkludmFsaWQgYXR0ZW1wdCB0byBkZXN0cnVjdHVyZSBub24taXRlcmFibGUgaW5zdGFuY2UuXG5JbiBvcmRlciB0byBiZSBpdGVyYWJsZSwgbm9uLWFycmF5IG9iamVjdHMgbXVzdCBoYXZlIGEgW1N5bWJvbC5pdGVyYXRvcl0oKSBtZXRob2QuIik7fWZ1bmN0aW9uIEJvb2xlYW5JbnB1dF91bnN1cHBvcnRlZEl0ZXJhYmxlVG9BcnJheShvLCBtaW5MZW4pIHtpZiAoIW8pIHJldHVybjtpZiAodHlwZW9mIG8gPT09ICJzdHJpbmciKSByZXR1cm4gQm9vbGVhbklucHV0X2FycmF5TGlrZVRvQXJyYXkobywgbWluTGVuKTt2YXIgbiA9IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChvKS5zbGljZSg4LCAtMSk7aWYgKG4gPT09ICJPYmplY3QiICYmIG8uY29uc3RydWN0b3IpIG4gPSBvLmNvbnN0cnVjdG9yLm5hbWU7aWYgKG4gPT09ICJNYXAiIHx8IG4gPT09ICJTZXQiKSByZXR1cm4gQXJyYXkuZnJvbShvKTtpZiAobiA9PT0gIkFyZ3VtZW50cyIgfHwgL14oPzpVaXxJKW50KD86OHwxNnwzMikoPzpDbGFtcGVkKT9BcnJheSQvLnRlc3QobikpIHJldHVybiBCb29sZWFuSW5wdXRfYXJyYXlMaWtlVG9BcnJheShvLCBtaW5MZW4pO31mdW5jdGlvbiBCb29sZWFuSW5wdXRfYXJyYXlMaWtlVG9BcnJheShhcnIsIGxlbikge2lmIChsZW4gPT0gbnVsbCB8fCBsZW4gPiBhcnIubGVuZ3RoKSBsZW4gPSBhcnIubGVuZ3RoO2ZvciAodmFyIGkgPSAwLCBhcnIyID0gbmV3IEFycmF5KGxlbik7IGkgPCBsZW47IGkrKykge2FycjJbaV0gPSBhcnJbaV07fXJldHVybiBhcnIyO31mdW5jdGlvbiBCb29sZWFuSW5wdXRfaXRlcmFibGVUb0FycmF5TGltaXQoYXJyLCBpKSB7dmFyIF9pID0gbnVsbCA9PSBhcnIgPyBudWxsIDogInVuZGVmaW5lZCIgIT0gdHlwZW9mIFN5bWJvbCAmJiBhcnJbU3ltYm9sLml0ZXJhdG9yXSB8fCBhcnJbIkBAaXRlcmF0b3IiXTtpZiAobnVsbCAhPSBfaSkge3ZhciBfcyxfZSxfeCxfcixfYXJyID0gW10sX24gPSAhMCxfZCA9ICExO3RyeSB7aWYgKF94ID0gKF9pID0gX2kuY2FsbChhcnIpKS5uZXh0LCAwID09PSBpKSB7aWYgKE9iamVjdChfaSkgIT09IF9pKSByZXR1cm47X24gPSAhMTt9IGVsc2UgZm9yICg7ICEoX24gPSAoX3MgPSBfeC5jYWxsKF9pKSkuZG9uZSkgJiYgKF9hcnIucHVzaChfcy52YWx1ZSksIF9hcnIubGVuZ3RoICE9PSBpKTsgX24gPSAhMCkgezt9fSBjYXRjaCAoZXJyKSB7X2QgPSAhMCwgX2UgPSBlcnI7fSBmaW5hbGx5IHt0cnkge2lmICghX24gJiYgbnVsbCAhPSBfaVsicmV0dXJuIl0gJiYgKF9yID0gX2lbInJldHVybiJdKCksIE9iamVjdChfcikgIT09IF9yKSkgcmV0dXJuO30gZmluYWxseSB7aWYgKF9kKSB0aHJvdyBfZTt9fXJldHVybiBfYXJyO319ZnVuY3Rpb24gQm9vbGVhbklucHV0X2FycmF5V2l0aEhvbGVzKGFycikge2lmIChBcnJheS5pc0FycmF5KGFycikpIHJldHVybiBhcnI7fQoKCgogICAgICAgICAgZnVuY3Rpb24gQm9vbGVhbklucHV0KF9yZWYpIHt2YXIgYnV0dG9uID0gX3JlZi5idXR0b247CiAgICAgICAgICAgIHZhciBfdXNlU3RhdGUgPSAoMCwgcmVhY3QudXNlU3RhdGUpKGJ1dHRvbi52YWx1ZSA9PT0gInRydWUiKSxfdXNlU3RhdGUyID0gQm9vbGVhbklucHV0X3NsaWNlZFRvQXJyYXkoX3VzZVN0YXRlLCAyKSx2YWx1ZSA9IF91c2VTdGF0ZTJbMF0sc2V0VmFsdWUgPSBfdXNlU3RhdGUyWzFdOwoKICAgICAgICAgICAgcmV0dXJuIC8qI19fUFVSRV9fKi8oCiAgICAgICAgICAgICAgcmVhY3QuY3JlYXRlRWxlbWVudCgibGFiZWwiLCB7IGNsYXNzTmFtZTogImNoZWNrY29udGFpbmVyIiB9LCAvKiNfX1BVUkVfXyovCiAgICAgICAgICAgICAgcmVhY3QuY3JlYXRlRWxlbWVudCgiaW5wdXQiLCB7CiAgICAgICAgICAgICAgICB0eXBlOiAiaGlkZGVuIiwKICAgICAgICAgICAgICAgIG5hbWU6IGJ1dHRvbi5uYW1lLAogICAgICAgICAgICAgICAgdmFsdWU6IHZhbHVlLnRvU3RyaW5nKCksCiAgICAgICAgICAgICAgICAiZGF0YS1kZWZhdWx0IjogYnV0dG9uLnZhbHVlIH0pLCAvKiNfX1BVUkVfXyovCgogICAgICAgICAgICAgIHJlYWN0LmNyZWF0ZUVsZW1lbnQoImRpdiIsIHsKICAgICAgICAgICAgICAgIGNsYXNzTmFtZTogInRvZ2dsZS10cmFjayIsCiAgICAgICAgICAgICAgICBvbkNsaWNrOiBmdW5jdGlvbiBvbkNsaWNrKCkgewogICAgICAgICAgICAgICAgICBzZXRWYWx1ZSghdmFsdWUpOwogICAgICAgICAgICAgICAgICBidXR0b24uc2V0VmFsdWUoKCF2YWx1ZSkudG9TdHJpbmcoKSk7CiAgICAgICAgICAgICAgICB9IH0sIC8qI19fUFVSRV9fKi8KCiAgICAgICAgICAgICAgcmVhY3QuY3JlYXRlRWxlbWVudCgic3BhbiIsIHsgY2xhc3NOYW1lOiAidG9nZ2xlLWluZGljYXRvciIgfSwgLyojX19QVVJFX18qLwogICAgICAgICAgICAgIHJlYWN0LmNyZWF0ZUVsZW1lbnQoInNwYW4iLCB7IGNsYXNzTmFtZTogImNoZWNrTWFyayIgfSwgLyojX19QVVJFX18qLwogICAgICAgICAgICAgIHJlYWN0LmNyZWF0ZUVsZW1lbnQoInN2ZyIsIHsKICAgICAgICAgICAgICAgIHZpZXdCb3g6ICIwIDAgMjQgMjQiLAogICAgICAgICAgICAgICAgaWQ6ICJnaHEtc3ZnLWNoZWNrIiwKICAgICAgICAgICAgICAgIHJvbGU6ICJwcmVzZW50YXRpb24iLAogICAgICAgICAgICAgICAgImFyaWEtaGlkZGVuIjogInRydWUiIH0sIC8qI19fUFVSRV9fKi8KCiAgICAgICAgICAgICAgcmVhY3QuY3JlYXRlRWxlbWVudCgicGF0aCIsIHsgZDogIk05Ljg2IDE4YTEgMSAwIDAxLS43My0uMzJsLTQuODYtNS4xN2ExLjAwMSAxLjAwMSAwIDAxMS40Ni0xLjM3bDQuMTIgNC4zOSA4LjQxLTkuMmExIDEgMCAxMTEuNDggMS4zNGwtOS4xNCAxMGExIDEgMCAwMS0uNzMuMzNoLS4wMXoiIH0pKSkpKSkpOwoKCgoKCgogICAgICAgICAgfQoKICAgICAgICAgIC8qCiAgICAgICAgICA8ZGl2CiAgICAgICAgICAgIGNsYXNzPSJjaGVja21hcmsiCiAgICAgICAgICAgIG9uQ2xpY2s9eygpID0+IHsKICAgICAgICAgICAgICBzZXRWYWx1ZSghdmFsdWUpOwogICAgICAgICAgICB9fQogICAgICAgICAgLz4KICAgICAgICAgICAqLwogICAgICAgICAgLyogaGFybW9ueSBkZWZhdWx0IGV4cG9ydCAqL3ZhciBzZXR0aW5nc19Cb29sZWFuSW5wdXQgPSBCb29sZWFuSW5wdXQ7CiAgICAgICAgICA7IC8vIENPTkNBVEVOQVRFRCBNT0RVTEU6IC4vc3JjL3JlbGF5L2NvbXBvbmVudHMvc2V0dGluZ3MvRHJvcGRvd25JbnB1dC50c3gKCgoKICAgICAgICAgIGZ1bmN0aW9uIERyb3Bkb3duSW5wdXQoX3JlZikge3ZhciBidXR0b24gPSBfcmVmLmJ1dHRvbjsKICAgICAgICAgICAgcmV0dXJuIC8qI19fUFVSRV9fKi8oCiAgICAgICAgICAgICAgcmVhY3QuY3JlYXRlRWxlbWVudCgic2VsZWN0IiwgewogICAgICAgICAgICAgICAgY2xhc3NOYW1lOiAiZHJvcGRvd25jb250YWluZXIiLAogICAgICAgICAgICAgICAgbmFtZTogYnV0dG9uLm5hbWUsCiAgICAgICAgICAgICAgICBkZWZhdWx0VmFsdWU6IGJ1dHRvbi52YWx1ZSwKICAgICAgICAgICAgICAgIG9uQ2hhbmdlOiBmdW5jdGlvbiBvbkNoYW5nZShlKSB7cmV0dXJuIGJ1dHRvbi5zZXRWYWx1ZShlLnRhcmdldC52YWx1ZSk7fSB9LAoKICAgICAgICAgICAgICBidXR0b24uZHJvcGRvd24ubWFwKGZ1bmN0aW9uIChvcHRpb24pIHsKICAgICAgICAgICAgICAgIHJldHVybiAvKiNfX1BVUkVfXyovKAogICAgICAgICAgICAgICAgICByZWFjdC5jcmVhdGVFbGVtZW50KCJvcHRpb24iLCB7IGtleTogb3B0aW9uLnZhbHVlLCB2YWx1ZTogb3B0aW9uLnZhbHVlIH0sCiAgICAgICAgICAgICAgICAgIG9wdGlvbi5kaXNwbGF5IHx8IG9wdGlvbi52YWx1ZSkpOwoKCiAgICAgICAgICAgICAgfSkpKTsKCgogICAgICAgICAgfQoKICAgICAgICAgIC8qIGhhcm1vbnkgZGVmYXVsdCBleHBvcnQgKi92YXIgc2V0dGluZ3NfRHJvcGRvd25JbnB1dCA9IERyb3Bkb3duSW5wdXQ7CiAgICAgICAgICA7IC8vIENPTkNBVEVOQVRFRCBNT0RVTEU6IC4vc3JjL3JlbGF5L2NvbXBvbmVudHMvc2V0dGluZ3MvU3RyaW5nSW5wdXQudHN4CgoKCiAgICAgICAgICBmdW5jdGlvbiBTdHJpbmdJbnB1dChfcmVmKSB7dmFyIGJ1dHRvbiA9IF9yZWYuYnV0dG9uOwogICAgICAgICAgICByZXR1cm4gLyojX19QVVJFX18qLygKICAgICAgICAgICAgICByZWFjdC5jcmVhdGVFbGVtZW50KCJpbnB1dCIsIHsKICAgICAgICAgICAgICAgIGNsYXNzTmFtZTogInN0cmluZ2NvbnRhaW5lciIsCiAgICAgICAgICAgICAgICBuYW1lOiBidXR0b24ubmFtZSwKICAgICAgICAgICAgICAgIGRlZmF1bHRWYWx1ZTogYnV0dG9uLnZhbHVlLAogICAgICAgICAgICAgICAgb25DaGFuZ2U6IGZ1bmN0aW9uIG9uQ2hhbmdlKGUpIHtyZXR1cm4gYnV0dG9uLnNldFZhbHVlKGUudGFyZ2V0LnZhbHVlKTt9IH0pKTsKCgogICAgICAgICAgfQoKICAgICAgICAgIC8qIGhhcm1vbnkgZGVmYXVsdCBleHBvcnQgKi92YXIgc2V0dGluZ3NfU3RyaW5nSW5wdXQgPSBTdHJpbmdJbnB1dDsKICAgICAgICAgIDsgLy8gQ09OQ0FURU5BVEVEIE1PRFVMRTogLi9zcmMvcmVsYXkvY29tcG9uZW50cy9zZXR0aW5ncy9TZXR0aW5nLnRzeAogICAgICAgICAgZnVuY3Rpb24gU2V0dGluZ19zbGljZWRUb0FycmF5KGFyciwgaSkge3JldHVybiBTZXR0aW5nX2FycmF5V2l0aEhvbGVzKGFycikgfHwgU2V0dGluZ19pdGVyYWJsZVRvQXJyYXlMaW1pdChhcnIsIGkpIHx8IFNldHRpbmdfdW5zdXBwb3J0ZWRJdGVyYWJsZVRvQXJyYXkoYXJyLCBpKSB8fCBTZXR0aW5nX25vbkl0ZXJhYmxlUmVzdCgpO31mdW5jdGlvbiBTZXR0aW5nX25vbkl0ZXJhYmxlUmVzdCgpIHt0aHJvdyBuZXcgVHlwZUVycm9yKCJJbnZhbGlkIGF0dGVtcHQgdG8gZGVzdHJ1Y3R1cmUgbm9uLWl0ZXJhYmxlIGluc3RhbmNlLlxuSW4gb3JkZXIgdG8gYmUgaXRlcmFibGUsIG5vbi1hcnJheSBvYmplY3RzIG11c3QgaGF2ZSBhIFtTeW1ib2wuaXRlcmF0b3JdKCkgbWV0aG9kLiIpO31mdW5jdGlvbiBTZXR0aW5nX3Vuc3VwcG9ydGVkSXRlcmFibGVUb0FycmF5KG8sIG1pbkxlbikge2lmICghbykgcmV0dXJuO2lmICh0eXBlb2YgbyA9PT0gInN0cmluZyIpIHJldHVybiBTZXR0aW5nX2FycmF5TGlrZVRvQXJyYXkobywgbWluTGVuKTt2YXIgbiA9IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChvKS5zbGljZSg4LCAtMSk7aWYgKG4gPT09ICJPYmplY3QiICYmIG8uY29uc3RydWN0b3IpIG4gPSBvLmNvbnN0cnVjdG9yLm5hbWU7aWYgKG4gPT09ICJNYXAiIHx8IG4gPT09ICJTZXQiKSByZXR1cm4gQXJyYXkuZnJvbShvKTtpZiAobiA9PT0gIkFyZ3VtZW50cyIgfHwgL14oPzpVaXxJKW50KD86OHwxNnwzMikoPzpDbGFtcGVkKT9BcnJheSQvLnRlc3QobikpIHJldHVybiBTZXR0aW5nX2FycmF5TGlrZVRvQXJyYXkobywgbWluTGVuKTt9ZnVuY3Rpb24gU2V0dGluZ19hcnJheUxpa2VUb0FycmF5KGFyciwgbGVuKSB7aWYgKGxlbiA9PSBudWxsIHx8IGxlbiA+IGFyci5sZW5ndGgpIGxlbiA9IGFyci5sZW5ndGg7Zm9yICh2YXIgaSA9IDAsIGFycjIgPSBuZXcgQXJyYXkobGVuKTsgaSA8IGxlbjsgaSsrKSB7YXJyMltpXSA9IGFycltpXTt9cmV0dXJuIGFycjI7fWZ1bmN0aW9uIFNldHRpbmdfaXRlcmFibGVUb0FycmF5TGltaXQoYXJyLCBpKSB7dmFyIF9pID0gbnVsbCA9PSBhcnIgPyBudWxsIDogInVuZGVmaW5lZCIgIT0gdHlwZW9mIFN5bWJvbCAmJiBhcnJbU3ltYm9sLml0ZXJhdG9yXSB8fCBhcnJbIkBAaXRlcmF0b3IiXTtpZiAobnVsbCAhPSBfaSkge3ZhciBfcyxfZSxfeCxfcixfYXJyID0gW10sX24gPSAhMCxfZCA9ICExO3RyeSB7aWYgKF94ID0gKF9pID0gX2kuY2FsbChhcnIpKS5uZXh0LCAwID09PSBpKSB7aWYgKE9iamVjdChfaSkgIT09IF9pKSByZXR1cm47X24gPSAhMTt9IGVsc2UgZm9yICg7ICEoX24gPSAoX3MgPSBfeC5jYWxsKF9pKSkuZG9uZSkgJiYgKF9hcnIucHVzaChfcy52YWx1ZSksIF9hcnIubGVuZ3RoICE9PSBpKTsgX24gPSAhMCkgezt9fSBjYXRjaCAoZXJyKSB7X2QgPSAhMCwgX2UgPSBlcnI7fSBmaW5hbGx5IHt0cnkge2lmICghX24gJiYgbnVsbCAhPSBfaVsicmV0dXJuIl0gJiYgKF9yID0gX2lbInJldHVybiJdKCksIE9iamVjdChfcikgIT09IF9yKSkgcmV0dXJuO30gZmluYWxseSB7aWYgKF9kKSB0aHJvdyBfZTt9fXJldHVybiBfYXJyO319ZnVuY3Rpb24gU2V0dGluZ19hcnJheVdpdGhIb2xlcyhhcnIpIHtpZiAoQXJyYXkuaXNBcnJheShhcnIpKSByZXR1cm4gYXJyO30KCgoKCgoKICAgICAgICAgIGZ1bmN0aW9uIFNldHRpbmcoX3JlZikKCgoKCgogICAgICAgICAge3ZhciBidXR0b24gPSBfcmVmLmJ1dHRvbix2YWxpZGF0b3IgPSBfcmVmLnZhbGlkYXRvcjsKICAgICAgICAgICAgdmFyIF91c2VTdGF0ZSA9ICgwLCByZWFjdC51c2VTdGF0ZSkodmFsaWRhdG9yLmlzVmFsaWQoYnV0dG9uKSksX3VzZVN0YXRlMiA9IFNldHRpbmdfc2xpY2VkVG9BcnJheShfdXNlU3RhdGUsIDIpLHZhbGlkID0gX3VzZVN0YXRlMlswXSxzZXRWYWxpZCA9IF91c2VTdGF0ZTJbMV07CgogICAgICAgICAgICBidXR0b24uc2V0VmFsdWUgPSBmdW5jdGlvbiAodmFsKSB7CiAgICAgICAgICAgICAgYnV0dG9uLnZhbHVlID0gdmFsOwogICAgICAgICAgICAgIHZhbGlkYXRvci51cGRhdGVTZXR0aW5nKGJ1dHRvbik7CiAgICAgICAgICAgIH07CgogICAgICAgICAgICB2YWxpZGF0b3IuYWRkU2V0dGluZyhidXR0b24sIHNldFZhbGlkKTsKCiAgICAgICAgICAgIHJldHVybiAvKiNfX1BVUkVfXyovKAogICAgICAgICAgICAgIHJlYWN0LmNyZWF0ZUVsZW1lbnQoInRyIiwgeyBpZDogInVzZXJQcmVmZXJlbmNlIiB9LCAvKiNfX1BVUkVfXyovCiAgICAgICAgICAgICAgcmVhY3QuY3JlYXRlRWxlbWVudCgidGQiLCB7IGNsYXNzTmFtZTogInNldHRpbmciIH0sCiAgICAgICAgICAgICAgYnV0dG9uLm5hbWUsIC8qI19fUFVSRV9fKi8KICAgICAgICAgICAgICByZWFjdC5jcmVhdGVFbGVtZW50KCJkaXYiLCB7IGNsYXNzTmFtZTogInNldHRpbmdIb3ZlciIgfSwgYnV0dG9uLnByZWZlcmVuY2UpKSwgLyojX19QVVJFX18qLwoKICAgICAgICAgICAgICByZWFjdC5jcmVhdGVFbGVtZW50KCJ0ZCIsIHsgY2xhc3NOYW1lOiB2YWxpZCA/ICIiIDogImludmFsaWQtc2V0dGluZyIgfSwKICAgICAgICAgICAgICBidXR0b24udHlwZSA9PT0gUmVsYXlDb21wb25lbnRUeXBlLkJPT0xFQU4gPyAvKiNfX1BVUkVfXyovCiAgICAgICAgICAgICAgcmVhY3QuY3JlYXRlRWxlbWVudChzZXR0aW5nc19Cb29sZWFuSW5wdXQsIHsgYnV0dG9uOiBidXR0b24gfSkgOgogICAgICAgICAgICAgIGJ1dHRvbi50eXBlID09PSBSZWxheUNvbXBvbmVudFR5cGUuRFJPUERPV04gPyAvKiNfX1BVUkVfXyovCiAgICAgICAgICAgICAgcmVhY3QuY3JlYXRlRWxlbWVudChzZXR0aW5nc19Ecm9wZG93bklucHV0LCB7IGJ1dHRvbjogYnV0dG9uIH0pIDogLyojX19QVVJFX18qLwoKICAgICAgICAgICAgICByZWFjdC5jcmVhdGVFbGVtZW50KHNldHRpbmdzX1N0cmluZ0lucHV0LCB7IGJ1dHRvbjogYnV0dG9uIH0pLAoKICAgICAgICAgICAgICBidXR0b24uaW52YWxpZFJlYXNvbiAhPSBudWxsID8gLyojX19QVVJFX18qLwogICAgICAgICAgICAgIHJlYWN0LmNyZWF0ZUVsZW1lbnQoImRpdiIsIHsgY2xhc3NOYW1lOiAiaW52YWxpZC1yZWFzb24iLCBoaWRkZW46IHZhbGlkIH0sIC8qI19fUFVSRV9fKi8KICAgICAgICAgICAgICByZWFjdC5jcmVhdGVFbGVtZW50KCJzbWFsbCIsIG51bGwsIGJ1dHRvbi5pbnZhbGlkUmVhc29uKSkgOiAvKiNfX1BVUkVfXyovCgoKICAgICAgICAgICAgICByZWFjdC5jcmVhdGVFbGVtZW50KHJlYWN0LkZyYWdtZW50LCBudWxsKSksIC8qI19fUFVSRV9fKi8KCgogICAgICAgICAgICAgIHJlYWN0LmNyZWF0ZUVsZW1lbnQoInRkIiwgbnVsbCwgYnV0dG9uLmRlc2NyaXB0aW9uKSkpOwoKCiAgICAgICAgICB9CgogICAgICAgICAgLyogaGFybW9ueSBkZWZhdWx0IGV4cG9ydCAqL3ZhciBzZXR0aW5nc19TZXR0aW5nID0gU2V0dGluZzsKICAgICAgICAgIDsgLy8gQ09OQ0FURU5BVEVEIE1PRFVMRTogLi9zcmMvcmVsYXkvcm91dGVzL1JlbGF5UGFnZS50c3gKICAgICAgICAgIGZ1bmN0aW9uIFJlbGF5UGFnZV9zbGljZWRUb0FycmF5KGFyciwgaSkge3JldHVybiBSZWxheVBhZ2VfYXJyYXlXaXRoSG9sZXMoYXJyKSB8fCBSZWxheVBhZ2VfaXRlcmFibGVUb0FycmF5TGltaXQoYXJyLCBpKSB8fCBSZWxheVBhZ2VfdW5zdXBwb3J0ZWRJdGVyYWJsZVRvQXJyYXkoYXJyLCBpKSB8fCBSZWxheVBhZ2Vfbm9uSXRlcmFibGVSZXN0KCk7fWZ1bmN0aW9uIFJlbGF5UGFnZV9ub25JdGVyYWJsZVJlc3QoKSB7dGhyb3cgbmV3IFR5cGVFcnJvcigiSW52YWxpZCBhdHRlbXB0IHRvIGRlc3RydWN0dXJlIG5vbi1pdGVyYWJsZSBpbnN0YW5jZS5cbkluIG9yZGVyIHRvIGJlIGl0ZXJhYmxlLCBub24tYXJyYXkgb2JqZWN0cyBtdXN0IGhhdmUgYSBbU3ltYm9sLml0ZXJhdG9yXSgpIG1ldGhvZC4iKTt9ZnVuY3Rpb24gUmVsYXlQYWdlX2l0ZXJhYmxlVG9BcnJheUxpbWl0KGFyciwgaSkge3ZhciBfaSA9IG51bGwgPT0gYXJyID8gbnVsbCA6ICJ1bmRlZmluZWQiICE9IHR5cGVvZiBTeW1ib2wgJiYgYXJyW1N5bWJvbC5pdGVyYXRvcl0gfHwgYXJyWyJAQGl0ZXJhdG9yIl07aWYgKG51bGwgIT0gX2kpIHt2YXIgX3MsX2UsX3gsX3IsX2FyciA9IFtdLF9uID0gITAsX2QgPSAhMTt0cnkge2lmIChfeCA9IChfaSA9IF9pLmNhbGwoYXJyKSkubmV4dCwgMCA9PT0gaSkge2lmIChPYmplY3QoX2kpICE9PSBfaSkgcmV0dXJuO19uID0gITE7fSBlbHNlIGZvciAoOyAhKF9uID0gKF9zID0gX3guY2FsbChfaSkpLmRvbmUpICYmIChfYXJyLnB1c2goX3MudmFsdWUpLCBfYXJyLmxlbmd0aCAhPT0gaSk7IF9uID0gITApIHs7fX0gY2F0Y2ggKGVycikge19kID0gITAsIF9lID0gZXJyO30gZmluYWxseSB7dHJ5IHtpZiAoIV9uICYmIG51bGwgIT0gX2lbInJldHVybiJdICYmIChfciA9IF9pWyJyZXR1cm4iXSgpLCBPYmplY3QoX3IpICE9PSBfcikpIHJldHVybjt9IGZpbmFsbHkge2lmIChfZCkgdGhyb3cgX2U7fX1yZXR1cm4gX2Fycjt9fWZ1bmN0aW9uIFJlbGF5UGFnZV9hcnJheVdpdGhIb2xlcyhhcnIpIHtpZiAoQXJyYXkuaXNBcnJheShhcnIpKSByZXR1cm4gYXJyO31mdW5jdGlvbiBSZWxheVBhZ2VfY3JlYXRlRm9yT2ZJdGVyYXRvckhlbHBlcihvLCBhbGxvd0FycmF5TGlrZSkge3ZhciBpdCA9IHR5cGVvZiBTeW1ib2wgIT09ICJ1bmRlZmluZWQiICYmIG9bU3ltYm9sLml0ZXJhdG9yXSB8fCBvWyJAQGl0ZXJhdG9yIl07aWYgKCFpdCkge2lmIChBcnJheS5pc0FycmF5KG8pIHx8IChpdCA9IFJlbGF5UGFnZV91bnN1cHBvcnRlZEl0ZXJhYmxlVG9BcnJheShvKSkgfHwgYWxsb3dBcnJheUxpa2UgJiYgbyAmJiB0eXBlb2Ygby5sZW5ndGggPT09ICJudW1iZXIiKSB7aWYgKGl0KSBvID0gaXQ7dmFyIGkgPSAwO3ZhciBGID0gZnVuY3Rpb24gRigpIHt9O3JldHVybiB7IHM6IEYsIG46IGZ1bmN0aW9uIG4oKSB7aWYgKGkgPj0gby5sZW5ndGgpIHJldHVybiB7IGRvbmU6IHRydWUgfTtyZXR1cm4geyBkb25lOiBmYWxzZSwgdmFsdWU6IG9baSsrXSB9O30sIGU6IGZ1bmN0aW9uIGUoX2UyKSB7dGhyb3cgX2UyO30sIGY6IEYgfTt9dGhyb3cgbmV3IFR5cGVFcnJvcigiSW52YWxpZCBhdHRlbXB0IHRvIGl0ZXJhdGUgbm9uLWl0ZXJhYmxlIGluc3RhbmNlLlxuSW4gb3JkZXIgdG8gYmUgaXRlcmFibGUsIG5vbi1hcnJheSBvYmplY3RzIG11c3QgaGF2ZSBhIFtTeW1ib2wuaXRlcmF0b3JdKCkgbWV0aG9kLiIpO312YXIgbm9ybWFsQ29tcGxldGlvbiA9IHRydWUsZGlkRXJyID0gZmFsc2UsZXJyO3JldHVybiB7IHM6IGZ1bmN0aW9uIHMoKSB7aXQgPSBpdC5jYWxsKG8pO30sIG46IGZ1bmN0aW9uIG4oKSB7dmFyIHN0ZXAgPSBpdC5uZXh0KCk7bm9ybWFsQ29tcGxldGlvbiA9IHN0ZXAuZG9uZTtyZXR1cm4gc3RlcDt9LCBlOiBmdW5jdGlvbiBlKF9lMykge2RpZEVyciA9IHRydWU7ZXJyID0gX2UzO30sIGY6IGZ1bmN0aW9uIGYoKSB7dHJ5IHtpZiAoIW5vcm1hbENvbXBsZXRpb24gJiYgaXRbInJldHVybiJdICE9IG51bGwpIGl0WyJyZXR1cm4iXSgpO30gZmluYWxseSB7aWYgKGRpZEVycikgdGhyb3cgZXJyO319IH07fWZ1bmN0aW9uIFJlbGF5UGFnZV91bnN1cHBvcnRlZEl0ZXJhYmxlVG9BcnJheShvLCBtaW5MZW4pIHtpZiAoIW8pIHJldHVybjtpZiAodHlwZW9mIG8gPT09ICJzdHJpbmciKSByZXR1cm4gUmVsYXlQYWdlX2FycmF5TGlrZVRvQXJyYXkobywgbWluTGVuKTt2YXIgbiA9IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChvKS5zbGljZSg4LCAtMSk7aWYgKG4gPT09ICJPYmplY3QiICYmIG8uY29uc3RydWN0b3IpIG4gPSBvLmNvbnN0cnVjdG9yLm5hbWU7aWYgKG4gPT09ICJNYXAiIHx8IG4gPT09ICJTZXQiKSByZXR1cm4gQXJyYXkuZnJvbShvKTtpZiAobiA9PT0gIkFyZ3VtZW50cyIgfHwgL14oPzpVaXxJKW50KD86OHwxNnwzMikoPzpDbGFtcGVkKT9BcnJheSQvLnRlc3QobikpIHJldHVybiBSZWxheVBhZ2VfYXJyYXlMaWtlVG9BcnJheShvLCBtaW5MZW4pO31mdW5jdGlvbiBSZWxheVBhZ2VfYXJyYXlMaWtlVG9BcnJheShhcnIsIGxlbikge2lmIChsZW4gPT0gbnVsbCB8fCBsZW4gPiBhcnIubGVuZ3RoKSBsZW4gPSBhcnIubGVuZ3RoO2ZvciAodmFyIGkgPSAwLCBhcnIyID0gbmV3IEFycmF5KGxlbik7IGkgPCBsZW47IGkrKykge2FycjJbaV0gPSBhcnJbaV07fXJldHVybiBhcnIyO30KCgoKCgoKICAgICAgICAgIGZ1bmN0aW9uIFJlbGF5UGFnZShfcmVmKSB7dmFyIHBhZ2UgPSBfcmVmLnBhZ2U7CiAgICAgICAgICAgIHZhciBncm91cHMgPSBbXTsKICAgICAgICAgICAgdmFyIGN1cnJlbnRHcm91cCA9IG51bGw7dmFyIF9pdGVyYXRvciA9IFJlbGF5UGFnZV9jcmVhdGVGb3JPZkl0ZXJhdG9ySGVscGVyKAoKICAgICAgICAgICAgICBwYWdlLmNvbXBvbmVudHMpLF9zdGVwO3RyeSB7Zm9yIChfaXRlcmF0b3IucygpOyAhKF9zdGVwID0gX2l0ZXJhdG9yLm4oKSkuZG9uZTspIHt2YXIgY29tcG9uZW50ID0gX3N0ZXAudmFsdWU7CiAgICAgICAgICAgICAgICBpZiAoCiAgICAgICAgICAgICAgICBjb21wb25lbnQudHlwZSA9PSBSZWxheUNvbXBvbmVudFR5cGUuSFRNTCB8fAogICAgICAgICAgICAgICAgY29tcG9uZW50LnR5cGUgPT0gUmVsYXlDb21wb25lbnRUeXBlLklOVEVSUlVQVCkKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgZ3JvdXBzLnB1c2goY29tcG9uZW50KTsKICAgICAgICAgICAgICAgICAgY3VycmVudEdyb3VwID0gbnVsbDsKICAgICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgaWYgKGN1cnJlbnRHcm91cCA9PSBudWxsKSB7CiAgICAgICAgICAgICAgICAgIGN1cnJlbnRHcm91cCA9IFtdOwogICAgICAgICAgICAgICAgICBncm91cHMucHVzaChjdXJyZW50R3JvdXApOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGN1cnJlbnRHcm91cC5wdXNoKGNvbXBvbmVudCk7CiAgICAgICAgICAgICAgfX0gY2F0Y2ggKGVycikge19pdGVyYXRvci5lKGVycik7fSBmaW5hbGx5IHtfaXRlcmF0b3IuZigpO30KCiAgICAgICAgICAgIHZhciBlbGVtZW50cyA9IFtdOwogICAgICAgICAgICB2YXIgdmFsaWRhdG9yID0gbmV3IGFwaV9TZXR0aW5nVmFsaWRhdG9yKCk7CgogICAgICAgICAgICBncm91cHMuZm9yRWFjaChmdW5jdGlvbiAoY29tcG9uZW50cykgewogICAgICAgICAgICAgIGlmIChjb21wb25lbnRzLnR5cGUgPT0gUmVsYXlDb21wb25lbnRUeXBlLkhUTUwpIHsKICAgICAgICAgICAgICAgIHZhciBodG1sID0gY29tcG9uZW50czsKCiAgICAgICAgICAgICAgICBpZiAoaHRtbC5kYXRhID09IG51bGwpIHsKICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGVsZW1lbnRzLnB1c2goIC8qI19fUFVSRV9fKi8KICAgICAgICAgICAgICAgIHJlYWN0LmNyZWF0ZUVsZW1lbnQoImRpdiIsIHsKICAgICAgICAgICAgICAgICAgZGFuZ2Vyb3VzbHlTZXRJbm5lckhUTUw6IHsKICAgICAgICAgICAgICAgICAgICBfX2h0bWw6IGNvbXBvbmVudHMuZGF0YQogICAgICAgICAgICAgICAgICB9IH0pKTsKCgogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgaWYgKGNvbXBvbmVudHMudHlwZSA9PSBSZWxheUNvbXBvbmVudFR5cGUuSU5URVJSVVBUKSB7CiAgICAgICAgICAgICAgICBlbGVtZW50cy5wdXNoKCAvKiNfX1BVUkVfXyovCiAgICAgICAgICAgICAgICByZWFjdC5jcmVhdGVFbGVtZW50KGNvbXBvbmVudHNfSW50ZXJydXB0LCB7IGJ1dHRvbjogY29tcG9uZW50cyB9KSk7CgogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgdmFyIGJ1dHRvbnMgPSBjb21wb25lbnRzOwoKICAgICAgICAgICAgICBlbGVtZW50cy5wdXNoKCAvKiNfX1BVUkVfXyovCiAgICAgICAgICAgICAgcmVhY3QuY3JlYXRlRWxlbWVudCgidGFibGUiLCBudWxsLCAvKiNfX1BVUkVfXyovCiAgICAgICAgICAgICAgcmVhY3QuY3JlYXRlRWxlbWVudCgidGJvZHkiLCBudWxsLAogICAgICAgICAgICAgIGJ1dHRvbnMubWFwKGZ1bmN0aW9uIChzZXR0aW5nLCBpbmRleCkge3JldHVybiAvKiNfX1BVUkVfXyovKAogICAgICAgICAgICAgICAgICByZWFjdC5jcmVhdGVFbGVtZW50KHNldHRpbmdzX1NldHRpbmcsIHsga2V5OiBpbmRleCwgYnV0dG9uOiBzZXR0aW5nLCB2YWxpZGF0b3I6IHZhbGlkYXRvciB9KSk7fSkpKSk7CgoKCgogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIHZhbGlkYXRvci51cGRhdGVPYmplY3QoKTsKCiAgICAgICAgICAgIC8vIElmIHdlIGhhdmUgbm8gc2V0dGluZ3MgaW4gd2hpY2ggd2UnZCBzYXZlIHN0dWZmLCBkb24ndCBib3RoZXIgcmVuZGVyaW5nIHNhdmUgYnV0dG9uCiAgICAgICAgICAgIGlmICgKICAgICAgICAgICAgcGFnZS5jb21wb25lbnRzLmZpbmQoZnVuY3Rpb24gKGMpIHtyZXR1cm4gYy5wcmVmZXJlbmNlICE9IG51bGw7fSkgPT0KICAgICAgICAgICAgbnVsbCkKICAgICAgICAgICAgewogICAgICAgICAgICAgIHJldHVybiAvKiNfX1BVUkVfXyovcmVhY3QuY3JlYXRlRWxlbWVudChyZWFjdC5GcmFnbWVudCwgbnVsbCwgZWxlbWVudHMpOwogICAgICAgICAgICB9CgogICAgICAgICAgICByZXR1cm4gLyojX19QVVJFX18qLygKICAgICAgICAgICAgICByZWFjdC5jcmVhdGVFbGVtZW50KHJlYWN0LkZyYWdtZW50LCBudWxsLAogICAgICAgICAgICAgICIgIiwKICAgICAgICAgICAgICBlbGVtZW50cywgIiAiLCAvKiNfX1BVUkVfXyovcmVhY3QuY3JlYXRlRWxlbWVudCgiYnIiLCBudWxsKSwgLyojX19QVVJFX18qLwogICAgICAgICAgICAgIHJlYWN0LmNyZWF0ZUVsZW1lbnQoImlucHV0IiwgewogICAgICAgICAgICAgICAgY2xhc3NOYW1lOiAic2F2ZSIsCiAgICAgICAgICAgICAgICBvbkNsaWNrOiBmdW5jdGlvbiBvbkNsaWNrKCkge3JldHVybiAoCiAgICAgICAgICAgICAgICAgICAgc2F2ZVNldHRpbmdzKAogICAgICAgICAgICAgICAgICAgIHBhZ2UuY29tcG9uZW50cy5maWx0ZXIoCiAgICAgICAgICAgICAgICAgICAgZnVuY3Rpb24gKGIpIHtyZXR1cm4gYi5wcmVmZXJlbmNlICE9IG51bGw7fSkpLgoKICAgICAgICAgICAgICAgICAgICB0aGVuKGZ1bmN0aW9uIChlKSB7CiAgICAgICAgICAgICAgICAgICAgICB2YXIgY2hhbmdlZCA9IEpTT04ucGFyc2UoZSk7dmFyIF9pdGVyYXRvcjIgPSBSZWxheVBhZ2VfY3JlYXRlRm9yT2ZJdGVyYXRvckhlbHBlcigKCiAgICAgICAgICAgICAgICAgICAgICAgIGNoYW5nZWQpLF9zdGVwMjt0cnkge2ZvciAoX2l0ZXJhdG9yMi5zKCk7ICEoX3N0ZXAyID0gX2l0ZXJhdG9yMi5uKCkpLmRvbmU7KSB7dmFyIF9zdGVwMiR2YWx1ZSA9IFJlbGF5UGFnZV9zbGljZWRUb0FycmF5KF9zdGVwMi52YWx1ZSwgMykscHJvcCA9IF9zdGVwMiR2YWx1ZVswXSxwcmV2ID0gX3N0ZXAyJHZhbHVlWzFdLG5vdyA9IF9zdGVwMiR2YWx1ZVsyXTsKICAgICAgICAgICAgICAgICAgICAgICAgICBhZGROb3RpZmljYXRpb24oIiIuY29uY2F0KHByb3AsICIgY2hhbmdlZCBmcm9tIGAiKS5jb25jYXQocHJldiwgImAgdG8gYCIpLmNvbmNhdChub3csICJgIikpOwogICAgICAgICAgICAgICAgICAgICAgICB9fSBjYXRjaCAoZXJyKSB7X2l0ZXJhdG9yMi5lKGVycik7fSBmaW5hbGx5IHtfaXRlcmF0b3IyLmYoKTt9CgogICAgICAgICAgICAgICAgICAgICAgaWYgKGNoYW5nZWQubGVuZ3RoID09IDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgYWRkTm90aWZpY2F0aW9uKCJObyBzZXR0aW5ncyB3ZXJlIG1vZGlmaWVkLiIpOwogICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0pKTt9LAoKICAgICAgICAgICAgICAgIHR5cGU6ICJzdWJtaXQiLAogICAgICAgICAgICAgICAgdmFsdWU6ICJTYXZlIENoYW5nZXMiIH0pKSk7CgoKCiAgICAgICAgICB9CgogICAgICAgICAgLyogaGFybW9ueSBkZWZhdWx0IGV4cG9ydCAqL3ZhciByb3V0ZXNfUmVsYXlQYWdlID0gUmVsYXlQYWdlOwogICAgICAgICAgOyAvLyBDT05DQVRFTkFURUQgTU9EVUxFOiAuL3NyYy9yZWxheS9BcHAudHN4CgoKCgoKCiAgICAgICAgICBmdW5jdGlvbiBBcHAoX3JlZikge3ZhciBwYWdlcyA9IF9yZWYucGFnZXM7CiAgICAgICAgICAgIHJldHVybiAvKiNfX1BVUkVfXyovKAogICAgICAgICAgICAgIHJlYWN0LmNyZWF0ZUVsZW1lbnQoTWVtb3J5Um91dGVyLCBudWxsLAogICAgICAgICAgICAgICIgIiwgLyojX19QVVJFX18qLwogICAgICAgICAgICAgIHJlYWN0LmNyZWF0ZUVsZW1lbnQoUm91dGVzLCBudWxsLAogICAgICAgICAgICAgICIgIiwgLyojX19QVVJFX18qLwogICAgICAgICAgICAgIHJlYWN0LmNyZWF0ZUVsZW1lbnQoUm91dGUsIHsgZWxlbWVudDogLyojX19QVVJFX18qL3JlYWN0LmNyZWF0ZUVsZW1lbnQoY29tcG9uZW50c19MYXlvdXQsIHsgcGFnZXM6IHBhZ2VzIH0pIH0sCiAgICAgICAgICAgICAgIiAiLCAvKiNfX1BVUkVfXyovCiAgICAgICAgICAgICAgcmVhY3QuY3JlYXRlRWxlbWVudChSb3V0ZSwgewogICAgICAgICAgICAgICAgcGF0aDogIi8iLAogICAgICAgICAgICAgICAgZWxlbWVudDogLyojX19QVVJFX18qL3JlYWN0LmNyZWF0ZUVsZW1lbnQoTmF2aWdhdGUsIHsgdG86ICIvIiArIHBhZ2VzWzBdLmZpbGUsIHJlcGxhY2U6IHRydWUgfSkgfSksCiAgICAgICAgICAgICAgIiAiLAogICAgICAgICAgICAgIHBhZ2VzLm1hcChmdW5jdGlvbiAocCwgaW5kZXgpIHsKICAgICAgICAgICAgICAgIHJldHVybiAvKiNfX1BVUkVfXyovKAogICAgICAgICAgICAgICAgICByZWFjdC5jcmVhdGVFbGVtZW50KFJvdXRlLCB7CiAgICAgICAgICAgICAgICAgICAga2V5OiBpbmRleCwKICAgICAgICAgICAgICAgICAgICBwYXRoOiAiLyIgKyBwLmZpbGUsCiAgICAgICAgICAgICAgICAgICAgZWxlbWVudDogLyojX19QVVJFX18qL3JlYWN0LmNyZWF0ZUVsZW1lbnQocm91dGVzX1JlbGF5UGFnZSwgeyBwYWdlOiBwIH0pIH0pKTsKCgogICAgICAgICAgICAgIH0pLCAiICIpLAogICAgICAgICAgICAgICIgIiksCiAgICAgICAgICAgICAgIiAiKSk7CgoKICAgICAgICAgIH0KCiAgICAgICAgICAvKiBoYXJtb255IGRlZmF1bHQgZXhwb3J0ICovdmFyIHJlbGF5X0FwcCA9IEFwcDsKCiAgICAgICAgICAvKioqL30sCgogICAgICAgIC8qKiovNDQ4OgogICAgICAgIC8qKiovKF9fdW51c2VkX3dlYnBhY2tfbW9kdWxlLCBleHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSA9PiB7CgogICAgICAgICAgLyoqCiAgICAgICAgICAgKiBAbGljZW5zZSBSZWFjdAogICAgICAgICAgICogcmVhY3QtZG9tLnByb2R1Y3Rpb24ubWluLmpzCiAgICAgICAgICAgKgogICAgICAgICAgICogQ29weXJpZ2h0IChjKSBGYWNlYm9vaywgSW5jLiBhbmQgaXRzIGFmZmlsaWF0ZXMuCiAgICAgICAgICAgKgogICAgICAgICAgICogVGhpcyBzb3VyY2UgY29kZSBpcyBsaWNlbnNlZCB1bmRlciB0aGUgTUlUIGxpY2Vuc2UgZm91bmQgaW4gdGhlCiAgICAgICAgICAgKiBMSUNFTlNFIGZpbGUgaW4gdGhlIHJvb3QgZGlyZWN0b3J5IG9mIHRoaXMgc291cmNlIHRyZWUuCiAgICAgICAgICAgKi8KICAgICAgICAgIC8qCiAgICAgICAgICAgTW9kZXJuaXpyIDMuMC4wcHJlIChDdXN0b20gQnVpbGQpIHwgTUlUCiAgICAgICAgICAqLwogICAgICAgICAgdmFyIGFhID0gX193ZWJwYWNrX3JlcXVpcmVfXygyOTQpLGNhID0gX193ZWJwYWNrX3JlcXVpcmVfXyg4NDApO2Z1bmN0aW9uIHAoYSkge2ZvciAodmFyIGIgPSAiaHR0cHM6Ly9yZWFjdGpzLm9yZy9kb2NzL2Vycm9yLWRlY29kZXIuaHRtbD9pbnZhcmlhbnQ9IiArIGEsIGMgPSAxOyBjIDwgYXJndW1lbnRzLmxlbmd0aDsgYysrKSB7YiArPSAiJmFyZ3NbXT0iICsgZW5jb2RlVVJJQ29tcG9uZW50KGFyZ3VtZW50c1tjXSk7fXJldHVybiAiTWluaWZpZWQgUmVhY3QgZXJyb3IgIyIgKyBhICsgIjsgdmlzaXQgIiArIGIgKyAiIGZvciB0aGUgZnVsbCBtZXNzYWdlIG9yIHVzZSB0aGUgbm9uLW1pbmlmaWVkIGRldiBlbnZpcm9ubWVudCBmb3IgZnVsbCBlcnJvcnMgYW5kIGFkZGl0aW9uYWwgaGVscGZ1bCB3YXJuaW5ncy4iO312YXIgZGEgPSBuZXcgU2V0KCksZWEgPSB7fTtmdW5jdGlvbiBmYShhLCBiKSB7aGEoYSwgYik7aGEoYSArICJDYXB0dXJlIiwgYik7fQogICAgICAgICAgZnVuY3Rpb24gaGEoYSwgYikge2VhW2FdID0gYjtmb3IgKGEgPSAwOyBhIDwgYi5sZW5ndGg7IGErKykge2RhLmFkZChiW2FdKTt9fQogICAgICAgICAgdmFyIGlhID0gISgidW5kZWZpbmVkIiA9PT0gdHlwZW9mIHdpbmRvdyB8fCAidW5kZWZpbmVkIiA9PT0gdHlwZW9mIHdpbmRvdy5kb2N1bWVudCB8fCAidW5kZWZpbmVkIiA9PT0gdHlwZW9mIHdpbmRvdy5kb2N1bWVudC5jcmVhdGVFbGVtZW50KSxqYSA9IE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHksa2EgPSAvXls6QS1aX2Etelx1MDBDMC1cdTAwRDZcdTAwRDgtXHUwMEY2XHUwMEY4LVx1MDJGRlx1MDM3MC1cdTAzN0RcdTAzN0YtXHUxRkZGXHUyMDBDLVx1MjAwRFx1MjA3MC1cdTIxOEZcdTJDMDAtXHUyRkVGXHUzMDAxLVx1RDdGRlx1RjkwMC1cdUZEQ0ZcdUZERjAtXHVGRkZEXVs6QS1aX2Etelx1MDBDMC1cdTAwRDZcdTAwRDgtXHUwMEY2XHUwMEY4LVx1MDJGRlx1MDM3MC1cdTAzN0RcdTAzN0YtXHUxRkZGXHUyMDBDLVx1MjAwRFx1MjA3MC1cdTIxOEZcdTJDMDAtXHUyRkVGXHUzMDAxLVx1RDdGRlx1RjkwMC1cdUZEQ0ZcdUZERjAtXHVGRkZEXC0uMC05XHUwMEI3XHUwMzAwLVx1MDM2Rlx1MjAzRi1cdTIwNDBdKiQvLGxhID0KICAgICAgICAgICAge30sbWEgPSB7fTtmdW5jdGlvbiBvYShhKSB7aWYgKGphLmNhbGwobWEsIGEpKSByZXR1cm4gITA7aWYgKGphLmNhbGwobGEsIGEpKSByZXR1cm4gITE7aWYgKGthLnRlc3QoYSkpIHJldHVybiBtYVthXSA9ICEwO2xhW2FdID0gITA7cmV0dXJuICExO31mdW5jdGlvbiBwYShhLCBiLCBjLCBkKSB7aWYgKG51bGwgIT09IGMgJiYgMCA9PT0gYy50eXBlKSByZXR1cm4gITE7c3dpdGNoICh0eXBlb2YgYikge2Nhc2UgImZ1bmN0aW9uIjpjYXNlICJzeW1ib2wiOnJldHVybiAhMDtjYXNlICJib29sZWFuIjppZiAoZCkgcmV0dXJuICExO2lmIChudWxsICE9PSBjKSByZXR1cm4gIWMuYWNjZXB0c0Jvb2xlYW5zO2EgPSBhLnRvTG93ZXJDYXNlKCkuc2xpY2UoMCwgNSk7cmV0dXJuICJkYXRhLSIgIT09IGEgJiYgImFyaWEtIiAhPT0gYTtkZWZhdWx0OnJldHVybiAhMTt9fQogICAgICAgICAgZnVuY3Rpb24gcWEoYSwgYiwgYywgZCkge2lmIChudWxsID09PSBiIHx8ICJ1bmRlZmluZWQiID09PSB0eXBlb2YgYiB8fCBwYShhLCBiLCBjLCBkKSkgcmV0dXJuICEwO2lmIChkKSByZXR1cm4gITE7aWYgKG51bGwgIT09IGMpIHN3aXRjaCAoYy50eXBlKSB7Y2FzZSAzOnJldHVybiAhYjtjYXNlIDQ6cmV0dXJuICExID09PSBiO2Nhc2UgNTpyZXR1cm4gaXNOYU4oYik7Y2FzZSA2OnJldHVybiBpc05hTihiKSB8fCAxID4gYjt9cmV0dXJuICExO31mdW5jdGlvbiB2KGEsIGIsIGMsIGQsIGUsIGYsIGcpIHt0aGlzLmFjY2VwdHNCb29sZWFucyA9IDIgPT09IGIgfHwgMyA9PT0gYiB8fCA0ID09PSBiO3RoaXMuYXR0cmlidXRlTmFtZSA9IGQ7dGhpcy5hdHRyaWJ1dGVOYW1lc3BhY2UgPSBlO3RoaXMubXVzdFVzZVByb3BlcnR5ID0gYzt0aGlzLnByb3BlcnR5TmFtZSA9IGE7dGhpcy50eXBlID0gYjt0aGlzLnNhbml0aXplVVJMID0gZjt0aGlzLnJlbW92ZUVtcHR5U3RyaW5nID0gZzt9dmFyIHogPSB7fTsKICAgICAgICAgICJjaGlsZHJlbiBkYW5nZXJvdXNseVNldElubmVySFRNTCBkZWZhdWx0VmFsdWUgZGVmYXVsdENoZWNrZWQgaW5uZXJIVE1MIHN1cHByZXNzQ29udGVudEVkaXRhYmxlV2FybmluZyBzdXBwcmVzc0h5ZHJhdGlvbldhcm5pbmcgc3R5bGUiLnNwbGl0KCIgIikuZm9yRWFjaChmdW5jdGlvbiAoYSkge3pbYV0gPSBuZXcgdihhLCAwLCAhMSwgYSwgbnVsbCwgITEsICExKTt9KTtbWyJhY2NlcHRDaGFyc2V0IiwgImFjY2VwdC1jaGFyc2V0Il0sIFsiY2xhc3NOYW1lIiwgImNsYXNzIl0sIFsiaHRtbEZvciIsICJmb3IiXSwgWyJodHRwRXF1aXYiLCAiaHR0cC1lcXVpdiJdXS5mb3JFYWNoKGZ1bmN0aW9uIChhKSB7dmFyIGIgPSBhWzBdO3pbYl0gPSBuZXcgdihiLCAxLCAhMSwgYVsxXSwgbnVsbCwgITEsICExKTt9KTtbImNvbnRlbnRFZGl0YWJsZSIsICJkcmFnZ2FibGUiLCAic3BlbGxDaGVjayIsICJ2YWx1ZSJdLmZvckVhY2goZnVuY3Rpb24gKGEpIHt6W2FdID0gbmV3IHYoYSwgMiwgITEsIGEudG9Mb3dlckNhc2UoKSwgbnVsbCwgITEsICExKTt9KTsKICAgICAgICAgIFsiYXV0b1JldmVyc2UiLCAiZXh0ZXJuYWxSZXNvdXJjZXNSZXF1aXJlZCIsICJmb2N1c2FibGUiLCAicHJlc2VydmVBbHBoYSJdLmZvckVhY2goZnVuY3Rpb24gKGEpIHt6W2FdID0gbmV3IHYoYSwgMiwgITEsIGEsIG51bGwsICExLCAhMSk7fSk7ImFsbG93RnVsbFNjcmVlbiBhc3luYyBhdXRvRm9jdXMgYXV0b1BsYXkgY29udHJvbHMgZGVmYXVsdCBkZWZlciBkaXNhYmxlZCBkaXNhYmxlUGljdHVyZUluUGljdHVyZSBkaXNhYmxlUmVtb3RlUGxheWJhY2sgZm9ybU5vVmFsaWRhdGUgaGlkZGVuIGxvb3Agbm9Nb2R1bGUgbm9WYWxpZGF0ZSBvcGVuIHBsYXlzSW5saW5lIHJlYWRPbmx5IHJlcXVpcmVkIHJldmVyc2VkIHNjb3BlZCBzZWFtbGVzcyBpdGVtU2NvcGUiLnNwbGl0KCIgIikuZm9yRWFjaChmdW5jdGlvbiAoYSkge3pbYV0gPSBuZXcgdihhLCAzLCAhMSwgYS50b0xvd2VyQ2FzZSgpLCBudWxsLCAhMSwgITEpO30pOwogICAgICAgICAgWyJjaGVja2VkIiwgIm11bHRpcGxlIiwgIm11dGVkIiwgInNlbGVjdGVkIl0uZm9yRWFjaChmdW5jdGlvbiAoYSkge3pbYV0gPSBuZXcgdihhLCAzLCAhMCwgYSwgbnVsbCwgITEsICExKTt9KTtbImNhcHR1cmUiLCAiZG93bmxvYWQiXS5mb3JFYWNoKGZ1bmN0aW9uIChhKSB7elthXSA9IG5ldyB2KGEsIDQsICExLCBhLCBudWxsLCAhMSwgITEpO30pO1siY29scyIsICJyb3dzIiwgInNpemUiLCAic3BhbiJdLmZvckVhY2goZnVuY3Rpb24gKGEpIHt6W2FdID0gbmV3IHYoYSwgNiwgITEsIGEsIG51bGwsICExLCAhMSk7fSk7WyJyb3dTcGFuIiwgInN0YXJ0Il0uZm9yRWFjaChmdW5jdGlvbiAoYSkge3pbYV0gPSBuZXcgdihhLCA1LCAhMSwgYS50b0xvd2VyQ2FzZSgpLCBudWxsLCAhMSwgITEpO30pO3ZhciByYSA9IC9bXC06XShbYS16XSkvZztmdW5jdGlvbiBzYShhKSB7cmV0dXJuIGFbMV0udG9VcHBlckNhc2UoKTt9CiAgICAgICAgICAiYWNjZW50LWhlaWdodCBhbGlnbm1lbnQtYmFzZWxpbmUgYXJhYmljLWZvcm0gYmFzZWxpbmUtc2hpZnQgY2FwLWhlaWdodCBjbGlwLXBhdGggY2xpcC1ydWxlIGNvbG9yLWludGVycG9sYXRpb24gY29sb3ItaW50ZXJwb2xhdGlvbi1maWx0ZXJzIGNvbG9yLXByb2ZpbGUgY29sb3ItcmVuZGVyaW5nIGRvbWluYW50LWJhc2VsaW5lIGVuYWJsZS1iYWNrZ3JvdW5kIGZpbGwtb3BhY2l0eSBmaWxsLXJ1bGUgZmxvb2QtY29sb3IgZmxvb2Qtb3BhY2l0eSBmb250LWZhbWlseSBmb250LXNpemUgZm9udC1zaXplLWFkanVzdCBmb250LXN0cmV0Y2ggZm9udC1zdHlsZSBmb250LXZhcmlhbnQgZm9udC13ZWlnaHQgZ2x5cGgtbmFtZSBnbHlwaC1vcmllbnRhdGlvbi1ob3Jpem9udGFsIGdseXBoLW9yaWVudGF0aW9uLXZlcnRpY2FsIGhvcml6LWFkdi14IGhvcml6LW9yaWdpbi14IGltYWdlLXJlbmRlcmluZyBsZXR0ZXItc3BhY2luZyBsaWdodGluZy1jb2xvciBtYXJrZXItZW5kIG1hcmtlci1taWQgbWFya2VyLXN0YXJ0IG92ZXJsaW5lLXBvc2l0aW9uIG92ZXJsaW5lLXRoaWNrbmVzcyBwYWludC1vcmRlciBwYW5vc2UtMSBwb2ludGVyLWV2ZW50cyByZW5kZXJpbmctaW50ZW50IHNoYXBlLXJlbmRlcmluZyBzdG9wLWNvbG9yIHN0b3Atb3BhY2l0eSBzdHJpa2V0aHJvdWdoLXBvc2l0aW9uIHN0cmlrZXRocm91Z2gtdGhpY2tuZXNzIHN0cm9rZS1kYXNoYXJyYXkgc3Ryb2tlLWRhc2hvZmZzZXQgc3Ryb2tlLWxpbmVjYXAgc3Ryb2tlLWxpbmVqb2luIHN0cm9rZS1taXRlcmxpbWl0IHN0cm9rZS1vcGFjaXR5IHN0cm9rZS13aWR0aCB0ZXh0LWFuY2hvciB0ZXh0LWRlY29yYXRpb24gdGV4dC1yZW5kZXJpbmcgdW5kZXJsaW5lLXBvc2l0aW9uIHVuZGVybGluZS10aGlja25lc3MgdW5pY29kZS1iaWRpIHVuaWNvZGUtcmFuZ2UgdW5pdHMtcGVyLWVtIHYtYWxwaGFiZXRpYyB2LWhhbmdpbmcgdi1pZGVvZ3JhcGhpYyB2LW1hdGhlbWF0aWNhbCB2ZWN0b3ItZWZmZWN0IHZlcnQtYWR2LXkgdmVydC1vcmlnaW4teCB2ZXJ0LW9yaWdpbi15IHdvcmQtc3BhY2luZyB3cml0aW5nLW1vZGUgeG1sbnM6eGxpbmsgeC1oZWlnaHQiLnNwbGl0KCIgIikuZm9yRWFjaChmdW5jdGlvbiAoYSkge3ZhciBiID0gYS5yZXBsYWNlKHJhLAogICAgICAgICAgICBzYSk7eltiXSA9IG5ldyB2KGIsIDEsICExLCBhLCBudWxsLCAhMSwgITEpO30pOyJ4bGluazphY3R1YXRlIHhsaW5rOmFyY3JvbGUgeGxpbms6cm9sZSB4bGluazpzaG93IHhsaW5rOnRpdGxlIHhsaW5rOnR5cGUiLnNwbGl0KCIgIikuZm9yRWFjaChmdW5jdGlvbiAoYSkge3ZhciBiID0gYS5yZXBsYWNlKHJhLCBzYSk7eltiXSA9IG5ldyB2KGIsIDEsICExLCBhLCAiaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIsICExLCAhMSk7fSk7WyJ4bWw6YmFzZSIsICJ4bWw6bGFuZyIsICJ4bWw6c3BhY2UiXS5mb3JFYWNoKGZ1bmN0aW9uIChhKSB7dmFyIGIgPSBhLnJlcGxhY2UocmEsIHNhKTt6W2JdID0gbmV3IHYoYiwgMSwgITEsIGEsICJodHRwOi8vd3d3LnczLm9yZy9YTUwvMTk5OC9uYW1lc3BhY2UiLCAhMSwgITEpO30pO1sidGFiSW5kZXgiLCAiY3Jvc3NPcmlnaW4iXS5mb3JFYWNoKGZ1bmN0aW9uIChhKSB7elthXSA9IG5ldyB2KGEsIDEsICExLCBhLnRvTG93ZXJDYXNlKCksIG51bGwsICExLCAhMSk7fSk7CiAgICAgICAgICB6LnhsaW5rSHJlZiA9IG5ldyB2KCJ4bGlua0hyZWYiLCAxLCAhMSwgInhsaW5rOmhyZWYiLCAiaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIsICEwLCAhMSk7WyJzcmMiLCAiaHJlZiIsICJhY3Rpb24iLCAiZm9ybUFjdGlvbiJdLmZvckVhY2goZnVuY3Rpb24gKGEpIHt6W2FdID0gbmV3IHYoYSwgMSwgITEsIGEudG9Mb3dlckNhc2UoKSwgbnVsbCwgITAsICEwKTt9KTsKICAgICAgICAgIGZ1bmN0aW9uIHRhKGEsIGIsIGMsIGQpIHt2YXIgZSA9IHouaGFzT3duUHJvcGVydHkoYikgPyB6W2JdIDogbnVsbDtpZiAobnVsbCAhPT0gZSA/IDAgIT09IGUudHlwZSA6IGQgfHwgISgyIDwgYi5sZW5ndGgpIHx8ICJvIiAhPT0gYlswXSAmJiAiTyIgIT09IGJbMF0gfHwgIm4iICE9PSBiWzFdICYmICJOIiAhPT0gYlsxXSkgcWEoYiwgYywgZSwgZCkgJiYgKGMgPSBudWxsKSwgZCB8fCBudWxsID09PSBlID8gb2EoYikgJiYgKG51bGwgPT09IGMgPyBhLnJlbW92ZUF0dHJpYnV0ZShiKSA6IGEuc2V0QXR0cmlidXRlKGIsICIiICsgYykpIDogZS5tdXN0VXNlUHJvcGVydHkgPyBhW2UucHJvcGVydHlOYW1lXSA9IG51bGwgPT09IGMgPyAzID09PSBlLnR5cGUgPyAhMSA6ICIiIDogYyA6IChiID0gZS5hdHRyaWJ1dGVOYW1lLCBkID0gZS5hdHRyaWJ1dGVOYW1lc3BhY2UsIG51bGwgPT09IGMgPyBhLnJlbW92ZUF0dHJpYnV0ZShiKSA6IChlID0gZS50eXBlLCBjID0gMyA9PT0gZSB8fCA0ID09PSBlICYmICEwID09PSBjID8gIiIgOiAiIiArIGMsIGQgPyBhLnNldEF0dHJpYnV0ZU5TKGQsIGIsIGMpIDogYS5zZXRBdHRyaWJ1dGUoYiwgYykpKTt9CiAgICAgICAgICB2YXIgdWEgPSBhYS5fX1NFQ1JFVF9JTlRFUk5BTFNfRE9fTk9UX1VTRV9PUl9ZT1VfV0lMTF9CRV9GSVJFRCx2YSA9IFN5bWJvbC5mb3IoInJlYWN0LmVsZW1lbnQiKSx3YSA9IFN5bWJvbC5mb3IoInJlYWN0LnBvcnRhbCIpLHlhID0gU3ltYm9sLmZvcigicmVhY3QuZnJhZ21lbnQiKSx6YSA9IFN5bWJvbC5mb3IoInJlYWN0LnN0cmljdF9tb2RlIiksQWEgPSBTeW1ib2wuZm9yKCJyZWFjdC5wcm9maWxlciIpLEJhID0gU3ltYm9sLmZvcigicmVhY3QucHJvdmlkZXIiKSxDYSA9IFN5bWJvbC5mb3IoInJlYWN0LmNvbnRleHQiKSxEYSA9IFN5bWJvbC5mb3IoInJlYWN0LmZvcndhcmRfcmVmIiksRWEgPSBTeW1ib2wuZm9yKCJyZWFjdC5zdXNwZW5zZSIpLEZhID0gU3ltYm9sLmZvcigicmVhY3Quc3VzcGVuc2VfbGlzdCIpLEdhID0gU3ltYm9sLmZvcigicmVhY3QubWVtbyIpLEhhID0gU3ltYm9sLmZvcigicmVhY3QubGF6eSIpO1N5bWJvbC5mb3IoInJlYWN0LnNjb3BlIik7U3ltYm9sLmZvcigicmVhY3QuZGVidWdfdHJhY2VfbW9kZSIpOwogICAgICAgICAgdmFyIElhID0gU3ltYm9sLmZvcigicmVhY3Qub2Zmc2NyZWVuIik7U3ltYm9sLmZvcigicmVhY3QubGVnYWN5X2hpZGRlbiIpO1N5bWJvbC5mb3IoInJlYWN0LmNhY2hlIik7U3ltYm9sLmZvcigicmVhY3QudHJhY2luZ19tYXJrZXIiKTt2YXIgSmEgPSBTeW1ib2wuaXRlcmF0b3I7ZnVuY3Rpb24gS2EoYSkge2lmIChudWxsID09PSBhIHx8ICJvYmplY3QiICE9PSB0eXBlb2YgYSkgcmV0dXJuIG51bGw7YSA9IEphICYmIGFbSmFdIHx8IGFbIkBAaXRlcmF0b3IiXTtyZXR1cm4gImZ1bmN0aW9uIiA9PT0gdHlwZW9mIGEgPyBhIDogbnVsbDt9dmFyIEEgPSBPYmplY3QuYXNzaWduLExhO2Z1bmN0aW9uIE1hKGEpIHtpZiAodm9pZCAwID09PSBMYSkgdHJ5IHt0aHJvdyBFcnJvcigpO30gY2F0Y2ggKGMpIHt2YXIgYiA9IGMuc3RhY2sudHJpbSgpLm1hdGNoKC9cbiggKihhdCApPykvKTtMYSA9IGIgJiYgYlsxXSB8fCAiIjt9cmV0dXJuICJcbiIgKyBMYSArIGE7fXZhciBOYSA9ICExOwogICAgICAgICAgZnVuY3Rpb24gT2EoYSwgYikge2lmICghYSB8fCBOYSkgcmV0dXJuICIiO05hID0gITA7dmFyIGMgPSBFcnJvci5wcmVwYXJlU3RhY2tUcmFjZTtFcnJvci5wcmVwYXJlU3RhY2tUcmFjZSA9IHZvaWQgMDt0cnkge2lmIChiKSB7aWYgKGIgPSBmdW5jdGlvbiBiKCkge3Rocm93IEVycm9yKCk7fSwgT2JqZWN0LmRlZmluZVByb3BlcnR5KGIucHJvdG90eXBlLCAicHJvcHMiLCB7IHNldDogZnVuY3Rpb24gc2V0KCkge3Rocm93IEVycm9yKCk7fSB9KSwgIm9iamVjdCIgPT09IHR5cGVvZiBSZWZsZWN0ICYmIFJlZmxlY3QuY29uc3RydWN0KSB7dHJ5IHtSZWZsZWN0LmNvbnN0cnVjdChiLCBbXSk7fSBjYXRjaCAobCkge3ZhciBkID0gbDt9UmVmbGVjdC5jb25zdHJ1Y3QoYSwgW10sIGIpO30gZWxzZSB7dHJ5IHtiLmNhbGwoKTt9IGNhdGNoIChsKSB7ZCA9IGw7fWEuY2FsbChiLnByb3RvdHlwZSk7fX0gZWxzZSB7dHJ5IHt0aHJvdyBFcnJvcigpO30gY2F0Y2ggKGwpIHtkID0gbDt9YSgpO319IGNhdGNoIChsKSB7aWYgKGwgJiYgZCAmJiAic3RyaW5nIiA9PT0gdHlwZW9mIGwuc3RhY2spIHtmb3IgKHZhciBlID0gbC5zdGFjay5zcGxpdCgiXG4iKSwKICAgICAgICAgICAgICAgICAgZiA9IGQuc3RhY2suc3BsaXQoIlxuIiksIGcgPSBlLmxlbmd0aCAtIDEsIGggPSBmLmxlbmd0aCAtIDE7IDEgPD0gZyAmJiAwIDw9IGggJiYgZVtnXSAhPT0gZltoXTspIHtoLS07fWZvciAoOyAxIDw9IGcgJiYgMCA8PSBoOyBnLS0sIGgtLSkge2lmIChlW2ddICE9PSBmW2hdKSB7aWYgKDEgIT09IGcgfHwgMSAhPT0gaCkge2RvIHtpZiAoZy0tLCBoLS0sIDAgPiBoIHx8IGVbZ10gIT09IGZbaF0pIHt2YXIgayA9ICJcbiIgKyBlW2ddLnJlcGxhY2UoIiBhdCBuZXcgIiwgIiBhdCAiKTthLmRpc3BsYXlOYW1lICYmIGsuaW5jbHVkZXMoIjxhbm9ueW1vdXM+IikgJiYgKGsgPSBrLnJlcGxhY2UoIjxhbm9ueW1vdXM+IiwgYS5kaXNwbGF5TmFtZSkpO3JldHVybiBrO319IHdoaWxlICgxIDw9IGcgJiYgMCA8PSBoKTt9YnJlYWs7fX19fSBmaW5hbGx5IHtOYSA9ICExLCBFcnJvci5wcmVwYXJlU3RhY2tUcmFjZSA9IGM7fXJldHVybiAoYSA9IGEgPyBhLmRpc3BsYXlOYW1lIHx8IGEubmFtZSA6ICIiKSA/IE1hKGEpIDogIiI7fQogICAgICAgICAgZnVuY3Rpb24gUGEoYSkge3N3aXRjaCAoYS50YWcpIHtjYXNlIDU6cmV0dXJuIE1hKGEudHlwZSk7Y2FzZSAxNjpyZXR1cm4gTWEoIkxhenkiKTtjYXNlIDEzOnJldHVybiBNYSgiU3VzcGVuc2UiKTtjYXNlIDE5OnJldHVybiBNYSgiU3VzcGVuc2VMaXN0Iik7Y2FzZSAwOmNhc2UgMjpjYXNlIDE1OnJldHVybiBhID0gT2EoYS50eXBlLCAhMSksIGE7Y2FzZSAxMTpyZXR1cm4gYSA9IE9hKGEudHlwZS5yZW5kZXIsICExKSwgYTtjYXNlIDE6cmV0dXJuIGEgPSBPYShhLnR5cGUsICEwKSwgYTtkZWZhdWx0OnJldHVybiAiIjt9fQogICAgICAgICAgZnVuY3Rpb24gUWEoYSkge2lmIChudWxsID09IGEpIHJldHVybiBudWxsO2lmICgiZnVuY3Rpb24iID09PSB0eXBlb2YgYSkgcmV0dXJuIGEuZGlzcGxheU5hbWUgfHwgYS5uYW1lIHx8IG51bGw7aWYgKCJzdHJpbmciID09PSB0eXBlb2YgYSkgcmV0dXJuIGE7c3dpdGNoIChhKSB7Y2FzZSB5YTpyZXR1cm4gIkZyYWdtZW50IjtjYXNlIHdhOnJldHVybiAiUG9ydGFsIjtjYXNlIEFhOnJldHVybiAiUHJvZmlsZXIiO2Nhc2UgemE6cmV0dXJuICJTdHJpY3RNb2RlIjtjYXNlIEVhOnJldHVybiAiU3VzcGVuc2UiO2Nhc2UgRmE6cmV0dXJuICJTdXNwZW5zZUxpc3QiO31pZiAoIm9iamVjdCIgPT09IHR5cGVvZiBhKSBzd2l0Y2ggKGEuJCR0eXBlb2YpIHtjYXNlIENhOnJldHVybiAoYS5kaXNwbGF5TmFtZSB8fCAiQ29udGV4dCIpICsgIi5Db25zdW1lciI7Y2FzZSBCYTpyZXR1cm4gKGEuX2NvbnRleHQuZGlzcGxheU5hbWUgfHwgIkNvbnRleHQiKSArICIuUHJvdmlkZXIiO2Nhc2UgRGE6dmFyIGIgPSBhLnJlbmRlcjthID0gYS5kaXNwbGF5TmFtZTthIHx8IChhID0gYi5kaXNwbGF5TmFtZSB8fAogICAgICAgICAgICAgICAgYi5uYW1lIHx8ICIiLCBhID0gIiIgIT09IGEgPyAiRm9yd2FyZFJlZigiICsgYSArICIpIiA6ICJGb3J3YXJkUmVmIik7cmV0dXJuIGE7Y2FzZSBHYTpyZXR1cm4gYiA9IGEuZGlzcGxheU5hbWUgfHwgbnVsbCwgbnVsbCAhPT0gYiA/IGIgOiBRYShhLnR5cGUpIHx8ICJNZW1vIjtjYXNlIEhhOmIgPSBhLl9wYXlsb2FkO2EgPSBhLl9pbml0O3RyeSB7cmV0dXJuIFFhKGEoYikpO30gY2F0Y2ggKGMpIHt9fXJldHVybiBudWxsO30KICAgICAgICAgIGZ1bmN0aW9uIFJhKGEpIHt2YXIgYiA9IGEudHlwZTtzd2l0Y2ggKGEudGFnKSB7Y2FzZSAyNDpyZXR1cm4gIkNhY2hlIjtjYXNlIDk6cmV0dXJuIChiLmRpc3BsYXlOYW1lIHx8ICJDb250ZXh0IikgKyAiLkNvbnN1bWVyIjtjYXNlIDEwOnJldHVybiAoYi5fY29udGV4dC5kaXNwbGF5TmFtZSB8fCAiQ29udGV4dCIpICsgIi5Qcm92aWRlciI7Y2FzZSAxODpyZXR1cm4gIkRlaHlkcmF0ZWRGcmFnbWVudCI7Y2FzZSAxMTpyZXR1cm4gYSA9IGIucmVuZGVyLCBhID0gYS5kaXNwbGF5TmFtZSB8fCBhLm5hbWUgfHwgIiIsIGIuZGlzcGxheU5hbWUgfHwgKCIiICE9PSBhID8gIkZvcndhcmRSZWYoIiArIGEgKyAiKSIgOiAiRm9yd2FyZFJlZiIpO2Nhc2UgNzpyZXR1cm4gIkZyYWdtZW50IjtjYXNlIDU6cmV0dXJuIGI7Y2FzZSA0OnJldHVybiAiUG9ydGFsIjtjYXNlIDM6cmV0dXJuICJSb290IjtjYXNlIDY6cmV0dXJuICJUZXh0IjtjYXNlIDE2OnJldHVybiBRYShiKTtjYXNlIDg6cmV0dXJuIGIgPT09IHphID8gIlN0cmljdE1vZGUiIDogIk1vZGUiO2Nhc2UgMjI6cmV0dXJuICJPZmZzY3JlZW4iOwogICAgICAgICAgICAgIGNhc2UgMTI6cmV0dXJuICJQcm9maWxlciI7Y2FzZSAyMTpyZXR1cm4gIlNjb3BlIjtjYXNlIDEzOnJldHVybiAiU3VzcGVuc2UiO2Nhc2UgMTk6cmV0dXJuICJTdXNwZW5zZUxpc3QiO2Nhc2UgMjU6cmV0dXJuICJUcmFjaW5nTWFya2VyIjtjYXNlIDE6Y2FzZSAwOmNhc2UgMTc6Y2FzZSAyOmNhc2UgMTQ6Y2FzZSAxNTppZiAoImZ1bmN0aW9uIiA9PT0gdHlwZW9mIGIpIHJldHVybiBiLmRpc3BsYXlOYW1lIHx8IGIubmFtZSB8fCBudWxsO2lmICgic3RyaW5nIiA9PT0gdHlwZW9mIGIpIHJldHVybiBiO31yZXR1cm4gbnVsbDt9ZnVuY3Rpb24gU2EoYSkge3N3aXRjaCAodHlwZW9mIGEpIHtjYXNlICJib29sZWFuIjpjYXNlICJudW1iZXIiOmNhc2UgInN0cmluZyI6Y2FzZSAidW5kZWZpbmVkIjpyZXR1cm4gYTtjYXNlICJvYmplY3QiOnJldHVybiBhO2RlZmF1bHQ6cmV0dXJuICIiO319CiAgICAgICAgICBmdW5jdGlvbiBUYShhKSB7dmFyIGIgPSBhLnR5cGU7cmV0dXJuIChhID0gYS5ub2RlTmFtZSkgJiYgImlucHV0IiA9PT0gYS50b0xvd2VyQ2FzZSgpICYmICgiY2hlY2tib3giID09PSBiIHx8ICJyYWRpbyIgPT09IGIpO30KICAgICAgICAgIGZ1bmN0aW9uIFVhKGEpIHt2YXIgYiA9IFRhKGEpID8gImNoZWNrZWQiIDogInZhbHVlIixjID0gT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihhLmNvbnN0cnVjdG9yLnByb3RvdHlwZSwgYiksZCA9ICIiICsgYVtiXTtpZiAoIWEuaGFzT3duUHJvcGVydHkoYikgJiYgInVuZGVmaW5lZCIgIT09IHR5cGVvZiBjICYmICJmdW5jdGlvbiIgPT09IHR5cGVvZiBjLmdldCAmJiAiZnVuY3Rpb24iID09PSB0eXBlb2YgYy5zZXQpIHt2YXIgZSA9IGMuZ2V0LGYgPSBjLnNldDtPYmplY3QuZGVmaW5lUHJvcGVydHkoYSwgYiwgeyBjb25maWd1cmFibGU6ICEwLCBnZXQ6IGZ1bmN0aW9uIGdldCgpIHtyZXR1cm4gZS5jYWxsKHRoaXMpO30sIHNldDogZnVuY3Rpb24gc2V0KGEpIHtkID0gIiIgKyBhO2YuY2FsbCh0aGlzLCBhKTt9IH0pO09iamVjdC5kZWZpbmVQcm9wZXJ0eShhLCBiLCB7IGVudW1lcmFibGU6IGMuZW51bWVyYWJsZSB9KTtyZXR1cm4geyBnZXRWYWx1ZTogZnVuY3Rpb24gZ2V0VmFsdWUoKSB7cmV0dXJuIGQ7fSwgc2V0VmFsdWU6IGZ1bmN0aW9uIHNldFZhbHVlKGEpIHtkID0gIiIgKyBhO30sIHN0b3BUcmFja2luZzogZnVuY3Rpb24gc3RvcFRyYWNraW5nKCkge2EuX3ZhbHVlVHJhY2tlciA9CiAgICAgICAgICAgICAgICAgIG51bGw7ZGVsZXRlIGFbYl07fSB9O319ZnVuY3Rpb24gVmEoYSkge2EuX3ZhbHVlVHJhY2tlciB8fCAoYS5fdmFsdWVUcmFja2VyID0gVWEoYSkpO31mdW5jdGlvbiBXYShhKSB7aWYgKCFhKSByZXR1cm4gITE7dmFyIGIgPSBhLl92YWx1ZVRyYWNrZXI7aWYgKCFiKSByZXR1cm4gITA7dmFyIGMgPSBiLmdldFZhbHVlKCk7dmFyIGQgPSAiIjthICYmIChkID0gVGEoYSkgPyBhLmNoZWNrZWQgPyAidHJ1ZSIgOiAiZmFsc2UiIDogYS52YWx1ZSk7YSA9IGQ7cmV0dXJuIGEgIT09IGMgPyAoYi5zZXRWYWx1ZShhKSwgITApIDogITE7fWZ1bmN0aW9uIFhhKGEpIHthID0gYSB8fCAoInVuZGVmaW5lZCIgIT09IHR5cGVvZiBkb2N1bWVudCA/IGRvY3VtZW50IDogdm9pZCAwKTtpZiAoInVuZGVmaW5lZCIgPT09IHR5cGVvZiBhKSByZXR1cm4gbnVsbDt0cnkge3JldHVybiBhLmFjdGl2ZUVsZW1lbnQgfHwgYS5ib2R5O30gY2F0Y2ggKGIpIHtyZXR1cm4gYS5ib2R5O319CiAgICAgICAgICBmdW5jdGlvbiBZYShhLCBiKSB7dmFyIGMgPSBiLmNoZWNrZWQ7cmV0dXJuIEEoe30sIGIsIHsgZGVmYXVsdENoZWNrZWQ6IHZvaWQgMCwgZGVmYXVsdFZhbHVlOiB2b2lkIDAsIHZhbHVlOiB2b2lkIDAsIGNoZWNrZWQ6IG51bGwgIT0gYyA/IGMgOiBhLl93cmFwcGVyU3RhdGUuaW5pdGlhbENoZWNrZWQgfSk7fWZ1bmN0aW9uIFphKGEsIGIpIHt2YXIgYyA9IG51bGwgPT0gYi5kZWZhdWx0VmFsdWUgPyAiIiA6IGIuZGVmYXVsdFZhbHVlLGQgPSBudWxsICE9IGIuY2hlY2tlZCA/IGIuY2hlY2tlZCA6IGIuZGVmYXVsdENoZWNrZWQ7YyA9IFNhKG51bGwgIT0gYi52YWx1ZSA/IGIudmFsdWUgOiBjKTthLl93cmFwcGVyU3RhdGUgPSB7IGluaXRpYWxDaGVja2VkOiBkLCBpbml0aWFsVmFsdWU6IGMsIGNvbnRyb2xsZWQ6ICJjaGVja2JveCIgPT09IGIudHlwZSB8fCAicmFkaW8iID09PSBiLnR5cGUgPyBudWxsICE9IGIuY2hlY2tlZCA6IG51bGwgIT0gYi52YWx1ZSB9O31mdW5jdGlvbiBhYihhLCBiKSB7YiA9IGIuY2hlY2tlZDtudWxsICE9IGIgJiYgdGEoYSwgImNoZWNrZWQiLCBiLCAhMSk7fQogICAgICAgICAgZnVuY3Rpb24gYmIoYSwgYikge2FiKGEsIGIpO3ZhciBjID0gU2EoYi52YWx1ZSksZCA9IGIudHlwZTtpZiAobnVsbCAhPSBjKSB7aWYgKCJudW1iZXIiID09PSBkKSB7aWYgKDAgPT09IGMgJiYgIiIgPT09IGEudmFsdWUgfHwgYS52YWx1ZSAhPSBjKSBhLnZhbHVlID0gIiIgKyBjO30gZWxzZSBhLnZhbHVlICE9PSAiIiArIGMgJiYgKGEudmFsdWUgPSAiIiArIGMpO30gZWxzZSBpZiAoInN1Ym1pdCIgPT09IGQgfHwgInJlc2V0IiA9PT0gZCkge2EucmVtb3ZlQXR0cmlidXRlKCJ2YWx1ZSIpO3JldHVybjt9Yi5oYXNPd25Qcm9wZXJ0eSgidmFsdWUiKSA/IGNiKGEsIGIudHlwZSwgYykgOiBiLmhhc093blByb3BlcnR5KCJkZWZhdWx0VmFsdWUiKSAmJiBjYihhLCBiLnR5cGUsIFNhKGIuZGVmYXVsdFZhbHVlKSk7bnVsbCA9PSBiLmNoZWNrZWQgJiYgbnVsbCAhPSBiLmRlZmF1bHRDaGVja2VkICYmIChhLmRlZmF1bHRDaGVja2VkID0gISFiLmRlZmF1bHRDaGVja2VkKTt9CiAgICAgICAgICBmdW5jdGlvbiBkYihhLCBiLCBjKSB7aWYgKGIuaGFzT3duUHJvcGVydHkoInZhbHVlIikgfHwgYi5oYXNPd25Qcm9wZXJ0eSgiZGVmYXVsdFZhbHVlIikpIHt2YXIgZCA9IGIudHlwZTtpZiAoISgic3VibWl0IiAhPT0gZCAmJiAicmVzZXQiICE9PSBkIHx8IHZvaWQgMCAhPT0gYi52YWx1ZSAmJiBudWxsICE9PSBiLnZhbHVlKSkgcmV0dXJuO2IgPSAiIiArIGEuX3dyYXBwZXJTdGF0ZS5pbml0aWFsVmFsdWU7YyB8fCBiID09PSBhLnZhbHVlIHx8IChhLnZhbHVlID0gYik7YS5kZWZhdWx0VmFsdWUgPSBiO31jID0gYS5uYW1lOyIiICE9PSBjICYmIChhLm5hbWUgPSAiIik7YS5kZWZhdWx0Q2hlY2tlZCA9ICEhYS5fd3JhcHBlclN0YXRlLmluaXRpYWxDaGVja2VkOyIiICE9PSBjICYmIChhLm5hbWUgPSBjKTt9CiAgICAgICAgICBmdW5jdGlvbiBjYihhLCBiLCBjKSB7aWYgKCJudW1iZXIiICE9PSBiIHx8IFhhKGEub3duZXJEb2N1bWVudCkgIT09IGEpIG51bGwgPT0gYyA/IGEuZGVmYXVsdFZhbHVlID0gIiIgKyBhLl93cmFwcGVyU3RhdGUuaW5pdGlhbFZhbHVlIDogYS5kZWZhdWx0VmFsdWUgIT09ICIiICsgYyAmJiAoYS5kZWZhdWx0VmFsdWUgPSAiIiArIGMpO312YXIgZWIgPSBBcnJheS5pc0FycmF5OwogICAgICAgICAgZnVuY3Rpb24gZmIoYSwgYiwgYywgZCkge2EgPSBhLm9wdGlvbnM7aWYgKGIpIHtiID0ge307Zm9yICh2YXIgZSA9IDA7IGUgPCBjLmxlbmd0aDsgZSsrKSB7YlsiJCIgKyBjW2VdXSA9ICEwO31mb3IgKGMgPSAwOyBjIDwgYS5sZW5ndGg7IGMrKykge2UgPSBiLmhhc093blByb3BlcnR5KCIkIiArIGFbY10udmFsdWUpLCBhW2NdLnNlbGVjdGVkICE9PSBlICYmIChhW2NdLnNlbGVjdGVkID0gZSksIGUgJiYgZCAmJiAoYVtjXS5kZWZhdWx0U2VsZWN0ZWQgPSAhMCk7fX0gZWxzZSB7YyA9ICIiICsgU2EoYyk7YiA9IG51bGw7Zm9yIChlID0gMDsgZSA8IGEubGVuZ3RoOyBlKyspIHtpZiAoYVtlXS52YWx1ZSA9PT0gYykge2FbZV0uc2VsZWN0ZWQgPSAhMDtkICYmIChhW2VdLmRlZmF1bHRTZWxlY3RlZCA9ICEwKTtyZXR1cm47fW51bGwgIT09IGIgfHwgYVtlXS5kaXNhYmxlZCB8fCAoYiA9IGFbZV0pO31udWxsICE9PSBiICYmIChiLnNlbGVjdGVkID0gITApO319CiAgICAgICAgICBmdW5jdGlvbiBnYihhLCBiKSB7aWYgKG51bGwgIT0gYi5kYW5nZXJvdXNseVNldElubmVySFRNTCkgdGhyb3cgRXJyb3IocCg5MSkpO3JldHVybiBBKHt9LCBiLCB7IHZhbHVlOiB2b2lkIDAsIGRlZmF1bHRWYWx1ZTogdm9pZCAwLCBjaGlsZHJlbjogIiIgKyBhLl93cmFwcGVyU3RhdGUuaW5pdGlhbFZhbHVlIH0pO31mdW5jdGlvbiBoYihhLCBiKSB7dmFyIGMgPSBiLnZhbHVlO2lmIChudWxsID09IGMpIHtjID0gYi5jaGlsZHJlbjtiID0gYi5kZWZhdWx0VmFsdWU7aWYgKG51bGwgIT0gYykge2lmIChudWxsICE9IGIpIHRocm93IEVycm9yKHAoOTIpKTtpZiAoZWIoYykpIHtpZiAoMSA8IGMubGVuZ3RoKSB0aHJvdyBFcnJvcihwKDkzKSk7YyA9IGNbMF07fWIgPSBjO31udWxsID09IGIgJiYgKGIgPSAiIik7YyA9IGI7fWEuX3dyYXBwZXJTdGF0ZSA9IHsgaW5pdGlhbFZhbHVlOiBTYShjKSB9O30KICAgICAgICAgIGZ1bmN0aW9uIGliKGEsIGIpIHt2YXIgYyA9IFNhKGIudmFsdWUpLGQgPSBTYShiLmRlZmF1bHRWYWx1ZSk7bnVsbCAhPSBjICYmIChjID0gIiIgKyBjLCBjICE9PSBhLnZhbHVlICYmIChhLnZhbHVlID0gYyksIG51bGwgPT0gYi5kZWZhdWx0VmFsdWUgJiYgYS5kZWZhdWx0VmFsdWUgIT09IGMgJiYgKGEuZGVmYXVsdFZhbHVlID0gYykpO251bGwgIT0gZCAmJiAoYS5kZWZhdWx0VmFsdWUgPSAiIiArIGQpO31mdW5jdGlvbiBqYihhKSB7dmFyIGIgPSBhLnRleHRDb250ZW50O2IgPT09IGEuX3dyYXBwZXJTdGF0ZS5pbml0aWFsVmFsdWUgJiYgIiIgIT09IGIgJiYgbnVsbCAhPT0gYiAmJiAoYS52YWx1ZSA9IGIpO31mdW5jdGlvbiBrYihhKSB7c3dpdGNoIChhKSB7Y2FzZSAic3ZnIjpyZXR1cm4gImh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIjtjYXNlICJtYXRoIjpyZXR1cm4gImh0dHA6Ly93d3cudzMub3JnLzE5OTgvTWF0aC9NYXRoTUwiO2RlZmF1bHQ6cmV0dXJuICJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hodG1sIjt9fQogICAgICAgICAgZnVuY3Rpb24gbGIoYSwgYikge3JldHVybiBudWxsID09IGEgfHwgImh0dHA6Ly93d3cudzMub3JnLzE5OTkveGh0bWwiID09PSBhID8ga2IoYikgOiAiaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciID09PSBhICYmICJmb3JlaWduT2JqZWN0IiA9PT0gYiA/ICJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hodG1sIiA6IGE7fQogICAgICAgICAgdmFyIG1iLG5iID0gZnVuY3Rpb24gKGEpIHtyZXR1cm4gInVuZGVmaW5lZCIgIT09IHR5cGVvZiBNU0FwcCAmJiBNU0FwcC5leGVjVW5zYWZlTG9jYWxGdW5jdGlvbiA/IGZ1bmN0aW9uIChiLCBjLCBkLCBlKSB7TVNBcHAuZXhlY1Vuc2FmZUxvY2FsRnVuY3Rpb24oZnVuY3Rpb24gKCkge3JldHVybiBhKGIsIGMsIGQsIGUpO30pO30gOiBhO30oZnVuY3Rpb24gKGEsIGIpIHtpZiAoImh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiAhPT0gYS5uYW1lc3BhY2VVUkkgfHwgImlubmVySFRNTCIgaW4gYSkgYS5pbm5lckhUTUwgPSBiO2Vsc2Uge21iID0gbWIgfHwgZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2Iik7bWIuaW5uZXJIVE1MID0gIjxzdmc+IiArIGIudmFsdWVPZigpLnRvU3RyaW5nKCkgKyAiPC9zdmc+Ijtmb3IgKGIgPSBtYi5maXJzdENoaWxkOyBhLmZpcnN0Q2hpbGQ7KSB7YS5yZW1vdmVDaGlsZChhLmZpcnN0Q2hpbGQpO31mb3IgKDsgYi5maXJzdENoaWxkOykge2EuYXBwZW5kQ2hpbGQoYi5maXJzdENoaWxkKTt9fX0pOwogICAgICAgICAgZnVuY3Rpb24gb2IoYSwgYikge2lmIChiKSB7dmFyIGMgPSBhLmZpcnN0Q2hpbGQ7aWYgKGMgJiYgYyA9PT0gYS5sYXN0Q2hpbGQgJiYgMyA9PT0gYy5ub2RlVHlwZSkge2Mubm9kZVZhbHVlID0gYjtyZXR1cm47fX1hLnRleHRDb250ZW50ID0gYjt9CiAgICAgICAgICB2YXIgcGIgPSB7IGFuaW1hdGlvbkl0ZXJhdGlvbkNvdW50OiAhMCwgYXNwZWN0UmF0aW86ICEwLCBib3JkZXJJbWFnZU91dHNldDogITAsIGJvcmRlckltYWdlU2xpY2U6ICEwLCBib3JkZXJJbWFnZVdpZHRoOiAhMCwgYm94RmxleDogITAsIGJveEZsZXhHcm91cDogITAsIGJveE9yZGluYWxHcm91cDogITAsIGNvbHVtbkNvdW50OiAhMCwgY29sdW1uczogITAsIGZsZXg6ICEwLCBmbGV4R3JvdzogITAsIGZsZXhQb3NpdGl2ZTogITAsIGZsZXhTaHJpbms6ICEwLCBmbGV4TmVnYXRpdmU6ICEwLCBmbGV4T3JkZXI6ICEwLCBncmlkQXJlYTogITAsIGdyaWRSb3c6ICEwLCBncmlkUm93RW5kOiAhMCwgZ3JpZFJvd1NwYW46ICEwLCBncmlkUm93U3RhcnQ6ICEwLCBncmlkQ29sdW1uOiAhMCwgZ3JpZENvbHVtbkVuZDogITAsIGdyaWRDb2x1bW5TcGFuOiAhMCwgZ3JpZENvbHVtblN0YXJ0OiAhMCwgZm9udFdlaWdodDogITAsIGxpbmVDbGFtcDogITAsIGxpbmVIZWlnaHQ6ICEwLCBvcGFjaXR5OiAhMCwgb3JkZXI6ICEwLCBvcnBoYW5zOiAhMCwgdGFiU2l6ZTogITAsIHdpZG93czogITAsIHpJbmRleDogITAsCiAgICAgICAgICAgICAgem9vbTogITAsIGZpbGxPcGFjaXR5OiAhMCwgZmxvb2RPcGFjaXR5OiAhMCwgc3RvcE9wYWNpdHk6ICEwLCBzdHJva2VEYXNoYXJyYXk6ICEwLCBzdHJva2VEYXNob2Zmc2V0OiAhMCwgc3Ryb2tlTWl0ZXJsaW1pdDogITAsIHN0cm9rZU9wYWNpdHk6ICEwLCBzdHJva2VXaWR0aDogITAgfSxxYiA9IFsiV2Via2l0IiwgIm1zIiwgIk1veiIsICJPIl07T2JqZWN0LmtleXMocGIpLmZvckVhY2goZnVuY3Rpb24gKGEpIHtxYi5mb3JFYWNoKGZ1bmN0aW9uIChiKSB7YiA9IGIgKyBhLmNoYXJBdCgwKS50b1VwcGVyQ2FzZSgpICsgYS5zdWJzdHJpbmcoMSk7cGJbYl0gPSBwYlthXTt9KTt9KTtmdW5jdGlvbiByYihhLCBiLCBjKSB7cmV0dXJuIG51bGwgPT0gYiB8fCAiYm9vbGVhbiIgPT09IHR5cGVvZiBiIHx8ICIiID09PSBiID8gIiIgOiBjIHx8ICJudW1iZXIiICE9PSB0eXBlb2YgYiB8fCAwID09PSBiIHx8IHBiLmhhc093blByb3BlcnR5KGEpICYmIHBiW2FdID8gKCIiICsgYikudHJpbSgpIDogYiArICJweCI7fQogICAgICAgICAgZnVuY3Rpb24gc2IoYSwgYikge2EgPSBhLnN0eWxlO2ZvciAodmFyIGMgaW4gYikge2lmIChiLmhhc093blByb3BlcnR5KGMpKSB7dmFyIGQgPSAwID09PSBjLmluZGV4T2YoIi0tIiksZSA9IHJiKGMsIGJbY10sIGQpOyJmbG9hdCIgPT09IGMgJiYgKGMgPSAiY3NzRmxvYXQiKTtkID8gYS5zZXRQcm9wZXJ0eShjLCBlKSA6IGFbY10gPSBlO319fXZhciB0YiA9IEEoeyBtZW51aXRlbTogITAgfSwgeyBhcmVhOiAhMCwgYmFzZTogITAsIGJyOiAhMCwgY29sOiAhMCwgZW1iZWQ6ICEwLCBocjogITAsIGltZzogITAsIGlucHV0OiAhMCwga2V5Z2VuOiAhMCwgbGluazogITAsIG1ldGE6ICEwLCBwYXJhbTogITAsIHNvdXJjZTogITAsIHRyYWNrOiAhMCwgd2JyOiAhMCB9KTsKICAgICAgICAgIGZ1bmN0aW9uIHViKGEsIGIpIHtpZiAoYikge2lmICh0YlthXSAmJiAobnVsbCAhPSBiLmNoaWxkcmVuIHx8IG51bGwgIT0gYi5kYW5nZXJvdXNseVNldElubmVySFRNTCkpIHRocm93IEVycm9yKHAoMTM3LCBhKSk7aWYgKG51bGwgIT0gYi5kYW5nZXJvdXNseVNldElubmVySFRNTCkge2lmIChudWxsICE9IGIuY2hpbGRyZW4pIHRocm93IEVycm9yKHAoNjApKTtpZiAoIm9iamVjdCIgIT09IHR5cGVvZiBiLmRhbmdlcm91c2x5U2V0SW5uZXJIVE1MIHx8ICEoIl9faHRtbCIgaW4gYi5kYW5nZXJvdXNseVNldElubmVySFRNTCkpIHRocm93IEVycm9yKHAoNjEpKTt9aWYgKG51bGwgIT0gYi5zdHlsZSAmJiAib2JqZWN0IiAhPT0gdHlwZW9mIGIuc3R5bGUpIHRocm93IEVycm9yKHAoNjIpKTt9fQogICAgICAgICAgZnVuY3Rpb24gdmIoYSwgYikge2lmICgtMSA9PT0gYS5pbmRleE9mKCItIikpIHJldHVybiAic3RyaW5nIiA9PT0gdHlwZW9mIGIuaXM7c3dpdGNoIChhKSB7Y2FzZSAiYW5ub3RhdGlvbi14bWwiOmNhc2UgImNvbG9yLXByb2ZpbGUiOmNhc2UgImZvbnQtZmFjZSI6Y2FzZSAiZm9udC1mYWNlLXNyYyI6Y2FzZSAiZm9udC1mYWNlLXVyaSI6Y2FzZSAiZm9udC1mYWNlLWZvcm1hdCI6Y2FzZSAiZm9udC1mYWNlLW5hbWUiOmNhc2UgIm1pc3NpbmctZ2x5cGgiOnJldHVybiAhMTtkZWZhdWx0OnJldHVybiAhMDt9fXZhciB3YiA9IG51bGw7ZnVuY3Rpb24geGIoYSkge2EgPSBhLnRhcmdldCB8fCBhLnNyY0VsZW1lbnQgfHwgd2luZG93O2EuY29ycmVzcG9uZGluZ1VzZUVsZW1lbnQgJiYgKGEgPSBhLmNvcnJlc3BvbmRpbmdVc2VFbGVtZW50KTtyZXR1cm4gMyA9PT0gYS5ub2RlVHlwZSA/IGEucGFyZW50Tm9kZSA6IGE7fXZhciB5YiA9IG51bGwsemIgPSBudWxsLEFiID0gbnVsbDsKICAgICAgICAgIGZ1bmN0aW9uIEJiKGEpIHtpZiAoYSA9IENiKGEpKSB7aWYgKCJmdW5jdGlvbiIgIT09IHR5cGVvZiB5YikgdGhyb3cgRXJyb3IocCgyODApKTt2YXIgYiA9IGEuc3RhdGVOb2RlO2IgJiYgKGIgPSBEYihiKSwgeWIoYS5zdGF0ZU5vZGUsIGEudHlwZSwgYikpO319ZnVuY3Rpb24gRWIoYSkge3piID8gQWIgPyBBYi5wdXNoKGEpIDogQWIgPSBbYV0gOiB6YiA9IGE7fWZ1bmN0aW9uIEZiKCkge2lmICh6Yikge3ZhciBhID0gemIsYiA9IEFiO0FiID0gemIgPSBudWxsO0JiKGEpO2lmIChiKSBmb3IgKGEgPSAwOyBhIDwgYi5sZW5ndGg7IGErKykge0JiKGJbYV0pO319fWZ1bmN0aW9uIEdiKGEsIGIpIHtyZXR1cm4gYShiKTt9ZnVuY3Rpb24gSGIoKSB7fXZhciBJYiA9ICExO2Z1bmN0aW9uIEpiKGEsIGIsIGMpIHtpZiAoSWIpIHJldHVybiBhKGIsIGMpO0liID0gITA7dHJ5IHtyZXR1cm4gR2IoYSwgYiwgYyk7fSBmaW5hbGx5IHtpZiAoSWIgPSAhMSwgbnVsbCAhPT0gemIgfHwgbnVsbCAhPT0gQWIpIEhiKCksIEZiKCk7fX0KICAgICAgICAgIGZ1bmN0aW9uIEtiKGEsIGIpIHt2YXIgYyA9IGEuc3RhdGVOb2RlO2lmIChudWxsID09PSBjKSByZXR1cm4gbnVsbDt2YXIgZCA9IERiKGMpO2lmIChudWxsID09PSBkKSByZXR1cm4gbnVsbDtjID0gZFtiXTthOiBzd2l0Y2ggKGIpIHtjYXNlICJvbkNsaWNrIjpjYXNlICJvbkNsaWNrQ2FwdHVyZSI6Y2FzZSAib25Eb3VibGVDbGljayI6Y2FzZSAib25Eb3VibGVDbGlja0NhcHR1cmUiOmNhc2UgIm9uTW91c2VEb3duIjpjYXNlICJvbk1vdXNlRG93bkNhcHR1cmUiOmNhc2UgIm9uTW91c2VNb3ZlIjpjYXNlICJvbk1vdXNlTW92ZUNhcHR1cmUiOmNhc2UgIm9uTW91c2VVcCI6Y2FzZSAib25Nb3VzZVVwQ2FwdHVyZSI6Y2FzZSAib25Nb3VzZUVudGVyIjooZCA9ICFkLmRpc2FibGVkKSB8fCAoYSA9IGEudHlwZSwgZCA9ICEoImJ1dHRvbiIgPT09IGEgfHwgImlucHV0IiA9PT0gYSB8fCAic2VsZWN0IiA9PT0gYSB8fCAidGV4dGFyZWEiID09PSBhKSk7YSA9ICFkO2JyZWFrIGE7ZGVmYXVsdDphID0gITE7fWlmIChhKSByZXR1cm4gbnVsbDtpZiAoYyAmJiAiZnVuY3Rpb24iICE9PQogICAgICAgICAgICB0eXBlb2YgYykgdGhyb3cgRXJyb3IocCgyMzEsIGIsIHR5cGVvZiBjKSk7cmV0dXJuIGM7fXZhciBMYiA9ICExO2lmIChpYSkgdHJ5IHt2YXIgTWIgPSB7fTtPYmplY3QuZGVmaW5lUHJvcGVydHkoTWIsICJwYXNzaXZlIiwgeyBnZXQ6IGZ1bmN0aW9uIGdldCgpIHtMYiA9ICEwO30gfSk7d2luZG93LmFkZEV2ZW50TGlzdGVuZXIoInRlc3QiLCBNYiwgTWIpO3dpbmRvdy5yZW1vdmVFdmVudExpc3RlbmVyKCJ0ZXN0IiwgTWIsIE1iKTt9IGNhdGNoIChhKSB7TGIgPSAhMTt9ZnVuY3Rpb24gTmIoYSwgYiwgYywgZCwgZSwgZiwgZywgaCwgaykge3ZhciBsID0gQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYXJndW1lbnRzLCAzKTt0cnkge2IuYXBwbHkoYywgbCk7fSBjYXRjaCAobSkge3RoaXMub25FcnJvcihtKTt9fXZhciBPYiA9ICExLFBiID0gbnVsbCxRYiA9ICExLFJiID0gbnVsbCxTYiA9IHsgb25FcnJvcjogZnVuY3Rpb24gb25FcnJvcihhKSB7T2IgPSAhMDtQYiA9IGE7fSB9O2Z1bmN0aW9uIFRiKGEsIGIsIGMsIGQsIGUsIGYsIGcsIGgsIGspIHtPYiA9ICExO1BiID0gbnVsbDtOYi5hcHBseShTYiwgYXJndW1lbnRzKTt9CiAgICAgICAgICBmdW5jdGlvbiBVYihhLCBiLCBjLCBkLCBlLCBmLCBnLCBoLCBrKSB7VGIuYXBwbHkodGhpcywgYXJndW1lbnRzKTtpZiAoT2IpIHtpZiAoT2IpIHt2YXIgbCA9IFBiO09iID0gITE7UGIgPSBudWxsO30gZWxzZSB0aHJvdyBFcnJvcihwKDE5OCkpO1FiIHx8IChRYiA9ICEwLCBSYiA9IGwpO319ZnVuY3Rpb24gVmIoYSkge3ZhciBiID0gYSxjID0gYTtpZiAoYS5hbHRlcm5hdGUpIGZvciAoOyBiLnJldHVybjspIHtiID0gYi5yZXR1cm47fSBlbHNlIHthID0gYjtkbyB7YiA9IGEsIDAgIT09IChiLmZsYWdzICYgNDA5OCkgJiYgKGMgPSBiLnJldHVybiksIGEgPSBiLnJldHVybjt9IHdoaWxlIChhKTt9cmV0dXJuIDMgPT09IGIudGFnID8gYyA6IG51bGw7fWZ1bmN0aW9uIFdiKGEpIHtpZiAoMTMgPT09IGEudGFnKSB7dmFyIGIgPSBhLm1lbW9pemVkU3RhdGU7bnVsbCA9PT0gYiAmJiAoYSA9IGEuYWx0ZXJuYXRlLCBudWxsICE9PSBhICYmIChiID0gYS5tZW1vaXplZFN0YXRlKSk7aWYgKG51bGwgIT09IGIpIHJldHVybiBiLmRlaHlkcmF0ZWQ7fXJldHVybiBudWxsO31mdW5jdGlvbiBYYihhKSB7aWYgKFZiKGEpICE9PSBhKSB0aHJvdyBFcnJvcihwKDE4OCkpO30KICAgICAgICAgIGZ1bmN0aW9uIFliKGEpIHt2YXIgYiA9IGEuYWx0ZXJuYXRlO2lmICghYikge2IgPSBWYihhKTtpZiAobnVsbCA9PT0gYikgdGhyb3cgRXJyb3IocCgxODgpKTtyZXR1cm4gYiAhPT0gYSA/IG51bGwgOiBhO31mb3IgKHZhciBjID0gYSwgZCA9IGI7Oykge3ZhciBlID0gYy5yZXR1cm47aWYgKG51bGwgPT09IGUpIGJyZWFrO3ZhciBmID0gZS5hbHRlcm5hdGU7aWYgKG51bGwgPT09IGYpIHtkID0gZS5yZXR1cm47aWYgKG51bGwgIT09IGQpIHtjID0gZDtjb250aW51ZTt9YnJlYWs7fWlmIChlLmNoaWxkID09PSBmLmNoaWxkKSB7Zm9yIChmID0gZS5jaGlsZDsgZjspIHtpZiAoZiA9PT0gYykgcmV0dXJuIFhiKGUpLCBhO2lmIChmID09PSBkKSByZXR1cm4gWGIoZSksIGI7ZiA9IGYuc2libGluZzt9dGhyb3cgRXJyb3IocCgxODgpKTt9aWYgKGMucmV0dXJuICE9PSBkLnJldHVybikgYyA9IGUsIGQgPSBmO2Vsc2Uge2ZvciAodmFyIGcgPSAhMSwgaCA9IGUuY2hpbGQ7IGg7KSB7aWYgKGggPT09IGMpIHtnID0gITA7YyA9IGU7ZCA9IGY7YnJlYWs7fWlmIChoID09PSBkKSB7ZyA9ICEwO2QgPSBlO2MgPSBmO2JyZWFrO31oID0gaC5zaWJsaW5nO31pZiAoIWcpIHtmb3IgKGggPSBmLmNoaWxkOyBoOykge2lmIChoID09PQogICAgICAgICAgICAgICAgICAgIGMpIHtnID0gITA7YyA9IGY7ZCA9IGU7YnJlYWs7fWlmIChoID09PSBkKSB7ZyA9ICEwO2QgPSBmO2MgPSBlO2JyZWFrO31oID0gaC5zaWJsaW5nO31pZiAoIWcpIHRocm93IEVycm9yKHAoMTg5KSk7fX1pZiAoYy5hbHRlcm5hdGUgIT09IGQpIHRocm93IEVycm9yKHAoMTkwKSk7fWlmICgzICE9PSBjLnRhZykgdGhyb3cgRXJyb3IocCgxODgpKTtyZXR1cm4gYy5zdGF0ZU5vZGUuY3VycmVudCA9PT0gYyA/IGEgOiBiO31mdW5jdGlvbiBaYihhKSB7YSA9IFliKGEpO3JldHVybiBudWxsICE9PSBhID8gJGIoYSkgOiBudWxsO31mdW5jdGlvbiAkYihhKSB7aWYgKDUgPT09IGEudGFnIHx8IDYgPT09IGEudGFnKSByZXR1cm4gYTtmb3IgKGEgPSBhLmNoaWxkOyBudWxsICE9PSBhOykge3ZhciBiID0gJGIoYSk7aWYgKG51bGwgIT09IGIpIHJldHVybiBiO2EgPSBhLnNpYmxpbmc7fXJldHVybiBudWxsO30KICAgICAgICAgIHZhciBhYyA9IGNhLnVuc3RhYmxlX3NjaGVkdWxlQ2FsbGJhY2ssYmMgPSBjYS51bnN0YWJsZV9jYW5jZWxDYWxsYmFjayxjYyA9IGNhLnVuc3RhYmxlX3Nob3VsZFlpZWxkLGRjID0gY2EudW5zdGFibGVfcmVxdWVzdFBhaW50LEIgPSBjYS51bnN0YWJsZV9ub3csZWMgPSBjYS51bnN0YWJsZV9nZXRDdXJyZW50UHJpb3JpdHlMZXZlbCxmYyA9IGNhLnVuc3RhYmxlX0ltbWVkaWF0ZVByaW9yaXR5LGdjID0gY2EudW5zdGFibGVfVXNlckJsb2NraW5nUHJpb3JpdHksaGMgPSBjYS51bnN0YWJsZV9Ob3JtYWxQcmlvcml0eSxpYyA9IGNhLnVuc3RhYmxlX0xvd1ByaW9yaXR5LGpjID0gY2EudW5zdGFibGVfSWRsZVByaW9yaXR5LGtjID0gbnVsbCxsYyA9IG51bGw7ZnVuY3Rpb24gbWMoYSkge2lmIChsYyAmJiAiZnVuY3Rpb24iID09PSB0eXBlb2YgbGMub25Db21taXRGaWJlclJvb3QpIHRyeSB7bGMub25Db21taXRGaWJlclJvb3Qoa2MsIGEsIHZvaWQgMCwgMTI4ID09PSAoYS5jdXJyZW50LmZsYWdzICYgMTI4KSk7fSBjYXRjaCAoYikge319CiAgICAgICAgICB2YXIgb2MgPSBNYXRoLmNsejMyID8gTWF0aC5jbHozMiA6IG5jLHBjID0gTWF0aC5sb2cscWMgPSBNYXRoLkxOMjtmdW5jdGlvbiBuYyhhKSB7YSA+Pj49IDA7cmV0dXJuIDAgPT09IGEgPyAzMiA6IDMxIC0gKHBjKGEpIC8gcWMgfCAwKSB8IDA7fXZhciByYyA9IDY0LHNjID0gNDE5NDMwNDsKICAgICAgICAgIGZ1bmN0aW9uIHRjKGEpIHtzd2l0Y2ggKGEgJiAtYSkge2Nhc2UgMTpyZXR1cm4gMTtjYXNlIDI6cmV0dXJuIDI7Y2FzZSA0OnJldHVybiA0O2Nhc2UgODpyZXR1cm4gODtjYXNlIDE2OnJldHVybiAxNjtjYXNlIDMyOnJldHVybiAzMjtjYXNlIDY0OmNhc2UgMTI4OmNhc2UgMjU2OmNhc2UgNTEyOmNhc2UgMTAyNDpjYXNlIDIwNDg6Y2FzZSA0MDk2OmNhc2UgODE5MjpjYXNlIDE2Mzg0OmNhc2UgMzI3Njg6Y2FzZSA2NTUzNjpjYXNlIDEzMTA3MjpjYXNlIDI2MjE0NDpjYXNlIDUyNDI4ODpjYXNlIDEwNDg1NzY6Y2FzZSAyMDk3MTUyOnJldHVybiBhICYgNDE5NDI0MDtjYXNlIDQxOTQzMDQ6Y2FzZSA4Mzg4NjA4OmNhc2UgMTY3NzcyMTY6Y2FzZSAzMzU1NDQzMjpjYXNlIDY3MTA4ODY0OnJldHVybiBhICYgMTMwMDIzNDI0O2Nhc2UgMTM0MjE3NzI4OnJldHVybiAxMzQyMTc3Mjg7Y2FzZSAyNjg0MzU0NTY6cmV0dXJuIDI2ODQzNTQ1NjtjYXNlIDUzNjg3MDkxMjpyZXR1cm4gNTM2ODcwOTEyO2Nhc2UgMTA3Mzc0MTgyNDpyZXR1cm4gMTA3Mzc0MTgyNDsKICAgICAgICAgICAgICBkZWZhdWx0OnJldHVybiBhO319ZnVuY3Rpb24gdWMoYSwgYikge3ZhciBjID0gYS5wZW5kaW5nTGFuZXM7aWYgKDAgPT09IGMpIHJldHVybiAwO3ZhciBkID0gMCxlID0gYS5zdXNwZW5kZWRMYW5lcyxmID0gYS5waW5nZWRMYW5lcyxnID0gYyAmIDI2ODQzNTQ1NTtpZiAoMCAhPT0gZykge3ZhciBoID0gZyAmIH5lOzAgIT09IGggPyBkID0gdGMoaCkgOiAoZiAmPSBnLCAwICE9PSBmICYmIChkID0gdGMoZikpKTt9IGVsc2UgZyA9IGMgJiB+ZSwgMCAhPT0gZyA/IGQgPSB0YyhnKSA6IDAgIT09IGYgJiYgKGQgPSB0YyhmKSk7aWYgKDAgPT09IGQpIHJldHVybiAwO2lmICgwICE9PSBiICYmIGIgIT09IGQgJiYgMCA9PT0gKGIgJiBlKSAmJiAoZSA9IGQgJiAtZCwgZiA9IGIgJiAtYiwgZSA+PSBmIHx8IDE2ID09PSBlICYmIDAgIT09IChmICYgNDE5NDI0MCkpKSByZXR1cm4gYjswICE9PSAoZCAmIDQpICYmIChkIHw9IGMgJiAxNik7YiA9IGEuZW50YW5nbGVkTGFuZXM7aWYgKDAgIT09IGIpIGZvciAoYSA9IGEuZW50YW5nbGVtZW50cywgYiAmPSBkOyAwIDwgYjspIHtjID0gMzEgLSBvYyhiKSwgZSA9IDEgPDwgYywgZCB8PSBhW2NdLCBiICY9IH5lO31yZXR1cm4gZDt9CiAgICAgICAgICBmdW5jdGlvbiB2YyhhLCBiKSB7c3dpdGNoIChhKSB7Y2FzZSAxOmNhc2UgMjpjYXNlIDQ6cmV0dXJuIGIgKyAyNTA7Y2FzZSA4OmNhc2UgMTY6Y2FzZSAzMjpjYXNlIDY0OmNhc2UgMTI4OmNhc2UgMjU2OmNhc2UgNTEyOmNhc2UgMTAyNDpjYXNlIDIwNDg6Y2FzZSA0MDk2OmNhc2UgODE5MjpjYXNlIDE2Mzg0OmNhc2UgMzI3Njg6Y2FzZSA2NTUzNjpjYXNlIDEzMTA3MjpjYXNlIDI2MjE0NDpjYXNlIDUyNDI4ODpjYXNlIDEwNDg1NzY6Y2FzZSAyMDk3MTUyOnJldHVybiBiICsgNUUzO2Nhc2UgNDE5NDMwNDpjYXNlIDgzODg2MDg6Y2FzZSAxNjc3NzIxNjpjYXNlIDMzNTU0NDMyOmNhc2UgNjcxMDg4NjQ6cmV0dXJuIC0xO2Nhc2UgMTM0MjE3NzI4OmNhc2UgMjY4NDM1NDU2OmNhc2UgNTM2ODcwOTEyOmNhc2UgMTA3Mzc0MTgyNDpyZXR1cm4gLTE7ZGVmYXVsdDpyZXR1cm4gLTE7fX0KICAgICAgICAgIGZ1bmN0aW9uIHdjKGEsIGIpIHtmb3IgKHZhciBjID0gYS5zdXNwZW5kZWRMYW5lcywgZCA9IGEucGluZ2VkTGFuZXMsIGUgPSBhLmV4cGlyYXRpb25UaW1lcywgZiA9IGEucGVuZGluZ0xhbmVzOyAwIDwgZjspIHt2YXIgZyA9IDMxIC0gb2MoZiksaCA9IDEgPDwgZyxrID0gZVtnXTtpZiAoLTEgPT09IGspIHtpZiAoMCA9PT0gKGggJiBjKSB8fCAwICE9PSAoaCAmIGQpKSBlW2ddID0gdmMoaCwgYik7fSBlbHNlIGsgPD0gYiAmJiAoYS5leHBpcmVkTGFuZXMgfD0gaCk7ZiAmPSB+aDt9fWZ1bmN0aW9uIHhjKGEpIHthID0gYS5wZW5kaW5nTGFuZXMgJiAtMTA3Mzc0MTgyNTtyZXR1cm4gMCAhPT0gYSA/IGEgOiBhICYgMTA3Mzc0MTgyNCA/IDEwNzM3NDE4MjQgOiAwO31mdW5jdGlvbiB5YygpIHt2YXIgYSA9IHJjO3JjIDw8PSAxOzAgPT09IChyYyAmIDQxOTQyNDApICYmIChyYyA9IDY0KTtyZXR1cm4gYTt9ZnVuY3Rpb24gemMoYSkge2ZvciAodmFyIGIgPSBbXSwgYyA9IDA7IDMxID4gYzsgYysrKSB7Yi5wdXNoKGEpO31yZXR1cm4gYjt9CiAgICAgICAgICBmdW5jdGlvbiBBYyhhLCBiLCBjKSB7YS5wZW5kaW5nTGFuZXMgfD0gYjs1MzY4NzA5MTIgIT09IGIgJiYgKGEuc3VzcGVuZGVkTGFuZXMgPSAwLCBhLnBpbmdlZExhbmVzID0gMCk7YSA9IGEuZXZlbnRUaW1lcztiID0gMzEgLSBvYyhiKTthW2JdID0gYzt9ZnVuY3Rpb24gQmMoYSwgYikge3ZhciBjID0gYS5wZW5kaW5nTGFuZXMgJiB+YjthLnBlbmRpbmdMYW5lcyA9IGI7YS5zdXNwZW5kZWRMYW5lcyA9IDA7YS5waW5nZWRMYW5lcyA9IDA7YS5leHBpcmVkTGFuZXMgJj0gYjthLm11dGFibGVSZWFkTGFuZXMgJj0gYjthLmVudGFuZ2xlZExhbmVzICY9IGI7YiA9IGEuZW50YW5nbGVtZW50czt2YXIgZCA9IGEuZXZlbnRUaW1lcztmb3IgKGEgPSBhLmV4cGlyYXRpb25UaW1lczsgMCA8IGM7KSB7dmFyIGUgPSAzMSAtIG9jKGMpLGYgPSAxIDw8IGU7YltlXSA9IDA7ZFtlXSA9IC0xO2FbZV0gPSAtMTtjICY9IH5mO319CiAgICAgICAgICBmdW5jdGlvbiBDYyhhLCBiKSB7dmFyIGMgPSBhLmVudGFuZ2xlZExhbmVzIHw9IGI7Zm9yIChhID0gYS5lbnRhbmdsZW1lbnRzOyBjOykge3ZhciBkID0gMzEgLSBvYyhjKSxlID0gMSA8PCBkO2UgJiBiIHwgYVtkXSAmIGIgJiYgKGFbZF0gfD0gYik7YyAmPSB+ZTt9fXZhciBDID0gMDtmdW5jdGlvbiBEYyhhKSB7YSAmPSAtYTtyZXR1cm4gMSA8IGEgPyA0IDwgYSA/IDAgIT09IChhICYgMjY4NDM1NDU1KSA/IDE2IDogNTM2ODcwOTEyIDogNCA6IDE7fXZhciBFYyxGYyxHYyxIYyxJYyxKYyA9ICExLEtjID0gW10sTGMgPSBudWxsLE1jID0gbnVsbCxOYyA9IG51bGwsT2MgPSBuZXcgTWFwKCksUGMgPSBuZXcgTWFwKCksUWMgPSBbXSxSYyA9ICJtb3VzZWRvd24gbW91c2V1cCB0b3VjaGNhbmNlbCB0b3VjaGVuZCB0b3VjaHN0YXJ0IGF1eGNsaWNrIGRibGNsaWNrIHBvaW50ZXJjYW5jZWwgcG9pbnRlcmRvd24gcG9pbnRlcnVwIGRyYWdlbmQgZHJhZ3N0YXJ0IGRyb3AgY29tcG9zaXRpb25lbmQgY29tcG9zaXRpb25zdGFydCBrZXlkb3duIGtleXByZXNzIGtleXVwIGlucHV0IHRleHRJbnB1dCBjb3B5IGN1dCBwYXN0ZSBjbGljayBjaGFuZ2UgY29udGV4dG1lbnUgcmVzZXQgc3VibWl0Ii5zcGxpdCgiICIpOwogICAgICAgICAgZnVuY3Rpb24gU2MoYSwgYikge3N3aXRjaCAoYSkge2Nhc2UgImZvY3VzaW4iOmNhc2UgImZvY3Vzb3V0IjpMYyA9IG51bGw7YnJlYWs7Y2FzZSAiZHJhZ2VudGVyIjpjYXNlICJkcmFnbGVhdmUiOk1jID0gbnVsbDticmVhaztjYXNlICJtb3VzZW92ZXIiOmNhc2UgIm1vdXNlb3V0IjpOYyA9IG51bGw7YnJlYWs7Y2FzZSAicG9pbnRlcm92ZXIiOmNhc2UgInBvaW50ZXJvdXQiOk9jLmRlbGV0ZShiLnBvaW50ZXJJZCk7YnJlYWs7Y2FzZSAiZ290cG9pbnRlcmNhcHR1cmUiOmNhc2UgImxvc3Rwb2ludGVyY2FwdHVyZSI6UGMuZGVsZXRlKGIucG9pbnRlcklkKTt9fQogICAgICAgICAgZnVuY3Rpb24gVGMoYSwgYiwgYywgZCwgZSwgZikge2lmIChudWxsID09PSBhIHx8IGEubmF0aXZlRXZlbnQgIT09IGYpIHJldHVybiBhID0geyBibG9ja2VkT246IGIsIGRvbUV2ZW50TmFtZTogYywgZXZlbnRTeXN0ZW1GbGFnczogZCwgbmF0aXZlRXZlbnQ6IGYsIHRhcmdldENvbnRhaW5lcnM6IFtlXSB9LCBudWxsICE9PSBiICYmIChiID0gQ2IoYiksIG51bGwgIT09IGIgJiYgRmMoYikpLCBhO2EuZXZlbnRTeXN0ZW1GbGFncyB8PSBkO2IgPSBhLnRhcmdldENvbnRhaW5lcnM7bnVsbCAhPT0gZSAmJiAtMSA9PT0gYi5pbmRleE9mKGUpICYmIGIucHVzaChlKTtyZXR1cm4gYTt9CiAgICAgICAgICBmdW5jdGlvbiBVYyhhLCBiLCBjLCBkLCBlKSB7c3dpdGNoIChiKSB7Y2FzZSAiZm9jdXNpbiI6cmV0dXJuIExjID0gVGMoTGMsIGEsIGIsIGMsIGQsIGUpLCAhMDtjYXNlICJkcmFnZW50ZXIiOnJldHVybiBNYyA9IFRjKE1jLCBhLCBiLCBjLCBkLCBlKSwgITA7Y2FzZSAibW91c2VvdmVyIjpyZXR1cm4gTmMgPSBUYyhOYywgYSwgYiwgYywgZCwgZSksICEwO2Nhc2UgInBvaW50ZXJvdmVyIjp2YXIgZiA9IGUucG9pbnRlcklkO09jLnNldChmLCBUYyhPYy5nZXQoZikgfHwgbnVsbCwgYSwgYiwgYywgZCwgZSkpO3JldHVybiAhMDtjYXNlICJnb3Rwb2ludGVyY2FwdHVyZSI6cmV0dXJuIGYgPSBlLnBvaW50ZXJJZCwgUGMuc2V0KGYsIFRjKFBjLmdldChmKSB8fCBudWxsLCBhLCBiLCBjLCBkLCBlKSksICEwO31yZXR1cm4gITE7fQogICAgICAgICAgZnVuY3Rpb24gVmMoYSkge3ZhciBiID0gV2MoYS50YXJnZXQpO2lmIChudWxsICE9PSBiKSB7dmFyIGMgPSBWYihiKTtpZiAobnVsbCAhPT0gYykgaWYgKGIgPSBjLnRhZywgMTMgPT09IGIpIHtpZiAoYiA9IFdiKGMpLCBudWxsICE9PSBiKSB7YS5ibG9ja2VkT24gPSBiO0ljKGEucHJpb3JpdHksIGZ1bmN0aW9uICgpIHtHYyhjKTt9KTtyZXR1cm47fX0gZWxzZSBpZiAoMyA9PT0gYiAmJiBjLnN0YXRlTm9kZS5jdXJyZW50Lm1lbW9pemVkU3RhdGUuaXNEZWh5ZHJhdGVkKSB7YS5ibG9ja2VkT24gPSAzID09PSBjLnRhZyA/IGMuc3RhdGVOb2RlLmNvbnRhaW5lckluZm8gOiBudWxsO3JldHVybjt9fWEuYmxvY2tlZE9uID0gbnVsbDt9CiAgICAgICAgICBmdW5jdGlvbiBYYyhhKSB7aWYgKG51bGwgIT09IGEuYmxvY2tlZE9uKSByZXR1cm4gITE7Zm9yICh2YXIgYiA9IGEudGFyZ2V0Q29udGFpbmVyczsgMCA8IGIubGVuZ3RoOykge3ZhciBjID0gWWMoYS5kb21FdmVudE5hbWUsIGEuZXZlbnRTeXN0ZW1GbGFncywgYlswXSwgYS5uYXRpdmVFdmVudCk7aWYgKG51bGwgPT09IGMpIHtjID0gYS5uYXRpdmVFdmVudDt2YXIgZCA9IG5ldyBjLmNvbnN0cnVjdG9yKGMudHlwZSwgYyk7d2IgPSBkO2MudGFyZ2V0LmRpc3BhdGNoRXZlbnQoZCk7d2IgPSBudWxsO30gZWxzZSByZXR1cm4gYiA9IENiKGMpLCBudWxsICE9PSBiICYmIEZjKGIpLCBhLmJsb2NrZWRPbiA9IGMsICExO2Iuc2hpZnQoKTt9cmV0dXJuICEwO31mdW5jdGlvbiBaYyhhLCBiLCBjKSB7WGMoYSkgJiYgYy5kZWxldGUoYik7fWZ1bmN0aW9uICRjKCkge0pjID0gITE7bnVsbCAhPT0gTGMgJiYgWGMoTGMpICYmIChMYyA9IG51bGwpO251bGwgIT09IE1jICYmIFhjKE1jKSAmJiAoTWMgPSBudWxsKTtudWxsICE9PSBOYyAmJiBYYyhOYykgJiYgKE5jID0gbnVsbCk7T2MuZm9yRWFjaChaYyk7UGMuZm9yRWFjaChaYyk7fQogICAgICAgICAgZnVuY3Rpb24gYWQoYSwgYikge2EuYmxvY2tlZE9uID09PSBiICYmIChhLmJsb2NrZWRPbiA9IG51bGwsIEpjIHx8IChKYyA9ICEwLCBjYS51bnN0YWJsZV9zY2hlZHVsZUNhbGxiYWNrKGNhLnVuc3RhYmxlX05vcm1hbFByaW9yaXR5LCAkYykpKTt9CiAgICAgICAgICBmdW5jdGlvbiBiZChhKSB7ZnVuY3Rpb24gYihiKSB7cmV0dXJuIGFkKGIsIGEpO31pZiAoMCA8IEtjLmxlbmd0aCkge2FkKEtjWzBdLCBhKTtmb3IgKHZhciBjID0gMTsgYyA8IEtjLmxlbmd0aDsgYysrKSB7dmFyIGQgPSBLY1tjXTtkLmJsb2NrZWRPbiA9PT0gYSAmJiAoZC5ibG9ja2VkT24gPSBudWxsKTt9fW51bGwgIT09IExjICYmIGFkKExjLCBhKTtudWxsICE9PSBNYyAmJiBhZChNYywgYSk7bnVsbCAhPT0gTmMgJiYgYWQoTmMsIGEpO09jLmZvckVhY2goYik7UGMuZm9yRWFjaChiKTtmb3IgKGMgPSAwOyBjIDwgUWMubGVuZ3RoOyBjKyspIHtkID0gUWNbY10sIGQuYmxvY2tlZE9uID09PSBhICYmIChkLmJsb2NrZWRPbiA9IG51bGwpO31mb3IgKDsgMCA8IFFjLmxlbmd0aCAmJiAoYyA9IFFjWzBdLCBudWxsID09PSBjLmJsb2NrZWRPbik7KSB7VmMoYyksIG51bGwgPT09IGMuYmxvY2tlZE9uICYmIFFjLnNoaWZ0KCk7fX12YXIgY2QgPSB1YS5SZWFjdEN1cnJlbnRCYXRjaENvbmZpZyxkZCA9ICEwOwogICAgICAgICAgZnVuY3Rpb24gZWQoYSwgYiwgYywgZCkge3ZhciBlID0gQyxmID0gY2QudHJhbnNpdGlvbjtjZC50cmFuc2l0aW9uID0gbnVsbDt0cnkge0MgPSAxLCBmZChhLCBiLCBjLCBkKTt9IGZpbmFsbHkge0MgPSBlLCBjZC50cmFuc2l0aW9uID0gZjt9fWZ1bmN0aW9uIGdkKGEsIGIsIGMsIGQpIHt2YXIgZSA9IEMsZiA9IGNkLnRyYW5zaXRpb247Y2QudHJhbnNpdGlvbiA9IG51bGw7dHJ5IHtDID0gNCwgZmQoYSwgYiwgYywgZCk7fSBmaW5hbGx5IHtDID0gZSwgY2QudHJhbnNpdGlvbiA9IGY7fX0KICAgICAgICAgIGZ1bmN0aW9uIGZkKGEsIGIsIGMsIGQpIHtpZiAoZGQpIHt2YXIgZSA9IFljKGEsIGIsIGMsIGQpO2lmIChudWxsID09PSBlKSBoZChhLCBiLCBkLCBpZCwgYyksIFNjKGEsIGQpO2Vsc2UgaWYgKFVjKGUsIGEsIGIsIGMsIGQpKSBkLnN0b3BQcm9wYWdhdGlvbigpO2Vsc2UgaWYgKFNjKGEsIGQpLCBiICYgNCAmJiAtMSA8IFJjLmluZGV4T2YoYSkpIHtmb3IgKDsgbnVsbCAhPT0gZTspIHt2YXIgZiA9IENiKGUpO251bGwgIT09IGYgJiYgRWMoZik7ZiA9IFljKGEsIGIsIGMsIGQpO251bGwgPT09IGYgJiYgaGQoYSwgYiwgZCwgaWQsIGMpO2lmIChmID09PSBlKSBicmVhaztlID0gZjt9bnVsbCAhPT0gZSAmJiBkLnN0b3BQcm9wYWdhdGlvbigpO30gZWxzZSBoZChhLCBiLCBkLCBudWxsLCBjKTt9fXZhciBpZCA9IG51bGw7CiAgICAgICAgICBmdW5jdGlvbiBZYyhhLCBiLCBjLCBkKSB7aWQgPSBudWxsO2EgPSB4YihkKTthID0gV2MoYSk7aWYgKG51bGwgIT09IGEpIGlmIChiID0gVmIoYSksIG51bGwgPT09IGIpIGEgPSBudWxsO2Vsc2UgaWYgKGMgPSBiLnRhZywgMTMgPT09IGMpIHthID0gV2IoYik7aWYgKG51bGwgIT09IGEpIHJldHVybiBhO2EgPSBudWxsO30gZWxzZSBpZiAoMyA9PT0gYykge2lmIChiLnN0YXRlTm9kZS5jdXJyZW50Lm1lbW9pemVkU3RhdGUuaXNEZWh5ZHJhdGVkKSByZXR1cm4gMyA9PT0gYi50YWcgPyBiLnN0YXRlTm9kZS5jb250YWluZXJJbmZvIDogbnVsbDthID0gbnVsbDt9IGVsc2UgYiAhPT0gYSAmJiAoYSA9IG51bGwpO2lkID0gYTtyZXR1cm4gbnVsbDt9CiAgICAgICAgICBmdW5jdGlvbiBqZChhKSB7c3dpdGNoIChhKSB7Y2FzZSAiY2FuY2VsIjpjYXNlICJjbGljayI6Y2FzZSAiY2xvc2UiOmNhc2UgImNvbnRleHRtZW51IjpjYXNlICJjb3B5IjpjYXNlICJjdXQiOmNhc2UgImF1eGNsaWNrIjpjYXNlICJkYmxjbGljayI6Y2FzZSAiZHJhZ2VuZCI6Y2FzZSAiZHJhZ3N0YXJ0IjpjYXNlICJkcm9wIjpjYXNlICJmb2N1c2luIjpjYXNlICJmb2N1c291dCI6Y2FzZSAiaW5wdXQiOmNhc2UgImludmFsaWQiOmNhc2UgImtleWRvd24iOmNhc2UgImtleXByZXNzIjpjYXNlICJrZXl1cCI6Y2FzZSAibW91c2Vkb3duIjpjYXNlICJtb3VzZXVwIjpjYXNlICJwYXN0ZSI6Y2FzZSAicGF1c2UiOmNhc2UgInBsYXkiOmNhc2UgInBvaW50ZXJjYW5jZWwiOmNhc2UgInBvaW50ZXJkb3duIjpjYXNlICJwb2ludGVydXAiOmNhc2UgInJhdGVjaGFuZ2UiOmNhc2UgInJlc2V0IjpjYXNlICJyZXNpemUiOmNhc2UgInNlZWtlZCI6Y2FzZSAic3VibWl0IjpjYXNlICJ0b3VjaGNhbmNlbCI6Y2FzZSAidG91Y2hlbmQiOmNhc2UgInRvdWNoc3RhcnQiOmNhc2UgInZvbHVtZWNoYW5nZSI6Y2FzZSAiY2hhbmdlIjpjYXNlICJzZWxlY3Rpb25jaGFuZ2UiOmNhc2UgInRleHRJbnB1dCI6Y2FzZSAiY29tcG9zaXRpb25zdGFydCI6Y2FzZSAiY29tcG9zaXRpb25lbmQiOmNhc2UgImNvbXBvc2l0aW9udXBkYXRlIjpjYXNlICJiZWZvcmVibHVyIjpjYXNlICJhZnRlcmJsdXIiOmNhc2UgImJlZm9yZWlucHV0IjpjYXNlICJibHVyIjpjYXNlICJmdWxsc2NyZWVuY2hhbmdlIjpjYXNlICJmb2N1cyI6Y2FzZSAiaGFzaGNoYW5nZSI6Y2FzZSAicG9wc3RhdGUiOmNhc2UgInNlbGVjdCI6Y2FzZSAic2VsZWN0c3RhcnQiOnJldHVybiAxO2Nhc2UgImRyYWciOmNhc2UgImRyYWdlbnRlciI6Y2FzZSAiZHJhZ2V4aXQiOmNhc2UgImRyYWdsZWF2ZSI6Y2FzZSAiZHJhZ292ZXIiOmNhc2UgIm1vdXNlbW92ZSI6Y2FzZSAibW91c2VvdXQiOmNhc2UgIm1vdXNlb3ZlciI6Y2FzZSAicG9pbnRlcm1vdmUiOmNhc2UgInBvaW50ZXJvdXQiOmNhc2UgInBvaW50ZXJvdmVyIjpjYXNlICJzY3JvbGwiOmNhc2UgInRvZ2dsZSI6Y2FzZSAidG91Y2htb3ZlIjpjYXNlICJ3aGVlbCI6Y2FzZSAibW91c2VlbnRlciI6Y2FzZSAibW91c2VsZWF2ZSI6Y2FzZSAicG9pbnRlcmVudGVyIjpjYXNlICJwb2ludGVybGVhdmUiOnJldHVybiA0OwogICAgICAgICAgICAgIGNhc2UgIm1lc3NhZ2UiOnN3aXRjaCAoZWMoKSkge2Nhc2UgZmM6cmV0dXJuIDE7Y2FzZSBnYzpyZXR1cm4gNDtjYXNlIGhjOmNhc2UgaWM6cmV0dXJuIDE2O2Nhc2UgamM6cmV0dXJuIDUzNjg3MDkxMjtkZWZhdWx0OnJldHVybiAxNjt9ZGVmYXVsdDpyZXR1cm4gMTY7fX12YXIga2QgPSBudWxsLGxkID0gbnVsbCxtZCA9IG51bGw7ZnVuY3Rpb24gbmQoKSB7aWYgKG1kKSByZXR1cm4gbWQ7dmFyIGEsYiA9IGxkLGMgPSBiLmxlbmd0aCxkLGUgPSAidmFsdWUiIGluIGtkID8ga2QudmFsdWUgOiBrZC50ZXh0Q29udGVudCxmID0gZS5sZW5ndGg7Zm9yIChhID0gMDsgYSA8IGMgJiYgYlthXSA9PT0gZVthXTsgYSsrKSB7O312YXIgZyA9IGMgLSBhO2ZvciAoZCA9IDE7IGQgPD0gZyAmJiBiW2MgLSBkXSA9PT0gZVtmIC0gZF07IGQrKykgezt9cmV0dXJuIG1kID0gZS5zbGljZShhLCAxIDwgZCA/IDEgLSBkIDogdm9pZCAwKTt9CiAgICAgICAgICBmdW5jdGlvbiBvZChhKSB7dmFyIGIgPSBhLmtleUNvZGU7ImNoYXJDb2RlIiBpbiBhID8gKGEgPSBhLmNoYXJDb2RlLCAwID09PSBhICYmIDEzID09PSBiICYmIChhID0gMTMpKSA6IGEgPSBiOzEwID09PSBhICYmIChhID0gMTMpO3JldHVybiAzMiA8PSBhIHx8IDEzID09PSBhID8gYSA6IDA7fWZ1bmN0aW9uIHBkKCkge3JldHVybiAhMDt9ZnVuY3Rpb24gcWQoKSB7cmV0dXJuICExO30KICAgICAgICAgIGZ1bmN0aW9uIHJkKGEpIHtmdW5jdGlvbiBiKGIsIGQsIGUsIGYsIGcpIHt0aGlzLl9yZWFjdE5hbWUgPSBiO3RoaXMuX3RhcmdldEluc3QgPSBlO3RoaXMudHlwZSA9IGQ7dGhpcy5uYXRpdmVFdmVudCA9IGY7dGhpcy50YXJnZXQgPSBnO3RoaXMuY3VycmVudFRhcmdldCA9IG51bGw7Zm9yICh2YXIgYyBpbiBhKSB7YS5oYXNPd25Qcm9wZXJ0eShjKSAmJiAoYiA9IGFbY10sIHRoaXNbY10gPSBiID8gYihmKSA6IGZbY10pO310aGlzLmlzRGVmYXVsdFByZXZlbnRlZCA9IChudWxsICE9IGYuZGVmYXVsdFByZXZlbnRlZCA/IGYuZGVmYXVsdFByZXZlbnRlZCA6ICExID09PSBmLnJldHVyblZhbHVlKSA/IHBkIDogcWQ7dGhpcy5pc1Byb3BhZ2F0aW9uU3RvcHBlZCA9IHFkO3JldHVybiB0aGlzO31BKGIucHJvdG90eXBlLCB7IHByZXZlbnREZWZhdWx0OiBmdW5jdGlvbiBwcmV2ZW50RGVmYXVsdCgpIHt0aGlzLmRlZmF1bHRQcmV2ZW50ZWQgPSAhMDt2YXIgYSA9IHRoaXMubmF0aXZlRXZlbnQ7YSAmJiAoYS5wcmV2ZW50RGVmYXVsdCA/IGEucHJldmVudERlZmF1bHQoKSA6ICJ1bmtub3duIiAhPT0gdHlwZW9mIGEucmV0dXJuVmFsdWUgJiYgKAogICAgICAgICAgICAgICAgYS5yZXR1cm5WYWx1ZSA9ICExKSwgdGhpcy5pc0RlZmF1bHRQcmV2ZW50ZWQgPSBwZCk7fSwgc3RvcFByb3BhZ2F0aW9uOiBmdW5jdGlvbiBzdG9wUHJvcGFnYXRpb24oKSB7dmFyIGEgPSB0aGlzLm5hdGl2ZUV2ZW50O2EgJiYgKGEuc3RvcFByb3BhZ2F0aW9uID8gYS5zdG9wUHJvcGFnYXRpb24oKSA6ICJ1bmtub3duIiAhPT0gdHlwZW9mIGEuY2FuY2VsQnViYmxlICYmIChhLmNhbmNlbEJ1YmJsZSA9ICEwKSwgdGhpcy5pc1Byb3BhZ2F0aW9uU3RvcHBlZCA9IHBkKTt9LCBwZXJzaXN0OiBmdW5jdGlvbiBwZXJzaXN0KCkge30sIGlzUGVyc2lzdGVudDogcGQgfSk7cmV0dXJuIGI7fQogICAgICAgICAgdmFyIHNkID0geyBldmVudFBoYXNlOiAwLCBidWJibGVzOiAwLCBjYW5jZWxhYmxlOiAwLCB0aW1lU3RhbXA6IGZ1bmN0aW9uIHRpbWVTdGFtcChhKSB7cmV0dXJuIGEudGltZVN0YW1wIHx8IERhdGUubm93KCk7fSwgZGVmYXVsdFByZXZlbnRlZDogMCwgaXNUcnVzdGVkOiAwIH0sdGQgPSByZChzZCksdWQgPSBBKHt9LCBzZCwgeyB2aWV3OiAwLCBkZXRhaWw6IDAgfSksdmQgPSByZCh1ZCksd2QseGQseWQsQWQgPSBBKHt9LCB1ZCwgeyBzY3JlZW5YOiAwLCBzY3JlZW5ZOiAwLCBjbGllbnRYOiAwLCBjbGllbnRZOiAwLCBwYWdlWDogMCwgcGFnZVk6IDAsIGN0cmxLZXk6IDAsIHNoaWZ0S2V5OiAwLCBhbHRLZXk6IDAsIG1ldGFLZXk6IDAsIGdldE1vZGlmaWVyU3RhdGU6IHpkLCBidXR0b246IDAsIGJ1dHRvbnM6IDAsIHJlbGF0ZWRUYXJnZXQ6IGZ1bmN0aW9uIHJlbGF0ZWRUYXJnZXQoYSkge3JldHVybiB2b2lkIDAgPT09IGEucmVsYXRlZFRhcmdldCA/IGEuZnJvbUVsZW1lbnQgPT09IGEuc3JjRWxlbWVudCA/IGEudG9FbGVtZW50IDogYS5mcm9tRWxlbWVudCA6IGEucmVsYXRlZFRhcmdldDt9LCBtb3ZlbWVudFg6IGZ1bmN0aW9uIG1vdmVtZW50WChhKSB7aWYgKCJtb3ZlbWVudFgiIGluCiAgICAgICAgICAgICAgICBhKSByZXR1cm4gYS5tb3ZlbWVudFg7YSAhPT0geWQgJiYgKHlkICYmICJtb3VzZW1vdmUiID09PSBhLnR5cGUgPyAod2QgPSBhLnNjcmVlblggLSB5ZC5zY3JlZW5YLCB4ZCA9IGEuc2NyZWVuWSAtIHlkLnNjcmVlblkpIDogeGQgPSB3ZCA9IDAsIHlkID0gYSk7cmV0dXJuIHdkO30sIG1vdmVtZW50WTogZnVuY3Rpb24gbW92ZW1lbnRZKGEpIHtyZXR1cm4gIm1vdmVtZW50WSIgaW4gYSA/IGEubW92ZW1lbnRZIDogeGQ7fSB9KSxCZCA9IHJkKEFkKSxDZCA9IEEoe30sIEFkLCB7IGRhdGFUcmFuc2ZlcjogMCB9KSxEZCA9IHJkKENkKSxFZCA9IEEoe30sIHVkLCB7IHJlbGF0ZWRUYXJnZXQ6IDAgfSksRmQgPSByZChFZCksR2QgPSBBKHt9LCBzZCwgeyBhbmltYXRpb25OYW1lOiAwLCBlbGFwc2VkVGltZTogMCwgcHNldWRvRWxlbWVudDogMCB9KSxIZCA9IHJkKEdkKSxJZCA9IEEoe30sIHNkLCB7IGNsaXBib2FyZERhdGE6IGZ1bmN0aW9uIGNsaXBib2FyZERhdGEoYSkge3JldHVybiAiY2xpcGJvYXJkRGF0YSIgaW4gYSA/IGEuY2xpcGJvYXJkRGF0YSA6IHdpbmRvdy5jbGlwYm9hcmREYXRhO30gfSksSmQgPSByZChJZCksS2QgPSBBKHt9LCBzZCwgeyBkYXRhOiAwIH0pLExkID0gcmQoS2QpLE1kID0geyBFc2M6ICJFc2NhcGUiLAogICAgICAgICAgICAgIFNwYWNlYmFyOiAiICIsIExlZnQ6ICJBcnJvd0xlZnQiLCBVcDogIkFycm93VXAiLCBSaWdodDogIkFycm93UmlnaHQiLCBEb3duOiAiQXJyb3dEb3duIiwgRGVsOiAiRGVsZXRlIiwgV2luOiAiT1MiLCBNZW51OiAiQ29udGV4dE1lbnUiLCBBcHBzOiAiQ29udGV4dE1lbnUiLCBTY3JvbGw6ICJTY3JvbGxMb2NrIiwgTW96UHJpbnRhYmxlS2V5OiAiVW5pZGVudGlmaWVkIiB9LE5kID0geyA4OiAiQmFja3NwYWNlIiwgOTogIlRhYiIsIDEyOiAiQ2xlYXIiLCAxMzogIkVudGVyIiwgMTY6ICJTaGlmdCIsIDE3OiAiQ29udHJvbCIsIDE4OiAiQWx0IiwgMTk6ICJQYXVzZSIsIDIwOiAiQ2Fwc0xvY2siLCAyNzogIkVzY2FwZSIsIDMyOiAiICIsIDMzOiAiUGFnZVVwIiwgMzQ6ICJQYWdlRG93biIsIDM1OiAiRW5kIiwgMzY6ICJIb21lIiwgMzc6ICJBcnJvd0xlZnQiLCAzODogIkFycm93VXAiLCAzOTogIkFycm93UmlnaHQiLCA0MDogIkFycm93RG93biIsIDQ1OiAiSW5zZXJ0IiwgNDY6ICJEZWxldGUiLCAxMTI6ICJGMSIsIDExMzogIkYyIiwgMTE0OiAiRjMiLCAxMTU6ICJGNCIsIDExNjogIkY1IiwgMTE3OiAiRjYiLCAxMTg6ICJGNyIsCiAgICAgICAgICAgICAgMTE5OiAiRjgiLCAxMjA6ICJGOSIsIDEyMTogIkYxMCIsIDEyMjogIkYxMSIsIDEyMzogIkYxMiIsIDE0NDogIk51bUxvY2siLCAxNDU6ICJTY3JvbGxMb2NrIiwgMjI0OiAiTWV0YSIgfSxPZCA9IHsgQWx0OiAiYWx0S2V5IiwgQ29udHJvbDogImN0cmxLZXkiLCBNZXRhOiAibWV0YUtleSIsIFNoaWZ0OiAic2hpZnRLZXkiIH07ZnVuY3Rpb24gUGQoYSkge3ZhciBiID0gdGhpcy5uYXRpdmVFdmVudDtyZXR1cm4gYi5nZXRNb2RpZmllclN0YXRlID8gYi5nZXRNb2RpZmllclN0YXRlKGEpIDogKGEgPSBPZFthXSkgPyAhIWJbYV0gOiAhMTt9ZnVuY3Rpb24gemQoKSB7cmV0dXJuIFBkO30KICAgICAgICAgIHZhciBRZCA9IEEoe30sIHVkLCB7IGtleTogZnVuY3Rpb24ga2V5KGEpIHtpZiAoYS5rZXkpIHt2YXIgYiA9IE1kW2Eua2V5XSB8fCBhLmtleTtpZiAoIlVuaWRlbnRpZmllZCIgIT09IGIpIHJldHVybiBiO31yZXR1cm4gImtleXByZXNzIiA9PT0gYS50eXBlID8gKGEgPSBvZChhKSwgMTMgPT09IGEgPyAiRW50ZXIiIDogU3RyaW5nLmZyb21DaGFyQ29kZShhKSkgOiAia2V5ZG93biIgPT09IGEudHlwZSB8fCAia2V5dXAiID09PSBhLnR5cGUgPyBOZFthLmtleUNvZGVdIHx8ICJVbmlkZW50aWZpZWQiIDogIiI7fSwgY29kZTogMCwgbG9jYXRpb246IDAsIGN0cmxLZXk6IDAsIHNoaWZ0S2V5OiAwLCBhbHRLZXk6IDAsIG1ldGFLZXk6IDAsIHJlcGVhdDogMCwgbG9jYWxlOiAwLCBnZXRNb2RpZmllclN0YXRlOiB6ZCwgY2hhckNvZGU6IGZ1bmN0aW9uIGNoYXJDb2RlKGEpIHtyZXR1cm4gImtleXByZXNzIiA9PT0gYS50eXBlID8gb2QoYSkgOiAwO30sIGtleUNvZGU6IGZ1bmN0aW9uIGtleUNvZGUoYSkge3JldHVybiAia2V5ZG93biIgPT09IGEudHlwZSB8fCAia2V5dXAiID09PSBhLnR5cGUgPyBhLmtleUNvZGUgOiAwO30sIHdoaWNoOiBmdW5jdGlvbiB3aGljaChhKSB7cmV0dXJuICJrZXlwcmVzcyIgPT09CiAgICAgICAgICAgICAgICBhLnR5cGUgPyBvZChhKSA6ICJrZXlkb3duIiA9PT0gYS50eXBlIHx8ICJrZXl1cCIgPT09IGEudHlwZSA/IGEua2V5Q29kZSA6IDA7fSB9KSxSZCA9IHJkKFFkKSxTZCA9IEEoe30sIEFkLCB7IHBvaW50ZXJJZDogMCwgd2lkdGg6IDAsIGhlaWdodDogMCwgcHJlc3N1cmU6IDAsIHRhbmdlbnRpYWxQcmVzc3VyZTogMCwgdGlsdFg6IDAsIHRpbHRZOiAwLCB0d2lzdDogMCwgcG9pbnRlclR5cGU6IDAsIGlzUHJpbWFyeTogMCB9KSxUZCA9IHJkKFNkKSxVZCA9IEEoe30sIHVkLCB7IHRvdWNoZXM6IDAsIHRhcmdldFRvdWNoZXM6IDAsIGNoYW5nZWRUb3VjaGVzOiAwLCBhbHRLZXk6IDAsIG1ldGFLZXk6IDAsIGN0cmxLZXk6IDAsIHNoaWZ0S2V5OiAwLCBnZXRNb2RpZmllclN0YXRlOiB6ZCB9KSxWZCA9IHJkKFVkKSxXZCA9IEEoe30sIHNkLCB7IHByb3BlcnR5TmFtZTogMCwgZWxhcHNlZFRpbWU6IDAsIHBzZXVkb0VsZW1lbnQ6IDAgfSksWGQgPSByZChXZCksWWQgPSBBKHt9LCBBZCwgeyBkZWx0YVg6IGZ1bmN0aW9uIGRlbHRhWChhKSB7cmV0dXJuICJkZWx0YVgiIGluIGEgPyBhLmRlbHRhWCA6ICJ3aGVlbERlbHRhWCIgaW4gYSA/IC1hLndoZWVsRGVsdGFYIDogMDt9LAogICAgICAgICAgICAgIGRlbHRhWTogZnVuY3Rpb24gZGVsdGFZKGEpIHtyZXR1cm4gImRlbHRhWSIgaW4gYSA/IGEuZGVsdGFZIDogIndoZWVsRGVsdGFZIiBpbiBhID8gLWEud2hlZWxEZWx0YVkgOiAid2hlZWxEZWx0YSIgaW4gYSA/IC1hLndoZWVsRGVsdGEgOiAwO30sIGRlbHRhWjogMCwgZGVsdGFNb2RlOiAwIH0pLFpkID0gcmQoWWQpLCRkID0gWzksIDEzLCAyNywgMzJdLGFlID0gaWEgJiYgIkNvbXBvc2l0aW9uRXZlbnQiIGluIHdpbmRvdyxiZSA9IG51bGw7aWEgJiYgImRvY3VtZW50TW9kZSIgaW4gZG9jdW1lbnQgJiYgKGJlID0gZG9jdW1lbnQuZG9jdW1lbnRNb2RlKTt2YXIgY2UgPSBpYSAmJiAiVGV4dEV2ZW50IiBpbiB3aW5kb3cgJiYgIWJlLGRlID0gaWEgJiYgKCFhZSB8fCBiZSAmJiA4IDwgYmUgJiYgMTEgPj0gYmUpLGVlID0gU3RyaW5nLmZyb21DaGFyQ29kZSgzMiksZmUgPSAhMTsKICAgICAgICAgIGZ1bmN0aW9uIGdlKGEsIGIpIHtzd2l0Y2ggKGEpIHtjYXNlICJrZXl1cCI6cmV0dXJuIC0xICE9PSAkZC5pbmRleE9mKGIua2V5Q29kZSk7Y2FzZSAia2V5ZG93biI6cmV0dXJuIDIyOSAhPT0gYi5rZXlDb2RlO2Nhc2UgImtleXByZXNzIjpjYXNlICJtb3VzZWRvd24iOmNhc2UgImZvY3Vzb3V0IjpyZXR1cm4gITA7ZGVmYXVsdDpyZXR1cm4gITE7fX1mdW5jdGlvbiBoZShhKSB7YSA9IGEuZGV0YWlsO3JldHVybiAib2JqZWN0IiA9PT0gdHlwZW9mIGEgJiYgImRhdGEiIGluIGEgPyBhLmRhdGEgOiBudWxsO312YXIgaWUgPSAhMTtmdW5jdGlvbiBqZShhLCBiKSB7c3dpdGNoIChhKSB7Y2FzZSAiY29tcG9zaXRpb25lbmQiOnJldHVybiBoZShiKTtjYXNlICJrZXlwcmVzcyI6aWYgKDMyICE9PSBiLndoaWNoKSByZXR1cm4gbnVsbDtmZSA9ICEwO3JldHVybiBlZTtjYXNlICJ0ZXh0SW5wdXQiOnJldHVybiBhID0gYi5kYXRhLCBhID09PSBlZSAmJiBmZSA/IG51bGwgOiBhO2RlZmF1bHQ6cmV0dXJuIG51bGw7fX0KICAgICAgICAgIGZ1bmN0aW9uIGtlKGEsIGIpIHtpZiAoaWUpIHJldHVybiAiY29tcG9zaXRpb25lbmQiID09PSBhIHx8ICFhZSAmJiBnZShhLCBiKSA/IChhID0gbmQoKSwgbWQgPSBsZCA9IGtkID0gbnVsbCwgaWUgPSAhMSwgYSkgOiBudWxsO3N3aXRjaCAoYSkge2Nhc2UgInBhc3RlIjpyZXR1cm4gbnVsbDtjYXNlICJrZXlwcmVzcyI6aWYgKCEoYi5jdHJsS2V5IHx8IGIuYWx0S2V5IHx8IGIubWV0YUtleSkgfHwgYi5jdHJsS2V5ICYmIGIuYWx0S2V5KSB7aWYgKGIuY2hhciAmJiAxIDwgYi5jaGFyLmxlbmd0aCkgcmV0dXJuIGIuY2hhcjtpZiAoYi53aGljaCkgcmV0dXJuIFN0cmluZy5mcm9tQ2hhckNvZGUoYi53aGljaCk7fXJldHVybiBudWxsO2Nhc2UgImNvbXBvc2l0aW9uZW5kIjpyZXR1cm4gZGUgJiYgImtvIiAhPT0gYi5sb2NhbGUgPyBudWxsIDogYi5kYXRhO2RlZmF1bHQ6cmV0dXJuIG51bGw7fX0KICAgICAgICAgIHZhciBsZSA9IHsgY29sb3I6ICEwLCBkYXRlOiAhMCwgZGF0ZXRpbWU6ICEwLCAiZGF0ZXRpbWUtbG9jYWwiOiAhMCwgZW1haWw6ICEwLCBtb250aDogITAsIG51bWJlcjogITAsIHBhc3N3b3JkOiAhMCwgcmFuZ2U6ICEwLCBzZWFyY2g6ICEwLCB0ZWw6ICEwLCB0ZXh0OiAhMCwgdGltZTogITAsIHVybDogITAsIHdlZWs6ICEwIH07ZnVuY3Rpb24gbWUoYSkge3ZhciBiID0gYSAmJiBhLm5vZGVOYW1lICYmIGEubm9kZU5hbWUudG9Mb3dlckNhc2UoKTtyZXR1cm4gImlucHV0IiA9PT0gYiA/ICEhbGVbYS50eXBlXSA6ICJ0ZXh0YXJlYSIgPT09IGIgPyAhMCA6ICExO31mdW5jdGlvbiBuZShhLCBiLCBjLCBkKSB7RWIoZCk7YiA9IG9lKGIsICJvbkNoYW5nZSIpOzAgPCBiLmxlbmd0aCAmJiAoYyA9IG5ldyB0ZCgib25DaGFuZ2UiLCAiY2hhbmdlIiwgbnVsbCwgYywgZCksIGEucHVzaCh7IGV2ZW50OiBjLCBsaXN0ZW5lcnM6IGIgfSkpO312YXIgcGUgPSBudWxsLHFlID0gbnVsbDtmdW5jdGlvbiByZShhKSB7c2UoYSwgMCk7fWZ1bmN0aW9uIHRlKGEpIHt2YXIgYiA9IHVlKGEpO2lmIChXYShiKSkgcmV0dXJuIGE7fQogICAgICAgICAgZnVuY3Rpb24gdmUoYSwgYikge2lmICgiY2hhbmdlIiA9PT0gYSkgcmV0dXJuIGI7fXZhciB3ZSA9ICExO2lmIChpYSkge3ZhciB4ZTtpZiAoaWEpIHt2YXIgeWUgPSAoIm9uaW5wdXQiIGluIGRvY3VtZW50KTtpZiAoIXllKSB7dmFyIHplID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2Iik7emUuc2V0QXR0cmlidXRlKCJvbmlucHV0IiwgInJldHVybjsiKTt5ZSA9ICJmdW5jdGlvbiIgPT09IHR5cGVvZiB6ZS5vbmlucHV0O314ZSA9IHllO30gZWxzZSB4ZSA9ICExO3dlID0geGUgJiYgKCFkb2N1bWVudC5kb2N1bWVudE1vZGUgfHwgOSA8IGRvY3VtZW50LmRvY3VtZW50TW9kZSk7fWZ1bmN0aW9uIEFlKCkge3BlICYmIChwZS5kZXRhY2hFdmVudCgib25wcm9wZXJ0eWNoYW5nZSIsIEJlKSwgcWUgPSBwZSA9IG51bGwpO31mdW5jdGlvbiBCZShhKSB7aWYgKCJ2YWx1ZSIgPT09IGEucHJvcGVydHlOYW1lICYmIHRlKHFlKSkge3ZhciBiID0gW107bmUoYiwgcWUsIGEsIHhiKGEpKTtKYihyZSwgYik7fX0KICAgICAgICAgIGZ1bmN0aW9uIENlKGEsIGIsIGMpIHsiZm9jdXNpbiIgPT09IGEgPyAoQWUoKSwgcGUgPSBiLCBxZSA9IGMsIHBlLmF0dGFjaEV2ZW50KCJvbnByb3BlcnR5Y2hhbmdlIiwgQmUpKSA6ICJmb2N1c291dCIgPT09IGEgJiYgQWUoKTt9ZnVuY3Rpb24gRGUoYSkge2lmICgic2VsZWN0aW9uY2hhbmdlIiA9PT0gYSB8fCAia2V5dXAiID09PSBhIHx8ICJrZXlkb3duIiA9PT0gYSkgcmV0dXJuIHRlKHFlKTt9ZnVuY3Rpb24gRWUoYSwgYikge2lmICgiY2xpY2siID09PSBhKSByZXR1cm4gdGUoYik7fWZ1bmN0aW9uIEZlKGEsIGIpIHtpZiAoImlucHV0IiA9PT0gYSB8fCAiY2hhbmdlIiA9PT0gYSkgcmV0dXJuIHRlKGIpO31mdW5jdGlvbiBHZShhLCBiKSB7cmV0dXJuIGEgPT09IGIgJiYgKDAgIT09IGEgfHwgMSAvIGEgPT09IDEgLyBiKSB8fCBhICE9PSBhICYmIGIgIT09IGI7fXZhciBIZSA9ICJmdW5jdGlvbiIgPT09IHR5cGVvZiBPYmplY3QuaXMgPyBPYmplY3QuaXMgOiBHZTsKICAgICAgICAgIGZ1bmN0aW9uIEllKGEsIGIpIHtpZiAoSGUoYSwgYikpIHJldHVybiAhMDtpZiAoIm9iamVjdCIgIT09IHR5cGVvZiBhIHx8IG51bGwgPT09IGEgfHwgIm9iamVjdCIgIT09IHR5cGVvZiBiIHx8IG51bGwgPT09IGIpIHJldHVybiAhMTt2YXIgYyA9IE9iamVjdC5rZXlzKGEpLGQgPSBPYmplY3Qua2V5cyhiKTtpZiAoYy5sZW5ndGggIT09IGQubGVuZ3RoKSByZXR1cm4gITE7Zm9yIChkID0gMDsgZCA8IGMubGVuZ3RoOyBkKyspIHt2YXIgZSA9IGNbZF07aWYgKCFqYS5jYWxsKGIsIGUpIHx8ICFIZShhW2VdLCBiW2VdKSkgcmV0dXJuICExO31yZXR1cm4gITA7fWZ1bmN0aW9uIEplKGEpIHtmb3IgKDsgYSAmJiBhLmZpcnN0Q2hpbGQ7KSB7YSA9IGEuZmlyc3RDaGlsZDt9cmV0dXJuIGE7fQogICAgICAgICAgZnVuY3Rpb24gS2UoYSwgYikge3ZhciBjID0gSmUoYSk7YSA9IDA7Zm9yICh2YXIgZDsgYzspIHtpZiAoMyA9PT0gYy5ub2RlVHlwZSkge2QgPSBhICsgYy50ZXh0Q29udGVudC5sZW5ndGg7aWYgKGEgPD0gYiAmJiBkID49IGIpIHJldHVybiB7IG5vZGU6IGMsIG9mZnNldDogYiAtIGEgfTthID0gZDt9YToge2ZvciAoOyBjOykge2lmIChjLm5leHRTaWJsaW5nKSB7YyA9IGMubmV4dFNpYmxpbmc7YnJlYWsgYTt9YyA9IGMucGFyZW50Tm9kZTt9YyA9IHZvaWQgMDt9YyA9IEplKGMpO319ZnVuY3Rpb24gTGUoYSwgYikge3JldHVybiBhICYmIGIgPyBhID09PSBiID8gITAgOiBhICYmIDMgPT09IGEubm9kZVR5cGUgPyAhMSA6IGIgJiYgMyA9PT0gYi5ub2RlVHlwZSA/IExlKGEsIGIucGFyZW50Tm9kZSkgOiAiY29udGFpbnMiIGluIGEgPyBhLmNvbnRhaW5zKGIpIDogYS5jb21wYXJlRG9jdW1lbnRQb3NpdGlvbiA/ICEhKGEuY29tcGFyZURvY3VtZW50UG9zaXRpb24oYikgJiAxNikgOiAhMSA6ICExO30KICAgICAgICAgIGZ1bmN0aW9uIE1lKCkge2ZvciAodmFyIGEgPSB3aW5kb3csIGIgPSBYYSgpOyBiIGluc3RhbmNlb2YgYS5IVE1MSUZyYW1lRWxlbWVudDspIHt0cnkge3ZhciBjID0gInN0cmluZyIgPT09IHR5cGVvZiBiLmNvbnRlbnRXaW5kb3cubG9jYXRpb24uaHJlZjt9IGNhdGNoIChkKSB7YyA9ICExO31pZiAoYykgYSA9IGIuY29udGVudFdpbmRvdztlbHNlIGJyZWFrO2IgPSBYYShhLmRvY3VtZW50KTt9cmV0dXJuIGI7fWZ1bmN0aW9uIE5lKGEpIHt2YXIgYiA9IGEgJiYgYS5ub2RlTmFtZSAmJiBhLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCk7cmV0dXJuIGIgJiYgKCJpbnB1dCIgPT09IGIgJiYgKCJ0ZXh0IiA9PT0gYS50eXBlIHx8ICJzZWFyY2giID09PSBhLnR5cGUgfHwgInRlbCIgPT09IGEudHlwZSB8fCAidXJsIiA9PT0gYS50eXBlIHx8ICJwYXNzd29yZCIgPT09IGEudHlwZSkgfHwgInRleHRhcmVhIiA9PT0gYiB8fCAidHJ1ZSIgPT09IGEuY29udGVudEVkaXRhYmxlKTt9CiAgICAgICAgICBmdW5jdGlvbiBPZShhKSB7dmFyIGIgPSBNZSgpLGMgPSBhLmZvY3VzZWRFbGVtLGQgPSBhLnNlbGVjdGlvblJhbmdlO2lmIChiICE9PSBjICYmIGMgJiYgYy5vd25lckRvY3VtZW50ICYmIExlKGMub3duZXJEb2N1bWVudC5kb2N1bWVudEVsZW1lbnQsIGMpKSB7aWYgKG51bGwgIT09IGQgJiYgTmUoYykpIGlmIChiID0gZC5zdGFydCwgYSA9IGQuZW5kLCB2b2lkIDAgPT09IGEgJiYgKGEgPSBiKSwgInNlbGVjdGlvblN0YXJ0IiBpbiBjKSBjLnNlbGVjdGlvblN0YXJ0ID0gYiwgYy5zZWxlY3Rpb25FbmQgPSBNYXRoLm1pbihhLCBjLnZhbHVlLmxlbmd0aCk7ZWxzZSBpZiAoYSA9IChiID0gYy5vd25lckRvY3VtZW50IHx8IGRvY3VtZW50KSAmJiBiLmRlZmF1bHRWaWV3IHx8IHdpbmRvdywgYS5nZXRTZWxlY3Rpb24pIHthID0gYS5nZXRTZWxlY3Rpb24oKTt2YXIgZSA9IGMudGV4dENvbnRlbnQubGVuZ3RoLGYgPSBNYXRoLm1pbihkLnN0YXJ0LCBlKTtkID0gdm9pZCAwID09PSBkLmVuZCA/IGYgOiBNYXRoLm1pbihkLmVuZCwgZSk7IWEuZXh0ZW5kICYmIGYgPiBkICYmIChlID0gZCwgZCA9IGYsIGYgPSBlKTtlID0gS2UoYywgZik7dmFyIGcgPSBLZShjLAogICAgICAgICAgICAgICAgZCk7ZSAmJiBnICYmICgxICE9PSBhLnJhbmdlQ291bnQgfHwgYS5hbmNob3JOb2RlICE9PSBlLm5vZGUgfHwgYS5hbmNob3JPZmZzZXQgIT09IGUub2Zmc2V0IHx8IGEuZm9jdXNOb2RlICE9PSBnLm5vZGUgfHwgYS5mb2N1c09mZnNldCAhPT0gZy5vZmZzZXQpICYmIChiID0gYi5jcmVhdGVSYW5nZSgpLCBiLnNldFN0YXJ0KGUubm9kZSwgZS5vZmZzZXQpLCBhLnJlbW92ZUFsbFJhbmdlcygpLCBmID4gZCA/IChhLmFkZFJhbmdlKGIpLCBhLmV4dGVuZChnLm5vZGUsIGcub2Zmc2V0KSkgOiAoYi5zZXRFbmQoZy5ub2RlLCBnLm9mZnNldCksIGEuYWRkUmFuZ2UoYikpKTt9YiA9IFtdO2ZvciAoYSA9IGM7IGEgPSBhLnBhcmVudE5vZGU7KSB7MSA9PT0gYS5ub2RlVHlwZSAmJiBiLnB1c2goeyBlbGVtZW50OiBhLCBsZWZ0OiBhLnNjcm9sbExlZnQsIHRvcDogYS5zY3JvbGxUb3AgfSk7fSJmdW5jdGlvbiIgPT09IHR5cGVvZiBjLmZvY3VzICYmIGMuZm9jdXMoKTtmb3IgKGMgPSAwOyBjIDwgYi5sZW5ndGg7IGMrKykge2EgPSBiW2NdLCBhLmVsZW1lbnQuc2Nyb2xsTGVmdCA9IGEubGVmdCwgYS5lbGVtZW50LnNjcm9sbFRvcCA9IGEudG9wO319fQogICAgICAgICAgdmFyIFBlID0gaWEgJiYgImRvY3VtZW50TW9kZSIgaW4gZG9jdW1lbnQgJiYgMTEgPj0gZG9jdW1lbnQuZG9jdW1lbnRNb2RlLFFlID0gbnVsbCxSZSA9IG51bGwsU2UgPSBudWxsLFRlID0gITE7CiAgICAgICAgICBmdW5jdGlvbiBVZShhLCBiLCBjKSB7dmFyIGQgPSBjLndpbmRvdyA9PT0gYyA/IGMuZG9jdW1lbnQgOiA5ID09PSBjLm5vZGVUeXBlID8gYyA6IGMub3duZXJEb2N1bWVudDtUZSB8fCBudWxsID09IFFlIHx8IFFlICE9PSBYYShkKSB8fCAoZCA9IFFlLCAic2VsZWN0aW9uU3RhcnQiIGluIGQgJiYgTmUoZCkgPyBkID0geyBzdGFydDogZC5zZWxlY3Rpb25TdGFydCwgZW5kOiBkLnNlbGVjdGlvbkVuZCB9IDogKGQgPSAoZC5vd25lckRvY3VtZW50ICYmIGQub3duZXJEb2N1bWVudC5kZWZhdWx0VmlldyB8fCB3aW5kb3cpLmdldFNlbGVjdGlvbigpLCBkID0geyBhbmNob3JOb2RlOiBkLmFuY2hvck5vZGUsIGFuY2hvck9mZnNldDogZC5hbmNob3JPZmZzZXQsIGZvY3VzTm9kZTogZC5mb2N1c05vZGUsIGZvY3VzT2Zmc2V0OiBkLmZvY3VzT2Zmc2V0IH0pLCBTZSAmJiBJZShTZSwgZCkgfHwgKFNlID0gZCwgZCA9IG9lKFJlLCAib25TZWxlY3QiKSwgMCA8IGQubGVuZ3RoICYmIChiID0gbmV3IHRkKCJvblNlbGVjdCIsICJzZWxlY3QiLCBudWxsLCBiLCBjKSwgYS5wdXNoKHsgZXZlbnQ6IGIsIGxpc3RlbmVyczogZCB9KSwgYi50YXJnZXQgPSBRZSkpKTt9CiAgICAgICAgICBmdW5jdGlvbiBWZShhLCBiKSB7dmFyIGMgPSB7fTtjW2EudG9Mb3dlckNhc2UoKV0gPSBiLnRvTG93ZXJDYXNlKCk7Y1siV2Via2l0IiArIGFdID0gIndlYmtpdCIgKyBiO2NbIk1veiIgKyBhXSA9ICJtb3oiICsgYjtyZXR1cm4gYzt9dmFyIFdlID0geyBhbmltYXRpb25lbmQ6IFZlKCJBbmltYXRpb24iLCAiQW5pbWF0aW9uRW5kIiksIGFuaW1hdGlvbml0ZXJhdGlvbjogVmUoIkFuaW1hdGlvbiIsICJBbmltYXRpb25JdGVyYXRpb24iKSwgYW5pbWF0aW9uc3RhcnQ6IFZlKCJBbmltYXRpb24iLCAiQW5pbWF0aW9uU3RhcnQiKSwgdHJhbnNpdGlvbmVuZDogVmUoIlRyYW5zaXRpb24iLCAiVHJhbnNpdGlvbkVuZCIpIH0sWGUgPSB7fSxZZSA9IHt9OwogICAgICAgICAgaWEgJiYgKFllID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2Iikuc3R5bGUsICJBbmltYXRpb25FdmVudCIgaW4gd2luZG93IHx8IChkZWxldGUgV2UuYW5pbWF0aW9uZW5kLmFuaW1hdGlvbiwgZGVsZXRlIFdlLmFuaW1hdGlvbml0ZXJhdGlvbi5hbmltYXRpb24sIGRlbGV0ZSBXZS5hbmltYXRpb25zdGFydC5hbmltYXRpb24pLCAiVHJhbnNpdGlvbkV2ZW50IiBpbiB3aW5kb3cgfHwgZGVsZXRlIFdlLnRyYW5zaXRpb25lbmQudHJhbnNpdGlvbik7ZnVuY3Rpb24gWmUoYSkge2lmIChYZVthXSkgcmV0dXJuIFhlW2FdO2lmICghV2VbYV0pIHJldHVybiBhO3ZhciBiID0gV2VbYV0sYztmb3IgKGMgaW4gYikge2lmIChiLmhhc093blByb3BlcnR5KGMpICYmIGMgaW4gWWUpIHJldHVybiBYZVthXSA9IGJbY107fXJldHVybiBhO312YXIgJGUgPSBaZSgiYW5pbWF0aW9uZW5kIiksYWYgPSBaZSgiYW5pbWF0aW9uaXRlcmF0aW9uIiksYmYgPSBaZSgiYW5pbWF0aW9uc3RhcnQiKSxjZiA9IFplKCJ0cmFuc2l0aW9uZW5kIiksZGYgPSBuZXcgTWFwKCksZWYgPSAiYWJvcnQgYXV4Q2xpY2sgY2FuY2VsIGNhblBsYXkgY2FuUGxheVRocm91Z2ggY2xpY2sgY2xvc2UgY29udGV4dE1lbnUgY29weSBjdXQgZHJhZyBkcmFnRW5kIGRyYWdFbnRlciBkcmFnRXhpdCBkcmFnTGVhdmUgZHJhZ092ZXIgZHJhZ1N0YXJ0IGRyb3AgZHVyYXRpb25DaGFuZ2UgZW1wdGllZCBlbmNyeXB0ZWQgZW5kZWQgZXJyb3IgZ290UG9pbnRlckNhcHR1cmUgaW5wdXQgaW52YWxpZCBrZXlEb3duIGtleVByZXNzIGtleVVwIGxvYWQgbG9hZGVkRGF0YSBsb2FkZWRNZXRhZGF0YSBsb2FkU3RhcnQgbG9zdFBvaW50ZXJDYXB0dXJlIG1vdXNlRG93biBtb3VzZU1vdmUgbW91c2VPdXQgbW91c2VPdmVyIG1vdXNlVXAgcGFzdGUgcGF1c2UgcGxheSBwbGF5aW5nIHBvaW50ZXJDYW5jZWwgcG9pbnRlckRvd24gcG9pbnRlck1vdmUgcG9pbnRlck91dCBwb2ludGVyT3ZlciBwb2ludGVyVXAgcHJvZ3Jlc3MgcmF0ZUNoYW5nZSByZXNldCByZXNpemUgc2Vla2VkIHNlZWtpbmcgc3RhbGxlZCBzdWJtaXQgc3VzcGVuZCB0aW1lVXBkYXRlIHRvdWNoQ2FuY2VsIHRvdWNoRW5kIHRvdWNoU3RhcnQgdm9sdW1lQ2hhbmdlIHNjcm9sbCB0b2dnbGUgdG91Y2hNb3ZlIHdhaXRpbmcgd2hlZWwiLnNwbGl0KCIgIik7CiAgICAgICAgICBmdW5jdGlvbiBmZihhLCBiKSB7ZGYuc2V0KGEsIGIpO2ZhKGIsIFthXSk7fWZvciAodmFyIGdmID0gMDsgZ2YgPCBlZi5sZW5ndGg7IGdmKyspIHt2YXIgaGYgPSBlZltnZl0samYgPSBoZi50b0xvd2VyQ2FzZSgpLGtmID0gaGZbMF0udG9VcHBlckNhc2UoKSArIGhmLnNsaWNlKDEpO2ZmKGpmLCAib24iICsga2YpO31mZigkZSwgIm9uQW5pbWF0aW9uRW5kIik7ZmYoYWYsICJvbkFuaW1hdGlvbkl0ZXJhdGlvbiIpO2ZmKGJmLCAib25BbmltYXRpb25TdGFydCIpO2ZmKCJkYmxjbGljayIsICJvbkRvdWJsZUNsaWNrIik7ZmYoImZvY3VzaW4iLCAib25Gb2N1cyIpO2ZmKCJmb2N1c291dCIsICJvbkJsdXIiKTtmZihjZiwgIm9uVHJhbnNpdGlvbkVuZCIpO2hhKCJvbk1vdXNlRW50ZXIiLCBbIm1vdXNlb3V0IiwgIm1vdXNlb3ZlciJdKTtoYSgib25Nb3VzZUxlYXZlIiwgWyJtb3VzZW91dCIsICJtb3VzZW92ZXIiXSk7aGEoIm9uUG9pbnRlckVudGVyIiwgWyJwb2ludGVyb3V0IiwgInBvaW50ZXJvdmVyIl0pOwogICAgICAgICAgaGEoIm9uUG9pbnRlckxlYXZlIiwgWyJwb2ludGVyb3V0IiwgInBvaW50ZXJvdmVyIl0pO2ZhKCJvbkNoYW5nZSIsICJjaGFuZ2UgY2xpY2sgZm9jdXNpbiBmb2N1c291dCBpbnB1dCBrZXlkb3duIGtleXVwIHNlbGVjdGlvbmNoYW5nZSIuc3BsaXQoIiAiKSk7ZmEoIm9uU2VsZWN0IiwgImZvY3Vzb3V0IGNvbnRleHRtZW51IGRyYWdlbmQgZm9jdXNpbiBrZXlkb3duIGtleXVwIG1vdXNlZG93biBtb3VzZXVwIHNlbGVjdGlvbmNoYW5nZSIuc3BsaXQoIiAiKSk7ZmEoIm9uQmVmb3JlSW5wdXQiLCBbImNvbXBvc2l0aW9uZW5kIiwgImtleXByZXNzIiwgInRleHRJbnB1dCIsICJwYXN0ZSJdKTtmYSgib25Db21wb3NpdGlvbkVuZCIsICJjb21wb3NpdGlvbmVuZCBmb2N1c291dCBrZXlkb3duIGtleXByZXNzIGtleXVwIG1vdXNlZG93biIuc3BsaXQoIiAiKSk7ZmEoIm9uQ29tcG9zaXRpb25TdGFydCIsICJjb21wb3NpdGlvbnN0YXJ0IGZvY3Vzb3V0IGtleWRvd24ga2V5cHJlc3Mga2V5dXAgbW91c2Vkb3duIi5zcGxpdCgiICIpKTsKICAgICAgICAgIGZhKCJvbkNvbXBvc2l0aW9uVXBkYXRlIiwgImNvbXBvc2l0aW9udXBkYXRlIGZvY3Vzb3V0IGtleWRvd24ga2V5cHJlc3Mga2V5dXAgbW91c2Vkb3duIi5zcGxpdCgiICIpKTt2YXIgbGYgPSAiYWJvcnQgY2FucGxheSBjYW5wbGF5dGhyb3VnaCBkdXJhdGlvbmNoYW5nZSBlbXB0aWVkIGVuY3J5cHRlZCBlbmRlZCBlcnJvciBsb2FkZWRkYXRhIGxvYWRlZG1ldGFkYXRhIGxvYWRzdGFydCBwYXVzZSBwbGF5IHBsYXlpbmcgcHJvZ3Jlc3MgcmF0ZWNoYW5nZSByZXNpemUgc2Vla2VkIHNlZWtpbmcgc3RhbGxlZCBzdXNwZW5kIHRpbWV1cGRhdGUgdm9sdW1lY2hhbmdlIHdhaXRpbmciLnNwbGl0KCIgIiksbWYgPSBuZXcgU2V0KCJjYW5jZWwgY2xvc2UgaW52YWxpZCBsb2FkIHNjcm9sbCB0b2dnbGUiLnNwbGl0KCIgIikuY29uY2F0KGxmKSk7CiAgICAgICAgICBmdW5jdGlvbiBuZihhLCBiLCBjKSB7dmFyIGQgPSBhLnR5cGUgfHwgInVua25vd24tZXZlbnQiO2EuY3VycmVudFRhcmdldCA9IGM7VWIoZCwgYiwgdm9pZCAwLCBhKTthLmN1cnJlbnRUYXJnZXQgPSBudWxsO30KICAgICAgICAgIGZ1bmN0aW9uIHNlKGEsIGIpIHtiID0gMCAhPT0gKGIgJiA0KTtmb3IgKHZhciBjID0gMDsgYyA8IGEubGVuZ3RoOyBjKyspIHt2YXIgZCA9IGFbY10sZSA9IGQuZXZlbnQ7ZCA9IGQubGlzdGVuZXJzO2E6IHt2YXIgZiA9IHZvaWQgMDtpZiAoYikgZm9yICh2YXIgZyA9IGQubGVuZ3RoIC0gMTsgMCA8PSBnOyBnLS0pIHt2YXIgaCA9IGRbZ10sayA9IGguaW5zdGFuY2UsbCA9IGguY3VycmVudFRhcmdldDtoID0gaC5saXN0ZW5lcjtpZiAoayAhPT0gZiAmJiBlLmlzUHJvcGFnYXRpb25TdG9wcGVkKCkpIGJyZWFrIGE7bmYoZSwgaCwgbCk7ZiA9IGs7fSBlbHNlIGZvciAoZyA9IDA7IGcgPCBkLmxlbmd0aDsgZysrKSB7aCA9IGRbZ107ayA9IGguaW5zdGFuY2U7bCA9IGguY3VycmVudFRhcmdldDtoID0gaC5saXN0ZW5lcjtpZiAoayAhPT0gZiAmJiBlLmlzUHJvcGFnYXRpb25TdG9wcGVkKCkpIGJyZWFrIGE7bmYoZSwgaCwgbCk7ZiA9IGs7fX19aWYgKFFiKSB0aHJvdyBhID0gUmIsIFFiID0gITEsIFJiID0gbnVsbCwgYTt9CiAgICAgICAgICBmdW5jdGlvbiBEKGEsIGIpIHt2YXIgYyA9IGJbb2ZdO3ZvaWQgMCA9PT0gYyAmJiAoYyA9IGJbb2ZdID0gbmV3IFNldCgpKTt2YXIgZCA9IGEgKyAiX19idWJibGUiO2MuaGFzKGQpIHx8IChwZihiLCBhLCAyLCAhMSksIGMuYWRkKGQpKTt9ZnVuY3Rpb24gcWYoYSwgYiwgYykge3ZhciBkID0gMDtiICYmIChkIHw9IDQpO3BmKGMsIGEsIGQsIGIpO312YXIgcmYgPSAiX3JlYWN0TGlzdGVuaW5nIiArIE1hdGgucmFuZG9tKCkudG9TdHJpbmcoMzYpLnNsaWNlKDIpO2Z1bmN0aW9uIHNmKGEpIHtpZiAoIWFbcmZdKSB7YVtyZl0gPSAhMDtkYS5mb3JFYWNoKGZ1bmN0aW9uIChiKSB7InNlbGVjdGlvbmNoYW5nZSIgIT09IGIgJiYgKG1mLmhhcyhiKSB8fCBxZihiLCAhMSwgYSksIHFmKGIsICEwLCBhKSk7fSk7dmFyIGIgPSA5ID09PSBhLm5vZGVUeXBlID8gYSA6IGEub3duZXJEb2N1bWVudDtudWxsID09PSBiIHx8IGJbcmZdIHx8IChiW3JmXSA9ICEwLCBxZigic2VsZWN0aW9uY2hhbmdlIiwgITEsIGIpKTt9fQogICAgICAgICAgZnVuY3Rpb24gcGYoYSwgYiwgYywgZCkge3N3aXRjaCAoamQoYikpIHtjYXNlIDE6dmFyIGUgPSBlZDticmVhaztjYXNlIDQ6ZSA9IGdkO2JyZWFrO2RlZmF1bHQ6ZSA9IGZkO31jID0gZS5iaW5kKG51bGwsIGIsIGMsIGEpO2UgPSB2b2lkIDA7IUxiIHx8ICJ0b3VjaHN0YXJ0IiAhPT0gYiAmJiAidG91Y2htb3ZlIiAhPT0gYiAmJiAid2hlZWwiICE9PSBiIHx8IChlID0gITApO2QgPyB2b2lkIDAgIT09IGUgPyBhLmFkZEV2ZW50TGlzdGVuZXIoYiwgYywgeyBjYXB0dXJlOiAhMCwgcGFzc2l2ZTogZSB9KSA6IGEuYWRkRXZlbnRMaXN0ZW5lcihiLCBjLCAhMCkgOiB2b2lkIDAgIT09IGUgPyBhLmFkZEV2ZW50TGlzdGVuZXIoYiwgYywgeyBwYXNzaXZlOiBlIH0pIDogYS5hZGRFdmVudExpc3RlbmVyKGIsIGMsICExKTt9CiAgICAgICAgICBmdW5jdGlvbiBoZChhLCBiLCBjLCBkLCBlKSB7dmFyIGYgPSBkO2lmICgwID09PSAoYiAmIDEpICYmIDAgPT09IChiICYgMikgJiYgbnVsbCAhPT0gZCkgYTogZm9yICg7Oykge2lmIChudWxsID09PSBkKSByZXR1cm47dmFyIGcgPSBkLnRhZztpZiAoMyA9PT0gZyB8fCA0ID09PSBnKSB7dmFyIGggPSBkLnN0YXRlTm9kZS5jb250YWluZXJJbmZvO2lmIChoID09PSBlIHx8IDggPT09IGgubm9kZVR5cGUgJiYgaC5wYXJlbnROb2RlID09PSBlKSBicmVhaztpZiAoNCA9PT0gZykgZm9yIChnID0gZC5yZXR1cm47IG51bGwgIT09IGc7KSB7dmFyIGsgPSBnLnRhZztpZiAoMyA9PT0gayB8fCA0ID09PSBrKSBpZiAoayA9IGcuc3RhdGVOb2RlLmNvbnRhaW5lckluZm8sIGsgPT09IGUgfHwgOCA9PT0gay5ub2RlVHlwZSAmJiBrLnBhcmVudE5vZGUgPT09IGUpIHJldHVybjtnID0gZy5yZXR1cm47fWZvciAoOyBudWxsICE9PSBoOykge2cgPSBXYyhoKTtpZiAobnVsbCA9PT0gZykgcmV0dXJuO2sgPSBnLnRhZztpZiAoNSA9PT0gayB8fCA2ID09PSBrKSB7ZCA9IGYgPSBnO2NvbnRpbnVlIGE7fWggPSBoLnBhcmVudE5vZGU7fX1kID0gZC5yZXR1cm47fUpiKGZ1bmN0aW9uICgpIHt2YXIgZCA9IGYsZSA9IHhiKGMpLGcgPSBbXTsKICAgICAgICAgICAgICBhOiB7dmFyIGggPSBkZi5nZXQoYSk7aWYgKHZvaWQgMCAhPT0gaCkge3ZhciBrID0gdGQsbiA9IGE7c3dpdGNoIChhKSB7Y2FzZSAia2V5cHJlc3MiOmlmICgwID09PSBvZChjKSkgYnJlYWsgYTtjYXNlICJrZXlkb3duIjpjYXNlICJrZXl1cCI6ayA9IFJkO2JyZWFrO2Nhc2UgImZvY3VzaW4iOm4gPSAiZm9jdXMiO2sgPSBGZDticmVhaztjYXNlICJmb2N1c291dCI6biA9ICJibHVyIjtrID0gRmQ7YnJlYWs7Y2FzZSAiYmVmb3JlYmx1ciI6Y2FzZSAiYWZ0ZXJibHVyIjprID0gRmQ7YnJlYWs7Y2FzZSAiY2xpY2siOmlmICgyID09PSBjLmJ1dHRvbikgYnJlYWsgYTtjYXNlICJhdXhjbGljayI6Y2FzZSAiZGJsY2xpY2siOmNhc2UgIm1vdXNlZG93biI6Y2FzZSAibW91c2Vtb3ZlIjpjYXNlICJtb3VzZXVwIjpjYXNlICJtb3VzZW91dCI6Y2FzZSAibW91c2VvdmVyIjpjYXNlICJjb250ZXh0bWVudSI6ayA9IEJkO2JyZWFrO2Nhc2UgImRyYWciOmNhc2UgImRyYWdlbmQiOmNhc2UgImRyYWdlbnRlciI6Y2FzZSAiZHJhZ2V4aXQiOmNhc2UgImRyYWdsZWF2ZSI6Y2FzZSAiZHJhZ292ZXIiOmNhc2UgImRyYWdzdGFydCI6Y2FzZSAiZHJvcCI6ayA9CiAgICAgICAgICAgICAgICAgICAgICBEZDticmVhaztjYXNlICJ0b3VjaGNhbmNlbCI6Y2FzZSAidG91Y2hlbmQiOmNhc2UgInRvdWNobW92ZSI6Y2FzZSAidG91Y2hzdGFydCI6ayA9IFZkO2JyZWFrO2Nhc2UgJGU6Y2FzZSBhZjpjYXNlIGJmOmsgPSBIZDticmVhaztjYXNlIGNmOmsgPSBYZDticmVhaztjYXNlICJzY3JvbGwiOmsgPSB2ZDticmVhaztjYXNlICJ3aGVlbCI6ayA9IFpkO2JyZWFrO2Nhc2UgImNvcHkiOmNhc2UgImN1dCI6Y2FzZSAicGFzdGUiOmsgPSBKZDticmVhaztjYXNlICJnb3Rwb2ludGVyY2FwdHVyZSI6Y2FzZSAibG9zdHBvaW50ZXJjYXB0dXJlIjpjYXNlICJwb2ludGVyY2FuY2VsIjpjYXNlICJwb2ludGVyZG93biI6Y2FzZSAicG9pbnRlcm1vdmUiOmNhc2UgInBvaW50ZXJvdXQiOmNhc2UgInBvaW50ZXJvdmVyIjpjYXNlICJwb2ludGVydXAiOmsgPSBUZDt9dmFyIHQgPSAwICE9PSAoYiAmIDQpLEogPSAhdCAmJiAic2Nyb2xsIiA9PT0gYSx4ID0gdCA/IG51bGwgIT09IGggPyBoICsgIkNhcHR1cmUiIDogbnVsbCA6IGg7dCA9IFtdO2ZvciAodmFyIHcgPSBkLCB1OyBudWxsICE9PQogICAgICAgICAgICAgICAgICB3Oykge3UgPSB3O3ZhciBGID0gdS5zdGF0ZU5vZGU7NSA9PT0gdS50YWcgJiYgbnVsbCAhPT0gRiAmJiAodSA9IEYsIG51bGwgIT09IHggJiYgKEYgPSBLYih3LCB4KSwgbnVsbCAhPSBGICYmIHQucHVzaCh0Zih3LCBGLCB1KSkpKTtpZiAoSikgYnJlYWs7dyA9IHcucmV0dXJuO30wIDwgdC5sZW5ndGggJiYgKGggPSBuZXcgayhoLCBuLCBudWxsLCBjLCBlKSwgZy5wdXNoKHsgZXZlbnQ6IGgsIGxpc3RlbmVyczogdCB9KSk7fX1pZiAoMCA9PT0gKGIgJiA3KSkge2E6IHtoID0gIm1vdXNlb3ZlciIgPT09IGEgfHwgInBvaW50ZXJvdmVyIiA9PT0gYTtrID0gIm1vdXNlb3V0IiA9PT0gYSB8fCAicG9pbnRlcm91dCIgPT09IGE7aWYgKGggJiYgYyAhPT0gd2IgJiYgKG4gPSBjLnJlbGF0ZWRUYXJnZXQgfHwgYy5mcm9tRWxlbWVudCkgJiYgKFdjKG4pIHx8IG5bdWZdKSkgYnJlYWsgYTtpZiAoayB8fCBoKSB7aCA9IGUud2luZG93ID09PSBlID8gZSA6IChoID0gZS5vd25lckRvY3VtZW50KSA/IGguZGVmYXVsdFZpZXcgfHwgaC5wYXJlbnRXaW5kb3cgOiB3aW5kb3c7aWYgKGspIHtpZiAobiA9IGMucmVsYXRlZFRhcmdldCB8fCBjLnRvRWxlbWVudCwgayA9IGQsIG4gPSBuID8gV2MobikgOiBudWxsLCBudWxsICE9PQogICAgICAgICAgICAgICAgICAgICAgbiAmJiAoSiA9IFZiKG4pLCBuICE9PSBKIHx8IDUgIT09IG4udGFnICYmIDYgIT09IG4udGFnKSkgbiA9IG51bGw7fSBlbHNlIGsgPSBudWxsLCBuID0gZDtpZiAoayAhPT0gbikge3QgPSBCZDtGID0gIm9uTW91c2VMZWF2ZSI7eCA9ICJvbk1vdXNlRW50ZXIiO3cgPSAibW91c2UiO2lmICgicG9pbnRlcm91dCIgPT09IGEgfHwgInBvaW50ZXJvdmVyIiA9PT0gYSkgdCA9IFRkLCBGID0gIm9uUG9pbnRlckxlYXZlIiwgeCA9ICJvblBvaW50ZXJFbnRlciIsIHcgPSAicG9pbnRlciI7SiA9IG51bGwgPT0gayA/IGggOiB1ZShrKTt1ID0gbnVsbCA9PSBuID8gaCA6IHVlKG4pO2ggPSBuZXcgdChGLCB3ICsgImxlYXZlIiwgaywgYywgZSk7aC50YXJnZXQgPSBKO2gucmVsYXRlZFRhcmdldCA9IHU7RiA9IG51bGw7V2MoZSkgPT09IGQgJiYgKHQgPSBuZXcgdCh4LCB3ICsgImVudGVyIiwgbiwgYywgZSksIHQudGFyZ2V0ID0gdSwgdC5yZWxhdGVkVGFyZ2V0ID0gSiwgRiA9IHQpO0ogPSBGO2lmIChrICYmIG4pIGI6IHt0ID0gazt4ID0gbjt3ID0gMDtmb3IgKHUgPSB0OyB1OyB1ID0gdmYodSkpIHt3Kys7fXUgPSAwO2ZvciAoRiA9IHg7IEY7IEYgPSB2ZihGKSkge3UrKzt9Zm9yICg7IDAgPCB3IC0gdTspIHt0ID0gdmYodCksIHctLTt9Zm9yICg7IDAgPCB1IC0gdzspIHt4ID0KICAgICAgICAgICAgICAgICAgICAgICAgICB2Zih4KSwgdS0tO31mb3IgKDsgdy0tOykge2lmICh0ID09PSB4IHx8IG51bGwgIT09IHggJiYgdCA9PT0geC5hbHRlcm5hdGUpIGJyZWFrIGI7dCA9IHZmKHQpO3ggPSB2Zih4KTt9dCA9IG51bGw7fSBlbHNlIHQgPSBudWxsO251bGwgIT09IGsgJiYgd2YoZywgaCwgaywgdCwgITEpO251bGwgIT09IG4gJiYgbnVsbCAhPT0gSiAmJiB3ZihnLCBKLCBuLCB0LCAhMCk7fX19YToge2ggPSBkID8gdWUoZCkgOiB3aW5kb3c7ayA9IGgubm9kZU5hbWUgJiYgaC5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpO2lmICgic2VsZWN0IiA9PT0gayB8fCAiaW5wdXQiID09PSBrICYmICJmaWxlIiA9PT0gaC50eXBlKSB2YXIgbmEgPSB2ZTtlbHNlIGlmIChtZShoKSkge2lmICh3ZSkgbmEgPSBGZTtlbHNlIHtuYSA9IERlO3ZhciB4YSA9IENlO319IGVsc2UgKGsgPSBoLm5vZGVOYW1lKSAmJiAiaW5wdXQiID09PSBrLnRvTG93ZXJDYXNlKCkgJiYgKCJjaGVja2JveCIgPT09IGgudHlwZSB8fCAicmFkaW8iID09PSBoLnR5cGUpICYmIChuYSA9IEVlKTtpZiAobmEgJiYgKG5hID0gbmEoYSwgZCkpKSB7bmUoZywgbmEsIGMsIGUpO2JyZWFrIGE7fXhhICYmIHhhKGEsIGgsIGQpOyJmb2N1c291dCIgPT09IGEgJiYgKHhhID0gaC5fd3JhcHBlclN0YXRlKSAmJgogICAgICAgICAgICAgICAgICB4YS5jb250cm9sbGVkICYmICJudW1iZXIiID09PSBoLnR5cGUgJiYgY2IoaCwgIm51bWJlciIsIGgudmFsdWUpO314YSA9IGQgPyB1ZShkKSA6IHdpbmRvdztzd2l0Y2ggKGEpIHtjYXNlICJmb2N1c2luIjppZiAobWUoeGEpIHx8ICJ0cnVlIiA9PT0geGEuY29udGVudEVkaXRhYmxlKSBRZSA9IHhhLCBSZSA9IGQsIFNlID0gbnVsbDticmVhaztjYXNlICJmb2N1c291dCI6U2UgPSBSZSA9IFFlID0gbnVsbDticmVhaztjYXNlICJtb3VzZWRvd24iOlRlID0gITA7YnJlYWs7Y2FzZSAiY29udGV4dG1lbnUiOmNhc2UgIm1vdXNldXAiOmNhc2UgImRyYWdlbmQiOlRlID0gITE7VWUoZywgYywgZSk7YnJlYWs7Y2FzZSAic2VsZWN0aW9uY2hhbmdlIjppZiAoUGUpIGJyZWFrO2Nhc2UgImtleWRvd24iOmNhc2UgImtleXVwIjpVZShnLCBjLCBlKTt9dmFyICRhO2lmIChhZSkgYjoge3N3aXRjaCAoYSkge2Nhc2UgImNvbXBvc2l0aW9uc3RhcnQiOnZhciBiYSA9ICJvbkNvbXBvc2l0aW9uU3RhcnQiO2JyZWFrIGI7Y2FzZSAiY29tcG9zaXRpb25lbmQiOmJhID0gIm9uQ29tcG9zaXRpb25FbmQiOwogICAgICAgICAgICAgICAgICAgICAgYnJlYWsgYjtjYXNlICJjb21wb3NpdGlvbnVwZGF0ZSI6YmEgPSAib25Db21wb3NpdGlvblVwZGF0ZSI7YnJlYWsgYjt9YmEgPSB2b2lkIDA7fSBlbHNlIGllID8gZ2UoYSwgYykgJiYgKGJhID0gIm9uQ29tcG9zaXRpb25FbmQiKSA6ICJrZXlkb3duIiA9PT0gYSAmJiAyMjkgPT09IGMua2V5Q29kZSAmJiAoYmEgPSAib25Db21wb3NpdGlvblN0YXJ0Iik7YmEgJiYgKGRlICYmICJrbyIgIT09IGMubG9jYWxlICYmIChpZSB8fCAib25Db21wb3NpdGlvblN0YXJ0IiAhPT0gYmEgPyAib25Db21wb3NpdGlvbkVuZCIgPT09IGJhICYmIGllICYmICgkYSA9IG5kKCkpIDogKGtkID0gZSwgbGQgPSAidmFsdWUiIGluIGtkID8ga2QudmFsdWUgOiBrZC50ZXh0Q29udGVudCwgaWUgPSAhMCkpLCB4YSA9IG9lKGQsIGJhKSwgMCA8IHhhLmxlbmd0aCAmJiAoYmEgPSBuZXcgTGQoYmEsIGEsIG51bGwsIGMsIGUpLCBnLnB1c2goeyBldmVudDogYmEsIGxpc3RlbmVyczogeGEgfSksICRhID8gYmEuZGF0YSA9ICRhIDogKCRhID0gaGUoYyksIG51bGwgIT09ICRhICYmIChiYS5kYXRhID0gJGEpKSkpO2lmICgkYSA9IGNlID8gamUoYSwgYykgOiBrZShhLCBjKSkgZCA9IG9lKGQsICJvbkJlZm9yZUlucHV0IiksCiAgICAgICAgICAgICAgICAwIDwgZC5sZW5ndGggJiYgKGUgPSBuZXcgTGQoIm9uQmVmb3JlSW5wdXQiLCAiYmVmb3JlaW5wdXQiLCBudWxsLCBjLCBlKSwgZy5wdXNoKHsgZXZlbnQ6IGUsIGxpc3RlbmVyczogZCB9KSwgZS5kYXRhID0gJGEpO31zZShnLCBiKTt9KTt9ZnVuY3Rpb24gdGYoYSwgYiwgYykge3JldHVybiB7IGluc3RhbmNlOiBhLCBsaXN0ZW5lcjogYiwgY3VycmVudFRhcmdldDogYyB9O31mdW5jdGlvbiBvZShhLCBiKSB7Zm9yICh2YXIgYyA9IGIgKyAiQ2FwdHVyZSIsIGQgPSBbXTsgbnVsbCAhPT0gYTspIHt2YXIgZSA9IGEsZiA9IGUuc3RhdGVOb2RlOzUgPT09IGUudGFnICYmIG51bGwgIT09IGYgJiYgKGUgPSBmLCBmID0gS2IoYSwgYyksIG51bGwgIT0gZiAmJiBkLnVuc2hpZnQodGYoYSwgZiwgZSkpLCBmID0gS2IoYSwgYiksIG51bGwgIT0gZiAmJiBkLnB1c2godGYoYSwgZiwgZSkpKTthID0gYS5yZXR1cm47fXJldHVybiBkO31mdW5jdGlvbiB2ZihhKSB7aWYgKG51bGwgPT09IGEpIHJldHVybiBudWxsO2RvIHthID0gYS5yZXR1cm47fSB3aGlsZSAoYSAmJiA1ICE9PSBhLnRhZyk7cmV0dXJuIGEgPyBhIDogbnVsbDt9CiAgICAgICAgICBmdW5jdGlvbiB3ZihhLCBiLCBjLCBkLCBlKSB7Zm9yICh2YXIgZiA9IGIuX3JlYWN0TmFtZSwgZyA9IFtdOyBudWxsICE9PSBjICYmIGMgIT09IGQ7KSB7dmFyIGggPSBjLGsgPSBoLmFsdGVybmF0ZSxsID0gaC5zdGF0ZU5vZGU7aWYgKG51bGwgIT09IGsgJiYgayA9PT0gZCkgYnJlYWs7NSA9PT0gaC50YWcgJiYgbnVsbCAhPT0gbCAmJiAoaCA9IGwsIGUgPyAoayA9IEtiKGMsIGYpLCBudWxsICE9IGsgJiYgZy51bnNoaWZ0KHRmKGMsIGssIGgpKSkgOiBlIHx8IChrID0gS2IoYywgZiksIG51bGwgIT0gayAmJiBnLnB1c2godGYoYywgaywgaCkpKSk7YyA9IGMucmV0dXJuO30wICE9PSBnLmxlbmd0aCAmJiBhLnB1c2goeyBldmVudDogYiwgbGlzdGVuZXJzOiBnIH0pO312YXIgeGYgPSAvXHJcbj8vZyx5ZiA9IC9cdTAwMDB8XHVGRkZEL2c7ZnVuY3Rpb24gemYoYSkge3JldHVybiAoInN0cmluZyIgPT09IHR5cGVvZiBhID8gYSA6ICIiICsgYSkucmVwbGFjZSh4ZiwgIlxuIikucmVwbGFjZSh5ZiwgIiIpO31mdW5jdGlvbiBBZihhLCBiLCBjKSB7YiA9IHpmKGIpO2lmICh6ZihhKSAhPT0gYiAmJiBjKSB0aHJvdyBFcnJvcihwKDQyNSkpO31mdW5jdGlvbiBCZigpIHt9CiAgICAgICAgICB2YXIgQ2YgPSBudWxsLERmID0gbnVsbDtmdW5jdGlvbiBFZihhLCBiKSB7cmV0dXJuICJ0ZXh0YXJlYSIgPT09IGEgfHwgIm5vc2NyaXB0IiA9PT0gYSB8fCAic3RyaW5nIiA9PT0gdHlwZW9mIGIuY2hpbGRyZW4gfHwgIm51bWJlciIgPT09IHR5cGVvZiBiLmNoaWxkcmVuIHx8ICJvYmplY3QiID09PSB0eXBlb2YgYi5kYW5nZXJvdXNseVNldElubmVySFRNTCAmJiBudWxsICE9PSBiLmRhbmdlcm91c2x5U2V0SW5uZXJIVE1MICYmIG51bGwgIT0gYi5kYW5nZXJvdXNseVNldElubmVySFRNTC5fX2h0bWw7fQogICAgICAgICAgdmFyIEZmID0gImZ1bmN0aW9uIiA9PT0gdHlwZW9mIHNldFRpbWVvdXQgPyBzZXRUaW1lb3V0IDogdm9pZCAwLEdmID0gImZ1bmN0aW9uIiA9PT0gdHlwZW9mIGNsZWFyVGltZW91dCA/IGNsZWFyVGltZW91dCA6IHZvaWQgMCxIZiA9ICJmdW5jdGlvbiIgPT09IHR5cGVvZiBQcm9taXNlID8gUHJvbWlzZSA6IHZvaWQgMCxKZiA9ICJmdW5jdGlvbiIgPT09IHR5cGVvZiBxdWV1ZU1pY3JvdGFzayA/IHF1ZXVlTWljcm90YXNrIDogInVuZGVmaW5lZCIgIT09IHR5cGVvZiBIZiA/IGZ1bmN0aW9uIChhKSB7cmV0dXJuIEhmLnJlc29sdmUobnVsbCkudGhlbihhKS5jYXRjaChJZik7fSA6IEZmO2Z1bmN0aW9uIElmKGEpIHtzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHt0aHJvdyBhO30pO30KICAgICAgICAgIGZ1bmN0aW9uIEtmKGEsIGIpIHt2YXIgYyA9IGIsZCA9IDA7ZG8ge3ZhciBlID0gYy5uZXh0U2libGluZzthLnJlbW92ZUNoaWxkKGMpO2lmIChlICYmIDggPT09IGUubm9kZVR5cGUpIGlmIChjID0gZS5kYXRhLCAiLyQiID09PSBjKSB7aWYgKDAgPT09IGQpIHthLnJlbW92ZUNoaWxkKGUpO2JkKGIpO3JldHVybjt9ZC0tO30gZWxzZSAiJCIgIT09IGMgJiYgIiQ/IiAhPT0gYyAmJiAiJCEiICE9PSBjIHx8IGQrKztjID0gZTt9IHdoaWxlIChjKTtiZChiKTt9ZnVuY3Rpb24gTGYoYSkge2ZvciAoOyBudWxsICE9IGE7IGEgPSBhLm5leHRTaWJsaW5nKSB7dmFyIGIgPSBhLm5vZGVUeXBlO2lmICgxID09PSBiIHx8IDMgPT09IGIpIGJyZWFrO2lmICg4ID09PSBiKSB7YiA9IGEuZGF0YTtpZiAoIiQiID09PSBiIHx8ICIkISIgPT09IGIgfHwgIiQ/IiA9PT0gYikgYnJlYWs7aWYgKCIvJCIgPT09IGIpIHJldHVybiBudWxsO319cmV0dXJuIGE7fQogICAgICAgICAgZnVuY3Rpb24gTWYoYSkge2EgPSBhLnByZXZpb3VzU2libGluZztmb3IgKHZhciBiID0gMDsgYTspIHtpZiAoOCA9PT0gYS5ub2RlVHlwZSkge3ZhciBjID0gYS5kYXRhO2lmICgiJCIgPT09IGMgfHwgIiQhIiA9PT0gYyB8fCAiJD8iID09PSBjKSB7aWYgKDAgPT09IGIpIHJldHVybiBhO2ItLTt9IGVsc2UgIi8kIiA9PT0gYyAmJiBiKys7fWEgPSBhLnByZXZpb3VzU2libGluZzt9cmV0dXJuIG51bGw7fXZhciBOZiA9IE1hdGgucmFuZG9tKCkudG9TdHJpbmcoMzYpLnNsaWNlKDIpLE9mID0gIl9fcmVhY3RGaWJlciQiICsgTmYsUGYgPSAiX19yZWFjdFByb3BzJCIgKyBOZix1ZiA9ICJfX3JlYWN0Q29udGFpbmVyJCIgKyBOZixvZiA9ICJfX3JlYWN0RXZlbnRzJCIgKyBOZixRZiA9ICJfX3JlYWN0TGlzdGVuZXJzJCIgKyBOZixSZiA9ICJfX3JlYWN0SGFuZGxlcyQiICsgTmY7CiAgICAgICAgICBmdW5jdGlvbiBXYyhhKSB7dmFyIGIgPSBhW09mXTtpZiAoYikgcmV0dXJuIGI7Zm9yICh2YXIgYyA9IGEucGFyZW50Tm9kZTsgYzspIHtpZiAoYiA9IGNbdWZdIHx8IGNbT2ZdKSB7YyA9IGIuYWx0ZXJuYXRlO2lmIChudWxsICE9PSBiLmNoaWxkIHx8IG51bGwgIT09IGMgJiYgbnVsbCAhPT0gYy5jaGlsZCkgZm9yIChhID0gTWYoYSk7IG51bGwgIT09IGE7KSB7aWYgKGMgPSBhW09mXSkgcmV0dXJuIGM7YSA9IE1mKGEpO31yZXR1cm4gYjt9YSA9IGM7YyA9IGEucGFyZW50Tm9kZTt9cmV0dXJuIG51bGw7fWZ1bmN0aW9uIENiKGEpIHthID0gYVtPZl0gfHwgYVt1Zl07cmV0dXJuICFhIHx8IDUgIT09IGEudGFnICYmIDYgIT09IGEudGFnICYmIDEzICE9PSBhLnRhZyAmJiAzICE9PSBhLnRhZyA/IG51bGwgOiBhO31mdW5jdGlvbiB1ZShhKSB7aWYgKDUgPT09IGEudGFnIHx8IDYgPT09IGEudGFnKSByZXR1cm4gYS5zdGF0ZU5vZGU7dGhyb3cgRXJyb3IocCgzMykpO31mdW5jdGlvbiBEYihhKSB7cmV0dXJuIGFbUGZdIHx8IG51bGw7fXZhciBTZiA9IFtdLFRmID0gLTE7ZnVuY3Rpb24gVWYoYSkge3JldHVybiB7IGN1cnJlbnQ6IGEgfTt9CiAgICAgICAgICBmdW5jdGlvbiBFKGEpIHswID4gVGYgfHwgKGEuY3VycmVudCA9IFNmW1RmXSwgU2ZbVGZdID0gbnVsbCwgVGYtLSk7fWZ1bmN0aW9uIEcoYSwgYikge1RmKys7U2ZbVGZdID0gYS5jdXJyZW50O2EuY3VycmVudCA9IGI7fXZhciBWZiA9IHt9LEggPSBVZihWZiksV2YgPSBVZighMSksWGYgPSBWZjtmdW5jdGlvbiBZZihhLCBiKSB7dmFyIGMgPSBhLnR5cGUuY29udGV4dFR5cGVzO2lmICghYykgcmV0dXJuIFZmO3ZhciBkID0gYS5zdGF0ZU5vZGU7aWYgKGQgJiYgZC5fX3JlYWN0SW50ZXJuYWxNZW1vaXplZFVubWFza2VkQ2hpbGRDb250ZXh0ID09PSBiKSByZXR1cm4gZC5fX3JlYWN0SW50ZXJuYWxNZW1vaXplZE1hc2tlZENoaWxkQ29udGV4dDt2YXIgZSA9IHt9LGY7Zm9yIChmIGluIGMpIHtlW2ZdID0gYltmXTt9ZCAmJiAoYSA9IGEuc3RhdGVOb2RlLCBhLl9fcmVhY3RJbnRlcm5hbE1lbW9pemVkVW5tYXNrZWRDaGlsZENvbnRleHQgPSBiLCBhLl9fcmVhY3RJbnRlcm5hbE1lbW9pemVkTWFza2VkQ2hpbGRDb250ZXh0ID0gZSk7cmV0dXJuIGU7fQogICAgICAgICAgZnVuY3Rpb24gWmYoYSkge2EgPSBhLmNoaWxkQ29udGV4dFR5cGVzO3JldHVybiBudWxsICE9PSBhICYmIHZvaWQgMCAhPT0gYTt9ZnVuY3Rpb24gJGYoKSB7RShXZik7RShIKTt9ZnVuY3Rpb24gYWcoYSwgYiwgYykge2lmIChILmN1cnJlbnQgIT09IFZmKSB0aHJvdyBFcnJvcihwKDE2OCkpO0coSCwgYik7RyhXZiwgYyk7fWZ1bmN0aW9uIGJnKGEsIGIsIGMpIHt2YXIgZCA9IGEuc3RhdGVOb2RlO2IgPSBiLmNoaWxkQ29udGV4dFR5cGVzO2lmICgiZnVuY3Rpb24iICE9PSB0eXBlb2YgZC5nZXRDaGlsZENvbnRleHQpIHJldHVybiBjO2QgPSBkLmdldENoaWxkQ29udGV4dCgpO2ZvciAodmFyIGUgaW4gZCkge2lmICghKGUgaW4gYikpIHRocm93IEVycm9yKHAoMTA4LCBSYShhKSB8fCAiVW5rbm93biIsIGUpKTt9cmV0dXJuIEEoe30sIGMsIGQpO30KICAgICAgICAgIGZ1bmN0aW9uIGNnKGEpIHthID0gKGEgPSBhLnN0YXRlTm9kZSkgJiYgYS5fX3JlYWN0SW50ZXJuYWxNZW1vaXplZE1lcmdlZENoaWxkQ29udGV4dCB8fCBWZjtYZiA9IEguY3VycmVudDtHKEgsIGEpO0coV2YsIFdmLmN1cnJlbnQpO3JldHVybiAhMDt9ZnVuY3Rpb24gZGcoYSwgYiwgYykge3ZhciBkID0gYS5zdGF0ZU5vZGU7aWYgKCFkKSB0aHJvdyBFcnJvcihwKDE2OSkpO2MgPyAoYSA9IGJnKGEsIGIsIFhmKSwgZC5fX3JlYWN0SW50ZXJuYWxNZW1vaXplZE1lcmdlZENoaWxkQ29udGV4dCA9IGEsIEUoV2YpLCBFKEgpLCBHKEgsIGEpKSA6IEUoV2YpO0coV2YsIGMpO312YXIgZWcgPSBudWxsLGZnID0gITEsZ2cgPSAhMTtmdW5jdGlvbiBoZyhhKSB7bnVsbCA9PT0gZWcgPyBlZyA9IFthXSA6IGVnLnB1c2goYSk7fWZ1bmN0aW9uIGlnKGEpIHtmZyA9ICEwO2hnKGEpO30KICAgICAgICAgIGZ1bmN0aW9uIGpnKCkge2lmICghZ2cgJiYgbnVsbCAhPT0gZWcpIHtnZyA9ICEwO3ZhciBhID0gMCxiID0gQzt0cnkge3ZhciBjID0gZWc7Zm9yIChDID0gMTsgYSA8IGMubGVuZ3RoOyBhKyspIHt2YXIgZCA9IGNbYV07ZG8ge2QgPSBkKCEwKTt9IHdoaWxlIChudWxsICE9PSBkKTt9ZWcgPSBudWxsO2ZnID0gITE7fSBjYXRjaCAoZSkge3Rocm93IG51bGwgIT09IGVnICYmIChlZyA9IGVnLnNsaWNlKGEgKyAxKSksIGFjKGZjLCBqZyksIGU7fSBmaW5hbGx5IHtDID0gYiwgZ2cgPSAhMTt9fXJldHVybiBudWxsO312YXIga2cgPSBbXSxsZyA9IDAsbWcgPSBudWxsLG5nID0gMCxvZyA9IFtdLHBnID0gMCxxZyA9IG51bGwscmcgPSAxLHNnID0gIiI7ZnVuY3Rpb24gdGcoYSwgYikge2tnW2xnKytdID0gbmc7a2dbbGcrK10gPSBtZzttZyA9IGE7bmcgPSBiO30KICAgICAgICAgIGZ1bmN0aW9uIHVnKGEsIGIsIGMpIHtvZ1twZysrXSA9IHJnO29nW3BnKytdID0gc2c7b2dbcGcrK10gPSBxZztxZyA9IGE7dmFyIGQgPSByZzthID0gc2c7dmFyIGUgPSAzMiAtIG9jKGQpIC0gMTtkICY9IH4oMSA8PCBlKTtjICs9IDE7dmFyIGYgPSAzMiAtIG9jKGIpICsgZTtpZiAoMzAgPCBmKSB7dmFyIGcgPSBlIC0gZSAlIDU7ZiA9IChkICYgKDEgPDwgZykgLSAxKS50b1N0cmluZygzMik7ZCA+Pj0gZztlIC09IGc7cmcgPSAxIDw8IDMyIC0gb2MoYikgKyBlIHwgYyA8PCBlIHwgZDtzZyA9IGYgKyBhO30gZWxzZSByZyA9IDEgPDwgZiB8IGMgPDwgZSB8IGQsIHNnID0gYTt9ZnVuY3Rpb24gdmcoYSkge251bGwgIT09IGEucmV0dXJuICYmICh0ZyhhLCAxKSwgdWcoYSwgMSwgMCkpO31mdW5jdGlvbiB3ZyhhKSB7Zm9yICg7IGEgPT09IG1nOykge21nID0ga2dbLS1sZ10sIGtnW2xnXSA9IG51bGwsIG5nID0ga2dbLS1sZ10sIGtnW2xnXSA9IG51bGw7fWZvciAoOyBhID09PSBxZzspIHtxZyA9IG9nWy0tcGddLCBvZ1twZ10gPSBudWxsLCBzZyA9IG9nWy0tcGddLCBvZ1twZ10gPSBudWxsLCByZyA9IG9nWy0tcGddLCBvZ1twZ10gPSBudWxsO319dmFyIHhnID0gbnVsbCx5ZyA9IG51bGwsSSA9ICExLHpnID0gbnVsbDsKICAgICAgICAgIGZ1bmN0aW9uIEFnKGEsIGIpIHt2YXIgYyA9IEJnKDUsIG51bGwsIG51bGwsIDApO2MuZWxlbWVudFR5cGUgPSAiREVMRVRFRCI7Yy5zdGF0ZU5vZGUgPSBiO2MucmV0dXJuID0gYTtiID0gYS5kZWxldGlvbnM7bnVsbCA9PT0gYiA/IChhLmRlbGV0aW9ucyA9IFtjXSwgYS5mbGFncyB8PSAxNikgOiBiLnB1c2goYyk7fQogICAgICAgICAgZnVuY3Rpb24gQ2coYSwgYikge3N3aXRjaCAoYS50YWcpIHtjYXNlIDU6dmFyIGMgPSBhLnR5cGU7YiA9IDEgIT09IGIubm9kZVR5cGUgfHwgYy50b0xvd2VyQ2FzZSgpICE9PSBiLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCkgPyBudWxsIDogYjtyZXR1cm4gbnVsbCAhPT0gYiA/IChhLnN0YXRlTm9kZSA9IGIsIHhnID0gYSwgeWcgPSBMZihiLmZpcnN0Q2hpbGQpLCAhMCkgOiAhMTtjYXNlIDY6cmV0dXJuIGIgPSAiIiA9PT0gYS5wZW5kaW5nUHJvcHMgfHwgMyAhPT0gYi5ub2RlVHlwZSA/IG51bGwgOiBiLCBudWxsICE9PSBiID8gKGEuc3RhdGVOb2RlID0gYiwgeGcgPSBhLCB5ZyA9IG51bGwsICEwKSA6ICExO2Nhc2UgMTM6cmV0dXJuIGIgPSA4ICE9PSBiLm5vZGVUeXBlID8gbnVsbCA6IGIsIG51bGwgIT09IGIgPyAoYyA9IG51bGwgIT09IHFnID8geyBpZDogcmcsIG92ZXJmbG93OiBzZyB9IDogbnVsbCwgYS5tZW1vaXplZFN0YXRlID0geyBkZWh5ZHJhdGVkOiBiLCB0cmVlQ29udGV4dDogYywgcmV0cnlMYW5lOiAxMDczNzQxODI0IH0sIGMgPSBCZygxOCwgbnVsbCwgbnVsbCwgMCksIGMuc3RhdGVOb2RlID0gYiwgYy5yZXR1cm4gPSBhLCBhLmNoaWxkID0gYywgeGcgPSBhLCB5ZyA9CiAgICAgICAgICAgICAgICBudWxsLCAhMCkgOiAhMTtkZWZhdWx0OnJldHVybiAhMTt9fWZ1bmN0aW9uIERnKGEpIHtyZXR1cm4gMCAhPT0gKGEubW9kZSAmIDEpICYmIDAgPT09IChhLmZsYWdzICYgMTI4KTt9ZnVuY3Rpb24gRWcoYSkge2lmIChJKSB7dmFyIGIgPSB5ZztpZiAoYikge3ZhciBjID0gYjtpZiAoIUNnKGEsIGIpKSB7aWYgKERnKGEpKSB0aHJvdyBFcnJvcihwKDQxOCkpO2IgPSBMZihjLm5leHRTaWJsaW5nKTt2YXIgZCA9IHhnO2IgJiYgQ2coYSwgYikgPyBBZyhkLCBjKSA6IChhLmZsYWdzID0gYS5mbGFncyAmIC00MDk3IHwgMiwgSSA9ICExLCB4ZyA9IGEpO319IGVsc2Uge2lmIChEZyhhKSkgdGhyb3cgRXJyb3IocCg0MTgpKTthLmZsYWdzID0gYS5mbGFncyAmIC00MDk3IHwgMjtJID0gITE7eGcgPSBhO319fWZ1bmN0aW9uIEZnKGEpIHtmb3IgKGEgPSBhLnJldHVybjsgbnVsbCAhPT0gYSAmJiA1ICE9PSBhLnRhZyAmJiAzICE9PSBhLnRhZyAmJiAxMyAhPT0gYS50YWc7KSB7YSA9IGEucmV0dXJuO314ZyA9IGE7fQogICAgICAgICAgZnVuY3Rpb24gR2coYSkge2lmIChhICE9PSB4ZykgcmV0dXJuICExO2lmICghSSkgcmV0dXJuIEZnKGEpLCBJID0gITAsICExO3ZhciBiOyhiID0gMyAhPT0gYS50YWcpICYmICEoYiA9IDUgIT09IGEudGFnKSAmJiAoYiA9IGEudHlwZSwgYiA9ICJoZWFkIiAhPT0gYiAmJiAiYm9keSIgIT09IGIgJiYgIUVmKGEudHlwZSwgYS5tZW1vaXplZFByb3BzKSk7aWYgKGIgJiYgKGIgPSB5ZykpIHtpZiAoRGcoYSkpIHRocm93IEhnKCksIEVycm9yKHAoNDE4KSk7Zm9yICg7IGI7KSB7QWcoYSwgYiksIGIgPSBMZihiLm5leHRTaWJsaW5nKTt9fUZnKGEpO2lmICgxMyA9PT0gYS50YWcpIHthID0gYS5tZW1vaXplZFN0YXRlO2EgPSBudWxsICE9PSBhID8gYS5kZWh5ZHJhdGVkIDogbnVsbDtpZiAoIWEpIHRocm93IEVycm9yKHAoMzE3KSk7YToge2EgPSBhLm5leHRTaWJsaW5nO2ZvciAoYiA9IDA7IGE7KSB7aWYgKDggPT09IGEubm9kZVR5cGUpIHt2YXIgYyA9IGEuZGF0YTtpZiAoIi8kIiA9PT0gYykge2lmICgwID09PSBiKSB7eWcgPSBMZihhLm5leHRTaWJsaW5nKTticmVhayBhO31iLS07fSBlbHNlICIkIiAhPT0gYyAmJiAiJCEiICE9PSBjICYmICIkPyIgIT09IGMgfHwgYisrO31hID0gYS5uZXh0U2libGluZzt9eWcgPQogICAgICAgICAgICAgICAgbnVsbDt9fSBlbHNlIHlnID0geGcgPyBMZihhLnN0YXRlTm9kZS5uZXh0U2libGluZykgOiBudWxsO3JldHVybiAhMDt9ZnVuY3Rpb24gSGcoKSB7Zm9yICh2YXIgYSA9IHlnOyBhOykge2EgPSBMZihhLm5leHRTaWJsaW5nKTt9fWZ1bmN0aW9uIElnKCkge3lnID0geGcgPSBudWxsO0kgPSAhMTt9ZnVuY3Rpb24gSmcoYSkge251bGwgPT09IHpnID8gemcgPSBbYV0gOiB6Zy5wdXNoKGEpO312YXIgS2cgPSB1YS5SZWFjdEN1cnJlbnRCYXRjaENvbmZpZztmdW5jdGlvbiBMZyhhLCBiKSB7aWYgKGEgJiYgYS5kZWZhdWx0UHJvcHMpIHtiID0gQSh7fSwgYik7YSA9IGEuZGVmYXVsdFByb3BzO2ZvciAodmFyIGMgaW4gYSkge3ZvaWQgMCA9PT0gYltjXSAmJiAoYltjXSA9IGFbY10pO31yZXR1cm4gYjt9cmV0dXJuIGI7fXZhciBNZyA9IFVmKG51bGwpLE5nID0gbnVsbCxPZyA9IG51bGwsUGcgPSBudWxsO2Z1bmN0aW9uIFFnKCkge1BnID0gT2cgPSBOZyA9IG51bGw7fWZ1bmN0aW9uIFJnKGEpIHt2YXIgYiA9IE1nLmN1cnJlbnQ7RShNZyk7YS5fY3VycmVudFZhbHVlID0gYjt9CiAgICAgICAgICBmdW5jdGlvbiBTZyhhLCBiLCBjKSB7Zm9yICg7IG51bGwgIT09IGE7KSB7dmFyIGQgPSBhLmFsdGVybmF0ZTsoYS5jaGlsZExhbmVzICYgYikgIT09IGIgPyAoYS5jaGlsZExhbmVzIHw9IGIsIG51bGwgIT09IGQgJiYgKGQuY2hpbGRMYW5lcyB8PSBiKSkgOiBudWxsICE9PSBkICYmIChkLmNoaWxkTGFuZXMgJiBiKSAhPT0gYiAmJiAoZC5jaGlsZExhbmVzIHw9IGIpO2lmIChhID09PSBjKSBicmVhazthID0gYS5yZXR1cm47fX1mdW5jdGlvbiBUZyhhLCBiKSB7TmcgPSBhO1BnID0gT2cgPSBudWxsO2EgPSBhLmRlcGVuZGVuY2llcztudWxsICE9PSBhICYmIG51bGwgIT09IGEuZmlyc3RDb250ZXh0ICYmICgwICE9PSAoYS5sYW5lcyAmIGIpICYmIChVZyA9ICEwKSwgYS5maXJzdENvbnRleHQgPSBudWxsKTt9CiAgICAgICAgICBmdW5jdGlvbiBWZyhhKSB7dmFyIGIgPSBhLl9jdXJyZW50VmFsdWU7aWYgKFBnICE9PSBhKSBpZiAoYSA9IHsgY29udGV4dDogYSwgbWVtb2l6ZWRWYWx1ZTogYiwgbmV4dDogbnVsbCB9LCBudWxsID09PSBPZykge2lmIChudWxsID09PSBOZykgdGhyb3cgRXJyb3IocCgzMDgpKTtPZyA9IGE7TmcuZGVwZW5kZW5jaWVzID0geyBsYW5lczogMCwgZmlyc3RDb250ZXh0OiBhIH07fSBlbHNlIE9nID0gT2cubmV4dCA9IGE7cmV0dXJuIGI7fXZhciBXZyA9IG51bGw7ZnVuY3Rpb24gWGcoYSkge251bGwgPT09IFdnID8gV2cgPSBbYV0gOiBXZy5wdXNoKGEpO31mdW5jdGlvbiBZZyhhLCBiLCBjLCBkKSB7dmFyIGUgPSBiLmludGVybGVhdmVkO251bGwgPT09IGUgPyAoYy5uZXh0ID0gYywgWGcoYikpIDogKGMubmV4dCA9IGUubmV4dCwgZS5uZXh0ID0gYyk7Yi5pbnRlcmxlYXZlZCA9IGM7cmV0dXJuIFpnKGEsIGQpO30KICAgICAgICAgIGZ1bmN0aW9uIFpnKGEsIGIpIHthLmxhbmVzIHw9IGI7dmFyIGMgPSBhLmFsdGVybmF0ZTtudWxsICE9PSBjICYmIChjLmxhbmVzIHw9IGIpO2MgPSBhO2ZvciAoYSA9IGEucmV0dXJuOyBudWxsICE9PSBhOykge2EuY2hpbGRMYW5lcyB8PSBiLCBjID0gYS5hbHRlcm5hdGUsIG51bGwgIT09IGMgJiYgKGMuY2hpbGRMYW5lcyB8PSBiKSwgYyA9IGEsIGEgPSBhLnJldHVybjt9cmV0dXJuIDMgPT09IGMudGFnID8gYy5zdGF0ZU5vZGUgOiBudWxsO312YXIgJGcgPSAhMTtmdW5jdGlvbiBhaChhKSB7YS51cGRhdGVRdWV1ZSA9IHsgYmFzZVN0YXRlOiBhLm1lbW9pemVkU3RhdGUsIGZpcnN0QmFzZVVwZGF0ZTogbnVsbCwgbGFzdEJhc2VVcGRhdGU6IG51bGwsIHNoYXJlZDogeyBwZW5kaW5nOiBudWxsLCBpbnRlcmxlYXZlZDogbnVsbCwgbGFuZXM6IDAgfSwgZWZmZWN0czogbnVsbCB9O30KICAgICAgICAgIGZ1bmN0aW9uIGJoKGEsIGIpIHthID0gYS51cGRhdGVRdWV1ZTtiLnVwZGF0ZVF1ZXVlID09PSBhICYmIChiLnVwZGF0ZVF1ZXVlID0geyBiYXNlU3RhdGU6IGEuYmFzZVN0YXRlLCBmaXJzdEJhc2VVcGRhdGU6IGEuZmlyc3RCYXNlVXBkYXRlLCBsYXN0QmFzZVVwZGF0ZTogYS5sYXN0QmFzZVVwZGF0ZSwgc2hhcmVkOiBhLnNoYXJlZCwgZWZmZWN0czogYS5lZmZlY3RzIH0pO31mdW5jdGlvbiBjaChhLCBiKSB7cmV0dXJuIHsgZXZlbnRUaW1lOiBhLCBsYW5lOiBiLCB0YWc6IDAsIHBheWxvYWQ6IG51bGwsIGNhbGxiYWNrOiBudWxsLCBuZXh0OiBudWxsIH07fQogICAgICAgICAgZnVuY3Rpb24gZGgoYSwgYiwgYykge3ZhciBkID0gYS51cGRhdGVRdWV1ZTtpZiAobnVsbCA9PT0gZCkgcmV0dXJuIG51bGw7ZCA9IGQuc2hhcmVkO2lmICgwICE9PSAoSyAmIDIpKSB7dmFyIGUgPSBkLnBlbmRpbmc7bnVsbCA9PT0gZSA/IGIubmV4dCA9IGIgOiAoYi5uZXh0ID0gZS5uZXh0LCBlLm5leHQgPSBiKTtkLnBlbmRpbmcgPSBiO3JldHVybiBaZyhhLCBjKTt9ZSA9IGQuaW50ZXJsZWF2ZWQ7bnVsbCA9PT0gZSA/IChiLm5leHQgPSBiLCBYZyhkKSkgOiAoYi5uZXh0ID0gZS5uZXh0LCBlLm5leHQgPSBiKTtkLmludGVybGVhdmVkID0gYjtyZXR1cm4gWmcoYSwgYyk7fWZ1bmN0aW9uIGVoKGEsIGIsIGMpIHtiID0gYi51cGRhdGVRdWV1ZTtpZiAobnVsbCAhPT0gYiAmJiAoYiA9IGIuc2hhcmVkLCAwICE9PSAoYyAmIDQxOTQyNDApKSkge3ZhciBkID0gYi5sYW5lcztkICY9IGEucGVuZGluZ0xhbmVzO2MgfD0gZDtiLmxhbmVzID0gYztDYyhhLCBjKTt9fQogICAgICAgICAgZnVuY3Rpb24gZmgoYSwgYikge3ZhciBjID0gYS51cGRhdGVRdWV1ZSxkID0gYS5hbHRlcm5hdGU7aWYgKG51bGwgIT09IGQgJiYgKGQgPSBkLnVwZGF0ZVF1ZXVlLCBjID09PSBkKSkge3ZhciBlID0gbnVsbCxmID0gbnVsbDtjID0gYy5maXJzdEJhc2VVcGRhdGU7aWYgKG51bGwgIT09IGMpIHtkbyB7dmFyIGcgPSB7IGV2ZW50VGltZTogYy5ldmVudFRpbWUsIGxhbmU6IGMubGFuZSwgdGFnOiBjLnRhZywgcGF5bG9hZDogYy5wYXlsb2FkLCBjYWxsYmFjazogYy5jYWxsYmFjaywgbmV4dDogbnVsbCB9O251bGwgPT09IGYgPyBlID0gZiA9IGcgOiBmID0gZi5uZXh0ID0gZztjID0gYy5uZXh0O30gd2hpbGUgKG51bGwgIT09IGMpO251bGwgPT09IGYgPyBlID0gZiA9IGIgOiBmID0gZi5uZXh0ID0gYjt9IGVsc2UgZSA9IGYgPSBiO2MgPSB7IGJhc2VTdGF0ZTogZC5iYXNlU3RhdGUsIGZpcnN0QmFzZVVwZGF0ZTogZSwgbGFzdEJhc2VVcGRhdGU6IGYsIHNoYXJlZDogZC5zaGFyZWQsIGVmZmVjdHM6IGQuZWZmZWN0cyB9O2EudXBkYXRlUXVldWUgPSBjO3JldHVybjt9YSA9IGMubGFzdEJhc2VVcGRhdGU7bnVsbCA9PT0gYSA/IGMuZmlyc3RCYXNlVXBkYXRlID0gYiA6IGEubmV4dCA9CiAgICAgICAgICAgIGI7Yy5sYXN0QmFzZVVwZGF0ZSA9IGI7fQogICAgICAgICAgZnVuY3Rpb24gZ2goYSwgYiwgYywgZCkge3ZhciBlID0gYS51cGRhdGVRdWV1ZTskZyA9ICExO3ZhciBmID0gZS5maXJzdEJhc2VVcGRhdGUsZyA9IGUubGFzdEJhc2VVcGRhdGUsaCA9IGUuc2hhcmVkLnBlbmRpbmc7aWYgKG51bGwgIT09IGgpIHtlLnNoYXJlZC5wZW5kaW5nID0gbnVsbDt2YXIgayA9IGgsbCA9IGsubmV4dDtrLm5leHQgPSBudWxsO251bGwgPT09IGcgPyBmID0gbCA6IGcubmV4dCA9IGw7ZyA9IGs7dmFyIG0gPSBhLmFsdGVybmF0ZTtudWxsICE9PSBtICYmIChtID0gbS51cGRhdGVRdWV1ZSwgaCA9IG0ubGFzdEJhc2VVcGRhdGUsIGggIT09IGcgJiYgKG51bGwgPT09IGggPyBtLmZpcnN0QmFzZVVwZGF0ZSA9IGwgOiBoLm5leHQgPSBsLCBtLmxhc3RCYXNlVXBkYXRlID0gaykpO31pZiAobnVsbCAhPT0gZikge3ZhciBxID0gZS5iYXNlU3RhdGU7ZyA9IDA7bSA9IGwgPSBrID0gbnVsbDtoID0gZjtkbyB7dmFyIHIgPSBoLmxhbmUseSA9IGguZXZlbnRUaW1lO2lmICgoZCAmIHIpID09PSByKSB7bnVsbCAhPT0gbSAmJiAobSA9IG0ubmV4dCA9IHsgZXZlbnRUaW1lOiB5LCBsYW5lOiAwLCB0YWc6IGgudGFnLCBwYXlsb2FkOiBoLnBheWxvYWQsIGNhbGxiYWNrOiBoLmNhbGxiYWNrLAogICAgICAgICAgICAgICAgICAgIG5leHQ6IG51bGwgfSk7YToge3ZhciBuID0gYSx0ID0gaDtyID0gYjt5ID0gYztzd2l0Y2ggKHQudGFnKSB7Y2FzZSAxOm4gPSB0LnBheWxvYWQ7aWYgKCJmdW5jdGlvbiIgPT09IHR5cGVvZiBuKSB7cSA9IG4uY2FsbCh5LCBxLCByKTticmVhayBhO31xID0gbjticmVhayBhO2Nhc2UgMzpuLmZsYWdzID0gbi5mbGFncyAmIC02NTUzNyB8IDEyODtjYXNlIDA6biA9IHQucGF5bG9hZDtyID0gImZ1bmN0aW9uIiA9PT0gdHlwZW9mIG4gPyBuLmNhbGwoeSwgcSwgcikgOiBuO2lmIChudWxsID09PSByIHx8IHZvaWQgMCA9PT0gcikgYnJlYWsgYTtxID0gQSh7fSwgcSwgcik7YnJlYWsgYTtjYXNlIDI6JGcgPSAhMDt9fW51bGwgIT09IGguY2FsbGJhY2sgJiYgMCAhPT0gaC5sYW5lICYmIChhLmZsYWdzIHw9IDY0LCByID0gZS5lZmZlY3RzLCBudWxsID09PSByID8gZS5lZmZlY3RzID0gW2hdIDogci5wdXNoKGgpKTt9IGVsc2UgeSA9IHsgZXZlbnRUaW1lOiB5LCBsYW5lOiByLCB0YWc6IGgudGFnLCBwYXlsb2FkOiBoLnBheWxvYWQsIGNhbGxiYWNrOiBoLmNhbGxiYWNrLCBuZXh0OiBudWxsIH0sIG51bGwgPT09IG0gPyAobCA9IG0gPSB5LCBrID0gcSkgOiBtID0gbS5uZXh0ID0geSwgZyB8PSByOwogICAgICAgICAgICAgICAgaCA9IGgubmV4dDtpZiAobnVsbCA9PT0gaCkgaWYgKGggPSBlLnNoYXJlZC5wZW5kaW5nLCBudWxsID09PSBoKSBicmVhaztlbHNlIHIgPSBoLCBoID0gci5uZXh0LCByLm5leHQgPSBudWxsLCBlLmxhc3RCYXNlVXBkYXRlID0gciwgZS5zaGFyZWQucGVuZGluZyA9IG51bGw7fSB3aGlsZSAoMSk7bnVsbCA9PT0gbSAmJiAoayA9IHEpO2UuYmFzZVN0YXRlID0gaztlLmZpcnN0QmFzZVVwZGF0ZSA9IGw7ZS5sYXN0QmFzZVVwZGF0ZSA9IG07YiA9IGUuc2hhcmVkLmludGVybGVhdmVkO2lmIChudWxsICE9PSBiKSB7ZSA9IGI7ZG8ge2cgfD0gZS5sYW5lLCBlID0gZS5uZXh0O30gd2hpbGUgKGUgIT09IGIpO30gZWxzZSBudWxsID09PSBmICYmIChlLnNoYXJlZC5sYW5lcyA9IDApO2hoIHw9IGc7YS5sYW5lcyA9IGc7YS5tZW1vaXplZFN0YXRlID0gcTt9fQogICAgICAgICAgZnVuY3Rpb24gaWgoYSwgYiwgYykge2EgPSBiLmVmZmVjdHM7Yi5lZmZlY3RzID0gbnVsbDtpZiAobnVsbCAhPT0gYSkgZm9yIChiID0gMDsgYiA8IGEubGVuZ3RoOyBiKyspIHt2YXIgZCA9IGFbYl0sZSA9IGQuY2FsbGJhY2s7aWYgKG51bGwgIT09IGUpIHtkLmNhbGxiYWNrID0gbnVsbDtkID0gYztpZiAoImZ1bmN0aW9uIiAhPT0gdHlwZW9mIGUpIHRocm93IEVycm9yKHAoMTkxLCBlKSk7ZS5jYWxsKGQpO319fXZhciBqaCA9IG5ldyBhYS5Db21wb25lbnQoKS5yZWZzO2Z1bmN0aW9uIGtoKGEsIGIsIGMsIGQpIHtiID0gYS5tZW1vaXplZFN0YXRlO2MgPSBjKGQsIGIpO2MgPSBudWxsID09PSBjIHx8IHZvaWQgMCA9PT0gYyA/IGIgOiBBKHt9LCBiLCBjKTthLm1lbW9pemVkU3RhdGUgPSBjOzAgPT09IGEubGFuZXMgJiYgKGEudXBkYXRlUXVldWUuYmFzZVN0YXRlID0gYyk7fQogICAgICAgICAgdmFyIG5oID0geyBpc01vdW50ZWQ6IGZ1bmN0aW9uIGlzTW91bnRlZChhKSB7cmV0dXJuIChhID0gYS5fcmVhY3RJbnRlcm5hbHMpID8gVmIoYSkgPT09IGEgOiAhMTt9LCBlbnF1ZXVlU2V0U3RhdGU6IGZ1bmN0aW9uIGVucXVldWVTZXRTdGF0ZShhLCBiLCBjKSB7YSA9IGEuX3JlYWN0SW50ZXJuYWxzO3ZhciBkID0gTCgpLGUgPSBsaChhKSxmID0gY2goZCwgZSk7Zi5wYXlsb2FkID0gYjt2b2lkIDAgIT09IGMgJiYgbnVsbCAhPT0gYyAmJiAoZi5jYWxsYmFjayA9IGMpO2IgPSBkaChhLCBmLCBlKTtudWxsICE9PSBiICYmIChtaChiLCBhLCBlLCBkKSwgZWgoYiwgYSwgZSkpO30sIGVucXVldWVSZXBsYWNlU3RhdGU6IGZ1bmN0aW9uIGVucXVldWVSZXBsYWNlU3RhdGUoYSwgYiwgYykge2EgPSBhLl9yZWFjdEludGVybmFsczt2YXIgZCA9IEwoKSxlID0gbGgoYSksZiA9IGNoKGQsIGUpO2YudGFnID0gMTtmLnBheWxvYWQgPSBiO3ZvaWQgMCAhPT0gYyAmJiBudWxsICE9PSBjICYmIChmLmNhbGxiYWNrID0gYyk7YiA9IGRoKGEsIGYsIGUpO251bGwgIT09IGIgJiYgKG1oKGIsIGEsIGUsIGQpLCBlaChiLCBhLCBlKSk7fSwgZW5xdWV1ZUZvcmNlVXBkYXRlOiBmdW5jdGlvbiBlbnF1ZXVlRm9yY2VVcGRhdGUoYSwgYikge2EgPSBhLl9yZWFjdEludGVybmFsczt2YXIgYyA9IEwoKSxkID0KICAgICAgICAgICAgICAgIGxoKGEpLGUgPSBjaChjLCBkKTtlLnRhZyA9IDI7dm9pZCAwICE9PSBiICYmIG51bGwgIT09IGIgJiYgKGUuY2FsbGJhY2sgPSBiKTtiID0gZGgoYSwgZSwgZCk7bnVsbCAhPT0gYiAmJiAobWgoYiwgYSwgZCwgYyksIGVoKGIsIGEsIGQpKTt9IH07ZnVuY3Rpb24gb2goYSwgYiwgYywgZCwgZSwgZiwgZykge2EgPSBhLnN0YXRlTm9kZTtyZXR1cm4gImZ1bmN0aW9uIiA9PT0gdHlwZW9mIGEuc2hvdWxkQ29tcG9uZW50VXBkYXRlID8gYS5zaG91bGRDb21wb25lbnRVcGRhdGUoZCwgZiwgZykgOiBiLnByb3RvdHlwZSAmJiBiLnByb3RvdHlwZS5pc1B1cmVSZWFjdENvbXBvbmVudCA/ICFJZShjLCBkKSB8fCAhSWUoZSwgZikgOiAhMDt9CiAgICAgICAgICBmdW5jdGlvbiBwaChhLCBiLCBjKSB7dmFyIGQgPSAhMSxlID0gVmY7dmFyIGYgPSBiLmNvbnRleHRUeXBlOyJvYmplY3QiID09PSB0eXBlb2YgZiAmJiBudWxsICE9PSBmID8gZiA9IFZnKGYpIDogKGUgPSBaZihiKSA/IFhmIDogSC5jdXJyZW50LCBkID0gYi5jb250ZXh0VHlwZXMsIGYgPSAoZCA9IG51bGwgIT09IGQgJiYgdm9pZCAwICE9PSBkKSA/IFlmKGEsIGUpIDogVmYpO2IgPSBuZXcgYihjLCBmKTthLm1lbW9pemVkU3RhdGUgPSBudWxsICE9PSBiLnN0YXRlICYmIHZvaWQgMCAhPT0gYi5zdGF0ZSA/IGIuc3RhdGUgOiBudWxsO2IudXBkYXRlciA9IG5oO2Euc3RhdGVOb2RlID0gYjtiLl9yZWFjdEludGVybmFscyA9IGE7ZCAmJiAoYSA9IGEuc3RhdGVOb2RlLCBhLl9fcmVhY3RJbnRlcm5hbE1lbW9pemVkVW5tYXNrZWRDaGlsZENvbnRleHQgPSBlLCBhLl9fcmVhY3RJbnRlcm5hbE1lbW9pemVkTWFza2VkQ2hpbGRDb250ZXh0ID0gZik7cmV0dXJuIGI7fQogICAgICAgICAgZnVuY3Rpb24gcWgoYSwgYiwgYywgZCkge2EgPSBiLnN0YXRlOyJmdW5jdGlvbiIgPT09IHR5cGVvZiBiLmNvbXBvbmVudFdpbGxSZWNlaXZlUHJvcHMgJiYgYi5jb21wb25lbnRXaWxsUmVjZWl2ZVByb3BzKGMsIGQpOyJmdW5jdGlvbiIgPT09IHR5cGVvZiBiLlVOU0FGRV9jb21wb25lbnRXaWxsUmVjZWl2ZVByb3BzICYmIGIuVU5TQUZFX2NvbXBvbmVudFdpbGxSZWNlaXZlUHJvcHMoYywgZCk7Yi5zdGF0ZSAhPT0gYSAmJiBuaC5lbnF1ZXVlUmVwbGFjZVN0YXRlKGIsIGIuc3RhdGUsIG51bGwpO30KICAgICAgICAgIGZ1bmN0aW9uIHJoKGEsIGIsIGMsIGQpIHt2YXIgZSA9IGEuc3RhdGVOb2RlO2UucHJvcHMgPSBjO2Uuc3RhdGUgPSBhLm1lbW9pemVkU3RhdGU7ZS5yZWZzID0gamg7YWgoYSk7dmFyIGYgPSBiLmNvbnRleHRUeXBlOyJvYmplY3QiID09PSB0eXBlb2YgZiAmJiBudWxsICE9PSBmID8gZS5jb250ZXh0ID0gVmcoZikgOiAoZiA9IFpmKGIpID8gWGYgOiBILmN1cnJlbnQsIGUuY29udGV4dCA9IFlmKGEsIGYpKTtlLnN0YXRlID0gYS5tZW1vaXplZFN0YXRlO2YgPSBiLmdldERlcml2ZWRTdGF0ZUZyb21Qcm9wczsiZnVuY3Rpb24iID09PSB0eXBlb2YgZiAmJiAoa2goYSwgYiwgZiwgYyksIGUuc3RhdGUgPSBhLm1lbW9pemVkU3RhdGUpOyJmdW5jdGlvbiIgPT09IHR5cGVvZiBiLmdldERlcml2ZWRTdGF0ZUZyb21Qcm9wcyB8fCAiZnVuY3Rpb24iID09PSB0eXBlb2YgZS5nZXRTbmFwc2hvdEJlZm9yZVVwZGF0ZSB8fCAiZnVuY3Rpb24iICE9PSB0eXBlb2YgZS5VTlNBRkVfY29tcG9uZW50V2lsbE1vdW50ICYmICJmdW5jdGlvbiIgIT09IHR5cGVvZiBlLmNvbXBvbmVudFdpbGxNb3VudCB8fCAoYiA9IGUuc3RhdGUsCiAgICAgICAgICAgICJmdW5jdGlvbiIgPT09IHR5cGVvZiBlLmNvbXBvbmVudFdpbGxNb3VudCAmJiBlLmNvbXBvbmVudFdpbGxNb3VudCgpLCAiZnVuY3Rpb24iID09PSB0eXBlb2YgZS5VTlNBRkVfY29tcG9uZW50V2lsbE1vdW50ICYmIGUuVU5TQUZFX2NvbXBvbmVudFdpbGxNb3VudCgpLCBiICE9PSBlLnN0YXRlICYmIG5oLmVucXVldWVSZXBsYWNlU3RhdGUoZSwgZS5zdGF0ZSwgbnVsbCksIGdoKGEsIGMsIGUsIGQpLCBlLnN0YXRlID0gYS5tZW1vaXplZFN0YXRlKTsiZnVuY3Rpb24iID09PSB0eXBlb2YgZS5jb21wb25lbnREaWRNb3VudCAmJiAoYS5mbGFncyB8PSA0MTk0MzA4KTt9CiAgICAgICAgICBmdW5jdGlvbiBzaChhLCBiLCBjKSB7YSA9IGMucmVmO2lmIChudWxsICE9PSBhICYmICJmdW5jdGlvbiIgIT09IHR5cGVvZiBhICYmICJvYmplY3QiICE9PSB0eXBlb2YgYSkge2lmIChjLl9vd25lcikge2MgPSBjLl9vd25lcjtpZiAoYykge2lmICgxICE9PSBjLnRhZykgdGhyb3cgRXJyb3IocCgzMDkpKTt2YXIgZCA9IGMuc3RhdGVOb2RlO31pZiAoIWQpIHRocm93IEVycm9yKHAoMTQ3LCBhKSk7dmFyIGUgPSBkLGYgPSAiIiArIGE7aWYgKG51bGwgIT09IGIgJiYgbnVsbCAhPT0gYi5yZWYgJiYgImZ1bmN0aW9uIiA9PT0gdHlwZW9mIGIucmVmICYmIGIucmVmLl9zdHJpbmdSZWYgPT09IGYpIHJldHVybiBiLnJlZjtiID0gZnVuY3Rpb24gYihhKSB7dmFyIGIgPSBlLnJlZnM7YiA9PT0gamggJiYgKGIgPSBlLnJlZnMgPSB7fSk7bnVsbCA9PT0gYSA/IGRlbGV0ZSBiW2ZdIDogYltmXSA9IGE7fTtiLl9zdHJpbmdSZWYgPSBmO3JldHVybiBiO31pZiAoInN0cmluZyIgIT09IHR5cGVvZiBhKSB0aHJvdyBFcnJvcihwKDI4NCkpO2lmICghYy5fb3duZXIpIHRocm93IEVycm9yKHAoMjkwLCBhKSk7fXJldHVybiBhO30KICAgICAgICAgIGZ1bmN0aW9uIHRoKGEsIGIpIHthID0gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKGIpO3Rocm93IEVycm9yKHAoMzEsICJbb2JqZWN0IE9iamVjdF0iID09PSBhID8gIm9iamVjdCB3aXRoIGtleXMgeyIgKyBPYmplY3Qua2V5cyhiKS5qb2luKCIsICIpICsgIn0iIDogYSkpO31mdW5jdGlvbiB1aChhKSB7dmFyIGIgPSBhLl9pbml0O3JldHVybiBiKGEuX3BheWxvYWQpO30KICAgICAgICAgIGZ1bmN0aW9uIHZoKGEpIHtmdW5jdGlvbiBiKGIsIGMpIHtpZiAoYSkge3ZhciBkID0gYi5kZWxldGlvbnM7bnVsbCA9PT0gZCA/IChiLmRlbGV0aW9ucyA9IFtjXSwgYi5mbGFncyB8PSAxNikgOiBkLnB1c2goYyk7fX1mdW5jdGlvbiBjKGMsIGQpIHtpZiAoIWEpIHJldHVybiBudWxsO2ZvciAoOyBudWxsICE9PSBkOykge2IoYywgZCksIGQgPSBkLnNpYmxpbmc7fXJldHVybiBudWxsO31mdW5jdGlvbiBkKGEsIGIpIHtmb3IgKGEgPSBuZXcgTWFwKCk7IG51bGwgIT09IGI7KSB7bnVsbCAhPT0gYi5rZXkgPyBhLnNldChiLmtleSwgYikgOiBhLnNldChiLmluZGV4LCBiKSwgYiA9IGIuc2libGluZzt9cmV0dXJuIGE7fWZ1bmN0aW9uIGUoYSwgYikge2EgPSB3aChhLCBiKTthLmluZGV4ID0gMDthLnNpYmxpbmcgPSBudWxsO3JldHVybiBhO31mdW5jdGlvbiBmKGIsIGMsIGQpIHtiLmluZGV4ID0gZDtpZiAoIWEpIHJldHVybiBiLmZsYWdzIHw9IDEwNDg1NzYsIGM7ZCA9IGIuYWx0ZXJuYXRlO2lmIChudWxsICE9PSBkKSByZXR1cm4gZCA9IGQuaW5kZXgsIGQgPCBjID8gKGIuZmxhZ3MgfD0gMiwgYykgOiBkO2IuZmxhZ3MgfD0gMjtyZXR1cm4gYzt9ZnVuY3Rpb24gZyhiKSB7YSAmJgogICAgICAgICAgICAgIG51bGwgPT09IGIuYWx0ZXJuYXRlICYmIChiLmZsYWdzIHw9IDIpO3JldHVybiBiO31mdW5jdGlvbiBoKGEsIGIsIGMsIGQpIHtpZiAobnVsbCA9PT0gYiB8fCA2ICE9PSBiLnRhZykgcmV0dXJuIGIgPSB4aChjLCBhLm1vZGUsIGQpLCBiLnJldHVybiA9IGEsIGI7YiA9IGUoYiwgYyk7Yi5yZXR1cm4gPSBhO3JldHVybiBiO31mdW5jdGlvbiBrKGEsIGIsIGMsIGQpIHt2YXIgZiA9IGMudHlwZTtpZiAoZiA9PT0geWEpIHJldHVybiBtKGEsIGIsIGMucHJvcHMuY2hpbGRyZW4sIGQsIGMua2V5KTtpZiAobnVsbCAhPT0gYiAmJiAoYi5lbGVtZW50VHlwZSA9PT0gZiB8fCAib2JqZWN0IiA9PT0gdHlwZW9mIGYgJiYgbnVsbCAhPT0gZiAmJiBmLiQkdHlwZW9mID09PSBIYSAmJiB1aChmKSA9PT0gYi50eXBlKSkgcmV0dXJuIGQgPSBlKGIsIGMucHJvcHMpLCBkLnJlZiA9IHNoKGEsIGIsIGMpLCBkLnJldHVybiA9IGEsIGQ7ZCA9IHloKGMudHlwZSwgYy5rZXksIGMucHJvcHMsIG51bGwsIGEubW9kZSwgZCk7ZC5yZWYgPSBzaChhLCBiLCBjKTtkLnJldHVybiA9IGE7cmV0dXJuIGQ7fWZ1bmN0aW9uIGwoYSwgYiwgYywgZCkge2lmIChudWxsID09PSBiIHx8IDQgIT09IGIudGFnIHx8CiAgICAgICAgICAgICAgYi5zdGF0ZU5vZGUuY29udGFpbmVySW5mbyAhPT0gYy5jb250YWluZXJJbmZvIHx8IGIuc3RhdGVOb2RlLmltcGxlbWVudGF0aW9uICE9PSBjLmltcGxlbWVudGF0aW9uKSByZXR1cm4gYiA9IHpoKGMsIGEubW9kZSwgZCksIGIucmV0dXJuID0gYSwgYjtiID0gZShiLCBjLmNoaWxkcmVuIHx8IFtdKTtiLnJldHVybiA9IGE7cmV0dXJuIGI7fWZ1bmN0aW9uIG0oYSwgYiwgYywgZCwgZikge2lmIChudWxsID09PSBiIHx8IDcgIT09IGIudGFnKSByZXR1cm4gYiA9IEFoKGMsIGEubW9kZSwgZCwgZiksIGIucmV0dXJuID0gYSwgYjtiID0gZShiLCBjKTtiLnJldHVybiA9IGE7cmV0dXJuIGI7fWZ1bmN0aW9uIHEoYSwgYiwgYykge2lmICgic3RyaW5nIiA9PT0gdHlwZW9mIGIgJiYgIiIgIT09IGIgfHwgIm51bWJlciIgPT09IHR5cGVvZiBiKSByZXR1cm4gYiA9IHhoKCIiICsgYiwgYS5tb2RlLCBjKSwgYi5yZXR1cm4gPSBhLCBiO2lmICgib2JqZWN0IiA9PT0gdHlwZW9mIGIgJiYgbnVsbCAhPT0gYikge3N3aXRjaCAoYi4kJHR5cGVvZikge2Nhc2UgdmE6cmV0dXJuIGMgPSB5aChiLnR5cGUsIGIua2V5LCBiLnByb3BzLCBudWxsLCBhLm1vZGUsIGMpLAogICAgICAgICAgICAgICAgICAgIGMucmVmID0gc2goYSwgbnVsbCwgYiksIGMucmV0dXJuID0gYSwgYztjYXNlIHdhOnJldHVybiBiID0gemgoYiwgYS5tb2RlLCBjKSwgYi5yZXR1cm4gPSBhLCBiO2Nhc2UgSGE6dmFyIGQgPSBiLl9pbml0O3JldHVybiBxKGEsIGQoYi5fcGF5bG9hZCksIGMpO31pZiAoZWIoYikgfHwgS2EoYikpIHJldHVybiBiID0gQWgoYiwgYS5tb2RlLCBjLCBudWxsKSwgYi5yZXR1cm4gPSBhLCBiO3RoKGEsIGIpO31yZXR1cm4gbnVsbDt9ZnVuY3Rpb24gcihhLCBiLCBjLCBkKSB7dmFyIGUgPSBudWxsICE9PSBiID8gYi5rZXkgOiBudWxsO2lmICgic3RyaW5nIiA9PT0gdHlwZW9mIGMgJiYgIiIgIT09IGMgfHwgIm51bWJlciIgPT09IHR5cGVvZiBjKSByZXR1cm4gbnVsbCAhPT0gZSA/IG51bGwgOiBoKGEsIGIsICIiICsgYywgZCk7aWYgKCJvYmplY3QiID09PSB0eXBlb2YgYyAmJiBudWxsICE9PSBjKSB7c3dpdGNoIChjLiQkdHlwZW9mKSB7Y2FzZSB2YTpyZXR1cm4gYy5rZXkgPT09IGUgPyBrKGEsIGIsIGMsIGQpIDogbnVsbDtjYXNlIHdhOnJldHVybiBjLmtleSA9PT0gZSA/IGwoYSwgYiwgYywgZCkgOiBudWxsO2Nhc2UgSGE6cmV0dXJuIGUgPSBjLl9pbml0LCByKGEsCiAgICAgICAgICAgICAgICAgICAgYiwgZShjLl9wYXlsb2FkKSwgZCk7fWlmIChlYihjKSB8fCBLYShjKSkgcmV0dXJuIG51bGwgIT09IGUgPyBudWxsIDogbShhLCBiLCBjLCBkLCBudWxsKTt0aChhLCBjKTt9cmV0dXJuIG51bGw7fWZ1bmN0aW9uIHkoYSwgYiwgYywgZCwgZSkge2lmICgic3RyaW5nIiA9PT0gdHlwZW9mIGQgJiYgIiIgIT09IGQgfHwgIm51bWJlciIgPT09IHR5cGVvZiBkKSByZXR1cm4gYSA9IGEuZ2V0KGMpIHx8IG51bGwsIGgoYiwgYSwgIiIgKyBkLCBlKTtpZiAoIm9iamVjdCIgPT09IHR5cGVvZiBkICYmIG51bGwgIT09IGQpIHtzd2l0Y2ggKGQuJCR0eXBlb2YpIHtjYXNlIHZhOnJldHVybiBhID0gYS5nZXQobnVsbCA9PT0gZC5rZXkgPyBjIDogZC5rZXkpIHx8IG51bGwsIGsoYiwgYSwgZCwgZSk7Y2FzZSB3YTpyZXR1cm4gYSA9IGEuZ2V0KG51bGwgPT09IGQua2V5ID8gYyA6IGQua2V5KSB8fCBudWxsLCBsKGIsIGEsIGQsIGUpO2Nhc2UgSGE6dmFyIGYgPSBkLl9pbml0O3JldHVybiB5KGEsIGIsIGMsIGYoZC5fcGF5bG9hZCksIGUpO31pZiAoZWIoZCkgfHwgS2EoZCkpIHJldHVybiBhID0gYS5nZXQoYykgfHwgbnVsbCwgbShiLCBhLCBkLCBlLCBudWxsKTt0aChiLCBkKTt9cmV0dXJuIG51bGw7fQogICAgICAgICAgICBmdW5jdGlvbiBuKGUsIGcsIGgsIGspIHtmb3IgKHZhciBsID0gbnVsbCwgbSA9IG51bGwsIHUgPSBnLCB3ID0gZyA9IDAsIHggPSBudWxsOyBudWxsICE9PSB1ICYmIHcgPCBoLmxlbmd0aDsgdysrKSB7dS5pbmRleCA+IHcgPyAoeCA9IHUsIHUgPSBudWxsKSA6IHggPSB1LnNpYmxpbmc7dmFyIG4gPSByKGUsIHUsIGhbd10sIGspO2lmIChudWxsID09PSBuKSB7bnVsbCA9PT0gdSAmJiAodSA9IHgpO2JyZWFrO31hICYmIHUgJiYgbnVsbCA9PT0gbi5hbHRlcm5hdGUgJiYgYihlLCB1KTtnID0gZihuLCBnLCB3KTtudWxsID09PSBtID8gbCA9IG4gOiBtLnNpYmxpbmcgPSBuO20gPSBuO3UgPSB4O31pZiAodyA9PT0gaC5sZW5ndGgpIHJldHVybiBjKGUsIHUpLCBJICYmIHRnKGUsIHcpLCBsO2lmIChudWxsID09PSB1KSB7Zm9yICg7IHcgPCBoLmxlbmd0aDsgdysrKSB7dSA9IHEoZSwgaFt3XSwgayksIG51bGwgIT09IHUgJiYgKGcgPSBmKHUsIGcsIHcpLCBudWxsID09PSBtID8gbCA9IHUgOiBtLnNpYmxpbmcgPSB1LCBtID0gdSk7fUkgJiYgdGcoZSwgdyk7cmV0dXJuIGw7fWZvciAodSA9IGQoZSwgdSk7IHcgPCBoLmxlbmd0aDsgdysrKSB7eCA9IHkodSwgZSwgdywgaFt3XSwgayksIG51bGwgIT09IHggJiYgKGEgJiYgbnVsbCAhPT0geC5hbHRlcm5hdGUgJiYgdS5kZWxldGUobnVsbCA9PT0KICAgICAgICAgICAgICAgIHgua2V5ID8gdyA6IHgua2V5KSwgZyA9IGYoeCwgZywgdyksIG51bGwgPT09IG0gPyBsID0geCA6IG0uc2libGluZyA9IHgsIG0gPSB4KTt9YSAmJiB1LmZvckVhY2goZnVuY3Rpb24gKGEpIHtyZXR1cm4gYihlLCBhKTt9KTtJICYmIHRnKGUsIHcpO3JldHVybiBsO31mdW5jdGlvbiB0KGUsIGcsIGgsIGspIHt2YXIgbCA9IEthKGgpO2lmICgiZnVuY3Rpb24iICE9PSB0eXBlb2YgbCkgdGhyb3cgRXJyb3IocCgxNTApKTtoID0gbC5jYWxsKGgpO2lmIChudWxsID09IGgpIHRocm93IEVycm9yKHAoMTUxKSk7Zm9yICh2YXIgdSA9IGwgPSBudWxsLCBtID0gZywgdyA9IGcgPSAwLCB4ID0gbnVsbCwgbiA9IGgubmV4dCgpOyBudWxsICE9PSBtICYmICFuLmRvbmU7IHcrKywgbiA9IGgubmV4dCgpKSB7bS5pbmRleCA+IHcgPyAoeCA9IG0sIG0gPSBudWxsKSA6IHggPSBtLnNpYmxpbmc7dmFyIHQgPSByKGUsIG0sIG4udmFsdWUsIGspO2lmIChudWxsID09PSB0KSB7bnVsbCA9PT0gbSAmJiAobSA9IHgpO2JyZWFrO31hICYmIG0gJiYgbnVsbCA9PT0gdC5hbHRlcm5hdGUgJiYgYihlLCBtKTtnID0gZih0LCBnLCB3KTtudWxsID09PSB1ID8gbCA9IHQgOiB1LnNpYmxpbmcgPSB0O3UgPSB0O20gPSB4O31pZiAobi5kb25lKSByZXR1cm4gYyhlLAogICAgICAgICAgICAgIG0pLCBJICYmIHRnKGUsIHcpLCBsO2lmIChudWxsID09PSBtKSB7Zm9yICg7ICFuLmRvbmU7IHcrKywgbiA9IGgubmV4dCgpKSB7biA9IHEoZSwgbi52YWx1ZSwgayksIG51bGwgIT09IG4gJiYgKGcgPSBmKG4sIGcsIHcpLCBudWxsID09PSB1ID8gbCA9IG4gOiB1LnNpYmxpbmcgPSBuLCB1ID0gbik7fUkgJiYgdGcoZSwgdyk7cmV0dXJuIGw7fWZvciAobSA9IGQoZSwgbSk7ICFuLmRvbmU7IHcrKywgbiA9IGgubmV4dCgpKSB7biA9IHkobSwgZSwgdywgbi52YWx1ZSwgayksIG51bGwgIT09IG4gJiYgKGEgJiYgbnVsbCAhPT0gbi5hbHRlcm5hdGUgJiYgbS5kZWxldGUobnVsbCA9PT0gbi5rZXkgPyB3IDogbi5rZXkpLCBnID0gZihuLCBnLCB3KSwgbnVsbCA9PT0gdSA/IGwgPSBuIDogdS5zaWJsaW5nID0gbiwgdSA9IG4pO31hICYmIG0uZm9yRWFjaChmdW5jdGlvbiAoYSkge3JldHVybiBiKGUsIGEpO30pO0kgJiYgdGcoZSwgdyk7cmV0dXJuIGw7fWZ1bmN0aW9uIEooYSwgZCwgZiwgaCkgeyJvYmplY3QiID09PSB0eXBlb2YgZiAmJiBudWxsICE9PSBmICYmIGYudHlwZSA9PT0geWEgJiYgbnVsbCA9PT0gZi5rZXkgJiYgKGYgPSBmLnByb3BzLmNoaWxkcmVuKTtpZiAoIm9iamVjdCIgPT09IHR5cGVvZiBmICYmIG51bGwgIT09IGYpIHtzd2l0Y2ggKGYuJCR0eXBlb2YpIHtjYXNlIHZhOmE6IHtmb3IgKHZhciBrID0KICAgICAgICAgICAgICAgICAgICAgICAgZi5rZXksIGwgPSBkOyBudWxsICE9PSBsOykge2lmIChsLmtleSA9PT0gaykge2sgPSBmLnR5cGU7aWYgKGsgPT09IHlhKSB7aWYgKDcgPT09IGwudGFnKSB7YyhhLCBsLnNpYmxpbmcpO2QgPSBlKGwsIGYucHJvcHMuY2hpbGRyZW4pO2QucmV0dXJuID0gYTthID0gZDticmVhayBhO319IGVsc2UgaWYgKGwuZWxlbWVudFR5cGUgPT09IGsgfHwgIm9iamVjdCIgPT09IHR5cGVvZiBrICYmIG51bGwgIT09IGsgJiYgay4kJHR5cGVvZiA9PT0gSGEgJiYgdWgoaykgPT09IGwudHlwZSkge2MoYSwgbC5zaWJsaW5nKTtkID0gZShsLCBmLnByb3BzKTtkLnJlZiA9IHNoKGEsIGwsIGYpO2QucmV0dXJuID0gYTthID0gZDticmVhayBhO31jKGEsIGwpO2JyZWFrO30gZWxzZSBiKGEsIGwpO2wgPSBsLnNpYmxpbmc7fWYudHlwZSA9PT0geWEgPyAoZCA9IEFoKGYucHJvcHMuY2hpbGRyZW4sIGEubW9kZSwgaCwgZi5rZXkpLCBkLnJldHVybiA9IGEsIGEgPSBkKSA6IChoID0geWgoZi50eXBlLCBmLmtleSwgZi5wcm9wcywgbnVsbCwgYS5tb2RlLCBoKSwgaC5yZWYgPSBzaChhLCBkLCBmKSwgaC5yZXR1cm4gPSBhLCBhID0gaCk7fXJldHVybiBnKGEpO2Nhc2Ugd2E6YToge2ZvciAobCA9IGYua2V5OyBudWxsICE9PQogICAgICAgICAgICAgICAgICAgICAgZDspIHtpZiAoZC5rZXkgPT09IGwpIHtpZiAoNCA9PT0gZC50YWcgJiYgZC5zdGF0ZU5vZGUuY29udGFpbmVySW5mbyA9PT0gZi5jb250YWluZXJJbmZvICYmIGQuc3RhdGVOb2RlLmltcGxlbWVudGF0aW9uID09PSBmLmltcGxlbWVudGF0aW9uKSB7YyhhLCBkLnNpYmxpbmcpO2QgPSBlKGQsIGYuY2hpbGRyZW4gfHwgW10pO2QucmV0dXJuID0gYTthID0gZDticmVhayBhO30gZWxzZSB7YyhhLCBkKTticmVhazt9fSBlbHNlIGIoYSwgZCk7ZCA9IGQuc2libGluZzt9ZCA9IHpoKGYsIGEubW9kZSwgaCk7ZC5yZXR1cm4gPSBhO2EgPSBkO31yZXR1cm4gZyhhKTtjYXNlIEhhOnJldHVybiBsID0gZi5faW5pdCwgSihhLCBkLCBsKGYuX3BheWxvYWQpLCBoKTt9aWYgKGViKGYpKSByZXR1cm4gbihhLCBkLCBmLCBoKTtpZiAoS2EoZikpIHJldHVybiB0KGEsIGQsIGYsIGgpO3RoKGEsIGYpO31yZXR1cm4gInN0cmluZyIgPT09IHR5cGVvZiBmICYmICIiICE9PSBmIHx8ICJudW1iZXIiID09PSB0eXBlb2YgZiA/IChmID0gIiIgKyBmLCBudWxsICE9PSBkICYmIDYgPT09IGQudGFnID8gKGMoYSwgZC5zaWJsaW5nKSwgZCA9IGUoZCwgZiksIGQucmV0dXJuID0gYSwgYSA9IGQpIDogKAogICAgICAgICAgICAgIGMoYSwgZCksIGQgPSB4aChmLCBhLm1vZGUsIGgpLCBkLnJldHVybiA9IGEsIGEgPSBkKSwgZyhhKSkgOiBjKGEsIGQpO31yZXR1cm4gSjt9dmFyIEJoID0gdmgoITApLENoID0gdmgoITEpLERoID0ge30sRWggPSBVZihEaCksRmggPSBVZihEaCksR2ggPSBVZihEaCk7ZnVuY3Rpb24gSGgoYSkge2lmIChhID09PSBEaCkgdGhyb3cgRXJyb3IocCgxNzQpKTtyZXR1cm4gYTt9ZnVuY3Rpb24gSWgoYSwgYikge0coR2gsIGIpO0coRmgsIGEpO0coRWgsIERoKTthID0gYi5ub2RlVHlwZTtzd2l0Y2ggKGEpIHtjYXNlIDk6Y2FzZSAxMTpiID0gKGIgPSBiLmRvY3VtZW50RWxlbWVudCkgPyBiLm5hbWVzcGFjZVVSSSA6IGxiKG51bGwsICIiKTticmVhaztkZWZhdWx0OmEgPSA4ID09PSBhID8gYi5wYXJlbnROb2RlIDogYiwgYiA9IGEubmFtZXNwYWNlVVJJIHx8IG51bGwsIGEgPSBhLnRhZ05hbWUsIGIgPSBsYihiLCBhKTt9RShFaCk7RyhFaCwgYik7fWZ1bmN0aW9uIEpoKCkge0UoRWgpO0UoRmgpO0UoR2gpO30KICAgICAgICAgIGZ1bmN0aW9uIEtoKGEpIHtIaChHaC5jdXJyZW50KTt2YXIgYiA9IEhoKEVoLmN1cnJlbnQpO3ZhciBjID0gbGIoYiwgYS50eXBlKTtiICE9PSBjICYmIChHKEZoLCBhKSwgRyhFaCwgYykpO31mdW5jdGlvbiBMaChhKSB7RmguY3VycmVudCA9PT0gYSAmJiAoRShFaCksIEUoRmgpKTt9dmFyIE0gPSBVZigwKTsKICAgICAgICAgIGZ1bmN0aW9uIE1oKGEpIHtmb3IgKHZhciBiID0gYTsgbnVsbCAhPT0gYjspIHtpZiAoMTMgPT09IGIudGFnKSB7dmFyIGMgPSBiLm1lbW9pemVkU3RhdGU7aWYgKG51bGwgIT09IGMgJiYgKGMgPSBjLmRlaHlkcmF0ZWQsIG51bGwgPT09IGMgfHwgIiQ/IiA9PT0gYy5kYXRhIHx8ICIkISIgPT09IGMuZGF0YSkpIHJldHVybiBiO30gZWxzZSBpZiAoMTkgPT09IGIudGFnICYmIHZvaWQgMCAhPT0gYi5tZW1vaXplZFByb3BzLnJldmVhbE9yZGVyKSB7aWYgKDAgIT09IChiLmZsYWdzICYgMTI4KSkgcmV0dXJuIGI7fSBlbHNlIGlmIChudWxsICE9PSBiLmNoaWxkKSB7Yi5jaGlsZC5yZXR1cm4gPSBiO2IgPSBiLmNoaWxkO2NvbnRpbnVlO31pZiAoYiA9PT0gYSkgYnJlYWs7Zm9yICg7IG51bGwgPT09IGIuc2libGluZzspIHtpZiAobnVsbCA9PT0gYi5yZXR1cm4gfHwgYi5yZXR1cm4gPT09IGEpIHJldHVybiBudWxsO2IgPSBiLnJldHVybjt9Yi5zaWJsaW5nLnJldHVybiA9IGIucmV0dXJuO2IgPSBiLnNpYmxpbmc7fXJldHVybiBudWxsO312YXIgTmggPSBbXTsKICAgICAgICAgIGZ1bmN0aW9uIE9oKCkge2ZvciAodmFyIGEgPSAwOyBhIDwgTmgubGVuZ3RoOyBhKyspIHtOaFthXS5fd29ya0luUHJvZ3Jlc3NWZXJzaW9uUHJpbWFyeSA9IG51bGw7fU5oLmxlbmd0aCA9IDA7fXZhciBQaCA9IHVhLlJlYWN0Q3VycmVudERpc3BhdGNoZXIsUWggPSB1YS5SZWFjdEN1cnJlbnRCYXRjaENvbmZpZyxSaCA9IDAsTiA9IG51bGwsTyA9IG51bGwsUCA9IG51bGwsU2ggPSAhMSxUaCA9ICExLFVoID0gMCxWaCA9IDA7ZnVuY3Rpb24gUSgpIHt0aHJvdyBFcnJvcihwKDMyMSkpO31mdW5jdGlvbiBXaChhLCBiKSB7aWYgKG51bGwgPT09IGIpIHJldHVybiAhMTtmb3IgKHZhciBjID0gMDsgYyA8IGIubGVuZ3RoICYmIGMgPCBhLmxlbmd0aDsgYysrKSB7aWYgKCFIZShhW2NdLCBiW2NdKSkgcmV0dXJuICExO31yZXR1cm4gITA7fQogICAgICAgICAgZnVuY3Rpb24gWGgoYSwgYiwgYywgZCwgZSwgZikge1JoID0gZjtOID0gYjtiLm1lbW9pemVkU3RhdGUgPSBudWxsO2IudXBkYXRlUXVldWUgPSBudWxsO2IubGFuZXMgPSAwO1BoLmN1cnJlbnQgPSBudWxsID09PSBhIHx8IG51bGwgPT09IGEubWVtb2l6ZWRTdGF0ZSA/IFloIDogWmg7YSA9IGMoZCwgZSk7aWYgKFRoKSB7ZiA9IDA7ZG8ge1RoID0gITE7VWggPSAwO2lmICgyNSA8PSBmKSB0aHJvdyBFcnJvcihwKDMwMSkpO2YgKz0gMTtQID0gTyA9IG51bGw7Yi51cGRhdGVRdWV1ZSA9IG51bGw7UGguY3VycmVudCA9ICRoO2EgPSBjKGQsIGUpO30gd2hpbGUgKFRoKTt9UGguY3VycmVudCA9IGFpO2IgPSBudWxsICE9PSBPICYmIG51bGwgIT09IE8ubmV4dDtSaCA9IDA7UCA9IE8gPSBOID0gbnVsbDtTaCA9ICExO2lmIChiKSB0aHJvdyBFcnJvcihwKDMwMCkpO3JldHVybiBhO31mdW5jdGlvbiBiaSgpIHt2YXIgYSA9IDAgIT09IFVoO1VoID0gMDtyZXR1cm4gYTt9CiAgICAgICAgICBmdW5jdGlvbiBjaSgpIHt2YXIgYSA9IHsgbWVtb2l6ZWRTdGF0ZTogbnVsbCwgYmFzZVN0YXRlOiBudWxsLCBiYXNlUXVldWU6IG51bGwsIHF1ZXVlOiBudWxsLCBuZXh0OiBudWxsIH07bnVsbCA9PT0gUCA/IE4ubWVtb2l6ZWRTdGF0ZSA9IFAgPSBhIDogUCA9IFAubmV4dCA9IGE7cmV0dXJuIFA7fWZ1bmN0aW9uIGRpKCkge2lmIChudWxsID09PSBPKSB7dmFyIGEgPSBOLmFsdGVybmF0ZTthID0gbnVsbCAhPT0gYSA/IGEubWVtb2l6ZWRTdGF0ZSA6IG51bGw7fSBlbHNlIGEgPSBPLm5leHQ7dmFyIGIgPSBudWxsID09PSBQID8gTi5tZW1vaXplZFN0YXRlIDogUC5uZXh0O2lmIChudWxsICE9PSBiKSBQID0gYiwgTyA9IGE7ZWxzZSB7aWYgKG51bGwgPT09IGEpIHRocm93IEVycm9yKHAoMzEwKSk7TyA9IGE7YSA9IHsgbWVtb2l6ZWRTdGF0ZTogTy5tZW1vaXplZFN0YXRlLCBiYXNlU3RhdGU6IE8uYmFzZVN0YXRlLCBiYXNlUXVldWU6IE8uYmFzZVF1ZXVlLCBxdWV1ZTogTy5xdWV1ZSwgbmV4dDogbnVsbCB9O251bGwgPT09IFAgPyBOLm1lbW9pemVkU3RhdGUgPSBQID0gYSA6IFAgPSBQLm5leHQgPSBhO31yZXR1cm4gUDt9CiAgICAgICAgICBmdW5jdGlvbiBlaShhLCBiKSB7cmV0dXJuICJmdW5jdGlvbiIgPT09IHR5cGVvZiBiID8gYihhKSA6IGI7fQogICAgICAgICAgZnVuY3Rpb24gZmkoYSkge3ZhciBiID0gZGkoKSxjID0gYi5xdWV1ZTtpZiAobnVsbCA9PT0gYykgdGhyb3cgRXJyb3IocCgzMTEpKTtjLmxhc3RSZW5kZXJlZFJlZHVjZXIgPSBhO3ZhciBkID0gTyxlID0gZC5iYXNlUXVldWUsZiA9IGMucGVuZGluZztpZiAobnVsbCAhPT0gZikge2lmIChudWxsICE9PSBlKSB7dmFyIGcgPSBlLm5leHQ7ZS5uZXh0ID0gZi5uZXh0O2YubmV4dCA9IGc7fWQuYmFzZVF1ZXVlID0gZSA9IGY7Yy5wZW5kaW5nID0gbnVsbDt9aWYgKG51bGwgIT09IGUpIHtmID0gZS5uZXh0O2QgPSBkLmJhc2VTdGF0ZTt2YXIgaCA9IGcgPSBudWxsLGsgPSBudWxsLGwgPSBmO2RvIHt2YXIgbSA9IGwubGFuZTtpZiAoKFJoICYgbSkgPT09IG0pIG51bGwgIT09IGsgJiYgKGsgPSBrLm5leHQgPSB7IGxhbmU6IDAsIGFjdGlvbjogbC5hY3Rpb24sIGhhc0VhZ2VyU3RhdGU6IGwuaGFzRWFnZXJTdGF0ZSwgZWFnZXJTdGF0ZTogbC5lYWdlclN0YXRlLCBuZXh0OiBudWxsIH0pLCBkID0gbC5oYXNFYWdlclN0YXRlID8gbC5lYWdlclN0YXRlIDogYShkLCBsLmFjdGlvbik7ZWxzZSB7dmFyIHEgPSB7IGxhbmU6IG0sIGFjdGlvbjogbC5hY3Rpb24sIGhhc0VhZ2VyU3RhdGU6IGwuaGFzRWFnZXJTdGF0ZSwKICAgICAgICAgICAgICAgICAgICBlYWdlclN0YXRlOiBsLmVhZ2VyU3RhdGUsIG5leHQ6IG51bGwgfTtudWxsID09PSBrID8gKGggPSBrID0gcSwgZyA9IGQpIDogayA9IGsubmV4dCA9IHE7Ti5sYW5lcyB8PSBtO2hoIHw9IG07fWwgPSBsLm5leHQ7fSB3aGlsZSAobnVsbCAhPT0gbCAmJiBsICE9PSBmKTtudWxsID09PSBrID8gZyA9IGQgOiBrLm5leHQgPSBoO0hlKGQsIGIubWVtb2l6ZWRTdGF0ZSkgfHwgKFVnID0gITApO2IubWVtb2l6ZWRTdGF0ZSA9IGQ7Yi5iYXNlU3RhdGUgPSBnO2IuYmFzZVF1ZXVlID0gaztjLmxhc3RSZW5kZXJlZFN0YXRlID0gZDt9YSA9IGMuaW50ZXJsZWF2ZWQ7aWYgKG51bGwgIT09IGEpIHtlID0gYTtkbyB7ZiA9IGUubGFuZSwgTi5sYW5lcyB8PSBmLCBoaCB8PSBmLCBlID0gZS5uZXh0O30gd2hpbGUgKGUgIT09IGEpO30gZWxzZSBudWxsID09PSBlICYmIChjLmxhbmVzID0gMCk7cmV0dXJuIFtiLm1lbW9pemVkU3RhdGUsIGMuZGlzcGF0Y2hdO30KICAgICAgICAgIGZ1bmN0aW9uIGdpKGEpIHt2YXIgYiA9IGRpKCksYyA9IGIucXVldWU7aWYgKG51bGwgPT09IGMpIHRocm93IEVycm9yKHAoMzExKSk7Yy5sYXN0UmVuZGVyZWRSZWR1Y2VyID0gYTt2YXIgZCA9IGMuZGlzcGF0Y2gsZSA9IGMucGVuZGluZyxmID0gYi5tZW1vaXplZFN0YXRlO2lmIChudWxsICE9PSBlKSB7Yy5wZW5kaW5nID0gbnVsbDt2YXIgZyA9IGUgPSBlLm5leHQ7ZG8ge2YgPSBhKGYsIGcuYWN0aW9uKSwgZyA9IGcubmV4dDt9IHdoaWxlIChnICE9PSBlKTtIZShmLCBiLm1lbW9pemVkU3RhdGUpIHx8IChVZyA9ICEwKTtiLm1lbW9pemVkU3RhdGUgPSBmO251bGwgPT09IGIuYmFzZVF1ZXVlICYmIChiLmJhc2VTdGF0ZSA9IGYpO2MubGFzdFJlbmRlcmVkU3RhdGUgPSBmO31yZXR1cm4gW2YsIGRdO31mdW5jdGlvbiBoaSgpIHt9CiAgICAgICAgICBmdW5jdGlvbiBpaShhLCBiKSB7dmFyIGMgPSBOLGQgPSBkaSgpLGUgPSBiKCksZiA9ICFIZShkLm1lbW9pemVkU3RhdGUsIGUpO2YgJiYgKGQubWVtb2l6ZWRTdGF0ZSA9IGUsIFVnID0gITApO2QgPSBkLnF1ZXVlO2ppKGtpLmJpbmQobnVsbCwgYywgZCwgYSksIFthXSk7aWYgKGQuZ2V0U25hcHNob3QgIT09IGIgfHwgZiB8fCBudWxsICE9PSBQICYmIFAubWVtb2l6ZWRTdGF0ZS50YWcgJiAxKSB7Yy5mbGFncyB8PSAyMDQ4O2xpKDksIG1pLmJpbmQobnVsbCwgYywgZCwgZSwgYiksIHZvaWQgMCwgbnVsbCk7aWYgKG51bGwgPT09IFIpIHRocm93IEVycm9yKHAoMzQ5KSk7MCAhPT0gKFJoICYgMzApIHx8IG5pKGMsIGIsIGUpO31yZXR1cm4gZTt9ZnVuY3Rpb24gbmkoYSwgYiwgYykge2EuZmxhZ3MgfD0gMTYzODQ7YSA9IHsgZ2V0U25hcHNob3Q6IGIsIHZhbHVlOiBjIH07YiA9IE4udXBkYXRlUXVldWU7bnVsbCA9PT0gYiA/IChiID0geyBsYXN0RWZmZWN0OiBudWxsLCBzdG9yZXM6IG51bGwgfSwgTi51cGRhdGVRdWV1ZSA9IGIsIGIuc3RvcmVzID0gW2FdKSA6IChjID0gYi5zdG9yZXMsIG51bGwgPT09IGMgPyBiLnN0b3JlcyA9IFthXSA6IGMucHVzaChhKSk7fQogICAgICAgICAgZnVuY3Rpb24gbWkoYSwgYiwgYywgZCkge2IudmFsdWUgPSBjO2IuZ2V0U25hcHNob3QgPSBkO29pKGIpICYmIHBpKGEpO31mdW5jdGlvbiBraShhLCBiLCBjKSB7cmV0dXJuIGMoZnVuY3Rpb24gKCkge29pKGIpICYmIHBpKGEpO30pO31mdW5jdGlvbiBvaShhKSB7dmFyIGIgPSBhLmdldFNuYXBzaG90O2EgPSBhLnZhbHVlO3RyeSB7dmFyIGMgPSBiKCk7cmV0dXJuICFIZShhLCBjKTt9IGNhdGNoIChkKSB7cmV0dXJuICEwO319ZnVuY3Rpb24gcGkoYSkge3ZhciBiID0gWmcoYSwgMSk7bnVsbCAhPT0gYiAmJiBtaChiLCBhLCAxLCAtMSk7fQogICAgICAgICAgZnVuY3Rpb24gcWkoYSkge3ZhciBiID0gY2koKTsiZnVuY3Rpb24iID09PSB0eXBlb2YgYSAmJiAoYSA9IGEoKSk7Yi5tZW1vaXplZFN0YXRlID0gYi5iYXNlU3RhdGUgPSBhO2EgPSB7IHBlbmRpbmc6IG51bGwsIGludGVybGVhdmVkOiBudWxsLCBsYW5lczogMCwgZGlzcGF0Y2g6IG51bGwsIGxhc3RSZW5kZXJlZFJlZHVjZXI6IGVpLCBsYXN0UmVuZGVyZWRTdGF0ZTogYSB9O2IucXVldWUgPSBhO2EgPSBhLmRpc3BhdGNoID0gcmkuYmluZChudWxsLCBOLCBhKTtyZXR1cm4gW2IubWVtb2l6ZWRTdGF0ZSwgYV07fQogICAgICAgICAgZnVuY3Rpb24gbGkoYSwgYiwgYywgZCkge2EgPSB7IHRhZzogYSwgY3JlYXRlOiBiLCBkZXN0cm95OiBjLCBkZXBzOiBkLCBuZXh0OiBudWxsIH07YiA9IE4udXBkYXRlUXVldWU7bnVsbCA9PT0gYiA/IChiID0geyBsYXN0RWZmZWN0OiBudWxsLCBzdG9yZXM6IG51bGwgfSwgTi51cGRhdGVRdWV1ZSA9IGIsIGIubGFzdEVmZmVjdCA9IGEubmV4dCA9IGEpIDogKGMgPSBiLmxhc3RFZmZlY3QsIG51bGwgPT09IGMgPyBiLmxhc3RFZmZlY3QgPSBhLm5leHQgPSBhIDogKGQgPSBjLm5leHQsIGMubmV4dCA9IGEsIGEubmV4dCA9IGQsIGIubGFzdEVmZmVjdCA9IGEpKTtyZXR1cm4gYTt9ZnVuY3Rpb24gc2koKSB7cmV0dXJuIGRpKCkubWVtb2l6ZWRTdGF0ZTt9ZnVuY3Rpb24gdGkoYSwgYiwgYywgZCkge3ZhciBlID0gY2koKTtOLmZsYWdzIHw9IGE7ZS5tZW1vaXplZFN0YXRlID0gbGkoMSB8IGIsIGMsIHZvaWQgMCwgdm9pZCAwID09PSBkID8gbnVsbCA6IGQpO30KICAgICAgICAgIGZ1bmN0aW9uIHVpKGEsIGIsIGMsIGQpIHt2YXIgZSA9IGRpKCk7ZCA9IHZvaWQgMCA9PT0gZCA/IG51bGwgOiBkO3ZhciBmID0gdm9pZCAwO2lmIChudWxsICE9PSBPKSB7dmFyIGcgPSBPLm1lbW9pemVkU3RhdGU7ZiA9IGcuZGVzdHJveTtpZiAobnVsbCAhPT0gZCAmJiBXaChkLCBnLmRlcHMpKSB7ZS5tZW1vaXplZFN0YXRlID0gbGkoYiwgYywgZiwgZCk7cmV0dXJuO319Ti5mbGFncyB8PSBhO2UubWVtb2l6ZWRTdGF0ZSA9IGxpKDEgfCBiLCBjLCBmLCBkKTt9ZnVuY3Rpb24gdmkoYSwgYikge3JldHVybiB0aSg4MzkwNjU2LCA4LCBhLCBiKTt9ZnVuY3Rpb24gamkoYSwgYikge3JldHVybiB1aSgyMDQ4LCA4LCBhLCBiKTt9ZnVuY3Rpb24gd2koYSwgYikge3JldHVybiB1aSg0LCAyLCBhLCBiKTt9ZnVuY3Rpb24geGkoYSwgYikge3JldHVybiB1aSg0LCA0LCBhLCBiKTt9CiAgICAgICAgICBmdW5jdGlvbiB5aShhLCBiKSB7aWYgKCJmdW5jdGlvbiIgPT09IHR5cGVvZiBiKSByZXR1cm4gYSA9IGEoKSwgYihhKSwgZnVuY3Rpb24gKCkge2IobnVsbCk7fTtpZiAobnVsbCAhPT0gYiAmJiB2b2lkIDAgIT09IGIpIHJldHVybiBhID0gYSgpLCBiLmN1cnJlbnQgPSBhLCBmdW5jdGlvbiAoKSB7Yi5jdXJyZW50ID0gbnVsbDt9O31mdW5jdGlvbiB6aShhLCBiLCBjKSB7YyA9IG51bGwgIT09IGMgJiYgdm9pZCAwICE9PSBjID8gYy5jb25jYXQoW2FdKSA6IG51bGw7cmV0dXJuIHVpKDQsIDQsIHlpLmJpbmQobnVsbCwgYiwgYSksIGMpO31mdW5jdGlvbiBBaSgpIHt9ZnVuY3Rpb24gQmkoYSwgYikge3ZhciBjID0gZGkoKTtiID0gdm9pZCAwID09PSBiID8gbnVsbCA6IGI7dmFyIGQgPSBjLm1lbW9pemVkU3RhdGU7aWYgKG51bGwgIT09IGQgJiYgbnVsbCAhPT0gYiAmJiBXaChiLCBkWzFdKSkgcmV0dXJuIGRbMF07Yy5tZW1vaXplZFN0YXRlID0gW2EsIGJdO3JldHVybiBhO30KICAgICAgICAgIGZ1bmN0aW9uIENpKGEsIGIpIHt2YXIgYyA9IGRpKCk7YiA9IHZvaWQgMCA9PT0gYiA/IG51bGwgOiBiO3ZhciBkID0gYy5tZW1vaXplZFN0YXRlO2lmIChudWxsICE9PSBkICYmIG51bGwgIT09IGIgJiYgV2goYiwgZFsxXSkpIHJldHVybiBkWzBdO2EgPSBhKCk7Yy5tZW1vaXplZFN0YXRlID0gW2EsIGJdO3JldHVybiBhO31mdW5jdGlvbiBEaShhLCBiLCBjKSB7aWYgKDAgPT09IChSaCAmIDIxKSkgcmV0dXJuIGEuYmFzZVN0YXRlICYmIChhLmJhc2VTdGF0ZSA9ICExLCBVZyA9ICEwKSwgYS5tZW1vaXplZFN0YXRlID0gYztIZShjLCBiKSB8fCAoYyA9IHljKCksIE4ubGFuZXMgfD0gYywgaGggfD0gYywgYS5iYXNlU3RhdGUgPSAhMCk7cmV0dXJuIGI7fWZ1bmN0aW9uIEVpKGEsIGIpIHt2YXIgYyA9IEM7QyA9IDAgIT09IGMgJiYgNCA+IGMgPyBjIDogNDthKCEwKTt2YXIgZCA9IFFoLnRyYW5zaXRpb247UWgudHJhbnNpdGlvbiA9IHt9O3RyeSB7YSghMSksIGIoKTt9IGZpbmFsbHkge0MgPSBjLCBRaC50cmFuc2l0aW9uID0gZDt9fWZ1bmN0aW9uIEZpKCkge3JldHVybiBkaSgpLm1lbW9pemVkU3RhdGU7fQogICAgICAgICAgZnVuY3Rpb24gR2koYSwgYiwgYykge3ZhciBkID0gbGgoYSk7YyA9IHsgbGFuZTogZCwgYWN0aW9uOiBjLCBoYXNFYWdlclN0YXRlOiAhMSwgZWFnZXJTdGF0ZTogbnVsbCwgbmV4dDogbnVsbCB9O2lmIChIaShhKSkgSWkoYiwgYyk7ZWxzZSBpZiAoYyA9IFlnKGEsIGIsIGMsIGQpLCBudWxsICE9PSBjKSB7dmFyIGUgPSBMKCk7bWgoYywgYSwgZCwgZSk7SmkoYywgYiwgZCk7fX0KICAgICAgICAgIGZ1bmN0aW9uIHJpKGEsIGIsIGMpIHt2YXIgZCA9IGxoKGEpLGUgPSB7IGxhbmU6IGQsIGFjdGlvbjogYywgaGFzRWFnZXJTdGF0ZTogITEsIGVhZ2VyU3RhdGU6IG51bGwsIG5leHQ6IG51bGwgfTtpZiAoSGkoYSkpIElpKGIsIGUpO2Vsc2Uge3ZhciBmID0gYS5hbHRlcm5hdGU7aWYgKDAgPT09IGEubGFuZXMgJiYgKG51bGwgPT09IGYgfHwgMCA9PT0gZi5sYW5lcykgJiYgKGYgPSBiLmxhc3RSZW5kZXJlZFJlZHVjZXIsIG51bGwgIT09IGYpKSB0cnkge3ZhciBnID0gYi5sYXN0UmVuZGVyZWRTdGF0ZSxoID0gZihnLCBjKTtlLmhhc0VhZ2VyU3RhdGUgPSAhMDtlLmVhZ2VyU3RhdGUgPSBoO2lmIChIZShoLCBnKSkge3ZhciBrID0gYi5pbnRlcmxlYXZlZDtudWxsID09PSBrID8gKGUubmV4dCA9IGUsIFhnKGIpKSA6IChlLm5leHQgPSBrLm5leHQsIGsubmV4dCA9IGUpO2IuaW50ZXJsZWF2ZWQgPSBlO3JldHVybjt9fSBjYXRjaCAobCkge30gZmluYWxseSB7fWMgPSBZZyhhLCBiLCBlLCBkKTtudWxsICE9PSBjICYmIChlID0gTCgpLCBtaChjLCBhLCBkLCBlKSwgSmkoYywgYiwgZCkpO319CiAgICAgICAgICBmdW5jdGlvbiBIaShhKSB7dmFyIGIgPSBhLmFsdGVybmF0ZTtyZXR1cm4gYSA9PT0gTiB8fCBudWxsICE9PSBiICYmIGIgPT09IE47fWZ1bmN0aW9uIElpKGEsIGIpIHtUaCA9IFNoID0gITA7dmFyIGMgPSBhLnBlbmRpbmc7bnVsbCA9PT0gYyA/IGIubmV4dCA9IGIgOiAoYi5uZXh0ID0gYy5uZXh0LCBjLm5leHQgPSBiKTthLnBlbmRpbmcgPSBiO31mdW5jdGlvbiBKaShhLCBiLCBjKSB7aWYgKDAgIT09IChjICYgNDE5NDI0MCkpIHt2YXIgZCA9IGIubGFuZXM7ZCAmPSBhLnBlbmRpbmdMYW5lcztjIHw9IGQ7Yi5sYW5lcyA9IGM7Q2MoYSwgYyk7fX0KICAgICAgICAgIHZhciBhaSA9IHsgcmVhZENvbnRleHQ6IFZnLCB1c2VDYWxsYmFjazogUSwgdXNlQ29udGV4dDogUSwgdXNlRWZmZWN0OiBRLCB1c2VJbXBlcmF0aXZlSGFuZGxlOiBRLCB1c2VJbnNlcnRpb25FZmZlY3Q6IFEsIHVzZUxheW91dEVmZmVjdDogUSwgdXNlTWVtbzogUSwgdXNlUmVkdWNlcjogUSwgdXNlUmVmOiBRLCB1c2VTdGF0ZTogUSwgdXNlRGVidWdWYWx1ZTogUSwgdXNlRGVmZXJyZWRWYWx1ZTogUSwgdXNlVHJhbnNpdGlvbjogUSwgdXNlTXV0YWJsZVNvdXJjZTogUSwgdXNlU3luY0V4dGVybmFsU3RvcmU6IFEsIHVzZUlkOiBRLCB1bnN0YWJsZV9pc05ld1JlY29uY2lsZXI6ICExIH0sWWggPSB7IHJlYWRDb250ZXh0OiBWZywgdXNlQ2FsbGJhY2s6IGZ1bmN0aW9uIHVzZUNhbGxiYWNrKGEsIGIpIHtjaSgpLm1lbW9pemVkU3RhdGUgPSBbYSwgdm9pZCAwID09PSBiID8gbnVsbCA6IGJdO3JldHVybiBhO30sIHVzZUNvbnRleHQ6IFZnLCB1c2VFZmZlY3Q6IHZpLCB1c2VJbXBlcmF0aXZlSGFuZGxlOiBmdW5jdGlvbiB1c2VJbXBlcmF0aXZlSGFuZGxlKGEsIGIsIGMpIHtjID0gbnVsbCAhPT0gYyAmJiB2b2lkIDAgIT09IGMgPyBjLmNvbmNhdChbYV0pIDogbnVsbDtyZXR1cm4gdGkoNDE5NDMwOCwKICAgICAgICAgICAgICAgIDQsIHlpLmJpbmQobnVsbCwgYiwgYSksIGMpO30sIHVzZUxheW91dEVmZmVjdDogZnVuY3Rpb24gdXNlTGF5b3V0RWZmZWN0KGEsIGIpIHtyZXR1cm4gdGkoNDE5NDMwOCwgNCwgYSwgYik7fSwgdXNlSW5zZXJ0aW9uRWZmZWN0OiBmdW5jdGlvbiB1c2VJbnNlcnRpb25FZmZlY3QoYSwgYikge3JldHVybiB0aSg0LCAyLCBhLCBiKTt9LCB1c2VNZW1vOiBmdW5jdGlvbiB1c2VNZW1vKGEsIGIpIHt2YXIgYyA9IGNpKCk7YiA9IHZvaWQgMCA9PT0gYiA/IG51bGwgOiBiO2EgPSBhKCk7Yy5tZW1vaXplZFN0YXRlID0gW2EsIGJdO3JldHVybiBhO30sIHVzZVJlZHVjZXI6IGZ1bmN0aW9uIHVzZVJlZHVjZXIoYSwgYiwgYykge3ZhciBkID0gY2koKTtiID0gdm9pZCAwICE9PSBjID8gYyhiKSA6IGI7ZC5tZW1vaXplZFN0YXRlID0gZC5iYXNlU3RhdGUgPSBiO2EgPSB7IHBlbmRpbmc6IG51bGwsIGludGVybGVhdmVkOiBudWxsLCBsYW5lczogMCwgZGlzcGF0Y2g6IG51bGwsIGxhc3RSZW5kZXJlZFJlZHVjZXI6IGEsIGxhc3RSZW5kZXJlZFN0YXRlOiBiIH07ZC5xdWV1ZSA9IGE7YSA9IGEuZGlzcGF0Y2ggPSBHaS5iaW5kKG51bGwsIE4sIGEpO3JldHVybiBbZC5tZW1vaXplZFN0YXRlLCBhXTt9LCB1c2VSZWY6IGZ1bmN0aW9uIHVzZVJlZihhKSB7dmFyIGIgPQogICAgICAgICAgICAgICAgY2koKTthID0geyBjdXJyZW50OiBhIH07cmV0dXJuIGIubWVtb2l6ZWRTdGF0ZSA9IGE7fSwgdXNlU3RhdGU6IHFpLCB1c2VEZWJ1Z1ZhbHVlOiBBaSwgdXNlRGVmZXJyZWRWYWx1ZTogZnVuY3Rpb24gdXNlRGVmZXJyZWRWYWx1ZShhKSB7cmV0dXJuIGNpKCkubWVtb2l6ZWRTdGF0ZSA9IGE7fSwgdXNlVHJhbnNpdGlvbjogZnVuY3Rpb24gdXNlVHJhbnNpdGlvbigpIHt2YXIgYSA9IHFpKCExKSxiID0gYVswXTthID0gRWkuYmluZChudWxsLCBhWzFdKTtjaSgpLm1lbW9pemVkU3RhdGUgPSBhO3JldHVybiBbYiwgYV07fSwgdXNlTXV0YWJsZVNvdXJjZTogZnVuY3Rpb24gdXNlTXV0YWJsZVNvdXJjZSgpIHt9LCB1c2VTeW5jRXh0ZXJuYWxTdG9yZTogZnVuY3Rpb24gdXNlU3luY0V4dGVybmFsU3RvcmUoYSwgYiwgYykge3ZhciBkID0gTixlID0gY2koKTtpZiAoSSkge2lmICh2b2lkIDAgPT09IGMpIHRocm93IEVycm9yKHAoNDA3KSk7YyA9IGMoKTt9IGVsc2Uge2MgPSBiKCk7aWYgKG51bGwgPT09IFIpIHRocm93IEVycm9yKHAoMzQ5KSk7MCAhPT0gKFJoICYgMzApIHx8IG5pKGQsIGIsIGMpO31lLm1lbW9pemVkU3RhdGUgPSBjO3ZhciBmID0geyB2YWx1ZTogYywgZ2V0U25hcHNob3Q6IGIgfTtlLnF1ZXVlID0gZjt2aShraS5iaW5kKG51bGwsIGQsCiAgICAgICAgICAgICAgICBmLCBhKSwgW2FdKTtkLmZsYWdzIHw9IDIwNDg7bGkoOSwgbWkuYmluZChudWxsLCBkLCBmLCBjLCBiKSwgdm9pZCAwLCBudWxsKTtyZXR1cm4gYzt9LCB1c2VJZDogZnVuY3Rpb24gdXNlSWQoKSB7dmFyIGEgPSBjaSgpLGIgPSBSLmlkZW50aWZpZXJQcmVmaXg7aWYgKEkpIHt2YXIgYyA9IHNnO3ZhciBkID0gcmc7YyA9IChkICYgfigxIDw8IDMyIC0gb2MoZCkgLSAxKSkudG9TdHJpbmcoMzIpICsgYztiID0gIjoiICsgYiArICJSIiArIGM7YyA9IFVoKys7MCA8IGMgJiYgKGIgKz0gIkgiICsgYy50b1N0cmluZygzMikpO2IgKz0gIjoiO30gZWxzZSBjID0gVmgrKywgYiA9ICI6IiArIGIgKyAiciIgKyBjLnRvU3RyaW5nKDMyKSArICI6IjtyZXR1cm4gYS5tZW1vaXplZFN0YXRlID0gYjt9LCB1bnN0YWJsZV9pc05ld1JlY29uY2lsZXI6ICExIH0sWmggPSB7IHJlYWRDb250ZXh0OiBWZywgdXNlQ2FsbGJhY2s6IEJpLCB1c2VDb250ZXh0OiBWZywgdXNlRWZmZWN0OiBqaSwgdXNlSW1wZXJhdGl2ZUhhbmRsZTogemksIHVzZUluc2VydGlvbkVmZmVjdDogd2ksIHVzZUxheW91dEVmZmVjdDogeGksIHVzZU1lbW86IENpLCB1c2VSZWR1Y2VyOiBmaSwgdXNlUmVmOiBzaSwgdXNlU3RhdGU6IGZ1bmN0aW9uIHVzZVN0YXRlKCkge3JldHVybiBmaShlaSk7fSwKICAgICAgICAgICAgICB1c2VEZWJ1Z1ZhbHVlOiBBaSwgdXNlRGVmZXJyZWRWYWx1ZTogZnVuY3Rpb24gdXNlRGVmZXJyZWRWYWx1ZShhKSB7dmFyIGIgPSBkaSgpO3JldHVybiBEaShiLCBPLm1lbW9pemVkU3RhdGUsIGEpO30sIHVzZVRyYW5zaXRpb246IGZ1bmN0aW9uIHVzZVRyYW5zaXRpb24oKSB7dmFyIGEgPSBmaShlaSlbMF0sYiA9IGRpKCkubWVtb2l6ZWRTdGF0ZTtyZXR1cm4gW2EsIGJdO30sIHVzZU11dGFibGVTb3VyY2U6IGhpLCB1c2VTeW5jRXh0ZXJuYWxTdG9yZTogaWksIHVzZUlkOiBGaSwgdW5zdGFibGVfaXNOZXdSZWNvbmNpbGVyOiAhMSB9LCRoID0geyByZWFkQ29udGV4dDogVmcsIHVzZUNhbGxiYWNrOiBCaSwgdXNlQ29udGV4dDogVmcsIHVzZUVmZmVjdDogamksIHVzZUltcGVyYXRpdmVIYW5kbGU6IHppLCB1c2VJbnNlcnRpb25FZmZlY3Q6IHdpLCB1c2VMYXlvdXRFZmZlY3Q6IHhpLCB1c2VNZW1vOiBDaSwgdXNlUmVkdWNlcjogZ2ksIHVzZVJlZjogc2ksIHVzZVN0YXRlOiBmdW5jdGlvbiB1c2VTdGF0ZSgpIHtyZXR1cm4gZ2koZWkpO30sIHVzZURlYnVnVmFsdWU6IEFpLCB1c2VEZWZlcnJlZFZhbHVlOiBmdW5jdGlvbiB1c2VEZWZlcnJlZFZhbHVlKGEpIHt2YXIgYiA9IGRpKCk7cmV0dXJuIG51bGwgPT09CiAgICAgICAgICAgICAgICBPID8gYi5tZW1vaXplZFN0YXRlID0gYSA6IERpKGIsIE8ubWVtb2l6ZWRTdGF0ZSwgYSk7fSwgdXNlVHJhbnNpdGlvbjogZnVuY3Rpb24gdXNlVHJhbnNpdGlvbigpIHt2YXIgYSA9IGdpKGVpKVswXSxiID0gZGkoKS5tZW1vaXplZFN0YXRlO3JldHVybiBbYSwgYl07fSwgdXNlTXV0YWJsZVNvdXJjZTogaGksIHVzZVN5bmNFeHRlcm5hbFN0b3JlOiBpaSwgdXNlSWQ6IEZpLCB1bnN0YWJsZV9pc05ld1JlY29uY2lsZXI6ICExIH07ZnVuY3Rpb24gS2koYSwgYikge3RyeSB7dmFyIGMgPSAiIixkID0gYjtkbyB7YyArPSBQYShkKSwgZCA9IGQucmV0dXJuO30gd2hpbGUgKGQpO3ZhciBlID0gYzt9IGNhdGNoIChmKSB7ZSA9ICJcbkVycm9yIGdlbmVyYXRpbmcgc3RhY2s6ICIgKyBmLm1lc3NhZ2UgKyAiXG4iICsgZi5zdGFjazt9cmV0dXJuIHsgdmFsdWU6IGEsIHNvdXJjZTogYiwgc3RhY2s6IGUsIGRpZ2VzdDogbnVsbCB9O31mdW5jdGlvbiBMaShhLCBiLCBjKSB7cmV0dXJuIHsgdmFsdWU6IGEsIHNvdXJjZTogbnVsbCwgc3RhY2s6IG51bGwgIT0gYyA/IGMgOiBudWxsLCBkaWdlc3Q6IG51bGwgIT0gYiA/IGIgOiBudWxsIH07fQogICAgICAgICAgZnVuY3Rpb24gTWkoYSwgYikge3RyeSB7Y29uc29sZS5lcnJvcihiLnZhbHVlKTt9IGNhdGNoIChjKSB7c2V0VGltZW91dChmdW5jdGlvbiAoKSB7dGhyb3cgYzt9KTt9fXZhciBOaSA9ICJmdW5jdGlvbiIgPT09IHR5cGVvZiBXZWFrTWFwID8gV2Vha01hcCA6IE1hcDtmdW5jdGlvbiBPaShhLCBiLCBjKSB7YyA9IGNoKC0xLCBjKTtjLnRhZyA9IDM7Yy5wYXlsb2FkID0geyBlbGVtZW50OiBudWxsIH07dmFyIGQgPSBiLnZhbHVlO2MuY2FsbGJhY2sgPSBmdW5jdGlvbiAoKSB7UGkgfHwgKFBpID0gITAsIFFpID0gZCk7TWkoYSwgYik7fTtyZXR1cm4gYzt9CiAgICAgICAgICBmdW5jdGlvbiBSaShhLCBiLCBjKSB7YyA9IGNoKC0xLCBjKTtjLnRhZyA9IDM7dmFyIGQgPSBhLnR5cGUuZ2V0RGVyaXZlZFN0YXRlRnJvbUVycm9yO2lmICgiZnVuY3Rpb24iID09PSB0eXBlb2YgZCkge3ZhciBlID0gYi52YWx1ZTtjLnBheWxvYWQgPSBmdW5jdGlvbiAoKSB7cmV0dXJuIGQoZSk7fTtjLmNhbGxiYWNrID0gZnVuY3Rpb24gKCkge01pKGEsIGIpO307fXZhciBmID0gYS5zdGF0ZU5vZGU7bnVsbCAhPT0gZiAmJiAiZnVuY3Rpb24iID09PSB0eXBlb2YgZi5jb21wb25lbnREaWRDYXRjaCAmJiAoYy5jYWxsYmFjayA9IGZ1bmN0aW9uICgpIHtNaShhLCBiKTsiZnVuY3Rpb24iICE9PSB0eXBlb2YgZCAmJiAobnVsbCA9PT0gU2kgPyBTaSA9IG5ldyBTZXQoW3RoaXNdKSA6IFNpLmFkZCh0aGlzKSk7dmFyIGMgPSBiLnN0YWNrO3RoaXMuY29tcG9uZW50RGlkQ2F0Y2goYi52YWx1ZSwgeyBjb21wb25lbnRTdGFjazogbnVsbCAhPT0gYyA/IGMgOiAiIiB9KTt9KTtyZXR1cm4gYzt9CiAgICAgICAgICBmdW5jdGlvbiBUaShhLCBiLCBjKSB7dmFyIGQgPSBhLnBpbmdDYWNoZTtpZiAobnVsbCA9PT0gZCkge2QgPSBhLnBpbmdDYWNoZSA9IG5ldyBOaSgpO3ZhciBlID0gbmV3IFNldCgpO2Quc2V0KGIsIGUpO30gZWxzZSBlID0gZC5nZXQoYiksIHZvaWQgMCA9PT0gZSAmJiAoZSA9IG5ldyBTZXQoKSwgZC5zZXQoYiwgZSkpO2UuaGFzKGMpIHx8IChlLmFkZChjKSwgYSA9IFVpLmJpbmQobnVsbCwgYSwgYiwgYyksIGIudGhlbihhLCBhKSk7fWZ1bmN0aW9uIFZpKGEpIHtkbyB7dmFyIGI7aWYgKGIgPSAxMyA9PT0gYS50YWcpIGIgPSBhLm1lbW9pemVkU3RhdGUsIGIgPSBudWxsICE9PSBiID8gbnVsbCAhPT0gYi5kZWh5ZHJhdGVkID8gITAgOiAhMSA6ICEwO2lmIChiKSByZXR1cm4gYTthID0gYS5yZXR1cm47fSB3aGlsZSAobnVsbCAhPT0gYSk7cmV0dXJuIG51bGw7fQogICAgICAgICAgZnVuY3Rpb24gV2koYSwgYiwgYywgZCwgZSkge2lmICgwID09PSAoYS5tb2RlICYgMSkpIHJldHVybiBhID09PSBiID8gYS5mbGFncyB8PSA2NTUzNiA6IChhLmZsYWdzIHw9IDEyOCwgYy5mbGFncyB8PSAxMzEwNzIsIGMuZmxhZ3MgJj0gLTUyODA1LCAxID09PSBjLnRhZyAmJiAobnVsbCA9PT0gYy5hbHRlcm5hdGUgPyBjLnRhZyA9IDE3IDogKGIgPSBjaCgtMSwgMSksIGIudGFnID0gMiwgZGgoYywgYiwgMSkpKSwgYy5sYW5lcyB8PSAxKSwgYTthLmZsYWdzIHw9IDY1NTM2O2EubGFuZXMgPSBlO3JldHVybiBhO312YXIgWGkgPSB1YS5SZWFjdEN1cnJlbnRPd25lcixVZyA9ICExO2Z1bmN0aW9uIFlpKGEsIGIsIGMsIGQpIHtiLmNoaWxkID0gbnVsbCA9PT0gYSA/IENoKGIsIG51bGwsIGMsIGQpIDogQmgoYiwgYS5jaGlsZCwgYywgZCk7fQogICAgICAgICAgZnVuY3Rpb24gWmkoYSwgYiwgYywgZCwgZSkge2MgPSBjLnJlbmRlcjt2YXIgZiA9IGIucmVmO1RnKGIsIGUpO2QgPSBYaChhLCBiLCBjLCBkLCBmLCBlKTtjID0gYmkoKTtpZiAobnVsbCAhPT0gYSAmJiAhVWcpIHJldHVybiBiLnVwZGF0ZVF1ZXVlID0gYS51cGRhdGVRdWV1ZSwgYi5mbGFncyAmPSAtMjA1MywgYS5sYW5lcyAmPSB+ZSwgJGkoYSwgYiwgZSk7SSAmJiBjICYmIHZnKGIpO2IuZmxhZ3MgfD0gMTtZaShhLCBiLCBkLCBlKTtyZXR1cm4gYi5jaGlsZDt9CiAgICAgICAgICBmdW5jdGlvbiBhaihhLCBiLCBjLCBkLCBlKSB7aWYgKG51bGwgPT09IGEpIHt2YXIgZiA9IGMudHlwZTtpZiAoImZ1bmN0aW9uIiA9PT0gdHlwZW9mIGYgJiYgIWJqKGYpICYmIHZvaWQgMCA9PT0gZi5kZWZhdWx0UHJvcHMgJiYgbnVsbCA9PT0gYy5jb21wYXJlICYmIHZvaWQgMCA9PT0gYy5kZWZhdWx0UHJvcHMpIHJldHVybiBiLnRhZyA9IDE1LCBiLnR5cGUgPSBmLCBjaihhLCBiLCBmLCBkLCBlKTthID0geWgoYy50eXBlLCBudWxsLCBkLCBiLCBiLm1vZGUsIGUpO2EucmVmID0gYi5yZWY7YS5yZXR1cm4gPSBiO3JldHVybiBiLmNoaWxkID0gYTt9ZiA9IGEuY2hpbGQ7aWYgKDAgPT09IChhLmxhbmVzICYgZSkpIHt2YXIgZyA9IGYubWVtb2l6ZWRQcm9wcztjID0gYy5jb21wYXJlO2MgPSBudWxsICE9PSBjID8gYyA6IEllO2lmIChjKGcsIGQpICYmIGEucmVmID09PSBiLnJlZikgcmV0dXJuICRpKGEsIGIsIGUpO31iLmZsYWdzIHw9IDE7YSA9IHdoKGYsIGQpO2EucmVmID0gYi5yZWY7YS5yZXR1cm4gPSBiO3JldHVybiBiLmNoaWxkID0gYTt9CiAgICAgICAgICBmdW5jdGlvbiBjaihhLCBiLCBjLCBkLCBlKSB7aWYgKG51bGwgIT09IGEpIHt2YXIgZiA9IGEubWVtb2l6ZWRQcm9wcztpZiAoSWUoZiwgZCkgJiYgYS5yZWYgPT09IGIucmVmKSBpZiAoVWcgPSAhMSwgYi5wZW5kaW5nUHJvcHMgPSBkID0gZiwgMCAhPT0gKGEubGFuZXMgJiBlKSkgMCAhPT0gKGEuZmxhZ3MgJiAxMzEwNzIpICYmIChVZyA9ICEwKTtlbHNlIHJldHVybiBiLmxhbmVzID0gYS5sYW5lcywgJGkoYSwgYiwgZSk7fXJldHVybiBkaihhLCBiLCBjLCBkLCBlKTt9CiAgICAgICAgICBmdW5jdGlvbiBlaihhLCBiLCBjKSB7dmFyIGQgPSBiLnBlbmRpbmdQcm9wcyxlID0gZC5jaGlsZHJlbixmID0gbnVsbCAhPT0gYSA/IGEubWVtb2l6ZWRTdGF0ZSA6IG51bGw7aWYgKCJoaWRkZW4iID09PSBkLm1vZGUpIHtpZiAoMCA9PT0gKGIubW9kZSAmIDEpKSBiLm1lbW9pemVkU3RhdGUgPSB7IGJhc2VMYW5lczogMCwgY2FjaGVQb29sOiBudWxsLCB0cmFuc2l0aW9uczogbnVsbCB9LCBHKGZqLCBnaiksIGdqIHw9IGM7ZWxzZSB7aWYgKDAgPT09IChjICYgMTA3Mzc0MTgyNCkpIHJldHVybiBhID0gbnVsbCAhPT0gZiA/IGYuYmFzZUxhbmVzIHwgYyA6IGMsIGIubGFuZXMgPSBiLmNoaWxkTGFuZXMgPSAxMDczNzQxODI0LCBiLm1lbW9pemVkU3RhdGUgPSB7IGJhc2VMYW5lczogYSwgY2FjaGVQb29sOiBudWxsLCB0cmFuc2l0aW9uczogbnVsbCB9LCBiLnVwZGF0ZVF1ZXVlID0gbnVsbCwgRyhmaiwgZ2opLCBnaiB8PSBhLCBudWxsO2IubWVtb2l6ZWRTdGF0ZSA9IHsgYmFzZUxhbmVzOiAwLCBjYWNoZVBvb2w6IG51bGwsIHRyYW5zaXRpb25zOiBudWxsIH07ZCA9IG51bGwgIT09IGYgPyBmLmJhc2VMYW5lcyA6IGM7RyhmaiwgZ2opO2dqIHw9IGQ7fX0gZWxzZSBudWxsICE9PQogICAgICAgICAgICBmID8gKGQgPSBmLmJhc2VMYW5lcyB8IGMsIGIubWVtb2l6ZWRTdGF0ZSA9IG51bGwpIDogZCA9IGMsIEcoZmosIGdqKSwgZ2ogfD0gZDtZaShhLCBiLCBlLCBjKTtyZXR1cm4gYi5jaGlsZDt9ZnVuY3Rpb24gaGooYSwgYikge3ZhciBjID0gYi5yZWY7aWYgKG51bGwgPT09IGEgJiYgbnVsbCAhPT0gYyB8fCBudWxsICE9PSBhICYmIGEucmVmICE9PSBjKSBiLmZsYWdzIHw9IDUxMiwgYi5mbGFncyB8PSAyMDk3MTUyO31mdW5jdGlvbiBkaihhLCBiLCBjLCBkLCBlKSB7dmFyIGYgPSBaZihjKSA/IFhmIDogSC5jdXJyZW50O2YgPSBZZihiLCBmKTtUZyhiLCBlKTtjID0gWGgoYSwgYiwgYywgZCwgZiwgZSk7ZCA9IGJpKCk7aWYgKG51bGwgIT09IGEgJiYgIVVnKSByZXR1cm4gYi51cGRhdGVRdWV1ZSA9IGEudXBkYXRlUXVldWUsIGIuZmxhZ3MgJj0gLTIwNTMsIGEubGFuZXMgJj0gfmUsICRpKGEsIGIsIGUpO0kgJiYgZCAmJiB2ZyhiKTtiLmZsYWdzIHw9IDE7WWkoYSwgYiwgYywgZSk7cmV0dXJuIGIuY2hpbGQ7fQogICAgICAgICAgZnVuY3Rpb24gaWooYSwgYiwgYywgZCwgZSkge2lmIChaZihjKSkge3ZhciBmID0gITA7Y2coYik7fSBlbHNlIGYgPSAhMTtUZyhiLCBlKTtpZiAobnVsbCA9PT0gYi5zdGF0ZU5vZGUpIGpqKGEsIGIpLCBwaChiLCBjLCBkKSwgcmgoYiwgYywgZCwgZSksIGQgPSAhMDtlbHNlIGlmIChudWxsID09PSBhKSB7dmFyIGcgPSBiLnN0YXRlTm9kZSxoID0gYi5tZW1vaXplZFByb3BzO2cucHJvcHMgPSBoO3ZhciBrID0gZy5jb250ZXh0LGwgPSBjLmNvbnRleHRUeXBlOyJvYmplY3QiID09PSB0eXBlb2YgbCAmJiBudWxsICE9PSBsID8gbCA9IFZnKGwpIDogKGwgPSBaZihjKSA/IFhmIDogSC5jdXJyZW50LCBsID0gWWYoYiwgbCkpO3ZhciBtID0gYy5nZXREZXJpdmVkU3RhdGVGcm9tUHJvcHMscSA9ICJmdW5jdGlvbiIgPT09IHR5cGVvZiBtIHx8ICJmdW5jdGlvbiIgPT09IHR5cGVvZiBnLmdldFNuYXBzaG90QmVmb3JlVXBkYXRlO3EgfHwgImZ1bmN0aW9uIiAhPT0gdHlwZW9mIGcuVU5TQUZFX2NvbXBvbmVudFdpbGxSZWNlaXZlUHJvcHMgJiYgImZ1bmN0aW9uIiAhPT0gdHlwZW9mIGcuY29tcG9uZW50V2lsbFJlY2VpdmVQcm9wcyB8fAogICAgICAgICAgICAgIChoICE9PSBkIHx8IGsgIT09IGwpICYmIHFoKGIsIGcsIGQsIGwpOyRnID0gITE7dmFyIHIgPSBiLm1lbW9pemVkU3RhdGU7Zy5zdGF0ZSA9IHI7Z2goYiwgZCwgZywgZSk7ayA9IGIubWVtb2l6ZWRTdGF0ZTtoICE9PSBkIHx8IHIgIT09IGsgfHwgV2YuY3VycmVudCB8fCAkZyA/ICgiZnVuY3Rpb24iID09PSB0eXBlb2YgbSAmJiAoa2goYiwgYywgbSwgZCksIGsgPSBiLm1lbW9pemVkU3RhdGUpLCAoaCA9ICRnIHx8IG9oKGIsIGMsIGgsIGQsIHIsIGssIGwpKSA/IChxIHx8ICJmdW5jdGlvbiIgIT09IHR5cGVvZiBnLlVOU0FGRV9jb21wb25lbnRXaWxsTW91bnQgJiYgImZ1bmN0aW9uIiAhPT0gdHlwZW9mIGcuY29tcG9uZW50V2lsbE1vdW50IHx8ICgiZnVuY3Rpb24iID09PSB0eXBlb2YgZy5jb21wb25lbnRXaWxsTW91bnQgJiYgZy5jb21wb25lbnRXaWxsTW91bnQoKSwgImZ1bmN0aW9uIiA9PT0gdHlwZW9mIGcuVU5TQUZFX2NvbXBvbmVudFdpbGxNb3VudCAmJiBnLlVOU0FGRV9jb21wb25lbnRXaWxsTW91bnQoKSksICJmdW5jdGlvbiIgPT09IHR5cGVvZiBnLmNvbXBvbmVudERpZE1vdW50ICYmIChiLmZsYWdzIHw9IDQxOTQzMDgpKSA6ICgKICAgICAgICAgICAgICAiZnVuY3Rpb24iID09PSB0eXBlb2YgZy5jb21wb25lbnREaWRNb3VudCAmJiAoYi5mbGFncyB8PSA0MTk0MzA4KSwgYi5tZW1vaXplZFByb3BzID0gZCwgYi5tZW1vaXplZFN0YXRlID0gayksIGcucHJvcHMgPSBkLCBnLnN0YXRlID0gaywgZy5jb250ZXh0ID0gbCwgZCA9IGgpIDogKCJmdW5jdGlvbiIgPT09IHR5cGVvZiBnLmNvbXBvbmVudERpZE1vdW50ICYmIChiLmZsYWdzIHw9IDQxOTQzMDgpLCBkID0gITEpO30gZWxzZSB7ZyA9IGIuc3RhdGVOb2RlO2JoKGEsIGIpO2ggPSBiLm1lbW9pemVkUHJvcHM7bCA9IGIudHlwZSA9PT0gYi5lbGVtZW50VHlwZSA/IGggOiBMZyhiLnR5cGUsIGgpO2cucHJvcHMgPSBsO3EgPSBiLnBlbmRpbmdQcm9wcztyID0gZy5jb250ZXh0O2sgPSBjLmNvbnRleHRUeXBlOyJvYmplY3QiID09PSB0eXBlb2YgayAmJiBudWxsICE9PSBrID8gayA9IFZnKGspIDogKGsgPSBaZihjKSA/IFhmIDogSC5jdXJyZW50LCBrID0gWWYoYiwgaykpO3ZhciB5ID0gYy5nZXREZXJpdmVkU3RhdGVGcm9tUHJvcHM7KG0gPSAiZnVuY3Rpb24iID09PSB0eXBlb2YgeSB8fCAiZnVuY3Rpb24iID09PSB0eXBlb2YgZy5nZXRTbmFwc2hvdEJlZm9yZVVwZGF0ZSkgfHwKICAgICAgICAgICAgICAiZnVuY3Rpb24iICE9PSB0eXBlb2YgZy5VTlNBRkVfY29tcG9uZW50V2lsbFJlY2VpdmVQcm9wcyAmJiAiZnVuY3Rpb24iICE9PSB0eXBlb2YgZy5jb21wb25lbnRXaWxsUmVjZWl2ZVByb3BzIHx8IChoICE9PSBxIHx8IHIgIT09IGspICYmIHFoKGIsIGcsIGQsIGspOyRnID0gITE7ciA9IGIubWVtb2l6ZWRTdGF0ZTtnLnN0YXRlID0gcjtnaChiLCBkLCBnLCBlKTt2YXIgbiA9IGIubWVtb2l6ZWRTdGF0ZTtoICE9PSBxIHx8IHIgIT09IG4gfHwgV2YuY3VycmVudCB8fCAkZyA/ICgiZnVuY3Rpb24iID09PSB0eXBlb2YgeSAmJiAoa2goYiwgYywgeSwgZCksIG4gPSBiLm1lbW9pemVkU3RhdGUpLCAobCA9ICRnIHx8IG9oKGIsIGMsIGwsIGQsIHIsIG4sIGspIHx8ICExKSA/IChtIHx8ICJmdW5jdGlvbiIgIT09IHR5cGVvZiBnLlVOU0FGRV9jb21wb25lbnRXaWxsVXBkYXRlICYmICJmdW5jdGlvbiIgIT09IHR5cGVvZiBnLmNvbXBvbmVudFdpbGxVcGRhdGUgfHwgKCJmdW5jdGlvbiIgPT09IHR5cGVvZiBnLmNvbXBvbmVudFdpbGxVcGRhdGUgJiYgZy5jb21wb25lbnRXaWxsVXBkYXRlKGQsIG4sIGspLCAiZnVuY3Rpb24iID09PSB0eXBlb2YgZy5VTlNBRkVfY29tcG9uZW50V2lsbFVwZGF0ZSAmJgogICAgICAgICAgICAgIGcuVU5TQUZFX2NvbXBvbmVudFdpbGxVcGRhdGUoZCwgbiwgaykpLCAiZnVuY3Rpb24iID09PSB0eXBlb2YgZy5jb21wb25lbnREaWRVcGRhdGUgJiYgKGIuZmxhZ3MgfD0gNCksICJmdW5jdGlvbiIgPT09IHR5cGVvZiBnLmdldFNuYXBzaG90QmVmb3JlVXBkYXRlICYmIChiLmZsYWdzIHw9IDEwMjQpKSA6ICgiZnVuY3Rpb24iICE9PSB0eXBlb2YgZy5jb21wb25lbnREaWRVcGRhdGUgfHwgaCA9PT0gYS5tZW1vaXplZFByb3BzICYmIHIgPT09IGEubWVtb2l6ZWRTdGF0ZSB8fCAoYi5mbGFncyB8PSA0KSwgImZ1bmN0aW9uIiAhPT0gdHlwZW9mIGcuZ2V0U25hcHNob3RCZWZvcmVVcGRhdGUgfHwgaCA9PT0gYS5tZW1vaXplZFByb3BzICYmIHIgPT09IGEubWVtb2l6ZWRTdGF0ZSB8fCAoYi5mbGFncyB8PSAxMDI0KSwgYi5tZW1vaXplZFByb3BzID0gZCwgYi5tZW1vaXplZFN0YXRlID0gbiksIGcucHJvcHMgPSBkLCBnLnN0YXRlID0gbiwgZy5jb250ZXh0ID0gaywgZCA9IGwpIDogKCJmdW5jdGlvbiIgIT09IHR5cGVvZiBnLmNvbXBvbmVudERpZFVwZGF0ZSB8fCBoID09PSBhLm1lbW9pemVkUHJvcHMgJiYgciA9PT0KICAgICAgICAgICAgICBhLm1lbW9pemVkU3RhdGUgfHwgKGIuZmxhZ3MgfD0gNCksICJmdW5jdGlvbiIgIT09IHR5cGVvZiBnLmdldFNuYXBzaG90QmVmb3JlVXBkYXRlIHx8IGggPT09IGEubWVtb2l6ZWRQcm9wcyAmJiByID09PSBhLm1lbW9pemVkU3RhdGUgfHwgKGIuZmxhZ3MgfD0gMTAyNCksIGQgPSAhMSk7fXJldHVybiBraihhLCBiLCBjLCBkLCBmLCBlKTt9CiAgICAgICAgICBmdW5jdGlvbiBraihhLCBiLCBjLCBkLCBlLCBmKSB7aGooYSwgYik7dmFyIGcgPSAwICE9PSAoYi5mbGFncyAmIDEyOCk7aWYgKCFkICYmICFnKSByZXR1cm4gZSAmJiBkZyhiLCBjLCAhMSksICRpKGEsIGIsIGYpO2QgPSBiLnN0YXRlTm9kZTtYaS5jdXJyZW50ID0gYjt2YXIgaCA9IGcgJiYgImZ1bmN0aW9uIiAhPT0gdHlwZW9mIGMuZ2V0RGVyaXZlZFN0YXRlRnJvbUVycm9yID8gbnVsbCA6IGQucmVuZGVyKCk7Yi5mbGFncyB8PSAxO251bGwgIT09IGEgJiYgZyA/IChiLmNoaWxkID0gQmgoYiwgYS5jaGlsZCwgbnVsbCwgZiksIGIuY2hpbGQgPSBCaChiLCBudWxsLCBoLCBmKSkgOiBZaShhLCBiLCBoLCBmKTtiLm1lbW9pemVkU3RhdGUgPSBkLnN0YXRlO2UgJiYgZGcoYiwgYywgITApO3JldHVybiBiLmNoaWxkO31mdW5jdGlvbiBsaihhKSB7dmFyIGIgPSBhLnN0YXRlTm9kZTtiLnBlbmRpbmdDb250ZXh0ID8gYWcoYSwgYi5wZW5kaW5nQ29udGV4dCwgYi5wZW5kaW5nQ29udGV4dCAhPT0gYi5jb250ZXh0KSA6IGIuY29udGV4dCAmJiBhZyhhLCBiLmNvbnRleHQsICExKTtJaChhLCBiLmNvbnRhaW5lckluZm8pO30KICAgICAgICAgIGZ1bmN0aW9uIG1qKGEsIGIsIGMsIGQsIGUpIHtJZygpO0pnKGUpO2IuZmxhZ3MgfD0gMjU2O1lpKGEsIGIsIGMsIGQpO3JldHVybiBiLmNoaWxkO312YXIgbmogPSB7IGRlaHlkcmF0ZWQ6IG51bGwsIHRyZWVDb250ZXh0OiBudWxsLCByZXRyeUxhbmU6IDAgfTtmdW5jdGlvbiBvaihhKSB7cmV0dXJuIHsgYmFzZUxhbmVzOiBhLCBjYWNoZVBvb2w6IG51bGwsIHRyYW5zaXRpb25zOiBudWxsIH07fQogICAgICAgICAgZnVuY3Rpb24gcGooYSwgYiwgYykge3ZhciBkID0gYi5wZW5kaW5nUHJvcHMsZSA9IE0uY3VycmVudCxmID0gITEsZyA9IDAgIT09IChiLmZsYWdzICYgMTI4KSxoOyhoID0gZykgfHwgKGggPSBudWxsICE9PSBhICYmIG51bGwgPT09IGEubWVtb2l6ZWRTdGF0ZSA/ICExIDogMCAhPT0gKGUgJiAyKSk7aWYgKGgpIGYgPSAhMCwgYi5mbGFncyAmPSAtMTI5O2Vsc2UgaWYgKG51bGwgPT09IGEgfHwgbnVsbCAhPT0gYS5tZW1vaXplZFN0YXRlKSBlIHw9IDE7RyhNLCBlICYgMSk7aWYgKG51bGwgPT09IGEpIHtFZyhiKTthID0gYi5tZW1vaXplZFN0YXRlO2lmIChudWxsICE9PSBhICYmIChhID0gYS5kZWh5ZHJhdGVkLCBudWxsICE9PSBhKSkgcmV0dXJuIDAgPT09IChiLm1vZGUgJiAxKSA/IGIubGFuZXMgPSAxIDogIiQhIiA9PT0gYS5kYXRhID8gYi5sYW5lcyA9IDggOiBiLmxhbmVzID0gMTA3Mzc0MTgyNCwgbnVsbDtnID0gZC5jaGlsZHJlbjthID0gZC5mYWxsYmFjaztyZXR1cm4gZiA/IChkID0gYi5tb2RlLCBmID0gYi5jaGlsZCwgZyA9IHsgbW9kZTogImhpZGRlbiIsIGNoaWxkcmVuOiBnIH0sIDAgPT09IChkICYgMSkgJiYgbnVsbCAhPT0gZiA/IChmLmNoaWxkTGFuZXMgPSAwLCBmLnBlbmRpbmdQcm9wcyA9CiAgICAgICAgICAgICAgZykgOiBmID0gcWooZywgZCwgMCwgbnVsbCksIGEgPSBBaChhLCBkLCBjLCBudWxsKSwgZi5yZXR1cm4gPSBiLCBhLnJldHVybiA9IGIsIGYuc2libGluZyA9IGEsIGIuY2hpbGQgPSBmLCBiLmNoaWxkLm1lbW9pemVkU3RhdGUgPSBvaihjKSwgYi5tZW1vaXplZFN0YXRlID0gbmosIGEpIDogcmooYiwgZyk7fWUgPSBhLm1lbW9pemVkU3RhdGU7aWYgKG51bGwgIT09IGUgJiYgKGggPSBlLmRlaHlkcmF0ZWQsIG51bGwgIT09IGgpKSByZXR1cm4gc2ooYSwgYiwgZywgZCwgaCwgZSwgYyk7aWYgKGYpIHtmID0gZC5mYWxsYmFjaztnID0gYi5tb2RlO2UgPSBhLmNoaWxkO2ggPSBlLnNpYmxpbmc7dmFyIGsgPSB7IG1vZGU6ICJoaWRkZW4iLCBjaGlsZHJlbjogZC5jaGlsZHJlbiB9OzAgPT09IChnICYgMSkgJiYgYi5jaGlsZCAhPT0gZSA/IChkID0gYi5jaGlsZCwgZC5jaGlsZExhbmVzID0gMCwgZC5wZW5kaW5nUHJvcHMgPSBrLCBiLmRlbGV0aW9ucyA9IG51bGwpIDogKGQgPSB3aChlLCBrKSwgZC5zdWJ0cmVlRmxhZ3MgPSBlLnN1YnRyZWVGbGFncyAmIDE0NjgwMDY0KTtudWxsICE9PSBoID8gZiA9IHdoKGgsIGYpIDogKGYgPSBBaChmLCBnLCBjLCBudWxsKSwgZi5mbGFncyB8PSAyKTtmLnJldHVybiA9CiAgICAgICAgICAgICAgYjtkLnJldHVybiA9IGI7ZC5zaWJsaW5nID0gZjtiLmNoaWxkID0gZDtkID0gZjtmID0gYi5jaGlsZDtnID0gYS5jaGlsZC5tZW1vaXplZFN0YXRlO2cgPSBudWxsID09PSBnID8gb2ooYykgOiB7IGJhc2VMYW5lczogZy5iYXNlTGFuZXMgfCBjLCBjYWNoZVBvb2w6IG51bGwsIHRyYW5zaXRpb25zOiBnLnRyYW5zaXRpb25zIH07Zi5tZW1vaXplZFN0YXRlID0gZztmLmNoaWxkTGFuZXMgPSBhLmNoaWxkTGFuZXMgJiB+YztiLm1lbW9pemVkU3RhdGUgPSBuajtyZXR1cm4gZDt9ZiA9IGEuY2hpbGQ7YSA9IGYuc2libGluZztkID0gd2goZiwgeyBtb2RlOiAidmlzaWJsZSIsIGNoaWxkcmVuOiBkLmNoaWxkcmVuIH0pOzAgPT09IChiLm1vZGUgJiAxKSAmJiAoZC5sYW5lcyA9IGMpO2QucmV0dXJuID0gYjtkLnNpYmxpbmcgPSBudWxsO251bGwgIT09IGEgJiYgKGMgPSBiLmRlbGV0aW9ucywgbnVsbCA9PT0gYyA/IChiLmRlbGV0aW9ucyA9IFthXSwgYi5mbGFncyB8PSAxNikgOiBjLnB1c2goYSkpO2IuY2hpbGQgPSBkO2IubWVtb2l6ZWRTdGF0ZSA9IG51bGw7cmV0dXJuIGQ7fQogICAgICAgICAgZnVuY3Rpb24gcmooYSwgYikge2IgPSBxaih7IG1vZGU6ICJ2aXNpYmxlIiwgY2hpbGRyZW46IGIgfSwgYS5tb2RlLCAwLCBudWxsKTtiLnJldHVybiA9IGE7cmV0dXJuIGEuY2hpbGQgPSBiO31mdW5jdGlvbiB0aihhLCBiLCBjLCBkKSB7bnVsbCAhPT0gZCAmJiBKZyhkKTtCaChiLCBhLmNoaWxkLCBudWxsLCBjKTthID0gcmooYiwgYi5wZW5kaW5nUHJvcHMuY2hpbGRyZW4pO2EuZmxhZ3MgfD0gMjtiLm1lbW9pemVkU3RhdGUgPSBudWxsO3JldHVybiBhO30KICAgICAgICAgIGZ1bmN0aW9uIHNqKGEsIGIsIGMsIGQsIGUsIGYsIGcpIHtpZiAoYykge2lmIChiLmZsYWdzICYgMjU2KSByZXR1cm4gYi5mbGFncyAmPSAtMjU3LCBkID0gTGkoRXJyb3IocCg0MjIpKSksIHRqKGEsIGIsIGcsIGQpO2lmIChudWxsICE9PSBiLm1lbW9pemVkU3RhdGUpIHJldHVybiBiLmNoaWxkID0gYS5jaGlsZCwgYi5mbGFncyB8PSAxMjgsIG51bGw7ZiA9IGQuZmFsbGJhY2s7ZSA9IGIubW9kZTtkID0gcWooeyBtb2RlOiAidmlzaWJsZSIsIGNoaWxkcmVuOiBkLmNoaWxkcmVuIH0sIGUsIDAsIG51bGwpO2YgPSBBaChmLCBlLCBnLCBudWxsKTtmLmZsYWdzIHw9IDI7ZC5yZXR1cm4gPSBiO2YucmV0dXJuID0gYjtkLnNpYmxpbmcgPSBmO2IuY2hpbGQgPSBkOzAgIT09IChiLm1vZGUgJiAxKSAmJiBCaChiLCBhLmNoaWxkLCBudWxsLCBnKTtiLmNoaWxkLm1lbW9pemVkU3RhdGUgPSBvaihnKTtiLm1lbW9pemVkU3RhdGUgPSBuajtyZXR1cm4gZjt9aWYgKDAgPT09IChiLm1vZGUgJiAxKSkgcmV0dXJuIHRqKGEsIGIsIGcsIG51bGwpO2lmICgiJCEiID09PSBlLmRhdGEpIHtkID0gZS5uZXh0U2libGluZyAmJiBlLm5leHRTaWJsaW5nLmRhdGFzZXQ7CiAgICAgICAgICAgICAgaWYgKGQpIHZhciBoID0gZC5kZ3N0O2QgPSBoO2YgPSBFcnJvcihwKDQxOSkpO2QgPSBMaShmLCBkLCB2b2lkIDApO3JldHVybiB0aihhLCBiLCBnLCBkKTt9aCA9IDAgIT09IChnICYgYS5jaGlsZExhbmVzKTtpZiAoVWcgfHwgaCkge2QgPSBSO2lmIChudWxsICE9PSBkKSB7c3dpdGNoIChnICYgLWcpIHtjYXNlIDQ6ZSA9IDI7YnJlYWs7Y2FzZSAxNjplID0gODticmVhaztjYXNlIDY0OmNhc2UgMTI4OmNhc2UgMjU2OmNhc2UgNTEyOmNhc2UgMTAyNDpjYXNlIDIwNDg6Y2FzZSA0MDk2OmNhc2UgODE5MjpjYXNlIDE2Mzg0OmNhc2UgMzI3Njg6Y2FzZSA2NTUzNjpjYXNlIDEzMTA3MjpjYXNlIDI2MjE0NDpjYXNlIDUyNDI4ODpjYXNlIDEwNDg1NzY6Y2FzZSAyMDk3MTUyOmNhc2UgNDE5NDMwNDpjYXNlIDgzODg2MDg6Y2FzZSAxNjc3NzIxNjpjYXNlIDMzNTU0NDMyOmNhc2UgNjcxMDg4NjQ6ZSA9IDMyO2JyZWFrO2Nhc2UgNTM2ODcwOTEyOmUgPSAyNjg0MzU0NTY7YnJlYWs7ZGVmYXVsdDplID0gMDt9ZSA9IDAgIT09IChlICYgKGQuc3VzcGVuZGVkTGFuZXMgfCBnKSkgPyAwIDogZTsKICAgICAgICAgICAgICAgIDAgIT09IGUgJiYgZSAhPT0gZi5yZXRyeUxhbmUgJiYgKGYucmV0cnlMYW5lID0gZSwgWmcoYSwgZSksIG1oKGQsIGEsIGUsIC0xKSk7fXVqKCk7ZCA9IExpKEVycm9yKHAoNDIxKSkpO3JldHVybiB0aihhLCBiLCBnLCBkKTt9aWYgKCIkPyIgPT09IGUuZGF0YSkgcmV0dXJuIGIuZmxhZ3MgfD0gMTI4LCBiLmNoaWxkID0gYS5jaGlsZCwgYiA9IHZqLmJpbmQobnVsbCwgYSksIGUuX3JlYWN0UmV0cnkgPSBiLCBudWxsO2EgPSBmLnRyZWVDb250ZXh0O3lnID0gTGYoZS5uZXh0U2libGluZyk7eGcgPSBiO0kgPSAhMDt6ZyA9IG51bGw7bnVsbCAhPT0gYSAmJiAob2dbcGcrK10gPSByZywgb2dbcGcrK10gPSBzZywgb2dbcGcrK10gPSBxZywgcmcgPSBhLmlkLCBzZyA9IGEub3ZlcmZsb3csIHFnID0gYik7YiA9IHJqKGIsIGQuY2hpbGRyZW4pO2IuZmxhZ3MgfD0gNDA5NjtyZXR1cm4gYjt9ZnVuY3Rpb24gd2ooYSwgYiwgYykge2EubGFuZXMgfD0gYjt2YXIgZCA9IGEuYWx0ZXJuYXRlO251bGwgIT09IGQgJiYgKGQubGFuZXMgfD0gYik7U2coYS5yZXR1cm4sIGIsIGMpO30KICAgICAgICAgIGZ1bmN0aW9uIHhqKGEsIGIsIGMsIGQsIGUpIHt2YXIgZiA9IGEubWVtb2l6ZWRTdGF0ZTtudWxsID09PSBmID8gYS5tZW1vaXplZFN0YXRlID0geyBpc0JhY2t3YXJkczogYiwgcmVuZGVyaW5nOiBudWxsLCByZW5kZXJpbmdTdGFydFRpbWU6IDAsIGxhc3Q6IGQsIHRhaWw6IGMsIHRhaWxNb2RlOiBlIH0gOiAoZi5pc0JhY2t3YXJkcyA9IGIsIGYucmVuZGVyaW5nID0gbnVsbCwgZi5yZW5kZXJpbmdTdGFydFRpbWUgPSAwLCBmLmxhc3QgPSBkLCBmLnRhaWwgPSBjLCBmLnRhaWxNb2RlID0gZSk7fQogICAgICAgICAgZnVuY3Rpb24geWooYSwgYiwgYykge3ZhciBkID0gYi5wZW5kaW5nUHJvcHMsZSA9IGQucmV2ZWFsT3JkZXIsZiA9IGQudGFpbDtZaShhLCBiLCBkLmNoaWxkcmVuLCBjKTtkID0gTS5jdXJyZW50O2lmICgwICE9PSAoZCAmIDIpKSBkID0gZCAmIDEgfCAyLCBiLmZsYWdzIHw9IDEyODtlbHNlIHtpZiAobnVsbCAhPT0gYSAmJiAwICE9PSAoYS5mbGFncyAmIDEyOCkpIGE6IGZvciAoYSA9IGIuY2hpbGQ7IG51bGwgIT09IGE7KSB7aWYgKDEzID09PSBhLnRhZykgbnVsbCAhPT0gYS5tZW1vaXplZFN0YXRlICYmIHdqKGEsIGMsIGIpO2Vsc2UgaWYgKDE5ID09PSBhLnRhZykgd2ooYSwgYywgYik7ZWxzZSBpZiAobnVsbCAhPT0gYS5jaGlsZCkge2EuY2hpbGQucmV0dXJuID0gYTthID0gYS5jaGlsZDtjb250aW51ZTt9aWYgKGEgPT09IGIpIGJyZWFrIGE7Zm9yICg7IG51bGwgPT09IGEuc2libGluZzspIHtpZiAobnVsbCA9PT0gYS5yZXR1cm4gfHwgYS5yZXR1cm4gPT09IGIpIGJyZWFrIGE7YSA9IGEucmV0dXJuO31hLnNpYmxpbmcucmV0dXJuID0gYS5yZXR1cm47YSA9IGEuc2libGluZzt9ZCAmPSAxO31HKE0sIGQpO2lmICgwID09PSAoYi5tb2RlICYgMSkpIGIubWVtb2l6ZWRTdGF0ZSA9CiAgICAgICAgICAgIG51bGw7ZWxzZSBzd2l0Y2ggKGUpIHtjYXNlICJmb3J3YXJkcyI6YyA9IGIuY2hpbGQ7Zm9yIChlID0gbnVsbDsgbnVsbCAhPT0gYzspIHthID0gYy5hbHRlcm5hdGUsIG51bGwgIT09IGEgJiYgbnVsbCA9PT0gTWgoYSkgJiYgKGUgPSBjKSwgYyA9IGMuc2libGluZzt9YyA9IGU7bnVsbCA9PT0gYyA/IChlID0gYi5jaGlsZCwgYi5jaGlsZCA9IG51bGwpIDogKGUgPSBjLnNpYmxpbmcsIGMuc2libGluZyA9IG51bGwpO3hqKGIsICExLCBlLCBjLCBmKTticmVhaztjYXNlICJiYWNrd2FyZHMiOmMgPSBudWxsO2UgPSBiLmNoaWxkO2ZvciAoYi5jaGlsZCA9IG51bGw7IG51bGwgIT09IGU7KSB7YSA9IGUuYWx0ZXJuYXRlO2lmIChudWxsICE9PSBhICYmIG51bGwgPT09IE1oKGEpKSB7Yi5jaGlsZCA9IGU7YnJlYWs7fWEgPSBlLnNpYmxpbmc7ZS5zaWJsaW5nID0gYztjID0gZTtlID0gYTt9eGooYiwgITAsIGMsIG51bGwsIGYpO2JyZWFrO2Nhc2UgInRvZ2V0aGVyIjp4aihiLCAhMSwgbnVsbCwgbnVsbCwgdm9pZCAwKTticmVhaztkZWZhdWx0OmIubWVtb2l6ZWRTdGF0ZSA9IG51bGw7fXJldHVybiBiLmNoaWxkO30KICAgICAgICAgIGZ1bmN0aW9uIGpqKGEsIGIpIHswID09PSAoYi5tb2RlICYgMSkgJiYgbnVsbCAhPT0gYSAmJiAoYS5hbHRlcm5hdGUgPSBudWxsLCBiLmFsdGVybmF0ZSA9IG51bGwsIGIuZmxhZ3MgfD0gMik7fWZ1bmN0aW9uICRpKGEsIGIsIGMpIHtudWxsICE9PSBhICYmIChiLmRlcGVuZGVuY2llcyA9IGEuZGVwZW5kZW5jaWVzKTtoaCB8PSBiLmxhbmVzO2lmICgwID09PSAoYyAmIGIuY2hpbGRMYW5lcykpIHJldHVybiBudWxsO2lmIChudWxsICE9PSBhICYmIGIuY2hpbGQgIT09IGEuY2hpbGQpIHRocm93IEVycm9yKHAoMTUzKSk7aWYgKG51bGwgIT09IGIuY2hpbGQpIHthID0gYi5jaGlsZDtjID0gd2goYSwgYS5wZW5kaW5nUHJvcHMpO2IuY2hpbGQgPSBjO2ZvciAoYy5yZXR1cm4gPSBiOyBudWxsICE9PSBhLnNpYmxpbmc7KSB7YSA9IGEuc2libGluZywgYyA9IGMuc2libGluZyA9IHdoKGEsIGEucGVuZGluZ1Byb3BzKSwgYy5yZXR1cm4gPSBiO31jLnNpYmxpbmcgPSBudWxsO31yZXR1cm4gYi5jaGlsZDt9CiAgICAgICAgICBmdW5jdGlvbiB6aihhLCBiLCBjKSB7c3dpdGNoIChiLnRhZykge2Nhc2UgMzpsaihiKTtJZygpO2JyZWFrO2Nhc2UgNTpLaChiKTticmVhaztjYXNlIDE6WmYoYi50eXBlKSAmJiBjZyhiKTticmVhaztjYXNlIDQ6SWgoYiwgYi5zdGF0ZU5vZGUuY29udGFpbmVySW5mbyk7YnJlYWs7Y2FzZSAxMDp2YXIgZCA9IGIudHlwZS5fY29udGV4dCxlID0gYi5tZW1vaXplZFByb3BzLnZhbHVlO0coTWcsIGQuX2N1cnJlbnRWYWx1ZSk7ZC5fY3VycmVudFZhbHVlID0gZTticmVhaztjYXNlIDEzOmQgPSBiLm1lbW9pemVkU3RhdGU7aWYgKG51bGwgIT09IGQpIHtpZiAobnVsbCAhPT0gZC5kZWh5ZHJhdGVkKSByZXR1cm4gRyhNLCBNLmN1cnJlbnQgJiAxKSwgYi5mbGFncyB8PSAxMjgsIG51bGw7aWYgKDAgIT09IChjICYgYi5jaGlsZC5jaGlsZExhbmVzKSkgcmV0dXJuIHBqKGEsIGIsIGMpO0coTSwgTS5jdXJyZW50ICYgMSk7YSA9ICRpKGEsIGIsIGMpO3JldHVybiBudWxsICE9PSBhID8gYS5zaWJsaW5nIDogbnVsbDt9RyhNLCBNLmN1cnJlbnQgJiAxKTticmVhaztjYXNlIDE5OmQgPSAwICE9PSAoYyAmCiAgICAgICAgICAgICAgICBiLmNoaWxkTGFuZXMpO2lmICgwICE9PSAoYS5mbGFncyAmIDEyOCkpIHtpZiAoZCkgcmV0dXJuIHlqKGEsIGIsIGMpO2IuZmxhZ3MgfD0gMTI4O31lID0gYi5tZW1vaXplZFN0YXRlO251bGwgIT09IGUgJiYgKGUucmVuZGVyaW5nID0gbnVsbCwgZS50YWlsID0gbnVsbCwgZS5sYXN0RWZmZWN0ID0gbnVsbCk7RyhNLCBNLmN1cnJlbnQpO2lmIChkKSBicmVhaztlbHNlIHJldHVybiBudWxsO2Nhc2UgMjI6Y2FzZSAyMzpyZXR1cm4gYi5sYW5lcyA9IDAsIGVqKGEsIGIsIGMpO31yZXR1cm4gJGkoYSwgYiwgYyk7fXZhciBBaiwgQmosIENqLCBEajsKICAgICAgICAgIEFqID0gZnVuY3Rpb24gQWooYSwgYikge2ZvciAodmFyIGMgPSBiLmNoaWxkOyBudWxsICE9PSBjOykge2lmICg1ID09PSBjLnRhZyB8fCA2ID09PSBjLnRhZykgYS5hcHBlbmRDaGlsZChjLnN0YXRlTm9kZSk7ZWxzZSBpZiAoNCAhPT0gYy50YWcgJiYgbnVsbCAhPT0gYy5jaGlsZCkge2MuY2hpbGQucmV0dXJuID0gYztjID0gYy5jaGlsZDtjb250aW51ZTt9aWYgKGMgPT09IGIpIGJyZWFrO2ZvciAoOyBudWxsID09PSBjLnNpYmxpbmc7KSB7aWYgKG51bGwgPT09IGMucmV0dXJuIHx8IGMucmV0dXJuID09PSBiKSByZXR1cm47YyA9IGMucmV0dXJuO31jLnNpYmxpbmcucmV0dXJuID0gYy5yZXR1cm47YyA9IGMuc2libGluZzt9fTtCaiA9IGZ1bmN0aW9uIEJqKCkge307CiAgICAgICAgICBDaiA9IGZ1bmN0aW9uIENqKGEsIGIsIGMsIGQpIHt2YXIgZSA9IGEubWVtb2l6ZWRQcm9wcztpZiAoZSAhPT0gZCkge2EgPSBiLnN0YXRlTm9kZTtIaChFaC5jdXJyZW50KTt2YXIgZiA9IG51bGw7c3dpdGNoIChjKSB7Y2FzZSAiaW5wdXQiOmUgPSBZYShhLCBlKTtkID0gWWEoYSwgZCk7ZiA9IFtdO2JyZWFrO2Nhc2UgInNlbGVjdCI6ZSA9IEEoe30sIGUsIHsgdmFsdWU6IHZvaWQgMCB9KTtkID0gQSh7fSwgZCwgeyB2YWx1ZTogdm9pZCAwIH0pO2YgPSBbXTticmVhaztjYXNlICJ0ZXh0YXJlYSI6ZSA9IGdiKGEsIGUpO2QgPSBnYihhLCBkKTtmID0gW107YnJlYWs7ZGVmYXVsdDoiZnVuY3Rpb24iICE9PSB0eXBlb2YgZS5vbkNsaWNrICYmICJmdW5jdGlvbiIgPT09IHR5cGVvZiBkLm9uQ2xpY2sgJiYgKGEub25jbGljayA9IEJmKTt9dWIoYywgZCk7dmFyIGc7YyA9IG51bGw7Zm9yIChsIGluIGUpIHtpZiAoIWQuaGFzT3duUHJvcGVydHkobCkgJiYgZS5oYXNPd25Qcm9wZXJ0eShsKSAmJiBudWxsICE9IGVbbF0pIGlmICgic3R5bGUiID09PSBsKSB7dmFyIGggPSBlW2xdO2ZvciAoZyBpbiBoKSB7aC5oYXNPd25Qcm9wZXJ0eShnKSAmJiAoCiAgICAgICAgICAgICAgICAgICAgYyB8fCAoYyA9IHt9KSwgY1tnXSA9ICIiKTt9fSBlbHNlICJkYW5nZXJvdXNseVNldElubmVySFRNTCIgIT09IGwgJiYgImNoaWxkcmVuIiAhPT0gbCAmJiAic3VwcHJlc3NDb250ZW50RWRpdGFibGVXYXJuaW5nIiAhPT0gbCAmJiAic3VwcHJlc3NIeWRyYXRpb25XYXJuaW5nIiAhPT0gbCAmJiAiYXV0b0ZvY3VzIiAhPT0gbCAmJiAoZWEuaGFzT3duUHJvcGVydHkobCkgPyBmIHx8IChmID0gW10pIDogKGYgPSBmIHx8IFtdKS5wdXNoKGwsIG51bGwpKTt9Zm9yIChsIGluIGQpIHt2YXIgayA9IGRbbF07aCA9IG51bGwgIT0gZSA/IGVbbF0gOiB2b2lkIDA7aWYgKGQuaGFzT3duUHJvcGVydHkobCkgJiYgayAhPT0gaCAmJiAobnVsbCAhPSBrIHx8IG51bGwgIT0gaCkpIGlmICgic3R5bGUiID09PSBsKSB7aWYgKGgpIHtmb3IgKGcgaW4gaCkgeyFoLmhhc093blByb3BlcnR5KGcpIHx8IGsgJiYgay5oYXNPd25Qcm9wZXJ0eShnKSB8fCAoYyB8fCAoYyA9IHt9KSwgY1tnXSA9ICIiKTt9Zm9yIChnIGluIGspIHtrLmhhc093blByb3BlcnR5KGcpICYmIGhbZ10gIT09IGtbZ10gJiYgKGMgfHwgKGMgPSB7fSksIGNbZ10gPSBrW2ddKTt9fSBlbHNlIGMgfHwgKGYgfHwgKGYgPSBbXSksIGYucHVzaChsLAogICAgICAgICAgICAgICAgICBjKSksIGMgPSBrO30gZWxzZSAiZGFuZ2Vyb3VzbHlTZXRJbm5lckhUTUwiID09PSBsID8gKGsgPSBrID8gay5fX2h0bWwgOiB2b2lkIDAsIGggPSBoID8gaC5fX2h0bWwgOiB2b2lkIDAsIG51bGwgIT0gayAmJiBoICE9PSBrICYmIChmID0gZiB8fCBbXSkucHVzaChsLCBrKSkgOiAiY2hpbGRyZW4iID09PSBsID8gInN0cmluZyIgIT09IHR5cGVvZiBrICYmICJudW1iZXIiICE9PSB0eXBlb2YgayB8fCAoZiA9IGYgfHwgW10pLnB1c2gobCwgIiIgKyBrKSA6ICJzdXBwcmVzc0NvbnRlbnRFZGl0YWJsZVdhcm5pbmciICE9PSBsICYmICJzdXBwcmVzc0h5ZHJhdGlvbldhcm5pbmciICE9PSBsICYmIChlYS5oYXNPd25Qcm9wZXJ0eShsKSA/IChudWxsICE9IGsgJiYgIm9uU2Nyb2xsIiA9PT0gbCAmJiBEKCJzY3JvbGwiLCBhKSwgZiB8fCBoID09PSBrIHx8IChmID0gW10pKSA6IChmID0gZiB8fCBbXSkucHVzaChsLCBrKSk7fWMgJiYgKGYgPSBmIHx8IFtdKS5wdXNoKCJzdHlsZSIsIGMpO3ZhciBsID0gZjtpZiAoYi51cGRhdGVRdWV1ZSA9IGwpIGIuZmxhZ3MgfD0gNDt9fTtEaiA9IGZ1bmN0aW9uIERqKGEsIGIsIGMsIGQpIHtjICE9PSBkICYmIChiLmZsYWdzIHw9IDQpO307CiAgICAgICAgICBmdW5jdGlvbiBFaihhLCBiKSB7aWYgKCFJKSBzd2l0Y2ggKGEudGFpbE1vZGUpIHtjYXNlICJoaWRkZW4iOmIgPSBhLnRhaWw7Zm9yICh2YXIgYyA9IG51bGw7IG51bGwgIT09IGI7KSB7bnVsbCAhPT0gYi5hbHRlcm5hdGUgJiYgKGMgPSBiKSwgYiA9IGIuc2libGluZzt9bnVsbCA9PT0gYyA/IGEudGFpbCA9IG51bGwgOiBjLnNpYmxpbmcgPSBudWxsO2JyZWFrO2Nhc2UgImNvbGxhcHNlZCI6YyA9IGEudGFpbDtmb3IgKHZhciBkID0gbnVsbDsgbnVsbCAhPT0gYzspIHtudWxsICE9PSBjLmFsdGVybmF0ZSAmJiAoZCA9IGMpLCBjID0gYy5zaWJsaW5nO31udWxsID09PSBkID8gYiB8fCBudWxsID09PSBhLnRhaWwgPyBhLnRhaWwgPSBudWxsIDogYS50YWlsLnNpYmxpbmcgPSBudWxsIDogZC5zaWJsaW5nID0gbnVsbDt9fQogICAgICAgICAgZnVuY3Rpb24gUyhhKSB7dmFyIGIgPSBudWxsICE9PSBhLmFsdGVybmF0ZSAmJiBhLmFsdGVybmF0ZS5jaGlsZCA9PT0gYS5jaGlsZCxjID0gMCxkID0gMDtpZiAoYikgZm9yICh2YXIgZSA9IGEuY2hpbGQ7IG51bGwgIT09IGU7KSB7YyB8PSBlLmxhbmVzIHwgZS5jaGlsZExhbmVzLCBkIHw9IGUuc3VidHJlZUZsYWdzICYgMTQ2ODAwNjQsIGQgfD0gZS5mbGFncyAmIDE0NjgwMDY0LCBlLnJldHVybiA9IGEsIGUgPSBlLnNpYmxpbmc7fSBlbHNlIGZvciAoZSA9IGEuY2hpbGQ7IG51bGwgIT09IGU7KSB7YyB8PSBlLmxhbmVzIHwgZS5jaGlsZExhbmVzLCBkIHw9IGUuc3VidHJlZUZsYWdzLCBkIHw9IGUuZmxhZ3MsIGUucmV0dXJuID0gYSwgZSA9IGUuc2libGluZzt9YS5zdWJ0cmVlRmxhZ3MgfD0gZDthLmNoaWxkTGFuZXMgPSBjO3JldHVybiBiO30KICAgICAgICAgIGZ1bmN0aW9uIEZqKGEsIGIsIGMpIHt2YXIgZCA9IGIucGVuZGluZ1Byb3BzO3dnKGIpO3N3aXRjaCAoYi50YWcpIHtjYXNlIDI6Y2FzZSAxNjpjYXNlIDE1OmNhc2UgMDpjYXNlIDExOmNhc2UgNzpjYXNlIDg6Y2FzZSAxMjpjYXNlIDk6Y2FzZSAxNDpyZXR1cm4gUyhiKSwgbnVsbDtjYXNlIDE6cmV0dXJuIFpmKGIudHlwZSkgJiYgJGYoKSwgUyhiKSwgbnVsbDtjYXNlIDM6ZCA9IGIuc3RhdGVOb2RlO0poKCk7RShXZik7RShIKTtPaCgpO2QucGVuZGluZ0NvbnRleHQgJiYgKGQuY29udGV4dCA9IGQucGVuZGluZ0NvbnRleHQsIGQucGVuZGluZ0NvbnRleHQgPSBudWxsKTtpZiAobnVsbCA9PT0gYSB8fCBudWxsID09PSBhLmNoaWxkKSBHZyhiKSA/IGIuZmxhZ3MgfD0gNCA6IG51bGwgPT09IGEgfHwgYS5tZW1vaXplZFN0YXRlLmlzRGVoeWRyYXRlZCAmJiAwID09PSAoYi5mbGFncyAmIDI1NikgfHwgKGIuZmxhZ3MgfD0gMTAyNCwgbnVsbCAhPT0gemcgJiYgKEdqKHpnKSwgemcgPSBudWxsKSk7QmooYSwgYik7UyhiKTtyZXR1cm4gbnVsbDtjYXNlIDU6TGgoYik7dmFyIGUgPSBIaChHaC5jdXJyZW50KTsKICAgICAgICAgICAgICAgIGMgPSBiLnR5cGU7aWYgKG51bGwgIT09IGEgJiYgbnVsbCAhPSBiLnN0YXRlTm9kZSkgQ2ooYSwgYiwgYywgZCwgZSksIGEucmVmICE9PSBiLnJlZiAmJiAoYi5mbGFncyB8PSA1MTIsIGIuZmxhZ3MgfD0gMjA5NzE1Mik7ZWxzZSB7aWYgKCFkKSB7aWYgKG51bGwgPT09IGIuc3RhdGVOb2RlKSB0aHJvdyBFcnJvcihwKDE2NikpO1MoYik7cmV0dXJuIG51bGw7fWEgPSBIaChFaC5jdXJyZW50KTtpZiAoR2coYikpIHtkID0gYi5zdGF0ZU5vZGU7YyA9IGIudHlwZTt2YXIgZiA9IGIubWVtb2l6ZWRQcm9wcztkW09mXSA9IGI7ZFtQZl0gPSBmO2EgPSAwICE9PSAoYi5tb2RlICYgMSk7c3dpdGNoIChjKSB7Y2FzZSAiZGlhbG9nIjpEKCJjYW5jZWwiLCBkKTtEKCJjbG9zZSIsIGQpO2JyZWFrO2Nhc2UgImlmcmFtZSI6Y2FzZSAib2JqZWN0IjpjYXNlICJlbWJlZCI6RCgibG9hZCIsIGQpO2JyZWFrO2Nhc2UgInZpZGVvIjpjYXNlICJhdWRpbyI6Zm9yIChlID0gMDsgZSA8IGxmLmxlbmd0aDsgZSsrKSB7RChsZltlXSwgZCk7fWJyZWFrO2Nhc2UgInNvdXJjZSI6RCgiZXJyb3IiLCBkKTticmVhaztjYXNlICJpbWciOmNhc2UgImltYWdlIjpjYXNlICJsaW5rIjpEKCJlcnJvciIsCiAgICAgICAgICAgICAgICAgICAgICAgIGQpO0QoImxvYWQiLCBkKTticmVhaztjYXNlICJkZXRhaWxzIjpEKCJ0b2dnbGUiLCBkKTticmVhaztjYXNlICJpbnB1dCI6WmEoZCwgZik7RCgiaW52YWxpZCIsIGQpO2JyZWFrO2Nhc2UgInNlbGVjdCI6ZC5fd3JhcHBlclN0YXRlID0geyB3YXNNdWx0aXBsZTogISFmLm11bHRpcGxlIH07RCgiaW52YWxpZCIsIGQpO2JyZWFrO2Nhc2UgInRleHRhcmVhIjpoYihkLCBmKSwgRCgiaW52YWxpZCIsIGQpO311YihjLCBmKTtlID0gbnVsbDtmb3IgKHZhciBnIGluIGYpIHtpZiAoZi5oYXNPd25Qcm9wZXJ0eShnKSkge3ZhciBoID0gZltnXTsiY2hpbGRyZW4iID09PSBnID8gInN0cmluZyIgPT09IHR5cGVvZiBoID8gZC50ZXh0Q29udGVudCAhPT0gaCAmJiAoITAgIT09IGYuc3VwcHJlc3NIeWRyYXRpb25XYXJuaW5nICYmIEFmKGQudGV4dENvbnRlbnQsIGgsIGEpLCBlID0gWyJjaGlsZHJlbiIsIGhdKSA6ICJudW1iZXIiID09PSB0eXBlb2YgaCAmJiBkLnRleHRDb250ZW50ICE9PSAiIiArIGggJiYgKCEwICE9PSBmLnN1cHByZXNzSHlkcmF0aW9uV2FybmluZyAmJiBBZihkLnRleHRDb250ZW50LAogICAgICAgICAgICAgICAgICAgICAgICBoLCBhKSwgZSA9IFsiY2hpbGRyZW4iLCAiIiArIGhdKSA6IGVhLmhhc093blByb3BlcnR5KGcpICYmIG51bGwgIT0gaCAmJiAib25TY3JvbGwiID09PSBnICYmIEQoInNjcm9sbCIsIGQpO319c3dpdGNoIChjKSB7Y2FzZSAiaW5wdXQiOlZhKGQpO2RiKGQsIGYsICEwKTticmVhaztjYXNlICJ0ZXh0YXJlYSI6VmEoZCk7amIoZCk7YnJlYWs7Y2FzZSAic2VsZWN0IjpjYXNlICJvcHRpb24iOmJyZWFrO2RlZmF1bHQ6ImZ1bmN0aW9uIiA9PT0gdHlwZW9mIGYub25DbGljayAmJiAoZC5vbmNsaWNrID0gQmYpO31kID0gZTtiLnVwZGF0ZVF1ZXVlID0gZDtudWxsICE9PSBkICYmIChiLmZsYWdzIHw9IDQpO30gZWxzZSB7ZyA9IDkgPT09IGUubm9kZVR5cGUgPyBlIDogZS5vd25lckRvY3VtZW50OyJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hodG1sIiA9PT0gYSAmJiAoYSA9IGtiKGMpKTsiaHR0cDovL3d3dy53My5vcmcvMTk5OS94aHRtbCIgPT09IGEgPyAic2NyaXB0IiA9PT0gYyA/IChhID0gZy5jcmVhdGVFbGVtZW50KCJkaXYiKSwgYS5pbm5lckhUTUwgPSAiPHNjcmlwdD5ceDNjL3NjcmlwdD4iLCBhID0gYS5yZW1vdmVDaGlsZChhLmZpcnN0Q2hpbGQpKSA6CiAgICAgICAgICAgICAgICAgICAgInN0cmluZyIgPT09IHR5cGVvZiBkLmlzID8gYSA9IGcuY3JlYXRlRWxlbWVudChjLCB7IGlzOiBkLmlzIH0pIDogKGEgPSBnLmNyZWF0ZUVsZW1lbnQoYyksICJzZWxlY3QiID09PSBjICYmIChnID0gYSwgZC5tdWx0aXBsZSA/IGcubXVsdGlwbGUgPSAhMCA6IGQuc2l6ZSAmJiAoZy5zaXplID0gZC5zaXplKSkpIDogYSA9IGcuY3JlYXRlRWxlbWVudE5TKGEsIGMpO2FbT2ZdID0gYjthW1BmXSA9IGQ7QWooYSwgYiwgITEsICExKTtiLnN0YXRlTm9kZSA9IGE7YToge2cgPSB2YihjLCBkKTtzd2l0Y2ggKGMpIHtjYXNlICJkaWFsb2ciOkQoImNhbmNlbCIsIGEpO0QoImNsb3NlIiwgYSk7ZSA9IGQ7YnJlYWs7Y2FzZSAiaWZyYW1lIjpjYXNlICJvYmplY3QiOmNhc2UgImVtYmVkIjpEKCJsb2FkIiwgYSk7ZSA9IGQ7YnJlYWs7Y2FzZSAidmlkZW8iOmNhc2UgImF1ZGlvIjpmb3IgKGUgPSAwOyBlIDwgbGYubGVuZ3RoOyBlKyspIHtEKGxmW2VdLCBhKTt9ZSA9IGQ7YnJlYWs7Y2FzZSAic291cmNlIjpEKCJlcnJvciIsIGEpO2UgPSBkO2JyZWFrO2Nhc2UgImltZyI6Y2FzZSAiaW1hZ2UiOmNhc2UgImxpbmsiOkQoImVycm9yIiwKICAgICAgICAgICAgICAgICAgICAgICAgICBhKTtEKCJsb2FkIiwgYSk7ZSA9IGQ7YnJlYWs7Y2FzZSAiZGV0YWlscyI6RCgidG9nZ2xlIiwgYSk7ZSA9IGQ7YnJlYWs7Y2FzZSAiaW5wdXQiOlphKGEsIGQpO2UgPSBZYShhLCBkKTtEKCJpbnZhbGlkIiwgYSk7YnJlYWs7Y2FzZSAib3B0aW9uIjplID0gZDticmVhaztjYXNlICJzZWxlY3QiOmEuX3dyYXBwZXJTdGF0ZSA9IHsgd2FzTXVsdGlwbGU6ICEhZC5tdWx0aXBsZSB9O2UgPSBBKHt9LCBkLCB7IHZhbHVlOiB2b2lkIDAgfSk7RCgiaW52YWxpZCIsIGEpO2JyZWFrO2Nhc2UgInRleHRhcmVhIjpoYihhLCBkKTtlID0gZ2IoYSwgZCk7RCgiaW52YWxpZCIsIGEpO2JyZWFrO2RlZmF1bHQ6ZSA9IGQ7fXViKGMsIGUpO2ggPSBlO2ZvciAoZiBpbiBoKSB7aWYgKGguaGFzT3duUHJvcGVydHkoZikpIHt2YXIgayA9IGhbZl07InN0eWxlIiA9PT0gZiA/IHNiKGEsIGspIDogImRhbmdlcm91c2x5U2V0SW5uZXJIVE1MIiA9PT0gZiA/IChrID0gayA/IGsuX19odG1sIDogdm9pZCAwLCBudWxsICE9IGsgJiYgbmIoYSwgaykpIDogImNoaWxkcmVuIiA9PT0gZiA/ICJzdHJpbmciID09PSB0eXBlb2YgayA/ICgidGV4dGFyZWEiICE9PQogICAgICAgICAgICAgICAgICAgICAgICAgIGMgfHwgIiIgIT09IGspICYmIG9iKGEsIGspIDogIm51bWJlciIgPT09IHR5cGVvZiBrICYmIG9iKGEsICIiICsgaykgOiAic3VwcHJlc3NDb250ZW50RWRpdGFibGVXYXJuaW5nIiAhPT0gZiAmJiAic3VwcHJlc3NIeWRyYXRpb25XYXJuaW5nIiAhPT0gZiAmJiAiYXV0b0ZvY3VzIiAhPT0gZiAmJiAoZWEuaGFzT3duUHJvcGVydHkoZikgPyBudWxsICE9IGsgJiYgIm9uU2Nyb2xsIiA9PT0gZiAmJiBEKCJzY3JvbGwiLCBhKSA6IG51bGwgIT0gayAmJiB0YShhLCBmLCBrLCBnKSk7fX1zd2l0Y2ggKGMpIHtjYXNlICJpbnB1dCI6VmEoYSk7ZGIoYSwgZCwgITEpO2JyZWFrO2Nhc2UgInRleHRhcmVhIjpWYShhKTtqYihhKTticmVhaztjYXNlICJvcHRpb24iOm51bGwgIT0gZC52YWx1ZSAmJiBhLnNldEF0dHJpYnV0ZSgidmFsdWUiLCAiIiArIFNhKGQudmFsdWUpKTticmVhaztjYXNlICJzZWxlY3QiOmEubXVsdGlwbGUgPSAhIWQubXVsdGlwbGU7ZiA9IGQudmFsdWU7bnVsbCAhPSBmID8gZmIoYSwgISFkLm11bHRpcGxlLCBmLCAhMSkgOiBudWxsICE9IGQuZGVmYXVsdFZhbHVlICYmIGZiKGEsICEhZC5tdWx0aXBsZSwgZC5kZWZhdWx0VmFsdWUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgITApO2JyZWFrO2RlZmF1bHQ6ImZ1bmN0aW9uIiA9PT0gdHlwZW9mIGUub25DbGljayAmJiAoYS5vbmNsaWNrID0gQmYpO31zd2l0Y2ggKGMpIHtjYXNlICJidXR0b24iOmNhc2UgImlucHV0IjpjYXNlICJzZWxlY3QiOmNhc2UgInRleHRhcmVhIjpkID0gISFkLmF1dG9Gb2N1czticmVhayBhO2Nhc2UgImltZyI6ZCA9ICEwO2JyZWFrIGE7ZGVmYXVsdDpkID0gITE7fX1kICYmIChiLmZsYWdzIHw9IDQpO31udWxsICE9PSBiLnJlZiAmJiAoYi5mbGFncyB8PSA1MTIsIGIuZmxhZ3MgfD0gMjA5NzE1Mik7fVMoYik7cmV0dXJuIG51bGw7Y2FzZSA2OmlmIChhICYmIG51bGwgIT0gYi5zdGF0ZU5vZGUpIERqKGEsIGIsIGEubWVtb2l6ZWRQcm9wcywgZCk7ZWxzZSB7aWYgKCJzdHJpbmciICE9PSB0eXBlb2YgZCAmJiBudWxsID09PSBiLnN0YXRlTm9kZSkgdGhyb3cgRXJyb3IocCgxNjYpKTtjID0gSGgoR2guY3VycmVudCk7SGgoRWguY3VycmVudCk7aWYgKEdnKGIpKSB7ZCA9IGIuc3RhdGVOb2RlO2MgPSBiLm1lbW9pemVkUHJvcHM7ZFtPZl0gPSBiO2lmIChmID0gZC5ub2RlVmFsdWUgIT09IGMpIGlmIChhID0KICAgICAgICAgICAgICAgICAgICB4ZywgbnVsbCAhPT0gYSkgc3dpdGNoIChhLnRhZykge2Nhc2UgMzpBZihkLm5vZGVWYWx1ZSwgYywgMCAhPT0gKGEubW9kZSAmIDEpKTticmVhaztjYXNlIDU6ITAgIT09IGEubWVtb2l6ZWRQcm9wcy5zdXBwcmVzc0h5ZHJhdGlvbldhcm5pbmcgJiYgQWYoZC5ub2RlVmFsdWUsIGMsIDAgIT09IChhLm1vZGUgJiAxKSk7fWYgJiYgKGIuZmxhZ3MgfD0gNCk7fSBlbHNlIGQgPSAoOSA9PT0gYy5ub2RlVHlwZSA/IGMgOiBjLm93bmVyRG9jdW1lbnQpLmNyZWF0ZVRleHROb2RlKGQpLCBkW09mXSA9IGIsIGIuc3RhdGVOb2RlID0gZDt9UyhiKTtyZXR1cm4gbnVsbDtjYXNlIDEzOkUoTSk7ZCA9IGIubWVtb2l6ZWRTdGF0ZTtpZiAobnVsbCA9PT0gYSB8fCBudWxsICE9PSBhLm1lbW9pemVkU3RhdGUgJiYgbnVsbCAhPT0gYS5tZW1vaXplZFN0YXRlLmRlaHlkcmF0ZWQpIHtpZiAoSSAmJiBudWxsICE9PSB5ZyAmJiAwICE9PSAoYi5tb2RlICYgMSkgJiYgMCA9PT0gKGIuZmxhZ3MgJiAxMjgpKSBIZygpLCBJZygpLCBiLmZsYWdzIHw9IDk4NTYwLCBmID0gITE7ZWxzZSBpZiAoZiA9IEdnKGIpLCBudWxsICE9PSBkICYmIG51bGwgIT09IGQuZGVoeWRyYXRlZCkge2lmIChudWxsID09PQogICAgICAgICAgICAgICAgICAgIGEpIHtpZiAoIWYpIHRocm93IEVycm9yKHAoMzE4KSk7ZiA9IGIubWVtb2l6ZWRTdGF0ZTtmID0gbnVsbCAhPT0gZiA/IGYuZGVoeWRyYXRlZCA6IG51bGw7aWYgKCFmKSB0aHJvdyBFcnJvcihwKDMxNykpO2ZbT2ZdID0gYjt9IGVsc2UgSWcoKSwgMCA9PT0gKGIuZmxhZ3MgJiAxMjgpICYmIChiLm1lbW9pemVkU3RhdGUgPSBudWxsKSwgYi5mbGFncyB8PSA0O1MoYik7ZiA9ICExO30gZWxzZSBudWxsICE9PSB6ZyAmJiAoR2ooemcpLCB6ZyA9IG51bGwpLCBmID0gITA7aWYgKCFmKSByZXR1cm4gYi5mbGFncyAmIDY1NTM2ID8gYiA6IG51bGw7fWlmICgwICE9PSAoYi5mbGFncyAmIDEyOCkpIHJldHVybiBiLmxhbmVzID0gYywgYjtkID0gbnVsbCAhPT0gZDtkICE9PSAobnVsbCAhPT0gYSAmJiBudWxsICE9PSBhLm1lbW9pemVkU3RhdGUpICYmIGQgJiYgKGIuY2hpbGQuZmxhZ3MgfD0gODE5MiwgMCAhPT0gKGIubW9kZSAmIDEpICYmIChudWxsID09PSBhIHx8IDAgIT09IChNLmN1cnJlbnQgJiAxKSA/IDAgPT09IFQgJiYgKFQgPSAzKSA6IHVqKCkpKTtudWxsICE9PSBiLnVwZGF0ZVF1ZXVlICYmIChiLmZsYWdzIHw9IDQpO1MoYik7cmV0dXJuIG51bGw7Y2FzZSA0OnJldHVybiBKaCgpLAogICAgICAgICAgICAgICAgQmooYSwgYiksIG51bGwgPT09IGEgJiYgc2YoYi5zdGF0ZU5vZGUuY29udGFpbmVySW5mbyksIFMoYiksIG51bGw7Y2FzZSAxMDpyZXR1cm4gUmcoYi50eXBlLl9jb250ZXh0KSwgUyhiKSwgbnVsbDtjYXNlIDE3OnJldHVybiBaZihiLnR5cGUpICYmICRmKCksIFMoYiksIG51bGw7Y2FzZSAxOTpFKE0pO2YgPSBiLm1lbW9pemVkU3RhdGU7aWYgKG51bGwgPT09IGYpIHJldHVybiBTKGIpLCBudWxsO2QgPSAwICE9PSAoYi5mbGFncyAmIDEyOCk7ZyA9IGYucmVuZGVyaW5nO2lmIChudWxsID09PSBnKSB7aWYgKGQpIEVqKGYsICExKTtlbHNlIHtpZiAoMCAhPT0gVCB8fCBudWxsICE9PSBhICYmIDAgIT09IChhLmZsYWdzICYgMTI4KSkgZm9yIChhID0gYi5jaGlsZDsgbnVsbCAhPT0gYTspIHtnID0gTWgoYSk7aWYgKG51bGwgIT09IGcpIHtiLmZsYWdzIHw9IDEyODtFaihmLCAhMSk7ZCA9IGcudXBkYXRlUXVldWU7bnVsbCAhPT0gZCAmJiAoYi51cGRhdGVRdWV1ZSA9IGQsIGIuZmxhZ3MgfD0gNCk7Yi5zdWJ0cmVlRmxhZ3MgPSAwO2QgPSBjO2ZvciAoYyA9IGIuY2hpbGQ7IG51bGwgIT09IGM7KSB7ZiA9IGMsIGEgPSBkLCBmLmZsYWdzICY9IDE0NjgwMDY2LAogICAgICAgICAgICAgICAgICAgICAgICAgIGcgPSBmLmFsdGVybmF0ZSwgbnVsbCA9PT0gZyA/IChmLmNoaWxkTGFuZXMgPSAwLCBmLmxhbmVzID0gYSwgZi5jaGlsZCA9IG51bGwsIGYuc3VidHJlZUZsYWdzID0gMCwgZi5tZW1vaXplZFByb3BzID0gbnVsbCwgZi5tZW1vaXplZFN0YXRlID0gbnVsbCwgZi51cGRhdGVRdWV1ZSA9IG51bGwsIGYuZGVwZW5kZW5jaWVzID0gbnVsbCwgZi5zdGF0ZU5vZGUgPSBudWxsKSA6IChmLmNoaWxkTGFuZXMgPSBnLmNoaWxkTGFuZXMsIGYubGFuZXMgPSBnLmxhbmVzLCBmLmNoaWxkID0gZy5jaGlsZCwgZi5zdWJ0cmVlRmxhZ3MgPSAwLCBmLmRlbGV0aW9ucyA9IG51bGwsIGYubWVtb2l6ZWRQcm9wcyA9IGcubWVtb2l6ZWRQcm9wcywgZi5tZW1vaXplZFN0YXRlID0gZy5tZW1vaXplZFN0YXRlLCBmLnVwZGF0ZVF1ZXVlID0gZy51cGRhdGVRdWV1ZSwgZi50eXBlID0gZy50eXBlLCBhID0gZy5kZXBlbmRlbmNpZXMsIGYuZGVwZW5kZW5jaWVzID0gbnVsbCA9PT0gYSA/IG51bGwgOiB7IGxhbmVzOiBhLmxhbmVzLCBmaXJzdENvbnRleHQ6IGEuZmlyc3RDb250ZXh0IH0pLCBjID0gYy5zaWJsaW5nO31HKE0sIE0uY3VycmVudCAmIDEgfCAyKTtyZXR1cm4gYi5jaGlsZDt9YSA9CiAgICAgICAgICAgICAgICAgICAgICBhLnNpYmxpbmc7fW51bGwgIT09IGYudGFpbCAmJiBCKCkgPiBIaiAmJiAoYi5mbGFncyB8PSAxMjgsIGQgPSAhMCwgRWooZiwgITEpLCBiLmxhbmVzID0gNDE5NDMwNCk7fX0gZWxzZSB7aWYgKCFkKSBpZiAoYSA9IE1oKGcpLCBudWxsICE9PSBhKSB7aWYgKGIuZmxhZ3MgfD0gMTI4LCBkID0gITAsIGMgPSBhLnVwZGF0ZVF1ZXVlLCBudWxsICE9PSBjICYmIChiLnVwZGF0ZVF1ZXVlID0gYywgYi5mbGFncyB8PSA0KSwgRWooZiwgITApLCBudWxsID09PSBmLnRhaWwgJiYgImhpZGRlbiIgPT09IGYudGFpbE1vZGUgJiYgIWcuYWx0ZXJuYXRlICYmICFJKSByZXR1cm4gUyhiKSwgbnVsbDt9IGVsc2UgMiAqIEIoKSAtIGYucmVuZGVyaW5nU3RhcnRUaW1lID4gSGogJiYgMTA3Mzc0MTgyNCAhPT0gYyAmJiAoYi5mbGFncyB8PSAxMjgsIGQgPSAhMCwgRWooZiwgITEpLCBiLmxhbmVzID0gNDE5NDMwNCk7Zi5pc0JhY2t3YXJkcyA/IChnLnNpYmxpbmcgPSBiLmNoaWxkLCBiLmNoaWxkID0gZykgOiAoYyA9IGYubGFzdCwgbnVsbCAhPT0gYyA/IGMuc2libGluZyA9IGcgOiBiLmNoaWxkID0gZywgZi5sYXN0ID0gZyk7fWlmIChudWxsICE9PSBmLnRhaWwpIHJldHVybiBiID0gZi50YWlsLCBmLnJlbmRlcmluZyA9CiAgICAgICAgICAgICAgICBiLCBmLnRhaWwgPSBiLnNpYmxpbmcsIGYucmVuZGVyaW5nU3RhcnRUaW1lID0gQigpLCBiLnNpYmxpbmcgPSBudWxsLCBjID0gTS5jdXJyZW50LCBHKE0sIGQgPyBjICYgMSB8IDIgOiBjICYgMSksIGI7UyhiKTtyZXR1cm4gbnVsbDtjYXNlIDIyOmNhc2UgMjM6cmV0dXJuIElqKCksIGQgPSBudWxsICE9PSBiLm1lbW9pemVkU3RhdGUsIG51bGwgIT09IGEgJiYgbnVsbCAhPT0gYS5tZW1vaXplZFN0YXRlICE9PSBkICYmIChiLmZsYWdzIHw9IDgxOTIpLCBkICYmIDAgIT09IChiLm1vZGUgJiAxKSA/IDAgIT09IChnaiAmIDEwNzM3NDE4MjQpICYmIChTKGIpLCBiLnN1YnRyZWVGbGFncyAmIDYgJiYgKGIuZmxhZ3MgfD0gODE5MikpIDogUyhiKSwgbnVsbDtjYXNlIDI0OnJldHVybiBudWxsO2Nhc2UgMjU6cmV0dXJuIG51bGw7fXRocm93IEVycm9yKHAoMTU2LCBiLnRhZykpO30KICAgICAgICAgIGZ1bmN0aW9uIEpqKGEsIGIpIHt3ZyhiKTtzd2l0Y2ggKGIudGFnKSB7Y2FzZSAxOnJldHVybiBaZihiLnR5cGUpICYmICRmKCksIGEgPSBiLmZsYWdzLCBhICYgNjU1MzYgPyAoYi5mbGFncyA9IGEgJiAtNjU1MzcgfCAxMjgsIGIpIDogbnVsbDtjYXNlIDM6cmV0dXJuIEpoKCksIEUoV2YpLCBFKEgpLCBPaCgpLCBhID0gYi5mbGFncywgMCAhPT0gKGEgJiA2NTUzNikgJiYgMCA9PT0gKGEgJiAxMjgpID8gKGIuZmxhZ3MgPSBhICYgLTY1NTM3IHwgMTI4LCBiKSA6IG51bGw7Y2FzZSA1OnJldHVybiBMaChiKSwgbnVsbDtjYXNlIDEzOkUoTSk7YSA9IGIubWVtb2l6ZWRTdGF0ZTtpZiAobnVsbCAhPT0gYSAmJiBudWxsICE9PSBhLmRlaHlkcmF0ZWQpIHtpZiAobnVsbCA9PT0gYi5hbHRlcm5hdGUpIHRocm93IEVycm9yKHAoMzQwKSk7SWcoKTt9YSA9IGIuZmxhZ3M7cmV0dXJuIGEgJiA2NTUzNiA/IChiLmZsYWdzID0gYSAmIC02NTUzNyB8IDEyOCwgYikgOiBudWxsO2Nhc2UgMTk6cmV0dXJuIEUoTSksIG51bGw7Y2FzZSA0OnJldHVybiBKaCgpLCBudWxsO2Nhc2UgMTA6cmV0dXJuIFJnKGIudHlwZS5fY29udGV4dCksIG51bGw7Y2FzZSAyMjpjYXNlIDIzOnJldHVybiBJaigpLAogICAgICAgICAgICAgICAgbnVsbDtjYXNlIDI0OnJldHVybiBudWxsO2RlZmF1bHQ6cmV0dXJuIG51bGw7fX12YXIgS2ogPSAhMSxVID0gITEsTGogPSAiZnVuY3Rpb24iID09PSB0eXBlb2YgV2Vha1NldCA/IFdlYWtTZXQgOiBTZXQsViA9IG51bGw7ZnVuY3Rpb24gTWooYSwgYikge3ZhciBjID0gYS5yZWY7aWYgKG51bGwgIT09IGMpIGlmICgiZnVuY3Rpb24iID09PSB0eXBlb2YgYykgdHJ5IHtjKG51bGwpO30gY2F0Y2ggKGQpIHtXKGEsIGIsIGQpO30gZWxzZSBjLmN1cnJlbnQgPSBudWxsO31mdW5jdGlvbiBOaihhLCBiLCBjKSB7dHJ5IHtjKCk7fSBjYXRjaCAoZCkge1coYSwgYiwgZCk7fX12YXIgT2ogPSAhMTsKICAgICAgICAgIGZ1bmN0aW9uIFBqKGEsIGIpIHtDZiA9IGRkO2EgPSBNZSgpO2lmIChOZShhKSkge2lmICgic2VsZWN0aW9uU3RhcnQiIGluIGEpIHZhciBjID0geyBzdGFydDogYS5zZWxlY3Rpb25TdGFydCwgZW5kOiBhLnNlbGVjdGlvbkVuZCB9O2Vsc2UgYToge2MgPSAoYyA9IGEub3duZXJEb2N1bWVudCkgJiYgYy5kZWZhdWx0VmlldyB8fCB3aW5kb3c7dmFyIGQgPSBjLmdldFNlbGVjdGlvbiAmJiBjLmdldFNlbGVjdGlvbigpO2lmIChkICYmIDAgIT09IGQucmFuZ2VDb3VudCkge2MgPSBkLmFuY2hvck5vZGU7dmFyIGUgPSBkLmFuY2hvck9mZnNldCxmID0gZC5mb2N1c05vZGU7ZCA9IGQuZm9jdXNPZmZzZXQ7dHJ5IHtjLm5vZGVUeXBlLCBmLm5vZGVUeXBlO30gY2F0Y2ggKEYpIHtjID0gbnVsbDticmVhayBhO312YXIgZyA9IDAsaCA9IC0xLGsgPSAtMSxsID0gMCxtID0gMCxxID0gYSxyID0gbnVsbDtiOiBmb3IgKDs7KSB7Zm9yICh2YXIgeTs7KSB7cSAhPT0gYyB8fCAwICE9PSBlICYmIDMgIT09IHEubm9kZVR5cGUgfHwgKGggPSBnICsgZSk7cSAhPT0gZiB8fCAwICE9PSBkICYmIDMgIT09IHEubm9kZVR5cGUgfHwgKGsgPSBnICsgZCk7MyA9PT0gcS5ub2RlVHlwZSAmJiAoZyArPQogICAgICAgICAgICAgICAgICAgICAgcS5ub2RlVmFsdWUubGVuZ3RoKTtpZiAobnVsbCA9PT0gKHkgPSBxLmZpcnN0Q2hpbGQpKSBicmVhaztyID0gcTtxID0geTt9Zm9yICg7Oykge2lmIChxID09PSBhKSBicmVhayBiO3IgPT09IGMgJiYgKytsID09PSBlICYmIChoID0gZyk7ciA9PT0gZiAmJiArK20gPT09IGQgJiYgKGsgPSBnKTtpZiAobnVsbCAhPT0gKHkgPSBxLm5leHRTaWJsaW5nKSkgYnJlYWs7cSA9IHI7ciA9IHEucGFyZW50Tm9kZTt9cSA9IHk7fWMgPSAtMSA9PT0gaCB8fCAtMSA9PT0gayA/IG51bGwgOiB7IHN0YXJ0OiBoLCBlbmQ6IGsgfTt9IGVsc2UgYyA9IG51bGw7fWMgPSBjIHx8IHsgc3RhcnQ6IDAsIGVuZDogMCB9O30gZWxzZSBjID0gbnVsbDtEZiA9IHsgZm9jdXNlZEVsZW06IGEsIHNlbGVjdGlvblJhbmdlOiBjIH07ZGQgPSAhMTtmb3IgKFYgPSBiOyBudWxsICE9PSBWOykge2lmIChiID0gViwgYSA9IGIuY2hpbGQsIDAgIT09IChiLnN1YnRyZWVGbGFncyAmIDEwMjgpICYmIG51bGwgIT09IGEpIGEucmV0dXJuID0gYiwgViA9IGE7ZWxzZSBmb3IgKDsgbnVsbCAhPT0gVjspIHtiID0gVjt0cnkge3ZhciBuID0gYi5hbHRlcm5hdGU7aWYgKDAgIT09IChiLmZsYWdzICYgMTAyNCkpIHN3aXRjaCAoYi50YWcpIHtjYXNlIDA6Y2FzZSAxMTpjYXNlIDE1OmJyZWFrOwogICAgICAgICAgICAgICAgICAgIGNhc2UgMTppZiAobnVsbCAhPT0gbikge3ZhciB0ID0gbi5tZW1vaXplZFByb3BzLEogPSBuLm1lbW9pemVkU3RhdGUseCA9IGIuc3RhdGVOb2RlLHcgPSB4LmdldFNuYXBzaG90QmVmb3JlVXBkYXRlKGIuZWxlbWVudFR5cGUgPT09IGIudHlwZSA/IHQgOiBMZyhiLnR5cGUsIHQpLCBKKTt4Ll9fcmVhY3RJbnRlcm5hbFNuYXBzaG90QmVmb3JlVXBkYXRlID0gdzt9YnJlYWs7Y2FzZSAzOnZhciB1ID0gYi5zdGF0ZU5vZGUuY29udGFpbmVySW5mbzsxID09PSB1Lm5vZGVUeXBlID8gdS50ZXh0Q29udGVudCA9ICIiIDogOSA9PT0gdS5ub2RlVHlwZSAmJiB1LmRvY3VtZW50RWxlbWVudCAmJiB1LnJlbW92ZUNoaWxkKHUuZG9jdW1lbnRFbGVtZW50KTticmVhaztjYXNlIDU6Y2FzZSA2OmNhc2UgNDpjYXNlIDE3OmJyZWFrO2RlZmF1bHQ6dGhyb3cgRXJyb3IocCgxNjMpKTt9fSBjYXRjaCAoRikge1coYiwgYi5yZXR1cm4sIEYpO31hID0gYi5zaWJsaW5nO2lmIChudWxsICE9PSBhKSB7YS5yZXR1cm4gPSBiLnJldHVybjtWID0gYTticmVhazt9ViA9IGIucmV0dXJuO319biA9IE9qO09qID0gITE7cmV0dXJuIG47fQogICAgICAgICAgZnVuY3Rpb24gUWooYSwgYiwgYykge3ZhciBkID0gYi51cGRhdGVRdWV1ZTtkID0gbnVsbCAhPT0gZCA/IGQubGFzdEVmZmVjdCA6IG51bGw7aWYgKG51bGwgIT09IGQpIHt2YXIgZSA9IGQgPSBkLm5leHQ7ZG8ge2lmICgoZS50YWcgJiBhKSA9PT0gYSkge3ZhciBmID0gZS5kZXN0cm95O2UuZGVzdHJveSA9IHZvaWQgMDt2b2lkIDAgIT09IGYgJiYgTmooYiwgYywgZik7fWUgPSBlLm5leHQ7fSB3aGlsZSAoZSAhPT0gZCk7fX1mdW5jdGlvbiBSaihhLCBiKSB7YiA9IGIudXBkYXRlUXVldWU7YiA9IG51bGwgIT09IGIgPyBiLmxhc3RFZmZlY3QgOiBudWxsO2lmIChudWxsICE9PSBiKSB7dmFyIGMgPSBiID0gYi5uZXh0O2RvIHtpZiAoKGMudGFnICYgYSkgPT09IGEpIHt2YXIgZCA9IGMuY3JlYXRlO2MuZGVzdHJveSA9IGQoKTt9YyA9IGMubmV4dDt9IHdoaWxlIChjICE9PSBiKTt9fWZ1bmN0aW9uIFNqKGEpIHt2YXIgYiA9IGEucmVmO2lmIChudWxsICE9PSBiKSB7dmFyIGMgPSBhLnN0YXRlTm9kZTtzd2l0Y2ggKGEudGFnKSB7Y2FzZSA1OmEgPSBjO2JyZWFrO2RlZmF1bHQ6YSA9IGM7fSJmdW5jdGlvbiIgPT09IHR5cGVvZiBiID8gYihhKSA6IGIuY3VycmVudCA9IGE7fX0KICAgICAgICAgIGZ1bmN0aW9uIFRqKGEpIHt2YXIgYiA9IGEuYWx0ZXJuYXRlO251bGwgIT09IGIgJiYgKGEuYWx0ZXJuYXRlID0gbnVsbCwgVGooYikpO2EuY2hpbGQgPSBudWxsO2EuZGVsZXRpb25zID0gbnVsbDthLnNpYmxpbmcgPSBudWxsOzUgPT09IGEudGFnICYmIChiID0gYS5zdGF0ZU5vZGUsIG51bGwgIT09IGIgJiYgKGRlbGV0ZSBiW09mXSwgZGVsZXRlIGJbUGZdLCBkZWxldGUgYltvZl0sIGRlbGV0ZSBiW1FmXSwgZGVsZXRlIGJbUmZdKSk7YS5zdGF0ZU5vZGUgPSBudWxsO2EucmV0dXJuID0gbnVsbDthLmRlcGVuZGVuY2llcyA9IG51bGw7YS5tZW1vaXplZFByb3BzID0gbnVsbDthLm1lbW9pemVkU3RhdGUgPSBudWxsO2EucGVuZGluZ1Byb3BzID0gbnVsbDthLnN0YXRlTm9kZSA9IG51bGw7YS51cGRhdGVRdWV1ZSA9IG51bGw7fWZ1bmN0aW9uIFVqKGEpIHtyZXR1cm4gNSA9PT0gYS50YWcgfHwgMyA9PT0gYS50YWcgfHwgNCA9PT0gYS50YWc7fQogICAgICAgICAgZnVuY3Rpb24gVmooYSkge2E6IGZvciAoOzspIHtmb3IgKDsgbnVsbCA9PT0gYS5zaWJsaW5nOykge2lmIChudWxsID09PSBhLnJldHVybiB8fCBVaihhLnJldHVybikpIHJldHVybiBudWxsO2EgPSBhLnJldHVybjt9YS5zaWJsaW5nLnJldHVybiA9IGEucmV0dXJuO2ZvciAoYSA9IGEuc2libGluZzsgNSAhPT0gYS50YWcgJiYgNiAhPT0gYS50YWcgJiYgMTggIT09IGEudGFnOykge2lmIChhLmZsYWdzICYgMikgY29udGludWUgYTtpZiAobnVsbCA9PT0gYS5jaGlsZCB8fCA0ID09PSBhLnRhZykgY29udGludWUgYTtlbHNlIGEuY2hpbGQucmV0dXJuID0gYSwgYSA9IGEuY2hpbGQ7fWlmICghKGEuZmxhZ3MgJiAyKSkgcmV0dXJuIGEuc3RhdGVOb2RlO319CiAgICAgICAgICBmdW5jdGlvbiBXaihhLCBiLCBjKSB7dmFyIGQgPSBhLnRhZztpZiAoNSA9PT0gZCB8fCA2ID09PSBkKSBhID0gYS5zdGF0ZU5vZGUsIGIgPyA4ID09PSBjLm5vZGVUeXBlID8gYy5wYXJlbnROb2RlLmluc2VydEJlZm9yZShhLCBiKSA6IGMuaW5zZXJ0QmVmb3JlKGEsIGIpIDogKDggPT09IGMubm9kZVR5cGUgPyAoYiA9IGMucGFyZW50Tm9kZSwgYi5pbnNlcnRCZWZvcmUoYSwgYykpIDogKGIgPSBjLCBiLmFwcGVuZENoaWxkKGEpKSwgYyA9IGMuX3JlYWN0Um9vdENvbnRhaW5lciwgbnVsbCAhPT0gYyAmJiB2b2lkIDAgIT09IGMgfHwgbnVsbCAhPT0gYi5vbmNsaWNrIHx8IChiLm9uY2xpY2sgPSBCZikpO2Vsc2UgaWYgKDQgIT09IGQgJiYgKGEgPSBhLmNoaWxkLCBudWxsICE9PSBhKSkgZm9yIChXaihhLCBiLCBjKSwgYSA9IGEuc2libGluZzsgbnVsbCAhPT0gYTspIHtXaihhLCBiLCBjKSwgYSA9IGEuc2libGluZzt9fQogICAgICAgICAgZnVuY3Rpb24gWGooYSwgYiwgYykge3ZhciBkID0gYS50YWc7aWYgKDUgPT09IGQgfHwgNiA9PT0gZCkgYSA9IGEuc3RhdGVOb2RlLCBiID8gYy5pbnNlcnRCZWZvcmUoYSwgYikgOiBjLmFwcGVuZENoaWxkKGEpO2Vsc2UgaWYgKDQgIT09IGQgJiYgKGEgPSBhLmNoaWxkLCBudWxsICE9PSBhKSkgZm9yIChYaihhLCBiLCBjKSwgYSA9IGEuc2libGluZzsgbnVsbCAhPT0gYTspIHtYaihhLCBiLCBjKSwgYSA9IGEuc2libGluZzt9fXZhciBYID0gbnVsbCxZaiA9ICExO2Z1bmN0aW9uIFpqKGEsIGIsIGMpIHtmb3IgKGMgPSBjLmNoaWxkOyBudWxsICE9PSBjOykge2FrKGEsIGIsIGMpLCBjID0gYy5zaWJsaW5nO319CiAgICAgICAgICBmdW5jdGlvbiBhayhhLCBiLCBjKSB7aWYgKGxjICYmICJmdW5jdGlvbiIgPT09IHR5cGVvZiBsYy5vbkNvbW1pdEZpYmVyVW5tb3VudCkgdHJ5IHtsYy5vbkNvbW1pdEZpYmVyVW5tb3VudChrYywgYyk7fSBjYXRjaCAoaCkge31zd2l0Y2ggKGMudGFnKSB7Y2FzZSA1OlUgfHwgTWooYywgYik7Y2FzZSA2OnZhciBkID0gWCxlID0gWWo7WCA9IG51bGw7WmooYSwgYiwgYyk7WCA9IGQ7WWogPSBlO251bGwgIT09IFggJiYgKFlqID8gKGEgPSBYLCBjID0gYy5zdGF0ZU5vZGUsIDggPT09IGEubm9kZVR5cGUgPyBhLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQoYykgOiBhLnJlbW92ZUNoaWxkKGMpKSA6IFgucmVtb3ZlQ2hpbGQoYy5zdGF0ZU5vZGUpKTticmVhaztjYXNlIDE4Om51bGwgIT09IFggJiYgKFlqID8gKGEgPSBYLCBjID0gYy5zdGF0ZU5vZGUsIDggPT09IGEubm9kZVR5cGUgPyBLZihhLnBhcmVudE5vZGUsIGMpIDogMSA9PT0gYS5ub2RlVHlwZSAmJiBLZihhLCBjKSwgYmQoYSkpIDogS2YoWCwgYy5zdGF0ZU5vZGUpKTticmVhaztjYXNlIDQ6ZCA9IFg7ZSA9IFlqO1ggPSBjLnN0YXRlTm9kZS5jb250YWluZXJJbmZvO1lqID0gITA7CiAgICAgICAgICAgICAgICBaaihhLCBiLCBjKTtYID0gZDtZaiA9IGU7YnJlYWs7Y2FzZSAwOmNhc2UgMTE6Y2FzZSAxNDpjYXNlIDE1OmlmICghVSAmJiAoZCA9IGMudXBkYXRlUXVldWUsIG51bGwgIT09IGQgJiYgKGQgPSBkLmxhc3RFZmZlY3QsIG51bGwgIT09IGQpKSkge2UgPSBkID0gZC5uZXh0O2RvIHt2YXIgZiA9IGUsZyA9IGYuZGVzdHJveTtmID0gZi50YWc7dm9pZCAwICE9PSBnICYmICgwICE9PSAoZiAmIDIpID8gTmooYywgYiwgZykgOiAwICE9PSAoZiAmIDQpICYmIE5qKGMsIGIsIGcpKTtlID0gZS5uZXh0O30gd2hpbGUgKGUgIT09IGQpO31aaihhLCBiLCBjKTticmVhaztjYXNlIDE6aWYgKCFVICYmIChNaihjLCBiKSwgZCA9IGMuc3RhdGVOb2RlLCAiZnVuY3Rpb24iID09PSB0eXBlb2YgZC5jb21wb25lbnRXaWxsVW5tb3VudCkpIHRyeSB7ZC5wcm9wcyA9IGMubWVtb2l6ZWRQcm9wcywgZC5zdGF0ZSA9IGMubWVtb2l6ZWRTdGF0ZSwgZC5jb21wb25lbnRXaWxsVW5tb3VudCgpO30gY2F0Y2ggKGgpIHtXKGMsIGIsIGgpO31aaihhLCBiLCBjKTticmVhaztjYXNlIDIxOlpqKGEsIGIsIGMpO2JyZWFrO2Nhc2UgMjI6Yy5tb2RlICYgMSA/IChVID0gKGQgPSBVKSB8fCBudWxsICE9PQogICAgICAgICAgICAgICAgYy5tZW1vaXplZFN0YXRlLCBaaihhLCBiLCBjKSwgVSA9IGQpIDogWmooYSwgYiwgYyk7YnJlYWs7ZGVmYXVsdDpaaihhLCBiLCBjKTt9fWZ1bmN0aW9uIGJrKGEpIHt2YXIgYiA9IGEudXBkYXRlUXVldWU7aWYgKG51bGwgIT09IGIpIHthLnVwZGF0ZVF1ZXVlID0gbnVsbDt2YXIgYyA9IGEuc3RhdGVOb2RlO251bGwgPT09IGMgJiYgKGMgPSBhLnN0YXRlTm9kZSA9IG5ldyBMaigpKTtiLmZvckVhY2goZnVuY3Rpb24gKGIpIHt2YXIgZCA9IGNrLmJpbmQobnVsbCwgYSwgYik7Yy5oYXMoYikgfHwgKGMuYWRkKGIpLCBiLnRoZW4oZCwgZCkpO30pO319CiAgICAgICAgICBmdW5jdGlvbiBkayhhLCBiKSB7dmFyIGMgPSBiLmRlbGV0aW9ucztpZiAobnVsbCAhPT0gYykgZm9yICh2YXIgZCA9IDA7IGQgPCBjLmxlbmd0aDsgZCsrKSB7dmFyIGUgPSBjW2RdO3RyeSB7dmFyIGYgPSBhLGcgPSBiLGggPSBnO2E6IGZvciAoOyBudWxsICE9PSBoOykge3N3aXRjaCAoaC50YWcpIHtjYXNlIDU6WCA9IGguc3RhdGVOb2RlO1lqID0gITE7YnJlYWsgYTtjYXNlIDM6WCA9IGguc3RhdGVOb2RlLmNvbnRhaW5lckluZm87WWogPSAhMDticmVhayBhO2Nhc2UgNDpYID0gaC5zdGF0ZU5vZGUuY29udGFpbmVySW5mbztZaiA9ICEwO2JyZWFrIGE7fWggPSBoLnJldHVybjt9aWYgKG51bGwgPT09IFgpIHRocm93IEVycm9yKHAoMTYwKSk7YWsoZiwgZywgZSk7WCA9IG51bGw7WWogPSAhMTt2YXIgayA9IGUuYWx0ZXJuYXRlO251bGwgIT09IGsgJiYgKGsucmV0dXJuID0gbnVsbCk7ZS5yZXR1cm4gPSBudWxsO30gY2F0Y2ggKGwpIHtXKGUsIGIsIGwpO319aWYgKGIuc3VidHJlZUZsYWdzICYgMTI4NTQpIGZvciAoYiA9IGIuY2hpbGQ7IG51bGwgIT09IGI7KSB7ZWsoYiwgYSksIGIgPSBiLnNpYmxpbmc7fX0KICAgICAgICAgIGZ1bmN0aW9uIGVrKGEsIGIpIHt2YXIgYyA9IGEuYWx0ZXJuYXRlLGQgPSBhLmZsYWdzO3N3aXRjaCAoYS50YWcpIHtjYXNlIDA6Y2FzZSAxMTpjYXNlIDE0OmNhc2UgMTU6ZGsoYiwgYSk7ZmsoYSk7aWYgKGQgJiA0KSB7dHJ5IHtRaigzLCBhLCBhLnJldHVybiksIFJqKDMsIGEpO30gY2F0Y2ggKHQpIHtXKGEsIGEucmV0dXJuLCB0KTt9dHJ5IHtRaig1LCBhLCBhLnJldHVybik7fSBjYXRjaCAodCkge1coYSwgYS5yZXR1cm4sIHQpO319YnJlYWs7Y2FzZSAxOmRrKGIsIGEpO2ZrKGEpO2QgJiA1MTIgJiYgbnVsbCAhPT0gYyAmJiBNaihjLCBjLnJldHVybik7YnJlYWs7Y2FzZSA1OmRrKGIsIGEpO2ZrKGEpO2QgJiA1MTIgJiYgbnVsbCAhPT0gYyAmJiBNaihjLCBjLnJldHVybik7aWYgKGEuZmxhZ3MgJiAzMikge3ZhciBlID0gYS5zdGF0ZU5vZGU7dHJ5IHtvYihlLCAiIik7fSBjYXRjaCAodCkge1coYSwgYS5yZXR1cm4sIHQpO319aWYgKGQgJiA0ICYmIChlID0gYS5zdGF0ZU5vZGUsIG51bGwgIT0gZSkpIHt2YXIgZiA9IGEubWVtb2l6ZWRQcm9wcyxnID0gbnVsbCAhPT0gYyA/IGMubWVtb2l6ZWRQcm9wcyA6IGYsaCA9IGEudHlwZSxrID0gYS51cGRhdGVRdWV1ZTsKICAgICAgICAgICAgICAgICAgYS51cGRhdGVRdWV1ZSA9IG51bGw7aWYgKG51bGwgIT09IGspIHRyeSB7ImlucHV0IiA9PT0gaCAmJiAicmFkaW8iID09PSBmLnR5cGUgJiYgbnVsbCAhPSBmLm5hbWUgJiYgYWIoZSwgZik7dmIoaCwgZyk7dmFyIGwgPSB2YihoLCBmKTtmb3IgKGcgPSAwOyBnIDwgay5sZW5ndGg7IGcgKz0gMikge3ZhciBtID0ga1tnXSxxID0ga1tnICsgMV07InN0eWxlIiA9PT0gbSA/IHNiKGUsIHEpIDogImRhbmdlcm91c2x5U2V0SW5uZXJIVE1MIiA9PT0gbSA/IG5iKGUsIHEpIDogImNoaWxkcmVuIiA9PT0gbSA/IG9iKGUsIHEpIDogdGEoZSwgbSwgcSwgbCk7fXN3aXRjaCAoaCkge2Nhc2UgImlucHV0IjpiYihlLCBmKTticmVhaztjYXNlICJ0ZXh0YXJlYSI6aWIoZSwgZik7YnJlYWs7Y2FzZSAic2VsZWN0Ijp2YXIgciA9IGUuX3dyYXBwZXJTdGF0ZS53YXNNdWx0aXBsZTtlLl93cmFwcGVyU3RhdGUud2FzTXVsdGlwbGUgPSAhIWYubXVsdGlwbGU7dmFyIHkgPSBmLnZhbHVlO251bGwgIT0geSA/IGZiKGUsICEhZi5tdWx0aXBsZSwgeSwgITEpIDogciAhPT0gISFmLm11bHRpcGxlICYmIChudWxsICE9IGYuZGVmYXVsdFZhbHVlID8gZmIoZSwgISFmLm11bHRpcGxlLAogICAgICAgICAgICAgICAgICAgICAgICBmLmRlZmF1bHRWYWx1ZSwgITApIDogZmIoZSwgISFmLm11bHRpcGxlLCBmLm11bHRpcGxlID8gW10gOiAiIiwgITEpKTt9ZVtQZl0gPSBmO30gY2F0Y2ggKHQpIHtXKGEsIGEucmV0dXJuLCB0KTt9fWJyZWFrO2Nhc2UgNjpkayhiLCBhKTtmayhhKTtpZiAoZCAmIDQpIHtpZiAobnVsbCA9PT0gYS5zdGF0ZU5vZGUpIHRocm93IEVycm9yKHAoMTYyKSk7ZSA9IGEuc3RhdGVOb2RlO2YgPSBhLm1lbW9pemVkUHJvcHM7dHJ5IHtlLm5vZGVWYWx1ZSA9IGY7fSBjYXRjaCAodCkge1coYSwgYS5yZXR1cm4sIHQpO319YnJlYWs7Y2FzZSAzOmRrKGIsIGEpO2ZrKGEpO2lmIChkICYgNCAmJiBudWxsICE9PSBjICYmIGMubWVtb2l6ZWRTdGF0ZS5pc0RlaHlkcmF0ZWQpIHRyeSB7YmQoYi5jb250YWluZXJJbmZvKTt9IGNhdGNoICh0KSB7VyhhLCBhLnJldHVybiwgdCk7fWJyZWFrO2Nhc2UgNDpkayhiLCBhKTtmayhhKTticmVhaztjYXNlIDEzOmRrKGIsIGEpO2ZrKGEpO2UgPSBhLmNoaWxkO2UuZmxhZ3MgJiA4MTkyICYmIChmID0gbnVsbCAhPT0gZS5tZW1vaXplZFN0YXRlLCBlLnN0YXRlTm9kZS5pc0hpZGRlbiA9IGYsICFmIHx8CiAgICAgICAgICAgICAgICBudWxsICE9PSBlLmFsdGVybmF0ZSAmJiBudWxsICE9PSBlLmFsdGVybmF0ZS5tZW1vaXplZFN0YXRlIHx8IChnayA9IEIoKSkpO2QgJiA0ICYmIGJrKGEpO2JyZWFrO2Nhc2UgMjI6bSA9IG51bGwgIT09IGMgJiYgbnVsbCAhPT0gYy5tZW1vaXplZFN0YXRlO2EubW9kZSAmIDEgPyAoVSA9IChsID0gVSkgfHwgbSwgZGsoYiwgYSksIFUgPSBsKSA6IGRrKGIsIGEpO2ZrKGEpO2lmIChkICYgODE5Mikge2wgPSBudWxsICE9PSBhLm1lbW9pemVkU3RhdGU7aWYgKChhLnN0YXRlTm9kZS5pc0hpZGRlbiA9IGwpICYmICFtICYmIDAgIT09IChhLm1vZGUgJiAxKSkgZm9yIChWID0gYSwgbSA9IGEuY2hpbGQ7IG51bGwgIT09IG07KSB7Zm9yIChxID0gViA9IG07IG51bGwgIT09IFY7KSB7ciA9IFY7eSA9IHIuY2hpbGQ7c3dpdGNoIChyLnRhZykge2Nhc2UgMDpjYXNlIDExOmNhc2UgMTQ6Y2FzZSAxNTpRaig0LCByLCByLnJldHVybik7YnJlYWs7Y2FzZSAxOk1qKHIsIHIucmV0dXJuKTt2YXIgbiA9IHIuc3RhdGVOb2RlO2lmICgiZnVuY3Rpb24iID09PSB0eXBlb2Ygbi5jb21wb25lbnRXaWxsVW5tb3VudCkge2QgPSByO2MgPSByLnJldHVybjt0cnkge2IgPSBkLCBuLnByb3BzID0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYi5tZW1vaXplZFByb3BzLCBuLnN0YXRlID0gYi5tZW1vaXplZFN0YXRlLCBuLmNvbXBvbmVudFdpbGxVbm1vdW50KCk7fSBjYXRjaCAodCkge1coZCwgYywgdCk7fX1icmVhaztjYXNlIDU6TWoociwgci5yZXR1cm4pO2JyZWFrO2Nhc2UgMjI6aWYgKG51bGwgIT09IHIubWVtb2l6ZWRTdGF0ZSkge2hrKHEpO2NvbnRpbnVlO319bnVsbCAhPT0geSA/ICh5LnJldHVybiA9IHIsIFYgPSB5KSA6IGhrKHEpO31tID0gbS5zaWJsaW5nO31hOiBmb3IgKG0gPSBudWxsLCBxID0gYTs7KSB7aWYgKDUgPT09IHEudGFnKSB7aWYgKG51bGwgPT09IG0pIHttID0gcTt0cnkge2UgPSBxLnN0YXRlTm9kZSwgbCA/IChmID0gZS5zdHlsZSwgImZ1bmN0aW9uIiA9PT0gdHlwZW9mIGYuc2V0UHJvcGVydHkgPyBmLnNldFByb3BlcnR5KCJkaXNwbGF5IiwgIm5vbmUiLCAiaW1wb3J0YW50IikgOiBmLmRpc3BsYXkgPSAibm9uZSIpIDogKGggPSBxLnN0YXRlTm9kZSwgayA9IHEubWVtb2l6ZWRQcm9wcy5zdHlsZSwgZyA9IHZvaWQgMCAhPT0gayAmJiBudWxsICE9PSBrICYmIGsuaGFzT3duUHJvcGVydHkoImRpc3BsYXkiKSA/IGsuZGlzcGxheSA6IG51bGwsIGguc3R5bGUuZGlzcGxheSA9CiAgICAgICAgICAgICAgICAgICAgICAgICAgcmIoImRpc3BsYXkiLCBnKSk7fSBjYXRjaCAodCkge1coYSwgYS5yZXR1cm4sIHQpO319fSBlbHNlIGlmICg2ID09PSBxLnRhZykge2lmIChudWxsID09PSBtKSB0cnkge3Euc3RhdGVOb2RlLm5vZGVWYWx1ZSA9IGwgPyAiIiA6IHEubWVtb2l6ZWRQcm9wczt9IGNhdGNoICh0KSB7VyhhLCBhLnJldHVybiwgdCk7fX0gZWxzZSBpZiAoKDIyICE9PSBxLnRhZyAmJiAyMyAhPT0gcS50YWcgfHwgbnVsbCA9PT0gcS5tZW1vaXplZFN0YXRlIHx8IHEgPT09IGEpICYmIG51bGwgIT09IHEuY2hpbGQpIHtxLmNoaWxkLnJldHVybiA9IHE7cSA9IHEuY2hpbGQ7Y29udGludWU7fWlmIChxID09PSBhKSBicmVhayBhO2ZvciAoOyBudWxsID09PSBxLnNpYmxpbmc7KSB7aWYgKG51bGwgPT09IHEucmV0dXJuIHx8IHEucmV0dXJuID09PSBhKSBicmVhayBhO20gPT09IHEgJiYgKG0gPSBudWxsKTtxID0gcS5yZXR1cm47fW0gPT09IHEgJiYgKG0gPSBudWxsKTtxLnNpYmxpbmcucmV0dXJuID0gcS5yZXR1cm47cSA9IHEuc2libGluZzt9fWJyZWFrO2Nhc2UgMTk6ZGsoYiwgYSk7ZmsoYSk7ZCAmIDQgJiYgYmsoYSk7YnJlYWs7Y2FzZSAyMTpicmVhaztkZWZhdWx0OmRrKGIsCiAgICAgICAgICAgICAgICBhKSwgZmsoYSk7fX1mdW5jdGlvbiBmayhhKSB7dmFyIGIgPSBhLmZsYWdzO2lmIChiICYgMikge3RyeSB7YToge2ZvciAodmFyIGMgPSBhLnJldHVybjsgbnVsbCAhPT0gYzspIHtpZiAoVWooYykpIHt2YXIgZCA9IGM7YnJlYWsgYTt9YyA9IGMucmV0dXJuO310aHJvdyBFcnJvcihwKDE2MCkpO31zd2l0Y2ggKGQudGFnKSB7Y2FzZSA1OnZhciBlID0gZC5zdGF0ZU5vZGU7ZC5mbGFncyAmIDMyICYmIChvYihlLCAiIiksIGQuZmxhZ3MgJj0gLTMzKTt2YXIgZiA9IFZqKGEpO1hqKGEsIGYsIGUpO2JyZWFrO2Nhc2UgMzpjYXNlIDQ6dmFyIGcgPSBkLnN0YXRlTm9kZS5jb250YWluZXJJbmZvLGggPSBWaihhKTtXaihhLCBoLCBnKTticmVhaztkZWZhdWx0OnRocm93IEVycm9yKHAoMTYxKSk7fX0gY2F0Y2ggKGspIHtXKGEsIGEucmV0dXJuLCBrKTt9YS5mbGFncyAmPSAtMzt9YiAmIDQwOTYgJiYgKGEuZmxhZ3MgJj0gLTQwOTcpO31mdW5jdGlvbiBpayhhLCBiLCBjKSB7ViA9IGE7amsoYSwgYiwgYyk7fQogICAgICAgICAgZnVuY3Rpb24gamsoYSwgYiwgYykge2ZvciAodmFyIGQgPSAwICE9PSAoYS5tb2RlICYgMSk7IG51bGwgIT09IFY7KSB7dmFyIGUgPSBWLGYgPSBlLmNoaWxkO2lmICgyMiA9PT0gZS50YWcgJiYgZCkge3ZhciBnID0gbnVsbCAhPT0gZS5tZW1vaXplZFN0YXRlIHx8IEtqO2lmICghZykge3ZhciBoID0gZS5hbHRlcm5hdGUsayA9IG51bGwgIT09IGggJiYgbnVsbCAhPT0gaC5tZW1vaXplZFN0YXRlIHx8IFU7aCA9IEtqO3ZhciBsID0gVTtLaiA9IGc7aWYgKChVID0gaykgJiYgIWwpIGZvciAoViA9IGU7IG51bGwgIT09IFY7KSB7ZyA9IFYsIGsgPSBnLmNoaWxkLCAyMiA9PT0gZy50YWcgJiYgbnVsbCAhPT0gZy5tZW1vaXplZFN0YXRlID8ga2soZSkgOiBudWxsICE9PSBrID8gKGsucmV0dXJuID0gZywgViA9IGspIDoga2soZSk7fWZvciAoOyBudWxsICE9PSBmOykge1YgPSBmLCBqayhmLCBiLCBjKSwgZiA9IGYuc2libGluZzt9ViA9IGU7S2ogPSBoO1UgPSBsO31sayhhLCBiLCBjKTt9IGVsc2UgMCAhPT0gKGUuc3VidHJlZUZsYWdzICYgODc3MikgJiYgbnVsbCAhPT0gZiA/IChmLnJldHVybiA9IGUsIFYgPSBmKSA6IGxrKGEsIGIsIGMpO319CiAgICAgICAgICBmdW5jdGlvbiBsayhhKSB7Zm9yICg7IG51bGwgIT09IFY7KSB7dmFyIGIgPSBWO2lmICgwICE9PSAoYi5mbGFncyAmIDg3NzIpKSB7dmFyIGMgPSBiLmFsdGVybmF0ZTt0cnkge2lmICgwICE9PSAoYi5mbGFncyAmIDg3NzIpKSBzd2l0Y2ggKGIudGFnKSB7Y2FzZSAwOmNhc2UgMTE6Y2FzZSAxNTpVIHx8IFJqKDUsIGIpO2JyZWFrO2Nhc2UgMTp2YXIgZCA9IGIuc3RhdGVOb2RlO2lmIChiLmZsYWdzICYgNCAmJiAhVSkgaWYgKG51bGwgPT09IGMpIGQuY29tcG9uZW50RGlkTW91bnQoKTtlbHNlIHt2YXIgZSA9IGIuZWxlbWVudFR5cGUgPT09IGIudHlwZSA/IGMubWVtb2l6ZWRQcm9wcyA6IExnKGIudHlwZSwgYy5tZW1vaXplZFByb3BzKTtkLmNvbXBvbmVudERpZFVwZGF0ZShlLCBjLm1lbW9pemVkU3RhdGUsIGQuX19yZWFjdEludGVybmFsU25hcHNob3RCZWZvcmVVcGRhdGUpO312YXIgZiA9IGIudXBkYXRlUXVldWU7bnVsbCAhPT0gZiAmJiBpaChiLCBmLCBkKTticmVhaztjYXNlIDM6dmFyIGcgPSBiLnVwZGF0ZVF1ZXVlO2lmIChudWxsICE9PSBnKSB7YyA9IG51bGw7aWYgKG51bGwgIT09IGIuY2hpbGQpIHN3aXRjaCAoYi5jaGlsZC50YWcpIHtjYXNlIDU6YyA9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBiLmNoaWxkLnN0YXRlTm9kZTticmVhaztjYXNlIDE6YyA9IGIuY2hpbGQuc3RhdGVOb2RlO31paChiLCBnLCBjKTt9YnJlYWs7Y2FzZSA1OnZhciBoID0gYi5zdGF0ZU5vZGU7aWYgKG51bGwgPT09IGMgJiYgYi5mbGFncyAmIDQpIHtjID0gaDt2YXIgayA9IGIubWVtb2l6ZWRQcm9wcztzd2l0Y2ggKGIudHlwZSkge2Nhc2UgImJ1dHRvbiI6Y2FzZSAiaW5wdXQiOmNhc2UgInNlbGVjdCI6Y2FzZSAidGV4dGFyZWEiOmsuYXV0b0ZvY3VzICYmIGMuZm9jdXMoKTticmVhaztjYXNlICJpbWciOmsuc3JjICYmIChjLnNyYyA9IGsuc3JjKTt9fWJyZWFrO2Nhc2UgNjpicmVhaztjYXNlIDQ6YnJlYWs7Y2FzZSAxMjpicmVhaztjYXNlIDEzOmlmIChudWxsID09PSBiLm1lbW9pemVkU3RhdGUpIHt2YXIgbCA9IGIuYWx0ZXJuYXRlO2lmIChudWxsICE9PSBsKSB7dmFyIG0gPSBsLm1lbW9pemVkU3RhdGU7aWYgKG51bGwgIT09IG0pIHt2YXIgcSA9IG0uZGVoeWRyYXRlZDtudWxsICE9PSBxICYmIGJkKHEpO319fWJyZWFrO2Nhc2UgMTk6Y2FzZSAxNzpjYXNlIDIxOmNhc2UgMjI6Y2FzZSAyMzpjYXNlIDI1OmJyZWFrOwogICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6dGhyb3cgRXJyb3IocCgxNjMpKTt9VSB8fCBiLmZsYWdzICYgNTEyICYmIFNqKGIpO30gY2F0Y2ggKHIpIHtXKGIsIGIucmV0dXJuLCByKTt9fWlmIChiID09PSBhKSB7ViA9IG51bGw7YnJlYWs7fWMgPSBiLnNpYmxpbmc7aWYgKG51bGwgIT09IGMpIHtjLnJldHVybiA9IGIucmV0dXJuO1YgPSBjO2JyZWFrO31WID0gYi5yZXR1cm47fX1mdW5jdGlvbiBoayhhKSB7Zm9yICg7IG51bGwgIT09IFY7KSB7dmFyIGIgPSBWO2lmIChiID09PSBhKSB7ViA9IG51bGw7YnJlYWs7fXZhciBjID0gYi5zaWJsaW5nO2lmIChudWxsICE9PSBjKSB7Yy5yZXR1cm4gPSBiLnJldHVybjtWID0gYzticmVhazt9ViA9IGIucmV0dXJuO319CiAgICAgICAgICBmdW5jdGlvbiBrayhhKSB7Zm9yICg7IG51bGwgIT09IFY7KSB7dmFyIGIgPSBWO3RyeSB7c3dpdGNoIChiLnRhZykge2Nhc2UgMDpjYXNlIDExOmNhc2UgMTU6dmFyIGMgPSBiLnJldHVybjt0cnkge1JqKDQsIGIpO30gY2F0Y2ggKGspIHtXKGIsIGMsIGspO31icmVhaztjYXNlIDE6dmFyIGQgPSBiLnN0YXRlTm9kZTtpZiAoImZ1bmN0aW9uIiA9PT0gdHlwZW9mIGQuY29tcG9uZW50RGlkTW91bnQpIHt2YXIgZSA9IGIucmV0dXJuO3RyeSB7ZC5jb21wb25lbnREaWRNb3VudCgpO30gY2F0Y2ggKGspIHtXKGIsIGUsIGspO319dmFyIGYgPSBiLnJldHVybjt0cnkge1NqKGIpO30gY2F0Y2ggKGspIHtXKGIsIGYsIGspO31icmVhaztjYXNlIDU6dmFyIGcgPSBiLnJldHVybjt0cnkge1NqKGIpO30gY2F0Y2ggKGspIHtXKGIsIGcsIGspO319fSBjYXRjaCAoaykge1coYiwgYi5yZXR1cm4sIGspO31pZiAoYiA9PT0gYSkge1YgPSBudWxsO2JyZWFrO312YXIgaCA9IGIuc2libGluZztpZiAobnVsbCAhPT0gaCkge2gucmV0dXJuID0gYi5yZXR1cm47ViA9IGg7YnJlYWs7fVYgPSBiLnJldHVybjt9fQogICAgICAgICAgdmFyIG1rID0gTWF0aC5jZWlsLG5rID0gdWEuUmVhY3RDdXJyZW50RGlzcGF0Y2hlcixvayA9IHVhLlJlYWN0Q3VycmVudE93bmVyLHBrID0gdWEuUmVhY3RDdXJyZW50QmF0Y2hDb25maWcsSyA9IDAsUiA9IG51bGwsWSA9IG51bGwsWiA9IDAsZ2ogPSAwLGZqID0gVWYoMCksVCA9IDAscWsgPSBudWxsLGhoID0gMCxyayA9IDAsc2sgPSAwLHRrID0gbnVsbCx1ayA9IG51bGwsZ2sgPSAwLEhqID0gSW5maW5pdHksdmsgPSBudWxsLFBpID0gITEsUWkgPSBudWxsLFNpID0gbnVsbCx3ayA9ICExLHhrID0gbnVsbCx5ayA9IDAsemsgPSAwLEFrID0gbnVsbCxCayA9IC0xLENrID0gMDtmdW5jdGlvbiBMKCkge3JldHVybiAwICE9PSAoSyAmIDYpID8gQigpIDogLTEgIT09IEJrID8gQmsgOiBCayA9IEIoKTt9CiAgICAgICAgICBmdW5jdGlvbiBsaChhKSB7aWYgKDAgPT09IChhLm1vZGUgJiAxKSkgcmV0dXJuIDE7aWYgKDAgIT09IChLICYgMikgJiYgMCAhPT0gWikgcmV0dXJuIFogJiAtWjtpZiAobnVsbCAhPT0gS2cudHJhbnNpdGlvbikgcmV0dXJuIDAgPT09IENrICYmIChDayA9IHljKCkpLCBDazthID0gQztpZiAoMCAhPT0gYSkgcmV0dXJuIGE7YSA9IHdpbmRvdy5ldmVudDthID0gdm9pZCAwID09PSBhID8gMTYgOiBqZChhLnR5cGUpO3JldHVybiBhO31mdW5jdGlvbiBtaChhLCBiLCBjLCBkKSB7aWYgKDUwIDwgemspIHRocm93IHprID0gMCwgQWsgPSBudWxsLCBFcnJvcihwKDE4NSkpO0FjKGEsIGMsIGQpO2lmICgwID09PSAoSyAmIDIpIHx8IGEgIT09IFIpIGEgPT09IFIgJiYgKDAgPT09IChLICYgMikgJiYgKHJrIHw9IGMpLCA0ID09PSBUICYmIERrKGEsIFopKSwgRWsoYSwgZCksIDEgPT09IGMgJiYgMCA9PT0gSyAmJiAwID09PSAoYi5tb2RlICYgMSkgJiYgKEhqID0gQigpICsgNTAwLCBmZyAmJiBqZygpKTt9CiAgICAgICAgICBmdW5jdGlvbiBFayhhLCBiKSB7dmFyIGMgPSBhLmNhbGxiYWNrTm9kZTt3YyhhLCBiKTt2YXIgZCA9IHVjKGEsIGEgPT09IFIgPyBaIDogMCk7aWYgKDAgPT09IGQpIG51bGwgIT09IGMgJiYgYmMoYyksIGEuY2FsbGJhY2tOb2RlID0gbnVsbCwgYS5jYWxsYmFja1ByaW9yaXR5ID0gMDtlbHNlIGlmIChiID0gZCAmIC1kLCBhLmNhbGxiYWNrUHJpb3JpdHkgIT09IGIpIHtudWxsICE9IGMgJiYgYmMoYyk7aWYgKDEgPT09IGIpIDAgPT09IGEudGFnID8gaWcoRmsuYmluZChudWxsLCBhKSkgOiBoZyhGay5iaW5kKG51bGwsIGEpKSwgSmYoZnVuY3Rpb24gKCkgezAgPT09IChLICYgNikgJiYgamcoKTt9KSwgYyA9IG51bGw7ZWxzZSB7c3dpdGNoIChEYyhkKSkge2Nhc2UgMTpjID0gZmM7YnJlYWs7Y2FzZSA0OmMgPSBnYzticmVhaztjYXNlIDE2OmMgPSBoYzticmVhaztjYXNlIDUzNjg3MDkxMjpjID0gamM7YnJlYWs7ZGVmYXVsdDpjID0gaGM7fWMgPSBHayhjLCBIay5iaW5kKG51bGwsIGEpKTt9YS5jYWxsYmFja1ByaW9yaXR5ID0gYjthLmNhbGxiYWNrTm9kZSA9IGM7fX0KICAgICAgICAgIGZ1bmN0aW9uIEhrKGEsIGIpIHtCayA9IC0xO0NrID0gMDtpZiAoMCAhPT0gKEsgJiA2KSkgdGhyb3cgRXJyb3IocCgzMjcpKTt2YXIgYyA9IGEuY2FsbGJhY2tOb2RlO2lmIChJaygpICYmIGEuY2FsbGJhY2tOb2RlICE9PSBjKSByZXR1cm4gbnVsbDt2YXIgZCA9IHVjKGEsIGEgPT09IFIgPyBaIDogMCk7aWYgKDAgPT09IGQpIHJldHVybiBudWxsO2lmICgwICE9PSAoZCAmIDMwKSB8fCAwICE9PSAoZCAmIGEuZXhwaXJlZExhbmVzKSB8fCBiKSBiID0gSmsoYSwgZCk7ZWxzZSB7YiA9IGQ7dmFyIGUgPSBLO0sgfD0gMjt2YXIgZiA9IEtrKCk7aWYgKFIgIT09IGEgfHwgWiAhPT0gYikgdmsgPSBudWxsLCBIaiA9IEIoKSArIDUwMCwgTGsoYSwgYik7ZG8ge3RyeSB7TWsoKTticmVhazt9IGNhdGNoIChoKSB7TmsoYSwgaCk7fX0gd2hpbGUgKDEpO1FnKCk7bmsuY3VycmVudCA9IGY7SyA9IGU7bnVsbCAhPT0gWSA/IGIgPSAwIDogKFIgPSBudWxsLCBaID0gMCwgYiA9IFQpO31pZiAoMCAhPT0gYikgezIgPT09IGIgJiYgKGUgPSB4YyhhKSwgMCAhPT0gZSAmJiAoZCA9IGUsIGIgPSBPayhhLCBlKSkpO2lmICgxID09PSBiKSB0aHJvdyBjID0gcWssIExrKGEsIDApLCBEayhhLCBkKSwgRWsoYSwgQigpKSwgYztpZiAoNiA9PT0gYikgRGsoYSwgZCk7ZWxzZQogICAgICAgICAgICAgIHtlID0gYS5jdXJyZW50LmFsdGVybmF0ZTtpZiAoMCA9PT0gKGQgJiAzMCkgJiYgIVBrKGUpICYmIChiID0gSmsoYSwgZCksIDIgPT09IGIgJiYgKGYgPSB4YyhhKSwgMCAhPT0gZiAmJiAoZCA9IGYsIGIgPSBPayhhLCBmKSkpLCAxID09PSBiKSkgdGhyb3cgYyA9IHFrLCBMayhhLCAwKSwgRGsoYSwgZCksIEVrKGEsIEIoKSksIGM7YS5maW5pc2hlZFdvcmsgPSBlO2EuZmluaXNoZWRMYW5lcyA9IGQ7c3dpdGNoIChiKSB7Y2FzZSAwOmNhc2UgMTp0aHJvdyBFcnJvcihwKDM0NSkpO2Nhc2UgMjpRayhhLCB1aywgdmspO2JyZWFrO2Nhc2UgMzpEayhhLCBkKTtpZiAoKGQgJiAxMzAwMjM0MjQpID09PSBkICYmIChiID0gZ2sgKyA1MDAgLSBCKCksIDEwIDwgYikpIHtpZiAoMCAhPT0gdWMoYSwgMCkpIGJyZWFrO2UgPSBhLnN1c3BlbmRlZExhbmVzO2lmICgoZSAmIGQpICE9PSBkKSB7TCgpO2EucGluZ2VkTGFuZXMgfD0gYS5zdXNwZW5kZWRMYW5lcyAmIGU7YnJlYWs7fWEudGltZW91dEhhbmRsZSA9IEZmKFFrLmJpbmQobnVsbCwgYSwgdWssIHZrKSwgYik7YnJlYWs7fVFrKGEsIHVrLCB2ayk7YnJlYWs7Y2FzZSA0OkRrKGEsIGQpO2lmICgoZCAmIDQxOTQyNDApID09PQogICAgICAgICAgICAgICAgICAgIGQpIGJyZWFrO2IgPSBhLmV2ZW50VGltZXM7Zm9yIChlID0gLTE7IDAgPCBkOykge3ZhciBnID0gMzEgLSBvYyhkKTtmID0gMSA8PCBnO2cgPSBiW2ddO2cgPiBlICYmIChlID0gZyk7ZCAmPSB+Zjt9ZCA9IGU7ZCA9IEIoKSAtIGQ7ZCA9ICgxMjAgPiBkID8gMTIwIDogNDgwID4gZCA/IDQ4MCA6IDEwODAgPiBkID8gMTA4MCA6IDE5MjAgPiBkID8gMTkyMCA6IDNFMyA+IGQgPyAzRTMgOiA0MzIwID4gZCA/IDQzMjAgOiAxOTYwICogbWsoZCAvIDE5NjApKSAtIGQ7aWYgKDEwIDwgZCkge2EudGltZW91dEhhbmRsZSA9IEZmKFFrLmJpbmQobnVsbCwgYSwgdWssIHZrKSwgZCk7YnJlYWs7fVFrKGEsIHVrLCB2ayk7YnJlYWs7Y2FzZSA1OlFrKGEsIHVrLCB2ayk7YnJlYWs7ZGVmYXVsdDp0aHJvdyBFcnJvcihwKDMyOSkpO319fUVrKGEsIEIoKSk7cmV0dXJuIGEuY2FsbGJhY2tOb2RlID09PSBjID8gSGsuYmluZChudWxsLCBhKSA6IG51bGw7fQogICAgICAgICAgZnVuY3Rpb24gT2soYSwgYikge3ZhciBjID0gdGs7YS5jdXJyZW50Lm1lbW9pemVkU3RhdGUuaXNEZWh5ZHJhdGVkICYmIChMayhhLCBiKS5mbGFncyB8PSAyNTYpO2EgPSBKayhhLCBiKTsyICE9PSBhICYmIChiID0gdWssIHVrID0gYywgbnVsbCAhPT0gYiAmJiBHaihiKSk7cmV0dXJuIGE7fWZ1bmN0aW9uIEdqKGEpIHtudWxsID09PSB1ayA/IHVrID0gYSA6IHVrLnB1c2guYXBwbHkodWssIGEpO30KICAgICAgICAgIGZ1bmN0aW9uIFBrKGEpIHtmb3IgKHZhciBiID0gYTs7KSB7aWYgKGIuZmxhZ3MgJiAxNjM4NCkge3ZhciBjID0gYi51cGRhdGVRdWV1ZTtpZiAobnVsbCAhPT0gYyAmJiAoYyA9IGMuc3RvcmVzLCBudWxsICE9PSBjKSkgZm9yICh2YXIgZCA9IDA7IGQgPCBjLmxlbmd0aDsgZCsrKSB7dmFyIGUgPSBjW2RdLGYgPSBlLmdldFNuYXBzaG90O2UgPSBlLnZhbHVlO3RyeSB7aWYgKCFIZShmKCksIGUpKSByZXR1cm4gITE7fSBjYXRjaCAoZykge3JldHVybiAhMTt9fX1jID0gYi5jaGlsZDtpZiAoYi5zdWJ0cmVlRmxhZ3MgJiAxNjM4NCAmJiBudWxsICE9PSBjKSBjLnJldHVybiA9IGIsIGIgPSBjO2Vsc2Uge2lmIChiID09PSBhKSBicmVhaztmb3IgKDsgbnVsbCA9PT0gYi5zaWJsaW5nOykge2lmIChudWxsID09PSBiLnJldHVybiB8fCBiLnJldHVybiA9PT0gYSkgcmV0dXJuICEwO2IgPSBiLnJldHVybjt9Yi5zaWJsaW5nLnJldHVybiA9IGIucmV0dXJuO2IgPSBiLnNpYmxpbmc7fX1yZXR1cm4gITA7fQogICAgICAgICAgZnVuY3Rpb24gRGsoYSwgYikge2IgJj0gfnNrO2IgJj0gfnJrO2Euc3VzcGVuZGVkTGFuZXMgfD0gYjthLnBpbmdlZExhbmVzICY9IH5iO2ZvciAoYSA9IGEuZXhwaXJhdGlvblRpbWVzOyAwIDwgYjspIHt2YXIgYyA9IDMxIC0gb2MoYiksZCA9IDEgPDwgYzthW2NdID0gLTE7YiAmPSB+ZDt9fWZ1bmN0aW9uIEZrKGEpIHtpZiAoMCAhPT0gKEsgJiA2KSkgdGhyb3cgRXJyb3IocCgzMjcpKTtJaygpO3ZhciBiID0gdWMoYSwgMCk7aWYgKDAgPT09IChiICYgMSkpIHJldHVybiBFayhhLCBCKCkpLCBudWxsO3ZhciBjID0gSmsoYSwgYik7aWYgKDAgIT09IGEudGFnICYmIDIgPT09IGMpIHt2YXIgZCA9IHhjKGEpOzAgIT09IGQgJiYgKGIgPSBkLCBjID0gT2soYSwgZCkpO31pZiAoMSA9PT0gYykgdGhyb3cgYyA9IHFrLCBMayhhLCAwKSwgRGsoYSwgYiksIEVrKGEsIEIoKSksIGM7aWYgKDYgPT09IGMpIHRocm93IEVycm9yKHAoMzQ1KSk7YS5maW5pc2hlZFdvcmsgPSBhLmN1cnJlbnQuYWx0ZXJuYXRlO2EuZmluaXNoZWRMYW5lcyA9IGI7UWsoYSwgdWssIHZrKTtFayhhLCBCKCkpO3JldHVybiBudWxsO30KICAgICAgICAgIGZ1bmN0aW9uIFJrKGEsIGIpIHt2YXIgYyA9IEs7SyB8PSAxO3RyeSB7cmV0dXJuIGEoYik7fSBmaW5hbGx5IHtLID0gYywgMCA9PT0gSyAmJiAoSGogPSBCKCkgKyA1MDAsIGZnICYmIGpnKCkpO319ZnVuY3Rpb24gU2soYSkge251bGwgIT09IHhrICYmIDAgPT09IHhrLnRhZyAmJiAwID09PSAoSyAmIDYpICYmIElrKCk7dmFyIGIgPSBLO0sgfD0gMTt2YXIgYyA9IHBrLnRyYW5zaXRpb24sZCA9IEM7dHJ5IHtpZiAocGsudHJhbnNpdGlvbiA9IG51bGwsIEMgPSAxLCBhKSByZXR1cm4gYSgpO30gZmluYWxseSB7QyA9IGQsIHBrLnRyYW5zaXRpb24gPSBjLCBLID0gYiwgMCA9PT0gKEsgJiA2KSAmJiBqZygpO319ZnVuY3Rpb24gSWooKSB7Z2ogPSBmai5jdXJyZW50O0UoZmopO30KICAgICAgICAgIGZ1bmN0aW9uIExrKGEsIGIpIHthLmZpbmlzaGVkV29yayA9IG51bGw7YS5maW5pc2hlZExhbmVzID0gMDt2YXIgYyA9IGEudGltZW91dEhhbmRsZTstMSAhPT0gYyAmJiAoYS50aW1lb3V0SGFuZGxlID0gLTEsIEdmKGMpKTtpZiAobnVsbCAhPT0gWSkgZm9yIChjID0gWS5yZXR1cm47IG51bGwgIT09IGM7KSB7dmFyIGQgPSBjO3dnKGQpO3N3aXRjaCAoZC50YWcpIHtjYXNlIDE6ZCA9IGQudHlwZS5jaGlsZENvbnRleHRUeXBlcztudWxsICE9PSBkICYmIHZvaWQgMCAhPT0gZCAmJiAkZigpO2JyZWFrO2Nhc2UgMzpKaCgpO0UoV2YpO0UoSCk7T2goKTticmVhaztjYXNlIDU6TGgoZCk7YnJlYWs7Y2FzZSA0OkpoKCk7YnJlYWs7Y2FzZSAxMzpFKE0pO2JyZWFrO2Nhc2UgMTk6RShNKTticmVhaztjYXNlIDEwOlJnKGQudHlwZS5fY29udGV4dCk7YnJlYWs7Y2FzZSAyMjpjYXNlIDIzOklqKCk7fWMgPSBjLnJldHVybjt9UiA9IGE7WSA9IGEgPSB3aChhLmN1cnJlbnQsIG51bGwpO1ogPSBnaiA9IGI7VCA9IDA7cWsgPSBudWxsO3NrID0gcmsgPSBoaCA9IDA7dWsgPSB0ayA9IG51bGw7aWYgKG51bGwgIT09IFdnKSB7Zm9yIChiID0KICAgICAgICAgICAgICAwOyBiIDwgV2cubGVuZ3RoOyBiKyspIHtpZiAoYyA9IFdnW2JdLCBkID0gYy5pbnRlcmxlYXZlZCwgbnVsbCAhPT0gZCkge2MuaW50ZXJsZWF2ZWQgPSBudWxsO3ZhciBlID0gZC5uZXh0LGYgPSBjLnBlbmRpbmc7aWYgKG51bGwgIT09IGYpIHt2YXIgZyA9IGYubmV4dDtmLm5leHQgPSBlO2QubmV4dCA9IGc7fWMucGVuZGluZyA9IGQ7fX1XZyA9IG51bGw7fXJldHVybiBhO30KICAgICAgICAgIGZ1bmN0aW9uIE5rKGEsIGIpIHtkbyB7dmFyIGMgPSBZO3RyeSB7UWcoKTtQaC5jdXJyZW50ID0gYWk7aWYgKFNoKSB7Zm9yICh2YXIgZCA9IE4ubWVtb2l6ZWRTdGF0ZTsgbnVsbCAhPT0gZDspIHt2YXIgZSA9IGQucXVldWU7bnVsbCAhPT0gZSAmJiAoZS5wZW5kaW5nID0gbnVsbCk7ZCA9IGQubmV4dDt9U2ggPSAhMTt9UmggPSAwO1AgPSBPID0gTiA9IG51bGw7VGggPSAhMTtVaCA9IDA7b2suY3VycmVudCA9IG51bGw7aWYgKG51bGwgPT09IGMgfHwgbnVsbCA9PT0gYy5yZXR1cm4pIHtUID0gMTtxayA9IGI7WSA9IG51bGw7YnJlYWs7fWE6IHt2YXIgZiA9IGEsZyA9IGMucmV0dXJuLGggPSBjLGsgPSBiO2IgPSBaO2guZmxhZ3MgfD0gMzI3Njg7aWYgKG51bGwgIT09IGsgJiYgIm9iamVjdCIgPT09IHR5cGVvZiBrICYmICJmdW5jdGlvbiIgPT09IHR5cGVvZiBrLnRoZW4pIHt2YXIgbCA9IGssbSA9IGgscSA9IG0udGFnO2lmICgwID09PSAobS5tb2RlICYgMSkgJiYgKDAgPT09IHEgfHwgMTEgPT09IHEgfHwgMTUgPT09IHEpKSB7dmFyIHIgPSBtLmFsdGVybmF0ZTtyID8gKG0udXBkYXRlUXVldWUgPSByLnVwZGF0ZVF1ZXVlLCBtLm1lbW9pemVkU3RhdGUgPSByLm1lbW9pemVkU3RhdGUsCiAgICAgICAgICAgICAgICAgICAgICBtLmxhbmVzID0gci5sYW5lcykgOiAobS51cGRhdGVRdWV1ZSA9IG51bGwsIG0ubWVtb2l6ZWRTdGF0ZSA9IG51bGwpO312YXIgeSA9IFZpKGcpO2lmIChudWxsICE9PSB5KSB7eS5mbGFncyAmPSAtMjU3O1dpKHksIGcsIGgsIGYsIGIpO3kubW9kZSAmIDEgJiYgVGkoZiwgbCwgYik7YiA9IHk7ayA9IGw7dmFyIG4gPSBiLnVwZGF0ZVF1ZXVlO2lmIChudWxsID09PSBuKSB7dmFyIHQgPSBuZXcgU2V0KCk7dC5hZGQoayk7Yi51cGRhdGVRdWV1ZSA9IHQ7fSBlbHNlIG4uYWRkKGspO2JyZWFrIGE7fSBlbHNlIHtpZiAoMCA9PT0gKGIgJiAxKSkge1RpKGYsIGwsIGIpO3VqKCk7YnJlYWsgYTt9ayA9IEVycm9yKHAoNDI2KSk7fX0gZWxzZSBpZiAoSSAmJiBoLm1vZGUgJiAxKSB7dmFyIEogPSBWaShnKTtpZiAobnVsbCAhPT0gSikgezAgPT09IChKLmZsYWdzICYgNjU1MzYpICYmIChKLmZsYWdzIHw9IDI1Nik7V2koSiwgZywgaCwgZiwgYik7SmcoS2koaywgaCkpO2JyZWFrIGE7fX1mID0gayA9IEtpKGssIGgpOzQgIT09IFQgJiYgKFQgPSAyKTtudWxsID09PSB0ayA/IHRrID0gW2ZdIDogdGsucHVzaChmKTtmID0gZztkbyB7c3dpdGNoIChmLnRhZykge2Nhc2UgMzpmLmZsYWdzIHw9IDY1NTM2OwogICAgICAgICAgICAgICAgICAgICAgICBiICY9IC1iO2YubGFuZXMgfD0gYjt2YXIgeCA9IE9pKGYsIGssIGIpO2ZoKGYsIHgpO2JyZWFrIGE7Y2FzZSAxOmggPSBrO3ZhciB3ID0gZi50eXBlLHUgPSBmLnN0YXRlTm9kZTtpZiAoMCA9PT0gKGYuZmxhZ3MgJiAxMjgpICYmICgiZnVuY3Rpb24iID09PSB0eXBlb2Ygdy5nZXREZXJpdmVkU3RhdGVGcm9tRXJyb3IgfHwgbnVsbCAhPT0gdSAmJiAiZnVuY3Rpb24iID09PSB0eXBlb2YgdS5jb21wb25lbnREaWRDYXRjaCAmJiAobnVsbCA9PT0gU2kgfHwgIVNpLmhhcyh1KSkpKSB7Zi5mbGFncyB8PSA2NTUzNjtiICY9IC1iO2YubGFuZXMgfD0gYjt2YXIgRiA9IFJpKGYsIGgsIGIpO2ZoKGYsIEYpO2JyZWFrIGE7fX1mID0gZi5yZXR1cm47fSB3aGlsZSAobnVsbCAhPT0gZik7fVRrKGMpO30gY2F0Y2ggKG5hKSB7YiA9IG5hO1kgPT09IGMgJiYgbnVsbCAhPT0gYyAmJiAoWSA9IGMgPSBjLnJldHVybik7Y29udGludWU7fWJyZWFrO30gd2hpbGUgKDEpO31mdW5jdGlvbiBLaygpIHt2YXIgYSA9IG5rLmN1cnJlbnQ7bmsuY3VycmVudCA9IGFpO3JldHVybiBudWxsID09PSBhID8gYWkgOiBhO30KICAgICAgICAgIGZ1bmN0aW9uIHVqKCkge2lmICgwID09PSBUIHx8IDMgPT09IFQgfHwgMiA9PT0gVCkgVCA9IDQ7bnVsbCA9PT0gUiB8fCAwID09PSAoaGggJiAyNjg0MzU0NTUpICYmIDAgPT09IChyayAmIDI2ODQzNTQ1NSkgfHwgRGsoUiwgWik7fWZ1bmN0aW9uIEprKGEsIGIpIHt2YXIgYyA9IEs7SyB8PSAyO3ZhciBkID0gS2soKTtpZiAoUiAhPT0gYSB8fCBaICE9PSBiKSB2ayA9IG51bGwsIExrKGEsIGIpO2RvIHt0cnkge1VrKCk7YnJlYWs7fSBjYXRjaCAoZSkge05rKGEsIGUpO319IHdoaWxlICgxKTtRZygpO0sgPSBjO25rLmN1cnJlbnQgPSBkO2lmIChudWxsICE9PSBZKSB0aHJvdyBFcnJvcihwKDI2MSkpO1IgPSBudWxsO1ogPSAwO3JldHVybiBUO31mdW5jdGlvbiBVaygpIHtmb3IgKDsgbnVsbCAhPT0gWTspIHtWayhZKTt9fWZ1bmN0aW9uIE1rKCkge2ZvciAoOyBudWxsICE9PSBZICYmICFjYygpOykge1ZrKFkpO319ZnVuY3Rpb24gVmsoYSkge3ZhciBiID0gV2soYS5hbHRlcm5hdGUsIGEsIGdqKTthLm1lbW9pemVkUHJvcHMgPSBhLnBlbmRpbmdQcm9wcztudWxsID09PSBiID8gVGsoYSkgOiBZID0gYjtvay5jdXJyZW50ID0gbnVsbDt9CiAgICAgICAgICBmdW5jdGlvbiBUayhhKSB7dmFyIGIgPSBhO2RvIHt2YXIgYyA9IGIuYWx0ZXJuYXRlO2EgPSBiLnJldHVybjtpZiAoMCA9PT0gKGIuZmxhZ3MgJiAzMjc2OCkpIHtpZiAoYyA9IEZqKGMsIGIsIGdqKSwgbnVsbCAhPT0gYykge1kgPSBjO3JldHVybjt9fSBlbHNlIHtjID0gSmooYywgYik7aWYgKG51bGwgIT09IGMpIHtjLmZsYWdzICY9IDMyNzY3O1kgPSBjO3JldHVybjt9aWYgKG51bGwgIT09IGEpIGEuZmxhZ3MgfD0gMzI3NjgsIGEuc3VidHJlZUZsYWdzID0gMCwgYS5kZWxldGlvbnMgPSBudWxsO2Vsc2Uge1QgPSA2O1kgPSBudWxsO3JldHVybjt9fWIgPSBiLnNpYmxpbmc7aWYgKG51bGwgIT09IGIpIHtZID0gYjtyZXR1cm47fVkgPSBiID0gYTt9IHdoaWxlIChudWxsICE9PSBiKTswID09PSBUICYmIChUID0gNSk7fWZ1bmN0aW9uIFFrKGEsIGIsIGMpIHt2YXIgZCA9IEMsZSA9IHBrLnRyYW5zaXRpb247dHJ5IHtway50cmFuc2l0aW9uID0gbnVsbCwgQyA9IDEsIFhrKGEsIGIsIGMsIGQpO30gZmluYWxseSB7cGsudHJhbnNpdGlvbiA9IGUsIEMgPSBkO31yZXR1cm4gbnVsbDt9CiAgICAgICAgICBmdW5jdGlvbiBYayhhLCBiLCBjLCBkKSB7ZG8ge0lrKCk7fSB3aGlsZSAobnVsbCAhPT0geGspO2lmICgwICE9PSAoSyAmIDYpKSB0aHJvdyBFcnJvcihwKDMyNykpO2MgPSBhLmZpbmlzaGVkV29yazt2YXIgZSA9IGEuZmluaXNoZWRMYW5lcztpZiAobnVsbCA9PT0gYykgcmV0dXJuIG51bGw7YS5maW5pc2hlZFdvcmsgPSBudWxsO2EuZmluaXNoZWRMYW5lcyA9IDA7aWYgKGMgPT09IGEuY3VycmVudCkgdGhyb3cgRXJyb3IocCgxNzcpKTthLmNhbGxiYWNrTm9kZSA9IG51bGw7YS5jYWxsYmFja1ByaW9yaXR5ID0gMDt2YXIgZiA9IGMubGFuZXMgfCBjLmNoaWxkTGFuZXM7QmMoYSwgZik7YSA9PT0gUiAmJiAoWSA9IFIgPSBudWxsLCBaID0gMCk7MCA9PT0gKGMuc3VidHJlZUZsYWdzICYgMjA2NCkgJiYgMCA9PT0gKGMuZmxhZ3MgJiAyMDY0KSB8fCB3ayB8fCAod2sgPSAhMCwgR2soaGMsIGZ1bmN0aW9uICgpIHtJaygpO3JldHVybiBudWxsO30pKTtmID0gMCAhPT0gKGMuZmxhZ3MgJiAxNTk5MCk7aWYgKDAgIT09IChjLnN1YnRyZWVGbGFncyAmIDE1OTkwKSB8fCBmKSB7ZiA9IHBrLnRyYW5zaXRpb247cGsudHJhbnNpdGlvbiA9IG51bGw7CiAgICAgICAgICAgICAgdmFyIGcgPSBDO0MgPSAxO3ZhciBoID0gSztLIHw9IDQ7b2suY3VycmVudCA9IG51bGw7UGooYSwgYyk7ZWsoYywgYSk7T2UoRGYpO2RkID0gISFDZjtEZiA9IENmID0gbnVsbDthLmN1cnJlbnQgPSBjO2lrKGMsIGEsIGUpO2RjKCk7SyA9IGg7QyA9IGc7cGsudHJhbnNpdGlvbiA9IGY7fSBlbHNlIGEuY3VycmVudCA9IGM7d2sgJiYgKHdrID0gITEsIHhrID0gYSwgeWsgPSBlKTtmID0gYS5wZW5kaW5nTGFuZXM7MCA9PT0gZiAmJiAoU2kgPSBudWxsKTttYyhjLnN0YXRlTm9kZSwgZCk7RWsoYSwgQigpKTtpZiAobnVsbCAhPT0gYikgZm9yIChkID0gYS5vblJlY292ZXJhYmxlRXJyb3IsIGMgPSAwOyBjIDwgYi5sZW5ndGg7IGMrKykge2UgPSBiW2NdLCBkKGUudmFsdWUsIHsgY29tcG9uZW50U3RhY2s6IGUuc3RhY2ssIGRpZ2VzdDogZS5kaWdlc3QgfSk7fWlmIChQaSkgdGhyb3cgUGkgPSAhMSwgYSA9IFFpLCBRaSA9IG51bGwsIGE7MCAhPT0gKHlrICYgMSkgJiYgMCAhPT0gYS50YWcgJiYgSWsoKTtmID0gYS5wZW5kaW5nTGFuZXM7MCAhPT0gKGYgJiAxKSA/IGEgPT09IEFrID8gemsrKyA6ICh6ayA9IDAsIEFrID0gYSkgOiB6ayA9IDA7amcoKTtyZXR1cm4gbnVsbDt9CiAgICAgICAgICBmdW5jdGlvbiBJaygpIHtpZiAobnVsbCAhPT0geGspIHt2YXIgYSA9IERjKHlrKSxiID0gcGsudHJhbnNpdGlvbixjID0gQzt0cnkge3BrLnRyYW5zaXRpb24gPSBudWxsO0MgPSAxNiA+IGEgPyAxNiA6IGE7aWYgKG51bGwgPT09IHhrKSB2YXIgZCA9ICExO2Vsc2Uge2EgPSB4azt4ayA9IG51bGw7eWsgPSAwO2lmICgwICE9PSAoSyAmIDYpKSB0aHJvdyBFcnJvcihwKDMzMSkpO3ZhciBlID0gSztLIHw9IDQ7Zm9yIChWID0gYS5jdXJyZW50OyBudWxsICE9PSBWOykge3ZhciBmID0gVixnID0gZi5jaGlsZDtpZiAoMCAhPT0gKFYuZmxhZ3MgJiAxNikpIHt2YXIgaCA9IGYuZGVsZXRpb25zO2lmIChudWxsICE9PSBoKSB7Zm9yICh2YXIgayA9IDA7IGsgPCBoLmxlbmd0aDsgaysrKSB7dmFyIGwgPSBoW2tdO2ZvciAoViA9IGw7IG51bGwgIT09IFY7KSB7dmFyIG0gPSBWO3N3aXRjaCAobS50YWcpIHtjYXNlIDA6Y2FzZSAxMTpjYXNlIDE1OlFqKDgsIG0sIGYpO312YXIgcSA9IG0uY2hpbGQ7aWYgKG51bGwgIT09IHEpIHEucmV0dXJuID0gbSwgViA9IHE7ZWxzZSBmb3IgKDsgbnVsbCAhPT0gVjspIHttID0gVjt2YXIgciA9IG0uc2libGluZyx5ID0gbS5yZXR1cm47VGoobSk7aWYgKG0gPT09CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGwpIHtWID0gbnVsbDticmVhazt9aWYgKG51bGwgIT09IHIpIHtyLnJldHVybiA9IHk7ViA9IHI7YnJlYWs7fVYgPSB5O319fXZhciBuID0gZi5hbHRlcm5hdGU7aWYgKG51bGwgIT09IG4pIHt2YXIgdCA9IG4uY2hpbGQ7aWYgKG51bGwgIT09IHQpIHtuLmNoaWxkID0gbnVsbDtkbyB7dmFyIEogPSB0LnNpYmxpbmc7dC5zaWJsaW5nID0gbnVsbDt0ID0gSjt9IHdoaWxlIChudWxsICE9PSB0KTt9fVYgPSBmO319aWYgKDAgIT09IChmLnN1YnRyZWVGbGFncyAmIDIwNjQpICYmIG51bGwgIT09IGcpIGcucmV0dXJuID0gZiwgViA9IGc7ZWxzZSBiOiBmb3IgKDsgbnVsbCAhPT0gVjspIHtmID0gVjtpZiAoMCAhPT0gKGYuZmxhZ3MgJiAyMDQ4KSkgc3dpdGNoIChmLnRhZykge2Nhc2UgMDpjYXNlIDExOmNhc2UgMTU6UWooOSwgZiwgZi5yZXR1cm4pO312YXIgeCA9IGYuc2libGluZztpZiAobnVsbCAhPT0geCkge3gucmV0dXJuID0gZi5yZXR1cm47ViA9IHg7YnJlYWsgYjt9ViA9IGYucmV0dXJuO319dmFyIHcgPSBhLmN1cnJlbnQ7Zm9yIChWID0gdzsgbnVsbCAhPT0gVjspIHtnID0gVjt2YXIgdSA9IGcuY2hpbGQ7aWYgKDAgIT09IChnLnN1YnRyZWVGbGFncyAmIDIwNjQpICYmIG51bGwgIT09CiAgICAgICAgICAgICAgICAgICAgdSkgdS5yZXR1cm4gPSBnLCBWID0gdTtlbHNlIGI6IGZvciAoZyA9IHc7IG51bGwgIT09IFY7KSB7aCA9IFY7aWYgKDAgIT09IChoLmZsYWdzICYgMjA0OCkpIHRyeSB7c3dpdGNoIChoLnRhZykge2Nhc2UgMDpjYXNlIDExOmNhc2UgMTU6UmooOSwgaCk7fX0gY2F0Y2ggKG5hKSB7VyhoLCBoLnJldHVybiwgbmEpO31pZiAoaCA9PT0gZykge1YgPSBudWxsO2JyZWFrIGI7fXZhciBGID0gaC5zaWJsaW5nO2lmIChudWxsICE9PSBGKSB7Ri5yZXR1cm4gPSBoLnJldHVybjtWID0gRjticmVhayBiO31WID0gaC5yZXR1cm47fX1LID0gZTtqZygpO2lmIChsYyAmJiAiZnVuY3Rpb24iID09PSB0eXBlb2YgbGMub25Qb3N0Q29tbWl0RmliZXJSb290KSB0cnkge2xjLm9uUG9zdENvbW1pdEZpYmVyUm9vdChrYywgYSk7fSBjYXRjaCAobmEpIHt9ZCA9ICEwO31yZXR1cm4gZDt9IGZpbmFsbHkge0MgPSBjLCBway50cmFuc2l0aW9uID0gYjt9fXJldHVybiAhMTt9ZnVuY3Rpb24gWWsoYSwgYiwgYykge2IgPSBLaShjLCBiKTtiID0gT2koYSwgYiwgMSk7YSA9IGRoKGEsIGIsIDEpO2IgPSBMKCk7bnVsbCAhPT0gYSAmJiAoQWMoYSwgMSwgYiksIEVrKGEsIGIpKTt9CiAgICAgICAgICBmdW5jdGlvbiBXKGEsIGIsIGMpIHtpZiAoMyA9PT0gYS50YWcpIFlrKGEsIGEsIGMpO2Vsc2UgZm9yICg7IG51bGwgIT09IGI7KSB7aWYgKDMgPT09IGIudGFnKSB7WWsoYiwgYSwgYyk7YnJlYWs7fSBlbHNlIGlmICgxID09PSBiLnRhZykge3ZhciBkID0gYi5zdGF0ZU5vZGU7aWYgKCJmdW5jdGlvbiIgPT09IHR5cGVvZiBiLnR5cGUuZ2V0RGVyaXZlZFN0YXRlRnJvbUVycm9yIHx8ICJmdW5jdGlvbiIgPT09IHR5cGVvZiBkLmNvbXBvbmVudERpZENhdGNoICYmIChudWxsID09PSBTaSB8fCAhU2kuaGFzKGQpKSkge2EgPSBLaShjLCBhKTthID0gUmkoYiwgYSwgMSk7YiA9IGRoKGIsIGEsIDEpO2EgPSBMKCk7bnVsbCAhPT0gYiAmJiAoQWMoYiwgMSwgYSksIEVrKGIsIGEpKTticmVhazt9fWIgPSBiLnJldHVybjt9fQogICAgICAgICAgZnVuY3Rpb24gVWkoYSwgYiwgYykge3ZhciBkID0gYS5waW5nQ2FjaGU7bnVsbCAhPT0gZCAmJiBkLmRlbGV0ZShiKTtiID0gTCgpO2EucGluZ2VkTGFuZXMgfD0gYS5zdXNwZW5kZWRMYW5lcyAmIGM7UiA9PT0gYSAmJiAoWiAmIGMpID09PSBjICYmICg0ID09PSBUIHx8IDMgPT09IFQgJiYgKFogJiAxMzAwMjM0MjQpID09PSBaICYmIDUwMCA+IEIoKSAtIGdrID8gTGsoYSwgMCkgOiBzayB8PSBjKTtFayhhLCBiKTt9ZnVuY3Rpb24gWmsoYSwgYikgezAgPT09IGIgJiYgKDAgPT09IChhLm1vZGUgJiAxKSA/IGIgPSAxIDogKGIgPSBzYywgc2MgPDw9IDEsIDAgPT09IChzYyAmIDEzMDAyMzQyNCkgJiYgKHNjID0gNDE5NDMwNCkpKTt2YXIgYyA9IEwoKTthID0gWmcoYSwgYik7bnVsbCAhPT0gYSAmJiAoQWMoYSwgYiwgYyksIEVrKGEsIGMpKTt9ZnVuY3Rpb24gdmooYSkge3ZhciBiID0gYS5tZW1vaXplZFN0YXRlLGMgPSAwO251bGwgIT09IGIgJiYgKGMgPSBiLnJldHJ5TGFuZSk7WmsoYSwgYyk7fQogICAgICAgICAgZnVuY3Rpb24gY2soYSwgYikge3ZhciBjID0gMDtzd2l0Y2ggKGEudGFnKSB7Y2FzZSAxMzp2YXIgZCA9IGEuc3RhdGVOb2RlO3ZhciBlID0gYS5tZW1vaXplZFN0YXRlO251bGwgIT09IGUgJiYgKGMgPSBlLnJldHJ5TGFuZSk7YnJlYWs7Y2FzZSAxOTpkID0gYS5zdGF0ZU5vZGU7YnJlYWs7ZGVmYXVsdDp0aHJvdyBFcnJvcihwKDMxNCkpO31udWxsICE9PSBkICYmIGQuZGVsZXRlKGIpO1prKGEsIGMpO312YXIgV2s7CiAgICAgICAgICBXayA9IGZ1bmN0aW9uIFdrKGEsIGIsIGMpIHtpZiAobnVsbCAhPT0gYSkge2lmIChhLm1lbW9pemVkUHJvcHMgIT09IGIucGVuZGluZ1Byb3BzIHx8IFdmLmN1cnJlbnQpIFVnID0gITA7ZWxzZSB7aWYgKDAgPT09IChhLmxhbmVzICYgYykgJiYgMCA9PT0gKGIuZmxhZ3MgJiAxMjgpKSByZXR1cm4gVWcgPSAhMSwgemooYSwgYiwgYyk7VWcgPSAwICE9PSAoYS5mbGFncyAmIDEzMTA3MikgPyAhMCA6ICExO319IGVsc2UgVWcgPSAhMSwgSSAmJiAwICE9PSAoYi5mbGFncyAmIDEwNDg1NzYpICYmIHVnKGIsIG5nLCBiLmluZGV4KTtiLmxhbmVzID0gMDtzd2l0Y2ggKGIudGFnKSB7Y2FzZSAyOnZhciBkID0gYi50eXBlO2pqKGEsIGIpO2EgPSBiLnBlbmRpbmdQcm9wczt2YXIgZSA9IFlmKGIsIEguY3VycmVudCk7VGcoYiwgYyk7ZSA9IFhoKG51bGwsIGIsIGQsIGEsIGUsIGMpO3ZhciBmID0gYmkoKTtiLmZsYWdzIHw9IDE7Im9iamVjdCIgPT09IHR5cGVvZiBlICYmIG51bGwgIT09IGUgJiYgImZ1bmN0aW9uIiA9PT0gdHlwZW9mIGUucmVuZGVyICYmIHZvaWQgMCA9PT0gZS4kJHR5cGVvZiA/IChiLnRhZyA9IDEsIGIubWVtb2l6ZWRTdGF0ZSA9IG51bGwsIGIudXBkYXRlUXVldWUgPQogICAgICAgICAgICAgICAgbnVsbCwgWmYoZCkgPyAoZiA9ICEwLCBjZyhiKSkgOiBmID0gITEsIGIubWVtb2l6ZWRTdGF0ZSA9IG51bGwgIT09IGUuc3RhdGUgJiYgdm9pZCAwICE9PSBlLnN0YXRlID8gZS5zdGF0ZSA6IG51bGwsIGFoKGIpLCBlLnVwZGF0ZXIgPSBuaCwgYi5zdGF0ZU5vZGUgPSBlLCBlLl9yZWFjdEludGVybmFscyA9IGIsIHJoKGIsIGQsIGEsIGMpLCBiID0ga2oobnVsbCwgYiwgZCwgITAsIGYsIGMpKSA6IChiLnRhZyA9IDAsIEkgJiYgZiAmJiB2ZyhiKSwgWWkobnVsbCwgYiwgZSwgYyksIGIgPSBiLmNoaWxkKTtyZXR1cm4gYjtjYXNlIDE2OmQgPSBiLmVsZW1lbnRUeXBlO2E6IHtqaihhLCBiKTthID0gYi5wZW5kaW5nUHJvcHM7ZSA9IGQuX2luaXQ7ZCA9IGUoZC5fcGF5bG9hZCk7Yi50eXBlID0gZDtlID0gYi50YWcgPSAkayhkKTthID0gTGcoZCwgYSk7c3dpdGNoIChlKSB7Y2FzZSAwOmIgPSBkaihudWxsLCBiLCBkLCBhLCBjKTticmVhayBhO2Nhc2UgMTpiID0gaWoobnVsbCwgYiwgZCwgYSwgYyk7YnJlYWsgYTtjYXNlIDExOmIgPSBaaShudWxsLCBiLCBkLCBhLCBjKTticmVhayBhO2Nhc2UgMTQ6YiA9IGFqKG51bGwsIGIsIGQsIExnKGQudHlwZSwgYSksIGMpO2JyZWFrIGE7fXRocm93IEVycm9yKHAoMzA2LAogICAgICAgICAgICAgICAgICBkLCAiIikpO31yZXR1cm4gYjtjYXNlIDA6cmV0dXJuIGQgPSBiLnR5cGUsIGUgPSBiLnBlbmRpbmdQcm9wcywgZSA9IGIuZWxlbWVudFR5cGUgPT09IGQgPyBlIDogTGcoZCwgZSksIGRqKGEsIGIsIGQsIGUsIGMpO2Nhc2UgMTpyZXR1cm4gZCA9IGIudHlwZSwgZSA9IGIucGVuZGluZ1Byb3BzLCBlID0gYi5lbGVtZW50VHlwZSA9PT0gZCA/IGUgOiBMZyhkLCBlKSwgaWooYSwgYiwgZCwgZSwgYyk7Y2FzZSAzOmE6IHtsaihiKTtpZiAobnVsbCA9PT0gYSkgdGhyb3cgRXJyb3IocCgzODcpKTtkID0gYi5wZW5kaW5nUHJvcHM7ZiA9IGIubWVtb2l6ZWRTdGF0ZTtlID0gZi5lbGVtZW50O2JoKGEsIGIpO2doKGIsIGQsIG51bGwsIGMpO3ZhciBnID0gYi5tZW1vaXplZFN0YXRlO2QgPSBnLmVsZW1lbnQ7aWYgKGYuaXNEZWh5ZHJhdGVkKSB7aWYgKGYgPSB7IGVsZW1lbnQ6IGQsIGlzRGVoeWRyYXRlZDogITEsIGNhY2hlOiBnLmNhY2hlLCBwZW5kaW5nU3VzcGVuc2VCb3VuZGFyaWVzOiBnLnBlbmRpbmdTdXNwZW5zZUJvdW5kYXJpZXMsIHRyYW5zaXRpb25zOiBnLnRyYW5zaXRpb25zIH0sIGIudXBkYXRlUXVldWUuYmFzZVN0YXRlID0KICAgICAgICAgICAgICAgICAgICBmLCBiLm1lbW9pemVkU3RhdGUgPSBmLCBiLmZsYWdzICYgMjU2KSB7ZSA9IEtpKEVycm9yKHAoNDIzKSksIGIpO2IgPSBtaihhLCBiLCBkLCBjLCBlKTticmVhayBhO30gZWxzZSBpZiAoZCAhPT0gZSkge2UgPSBLaShFcnJvcihwKDQyNCkpLCBiKTtiID0gbWooYSwgYiwgZCwgYywgZSk7YnJlYWsgYTt9IGVsc2UgZm9yICh5ZyA9IExmKGIuc3RhdGVOb2RlLmNvbnRhaW5lckluZm8uZmlyc3RDaGlsZCksIHhnID0gYiwgSSA9ICEwLCB6ZyA9IG51bGwsIGMgPSBDaChiLCBudWxsLCBkLCBjKSwgYi5jaGlsZCA9IGM7IGM7KSB7Yy5mbGFncyA9IGMuZmxhZ3MgJiAtMyB8IDQwOTYsIGMgPSBjLnNpYmxpbmc7fX0gZWxzZSB7SWcoKTtpZiAoZCA9PT0gZSkge2IgPSAkaShhLCBiLCBjKTticmVhayBhO31ZaShhLCBiLCBkLCBjKTt9YiA9IGIuY2hpbGQ7fXJldHVybiBiO2Nhc2UgNTpyZXR1cm4gS2goYiksIG51bGwgPT09IGEgJiYgRWcoYiksIGQgPSBiLnR5cGUsIGUgPSBiLnBlbmRpbmdQcm9wcywgZiA9IG51bGwgIT09IGEgPyBhLm1lbW9pemVkUHJvcHMgOiBudWxsLCBnID0gZS5jaGlsZHJlbiwgRWYoZCwgZSkgPyBnID0gbnVsbCA6IG51bGwgIT09IGYgJiYgRWYoZCwgZikgJiYgKGIuZmxhZ3MgfD0gMzIpLAogICAgICAgICAgICAgICAgaGooYSwgYiksIFlpKGEsIGIsIGcsIGMpLCBiLmNoaWxkO2Nhc2UgNjpyZXR1cm4gbnVsbCA9PT0gYSAmJiBFZyhiKSwgbnVsbDtjYXNlIDEzOnJldHVybiBwaihhLCBiLCBjKTtjYXNlIDQ6cmV0dXJuIEloKGIsIGIuc3RhdGVOb2RlLmNvbnRhaW5lckluZm8pLCBkID0gYi5wZW5kaW5nUHJvcHMsIG51bGwgPT09IGEgPyBiLmNoaWxkID0gQmgoYiwgbnVsbCwgZCwgYykgOiBZaShhLCBiLCBkLCBjKSwgYi5jaGlsZDtjYXNlIDExOnJldHVybiBkID0gYi50eXBlLCBlID0gYi5wZW5kaW5nUHJvcHMsIGUgPSBiLmVsZW1lbnRUeXBlID09PSBkID8gZSA6IExnKGQsIGUpLCBaaShhLCBiLCBkLCBlLCBjKTtjYXNlIDc6cmV0dXJuIFlpKGEsIGIsIGIucGVuZGluZ1Byb3BzLCBjKSwgYi5jaGlsZDtjYXNlIDg6cmV0dXJuIFlpKGEsIGIsIGIucGVuZGluZ1Byb3BzLmNoaWxkcmVuLCBjKSwgYi5jaGlsZDtjYXNlIDEyOnJldHVybiBZaShhLCBiLCBiLnBlbmRpbmdQcm9wcy5jaGlsZHJlbiwgYyksIGIuY2hpbGQ7Y2FzZSAxMDphOiB7ZCA9IGIudHlwZS5fY29udGV4dDtlID0gYi5wZW5kaW5nUHJvcHM7ZiA9IGIubWVtb2l6ZWRQcm9wczsKICAgICAgICAgICAgICAgICAgZyA9IGUudmFsdWU7RyhNZywgZC5fY3VycmVudFZhbHVlKTtkLl9jdXJyZW50VmFsdWUgPSBnO2lmIChudWxsICE9PSBmKSBpZiAoSGUoZi52YWx1ZSwgZykpIHtpZiAoZi5jaGlsZHJlbiA9PT0gZS5jaGlsZHJlbiAmJiAhV2YuY3VycmVudCkge2IgPSAkaShhLCBiLCBjKTticmVhayBhO319IGVsc2UgZm9yIChmID0gYi5jaGlsZCwgbnVsbCAhPT0gZiAmJiAoZi5yZXR1cm4gPSBiKTsgbnVsbCAhPT0gZjspIHt2YXIgaCA9IGYuZGVwZW5kZW5jaWVzO2lmIChudWxsICE9PSBoKSB7ZyA9IGYuY2hpbGQ7Zm9yICh2YXIgayA9IGguZmlyc3RDb250ZXh0OyBudWxsICE9PSBrOykge2lmIChrLmNvbnRleHQgPT09IGQpIHtpZiAoMSA9PT0gZi50YWcpIHtrID0gY2goLTEsIGMgJiAtYyk7ay50YWcgPSAyO3ZhciBsID0gZi51cGRhdGVRdWV1ZTtpZiAobnVsbCAhPT0gbCkge2wgPSBsLnNoYXJlZDt2YXIgbSA9IGwucGVuZGluZztudWxsID09PSBtID8gay5uZXh0ID0gayA6IChrLm5leHQgPSBtLm5leHQsIG0ubmV4dCA9IGspO2wucGVuZGluZyA9IGs7fX1mLmxhbmVzIHw9IGM7ayA9IGYuYWx0ZXJuYXRlO251bGwgIT09IGsgJiYgKGsubGFuZXMgfD0gYyk7U2coZi5yZXR1cm4sCiAgICAgICAgICAgICAgICAgICAgICAgICAgYywgYik7aC5sYW5lcyB8PSBjO2JyZWFrO31rID0gay5uZXh0O319IGVsc2UgaWYgKDEwID09PSBmLnRhZykgZyA9IGYudHlwZSA9PT0gYi50eXBlID8gbnVsbCA6IGYuY2hpbGQ7ZWxzZSBpZiAoMTggPT09IGYudGFnKSB7ZyA9IGYucmV0dXJuO2lmIChudWxsID09PSBnKSB0aHJvdyBFcnJvcihwKDM0MSkpO2cubGFuZXMgfD0gYztoID0gZy5hbHRlcm5hdGU7bnVsbCAhPT0gaCAmJiAoaC5sYW5lcyB8PSBjKTtTZyhnLCBjLCBiKTtnID0gZi5zaWJsaW5nO30gZWxzZSBnID0gZi5jaGlsZDtpZiAobnVsbCAhPT0gZykgZy5yZXR1cm4gPSBmO2Vsc2UgZm9yIChnID0gZjsgbnVsbCAhPT0gZzspIHtpZiAoZyA9PT0gYikge2cgPSBudWxsO2JyZWFrO31mID0gZy5zaWJsaW5nO2lmIChudWxsICE9PSBmKSB7Zi5yZXR1cm4gPSBnLnJldHVybjtnID0gZjticmVhazt9ZyA9IGcucmV0dXJuO31mID0gZzt9WWkoYSwgYiwgZS5jaGlsZHJlbiwgYyk7YiA9IGIuY2hpbGQ7fXJldHVybiBiO2Nhc2UgOTpyZXR1cm4gZSA9IGIudHlwZSwgZCA9IGIucGVuZGluZ1Byb3BzLmNoaWxkcmVuLCBUZyhiLCBjKSwgZSA9IFZnKGUpLCBkID0gZChlKSwgYi5mbGFncyB8PSAxLCBZaShhLCBiLCBkLCBjKSwKICAgICAgICAgICAgICAgIGIuY2hpbGQ7Y2FzZSAxNDpyZXR1cm4gZCA9IGIudHlwZSwgZSA9IExnKGQsIGIucGVuZGluZ1Byb3BzKSwgZSA9IExnKGQudHlwZSwgZSksIGFqKGEsIGIsIGQsIGUsIGMpO2Nhc2UgMTU6cmV0dXJuIGNqKGEsIGIsIGIudHlwZSwgYi5wZW5kaW5nUHJvcHMsIGMpO2Nhc2UgMTc6cmV0dXJuIGQgPSBiLnR5cGUsIGUgPSBiLnBlbmRpbmdQcm9wcywgZSA9IGIuZWxlbWVudFR5cGUgPT09IGQgPyBlIDogTGcoZCwgZSksIGpqKGEsIGIpLCBiLnRhZyA9IDEsIFpmKGQpID8gKGEgPSAhMCwgY2coYikpIDogYSA9ICExLCBUZyhiLCBjKSwgcGgoYiwgZCwgZSksIHJoKGIsIGQsIGUsIGMpLCBraihudWxsLCBiLCBkLCAhMCwgYSwgYyk7Y2FzZSAxOTpyZXR1cm4geWooYSwgYiwgYyk7Y2FzZSAyMjpyZXR1cm4gZWooYSwgYiwgYyk7fXRocm93IEVycm9yKHAoMTU2LCBiLnRhZykpO307ZnVuY3Rpb24gR2soYSwgYikge3JldHVybiBhYyhhLCBiKTt9CiAgICAgICAgICBmdW5jdGlvbiBhbChhLCBiLCBjLCBkKSB7dGhpcy50YWcgPSBhO3RoaXMua2V5ID0gYzt0aGlzLnNpYmxpbmcgPSB0aGlzLmNoaWxkID0gdGhpcy5yZXR1cm4gPSB0aGlzLnN0YXRlTm9kZSA9IHRoaXMudHlwZSA9IHRoaXMuZWxlbWVudFR5cGUgPSBudWxsO3RoaXMuaW5kZXggPSAwO3RoaXMucmVmID0gbnVsbDt0aGlzLnBlbmRpbmdQcm9wcyA9IGI7dGhpcy5kZXBlbmRlbmNpZXMgPSB0aGlzLm1lbW9pemVkU3RhdGUgPSB0aGlzLnVwZGF0ZVF1ZXVlID0gdGhpcy5tZW1vaXplZFByb3BzID0gbnVsbDt0aGlzLm1vZGUgPSBkO3RoaXMuc3VidHJlZUZsYWdzID0gdGhpcy5mbGFncyA9IDA7dGhpcy5kZWxldGlvbnMgPSBudWxsO3RoaXMuY2hpbGRMYW5lcyA9IHRoaXMubGFuZXMgPSAwO3RoaXMuYWx0ZXJuYXRlID0gbnVsbDt9ZnVuY3Rpb24gQmcoYSwgYiwgYywgZCkge3JldHVybiBuZXcgYWwoYSwgYiwgYywgZCk7fWZ1bmN0aW9uIGJqKGEpIHthID0gYS5wcm90b3R5cGU7cmV0dXJuICEoIWEgfHwgIWEuaXNSZWFjdENvbXBvbmVudCk7fQogICAgICAgICAgZnVuY3Rpb24gJGsoYSkge2lmICgiZnVuY3Rpb24iID09PSB0eXBlb2YgYSkgcmV0dXJuIGJqKGEpID8gMSA6IDA7aWYgKHZvaWQgMCAhPT0gYSAmJiBudWxsICE9PSBhKSB7YSA9IGEuJCR0eXBlb2Y7aWYgKGEgPT09IERhKSByZXR1cm4gMTE7aWYgKGEgPT09IEdhKSByZXR1cm4gMTQ7fXJldHVybiAyO30KICAgICAgICAgIGZ1bmN0aW9uIHdoKGEsIGIpIHt2YXIgYyA9IGEuYWx0ZXJuYXRlO251bGwgPT09IGMgPyAoYyA9IEJnKGEudGFnLCBiLCBhLmtleSwgYS5tb2RlKSwgYy5lbGVtZW50VHlwZSA9IGEuZWxlbWVudFR5cGUsIGMudHlwZSA9IGEudHlwZSwgYy5zdGF0ZU5vZGUgPSBhLnN0YXRlTm9kZSwgYy5hbHRlcm5hdGUgPSBhLCBhLmFsdGVybmF0ZSA9IGMpIDogKGMucGVuZGluZ1Byb3BzID0gYiwgYy50eXBlID0gYS50eXBlLCBjLmZsYWdzID0gMCwgYy5zdWJ0cmVlRmxhZ3MgPSAwLCBjLmRlbGV0aW9ucyA9IG51bGwpO2MuZmxhZ3MgPSBhLmZsYWdzICYgMTQ2ODAwNjQ7Yy5jaGlsZExhbmVzID0gYS5jaGlsZExhbmVzO2MubGFuZXMgPSBhLmxhbmVzO2MuY2hpbGQgPSBhLmNoaWxkO2MubWVtb2l6ZWRQcm9wcyA9IGEubWVtb2l6ZWRQcm9wcztjLm1lbW9pemVkU3RhdGUgPSBhLm1lbW9pemVkU3RhdGU7Yy51cGRhdGVRdWV1ZSA9IGEudXBkYXRlUXVldWU7YiA9IGEuZGVwZW5kZW5jaWVzO2MuZGVwZW5kZW5jaWVzID0gbnVsbCA9PT0gYiA/IG51bGwgOiB7IGxhbmVzOiBiLmxhbmVzLCBmaXJzdENvbnRleHQ6IGIuZmlyc3RDb250ZXh0IH07CiAgICAgICAgICAgIGMuc2libGluZyA9IGEuc2libGluZztjLmluZGV4ID0gYS5pbmRleDtjLnJlZiA9IGEucmVmO3JldHVybiBjO30KICAgICAgICAgIGZ1bmN0aW9uIHloKGEsIGIsIGMsIGQsIGUsIGYpIHt2YXIgZyA9IDI7ZCA9IGE7aWYgKCJmdW5jdGlvbiIgPT09IHR5cGVvZiBhKSBiaihhKSAmJiAoZyA9IDEpO2Vsc2UgaWYgKCJzdHJpbmciID09PSB0eXBlb2YgYSkgZyA9IDU7ZWxzZSBhOiBzd2l0Y2ggKGEpIHtjYXNlIHlhOnJldHVybiBBaChjLmNoaWxkcmVuLCBlLCBmLCBiKTtjYXNlIHphOmcgPSA4O2UgfD0gODticmVhaztjYXNlIEFhOnJldHVybiBhID0gQmcoMTIsIGMsIGIsIGUgfCAyKSwgYS5lbGVtZW50VHlwZSA9IEFhLCBhLmxhbmVzID0gZiwgYTtjYXNlIEVhOnJldHVybiBhID0gQmcoMTMsIGMsIGIsIGUpLCBhLmVsZW1lbnRUeXBlID0gRWEsIGEubGFuZXMgPSBmLCBhO2Nhc2UgRmE6cmV0dXJuIGEgPSBCZygxOSwgYywgYiwgZSksIGEuZWxlbWVudFR5cGUgPSBGYSwgYS5sYW5lcyA9IGYsIGE7Y2FzZSBJYTpyZXR1cm4gcWooYywgZSwgZiwgYik7ZGVmYXVsdDppZiAoIm9iamVjdCIgPT09IHR5cGVvZiBhICYmIG51bGwgIT09IGEpIHN3aXRjaCAoYS4kJHR5cGVvZikge2Nhc2UgQmE6ZyA9IDEwO2JyZWFrIGE7Y2FzZSBDYTpnID0gOTticmVhayBhO2Nhc2UgRGE6ZyA9IDExOwogICAgICAgICAgICAgICAgICAgIGJyZWFrIGE7Y2FzZSBHYTpnID0gMTQ7YnJlYWsgYTtjYXNlIEhhOmcgPSAxNjtkID0gbnVsbDticmVhayBhO310aHJvdyBFcnJvcihwKDEzMCwgbnVsbCA9PSBhID8gYSA6IHR5cGVvZiBhLCAiIikpO31iID0gQmcoZywgYywgYiwgZSk7Yi5lbGVtZW50VHlwZSA9IGE7Yi50eXBlID0gZDtiLmxhbmVzID0gZjtyZXR1cm4gYjt9ZnVuY3Rpb24gQWgoYSwgYiwgYywgZCkge2EgPSBCZyg3LCBhLCBkLCBiKTthLmxhbmVzID0gYztyZXR1cm4gYTt9ZnVuY3Rpb24gcWooYSwgYiwgYywgZCkge2EgPSBCZygyMiwgYSwgZCwgYik7YS5lbGVtZW50VHlwZSA9IElhO2EubGFuZXMgPSBjO2Euc3RhdGVOb2RlID0geyBpc0hpZGRlbjogITEgfTtyZXR1cm4gYTt9ZnVuY3Rpb24geGgoYSwgYiwgYykge2EgPSBCZyg2LCBhLCBudWxsLCBiKTthLmxhbmVzID0gYztyZXR1cm4gYTt9CiAgICAgICAgICBmdW5jdGlvbiB6aChhLCBiLCBjKSB7YiA9IEJnKDQsIG51bGwgIT09IGEuY2hpbGRyZW4gPyBhLmNoaWxkcmVuIDogW10sIGEua2V5LCBiKTtiLmxhbmVzID0gYztiLnN0YXRlTm9kZSA9IHsgY29udGFpbmVySW5mbzogYS5jb250YWluZXJJbmZvLCBwZW5kaW5nQ2hpbGRyZW46IG51bGwsIGltcGxlbWVudGF0aW9uOiBhLmltcGxlbWVudGF0aW9uIH07cmV0dXJuIGI7fQogICAgICAgICAgZnVuY3Rpb24gYmwoYSwgYiwgYywgZCwgZSkge3RoaXMudGFnID0gYjt0aGlzLmNvbnRhaW5lckluZm8gPSBhO3RoaXMuZmluaXNoZWRXb3JrID0gdGhpcy5waW5nQ2FjaGUgPSB0aGlzLmN1cnJlbnQgPSB0aGlzLnBlbmRpbmdDaGlsZHJlbiA9IG51bGw7dGhpcy50aW1lb3V0SGFuZGxlID0gLTE7dGhpcy5jYWxsYmFja05vZGUgPSB0aGlzLnBlbmRpbmdDb250ZXh0ID0gdGhpcy5jb250ZXh0ID0gbnVsbDt0aGlzLmNhbGxiYWNrUHJpb3JpdHkgPSAwO3RoaXMuZXZlbnRUaW1lcyA9IHpjKDApO3RoaXMuZXhwaXJhdGlvblRpbWVzID0gemMoLTEpO3RoaXMuZW50YW5nbGVkTGFuZXMgPSB0aGlzLmZpbmlzaGVkTGFuZXMgPSB0aGlzLm11dGFibGVSZWFkTGFuZXMgPSB0aGlzLmV4cGlyZWRMYW5lcyA9IHRoaXMucGluZ2VkTGFuZXMgPSB0aGlzLnN1c3BlbmRlZExhbmVzID0gdGhpcy5wZW5kaW5nTGFuZXMgPSAwO3RoaXMuZW50YW5nbGVtZW50cyA9IHpjKDApO3RoaXMuaWRlbnRpZmllclByZWZpeCA9IGQ7dGhpcy5vblJlY292ZXJhYmxlRXJyb3IgPSBlO3RoaXMubXV0YWJsZVNvdXJjZUVhZ2VySHlkcmF0aW9uRGF0YSA9CiAgICAgICAgICAgIG51bGw7fWZ1bmN0aW9uIGNsKGEsIGIsIGMsIGQsIGUsIGYsIGcsIGgsIGspIHthID0gbmV3IGJsKGEsIGIsIGMsIGgsIGspOzEgPT09IGIgPyAoYiA9IDEsICEwID09PSBmICYmIChiIHw9IDgpKSA6IGIgPSAwO2YgPSBCZygzLCBudWxsLCBudWxsLCBiKTthLmN1cnJlbnQgPSBmO2Yuc3RhdGVOb2RlID0gYTtmLm1lbW9pemVkU3RhdGUgPSB7IGVsZW1lbnQ6IGQsIGlzRGVoeWRyYXRlZDogYywgY2FjaGU6IG51bGwsIHRyYW5zaXRpb25zOiBudWxsLCBwZW5kaW5nU3VzcGVuc2VCb3VuZGFyaWVzOiBudWxsIH07YWgoZik7cmV0dXJuIGE7fWZ1bmN0aW9uIGRsKGEsIGIsIGMpIHt2YXIgZCA9IDMgPCBhcmd1bWVudHMubGVuZ3RoICYmIHZvaWQgMCAhPT0gYXJndW1lbnRzWzNdID8gYXJndW1lbnRzWzNdIDogbnVsbDtyZXR1cm4geyAkJHR5cGVvZjogd2EsIGtleTogbnVsbCA9PSBkID8gbnVsbCA6ICIiICsgZCwgY2hpbGRyZW46IGEsIGNvbnRhaW5lckluZm86IGIsIGltcGxlbWVudGF0aW9uOiBjIH07fQogICAgICAgICAgZnVuY3Rpb24gZWwoYSkge2lmICghYSkgcmV0dXJuIFZmO2EgPSBhLl9yZWFjdEludGVybmFsczthOiB7aWYgKFZiKGEpICE9PSBhIHx8IDEgIT09IGEudGFnKSB0aHJvdyBFcnJvcihwKDE3MCkpO3ZhciBiID0gYTtkbyB7c3dpdGNoIChiLnRhZykge2Nhc2UgMzpiID0gYi5zdGF0ZU5vZGUuY29udGV4dDticmVhayBhO2Nhc2UgMTppZiAoWmYoYi50eXBlKSkge2IgPSBiLnN0YXRlTm9kZS5fX3JlYWN0SW50ZXJuYWxNZW1vaXplZE1lcmdlZENoaWxkQ29udGV4dDticmVhayBhO319YiA9IGIucmV0dXJuO30gd2hpbGUgKG51bGwgIT09IGIpO3Rocm93IEVycm9yKHAoMTcxKSk7fWlmICgxID09PSBhLnRhZykge3ZhciBjID0gYS50eXBlO2lmIChaZihjKSkgcmV0dXJuIGJnKGEsIGMsIGIpO31yZXR1cm4gYjt9CiAgICAgICAgICBmdW5jdGlvbiBmbChhLCBiLCBjLCBkLCBlLCBmLCBnLCBoLCBrKSB7YSA9IGNsKGMsIGQsICEwLCBhLCBlLCBmLCBnLCBoLCBrKTthLmNvbnRleHQgPSBlbChudWxsKTtjID0gYS5jdXJyZW50O2QgPSBMKCk7ZSA9IGxoKGMpO2YgPSBjaChkLCBlKTtmLmNhbGxiYWNrID0gdm9pZCAwICE9PSBiICYmIG51bGwgIT09IGIgPyBiIDogbnVsbDtkaChjLCBmLCBlKTthLmN1cnJlbnQubGFuZXMgPSBlO0FjKGEsIGUsIGQpO0VrKGEsIGQpO3JldHVybiBhO31mdW5jdGlvbiBnbChhLCBiLCBjLCBkKSB7dmFyIGUgPSBiLmN1cnJlbnQsZiA9IEwoKSxnID0gbGgoZSk7YyA9IGVsKGMpO251bGwgPT09IGIuY29udGV4dCA/IGIuY29udGV4dCA9IGMgOiBiLnBlbmRpbmdDb250ZXh0ID0gYztiID0gY2goZiwgZyk7Yi5wYXlsb2FkID0geyBlbGVtZW50OiBhIH07ZCA9IHZvaWQgMCA9PT0gZCA/IG51bGwgOiBkO251bGwgIT09IGQgJiYgKGIuY2FsbGJhY2sgPSBkKTthID0gZGgoZSwgYiwgZyk7bnVsbCAhPT0gYSAmJiAobWgoYSwgZSwgZywgZiksIGVoKGEsIGUsIGcpKTtyZXR1cm4gZzt9CiAgICAgICAgICBmdW5jdGlvbiBobChhKSB7YSA9IGEuY3VycmVudDtpZiAoIWEuY2hpbGQpIHJldHVybiBudWxsO3N3aXRjaCAoYS5jaGlsZC50YWcpIHtjYXNlIDU6cmV0dXJuIGEuY2hpbGQuc3RhdGVOb2RlO2RlZmF1bHQ6cmV0dXJuIGEuY2hpbGQuc3RhdGVOb2RlO319ZnVuY3Rpb24gaWwoYSwgYikge2EgPSBhLm1lbW9pemVkU3RhdGU7aWYgKG51bGwgIT09IGEgJiYgbnVsbCAhPT0gYS5kZWh5ZHJhdGVkKSB7dmFyIGMgPSBhLnJldHJ5TGFuZTthLnJldHJ5TGFuZSA9IDAgIT09IGMgJiYgYyA8IGIgPyBjIDogYjt9fWZ1bmN0aW9uIGpsKGEsIGIpIHtpbChhLCBiKTsoYSA9IGEuYWx0ZXJuYXRlKSAmJiBpbChhLCBiKTt9ZnVuY3Rpb24ga2woKSB7cmV0dXJuIG51bGw7fXZhciBsbCA9ICJmdW5jdGlvbiIgPT09IHR5cGVvZiByZXBvcnRFcnJvciA/IHJlcG9ydEVycm9yIDogZnVuY3Rpb24gKGEpIHtjb25zb2xlLmVycm9yKGEpO307ZnVuY3Rpb24gbWwoYSkge3RoaXMuX2ludGVybmFsUm9vdCA9IGE7fQogICAgICAgICAgbmwucHJvdG90eXBlLnJlbmRlciA9IG1sLnByb3RvdHlwZS5yZW5kZXIgPSBmdW5jdGlvbiAoYSkge3ZhciBiID0gdGhpcy5faW50ZXJuYWxSb290O2lmIChudWxsID09PSBiKSB0aHJvdyBFcnJvcihwKDQwOSkpO2dsKGEsIGIsIG51bGwsIG51bGwpO307bmwucHJvdG90eXBlLnVubW91bnQgPSBtbC5wcm90b3R5cGUudW5tb3VudCA9IGZ1bmN0aW9uICgpIHt2YXIgYSA9IHRoaXMuX2ludGVybmFsUm9vdDtpZiAobnVsbCAhPT0gYSkge3RoaXMuX2ludGVybmFsUm9vdCA9IG51bGw7dmFyIGIgPSBhLmNvbnRhaW5lckluZm87U2soZnVuY3Rpb24gKCkge2dsKG51bGwsIGEsIG51bGwsIG51bGwpO30pO2JbdWZdID0gbnVsbDt9fTtmdW5jdGlvbiBubChhKSB7dGhpcy5faW50ZXJuYWxSb290ID0gYTt9CiAgICAgICAgICBubC5wcm90b3R5cGUudW5zdGFibGVfc2NoZWR1bGVIeWRyYXRpb24gPSBmdW5jdGlvbiAoYSkge2lmIChhKSB7dmFyIGIgPSBIYygpO2EgPSB7IGJsb2NrZWRPbjogbnVsbCwgdGFyZ2V0OiBhLCBwcmlvcml0eTogYiB9O2ZvciAodmFyIGMgPSAwOyBjIDwgUWMubGVuZ3RoICYmIDAgIT09IGIgJiYgYiA8IFFjW2NdLnByaW9yaXR5OyBjKyspIHs7fVFjLnNwbGljZShjLCAwLCBhKTswID09PSBjICYmIFZjKGEpO319O2Z1bmN0aW9uIG9sKGEpIHtyZXR1cm4gISghYSB8fCAxICE9PSBhLm5vZGVUeXBlICYmIDkgIT09IGEubm9kZVR5cGUgJiYgMTEgIT09IGEubm9kZVR5cGUpO31mdW5jdGlvbiBwbChhKSB7cmV0dXJuICEoIWEgfHwgMSAhPT0gYS5ub2RlVHlwZSAmJiA5ICE9PSBhLm5vZGVUeXBlICYmIDExICE9PSBhLm5vZGVUeXBlICYmICg4ICE9PSBhLm5vZGVUeXBlIHx8ICIgcmVhY3QtbW91bnQtcG9pbnQtdW5zdGFibGUgIiAhPT0gYS5ub2RlVmFsdWUpKTt9ZnVuY3Rpb24gcWwoKSB7fQogICAgICAgICAgZnVuY3Rpb24gcmwoYSwgYiwgYywgZCwgZSkge2lmIChlKSB7aWYgKCJmdW5jdGlvbiIgPT09IHR5cGVvZiBkKSB7dmFyIGYgPSBkO2QgPSBmdW5jdGlvbiBkKCkge3ZhciBhID0gaGwoZyk7Zi5jYWxsKGEpO307fXZhciBnID0gZmwoYiwgZCwgYSwgMCwgbnVsbCwgITEsICExLCAiIiwgcWwpO2EuX3JlYWN0Um9vdENvbnRhaW5lciA9IGc7YVt1Zl0gPSBnLmN1cnJlbnQ7c2YoOCA9PT0gYS5ub2RlVHlwZSA/IGEucGFyZW50Tm9kZSA6IGEpO1NrKCk7cmV0dXJuIGc7fWZvciAoOyBlID0gYS5sYXN0Q2hpbGQ7KSB7YS5yZW1vdmVDaGlsZChlKTt9aWYgKCJmdW5jdGlvbiIgPT09IHR5cGVvZiBkKSB7dmFyIGggPSBkO2QgPSBmdW5jdGlvbiBkKCkge3ZhciBhID0gaGwoayk7aC5jYWxsKGEpO307fXZhciBrID0gY2woYSwgMCwgITEsIG51bGwsIG51bGwsICExLCAhMSwgIiIsIHFsKTthLl9yZWFjdFJvb3RDb250YWluZXIgPSBrO2FbdWZdID0gay5jdXJyZW50O3NmKDggPT09IGEubm9kZVR5cGUgPyBhLnBhcmVudE5vZGUgOiBhKTtTayhmdW5jdGlvbiAoKSB7Z2woYiwgaywgYywgZCk7fSk7cmV0dXJuIGs7fQogICAgICAgICAgZnVuY3Rpb24gc2woYSwgYiwgYywgZCwgZSkge3ZhciBmID0gYy5fcmVhY3RSb290Q29udGFpbmVyO2lmIChmKSB7dmFyIGcgPSBmO2lmICgiZnVuY3Rpb24iID09PSB0eXBlb2YgZSkge3ZhciBoID0gZTtlID0gZnVuY3Rpb24gZSgpIHt2YXIgYSA9IGhsKGcpO2guY2FsbChhKTt9O31nbChiLCBnLCBhLCBlKTt9IGVsc2UgZyA9IHJsKGMsIGIsIGEsIGUsIGQpO3JldHVybiBobChnKTt9RWMgPSBmdW5jdGlvbiBFYyhhKSB7c3dpdGNoIChhLnRhZykge2Nhc2UgMzp2YXIgYiA9IGEuc3RhdGVOb2RlO2lmIChiLmN1cnJlbnQubWVtb2l6ZWRTdGF0ZS5pc0RlaHlkcmF0ZWQpIHt2YXIgYyA9IHRjKGIucGVuZGluZ0xhbmVzKTswICE9PSBjICYmIChDYyhiLCBjIHwgMSksIEVrKGIsIEIoKSksIDAgPT09IChLICYgNikgJiYgKEhqID0gQigpICsgNTAwLCBqZygpKSk7fWJyZWFrO2Nhc2UgMTM6U2soZnVuY3Rpb24gKCkge3ZhciBiID0gWmcoYSwgMSk7aWYgKG51bGwgIT09IGIpIHt2YXIgYyA9IEwoKTttaChiLCBhLCAxLCBjKTt9fSksIGpsKGEsIDEpO319OwogICAgICAgICAgRmMgPSBmdW5jdGlvbiBGYyhhKSB7aWYgKDEzID09PSBhLnRhZykge3ZhciBiID0gWmcoYSwgMTM0MjE3NzI4KTtpZiAobnVsbCAhPT0gYikge3ZhciBjID0gTCgpO21oKGIsIGEsIDEzNDIxNzcyOCwgYyk7fWpsKGEsIDEzNDIxNzcyOCk7fX07R2MgPSBmdW5jdGlvbiBHYyhhKSB7aWYgKDEzID09PSBhLnRhZykge3ZhciBiID0gbGgoYSksYyA9IFpnKGEsIGIpO2lmIChudWxsICE9PSBjKSB7dmFyIGQgPSBMKCk7bWgoYywgYSwgYiwgZCk7fWpsKGEsIGIpO319O0hjID0gZnVuY3Rpb24gSGMoKSB7cmV0dXJuIEM7fTtJYyA9IGZ1bmN0aW9uIEljKGEsIGIpIHt2YXIgYyA9IEM7dHJ5IHtyZXR1cm4gQyA9IGEsIGIoKTt9IGZpbmFsbHkge0MgPSBjO319OwogICAgICAgICAgeWIgPSBmdW5jdGlvbiB5YihhLCBiLCBjKSB7c3dpdGNoIChiKSB7Y2FzZSAiaW5wdXQiOmJiKGEsIGMpO2IgPSBjLm5hbWU7aWYgKCJyYWRpbyIgPT09IGMudHlwZSAmJiBudWxsICE9IGIpIHtmb3IgKGMgPSBhOyBjLnBhcmVudE5vZGU7KSB7YyA9IGMucGFyZW50Tm9kZTt9YyA9IGMucXVlcnlTZWxlY3RvckFsbCgiaW5wdXRbbmFtZT0iICsgSlNPTi5zdHJpbmdpZnkoIiIgKyBiKSArICddW3R5cGU9InJhZGlvIl0nKTtmb3IgKGIgPSAwOyBiIDwgYy5sZW5ndGg7IGIrKykge3ZhciBkID0gY1tiXTtpZiAoZCAhPT0gYSAmJiBkLmZvcm0gPT09IGEuZm9ybSkge3ZhciBlID0gRGIoZCk7aWYgKCFlKSB0aHJvdyBFcnJvcihwKDkwKSk7V2EoZCk7YmIoZCwgZSk7fX19YnJlYWs7Y2FzZSAidGV4dGFyZWEiOmliKGEsIGMpO2JyZWFrO2Nhc2UgInNlbGVjdCI6YiA9IGMudmFsdWUsIG51bGwgIT0gYiAmJiBmYihhLCAhIWMubXVsdGlwbGUsIGIsICExKTt9fTtHYiA9IFJrO0hiID0gU2s7CiAgICAgICAgICB2YXIgdGwgPSB7IHVzaW5nQ2xpZW50RW50cnlQb2ludDogITEsIEV2ZW50czogW0NiLCB1ZSwgRGIsIEViLCBGYiwgUmtdIH0sdWwgPSB7IGZpbmRGaWJlckJ5SG9zdEluc3RhbmNlOiBXYywgYnVuZGxlVHlwZTogMCwgdmVyc2lvbjogIjE4LjIuMCIsIHJlbmRlcmVyUGFja2FnZU5hbWU6ICJyZWFjdC1kb20iIH07CiAgICAgICAgICB2YXIgdmwgPSB7IGJ1bmRsZVR5cGU6IHVsLmJ1bmRsZVR5cGUsIHZlcnNpb246IHVsLnZlcnNpb24sIHJlbmRlcmVyUGFja2FnZU5hbWU6IHVsLnJlbmRlcmVyUGFja2FnZU5hbWUsIHJlbmRlcmVyQ29uZmlnOiB1bC5yZW5kZXJlckNvbmZpZywgb3ZlcnJpZGVIb29rU3RhdGU6IG51bGwsIG92ZXJyaWRlSG9va1N0YXRlRGVsZXRlUGF0aDogbnVsbCwgb3ZlcnJpZGVIb29rU3RhdGVSZW5hbWVQYXRoOiBudWxsLCBvdmVycmlkZVByb3BzOiBudWxsLCBvdmVycmlkZVByb3BzRGVsZXRlUGF0aDogbnVsbCwgb3ZlcnJpZGVQcm9wc1JlbmFtZVBhdGg6IG51bGwsIHNldEVycm9ySGFuZGxlcjogbnVsbCwgc2V0U3VzcGVuc2VIYW5kbGVyOiBudWxsLCBzY2hlZHVsZVVwZGF0ZTogbnVsbCwgY3VycmVudERpc3BhdGNoZXJSZWY6IHVhLlJlYWN0Q3VycmVudERpc3BhdGNoZXIsIGZpbmRIb3N0SW5zdGFuY2VCeUZpYmVyOiBmdW5jdGlvbiBmaW5kSG9zdEluc3RhbmNlQnlGaWJlcihhKSB7YSA9IFpiKGEpO3JldHVybiBudWxsID09PSBhID8gbnVsbCA6IGEuc3RhdGVOb2RlO30sIGZpbmRGaWJlckJ5SG9zdEluc3RhbmNlOiB1bC5maW5kRmliZXJCeUhvc3RJbnN0YW5jZSB8fAogICAgICAgICAgICBrbCwgZmluZEhvc3RJbnN0YW5jZXNGb3JSZWZyZXNoOiBudWxsLCBzY2hlZHVsZVJlZnJlc2g6IG51bGwsIHNjaGVkdWxlUm9vdDogbnVsbCwgc2V0UmVmcmVzaEhhbmRsZXI6IG51bGwsIGdldEN1cnJlbnRGaWJlcjogbnVsbCwgcmVjb25jaWxlclZlcnNpb246ICIxOC4yLjAtbmV4dC05ZTNiNzcyYjgtMjAyMjA2MDgiIH07aWYgKCJ1bmRlZmluZWQiICE9PSB0eXBlb2YgX19SRUFDVF9ERVZUT09MU19HTE9CQUxfSE9PS19fKSB7dmFyIHdsID0gX19SRUFDVF9ERVZUT09MU19HTE9CQUxfSE9PS19fO2lmICghd2wuaXNEaXNhYmxlZCAmJiB3bC5zdXBwb3J0c0ZpYmVyKSB0cnkge2tjID0gd2wuaW5qZWN0KHZsKSwgbGMgPSB3bDt9IGNhdGNoIChhKSB7fX1leHBvcnRzLl9fU0VDUkVUX0lOVEVSTkFMU19ET19OT1RfVVNFX09SX1lPVV9XSUxMX0JFX0ZJUkVEID0gdGw7CiAgICAgICAgICBleHBvcnRzLmNyZWF0ZVBvcnRhbCA9IGZ1bmN0aW9uIChhLCBiKSB7dmFyIGMgPSAyIDwgYXJndW1lbnRzLmxlbmd0aCAmJiB2b2lkIDAgIT09IGFyZ3VtZW50c1syXSA/IGFyZ3VtZW50c1syXSA6IG51bGw7aWYgKCFvbChiKSkgdGhyb3cgRXJyb3IocCgyMDApKTtyZXR1cm4gZGwoYSwgYiwgbnVsbCwgYyk7fTtleHBvcnRzLmNyZWF0ZVJvb3QgPSBmdW5jdGlvbiAoYSwgYikge2lmICghb2woYSkpIHRocm93IEVycm9yKHAoMjk5KSk7dmFyIGMgPSAhMSxkID0gIiIsZSA9IGxsO251bGwgIT09IGIgJiYgdm9pZCAwICE9PSBiICYmICghMCA9PT0gYi51bnN0YWJsZV9zdHJpY3RNb2RlICYmIChjID0gITApLCB2b2lkIDAgIT09IGIuaWRlbnRpZmllclByZWZpeCAmJiAoZCA9IGIuaWRlbnRpZmllclByZWZpeCksIHZvaWQgMCAhPT0gYi5vblJlY292ZXJhYmxlRXJyb3IgJiYgKGUgPSBiLm9uUmVjb3ZlcmFibGVFcnJvcikpO2IgPSBjbChhLCAxLCAhMSwgbnVsbCwgbnVsbCwgYywgITEsIGQsIGUpO2FbdWZdID0gYi5jdXJyZW50O3NmKDggPT09IGEubm9kZVR5cGUgPyBhLnBhcmVudE5vZGUgOiBhKTtyZXR1cm4gbmV3IG1sKGIpO307CiAgICAgICAgICBleHBvcnRzLmZpbmRET01Ob2RlID0gZnVuY3Rpb24gKGEpIHtpZiAobnVsbCA9PSBhKSByZXR1cm4gbnVsbDtpZiAoMSA9PT0gYS5ub2RlVHlwZSkgcmV0dXJuIGE7dmFyIGIgPSBhLl9yZWFjdEludGVybmFscztpZiAodm9pZCAwID09PSBiKSB7aWYgKCJmdW5jdGlvbiIgPT09IHR5cGVvZiBhLnJlbmRlcikgdGhyb3cgRXJyb3IocCgxODgpKTthID0gT2JqZWN0LmtleXMoYSkuam9pbigiLCIpO3Rocm93IEVycm9yKHAoMjY4LCBhKSk7fWEgPSBaYihiKTthID0gbnVsbCA9PT0gYSA/IG51bGwgOiBhLnN0YXRlTm9kZTtyZXR1cm4gYTt9O2V4cG9ydHMuZmx1c2hTeW5jID0gZnVuY3Rpb24gKGEpIHtyZXR1cm4gU2soYSk7fTtleHBvcnRzLmh5ZHJhdGUgPSBmdW5jdGlvbiAoYSwgYiwgYykge2lmICghcGwoYikpIHRocm93IEVycm9yKHAoMjAwKSk7cmV0dXJuIHNsKG51bGwsIGEsIGIsICEwLCBjKTt9OwogICAgICAgICAgZXhwb3J0cy5oeWRyYXRlUm9vdCA9IGZ1bmN0aW9uIChhLCBiLCBjKSB7aWYgKCFvbChhKSkgdGhyb3cgRXJyb3IocCg0MDUpKTt2YXIgZCA9IG51bGwgIT0gYyAmJiBjLmh5ZHJhdGVkU291cmNlcyB8fCBudWxsLGUgPSAhMSxmID0gIiIsZyA9IGxsO251bGwgIT09IGMgJiYgdm9pZCAwICE9PSBjICYmICghMCA9PT0gYy51bnN0YWJsZV9zdHJpY3RNb2RlICYmIChlID0gITApLCB2b2lkIDAgIT09IGMuaWRlbnRpZmllclByZWZpeCAmJiAoZiA9IGMuaWRlbnRpZmllclByZWZpeCksIHZvaWQgMCAhPT0gYy5vblJlY292ZXJhYmxlRXJyb3IgJiYgKGcgPSBjLm9uUmVjb3ZlcmFibGVFcnJvcikpO2IgPSBmbChiLCBudWxsLCBhLCAxLCBudWxsICE9IGMgPyBjIDogbnVsbCwgZSwgITEsIGYsIGcpO2FbdWZdID0gYi5jdXJyZW50O3NmKGEpO2lmIChkKSBmb3IgKGEgPSAwOyBhIDwgZC5sZW5ndGg7IGErKykge2MgPSBkW2FdLCBlID0gYy5fZ2V0VmVyc2lvbiwgZSA9IGUoYy5fc291cmNlKSwgbnVsbCA9PSBiLm11dGFibGVTb3VyY2VFYWdlckh5ZHJhdGlvbkRhdGEgPyBiLm11dGFibGVTb3VyY2VFYWdlckh5ZHJhdGlvbkRhdGEgPSBbYywgZV0gOiBiLm11dGFibGVTb3VyY2VFYWdlckh5ZHJhdGlvbkRhdGEucHVzaChjLAogICAgICAgICAgICAgIGUpO31yZXR1cm4gbmV3IG5sKGIpO307ZXhwb3J0cy5yZW5kZXIgPSBmdW5jdGlvbiAoYSwgYiwgYykge2lmICghcGwoYikpIHRocm93IEVycm9yKHAoMjAwKSk7cmV0dXJuIHNsKG51bGwsIGEsIGIsICExLCBjKTt9O2V4cG9ydHMudW5tb3VudENvbXBvbmVudEF0Tm9kZSA9IGZ1bmN0aW9uIChhKSB7aWYgKCFwbChhKSkgdGhyb3cgRXJyb3IocCg0MCkpO3JldHVybiBhLl9yZWFjdFJvb3RDb250YWluZXIgPyAoU2soZnVuY3Rpb24gKCkge3NsKG51bGwsIG51bGwsIGEsICExLCBmdW5jdGlvbiAoKSB7YS5fcmVhY3RSb290Q29udGFpbmVyID0gbnVsbDthW3VmXSA9IG51bGw7fSk7fSksICEwKSA6ICExO307ZXhwb3J0cy51bnN0YWJsZV9iYXRjaGVkVXBkYXRlcyA9IFJrOwogICAgICAgICAgZXhwb3J0cy51bnN0YWJsZV9yZW5kZXJTdWJ0cmVlSW50b0NvbnRhaW5lciA9IGZ1bmN0aW9uIChhLCBiLCBjLCBkKSB7aWYgKCFwbChjKSkgdGhyb3cgRXJyb3IocCgyMDApKTtpZiAobnVsbCA9PSBhIHx8IHZvaWQgMCA9PT0gYS5fcmVhY3RJbnRlcm5hbHMpIHRocm93IEVycm9yKHAoMzgpKTtyZXR1cm4gc2woYSwgYiwgYywgITEsIGQpO307ZXhwb3J0cy52ZXJzaW9uID0gIjE4LjIuMC1uZXh0LTllM2I3NzJiOC0yMDIyMDYwOCI7CgoKICAgICAgICAgIC8qKiovfSwKCiAgICAgICAgLyoqKi83NDU6CiAgICAgICAgLyoqKi8oX191bnVzZWRfd2VicGFja19tb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pID0+IHsKCiAgICAgICAgICB2YXIgX193ZWJwYWNrX3VudXNlZF9leHBvcnRfXzsKCgogICAgICAgICAgdmFyIG0gPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDkzNSk7CiAgICAgICAgICBpZiAodHJ1ZSkgewogICAgICAgICAgICBleHBvcnRzLnMgPSBtLmNyZWF0ZVJvb3Q7CiAgICAgICAgICAgIF9fd2VicGFja191bnVzZWRfZXhwb3J0X18gPSBtLmh5ZHJhdGVSb290OwogICAgICAgICAgfSBlbHNlIHt2YXIgaTt9CgoKICAgICAgICAgIC8qKiovfSwKCiAgICAgICAgLyoqKi85MzU6CiAgICAgICAgLyoqKi8obW9kdWxlLCBfX3VudXNlZF93ZWJwYWNrX2V4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pID0+IHsKCgoKICAgICAgICAgIGZ1bmN0aW9uIGNoZWNrRENFKCkgewogICAgICAgICAgICAvKiBnbG9iYWwgX19SRUFDVF9ERVZUT09MU19HTE9CQUxfSE9PS19fICovCiAgICAgICAgICAgIGlmICgKICAgICAgICAgICAgdHlwZW9mIF9fUkVBQ1RfREVWVE9PTFNfR0xPQkFMX0hPT0tfXyA9PT0gJ3VuZGVmaW5lZCcgfHwKICAgICAgICAgICAgdHlwZW9mIF9fUkVBQ1RfREVWVE9PTFNfR0xPQkFMX0hPT0tfXy5jaGVja0RDRSAhPT0gJ2Z1bmN0aW9uJykKICAgICAgICAgICAgewogICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoZmFsc2UpIHt9CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgLy8gVmVyaWZ5IHRoYXQgdGhlIGNvZGUgYWJvdmUgaGFzIGJlZW4gZGVhZCBjb2RlIGVsaW1pbmF0ZWQgKERDRSdkKS4KICAgICAgICAgICAgICBfX1JFQUNUX0RFVlRPT0xTX0dMT0JBTF9IT09LX18uY2hlY2tEQ0UoY2hlY2tEQ0UpOwogICAgICAgICAgICB9IGNhdGNoIChlcnIpIHsKICAgICAgICAgICAgICAvLyBEZXZUb29scyBzaG91bGRuJ3QgY3Jhc2ggUmVhY3QsIG5vIG1hdHRlciB3aGF0LgogICAgICAgICAgICAgIC8vIFdlIHNob3VsZCBzdGlsbCByZXBvcnQgaW4gY2FzZSB3ZSBicmVhayB0aGlzIGNvZGUuCiAgICAgICAgICAgICAgY29uc29sZS5lcnJvcihlcnIpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKHRydWUpIHsKICAgICAgICAgICAgLy8gRENFIGNoZWNrIHNob3VsZCBoYXBwZW4gYmVmb3JlIFJlYWN0RE9NIGJ1bmRsZSBleGVjdXRlcyBzbyB0aGF0CiAgICAgICAgICAgIC8vIERldlRvb2xzIGNhbiByZXBvcnQgYmFkIG1pbmlmaWNhdGlvbiBkdXJpbmcgaW5qZWN0aW9uLgogICAgICAgICAgICBjaGVja0RDRSgpOwogICAgICAgICAgICBtb2R1bGUuZXhwb3J0cyA9IF9fd2VicGFja19yZXF1aXJlX18oNDQ4KTsKICAgICAgICAgIH0gZWxzZSB7fQoKCiAgICAgICAgICAvKioqL30sCgogICAgICAgIC8qKiovNDA4OgogICAgICAgIC8qKiovKF9fdW51c2VkX3dlYnBhY2tfbW9kdWxlLCBleHBvcnRzKSA9PiB7CgogICAgICAgICAgLyoqCiAgICAgICAgICAgKiBAbGljZW5zZSBSZWFjdAogICAgICAgICAgICogcmVhY3QucHJvZHVjdGlvbi5taW4uanMKICAgICAgICAgICAqCiAgICAgICAgICAgKiBDb3B5cmlnaHQgKGMpIEZhY2Vib29rLCBJbmMuIGFuZCBpdHMgYWZmaWxpYXRlcy4KICAgICAgICAgICAqCiAgICAgICAgICAgKiBUaGlzIHNvdXJjZSBjb2RlIGlzIGxpY2Vuc2VkIHVuZGVyIHRoZSBNSVQgbGljZW5zZSBmb3VuZCBpbiB0aGUKICAgICAgICAgICAqIExJQ0VOU0UgZmlsZSBpbiB0aGUgcm9vdCBkaXJlY3Rvcnkgb2YgdGhpcyBzb3VyY2UgdHJlZS4KICAgICAgICAgICAqLwogICAgICAgICAgdmFyIGwgPSBTeW1ib2wuZm9yKCJyZWFjdC5lbGVtZW50IiksbiA9IFN5bWJvbC5mb3IoInJlYWN0LnBvcnRhbCIpLHAgPSBTeW1ib2wuZm9yKCJyZWFjdC5mcmFnbWVudCIpLHEgPSBTeW1ib2wuZm9yKCJyZWFjdC5zdHJpY3RfbW9kZSIpLHIgPSBTeW1ib2wuZm9yKCJyZWFjdC5wcm9maWxlciIpLHQgPSBTeW1ib2wuZm9yKCJyZWFjdC5wcm92aWRlciIpLHUgPSBTeW1ib2wuZm9yKCJyZWFjdC5jb250ZXh0IiksdiA9IFN5bWJvbC5mb3IoInJlYWN0LmZvcndhcmRfcmVmIiksdyA9IFN5bWJvbC5mb3IoInJlYWN0LnN1c3BlbnNlIikseCA9IFN5bWJvbC5mb3IoInJlYWN0Lm1lbW8iKSx5ID0gU3ltYm9sLmZvcigicmVhY3QubGF6eSIpLHogPSBTeW1ib2wuaXRlcmF0b3I7ZnVuY3Rpb24gQShhKSB7aWYgKG51bGwgPT09IGEgfHwgIm9iamVjdCIgIT09IHR5cGVvZiBhKSByZXR1cm4gbnVsbDthID0geiAmJiBhW3pdIHx8IGFbIkBAaXRlcmF0b3IiXTtyZXR1cm4gImZ1bmN0aW9uIiA9PT0gdHlwZW9mIGEgPyBhIDogbnVsbDt9CiAgICAgICAgICB2YXIgQiA9IHsgaXNNb3VudGVkOiBmdW5jdGlvbiBpc01vdW50ZWQoKSB7cmV0dXJuICExO30sIGVucXVldWVGb3JjZVVwZGF0ZTogZnVuY3Rpb24gZW5xdWV1ZUZvcmNlVXBkYXRlKCkge30sIGVucXVldWVSZXBsYWNlU3RhdGU6IGZ1bmN0aW9uIGVucXVldWVSZXBsYWNlU3RhdGUoKSB7fSwgZW5xdWV1ZVNldFN0YXRlOiBmdW5jdGlvbiBlbnF1ZXVlU2V0U3RhdGUoKSB7fSB9LEMgPSBPYmplY3QuYXNzaWduLEQgPSB7fTtmdW5jdGlvbiBFKGEsIGIsIGUpIHt0aGlzLnByb3BzID0gYTt0aGlzLmNvbnRleHQgPSBiO3RoaXMucmVmcyA9IEQ7dGhpcy51cGRhdGVyID0gZSB8fCBCO31FLnByb3RvdHlwZS5pc1JlYWN0Q29tcG9uZW50ID0ge307CiAgICAgICAgICBFLnByb3RvdHlwZS5zZXRTdGF0ZSA9IGZ1bmN0aW9uIChhLCBiKSB7aWYgKCJvYmplY3QiICE9PSB0eXBlb2YgYSAmJiAiZnVuY3Rpb24iICE9PSB0eXBlb2YgYSAmJiBudWxsICE9IGEpIHRocm93IEVycm9yKCJzZXRTdGF0ZSguLi4pOiB0YWtlcyBhbiBvYmplY3Qgb2Ygc3RhdGUgdmFyaWFibGVzIHRvIHVwZGF0ZSBvciBhIGZ1bmN0aW9uIHdoaWNoIHJldHVybnMgYW4gb2JqZWN0IG9mIHN0YXRlIHZhcmlhYmxlcy4iKTt0aGlzLnVwZGF0ZXIuZW5xdWV1ZVNldFN0YXRlKHRoaXMsIGEsIGIsICJzZXRTdGF0ZSIpO307RS5wcm90b3R5cGUuZm9yY2VVcGRhdGUgPSBmdW5jdGlvbiAoYSkge3RoaXMudXBkYXRlci5lbnF1ZXVlRm9yY2VVcGRhdGUodGhpcywgYSwgImZvcmNlVXBkYXRlIik7fTtmdW5jdGlvbiBGKCkge31GLnByb3RvdHlwZSA9IEUucHJvdG90eXBlO2Z1bmN0aW9uIEcoYSwgYiwgZSkge3RoaXMucHJvcHMgPSBhO3RoaXMuY29udGV4dCA9IGI7dGhpcy5yZWZzID0gRDt0aGlzLnVwZGF0ZXIgPSBlIHx8IEI7fXZhciBIID0gRy5wcm90b3R5cGUgPSBuZXcgRigpOwogICAgICAgICAgSC5jb25zdHJ1Y3RvciA9IEc7QyhILCBFLnByb3RvdHlwZSk7SC5pc1B1cmVSZWFjdENvbXBvbmVudCA9ICEwO3ZhciBJID0gQXJyYXkuaXNBcnJheSxKID0gT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eSxLID0geyBjdXJyZW50OiBudWxsIH0sTCA9IHsga2V5OiAhMCwgcmVmOiAhMCwgX19zZWxmOiAhMCwgX19zb3VyY2U6ICEwIH07CiAgICAgICAgICBmdW5jdGlvbiBNKGEsIGIsIGUpIHt2YXIgZCxjID0ge30sayA9IG51bGwsaCA9IG51bGw7aWYgKG51bGwgIT0gYikgZm9yIChkIGluIHZvaWQgMCAhPT0gYi5yZWYgJiYgKGggPSBiLnJlZiksIHZvaWQgMCAhPT0gYi5rZXkgJiYgKGsgPSAiIiArIGIua2V5KSwgYikge0ouY2FsbChiLCBkKSAmJiAhTC5oYXNPd25Qcm9wZXJ0eShkKSAmJiAoY1tkXSA9IGJbZF0pO312YXIgZyA9IGFyZ3VtZW50cy5sZW5ndGggLSAyO2lmICgxID09PSBnKSBjLmNoaWxkcmVuID0gZTtlbHNlIGlmICgxIDwgZykge2ZvciAodmFyIGYgPSBBcnJheShnKSwgbSA9IDA7IG0gPCBnOyBtKyspIHtmW21dID0gYXJndW1lbnRzW20gKyAyXTt9Yy5jaGlsZHJlbiA9IGY7fWlmIChhICYmIGEuZGVmYXVsdFByb3BzKSBmb3IgKGQgaW4gZyA9IGEuZGVmYXVsdFByb3BzLCBnKSB7dm9pZCAwID09PSBjW2RdICYmIChjW2RdID0gZ1tkXSk7fXJldHVybiB7ICQkdHlwZW9mOiBsLCB0eXBlOiBhLCBrZXk6IGssIHJlZjogaCwgcHJvcHM6IGMsIF9vd25lcjogSy5jdXJyZW50IH07fQogICAgICAgICAgZnVuY3Rpb24gTihhLCBiKSB7cmV0dXJuIHsgJCR0eXBlb2Y6IGwsIHR5cGU6IGEudHlwZSwga2V5OiBiLCByZWY6IGEucmVmLCBwcm9wczogYS5wcm9wcywgX293bmVyOiBhLl9vd25lciB9O31mdW5jdGlvbiBPKGEpIHtyZXR1cm4gIm9iamVjdCIgPT09IHR5cGVvZiBhICYmIG51bGwgIT09IGEgJiYgYS4kJHR5cGVvZiA9PT0gbDt9ZnVuY3Rpb24gZXNjYXBlKGEpIHt2YXIgYiA9IHsgIj0iOiAiPTAiLCAiOiI6ICI9MiIgfTtyZXR1cm4gIiQiICsgYS5yZXBsYWNlKC9bPTpdL2csIGZ1bmN0aW9uIChhKSB7cmV0dXJuIGJbYV07fSk7fXZhciBQID0gL1wvKy9nO2Z1bmN0aW9uIFEoYSwgYikge3JldHVybiAib2JqZWN0IiA9PT0gdHlwZW9mIGEgJiYgbnVsbCAhPT0gYSAmJiBudWxsICE9IGEua2V5ID8gZXNjYXBlKCIiICsgYS5rZXkpIDogYi50b1N0cmluZygzNik7fQogICAgICAgICAgZnVuY3Rpb24gUihhLCBiLCBlLCBkLCBjKSB7dmFyIGsgPSB0eXBlb2YgYTtpZiAoInVuZGVmaW5lZCIgPT09IGsgfHwgImJvb2xlYW4iID09PSBrKSBhID0gbnVsbDt2YXIgaCA9ICExO2lmIChudWxsID09PSBhKSBoID0gITA7ZWxzZSBzd2l0Y2ggKGspIHtjYXNlICJzdHJpbmciOmNhc2UgIm51bWJlciI6aCA9ICEwO2JyZWFrO2Nhc2UgIm9iamVjdCI6c3dpdGNoIChhLiQkdHlwZW9mKSB7Y2FzZSBsOmNhc2UgbjpoID0gITA7fX1pZiAoaCkgcmV0dXJuIGggPSBhLCBjID0gYyhoKSwgYSA9ICIiID09PSBkID8gIi4iICsgUShoLCAwKSA6IGQsIEkoYykgPyAoZSA9ICIiLCBudWxsICE9IGEgJiYgKGUgPSBhLnJlcGxhY2UoUCwgIiQmLyIpICsgIi8iKSwgUihjLCBiLCBlLCAiIiwgZnVuY3Rpb24gKGEpIHtyZXR1cm4gYTt9KSkgOiBudWxsICE9IGMgJiYgKE8oYykgJiYgKGMgPSBOKGMsIGUgKyAoIWMua2V5IHx8IGggJiYgaC5rZXkgPT09IGMua2V5ID8gIiIgOiAoIiIgKyBjLmtleSkucmVwbGFjZShQLCAiJCYvIikgKyAiLyIpICsgYSkpLCBiLnB1c2goYykpLCAxO2ggPSAwO2QgPSAiIiA9PT0gZCA/ICIuIiA6IGQgKyAiOiI7aWYgKEkoYSkpIGZvciAodmFyIGcgPSAwOyBnIDwgYS5sZW5ndGg7IGcrKykge2sgPQogICAgICAgICAgICAgIGFbZ107dmFyIGYgPSBkICsgUShrLCBnKTtoICs9IFIoaywgYiwgZSwgZiwgYyk7fSBlbHNlIGlmIChmID0gQShhKSwgImZ1bmN0aW9uIiA9PT0gdHlwZW9mIGYpIGZvciAoYSA9IGYuY2FsbChhKSwgZyA9IDA7ICEoayA9IGEubmV4dCgpKS5kb25lOykge2sgPSBrLnZhbHVlLCBmID0gZCArIFEoaywgZysrKSwgaCArPSBSKGssIGIsIGUsIGYsIGMpO30gZWxzZSBpZiAoIm9iamVjdCIgPT09IGspIHRocm93IGIgPSBTdHJpbmcoYSksIEVycm9yKCJPYmplY3RzIGFyZSBub3QgdmFsaWQgYXMgYSBSZWFjdCBjaGlsZCAoZm91bmQ6ICIgKyAoIltvYmplY3QgT2JqZWN0XSIgPT09IGIgPyAib2JqZWN0IHdpdGgga2V5cyB7IiArIE9iamVjdC5rZXlzKGEpLmpvaW4oIiwgIikgKyAifSIgOiBiKSArICIpLiBJZiB5b3UgbWVhbnQgdG8gcmVuZGVyIGEgY29sbGVjdGlvbiBvZiBjaGlsZHJlbiwgdXNlIGFuIGFycmF5IGluc3RlYWQuIik7cmV0dXJuIGg7fQogICAgICAgICAgZnVuY3Rpb24gUyhhLCBiLCBlKSB7aWYgKG51bGwgPT0gYSkgcmV0dXJuIGE7dmFyIGQgPSBbXSxjID0gMDtSKGEsIGQsICIiLCAiIiwgZnVuY3Rpb24gKGEpIHtyZXR1cm4gYi5jYWxsKGUsIGEsIGMrKyk7fSk7cmV0dXJuIGQ7fWZ1bmN0aW9uIFQoYSkge2lmICgtMSA9PT0gYS5fc3RhdHVzKSB7dmFyIGIgPSBhLl9yZXN1bHQ7YiA9IGIoKTtiLnRoZW4oZnVuY3Rpb24gKGIpIHtpZiAoMCA9PT0gYS5fc3RhdHVzIHx8IC0xID09PSBhLl9zdGF0dXMpIGEuX3N0YXR1cyA9IDEsIGEuX3Jlc3VsdCA9IGI7fSwgZnVuY3Rpb24gKGIpIHtpZiAoMCA9PT0gYS5fc3RhdHVzIHx8IC0xID09PSBhLl9zdGF0dXMpIGEuX3N0YXR1cyA9IDIsIGEuX3Jlc3VsdCA9IGI7fSk7LTEgPT09IGEuX3N0YXR1cyAmJiAoYS5fc3RhdHVzID0gMCwgYS5fcmVzdWx0ID0gYik7fWlmICgxID09PSBhLl9zdGF0dXMpIHJldHVybiBhLl9yZXN1bHQuZGVmYXVsdDt0aHJvdyBhLl9yZXN1bHQ7fQogICAgICAgICAgdmFyIFUgPSB7IGN1cnJlbnQ6IG51bGwgfSxWID0geyB0cmFuc2l0aW9uOiBudWxsIH0sVyA9IHsgUmVhY3RDdXJyZW50RGlzcGF0Y2hlcjogVSwgUmVhY3RDdXJyZW50QmF0Y2hDb25maWc6IFYsIFJlYWN0Q3VycmVudE93bmVyOiBLIH07ZXhwb3J0cy5DaGlsZHJlbiA9IHsgbWFwOiBTLCBmb3JFYWNoOiBmdW5jdGlvbiBmb3JFYWNoKGEsIGIsIGUpIHtTKGEsIGZ1bmN0aW9uICgpIHtiLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7fSwgZSk7fSwgY291bnQ6IGZ1bmN0aW9uIGNvdW50KGEpIHt2YXIgYiA9IDA7UyhhLCBmdW5jdGlvbiAoKSB7YisrO30pO3JldHVybiBiO30sIHRvQXJyYXk6IGZ1bmN0aW9uIHRvQXJyYXkoYSkge3JldHVybiBTKGEsIGZ1bmN0aW9uIChhKSB7cmV0dXJuIGE7fSkgfHwgW107fSwgb25seTogZnVuY3Rpb24gb25seShhKSB7aWYgKCFPKGEpKSB0aHJvdyBFcnJvcigiUmVhY3QuQ2hpbGRyZW4ub25seSBleHBlY3RlZCB0byByZWNlaXZlIGEgc2luZ2xlIFJlYWN0IGVsZW1lbnQgY2hpbGQuIik7cmV0dXJuIGE7fSB9O2V4cG9ydHMuQ29tcG9uZW50ID0gRTtleHBvcnRzLkZyYWdtZW50ID0gcDsKICAgICAgICAgIGV4cG9ydHMuUHJvZmlsZXIgPSByO2V4cG9ydHMuUHVyZUNvbXBvbmVudCA9IEc7ZXhwb3J0cy5TdHJpY3RNb2RlID0gcTtleHBvcnRzLlN1c3BlbnNlID0gdztleHBvcnRzLl9fU0VDUkVUX0lOVEVSTkFMU19ET19OT1RfVVNFX09SX1lPVV9XSUxMX0JFX0ZJUkVEID0gVzsKICAgICAgICAgIGV4cG9ydHMuY2xvbmVFbGVtZW50ID0gZnVuY3Rpb24gKGEsIGIsIGUpIHtpZiAobnVsbCA9PT0gYSB8fCB2b2lkIDAgPT09IGEpIHRocm93IEVycm9yKCJSZWFjdC5jbG9uZUVsZW1lbnQoLi4uKTogVGhlIGFyZ3VtZW50IG11c3QgYmUgYSBSZWFjdCBlbGVtZW50LCBidXQgeW91IHBhc3NlZCAiICsgYSArICIuIik7dmFyIGQgPSBDKHt9LCBhLnByb3BzKSxjID0gYS5rZXksayA9IGEucmVmLGggPSBhLl9vd25lcjtpZiAobnVsbCAhPSBiKSB7dm9pZCAwICE9PSBiLnJlZiAmJiAoayA9IGIucmVmLCBoID0gSy5jdXJyZW50KTt2b2lkIDAgIT09IGIua2V5ICYmIChjID0gIiIgKyBiLmtleSk7aWYgKGEudHlwZSAmJiBhLnR5cGUuZGVmYXVsdFByb3BzKSB2YXIgZyA9IGEudHlwZS5kZWZhdWx0UHJvcHM7Zm9yIChmIGluIGIpIHtKLmNhbGwoYiwgZikgJiYgIUwuaGFzT3duUHJvcGVydHkoZikgJiYgKGRbZl0gPSB2b2lkIDAgPT09IGJbZl0gJiYgdm9pZCAwICE9PSBnID8gZ1tmXSA6IGJbZl0pO319dmFyIGYgPSBhcmd1bWVudHMubGVuZ3RoIC0gMjtpZiAoMSA9PT0gZikgZC5jaGlsZHJlbiA9IGU7ZWxzZSBpZiAoMSA8IGYpIHtnID0gQXJyYXkoZik7CiAgICAgICAgICAgICAgZm9yICh2YXIgbSA9IDA7IG0gPCBmOyBtKyspIHtnW21dID0gYXJndW1lbnRzW20gKyAyXTt9ZC5jaGlsZHJlbiA9IGc7fXJldHVybiB7ICQkdHlwZW9mOiBsLCB0eXBlOiBhLnR5cGUsIGtleTogYywgcmVmOiBrLCBwcm9wczogZCwgX293bmVyOiBoIH07fTtleHBvcnRzLmNyZWF0ZUNvbnRleHQgPSBmdW5jdGlvbiAoYSkge2EgPSB7ICQkdHlwZW9mOiB1LCBfY3VycmVudFZhbHVlOiBhLCBfY3VycmVudFZhbHVlMjogYSwgX3RocmVhZENvdW50OiAwLCBQcm92aWRlcjogbnVsbCwgQ29uc3VtZXI6IG51bGwsIF9kZWZhdWx0VmFsdWU6IG51bGwsIF9nbG9iYWxOYW1lOiBudWxsIH07YS5Qcm92aWRlciA9IHsgJCR0eXBlb2Y6IHQsIF9jb250ZXh0OiBhIH07cmV0dXJuIGEuQ29uc3VtZXIgPSBhO307ZXhwb3J0cy5jcmVhdGVFbGVtZW50ID0gTTtleHBvcnRzLmNyZWF0ZUZhY3RvcnkgPSBmdW5jdGlvbiAoYSkge3ZhciBiID0gTS5iaW5kKG51bGwsIGEpO2IudHlwZSA9IGE7cmV0dXJuIGI7fTtleHBvcnRzLmNyZWF0ZVJlZiA9IGZ1bmN0aW9uICgpIHtyZXR1cm4geyBjdXJyZW50OiBudWxsIH07fTsKICAgICAgICAgIGV4cG9ydHMuZm9yd2FyZFJlZiA9IGZ1bmN0aW9uIChhKSB7cmV0dXJuIHsgJCR0eXBlb2Y6IHYsIHJlbmRlcjogYSB9O307ZXhwb3J0cy5pc1ZhbGlkRWxlbWVudCA9IE87ZXhwb3J0cy5sYXp5ID0gZnVuY3Rpb24gKGEpIHtyZXR1cm4geyAkJHR5cGVvZjogeSwgX3BheWxvYWQ6IHsgX3N0YXR1czogLTEsIF9yZXN1bHQ6IGEgfSwgX2luaXQ6IFQgfTt9O2V4cG9ydHMubWVtbyA9IGZ1bmN0aW9uIChhLCBiKSB7cmV0dXJuIHsgJCR0eXBlb2Y6IHgsIHR5cGU6IGEsIGNvbXBhcmU6IHZvaWQgMCA9PT0gYiA/IG51bGwgOiBiIH07fTtleHBvcnRzLnN0YXJ0VHJhbnNpdGlvbiA9IGZ1bmN0aW9uIChhKSB7dmFyIGIgPSBWLnRyYW5zaXRpb247Vi50cmFuc2l0aW9uID0ge307dHJ5IHthKCk7fSBmaW5hbGx5IHtWLnRyYW5zaXRpb24gPSBiO319O2V4cG9ydHMudW5zdGFibGVfYWN0ID0gZnVuY3Rpb24gKCkge3Rocm93IEVycm9yKCJhY3QoLi4uKSBpcyBub3Qgc3VwcG9ydGVkIGluIHByb2R1Y3Rpb24gYnVpbGRzIG9mIFJlYWN0LiIpO307CiAgICAgICAgICBleHBvcnRzLnVzZUNhbGxiYWNrID0gZnVuY3Rpb24gKGEsIGIpIHtyZXR1cm4gVS5jdXJyZW50LnVzZUNhbGxiYWNrKGEsIGIpO307ZXhwb3J0cy51c2VDb250ZXh0ID0gZnVuY3Rpb24gKGEpIHtyZXR1cm4gVS5jdXJyZW50LnVzZUNvbnRleHQoYSk7fTtleHBvcnRzLnVzZURlYnVnVmFsdWUgPSBmdW5jdGlvbiAoKSB7fTtleHBvcnRzLnVzZURlZmVycmVkVmFsdWUgPSBmdW5jdGlvbiAoYSkge3JldHVybiBVLmN1cnJlbnQudXNlRGVmZXJyZWRWYWx1ZShhKTt9O2V4cG9ydHMudXNlRWZmZWN0ID0gZnVuY3Rpb24gKGEsIGIpIHtyZXR1cm4gVS5jdXJyZW50LnVzZUVmZmVjdChhLCBiKTt9O2V4cG9ydHMudXNlSWQgPSBmdW5jdGlvbiAoKSB7cmV0dXJuIFUuY3VycmVudC51c2VJZCgpO307ZXhwb3J0cy51c2VJbXBlcmF0aXZlSGFuZGxlID0gZnVuY3Rpb24gKGEsIGIsIGUpIHtyZXR1cm4gVS5jdXJyZW50LnVzZUltcGVyYXRpdmVIYW5kbGUoYSwgYiwgZSk7fTsKICAgICAgICAgIGV4cG9ydHMudXNlSW5zZXJ0aW9uRWZmZWN0ID0gZnVuY3Rpb24gKGEsIGIpIHtyZXR1cm4gVS5jdXJyZW50LnVzZUluc2VydGlvbkVmZmVjdChhLCBiKTt9O2V4cG9ydHMudXNlTGF5b3V0RWZmZWN0ID0gZnVuY3Rpb24gKGEsIGIpIHtyZXR1cm4gVS5jdXJyZW50LnVzZUxheW91dEVmZmVjdChhLCBiKTt9O2V4cG9ydHMudXNlTWVtbyA9IGZ1bmN0aW9uIChhLCBiKSB7cmV0dXJuIFUuY3VycmVudC51c2VNZW1vKGEsIGIpO307ZXhwb3J0cy51c2VSZWR1Y2VyID0gZnVuY3Rpb24gKGEsIGIsIGUpIHtyZXR1cm4gVS5jdXJyZW50LnVzZVJlZHVjZXIoYSwgYiwgZSk7fTtleHBvcnRzLnVzZVJlZiA9IGZ1bmN0aW9uIChhKSB7cmV0dXJuIFUuY3VycmVudC51c2VSZWYoYSk7fTtleHBvcnRzLnVzZVN0YXRlID0gZnVuY3Rpb24gKGEpIHtyZXR1cm4gVS5jdXJyZW50LnVzZVN0YXRlKGEpO307ZXhwb3J0cy51c2VTeW5jRXh0ZXJuYWxTdG9yZSA9IGZ1bmN0aW9uIChhLCBiLCBlKSB7cmV0dXJuIFUuY3VycmVudC51c2VTeW5jRXh0ZXJuYWxTdG9yZShhLCBiLCBlKTt9OwogICAgICAgICAgZXhwb3J0cy51c2VUcmFuc2l0aW9uID0gZnVuY3Rpb24gKCkge3JldHVybiBVLmN1cnJlbnQudXNlVHJhbnNpdGlvbigpO307ZXhwb3J0cy52ZXJzaW9uID0gIjE4LjIuMCI7CgoKICAgICAgICAgIC8qKiovfSwKCiAgICAgICAgLyoqKi8yOTQ6CiAgICAgICAgLyoqKi8obW9kdWxlLCBfX3VudXNlZF93ZWJwYWNrX2V4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pID0+IHsKCgoKICAgICAgICAgIGlmICh0cnVlKSB7CiAgICAgICAgICAgIG1vZHVsZS5leHBvcnRzID0gX193ZWJwYWNrX3JlcXVpcmVfXyg0MDgpOwogICAgICAgICAgfSBlbHNlIHt9CgoKICAgICAgICAgIC8qKiovfSwKCiAgICAgICAgLyoqKi81MzoKICAgICAgICAvKioqLyhfX3VudXNlZF93ZWJwYWNrX21vZHVsZSwgZXhwb3J0cykgPT4gewoKICAgICAgICAgIC8qKgogICAgICAgICAgICogQGxpY2Vuc2UgUmVhY3QKICAgICAgICAgICAqIHNjaGVkdWxlci5wcm9kdWN0aW9uLm1pbi5qcwogICAgICAgICAgICoKICAgICAgICAgICAqIENvcHlyaWdodCAoYykgRmFjZWJvb2ssIEluYy4gYW5kIGl0cyBhZmZpbGlhdGVzLgogICAgICAgICAgICoKICAgICAgICAgICAqIFRoaXMgc291cmNlIGNvZGUgaXMgbGljZW5zZWQgdW5kZXIgdGhlIE1JVCBsaWNlbnNlIGZvdW5kIGluIHRoZQogICAgICAgICAgICogTElDRU5TRSBmaWxlIGluIHRoZSByb290IGRpcmVjdG9yeSBvZiB0aGlzIHNvdXJjZSB0cmVlLgogICAgICAgICAgICovCiAgICAgICAgICBmdW5jdGlvbiBmKGEsIGIpIHt2YXIgYyA9IGEubGVuZ3RoO2EucHVzaChiKTthOiBmb3IgKDsgMCA8IGM7KSB7dmFyIGQgPSBjIC0gMSA+Pj4gMSxlID0gYVtkXTtpZiAoMCA8IGcoZSwgYikpIGFbZF0gPSBiLCBhW2NdID0gZSwgYyA9IGQ7ZWxzZSBicmVhayBhO319ZnVuY3Rpb24gaChhKSB7cmV0dXJuIDAgPT09IGEubGVuZ3RoID8gbnVsbCA6IGFbMF07fWZ1bmN0aW9uIGsoYSkge2lmICgwID09PSBhLmxlbmd0aCkgcmV0dXJuIG51bGw7dmFyIGIgPSBhWzBdLGMgPSBhLnBvcCgpO2lmIChjICE9PSBiKSB7YVswXSA9IGM7YTogZm9yICh2YXIgZCA9IDAsIGUgPSBhLmxlbmd0aCwgdyA9IGUgPj4+IDE7IGQgPCB3Oykge3ZhciBtID0gMiAqIChkICsgMSkgLSAxLEMgPSBhW21dLG4gPSBtICsgMSx4ID0gYVtuXTtpZiAoMCA+IGcoQywgYykpIG4gPCBlICYmIDAgPiBnKHgsIEMpID8gKGFbZF0gPSB4LCBhW25dID0gYywgZCA9IG4pIDogKGFbZF0gPSBDLCBhW21dID0gYywgZCA9IG0pO2Vsc2UgaWYgKG4gPCBlICYmIDAgPiBnKHgsIGMpKSBhW2RdID0geCwgYVtuXSA9IGMsIGQgPSBuO2Vsc2UgYnJlYWsgYTt9fXJldHVybiBiO30KICAgICAgICAgIGZ1bmN0aW9uIGcoYSwgYikge3ZhciBjID0gYS5zb3J0SW5kZXggLSBiLnNvcnRJbmRleDtyZXR1cm4gMCAhPT0gYyA/IGMgOiBhLmlkIC0gYi5pZDt9aWYgKCJvYmplY3QiID09PSB0eXBlb2YgcGVyZm9ybWFuY2UgJiYgImZ1bmN0aW9uIiA9PT0gdHlwZW9mIHBlcmZvcm1hbmNlLm5vdykge3ZhciBsID0gcGVyZm9ybWFuY2U7ZXhwb3J0cy51bnN0YWJsZV9ub3cgPSBmdW5jdGlvbiAoKSB7cmV0dXJuIGwubm93KCk7fTt9IGVsc2Uge3ZhciBwID0gRGF0ZSxxID0gcC5ub3coKTtleHBvcnRzLnVuc3RhYmxlX25vdyA9IGZ1bmN0aW9uICgpIHtyZXR1cm4gcC5ub3coKSAtIHE7fTt9dmFyIHIgPSBbXSx0ID0gW10sdSA9IDEsdiA9IG51bGwseSA9IDMseiA9ICExLEEgPSAhMSxCID0gITEsRCA9ICJmdW5jdGlvbiIgPT09IHR5cGVvZiBzZXRUaW1lb3V0ID8gc2V0VGltZW91dCA6IG51bGwsRSA9ICJmdW5jdGlvbiIgPT09IHR5cGVvZiBjbGVhclRpbWVvdXQgPyBjbGVhclRpbWVvdXQgOiBudWxsLEYgPSAidW5kZWZpbmVkIiAhPT0gdHlwZW9mIHNldEltbWVkaWF0ZSA/IHNldEltbWVkaWF0ZSA6IG51bGw7CiAgICAgICAgICAidW5kZWZpbmVkIiAhPT0gdHlwZW9mIG5hdmlnYXRvciAmJiB2b2lkIDAgIT09IG5hdmlnYXRvci5zY2hlZHVsaW5nICYmIHZvaWQgMCAhPT0gbmF2aWdhdG9yLnNjaGVkdWxpbmcuaXNJbnB1dFBlbmRpbmcgJiYgbmF2aWdhdG9yLnNjaGVkdWxpbmcuaXNJbnB1dFBlbmRpbmcuYmluZChuYXZpZ2F0b3Iuc2NoZWR1bGluZyk7ZnVuY3Rpb24gRyhhKSB7Zm9yICh2YXIgYiA9IGgodCk7IG51bGwgIT09IGI7KSB7aWYgKG51bGwgPT09IGIuY2FsbGJhY2spIGsodCk7ZWxzZSBpZiAoYi5zdGFydFRpbWUgPD0gYSkgayh0KSwgYi5zb3J0SW5kZXggPSBiLmV4cGlyYXRpb25UaW1lLCBmKHIsIGIpO2Vsc2UgYnJlYWs7YiA9IGgodCk7fX1mdW5jdGlvbiBIKGEpIHtCID0gITE7RyhhKTtpZiAoIUEpIGlmIChudWxsICE9PSBoKHIpKSBBID0gITAsIEkoSik7ZWxzZSB7dmFyIGIgPSBoKHQpO251bGwgIT09IGIgJiYgSyhILCBiLnN0YXJ0VGltZSAtIGEpO319CiAgICAgICAgICBmdW5jdGlvbiBKKGEsIGIpIHtBID0gITE7QiAmJiAoQiA9ICExLCBFKEwpLCBMID0gLTEpO3ogPSAhMDt2YXIgYyA9IHk7dHJ5IHtHKGIpO2ZvciAodiA9IGgocik7IG51bGwgIT09IHYgJiYgKCEodi5leHBpcmF0aW9uVGltZSA+IGIpIHx8IGEgJiYgIU0oKSk7KSB7dmFyIGQgPSB2LmNhbGxiYWNrO2lmICgiZnVuY3Rpb24iID09PSB0eXBlb2YgZCkge3YuY2FsbGJhY2sgPSBudWxsO3kgPSB2LnByaW9yaXR5TGV2ZWw7dmFyIGUgPSBkKHYuZXhwaXJhdGlvblRpbWUgPD0gYik7YiA9IGV4cG9ydHMudW5zdGFibGVfbm93KCk7ImZ1bmN0aW9uIiA9PT0gdHlwZW9mIGUgPyB2LmNhbGxiYWNrID0gZSA6IHYgPT09IGgocikgJiYgayhyKTtHKGIpO30gZWxzZSBrKHIpO3YgPSBoKHIpO31pZiAobnVsbCAhPT0gdikgdmFyIHcgPSAhMDtlbHNlIHt2YXIgbSA9IGgodCk7bnVsbCAhPT0gbSAmJiBLKEgsIG0uc3RhcnRUaW1lIC0gYik7dyA9ICExO31yZXR1cm4gdzt9IGZpbmFsbHkge3YgPSBudWxsLCB5ID0gYywgeiA9ICExO319dmFyIE4gPSAhMSxPID0gbnVsbCxMID0gLTEsUCA9IDUsUSA9IC0xOwogICAgICAgICAgZnVuY3Rpb24gTSgpIHtyZXR1cm4gZXhwb3J0cy51bnN0YWJsZV9ub3coKSAtIFEgPCBQID8gITEgOiAhMDt9ZnVuY3Rpb24gUigpIHtpZiAobnVsbCAhPT0gTykge3ZhciBhID0gZXhwb3J0cy51bnN0YWJsZV9ub3coKTtRID0gYTt2YXIgYiA9ICEwO3RyeSB7YiA9IE8oITAsIGEpO30gZmluYWxseSB7YiA/IFMoKSA6IChOID0gITEsIE8gPSBudWxsKTt9fSBlbHNlIE4gPSAhMTt9dmFyIFM7aWYgKCJmdW5jdGlvbiIgPT09IHR5cGVvZiBGKSBTID0gZnVuY3Rpb24gUygpIHtGKFIpO307ZWxzZSBpZiAoInVuZGVmaW5lZCIgIT09IHR5cGVvZiBNZXNzYWdlQ2hhbm5lbCkge3ZhciBUID0gbmV3IE1lc3NhZ2VDaGFubmVsKCksVSA9IFQucG9ydDI7VC5wb3J0MS5vbm1lc3NhZ2UgPSBSO1MgPSBmdW5jdGlvbiBTKCkge1UucG9zdE1lc3NhZ2UobnVsbCk7fTt9IGVsc2UgUyA9IGZ1bmN0aW9uIFMoKSB7RChSLCAwKTt9O2Z1bmN0aW9uIEkoYSkge08gPSBhO04gfHwgKE4gPSAhMCwgUygpKTt9ZnVuY3Rpb24gSyhhLCBiKSB7TCA9IEQoZnVuY3Rpb24gKCkge2EoZXhwb3J0cy51bnN0YWJsZV9ub3coKSk7fSwgYik7fQogICAgICAgICAgZXhwb3J0cy51bnN0YWJsZV9JZGxlUHJpb3JpdHkgPSA1O2V4cG9ydHMudW5zdGFibGVfSW1tZWRpYXRlUHJpb3JpdHkgPSAxO2V4cG9ydHMudW5zdGFibGVfTG93UHJpb3JpdHkgPSA0O2V4cG9ydHMudW5zdGFibGVfTm9ybWFsUHJpb3JpdHkgPSAzO2V4cG9ydHMudW5zdGFibGVfUHJvZmlsaW5nID0gbnVsbDtleHBvcnRzLnVuc3RhYmxlX1VzZXJCbG9ja2luZ1ByaW9yaXR5ID0gMjtleHBvcnRzLnVuc3RhYmxlX2NhbmNlbENhbGxiYWNrID0gZnVuY3Rpb24gKGEpIHthLmNhbGxiYWNrID0gbnVsbDt9O2V4cG9ydHMudW5zdGFibGVfY29udGludWVFeGVjdXRpb24gPSBmdW5jdGlvbiAoKSB7QSB8fCB6IHx8IChBID0gITAsIEkoSikpO307CiAgICAgICAgICBleHBvcnRzLnVuc3RhYmxlX2ZvcmNlRnJhbWVSYXRlID0gZnVuY3Rpb24gKGEpIHswID4gYSB8fCAxMjUgPCBhID8gY29uc29sZS5lcnJvcigiZm9yY2VGcmFtZVJhdGUgdGFrZXMgYSBwb3NpdGl2ZSBpbnQgYmV0d2VlbiAwIGFuZCAxMjUsIGZvcmNpbmcgZnJhbWUgcmF0ZXMgaGlnaGVyIHRoYW4gMTI1IGZwcyBpcyBub3Qgc3VwcG9ydGVkIikgOiBQID0gMCA8IGEgPyBNYXRoLmZsb29yKDFFMyAvIGEpIDogNTt9O2V4cG9ydHMudW5zdGFibGVfZ2V0Q3VycmVudFByaW9yaXR5TGV2ZWwgPSBmdW5jdGlvbiAoKSB7cmV0dXJuIHk7fTtleHBvcnRzLnVuc3RhYmxlX2dldEZpcnN0Q2FsbGJhY2tOb2RlID0gZnVuY3Rpb24gKCkge3JldHVybiBoKHIpO307ZXhwb3J0cy51bnN0YWJsZV9uZXh0ID0gZnVuY3Rpb24gKGEpIHtzd2l0Y2ggKHkpIHtjYXNlIDE6Y2FzZSAyOmNhc2UgMzp2YXIgYiA9IDM7YnJlYWs7ZGVmYXVsdDpiID0geTt9dmFyIGMgPSB5O3kgPSBiO3RyeSB7cmV0dXJuIGEoKTt9IGZpbmFsbHkge3kgPSBjO319O2V4cG9ydHMudW5zdGFibGVfcGF1c2VFeGVjdXRpb24gPSBmdW5jdGlvbiAoKSB7fTsKICAgICAgICAgIGV4cG9ydHMudW5zdGFibGVfcmVxdWVzdFBhaW50ID0gZnVuY3Rpb24gKCkge307ZXhwb3J0cy51bnN0YWJsZV9ydW5XaXRoUHJpb3JpdHkgPSBmdW5jdGlvbiAoYSwgYikge3N3aXRjaCAoYSkge2Nhc2UgMTpjYXNlIDI6Y2FzZSAzOmNhc2UgNDpjYXNlIDU6YnJlYWs7ZGVmYXVsdDphID0gMzt9dmFyIGMgPSB5O3kgPSBhO3RyeSB7cmV0dXJuIGIoKTt9IGZpbmFsbHkge3kgPSBjO319OwogICAgICAgICAgZXhwb3J0cy51bnN0YWJsZV9zY2hlZHVsZUNhbGxiYWNrID0gZnVuY3Rpb24gKGEsIGIsIGMpIHt2YXIgZCA9IGV4cG9ydHMudW5zdGFibGVfbm93KCk7Im9iamVjdCIgPT09IHR5cGVvZiBjICYmIG51bGwgIT09IGMgPyAoYyA9IGMuZGVsYXksIGMgPSAibnVtYmVyIiA9PT0gdHlwZW9mIGMgJiYgMCA8IGMgPyBkICsgYyA6IGQpIDogYyA9IGQ7c3dpdGNoIChhKSB7Y2FzZSAxOnZhciBlID0gLTE7YnJlYWs7Y2FzZSAyOmUgPSAyNTA7YnJlYWs7Y2FzZSA1OmUgPSAxMDczNzQxODIzO2JyZWFrO2Nhc2UgNDplID0gMUU0O2JyZWFrO2RlZmF1bHQ6ZSA9IDVFMzt9ZSA9IGMgKyBlO2EgPSB7IGlkOiB1KyssIGNhbGxiYWNrOiBiLCBwcmlvcml0eUxldmVsOiBhLCBzdGFydFRpbWU6IGMsIGV4cGlyYXRpb25UaW1lOiBlLCBzb3J0SW5kZXg6IC0xIH07YyA+IGQgPyAoYS5zb3J0SW5kZXggPSBjLCBmKHQsIGEpLCBudWxsID09PSBoKHIpICYmIGEgPT09IGgodCkgJiYgKEIgPyAoRShMKSwgTCA9IC0xKSA6IEIgPSAhMCwgSyhILCBjIC0gZCkpKSA6IChhLnNvcnRJbmRleCA9IGUsIGYociwgYSksIEEgfHwgeiB8fCAoQSA9ICEwLCBJKEopKSk7cmV0dXJuIGE7fTsKICAgICAgICAgIGV4cG9ydHMudW5zdGFibGVfc2hvdWxkWWllbGQgPSBNO2V4cG9ydHMudW5zdGFibGVfd3JhcENhbGxiYWNrID0gZnVuY3Rpb24gKGEpIHt2YXIgYiA9IHk7cmV0dXJuIGZ1bmN0aW9uICgpIHt2YXIgYyA9IHk7eSA9IGI7dHJ5IHtyZXR1cm4gYS5hcHBseSh0aGlzLCBhcmd1bWVudHMpO30gZmluYWxseSB7eSA9IGM7fX07fTsKCgogICAgICAgICAgLyoqKi99LAoKICAgICAgICAvKioqLzg0MDoKICAgICAgICAvKioqLyhtb2R1bGUsIF9fdW51c2VkX3dlYnBhY2tfZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgPT4gewoKCgogICAgICAgICAgaWYgKHRydWUpIHsKICAgICAgICAgICAgbW9kdWxlLmV4cG9ydHMgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDUzKTsKICAgICAgICAgIH0gZWxzZSB7fQoKCiAgICAgICAgICAvKioqL30KCiAgICAgICAgLyoqKioqKi8gfTsKICAgICAgLyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi8KICAgICAgLyoqKioqKi8gLy8gVGhlIG1vZHVsZSBjYWNoZQogICAgICAvKioqKioqL3ZhciBfX3dlYnBhY2tfbW9kdWxlX2NhY2hlX18gPSB7fTsKICAgICAgLyoqKioqKi8KICAgICAgLyoqKioqKi8gLy8gVGhlIHJlcXVpcmUgZnVuY3Rpb24KICAgICAgLyoqKioqKi9mdW5jdGlvbiBfX3dlYnBhY2tfcmVxdWlyZV9fKG1vZHVsZUlkKSB7CiAgICAgICAgLyoqKioqKi8gLy8gQ2hlY2sgaWYgbW9kdWxlIGlzIGluIGNhY2hlCiAgICAgICAgLyoqKioqKi92YXIgY2FjaGVkTW9kdWxlID0gX193ZWJwYWNrX21vZHVsZV9jYWNoZV9fW21vZHVsZUlkXTsKICAgICAgICAvKioqKioqL2lmIChjYWNoZWRNb2R1bGUgIT09IHVuZGVmaW5lZCkgewogICAgICAgICAgLyoqKioqKi9yZXR1cm4gY2FjaGVkTW9kdWxlLmV4cG9ydHM7CiAgICAgICAgICAvKioqKioqL30KICAgICAgICAvKioqKioqLyAvLyBDcmVhdGUgYSBuZXcgbW9kdWxlIChhbmQgcHV0IGl0IGludG8gdGhlIGNhY2hlKQogICAgICAgIC8qKioqKiovdmFyIG1vZHVsZSA9IF9fd2VicGFja19tb2R1bGVfY2FjaGVfX1ttb2R1bGVJZF0gPSB7CiAgICAgICAgICAvKioqKioqLyAvLyBubyBtb2R1bGUuaWQgbmVlZGVkCiAgICAgICAgICAvKioqKioqLyAvLyBubyBtb2R1bGUubG9hZGVkIG5lZWRlZAogICAgICAgICAgLyoqKioqKi9leHBvcnRzOiB7fQogICAgICAgICAgLyoqKioqKi8gfTsKICAgICAgICAvKioqKioqLwogICAgICAgIC8qKioqKiovIC8vIEV4ZWN1dGUgdGhlIG1vZHVsZSBmdW5jdGlvbgogICAgICAgIC8qKioqKiovX193ZWJwYWNrX21vZHVsZXNfX1ttb2R1bGVJZF0obW9kdWxlLCBtb2R1bGUuZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXyk7CiAgICAgICAgLyoqKioqKi8KICAgICAgICAvKioqKioqLyAvLyBSZXR1cm4gdGhlIGV4cG9ydHMgb2YgdGhlIG1vZHVsZQogICAgICAgIC8qKioqKiovcmV0dXJuIG1vZHVsZS5leHBvcnRzOwogICAgICAgIC8qKioqKiovfQogICAgICAvKioqKioqLwogICAgICAvKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqLwogICAgICAvKioqKioqLyAvKiB3ZWJwYWNrL3J1bnRpbWUvY3JlYXRlIGZha2UgbmFtZXNwYWNlIG9iamVjdCAqLwogICAgICAvKioqKioqLygoKSA9PiB7CiAgICAgICAgLyoqKioqKi92YXIgZ2V0UHJvdG8gPSBPYmplY3QuZ2V0UHJvdG90eXBlT2YgPyAob2JqKSA9PiBPYmplY3QuZ2V0UHJvdG90eXBlT2Yob2JqKSA6IChvYmopID0+IG9iai5fX3Byb3RvX187CiAgICAgICAgLyoqKioqKi92YXIgbGVhZlByb3RvdHlwZXM7CiAgICAgICAgLyoqKioqKi8gLy8gY3JlYXRlIGEgZmFrZSBuYW1lc3BhY2Ugb2JqZWN0CiAgICAgICAgLyoqKioqKi8gLy8gbW9kZSAmIDE6IHZhbHVlIGlzIGEgbW9kdWxlIGlkLCByZXF1aXJlIGl0CiAgICAgICAgLyoqKioqKi8gLy8gbW9kZSAmIDI6IG1lcmdlIGFsbCBwcm9wZXJ0aWVzIG9mIHZhbHVlIGludG8gdGhlIG5zCiAgICAgICAgLyoqKioqKi8gLy8gbW9kZSAmIDQ6IHJldHVybiB2YWx1ZSB3aGVuIGFscmVhZHkgbnMgb2JqZWN0CiAgICAgICAgLyoqKioqKi8gLy8gbW9kZSAmIDE2OiByZXR1cm4gdmFsdWUgd2hlbiBpdCdzIFByb21pc2UtbGlrZQogICAgICAgIC8qKioqKiovIC8vIG1vZGUgJiA4fDE6IGJlaGF2ZSBsaWtlIHJlcXVpcmUKICAgICAgICAvKioqKioqL19fd2VicGFja19yZXF1aXJlX18udCA9IGZ1bmN0aW9uICh2YWx1ZSwgbW9kZSkgewogICAgICAgICAgLyoqKioqKi9pZiAobW9kZSAmIDEpIHZhbHVlID0gdGhpcyh2YWx1ZSk7CiAgICAgICAgICAvKioqKioqL2lmIChtb2RlICYgOCkgcmV0dXJuIHZhbHVlOwogICAgICAgICAgLyoqKioqKi9pZiAodHlwZW9mIHZhbHVlID09PSAnb2JqZWN0JyAmJiB2YWx1ZSkgewogICAgICAgICAgICAvKioqKioqL2lmIChtb2RlICYgNCAmJiB2YWx1ZS5fX2VzTW9kdWxlKSByZXR1cm4gdmFsdWU7CiAgICAgICAgICAgIC8qKioqKiovaWYgKG1vZGUgJiAxNiAmJiB0eXBlb2YgdmFsdWUudGhlbiA9PT0gJ2Z1bmN0aW9uJykgcmV0dXJuIHZhbHVlOwogICAgICAgICAgICAvKioqKioqL30KICAgICAgICAgIC8qKioqKiovdmFyIG5zID0gT2JqZWN0LmNyZWF0ZShudWxsKTsKICAgICAgICAgIC8qKioqKiovX193ZWJwYWNrX3JlcXVpcmVfXy5yKG5zKTsKICAgICAgICAgIC8qKioqKiovdmFyIGRlZiA9IHt9OwogICAgICAgICAgLyoqKioqKi9sZWFmUHJvdG90eXBlcyA9IGxlYWZQcm90b3R5cGVzIHx8IFtudWxsLCBnZXRQcm90byh7fSksIGdldFByb3RvKFtdKSwgZ2V0UHJvdG8oZ2V0UHJvdG8pXTsKICAgICAgICAgIC8qKioqKiovZm9yICh2YXIgY3VycmVudCA9IG1vZGUgJiAyICYmIHZhbHVlOyB0eXBlb2YgY3VycmVudCA9PSAnb2JqZWN0JyAmJiAhfmxlYWZQcm90b3R5cGVzLmluZGV4T2YoY3VycmVudCk7IGN1cnJlbnQgPSBnZXRQcm90byhjdXJyZW50KSkgewogICAgICAgICAgICAvKioqKioqL09iamVjdC5nZXRPd25Qcm9wZXJ0eU5hbWVzKGN1cnJlbnQpLmZvckVhY2goKGtleSkgPT4gZGVmW2tleV0gPSAoKSA9PiB2YWx1ZVtrZXldKTsKICAgICAgICAgICAgLyoqKioqKi99CiAgICAgICAgICAvKioqKioqL2RlZlsnZGVmYXVsdCddID0gKCkgPT4gdmFsdWU7CiAgICAgICAgICAvKioqKioqL19fd2VicGFja19yZXF1aXJlX18uZChucywgZGVmKTsKICAgICAgICAgIC8qKioqKiovcmV0dXJuIG5zOwogICAgICAgICAgLyoqKioqKi99OwogICAgICAgIC8qKioqKiovfSkoKTsKICAgICAgLyoqKioqKi8KICAgICAgLyoqKioqKi8gLyogd2VicGFjay9ydW50aW1lL2RlZmluZSBwcm9wZXJ0eSBnZXR0ZXJzICovCiAgICAgIC8qKioqKiovKCgpID0+IHsKICAgICAgICAvKioqKioqLyAvLyBkZWZpbmUgZ2V0dGVyIGZ1bmN0aW9ucyBmb3IgaGFybW9ueSBleHBvcnRzCiAgICAgICAgLyoqKioqKi9fX3dlYnBhY2tfcmVxdWlyZV9fLmQgPSAoZXhwb3J0cywgZGVmaW5pdGlvbikgPT4gewogICAgICAgICAgLyoqKioqKi9mb3IgKHZhciBrZXkgaW4gZGVmaW5pdGlvbikgewogICAgICAgICAgICAvKioqKioqL2lmIChfX3dlYnBhY2tfcmVxdWlyZV9fLm8oZGVmaW5pdGlvbiwga2V5KSAmJiAhX193ZWJwYWNrX3JlcXVpcmVfXy5vKGV4cG9ydHMsIGtleSkpIHsKICAgICAgICAgICAgICAvKioqKioqL09iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBrZXksIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBkZWZpbml0aW9uW2tleV0gfSk7CiAgICAgICAgICAgICAgLyoqKioqKi99CiAgICAgICAgICAgIC8qKioqKiovfQogICAgICAgICAgLyoqKioqKi99OwogICAgICAgIC8qKioqKiovfSkoKTsKICAgICAgLyoqKioqKi8KICAgICAgLyoqKioqKi8gLyogd2VicGFjay9ydW50aW1lL2hhc093blByb3BlcnR5IHNob3J0aGFuZCAqLwogICAgICAvKioqKioqLygoKSA9PiB7CiAgICAgICAgLyoqKioqKi9fX3dlYnBhY2tfcmVxdWlyZV9fLm8gPSAob2JqLCBwcm9wKSA9PiBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwob2JqLCBwcm9wKTsKICAgICAgICAvKioqKioqL30pKCk7CiAgICAgIC8qKioqKiovCiAgICAgIC8qKioqKiovIC8qIHdlYnBhY2svcnVudGltZS9tYWtlIG5hbWVzcGFjZSBvYmplY3QgKi8KICAgICAgLyoqKioqKi8oKCkgPT4gewogICAgICAgIC8qKioqKiovIC8vIGRlZmluZSBfX2VzTW9kdWxlIG9uIGV4cG9ydHMKICAgICAgICAvKioqKioqL19fd2VicGFja19yZXF1aXJlX18uciA9IChleHBvcnRzKSA9PiB7CiAgICAgICAgICAvKioqKioqL2lmICh0eXBlb2YgU3ltYm9sICE9PSAndW5kZWZpbmVkJyAmJiBTeW1ib2wudG9TdHJpbmdUYWcpIHsKICAgICAgICAgICAgLyoqKioqKi9PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgU3ltYm9sLnRvU3RyaW5nVGFnLCB7IHZhbHVlOiAnTW9kdWxlJyB9KTsKICAgICAgICAgICAgLyoqKioqKi99CiAgICAgICAgICAvKioqKioqL09iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAnX19lc01vZHVsZScsIHsgdmFsdWU6IHRydWUgfSk7CiAgICAgICAgICAvKioqKioqL307CiAgICAgICAgLyoqKioqKi99KSgpOwogICAgICAvKioqKioqLwogICAgICAvKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqLwogICAgICB2YXIgX193ZWJwYWNrX2V4cG9ydHNfXyA9IHt9OwogICAgICAvLyBUaGlzIGVudHJ5IG5lZWQgdG8gYmUgd3JhcHBlZCBpbiBhbiBJSUZFIGJlY2F1c2UgaXQgbmVlZCB0byBiZSBpc29sYXRlZCBhZ2FpbnN0IG90aGVyIG1vZHVsZXMgaW4gdGhlIGNodW5rLgogICAgICAoKCkgPT4gewogICAgICAgIF9fd2VicGFja19yZXF1aXJlX18ucihfX3dlYnBhY2tfZXhwb3J0c19fKTsKICAgICAgICAvKiBoYXJtb255IGltcG9ydCAqL3ZhciBfQXBwX19XRUJQQUNLX0lNUE9SVEVEX01PRFVMRV8wX18gPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDI0Mik7CiAgICAgICAgLyogaGFybW9ueSBpbXBvcnQgKi92YXIgcmVhY3RfZG9tX2NsaWVudF9fV0VCUEFDS19JTVBPUlRFRF9NT0RVTEVfMV9fID0gX193ZWJwYWNrX3JlcXVpcmVfXyg3NDUpOwogICAgICAgIC8qIGhhcm1vbnkgaW1wb3J0ICovdmFyIHJlYWN0X19XRUJQQUNLX0lNUE9SVEVEX01PRFVMRV8yX18gPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDI5NCk7CiAgICAgICAgZnVuY3Rpb24gX2NyZWF0ZUZvck9mSXRlcmF0b3JIZWxwZXIobywgYWxsb3dBcnJheUxpa2UpIHt2YXIgaXQgPSB0eXBlb2YgU3ltYm9sICE9PSAidW5kZWZpbmVkIiAmJiBvW1N5bWJvbC5pdGVyYXRvcl0gfHwgb1siQEBpdGVyYXRvciJdO2lmICghaXQpIHtpZiAoQXJyYXkuaXNBcnJheShvKSB8fCAoaXQgPSBfdW5zdXBwb3J0ZWRJdGVyYWJsZVRvQXJyYXkobykpIHx8IGFsbG93QXJyYXlMaWtlICYmIG8gJiYgdHlwZW9mIG8ubGVuZ3RoID09PSAibnVtYmVyIikge2lmIChpdCkgbyA9IGl0O3ZhciBpID0gMDt2YXIgRiA9IGZ1bmN0aW9uIEYoKSB7fTtyZXR1cm4geyBzOiBGLCBuOiBmdW5jdGlvbiBuKCkge2lmIChpID49IG8ubGVuZ3RoKSByZXR1cm4geyBkb25lOiB0cnVlIH07cmV0dXJuIHsgZG9uZTogZmFsc2UsIHZhbHVlOiBvW2krK10gfTt9LCBlOiBmdW5jdGlvbiBlKF9lKSB7dGhyb3cgX2U7fSwgZjogRiB9O310aHJvdyBuZXcgVHlwZUVycm9yKCJJbnZhbGlkIGF0dGVtcHQgdG8gaXRlcmF0ZSBub24taXRlcmFibGUgaW5zdGFuY2UuXG5JbiBvcmRlciB0byBiZSBpdGVyYWJsZSwgbm9uLWFycmF5IG9iamVjdHMgbXVzdCBoYXZlIGEgW1N5bWJvbC5pdGVyYXRvcl0oKSBtZXRob2QuIik7fXZhciBub3JtYWxDb21wbGV0aW9uID0gdHJ1ZSxkaWRFcnIgPSBmYWxzZSxlcnI7cmV0dXJuIHsgczogZnVuY3Rpb24gcygpIHtpdCA9IGl0LmNhbGwobyk7fSwgbjogZnVuY3Rpb24gbigpIHt2YXIgc3RlcCA9IGl0Lm5leHQoKTtub3JtYWxDb21wbGV0aW9uID0gc3RlcC5kb25lO3JldHVybiBzdGVwO30sIGU6IGZ1bmN0aW9uIGUoX2UyKSB7ZGlkRXJyID0gdHJ1ZTtlcnIgPSBfZTI7fSwgZjogZnVuY3Rpb24gZigpIHt0cnkge2lmICghbm9ybWFsQ29tcGxldGlvbiAmJiBpdFsicmV0dXJuIl0gIT0gbnVsbCkgaXRbInJldHVybiJdKCk7fSBmaW5hbGx5IHtpZiAoZGlkRXJyKSB0aHJvdyBlcnI7fX0gfTt9ZnVuY3Rpb24gX3Vuc3VwcG9ydGVkSXRlcmFibGVUb0FycmF5KG8sIG1pbkxlbikge2lmICghbykgcmV0dXJuO2lmICh0eXBlb2YgbyA9PT0gInN0cmluZyIpIHJldHVybiBfYXJyYXlMaWtlVG9BcnJheShvLCBtaW5MZW4pO3ZhciBuID0gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKG8pLnNsaWNlKDgsIC0xKTtpZiAobiA9PT0gIk9iamVjdCIgJiYgby5jb25zdHJ1Y3RvcikgbiA9IG8uY29uc3RydWN0b3IubmFtZTtpZiAobiA9PT0gIk1hcCIgfHwgbiA9PT0gIlNldCIpIHJldHVybiBBcnJheS5mcm9tKG8pO2lmIChuID09PSAiQXJndW1lbnRzIiB8fCAvXig/OlVpfEkpbnQoPzo4fDE2fDMyKSg/OkNsYW1wZWQpP0FycmF5JC8udGVzdChuKSkgcmV0dXJuIF9hcnJheUxpa2VUb0FycmF5KG8sIG1pbkxlbik7fWZ1bmN0aW9uIF9hcnJheUxpa2VUb0FycmF5KGFyciwgbGVuKSB7aWYgKGxlbiA9PSBudWxsIHx8IGxlbiA+IGFyci5sZW5ndGgpIGxlbiA9IGFyci5sZW5ndGg7Zm9yICh2YXIgaSA9IDAsIGFycjIgPSBuZXcgQXJyYXkobGVuKTsgaSA8IGxlbjsgaSsrKSB7YXJyMltpXSA9IGFycltpXTt9cmV0dXJuIGFycjI7fQoKCgoKCiAgICAgICAgZ2V0RGF0YShmdW5jdGlvbiAocGFnZXMpIHt2YXIgX2l0ZXJhdG9yID0gX2NyZWF0ZUZvck9mSXRlcmF0b3JIZWxwZXIoCiAgICAgICAgICAgIHBhZ2VzKSxfc3RlcDt0cnkge2ZvciAoX2l0ZXJhdG9yLnMoKTsgIShfc3RlcCA9IF9pdGVyYXRvci5uKCkpLmRvbmU7KSB7dmFyIHBhZ2UgPSBfc3RlcC52YWx1ZTsKICAgICAgICAgICAgICBmb3IgKHZhciBfaSA9IDAsIF9hcnIgPSBwYWdlLmNvbXBvbmVudHM7IF9pIDwgX2Fyci5sZW5ndGg7IF9pKyspIHt2YXIgY29tcG9uZW50ID0gX2FycltfaV07CiAgICAgICAgICAgICAgICBjb21wb25lbnQucHJldmlvdXNWYWx1ZSA9IGNvbXBvbmVudC52YWx1ZTsKCiAgICAgICAgICAgICAgICBpZiAoY29tcG9uZW50LnZhbGlkYXRlICE9IG51bGwpIHsKICAgICAgICAgICAgICAgICAgY29tcG9uZW50LnZhbGlkYXRlID0gZXZhbChjb21wb25lbnQudmFsaWRhdGUpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfX0gY2F0Y2ggKGVycikge19pdGVyYXRvci5lKGVycik7fSBmaW5hbGx5IHtfaXRlcmF0b3IuZigpO30KCiAgICAgICAgICB2YXIgY29udGFpbmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInJvb3QiKTsKICAgICAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tbm9uLW51bGwtYXNzZXJ0aW9uCiAgICAgICAgICB2YXIgcm9vdCA9ICgwLCByZWFjdF9kb21fY2xpZW50X19XRUJQQUNLX0lNUE9SVEVEX01PRFVMRV8xX18gLyogLmNyZWF0ZVJvb3QgKi8ucykoY29udGFpbmVyKTsKICAgICAgICAgIHJvb3QucmVuZGVyKCAvKiNfX1BVUkVfXyovcmVhY3RfX1dFQlBBQ0tfSU1QT1JURURfTU9EVUxFXzJfXy5jcmVhdGVFbGVtZW50KF9BcHBfX1dFQlBBQ0tfSU1QT1JURURfTU9EVUxFXzBfXyAvKiBbImRlZmF1bHQiXSAqLy5aLCB7IHBhZ2VzOiBwYWdlcyB9KSk7CiAgICAgICAgfSk7CiAgICAgIH0pKCk7CgogICAgICAvKioqKioqL3JldHVybiBfX3dlYnBhY2tfZXhwb3J0c19fOwogICAgICAvKioqKioqL30pKCkpOwoKfSk7";

/***/ }),

/***/ 171:
/***/ ((module) => {

module.exports = "#relayContainer{margin:1rem;font-family:Arial,Helvetica,sans-serif}#notificationsContainer{pointer-events:none;position:absolute;top:5%;left:70%;transform:translateX(-50%);z-index:999}img{display:block;margin:auto}input.stringcontainer{background-color:#fff;border-radius:5px;border:1px solid #121943;height:24px;margin:auto;display:flex;padding-left:10px}input.interrupt{width:100%;border-color:darkred;background-color:#f1948a;color:darkred;margin:10px 0px;cursor:pointer}input.interrupt:hover{background-color:#f5867a}input.interrupt:active{background-color:#f77163}input.save,input.interrupt{margin:auto;display:block;font-size:x-large;padding:5px 25px;border-radius:10px}.notification{border:3px solid #00529b;background-color:#bde5f8;width:fit-content;margin-right:auto;margin-left:auto;border-radius:40px;color:#00529b;padding:7px 60px;animation:2s fadeOut 5s 1 forwards;cursor:default;pointer-events:auto}@keyframes fadeOut{0%{opacity:1}99%{height:100%}100%{opacity:0;height:0}}td{padding:.5rem}.toggle{align-items:center;border-radius:100px;display:flex;font-weight:700;margin-bottom:16px}.toggle:last-of-type{margin:0}.toggle__input{clip:rect(0 0 0 0);clip-path:inset(50%);height:1px;overflow:hidden;position:absolute;white-space:nowrap;width:1px}.toggle__input:not([disabled]):active+.toggle-track,.toggle__input:not([disabled]):focus+.toggle-track{border:1px solid rgba(0,0,0,0);box-shadow:0px 0px 0px 2px #121943}.toggle__input:disabled+.toggle-track{cursor:not-allowed;opacity:.7}.toggle-track{background:#fff;border:1px solid #5a72b5;border-radius:100px;cursor:pointer;display:flex;height:30px;margin:auto;position:relative;width:60px}.toggle-indicator{align-items:center;background:#121943;border-radius:24px;bottom:2px;display:flex;height:24px;justify-content:center;left:2px;outline:solid 2px rgba(0,0,0,0);position:absolute;transition:.4s;width:24px}.checkMark{fill:#fff;height:20px;width:20px;opacity:0;transition:opacity .4s ease-in-out}.dropdowncontainer{padding:8px 16px;border:1px solid rgba(0,0,0,0);border-color:#000}input[value=true]+.toggle-track .toggle-indicator{background:#121943;transform:translateX(30px)}input[value=true]+.toggle-track .toggle-indicator .checkMark{opacity:1;transition:opacity .4s ease-in-out}@media screen and (-ms-high-contrast: active){.toggle-track{border-radius:0;background-color:red}}.topBar{display:flex}.tabEntry{margin-right:10px;border-radius:10px;background-color:#333}.tabEntry a{display:block;color:#fff;text-align:center;padding:6px;text-decoration:none}.tabEntry a[aria-current=page]{background-color:#00529b;border-radius:10px}.tabEntry a:hover[aria-current=page]{background-color:#002c53;border-radius:10px}.tabEntry a:hover{background-color:#111;border-radius:10px}.setting{position:relative;display:inline-block}.setting .settingHover{visibility:hidden;background-color:#cacaca;color:#000;text-align:center;border-radius:6px;border-color:#000;position:absolute;z-index:1}.setting:hover .settingHover{visibility:visible;padding:5px;margin-left:15px}.invalid-setting input,.invalid-setting select,.invalid-setting .toggle-track{background:pink !important}.invalid-reason{text-align:center}.invalid-reason small{padding:0px 5px;border-radius:10px;color:red}\n";

/***/ }),

/***/ 530:
/***/ ((module) => {

module.exports = require("kolmafia");

/***/ })

/******/ 	});
/************************************************************************/
/******/ 	// The module cache
/******/ 	var __webpack_module_cache__ = {};
/******/ 	
/******/ 	// The require function
/******/ 	function __webpack_require__(moduleId) {
/******/ 		// Check if module is in cache
/******/ 		var cachedModule = __webpack_module_cache__[moduleId];
/******/ 		if (cachedModule !== undefined) {
/******/ 			return cachedModule.exports;
/******/ 		}
/******/ 		// Create a new module (and put it into the cache)
/******/ 		var module = __webpack_module_cache__[moduleId] = {
/******/ 			// no module.id needed
/******/ 			// no module.loaded needed
/******/ 			exports: {}
/******/ 		};
/******/ 	
/******/ 		// Execute the module function
/******/ 		__webpack_modules__[moduleId](module, module.exports, __webpack_require__);
/******/ 	
/******/ 		// Return the exports of the module
/******/ 		return module.exports;
/******/ 	}
/******/ 	
/************************************************************************/
/******/ 	/* webpack/runtime/compat get default export */
/******/ 	(() => {
/******/ 		// getDefaultExport function for compatibility with non-harmony modules
/******/ 		__webpack_require__.n = (module) => {
/******/ 			var getter = module && module.__esModule ?
/******/ 				() => (module['default']) :
/******/ 				() => (module);
/******/ 			__webpack_require__.d(getter, { a: getter });
/******/ 			return getter;
/******/ 		};
/******/ 	})();
/******/ 	
/******/ 	/* webpack/runtime/define property getters */
/******/ 	(() => {
/******/ 		// define getter functions for harmony exports
/******/ 		__webpack_require__.d = (exports, definition) => {
/******/ 			for(var key in definition) {
/******/ 				if(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {
/******/ 					Object.defineProperty(exports, key, { enumerable: true, get: definition[key] });
/******/ 				}
/******/ 			}
/******/ 		};
/******/ 	})();
/******/ 	
/******/ 	/* webpack/runtime/hasOwnProperty shorthand */
/******/ 	(() => {
/******/ 		__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))
/******/ 	})();
/******/ 	
/******/ 	/* webpack/runtime/make namespace object */
/******/ 	(() => {
/******/ 		// define __esModule on exports
/******/ 		__webpack_require__.r = (exports) => {
/******/ 			if(typeof Symbol !== 'undefined' && Symbol.toStringTag) {
/******/ 				Object.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });
/******/ 			}
/******/ 			Object.defineProperty(exports, '__esModule', { value: true });
/******/ 		};
/******/ 	})();
/******/ 	
/************************************************************************/
var __webpack_exports__ = {};
// This entry need to be wrapped in an IIFE because it need to be isolated against other modules in the chunk.
(() => {
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "main": () => (/* binding */ main)
/* harmony export */ });
/* harmony import */ var kolmafia__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(530);
/* harmony import */ var kolmafia__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(kolmafia__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var _RelayUtils__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(616);
function _createForOfIteratorHelper(o, allowArrayLike) {var it = typeof Symbol !== "undefined" && o[Symbol.iterator] || o["@@iterator"];if (!it) {if (Array.isArray(o) || (it = _unsupportedIterableToArray(o)) || allowArrayLike && o && typeof o.length === "number") {if (it) o = it;var i = 0;var F = function F() {};return { s: F, n: function n() {if (i >= o.length) return { done: true };return { done: false, value: o[i++] };}, e: function e(_e) {throw _e;}, f: F };}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");}var normalCompletion = true,didErr = false,err;return { s: function s() {it = it.call(o);}, n: function n() {var step = it.next();normalCompletion = step.done;return step;}, e: function e(_e2) {didErr = true;err = _e2;}, f: function f() {try {if (!normalCompletion && it.return != null) it.return();} finally {if (didErr) throw err;}} };}function _unsupportedIterableToArray(o, minLen) {if (!o) return;if (typeof o === "string") return _arrayLikeToArray(o, minLen);var n = Object.prototype.toString.call(o).slice(8, -1);if (n === "Object" && o.constructor) n = o.constructor.name;if (n === "Map" || n === "Set") return Array.from(o);if (n === "Arguments" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen);}function _arrayLikeToArray(arr, len) {if (len == null || len > arr.length) len = arr.length;for (var i = 0, arr2 = new Array(len); i < len; i++) {arr2[i] = arr[i];}return arr2;}



function main() {for (var _len = arguments.length, pagesToLoad = new Array(_len), _key = 0; _key < _len; _key++) {pagesToLoad[_key] = arguments[_key];}
  if ((0,_RelayUtils__WEBPACK_IMPORTED_MODULE_1__/* .handledApiRequest */ .k7)()) {
    return;
  }

  if (pagesToLoad.length == 0) {
    // Find any 'page' or 'pages' parameters
    pagesToLoad = ((0,kolmafia__WEBPACK_IMPORTED_MODULE_0__.formFields)()["page"] || (0,kolmafia__WEBPACK_IMPORTED_MODULE_0__.formFields)()["pages"] || "").
    split(",").
    filter((s) => s.length > 0);
  }

  var pages = [];
  var extraHtml;

  if (pagesToLoad.length > 0) {
    var cssFile;var _iterator = _createForOfIteratorHelper(
      pagesToLoad),_step;try {for (_iterator.s(); !(_step = _iterator.n()).done;) {var pageName = _step.value;
        try {
          var page = null;

          // If the parameter is a string, then try to load from file
          if (typeof pageName == "string") {
            cssFile = (0,_RelayUtils__WEBPACK_IMPORTED_MODULE_1__/* .parseCssFromFile */ .$p)(pageName);
            page = (0,_RelayUtils__WEBPACK_IMPORTED_MODULE_1__/* .parsePageFromFile */ .jU)(pageName);
          } else {
            page = pageName;
          }

          if (page == null) {
            continue;
          }

          // Assume at this point it must be a RelayPage
          pages.push(page);

          if (cssFile == null) {
            continue;
          }

          if (extraHtml == null) {
            extraHtml = { cssFiles: [] };
          }

          extraHtml.cssFiles.push(cssFile);
        } catch (e) {
          (0,kolmafia__WEBPACK_IMPORTED_MODULE_0__.write)(
          "<h2>An error occured while trying to load " + (
          typeof pageName == "string" ?
          (0,_RelayUtils__WEBPACK_IMPORTED_MODULE_1__/* .getPagePath */ .mn)(pageName) + ", is your json properly formatted?" :
          "a relay page") +
          "</h2>");


          if (e) {
            (0,kolmafia__WEBPACK_IMPORTED_MODULE_0__.write)("<br>");
            (0,kolmafia__WEBPACK_IMPORTED_MODULE_0__.write)(e);

            if (e.stack) {
              for (var _i = 0, _arr = e.stack.split("\n"); _i < _arr.length; _i++) {var s = _arr[_i];
                while (s.match(/\t|\r/)) {
                  s = s.replace(/\t|\r/, "");
                }

                (0,kolmafia__WEBPACK_IMPORTED_MODULE_0__.write)("<br>");
                (0,kolmafia__WEBPACK_IMPORTED_MODULE_0__.write)(s);
              }
            }
          }
          return;
        }
      }} catch (err) {_iterator.e(err);} finally {_iterator.f();}
  }

  if (pages.length == 0) {
    (0,kolmafia__WEBPACK_IMPORTED_MODULE_0__.write)(
    "<h3>The relay script could not find any pages to load, either invalid/missing pages were provided or nothing was.</h3>");

    return;
  }

  (0,kolmafia__WEBPACK_IMPORTED_MODULE_0__.write)((0,_RelayUtils__WEBPACK_IMPORTED_MODULE_1__/* .generateHTML */ .ar)(pages, extraHtml));
}
})();

var __webpack_export_target__ = exports;
for(var i in __webpack_exports__) __webpack_export_target__[i] = __webpack_exports__[i];
if(__webpack_exports__.__esModule) Object.defineProperty(__webpack_export_target__, "__esModule", { value: true });
/******/ })()
;