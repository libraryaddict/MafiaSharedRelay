/******/ (() => { // webpackBootstrap
/******/ 	"use strict";
/******/ 	var __webpack_modules__ = ({

/***/ 616:
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "$p": () => (/* binding */ parseCssFromFile),
/* harmony export */   "SU": () => (/* binding */ handleApiRequest),
/* harmony export */   "ar": () => (/* binding */ generateHTML),
/* harmony export */   "jU": () => (/* binding */ parsePageFromFile),
/* harmony export */   "mn": () => (/* binding */ getPagePath)
/* harmony export */ });
/* unused harmony export parsePageFromJson */
/* harmony import */ var kolmafia__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(530);
/* harmony import */ var kolmafia__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(kolmafia__WEBPACK_IMPORTED_MODULE_0__);
function _toConsumableArray(arr) {return _arrayWithoutHoles(arr) || _iterableToArray(arr) || _unsupportedIterableToArray(arr) || _nonIterableSpread();}function _nonIterableSpread() {throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");}function _iterableToArray(iter) {if (typeof Symbol !== "undefined" && iter[Symbol.iterator] != null || iter["@@iterator"] != null) return Array.from(iter);}function _arrayWithoutHoles(arr) {if (Array.isArray(arr)) return _arrayLikeToArray(arr);}function _slicedToArray(arr, i) {return _arrayWithHoles(arr) || _iterableToArrayLimit(arr, i) || _unsupportedIterableToArray(arr, i) || _nonIterableRest();}function _nonIterableRest() {throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");}function _iterableToArrayLimit(arr, i) {var _i = null == arr ? null : "undefined" != typeof Symbol && arr[Symbol.iterator] || arr["@@iterator"];if (null != _i) {var _s,_e,_x,_r,_arr = [],_n = !0,_d = !1;try {if (_x = (_i = _i.call(arr)).next, 0 === i) {if (Object(_i) !== _i) return;_n = !1;} else for (; !(_n = (_s = _x.call(_i)).done) && (_arr.push(_s.value), _arr.length !== i); _n = !0);} catch (err) {_d = !0, _e = err;} finally {try {if (!_n && null != _i.return && (_r = _i.return(), Object(_r) !== _r)) return;} finally {if (_d) throw _e;}}return _arr;}}function _arrayWithHoles(arr) {if (Array.isArray(arr)) return arr;}function _createForOfIteratorHelper(o, allowArrayLike) {var it = typeof Symbol !== "undefined" && o[Symbol.iterator] || o["@@iterator"];if (!it) {if (Array.isArray(o) || (it = _unsupportedIterableToArray(o)) || allowArrayLike && o && typeof o.length === "number") {if (it) o = it;var i = 0;var F = function F() {};return { s: F, n: function n() {if (i >= o.length) return { done: true };return { done: false, value: o[i++] };}, e: function e(_e2) {throw _e2;}, f: F };}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");}var normalCompletion = true,didErr = false,err;return { s: function s() {it = it.call(o);}, n: function n() {var step = it.next();normalCompletion = step.done;return step;}, e: function e(_e3) {didErr = true;err = _e3;}, f: function f() {try {if (!normalCompletion && it.return != null) it.return();} finally {if (didErr) throw err;}} };}function _unsupportedIterableToArray(o, minLen) {if (!o) return;if (typeof o === "string") return _arrayLikeToArray(o, minLen);var n = Object.prototype.toString.call(o).slice(8, -1);if (n === "Object" && o.constructor) n = o.constructor.name;if (n === "Map" || n === "Set") return Array.from(o);if (n === "Arguments" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen);}function _arrayLikeToArray(arr, len) {if (len == null || len > arr.length) len = arr.length;for (var i = 0, arr2 = new Array(len); i < len; i++) arr2[i] = arr[i];return arr2;}










function handleApiRequest() {
  if (handleJavascript()) {
    return true;
  }

  if (handleProperties()) {
    return true;
  }

  return false;
}

function handleProperties() {
  var toSet = (0,kolmafia__WEBPACK_IMPORTED_MODULE_0__.formFields)()["setProperties"];

  if (toSet == null) {
    return false;
  }

  var props = JSON.parse(toSet);
  var notifications = [];var _iterator = _createForOfIteratorHelper(

    props),_step;try {for (_iterator.s(); !(_step = _iterator.n()).done;) {var _step$value = _slicedToArray(_step.value, 2),key = _step$value[0],value = _step$value[1];
      var prevValue = (0,kolmafia__WEBPACK_IMPORTED_MODULE_0__.getProperty)(key);

      if (prevValue === value) {
        continue;
      }

      (0,kolmafia__WEBPACK_IMPORTED_MODULE_0__.setProperty)(key, value);
      notifications.push("".concat(key, " changed from `").concat(prevValue, "` to `").concat(value, "`"));
    }} catch (err) {_iterator.e(err);} finally {_iterator.f();}

  if (notifications.length == 0) {
    notifications.push("No settings were modified.");
  }

  // We include the ' ' because otherwise the browser doesn't like an empty page
  (0,kolmafia__WEBPACK_IMPORTED_MODULE_0__.write)(JSON.stringify(notifications));
  return true;
}

function handleJavascript() {
  var js = (0,kolmafia__WEBPACK_IMPORTED_MODULE_0__.formFields)()["javascript"];

  if (js == null) {
    return false;
  }

  var returns = eval(js) || "";
  // We include the ' ' because otherwise the browser doesn't like an empty page
  (0,kolmafia__WEBPACK_IMPORTED_MODULE_0__.write)(returns + (returns ? "" : " "));
  return true;
}

function validateComponents(components) {var _iterator2 = _createForOfIteratorHelper(
    components),_step2;try {for (_iterator2.s(); !(_step2 = _iterator2.n()).done;) {var _button$name;var component = _step2.value;
      var button = component;

      if (button.preference == null) {
        continue;
      }

      button.name = (_button$name = button.name) !== null && _button$name !== void 0 ? _button$name : button.preference;

      if (button.validate != null) {
        try {
          eval(button.validate);
        } catch (e) {
          (0,kolmafia__WEBPACK_IMPORTED_MODULE_0__.print)("Unable to load ".concat(button.name, "'s validator '").concat(button.validate, "'"));
          button.validate = null;
        }
      }

      if (button.default != undefined && typeof button.default != "string") {
        button.default = button.default + "";
      }

      if (button.default == null && (0,kolmafia__WEBPACK_IMPORTED_MODULE_0__.propertyHasDefault)(button.preference)) {
        button.default = (0,kolmafia__WEBPACK_IMPORTED_MODULE_0__.propertyDefaultValue)(button.preference);
      }

      if (button.value != undefined && typeof button.value != "string") {
        button.value = button.value + "";
      }

      if (button.default == null && button.type == "boolean") {
        button.default = "true";
      }

      if (button.type == "tags") {
        var tags = button;
        if (tags.allowDuplicateTags == null) {
          tags.allowDuplicateTags = true;
        } else if (typeof tags.allowDuplicateTags == "string") {
          tags.allowDuplicateTags = tags.allowDuplicateTags == "true";
        }

        if (tags.tagsSeperator == null) {
          tags.tagsSeperator = ",";
        }

        if (button.placeholderText == null) {
          button.placeholderText = button.default ? button.default : "";
        }
      }

      if (button.value != null) {
        continue;
      }

      var val = void 0;

      if ((0,kolmafia__WEBPACK_IMPORTED_MODULE_0__.propertyExists)(button.preference)) {
        val = (0,kolmafia__WEBPACK_IMPORTED_MODULE_0__.getProperty)(button.preference);
      } else if (button.default != null) {
        val = button.default;
      } else {
        if (button.type == "dropdown") {
          if (typeof button.dropdown[0] == "string") {
            val = button.dropdown[0];
          } else {
            val = button.dropdown[0].value;
          }
        } else if (button.type == "boolean") {
          val = "true";
        } else {
          val = "";
        }
      }

      button.value = val;
    }} catch (err) {_iterator2.e(err);} finally {_iterator2.f();}
}

function generateHTML(
pages,
extraHtml)
{
  pages = pages.filter((p) => p != null);var _iterator3 = _createForOfIteratorHelper(

    pages),_step3;try {for (_iterator3.s(); !(_step3 = _iterator3.n()).done;) {var _page$file;var page = _step3.value;
      page.file = (_page$file = page.file) !== null && _page$file !== void 0 ? _page$file : page.page;

      validateComponents(page.components);
    }} catch (err) {_iterator3.e(err);} finally {_iterator3.f();}

  var buffer = [];

  var cssFiles = [];

  if (extraHtml && extraHtml.cssFiles) {
    cssFiles.push.apply(cssFiles, _toConsumableArray(extraHtml.cssFiles));
  }

  buffer.push("<!DOCTYPE html>");
  buffer.push("<head>");

  cssFiles.forEach((s) => {
    buffer.push("<link rel=\"stylesheet\" src=\"".concat(s, "\">"));
  });

  buffer.push("<style>");
  buffer.push("".concat(__webpack_require__(171)));

  if (extraHtml && extraHtml.css) {
    buffer.push(extraHtml.css);
  }

  buffer.push("</style>");

  buffer.push("</head>");

  buffer.push('<div id="root"></div>');

  buffer.push("<script>");

  // add script that react calls when loaded to get kol data
  buffer.push("let getData = function(callback) {callback(".concat(
  JSON.stringify(pages), ")}"));


  // close notifications when they are clicked on
  buffer.push("document.onclick = (e) => {\n    if(e.target.classList.contains('notification')) e.target.remove();\n  }");



  buffer.push("</script>");

  // include react script
  buffer.push("<script src=\"".concat(
  __webpack_require__(832), "\"></script>"));


  return buffer.join("\n");
}

function getPagePath(file) {
  var fileName = file.includes("/") ?
  file :
  "relay/shared_relay/pages/" + file + ".json";

  if (!fileName.endsWith(".json") && (0,kolmafia__WEBPACK_IMPORTED_MODULE_0__.fileToBuffer)(fileName).length == 0) {
    fileName += ".json";
  }

  return fileName;
}

/**
 * Parses from relay/shared_relay/pages/ if no slashes are in the name, otherwise expects a valid json file
 */
function parsePageFromFile(file) {
  var data = (0,kolmafia__WEBPACK_IMPORTED_MODULE_0__.fileToBuffer)(getPagePath(file));

  return parsePageFromJson(file, data);
}

function parseCssFromFile(file) {
  var fileName = file.includes("/") ?
  file :
  "relay/shared_relay/pages/" + file + ".css";

  if (!fileName.endsWith(".css")) {
    fileName += ".css";
  }

  var data = (0,kolmafia__WEBPACK_IMPORTED_MODULE_0__.fileToBuffer)(fileName);

  if (data.length == 0) {
    return null;
  }

  return data;
}

function parsePageFromJson(id, jsonData) {
  if (jsonData.length == 0) {
    return null;
  }

  var subpage = JSON.parse(jsonData);

  subpage.file = id;

  for (var _i2 = 0, _arr2 = subpage.components; _i2 < _arr2.length; _i2++) {var _ref3;var button = _arr2[_i2];
    if (button.type != "dropdown") {
      continue;
    }

    var dropdown = button;

    if (dropdown.dropdown == null) {
      dropdown.dropdown = [];
    } else if (typeof dropdown.dropdown[0] == "string") {
      dropdown.dropdown = dropdown.dropdown.map(
      (s) => {
        return {
          display: s,
          value: s
        };
      });

    }

    if (dropdown.dropdownFiller == null) {
      continue;
    }

    var data =
    eval(dropdown.dropdownFiller).
    map((_ref) => {var _ref2 = _slicedToArray(_ref, 2),display = _ref2[0],value = _ref2[1];
      return {
        display: display,
        value: value
      };
    });

    (_ref3 = dropdown.dropdown).push.apply(_ref3, _toConsumableArray(data));
  }

  return subpage;
}

/***/ }),

/***/ 832:
/***/ ((module) => {

module.exports = "data:application/javascript;base64,ZnVuY3Rpb24gX3JlZ2VuZXJhdG9yUnVudGltZTIoKSB7InVzZSBzdHJpY3QiOwovKiEgcmVnZW5lcmF0b3ItcnVudGltZSAtLSBDb3B5cmlnaHQgKGMpIDIwMTQtcHJlc2VudCwgRmFjZWJvb2ssIEluYy4gLS0gbGljZW5zZSAoTUlUKTogaHR0cHM6Ly9naXRodWIuY29tL2ZhY2Vib29rL3JlZ2VuZXJhdG9yL2Jsb2IvbWFpbi9MSUNFTlNFICovX3JlZ2VuZXJhdG9yUnVudGltZTIgPSBmdW5jdGlvbiBfcmVnZW5lcmF0b3JSdW50aW1lMigpIHtyZXR1cm4gZXhwb3J0czt9O3ZhciBleHBvcnRzID0ge30sT3AgPSBPYmplY3QucHJvdG90eXBlLGhhc093biA9IE9wLmhhc093blByb3BlcnR5LGRlZmluZVByb3BlcnR5ID0gT2JqZWN0LmRlZmluZVByb3BlcnR5IHx8IGZ1bmN0aW9uIChvYmosIGtleSwgZGVzYykge29ialtrZXldID0gZGVzYy52YWx1ZTt9LCRTeW1ib2wgPSAiZnVuY3Rpb24iID09IHR5cGVvZiBTeW1ib2wgPyBTeW1ib2wgOiB7fSxpdGVyYXRvclN5bWJvbCA9ICRTeW1ib2wuaXRlcmF0b3IgfHwgIkBAaXRlcmF0b3IiLGFzeW5jSXRlcmF0b3JTeW1ib2wgPSAkU3ltYm9sLmFzeW5jSXRlcmF0b3IgfHwgIkBAYXN5bmNJdGVyYXRvciIsdG9TdHJpbmdUYWdTeW1ib2wgPSAkU3ltYm9sLnRvU3RyaW5nVGFnIHx8ICJAQHRvU3RyaW5nVGFnIjtmdW5jdGlvbiBkZWZpbmUob2JqLCBrZXksIHZhbHVlKSB7cmV0dXJuIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvYmosIGtleSwgeyB2YWx1ZTogdmFsdWUsIGVudW1lcmFibGU6ICEwLCBjb25maWd1cmFibGU6ICEwLCB3cml0YWJsZTogITAgfSksIG9ialtrZXldO310cnkge2RlZmluZSh7fSwgIiIpO30gY2F0Y2ggKGVycikge2RlZmluZSA9IGZ1bmN0aW9uIGRlZmluZShvYmosIGtleSwgdmFsdWUpIHtyZXR1cm4gb2JqW2tleV0gPSB2YWx1ZTt9O31mdW5jdGlvbiB3cmFwKGlubmVyRm4sIG91dGVyRm4sIHNlbGYsIHRyeUxvY3NMaXN0KSB7dmFyIHByb3RvR2VuZXJhdG9yID0gb3V0ZXJGbiAmJiBvdXRlckZuLnByb3RvdHlwZSBpbnN0YW5jZW9mIEdlbmVyYXRvciA/IG91dGVyRm4gOiBHZW5lcmF0b3IsZ2VuZXJhdG9yID0gT2JqZWN0LmNyZWF0ZShwcm90b0dlbmVyYXRvci5wcm90b3R5cGUpLGNvbnRleHQgPSBuZXcgQ29udGV4dCh0cnlMb2NzTGlzdCB8fCBbXSk7cmV0dXJuIGRlZmluZVByb3BlcnR5KGdlbmVyYXRvciwgIl9pbnZva2UiLCB7IHZhbHVlOiBtYWtlSW52b2tlTWV0aG9kKGlubmVyRm4sIHNlbGYsIGNvbnRleHQpIH0pLCBnZW5lcmF0b3I7fWZ1bmN0aW9uIHRyeUNhdGNoKGZuLCBvYmosIGFyZykge3RyeSB7cmV0dXJuIHsgdHlwZTogIm5vcm1hbCIsIGFyZzogZm4uY2FsbChvYmosIGFyZykgfTt9IGNhdGNoIChlcnIpIHtyZXR1cm4geyB0eXBlOiAidGhyb3ciLCBhcmc6IGVyciB9O319ZXhwb3J0cy53cmFwID0gd3JhcDt2YXIgQ29udGludWVTZW50aW5lbCA9IHt9O2Z1bmN0aW9uIEdlbmVyYXRvcigpIHt9ZnVuY3Rpb24gR2VuZXJhdG9yRnVuY3Rpb24oKSB7fWZ1bmN0aW9uIEdlbmVyYXRvckZ1bmN0aW9uUHJvdG90eXBlKCkge312YXIgSXRlcmF0b3JQcm90b3R5cGUgPSB7fTtkZWZpbmUoSXRlcmF0b3JQcm90b3R5cGUsIGl0ZXJhdG9yU3ltYm9sLCBmdW5jdGlvbiAoKSB7cmV0dXJuIHRoaXM7fSk7dmFyIGdldFByb3RvID0gT2JqZWN0LmdldFByb3RvdHlwZU9mLE5hdGl2ZUl0ZXJhdG9yUHJvdG90eXBlID0gZ2V0UHJvdG8gJiYgZ2V0UHJvdG8oZ2V0UHJvdG8odmFsdWVzKFtdKSkpO05hdGl2ZUl0ZXJhdG9yUHJvdG90eXBlICYmIE5hdGl2ZUl0ZXJhdG9yUHJvdG90eXBlICE9PSBPcCAmJiBoYXNPd24uY2FsbChOYXRpdmVJdGVyYXRvclByb3RvdHlwZSwgaXRlcmF0b3JTeW1ib2wpICYmIChJdGVyYXRvclByb3RvdHlwZSA9IE5hdGl2ZUl0ZXJhdG9yUHJvdG90eXBlKTt2YXIgR3AgPSBHZW5lcmF0b3JGdW5jdGlvblByb3RvdHlwZS5wcm90b3R5cGUgPSBHZW5lcmF0b3IucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZShJdGVyYXRvclByb3RvdHlwZSk7ZnVuY3Rpb24gZGVmaW5lSXRlcmF0b3JNZXRob2RzKHByb3RvdHlwZSkge1sibmV4dCIsICJ0aHJvdyIsICJyZXR1cm4iXS5mb3JFYWNoKGZ1bmN0aW9uIChtZXRob2QpIHtkZWZpbmUocHJvdG90eXBlLCBtZXRob2QsIGZ1bmN0aW9uIChhcmcpIHtyZXR1cm4gdGhpcy5faW52b2tlKG1ldGhvZCwgYXJnKTt9KTt9KTt9ZnVuY3Rpb24gQXN5bmNJdGVyYXRvcihnZW5lcmF0b3IsIFByb21pc2VJbXBsKSB7ZnVuY3Rpb24gaW52b2tlKG1ldGhvZCwgYXJnLCByZXNvbHZlLCByZWplY3QpIHt2YXIgcmVjb3JkID0gdHJ5Q2F0Y2goZ2VuZXJhdG9yW21ldGhvZF0sIGdlbmVyYXRvciwgYXJnKTtpZiAoInRocm93IiAhPT0gcmVjb3JkLnR5cGUpIHt2YXIgcmVzdWx0ID0gcmVjb3JkLmFyZyx2YWx1ZSA9IHJlc3VsdC52YWx1ZTtyZXR1cm4gdmFsdWUgJiYgIm9iamVjdCIgPT0gdHlwZW9mIHZhbHVlICYmIGhhc093bi5jYWxsKHZhbHVlLCAiX19hd2FpdCIpID8gUHJvbWlzZUltcGwucmVzb2x2ZSh2YWx1ZS5fX2F3YWl0KS50aGVuKGZ1bmN0aW9uICh2YWx1ZSkge2ludm9rZSgibmV4dCIsIHZhbHVlLCByZXNvbHZlLCByZWplY3QpO30sIGZ1bmN0aW9uIChlcnIpIHtpbnZva2UoInRocm93IiwgZXJyLCByZXNvbHZlLCByZWplY3QpO30pIDogUHJvbWlzZUltcGwucmVzb2x2ZSh2YWx1ZSkudGhlbihmdW5jdGlvbiAodW53cmFwcGVkKSB7cmVzdWx0LnZhbHVlID0gdW53cmFwcGVkLCByZXNvbHZlKHJlc3VsdCk7fSwgZnVuY3Rpb24gKGVycm9yKSB7cmV0dXJuIGludm9rZSgidGhyb3ciLCBlcnJvciwgcmVzb2x2ZSwgcmVqZWN0KTt9KTt9cmVqZWN0KHJlY29yZC5hcmcpO312YXIgcHJldmlvdXNQcm9taXNlO2RlZmluZVByb3BlcnR5KHRoaXMsICJfaW52b2tlIiwgeyB2YWx1ZTogZnVuY3Rpb24gdmFsdWUobWV0aG9kLCBhcmcpIHtmdW5jdGlvbiBjYWxsSW52b2tlV2l0aE1ldGhvZEFuZEFyZygpIHtyZXR1cm4gbmV3IFByb21pc2VJbXBsKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtpbnZva2UobWV0aG9kLCBhcmcsIHJlc29sdmUsIHJlamVjdCk7fSk7fXJldHVybiBwcmV2aW91c1Byb21pc2UgPSBwcmV2aW91c1Byb21pc2UgPyBwcmV2aW91c1Byb21pc2UudGhlbihjYWxsSW52b2tlV2l0aE1ldGhvZEFuZEFyZywgY2FsbEludm9rZVdpdGhNZXRob2RBbmRBcmcpIDogY2FsbEludm9rZVdpdGhNZXRob2RBbmRBcmcoKTt9IH0pO31mdW5jdGlvbiBtYWtlSW52b2tlTWV0aG9kKGlubmVyRm4sIHNlbGYsIGNvbnRleHQpIHt2YXIgc3RhdGUgPSAic3VzcGVuZGVkU3RhcnQiO3JldHVybiBmdW5jdGlvbiAobWV0aG9kLCBhcmcpIHtpZiAoImV4ZWN1dGluZyIgPT09IHN0YXRlKSB0aHJvdyBuZXcgRXJyb3IoIkdlbmVyYXRvciBpcyBhbHJlYWR5IHJ1bm5pbmciKTtpZiAoImNvbXBsZXRlZCIgPT09IHN0YXRlKSB7aWYgKCJ0aHJvdyIgPT09IG1ldGhvZCkgdGhyb3cgYXJnO3JldHVybiBkb25lUmVzdWx0KCk7fWZvciAoY29udGV4dC5tZXRob2QgPSBtZXRob2QsIGNvbnRleHQuYXJnID0gYXJnOzspIHt2YXIgZGVsZWdhdGUgPSBjb250ZXh0LmRlbGVnYXRlO2lmIChkZWxlZ2F0ZSkge3ZhciBkZWxlZ2F0ZVJlc3VsdCA9IG1heWJlSW52b2tlRGVsZWdhdGUoZGVsZWdhdGUsIGNvbnRleHQpO2lmIChkZWxlZ2F0ZVJlc3VsdCkge2lmIChkZWxlZ2F0ZVJlc3VsdCA9PT0gQ29udGludWVTZW50aW5lbCkgY29udGludWU7cmV0dXJuIGRlbGVnYXRlUmVzdWx0O319aWYgKCJuZXh0IiA9PT0gY29udGV4dC5tZXRob2QpIGNvbnRleHQuc2VudCA9IGNvbnRleHQuX3NlbnQgPSBjb250ZXh0LmFyZztlbHNlIGlmICgidGhyb3ciID09PSBjb250ZXh0Lm1ldGhvZCkge2lmICgic3VzcGVuZGVkU3RhcnQiID09PSBzdGF0ZSkgdGhyb3cgc3RhdGUgPSAiY29tcGxldGVkIiwgY29udGV4dC5hcmc7Y29udGV4dC5kaXNwYXRjaEV4Y2VwdGlvbihjb250ZXh0LmFyZyk7fSBlbHNlICJyZXR1cm4iID09PSBjb250ZXh0Lm1ldGhvZCAmJiBjb250ZXh0LmFicnVwdCgicmV0dXJuIiwgY29udGV4dC5hcmcpO3N0YXRlID0gImV4ZWN1dGluZyI7dmFyIHJlY29yZCA9IHRyeUNhdGNoKGlubmVyRm4sIHNlbGYsIGNvbnRleHQpO2lmICgibm9ybWFsIiA9PT0gcmVjb3JkLnR5cGUpIHtpZiAoc3RhdGUgPSBjb250ZXh0LmRvbmUgPyAiY29tcGxldGVkIiA6ICJzdXNwZW5kZWRZaWVsZCIsIHJlY29yZC5hcmcgPT09IENvbnRpbnVlU2VudGluZWwpIGNvbnRpbnVlO3JldHVybiB7IHZhbHVlOiByZWNvcmQuYXJnLCBkb25lOiBjb250ZXh0LmRvbmUgfTt9InRocm93IiA9PT0gcmVjb3JkLnR5cGUgJiYgKHN0YXRlID0gImNvbXBsZXRlZCIsIGNvbnRleHQubWV0aG9kID0gInRocm93IiwgY29udGV4dC5hcmcgPSByZWNvcmQuYXJnKTt9fTt9ZnVuY3Rpb24gbWF5YmVJbnZva2VEZWxlZ2F0ZShkZWxlZ2F0ZSwgY29udGV4dCkge3ZhciBtZXRob2ROYW1lID0gY29udGV4dC5tZXRob2QsbWV0aG9kID0gZGVsZWdhdGUuaXRlcmF0b3JbbWV0aG9kTmFtZV07aWYgKHVuZGVmaW5lZCA9PT0gbWV0aG9kKSByZXR1cm4gY29udGV4dC5kZWxlZ2F0ZSA9IG51bGwsICJ0aHJvdyIgPT09IG1ldGhvZE5hbWUgJiYgZGVsZWdhdGUuaXRlcmF0b3IucmV0dXJuICYmIChjb250ZXh0Lm1ldGhvZCA9ICJyZXR1cm4iLCBjb250ZXh0LmFyZyA9IHVuZGVmaW5lZCwgbWF5YmVJbnZva2VEZWxlZ2F0ZShkZWxlZ2F0ZSwgY29udGV4dCksICJ0aHJvdyIgPT09IGNvbnRleHQubWV0aG9kKSB8fCAicmV0dXJuIiAhPT0gbWV0aG9kTmFtZSAmJiAoY29udGV4dC5tZXRob2QgPSAidGhyb3ciLCBjb250ZXh0LmFyZyA9IG5ldyBUeXBlRXJyb3IoIlRoZSBpdGVyYXRvciBkb2VzIG5vdCBwcm92aWRlIGEgJyIgKyBtZXRob2ROYW1lICsgIicgbWV0aG9kIikpLCBDb250aW51ZVNlbnRpbmVsO3ZhciByZWNvcmQgPSB0cnlDYXRjaChtZXRob2QsIGRlbGVnYXRlLml0ZXJhdG9yLCBjb250ZXh0LmFyZyk7aWYgKCJ0aHJvdyIgPT09IHJlY29yZC50eXBlKSByZXR1cm4gY29udGV4dC5tZXRob2QgPSAidGhyb3ciLCBjb250ZXh0LmFyZyA9IHJlY29yZC5hcmcsIGNvbnRleHQuZGVsZWdhdGUgPSBudWxsLCBDb250aW51ZVNlbnRpbmVsO3ZhciBpbmZvID0gcmVjb3JkLmFyZztyZXR1cm4gaW5mbyA/IGluZm8uZG9uZSA/IChjb250ZXh0W2RlbGVnYXRlLnJlc3VsdE5hbWVdID0gaW5mby52YWx1ZSwgY29udGV4dC5uZXh0ID0gZGVsZWdhdGUubmV4dExvYywgInJldHVybiIgIT09IGNvbnRleHQubWV0aG9kICYmIChjb250ZXh0Lm1ldGhvZCA9ICJuZXh0IiwgY29udGV4dC5hcmcgPSB1bmRlZmluZWQpLCBjb250ZXh0LmRlbGVnYXRlID0gbnVsbCwgQ29udGludWVTZW50aW5lbCkgOiBpbmZvIDogKGNvbnRleHQubWV0aG9kID0gInRocm93IiwgY29udGV4dC5hcmcgPSBuZXcgVHlwZUVycm9yKCJpdGVyYXRvciByZXN1bHQgaXMgbm90IGFuIG9iamVjdCIpLCBjb250ZXh0LmRlbGVnYXRlID0gbnVsbCwgQ29udGludWVTZW50aW5lbCk7fWZ1bmN0aW9uIHB1c2hUcnlFbnRyeShsb2NzKSB7dmFyIGVudHJ5ID0geyB0cnlMb2M6IGxvY3NbMF0gfTsxIGluIGxvY3MgJiYgKGVudHJ5LmNhdGNoTG9jID0gbG9jc1sxXSksIDIgaW4gbG9jcyAmJiAoZW50cnkuZmluYWxseUxvYyA9IGxvY3NbMl0sIGVudHJ5LmFmdGVyTG9jID0gbG9jc1szXSksIHRoaXMudHJ5RW50cmllcy5wdXNoKGVudHJ5KTt9ZnVuY3Rpb24gcmVzZXRUcnlFbnRyeShlbnRyeSkge3ZhciByZWNvcmQgPSBlbnRyeS5jb21wbGV0aW9uIHx8IHt9O3JlY29yZC50eXBlID0gIm5vcm1hbCIsIGRlbGV0ZSByZWNvcmQuYXJnLCBlbnRyeS5jb21wbGV0aW9uID0gcmVjb3JkO31mdW5jdGlvbiBDb250ZXh0KHRyeUxvY3NMaXN0KSB7dGhpcy50cnlFbnRyaWVzID0gW3sgdHJ5TG9jOiAicm9vdCIgfV0sIHRyeUxvY3NMaXN0LmZvckVhY2gocHVzaFRyeUVudHJ5LCB0aGlzKSwgdGhpcy5yZXNldCghMCk7fWZ1bmN0aW9uIHZhbHVlcyhpdGVyYWJsZSkge2lmIChpdGVyYWJsZSkge3ZhciBpdGVyYXRvck1ldGhvZCA9IGl0ZXJhYmxlW2l0ZXJhdG9yU3ltYm9sXTtpZiAoaXRlcmF0b3JNZXRob2QpIHJldHVybiBpdGVyYXRvck1ldGhvZC5jYWxsKGl0ZXJhYmxlKTtpZiAoImZ1bmN0aW9uIiA9PSB0eXBlb2YgaXRlcmFibGUubmV4dCkgcmV0dXJuIGl0ZXJhYmxlO2lmICghaXNOYU4oaXRlcmFibGUubGVuZ3RoKSkge3ZhciBpID0gLTEsbmV4dCA9IGZ1bmN0aW9uIG5leHQoKSB7Zm9yICg7ICsraSA8IGl0ZXJhYmxlLmxlbmd0aDspIGlmIChoYXNPd24uY2FsbChpdGVyYWJsZSwgaSkpIHJldHVybiBuZXh0LnZhbHVlID0gaXRlcmFibGVbaV0sIG5leHQuZG9uZSA9ICExLCBuZXh0O3JldHVybiBuZXh0LnZhbHVlID0gdW5kZWZpbmVkLCBuZXh0LmRvbmUgPSAhMCwgbmV4dDt9O3JldHVybiBuZXh0Lm5leHQgPSBuZXh0O319cmV0dXJuIHsgbmV4dDogZG9uZVJlc3VsdCB9O31mdW5jdGlvbiBkb25lUmVzdWx0KCkge3JldHVybiB7IHZhbHVlOiB1bmRlZmluZWQsIGRvbmU6ICEwIH07fXJldHVybiBHZW5lcmF0b3JGdW5jdGlvbi5wcm90b3R5cGUgPSBHZW5lcmF0b3JGdW5jdGlvblByb3RvdHlwZSwgZGVmaW5lUHJvcGVydHkoR3AsICJjb25zdHJ1Y3RvciIsIHsgdmFsdWU6IEdlbmVyYXRvckZ1bmN0aW9uUHJvdG90eXBlLCBjb25maWd1cmFibGU6ICEwIH0pLCBkZWZpbmVQcm9wZXJ0eShHZW5lcmF0b3JGdW5jdGlvblByb3RvdHlwZSwgImNvbnN0cnVjdG9yIiwgeyB2YWx1ZTogR2VuZXJhdG9yRnVuY3Rpb24sIGNvbmZpZ3VyYWJsZTogITAgfSksIEdlbmVyYXRvckZ1bmN0aW9uLmRpc3BsYXlOYW1lID0gZGVmaW5lKEdlbmVyYXRvckZ1bmN0aW9uUHJvdG90eXBlLCB0b1N0cmluZ1RhZ1N5bWJvbCwgIkdlbmVyYXRvckZ1bmN0aW9uIiksIGV4cG9ydHMuaXNHZW5lcmF0b3JGdW5jdGlvbiA9IGZ1bmN0aW9uIChnZW5GdW4pIHt2YXIgY3RvciA9ICJmdW5jdGlvbiIgPT0gdHlwZW9mIGdlbkZ1biAmJiBnZW5GdW4uY29uc3RydWN0b3I7cmV0dXJuICEhY3RvciAmJiAoY3RvciA9PT0gR2VuZXJhdG9yRnVuY3Rpb24gfHwgIkdlbmVyYXRvckZ1bmN0aW9uIiA9PT0gKGN0b3IuZGlzcGxheU5hbWUgfHwgY3Rvci5uYW1lKSk7fSwgZXhwb3J0cy5tYXJrID0gZnVuY3Rpb24gKGdlbkZ1bikge3JldHVybiBPYmplY3Quc2V0UHJvdG90eXBlT2YgPyBPYmplY3Quc2V0UHJvdG90eXBlT2YoZ2VuRnVuLCBHZW5lcmF0b3JGdW5jdGlvblByb3RvdHlwZSkgOiAoZ2VuRnVuLl9fcHJvdG9fXyA9IEdlbmVyYXRvckZ1bmN0aW9uUHJvdG90eXBlLCBkZWZpbmUoZ2VuRnVuLCB0b1N0cmluZ1RhZ1N5bWJvbCwgIkdlbmVyYXRvckZ1bmN0aW9uIikpLCBnZW5GdW4ucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZShHcCksIGdlbkZ1bjt9LCBleHBvcnRzLmF3cmFwID0gZnVuY3Rpb24gKGFyZykge3JldHVybiB7IF9fYXdhaXQ6IGFyZyB9O30sIGRlZmluZUl0ZXJhdG9yTWV0aG9kcyhBc3luY0l0ZXJhdG9yLnByb3RvdHlwZSksIGRlZmluZShBc3luY0l0ZXJhdG9yLnByb3RvdHlwZSwgYXN5bmNJdGVyYXRvclN5bWJvbCwgZnVuY3Rpb24gKCkge3JldHVybiB0aGlzO30pLCBleHBvcnRzLkFzeW5jSXRlcmF0b3IgPSBBc3luY0l0ZXJhdG9yLCBleHBvcnRzLmFzeW5jID0gZnVuY3Rpb24gKGlubmVyRm4sIG91dGVyRm4sIHNlbGYsIHRyeUxvY3NMaXN0LCBQcm9taXNlSW1wbCkge3ZvaWQgMCA9PT0gUHJvbWlzZUltcGwgJiYgKFByb21pc2VJbXBsID0gUHJvbWlzZSk7dmFyIGl0ZXIgPSBuZXcgQXN5bmNJdGVyYXRvcih3cmFwKGlubmVyRm4sIG91dGVyRm4sIHNlbGYsIHRyeUxvY3NMaXN0KSwgUHJvbWlzZUltcGwpO3JldHVybiBleHBvcnRzLmlzR2VuZXJhdG9yRnVuY3Rpb24ob3V0ZXJGbikgPyBpdGVyIDogaXRlci5uZXh0KCkudGhlbihmdW5jdGlvbiAocmVzdWx0KSB7cmV0dXJuIHJlc3VsdC5kb25lID8gcmVzdWx0LnZhbHVlIDogaXRlci5uZXh0KCk7fSk7fSwgZGVmaW5lSXRlcmF0b3JNZXRob2RzKEdwKSwgZGVmaW5lKEdwLCB0b1N0cmluZ1RhZ1N5bWJvbCwgIkdlbmVyYXRvciIpLCBkZWZpbmUoR3AsIGl0ZXJhdG9yU3ltYm9sLCBmdW5jdGlvbiAoKSB7cmV0dXJuIHRoaXM7fSksIGRlZmluZShHcCwgInRvU3RyaW5nIiwgZnVuY3Rpb24gKCkge3JldHVybiAiW29iamVjdCBHZW5lcmF0b3JdIjt9KSwgZXhwb3J0cy5rZXlzID0gZnVuY3Rpb24gKHZhbCkge3ZhciBvYmplY3QgPSBPYmplY3QodmFsKSxrZXlzID0gW107Zm9yICh2YXIga2V5IGluIG9iamVjdCkga2V5cy5wdXNoKGtleSk7cmV0dXJuIGtleXMucmV2ZXJzZSgpLCBmdW5jdGlvbiBuZXh0KCkge2ZvciAoOyBrZXlzLmxlbmd0aDspIHt2YXIga2V5ID0ga2V5cy5wb3AoKTtpZiAoa2V5IGluIG9iamVjdCkgcmV0dXJuIG5leHQudmFsdWUgPSBrZXksIG5leHQuZG9uZSA9ICExLCBuZXh0O31yZXR1cm4gbmV4dC5kb25lID0gITAsIG5leHQ7fTt9LCBleHBvcnRzLnZhbHVlcyA9IHZhbHVlcywgQ29udGV4dC5wcm90b3R5cGUgPSB7IGNvbnN0cnVjdG9yOiBDb250ZXh0LCByZXNldDogZnVuY3Rpb24gcmVzZXQoc2tpcFRlbXBSZXNldCkge2lmICh0aGlzLnByZXYgPSAwLCB0aGlzLm5leHQgPSAwLCB0aGlzLnNlbnQgPSB0aGlzLl9zZW50ID0gdW5kZWZpbmVkLCB0aGlzLmRvbmUgPSAhMSwgdGhpcy5kZWxlZ2F0ZSA9IG51bGwsIHRoaXMubWV0aG9kID0gIm5leHQiLCB0aGlzLmFyZyA9IHVuZGVmaW5lZCwgdGhpcy50cnlFbnRyaWVzLmZvckVhY2gocmVzZXRUcnlFbnRyeSksICFza2lwVGVtcFJlc2V0KSBmb3IgKHZhciBuYW1lIGluIHRoaXMpICJ0IiA9PT0gbmFtZS5jaGFyQXQoMCkgJiYgaGFzT3duLmNhbGwodGhpcywgbmFtZSkgJiYgIWlzTmFOKCtuYW1lLnNsaWNlKDEpKSAmJiAodGhpc1tuYW1lXSA9IHVuZGVmaW5lZCk7fSwgc3RvcDogZnVuY3Rpb24gc3RvcCgpIHt0aGlzLmRvbmUgPSAhMDt2YXIgcm9vdFJlY29yZCA9IHRoaXMudHJ5RW50cmllc1swXS5jb21wbGV0aW9uO2lmICgidGhyb3ciID09PSByb290UmVjb3JkLnR5cGUpIHRocm93IHJvb3RSZWNvcmQuYXJnO3JldHVybiB0aGlzLnJ2YWw7fSwgZGlzcGF0Y2hFeGNlcHRpb246IGZ1bmN0aW9uIGRpc3BhdGNoRXhjZXB0aW9uKGV4Y2VwdGlvbikge2lmICh0aGlzLmRvbmUpIHRocm93IGV4Y2VwdGlvbjt2YXIgY29udGV4dCA9IHRoaXM7ZnVuY3Rpb24gaGFuZGxlKGxvYywgY2F1Z2h0KSB7cmV0dXJuIHJlY29yZC50eXBlID0gInRocm93IiwgcmVjb3JkLmFyZyA9IGV4Y2VwdGlvbiwgY29udGV4dC5uZXh0ID0gbG9jLCBjYXVnaHQgJiYgKGNvbnRleHQubWV0aG9kID0gIm5leHQiLCBjb250ZXh0LmFyZyA9IHVuZGVmaW5lZCksICEhY2F1Z2h0O31mb3IgKHZhciBpID0gdGhpcy50cnlFbnRyaWVzLmxlbmd0aCAtIDE7IGkgPj0gMDsgLS1pKSB7dmFyIGVudHJ5ID0gdGhpcy50cnlFbnRyaWVzW2ldLHJlY29yZCA9IGVudHJ5LmNvbXBsZXRpb247aWYgKCJyb290IiA9PT0gZW50cnkudHJ5TG9jKSByZXR1cm4gaGFuZGxlKCJlbmQiKTtpZiAoZW50cnkudHJ5TG9jIDw9IHRoaXMucHJldikge3ZhciBoYXNDYXRjaCA9IGhhc093bi5jYWxsKGVudHJ5LCAiY2F0Y2hMb2MiKSxoYXNGaW5hbGx5ID0gaGFzT3duLmNhbGwoZW50cnksICJmaW5hbGx5TG9jIik7aWYgKGhhc0NhdGNoICYmIGhhc0ZpbmFsbHkpIHtpZiAodGhpcy5wcmV2IDwgZW50cnkuY2F0Y2hMb2MpIHJldHVybiBoYW5kbGUoZW50cnkuY2F0Y2hMb2MsICEwKTtpZiAodGhpcy5wcmV2IDwgZW50cnkuZmluYWxseUxvYykgcmV0dXJuIGhhbmRsZShlbnRyeS5maW5hbGx5TG9jKTt9IGVsc2UgaWYgKGhhc0NhdGNoKSB7aWYgKHRoaXMucHJldiA8IGVudHJ5LmNhdGNoTG9jKSByZXR1cm4gaGFuZGxlKGVudHJ5LmNhdGNoTG9jLCAhMCk7fSBlbHNlIHtpZiAoIWhhc0ZpbmFsbHkpIHRocm93IG5ldyBFcnJvcigidHJ5IHN0YXRlbWVudCB3aXRob3V0IGNhdGNoIG9yIGZpbmFsbHkiKTtpZiAodGhpcy5wcmV2IDwgZW50cnkuZmluYWxseUxvYykgcmV0dXJuIGhhbmRsZShlbnRyeS5maW5hbGx5TG9jKTt9fX19LCBhYnJ1cHQ6IGZ1bmN0aW9uIGFicnVwdCh0eXBlLCBhcmcpIHtmb3IgKHZhciBpID0gdGhpcy50cnlFbnRyaWVzLmxlbmd0aCAtIDE7IGkgPj0gMDsgLS1pKSB7dmFyIGVudHJ5ID0gdGhpcy50cnlFbnRyaWVzW2ldO2lmIChlbnRyeS50cnlMb2MgPD0gdGhpcy5wcmV2ICYmIGhhc093bi5jYWxsKGVudHJ5LCAiZmluYWxseUxvYyIpICYmIHRoaXMucHJldiA8IGVudHJ5LmZpbmFsbHlMb2MpIHt2YXIgZmluYWxseUVudHJ5ID0gZW50cnk7YnJlYWs7fX1maW5hbGx5RW50cnkgJiYgKCJicmVhayIgPT09IHR5cGUgfHwgImNvbnRpbnVlIiA9PT0gdHlwZSkgJiYgZmluYWxseUVudHJ5LnRyeUxvYyA8PSBhcmcgJiYgYXJnIDw9IGZpbmFsbHlFbnRyeS5maW5hbGx5TG9jICYmIChmaW5hbGx5RW50cnkgPSBudWxsKTt2YXIgcmVjb3JkID0gZmluYWxseUVudHJ5ID8gZmluYWxseUVudHJ5LmNvbXBsZXRpb24gOiB7fTtyZXR1cm4gcmVjb3JkLnR5cGUgPSB0eXBlLCByZWNvcmQuYXJnID0gYXJnLCBmaW5hbGx5RW50cnkgPyAodGhpcy5tZXRob2QgPSAibmV4dCIsIHRoaXMubmV4dCA9IGZpbmFsbHlFbnRyeS5maW5hbGx5TG9jLCBDb250aW51ZVNlbnRpbmVsKSA6IHRoaXMuY29tcGxldGUocmVjb3JkKTt9LCBjb21wbGV0ZTogZnVuY3Rpb24gY29tcGxldGUocmVjb3JkLCBhZnRlckxvYykge2lmICgidGhyb3ciID09PSByZWNvcmQudHlwZSkgdGhyb3cgcmVjb3JkLmFyZztyZXR1cm4gImJyZWFrIiA9PT0gcmVjb3JkLnR5cGUgfHwgImNvbnRpbnVlIiA9PT0gcmVjb3JkLnR5cGUgPyB0aGlzLm5leHQgPSByZWNvcmQuYXJnIDogInJldHVybiIgPT09IHJlY29yZC50eXBlID8gKHRoaXMucnZhbCA9IHRoaXMuYXJnID0gcmVjb3JkLmFyZywgdGhpcy5tZXRob2QgPSAicmV0dXJuIiwgdGhpcy5uZXh0ID0gImVuZCIpIDogIm5vcm1hbCIgPT09IHJlY29yZC50eXBlICYmIGFmdGVyTG9jICYmICh0aGlzLm5leHQgPSBhZnRlckxvYyksIENvbnRpbnVlU2VudGluZWw7fSwgZmluaXNoOiBmdW5jdGlvbiBmaW5pc2goZmluYWxseUxvYykge2ZvciAodmFyIGkgPSB0aGlzLnRyeUVudHJpZXMubGVuZ3RoIC0gMTsgaSA+PSAwOyAtLWkpIHt2YXIgZW50cnkgPSB0aGlzLnRyeUVudHJpZXNbaV07aWYgKGVudHJ5LmZpbmFsbHlMb2MgPT09IGZpbmFsbHlMb2MpIHJldHVybiB0aGlzLmNvbXBsZXRlKGVudHJ5LmNvbXBsZXRpb24sIGVudHJ5LmFmdGVyTG9jKSwgcmVzZXRUcnlFbnRyeShlbnRyeSksIENvbnRpbnVlU2VudGluZWw7fX0sIGNhdGNoOiBmdW5jdGlvbiBfY2F0Y2godHJ5TG9jKSB7Zm9yICh2YXIgaSA9IHRoaXMudHJ5RW50cmllcy5sZW5ndGggLSAxOyBpID49IDA7IC0taSkge3ZhciBlbnRyeSA9IHRoaXMudHJ5RW50cmllc1tpXTtpZiAoZW50cnkudHJ5TG9jID09PSB0cnlMb2MpIHt2YXIgcmVjb3JkID0gZW50cnkuY29tcGxldGlvbjtpZiAoInRocm93IiA9PT0gcmVjb3JkLnR5cGUpIHt2YXIgdGhyb3duID0gcmVjb3JkLmFyZztyZXNldFRyeUVudHJ5KGVudHJ5KTt9cmV0dXJuIHRocm93bjt9fXRocm93IG5ldyBFcnJvcigiaWxsZWdhbCBjYXRjaCBhdHRlbXB0Iik7fSwgZGVsZWdhdGVZaWVsZDogZnVuY3Rpb24gZGVsZWdhdGVZaWVsZChpdGVyYWJsZSwgcmVzdWx0TmFtZSwgbmV4dExvYykge3JldHVybiB0aGlzLmRlbGVnYXRlID0geyBpdGVyYXRvcjogdmFsdWVzKGl0ZXJhYmxlKSwgcmVzdWx0TmFtZTogcmVzdWx0TmFtZSwgbmV4dExvYzogbmV4dExvYyB9LCAibmV4dCIgPT09IHRoaXMubWV0aG9kICYmICh0aGlzLmFyZyA9IHVuZGVmaW5lZCksIENvbnRpbnVlU2VudGluZWw7fSB9LCBleHBvcnRzO31mdW5jdGlvbiBhc3luY0dlbmVyYXRvclN0ZXAoZ2VuLCByZXNvbHZlLCByZWplY3QsIF9uZXh0LCBfdGhyb3csIGtleSwgYXJnKSB7dHJ5IHt2YXIgaW5mbyA9IGdlbltrZXldKGFyZyk7dmFyIHZhbHVlID0gaW5mby52YWx1ZTt9IGNhdGNoIChlcnJvcikge3JlamVjdChlcnJvcik7cmV0dXJuO31pZiAoaW5mby5kb25lKSB7cmVzb2x2ZSh2YWx1ZSk7fSBlbHNlIHtQcm9taXNlLnJlc29sdmUodmFsdWUpLnRoZW4oX25leHQsIF90aHJvdyk7fX1mdW5jdGlvbiBfYXN5bmNUb0dlbmVyYXRvcjIoZm4pIHtyZXR1cm4gZnVuY3Rpb24gKCkge3ZhciBzZWxmID0gdGhpcyxhcmdzID0gYXJndW1lbnRzO3JldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7dmFyIGdlbiA9IGZuLmFwcGx5KHNlbGYsIGFyZ3MpO2Z1bmN0aW9uIF9uZXh0KHZhbHVlKSB7YXN5bmNHZW5lcmF0b3JTdGVwKGdlbiwgcmVzb2x2ZSwgcmVqZWN0LCBfbmV4dCwgX3Rocm93LCAibmV4dCIsIHZhbHVlKTt9ZnVuY3Rpb24gX3Rocm93KGVycikge2FzeW5jR2VuZXJhdG9yU3RlcChnZW4sIHJlc29sdmUsIHJlamVjdCwgX25leHQsIF90aHJvdywgInRocm93IiwgZXJyKTt9X25leHQodW5kZWZpbmVkKTt9KTt9O31mdW5jdGlvbiBfZGVmaW5lUHJvcGVydHkyKG9iaiwga2V5LCB2YWx1ZSkge2tleSA9IF90b1Byb3BlcnR5S2V5MihrZXkpO2lmIChrZXkgaW4gb2JqKSB7T2JqZWN0LmRlZmluZVByb3BlcnR5KG9iaiwga2V5LCB7IHZhbHVlOiB2YWx1ZSwgZW51bWVyYWJsZTogdHJ1ZSwgY29uZmlndXJhYmxlOiB0cnVlLCB3cml0YWJsZTogdHJ1ZSB9KTt9IGVsc2Uge29ialtrZXldID0gdmFsdWU7fXJldHVybiBvYmo7fWZ1bmN0aW9uIF9kZWZpbmVQcm9wZXJ0aWVzKHRhcmdldCwgcHJvcHMpIHtmb3IgKHZhciBpID0gMDsgaSA8IHByb3BzLmxlbmd0aDsgaSsrKSB7dmFyIGRlc2NyaXB0b3IgPSBwcm9wc1tpXTtkZXNjcmlwdG9yLmVudW1lcmFibGUgPSBkZXNjcmlwdG9yLmVudW1lcmFibGUgfHwgZmFsc2U7ZGVzY3JpcHRvci5jb25maWd1cmFibGUgPSB0cnVlO2lmICgidmFsdWUiIGluIGRlc2NyaXB0b3IpIGRlc2NyaXB0b3Iud3JpdGFibGUgPSB0cnVlO09iamVjdC5kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIF90b1Byb3BlcnR5S2V5MihkZXNjcmlwdG9yLmtleSksIGRlc2NyaXB0b3IpO319ZnVuY3Rpb24gX2NyZWF0ZUNsYXNzMihDb25zdHJ1Y3RvciwgcHJvdG9Qcm9wcywgc3RhdGljUHJvcHMpIHtpZiAocHJvdG9Qcm9wcykgX2RlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IucHJvdG90eXBlLCBwcm90b1Byb3BzKTtpZiAoc3RhdGljUHJvcHMpIF9kZWZpbmVQcm9wZXJ0aWVzKENvbnN0cnVjdG9yLCBzdGF0aWNQcm9wcyk7T2JqZWN0LmRlZmluZVByb3BlcnR5KENvbnN0cnVjdG9yLCAicHJvdG90eXBlIiwgeyB3cml0YWJsZTogZmFsc2UgfSk7cmV0dXJuIENvbnN0cnVjdG9yO31mdW5jdGlvbiBfdG9Qcm9wZXJ0eUtleTIoYXJnKSB7dmFyIGtleSA9IF90b1ByaW1pdGl2ZTIoYXJnLCAic3RyaW5nIik7cmV0dXJuIHR5cGVvZiBrZXkgPT09ICJzeW1ib2wiID8ga2V5IDogU3RyaW5nKGtleSk7fWZ1bmN0aW9uIF90b1ByaW1pdGl2ZTIoaW5wdXQsIGhpbnQpIHtpZiAodHlwZW9mIGlucHV0ICE9PSAib2JqZWN0IiB8fCBpbnB1dCA9PT0gbnVsbCkgcmV0dXJuIGlucHV0O3ZhciBwcmltID0gaW5wdXRbU3ltYm9sLnRvUHJpbWl0aXZlXTtpZiAocHJpbSAhPT0gdW5kZWZpbmVkKSB7dmFyIHJlcyA9IHByaW0uY2FsbChpbnB1dCwgaGludCB8fCAiZGVmYXVsdCIpO2lmICh0eXBlb2YgcmVzICE9PSAib2JqZWN0IikgcmV0dXJuIHJlczt0aHJvdyBuZXcgVHlwZUVycm9yKCJAQHRvUHJpbWl0aXZlIG11c3QgcmV0dXJuIGEgcHJpbWl0aXZlIHZhbHVlLiIpO31yZXR1cm4gKGhpbnQgPT09ICJzdHJpbmciID8gU3RyaW5nIDogTnVtYmVyKShpbnB1dCk7fWZ1bmN0aW9uIF9jbGFzc0NhbGxDaGVjazIoaW5zdGFuY2UsIENvbnN0cnVjdG9yKSB7aWYgKCEoaW5zdGFuY2UgaW5zdGFuY2VvZiBDb25zdHJ1Y3RvcikpIHt0aHJvdyBuZXcgVHlwZUVycm9yKCJDYW5ub3QgY2FsbCBhIGNsYXNzIGFzIGEgZnVuY3Rpb24iKTt9fWZ1bmN0aW9uIF9pbmhlcml0cyhzdWJDbGFzcywgc3VwZXJDbGFzcykge2lmICh0eXBlb2Ygc3VwZXJDbGFzcyAhPT0gImZ1bmN0aW9uIiAmJiBzdXBlckNsYXNzICE9PSBudWxsKSB7dGhyb3cgbmV3IFR5cGVFcnJvcigiU3VwZXIgZXhwcmVzc2lvbiBtdXN0IGVpdGhlciBiZSBudWxsIG9yIGEgZnVuY3Rpb24iKTt9c3ViQ2xhc3MucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZShzdXBlckNsYXNzICYmIHN1cGVyQ2xhc3MucHJvdG90eXBlLCB7IGNvbnN0cnVjdG9yOiB7IHZhbHVlOiBzdWJDbGFzcywgd3JpdGFibGU6IHRydWUsIGNvbmZpZ3VyYWJsZTogdHJ1ZSB9IH0pO09iamVjdC5kZWZpbmVQcm9wZXJ0eShzdWJDbGFzcywgInByb3RvdHlwZSIsIHsgd3JpdGFibGU6IGZhbHNlIH0pO2lmIChzdXBlckNsYXNzKSBfc2V0UHJvdG90eXBlT2Yoc3ViQ2xhc3MsIHN1cGVyQ2xhc3MpO31mdW5jdGlvbiBfY3JlYXRlU3VwZXIoRGVyaXZlZCkge3ZhciBoYXNOYXRpdmVSZWZsZWN0Q29uc3RydWN0ID0gX2lzTmF0aXZlUmVmbGVjdENvbnN0cnVjdCgpO3JldHVybiBmdW5jdGlvbiBfY3JlYXRlU3VwZXJJbnRlcm5hbCgpIHt2YXIgU3VwZXIgPSBfZ2V0UHJvdG90eXBlT2YoRGVyaXZlZCkscmVzdWx0O2lmIChoYXNOYXRpdmVSZWZsZWN0Q29uc3RydWN0KSB7dmFyIE5ld1RhcmdldCA9IF9nZXRQcm90b3R5cGVPZih0aGlzKS5jb25zdHJ1Y3RvcjtyZXN1bHQgPSBSZWZsZWN0LmNvbnN0cnVjdChTdXBlciwgYXJndW1lbnRzLCBOZXdUYXJnZXQpO30gZWxzZSB7cmVzdWx0ID0gU3VwZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKTt9cmV0dXJuIF9wb3NzaWJsZUNvbnN0cnVjdG9yUmV0dXJuKHRoaXMsIHJlc3VsdCk7fTt9ZnVuY3Rpb24gX3Bvc3NpYmxlQ29uc3RydWN0b3JSZXR1cm4oc2VsZiwgY2FsbCkge2lmIChjYWxsICYmICh0eXBlb2YgY2FsbCA9PT0gIm9iamVjdCIgfHwgdHlwZW9mIGNhbGwgPT09ICJmdW5jdGlvbiIpKSB7cmV0dXJuIGNhbGw7fSBlbHNlIGlmIChjYWxsICE9PSB2b2lkIDApIHt0aHJvdyBuZXcgVHlwZUVycm9yKCJEZXJpdmVkIGNvbnN0cnVjdG9ycyBtYXkgb25seSByZXR1cm4gb2JqZWN0IG9yIHVuZGVmaW5lZCIpO31yZXR1cm4gX2Fzc2VydFRoaXNJbml0aWFsaXplZChzZWxmKTt9ZnVuY3Rpb24gX2Fzc2VydFRoaXNJbml0aWFsaXplZChzZWxmKSB7aWYgKHNlbGYgPT09IHZvaWQgMCkge3Rocm93IG5ldyBSZWZlcmVuY2VFcnJvcigidGhpcyBoYXNuJ3QgYmVlbiBpbml0aWFsaXNlZCAtIHN1cGVyKCkgaGFzbid0IGJlZW4gY2FsbGVkIik7fXJldHVybiBzZWxmO31mdW5jdGlvbiBfd3JhcE5hdGl2ZVN1cGVyKENsYXNzKSB7dmFyIF9jYWNoZSA9IHR5cGVvZiBNYXAgPT09ICJmdW5jdGlvbiIgPyBuZXcgTWFwKCkgOiB1bmRlZmluZWQ7X3dyYXBOYXRpdmVTdXBlciA9IGZ1bmN0aW9uIF93cmFwTmF0aXZlU3VwZXIoQ2xhc3MpIHtpZiAoQ2xhc3MgPT09IG51bGwgfHwgIV9pc05hdGl2ZUZ1bmN0aW9uKENsYXNzKSkgcmV0dXJuIENsYXNzO2lmICh0eXBlb2YgQ2xhc3MgIT09ICJmdW5jdGlvbiIpIHt0aHJvdyBuZXcgVHlwZUVycm9yKCJTdXBlciBleHByZXNzaW9uIG11c3QgZWl0aGVyIGJlIG51bGwgb3IgYSBmdW5jdGlvbiIpO31pZiAodHlwZW9mIF9jYWNoZSAhPT0gInVuZGVmaW5lZCIpIHtpZiAoX2NhY2hlLmhhcyhDbGFzcykpIHJldHVybiBfY2FjaGUuZ2V0KENsYXNzKTtfY2FjaGUuc2V0KENsYXNzLCBXcmFwcGVyKTt9ZnVuY3Rpb24gV3JhcHBlcigpIHtyZXR1cm4gX2NvbnN0cnVjdChDbGFzcywgYXJndW1lbnRzLCBfZ2V0UHJvdG90eXBlT2YodGhpcykuY29uc3RydWN0b3IpO31XcmFwcGVyLnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoQ2xhc3MucHJvdG90eXBlLCB7IGNvbnN0cnVjdG9yOiB7IHZhbHVlOiBXcmFwcGVyLCBlbnVtZXJhYmxlOiBmYWxzZSwgd3JpdGFibGU6IHRydWUsIGNvbmZpZ3VyYWJsZTogdHJ1ZSB9IH0pO3JldHVybiBfc2V0UHJvdG90eXBlT2YoV3JhcHBlciwgQ2xhc3MpO307cmV0dXJuIF93cmFwTmF0aXZlU3VwZXIoQ2xhc3MpO31mdW5jdGlvbiBfY29uc3RydWN0KFBhcmVudCwgYXJncywgQ2xhc3MpIHtpZiAoX2lzTmF0aXZlUmVmbGVjdENvbnN0cnVjdCgpKSB7X2NvbnN0cnVjdCA9IFJlZmxlY3QuY29uc3RydWN0LmJpbmQoKTt9IGVsc2Uge19jb25zdHJ1Y3QgPSBmdW5jdGlvbiBfY29uc3RydWN0KFBhcmVudCwgYXJncywgQ2xhc3MpIHt2YXIgYSA9IFtudWxsXTthLnB1c2guYXBwbHkoYSwgYXJncyk7dmFyIENvbnN0cnVjdG9yID0gRnVuY3Rpb24uYmluZC5hcHBseShQYXJlbnQsIGEpO3ZhciBpbnN0YW5jZSA9IG5ldyBDb25zdHJ1Y3RvcigpO2lmIChDbGFzcykgX3NldFByb3RvdHlwZU9mKGluc3RhbmNlLCBDbGFzcy5wcm90b3R5cGUpO3JldHVybiBpbnN0YW5jZTt9O31yZXR1cm4gX2NvbnN0cnVjdC5hcHBseShudWxsLCBhcmd1bWVudHMpO31mdW5jdGlvbiBfaXNOYXRpdmVSZWZsZWN0Q29uc3RydWN0KCkge2lmICh0eXBlb2YgUmVmbGVjdCA9PT0gInVuZGVmaW5lZCIgfHwgIVJlZmxlY3QuY29uc3RydWN0KSByZXR1cm4gZmFsc2U7aWYgKFJlZmxlY3QuY29uc3RydWN0LnNoYW0pIHJldHVybiBmYWxzZTtpZiAodHlwZW9mIFByb3h5ID09PSAiZnVuY3Rpb24iKSByZXR1cm4gdHJ1ZTt0cnkge0Jvb2xlYW4ucHJvdG90eXBlLnZhbHVlT2YuY2FsbChSZWZsZWN0LmNvbnN0cnVjdChCb29sZWFuLCBbXSwgZnVuY3Rpb24gKCkge30pKTtyZXR1cm4gdHJ1ZTt9IGNhdGNoIChlKSB7cmV0dXJuIGZhbHNlO319ZnVuY3Rpb24gX2lzTmF0aXZlRnVuY3Rpb24oZm4pIHtyZXR1cm4gRnVuY3Rpb24udG9TdHJpbmcuY2FsbChmbikuaW5kZXhPZigiW25hdGl2ZSBjb2RlXSIpICE9PSAtMTt9ZnVuY3Rpb24gX3NldFByb3RvdHlwZU9mKG8sIHApIHtfc2V0UHJvdG90eXBlT2YgPSBPYmplY3Quc2V0UHJvdG90eXBlT2YgPyBPYmplY3Quc2V0UHJvdG90eXBlT2YuYmluZCgpIDogZnVuY3Rpb24gX3NldFByb3RvdHlwZU9mKG8sIHApIHtvLl9fcHJvdG9fXyA9IHA7cmV0dXJuIG87fTtyZXR1cm4gX3NldFByb3RvdHlwZU9mKG8sIHApO31mdW5jdGlvbiBfZ2V0UHJvdG90eXBlT2Yobykge19nZXRQcm90b3R5cGVPZiA9IE9iamVjdC5zZXRQcm90b3R5cGVPZiA/IE9iamVjdC5nZXRQcm90b3R5cGVPZi5iaW5kKCkgOiBmdW5jdGlvbiBfZ2V0UHJvdG90eXBlT2Yobykge3JldHVybiBvLl9fcHJvdG9fXyB8fCBPYmplY3QuZ2V0UHJvdG90eXBlT2Yobyk7fTtyZXR1cm4gX2dldFByb3RvdHlwZU9mKG8pO31mdW5jdGlvbiBfc2xpY2VkVG9BcnJheTIoYXJyLCBpKSB7cmV0dXJuIF9hcnJheVdpdGhIb2xlczIoYXJyKSB8fCBfaXRlcmFibGVUb0FycmF5TGltaXQyKGFyciwgaSkgfHwgX3Vuc3VwcG9ydGVkSXRlcmFibGVUb0FycmF5MihhcnIsIGkpIHx8IF9ub25JdGVyYWJsZVJlc3QyKCk7fWZ1bmN0aW9uIF9pdGVyYWJsZVRvQXJyYXlMaW1pdDIoYXJyLCBpKSB7dmFyIF9pID0gbnVsbCA9PSBhcnIgPyBudWxsIDogInVuZGVmaW5lZCIgIT0gdHlwZW9mIFN5bWJvbCAmJiBhcnJbU3ltYm9sLml0ZXJhdG9yXSB8fCBhcnJbIkBAaXRlcmF0b3IiXTtpZiAobnVsbCAhPSBfaSkge3ZhciBfcyxfZSxfeCxfcixfYXJyID0gW10sX24gPSAhMCxfZCA9ICExO3RyeSB7aWYgKF94ID0gKF9pID0gX2kuY2FsbChhcnIpKS5uZXh0LCAwID09PSBpKSB7aWYgKE9iamVjdChfaSkgIT09IF9pKSByZXR1cm47X24gPSAhMTt9IGVsc2UgZm9yICg7ICEoX24gPSAoX3MgPSBfeC5jYWxsKF9pKSkuZG9uZSkgJiYgKF9hcnIucHVzaChfcy52YWx1ZSksIF9hcnIubGVuZ3RoICE9PSBpKTsgX24gPSAhMCk7fSBjYXRjaCAoZXJyKSB7X2QgPSAhMCwgX2UgPSBlcnI7fSBmaW5hbGx5IHt0cnkge2lmICghX24gJiYgbnVsbCAhPSBfaS5yZXR1cm4gJiYgKF9yID0gX2kucmV0dXJuKCksIE9iamVjdChfcikgIT09IF9yKSkgcmV0dXJuO30gZmluYWxseSB7aWYgKF9kKSB0aHJvdyBfZTt9fXJldHVybiBfYXJyO319ZnVuY3Rpb24gX3RvQXJyYXkoYXJyKSB7cmV0dXJuIF9hcnJheVdpdGhIb2xlczIoYXJyKSB8fCBfaXRlcmFibGVUb0FycmF5MihhcnIpIHx8IF91bnN1cHBvcnRlZEl0ZXJhYmxlVG9BcnJheTIoYXJyKSB8fCBfbm9uSXRlcmFibGVSZXN0MigpO31mdW5jdGlvbiBfbm9uSXRlcmFibGVSZXN0MigpIHt0aHJvdyBuZXcgVHlwZUVycm9yKCJJbnZhbGlkIGF0dGVtcHQgdG8gZGVzdHJ1Y3R1cmUgbm9uLWl0ZXJhYmxlIGluc3RhbmNlLlxuSW4gb3JkZXIgdG8gYmUgaXRlcmFibGUsIG5vbi1hcnJheSBvYmplY3RzIG11c3QgaGF2ZSBhIFtTeW1ib2wuaXRlcmF0b3JdKCkgbWV0aG9kLiIpO31mdW5jdGlvbiBfYXJyYXlXaXRoSG9sZXMyKGFycikge2lmIChBcnJheS5pc0FycmF5KGFycikpIHJldHVybiBhcnI7fWZ1bmN0aW9uIF9jcmVhdGVGb3JPZkl0ZXJhdG9ySGVscGVyMihvLCBhbGxvd0FycmF5TGlrZSkge3ZhciBpdCA9IHR5cGVvZiBTeW1ib2wgIT09ICJ1bmRlZmluZWQiICYmIG9bU3ltYm9sLml0ZXJhdG9yXSB8fCBvWyJAQGl0ZXJhdG9yIl07aWYgKCFpdCkge2lmIChBcnJheS5pc0FycmF5KG8pIHx8IChpdCA9IF91bnN1cHBvcnRlZEl0ZXJhYmxlVG9BcnJheTIobykpIHx8IGFsbG93QXJyYXlMaWtlICYmIG8gJiYgdHlwZW9mIG8ubGVuZ3RoID09PSAibnVtYmVyIikge2lmIChpdCkgbyA9IGl0O3ZhciBpID0gMDt2YXIgRiA9IGZ1bmN0aW9uIEYoKSB7fTtyZXR1cm4geyBzOiBGLCBuOiBmdW5jdGlvbiBuKCkge2lmIChpID49IG8ubGVuZ3RoKSByZXR1cm4geyBkb25lOiB0cnVlIH07cmV0dXJuIHsgZG9uZTogZmFsc2UsIHZhbHVlOiBvW2krK10gfTt9LCBlOiBmdW5jdGlvbiBlKF9lNCkge3Rocm93IF9lNDt9LCBmOiBGIH07fXRocm93IG5ldyBUeXBlRXJyb3IoIkludmFsaWQgYXR0ZW1wdCB0byBpdGVyYXRlIG5vbi1pdGVyYWJsZSBpbnN0YW5jZS5cbkluIG9yZGVyIHRvIGJlIGl0ZXJhYmxlLCBub24tYXJyYXkgb2JqZWN0cyBtdXN0IGhhdmUgYSBbU3ltYm9sLml0ZXJhdG9yXSgpIG1ldGhvZC4iKTt9dmFyIG5vcm1hbENvbXBsZXRpb24gPSB0cnVlLGRpZEVyciA9IGZhbHNlLGVycjtyZXR1cm4geyBzOiBmdW5jdGlvbiBzKCkge2l0ID0gaXQuY2FsbChvKTt9LCBuOiBmdW5jdGlvbiBuKCkge3ZhciBzdGVwID0gaXQubmV4dCgpO25vcm1hbENvbXBsZXRpb24gPSBzdGVwLmRvbmU7cmV0dXJuIHN0ZXA7fSwgZTogZnVuY3Rpb24gZShfZTUpIHtkaWRFcnIgPSB0cnVlO2VyciA9IF9lNTt9LCBmOiBmdW5jdGlvbiBmKCkge3RyeSB7aWYgKCFub3JtYWxDb21wbGV0aW9uICYmIGl0LnJldHVybiAhPSBudWxsKSBpdC5yZXR1cm4oKTt9IGZpbmFsbHkge2lmIChkaWRFcnIpIHRocm93IGVycjt9fSB9O31mdW5jdGlvbiBfdG9Db25zdW1hYmxlQXJyYXkyKGFycikge3JldHVybiBfYXJyYXlXaXRob3V0SG9sZXMyKGFycikgfHwgX2l0ZXJhYmxlVG9BcnJheTIoYXJyKSB8fCBfdW5zdXBwb3J0ZWRJdGVyYWJsZVRvQXJyYXkyKGFycikgfHwgX25vbkl0ZXJhYmxlU3ByZWFkMigpO31mdW5jdGlvbiBfbm9uSXRlcmFibGVTcHJlYWQyKCkge3Rocm93IG5ldyBUeXBlRXJyb3IoIkludmFsaWQgYXR0ZW1wdCB0byBzcHJlYWQgbm9uLWl0ZXJhYmxlIGluc3RhbmNlLlxuSW4gb3JkZXIgdG8gYmUgaXRlcmFibGUsIG5vbi1hcnJheSBvYmplY3RzIG11c3QgaGF2ZSBhIFtTeW1ib2wuaXRlcmF0b3JdKCkgbWV0aG9kLiIpO31mdW5jdGlvbiBfdW5zdXBwb3J0ZWRJdGVyYWJsZVRvQXJyYXkyKG8sIG1pbkxlbikge2lmICghbykgcmV0dXJuO2lmICh0eXBlb2YgbyA9PT0gInN0cmluZyIpIHJldHVybiBfYXJyYXlMaWtlVG9BcnJheTIobywgbWluTGVuKTt2YXIgbiA9IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChvKS5zbGljZSg4LCAtMSk7aWYgKG4gPT09ICJPYmplY3QiICYmIG8uY29uc3RydWN0b3IpIG4gPSBvLmNvbnN0cnVjdG9yLm5hbWU7aWYgKG4gPT09ICJNYXAiIHx8IG4gPT09ICJTZXQiKSByZXR1cm4gQXJyYXkuZnJvbShvKTtpZiAobiA9PT0gIkFyZ3VtZW50cyIgfHwgL14oPzpVaXxJKW50KD86OHwxNnwzMikoPzpDbGFtcGVkKT9BcnJheSQvLnRlc3QobikpIHJldHVybiBfYXJyYXlMaWtlVG9BcnJheTIobywgbWluTGVuKTt9ZnVuY3Rpb24gX2l0ZXJhYmxlVG9BcnJheTIoaXRlcikge2lmICh0eXBlb2YgU3ltYm9sICE9PSAidW5kZWZpbmVkIiAmJiBpdGVyW1N5bWJvbC5pdGVyYXRvcl0gIT0gbnVsbCB8fCBpdGVyWyJAQGl0ZXJhdG9yIl0gIT0gbnVsbCkgcmV0dXJuIEFycmF5LmZyb20oaXRlcik7fWZ1bmN0aW9uIF9hcnJheVdpdGhvdXRIb2xlczIoYXJyKSB7aWYgKEFycmF5LmlzQXJyYXkoYXJyKSkgcmV0dXJuIF9hcnJheUxpa2VUb0FycmF5MihhcnIpO31mdW5jdGlvbiBfYXJyYXlMaWtlVG9BcnJheTIoYXJyLCBsZW4pIHtpZiAobGVuID09IG51bGwgfHwgbGVuID4gYXJyLmxlbmd0aCkgbGVuID0gYXJyLmxlbmd0aDtmb3IgKHZhciBpID0gMCwgYXJyMiA9IG5ldyBBcnJheShsZW4pOyBpIDwgbGVuOyBpKyspIGFycjJbaV0gPSBhcnJbaV07cmV0dXJuIGFycjI7fShmdW5jdGlvbiB3ZWJwYWNrVW5pdmVyc2FsTW9kdWxlRGVmaW5pdGlvbihyb290LCBmYWN0b3J5KSB7aWYgKHR5cGVvZiBleHBvcnRzID09PSAnb2JqZWN0JyAmJiB0eXBlb2YgbW9kdWxlID09PSAnb2JqZWN0JykKICBtb2R1bGUuZXhwb3J0cyA9IGZhY3RvcnkoKTtlbHNlCiAgaWYgKHR5cGVvZiBkZWZpbmUgPT09ICdmdW5jdGlvbicgJiYgZGVmaW5lLmFtZCkKICBkZWZpbmUoW10sIGZhY3RvcnkpO2Vsc2UKICB7CiAgICB2YXIgYSA9IGZhY3RvcnkoKTsKICAgIGZvciAodmFyIGkgaW4gYSkgKHR5cGVvZiBleHBvcnRzID09PSAnb2JqZWN0JyA/IGV4cG9ydHMgOiByb290KVtpXSA9IGFbaV07CiAgfQp9KShzZWxmLCAoKSA9PiB7CiAgcmV0dXJuICgvKioqKioqLygoKSA9PiB7Ly8gd2VicGFja0Jvb3RzdHJhcAogICAgICAvKioqKioqLyJ1c2Ugc3RyaWN0IjsKICAgICAgLyoqKioqKi92YXIgX193ZWJwYWNrX21vZHVsZXNfXyA9IHsKCiAgICAgICAgLyoqKi84ODc6CiAgICAgICAgLyoqKi8oX191bnVzZWRfd2VicGFja19tb2R1bGUsIF9fd2VicGFja19leHBvcnRzX18sIF9fd2VicGFja19yZXF1aXJlX18pID0+IHsKCgogICAgICAgICAgLy8gRVhQT1JUUwogICAgICAgICAgX193ZWJwYWNrX3JlcXVpcmVfXy5kKF9fd2VicGFja19leHBvcnRzX18sIHsKICAgICAgICAgICAgIloiOiAoKSA9PiAvKiBiaW5kaW5nICovcmVsYXlfQXBwCiAgICAgICAgICB9KTsKCiAgICAgICAgICA7IC8vIENPTkNBVEVOQVRFRCBNT0RVTEU6IC4vbm9kZV9tb2R1bGVzL0ByZW1peC1ydW4vcm91dGVyL2Rpc3Qvcm91dGVyLmpzCiAgICAgICAgICAvKioKICAgICAgICAgICAqIEByZW1peC1ydW4vcm91dGVyIHYxLjMuMQogICAgICAgICAgICoKICAgICAgICAgICAqIENvcHlyaWdodCAoYykgUmVtaXggU29mdHdhcmUgSW5jLgogICAgICAgICAgICoKICAgICAgICAgICAqIFRoaXMgc291cmNlIGNvZGUgaXMgbGljZW5zZWQgdW5kZXIgdGhlIE1JVCBsaWNlbnNlIGZvdW5kIGluIHRoZQogICAgICAgICAgICogTElDRU5TRS5tZCBmaWxlIGluIHRoZSByb290IGRpcmVjdG9yeSBvZiB0aGlzIHNvdXJjZSB0cmVlLgogICAgICAgICAgICoKICAgICAgICAgICAqIEBsaWNlbnNlIE1JVAogICAgICAgICAgICovCiAgICAgICAgICBmdW5jdGlvbiBfZXh0ZW5kcygpIHsKICAgICAgICAgICAgX2V4dGVuZHMgPSBPYmplY3QuYXNzaWduID8gT2JqZWN0LmFzc2lnbi5iaW5kKCkgOiBmdW5jdGlvbiAodGFyZ2V0KSB7CiAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDE7IGkgPCBhcmd1bWVudHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICAgIHZhciBzb3VyY2UgPSBhcmd1bWVudHNbaV07CgogICAgICAgICAgICAgICAgZm9yICh2YXIga2V5IGluIHNvdXJjZSkgewogICAgICAgICAgICAgICAgICBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKHNvdXJjZSwga2V5KSkgewogICAgICAgICAgICAgICAgICAgIHRhcmdldFtrZXldID0gc291cmNlW2tleV07CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIHJldHVybiB0YXJnZXQ7CiAgICAgICAgICAgIH07CiAgICAgICAgICAgIHJldHVybiBfZXh0ZW5kcy5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICAgICAgfQoKICAgICAgICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCiAgICAgICAgICAvLyNyZWdpb24gVHlwZXMgYW5kIENvbnN0YW50cwogICAgICAgICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KCiAgICAgICAgICAvKioKICAgICAgICAgICAqIEFjdGlvbnMgcmVwcmVzZW50IHRoZSB0eXBlIG9mIGNoYW5nZSB0byBhIGxvY2F0aW9uIHZhbHVlLgogICAgICAgICAgICovCiAgICAgICAgICB2YXIgQWN0aW9uOwoKICAgICAgICAgIChmdW5jdGlvbiAoQWN0aW9uKSB7CiAgICAgICAgICAgIC8qKgogICAgICAgICAgICAgKiBBIFBPUCBpbmRpY2F0ZXMgYSBjaGFuZ2UgdG8gYW4gYXJiaXRyYXJ5IGluZGV4IGluIHRoZSBoaXN0b3J5IHN0YWNrLCBzdWNoCiAgICAgICAgICAgICAqIGFzIGEgYmFjayBvciBmb3J3YXJkIG5hdmlnYXRpb24uIEl0IGRvZXMgbm90IGRlc2NyaWJlIHRoZSBkaXJlY3Rpb24gb2YgdGhlCiAgICAgICAgICAgICAqIG5hdmlnYXRpb24sIG9ubHkgdGhhdCB0aGUgY3VycmVudCBpbmRleCBjaGFuZ2VkLgogICAgICAgICAgICAgKgogICAgICAgICAgICAgKiBOb3RlOiBUaGlzIGlzIHRoZSBkZWZhdWx0IGFjdGlvbiBmb3IgbmV3bHkgY3JlYXRlZCBoaXN0b3J5IG9iamVjdHMuCiAgICAgICAgICAgICAqLwogICAgICAgICAgICBBY3Rpb25bIlBvcCJdID0gIlBPUCI7CiAgICAgICAgICAgIC8qKgogICAgICAgICAgICAgKiBBIFBVU0ggaW5kaWNhdGVzIGEgbmV3IGVudHJ5IGJlaW5nIGFkZGVkIHRvIHRoZSBoaXN0b3J5IHN0YWNrLCBzdWNoIGFzIHdoZW4KICAgICAgICAgICAgICogYSBsaW5rIGlzIGNsaWNrZWQgYW5kIGEgbmV3IHBhZ2UgbG9hZHMuIFdoZW4gdGhpcyBoYXBwZW5zLCBhbGwgc3Vic2VxdWVudAogICAgICAgICAgICAgKiBlbnRyaWVzIGluIHRoZSBzdGFjayBhcmUgbG9zdC4KICAgICAgICAgICAgICovCgogICAgICAgICAgICBBY3Rpb25bIlB1c2giXSA9ICJQVVNIIjsKICAgICAgICAgICAgLyoqCiAgICAgICAgICAgICAqIEEgUkVQTEFDRSBpbmRpY2F0ZXMgdGhlIGVudHJ5IGF0IHRoZSBjdXJyZW50IGluZGV4IGluIHRoZSBoaXN0b3J5IHN0YWNrCiAgICAgICAgICAgICAqIGJlaW5nIHJlcGxhY2VkIGJ5IGEgbmV3IG9uZS4KICAgICAgICAgICAgICovCgogICAgICAgICAgICBBY3Rpb25bIlJlcGxhY2UiXSA9ICJSRVBMQUNFIjsKICAgICAgICAgIH0pKEFjdGlvbiB8fCAoQWN0aW9uID0ge30pKTsKCiAgICAgICAgICB2YXIgUG9wU3RhdGVFdmVudFR5cGUgPSAicG9wc3RhdGUiOwogICAgICAgICAgLyoqCiAgICAgICAgICAgKiBNZW1vcnkgaGlzdG9yeSBzdG9yZXMgdGhlIGN1cnJlbnQgbG9jYXRpb24gaW4gbWVtb3J5LiBJdCBpcyBkZXNpZ25lZCBmb3IgdXNlCiAgICAgICAgICAgKiBpbiBzdGF0ZWZ1bCBub24tYnJvd3NlciBlbnZpcm9ubWVudHMgbGlrZSB0ZXN0cyBhbmQgUmVhY3QgTmF0aXZlLgogICAgICAgICAgICovCgogICAgICAgICAgZnVuY3Rpb24gcm91dGVyX2NyZWF0ZU1lbW9yeUhpc3Rvcnkob3B0aW9ucykgewogICAgICAgICAgICBpZiAob3B0aW9ucyA9PT0gdm9pZCAwKSB7CiAgICAgICAgICAgICAgb3B0aW9ucyA9IHt9OwogICAgICAgICAgICB9CgogICAgICAgICAgICB2YXIgX29wdGlvbnMgPQoKCgogICAgICAgICAgICAgIG9wdGlvbnMsX29wdGlvbnMkaW5pdGlhbEVudHJpID0gX29wdGlvbnMuaW5pdGlhbEVudHJpZXMsaW5pdGlhbEVudHJpZXMgPSBfb3B0aW9ucyRpbml0aWFsRW50cmkgPT09IHZvaWQgMCA/IFsiLyJdIDogX29wdGlvbnMkaW5pdGlhbEVudHJpLGluaXRpYWxJbmRleCA9IF9vcHRpb25zLmluaXRpYWxJbmRleCxfb3B0aW9ucyR2NUNvbXBhdCA9IF9vcHRpb25zLnY1Q29tcGF0LHY1Q29tcGF0ID0gX29wdGlvbnMkdjVDb21wYXQgPT09IHZvaWQgMCA/IGZhbHNlIDogX29wdGlvbnMkdjVDb21wYXQ7CiAgICAgICAgICAgIHZhciBlbnRyaWVzOyAvLyBEZWNsYXJlIHNvIHdlIGNhbiBhY2Nlc3MgZnJvbSBjcmVhdGVNZW1vcnlMb2NhdGlvbgoKICAgICAgICAgICAgZW50cmllcyA9IGluaXRpYWxFbnRyaWVzLm1hcCgoZW50cnksIGluZGV4KSA9PiBjcmVhdGVNZW1vcnlMb2NhdGlvbihlbnRyeSwgdHlwZW9mIGVudHJ5ID09PSAic3RyaW5nIiA/IG51bGwgOiBlbnRyeS5zdGF0ZSwgaW5kZXggPT09IDAgPyAiZGVmYXVsdCIgOiB1bmRlZmluZWQpKTsKICAgICAgICAgICAgdmFyIGluZGV4ID0gY2xhbXBJbmRleChpbml0aWFsSW5kZXggPT0gbnVsbCA/IGVudHJpZXMubGVuZ3RoIC0gMSA6IGluaXRpYWxJbmRleCk7CiAgICAgICAgICAgIHZhciBhY3Rpb24gPSBBY3Rpb24uUG9wOwogICAgICAgICAgICB2YXIgbGlzdGVuZXIgPSBudWxsOwoKICAgICAgICAgICAgZnVuY3Rpb24gY2xhbXBJbmRleChuKSB7CiAgICAgICAgICAgICAgcmV0dXJuIE1hdGgubWluKE1hdGgubWF4KG4sIDApLCBlbnRyaWVzLmxlbmd0aCAtIDEpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBmdW5jdGlvbiBnZXRDdXJyZW50TG9jYXRpb24oKSB7CiAgICAgICAgICAgICAgcmV0dXJuIGVudHJpZXNbaW5kZXhdOwogICAgICAgICAgICB9CgogICAgICAgICAgICBmdW5jdGlvbiBjcmVhdGVNZW1vcnlMb2NhdGlvbih0bywgc3RhdGUsIGtleSkgewogICAgICAgICAgICAgIGlmIChzdGF0ZSA9PT0gdm9pZCAwKSB7CiAgICAgICAgICAgICAgICBzdGF0ZSA9IG51bGw7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICB2YXIgbG9jYXRpb24gPSBjcmVhdGVMb2NhdGlvbihlbnRyaWVzID8gZ2V0Q3VycmVudExvY2F0aW9uKCkucGF0aG5hbWUgOiAiLyIsIHRvLCBzdGF0ZSwga2V5KTsKICAgICAgICAgICAgICB3YXJuaW5nJDEobG9jYXRpb24ucGF0aG5hbWUuY2hhckF0KDApID09PSAiLyIsICJyZWxhdGl2ZSBwYXRobmFtZXMgYXJlIG5vdCBzdXBwb3J0ZWQgaW4gbWVtb3J5IGhpc3Rvcnk6ICIgKyBKU09OLnN0cmluZ2lmeSh0bykpOwogICAgICAgICAgICAgIHJldHVybiBsb2NhdGlvbjsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgZnVuY3Rpb24gY3JlYXRlSHJlZih0bykgewogICAgICAgICAgICAgIHJldHVybiB0eXBlb2YgdG8gPT09ICJzdHJpbmciID8gdG8gOiByb3V0ZXJfY3JlYXRlUGF0aCh0byk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHZhciBoaXN0b3J5ID0gewogICAgICAgICAgICAgIGdldCBpbmRleCgpIHsKICAgICAgICAgICAgICAgIHJldHVybiBpbmRleDsKICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICBnZXQgYWN0aW9uKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIGFjdGlvbjsKICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICBnZXQgbG9jYXRpb24oKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gZ2V0Q3VycmVudExvY2F0aW9uKCk7CiAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgY3JlYXRlSHJlZjogY3JlYXRlSHJlZiwKCiAgICAgICAgICAgICAgY3JlYXRlVVJMOiBmdW5jdGlvbiBjcmVhdGVVUkwodG8pIHsKICAgICAgICAgICAgICAgIHJldHVybiBuZXcgVVJMKGNyZWF0ZUhyZWYodG8pLCAiaHR0cDovL2xvY2FsaG9zdCIpOwogICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgIGVuY29kZUxvY2F0aW9uOiBmdW5jdGlvbiBlbmNvZGVMb2NhdGlvbih0bykgewogICAgICAgICAgICAgICAgdmFyIHBhdGggPSB0eXBlb2YgdG8gPT09ICJzdHJpbmciID8gcGFyc2VQYXRoKHRvKSA6IHRvOwogICAgICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgICAgcGF0aG5hbWU6IHBhdGgucGF0aG5hbWUgfHwgIiIsCiAgICAgICAgICAgICAgICAgIHNlYXJjaDogcGF0aC5zZWFyY2ggfHwgIiIsCiAgICAgICAgICAgICAgICAgIGhhc2g6IHBhdGguaGFzaCB8fCAiIgogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICBwdXNoOiBmdW5jdGlvbiBwdXNoKHRvLCBzdGF0ZSkgewogICAgICAgICAgICAgICAgYWN0aW9uID0gQWN0aW9uLlB1c2g7CiAgICAgICAgICAgICAgICB2YXIgbmV4dExvY2F0aW9uID0gY3JlYXRlTWVtb3J5TG9jYXRpb24odG8sIHN0YXRlKTsKICAgICAgICAgICAgICAgIGluZGV4ICs9IDE7CiAgICAgICAgICAgICAgICBlbnRyaWVzLnNwbGljZShpbmRleCwgZW50cmllcy5sZW5ndGgsIG5leHRMb2NhdGlvbik7CgogICAgICAgICAgICAgICAgaWYgKHY1Q29tcGF0ICYmIGxpc3RlbmVyKSB7CiAgICAgICAgICAgICAgICAgIGxpc3RlbmVyKHsKICAgICAgICAgICAgICAgICAgICBhY3Rpb246IGFjdGlvbiwKICAgICAgICAgICAgICAgICAgICBsb2NhdGlvbjogbmV4dExvY2F0aW9uLAogICAgICAgICAgICAgICAgICAgIGRlbHRhOiAxCiAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgIHJlcGxhY2U6IGZ1bmN0aW9uIHJlcGxhY2UodG8sIHN0YXRlKSB7CiAgICAgICAgICAgICAgICBhY3Rpb24gPSBBY3Rpb24uUmVwbGFjZTsKICAgICAgICAgICAgICAgIHZhciBuZXh0TG9jYXRpb24gPSBjcmVhdGVNZW1vcnlMb2NhdGlvbih0bywgc3RhdGUpOwogICAgICAgICAgICAgICAgZW50cmllc1tpbmRleF0gPSBuZXh0TG9jYXRpb247CgogICAgICAgICAgICAgICAgaWYgKHY1Q29tcGF0ICYmIGxpc3RlbmVyKSB7CiAgICAgICAgICAgICAgICAgIGxpc3RlbmVyKHsKICAgICAgICAgICAgICAgICAgICBhY3Rpb246IGFjdGlvbiwKICAgICAgICAgICAgICAgICAgICBsb2NhdGlvbjogbmV4dExvY2F0aW9uLAogICAgICAgICAgICAgICAgICAgIGRlbHRhOiAwCiAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgIGdvOiBmdW5jdGlvbiBnbyhkZWx0YSkgewogICAgICAgICAgICAgICAgYWN0aW9uID0gQWN0aW9uLlBvcDsKICAgICAgICAgICAgICAgIHZhciBuZXh0SW5kZXggPSBjbGFtcEluZGV4KGluZGV4ICsgZGVsdGEpOwogICAgICAgICAgICAgICAgdmFyIG5leHRMb2NhdGlvbiA9IGVudHJpZXNbbmV4dEluZGV4XTsKICAgICAgICAgICAgICAgIGluZGV4ID0gbmV4dEluZGV4OwoKICAgICAgICAgICAgICAgIGlmIChsaXN0ZW5lcikgewogICAgICAgICAgICAgICAgICBsaXN0ZW5lcih7CiAgICAgICAgICAgICAgICAgICAgYWN0aW9uOiBhY3Rpb24sCiAgICAgICAgICAgICAgICAgICAgbG9jYXRpb246IG5leHRMb2NhdGlvbiwKICAgICAgICAgICAgICAgICAgICBkZWx0YTogZGVsdGEKICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgbGlzdGVuOiBmdW5jdGlvbiBsaXN0ZW4oZm4pIHsKICAgICAgICAgICAgICAgIGxpc3RlbmVyID0gZm47CiAgICAgICAgICAgICAgICByZXR1cm4gKCkgPT4gewogICAgICAgICAgICAgICAgICBsaXN0ZW5lciA9IG51bGw7CiAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgIH07CiAgICAgICAgICAgIHJldHVybiBoaXN0b3J5OwogICAgICAgICAgfQogICAgICAgICAgLyoqCiAgICAgICAgICAgKiBCcm93c2VyIGhpc3Rvcnkgc3RvcmVzIHRoZSBsb2NhdGlvbiBpbiByZWd1bGFyIFVSTHMuIFRoaXMgaXMgdGhlIHN0YW5kYXJkIGZvcgogICAgICAgICAgICogbW9zdCB3ZWIgYXBwcywgYnV0IGl0IHJlcXVpcmVzIHNvbWUgY29uZmlndXJhdGlvbiBvbiB0aGUgc2VydmVyIHRvIGVuc3VyZSB5b3UKICAgICAgICAgICAqIHNlcnZlIHRoZSBzYW1lIGFwcCBhdCBtdWx0aXBsZSBVUkxzLgogICAgICAgICAgICoKICAgICAgICAgICAqIEBzZWUgaHR0cHM6Ly9naXRodWIuY29tL3JlbWl4LXJ1bi9oaXN0b3J5L3RyZWUvbWFpbi9kb2NzL2FwaS1yZWZlcmVuY2UubWQjY3JlYXRlYnJvd3Nlcmhpc3RvcnkKICAgICAgICAgICAqLwoKICAgICAgICAgIGZ1bmN0aW9uIHJvdXRlcl9jcmVhdGVCcm93c2VySGlzdG9yeShvcHRpb25zKSB7CiAgICAgICAgICAgIGlmIChvcHRpb25zID09PSB2b2lkIDApIHsKICAgICAgICAgICAgICBvcHRpb25zID0ge307CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGZ1bmN0aW9uIGNyZWF0ZUJyb3dzZXJMb2NhdGlvbih3aW5kb3csIGdsb2JhbEhpc3RvcnkpIHsKICAgICAgICAgICAgICB2YXIgX3dpbmRvdyRsb2NhdGlvbiA9CgoKCiAgICAgICAgICAgICAgICB3aW5kb3cubG9jYXRpb24scGF0aG5hbWUgPSBfd2luZG93JGxvY2F0aW9uLnBhdGhuYW1lLHNlYXJjaCA9IF93aW5kb3ckbG9jYXRpb24uc2VhcmNoLGhhc2ggPSBfd2luZG93JGxvY2F0aW9uLmhhc2g7CiAgICAgICAgICAgICAgcmV0dXJuIGNyZWF0ZUxvY2F0aW9uKCIiLCB7CiAgICAgICAgICAgICAgICBwYXRobmFtZTogcGF0aG5hbWUsCiAgICAgICAgICAgICAgICBzZWFyY2g6IHNlYXJjaCwKICAgICAgICAgICAgICAgIGhhc2g6IGhhc2gKICAgICAgICAgICAgICB9LCAvLyBzdGF0ZSBkZWZhdWx0cyB0byBgbnVsbGAgYmVjYXVzZSBgd2luZG93Lmhpc3Rvcnkuc3RhdGVgIGRvZXMKICAgICAgICAgICAgICBnbG9iYWxIaXN0b3J5LnN0YXRlICYmIGdsb2JhbEhpc3Rvcnkuc3RhdGUudXNyIHx8IG51bGwsIGdsb2JhbEhpc3Rvcnkuc3RhdGUgJiYgZ2xvYmFsSGlzdG9yeS5zdGF0ZS5rZXkgfHwgImRlZmF1bHQiKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgZnVuY3Rpb24gY3JlYXRlQnJvd3NlckhyZWYod2luZG93LCB0bykgewogICAgICAgICAgICAgIHJldHVybiB0eXBlb2YgdG8gPT09ICJzdHJpbmciID8gdG8gOiByb3V0ZXJfY3JlYXRlUGF0aCh0byk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybiBnZXRVcmxCYXNlZEhpc3RvcnkoY3JlYXRlQnJvd3NlckxvY2F0aW9uLCBjcmVhdGVCcm93c2VySHJlZiwgbnVsbCwgb3B0aW9ucyk7CiAgICAgICAgICB9CiAgICAgICAgICAvKioKICAgICAgICAgICAqIEhhc2ggaGlzdG9yeSBzdG9yZXMgdGhlIGxvY2F0aW9uIGluIHdpbmRvdy5sb2NhdGlvbi5oYXNoLiBUaGlzIG1ha2VzIGl0IGlkZWFsCiAgICAgICAgICAgKiBmb3Igc2l0dWF0aW9ucyB3aGVyZSB5b3UgZG9uJ3Qgd2FudCB0byBzZW5kIHRoZSBsb2NhdGlvbiB0byB0aGUgc2VydmVyIGZvcgogICAgICAgICAgICogc29tZSByZWFzb24sIGVpdGhlciBiZWNhdXNlIHlvdSBkbyBjYW5ub3QgY29uZmlndXJlIGl0IG9yIHRoZSBVUkwgc3BhY2UgaXMKICAgICAgICAgICAqIHJlc2VydmVkIGZvciBzb21ldGhpbmcgZWxzZS4KICAgICAgICAgICAqCiAgICAgICAgICAgKiBAc2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9yZW1peC1ydW4vaGlzdG9yeS90cmVlL21haW4vZG9jcy9hcGktcmVmZXJlbmNlLm1kI2NyZWF0ZWhhc2hoaXN0b3J5CiAgICAgICAgICAgKi8KCiAgICAgICAgICBmdW5jdGlvbiByb3V0ZXJfY3JlYXRlSGFzaEhpc3Rvcnkob3B0aW9ucykgewogICAgICAgICAgICBpZiAob3B0aW9ucyA9PT0gdm9pZCAwKSB7CiAgICAgICAgICAgICAgb3B0aW9ucyA9IHt9OwogICAgICAgICAgICB9CgogICAgICAgICAgICBmdW5jdGlvbiBjcmVhdGVIYXNoTG9jYXRpb24od2luZG93LCBnbG9iYWxIaXN0b3J5KSB7CiAgICAgICAgICAgICAgdmFyIF9wYXJzZVBhdGggPQoKCgogICAgICAgICAgICAgICAgcGFyc2VQYXRoKHdpbmRvdy5sb2NhdGlvbi5oYXNoLnN1YnN0cigxKSksX3BhcnNlUGF0aCRwYXRobmFtZSA9IF9wYXJzZVBhdGgucGF0aG5hbWUscGF0aG5hbWUgPSBfcGFyc2VQYXRoJHBhdGhuYW1lID09PSB2b2lkIDAgPyAiLyIgOiBfcGFyc2VQYXRoJHBhdGhuYW1lLF9wYXJzZVBhdGgkc2VhcmNoID0gX3BhcnNlUGF0aC5zZWFyY2gsc2VhcmNoID0gX3BhcnNlUGF0aCRzZWFyY2ggPT09IHZvaWQgMCA/ICIiIDogX3BhcnNlUGF0aCRzZWFyY2gsX3BhcnNlUGF0aCRoYXNoID0gX3BhcnNlUGF0aC5oYXNoLGhhc2ggPSBfcGFyc2VQYXRoJGhhc2ggPT09IHZvaWQgMCA/ICIiIDogX3BhcnNlUGF0aCRoYXNoOwogICAgICAgICAgICAgIHJldHVybiBjcmVhdGVMb2NhdGlvbigiIiwgewogICAgICAgICAgICAgICAgcGF0aG5hbWU6IHBhdGhuYW1lLAogICAgICAgICAgICAgICAgc2VhcmNoOiBzZWFyY2gsCiAgICAgICAgICAgICAgICBoYXNoOiBoYXNoCiAgICAgICAgICAgICAgfSwgLy8gc3RhdGUgZGVmYXVsdHMgdG8gYG51bGxgIGJlY2F1c2UgYHdpbmRvdy5oaXN0b3J5LnN0YXRlYCBkb2VzCiAgICAgICAgICAgICAgZ2xvYmFsSGlzdG9yeS5zdGF0ZSAmJiBnbG9iYWxIaXN0b3J5LnN0YXRlLnVzciB8fCBudWxsLCBnbG9iYWxIaXN0b3J5LnN0YXRlICYmIGdsb2JhbEhpc3Rvcnkuc3RhdGUua2V5IHx8ICJkZWZhdWx0Iik7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGZ1bmN0aW9uIGNyZWF0ZUhhc2hIcmVmKHdpbmRvdywgdG8pIHsKICAgICAgICAgICAgICB2YXIgYmFzZSA9IHdpbmRvdy5kb2N1bWVudC5xdWVyeVNlbGVjdG9yKCJiYXNlIik7CiAgICAgICAgICAgICAgdmFyIGhyZWYgPSAiIjsKCiAgICAgICAgICAgICAgaWYgKGJhc2UgJiYgYmFzZS5nZXRBdHRyaWJ1dGUoImhyZWYiKSkgewogICAgICAgICAgICAgICAgdmFyIHVybCA9IHdpbmRvdy5sb2NhdGlvbi5ocmVmOwogICAgICAgICAgICAgICAgdmFyIGhhc2hJbmRleCA9IHVybC5pbmRleE9mKCIjIik7CiAgICAgICAgICAgICAgICBocmVmID0gaGFzaEluZGV4ID09PSAtMSA/IHVybCA6IHVybC5zbGljZSgwLCBoYXNoSW5kZXgpOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgcmV0dXJuIGhyZWYgKyAiIyIgKyAodHlwZW9mIHRvID09PSAic3RyaW5nIiA/IHRvIDogcm91dGVyX2NyZWF0ZVBhdGgodG8pKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgZnVuY3Rpb24gdmFsaWRhdGVIYXNoTG9jYXRpb24obG9jYXRpb24sIHRvKSB7CiAgICAgICAgICAgICAgd2FybmluZyQxKGxvY2F0aW9uLnBhdGhuYW1lLmNoYXJBdCgwKSA9PT0gIi8iLCAicmVsYXRpdmUgcGF0aG5hbWVzIGFyZSBub3Qgc3VwcG9ydGVkIGluIGhhc2ggaGlzdG9yeS5wdXNoKCIgKyBKU09OLnN0cmluZ2lmeSh0bykgKyAiKSIpOwogICAgICAgICAgICB9CgogICAgICAgICAgICByZXR1cm4gZ2V0VXJsQmFzZWRIaXN0b3J5KGNyZWF0ZUhhc2hMb2NhdGlvbiwgY3JlYXRlSGFzaEhyZWYsIHZhbGlkYXRlSGFzaExvY2F0aW9uLCBvcHRpb25zKTsKICAgICAgICAgIH0KICAgICAgICAgIGZ1bmN0aW9uIHJvdXRlcl9pbnZhcmlhbnQodmFsdWUsIG1lc3NhZ2UpIHsKICAgICAgICAgICAgaWYgKHZhbHVlID09PSBmYWxzZSB8fCB2YWx1ZSA9PT0gbnVsbCB8fCB0eXBlb2YgdmFsdWUgPT09ICJ1bmRlZmluZWQiKSB7CiAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKG1lc3NhZ2UpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CgogICAgICAgICAgZnVuY3Rpb24gd2FybmluZyQxKGNvbmQsIG1lc3NhZ2UpIHsKICAgICAgICAgICAgaWYgKCFjb25kKSB7CiAgICAgICAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG5vLWNvbnNvbGUKICAgICAgICAgICAgICBpZiAodHlwZW9mIGNvbnNvbGUgIT09ICJ1bmRlZmluZWQiKSBjb25zb2xlLndhcm4obWVzc2FnZSk7CgogICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAvLyBXZWxjb21lIHRvIGRlYnVnZ2luZyBoaXN0b3J5IQogICAgICAgICAgICAgICAgLy8KICAgICAgICAgICAgICAgIC8vIFRoaXMgZXJyb3IgaXMgdGhyb3duIGFzIGEgY29udmVuaWVuY2Ugc28geW91IGNhbiBtb3JlIGVhc2lseQogICAgICAgICAgICAgICAgLy8gZmluZCB0aGUgc291cmNlIGZvciBhIHdhcm5pbmcgdGhhdCBhcHBlYXJzIGluIHRoZSBjb25zb2xlIGJ5CiAgICAgICAgICAgICAgICAvLyBlbmFibGluZyAicGF1c2Ugb24gZXhjZXB0aW9ucyIgaW4geW91ciBKYXZhU2NyaXB0IGRlYnVnZ2VyLgogICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKG1lc3NhZ2UpOyAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tZW1wdHkKICAgICAgICAgICAgICB9IGNhdGNoIChlKSB7fQogICAgICAgICAgICB9CiAgICAgICAgICB9CgogICAgICAgICAgZnVuY3Rpb24gY3JlYXRlS2V5KCkgewogICAgICAgICAgICByZXR1cm4gTWF0aC5yYW5kb20oKS50b1N0cmluZygzNikuc3Vic3RyKDIsIDgpOwogICAgICAgICAgfQogICAgICAgICAgLyoqCiAgICAgICAgICAgKiBGb3IgYnJvd3Nlci1iYXNlZCBoaXN0b3JpZXMsIHdlIGNvbWJpbmUgdGhlIHN0YXRlIGFuZCBrZXkgaW50byBhbiBvYmplY3QKICAgICAgICAgICAqLwoKCiAgICAgICAgICBmdW5jdGlvbiBnZXRIaXN0b3J5U3RhdGUobG9jYXRpb24sIGluZGV4KSB7CiAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgdXNyOiBsb2NhdGlvbi5zdGF0ZSwKICAgICAgICAgICAgICBrZXk6IGxvY2F0aW9uLmtleSwKICAgICAgICAgICAgICBpZHg6IGluZGV4CiAgICAgICAgICAgIH07CiAgICAgICAgICB9CiAgICAgICAgICAvKioKICAgICAgICAgICAqIENyZWF0ZXMgYSBMb2NhdGlvbiBvYmplY3Qgd2l0aCBhIHVuaXF1ZSBrZXkgZnJvbSB0aGUgZ2l2ZW4gUGF0aAogICAgICAgICAgICovCgoKICAgICAgICAgIGZ1bmN0aW9uIGNyZWF0ZUxvY2F0aW9uKGN1cnJlbnQsIHRvLCBzdGF0ZSwga2V5KSB7CiAgICAgICAgICAgIGlmIChzdGF0ZSA9PT0gdm9pZCAwKSB7CiAgICAgICAgICAgICAgc3RhdGUgPSBudWxsOwogICAgICAgICAgICB9CgogICAgICAgICAgICB2YXIgbG9jYXRpb24gPSBfZXh0ZW5kcyh7CiAgICAgICAgICAgICAgcGF0aG5hbWU6IHR5cGVvZiBjdXJyZW50ID09PSAic3RyaW5nIiA/IGN1cnJlbnQgOiBjdXJyZW50LnBhdGhuYW1lLAogICAgICAgICAgICAgIHNlYXJjaDogIiIsCiAgICAgICAgICAgICAgaGFzaDogIiIKICAgICAgICAgICAgfSwgdHlwZW9mIHRvID09PSAic3RyaW5nIiA/IHBhcnNlUGF0aCh0bykgOiB0bywgewogICAgICAgICAgICAgIHN0YXRlOiBzdGF0ZSwKICAgICAgICAgICAgICAvLyBUT0RPOiBUaGlzIGNvdWxkIGJlIGNsZWFuZWQgdXAuICBwdXNoL3JlcGxhY2Ugc2hvdWxkIHByb2JhYmx5IGp1c3QgdGFrZQogICAgICAgICAgICAgIC8vIGZ1bGwgTG9jYXRpb25zIG5vdyBhbmQgYXZvaWQgdGhlIG5lZWQgdG8gcnVuIHRocm91Z2ggdGhpcyBmbG93IGF0IGFsbAogICAgICAgICAgICAgIC8vIEJ1dCB0aGF0J3MgYSBwcmV0dHkgYmlnIHJlZmFjdG9yIHRvIHRoZSBjdXJyZW50IHRlc3Qgc3VpdGUgc28gZ29pbmcgdG8KICAgICAgICAgICAgICAvLyBrZWVwIGFzIGlzIGZvciB0aGUgdGltZSBiZWluZyBhbmQganVzdCBsZXQgYW55IGluY29taW5nIGtleXMgdGFrZSBwcmVjZWRlbmNlCiAgICAgICAgICAgICAga2V5OiB0byAmJiB0by5rZXkgfHwga2V5IHx8IGNyZWF0ZUtleSgpCiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgcmV0dXJuIGxvY2F0aW9uOwogICAgICAgICAgfQogICAgICAgICAgLyoqCiAgICAgICAgICAgKiBDcmVhdGVzIGEgc3RyaW5nIFVSTCBwYXRoIGZyb20gdGhlIGdpdmVuIHBhdGhuYW1lLCBzZWFyY2gsIGFuZCBoYXNoIGNvbXBvbmVudHMuCiAgICAgICAgICAgKi8KCiAgICAgICAgICBmdW5jdGlvbiByb3V0ZXJfY3JlYXRlUGF0aChfcmVmKSB7CiAgICAgICAgICAgIHZhciBfcmVmJHBhdGhuYW1lID0KCgoKICAgICAgICAgICAgICBfcmVmLnBhdGhuYW1lLHBhdGhuYW1lID0gX3JlZiRwYXRobmFtZSA9PT0gdm9pZCAwID8gIi8iIDogX3JlZiRwYXRobmFtZSxfcmVmJHNlYXJjaCA9IF9yZWYuc2VhcmNoLHNlYXJjaCA9IF9yZWYkc2VhcmNoID09PSB2b2lkIDAgPyAiIiA6IF9yZWYkc2VhcmNoLF9yZWYkaGFzaCA9IF9yZWYuaGFzaCxoYXNoID0gX3JlZiRoYXNoID09PSB2b2lkIDAgPyAiIiA6IF9yZWYkaGFzaDsKICAgICAgICAgICAgaWYgKHNlYXJjaCAmJiBzZWFyY2ggIT09ICI/IikgcGF0aG5hbWUgKz0gc2VhcmNoLmNoYXJBdCgwKSA9PT0gIj8iID8gc2VhcmNoIDogIj8iICsgc2VhcmNoOwogICAgICAgICAgICBpZiAoaGFzaCAmJiBoYXNoICE9PSAiIyIpIHBhdGhuYW1lICs9IGhhc2guY2hhckF0KDApID09PSAiIyIgPyBoYXNoIDogIiMiICsgaGFzaDsKICAgICAgICAgICAgcmV0dXJuIHBhdGhuYW1lOwogICAgICAgICAgfQogICAgICAgICAgLyoqCiAgICAgICAgICAgKiBQYXJzZXMgYSBzdHJpbmcgVVJMIHBhdGggaW50byBpdHMgc2VwYXJhdGUgcGF0aG5hbWUsIHNlYXJjaCwgYW5kIGhhc2ggY29tcG9uZW50cy4KICAgICAgICAgICAqLwoKICAgICAgICAgIGZ1bmN0aW9uIHBhcnNlUGF0aChwYXRoKSB7CiAgICAgICAgICAgIHZhciBwYXJzZWRQYXRoID0ge307CgogICAgICAgICAgICBpZiAocGF0aCkgewogICAgICAgICAgICAgIHZhciBoYXNoSW5kZXggPSBwYXRoLmluZGV4T2YoIiMiKTsKCiAgICAgICAgICAgICAgaWYgKGhhc2hJbmRleCA+PSAwKSB7CiAgICAgICAgICAgICAgICBwYXJzZWRQYXRoLmhhc2ggPSBwYXRoLnN1YnN0cihoYXNoSW5kZXgpOwogICAgICAgICAgICAgICAgcGF0aCA9IHBhdGguc3Vic3RyKDAsIGhhc2hJbmRleCk7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICB2YXIgc2VhcmNoSW5kZXggPSBwYXRoLmluZGV4T2YoIj8iKTsKCiAgICAgICAgICAgICAgaWYgKHNlYXJjaEluZGV4ID49IDApIHsKICAgICAgICAgICAgICAgIHBhcnNlZFBhdGguc2VhcmNoID0gcGF0aC5zdWJzdHIoc2VhcmNoSW5kZXgpOwogICAgICAgICAgICAgICAgcGF0aCA9IHBhdGguc3Vic3RyKDAsIHNlYXJjaEluZGV4KTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIGlmIChwYXRoKSB7CiAgICAgICAgICAgICAgICBwYXJzZWRQYXRoLnBhdGhuYW1lID0gcGF0aDsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybiBwYXJzZWRQYXRoOwogICAgICAgICAgfQoKICAgICAgICAgIGZ1bmN0aW9uIGdldFVybEJhc2VkSGlzdG9yeShnZXRMb2NhdGlvbiwgX2NyZWF0ZUhyZWYsIHZhbGlkYXRlTG9jYXRpb24sIG9wdGlvbnMpIHsKICAgICAgICAgICAgaWYgKG9wdGlvbnMgPT09IHZvaWQgMCkgewogICAgICAgICAgICAgIG9wdGlvbnMgPSB7fTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdmFyIF9vcHRpb25zMiA9CgoKICAgICAgICAgICAgICBvcHRpb25zLF9vcHRpb25zMiR3aW5kb3cgPSBfb3B0aW9uczIud2luZG93LHdpbmRvdyA9IF9vcHRpb25zMiR3aW5kb3cgPT09IHZvaWQgMCA/IGRvY3VtZW50LmRlZmF1bHRWaWV3IDogX29wdGlvbnMyJHdpbmRvdyxfb3B0aW9uczIkdjVDb21wYXQgPSBfb3B0aW9uczIudjVDb21wYXQsdjVDb21wYXQgPSBfb3B0aW9uczIkdjVDb21wYXQgPT09IHZvaWQgMCA/IGZhbHNlIDogX29wdGlvbnMyJHY1Q29tcGF0OwogICAgICAgICAgICB2YXIgZ2xvYmFsSGlzdG9yeSA9IHdpbmRvdy5oaXN0b3J5OwogICAgICAgICAgICB2YXIgYWN0aW9uID0gQWN0aW9uLlBvcDsKICAgICAgICAgICAgdmFyIGxpc3RlbmVyID0gbnVsbDsKICAgICAgICAgICAgdmFyIGluZGV4ID0gZ2V0SW5kZXgoKTsgLy8gSW5kZXggc2hvdWxkIG9ubHkgYmUgbnVsbCB3aGVuIHdlIGluaXRpYWxpemUuIElmIG5vdCwgaXQncyBiZWNhdXNlIHRoZQogICAgICAgICAgICAvLyB1c2VyIGNhbGxlZCBoaXN0b3J5LnB1c2hTdGF0ZSBvciBoaXN0b3J5LnJlcGxhY2VTdGF0ZSBkaXJlY3RseSwgaW4gd2hpY2gKICAgICAgICAgICAgLy8gY2FzZSB3ZSBzaG91bGQgbG9nIGEgd2FybmluZyBhcyBpdCB3aWxsIHJlc3VsdCBpbiBidWdzLgoKICAgICAgICAgICAgaWYgKGluZGV4ID09IG51bGwpIHsKICAgICAgICAgICAgICBpbmRleCA9IDA7CiAgICAgICAgICAgICAgZ2xvYmFsSGlzdG9yeS5yZXBsYWNlU3RhdGUoX2V4dGVuZHMoe30sIGdsb2JhbEhpc3Rvcnkuc3RhdGUsIHsKICAgICAgICAgICAgICAgIGlkeDogaW5kZXgKICAgICAgICAgICAgICB9KSwgIiIpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBmdW5jdGlvbiBnZXRJbmRleCgpIHsKICAgICAgICAgICAgICB2YXIgc3RhdGUgPSBnbG9iYWxIaXN0b3J5LnN0YXRlIHx8IHsKICAgICAgICAgICAgICAgIGlkeDogbnVsbAogICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgcmV0dXJuIHN0YXRlLmlkeDsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgZnVuY3Rpb24gaGFuZGxlUG9wKCkgewogICAgICAgICAgICAgIGFjdGlvbiA9IEFjdGlvbi5Qb3A7CiAgICAgICAgICAgICAgdmFyIG5leHRJbmRleCA9IGdldEluZGV4KCk7CiAgICAgICAgICAgICAgdmFyIGRlbHRhID0gbmV4dEluZGV4ID09IG51bGwgPyBudWxsIDogbmV4dEluZGV4IC0gaW5kZXg7CiAgICAgICAgICAgICAgaW5kZXggPSBuZXh0SW5kZXg7CgogICAgICAgICAgICAgIGlmIChsaXN0ZW5lcikgewogICAgICAgICAgICAgICAgbGlzdGVuZXIoewogICAgICAgICAgICAgICAgICBhY3Rpb246IGFjdGlvbiwKICAgICAgICAgICAgICAgICAgbG9jYXRpb246IGhpc3RvcnkubG9jYXRpb24sCiAgICAgICAgICAgICAgICAgIGRlbHRhOiBkZWx0YQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICBmdW5jdGlvbiBwdXNoKHRvLCBzdGF0ZSkgewogICAgICAgICAgICAgIGFjdGlvbiA9IEFjdGlvbi5QdXNoOwogICAgICAgICAgICAgIHZhciBsb2NhdGlvbiA9IGNyZWF0ZUxvY2F0aW9uKGhpc3RvcnkubG9jYXRpb24sIHRvLCBzdGF0ZSk7CiAgICAgICAgICAgICAgaWYgKHZhbGlkYXRlTG9jYXRpb24pIHZhbGlkYXRlTG9jYXRpb24obG9jYXRpb24sIHRvKTsKICAgICAgICAgICAgICBpbmRleCA9IGdldEluZGV4KCkgKyAxOwogICAgICAgICAgICAgIHZhciBoaXN0b3J5U3RhdGUgPSBnZXRIaXN0b3J5U3RhdGUobG9jYXRpb24sIGluZGV4KTsKICAgICAgICAgICAgICB2YXIgdXJsID0gaGlzdG9yeS5jcmVhdGVIcmVmKGxvY2F0aW9uKTsgLy8gdHJ5Li4uY2F0Y2ggYmVjYXVzZSBpT1MgbGltaXRzIHVzIHRvIDEwMCBwdXNoU3RhdGUgY2FsbHMgOi8KCiAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIGdsb2JhbEhpc3RvcnkucHVzaFN0YXRlKGhpc3RvcnlTdGF0ZSwgIiIsIHVybCk7CiAgICAgICAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICAgICAgICAgIC8vIFRoZXkgYXJlIGdvaW5nIHRvIGxvc2Ugc3RhdGUgaGVyZSwgYnV0IHRoZXJlIGlzIG5vIHJlYWwKICAgICAgICAgICAgICAgIC8vIHdheSB0byB3YXJuIHRoZW0gYWJvdXQgaXQgc2luY2UgdGhlIHBhZ2Ugd2lsbCByZWZyZXNoLi4uCiAgICAgICAgICAgICAgICB3aW5kb3cubG9jYXRpb24uYXNzaWduKHVybCk7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBpZiAodjVDb21wYXQgJiYgbGlzdGVuZXIpIHsKICAgICAgICAgICAgICAgIGxpc3RlbmVyKHsKICAgICAgICAgICAgICAgICAgYWN0aW9uOiBhY3Rpb24sCiAgICAgICAgICAgICAgICAgIGxvY2F0aW9uOiBoaXN0b3J5LmxvY2F0aW9uLAogICAgICAgICAgICAgICAgICBkZWx0YTogMQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICBmdW5jdGlvbiByZXBsYWNlKHRvLCBzdGF0ZSkgewogICAgICAgICAgICAgIGFjdGlvbiA9IEFjdGlvbi5SZXBsYWNlOwogICAgICAgICAgICAgIHZhciBsb2NhdGlvbiA9IGNyZWF0ZUxvY2F0aW9uKGhpc3RvcnkubG9jYXRpb24sIHRvLCBzdGF0ZSk7CiAgICAgICAgICAgICAgaWYgKHZhbGlkYXRlTG9jYXRpb24pIHZhbGlkYXRlTG9jYXRpb24obG9jYXRpb24sIHRvKTsKICAgICAgICAgICAgICBpbmRleCA9IGdldEluZGV4KCk7CiAgICAgICAgICAgICAgdmFyIGhpc3RvcnlTdGF0ZSA9IGdldEhpc3RvcnlTdGF0ZShsb2NhdGlvbiwgaW5kZXgpOwogICAgICAgICAgICAgIHZhciB1cmwgPSBoaXN0b3J5LmNyZWF0ZUhyZWYobG9jYXRpb24pOwogICAgICAgICAgICAgIGdsb2JhbEhpc3RvcnkucmVwbGFjZVN0YXRlKGhpc3RvcnlTdGF0ZSwgIiIsIHVybCk7CgogICAgICAgICAgICAgIGlmICh2NUNvbXBhdCAmJiBsaXN0ZW5lcikgewogICAgICAgICAgICAgICAgbGlzdGVuZXIoewogICAgICAgICAgICAgICAgICBhY3Rpb246IGFjdGlvbiwKICAgICAgICAgICAgICAgICAgbG9jYXRpb246IGhpc3RvcnkubG9jYXRpb24sCiAgICAgICAgICAgICAgICAgIGRlbHRhOiAwCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGZ1bmN0aW9uIGNyZWF0ZVVSTCh0bykgewogICAgICAgICAgICAgIC8vIHdpbmRvdy5sb2NhdGlvbi5vcmlnaW4gaXMgIm51bGwiICh0aGUgbGl0ZXJhbCBzdHJpbmcgdmFsdWUpIGluIEZpcmVmb3gKICAgICAgICAgICAgICAvLyB1bmRlciBjZXJ0YWluIGNvbmRpdGlvbnMsIG5vdGFibHkgd2hlbiBzZXJ2aW5nIGZyb20gYSBsb2NhbCBIVE1MIGZpbGUKICAgICAgICAgICAgICAvLyBTZWUgaHR0cHM6Ly9idWd6aWxsYS5tb3ppbGxhLm9yZy9zaG93X2J1Zy5jZ2k/aWQ9ODc4Mjk3CiAgICAgICAgICAgICAgdmFyIGJhc2UgPSB3aW5kb3cubG9jYXRpb24ub3JpZ2luICE9PSAibnVsbCIgPyB3aW5kb3cubG9jYXRpb24ub3JpZ2luIDogd2luZG93LmxvY2F0aW9uLmhyZWY7CiAgICAgICAgICAgICAgdmFyIGhyZWYgPSB0eXBlb2YgdG8gPT09ICJzdHJpbmciID8gdG8gOiByb3V0ZXJfY3JlYXRlUGF0aCh0byk7CiAgICAgICAgICAgICAgcm91dGVyX2ludmFyaWFudChiYXNlLCAiTm8gd2luZG93LmxvY2F0aW9uLihvcmlnaW58aHJlZikgYXZhaWxhYmxlIHRvIGNyZWF0ZSBVUkwgZm9yIGhyZWY6ICIgKyBocmVmKTsKICAgICAgICAgICAgICByZXR1cm4gbmV3IFVSTChocmVmLCBiYXNlKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdmFyIGhpc3RvcnkgPSB7CiAgICAgICAgICAgICAgZ2V0IGFjdGlvbigpIHsKICAgICAgICAgICAgICAgIHJldHVybiBhY3Rpb247CiAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgZ2V0IGxvY2F0aW9uKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIGdldExvY2F0aW9uKHdpbmRvdywgZ2xvYmFsSGlzdG9yeSk7CiAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgbGlzdGVuOiBmdW5jdGlvbiBsaXN0ZW4oZm4pIHsKICAgICAgICAgICAgICAgIGlmIChsaXN0ZW5lcikgewogICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIkEgaGlzdG9yeSBvbmx5IGFjY2VwdHMgb25lIGFjdGl2ZSBsaXN0ZW5lciIpOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKFBvcFN0YXRlRXZlbnRUeXBlLCBoYW5kbGVQb3ApOwogICAgICAgICAgICAgICAgbGlzdGVuZXIgPSBmbjsKICAgICAgICAgICAgICAgIHJldHVybiAoKSA9PiB7CiAgICAgICAgICAgICAgICAgIHdpbmRvdy5yZW1vdmVFdmVudExpc3RlbmVyKFBvcFN0YXRlRXZlbnRUeXBlLCBoYW5kbGVQb3ApOwogICAgICAgICAgICAgICAgICBsaXN0ZW5lciA9IG51bGw7CiAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgIGNyZWF0ZUhyZWY6IGZ1bmN0aW9uIGNyZWF0ZUhyZWYodG8pIHsKICAgICAgICAgICAgICAgIHJldHVybiBfY3JlYXRlSHJlZih3aW5kb3csIHRvKTsKICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICBjcmVhdGVVUkw6IGNyZWF0ZVVSTCwKCiAgICAgICAgICAgICAgZW5jb2RlTG9jYXRpb246IGZ1bmN0aW9uIGVuY29kZUxvY2F0aW9uKHRvKSB7CiAgICAgICAgICAgICAgICAvLyBFbmNvZGUgYSBMb2NhdGlvbiB0aGUgc2FtZSB3YXkgd2luZG93LmxvY2F0aW9uIHdvdWxkCiAgICAgICAgICAgICAgICB2YXIgdXJsID0gY3JlYXRlVVJMKHRvKTsKICAgICAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICAgIHBhdGhuYW1lOiB1cmwucGF0aG5hbWUsCiAgICAgICAgICAgICAgICAgIHNlYXJjaDogdXJsLnNlYXJjaCwKICAgICAgICAgICAgICAgICAgaGFzaDogdXJsLmhhc2gKICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgcHVzaDogcHVzaCwKICAgICAgICAgICAgICByZXBsYWNlOiByZXBsYWNlLAoKICAgICAgICAgICAgICBnbzogZnVuY3Rpb24gZ28obikgewogICAgICAgICAgICAgICAgcmV0dXJuIGdsb2JhbEhpc3RvcnkuZ28obik7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgfTsKICAgICAgICAgICAgcmV0dXJuIGhpc3Rvcnk7CiAgICAgICAgICB9IC8vI2VuZHJlZ2lvbgoKICAgICAgICAgIHZhciBSZXN1bHRUeXBlOwoKICAgICAgICAgIChmdW5jdGlvbiAoUmVzdWx0VHlwZSkgewogICAgICAgICAgICBSZXN1bHRUeXBlWyJkYXRhIl0gPSAiZGF0YSI7CiAgICAgICAgICAgIFJlc3VsdFR5cGVbImRlZmVycmVkIl0gPSAiZGVmZXJyZWQiOwogICAgICAgICAgICBSZXN1bHRUeXBlWyJyZWRpcmVjdCJdID0gInJlZGlyZWN0IjsKICAgICAgICAgICAgUmVzdWx0VHlwZVsiZXJyb3IiXSA9ICJlcnJvciI7CiAgICAgICAgICB9KShSZXN1bHRUeXBlIHx8IChSZXN1bHRUeXBlID0ge30pKTsKCiAgICAgICAgICBmdW5jdGlvbiBpc0luZGV4Um91dGUocm91dGUpIHsKICAgICAgICAgICAgcmV0dXJuIHJvdXRlLmluZGV4ID09PSB0cnVlOwogICAgICAgICAgfSAvLyBXYWxrIHRoZSByb3V0ZSB0cmVlIGdlbmVyYXRpbmcgdW5pcXVlIElEcyB3aGVyZSBuZWNlc3Nhcnkgc28gd2UgYXJlIHdvcmtpbmcKICAgICAgICAgIC8vIHNvbGVseSB3aXRoIEFnbm9zdGljRGF0YVJvdXRlT2JqZWN0J3Mgd2l0aGluIHRoZSBSb3V0ZXIKCgogICAgICAgICAgZnVuY3Rpb24gY29udmVydFJvdXRlc1RvRGF0YVJvdXRlcyhyb3V0ZXMsIHBhcmVudFBhdGgsIGFsbElkcykgewogICAgICAgICAgICBpZiAocGFyZW50UGF0aCA9PT0gdm9pZCAwKSB7CiAgICAgICAgICAgICAgcGFyZW50UGF0aCA9IFtdOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoYWxsSWRzID09PSB2b2lkIDApIHsKICAgICAgICAgICAgICBhbGxJZHMgPSBuZXcgU2V0KCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybiByb3V0ZXMubWFwKChyb3V0ZSwgaW5kZXgpID0+IHsKICAgICAgICAgICAgICB2YXIgdHJlZVBhdGggPSBbXS5jb25jYXQoX3RvQ29uc3VtYWJsZUFycmF5MihwYXJlbnRQYXRoKSwgW2luZGV4XSk7CiAgICAgICAgICAgICAgdmFyIGlkID0gdHlwZW9mIHJvdXRlLmlkID09PSAic3RyaW5nIiA/IHJvdXRlLmlkIDogdHJlZVBhdGguam9pbigiLSIpOwogICAgICAgICAgICAgIHJvdXRlcl9pbnZhcmlhbnQocm91dGUuaW5kZXggIT09IHRydWUgfHwgIXJvdXRlLmNoaWxkcmVuLCAiQ2Fubm90IHNwZWNpZnkgY2hpbGRyZW4gb24gYW4gaW5kZXggcm91dGUiKTsKICAgICAgICAgICAgICByb3V0ZXJfaW52YXJpYW50KCFhbGxJZHMuaGFzKGlkKSwgIkZvdW5kIGEgcm91dGUgaWQgY29sbGlzaW9uIG9uIGlkIFwiIiArIGlkICsgIlwiLiAgUm91dGUgIiArICJpZCdzIG11c3QgYmUgZ2xvYmFsbHkgdW5pcXVlIHdpdGhpbiBEYXRhIFJvdXRlciB1c2FnZXMiKTsKICAgICAgICAgICAgICBhbGxJZHMuYWRkKGlkKTsKCiAgICAgICAgICAgICAgaWYgKGlzSW5kZXhSb3V0ZShyb3V0ZSkpIHsKICAgICAgICAgICAgICAgIHZhciBpbmRleFJvdXRlID0gX2V4dGVuZHMoe30sIHJvdXRlLCB7CiAgICAgICAgICAgICAgICAgIGlkOiBpZAogICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgICAgcmV0dXJuIGluZGV4Um91dGU7CiAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHZhciBwYXRoT3JMYXlvdXRSb3V0ZSA9IF9leHRlbmRzKHt9LCByb3V0ZSwgewogICAgICAgICAgICAgICAgICBpZDogaWQsCiAgICAgICAgICAgICAgICAgIGNoaWxkcmVuOiByb3V0ZS5jaGlsZHJlbiA/IGNvbnZlcnRSb3V0ZXNUb0RhdGFSb3V0ZXMocm91dGUuY2hpbGRyZW4sIHRyZWVQYXRoLCBhbGxJZHMpIDogdW5kZWZpbmVkCiAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgICByZXR1cm4gcGF0aE9yTGF5b3V0Um91dGU7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICAgIH0KICAgICAgICAgIC8qKgogICAgICAgICAgICogTWF0Y2hlcyB0aGUgZ2l2ZW4gcm91dGVzIHRvIGEgbG9jYXRpb24gYW5kIHJldHVybnMgdGhlIG1hdGNoIGRhdGEuCiAgICAgICAgICAgKgogICAgICAgICAgICogQHNlZSBodHRwczovL3JlYWN0cm91dGVyLmNvbS91dGlscy9tYXRjaC1yb3V0ZXMKICAgICAgICAgICAqLwoKICAgICAgICAgIGZ1bmN0aW9uIG1hdGNoUm91dGVzKHJvdXRlcywgbG9jYXRpb25BcmcsIGJhc2VuYW1lKSB7CiAgICAgICAgICAgIGlmIChiYXNlbmFtZSA9PT0gdm9pZCAwKSB7CiAgICAgICAgICAgICAgYmFzZW5hbWUgPSAiLyI7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHZhciBsb2NhdGlvbiA9IHR5cGVvZiBsb2NhdGlvbkFyZyA9PT0gInN0cmluZyIgPyBwYXJzZVBhdGgobG9jYXRpb25BcmcpIDogbG9jYXRpb25Bcmc7CiAgICAgICAgICAgIHZhciBwYXRobmFtZSA9IHN0cmlwQmFzZW5hbWUobG9jYXRpb24ucGF0aG5hbWUgfHwgIi8iLCBiYXNlbmFtZSk7CgogICAgICAgICAgICBpZiAocGF0aG5hbWUgPT0gbnVsbCkgewogICAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgICAgICB9CgogICAgICAgICAgICB2YXIgYnJhbmNoZXMgPSBmbGF0dGVuUm91dGVzKHJvdXRlcyk7CiAgICAgICAgICAgIHJhbmtSb3V0ZUJyYW5jaGVzKGJyYW5jaGVzKTsKICAgICAgICAgICAgdmFyIG1hdGNoZXMgPSBudWxsOwoKICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IG1hdGNoZXMgPT0gbnVsbCAmJiBpIDwgYnJhbmNoZXMubGVuZ3RoOyArK2kpIHsKICAgICAgICAgICAgICBtYXRjaGVzID0gbWF0Y2hSb3V0ZUJyYW5jaChicmFuY2hlc1tpXSwgLy8gSW5jb21pbmcgcGF0aG5hbWVzIGFyZSBnZW5lcmFsbHkgZW5jb2RlZCBmcm9tIGVpdGhlciB3aW5kb3cubG9jYXRpb24KICAgICAgICAgICAgICAvLyBvciBmcm9tIHJvdXRlci5uYXZpZ2F0ZSwgYnV0IHdlIHdhbnQgdG8gbWF0Y2ggYWdhaW5zdCB0aGUgdW5lbmNvZGVkCiAgICAgICAgICAgICAgLy8gcGF0aHMgaW4gdGhlIHJvdXRlIGRlZmluaXRpb25zLiAgTWVtb3J5IHJvdXRlciBsb2NhdGlvbnMgd29uJ3QgYmUKICAgICAgICAgICAgICAvLyBlbmNvZGVkIGhlcmUgYnV0IHRoZXJlIGFsc28gc2hvdWxkbid0IGJlIGFueXRoaW5nIHRvIGRlY29kZSBzbyB0aGlzCiAgICAgICAgICAgICAgLy8gc2hvdWxkIGJlIGEgc2FmZSBvcGVyYXRpb24uICBUaGlzIGF2b2lkcyBuZWVkaW5nIG1hdGNoUm91dGVzIHRvIGJlCiAgICAgICAgICAgICAgLy8gaGlzdG9yeS1hd2FyZS4KICAgICAgICAgICAgICBzYWZlbHlEZWNvZGVVUkkocGF0aG5hbWUpKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuIG1hdGNoZXM7CiAgICAgICAgICB9CgogICAgICAgICAgZnVuY3Rpb24gZmxhdHRlblJvdXRlcyhyb3V0ZXMsIGJyYW5jaGVzLCBwYXJlbnRzTWV0YSwgcGFyZW50UGF0aCkgewogICAgICAgICAgICBpZiAoYnJhbmNoZXMgPT09IHZvaWQgMCkgewogICAgICAgICAgICAgIGJyYW5jaGVzID0gW107CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChwYXJlbnRzTWV0YSA9PT0gdm9pZCAwKSB7CiAgICAgICAgICAgICAgcGFyZW50c01ldGEgPSBbXTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKHBhcmVudFBhdGggPT09IHZvaWQgMCkgewogICAgICAgICAgICAgIHBhcmVudFBhdGggPSAiIjsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdmFyIGZsYXR0ZW5Sb3V0ZSA9IChyb3V0ZSwgaW5kZXgsIHJlbGF0aXZlUGF0aCkgPT4gewogICAgICAgICAgICAgIHZhciBtZXRhID0gewogICAgICAgICAgICAgICAgcmVsYXRpdmVQYXRoOiByZWxhdGl2ZVBhdGggPT09IHVuZGVmaW5lZCA/IHJvdXRlLnBhdGggfHwgIiIgOiByZWxhdGl2ZVBhdGgsCiAgICAgICAgICAgICAgICBjYXNlU2Vuc2l0aXZlOiByb3V0ZS5jYXNlU2Vuc2l0aXZlID09PSB0cnVlLAogICAgICAgICAgICAgICAgY2hpbGRyZW5JbmRleDogaW5kZXgsCiAgICAgICAgICAgICAgICByb3V0ZTogcm91dGUKICAgICAgICAgICAgICB9OwoKICAgICAgICAgICAgICBpZiAobWV0YS5yZWxhdGl2ZVBhdGguc3RhcnRzV2l0aCgiLyIpKSB7CiAgICAgICAgICAgICAgICByb3V0ZXJfaW52YXJpYW50KG1ldGEucmVsYXRpdmVQYXRoLnN0YXJ0c1dpdGgocGFyZW50UGF0aCksICJBYnNvbHV0ZSByb3V0ZSBwYXRoIFwiIiArIG1ldGEucmVsYXRpdmVQYXRoICsgIlwiIG5lc3RlZCB1bmRlciBwYXRoICIgKyAoIlwiIiArIHBhcmVudFBhdGggKyAiXCIgaXMgbm90IHZhbGlkLiBBbiBhYnNvbHV0ZSBjaGlsZCByb3V0ZSBwYXRoICIpICsgIm11c3Qgc3RhcnQgd2l0aCB0aGUgY29tYmluZWQgcGF0aCBvZiBhbGwgaXRzIHBhcmVudCByb3V0ZXMuIik7CiAgICAgICAgICAgICAgICBtZXRhLnJlbGF0aXZlUGF0aCA9IG1ldGEucmVsYXRpdmVQYXRoLnNsaWNlKHBhcmVudFBhdGgubGVuZ3RoKTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIHZhciBwYXRoID0gcm91dGVyX2pvaW5QYXRocyhbcGFyZW50UGF0aCwgbWV0YS5yZWxhdGl2ZVBhdGhdKTsKICAgICAgICAgICAgICB2YXIgcm91dGVzTWV0YSA9IHBhcmVudHNNZXRhLmNvbmNhdChtZXRhKTsgLy8gQWRkIHRoZSBjaGlsZHJlbiBiZWZvcmUgYWRkaW5nIHRoaXMgcm91dGUgdG8gdGhlIGFycmF5IHNvIHdlIHRyYXZlcnNlIHRoZQogICAgICAgICAgICAgIC8vIHJvdXRlIHRyZWUgZGVwdGgtZmlyc3QgYW5kIGNoaWxkIHJvdXRlcyBhcHBlYXIgYmVmb3JlIHRoZWlyIHBhcmVudHMgaW4KICAgICAgICAgICAgICAvLyB0aGUgImZsYXR0ZW5lZCIgdmVyc2lvbi4KCiAgICAgICAgICAgICAgaWYgKHJvdXRlLmNoaWxkcmVuICYmIHJvdXRlLmNoaWxkcmVuLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgICAgIHJvdXRlcl9pbnZhcmlhbnQoIC8vIE91ciB0eXBlcyBrbm93IGJldHRlciwgYnV0IHJ1bnRpbWUgSlMgbWF5IG5vdCEKICAgICAgICAgICAgICAgIC8vIEB0cy1leHBlY3QtZXJyb3IKICAgICAgICAgICAgICAgIHJvdXRlLmluZGV4ICE9PSB0cnVlLCAiSW5kZXggcm91dGVzIG11c3Qgbm90IGhhdmUgY2hpbGQgcm91dGVzLiBQbGVhc2UgcmVtb3ZlICIgKyAoImFsbCBjaGlsZCByb3V0ZXMgZnJvbSByb3V0ZSBwYXRoIFwiIiArIHBhdGggKyAiXCIuIikpOwogICAgICAgICAgICAgICAgZmxhdHRlblJvdXRlcyhyb3V0ZS5jaGlsZHJlbiwgYnJhbmNoZXMsIHJvdXRlc01ldGEsIHBhdGgpOwogICAgICAgICAgICAgIH0gLy8gUm91dGVzIHdpdGhvdXQgYSBwYXRoIHNob3VsZG4ndCBldmVyIG1hdGNoIGJ5IHRoZW1zZWx2ZXMgdW5sZXNzIHRoZXkgYXJlCiAgICAgICAgICAgICAgLy8gaW5kZXggcm91dGVzLCBzbyBkb24ndCBhZGQgdGhlbSB0byB0aGUgbGlzdCBvZiBwb3NzaWJsZSBicmFuY2hlcy4KCgogICAgICAgICAgICAgIGlmIChyb3V0ZS5wYXRoID09IG51bGwgJiYgIXJvdXRlLmluZGV4KSB7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBicmFuY2hlcy5wdXNoKHsKICAgICAgICAgICAgICAgIHBhdGg6IHBhdGgsCiAgICAgICAgICAgICAgICBzY29yZTogY29tcHV0ZVNjb3JlKHBhdGgsIHJvdXRlLmluZGV4KSwKICAgICAgICAgICAgICAgIHJvdXRlc01ldGE6IHJvdXRlc01ldGEKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfTsKCiAgICAgICAgICAgIHJvdXRlcy5mb3JFYWNoKChyb3V0ZSwgaW5kZXgpID0+IHsKICAgICAgICAgICAgICB2YXIgX3JvdXRlJHBhdGg7CgogICAgICAgICAgICAgIC8vIGNvYXJzZS1ncmFpbiBjaGVjayBmb3Igb3B0aW9uYWwgcGFyYW1zCiAgICAgICAgICAgICAgaWYgKHJvdXRlLnBhdGggPT09ICIiIHx8ICEoKF9yb3V0ZSRwYXRoID0gcm91dGUucGF0aCkgIT0gbnVsbCAmJiBfcm91dGUkcGF0aC5pbmNsdWRlcygiPyIpKSkgewogICAgICAgICAgICAgICAgZmxhdHRlblJvdXRlKHJvdXRlLCBpbmRleCk7CiAgICAgICAgICAgICAgfSBlbHNlIHt2YXIgX2l0ZXJhdG9yMyA9IF9jcmVhdGVGb3JPZkl0ZXJhdG9ySGVscGVyMigKICAgICAgICAgICAgICAgICAgZXhwbG9kZU9wdGlvbmFsU2VnbWVudHMocm91dGUucGF0aCkpLF9zdGVwMzt0cnkge2ZvciAoX2l0ZXJhdG9yMy5zKCk7ICEoX3N0ZXAzID0gX2l0ZXJhdG9yMy5uKCkpLmRvbmU7KSB7dmFyIGV4cGxvZGVkID0gX3N0ZXAzLnZhbHVlOwogICAgICAgICAgICAgICAgICAgIGZsYXR0ZW5Sb3V0ZShyb3V0ZSwgaW5kZXgsIGV4cGxvZGVkKTsKICAgICAgICAgICAgICAgICAgfX0gY2F0Y2ggKGVycikge19pdGVyYXRvcjMuZShlcnIpO30gZmluYWxseSB7X2l0ZXJhdG9yMy5mKCk7fQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIHJldHVybiBicmFuY2hlczsKICAgICAgICAgIH0KICAgICAgICAgIC8qKgogICAgICAgICAgICogQ29tcHV0ZXMgYWxsIGNvbWJpbmF0aW9ucyBvZiBvcHRpb25hbCBwYXRoIHNlZ21lbnRzIGZvciBhIGdpdmVuIHBhdGgsCiAgICAgICAgICAgKiBleGNsdWRpbmcgY29tYmluYXRpb25zIHRoYXQgYXJlIGFtYmlndW91cyBhbmQgb2YgbG93ZXIgcHJpb3JpdHkuCiAgICAgICAgICAgKgogICAgICAgICAgICogRm9yIGV4YW1wbGUsIGAvb25lLzp0d28/L3RocmVlLzpmb3VyPy86Zml2ZT9gIGV4cGxvZGVzIHRvOgogICAgICAgICAgICogLSBgL29uZS90aHJlZWAKICAgICAgICAgICAqIC0gYC9vbmUvOnR3by90aHJlZWAKICAgICAgICAgICAqIC0gYC9vbmUvdGhyZWUvOmZvdXJgCiAgICAgICAgICAgKiAtIGAvb25lL3RocmVlLzpmaXZlYAogICAgICAgICAgICogLSBgL29uZS86dHdvL3RocmVlLzpmb3VyYAogICAgICAgICAgICogLSBgL29uZS86dHdvL3RocmVlLzpmaXZlYAogICAgICAgICAgICogLSBgL29uZS90aHJlZS86Zm91ci86Zml2ZWAKICAgICAgICAgICAqIC0gYC9vbmUvOnR3by90aHJlZS86Zm91ci86Zml2ZWAKICAgICAgICAgICAqLwoKCiAgICAgICAgICBmdW5jdGlvbiBleHBsb2RlT3B0aW9uYWxTZWdtZW50cyhwYXRoKSB7CiAgICAgICAgICAgIHZhciBzZWdtZW50cyA9IHBhdGguc3BsaXQoIi8iKTsKICAgICAgICAgICAgaWYgKHNlZ21lbnRzLmxlbmd0aCA9PT0gMCkgcmV0dXJuIFtdOwogICAgICAgICAgICB2YXIgX3NlZ21lbnRzID0gX3RvQXJyYXkoc2VnbWVudHMpLGZpcnN0ID0gX3NlZ21lbnRzWzBdLHJlc3QgPSBfc2VnbWVudHMuc2xpY2UoMSk7IC8vIE9wdGlvbmFsIHBhdGggc2VnbWVudHMgYXJlIGRlbm90ZWQgYnkgYSB0cmFpbGluZyBgP2AKCiAgICAgICAgICAgIHZhciBpc09wdGlvbmFsID0gZmlyc3QuZW5kc1dpdGgoIj8iKTsgLy8gQ29tcHV0ZSB0aGUgY29ycmVzcG9uZGluZyByZXF1aXJlZCBzZWdtZW50OiBgZm9vP2AgLT4gYGZvb2AKCiAgICAgICAgICAgIHZhciByZXF1aXJlZCA9IGZpcnN0LnJlcGxhY2UoL1w/JC8sICIiKTsKCiAgICAgICAgICAgIGlmIChyZXN0Lmxlbmd0aCA9PT0gMCkgewogICAgICAgICAgICAgIC8vIEludGVwcmV0IGVtcHR5IHN0cmluZyBhcyBvbWl0dGluZyBhbiBvcHRpb25hbCBzZWdtZW50CiAgICAgICAgICAgICAgLy8gYFsib25lIiwgIiIsICJ0aHJlZSJdYCBjb3JyZXNwb25kcyB0byBvbWl0dGluZyBgOnR3b2AgZnJvbSBgL29uZS86dHdvPy90aHJlZWAgLT4gYC9vbmUvdGhyZWVgCiAgICAgICAgICAgICAgcmV0dXJuIGlzT3B0aW9uYWwgPyBbcmVxdWlyZWQsICIiXSA6IFtyZXF1aXJlZF07CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHZhciByZXN0RXhwbG9kZWQgPSBleHBsb2RlT3B0aW9uYWxTZWdtZW50cyhyZXN0LmpvaW4oIi8iKSk7CiAgICAgICAgICAgIHZhciByZXN1bHQgPSBbXTsgLy8gQWxsIGNoaWxkIHBhdGhzIHdpdGggdGhlIHByZWZpeC4gIERvIHRoaXMgZm9yIGFsbCBjaGlsZHJlbiBiZWZvcmUgdGhlCiAgICAgICAgICAgIC8vIG9wdGlvbmFsIHZlcnNpb24gZm9yIGFsbCBjaGlsZHJlbiBzbyB3ZSBnZXQgY29uc2lzdGVudCBvcmRlcmluZyB3aGVyZSB0aGUKICAgICAgICAgICAgLy8gcGFyZW50IG9wdGlvbmFsIGFzcGVjdCBpcyBwcmVmZXJyZWQgYXMgcmVxdWlyZWQuICBPdGhlcndpc2UsIHdlIGNhbiBnZXQKICAgICAgICAgICAgLy8gY2hpbGQgc2VjdGlvbnMgaW50ZXJzcGVyc2VkIHdoZXJlIGRlZXBlciBvcHRpb25hbCBzZWdtZW50cyBhcmUgaGlnaGVyIHRoYW4KICAgICAgICAgICAgLy8gcGFyZW50IG9wdGlvbmFsIHNlZ21lbnRzLCB3aGVyZSBmb3IgZXhhbXBsZSwgLzp0d28gd291bGQgZXhwbG9kZXMgX2VhcmxpZXJfCiAgICAgICAgICAgIC8vIHRoZW4gLzpvbmUuICBCeSBhbHdheXMgaW5jbHVkaW5nIHRoZSBwYXJlbnQgYXMgcmVxdWlyZWQgX2ZvciBhbGwgY2hpbGRyZW5fCiAgICAgICAgICAgIC8vIGZpcnN0LCB3ZSBhdm9pZCB0aGlzIGlzc3VlCgogICAgICAgICAgICByZXN1bHQucHVzaC5hcHBseShyZXN1bHQsIF90b0NvbnN1bWFibGVBcnJheTIocmVzdEV4cGxvZGVkLm1hcCgoc3VicGF0aCkgPT4gc3VicGF0aCA9PT0gIiIgPyByZXF1aXJlZCA6IFtyZXF1aXJlZCwgc3VicGF0aF0uam9pbigiLyIpKSkpOyAvLyBUaGVuIGlmIHRoaXMgaXMgYW4gb3B0aW9uYWwgdmFsdWUsIGFkZCBhbGwgY2hpbGQgdmVyc2lvbnMgd2l0aG91dAoKICAgICAgICAgICAgaWYgKGlzT3B0aW9uYWwpIHsKICAgICAgICAgICAgICByZXN1bHQucHVzaC5hcHBseShyZXN1bHQsIF90b0NvbnN1bWFibGVBcnJheTIocmVzdEV4cGxvZGVkKSk7CiAgICAgICAgICAgIH0gLy8gZm9yIGFic29sdXRlIHBhdGhzLCBlbnN1cmUgYC9gIGluc3RlYWQgb2YgZW1wdHkgc2VnbWVudAoKCiAgICAgICAgICAgIHJldHVybiByZXN1bHQubWFwKChleHBsb2RlZCkgPT4gcGF0aC5zdGFydHNXaXRoKCIvIikgJiYgZXhwbG9kZWQgPT09ICIiID8gIi8iIDogZXhwbG9kZWQpOwogICAgICAgICAgfQoKICAgICAgICAgIGZ1bmN0aW9uIHJhbmtSb3V0ZUJyYW5jaGVzKGJyYW5jaGVzKSB7CiAgICAgICAgICAgIGJyYW5jaGVzLnNvcnQoKGEsIGIpID0+IGEuc2NvcmUgIT09IGIuc2NvcmUgPyBiLnNjb3JlIC0gYS5zY29yZSAvLyBIaWdoZXIgc2NvcmUgZmlyc3QKICAgICAgICAgICAgOiBjb21wYXJlSW5kZXhlcyhhLnJvdXRlc01ldGEubWFwKChtZXRhKSA9PiBtZXRhLmNoaWxkcmVuSW5kZXgpLCBiLnJvdXRlc01ldGEubWFwKChtZXRhKSA9PiBtZXRhLmNoaWxkcmVuSW5kZXgpKSk7CiAgICAgICAgICB9CgogICAgICAgICAgdmFyIHBhcmFtUmUgPSAvXjpcdyskLzsKICAgICAgICAgIHZhciBkeW5hbWljU2VnbWVudFZhbHVlID0gMzsKICAgICAgICAgIHZhciBpbmRleFJvdXRlVmFsdWUgPSAyOwogICAgICAgICAgdmFyIGVtcHR5U2VnbWVudFZhbHVlID0gMTsKICAgICAgICAgIHZhciBzdGF0aWNTZWdtZW50VmFsdWUgPSAxMDsKICAgICAgICAgIHZhciBzcGxhdFBlbmFsdHkgPSAtMjsKCiAgICAgICAgICB2YXIgaXNTcGxhdCA9IChzKSA9PiBzID09PSAiKiI7CgogICAgICAgICAgZnVuY3Rpb24gY29tcHV0ZVNjb3JlKHBhdGgsIGluZGV4KSB7CiAgICAgICAgICAgIHZhciBzZWdtZW50cyA9IHBhdGguc3BsaXQoIi8iKTsKICAgICAgICAgICAgdmFyIGluaXRpYWxTY29yZSA9IHNlZ21lbnRzLmxlbmd0aDsKCiAgICAgICAgICAgIGlmIChzZWdtZW50cy5zb21lKGlzU3BsYXQpKSB7CiAgICAgICAgICAgICAgaW5pdGlhbFNjb3JlICs9IHNwbGF0UGVuYWx0eTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKGluZGV4KSB7CiAgICAgICAgICAgICAgaW5pdGlhbFNjb3JlICs9IGluZGV4Um91dGVWYWx1ZTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuIHNlZ21lbnRzLmZpbHRlcigocykgPT4gIWlzU3BsYXQocykpLnJlZHVjZSgoc2NvcmUsIHNlZ21lbnQpID0+IHNjb3JlICsgKHBhcmFtUmUudGVzdChzZWdtZW50KSA/IGR5bmFtaWNTZWdtZW50VmFsdWUgOiBzZWdtZW50ID09PSAiIiA/IGVtcHR5U2VnbWVudFZhbHVlIDogc3RhdGljU2VnbWVudFZhbHVlKSwgaW5pdGlhbFNjb3JlKTsKICAgICAgICAgIH0KCiAgICAgICAgICBmdW5jdGlvbiBjb21wYXJlSW5kZXhlcyhhLCBiKSB7CiAgICAgICAgICAgIHZhciBzaWJsaW5ncyA9IGEubGVuZ3RoID09PSBiLmxlbmd0aCAmJiBhLnNsaWNlKDAsIC0xKS5ldmVyeSgobiwgaSkgPT4gbiA9PT0gYltpXSk7CiAgICAgICAgICAgIHJldHVybiBzaWJsaW5ncyA/IC8vIElmIHR3byByb3V0ZXMgYXJlIHNpYmxpbmdzLCB3ZSBzaG91bGQgdHJ5IHRvIG1hdGNoIHRoZSBlYXJsaWVyIHNpYmxpbmcKICAgICAgICAgICAgLy8gZmlyc3QuIFRoaXMgYWxsb3dzIHBlb3BsZSB0byBoYXZlIGZpbmUtZ3JhaW5lZCBjb250cm9sIG92ZXIgdGhlIG1hdGNoaW5nCiAgICAgICAgICAgIC8vIGJlaGF2aW9yIGJ5IHNpbXBseSBwdXR0aW5nIHJvdXRlcyB3aXRoIGlkZW50aWNhbCBwYXRocyBpbiB0aGUgb3JkZXIgdGhleQogICAgICAgICAgICAvLyB3YW50IHRoZW0gdHJpZWQuCiAgICAgICAgICAgIGFbYS5sZW5ndGggLSAxXSAtIGJbYi5sZW5ndGggLSAxXSA6IC8vIE90aGVyd2lzZSwgaXQgZG9lc24ndCByZWFsbHkgbWFrZSBzZW5zZSB0byByYW5rIG5vbi1zaWJsaW5ncyBieSBpbmRleCwKICAgICAgICAgICAgLy8gc28gdGhleSBzb3J0IGVxdWFsbHkuCiAgICAgICAgICAgIDA7CiAgICAgICAgICB9CgogICAgICAgICAgZnVuY3Rpb24gbWF0Y2hSb3V0ZUJyYW5jaChicmFuY2gsIHBhdGhuYW1lKSB7CiAgICAgICAgICAgIHZhcgogICAgICAgICAgICByb3V0ZXNNZXRhID0KICAgICAgICAgICAgYnJhbmNoLnJvdXRlc01ldGE7CiAgICAgICAgICAgIHZhciBtYXRjaGVkUGFyYW1zID0ge307CiAgICAgICAgICAgIHZhciBtYXRjaGVkUGF0aG5hbWUgPSAiLyI7CiAgICAgICAgICAgIHZhciBtYXRjaGVzID0gW107CgogICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHJvdXRlc01ldGEubGVuZ3RoOyArK2kpIHsKICAgICAgICAgICAgICB2YXIgbWV0YSA9IHJvdXRlc01ldGFbaV07CiAgICAgICAgICAgICAgdmFyIGVuZCA9IGkgPT09IHJvdXRlc01ldGEubGVuZ3RoIC0gMTsKICAgICAgICAgICAgICB2YXIgcmVtYWluaW5nUGF0aG5hbWUgPSBtYXRjaGVkUGF0aG5hbWUgPT09ICIvIiA/IHBhdGhuYW1lIDogcGF0aG5hbWUuc2xpY2UobWF0Y2hlZFBhdGhuYW1lLmxlbmd0aCkgfHwgIi8iOwogICAgICAgICAgICAgIHZhciBtYXRjaCA9IHJvdXRlcl9tYXRjaFBhdGgoewogICAgICAgICAgICAgICAgcGF0aDogbWV0YS5yZWxhdGl2ZVBhdGgsCiAgICAgICAgICAgICAgICBjYXNlU2Vuc2l0aXZlOiBtZXRhLmNhc2VTZW5zaXRpdmUsCiAgICAgICAgICAgICAgICBlbmQ6IGVuZAogICAgICAgICAgICAgIH0sIHJlbWFpbmluZ1BhdGhuYW1lKTsKICAgICAgICAgICAgICBpZiAoIW1hdGNoKSByZXR1cm4gbnVsbDsKICAgICAgICAgICAgICBPYmplY3QuYXNzaWduKG1hdGNoZWRQYXJhbXMsIG1hdGNoLnBhcmFtcyk7CiAgICAgICAgICAgICAgdmFyIHJvdXRlID0gbWV0YS5yb3V0ZTsKICAgICAgICAgICAgICBtYXRjaGVzLnB1c2goewogICAgICAgICAgICAgICAgLy8gVE9ETzogQ2FuIHRoaXMgYXMgYmUgYXZvaWRlZD8KICAgICAgICAgICAgICAgIHBhcmFtczogbWF0Y2hlZFBhcmFtcywKICAgICAgICAgICAgICAgIHBhdGhuYW1lOiByb3V0ZXJfam9pblBhdGhzKFttYXRjaGVkUGF0aG5hbWUsIG1hdGNoLnBhdGhuYW1lXSksCiAgICAgICAgICAgICAgICBwYXRobmFtZUJhc2U6IG5vcm1hbGl6ZVBhdGhuYW1lKHJvdXRlcl9qb2luUGF0aHMoW21hdGNoZWRQYXRobmFtZSwgbWF0Y2gucGF0aG5hbWVCYXNlXSkpLAogICAgICAgICAgICAgICAgcm91dGU6IHJvdXRlCiAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgIGlmIChtYXRjaC5wYXRobmFtZUJhc2UgIT09ICIvIikgewogICAgICAgICAgICAgICAgbWF0Y2hlZFBhdGhuYW1lID0gcm91dGVyX2pvaW5QYXRocyhbbWF0Y2hlZFBhdGhuYW1lLCBtYXRjaC5wYXRobmFtZUJhc2VdKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybiBtYXRjaGVzOwogICAgICAgICAgfQogICAgICAgICAgLyoqCiAgICAgICAgICAgKiBSZXR1cm5zIGEgcGF0aCB3aXRoIHBhcmFtcyBpbnRlcnBvbGF0ZWQuCiAgICAgICAgICAgKgogICAgICAgICAgICogQHNlZSBodHRwczovL3JlYWN0cm91dGVyLmNvbS91dGlscy9nZW5lcmF0ZS1wYXRoCiAgICAgICAgICAgKi8KCgogICAgICAgICAgZnVuY3Rpb24gZ2VuZXJhdGVQYXRoKG9yaWdpbmFsUGF0aCwgcGFyYW1zKSB7CiAgICAgICAgICAgIGlmIChwYXJhbXMgPT09IHZvaWQgMCkgewogICAgICAgICAgICAgIHBhcmFtcyA9IHt9OwogICAgICAgICAgICB9CgogICAgICAgICAgICB2YXIgcGF0aCA9IG9yaWdpbmFsUGF0aDsKCiAgICAgICAgICAgIGlmIChwYXRoLmVuZHNXaXRoKCIqIikgJiYgcGF0aCAhPT0gIioiICYmICFwYXRoLmVuZHNXaXRoKCIvKiIpKSB7CiAgICAgICAgICAgICAgd2FybmluZyhmYWxzZSwgIlJvdXRlIHBhdGggXCIiICsgcGF0aCArICJcIiB3aWxsIGJlIHRyZWF0ZWQgYXMgaWYgaXQgd2VyZSAiICsgKCJcIiIgKyBwYXRoLnJlcGxhY2UoL1wqJC8sICIvKiIpICsgIlwiIGJlY2F1c2UgdGhlIGAqYCBjaGFyYWN0ZXIgbXVzdCAiKSArICJhbHdheXMgZm9sbG93IGEgYC9gIGluIHRoZSBwYXR0ZXJuLiBUbyBnZXQgcmlkIG9mIHRoaXMgd2FybmluZywgIiArICgicGxlYXNlIGNoYW5nZSB0aGUgcm91dGUgcGF0aCB0byBcIiIgKyBwYXRoLnJlcGxhY2UoL1wqJC8sICIvKiIpICsgIlwiLiIpKTsKICAgICAgICAgICAgICBwYXRoID0gcGF0aC5yZXBsYWNlKC9cKiQvLCAiLyoiKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuIHBhdGgucmVwbGFjZSgvXjooXHcrKShcPz8pL2csIChfLCBrZXksIG9wdGlvbmFsKSA9PiB7CiAgICAgICAgICAgICAgdmFyIHBhcmFtID0gcGFyYW1zW2tleV07CgogICAgICAgICAgICAgIGlmIChvcHRpb25hbCA9PT0gIj8iKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gcGFyYW0gPT0gbnVsbCA/ICIiIDogcGFyYW07CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBpZiAocGFyYW0gPT0gbnVsbCkgewogICAgICAgICAgICAgICAgcm91dGVyX2ludmFyaWFudChmYWxzZSwgIk1pc3NpbmcgXCI6IiArIGtleSArICJcIiBwYXJhbSIpOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgcmV0dXJuIHBhcmFtOwogICAgICAgICAgICB9KS5yZXBsYWNlKC9cLzooXHcrKShcPz8pL2csIChfLCBrZXksIG9wdGlvbmFsKSA9PiB7CiAgICAgICAgICAgICAgdmFyIHBhcmFtID0gcGFyYW1zW2tleV07CgogICAgICAgICAgICAgIGlmIChvcHRpb25hbCA9PT0gIj8iKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gcGFyYW0gPT0gbnVsbCA/ICIiIDogIi8iICsgcGFyYW07CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBpZiAocGFyYW0gPT0gbnVsbCkgewogICAgICAgICAgICAgICAgcm91dGVyX2ludmFyaWFudChmYWxzZSwgIk1pc3NpbmcgXCI6IiArIGtleSArICJcIiBwYXJhbSIpOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgcmV0dXJuICIvIiArIHBhcmFtOwogICAgICAgICAgICB9KSAvLyBSZW1vdmUgYW55IG9wdGlvbmFsIG1hcmtlcnMgZnJvbSBvcHRpb25hbCBzdGF0aWMgc2VnbWVudHMKICAgICAgICAgICAgLnJlcGxhY2UoL1w/L2csICIiKS5yZXBsYWNlKC8oXC8/KVwqLywgKF8sIHByZWZpeCwgX18sIHN0cikgPT4gewogICAgICAgICAgICAgIHZhciBzdGFyID0gIioiOwoKICAgICAgICAgICAgICBpZiAocGFyYW1zW3N0YXJdID09IG51bGwpIHsKICAgICAgICAgICAgICAgIC8vIElmIG5vIHNwbGF0IHdhcyBwcm92aWRlZCwgdHJpbSB0aGUgdHJhaWxpbmcgc2xhc2ggX3VubGVzc18gaXQncwogICAgICAgICAgICAgICAgLy8gdGhlIGVudGlyZSBwYXRoCiAgICAgICAgICAgICAgICByZXR1cm4gc3RyID09PSAiLyoiID8gIi8iIDogIiI7CiAgICAgICAgICAgICAgfSAvLyBBcHBseSB0aGUgc3BsYXQKCgogICAgICAgICAgICAgIHJldHVybiAiIiArIHByZWZpeCArIHBhcmFtc1tzdGFyXTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9CiAgICAgICAgICAvKioKICAgICAgICAgICAqIFBlcmZvcm1zIHBhdHRlcm4gbWF0Y2hpbmcgb24gYSBVUkwgcGF0aG5hbWUgYW5kIHJldHVybnMgaW5mb3JtYXRpb24gYWJvdXQKICAgICAgICAgICAqIHRoZSBtYXRjaC4KICAgICAgICAgICAqCiAgICAgICAgICAgKiBAc2VlIGh0dHBzOi8vcmVhY3Ryb3V0ZXIuY29tL3V0aWxzL21hdGNoLXBhdGgKICAgICAgICAgICAqLwoKICAgICAgICAgIGZ1bmN0aW9uIHJvdXRlcl9tYXRjaFBhdGgocGF0dGVybiwgcGF0aG5hbWUpIHsKICAgICAgICAgICAgaWYgKHR5cGVvZiBwYXR0ZXJuID09PSAic3RyaW5nIikgewogICAgICAgICAgICAgIHBhdHRlcm4gPSB7CiAgICAgICAgICAgICAgICBwYXRoOiBwYXR0ZXJuLAogICAgICAgICAgICAgICAgY2FzZVNlbnNpdGl2ZTogZmFsc2UsCiAgICAgICAgICAgICAgICBlbmQ6IHRydWUKICAgICAgICAgICAgICB9OwogICAgICAgICAgICB9CgogICAgICAgICAgICB2YXIgX2NvbXBpbGVQYXRoID0gY29tcGlsZVBhdGgocGF0dGVybi5wYXRoLCBwYXR0ZXJuLmNhc2VTZW5zaXRpdmUsIHBhdHRlcm4uZW5kKSxfY29tcGlsZVBhdGgyID0gX3NsaWNlZFRvQXJyYXkyKF9jb21waWxlUGF0aCwgMiksbWF0Y2hlciA9IF9jb21waWxlUGF0aDJbMF0scGFyYW1OYW1lcyA9IF9jb21waWxlUGF0aDJbMV07CiAgICAgICAgICAgIHZhciBtYXRjaCA9IHBhdGhuYW1lLm1hdGNoKG1hdGNoZXIpOwogICAgICAgICAgICBpZiAoIW1hdGNoKSByZXR1cm4gbnVsbDsKICAgICAgICAgICAgdmFyIG1hdGNoZWRQYXRobmFtZSA9IG1hdGNoWzBdOwogICAgICAgICAgICB2YXIgcGF0aG5hbWVCYXNlID0gbWF0Y2hlZFBhdGhuYW1lLnJlcGxhY2UoLyguKVwvKyQvLCAiJDEiKTsKICAgICAgICAgICAgdmFyIGNhcHR1cmVHcm91cHMgPSBtYXRjaC5zbGljZSgxKTsKICAgICAgICAgICAgdmFyIHBhcmFtcyA9IHBhcmFtTmFtZXMucmVkdWNlKChtZW1vLCBwYXJhbU5hbWUsIGluZGV4KSA9PiB7CiAgICAgICAgICAgICAgLy8gV2UgbmVlZCB0byBjb21wdXRlIHRoZSBwYXRobmFtZUJhc2UgaGVyZSB1c2luZyB0aGUgcmF3IHNwbGF0IHZhbHVlCiAgICAgICAgICAgICAgLy8gaW5zdGVhZCBvZiB1c2luZyBwYXJhbXNbIioiXSBsYXRlciBiZWNhdXNlIGl0IHdpbGwgYmUgZGVjb2RlZCB0aGVuCiAgICAgICAgICAgICAgaWYgKHBhcmFtTmFtZSA9PT0gIioiKSB7CiAgICAgICAgICAgICAgICB2YXIgc3BsYXRWYWx1ZSA9IGNhcHR1cmVHcm91cHNbaW5kZXhdIHx8ICIiOwogICAgICAgICAgICAgICAgcGF0aG5hbWVCYXNlID0gbWF0Y2hlZFBhdGhuYW1lLnNsaWNlKDAsIG1hdGNoZWRQYXRobmFtZS5sZW5ndGggLSBzcGxhdFZhbHVlLmxlbmd0aCkucmVwbGFjZSgvKC4pXC8rJC8sICIkMSIpOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgbWVtb1twYXJhbU5hbWVdID0gc2FmZWx5RGVjb2RlVVJJQ29tcG9uZW50KGNhcHR1cmVHcm91cHNbaW5kZXhdIHx8ICIiLCBwYXJhbU5hbWUpOwogICAgICAgICAgICAgIHJldHVybiBtZW1vOwogICAgICAgICAgICB9LCB7fSk7CiAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgcGFyYW1zOiBwYXJhbXMsCiAgICAgICAgICAgICAgcGF0aG5hbWU6IG1hdGNoZWRQYXRobmFtZSwKICAgICAgICAgICAgICBwYXRobmFtZUJhc2U6IHBhdGhuYW1lQmFzZSwKICAgICAgICAgICAgICBwYXR0ZXJuOiBwYXR0ZXJuCiAgICAgICAgICAgIH07CiAgICAgICAgICB9CgogICAgICAgICAgZnVuY3Rpb24gY29tcGlsZVBhdGgocGF0aCwgY2FzZVNlbnNpdGl2ZSwgZW5kKSB7CiAgICAgICAgICAgIGlmIChjYXNlU2Vuc2l0aXZlID09PSB2b2lkIDApIHsKICAgICAgICAgICAgICBjYXNlU2Vuc2l0aXZlID0gZmFsc2U7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChlbmQgPT09IHZvaWQgMCkgewogICAgICAgICAgICAgIGVuZCA9IHRydWU7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHdhcm5pbmcocGF0aCA9PT0gIioiIHx8ICFwYXRoLmVuZHNXaXRoKCIqIikgfHwgcGF0aC5lbmRzV2l0aCgiLyoiKSwgIlJvdXRlIHBhdGggXCIiICsgcGF0aCArICJcIiB3aWxsIGJlIHRyZWF0ZWQgYXMgaWYgaXQgd2VyZSAiICsgKCJcIiIgKyBwYXRoLnJlcGxhY2UoL1wqJC8sICIvKiIpICsgIlwiIGJlY2F1c2UgdGhlIGAqYCBjaGFyYWN0ZXIgbXVzdCAiKSArICJhbHdheXMgZm9sbG93IGEgYC9gIGluIHRoZSBwYXR0ZXJuLiBUbyBnZXQgcmlkIG9mIHRoaXMgd2FybmluZywgIiArICgicGxlYXNlIGNoYW5nZSB0aGUgcm91dGUgcGF0aCB0byBcIiIgKyBwYXRoLnJlcGxhY2UoL1wqJC8sICIvKiIpICsgIlwiLiIpKTsKICAgICAgICAgICAgdmFyIHBhcmFtTmFtZXMgPSBbXTsKICAgICAgICAgICAgdmFyIHJlZ2V4cFNvdXJjZSA9ICJeIiArIHBhdGgucmVwbGFjZSgvXC8qXCo/JC8sICIiKSAvLyBJZ25vcmUgdHJhaWxpbmcgLyBhbmQgLyosIHdlJ2xsIGhhbmRsZSBpdCBiZWxvdwogICAgICAgICAgICAucmVwbGFjZSgvXlwvKi8sICIvIikgLy8gTWFrZSBzdXJlIGl0IGhhcyBhIGxlYWRpbmcgLwogICAgICAgICAgICAucmVwbGFjZSgvW1xcLiorXiQ/e318KClbXF1dL2csICJcXCQmIikgLy8gRXNjYXBlIHNwZWNpYWwgcmVnZXggY2hhcnMKICAgICAgICAgICAgLnJlcGxhY2UoL1wvOihcdyspL2csIChfLCBwYXJhbU5hbWUpID0+IHsKICAgICAgICAgICAgICBwYXJhbU5hbWVzLnB1c2gocGFyYW1OYW1lKTsKICAgICAgICAgICAgICByZXR1cm4gIi8oW15cXC9dKykiOwogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIGlmIChwYXRoLmVuZHNXaXRoKCIqIikpIHsKICAgICAgICAgICAgICBwYXJhbU5hbWVzLnB1c2goIioiKTsKICAgICAgICAgICAgICByZWdleHBTb3VyY2UgKz0gcGF0aCA9PT0gIioiIHx8IHBhdGggPT09ICIvKiIgPyAiKC4qKSQiIC8vIEFscmVhZHkgbWF0Y2hlZCB0aGUgaW5pdGlhbCAvLCBqdXN0IG1hdGNoIHRoZSByZXN0CiAgICAgICAgICAgICAgOiAiKD86XFwvKC4rKXxcXC8qKSQiOyAvLyBEb24ndCBpbmNsdWRlIHRoZSAvIGluIHBhcmFtc1siKiJdCiAgICAgICAgICAgIH0gZWxzZSBpZiAoZW5kKSB7CiAgICAgICAgICAgICAgLy8gV2hlbiBtYXRjaGluZyB0byB0aGUgZW5kLCBpZ25vcmUgdHJhaWxpbmcgc2xhc2hlcwogICAgICAgICAgICAgIHJlZ2V4cFNvdXJjZSArPSAiXFwvKiQiOwogICAgICAgICAgICB9IGVsc2UgaWYgKHBhdGggIT09ICIiICYmIHBhdGggIT09ICIvIikgewogICAgICAgICAgICAgIC8vIElmIG91ciBwYXRoIGlzIG5vbi1lbXB0eSBhbmQgY29udGFpbnMgYW55dGhpbmcgYmV5b25kIGFuIGluaXRpYWwgc2xhc2gsCiAgICAgICAgICAgICAgLy8gdGhlbiB3ZSBoYXZlIF9zb21lXyBmb3JtIG9mIHBhdGggaW4gb3VyIHJlZ2V4IHNvIHdlIHNob3VsZCBleHBlY3QgdG8KICAgICAgICAgICAgICAvLyBtYXRjaCBvbmx5IGlmIHdlIGZpbmQgdGhlIGVuZCBvZiB0aGlzIHBhdGggc2VnbWVudC4gIExvb2sgZm9yIGFuIG9wdGlvbmFsCiAgICAgICAgICAgICAgLy8gbm9uLWNhcHR1cmVkIHRyYWlsaW5nIHNsYXNoICh0byBtYXRjaCBhIHBvcnRpb24gb2YgdGhlIFVSTCkgb3IgdGhlIGVuZAogICAgICAgICAgICAgIC8vIG9mIHRoZSBwYXRoIChpZiB3ZSd2ZSBtYXRjaGVkIHRvIHRoZSBlbmQpLiAgV2UgdXNlZCB0byBkbyB0aGlzIHdpdGggYQogICAgICAgICAgICAgIC8vIHdvcmQgYm91bmRhcnkgYnV0IHRoYXQgZ2l2ZXMgZmFsc2UgcG9zaXRpdmVzIG9uIHJvdXRlcyBsaWtlCiAgICAgICAgICAgICAgLy8gL3VzZXItcHJlZmVyZW5jZXMgc2luY2UgYC1gIGNvdW50cyBhcyBhIHdvcmQgYm91bmRhcnkuCiAgICAgICAgICAgICAgcmVnZXhwU291cmNlICs9ICIoPzooPz1cXC98JCkpIjsKICAgICAgICAgICAgfSBlbHNlIDsKCiAgICAgICAgICAgIHZhciBtYXRjaGVyID0gbmV3IFJlZ0V4cChyZWdleHBTb3VyY2UsIGNhc2VTZW5zaXRpdmUgPyB1bmRlZmluZWQgOiAiaSIpOwogICAgICAgICAgICByZXR1cm4gW21hdGNoZXIsIHBhcmFtTmFtZXNdOwogICAgICAgICAgfQoKICAgICAgICAgIGZ1bmN0aW9uIHNhZmVseURlY29kZVVSSSh2YWx1ZSkgewogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgIHJldHVybiBkZWNvZGVVUkkodmFsdWUpOwogICAgICAgICAgICB9IGNhdGNoIChlcnJvcikgewogICAgICAgICAgICAgIHdhcm5pbmcoZmFsc2UsICJUaGUgVVJMIHBhdGggXCIiICsgdmFsdWUgKyAiXCIgY291bGQgbm90IGJlIGRlY29kZWQgYmVjYXVzZSBpdCBpcyBpcyBhICIgKyAibWFsZm9ybWVkIFVSTCBzZWdtZW50LiBUaGlzIGlzIHByb2JhYmx5IGR1ZSB0byBhIGJhZCBwZXJjZW50ICIgKyAoImVuY29kaW5nICgiICsgZXJyb3IgKyAiKS4iKSk7CiAgICAgICAgICAgICAgcmV0dXJuIHZhbHVlOwogICAgICAgICAgICB9CiAgICAgICAgICB9CgogICAgICAgICAgZnVuY3Rpb24gc2FmZWx5RGVjb2RlVVJJQ29tcG9uZW50KHZhbHVlLCBwYXJhbU5hbWUpIHsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICByZXR1cm4gZGVjb2RlVVJJQ29tcG9uZW50KHZhbHVlKTsKICAgICAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICAgICAgICB3YXJuaW5nKGZhbHNlLCAiVGhlIHZhbHVlIGZvciB0aGUgVVJMIHBhcmFtIFwiIiArIHBhcmFtTmFtZSArICJcIiB3aWxsIG5vdCBiZSBkZWNvZGVkIGJlY2F1c2UiICsgKCIgdGhlIHN0cmluZyBcIiIgKyB2YWx1ZSArICJcIiBpcyBhIG1hbGZvcm1lZCBVUkwgc2VnbWVudC4gVGhpcyBpcyBwcm9iYWJseSIpICsgKCIgZHVlIHRvIGEgYmFkIHBlcmNlbnQgZW5jb2RpbmcgKCIgKyBlcnJvciArICIpLiIpKTsKICAgICAgICAgICAgICByZXR1cm4gdmFsdWU7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIC8qKgogICAgICAgICAgICogQHByaXZhdGUKICAgICAgICAgICAqLwoKCiAgICAgICAgICBmdW5jdGlvbiBzdHJpcEJhc2VuYW1lKHBhdGhuYW1lLCBiYXNlbmFtZSkgewogICAgICAgICAgICBpZiAoYmFzZW5hbWUgPT09ICIvIikgcmV0dXJuIHBhdGhuYW1lOwoKICAgICAgICAgICAgaWYgKCFwYXRobmFtZS50b0xvd2VyQ2FzZSgpLnN0YXJ0c1dpdGgoYmFzZW5hbWUudG9Mb3dlckNhc2UoKSkpIHsKICAgICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICAgICAgfSAvLyBXZSB3YW50IHRvIGxlYXZlIHRyYWlsaW5nIHNsYXNoIGJlaGF2aW9yIGluIHRoZSB1c2VyJ3MgY29udHJvbCwgc28gaWYgdGhleQogICAgICAgICAgICAvLyBzcGVjaWZ5IGEgYmFzZW5hbWUgd2l0aCBhIHRyYWlsaW5nIHNsYXNoLCB3ZSBzaG91bGQgc3VwcG9ydCBpdAoKCiAgICAgICAgICAgIHZhciBzdGFydEluZGV4ID0gYmFzZW5hbWUuZW5kc1dpdGgoIi8iKSA/IGJhc2VuYW1lLmxlbmd0aCAtIDEgOiBiYXNlbmFtZS5sZW5ndGg7CiAgICAgICAgICAgIHZhciBuZXh0Q2hhciA9IHBhdGhuYW1lLmNoYXJBdChzdGFydEluZGV4KTsKCiAgICAgICAgICAgIGlmIChuZXh0Q2hhciAmJiBuZXh0Q2hhciAhPT0gIi8iKSB7CiAgICAgICAgICAgICAgLy8gcGF0aG5hbWUgZG9lcyBub3Qgc3RhcnQgd2l0aCBiYXNlbmFtZS8KICAgICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuIHBhdGhuYW1lLnNsaWNlKHN0YXJ0SW5kZXgpIHx8ICIvIjsKICAgICAgICAgIH0KICAgICAgICAgIC8qKgogICAgICAgICAgICogQHByaXZhdGUKICAgICAgICAgICAqLwoKICAgICAgICAgIGZ1bmN0aW9uIHdhcm5pbmcoY29uZCwgbWVzc2FnZSkgewogICAgICAgICAgICBpZiAoIWNvbmQpIHsKICAgICAgICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tY29uc29sZQogICAgICAgICAgICAgIGlmICh0eXBlb2YgY29uc29sZSAhPT0gInVuZGVmaW5lZCIpIGNvbnNvbGUud2FybihtZXNzYWdlKTsKCiAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIC8vIFdlbGNvbWUgdG8gZGVidWdnaW5nIEByZW1peC1ydW4vcm91dGVyIQogICAgICAgICAgICAgICAgLy8KICAgICAgICAgICAgICAgIC8vIFRoaXMgZXJyb3IgaXMgdGhyb3duIGFzIGEgY29udmVuaWVuY2Ugc28geW91IGNhbiBtb3JlIGVhc2lseQogICAgICAgICAgICAgICAgLy8gZmluZCB0aGUgc291cmNlIGZvciBhIHdhcm5pbmcgdGhhdCBhcHBlYXJzIGluIHRoZSBjb25zb2xlIGJ5CiAgICAgICAgICAgICAgICAvLyBlbmFibGluZyAicGF1c2Ugb24gZXhjZXB0aW9ucyIgaW4geW91ciBKYXZhU2NyaXB0IGRlYnVnZ2VyLgogICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKG1lc3NhZ2UpOyAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tZW1wdHkKICAgICAgICAgICAgICB9IGNhdGNoIChlKSB7fQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICAvKioKICAgICAgICAgICAqIFJldHVybnMgYSByZXNvbHZlZCBwYXRoIG9iamVjdCByZWxhdGl2ZSB0byB0aGUgZ2l2ZW4gcGF0aG5hbWUuCiAgICAgICAgICAgKgogICAgICAgICAgICogQHNlZSBodHRwczovL3JlYWN0cm91dGVyLmNvbS91dGlscy9yZXNvbHZlLXBhdGgKICAgICAgICAgICAqLwoKICAgICAgICAgIGZ1bmN0aW9uIHJlc29sdmVQYXRoKHRvLCBmcm9tUGF0aG5hbWUpIHsKICAgICAgICAgICAgaWYgKGZyb21QYXRobmFtZSA9PT0gdm9pZCAwKSB7CiAgICAgICAgICAgICAgZnJvbVBhdGhuYW1lID0gIi8iOwogICAgICAgICAgICB9CgogICAgICAgICAgICB2YXIgX3JlZjkgPQoKCgogICAgICAgICAgICAgIHR5cGVvZiB0byA9PT0gInN0cmluZyIgPyBwYXJzZVBhdGgodG8pIDogdG8sdG9QYXRobmFtZSA9IF9yZWY5LnBhdGhuYW1lLF9yZWY5JHNlYXJjaCA9IF9yZWY5LnNlYXJjaCxzZWFyY2ggPSBfcmVmOSRzZWFyY2ggPT09IHZvaWQgMCA/ICIiIDogX3JlZjkkc2VhcmNoLF9yZWY5JGhhc2ggPSBfcmVmOS5oYXNoLGhhc2ggPSBfcmVmOSRoYXNoID09PSB2b2lkIDAgPyAiIiA6IF9yZWY5JGhhc2g7CiAgICAgICAgICAgIHZhciBwYXRobmFtZSA9IHRvUGF0aG5hbWUgPyB0b1BhdGhuYW1lLnN0YXJ0c1dpdGgoIi8iKSA/IHRvUGF0aG5hbWUgOiByZXNvbHZlUGF0aG5hbWUodG9QYXRobmFtZSwgZnJvbVBhdGhuYW1lKSA6IGZyb21QYXRobmFtZTsKICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICBwYXRobmFtZTogcGF0aG5hbWUsCiAgICAgICAgICAgICAgc2VhcmNoOiBub3JtYWxpemVTZWFyY2goc2VhcmNoKSwKICAgICAgICAgICAgICBoYXNoOiBub3JtYWxpemVIYXNoKGhhc2gpCiAgICAgICAgICAgIH07CiAgICAgICAgICB9CgogICAgICAgICAgZnVuY3Rpb24gcmVzb2x2ZVBhdGhuYW1lKHJlbGF0aXZlUGF0aCwgZnJvbVBhdGhuYW1lKSB7CiAgICAgICAgICAgIHZhciBzZWdtZW50cyA9IGZyb21QYXRobmFtZS5yZXBsYWNlKC9cLyskLywgIiIpLnNwbGl0KCIvIik7CiAgICAgICAgICAgIHZhciByZWxhdGl2ZVNlZ21lbnRzID0gcmVsYXRpdmVQYXRoLnNwbGl0KCIvIik7CiAgICAgICAgICAgIHJlbGF0aXZlU2VnbWVudHMuZm9yRWFjaCgoc2VnbWVudCkgPT4gewogICAgICAgICAgICAgIGlmIChzZWdtZW50ID09PSAiLi4iKSB7CiAgICAgICAgICAgICAgICAvLyBLZWVwIHRoZSByb290ICIiIHNlZ21lbnQgc28gdGhlIHBhdGhuYW1lIHN0YXJ0cyBhdCAvCiAgICAgICAgICAgICAgICBpZiAoc2VnbWVudHMubGVuZ3RoID4gMSkgc2VnbWVudHMucG9wKCk7CiAgICAgICAgICAgICAgfSBlbHNlIGlmIChzZWdtZW50ICE9PSAiLiIpIHsKICAgICAgICAgICAgICAgIHNlZ21lbnRzLnB1c2goc2VnbWVudCk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICAgICAgcmV0dXJuIHNlZ21lbnRzLmxlbmd0aCA+IDEgPyBzZWdtZW50cy5qb2luKCIvIikgOiAiLyI7CiAgICAgICAgICB9CgogICAgICAgICAgZnVuY3Rpb24gZ2V0SW52YWxpZFBhdGhFcnJvcihjaGFyLCBmaWVsZCwgZGVzdCwgcGF0aCkgewogICAgICAgICAgICByZXR1cm4gIkNhbm5vdCBpbmNsdWRlIGEgJyIgKyBjaGFyICsgIicgY2hhcmFjdGVyIGluIGEgbWFudWFsbHkgc3BlY2lmaWVkICIgKyAoImB0by4iICsgZmllbGQgKyAiYCBmaWVsZCBbIiArIEpTT04uc3RyaW5naWZ5KHBhdGgpICsgIl0uICBQbGVhc2Ugc2VwYXJhdGUgaXQgb3V0IHRvIHRoZSAiKSArICgiYHRvLiIgKyBkZXN0ICsgImAgZmllbGQuIEFsdGVybmF0aXZlbHkgeW91IG1heSBwcm92aWRlIHRoZSBmdWxsIHBhdGggYXMgIikgKyAiYSBzdHJpbmcgaW4gPExpbmsgdG89XCIuLi5cIj4gYW5kIHRoZSByb3V0ZXIgd2lsbCBwYXJzZSBpdCBmb3IgeW91LiI7CiAgICAgICAgICB9CiAgICAgICAgICAvKioKICAgICAgICAgICAqIEBwcml2YXRlCiAgICAgICAgICAgKgogICAgICAgICAgICogV2hlbiBwcm9jZXNzaW5nIHJlbGF0aXZlIG5hdmlnYXRpb24gd2Ugd2FudCB0byBpZ25vcmUgYW5jZXN0b3Igcm91dGVzIHRoYXQKICAgICAgICAgICAqIGRvIG5vdCBjb250cmlidXRlIHRvIHRoZSBwYXRoLCBzdWNoIHRoYXQgaW5kZXgvcGF0aGxlc3MgbGF5b3V0IHJvdXRlcyBkb24ndAogICAgICAgICAgICogaW50ZXJmZXJlLgogICAgICAgICAgICoKICAgICAgICAgICAqIEZvciBleGFtcGxlLCB3aGVuIG1vdmluZyBhIHJvdXRlIGVsZW1lbnQgaW50byBhbiBpbmRleCByb3V0ZSBhbmQvb3IgYQogICAgICAgICAgICogcGF0aGxlc3MgbGF5b3V0IHJvdXRlLCByZWxhdGl2ZSBsaW5rIGJlaGF2aW9yIGNvbnRhaW5lZCB3aXRoaW4gc2hvdWxkIHN0YXkKICAgICAgICAgICAqIHRoZSBzYW1lLiAgQm90aCBvZiB0aGUgZm9sbG93aW5nIGV4YW1wbGVzIHNob3VsZCBsaW5rIGJhY2sgdG8gdGhlIHJvb3Q6CiAgICAgICAgICAgKgogICAgICAgICAgICogICA8Um91dGUgcGF0aD0iLyI+CiAgICAgICAgICAgKiAgICAgPFJvdXRlIHBhdGg9ImFjY291bnRzIiBlbGVtZW50PXs8TGluayB0bz0iLi4ifT4KICAgICAgICAgICAqICAgPC9Sb3V0ZT4KICAgICAgICAgICAqCiAgICAgICAgICAgKiAgIDxSb3V0ZSBwYXRoPSIvIj4KICAgICAgICAgICAqICAgICA8Um91dGUgcGF0aD0iYWNjb3VudHMiPgogICAgICAgICAgICogICAgICAgPFJvdXRlIGVsZW1lbnQ9ezxBY2NvdW50c0xheW91dCAvPn0+ICAgICAgIC8vIDwtLSBEb2VzIG5vdCBjb250cmlidXRlCiAgICAgICAgICAgKiAgICAgICAgIDxSb3V0ZSBpbmRleCBlbGVtZW50PXs8TGluayB0bz0iLi4ifSAvPiAgLy8gPC0tIERvZXMgbm90IGNvbnRyaWJ1dGUKICAgICAgICAgICAqICAgICAgIDwvUm91dGUKICAgICAgICAgICAqICAgICA8L1JvdXRlPgogICAgICAgICAgICogICA8L1JvdXRlPgogICAgICAgICAgICovCgoKICAgICAgICAgIGZ1bmN0aW9uIGdldFBhdGhDb250cmlidXRpbmdNYXRjaGVzKG1hdGNoZXMpIHsKICAgICAgICAgICAgcmV0dXJuIG1hdGNoZXMuZmlsdGVyKChtYXRjaCwgaW5kZXgpID0+IGluZGV4ID09PSAwIHx8IG1hdGNoLnJvdXRlLnBhdGggJiYgbWF0Y2gucm91dGUucGF0aC5sZW5ndGggPiAwKTsKICAgICAgICAgIH0KICAgICAgICAgIC8qKgogICAgICAgICAgICogQHByaXZhdGUKICAgICAgICAgICAqLwoKICAgICAgICAgIGZ1bmN0aW9uIHJlc29sdmVUbyh0b0FyZywgcm91dGVQYXRobmFtZXMsIGxvY2F0aW9uUGF0aG5hbWUsIGlzUGF0aFJlbGF0aXZlKSB7CiAgICAgICAgICAgIGlmIChpc1BhdGhSZWxhdGl2ZSA9PT0gdm9pZCAwKSB7CiAgICAgICAgICAgICAgaXNQYXRoUmVsYXRpdmUgPSBmYWxzZTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdmFyIHRvOwoKICAgICAgICAgICAgaWYgKHR5cGVvZiB0b0FyZyA9PT0gInN0cmluZyIpIHsKICAgICAgICAgICAgICB0byA9IHBhcnNlUGF0aCh0b0FyZyk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgdG8gPSBfZXh0ZW5kcyh7fSwgdG9BcmcpOwogICAgICAgICAgICAgIHJvdXRlcl9pbnZhcmlhbnQoIXRvLnBhdGhuYW1lIHx8ICF0by5wYXRobmFtZS5pbmNsdWRlcygiPyIpLCBnZXRJbnZhbGlkUGF0aEVycm9yKCI/IiwgInBhdGhuYW1lIiwgInNlYXJjaCIsIHRvKSk7CiAgICAgICAgICAgICAgcm91dGVyX2ludmFyaWFudCghdG8ucGF0aG5hbWUgfHwgIXRvLnBhdGhuYW1lLmluY2x1ZGVzKCIjIiksIGdldEludmFsaWRQYXRoRXJyb3IoIiMiLCAicGF0aG5hbWUiLCAiaGFzaCIsIHRvKSk7CiAgICAgICAgICAgICAgcm91dGVyX2ludmFyaWFudCghdG8uc2VhcmNoIHx8ICF0by5zZWFyY2guaW5jbHVkZXMoIiMiKSwgZ2V0SW52YWxpZFBhdGhFcnJvcigiIyIsICJzZWFyY2giLCAiaGFzaCIsIHRvKSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHZhciBpc0VtcHR5UGF0aCA9IHRvQXJnID09PSAiIiB8fCB0by5wYXRobmFtZSA9PT0gIiI7CiAgICAgICAgICAgIHZhciB0b1BhdGhuYW1lID0gaXNFbXB0eVBhdGggPyAiLyIgOiB0by5wYXRobmFtZTsKICAgICAgICAgICAgdmFyIGZyb207IC8vIFJvdXRpbmcgaXMgcmVsYXRpdmUgdG8gdGhlIGN1cnJlbnQgcGF0aG5hbWUgaWYgZXhwbGljaXRseSByZXF1ZXN0ZWQuCiAgICAgICAgICAgIC8vCiAgICAgICAgICAgIC8vIElmIGEgcGF0aG5hbWUgaXMgZXhwbGljaXRseSBwcm92aWRlZCBpbiBgdG9gLCBpdCBzaG91bGQgYmUgcmVsYXRpdmUgdG8gdGhlCiAgICAgICAgICAgIC8vIHJvdXRlIGNvbnRleHQuIFRoaXMgaXMgZXhwbGFpbmVkIGluIGBOb3RlIG9uIGA8TGluayB0bz5gIHZhbHVlc2AgaW4gb3VyCiAgICAgICAgICAgIC8vIG1pZ3JhdGlvbiBndWlkZSBmcm9tIHY1IGFzIGEgbWVhbnMgb2YgZGlzYW1iaWd1YXRpb24gYmV0d2VlbiBgdG9gIHZhbHVlcwogICAgICAgICAgICAvLyB0aGF0IGJlZ2luIHdpdGggYC9gIGFuZCB0aG9zZSB0aGF0IGRvIG5vdC4gSG93ZXZlciwgdGhpcyBpcyBwcm9ibGVtYXRpYyBmb3IKICAgICAgICAgICAgLy8gYHRvYCB2YWx1ZXMgdGhhdCBkbyBub3QgcHJvdmlkZSBhIHBhdGhuYW1lLiBgdG9gIGNhbiBzaW1wbHkgYmUgYSBzZWFyY2ggb3IKICAgICAgICAgICAgLy8gaGFzaCBzdHJpbmcsIGluIHdoaWNoIGNhc2Ugd2Ugc2hvdWxkIGFzc3VtZSB0aGF0IHRoZSBuYXZpZ2F0aW9uIGlzIHJlbGF0aXZlCiAgICAgICAgICAgIC8vIHRvIHRoZSBjdXJyZW50IGxvY2F0aW9uJ3MgcGF0aG5hbWUgYW5kICpub3QqIHRoZSByb3V0ZSBwYXRobmFtZS4KCiAgICAgICAgICAgIGlmIChpc1BhdGhSZWxhdGl2ZSB8fCB0b1BhdGhuYW1lID09IG51bGwpIHsKICAgICAgICAgICAgICBmcm9tID0gbG9jYXRpb25QYXRobmFtZTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICB2YXIgcm91dGVQYXRobmFtZUluZGV4ID0gcm91dGVQYXRobmFtZXMubGVuZ3RoIC0gMTsKCiAgICAgICAgICAgICAgaWYgKHRvUGF0aG5hbWUuc3RhcnRzV2l0aCgiLi4iKSkgewogICAgICAgICAgICAgICAgdmFyIHRvU2VnbWVudHMgPSB0b1BhdGhuYW1lLnNwbGl0KCIvIik7IC8vIEVhY2ggbGVhZGluZyAuLiBzZWdtZW50IG1lYW5zICJnbyB1cCBvbmUgcm91dGUiIGluc3RlYWQgb2YgImdvIHVwIG9uZQogICAgICAgICAgICAgICAgLy8gVVJMIHNlZ21lbnQiLiAgVGhpcyBpcyBhIGtleSBkaWZmZXJlbmNlIGZyb20gaG93IDxhIGhyZWY+IHdvcmtzIGFuZCBhCiAgICAgICAgICAgICAgICAvLyBtYWpvciByZWFzb24gd2UgY2FsbCB0aGlzIGEgInRvIiB2YWx1ZSBpbnN0ZWFkIG9mIGEgImhyZWYiLgoKICAgICAgICAgICAgICAgIHdoaWxlICh0b1NlZ21lbnRzWzBdID09PSAiLi4iKSB7CiAgICAgICAgICAgICAgICAgIHRvU2VnbWVudHMuc2hpZnQoKTsKICAgICAgICAgICAgICAgICAgcm91dGVQYXRobmFtZUluZGV4IC09IDE7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgdG8ucGF0aG5hbWUgPSB0b1NlZ21lbnRzLmpvaW4oIi8iKTsKICAgICAgICAgICAgICB9IC8vIElmIHRoZXJlIGFyZSBtb3JlICIuLiIgc2VnbWVudHMgdGhhbiBwYXJlbnQgcm91dGVzLCByZXNvbHZlIHJlbGF0aXZlIHRvCiAgICAgICAgICAgICAgLy8gdGhlIHJvb3QgLyBVUkwuCgoKICAgICAgICAgICAgICBmcm9tID0gcm91dGVQYXRobmFtZUluZGV4ID49IDAgPyByb3V0ZVBhdGhuYW1lc1tyb3V0ZVBhdGhuYW1lSW5kZXhdIDogIi8iOwogICAgICAgICAgICB9CgogICAgICAgICAgICB2YXIgcGF0aCA9IHJlc29sdmVQYXRoKHRvLCBmcm9tKTsgLy8gRW5zdXJlIHRoZSBwYXRobmFtZSBoYXMgYSB0cmFpbGluZyBzbGFzaCBpZiB0aGUgb3JpZ2luYWwgInRvIiBoYWQgb25lCgogICAgICAgICAgICB2YXIgaGFzRXhwbGljaXRUcmFpbGluZ1NsYXNoID0gdG9QYXRobmFtZSAmJiB0b1BhdGhuYW1lICE9PSAiLyIgJiYgdG9QYXRobmFtZS5lbmRzV2l0aCgiLyIpOyAvLyBPciBpZiB0aGlzIHdhcyBhIGxpbmsgdG8gdGhlIGN1cnJlbnQgcGF0aCB3aGljaCBoYXMgYSB0cmFpbGluZyBzbGFzaAoKICAgICAgICAgICAgdmFyIGhhc0N1cnJlbnRUcmFpbGluZ1NsYXNoID0gKGlzRW1wdHlQYXRoIHx8IHRvUGF0aG5hbWUgPT09ICIuIikgJiYgbG9jYXRpb25QYXRobmFtZS5lbmRzV2l0aCgiLyIpOwoKICAgICAgICAgICAgaWYgKCFwYXRoLnBhdGhuYW1lLmVuZHNXaXRoKCIvIikgJiYgKGhhc0V4cGxpY2l0VHJhaWxpbmdTbGFzaCB8fCBoYXNDdXJyZW50VHJhaWxpbmdTbGFzaCkpIHsKICAgICAgICAgICAgICBwYXRoLnBhdGhuYW1lICs9ICIvIjsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuIHBhdGg7CiAgICAgICAgICB9CiAgICAgICAgICAvKioKICAgICAgICAgICAqIEBwcml2YXRlCiAgICAgICAgICAgKi8KCiAgICAgICAgICBmdW5jdGlvbiBnZXRUb1BhdGhuYW1lKHRvKSB7CiAgICAgICAgICAgIC8vIEVtcHR5IHN0cmluZ3Mgc2hvdWxkIGJlIHRyZWF0ZWQgdGhlIHNhbWUgYXMgLyBwYXRocwogICAgICAgICAgICByZXR1cm4gdG8gPT09ICIiIHx8IHRvLnBhdGhuYW1lID09PSAiIiA/ICIvIiA6IHR5cGVvZiB0byA9PT0gInN0cmluZyIgPyBwYXJzZVBhdGgodG8pLnBhdGhuYW1lIDogdG8ucGF0aG5hbWU7CiAgICAgICAgICB9CiAgICAgICAgICAvKioKICAgICAgICAgICAqIEBwcml2YXRlCiAgICAgICAgICAgKi8KCiAgICAgICAgICB2YXIgcm91dGVyX2pvaW5QYXRocyA9IChwYXRocykgPT4gcGF0aHMuam9pbigiLyIpLnJlcGxhY2UoL1wvXC8rL2csICIvIik7CiAgICAgICAgICAvKioKICAgICAgICAgICAqIEBwcml2YXRlCiAgICAgICAgICAgKi8KCiAgICAgICAgICB2YXIgbm9ybWFsaXplUGF0aG5hbWUgPSAocGF0aG5hbWUpID0+IHBhdGhuYW1lLnJlcGxhY2UoL1wvKyQvLCAiIikucmVwbGFjZSgvXlwvKi8sICIvIik7CiAgICAgICAgICAvKioKICAgICAgICAgICAqIEBwcml2YXRlCiAgICAgICAgICAgKi8KCiAgICAgICAgICB2YXIgbm9ybWFsaXplU2VhcmNoID0gKHNlYXJjaCkgPT4gIXNlYXJjaCB8fCBzZWFyY2ggPT09ICI/IiA/ICIiIDogc2VhcmNoLnN0YXJ0c1dpdGgoIj8iKSA/IHNlYXJjaCA6ICI/IiArIHNlYXJjaDsKICAgICAgICAgIC8qKgogICAgICAgICAgICogQHByaXZhdGUKICAgICAgICAgICAqLwoKICAgICAgICAgIHZhciBub3JtYWxpemVIYXNoID0gKGhhc2gpID0+ICFoYXNoIHx8IGhhc2ggPT09ICIjIiA/ICIiIDogaGFzaC5zdGFydHNXaXRoKCIjIikgPyBoYXNoIDogIiMiICsgaGFzaDsKICAgICAgICAgIC8qKgogICAgICAgICAgICogVGhpcyBpcyBhIHNob3J0Y3V0IGZvciBjcmVhdGluZyBgYXBwbGljYXRpb24vanNvbmAgcmVzcG9uc2VzLiBDb252ZXJ0cyBgZGF0YWAKICAgICAgICAgICAqIHRvIEpTT04gYW5kIHNldHMgdGhlIGBDb250ZW50LVR5cGVgIGhlYWRlci4KICAgICAgICAgICAqLwoKICAgICAgICAgIHZhciBqc29uID0gZnVuY3Rpb24ganNvbihkYXRhLCBpbml0KSB7CiAgICAgICAgICAgIGlmIChpbml0ID09PSB2b2lkIDApIHsKICAgICAgICAgICAgICBpbml0ID0ge307CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHZhciByZXNwb25zZUluaXQgPSB0eXBlb2YgaW5pdCA9PT0gIm51bWJlciIgPyB7CiAgICAgICAgICAgICAgc3RhdHVzOiBpbml0CiAgICAgICAgICAgIH0gOiBpbml0OwogICAgICAgICAgICB2YXIgaGVhZGVycyA9IG5ldyBIZWFkZXJzKHJlc3BvbnNlSW5pdC5oZWFkZXJzKTsKCiAgICAgICAgICAgIGlmICghaGVhZGVycy5oYXMoIkNvbnRlbnQtVHlwZSIpKSB7CiAgICAgICAgICAgICAgaGVhZGVycy5zZXQoIkNvbnRlbnQtVHlwZSIsICJhcHBsaWNhdGlvbi9qc29uOyBjaGFyc2V0PXV0Zi04Iik7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybiBuZXcgUmVzcG9uc2UoSlNPTi5zdHJpbmdpZnkoZGF0YSksIF9leHRlbmRzKHt9LCByZXNwb25zZUluaXQsIHsKICAgICAgICAgICAgICBoZWFkZXJzOiBoZWFkZXJzCiAgICAgICAgICAgIH0pKTsKICAgICAgICAgIH07dmFyCiAgICAgICAgICByb3V0ZXJfQWJvcnRlZERlZmVycmVkRXJyb3IgPSAvKiNfX1BVUkVfXyovZnVuY3Rpb24gKF9FcnJvcikge19pbmhlcml0cyhyb3V0ZXJfQWJvcnRlZERlZmVycmVkRXJyb3IsIF9FcnJvcik7dmFyIF9zdXBlciA9IF9jcmVhdGVTdXBlcihyb3V0ZXJfQWJvcnRlZERlZmVycmVkRXJyb3IpO2Z1bmN0aW9uIHJvdXRlcl9BYm9ydGVkRGVmZXJyZWRFcnJvcigpIHtfY2xhc3NDYWxsQ2hlY2syKHRoaXMsIHJvdXRlcl9BYm9ydGVkRGVmZXJyZWRFcnJvcik7cmV0dXJuIF9zdXBlci5hcHBseSh0aGlzLCBhcmd1bWVudHMpO31yZXR1cm4gX2NyZWF0ZUNsYXNzMihyb3V0ZXJfQWJvcnRlZERlZmVycmVkRXJyb3IpO30oIC8qI19fUFVSRV9fKi9fd3JhcE5hdGl2ZVN1cGVyKEVycm9yKSk7dmFyCiAgICAgICAgICBEZWZlcnJlZERhdGEgPSAvKiNfX1BVUkVfXyovZnVuY3Rpb24gKCkgewogICAgICAgICAgICBmdW5jdGlvbiBEZWZlcnJlZERhdGEoZGF0YSwgcmVzcG9uc2VJbml0KSB7X2NsYXNzQ2FsbENoZWNrMih0aGlzLCBEZWZlcnJlZERhdGEpOwogICAgICAgICAgICAgIHRoaXMucGVuZGluZ0tleXNTZXQgPSBuZXcgU2V0KCk7CiAgICAgICAgICAgICAgdGhpcy5zdWJzY3JpYmVycyA9IG5ldyBTZXQoKTsKICAgICAgICAgICAgICB0aGlzLmRlZmVycmVkS2V5cyA9IFtdOwogICAgICAgICAgICAgIHJvdXRlcl9pbnZhcmlhbnQoZGF0YSAmJiB0eXBlb2YgZGF0YSA9PT0gIm9iamVjdCIgJiYgIUFycmF5LmlzQXJyYXkoZGF0YSksICJkZWZlcigpIG9ubHkgYWNjZXB0cyBwbGFpbiBvYmplY3RzIik7IC8vIFNldCB1cCBhbiBBYm9ydENvbnRyb2xsZXIgKyBQcm9taXNlIHdlIGNhbiByYWNlIGFnYWluc3QgdG8gZXhpdCBlYXJseQogICAgICAgICAgICAgIC8vIGNhbmNlbGxhdGlvbgoKICAgICAgICAgICAgICB2YXIgcmVqZWN0OwogICAgICAgICAgICAgIHRoaXMuYWJvcnRQcm9taXNlID0gbmV3IFByb21pc2UoKF8sIHIpID0+IHJlamVjdCA9IHIpOwogICAgICAgICAgICAgIHRoaXMuY29udHJvbGxlciA9IG5ldyBBYm9ydENvbnRyb2xsZXIoKTsKCiAgICAgICAgICAgICAgdmFyIG9uQWJvcnQgPSAoKSA9PiByZWplY3QobmV3IHJvdXRlcl9BYm9ydGVkRGVmZXJyZWRFcnJvcigiRGVmZXJyZWQgZGF0YSBhYm9ydGVkIikpOwoKICAgICAgICAgICAgICB0aGlzLnVubGlzdGVuQWJvcnRTaWduYWwgPSAoKSA9PiB0aGlzLmNvbnRyb2xsZXIuc2lnbmFsLnJlbW92ZUV2ZW50TGlzdGVuZXIoImFib3J0Iiwgb25BYm9ydCk7CgogICAgICAgICAgICAgIHRoaXMuY29udHJvbGxlci5zaWduYWwuYWRkRXZlbnRMaXN0ZW5lcigiYWJvcnQiLCBvbkFib3J0KTsKICAgICAgICAgICAgICB0aGlzLmRhdGEgPSBPYmplY3QuZW50cmllcyhkYXRhKS5yZWR1Y2UoKGFjYywgX3JlZikgPT4gewogICAgICAgICAgICAgICAgdmFyIF9yZWYxMCA9IF9zbGljZWRUb0FycmF5MihfcmVmLCAyKSxrZXkgPSBfcmVmMTBbMF0sdmFsdWUgPSBfcmVmMTBbMV07CiAgICAgICAgICAgICAgICByZXR1cm4gT2JqZWN0LmFzc2lnbihhY2MsIF9kZWZpbmVQcm9wZXJ0eTIoe30sCiAgICAgICAgICAgICAgICBrZXksIHRoaXMudHJhY2tQcm9taXNlKGtleSwgdmFsdWUpKSk7CgogICAgICAgICAgICAgIH0sIHt9KTsKCiAgICAgICAgICAgICAgaWYgKHRoaXMuZG9uZSkgewogICAgICAgICAgICAgICAgLy8gQWxsIGluY29taW5nIHZhbHVlcyB3ZXJlIHJlc29sdmVkCiAgICAgICAgICAgICAgICB0aGlzLnVubGlzdGVuQWJvcnRTaWduYWwoKTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIHRoaXMuaW5pdCA9IHJlc3BvbnNlSW5pdDsKICAgICAgICAgICAgfV9jcmVhdGVDbGFzczIoRGVmZXJyZWREYXRhLCBbeyBrZXk6ICJ0cmFja1Byb21pc2UiLCB2YWx1ZToKCiAgICAgICAgICAgICAgZnVuY3Rpb24gdHJhY2tQcm9taXNlKGtleSwgdmFsdWUpIHsKICAgICAgICAgICAgICAgIGlmICghKHZhbHVlIGluc3RhbmNlb2YgUHJvbWlzZSkpIHsKICAgICAgICAgICAgICAgICAgcmV0dXJuIHZhbHVlOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHRoaXMuZGVmZXJyZWRLZXlzLnB1c2goa2V5KTsKICAgICAgICAgICAgICAgIHRoaXMucGVuZGluZ0tleXNTZXQuYWRkKGtleSk7IC8vIFdlIHN0b3JlIGEgbGl0dGxlIHdyYXBwZXIgcHJvbWlzZSB0aGF0IHdpbGwgYmUgZXh0ZW5kZWQgd2l0aAogICAgICAgICAgICAgICAgLy8gX2RhdGEvX2Vycm9yIHByb3BzIHVwb24gcmVzb2x2ZS9yZWplY3QKCiAgICAgICAgICAgICAgICB2YXIgcHJvbWlzZSA9IFByb21pc2UucmFjZShbdmFsdWUsIHRoaXMuYWJvcnRQcm9taXNlXSkudGhlbigoZGF0YSkgPT4gdGhpcy5vblNldHRsZShwcm9taXNlLCBrZXksIG51bGwsIGRhdGEpLCAoZXJyb3IpID0+IHRoaXMub25TZXR0bGUocHJvbWlzZSwga2V5LCBlcnJvcikpOyAvLyBSZWdpc3RlciByZWplY3Rpb24gbGlzdGVuZXJzIHRvIGF2b2lkIHVuY2F1Z2h0IHByb21pc2UgcmVqZWN0aW9ucyBvbgogICAgICAgICAgICAgICAgLy8gZXJyb3JzIG9yIGFib3J0ZWQgZGVmZXJyZWQgdmFsdWVzCgogICAgICAgICAgICAgICAgcHJvbWlzZS5jYXRjaCgoKSA9PiB7fSk7CiAgICAgICAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkocHJvbWlzZSwgIl90cmFja2VkIiwgewogICAgICAgICAgICAgICAgICBnZXQ6ICgpID0+IHRydWUKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgcmV0dXJuIHByb21pc2U7CiAgICAgICAgICAgICAgfSB9LCB7IGtleTogIm9uU2V0dGxlIiwgdmFsdWU6CgogICAgICAgICAgICAgIGZ1bmN0aW9uIG9uU2V0dGxlKHByb21pc2UsIGtleSwgZXJyb3IsIGRhdGEpIHsKICAgICAgICAgICAgICAgIGlmICh0aGlzLmNvbnRyb2xsZXIuc2lnbmFsLmFib3J0ZWQgJiYgZXJyb3IgaW5zdGFuY2VvZiByb3V0ZXJfQWJvcnRlZERlZmVycmVkRXJyb3IpIHsKICAgICAgICAgICAgICAgICAgdGhpcy51bmxpc3RlbkFib3J0U2lnbmFsKCk7CiAgICAgICAgICAgICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShwcm9taXNlLCAiX2Vycm9yIiwgewogICAgICAgICAgICAgICAgICAgIGdldDogKCkgPT4gZXJyb3IKICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgIHJldHVybiBQcm9taXNlLnJlamVjdChlcnJvcik7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgdGhpcy5wZW5kaW5nS2V5c1NldC5kZWxldGUoa2V5KTsKCiAgICAgICAgICAgICAgICBpZiAodGhpcy5kb25lKSB7CiAgICAgICAgICAgICAgICAgIC8vIE5vdGhpbmcgbGVmdCB0byBhYm9ydCEKICAgICAgICAgICAgICAgICAgdGhpcy51bmxpc3RlbkFib3J0U2lnbmFsKCk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgaWYgKGVycm9yKSB7CiAgICAgICAgICAgICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShwcm9taXNlLCAiX2Vycm9yIiwgewogICAgICAgICAgICAgICAgICAgIGdldDogKCkgPT4gZXJyb3IKICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgIHRoaXMuZW1pdChmYWxzZSwga2V5KTsKICAgICAgICAgICAgICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KGVycm9yKTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkocHJvbWlzZSwgIl9kYXRhIiwgewogICAgICAgICAgICAgICAgICBnZXQ6ICgpID0+IGRhdGEKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgdGhpcy5lbWl0KGZhbHNlLCBrZXkpOwogICAgICAgICAgICAgICAgcmV0dXJuIGRhdGE7CiAgICAgICAgICAgICAgfSB9LCB7IGtleTogImVtaXQiLCB2YWx1ZToKCiAgICAgICAgICAgICAgZnVuY3Rpb24gZW1pdChhYm9ydGVkLCBzZXR0bGVkS2V5KSB7CiAgICAgICAgICAgICAgICB0aGlzLnN1YnNjcmliZXJzLmZvckVhY2goKHN1YnNjcmliZXIpID0+IHN1YnNjcmliZXIoYWJvcnRlZCwgc2V0dGxlZEtleSkpOwogICAgICAgICAgICAgIH0gfSwgeyBrZXk6ICJzdWJzY3JpYmUiLCB2YWx1ZToKCiAgICAgICAgICAgICAgZnVuY3Rpb24gc3Vic2NyaWJlKGZuKSB7CiAgICAgICAgICAgICAgICB0aGlzLnN1YnNjcmliZXJzLmFkZChmbik7CiAgICAgICAgICAgICAgICByZXR1cm4gKCkgPT4gdGhpcy5zdWJzY3JpYmVycy5kZWxldGUoZm4pOwogICAgICAgICAgICAgIH0gfSwgeyBrZXk6ICJjYW5jZWwiLCB2YWx1ZToKCiAgICAgICAgICAgICAgZnVuY3Rpb24gY2FuY2VsKCkgewogICAgICAgICAgICAgICAgdGhpcy5jb250cm9sbGVyLmFib3J0KCk7CiAgICAgICAgICAgICAgICB0aGlzLnBlbmRpbmdLZXlzU2V0LmZvckVhY2goKHYsIGspID0+IHRoaXMucGVuZGluZ0tleXNTZXQuZGVsZXRlKGspKTsKICAgICAgICAgICAgICAgIHRoaXMuZW1pdCh0cnVlKTsKICAgICAgICAgICAgICB9IH0sIHsga2V5OiAicmVzb2x2ZURhdGEiLCB2YWx1ZTogZnVuY3Rpb24gKCkge3ZhciBfcmVzb2x2ZURhdGEgPSBfYXN5bmNUb0dlbmVyYXRvcjIoIC8qI19fUFVSRV9fKi9fcmVnZW5lcmF0b3JSdW50aW1lMigpLm1hcmsoCgogICAgICAgICAgICAgICAgZnVuY3Rpb24gX2NhbGxlZTIoc2lnbmFsKSB7dmFyIGFib3J0ZWQsIG9uQWJvcnQ7cmV0dXJuIF9yZWdlbmVyYXRvclJ1bnRpbWUyKCkud3JhcChmdW5jdGlvbiBfY2FsbGVlMiQoX2NvbnRleHQyKSB7d2hpbGUgKDEpIHN3aXRjaCAoX2NvbnRleHQyLnByZXYgPSBfY29udGV4dDIubmV4dCkge2Nhc2UgMDoKICAgICAgICAgICAgICAgICAgICAgICAgYWJvcnRlZCA9IGZhbHNlO2lmICgKCiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZG9uZSkge19jb250ZXh0Mi5uZXh0ID0gNzticmVhazt9CiAgICAgICAgICAgICAgICAgICAgICAgIG9uQWJvcnQgPSAoKSA9PiB0aGlzLmNhbmNlbCgpOwoKICAgICAgICAgICAgICAgICAgICAgICAgc2lnbmFsLmFkZEV2ZW50TGlzdGVuZXIoImFib3J0Iiwgb25BYm9ydCk7X2NvbnRleHQyLm5leHQgPSA2O3JldHVybiAoCiAgICAgICAgICAgICAgICAgICAgICAgICAgbmV3IFByb21pc2UoKHJlc29sdmUpID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc3Vic2NyaWJlKChhYm9ydGVkKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNpZ25hbC5yZW1vdmVFdmVudExpc3RlbmVyKCJhYm9ydCIsIG9uQWJvcnQpOwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGFib3J0ZWQgfHwgdGhpcy5kb25lKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShhYm9ydGVkKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgfSkpO2Nhc2UgNjphYm9ydGVkID0gX2NvbnRleHQyLnNlbnQ7Y2FzZSA3OnJldHVybiBfY29udGV4dDIuYWJydXB0KCJyZXR1cm4iLAoKCiAgICAgICAgICAgICAgICAgICAgICAgIGFib3J0ZWQpO2Nhc2UgODpjYXNlICJlbmQiOnJldHVybiBfY29udGV4dDIuc3RvcCgpO319LCBfY2FsbGVlMiwgdGhpcyk7fSkpO2Z1bmN0aW9uIHJlc29sdmVEYXRhKF94Mykge3JldHVybiBfcmVzb2x2ZURhdGEuYXBwbHkodGhpcywgYXJndW1lbnRzKTt9cmV0dXJuIHJlc29sdmVEYXRhO30oKSB9LCB7IGtleTogImRvbmUiLCBnZXQ6CgoKICAgICAgICAgICAgICBmdW5jdGlvbiBnZXQoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5wZW5kaW5nS2V5c1NldC5zaXplID09PSAwOwogICAgICAgICAgICAgIH0gfSwgeyBrZXk6ICJ1bndyYXBwZWREYXRhIiwgZ2V0OgoKICAgICAgICAgICAgICBmdW5jdGlvbiBnZXQoKSB7CiAgICAgICAgICAgICAgICByb3V0ZXJfaW52YXJpYW50KHRoaXMuZGF0YSAhPT0gbnVsbCAmJiB0aGlzLmRvbmUsICJDYW4gb25seSB1bndyYXAgZGF0YSBvbiBpbml0aWFsaXplZCBhbmQgc2V0dGxlZCBkZWZlcnJlZHMiKTsKICAgICAgICAgICAgICAgIHJldHVybiBPYmplY3QuZW50cmllcyh0aGlzLmRhdGEpLnJlZHVjZSgoYWNjLCBfcmVmMikgPT4gewogICAgICAgICAgICAgICAgICB2YXIgX3JlZjExID0gX3NsaWNlZFRvQXJyYXkyKF9yZWYyLCAyKSxrZXkgPSBfcmVmMTFbMF0sdmFsdWUgPSBfcmVmMTFbMV07CiAgICAgICAgICAgICAgICAgIHJldHVybiBPYmplY3QuYXNzaWduKGFjYywgX2RlZmluZVByb3BlcnR5Mih7fSwKICAgICAgICAgICAgICAgICAga2V5LCB1bndyYXBUcmFja2VkUHJvbWlzZSh2YWx1ZSkpKTsKCiAgICAgICAgICAgICAgICB9LCB7fSk7CiAgICAgICAgICAgICAgfSB9LCB7IGtleTogInBlbmRpbmdLZXlzIiwgZ2V0OgoKICAgICAgICAgICAgICBmdW5jdGlvbiBnZXQoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gQXJyYXkuZnJvbSh0aGlzLnBlbmRpbmdLZXlzU2V0KTsKICAgICAgICAgICAgICB9IH1dKTtyZXR1cm4gRGVmZXJyZWREYXRhO30oKTsKCgoKICAgICAgICAgIGZ1bmN0aW9uIGlzVHJhY2tlZFByb21pc2UodmFsdWUpIHsKICAgICAgICAgICAgcmV0dXJuIHZhbHVlIGluc3RhbmNlb2YgUHJvbWlzZSAmJiB2YWx1ZS5fdHJhY2tlZCA9PT0gdHJ1ZTsKICAgICAgICAgIH0KCiAgICAgICAgICBmdW5jdGlvbiB1bndyYXBUcmFja2VkUHJvbWlzZSh2YWx1ZSkgewogICAgICAgICAgICBpZiAoIWlzVHJhY2tlZFByb21pc2UodmFsdWUpKSB7CiAgICAgICAgICAgICAgcmV0dXJuIHZhbHVlOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAodmFsdWUuX2Vycm9yKSB7CiAgICAgICAgICAgICAgdGhyb3cgdmFsdWUuX2Vycm9yOwogICAgICAgICAgICB9CgogICAgICAgICAgICByZXR1cm4gdmFsdWUuX2RhdGE7CiAgICAgICAgICB9CgogICAgICAgICAgdmFyIGRlZmVyID0gZnVuY3Rpb24gZGVmZXIoZGF0YSwgaW5pdCkgewogICAgICAgICAgICBpZiAoaW5pdCA9PT0gdm9pZCAwKSB7CiAgICAgICAgICAgICAgaW5pdCA9IHt9OwogICAgICAgICAgICB9CgogICAgICAgICAgICB2YXIgcmVzcG9uc2VJbml0ID0gdHlwZW9mIGluaXQgPT09ICJudW1iZXIiID8gewogICAgICAgICAgICAgIHN0YXR1czogaW5pdAogICAgICAgICAgICB9IDogaW5pdDsKICAgICAgICAgICAgcmV0dXJuIG5ldyBEZWZlcnJlZERhdGEoZGF0YSwgcmVzcG9uc2VJbml0KTsKICAgICAgICAgIH07CiAgICAgICAgICAvKioKICAgICAgICAgICAqIEEgcmVkaXJlY3QgcmVzcG9uc2UuIFNldHMgdGhlIHN0YXR1cyBjb2RlIGFuZCB0aGUgYExvY2F0aW9uYCBoZWFkZXIuCiAgICAgICAgICAgKiBEZWZhdWx0cyB0byAiMzAyIEZvdW5kIi4KICAgICAgICAgICAqLwoKICAgICAgICAgIHZhciByZWRpcmVjdCA9IGZ1bmN0aW9uIHJlZGlyZWN0KHVybCwgaW5pdCkgewogICAgICAgICAgICBpZiAoaW5pdCA9PT0gdm9pZCAwKSB7CiAgICAgICAgICAgICAgaW5pdCA9IDMwMjsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdmFyIHJlc3BvbnNlSW5pdCA9IGluaXQ7CgogICAgICAgICAgICBpZiAodHlwZW9mIHJlc3BvbnNlSW5pdCA9PT0gIm51bWJlciIpIHsKICAgICAgICAgICAgICByZXNwb25zZUluaXQgPSB7CiAgICAgICAgICAgICAgICBzdGF0dXM6IHJlc3BvbnNlSW5pdAogICAgICAgICAgICAgIH07CiAgICAgICAgICAgIH0gZWxzZSBpZiAodHlwZW9mIHJlc3BvbnNlSW5pdC5zdGF0dXMgPT09ICJ1bmRlZmluZWQiKSB7CiAgICAgICAgICAgICAgcmVzcG9uc2VJbml0LnN0YXR1cyA9IDMwMjsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdmFyIGhlYWRlcnMgPSBuZXcgSGVhZGVycyhyZXNwb25zZUluaXQuaGVhZGVycyk7CiAgICAgICAgICAgIGhlYWRlcnMuc2V0KCJMb2NhdGlvbiIsIHVybCk7CiAgICAgICAgICAgIHJldHVybiBuZXcgUmVzcG9uc2UobnVsbCwgX2V4dGVuZHMoe30sIHJlc3BvbnNlSW5pdCwgewogICAgICAgICAgICAgIGhlYWRlcnM6IGhlYWRlcnMKICAgICAgICAgICAgfSkpOwogICAgICAgICAgfTsKICAgICAgICAgIC8qKgogICAgICAgICAgICogQHByaXZhdGUKICAgICAgICAgICAqIFV0aWxpdHkgY2xhc3Mgd2UgdXNlIHRvIGhvbGQgYXV0by11bndyYXBwZWQgNHh4LzV4eCBSZXNwb25zZSBib2RpZXMKICAgICAgICAgICAqL3ZhcgoKICAgICAgICAgIHJvdXRlcl9FcnJvclJlc3BvbnNlID0gLyojX19QVVJFX18qL19jcmVhdGVDbGFzczIoCiAgICAgICAgICBmdW5jdGlvbiByb3V0ZXJfRXJyb3JSZXNwb25zZShzdGF0dXMsIHN0YXR1c1RleHQsIGRhdGEsIGludGVybmFsKSB7X2NsYXNzQ2FsbENoZWNrMih0aGlzLCByb3V0ZXJfRXJyb3JSZXNwb25zZSk7CiAgICAgICAgICAgIGlmIChpbnRlcm5hbCA9PT0gdm9pZCAwKSB7CiAgICAgICAgICAgICAgaW50ZXJuYWwgPSBmYWxzZTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdGhpcy5zdGF0dXMgPSBzdGF0dXM7CiAgICAgICAgICAgIHRoaXMuc3RhdHVzVGV4dCA9IHN0YXR1c1RleHQgfHwgIiI7CiAgICAgICAgICAgIHRoaXMuaW50ZXJuYWwgPSBpbnRlcm5hbDsKCiAgICAgICAgICAgIGlmIChkYXRhIGluc3RhbmNlb2YgRXJyb3IpIHsKICAgICAgICAgICAgICB0aGlzLmRhdGEgPSBkYXRhLnRvU3RyaW5nKCk7CiAgICAgICAgICAgICAgdGhpcy5lcnJvciA9IGRhdGE7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgdGhpcy5kYXRhID0gZGF0YTsKICAgICAgICAgICAgfQogICAgICAgICAgfSk7CgoKICAgICAgICAgIC8qKgogICAgICAgICAgICogQ2hlY2sgaWYgdGhlIGdpdmVuIGVycm9yIGlzIGFuIEVycm9yUmVzcG9uc2UgZ2VuZXJhdGVkIGZyb20gYSA0eHgvNXh4CiAgICAgICAgICAgKiBSZXNwb25zZSB0aHJvd24gZnJvbSBhbiBhY3Rpb24vbG9hZGVyCiAgICAgICAgICAgKi8KCiAgICAgICAgICBmdW5jdGlvbiBpc1JvdXRlRXJyb3JSZXNwb25zZShlcnJvcikgewogICAgICAgICAgICByZXR1cm4gZXJyb3IgIT0gbnVsbCAmJiB0eXBlb2YgZXJyb3Iuc3RhdHVzID09PSAibnVtYmVyIiAmJiB0eXBlb2YgZXJyb3Iuc3RhdHVzVGV4dCA9PT0gInN0cmluZyIgJiYgdHlwZW9mIGVycm9yLmludGVybmFsID09PSAiYm9vbGVhbiIgJiYgImRhdGEiIGluIGVycm9yOwogICAgICAgICAgfQoKICAgICAgICAgIHZhciB2YWxpZE11dGF0aW9uTWV0aG9kc0FyciA9IFsicG9zdCIsICJwdXQiLCAicGF0Y2giLCAiZGVsZXRlIl07CiAgICAgICAgICB2YXIgdmFsaWRNdXRhdGlvbk1ldGhvZHMgPSBuZXcgU2V0KHZhbGlkTXV0YXRpb25NZXRob2RzQXJyKTsKICAgICAgICAgIHZhciB2YWxpZFJlcXVlc3RNZXRob2RzQXJyID0gWyJnZXQiXS5jb25jYXQodmFsaWRNdXRhdGlvbk1ldGhvZHNBcnIpOwogICAgICAgICAgdmFyIHZhbGlkUmVxdWVzdE1ldGhvZHMgPSBuZXcgU2V0KHZhbGlkUmVxdWVzdE1ldGhvZHNBcnIpOwogICAgICAgICAgdmFyIHJlZGlyZWN0U3RhdHVzQ29kZXMgPSBuZXcgU2V0KFszMDEsIDMwMiwgMzAzLCAzMDcsIDMwOF0pOwogICAgICAgICAgdmFyIHJlZGlyZWN0UHJlc2VydmVNZXRob2RTdGF0dXNDb2RlcyA9IG5ldyBTZXQoWzMwNywgMzA4XSk7CiAgICAgICAgICB2YXIgSURMRV9OQVZJR0FUSU9OID0gewogICAgICAgICAgICBzdGF0ZTogImlkbGUiLAogICAgICAgICAgICBsb2NhdGlvbjogdW5kZWZpbmVkLAogICAgICAgICAgICBmb3JtTWV0aG9kOiB1bmRlZmluZWQsCiAgICAgICAgICAgIGZvcm1BY3Rpb246IHVuZGVmaW5lZCwKICAgICAgICAgICAgZm9ybUVuY1R5cGU6IHVuZGVmaW5lZCwKICAgICAgICAgICAgZm9ybURhdGE6IHVuZGVmaW5lZAogICAgICAgICAgfTsKICAgICAgICAgIHZhciBJRExFX0ZFVENIRVIgPSB7CiAgICAgICAgICAgIHN0YXRlOiAiaWRsZSIsCiAgICAgICAgICAgIGRhdGE6IHVuZGVmaW5lZCwKICAgICAgICAgICAgZm9ybU1ldGhvZDogdW5kZWZpbmVkLAogICAgICAgICAgICBmb3JtQWN0aW9uOiB1bmRlZmluZWQsCiAgICAgICAgICAgIGZvcm1FbmNUeXBlOiB1bmRlZmluZWQsCiAgICAgICAgICAgIGZvcm1EYXRhOiB1bmRlZmluZWQKICAgICAgICAgIH07CiAgICAgICAgICB2YXIgSURMRV9CTE9DS0VSID0gewogICAgICAgICAgICBzdGF0ZTogInVuYmxvY2tlZCIsCiAgICAgICAgICAgIHByb2NlZWQ6IHVuZGVmaW5lZCwKICAgICAgICAgICAgcmVzZXQ6IHVuZGVmaW5lZCwKICAgICAgICAgICAgbG9jYXRpb246IHVuZGVmaW5lZAogICAgICAgICAgfTsKICAgICAgICAgIHZhciBpc0Jyb3dzZXIgPSB0eXBlb2Ygd2luZG93ICE9PSAidW5kZWZpbmVkIiAmJiB0eXBlb2Ygd2luZG93LmRvY3VtZW50ICE9PSAidW5kZWZpbmVkIiAmJiB0eXBlb2Ygd2luZG93LmRvY3VtZW50LmNyZWF0ZUVsZW1lbnQgIT09ICJ1bmRlZmluZWQiOwogICAgICAgICAgdmFyIGlzU2VydmVyID0gIWlzQnJvd3NlcjsgLy8jZW5kcmVnaW9uCiAgICAgICAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwogICAgICAgICAgLy8jcmVnaW9uIGNyZWF0ZVJvdXRlcgogICAgICAgICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KCiAgICAgICAgICAvKioKICAgICAgICAgICAqIENyZWF0ZSBhIHJvdXRlciBhbmQgbGlzdGVuIHRvIGhpc3RvcnkgUE9QIG5hdmlnYXRpb25zCiAgICAgICAgICAgKi8KCiAgICAgICAgICBmdW5jdGlvbiByb3V0ZXJfY3JlYXRlUm91dGVyKGluaXQpIHsKICAgICAgICAgICAgcm91dGVyX2ludmFyaWFudChpbml0LnJvdXRlcy5sZW5ndGggPiAwLCAiWW91IG11c3QgcHJvdmlkZSBhIG5vbi1lbXB0eSByb3V0ZXMgYXJyYXkgdG8gY3JlYXRlUm91dGVyIik7CiAgICAgICAgICAgIHZhciBkYXRhUm91dGVzID0gY29udmVydFJvdXRlc1RvRGF0YVJvdXRlcyhpbml0LnJvdXRlcyk7IC8vIENsZWFudXAgZnVuY3Rpb24gZm9yIGhpc3RvcnkKCiAgICAgICAgICAgIHZhciB1bmxpc3Rlbkhpc3RvcnkgPSBudWxsOyAvLyBFeHRlcm5hbGx5LXByb3ZpZGVkIGZ1bmN0aW9ucyB0byBjYWxsIG9uIGFsbCBzdGF0ZSBjaGFuZ2VzCgogICAgICAgICAgICB2YXIgc3Vic2NyaWJlcnMgPSBuZXcgU2V0KCk7IC8vIEV4dGVybmFsbHktcHJvdmlkZWQgb2JqZWN0IHRvIGhvbGQgc2Nyb2xsIHJlc3RvcmF0aW9uIGxvY2F0aW9ucyBkdXJpbmcgcm91dGluZwoKICAgICAgICAgICAgdmFyIHNhdmVkU2Nyb2xsUG9zaXRpb25zID0gbnVsbDsgLy8gRXh0ZXJuYWxseS1wcm92aWRlZCBmdW5jdGlvbiB0byBnZXQgc2Nyb2xsIHJlc3RvcmF0aW9uIGtleXMKCiAgICAgICAgICAgIHZhciBnZXRTY3JvbGxSZXN0b3JhdGlvbktleSA9IG51bGw7IC8vIEV4dGVybmFsbHktcHJvdmlkZWQgZnVuY3Rpb24gdG8gZ2V0IGN1cnJlbnQgc2Nyb2xsIHBvc2l0aW9uCgogICAgICAgICAgICB2YXIgZ2V0U2Nyb2xsUG9zaXRpb24gPSBudWxsOyAvLyBPbmUtdGltZSBmbGFnIHRvIGNvbnRyb2wgdGhlIGluaXRpYWwgaHlkcmF0aW9uIHNjcm9sbCByZXN0b3JhdGlvbi4gIEJlY2F1c2UKICAgICAgICAgICAgLy8gd2UgZG9uJ3QgZ2V0IHRoZSBzYXZlZCBwb3NpdGlvbnMgZnJvbSA8U2Nyb2xsUmVzdG9yYXRpb24gLz4gdW50aWwgX2FmdGVyXwogICAgICAgICAgICAvLyB0aGUgaW5pdGlhbCByZW5kZXIsIHdlIG5lZWQgdG8gbWFudWFsbHkgdHJpZ2dlciBhIHNlcGFyYXRlIHVwZGF0ZVN0YXRlIHRvCiAgICAgICAgICAgIC8vIHNlbmQgYWxvbmcgdGhlIHJlc3RvcmVTY3JvbGxQb3NpdGlvbgogICAgICAgICAgICAvLyBTZXQgdG8gdHJ1ZSBpZiB3ZSBoYXZlIGBoeWRyYXRpb25EYXRhYCBzaW5jZSB3ZSBhc3N1bWUgd2Ugd2VyZSBTU1InZCBhbmQgdGhhdAogICAgICAgICAgICAvLyBTU1IgZGlkIHRoZSBpbml0aWFsIHNjcm9sbCByZXN0b3JhdGlvbi4KCiAgICAgICAgICAgIHZhciBpbml0aWFsU2Nyb2xsUmVzdG9yZWQgPSBpbml0Lmh5ZHJhdGlvbkRhdGEgIT0gbnVsbDsKICAgICAgICAgICAgdmFyIGluaXRpYWxNYXRjaGVzID0gbWF0Y2hSb3V0ZXMoZGF0YVJvdXRlcywgaW5pdC5oaXN0b3J5LmxvY2F0aW9uLCBpbml0LmJhc2VuYW1lKTsKICAgICAgICAgICAgdmFyIGluaXRpYWxFcnJvcnMgPSBudWxsOwoKICAgICAgICAgICAgaWYgKGluaXRpYWxNYXRjaGVzID09IG51bGwpIHsKICAgICAgICAgICAgICAvLyBJZiB3ZSBkbyBub3QgbWF0Y2ggYSB1c2VyLXByb3ZpZGVkLXJvdXRlLCBmYWxsIGJhY2sgdG8gdGhlIHJvb3QKICAgICAgICAgICAgICAvLyB0byBhbGxvdyB0aGUgZXJyb3IgYm91bmRhcnkgdG8gdGFrZSBvdmVyCiAgICAgICAgICAgICAgdmFyIGVycm9yID0gZ2V0SW50ZXJuYWxSb3V0ZXJFcnJvcig0MDQsIHsKICAgICAgICAgICAgICAgIHBhdGhuYW1lOiBpbml0Lmhpc3RvcnkubG9jYXRpb24ucGF0aG5hbWUKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICB2YXIgX2dldFNob3J0Q2lyY3VpdE1hdGNoID0KCgogICAgICAgICAgICAgICAgZ2V0U2hvcnRDaXJjdWl0TWF0Y2hlcyhkYXRhUm91dGVzKSxtYXRjaGVzID0gX2dldFNob3J0Q2lyY3VpdE1hdGNoLm1hdGNoZXMscm91dGUgPSBfZ2V0U2hvcnRDaXJjdWl0TWF0Y2gucm91dGU7CiAgICAgICAgICAgICAgaW5pdGlhbE1hdGNoZXMgPSBtYXRjaGVzOwogICAgICAgICAgICAgIGluaXRpYWxFcnJvcnMgPSBfZGVmaW5lUHJvcGVydHkyKHt9LAogICAgICAgICAgICAgIHJvdXRlLmlkLCBlcnJvcik7CgogICAgICAgICAgICB9CgogICAgICAgICAgICB2YXIgaW5pdGlhbGl6ZWQgPSAhaW5pdGlhbE1hdGNoZXMuc29tZSgobSkgPT4gbS5yb3V0ZS5sb2FkZXIpIHx8IGluaXQuaHlkcmF0aW9uRGF0YSAhPSBudWxsOwogICAgICAgICAgICB2YXIgcm91dGVyOwogICAgICAgICAgICB2YXIgc3RhdGUgPSB7CiAgICAgICAgICAgICAgaGlzdG9yeUFjdGlvbjogaW5pdC5oaXN0b3J5LmFjdGlvbiwKICAgICAgICAgICAgICBsb2NhdGlvbjogaW5pdC5oaXN0b3J5LmxvY2F0aW9uLAogICAgICAgICAgICAgIG1hdGNoZXM6IGluaXRpYWxNYXRjaGVzLAogICAgICAgICAgICAgIGluaXRpYWxpemVkOiBpbml0aWFsaXplZCwKICAgICAgICAgICAgICBuYXZpZ2F0aW9uOiBJRExFX05BVklHQVRJT04sCiAgICAgICAgICAgICAgLy8gRG9uJ3QgcmVzdG9yZSBvbiBpbml0aWFsIHVwZGF0ZVN0YXRlKCkgaWYgd2Ugd2VyZSBTU1InZAogICAgICAgICAgICAgIHJlc3RvcmVTY3JvbGxQb3NpdGlvbjogaW5pdC5oeWRyYXRpb25EYXRhICE9IG51bGwgPyBmYWxzZSA6IG51bGwsCiAgICAgICAgICAgICAgcHJldmVudFNjcm9sbFJlc2V0OiBmYWxzZSwKICAgICAgICAgICAgICByZXZhbGlkYXRpb246ICJpZGxlIiwKICAgICAgICAgICAgICBsb2FkZXJEYXRhOiBpbml0Lmh5ZHJhdGlvbkRhdGEgJiYgaW5pdC5oeWRyYXRpb25EYXRhLmxvYWRlckRhdGEgfHwge30sCiAgICAgICAgICAgICAgYWN0aW9uRGF0YTogaW5pdC5oeWRyYXRpb25EYXRhICYmIGluaXQuaHlkcmF0aW9uRGF0YS5hY3Rpb25EYXRhIHx8IG51bGwsCiAgICAgICAgICAgICAgZXJyb3JzOiBpbml0Lmh5ZHJhdGlvbkRhdGEgJiYgaW5pdC5oeWRyYXRpb25EYXRhLmVycm9ycyB8fCBpbml0aWFsRXJyb3JzLAogICAgICAgICAgICAgIGZldGNoZXJzOiBuZXcgTWFwKCksCiAgICAgICAgICAgICAgYmxvY2tlcnM6IG5ldyBNYXAoKQogICAgICAgICAgICB9OyAvLyAtLSBTdGF0ZWZ1bCBpbnRlcm5hbCB2YXJpYWJsZXMgdG8gbWFuYWdlIG5hdmlnYXRpb25zIC0tCiAgICAgICAgICAgIC8vIEN1cnJlbnQgbmF2aWdhdGlvbiBpbiBwcm9ncmVzcyAodG8gYmUgY29tbWl0dGVkIGluIGNvbXBsZXRlTmF2aWdhdGlvbikKCiAgICAgICAgICAgIHZhciBwZW5kaW5nQWN0aW9uID0gQWN0aW9uLlBvcDsgLy8gU2hvdWxkIHRoZSBjdXJyZW50IG5hdmlnYXRpb24gcHJldmVudCB0aGUgc2Nyb2xsIHJlc2V0IGlmIHNjcm9sbCBjYW5ub3QKICAgICAgICAgICAgLy8gYmUgcmVzdG9yZWQ/CgogICAgICAgICAgICB2YXIgcGVuZGluZ1ByZXZlbnRTY3JvbGxSZXNldCA9IGZhbHNlOyAvLyBBYm9ydENvbnRyb2xsZXIgZm9yIHRoZSBhY3RpdmUgbmF2aWdhdGlvbgoKICAgICAgICAgICAgdmFyIHBlbmRpbmdOYXZpZ2F0aW9uQ29udHJvbGxlcjsgLy8gV2UgdXNlIHRoaXMgdG8gYXZvaWQgdG91Y2hpbmcgaGlzdG9yeSBpbiBjb21wbGV0ZU5hdmlnYXRpb24gaWYgYQogICAgICAgICAgICAvLyByZXZhbGlkYXRpb24gaXMgZW50aXJlbHkgdW5pbnRlcnJ1cHRlZAoKICAgICAgICAgICAgdmFyIGlzVW5pbnRlcnJ1cHRlZFJldmFsaWRhdGlvbiA9IGZhbHNlOyAvLyBVc2UgdGhpcyBpbnRlcm5hbCBmbGFnIHRvIGZvcmNlIHJldmFsaWRhdGlvbiBvZiBhbGwgbG9hZGVyczoKICAgICAgICAgICAgLy8gIC0gc3VibWlzc2lvbnMgKGNvbXBsZXRlZCBvciBpbnRlcnJ1cHRlZCkKICAgICAgICAgICAgLy8gIC0gdXNlUmV2YWxpZGF0ZSgpCiAgICAgICAgICAgIC8vICAtIFgtUmVtaXgtUmV2YWxpZGF0ZSAoZnJvbSByZWRpcmVjdCkKCiAgICAgICAgICAgIHZhciBpc1JldmFsaWRhdGlvblJlcXVpcmVkID0gZmFsc2U7IC8vIFVzZSB0aGlzIGludGVybmFsIGFycmF5IHRvIGNhcHR1cmUgcm91dGVzIHRoYXQgcmVxdWlyZSByZXZhbGlkYXRpb24gZHVlCiAgICAgICAgICAgIC8vIHRvIGEgY2FuY2VsbGVkIGRlZmVycmVkIG9uIGFjdGlvbiBzdWJtaXNzaW9uCgogICAgICAgICAgICB2YXIgY2FuY2VsbGVkRGVmZXJyZWRSb3V0ZXMgPSBbXTsgLy8gVXNlIHRoaXMgaW50ZXJuYWwgYXJyYXkgdG8gY2FwdHVyZSBmZXRjaGVyIGxvYWRzIHRoYXQgd2VyZSBjYW5jZWxsZWQgYnkgYW4KICAgICAgICAgICAgLy8gYWN0aW9uIG5hdmlnYXRpb24gYW5kIHJlcXVpcmUgcmV2YWxpZGF0aW9uCgogICAgICAgICAgICB2YXIgY2FuY2VsbGVkRmV0Y2hlckxvYWRzID0gW107IC8vIEFib3J0Q29udHJvbGxlcnMgZm9yIGFueSBpbi1mbGlnaHQgZmV0Y2hlcnMKCiAgICAgICAgICAgIHZhciBmZXRjaENvbnRyb2xsZXJzID0gbmV3IE1hcCgpOyAvLyBUcmFjayBsb2FkcyBiYXNlZCBvbiB0aGUgb3JkZXIgaW4gd2hpY2ggdGhleSBzdGFydGVkCgogICAgICAgICAgICB2YXIgaW5jcmVtZW50aW5nTG9hZElkID0gMDsgLy8gVHJhY2sgdGhlIG91dHN0YW5kaW5nIHBlbmRpbmcgbmF2aWdhdGlvbiBkYXRhIGxvYWQgdG8gYmUgY29tcGFyZWQgYWdhaW5zdAogICAgICAgICAgICAvLyB0aGUgZ2xvYmFsbHkgaW5jcmVtZW50aW5nIGxvYWQgd2hlbiBhIGZldGNoZXIgbG9hZCBsYW5kcyBhZnRlciBhIGNvbXBsZXRlZAogICAgICAgICAgICAvLyBuYXZpZ2F0aW9uCgogICAgICAgICAgICB2YXIgcGVuZGluZ05hdmlnYXRpb25Mb2FkSWQgPSAtMTsgLy8gRmV0Y2hlcnMgdGhhdCB0cmlnZ2VyZWQgZGF0YSByZWxvYWRzIGFzIGEgcmVzdWx0IG9mIHRoZWlyIGFjdGlvbnMKCiAgICAgICAgICAgIHZhciBmZXRjaFJlbG9hZElkcyA9IG5ldyBNYXAoKTsgLy8gRmV0Y2hlcnMgdGhhdCB0cmlnZ2VyZWQgcmVkaXJlY3QgbmF2aWdhdGlvbnMgZnJvbSB0aGVpciBhY3Rpb25zCgogICAgICAgICAgICB2YXIgZmV0Y2hSZWRpcmVjdElkcyA9IG5ldyBTZXQoKTsgLy8gTW9zdCByZWNlbnQgaHJlZi9tYXRjaCBmb3IgZmV0Y2hlci5sb2FkIGNhbGxzIGZvciBmZXRjaGVycwoKICAgICAgICAgICAgdmFyIGZldGNoTG9hZE1hdGNoZXMgPSBuZXcgTWFwKCk7IC8vIFN0b3JlIERlZmVycmVkRGF0YSBpbnN0YW5jZXMgZm9yIGFjdGl2ZSByb3V0ZSBtYXRjaGVzLiAgV2hlbiBhCiAgICAgICAgICAgIC8vIHJvdXRlIGxvYWRlciByZXR1cm5zIGRlZmVyKCkgd2Ugc3RpY2sgb25lIGluIGhlcmUuICBUaGVuLCB3aGVuIGEgbmVzdGVkCiAgICAgICAgICAgIC8vIHByb21pc2UgcmVzb2x2ZXMgd2UgdXBkYXRlIGxvYWRlckRhdGEuICBJZiBhIG5ldyBuYXZpZ2F0aW9uIHN0YXJ0cyB3ZQogICAgICAgICAgICAvLyBjYW5jZWwgYWN0aXZlIGRlZmVycmVkcyBmb3IgZWxpbWluYXRlZCByb3V0ZXMuCgogICAgICAgICAgICB2YXIgYWN0aXZlRGVmZXJyZWRzID0gbmV3IE1hcCgpOyAvLyBXZSBvbnkgc3VwcG9ydCBhIHNpbmdsZSBhY3RpdmUgYmxvY2tlciBhdCB0aGUgbW9tZW50IHNpbmNlIHdlIGRvbid0IGhhdmUKICAgICAgICAgICAgLy8gYW55IGNvbXBlbGxpbmcgdXNlIGNhc2VzIGZvciBtdWx0aS1ibG9ja2VyIHlldAoKICAgICAgICAgICAgdmFyIGFjdGl2ZUJsb2NrZXIgPSBudWxsOyAvLyBTdG9yZSBibG9ja2VyIGZ1bmN0aW9ucyBpbiBhIHNlcGFyYXRlIE1hcCBvdXRzaWRlIG9mIHJvdXRlciBzdGF0ZSBzaW5jZQogICAgICAgICAgICAvLyB3ZSBkb24ndCBuZWVkIHRvIHVwZGF0ZSBVSSBzdGF0ZSBpZiB0aGV5IGNoYW5nZQoKICAgICAgICAgICAgdmFyIGJsb2NrZXJGdW5jdGlvbnMgPSBuZXcgTWFwKCk7IC8vIEZsYWcgdG8gaWdub3JlIHRoZSBuZXh0IGhpc3RvcnkgdXBkYXRlLCBzbyB3ZSBjYW4gcmV2ZXJ0IHRoZSBVUkwgY2hhbmdlIG9uCiAgICAgICAgICAgIC8vIGEgUE9QIG5hdmlnYXRpb24gdGhhdCB3YXMgYmxvY2tlZCBieSB0aGUgdXNlciB3aXRob3V0IHRvdWNoaW5nIHJvdXRlciBzdGF0ZQoKICAgICAgICAgICAgdmFyIGlnbm9yZU5leHRIaXN0b3J5VXBkYXRlID0gZmFsc2U7IC8vIEluaXRpYWxpemUgdGhlIHJvdXRlciwgYWxsIHNpZGUgZWZmZWN0cyBzaG91bGQgYmUga2lja2VkIG9mZiBmcm9tIGhlcmUuCiAgICAgICAgICAgIC8vIEltcGxlbWVudGVkIGFzIGEgRmx1ZW50IEFQSSBmb3IgZWFzZSBvZjoKICAgICAgICAgICAgLy8gICBsZXQgcm91dGVyID0gY3JlYXRlUm91dGVyKGluaXQpLmluaXRpYWxpemUoKTsKCiAgICAgICAgICAgIGZ1bmN0aW9uIGluaXRpYWxpemUoKSB7CiAgICAgICAgICAgICAgLy8gSWYgaGlzdG9yeSBpbmZvcm1zIHVzIG9mIGEgUE9QIG5hdmlnYXRpb24sIHN0YXJ0IHRoZSBuYXZpZ2F0aW9uIGJ1dCBkbyBub3QgdXBkYXRlCiAgICAgICAgICAgICAgLy8gc3RhdGUuICBXZSdsbCB1cGRhdGUgb3VyIG93biBzdGF0ZSBvbmNlIHRoZSBuYXZpZ2F0aW9uIGNvbXBsZXRlcwogICAgICAgICAgICAgIHVubGlzdGVuSGlzdG9yeSA9IGluaXQuaGlzdG9yeS5saXN0ZW4oKF9yZWYpID0+IHsKICAgICAgICAgICAgICAgIHZhcgogICAgICAgICAgICAgICAgICBoaXN0b3J5QWN0aW9uID0KCgogICAgICAgICAgICAgICAgICBfcmVmLmFjdGlvbixsb2NhdGlvbiA9IF9yZWYubG9jYXRpb24sZGVsdGEgPSBfcmVmLmRlbHRhOwoKICAgICAgICAgICAgICAgIC8vIElnbm9yZSB0aGlzIGV2ZW50IGlmIGl0IHdhcyBqdXN0IHVzIHJlc2V0dGluZyB0aGUgVVJMIGZyb20gYQogICAgICAgICAgICAgICAgLy8gYmxvY2tlZCBQT1AgbmF2aWdhdGlvbgogICAgICAgICAgICAgICAgaWYgKGlnbm9yZU5leHRIaXN0b3J5VXBkYXRlKSB7CiAgICAgICAgICAgICAgICAgIGlnbm9yZU5leHRIaXN0b3J5VXBkYXRlID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICB3YXJuaW5nKGFjdGl2ZUJsb2NrZXIgIT0gbnVsbCAmJiBkZWx0YSA9PT0gbnVsbCwgIllvdSBhcmUgdHJ5aW5nIHRvIHVzZSBhIGJsb2NrZXIgb24gYSBQT1AgbmF2aWdhdGlvbiB0byBhIGxvY2F0aW9uICIgKyAidGhhdCB3YXMgbm90IGNyZWF0ZWQgYnkgQHJlbWl4LXJ1bi9yb3V0ZXIuIFRoaXMgd2lsbCBmYWlsIHNpbGVudGx5IGluICIgKyAicHJvZHVjdGlvbi4gVGhpcyBjYW4gaGFwcGVuIGlmIHlvdSBhcmUgbmF2aWdhdGluZyBvdXRzaWRlIHRoZSByb3V0ZXIgIiArICJ2aWEgYHdpbmRvdy5oaXN0b3J5LnB1c2hTdGF0ZWAvYHdpbmRvdy5sb2NhdGlvbi5oYXNoYCBpbnN0ZWFkIG9mIHVzaW5nICIgKyAicm91dGVyIG5hdmlnYXRpb24gQVBJcy4gIFRoaXMgY2FuIGFsc28gaGFwcGVuIGlmIHlvdSBhcmUgdXNpbmcgIiArICJjcmVhdGVIYXNoUm91dGVyIGFuZCB0aGUgdXNlciBtYW51YWxseSBjaGFuZ2VzIHRoZSBVUkwuIik7CiAgICAgICAgICAgICAgICB2YXIgYmxvY2tlcktleSA9IHNob3VsZEJsb2NrTmF2aWdhdGlvbih7CiAgICAgICAgICAgICAgICAgIGN1cnJlbnRMb2NhdGlvbjogc3RhdGUubG9jYXRpb24sCiAgICAgICAgICAgICAgICAgIG5leHRMb2NhdGlvbjogbG9jYXRpb24sCiAgICAgICAgICAgICAgICAgIGhpc3RvcnlBY3Rpb246IGhpc3RvcnlBY3Rpb24KICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICAgIGlmIChibG9ja2VyS2V5ICYmIGRlbHRhICE9IG51bGwpIHsKICAgICAgICAgICAgICAgICAgLy8gUmVzdG9yZSB0aGUgVVJMIHRvIG1hdGNoIHRoZSBjdXJyZW50IFVJLCBidXQgZG9uJ3QgdXBkYXRlIHJvdXRlciBzdGF0ZQogICAgICAgICAgICAgICAgICBpZ25vcmVOZXh0SGlzdG9yeVVwZGF0ZSA9IHRydWU7CiAgICAgICAgICAgICAgICAgIGluaXQuaGlzdG9yeS5nbyhkZWx0YSAqIC0xKTsgLy8gUHV0IHRoZSBibG9ja2VyIGludG8gYSBibG9ja2VkIHN0YXRlCgogICAgICAgICAgICAgICAgICB1cGRhdGVCbG9ja2VyKGJsb2NrZXJLZXksIHsKICAgICAgICAgICAgICAgICAgICBzdGF0ZTogImJsb2NrZWQiLAogICAgICAgICAgICAgICAgICAgIGxvY2F0aW9uOiBsb2NhdGlvbiwKCiAgICAgICAgICAgICAgICAgICAgcHJvY2VlZDogZnVuY3Rpb24gcHJvY2VlZCgpIHsKICAgICAgICAgICAgICAgICAgICAgIHVwZGF0ZUJsb2NrZXIoYmxvY2tlcktleSwgewogICAgICAgICAgICAgICAgICAgICAgICBzdGF0ZTogInByb2NlZWRpbmciLAogICAgICAgICAgICAgICAgICAgICAgICBwcm9jZWVkOiB1bmRlZmluZWQsCiAgICAgICAgICAgICAgICAgICAgICAgIHJlc2V0OiB1bmRlZmluZWQsCiAgICAgICAgICAgICAgICAgICAgICAgIGxvY2F0aW9uOiBsb2NhdGlvbgogICAgICAgICAgICAgICAgICAgICAgfSk7IC8vIFJlLWRvIHRoZSBzYW1lIFBPUCBuYXZpZ2F0aW9uIHdlIGp1c3QgYmxvY2tlZAoKICAgICAgICAgICAgICAgICAgICAgIGluaXQuaGlzdG9yeS5nbyhkZWx0YSk7CiAgICAgICAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgICAgICAgcmVzZXQ6IGZ1bmN0aW9uIHJlc2V0KCkgewogICAgICAgICAgICAgICAgICAgICAgZGVsZXRlQmxvY2tlcihibG9ja2VyS2V5KTsKICAgICAgICAgICAgICAgICAgICAgIHVwZGF0ZVN0YXRlKHsKICAgICAgICAgICAgICAgICAgICAgICAgYmxvY2tlcnM6IG5ldyBNYXAocm91dGVyLnN0YXRlLmJsb2NrZXJzKQogICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICByZXR1cm4gc3RhcnROYXZpZ2F0aW9uKGhpc3RvcnlBY3Rpb24sIGxvY2F0aW9uKTsKICAgICAgICAgICAgICB9KTsgLy8gS2ljayBvZmYgaW5pdGlhbCBkYXRhIGxvYWQgaWYgbmVlZGVkLiAgVXNlIFBvcCB0byBhdm9pZCBtb2RpZnlpbmcgaGlzdG9yeQoKICAgICAgICAgICAgICBpZiAoIXN0YXRlLmluaXRpYWxpemVkKSB7CiAgICAgICAgICAgICAgICBzdGFydE5hdmlnYXRpb24oQWN0aW9uLlBvcCwgc3RhdGUubG9jYXRpb24pOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgcmV0dXJuIHJvdXRlcjsKICAgICAgICAgICAgfSAvLyBDbGVhbiB1cCBhIHJvdXRlciBhbmQgaXQncyBzaWRlIGVmZmVjdHMKCgogICAgICAgICAgICBmdW5jdGlvbiBkaXNwb3NlKCkgewogICAgICAgICAgICAgIGlmICh1bmxpc3Rlbkhpc3RvcnkpIHsKICAgICAgICAgICAgICAgIHVubGlzdGVuSGlzdG9yeSgpOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgc3Vic2NyaWJlcnMuY2xlYXIoKTsKICAgICAgICAgICAgICBwZW5kaW5nTmF2aWdhdGlvbkNvbnRyb2xsZXIgJiYgcGVuZGluZ05hdmlnYXRpb25Db250cm9sbGVyLmFib3J0KCk7CiAgICAgICAgICAgICAgc3RhdGUuZmV0Y2hlcnMuZm9yRWFjaCgoXywga2V5KSA9PiBkZWxldGVGZXRjaGVyKGtleSkpOwogICAgICAgICAgICAgIHN0YXRlLmJsb2NrZXJzLmZvckVhY2goKF8sIGtleSkgPT4gZGVsZXRlQmxvY2tlcihrZXkpKTsKICAgICAgICAgICAgfSAvLyBTdWJzY3JpYmUgdG8gc3RhdGUgdXBkYXRlcyBmb3IgdGhlIHJvdXRlcgoKCiAgICAgICAgICAgIGZ1bmN0aW9uIHN1YnNjcmliZShmbikgewogICAgICAgICAgICAgIHN1YnNjcmliZXJzLmFkZChmbik7CiAgICAgICAgICAgICAgcmV0dXJuICgpID0+IHN1YnNjcmliZXJzLmRlbGV0ZShmbik7CiAgICAgICAgICAgIH0gLy8gVXBkYXRlIG91ciBzdGF0ZSBhbmQgbm90aWZ5IHRoZSBjYWxsaW5nIGNvbnRleHQgb2YgdGhlIGNoYW5nZQoKCiAgICAgICAgICAgIGZ1bmN0aW9uIHVwZGF0ZVN0YXRlKG5ld1N0YXRlKSB7CiAgICAgICAgICAgICAgc3RhdGUgPSBfZXh0ZW5kcyh7fSwgc3RhdGUsIG5ld1N0YXRlKTsKICAgICAgICAgICAgICBzdWJzY3JpYmVycy5mb3JFYWNoKChzdWJzY3JpYmVyKSA9PiBzdWJzY3JpYmVyKHN0YXRlKSk7CiAgICAgICAgICAgIH0gLy8gQ29tcGxldGUgYSBuYXZpZ2F0aW9uIHJldHVybmluZyB0aGUgc3RhdGUubmF2aWdhdGlvbiBiYWNrIHRvIHRoZSBJRExFX05BVklHQVRJT04KICAgICAgICAgICAgLy8gYW5kIHNldHRpbmcgc3RhdGUuW2hpc3RvcnlBY3Rpb24vbG9jYXRpb24vbWF0Y2hlc10gdG8gdGhlIG5ldyByb3V0ZS4KICAgICAgICAgICAgLy8gLSBMb2NhdGlvbiBpcyBhIHJlcXVpcmVkIHBhcmFtCiAgICAgICAgICAgIC8vIC0gTmF2aWdhdGlvbiB3aWxsIGFsd2F5cyBiZSBzZXQgdG8gSURMRV9OQVZJR0FUSU9OCiAgICAgICAgICAgIC8vIC0gQ2FuIHBhc3MgYW55IG90aGVyIHN0YXRlIGluIG5ld1N0YXRlCgoKICAgICAgICAgICAgZnVuY3Rpb24gY29tcGxldGVOYXZpZ2F0aW9uKGxvY2F0aW9uLCBuZXdTdGF0ZSkgewogICAgICAgICAgICAgIHZhciBfbG9jYXRpb24kc3RhdGUsIF9sb2NhdGlvbiRzdGF0ZTI7CgogICAgICAgICAgICAgIC8vIERlZHVjZSBpZiB3ZSdyZSBpbiBhIGxvYWRpbmcvYWN0aW9uUmVsb2FkIHN0YXRlOgogICAgICAgICAgICAgIC8vIC0gV2UgaGF2ZSBjb21taXR0ZWQgYWN0aW9uRGF0YSBpbiB0aGUgc3RvcmUKICAgICAgICAgICAgICAvLyAtIFRoZSBjdXJyZW50IG5hdmlnYXRpb24gd2FzIGEgbXV0YXRpb24gc3VibWlzc2lvbgogICAgICAgICAgICAgIC8vIC0gV2UncmUgcGFzdCB0aGUgc3VibWl0dGluZyBzdGF0ZSBhbmQgaW50byB0aGUgbG9hZGluZyBzdGF0ZQogICAgICAgICAgICAgIC8vIC0gVGhlIGxvY2F0aW9uIGJlaW5nIGxvYWRlZCBpcyBub3QgdGhlIHJlc3VsdCBvZiBhIHJlZGlyZWN0CiAgICAgICAgICAgICAgdmFyIGlzQWN0aW9uUmVsb2FkID0gc3RhdGUuYWN0aW9uRGF0YSAhPSBudWxsICYmIHN0YXRlLm5hdmlnYXRpb24uZm9ybU1ldGhvZCAhPSBudWxsICYmIGlzTXV0YXRpb25NZXRob2Qoc3RhdGUubmF2aWdhdGlvbi5mb3JtTWV0aG9kKSAmJiBzdGF0ZS5uYXZpZ2F0aW9uLnN0YXRlID09PSAibG9hZGluZyIgJiYgKChfbG9jYXRpb24kc3RhdGUgPSBsb2NhdGlvbi5zdGF0ZSkgPT0gbnVsbCA/IHZvaWQgMCA6IF9sb2NhdGlvbiRzdGF0ZS5faXNSZWRpcmVjdCkgIT09IHRydWU7CiAgICAgICAgICAgICAgdmFyIGFjdGlvbkRhdGE7CgogICAgICAgICAgICAgIGlmIChuZXdTdGF0ZS5hY3Rpb25EYXRhKSB7CiAgICAgICAgICAgICAgICBpZiAoT2JqZWN0LmtleXMobmV3U3RhdGUuYWN0aW9uRGF0YSkubGVuZ3RoID4gMCkgewogICAgICAgICAgICAgICAgICBhY3Rpb25EYXRhID0gbmV3U3RhdGUuYWN0aW9uRGF0YTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgIC8vIEVtcHR5IGFjdGlvbkRhdGEgLT4gY2xlYXIgcHJpb3IgYWN0aW9uRGF0YSBkdWUgdG8gYW4gYWN0aW9uIGVycm9yCiAgICAgICAgICAgICAgICAgIGFjdGlvbkRhdGEgPSBudWxsOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0gZWxzZSBpZiAoaXNBY3Rpb25SZWxvYWQpIHsKICAgICAgICAgICAgICAgIC8vIEtlZXAgdGhlIGN1cnJlbnQgZGF0YSBpZiB3ZSdyZSB3cmFwcGluZyB1cCB0aGUgYWN0aW9uIHJlbG9hZAogICAgICAgICAgICAgICAgYWN0aW9uRGF0YSA9IHN0YXRlLmFjdGlvbkRhdGE7CiAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIC8vIENsZWFyIGFjdGlvbkRhdGEgb24gYW55IG90aGVyIGNvbXBsZXRlZCBuYXZpZ2F0aW9ucwogICAgICAgICAgICAgICAgYWN0aW9uRGF0YSA9IG51bGw7CiAgICAgICAgICAgICAgfSAvLyBBbHdheXMgcHJlc2VydmUgYW55IGV4aXN0aW5nIGxvYWRlckRhdGEgZnJvbSByZS11c2VkIHJvdXRlcwoKCiAgICAgICAgICAgICAgdmFyIGxvYWRlckRhdGEgPSBuZXdTdGF0ZS5sb2FkZXJEYXRhID8gbWVyZ2VMb2FkZXJEYXRhKHN0YXRlLmxvYWRlckRhdGEsIG5ld1N0YXRlLmxvYWRlckRhdGEsIG5ld1N0YXRlLm1hdGNoZXMgfHwgW10sIG5ld1N0YXRlLmVycm9ycykgOiBzdGF0ZS5sb2FkZXJEYXRhOyAvLyBPbiBhIHN1Y2Nlc3NmdWwgbmF2aWdhdGlvbiB3ZSBjYW4gYXNzdW1lIHdlIGdvdCB0aHJvdWdoIGFsbCBibG9ja2VycwogICAgICAgICAgICAgIC8vIHNvIHdlIGNhbiBzdGFydCBmcmVzaAogICAgICAgICAgICAgIHZhciBfaXRlcmF0b3I0ID0gX2NyZWF0ZUZvck9mSXRlcmF0b3JIZWxwZXIyKAogICAgICAgICAgICAgICAgYmxvY2tlckZ1bmN0aW9ucyksX3N0ZXA0O3RyeSB7Zm9yIChfaXRlcmF0b3I0LnMoKTsgIShfc3RlcDQgPSBfaXRlcmF0b3I0Lm4oKSkuZG9uZTspIHt2YXIgX3N0ZXA0JHZhbHVlID0gX3NsaWNlZFRvQXJyYXkyKF9zdGVwNC52YWx1ZSwgMSksa2V5ID0gX3N0ZXA0JHZhbHVlWzBdOwogICAgICAgICAgICAgICAgICBkZWxldGVCbG9ja2VyKGtleSk7CiAgICAgICAgICAgICAgICB9IC8vIEFsd2F5cyByZXNwZWN0IHRoZSB1c2VyIGZsYWcuICBPdGhlcndpc2UgZG9uJ3QgcmVzZXQgb24gbXV0YXRpb24KICAgICAgICAgICAgICAgIC8vIHN1Ym1pc3Npb24gbmF2aWdhdGlvbnMgdW5sZXNzIHRoZXkgcmVkaXJlY3QKICAgICAgICAgICAgICB9IGNhdGNoIChlcnIpIHtfaXRlcmF0b3I0LmUoZXJyKTt9IGZpbmFsbHkge19pdGVyYXRvcjQuZigpO30KCiAgICAgICAgICAgICAgdmFyIHByZXZlbnRTY3JvbGxSZXNldCA9IHBlbmRpbmdQcmV2ZW50U2Nyb2xsUmVzZXQgPT09IHRydWUgfHwgc3RhdGUubmF2aWdhdGlvbi5mb3JtTWV0aG9kICE9IG51bGwgJiYgaXNNdXRhdGlvbk1ldGhvZChzdGF0ZS5uYXZpZ2F0aW9uLmZvcm1NZXRob2QpICYmICgoX2xvY2F0aW9uJHN0YXRlMiA9IGxvY2F0aW9uLnN0YXRlKSA9PSBudWxsID8gdm9pZCAwIDogX2xvY2F0aW9uJHN0YXRlMi5faXNSZWRpcmVjdCkgIT09IHRydWU7CiAgICAgICAgICAgICAgdXBkYXRlU3RhdGUoX2V4dGVuZHMoe30sIG5ld1N0YXRlLCB7CiAgICAgICAgICAgICAgICBhY3Rpb25EYXRhOiBhY3Rpb25EYXRhLAogICAgICAgICAgICAgICAgbG9hZGVyRGF0YTogbG9hZGVyRGF0YSwKICAgICAgICAgICAgICAgIGhpc3RvcnlBY3Rpb246IHBlbmRpbmdBY3Rpb24sCiAgICAgICAgICAgICAgICBsb2NhdGlvbjogbG9jYXRpb24sCiAgICAgICAgICAgICAgICBpbml0aWFsaXplZDogdHJ1ZSwKICAgICAgICAgICAgICAgIG5hdmlnYXRpb246IElETEVfTkFWSUdBVElPTiwKICAgICAgICAgICAgICAgIHJldmFsaWRhdGlvbjogImlkbGUiLAogICAgICAgICAgICAgICAgcmVzdG9yZVNjcm9sbFBvc2l0aW9uOiBnZXRTYXZlZFNjcm9sbFBvc2l0aW9uKGxvY2F0aW9uLCBuZXdTdGF0ZS5tYXRjaGVzIHx8IHN0YXRlLm1hdGNoZXMpLAogICAgICAgICAgICAgICAgcHJldmVudFNjcm9sbFJlc2V0OiBwcmV2ZW50U2Nyb2xsUmVzZXQsCiAgICAgICAgICAgICAgICBibG9ja2VyczogbmV3IE1hcChzdGF0ZS5ibG9ja2VycykKICAgICAgICAgICAgICB9KSk7CgogICAgICAgICAgICAgIGlmIChpc1VuaW50ZXJydXB0ZWRSZXZhbGlkYXRpb24pIDtlbHNlIGlmIChwZW5kaW5nQWN0aW9uID09PSBBY3Rpb24uUG9wKSA7ZWxzZSBpZiAocGVuZGluZ0FjdGlvbiA9PT0gQWN0aW9uLlB1c2gpIHsKICAgICAgICAgICAgICAgIGluaXQuaGlzdG9yeS5wdXNoKGxvY2F0aW9uLCBsb2NhdGlvbi5zdGF0ZSk7CiAgICAgICAgICAgICAgfSBlbHNlIGlmIChwZW5kaW5nQWN0aW9uID09PSBBY3Rpb24uUmVwbGFjZSkgewogICAgICAgICAgICAgICAgaW5pdC5oaXN0b3J5LnJlcGxhY2UobG9jYXRpb24sIGxvY2F0aW9uLnN0YXRlKTsKICAgICAgICAgICAgICB9IC8vIFJlc2V0IHN0YXRlZnVsIG5hdmlnYXRpb24gdmFycwoKCiAgICAgICAgICAgICAgcGVuZGluZ0FjdGlvbiA9IEFjdGlvbi5Qb3A7CiAgICAgICAgICAgICAgcGVuZGluZ1ByZXZlbnRTY3JvbGxSZXNldCA9IGZhbHNlOwogICAgICAgICAgICAgIGlzVW5pbnRlcnJ1cHRlZFJldmFsaWRhdGlvbiA9IGZhbHNlOwogICAgICAgICAgICAgIGlzUmV2YWxpZGF0aW9uUmVxdWlyZWQgPSBmYWxzZTsKICAgICAgICAgICAgICBjYW5jZWxsZWREZWZlcnJlZFJvdXRlcyA9IFtdOwogICAgICAgICAgICAgIGNhbmNlbGxlZEZldGNoZXJMb2FkcyA9IFtdOwogICAgICAgICAgICB9IC8vIFRyaWdnZXIgYSBuYXZpZ2F0aW9uIGV2ZW50LCB3aGljaCBjYW4gZWl0aGVyIGJlIGEgbnVtZXJpY2FsIFBPUCBvciBhIFBVU0gKICAgICAgICAgICAgLy8gcmVwbGFjZSB3aXRoIGFuIG9wdGlvbmFsIHN1Ym1pc3Npb24KICAgICAgICAgICAgZnVuY3Rpb24KCiAgICAgICAgICAgIG5hdmlnYXRlKF94NCwgX3g1KSB7cmV0dXJuIF9uYXZpZ2F0ZS5hcHBseSh0aGlzLCBhcmd1bWVudHMpO30KCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgogICAgICAgICAgICAvLyBSZXZhbGlkYXRlIGFsbCBjdXJyZW50IGxvYWRlcnMuICBJZiBhIG5hdmlnYXRpb24gaXMgaW4gcHJvZ3Jlc3Mgb3IgaWYgdGhpcwogICAgICAgICAgICAvLyBpcyBpbnRlcnJ1cHRlZCBieSBhIG5hdmlnYXRpb24sIGFsbG93IHRoaXMgdG8gInN1Y2NlZWQiIGJ5IGNhbGxpbmcgYWxsCiAgICAgICAgICAgIC8vIGxvYWRlcnMgZHVyaW5nIHRoZSBuZXh0IGxvYWRlciByb3VuZAogICAgICAgICAgICBmdW5jdGlvbiBfbmF2aWdhdGUoKSB7X25hdmlnYXRlID0gX2FzeW5jVG9HZW5lcmF0b3IyKCAvKiNfX1BVUkVfXyovX3JlZ2VuZXJhdG9yUnVudGltZTIoKS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUzKHRvLCBvcHRzKSB7dmFyIF9ub3JtYWxpemVOYXZpZ2F0ZU9wdDIsIHBhdGgsIHN1Ym1pc3Npb24sIGVycm9yLCBjdXJyZW50TG9jYXRpb24sIG5leHRMb2NhdGlvbiwgdXNlclJlcGxhY2UsIGhpc3RvcnlBY3Rpb24sIHByZXZlbnRTY3JvbGxSZXNldCwgYmxvY2tlcktleTtyZXR1cm4gX3JlZ2VuZXJhdG9yUnVudGltZTIoKS53cmFwKGZ1bmN0aW9uIF9jYWxsZWUzJChfY29udGV4dDMpIHt3aGlsZSAoMSkgc3dpdGNoIChfY29udGV4dDMucHJldiA9IF9jb250ZXh0My5uZXh0KSB7Y2FzZSAwOmlmICghKHR5cGVvZiB0byA9PT0gIm51bWJlciIpKSB7X2NvbnRleHQzLm5leHQgPSAzO2JyZWFrO31pbml0Lmhpc3RvcnkuZ28odG8pO3JldHVybiBfY29udGV4dDMuYWJydXB0KCJyZXR1cm4iKTtjYXNlIDM6X25vcm1hbGl6ZU5hdmlnYXRlT3B0MiA9IG5vcm1hbGl6ZU5hdmlnYXRlT3B0aW9ucyh0bywgb3B0cyksIHBhdGggPSBfbm9ybWFsaXplTmF2aWdhdGVPcHQyLnBhdGgsIHN1Ym1pc3Npb24gPSBfbm9ybWFsaXplTmF2aWdhdGVPcHQyLnN1Ym1pc3Npb24sIGVycm9yID0gX25vcm1hbGl6ZU5hdmlnYXRlT3B0Mi5lcnJvcjtjdXJyZW50TG9jYXRpb24gPSBzdGF0ZS5sb2NhdGlvbjtuZXh0TG9jYXRpb24gPSBjcmVhdGVMb2NhdGlvbihzdGF0ZS5sb2NhdGlvbiwgcGF0aCwgb3B0cyAmJiBvcHRzLnN0YXRlKTsgLy8gV2hlbiB1c2luZyBuYXZpZ2F0ZSBhcyBhIFBVU0gvUkVQTEFDRSB3ZSBhcmVuJ3QgcmVhZGluZyBhbiBhbHJlYWR5LWVuY29kZWQKICAgICAgICAgICAgICAgICAgICAgIC8vIFVSTCBmcm9tIHdpbmRvdy5sb2NhdGlvbiwgc28gd2UgbmVlZCB0byBlbmNvZGUgaXQgaGVyZSBzbyB0aGUgYmVoYXZpb3IKICAgICAgICAgICAgICAgICAgICAgIC8vIHJlbWFpbnMgdGhlIHNhbWUgYXMgUE9QIGFuZCBub24tZGF0YS1yb3V0ZXIgdXNhZ2VzLiAgbmV3IFVSTCgpIGRvZXMgYWxsCiAgICAgICAgICAgICAgICAgICAgICAvLyB0aGUgc2FtZSBlbmNvZGluZyB3ZSdkIGdldCBmcm9tIGEgaGlzdG9yeS5wdXNoU3RhdGUvd2luZG93LmxvY2F0aW9uIHJlYWQKICAgICAgICAgICAgICAgICAgICAgIC8vIHdpdGhvdXQgaGF2aW5nIHRvIHRvdWNoIGhpc3RvcnkKICAgICAgICAgICAgICAgICAgICAgIG5leHRMb2NhdGlvbiA9IF9leHRlbmRzKHt9LCBuZXh0TG9jYXRpb24sIGluaXQuaGlzdG9yeS5lbmNvZGVMb2NhdGlvbihuZXh0TG9jYXRpb24pKTt1c2VyUmVwbGFjZSA9IG9wdHMgJiYgb3B0cy5yZXBsYWNlICE9IG51bGwgPyBvcHRzLnJlcGxhY2UgOiB1bmRlZmluZWQ7aGlzdG9yeUFjdGlvbiA9IEFjdGlvbi5QdXNoO2lmICh1c2VyUmVwbGFjZSA9PT0gdHJ1ZSkge2hpc3RvcnlBY3Rpb24gPSBBY3Rpb24uUmVwbGFjZTt9IGVsc2UgaWYgKHVzZXJSZXBsYWNlID09PSBmYWxzZSkgO2Vsc2UgaWYgKHN1Ym1pc3Npb24gIT0gbnVsbCAmJiBpc011dGF0aW9uTWV0aG9kKHN1Ym1pc3Npb24uZm9ybU1ldGhvZCkgJiYgc3VibWlzc2lvbi5mb3JtQWN0aW9uID09PSBzdGF0ZS5sb2NhdGlvbi5wYXRobmFtZSArIHN0YXRlLmxvY2F0aW9uLnNlYXJjaCkgey8vIEJ5IGRlZmF1bHQgb24gc3VibWlzc2lvbnMgdG8gdGhlIGN1cnJlbnQgbG9jYXRpb24gd2UgUkVQTEFDRSBzbyB0aGF0CiAgICAgICAgICAgICAgICAgICAgICAgIC8vIHVzZXJzIGRvbid0IGhhdmUgdG8gZG91YmxlLWNsaWNrIHRoZSBiYWNrIGJ1dHRvbiB0byBnZXQgdG8gdGhlIHByaW9yCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIGxvY2F0aW9uLiAgSWYgdGhlIHVzZXIgcmVkaXJlY3RzIHRvIGEgZGlmZmVyZW50IGxvY2F0aW9uIGZyb20gdGhlCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIGFjdGlvbi9sb2FkZXIgdGhpcyB3aWxsIGJlIGlnbm9yZWQgYW5kIHRoZSByZWRpcmVjdCB3aWxsIGJlIGEgUFVTSAogICAgICAgICAgICAgICAgICAgICAgICBoaXN0b3J5QWN0aW9uID0gQWN0aW9uLlJlcGxhY2U7fXByZXZlbnRTY3JvbGxSZXNldCA9IG9wdHMgJiYgInByZXZlbnRTY3JvbGxSZXNldCIgaW4gb3B0cyA/IG9wdHMucHJldmVudFNjcm9sbFJlc2V0ID09PSB0cnVlIDogdW5kZWZpbmVkO2Jsb2NrZXJLZXkgPSBzaG91bGRCbG9ja05hdmlnYXRpb24oeyBjdXJyZW50TG9jYXRpb246IGN1cnJlbnRMb2NhdGlvbiwgbmV4dExvY2F0aW9uOiBuZXh0TG9jYXRpb24sIGhpc3RvcnlBY3Rpb246IGhpc3RvcnlBY3Rpb24gfSk7aWYgKCFibG9ja2VyS2V5KSB7X2NvbnRleHQzLm5leHQgPSAxNTticmVhazt9IC8vIFB1dCB0aGUgYmxvY2tlciBpbnRvIGEgYmxvY2tlZCBzdGF0ZQogICAgICAgICAgICAgICAgICAgICAgdXBkYXRlQmxvY2tlcihibG9ja2VyS2V5LCB7IHN0YXRlOiAiYmxvY2tlZCIsIGxvY2F0aW9uOiBuZXh0TG9jYXRpb24sIHByb2NlZWQ6IGZ1bmN0aW9uIHByb2NlZWQoKSB7dXBkYXRlQmxvY2tlcihibG9ja2VyS2V5LCB7IHN0YXRlOiAicHJvY2VlZGluZyIsIHByb2NlZWQ6IHVuZGVmaW5lZCwgcmVzZXQ6IHVuZGVmaW5lZCwgbG9jYXRpb246IG5leHRMb2NhdGlvbiB9KTsgLy8gU2VuZCB0aGUgc2FtZSBuYXZpZ2F0aW9uIHRocm91Z2gKICAgICAgICAgICAgICAgICAgICAgICAgICBuYXZpZ2F0ZSh0bywgb3B0cyk7fSwgcmVzZXQ6IGZ1bmN0aW9uIHJlc2V0KCkge2RlbGV0ZUJsb2NrZXIoYmxvY2tlcktleSk7dXBkYXRlU3RhdGUoeyBibG9ja2VyczogbmV3IE1hcChzdGF0ZS5ibG9ja2VycykgfSk7fSB9KTtyZXR1cm4gX2NvbnRleHQzLmFicnVwdCgicmV0dXJuIik7Y2FzZSAxNTpfY29udGV4dDMubmV4dCA9IDE3O3JldHVybiBzdGFydE5hdmlnYXRpb24oaGlzdG9yeUFjdGlvbiwgbmV4dExvY2F0aW9uLCB7IHN1Ym1pc3Npb246IHN1Ym1pc3Npb24sIC8vIFNlbmQgdGhyb3VnaCB0aGUgZm9ybURhdGEgc2VyaWFsaXphdGlvbiBlcnJvciBpZiB3ZSBoYXZlIG9uZSBzbyB3ZSBjYW4KICAgICAgICAgICAgICAgICAgICAgICAgLy8gcmVuZGVyIGF0IHRoZSByaWdodCBlcnJvciBib3VuZGFyeSBhZnRlciB3ZSBtYXRjaCByb3V0ZXMKICAgICAgICAgICAgICAgICAgICAgICAgcGVuZGluZ0Vycm9yOiBlcnJvciwgcHJldmVudFNjcm9sbFJlc2V0OiBwcmV2ZW50U2Nyb2xsUmVzZXQsIHJlcGxhY2U6IG9wdHMgJiYgb3B0cy5yZXBsYWNlIH0pO2Nhc2UgMTc6cmV0dXJuIF9jb250ZXh0My5hYnJ1cHQoInJldHVybiIsIF9jb250ZXh0My5zZW50KTtjYXNlIDE4OmNhc2UgImVuZCI6cmV0dXJuIF9jb250ZXh0My5zdG9wKCk7fX0sIF9jYWxsZWUzKTt9KSk7cmV0dXJuIF9uYXZpZ2F0ZS5hcHBseSh0aGlzLCBhcmd1bWVudHMpO31mdW5jdGlvbiByZXZhbGlkYXRlKCkge2ludGVycnVwdEFjdGl2ZUxvYWRzKCk7dXBkYXRlU3RhdGUoeyByZXZhbGlkYXRpb246ICJsb2FkaW5nIiB9KTsgLy8gSWYgd2UncmUgY3VycmVudGx5IHN1Ym1pdHRpbmcgYW4gYWN0aW9uLCB3ZSBkb24ndCBuZWVkIHRvIHN0YXJ0IGEgbmV3CiAgICAgICAgICAgICAgLy8gbmF2aWdhdGlvbiwgd2UnbGwganVzdCBsZXQgdGhlIGZvbGxvdyB1cCBsb2FkZXIgZXhlY3V0aW9uIGNhbGwgYWxsIGxvYWRlcnMKICAgICAgICAgICAgICBpZiAoc3RhdGUubmF2aWdhdGlvbi5zdGF0ZSA9PT0gInN1Ym1pdHRpbmciKSB7cmV0dXJuO30gLy8gSWYgd2UncmUgY3VycmVudGx5IGluIGFuIGlkbGUgc3RhdGUsIHN0YXJ0IGEgbmV3IG5hdmlnYXRpb24gZm9yIHRoZSBjdXJyZW50CiAgICAgICAgICAgICAgLy8gYWN0aW9uL2xvY2F0aW9uIGFuZCBtYXJrIGl0IGFzIHVuaW50ZXJydXB0ZWQsIHdoaWNoIHdpbGwgc2tpcCB0aGUgaGlzdG9yeQogICAgICAgICAgICAgIC8vIHVwZGF0ZSBpbiBjb21wbGV0ZU5hdmlnYXRpb24KICAgICAgICAgICAgICBpZiAoc3RhdGUubmF2aWdhdGlvbi5zdGF0ZSA9PT0gImlkbGUiKSB7c3RhcnROYXZpZ2F0aW9uKHN0YXRlLmhpc3RvcnlBY3Rpb24sIHN0YXRlLmxvY2F0aW9uLCB7IHN0YXJ0VW5pbnRlcnJ1cHRlZFJldmFsaWRhdGlvbjogdHJ1ZQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgfSAvLyBPdGhlcndpc2UsIGlmIHdlJ3JlIGN1cnJlbnRseSBpbiBhIGxvYWRpbmcgc3RhdGUsIGp1c3Qgc3RhcnQgYSBuZXcKICAgICAgICAgICAgICAvLyBuYXZpZ2F0aW9uIHRvIHRoZSBuYXZpZ2F0aW9uLmxvY2F0aW9uIGJ1dCBkbyBub3QgdHJpZ2dlciBhbiB1bmludGVycnVwdGVkCiAgICAgICAgICAgICAgLy8gcmV2YWxpZGF0aW9uIHNvIHRoYXQgaGlzdG9yeSBjb3JyZWN0bHkgdXBkYXRlcyBvbmNlIHRoZSBuYXZpZ2F0aW9uIGNvbXBsZXRlcwoKCiAgICAgICAgICAgICAgc3RhcnROYXZpZ2F0aW9uKHBlbmRpbmdBY3Rpb24gfHwgc3RhdGUuaGlzdG9yeUFjdGlvbiwgc3RhdGUubmF2aWdhdGlvbi5sb2NhdGlvbiwgewogICAgICAgICAgICAgICAgb3ZlcnJpZGVOYXZpZ2F0aW9uOiBzdGF0ZS5uYXZpZ2F0aW9uCiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0gLy8gU3RhcnQgYSBuYXZpZ2F0aW9uIHRvIHRoZSBnaXZlbiBhY3Rpb24vbG9jYXRpb24uICBDYW4gb3B0aW9uYWxseSBwcm92aWRlIGEKICAgICAgICAgICAgLy8gb3ZlcnJpZGVOYXZpZ2F0aW9uIHdoaWNoIHdpbGwgb3ZlcnJpZGUgdGhlIG5vcm1hbExvYWQgaW4gdGhlIGNhc2Ugb2YgYSByZWRpcmVjdAogICAgICAgICAgICAvLyBuYXZpZ2F0aW9uCiAgICAgICAgICAgIGZ1bmN0aW9uCgogICAgICAgICAgICBzdGFydE5hdmlnYXRpb24oX3g2LCBfeDcsIF94OCkge3JldHVybiBfc3RhcnROYXZpZ2F0aW9uLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7fQoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKICAgICAgICAgICAgLy8gQ2FsbCB0aGUgYWN0aW9uIG1hdGNoZWQgYnkgdGhlIGxlYWYgcm91dGUgZm9yIHRoaXMgbmF2aWdhdGlvbiBhbmQgaGFuZGxlCiAgICAgICAgICAgIC8vIHJlZGlyZWN0cy9lcnJvcnMKICAgICAgICAgICAgZnVuY3Rpb24gX3N0YXJ0TmF2aWdhdGlvbigpIHtfc3RhcnROYXZpZ2F0aW9uID0gX2FzeW5jVG9HZW5lcmF0b3IyKCAvKiNfX1BVUkVfXyovX3JlZ2VuZXJhdG9yUnVudGltZTIoKS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWU0KGhpc3RvcnlBY3Rpb24sIGxvY2F0aW9uLCBvcHRzKSB7dmFyIGxvYWRpbmdOYXZpZ2F0aW9uLCBtYXRjaGVzLCBfZXJyb3IsIF9nZXRTaG9ydENpcmN1aXRNYXRjaDIsIG5vdEZvdW5kTWF0Y2hlcywgX3JvdXRlLCByZXF1ZXN0LCBwZW5kaW5nQWN0aW9uRGF0YSwgcGVuZGluZ0Vycm9yLCBhY3Rpb25PdXRwdXQsIG5hdmlnYXRpb24sIF95aWVsZCRoYW5kbGVMb2FkZXJzLCBzaG9ydENpcmN1aXRlZCwgbG9hZGVyRGF0YSwgZXJyb3JzO3JldHVybiBfcmVnZW5lcmF0b3JSdW50aW1lMigpLndyYXAoZnVuY3Rpb24gX2NhbGxlZTQkKF9jb250ZXh0NCkge3doaWxlICgxKSBzd2l0Y2ggKF9jb250ZXh0NC5wcmV2ID0gX2NvbnRleHQ0Lm5leHQpIHtjYXNlIDA6IC8vIEFib3J0IGFueSBpbi1wcm9ncmVzcyBuYXZpZ2F0aW9ucyBhbmQgc3RhcnQgYSBuZXcgb25lLiBVbnNldCBhbnkgb25nb2luZwogICAgICAgICAgICAgICAgICAgICAgLy8gdW5pbnRlcnJ1cHRlZCByZXZhbGlkYXRpb25zIHVubGVzcyB0b2xkIG90aGVyd2lzZSwgc2luY2Ugd2Ugd2FudCB0aGlzCiAgICAgICAgICAgICAgICAgICAgICAvLyBuZXcgbmF2aWdhdGlvbiB0byB1cGRhdGUgaGlzdG9yeSBub3JtYWxseQogICAgICAgICAgICAgICAgICAgICAgcGVuZGluZ05hdmlnYXRpb25Db250cm9sbGVyICYmIHBlbmRpbmdOYXZpZ2F0aW9uQ29udHJvbGxlci5hYm9ydCgpO3BlbmRpbmdOYXZpZ2F0aW9uQ29udHJvbGxlciA9IG51bGw7cGVuZGluZ0FjdGlvbiA9IGhpc3RvcnlBY3Rpb247aXNVbmludGVycnVwdGVkUmV2YWxpZGF0aW9uID0gKG9wdHMgJiYgb3B0cy5zdGFydFVuaW50ZXJydXB0ZWRSZXZhbGlkYXRpb24pID09PSB0cnVlOyAvLyBTYXZlIHRoZSBjdXJyZW50IHNjcm9sbCBwb3NpdGlvbiBldmVyeSB0aW1lIHdlIHN0YXJ0IGEgbmV3IG5hdmlnYXRpb24sCiAgICAgICAgICAgICAgICAgICAgICAvLyBhbmQgdHJhY2sgd2hldGhlciB3ZSBzaG91bGQgcmVzZXQgc2Nyb2xsIG9uIGNvbXBsZXRpb24KICAgICAgICAgICAgICAgICAgICAgIHNhdmVTY3JvbGxQb3NpdGlvbihzdGF0ZS5sb2NhdGlvbiwgc3RhdGUubWF0Y2hlcyk7cGVuZGluZ1ByZXZlbnRTY3JvbGxSZXNldCA9IChvcHRzICYmIG9wdHMucHJldmVudFNjcm9sbFJlc2V0KSA9PT0gdHJ1ZTtsb2FkaW5nTmF2aWdhdGlvbiA9IG9wdHMgJiYgb3B0cy5vdmVycmlkZU5hdmlnYXRpb247bWF0Y2hlcyA9IG1hdGNoUm91dGVzKGRhdGFSb3V0ZXMsIGxvY2F0aW9uLCBpbml0LmJhc2VuYW1lKTsgLy8gU2hvcnQgY2lyY3VpdCB3aXRoIGEgNDA0IG9uIHRoZSByb290IGVycm9yIGJvdW5kYXJ5IGlmIHdlIG1hdGNoIG5vdGhpbmcKICAgICAgICAgICAgICAgICAgICAgIGlmIChtYXRjaGVzKSB7X2NvbnRleHQ0Lm5leHQgPSAxNDticmVhazt9X2Vycm9yID0gZ2V0SW50ZXJuYWxSb3V0ZXJFcnJvcig0MDQsIHsgcGF0aG5hbWU6IGxvY2F0aW9uLnBhdGhuYW1lIH0pO19nZXRTaG9ydENpcmN1aXRNYXRjaDIgPSBnZXRTaG9ydENpcmN1aXRNYXRjaGVzKGRhdGFSb3V0ZXMpLCBub3RGb3VuZE1hdGNoZXMgPSBfZ2V0U2hvcnRDaXJjdWl0TWF0Y2gyLm1hdGNoZXMsIF9yb3V0ZSA9IF9nZXRTaG9ydENpcmN1aXRNYXRjaDIucm91dGU7IC8vIENhbmNlbCBhbGwgcGVuZGluZyBkZWZlcnJlZCBvbiA0MDRzIHNpbmNlIHdlIGRvbid0IGtlZXAgYW55IHJvdXRlcwogICAgICAgICAgICAgICAgICAgICAgY2FuY2VsQWN0aXZlRGVmZXJyZWRzKCk7Y29tcGxldGVOYXZpZ2F0aW9uKGxvY2F0aW9uLCB7IG1hdGNoZXM6IG5vdEZvdW5kTWF0Y2hlcywgbG9hZGVyRGF0YToge30sIGVycm9yczogX2RlZmluZVByb3BlcnR5Mih7fSwgX3JvdXRlLmlkLCBfZXJyb3IpIH0pO3JldHVybiBfY29udGV4dDQuYWJydXB0KCJyZXR1cm4iKTtjYXNlIDE0OmlmICghKGlzSGFzaENoYW5nZU9ubHkoc3RhdGUubG9jYXRpb24sIGxvY2F0aW9uKSAmJiAhKG9wdHMgJiYgb3B0cy5zdWJtaXNzaW9uICYmIGlzTXV0YXRpb25NZXRob2Qob3B0cy5zdWJtaXNzaW9uLmZvcm1NZXRob2QpKSkpIHtfY29udGV4dDQubmV4dCA9IDE3O2JyZWFrO31jb21wbGV0ZU5hdmlnYXRpb24obG9jYXRpb24sIHsgbWF0Y2hlczogbWF0Y2hlcyB9KTtyZXR1cm4gX2NvbnRleHQ0LmFicnVwdCgicmV0dXJuIik7Y2FzZSAxNzogLy8gQ3JlYXRlIGEgY29udHJvbGxlci9SZXF1ZXN0IGZvciB0aGlzIG5hdmlnYXRpb24KICAgICAgICAgICAgICAgICAgICAgIHBlbmRpbmdOYXZpZ2F0aW9uQ29udHJvbGxlciA9IG5ldyBBYm9ydENvbnRyb2xsZXIoKTtyZXF1ZXN0ID0gY3JlYXRlQ2xpZW50U2lkZVJlcXVlc3QoaW5pdC5oaXN0b3J5LCBsb2NhdGlvbiwgcGVuZGluZ05hdmlnYXRpb25Db250cm9sbGVyLnNpZ25hbCwgb3B0cyAmJiBvcHRzLnN1Ym1pc3Npb24pO2lmICghKG9wdHMgJiYgb3B0cy5wZW5kaW5nRXJyb3IpKSB7X2NvbnRleHQ0Lm5leHQgPSAyMzticmVhazt9IC8vIElmIHdlIGhhdmUgYSBwZW5kaW5nRXJyb3IsIGl0IG1lYW5zIHRoZSB1c2VyIGF0dGVtcHRlZCBhIEdFVCBzdWJtaXNzaW9uCiAgICAgICAgICAgICAgICAgICAgICAvLyB3aXRoIGJpbmFyeSBGb3JtRGF0YSBzbyBhc3NpZ24gaGVyZSBhbmQgc2tpcCB0byBoYW5kbGVMb2FkZXJzLiAgVGhhdAogICAgICAgICAgICAgICAgICAgICAgLy8gd2F5IHdlIGhhbmRsZSBjYWxsaW5nIGxvYWRlcnMgYWJvdmUgdGhlIGJvdW5kYXJ5IGV0Yy4gIEl0J3Mgbm90IHJlYWxseQogICAgICAgICAgICAgICAgICAgICAgLy8gZGlmZmVyZW50IGZyb20gYW4gYWN0aW9uRXJyb3IgaW4gdGhhdCBzZW5zZS4KICAgICAgICAgICAgICAgICAgICAgIHBlbmRpbmdFcnJvciA9IF9kZWZpbmVQcm9wZXJ0eTIoe30sIGZpbmROZWFyZXN0Qm91bmRhcnkobWF0Y2hlcykucm91dGUuaWQsIG9wdHMucGVuZGluZ0Vycm9yKTtfY29udGV4dDQubmV4dCA9IDM0O2JyZWFrO2Nhc2UgMjM6aWYgKCEob3B0cyAmJiBvcHRzLnN1Ym1pc3Npb24gJiYgaXNNdXRhdGlvbk1ldGhvZChvcHRzLnN1Ym1pc3Npb24uZm9ybU1ldGhvZCkpKSB7X2NvbnRleHQ0Lm5leHQgPSAzNDticmVhazt9X2NvbnRleHQ0Lm5leHQgPSAyNjtyZXR1cm4gaGFuZGxlQWN0aW9uKHJlcXVlc3QsIGxvY2F0aW9uLCBvcHRzLnN1Ym1pc3Npb24sIG1hdGNoZXMsIHsgcmVwbGFjZTogb3B0cy5yZXBsYWNlIH0pO2Nhc2UgMjY6YWN0aW9uT3V0cHV0ID0gX2NvbnRleHQ0LnNlbnQ7aWYgKCFhY3Rpb25PdXRwdXQuc2hvcnRDaXJjdWl0ZWQpIHtfY29udGV4dDQubmV4dCA9IDI5O2JyZWFrO31yZXR1cm4gX2NvbnRleHQ0LmFicnVwdCgicmV0dXJuIik7Y2FzZSAyOTpwZW5kaW5nQWN0aW9uRGF0YSA9IGFjdGlvbk91dHB1dC5wZW5kaW5nQWN0aW9uRGF0YTtwZW5kaW5nRXJyb3IgPSBhY3Rpb25PdXRwdXQucGVuZGluZ0FjdGlvbkVycm9yO25hdmlnYXRpb24gPSBfZXh0ZW5kcyh7IHN0YXRlOiAibG9hZGluZyIsIGxvY2F0aW9uOiBsb2NhdGlvbiB9LCBvcHRzLnN1Ym1pc3Npb24pO2xvYWRpbmdOYXZpZ2F0aW9uID0gbmF2aWdhdGlvbjsgLy8gQ3JlYXRlIGEgR0VUIHJlcXVlc3QgZm9yIHRoZSBsb2FkZXJzCiAgICAgICAgICAgICAgICAgICAgICByZXF1ZXN0ID0gbmV3IFJlcXVlc3QocmVxdWVzdC51cmwsIHsgc2lnbmFsOiByZXF1ZXN0LnNpZ25hbCB9KTtjYXNlIDM0Ol9jb250ZXh0NC5uZXh0ID0gMzY7cmV0dXJuIGhhbmRsZUxvYWRlcnMocmVxdWVzdCwgbG9jYXRpb24sIG1hdGNoZXMsIGxvYWRpbmdOYXZpZ2F0aW9uLCBvcHRzICYmIG9wdHMuc3VibWlzc2lvbiwgb3B0cyAmJiBvcHRzLnJlcGxhY2UsIHBlbmRpbmdBY3Rpb25EYXRhLCBwZW5kaW5nRXJyb3IpO2Nhc2UgMzY6X3lpZWxkJGhhbmRsZUxvYWRlcnMgPSBfY29udGV4dDQuc2VudDtzaG9ydENpcmN1aXRlZCA9IF95aWVsZCRoYW5kbGVMb2FkZXJzLnNob3J0Q2lyY3VpdGVkO2xvYWRlckRhdGEgPSBfeWllbGQkaGFuZGxlTG9hZGVycy5sb2FkZXJEYXRhO2Vycm9ycyA9IF95aWVsZCRoYW5kbGVMb2FkZXJzLmVycm9ycztpZiAoIXNob3J0Q2lyY3VpdGVkKSB7X2NvbnRleHQ0Lm5leHQgPSA0MjticmVhazt9cmV0dXJuIF9jb250ZXh0NC5hYnJ1cHQoInJldHVybiIpO2Nhc2UgNDI6IC8vIENsZWFuIHVwIG5vdyB0aGF0IHRoZSBhY3Rpb24vbG9hZGVycyBoYXZlIGNvbXBsZXRlZC4gIERvbid0IGNsZWFuIHVwIGlmCiAgICAgICAgICAgICAgICAgICAgICAvLyB3ZSBzaG9ydCBjaXJjdWl0ZWQgYmVjYXVzZSBwZW5kaW5nTmF2aWdhdGlvbkNvbnRyb2xsZXIgd2lsbCBoYXZlIGFscmVhZHkKICAgICAgICAgICAgICAgICAgICAgIC8vIGJlZW4gYXNzaWduZWQgdG8gYSBuZXcgY29udHJvbGxlciBmb3IgdGhlIG5leHQgbmF2aWdhdGlvbgogICAgICAgICAgICAgICAgICAgICAgcGVuZGluZ05hdmlnYXRpb25Db250cm9sbGVyID0gbnVsbDtjb21wbGV0ZU5hdmlnYXRpb24obG9jYXRpb24sIF9leHRlbmRzKHsgbWF0Y2hlczogbWF0Y2hlcyB9LCBwZW5kaW5nQWN0aW9uRGF0YSA/IHsgYWN0aW9uRGF0YTogcGVuZGluZ0FjdGlvbkRhdGEgfSA6IHt9LCB7IGxvYWRlckRhdGE6IGxvYWRlckRhdGEsIGVycm9yczogZXJyb3JzIH0pKTtjYXNlIDQ0OmNhc2UgImVuZCI6cmV0dXJuIF9jb250ZXh0NC5zdG9wKCk7fX0sIF9jYWxsZWU0KTt9KSk7cmV0dXJuIF9zdGFydE5hdmlnYXRpb24uYXBwbHkodGhpcywgYXJndW1lbnRzKTt9ZnVuY3Rpb24gaGFuZGxlQWN0aW9uKF94OSwgX3gxMCwgX3gxMSwgX3gxMiwgX3gxMykge3JldHVybiBfaGFuZGxlQWN0aW9uLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7fQoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgogICAgICAgICAgICAvLyBDYWxsIGFsbCBhcHBsaWNhYmxlIGxvYWRlcnMgZm9yIHRoZSBnaXZlbiBtYXRjaGVzLCBoYW5kbGluZyByZWRpcmVjdHMsCiAgICAgICAgICAgIC8vIGVycm9ycywgZXRjLgogICAgICAgICAgICBmdW5jdGlvbiBfaGFuZGxlQWN0aW9uKCkge19oYW5kbGVBY3Rpb24gPSBfYXN5bmNUb0dlbmVyYXRvcjIoIC8qI19fUFVSRV9fKi9fcmVnZW5lcmF0b3JSdW50aW1lMigpLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTUocmVxdWVzdCwgbG9jYXRpb24sIHN1Ym1pc3Npb24sIG1hdGNoZXMsIG9wdHMpIHt2YXIgbmF2aWdhdGlvbiwgcmVzdWx0LCBhY3Rpb25NYXRjaCwgcmVwbGFjZSwgYm91bmRhcnlNYXRjaDtyZXR1cm4gX3JlZ2VuZXJhdG9yUnVudGltZTIoKS53cmFwKGZ1bmN0aW9uIF9jYWxsZWU1JChfY29udGV4dDUpIHt3aGlsZSAoMSkgc3dpdGNoIChfY29udGV4dDUucHJldiA9IF9jb250ZXh0NS5uZXh0KSB7Y2FzZSAwOmludGVycnVwdEFjdGl2ZUxvYWRzKCk7IC8vIFB1dCB1cyBpbiBhIHN1Ym1pdHRpbmcgc3RhdGUKICAgICAgICAgICAgICAgICAgICAgIG5hdmlnYXRpb24gPSBfZXh0ZW5kcyh7IHN0YXRlOiAic3VibWl0dGluZyIsIGxvY2F0aW9uOiBsb2NhdGlvbiB9LCBzdWJtaXNzaW9uKTt1cGRhdGVTdGF0ZSh7IG5hdmlnYXRpb246IG5hdmlnYXRpb24gfSk7IC8vIENhbGwgb3VyIGFjdGlvbiBhbmQgZ2V0IHRoZSByZXN1bHQKICAgICAgICAgICAgICAgICAgICAgIGFjdGlvbk1hdGNoID0gZ2V0VGFyZ2V0TWF0Y2gobWF0Y2hlcywgbG9jYXRpb24pO2lmIChhY3Rpb25NYXRjaC5yb3V0ZS5hY3Rpb24pIHtfY29udGV4dDUubmV4dCA9IDg7YnJlYWs7fXJlc3VsdCA9IHsgdHlwZTogUmVzdWx0VHlwZS5lcnJvciwgZXJyb3I6IGdldEludGVybmFsUm91dGVyRXJyb3IoNDA1LCB7IG1ldGhvZDogcmVxdWVzdC5tZXRob2QsIHBhdGhuYW1lOiBsb2NhdGlvbi5wYXRobmFtZSwgcm91dGVJZDogYWN0aW9uTWF0Y2gucm91dGUuaWQgfSkgfTtfY29udGV4dDUubmV4dCA9IDEzO2JyZWFrO2Nhc2UgODpfY29udGV4dDUubmV4dCA9IDEwO3JldHVybiBjYWxsTG9hZGVyT3JBY3Rpb24oImFjdGlvbiIsIHJlcXVlc3QsIGFjdGlvbk1hdGNoLCBtYXRjaGVzLCByb3V0ZXIuYmFzZW5hbWUpO2Nhc2UgMTA6cmVzdWx0ID0gX2NvbnRleHQ1LnNlbnQ7aWYgKCFyZXF1ZXN0LnNpZ25hbC5hYm9ydGVkKSB7X2NvbnRleHQ1Lm5leHQgPSAxMzticmVhazt9cmV0dXJuIF9jb250ZXh0NS5hYnJ1cHQoInJldHVybiIsIHsgc2hvcnRDaXJjdWl0ZWQ6IHRydWUgfSk7Y2FzZSAxMzppZiAoIWlzUmVkaXJlY3RSZXN1bHQocmVzdWx0KSkge19jb250ZXh0NS5uZXh0ID0gMTg7YnJlYWs7fWlmIChvcHRzICYmIG9wdHMucmVwbGFjZSAhPSBudWxsKSB7cmVwbGFjZSA9IG9wdHMucmVwbGFjZTt9IGVsc2Ugey8vIElmIHRoZSB1c2VyIGRpZG4ndCBleHBsaWNpdHkgaW5kaWNhdGUgcmVwbGFjZSBiZWhhdmlvciwgcmVwbGFjZSBpZgogICAgICAgICAgICAgICAgICAgICAgICAvLyB3ZSByZWRpcmVjdGVkIHRvIHRoZSBleGFjdCBzYW1lIGxvY2F0aW9uIHdlJ3JlIGN1cnJlbnRseSBhdCB0byBhdm9pZAogICAgICAgICAgICAgICAgICAgICAgICAvLyBkb3VibGUgYmFjay1idXR0b25zCiAgICAgICAgICAgICAgICAgICAgICAgIHJlcGxhY2UgPSByZXN1bHQubG9jYXRpb24gPT09IHN0YXRlLmxvY2F0aW9uLnBhdGhuYW1lICsgc3RhdGUubG9jYXRpb24uc2VhcmNoO31fY29udGV4dDUubmV4dCA9IDE3O3JldHVybiBzdGFydFJlZGlyZWN0TmF2aWdhdGlvbihzdGF0ZSwgcmVzdWx0LCB7IHN1Ym1pc3Npb246IHN1Ym1pc3Npb24sIHJlcGxhY2U6IHJlcGxhY2UgfSk7Y2FzZSAxNzpyZXR1cm4gX2NvbnRleHQ1LmFicnVwdCgicmV0dXJuIiwgeyBzaG9ydENpcmN1aXRlZDogdHJ1ZSB9KTtjYXNlIDE4OmlmICghaXNFcnJvclJlc3VsdChyZXN1bHQpKSB7X2NvbnRleHQ1Lm5leHQgPSAyMjticmVhazt9IC8vIFN0b3JlIG9mZiB0aGUgcGVuZGluZyBlcnJvciAtIHdlIHVzZSBpdCB0byBkZXRlcm1pbmUgd2hpY2ggbG9hZGVycwogICAgICAgICAgICAgICAgICAgICAgLy8gdG8gY2FsbCBhbmQgd2lsbCBjb21taXQgaXQgd2hlbiB3ZSBjb21wbGV0ZSB0aGUgbmF2aWdhdGlvbgogICAgICAgICAgICAgICAgICAgICAgYm91bmRhcnlNYXRjaCA9IGZpbmROZWFyZXN0Qm91bmRhcnkobWF0Y2hlcywgYWN0aW9uTWF0Y2gucm91dGUuaWQpOyAvLyBCeSBkZWZhdWx0LCBhbGwgc3VibWlzc2lvbnMgYXJlIFJFUExBQ0UgbmF2aWdhdGlvbnMsIGJ1dCBpZiB0aGUKICAgICAgICAgICAgICAgICAgICAgIC8vIGFjdGlvbiB0aHJldyBhbiBlcnJvciB0aGF0J2xsIGJlIHJlbmRlcmVkIGluIGFuIGVycm9yRWxlbWVudCwgd2UgZmFsbAogICAgICAgICAgICAgICAgICAgICAgLy8gYmFjayB0byBQVVNIIHNvIHRoYXQgdGhlIHVzZXIgY2FuIHVzZSB0aGUgYmFjayBidXR0b24gdG8gZ2V0IGJhY2sgdG8KICAgICAgICAgICAgICAgICAgICAgIC8vIHRoZSBwcmUtc3VibWlzc2lvbiBmb3JtIGxvY2F0aW9uIHRvIHRyeSBhZ2FpbgogICAgICAgICAgICAgICAgICAgICAgaWYgKChvcHRzICYmIG9wdHMucmVwbGFjZSkgIT09IHRydWUpIHtwZW5kaW5nQWN0aW9uID0gQWN0aW9uLlB1c2g7fXJldHVybiBfY29udGV4dDUuYWJydXB0KCJyZXR1cm4iLCB7IC8vIFNlbmQgYmFjayBhbiBlbXB0eSBvYmplY3Qgd2UgY2FuIHVzZSB0byBjbGVhciBvdXQgYW55IHByaW9yIGFjdGlvbkRhdGEKICAgICAgICAgICAgICAgICAgICAgICAgcGVuZGluZ0FjdGlvbkRhdGE6IHt9LCBwZW5kaW5nQWN0aW9uRXJyb3I6IF9kZWZpbmVQcm9wZXJ0eTIoe30sIGJvdW5kYXJ5TWF0Y2gucm91dGUuaWQsIHJlc3VsdC5lcnJvcikgfSk7Y2FzZSAyMjppZiAoIWlzRGVmZXJyZWRSZXN1bHQocmVzdWx0KSkge19jb250ZXh0NS5uZXh0ID0gMjQ7YnJlYWs7fXRocm93IGdldEludGVybmFsUm91dGVyRXJyb3IoNDAwLCB7IHR5cGU6ICJkZWZlci1hY3Rpb24iIH0pO2Nhc2UgMjQ6cmV0dXJuIF9jb250ZXh0NS5hYnJ1cHQoInJldHVybiIsIHsgcGVuZGluZ0FjdGlvbkRhdGE6IF9kZWZpbmVQcm9wZXJ0eTIoe30sIGFjdGlvbk1hdGNoLnJvdXRlLmlkLCByZXN1bHQuZGF0YSkgfSk7Y2FzZSAyNTpjYXNlICJlbmQiOnJldHVybiBfY29udGV4dDUuc3RvcCgpO319LCBfY2FsbGVlNSk7fSkpO3JldHVybiBfaGFuZGxlQWN0aW9uLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7fWZ1bmN0aW9uIGhhbmRsZUxvYWRlcnMoX3gxNCwgX3gxNSwgX3gxNiwgX3gxNywgX3gxOCwgX3gxOSwgX3gyMCwgX3gyMSkge3JldHVybiBfaGFuZGxlTG9hZGVycy5hcHBseSh0aGlzLCBhcmd1bWVudHMpO31mdW5jdGlvbiBfaGFuZGxlTG9hZGVycygpIHtfaGFuZGxlTG9hZGVycyA9IF9hc3luY1RvR2VuZXJhdG9yMiggLyojX19QVVJFX18qL19yZWdlbmVyYXRvclJ1bnRpbWUyKCkubWFyayhmdW5jdGlvbiBfY2FsbGVlNihyZXF1ZXN0LCBsb2NhdGlvbiwgbWF0Y2hlcywgb3ZlcnJpZGVOYXZpZ2F0aW9uLCBzdWJtaXNzaW9uLCByZXBsYWNlLCBwZW5kaW5nQWN0aW9uRGF0YSwgcGVuZGluZ0Vycm9yKSB7dmFyIGxvYWRpbmdOYXZpZ2F0aW9uLCBuYXZpZ2F0aW9uLCBhY3RpdmVTdWJtaXNzaW9uLCBfZ2V0TWF0Y2hlc1RvTG9hZCwgX2dldE1hdGNoZXNUb0xvYWQyLCBtYXRjaGVzVG9Mb2FkLCByZXZhbGlkYXRpbmdGZXRjaGVycywgYWN0aW9uRGF0YSwgX3lpZWxkJGNhbGxMb2FkZXJzQW5kLCByZXN1bHRzLCBsb2FkZXJSZXN1bHRzLCBmZXRjaGVyUmVzdWx0cywgcmVkaXJlY3QsIF9wcm9jZXNzTG9hZGVyRGF0YSwgbG9hZGVyRGF0YSwgZXJyb3JzLCBkaWRBYm9ydEZldGNoTG9hZHM7cmV0dXJuIF9yZWdlbmVyYXRvclJ1bnRpbWUyKCkud3JhcChmdW5jdGlvbiBfY2FsbGVlNiQoX2NvbnRleHQ2KSB7d2hpbGUgKDEpIHN3aXRjaCAoX2NvbnRleHQ2LnByZXYgPSBfY29udGV4dDYubmV4dCkge2Nhc2UgMDogLy8gRmlndXJlIG91dCB0aGUgcmlnaHQgbmF2aWdhdGlvbiB3ZSB3YW50IHRvIHVzZSBmb3IgZGF0YSBsb2FkaW5nCiAgICAgICAgICAgICAgICAgICAgICBsb2FkaW5nTmF2aWdhdGlvbiA9IG92ZXJyaWRlTmF2aWdhdGlvbjtpZiAoIWxvYWRpbmdOYXZpZ2F0aW9uKSB7bmF2aWdhdGlvbiA9IF9leHRlbmRzKHsgc3RhdGU6ICJsb2FkaW5nIiwgbG9jYXRpb246IGxvY2F0aW9uLCBmb3JtTWV0aG9kOiB1bmRlZmluZWQsIGZvcm1BY3Rpb246IHVuZGVmaW5lZCwgZm9ybUVuY1R5cGU6IHVuZGVmaW5lZCwgZm9ybURhdGE6IHVuZGVmaW5lZAogICAgICAgICAgICAgICAgICAgICAgICB9LCBzdWJtaXNzaW9uKTsKCiAgICAgICAgICAgICAgICAgICAgICAgIGxvYWRpbmdOYXZpZ2F0aW9uID0gbmF2aWdhdGlvbjsKICAgICAgICAgICAgICAgICAgICAgIH0gLy8gSWYgdGhpcyB3YXMgYSByZWRpcmVjdCBmcm9tIGFuIGFjdGlvbiB3ZSBkb24ndCBoYXZlIGEgInN1Ym1pc3Npb24iIGJ1dAogICAgICAgICAgICAgICAgICAgICAgLy8gd2UgaGF2ZSBpdCBvbiB0aGUgbG9hZGluZyBuYXZpZ2F0aW9uIHNvIHVzZSB0aGF0IGlmIGF2YWlsYWJsZQoKCiAgICAgICAgICAgICAgICAgICAgICBhY3RpdmVTdWJtaXNzaW9uID0gc3VibWlzc2lvbiA/IHN1Ym1pc3Npb24gOiBsb2FkaW5nTmF2aWdhdGlvbi5mb3JtTWV0aG9kICYmIGxvYWRpbmdOYXZpZ2F0aW9uLmZvcm1BY3Rpb24gJiYgbG9hZGluZ05hdmlnYXRpb24uZm9ybURhdGEgJiYgbG9hZGluZ05hdmlnYXRpb24uZm9ybUVuY1R5cGUgPyB7CiAgICAgICAgICAgICAgICAgICAgICAgIGZvcm1NZXRob2Q6IGxvYWRpbmdOYXZpZ2F0aW9uLmZvcm1NZXRob2QsCiAgICAgICAgICAgICAgICAgICAgICAgIGZvcm1BY3Rpb246IGxvYWRpbmdOYXZpZ2F0aW9uLmZvcm1BY3Rpb24sCiAgICAgICAgICAgICAgICAgICAgICAgIGZvcm1EYXRhOiBsb2FkaW5nTmF2aWdhdGlvbi5mb3JtRGF0YSwKICAgICAgICAgICAgICAgICAgICAgICAgZm9ybUVuY1R5cGU6IGxvYWRpbmdOYXZpZ2F0aW9uLmZvcm1FbmNUeXBlCiAgICAgICAgICAgICAgICAgICAgICB9IDogdW5kZWZpbmVkO19nZXRNYXRjaGVzVG9Mb2FkID0KICAgICAgICAgICAgICAgICAgICAgIGdldE1hdGNoZXNUb0xvYWQoaW5pdC5oaXN0b3J5LCBzdGF0ZSwgbWF0Y2hlcywgYWN0aXZlU3VibWlzc2lvbiwgbG9jYXRpb24sIGlzUmV2YWxpZGF0aW9uUmVxdWlyZWQsIGNhbmNlbGxlZERlZmVycmVkUm91dGVzLCBjYW5jZWxsZWRGZXRjaGVyTG9hZHMsIHBlbmRpbmdBY3Rpb25EYXRhLCBwZW5kaW5nRXJyb3IsIGZldGNoTG9hZE1hdGNoZXMpLCBfZ2V0TWF0Y2hlc1RvTG9hZDIgPSBfc2xpY2VkVG9BcnJheTIoX2dldE1hdGNoZXNUb0xvYWQsIDIpLCBtYXRjaGVzVG9Mb2FkID0gX2dldE1hdGNoZXNUb0xvYWQyWzBdLCByZXZhbGlkYXRpbmdGZXRjaGVycyA9IF9nZXRNYXRjaGVzVG9Mb2FkMlsxXTsgLy8gQ2FuY2VsIHBlbmRpbmcgZGVmZXJyZWRzIGZvciBuby1sb25nZXItbWF0Y2hlZCByb3V0ZXMgb3Igcm91dGVzIHdlJ3JlCiAgICAgICAgICAgICAgICAgICAgICAvLyBhYm91dCB0byByZWxvYWQuICBOb3RlIHRoYXQgaWYgdGhpcyBpcyBhbiBhY3Rpb24gcmVsb2FkIHdlIHdvdWxkIGhhdmUKICAgICAgICAgICAgICAgICAgICAgIC8vIGFscmVhZHkgY2FuY2VsbGVkIGFsbCBwZW5kaW5nIGRlZmVycmVkcyBzbyB0aGlzIHdvdWxkIGJlIGEgbm8tb3AKCiAgICAgICAgICAgICAgICAgICAgICBjYW5jZWxBY3RpdmVEZWZlcnJlZHMoKHJvdXRlSWQpID0+ICEobWF0Y2hlcyAmJiBtYXRjaGVzLnNvbWUoKG0pID0+IG0ucm91dGUuaWQgPT09IHJvdXRlSWQpKSB8fCBtYXRjaGVzVG9Mb2FkICYmIG1hdGNoZXNUb0xvYWQuc29tZSgobSkgPT4gbS5yb3V0ZS5pZCA9PT0gcm91dGVJZCkpOyAvLyBTaG9ydCBjaXJjdWl0IGlmIHdlIGhhdmUgbm8gbG9hZGVycyB0byBydW4KICAgICAgICAgICAgICAgICAgICAgIGlmICghKAogICAgICAgICAgICAgICAgICAgICAgbWF0Y2hlc1RvTG9hZC5sZW5ndGggPT09IDAgJiYgcmV2YWxpZGF0aW5nRmV0Y2hlcnMubGVuZ3RoID09PSAwKSkge19jb250ZXh0Ni5uZXh0ID0gODticmVhazt9CiAgICAgICAgICAgICAgICAgICAgICBjb21wbGV0ZU5hdmlnYXRpb24obG9jYXRpb24sIF9leHRlbmRzKHsKICAgICAgICAgICAgICAgICAgICAgICAgbWF0Y2hlczogbWF0Y2hlcywKICAgICAgICAgICAgICAgICAgICAgICAgbG9hZGVyRGF0YToge30sCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIENvbW1pdCBwZW5kaW5nIGVycm9yIGlmIHdlJ3JlIHNob3J0IGNpcmN1aXRpbmcKICAgICAgICAgICAgICAgICAgICAgICAgZXJyb3JzOiBwZW5kaW5nRXJyb3IgfHwgbnVsbAogICAgICAgICAgICAgICAgICAgICAgfSwgcGVuZGluZ0FjdGlvbkRhdGEgPyB7CiAgICAgICAgICAgICAgICAgICAgICAgIGFjdGlvbkRhdGE6IHBlbmRpbmdBY3Rpb25EYXRhCiAgICAgICAgICAgICAgICAgICAgICB9IDoge30pKTtyZXR1cm4gX2NvbnRleHQ2LmFicnVwdCgicmV0dXJuIiwKICAgICAgICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgICAgICAgc2hvcnRDaXJjdWl0ZWQ6IHRydWUKICAgICAgICAgICAgICAgICAgICAgIH0pO2Nhc2UgODoKICAgICAgICAgICAgICAgICAgICAgIC8vIElmIHRoaXMgaXMgYW4gdW5pbnRlcnJ1cHRlZCByZXZhbGlkYXRpb24sIHdlIHJlbWFpbiBpbiBvdXIgY3VycmVudCBpZGxlCiAgICAgICAgICAgICAgICAgICAgICAvLyBzdGF0ZS4gIElmIG5vdCwgd2UgbmVlZCB0byBzd2l0Y2ggdG8gb3VyIGxvYWRpbmcgc3RhdGUgYW5kIGxvYWQgZGF0YSwKICAgICAgICAgICAgICAgICAgICAgIC8vIHByZXNlcnZpbmcgYW55IG5ldyBhY3Rpb24gZGF0YSBvciBleGlzdGluZyBhY3Rpb24gZGF0YSAoaW4gdGhlIGNhc2Ugb2YKICAgICAgICAgICAgICAgICAgICAgIC8vIGEgcmV2YWxpZGF0aW9uIGludGVycnVwdGluZyBhbiBhY3Rpb25SZWxvYWQpCgoKICAgICAgICAgICAgICAgICAgICAgIGlmICghaXNVbmludGVycnVwdGVkUmV2YWxpZGF0aW9uKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldmFsaWRhdGluZ0ZldGNoZXJzLmZvckVhY2goKHJmKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGZldGNoZXIgPSBzdGF0ZS5mZXRjaGVycy5nZXQocmYua2V5KTsKICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgcmV2YWxpZGF0aW5nRmV0Y2hlciA9IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YXRlOiAibG9hZGluZyIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhOiBmZXRjaGVyICYmIGZldGNoZXIuZGF0YSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvcm1NZXRob2Q6IHVuZGVmaW5lZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvcm1BY3Rpb246IHVuZGVmaW5lZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvcm1FbmNUeXBlOiB1bmRlZmluZWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3JtRGF0YTogdW5kZWZpbmVkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgIiBfaGFzRmV0Y2hlckRvbmVBbnl0aGluZyAiOiB0cnVlCiAgICAgICAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgICAgICAgICAgICBzdGF0ZS5mZXRjaGVycy5zZXQocmYua2V5LCByZXZhbGlkYXRpbmdGZXRjaGVyKTsKICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGFjdGlvbkRhdGEgPSBwZW5kaW5nQWN0aW9uRGF0YSB8fCBzdGF0ZS5hY3Rpb25EYXRhOwogICAgICAgICAgICAgICAgICAgICAgICB1cGRhdGVTdGF0ZShfZXh0ZW5kcyh7CiAgICAgICAgICAgICAgICAgICAgICAgICAgbmF2aWdhdGlvbjogbG9hZGluZ05hdmlnYXRpb24KICAgICAgICAgICAgICAgICAgICAgICAgfSwgYWN0aW9uRGF0YSA/IE9iamVjdC5rZXlzKGFjdGlvbkRhdGEpLmxlbmd0aCA9PT0gMCA/IHsKICAgICAgICAgICAgICAgICAgICAgICAgICBhY3Rpb25EYXRhOiBudWxsCiAgICAgICAgICAgICAgICAgICAgICAgIH0gOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgYWN0aW9uRGF0YTogYWN0aW9uRGF0YQogICAgICAgICAgICAgICAgICAgICAgICB9IDoge30sIHJldmFsaWRhdGluZ0ZldGNoZXJzLmxlbmd0aCA+IDAgPyB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgZmV0Y2hlcnM6IG5ldyBNYXAoc3RhdGUuZmV0Y2hlcnMpCiAgICAgICAgICAgICAgICAgICAgICAgIH0gOiB7fSkpOwogICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgIHBlbmRpbmdOYXZpZ2F0aW9uTG9hZElkID0gKytpbmNyZW1lbnRpbmdMb2FkSWQ7CiAgICAgICAgICAgICAgICAgICAgICByZXZhbGlkYXRpbmdGZXRjaGVycy5mb3JFYWNoKChyZikgPT4gZmV0Y2hDb250cm9sbGVycy5zZXQocmYua2V5LCBwZW5kaW5nTmF2aWdhdGlvbkNvbnRyb2xsZXIpKTtfY29udGV4dDYubmV4dCA9IDEzO3JldHVybiAoCgoKCgogICAgICAgICAgICAgICAgICAgICAgICBjYWxsTG9hZGVyc0FuZE1heWJlUmVzb2x2ZURhdGEoc3RhdGUubWF0Y2hlcywgbWF0Y2hlcywgbWF0Y2hlc1RvTG9hZCwgcmV2YWxpZGF0aW5nRmV0Y2hlcnMsIHJlcXVlc3QpKTtjYXNlIDEzOl95aWVsZCRjYWxsTG9hZGVyc0FuZCA9IF9jb250ZXh0Ni5zZW50O3Jlc3VsdHMgPSBfeWllbGQkY2FsbExvYWRlcnNBbmQucmVzdWx0cztsb2FkZXJSZXN1bHRzID0gX3lpZWxkJGNhbGxMb2FkZXJzQW5kLmxvYWRlclJlc3VsdHM7ZmV0Y2hlclJlc3VsdHMgPSBfeWllbGQkY2FsbExvYWRlcnNBbmQuZmV0Y2hlclJlc3VsdHM7aWYgKCEKCiAgICAgICAgICAgICAgICAgICAgICByZXF1ZXN0LnNpZ25hbC5hYm9ydGVkKSB7X2NvbnRleHQ2Lm5leHQgPSAxOTticmVhazt9cmV0dXJuIF9jb250ZXh0Ni5hYnJ1cHQoInJldHVybiIsCiAgICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgIHNob3J0Q2lyY3VpdGVkOiB0cnVlCiAgICAgICAgICAgICAgICAgICAgICB9KTtjYXNlIDE5OgogICAgICAgICAgICAgICAgICAgICAgLy8gQ2xlYW4gdXAgX2FmdGVyXyBsb2FkZXJzIGhhdmUgY29tcGxldGVkLiAgRG9uJ3QgY2xlYW4gdXAgaWYgd2Ugc2hvcnQKICAgICAgICAgICAgICAgICAgICAgIC8vIGNpcmN1aXRlZCBiZWNhdXNlIGZldGNoQ29udHJvbGxlcnMgd291bGQgaGF2ZSBiZWVuIGFib3J0ZWQgYW5kCiAgICAgICAgICAgICAgICAgICAgICAvLyByZWFzc2lnbmVkIHRvIG5ldyBjb250cm9sbGVycyBmb3IgdGhlIG5leHQgbmF2aWdhdGlvbgoKCiAgICAgICAgICAgICAgICAgICAgICByZXZhbGlkYXRpbmdGZXRjaGVycy5mb3JFYWNoKChyZikgPT4gZmV0Y2hDb250cm9sbGVycy5kZWxldGUocmYua2V5KSk7IC8vIElmIGFueSBsb2FkZXJzIHJldHVybmVkIGEgcmVkaXJlY3QgUmVzcG9uc2UsIHN0YXJ0IGEgbmV3IFJFUExBQ0UgbmF2aWdhdGlvbgoKICAgICAgICAgICAgICAgICAgICAgIHJlZGlyZWN0ID0gZmluZFJlZGlyZWN0KHJlc3VsdHMpO2lmICghCgogICAgICAgICAgICAgICAgICAgICAgcmVkaXJlY3QpIHtfY29udGV4dDYubmV4dCA9IDI1O2JyZWFrO31fY29udGV4dDYubmV4dCA9IDI0O3JldHVybiAoCiAgICAgICAgICAgICAgICAgICAgICAgIHN0YXJ0UmVkaXJlY3ROYXZpZ2F0aW9uKHN0YXRlLCByZWRpcmVjdCwgewogICAgICAgICAgICAgICAgICAgICAgICAgIHJlcGxhY2U6IHJlcGxhY2UKICAgICAgICAgICAgICAgICAgICAgICAgfSkpO2Nhc2UgMjQ6cmV0dXJuIF9jb250ZXh0Ni5hYnJ1cHQoInJldHVybiIsCiAgICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgIHNob3J0Q2lyY3VpdGVkOiB0cnVlCiAgICAgICAgICAgICAgICAgICAgICB9KTtjYXNlIDI1OgogICAgICAgICAgICAgICAgICAgICAgLy8gUHJvY2VzcyBhbmQgY29tbWl0IG91dHB1dCBmcm9tIGxvYWRlcnMKICAgICAgICAgICAgICAgICAgICAgIF9wcm9jZXNzTG9hZGVyRGF0YSA9CgoKCgogICAgICAgICAgICAgICAgICAgICAgcHJvY2Vzc0xvYWRlckRhdGEoc3RhdGUsIG1hdGNoZXMsIG1hdGNoZXNUb0xvYWQsIGxvYWRlclJlc3VsdHMsIHBlbmRpbmdFcnJvciwgcmV2YWxpZGF0aW5nRmV0Y2hlcnMsIGZldGNoZXJSZXN1bHRzLCBhY3RpdmVEZWZlcnJlZHMpLCBsb2FkZXJEYXRhID0gX3Byb2Nlc3NMb2FkZXJEYXRhLmxvYWRlckRhdGEsIGVycm9ycyA9IF9wcm9jZXNzTG9hZGVyRGF0YS5lcnJvcnM7IC8vIFdpcmUgdXAgc3Vic2NyaWJlcnMgdG8gdXBkYXRlIGxvYWRlckRhdGEgYXMgcHJvbWlzZXMgc2V0dGxlCgogICAgICAgICAgICAgICAgICAgICAgYWN0aXZlRGVmZXJyZWRzLmZvckVhY2goKGRlZmVycmVkRGF0YSwgcm91dGVJZCkgPT4gewogICAgICAgICAgICAgICAgICAgICAgICBkZWZlcnJlZERhdGEuc3Vic2NyaWJlKChhYm9ydGVkKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gTm90ZTogTm8gbmVlZCB0byB1cGRhdGVTdGF0ZSBoZXJlIHNpbmNlIHRoZSBUcmFja2VkUHJvbWlzZSBvbgogICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGxvYWRlckRhdGEgaXMgc3RhYmxlIGFjcm9zcyByZXNvbHZlL3JlamVjdAogICAgICAgICAgICAgICAgICAgICAgICAgIC8vIFJlbW92ZSB0aGlzIGluc3RhbmNlIGlmIHdlIHdlcmUgYWJvcnRlZCBvciBpZiBwcm9taXNlcyBoYXZlIHNldHRsZWQKICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoYWJvcnRlZCB8fCBkZWZlcnJlZERhdGEuZG9uZSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgYWN0aXZlRGVmZXJyZWRzLmRlbGV0ZShyb3V0ZUlkKTsKICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICBtYXJrRmV0Y2hSZWRpcmVjdHNEb25lKCk7CiAgICAgICAgICAgICAgICAgICAgICBkaWRBYm9ydEZldGNoTG9hZHMgPSBhYm9ydFN0YWxlRmV0Y2hMb2FkcyhwZW5kaW5nTmF2aWdhdGlvbkxvYWRJZCk7cmV0dXJuIF9jb250ZXh0Ni5hYnJ1cHQoInJldHVybiIsCiAgICAgICAgICAgICAgICAgICAgICBfZXh0ZW5kcyh7CiAgICAgICAgICAgICAgICAgICAgICAgIGxvYWRlckRhdGE6IGxvYWRlckRhdGEsCiAgICAgICAgICAgICAgICAgICAgICAgIGVycm9yczogZXJyb3JzCiAgICAgICAgICAgICAgICAgICAgICB9LCBkaWRBYm9ydEZldGNoTG9hZHMgfHwgcmV2YWxpZGF0aW5nRmV0Y2hlcnMubGVuZ3RoID4gMCA/IHsKICAgICAgICAgICAgICAgICAgICAgICAgZmV0Y2hlcnM6IG5ldyBNYXAoc3RhdGUuZmV0Y2hlcnMpCiAgICAgICAgICAgICAgICAgICAgICB9IDoge30pKTtjYXNlIDMwOmNhc2UgImVuZCI6cmV0dXJuIF9jb250ZXh0Ni5zdG9wKCk7fX0sIF9jYWxsZWU2KTt9KSk7cmV0dXJuIF9oYW5kbGVMb2FkZXJzLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7fQoKCiAgICAgICAgICAgIGZ1bmN0aW9uIGdldEZldGNoZXIoa2V5KSB7CiAgICAgICAgICAgICAgcmV0dXJuIHN0YXRlLmZldGNoZXJzLmdldChrZXkpIHx8IElETEVfRkVUQ0hFUjsKICAgICAgICAgICAgfSAvLyBUcmlnZ2VyIGEgZmV0Y2hlciBsb2FkL3N1Ym1pdCBmb3IgdGhlIGdpdmVuIGZldGNoZXIga2V5CgoKICAgICAgICAgICAgZnVuY3Rpb24gZmV0Y2goa2V5LCByb3V0ZUlkLCBocmVmLCBvcHRzKSB7CiAgICAgICAgICAgICAgaWYgKGlzU2VydmVyKSB7CiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoInJvdXRlci5mZXRjaCgpIHdhcyBjYWxsZWQgZHVyaW5nIHRoZSBzZXJ2ZXIgcmVuZGVyLCBidXQgaXQgc2hvdWxkbid0IGJlLiAiICsgIllvdSBhcmUgbGlrZWx5IGNhbGxpbmcgYSB1c2VGZXRjaGVyKCkgbWV0aG9kIGluIHRoZSBib2R5IG9mIHlvdXIgY29tcG9uZW50LiAiICsgIlRyeSBtb3ZpbmcgaXQgdG8gYSB1c2VFZmZlY3Qgb3IgYSBjYWxsYmFjay4iKTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIGlmIChmZXRjaENvbnRyb2xsZXJzLmhhcyhrZXkpKSBhYm9ydEZldGNoZXIoa2V5KTsKICAgICAgICAgICAgICB2YXIgbWF0Y2hlcyA9IG1hdGNoUm91dGVzKGRhdGFSb3V0ZXMsIGhyZWYsIGluaXQuYmFzZW5hbWUpOwoKICAgICAgICAgICAgICBpZiAoIW1hdGNoZXMpIHsKICAgICAgICAgICAgICAgIHNldEZldGNoZXJFcnJvcihrZXksIHJvdXRlSWQsIGdldEludGVybmFsUm91dGVyRXJyb3IoNDA0LCB7CiAgICAgICAgICAgICAgICAgIHBhdGhuYW1lOiBocmVmCiAgICAgICAgICAgICAgICB9KSk7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICB2YXIgX25vcm1hbGl6ZU5hdmlnYXRlT3B0ID0KCgogICAgICAgICAgICAgICAgbm9ybWFsaXplTmF2aWdhdGVPcHRpb25zKGhyZWYsIG9wdHMsIHRydWUpLHBhdGggPSBfbm9ybWFsaXplTmF2aWdhdGVPcHQucGF0aCxzdWJtaXNzaW9uID0gX25vcm1hbGl6ZU5hdmlnYXRlT3B0LnN1Ym1pc3Npb247CiAgICAgICAgICAgICAgdmFyIG1hdGNoID0gZ2V0VGFyZ2V0TWF0Y2gobWF0Y2hlcywgcGF0aCk7CiAgICAgICAgICAgICAgcGVuZGluZ1ByZXZlbnRTY3JvbGxSZXNldCA9IChvcHRzICYmIG9wdHMucHJldmVudFNjcm9sbFJlc2V0KSA9PT0gdHJ1ZTsKCiAgICAgICAgICAgICAgaWYgKHN1Ym1pc3Npb24gJiYgaXNNdXRhdGlvbk1ldGhvZChzdWJtaXNzaW9uLmZvcm1NZXRob2QpKSB7CiAgICAgICAgICAgICAgICBoYW5kbGVGZXRjaGVyQWN0aW9uKGtleSwgcm91dGVJZCwgcGF0aCwgbWF0Y2gsIG1hdGNoZXMsIHN1Ym1pc3Npb24pOwogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgIH0gLy8gU3RvcmUgb2ZmIHRoZSBtYXRjaCBzbyB3ZSBjYW4gY2FsbCBpdCdzIHNob3VsZFJldmFsaWRhdGUgb24gc3Vic2VxdWVudAogICAgICAgICAgICAgIC8vIHJldmFsaWRhdGlvbnMKCgogICAgICAgICAgICAgIGZldGNoTG9hZE1hdGNoZXMuc2V0KGtleSwgewogICAgICAgICAgICAgICAgcm91dGVJZDogcm91dGVJZCwKICAgICAgICAgICAgICAgIHBhdGg6IHBhdGgsCiAgICAgICAgICAgICAgICBtYXRjaDogbWF0Y2gsCiAgICAgICAgICAgICAgICBtYXRjaGVzOiBtYXRjaGVzCiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgaGFuZGxlRmV0Y2hlckxvYWRlcihrZXksIHJvdXRlSWQsIHBhdGgsIG1hdGNoLCBtYXRjaGVzLCBzdWJtaXNzaW9uKTsKICAgICAgICAgICAgfSAvLyBDYWxsIHRoZSBhY3Rpb24gZm9yIHRoZSBtYXRjaGVkIGZldGNoZXIuc3VibWl0KCksIGFuZCB0aGVuIGhhbmRsZSByZWRpcmVjdHMsCiAgICAgICAgICAgIC8vIGVycm9ycywgYW5kIHJldmFsaWRhdGlvbgogICAgICAgICAgICBmdW5jdGlvbgoKICAgICAgICAgICAgaGFuZGxlRmV0Y2hlckFjdGlvbihfeDIyLCBfeDIzLCBfeDI0LCBfeDI1LCBfeDI2LCBfeDI3KSB7cmV0dXJuIF9oYW5kbGVGZXRjaGVyQWN0aW9uLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7fQoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCiAgICAgICAgICAgIC8vIENhbGwgdGhlIG1hdGNoZWQgbG9hZGVyIGZvciBmZXRjaGVyLmxvYWQoKSwgaGFuZGxpbmcgcmVkaXJlY3RzLCBlcnJvcnMsIGV0Yy4KICAgICAgICAgICAgZnVuY3Rpb24gX2hhbmRsZUZldGNoZXJBY3Rpb24oKSB7X2hhbmRsZUZldGNoZXJBY3Rpb24gPSBfYXN5bmNUb0dlbmVyYXRvcjIoIC8qI19fUFVSRV9fKi9fcmVnZW5lcmF0b3JSdW50aW1lMigpLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTcoa2V5LCByb3V0ZUlkLCBwYXRoLCBtYXRjaCwgcmVxdWVzdE1hdGNoZXMsIHN1Ym1pc3Npb24pIHt2YXIgX2Vycm9yMiwgZXhpc3RpbmdGZXRjaGVyLCBmZXRjaGVyLCBhYm9ydENvbnRyb2xsZXIsIGZldGNoUmVxdWVzdCwgYWN0aW9uUmVzdWx0LCBsb2FkaW5nRmV0Y2hlciwgbmV4dExvY2F0aW9uLCByZXZhbGlkYXRpb25SZXF1ZXN0LCBtYXRjaGVzLCBsb2FkSWQsIGxvYWRGZXRjaGVyLCBfZ2V0TWF0Y2hlc1RvTG9hZDMsIF9nZXRNYXRjaGVzVG9Mb2FkNCwgbWF0Y2hlc1RvTG9hZCwgcmV2YWxpZGF0aW5nRmV0Y2hlcnMsIF95aWVsZCRjYWxsTG9hZGVyc0FuZDIsIHJlc3VsdHMsIGxvYWRlclJlc3VsdHMsIGZldGNoZXJSZXN1bHRzLCByZWRpcmVjdCwgX3Byb2Nlc3NMb2FkZXJEYXRhMiwgbG9hZGVyRGF0YSwgZXJyb3JzLCBkb25lRmV0Y2hlciwgZGlkQWJvcnRGZXRjaExvYWRzO3JldHVybiBfcmVnZW5lcmF0b3JSdW50aW1lMigpLndyYXAoZnVuY3Rpb24gX2NhbGxlZTckKF9jb250ZXh0Nykge3doaWxlICgxKSBzd2l0Y2ggKF9jb250ZXh0Ny5wcmV2ID0gX2NvbnRleHQ3Lm5leHQpIHtjYXNlIDA6aW50ZXJydXB0QWN0aXZlTG9hZHMoKTtmZXRjaExvYWRNYXRjaGVzLmRlbGV0ZShrZXkpO2lmIChtYXRjaC5yb3V0ZS5hY3Rpb24pIHtfY29udGV4dDcubmV4dCA9IDY7YnJlYWs7fV9lcnJvcjIgPSBnZXRJbnRlcm5hbFJvdXRlckVycm9yKDQwNSwgeyBtZXRob2Q6IHN1Ym1pc3Npb24uZm9ybU1ldGhvZCwgcGF0aG5hbWU6IHBhdGgsIHJvdXRlSWQ6IHJvdXRlSWQgfSk7c2V0RmV0Y2hlckVycm9yKGtleSwgcm91dGVJZCwgX2Vycm9yMik7cmV0dXJuIF9jb250ZXh0Ny5hYnJ1cHQoInJldHVybiIpO2Nhc2UgNjogLy8gUHV0IHRoaXMgZmV0Y2hlciBpbnRvIGl0J3Mgc3VibWl0dGluZyBzdGF0ZQogICAgICAgICAgICAgICAgICAgICAgZXhpc3RpbmdGZXRjaGVyID0gc3RhdGUuZmV0Y2hlcnMuZ2V0KGtleSk7ZmV0Y2hlciA9IF9leHRlbmRzKHsgc3RhdGU6ICJzdWJtaXR0aW5nIiB9LCBzdWJtaXNzaW9uLCB7IGRhdGE6IGV4aXN0aW5nRmV0Y2hlciAmJiBleGlzdGluZ0ZldGNoZXIuZGF0YSwgIiBfaGFzRmV0Y2hlckRvbmVBbnl0aGluZyAiOiB0cnVlIH0pO3N0YXRlLmZldGNoZXJzLnNldChrZXksIGZldGNoZXIpO3VwZGF0ZVN0YXRlKHsgZmV0Y2hlcnM6IG5ldyBNYXAoc3RhdGUuZmV0Y2hlcnMpIH0pOyAvLyBDYWxsIHRoZSBhY3Rpb24gZm9yIHRoZSBmZXRjaGVyCiAgICAgICAgICAgICAgICAgICAgICBhYm9ydENvbnRyb2xsZXIgPSBuZXcgQWJvcnRDb250cm9sbGVyKCk7ZmV0Y2hSZXF1ZXN0ID0gY3JlYXRlQ2xpZW50U2lkZVJlcXVlc3QoaW5pdC5oaXN0b3J5LCBwYXRoLCBhYm9ydENvbnRyb2xsZXIuc2lnbmFsLCBzdWJtaXNzaW9uKTtmZXRjaENvbnRyb2xsZXJzLnNldChrZXksIGFib3J0Q29udHJvbGxlcik7X2NvbnRleHQ3Lm5leHQgPSAxNTtyZXR1cm4gY2FsbExvYWRlck9yQWN0aW9uKCJhY3Rpb24iLCBmZXRjaFJlcXVlc3QsIG1hdGNoLCByZXF1ZXN0TWF0Y2hlcywgcm91dGVyLmJhc2VuYW1lKTtjYXNlIDE1OmFjdGlvblJlc3VsdCA9IF9jb250ZXh0Ny5zZW50O2lmICghZmV0Y2hSZXF1ZXN0LnNpZ25hbC5hYm9ydGVkKSB7X2NvbnRleHQ3Lm5leHQgPSAxOTticmVhazt9IC8vIFdlIGNhbiBkZWxldGUgdGhpcyBzbyBsb25nIGFzIHdlIHdlcmVuJ3QgYWJvcnRlZCBieSBvdSBvdXIgb3duIGZldGNoZXIKICAgICAgICAgICAgICAgICAgICAgIC8vIHJlLXN1Ym1pdCB3aGljaCB3b3VsZCBoYXZlIHB1dCBfbmV3XyBjb250cm9sbGVyIGlzIGluIGZldGNoQ29udHJvbGxlcnMKICAgICAgICAgICAgICAgICAgICAgIGlmIChmZXRjaENvbnRyb2xsZXJzLmdldChrZXkpID09PSBhYm9ydENvbnRyb2xsZXIpIHtmZXRjaENvbnRyb2xsZXJzLmRlbGV0ZShrZXkpO31yZXR1cm4gX2NvbnRleHQ3LmFicnVwdCgicmV0dXJuIik7Y2FzZSAxOTppZiAoIWlzUmVkaXJlY3RSZXN1bHQoYWN0aW9uUmVzdWx0KSkge19jb250ZXh0Ny5uZXh0ID0gMjY7YnJlYWs7fWZldGNoQ29udHJvbGxlcnMuZGVsZXRlKGtleSk7ZmV0Y2hSZWRpcmVjdElkcy5hZGQoa2V5KTtsb2FkaW5nRmV0Y2hlciA9IF9leHRlbmRzKHsgc3RhdGU6ICJsb2FkaW5nIiB9LCBzdWJtaXNzaW9uLCB7IGRhdGE6IHVuZGVmaW5lZCwgIiBfaGFzRmV0Y2hlckRvbmVBbnl0aGluZyAiOiB0cnVlIH0pO3N0YXRlLmZldGNoZXJzLnNldChrZXksIGxvYWRpbmdGZXRjaGVyKTt1cGRhdGVTdGF0ZSh7IGZldGNoZXJzOiBuZXcgTWFwKHN0YXRlLmZldGNoZXJzKSB9KTtyZXR1cm4gX2NvbnRleHQ3LmFicnVwdCgicmV0dXJuIiwgc3RhcnRSZWRpcmVjdE5hdmlnYXRpb24oc3RhdGUsIGFjdGlvblJlc3VsdCwgeyBpc0ZldGNoQWN0aW9uUmVkaXJlY3Q6IHRydWUgfSkpO2Nhc2UgMjY6aWYgKCFpc0Vycm9yUmVzdWx0KGFjdGlvblJlc3VsdCkpIHtfY29udGV4dDcubmV4dCA9IDI5O2JyZWFrO31zZXRGZXRjaGVyRXJyb3Ioa2V5LCByb3V0ZUlkLCBhY3Rpb25SZXN1bHQuZXJyb3IpO3JldHVybiBfY29udGV4dDcuYWJydXB0KCJyZXR1cm4iKTtjYXNlIDI5OmlmICghaXNEZWZlcnJlZFJlc3VsdChhY3Rpb25SZXN1bHQpKSB7X2NvbnRleHQ3Lm5leHQgPSAzMTticmVhazt9dGhyb3cgZ2V0SW50ZXJuYWxSb3V0ZXJFcnJvcig0MDAsIHsgdHlwZTogImRlZmVyLWFjdGlvbiIgfSk7Y2FzZSAzMTogLy8gU3RhcnQgdGhlIGRhdGEgbG9hZCBmb3IgY3VycmVudCBtYXRjaGVzLCBvciB0aGUgbmV4dCBsb2NhdGlvbiBpZiB3ZSdyZQogICAgICAgICAgICAgICAgICAgICAgLy8gaW4gdGhlIG1pZGRsZSBvZiBhIG5hdmlnYXRpb24KICAgICAgICAgICAgICAgICAgICAgIG5leHRMb2NhdGlvbiA9IHN0YXRlLm5hdmlnYXRpb24ubG9jYXRpb24gfHwgc3RhdGUubG9jYXRpb247cmV2YWxpZGF0aW9uUmVxdWVzdCA9IGNyZWF0ZUNsaWVudFNpZGVSZXF1ZXN0KGluaXQuaGlzdG9yeSwgbmV4dExvY2F0aW9uLCBhYm9ydENvbnRyb2xsZXIuc2lnbmFsKTttYXRjaGVzID0gc3RhdGUubmF2aWdhdGlvbi5zdGF0ZSAhPT0gImlkbGUiID8gbWF0Y2hSb3V0ZXMoZGF0YVJvdXRlcywgc3RhdGUubmF2aWdhdGlvbi5sb2NhdGlvbiwgaW5pdC5iYXNlbmFtZSkgOiBzdGF0ZS5tYXRjaGVzO3JvdXRlcl9pbnZhcmlhbnQobWF0Y2hlcywgIkRpZG4ndCBmaW5kIGFueSBtYXRjaGVzIGFmdGVyIGZldGNoZXIgYWN0aW9uIik7bG9hZElkID0gKytpbmNyZW1lbnRpbmdMb2FkSWQ7ZmV0Y2hSZWxvYWRJZHMuc2V0KGtleSwgbG9hZElkKTtsb2FkRmV0Y2hlciA9IF9leHRlbmRzKHsgc3RhdGU6ICJsb2FkaW5nIiwgZGF0YTogYWN0aW9uUmVzdWx0LmRhdGEgfSwgc3VibWlzc2lvbiwgeyAiIF9oYXNGZXRjaGVyRG9uZUFueXRoaW5nICI6IHRydWUgfSk7c3RhdGUuZmV0Y2hlcnMuc2V0KGtleSwgbG9hZEZldGNoZXIpO19nZXRNYXRjaGVzVG9Mb2FkMyA9IGdldE1hdGNoZXNUb0xvYWQoaW5pdC5oaXN0b3J5LCBzdGF0ZSwgbWF0Y2hlcywgc3VibWlzc2lvbiwgbmV4dExvY2F0aW9uLCBpc1JldmFsaWRhdGlvblJlcXVpcmVkLCBjYW5jZWxsZWREZWZlcnJlZFJvdXRlcywgY2FuY2VsbGVkRmV0Y2hlckxvYWRzLCBfZGVmaW5lUHJvcGVydHkyKHt9LCBtYXRjaC5yb3V0ZS5pZCwgYWN0aW9uUmVzdWx0LmRhdGEpLCB1bmRlZmluZWQsIC8vIE5vIG5lZWQgdG8gc2VuZCB0aHJvdWdoIGVycm9ycyBzaW5jZSB3ZSBzaG9ydCBjaXJjdWl0IGFib3ZlCiAgICAgICAgICAgICAgICAgICAgICBmZXRjaExvYWRNYXRjaGVzKSwgX2dldE1hdGNoZXNUb0xvYWQ0ID0gX3NsaWNlZFRvQXJyYXkyKF9nZXRNYXRjaGVzVG9Mb2FkMywgMiksIG1hdGNoZXNUb0xvYWQgPSBfZ2V0TWF0Y2hlc1RvTG9hZDRbMF0sIHJldmFsaWRhdGluZ0ZldGNoZXJzID0gX2dldE1hdGNoZXNUb0xvYWQ0WzFdOyAvLyBQdXQgYWxsIHJldmFsaWRhdGluZyBmZXRjaGVycyBpbnRvIHRoZSBsb2FkaW5nIHN0YXRlLCBleGNlcHQgZm9yIHRoZQogICAgICAgICAgICAgICAgICAgICAgLy8gY3VycmVudCBmZXRjaGVyIHdoaWNoIHdlIHdhbnQgdG8ga2VlcCBpbiBpdCdzIGN1cnJlbnQgbG9hZGluZyBzdGF0ZSB3aGljaAogICAgICAgICAgICAgICAgICAgICAgLy8gY29udGFpbnMgaXQncyBhY3Rpb24gc3VibWlzc2lvbiBpbmZvICsgYWN0aW9uIGRhdGEKICAgICAgICAgICAgICAgICAgICAgIHJldmFsaWRhdGluZ0ZldGNoZXJzLmZpbHRlcigocmYpID0+IHJmLmtleSAhPT0ga2V5KS5mb3JFYWNoKChyZikgPT4ge3ZhciBzdGFsZUtleSA9IHJmLmtleTt2YXIgZXhpc3RpbmdGZXRjaGVyID0gc3RhdGUuZmV0Y2hlcnMuZ2V0KHN0YWxlS2V5KTt2YXIgcmV2YWxpZGF0aW5nRmV0Y2hlciA9IHsgc3RhdGU6ICJsb2FkaW5nIiwgZGF0YTogZXhpc3RpbmdGZXRjaGVyICYmIGV4aXN0aW5nRmV0Y2hlci5kYXRhLCBmb3JtTWV0aG9kOiB1bmRlZmluZWQsIGZvcm1BY3Rpb246IHVuZGVmaW5lZCwgZm9ybUVuY1R5cGU6IHVuZGVmaW5lZCwgZm9ybURhdGE6IHVuZGVmaW5lZCwgIiBfaGFzRmV0Y2hlckRvbmVBbnl0aGluZyAiOiB0cnVlIH07c3RhdGUuZmV0Y2hlcnMuc2V0KHN0YWxlS2V5LCByZXZhbGlkYXRpbmdGZXRjaGVyKTtmZXRjaENvbnRyb2xsZXJzLnNldChzdGFsZUtleSwgYWJvcnRDb250cm9sbGVyKTt9KTt1cGRhdGVTdGF0ZSh7IGZldGNoZXJzOiBuZXcgTWFwKHN0YXRlLmZldGNoZXJzKSB9KTtfY29udGV4dDcubmV4dCA9IDQ0O3JldHVybiBjYWxsTG9hZGVyc0FuZE1heWJlUmVzb2x2ZURhdGEoc3RhdGUubWF0Y2hlcywgbWF0Y2hlcywgbWF0Y2hlc1RvTG9hZCwgcmV2YWxpZGF0aW5nRmV0Y2hlcnMsIHJldmFsaWRhdGlvblJlcXVlc3QpO2Nhc2UgNDQ6X3lpZWxkJGNhbGxMb2FkZXJzQW5kMiA9IF9jb250ZXh0Ny5zZW50O3Jlc3VsdHMgPSBfeWllbGQkY2FsbExvYWRlcnNBbmQyLnJlc3VsdHM7bG9hZGVyUmVzdWx0cyA9IF95aWVsZCRjYWxsTG9hZGVyc0FuZDIubG9hZGVyUmVzdWx0cztmZXRjaGVyUmVzdWx0cyA9IF95aWVsZCRjYWxsTG9hZGVyc0FuZDIuZmV0Y2hlclJlc3VsdHM7aWYgKCFhYm9ydENvbnRyb2xsZXIuc2lnbmFsLmFib3J0ZWQpIHtfY29udGV4dDcubmV4dCA9IDUwO2JyZWFrO31yZXR1cm4gX2NvbnRleHQ3LmFicnVwdCgicmV0dXJuIik7Y2FzZSA1MDpmZXRjaFJlbG9hZElkcy5kZWxldGUoa2V5KTtmZXRjaENvbnRyb2xsZXJzLmRlbGV0ZShrZXkpO3JldmFsaWRhdGluZ0ZldGNoZXJzLmZvckVhY2goKHIpID0+IGZldGNoQ29udHJvbGxlcnMuZGVsZXRlKHIua2V5KSk7cmVkaXJlY3QgPSBmaW5kUmVkaXJlY3QocmVzdWx0cyk7aWYgKCFyZWRpcmVjdCkge19jb250ZXh0Ny5uZXh0ID0gNTY7YnJlYWs7fXJldHVybiBfY29udGV4dDcuYWJydXB0KCJyZXR1cm4iLCBzdGFydFJlZGlyZWN0TmF2aWdhdGlvbihzdGF0ZSwgcmVkaXJlY3QpKTtjYXNlIDU2OiAvLyBQcm9jZXNzIGFuZCBjb21taXQgb3V0cHV0IGZyb20gbG9hZGVycwogICAgICAgICAgICAgICAgICAgICAgX3Byb2Nlc3NMb2FkZXJEYXRhMiA9IHByb2Nlc3NMb2FkZXJEYXRhKHN0YXRlLCBzdGF0ZS5tYXRjaGVzLCBtYXRjaGVzVG9Mb2FkLCBsb2FkZXJSZXN1bHRzLCB1bmRlZmluZWQsIHJldmFsaWRhdGluZ0ZldGNoZXJzLCBmZXRjaGVyUmVzdWx0cywgYWN0aXZlRGVmZXJyZWRzKSwgbG9hZGVyRGF0YSA9IF9wcm9jZXNzTG9hZGVyRGF0YTIubG9hZGVyRGF0YSwgZXJyb3JzID0gX3Byb2Nlc3NMb2FkZXJEYXRhMi5lcnJvcnM7ZG9uZUZldGNoZXIgPSB7IHN0YXRlOiAiaWRsZSIsIGRhdGE6IGFjdGlvblJlc3VsdC5kYXRhLCBmb3JtTWV0aG9kOiB1bmRlZmluZWQsIGZvcm1BY3Rpb246IHVuZGVmaW5lZCwgZm9ybUVuY1R5cGU6IHVuZGVmaW5lZCwgZm9ybURhdGE6IHVuZGVmaW5lZCwgIiBfaGFzRmV0Y2hlckRvbmVBbnl0aGluZyAiOiB0cnVlIH07c3RhdGUuZmV0Y2hlcnMuc2V0KGtleSwgZG9uZUZldGNoZXIpO2RpZEFib3J0RmV0Y2hMb2FkcyA9IGFib3J0U3RhbGVGZXRjaExvYWRzKGxvYWRJZCk7IC8vIElmIHdlIGFyZSBjdXJyZW50bHkgaW4gYSBuYXZpZ2F0aW9uIGxvYWRpbmcgc3RhdGUgYW5kIHRoaXMgZmV0Y2hlciBpcwogICAgICAgICAgICAgICAgICAgICAgLy8gbW9yZSByZWNlbnQgdGhhbiB0aGUgbmF2aWdhdGlvbiwgd2Ugd2FudCB0aGUgbmV3ZXIgZGF0YSBzbyBhYm9ydCB0aGUKICAgICAgICAgICAgICAgICAgICAgIC8vIG5hdmlnYXRpb24gYW5kIGNvbXBsZXRlIGl0IHdpdGggdGhlIGZldGNoZXIgZGF0YQogICAgICAgICAgICAgICAgICAgICAgaWYgKHN0YXRlLm5hdmlnYXRpb24uc3RhdGUgPT09ICJsb2FkaW5nIiAmJiBsb2FkSWQgPiBwZW5kaW5nTmF2aWdhdGlvbkxvYWRJZCkge3JvdXRlcl9pbnZhcmlhbnQocGVuZGluZ0FjdGlvbiwgIkV4cGVjdGVkIHBlbmRpbmcgYWN0aW9uIik7cGVuZGluZ05hdmlnYXRpb25Db250cm9sbGVyICYmIHBlbmRpbmdOYXZpZ2F0aW9uQ29udHJvbGxlci5hYm9ydCgpO2NvbXBsZXRlTmF2aWdhdGlvbihzdGF0ZS5uYXZpZ2F0aW9uLmxvY2F0aW9uLCB7IG1hdGNoZXM6IG1hdGNoZXMsIGxvYWRlckRhdGE6IGxvYWRlckRhdGEsIGVycm9yczogZXJyb3JzLCBmZXRjaGVyczogbmV3IE1hcChzdGF0ZS5mZXRjaGVycykgfSk7fSBlbHNlIHsvLyBvdGhlcndpc2UganVzdCB1cGRhdGUgd2l0aCB0aGUgZmV0Y2hlciBkYXRhLCBwcmVzZXJ2aW5nIGFueSBleGlzdGluZwogICAgICAgICAgICAgICAgICAgICAgICAvLyBsb2FkZXJEYXRhIGZvciBsb2FkZXJzIHRoYXQgZGlkIG5vdCBuZWVkIHRvIHJlbG9hZC4gIFdlIGhhdmUgdG8KICAgICAgICAgICAgICAgICAgICAgICAgLy8gbWFudWFsbHkgbWVyZ2UgaGVyZSBzaW5jZSB3ZSBhcmVuJ3QgZ29pbmcgdGhyb3VnaCBjb21wbGV0ZU5hdmlnYXRpb24KICAgICAgICAgICAgICAgICAgICAgICAgdXBkYXRlU3RhdGUoX2V4dGVuZHMoeyBlcnJvcnM6IGVycm9ycywgbG9hZGVyRGF0YTogbWVyZ2VMb2FkZXJEYXRhKHN0YXRlLmxvYWRlckRhdGEsIGxvYWRlckRhdGEsIG1hdGNoZXMsIGVycm9ycykgfSwgZGlkQWJvcnRGZXRjaExvYWRzID8geyBmZXRjaGVyczogbmV3IE1hcChzdGF0ZS5mZXRjaGVycykgfSA6IHt9KSk7aXNSZXZhbGlkYXRpb25SZXF1aXJlZCA9IGZhbHNlO31jYXNlIDYxOmNhc2UgImVuZCI6cmV0dXJuIF9jb250ZXh0Ny5zdG9wKCk7fX0sIF9jYWxsZWU3KTt9KSk7cmV0dXJuIF9oYW5kbGVGZXRjaGVyQWN0aW9uLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7fWZ1bmN0aW9uIGhhbmRsZUZldGNoZXJMb2FkZXIoX3gyOCwgX3gyOSwgX3gzMCwgX3gzMSwgX3gzMiwgX3gzMykge3JldHVybiBfaGFuZGxlRmV0Y2hlckxvYWRlci5hcHBseSh0aGlzLCBhcmd1bWVudHMpO30KCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKICAgICAgICAgICAgLyoqCiAgICAgICAgICAgICAqIFV0aWxpdHkgZnVuY3Rpb24gdG8gaGFuZGxlIHJlZGlyZWN0cyByZXR1cm5lZCBmcm9tIGFuIGFjdGlvbiBvciBsb2FkZXIuCiAgICAgICAgICAgICAqIE5vcm1hbGx5LCBhIHJlZGlyZWN0ICJyZXBsYWNlcyIgdGhlIG5hdmlnYXRpb24gdGhhdCB0cmlnZ2VyZWQgaXQuICBTbywgZm9yCiAgICAgICAgICAgICAqIGV4YW1wbGU6CiAgICAgICAgICAgICAqCiAgICAgICAgICAgICAqICAtIHVzZXIgaXMgb24gL2EKICAgICAgICAgICAgICogIC0gdXNlciBjbGlja3MgYSBsaW5rIHRvIC9iCiAgICAgICAgICAgICAqICAtIGxvYWRlciBmb3IgL2IgcmVkaXJlY3RzIHRvIC9jCiAgICAgICAgICAgICAqCiAgICAgICAgICAgICAqIEluIGEgbm9uLUpTIGFwcCB0aGUgYnJvd3NlciB3b3VsZCB0cmFjayB0aGUgaW4tZmxpZ2h0IG5hdmlnYXRpb24gdG8gL2IgYW5kCiAgICAgICAgICAgICAqIHRoZW4gcmVwbGFjZSBpdCB3aXRoIC9jIHdoZW4gaXQgZW5jb3VudGVyZWQgdGhlIHJlZGlyZWN0IHJlc3BvbnNlLiAgSW4KICAgICAgICAgICAgICogdGhlIGVuZCBpdCB3b3VsZCBvbmx5IGV2ZXIgdXBkYXRlIHRoZSBVUkwgYmFyIHdpdGggL2MuCiAgICAgICAgICAgICAqCiAgICAgICAgICAgICAqIEluIGNsaWVudC1zaWRlIHJvdXRpbmcgdXNpbmcgcHVzaFN0YXRlL3JlcGxhY2VTdGF0ZSwgd2UgYWltIHRvIGVtdWxhdGUKICAgICAgICAgICAgICogdGhpcyBiZWhhdmlvciBhbmQgd2UgYWxzbyBkbyBub3QgdXBkYXRlIGhpc3RvcnkgdW50aWwgdGhlIGVuZCBvZiB0aGUKICAgICAgICAgICAgICogbmF2aWdhdGlvbiAoaW5jbHVkaW5nIHByb2Nlc3NlZCByZWRpcmVjdHMpLiAgVGhpcyBtZWFucyB0aGF0IHdlIG5ldmVyCiAgICAgICAgICAgICAqIGFjdHVhbGx5IHRvdWNoIGhpc3RvcnkgdW50aWwgd2UndmUgcHJvY2Vzc2VkIHJlZGlyZWN0cywgc28gd2UganVzdCB1c2UKICAgICAgICAgICAgICogdGhlIGhpc3RvcnkgYWN0aW9uIGZyb20gdGhlIG9yaWdpbmFsIG5hdmlnYXRpb24gKFBVU0ggb3IgUkVQTEFDRSkuCiAgICAgICAgICAgICAqL2Z1bmN0aW9uIF9oYW5kbGVGZXRjaGVyTG9hZGVyKCkge19oYW5kbGVGZXRjaGVyTG9hZGVyID0gX2FzeW5jVG9HZW5lcmF0b3IyKCAvKiNfX1BVUkVfXyovX3JlZ2VuZXJhdG9yUnVudGltZTIoKS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWU4KGtleSwgcm91dGVJZCwgcGF0aCwgbWF0Y2gsIG1hdGNoZXMsIHN1Ym1pc3Npb24pIHt2YXIgZXhpc3RpbmdGZXRjaGVyLCBsb2FkaW5nRmV0Y2hlciwgYWJvcnRDb250cm9sbGVyLCBmZXRjaFJlcXVlc3QsIHJlc3VsdCwgYm91bmRhcnlNYXRjaCwgZG9uZUZldGNoZXI7cmV0dXJuIF9yZWdlbmVyYXRvclJ1bnRpbWUyKCkud3JhcChmdW5jdGlvbiBfY2FsbGVlOCQoX2NvbnRleHQ4KSB7d2hpbGUgKDEpIHN3aXRjaCAoX2NvbnRleHQ4LnByZXYgPSBfY29udGV4dDgubmV4dCkge2Nhc2UgMDpleGlzdGluZ0ZldGNoZXIgPSBzdGF0ZS5mZXRjaGVycy5nZXQoa2V5KTsgLy8gUHV0IHRoaXMgZmV0Y2hlciBpbnRvIGl0J3MgbG9hZGluZyBzdGF0ZQogICAgICAgICAgICAgICAgICAgICAgbG9hZGluZ0ZldGNoZXIgPSBfZXh0ZW5kcyh7IHN0YXRlOiAibG9hZGluZyIsIGZvcm1NZXRob2Q6IHVuZGVmaW5lZCwgZm9ybUFjdGlvbjogdW5kZWZpbmVkLCBmb3JtRW5jVHlwZTogdW5kZWZpbmVkLCBmb3JtRGF0YTogdW5kZWZpbmVkIH0sIHN1Ym1pc3Npb24sIHsgZGF0YTogZXhpc3RpbmdGZXRjaGVyICYmIGV4aXN0aW5nRmV0Y2hlci5kYXRhLCAiIF9oYXNGZXRjaGVyRG9uZUFueXRoaW5nICI6IHRydWUgfSk7c3RhdGUuZmV0Y2hlcnMuc2V0KGtleSwgbG9hZGluZ0ZldGNoZXIpO3VwZGF0ZVN0YXRlKHsgZmV0Y2hlcnM6IG5ldyBNYXAoc3RhdGUuZmV0Y2hlcnMpIH0pOyAvLyBDYWxsIHRoZSBsb2FkZXIgZm9yIHRoaXMgZmV0Y2hlciByb3V0ZSBtYXRjaAogICAgICAgICAgICAgICAgICAgICAgYWJvcnRDb250cm9sbGVyID0gbmV3IEFib3J0Q29udHJvbGxlcigpO2ZldGNoUmVxdWVzdCA9IGNyZWF0ZUNsaWVudFNpZGVSZXF1ZXN0KGluaXQuaGlzdG9yeSwgcGF0aCwgYWJvcnRDb250cm9sbGVyLnNpZ25hbCk7ZmV0Y2hDb250cm9sbGVycy5zZXQoa2V5LCBhYm9ydENvbnRyb2xsZXIpO19jb250ZXh0OC5uZXh0ID0gOTtyZXR1cm4gY2FsbExvYWRlck9yQWN0aW9uKCJsb2FkZXIiLCBmZXRjaFJlcXVlc3QsIG1hdGNoLCBtYXRjaGVzLCByb3V0ZXIuYmFzZW5hbWUpO2Nhc2UgOTpyZXN1bHQgPSBfY29udGV4dDguc2VudDtpZiAoIWlzRGVmZXJyZWRSZXN1bHQocmVzdWx0KSkge19jb250ZXh0OC5uZXh0ID0gMTc7YnJlYWs7fV9jb250ZXh0OC5uZXh0ID0gMTM7cmV0dXJuIHJlc29sdmVEZWZlcnJlZERhdGEocmVzdWx0LCBmZXRjaFJlcXVlc3Quc2lnbmFsLCB0cnVlKTtjYXNlIDEzOl9jb250ZXh0OC50MCA9IF9jb250ZXh0OC5zZW50O2lmIChfY29udGV4dDgudDApIHtfY29udGV4dDgubmV4dCA9IDE2O2JyZWFrO31fY29udGV4dDgudDAgPSByZXN1bHQ7Y2FzZSAxNjpyZXN1bHQgPSBfY29udGV4dDgudDA7Y2FzZSAxNzogLy8gV2UgY2FuIGRlbGV0ZSB0aGlzIHNvIGxvbmcgYXMgd2Ugd2VyZW4ndCBhYm9ydGVkIGJ5IG91IG91ciBvd24gZmV0Y2hlcgogICAgICAgICAgICAgICAgICAgICAgLy8gcmUtbG9hZCB3aGljaCB3b3VsZCBoYXZlIHB1dCBfbmV3XyBjb250cm9sbGVyIGlzIGluIGZldGNoQ29udHJvbGxlcnMKICAgICAgICAgICAgICAgICAgICAgIGlmIChmZXRjaENvbnRyb2xsZXJzLmdldChrZXkpID09PSBhYm9ydENvbnRyb2xsZXIpIHtmZXRjaENvbnRyb2xsZXJzLmRlbGV0ZShrZXkpO31pZiAoIWZldGNoUmVxdWVzdC5zaWduYWwuYWJvcnRlZCkge19jb250ZXh0OC5uZXh0ID0gMjA7YnJlYWs7fXJldHVybiBfY29udGV4dDguYWJydXB0KCJyZXR1cm4iKTtjYXNlIDIwOmlmICghaXNSZWRpcmVjdFJlc3VsdChyZXN1bHQpKSB7X2NvbnRleHQ4Lm5leHQgPSAyNDticmVhazt9X2NvbnRleHQ4Lm5leHQgPSAyMztyZXR1cm4gc3RhcnRSZWRpcmVjdE5hdmlnYXRpb24oc3RhdGUsIHJlc3VsdCk7Y2FzZSAyMzpyZXR1cm4gX2NvbnRleHQ4LmFicnVwdCgicmV0dXJuIik7Y2FzZSAyNDppZiAoIWlzRXJyb3JSZXN1bHQocmVzdWx0KSkge19jb250ZXh0OC5uZXh0ID0gMjk7YnJlYWs7fWJvdW5kYXJ5TWF0Y2ggPSBmaW5kTmVhcmVzdEJvdW5kYXJ5KHN0YXRlLm1hdGNoZXMsIHJvdXRlSWQpO3N0YXRlLmZldGNoZXJzLmRlbGV0ZShrZXkpOyAvLyBUT0RPOiBJbiByZW1peCwgdGhpcyB3b3VsZCByZXNldCB0byBJRExFX05BVklHQVRJT04gaWYgaXQgd2FzIGEgY2F0Y2ggLQogICAgICAgICAgICAgICAgICAgICAgLy8gZG8gd2UgbmVlZCB0byBiZWhhdmUgYW55IGRpZmZlcmVudGx5IHdpdGggb3VyIG5vbi1yZWRpcmVjdCBlcnJvcnM/CiAgICAgICAgICAgICAgICAgICAgICAvLyBXaGF0IGlmIGl0IHdhcyBhIG5vbi1yZWRpcmVjdCBSZXNwb25zZT8KICAgICAgICAgICAgICAgICAgICAgIHVwZGF0ZVN0YXRlKHsgZmV0Y2hlcnM6IG5ldyBNYXAoc3RhdGUuZmV0Y2hlcnMpLCBlcnJvcnM6IF9kZWZpbmVQcm9wZXJ0eTIoe30sIGJvdW5kYXJ5TWF0Y2gucm91dGUuaWQsIHJlc3VsdC5lcnJvcikgfSk7cmV0dXJuIF9jb250ZXh0OC5hYnJ1cHQoInJldHVybiIpO2Nhc2UgMjk6cm91dGVyX2ludmFyaWFudCghaXNEZWZlcnJlZFJlc3VsdChyZXN1bHQpLCAiVW5oYW5kbGVkIGZldGNoZXIgZGVmZXJyZWQgZGF0YSIpOyAvLyBQdXQgdGhlIGZldGNoZXIgYmFjayBpbnRvIGFuIGlkbGUgc3RhdGUKICAgICAgICAgICAgICAgICAgICAgIGRvbmVGZXRjaGVyID0geyBzdGF0ZTogImlkbGUiLCBkYXRhOiByZXN1bHQuZGF0YSwgZm9ybU1ldGhvZDogdW5kZWZpbmVkLCBmb3JtQWN0aW9uOiB1bmRlZmluZWQsIGZvcm1FbmNUeXBlOiB1bmRlZmluZWQsIGZvcm1EYXRhOiB1bmRlZmluZWQsICIgX2hhc0ZldGNoZXJEb25lQW55dGhpbmcgIjogdHJ1ZSB9O3N0YXRlLmZldGNoZXJzLnNldChrZXksIGRvbmVGZXRjaGVyKTt1cGRhdGVTdGF0ZSh7IGZldGNoZXJzOiBuZXcgTWFwKHN0YXRlLmZldGNoZXJzKSB9KTtjYXNlIDMzOmNhc2UgImVuZCI6cmV0dXJuIF9jb250ZXh0OC5zdG9wKCk7fX0sIF9jYWxsZWU4KTt9KSk7cmV0dXJuIF9oYW5kbGVGZXRjaGVyTG9hZGVyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7fWZ1bmN0aW9uIHN0YXJ0UmVkaXJlY3ROYXZpZ2F0aW9uKF94MzQsIF94MzUsIF94MzYpIHtyZXR1cm4gX3N0YXJ0UmVkaXJlY3ROYXZpZ2F0aW9uLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7fWZ1bmN0aW9uIF9zdGFydFJlZGlyZWN0TmF2aWdhdGlvbigpIHtfc3RhcnRSZWRpcmVjdE5hdmlnYXRpb24gPSBfYXN5bmNUb0dlbmVyYXRvcjIoIC8qI19fUFVSRV9fKi9fcmVnZW5lcmF0b3JSdW50aW1lMigpLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTkoc3RhdGUsIHJlZGlyZWN0LCBfdGVtcCkge3ZhciBfd2luZG93LCBfcmVmMTIsIHN1Ym1pc3Npb24sIHJlcGxhY2UsIGlzRmV0Y2hBY3Rpb25SZWRpcmVjdCwgcmVkaXJlY3RMb2NhdGlvbiwgbmV3T3JpZ2luLCByZWRpcmVjdEhpc3RvcnlBY3Rpb24sIF9zdGF0ZSRuYXZpZ2F0aW9uLCBmb3JtTWV0aG9kLCBmb3JtQWN0aW9uLCBmb3JtRW5jVHlwZSwgZm9ybURhdGE7cmV0dXJuIF9yZWdlbmVyYXRvclJ1bnRpbWUyKCkud3JhcChmdW5jdGlvbiBfY2FsbGVlOSQoX2NvbnRleHQ5KSB7d2hpbGUgKDEpIHN3aXRjaCAoX2NvbnRleHQ5LnByZXYgPSBfY29udGV4dDkubmV4dCkge2Nhc2UgMDpfcmVmMTIgPQoKICAgICAgICAgICAgICAgICAgICAgIF90ZW1wID09PSB2b2lkIDAgPyB7fSA6IF90ZW1wLCBzdWJtaXNzaW9uID0gX3JlZjEyLnN1Ym1pc3Npb24sIHJlcGxhY2UgPSBfcmVmMTIucmVwbGFjZSwgaXNGZXRjaEFjdGlvblJlZGlyZWN0ID0gX3JlZjEyLmlzRmV0Y2hBY3Rpb25SZWRpcmVjdDsKCiAgICAgICAgICAgICAgICAgICAgICBpZiAocmVkaXJlY3QucmV2YWxpZGF0ZSkgewogICAgICAgICAgICAgICAgICAgICAgICBpc1JldmFsaWRhdGlvblJlcXVpcmVkID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICByZWRpcmVjdExvY2F0aW9uID0gY3JlYXRlTG9jYXRpb24oc3RhdGUubG9jYXRpb24sIHJlZGlyZWN0LmxvY2F0aW9uLCAvLyBUT0RPOiBUaGlzIGNhbiBiZSByZW1vdmVkIG9uY2Ugd2UgZ2V0IHJpZCBvZiB1c2VUcmFuc2l0aW9uIGluIFJlbWl4IHYyCiAgICAgICAgICAgICAgICAgICAgICBfZXh0ZW5kcyh7CiAgICAgICAgICAgICAgICAgICAgICAgIF9pc1JlZGlyZWN0OiB0cnVlCiAgICAgICAgICAgICAgICAgICAgICB9LCBpc0ZldGNoQWN0aW9uUmVkaXJlY3QgPyB7CiAgICAgICAgICAgICAgICAgICAgICAgIF9pc0ZldGNoQWN0aW9uUmVkaXJlY3Q6IHRydWUKICAgICAgICAgICAgICAgICAgICAgIH0gOiB7fSkpOwogICAgICAgICAgICAgICAgICAgICAgcm91dGVyX2ludmFyaWFudChyZWRpcmVjdExvY2F0aW9uLCAiRXhwZWN0ZWQgYSBsb2NhdGlvbiBvbiB0aGUgcmVkaXJlY3QgbmF2aWdhdGlvbiIpOyAvLyBDaGVjayBpZiB0aGlzIGFuIGV4dGVybmFsIHJlZGlyZWN0IHRoYXQgZ29lcyB0byBhIG5ldyBvcmlnaW4KICAgICAgICAgICAgICAgICAgICAgIGlmICghKAogICAgICAgICAgICAgICAgICAgICAgaXNCcm93c2VyICYmIHR5cGVvZiAoKF93aW5kb3cgPSB3aW5kb3cpID09IG51bGwgPyB2b2lkIDAgOiBfd2luZG93LmxvY2F0aW9uKSAhPT0gInVuZGVmaW5lZCIpKSB7X2NvbnRleHQ5Lm5leHQgPSA5O2JyZWFrO30KICAgICAgICAgICAgICAgICAgICAgIG5ld09yaWdpbiA9IGluaXQuaGlzdG9yeS5jcmVhdGVVUkwocmVkaXJlY3QubG9jYXRpb24pLm9yaWdpbjtpZiAoISgKCiAgICAgICAgICAgICAgICAgICAgICB3aW5kb3cubG9jYXRpb24ub3JpZ2luICE9PSBuZXdPcmlnaW4pKSB7X2NvbnRleHQ5Lm5leHQgPSA5O2JyZWFrO30KICAgICAgICAgICAgICAgICAgICAgIGlmIChyZXBsYWNlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvdy5sb2NhdGlvbi5yZXBsYWNlKHJlZGlyZWN0LmxvY2F0aW9uKTsKICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvdy5sb2NhdGlvbi5hc3NpZ24ocmVkaXJlY3QubG9jYXRpb24pOwogICAgICAgICAgICAgICAgICAgICAgfXJldHVybiBfY29udGV4dDkuYWJydXB0KCJyZXR1cm4iKTtjYXNlIDk6CgoKCiAgICAgICAgICAgICAgICAgICAgICAvLyBUaGVyZSdzIG5vIG5lZWQgdG8gYWJvcnQgb24gcmVkaXJlY3RzLCBzaW5jZSB3ZSBkb24ndCBkZXRlY3QgdGhlCiAgICAgICAgICAgICAgICAgICAgICAvLyByZWRpcmVjdCB1bnRpbCB0aGUgYWN0aW9uL2xvYWRlcnMgaGF2ZSBzZXR0bGVkCgoKICAgICAgICAgICAgICAgICAgICAgIHBlbmRpbmdOYXZpZ2F0aW9uQ29udHJvbGxlciA9IG51bGw7CiAgICAgICAgICAgICAgICAgICAgICByZWRpcmVjdEhpc3RvcnlBY3Rpb24gPSByZXBsYWNlID09PSB0cnVlID8gQWN0aW9uLlJlcGxhY2UgOiBBY3Rpb24uUHVzaDsgLy8gVXNlIHRoZSBpbmNvbWluZyBzdWJtaXNzaW9uIGlmIHByb3ZpZGVkLCBmYWxsYmFjayBvbiB0aGUgYWN0aXZlIG9uZSBpbgogICAgICAgICAgICAgICAgICAgICAgLy8gc3RhdGUubmF2aWdhdGlvbgogICAgICAgICAgICAgICAgICAgICAgX3N0YXRlJG5hdmlnYXRpb24gPQoKCgoKCiAgICAgICAgICAgICAgICAgICAgICBzdGF0ZS5uYXZpZ2F0aW9uLCBmb3JtTWV0aG9kID0gX3N0YXRlJG5hdmlnYXRpb24uZm9ybU1ldGhvZCwgZm9ybUFjdGlvbiA9IF9zdGF0ZSRuYXZpZ2F0aW9uLmZvcm1BY3Rpb24sIGZvcm1FbmNUeXBlID0gX3N0YXRlJG5hdmlnYXRpb24uZm9ybUVuY1R5cGUsIGZvcm1EYXRhID0gX3N0YXRlJG5hdmlnYXRpb24uZm9ybURhdGE7CgogICAgICAgICAgICAgICAgICAgICAgaWYgKCFzdWJtaXNzaW9uICYmIGZvcm1NZXRob2QgJiYgZm9ybUFjdGlvbiAmJiBmb3JtRGF0YSAmJiBmb3JtRW5jVHlwZSkgewogICAgICAgICAgICAgICAgICAgICAgICBzdWJtaXNzaW9uID0gewogICAgICAgICAgICAgICAgICAgICAgICAgIGZvcm1NZXRob2Q6IGZvcm1NZXRob2QsCiAgICAgICAgICAgICAgICAgICAgICAgICAgZm9ybUFjdGlvbjogZm9ybUFjdGlvbiwKICAgICAgICAgICAgICAgICAgICAgICAgICBmb3JtRW5jVHlwZTogZm9ybUVuY1R5cGUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgZm9ybURhdGE6IGZvcm1EYXRhCiAgICAgICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgICAgICB9IC8vIElmIHRoaXMgd2FzIGEgMzA3LzMwOCBzdWJtaXNzaW9uIHdlIHdhbnQgdG8gcHJlc2VydmUgdGhlIEhUVFAgbWV0aG9kIGFuZAogICAgICAgICAgICAgICAgICAgICAgLy8gcmUtc3VibWl0IHRoZSBHRVQvUE9TVC9QVVQvUEFUQ0gvREVMRVRFIGFzIGEgc3VibWlzc2lvbiBuYXZpZ2F0aW9uIHRvIHRoZQogICAgICAgICAgICAgICAgICAgICAgLy8gcmVkaXJlY3RlZCBsb2NhdGlvbgogICAgICAgICAgICAgICAgICAgICAgaWYgKCEoCgogICAgICAgICAgICAgICAgICAgICAgcmVkaXJlY3RQcmVzZXJ2ZU1ldGhvZFN0YXR1c0NvZGVzLmhhcyhyZWRpcmVjdC5zdGF0dXMpICYmIHN1Ym1pc3Npb24gJiYgaXNNdXRhdGlvbk1ldGhvZChzdWJtaXNzaW9uLmZvcm1NZXRob2QpKSkge19jb250ZXh0OS5uZXh0ID0gMTg7YnJlYWs7fV9jb250ZXh0OS5uZXh0ID0gMTY7cmV0dXJuICgKICAgICAgICAgICAgICAgICAgICAgICAgc3RhcnROYXZpZ2F0aW9uKHJlZGlyZWN0SGlzdG9yeUFjdGlvbiwgcmVkaXJlY3RMb2NhdGlvbiwgewogICAgICAgICAgICAgICAgICAgICAgICAgIHN1Ym1pc3Npb246IF9leHRlbmRzKHt9LCBzdWJtaXNzaW9uLCB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3JtQWN0aW9uOiByZWRpcmVjdC5sb2NhdGlvbgogICAgICAgICAgICAgICAgICAgICAgICAgIH0pLAogICAgICAgICAgICAgICAgICAgICAgICAgIC8vIFByZXNlcnZlIHRoaXMgZmxhZyBhY3Jvc3MgcmVkaXJlY3RzCiAgICAgICAgICAgICAgICAgICAgICAgICAgcHJldmVudFNjcm9sbFJlc2V0OiBwZW5kaW5nUHJldmVudFNjcm9sbFJlc2V0CiAgICAgICAgICAgICAgICAgICAgICAgIH0pKTtjYXNlIDE2Ol9jb250ZXh0OS5uZXh0ID0gMjA7YnJlYWs7Y2FzZSAxODpfY29udGV4dDkubmV4dCA9IDIwO3JldHVybiAoCgoKCiAgICAgICAgICAgICAgICAgICAgICAgIHN0YXJ0TmF2aWdhdGlvbihyZWRpcmVjdEhpc3RvcnlBY3Rpb24sIHJlZGlyZWN0TG9jYXRpb24sIHsKICAgICAgICAgICAgICAgICAgICAgICAgICBvdmVycmlkZU5hdmlnYXRpb246IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YXRlOiAibG9hZGluZyIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2NhdGlvbjogcmVkaXJlY3RMb2NhdGlvbiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvcm1NZXRob2Q6IHN1Ym1pc3Npb24gPyBzdWJtaXNzaW9uLmZvcm1NZXRob2QgOiB1bmRlZmluZWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3JtQWN0aW9uOiBzdWJtaXNzaW9uID8gc3VibWlzc2lvbi5mb3JtQWN0aW9uIDogdW5kZWZpbmVkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9ybUVuY1R5cGU6IHN1Ym1pc3Npb24gPyBzdWJtaXNzaW9uLmZvcm1FbmNUeXBlIDogdW5kZWZpbmVkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9ybURhdGE6IHN1Ym1pc3Npb24gPyBzdWJtaXNzaW9uLmZvcm1EYXRhIDogdW5kZWZpbmVkCiAgICAgICAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBQcmVzZXJ2ZSB0aGlzIGZsYWcgYWNyb3NzIHJlZGlyZWN0cwogICAgICAgICAgICAgICAgICAgICAgICAgIHByZXZlbnRTY3JvbGxSZXNldDogcGVuZGluZ1ByZXZlbnRTY3JvbGxSZXNldAogICAgICAgICAgICAgICAgICAgICAgICB9KSk7Y2FzZSAyMDpjYXNlICJlbmQiOnJldHVybiBfY29udGV4dDkuc3RvcCgpO319LCBfY2FsbGVlOSk7fSkpO3JldHVybiBfc3RhcnRSZWRpcmVjdE5hdmlnYXRpb24uYXBwbHkodGhpcywgYXJndW1lbnRzKTt9ZnVuY3Rpb24KCgoKICAgICAgICAgICAgY2FsbExvYWRlcnNBbmRNYXliZVJlc29sdmVEYXRhKF94MzcsIF94MzgsIF94MzksIF94NDAsIF94NDEpIHtyZXR1cm4gX2NhbGxMb2FkZXJzQW5kTWF5YmVSZXNvbHZlRGF0YS5hcHBseSh0aGlzLCBhcmd1bWVudHMpO31mdW5jdGlvbiBfY2FsbExvYWRlcnNBbmRNYXliZVJlc29sdmVEYXRhKCkge19jYWxsTG9hZGVyc0FuZE1heWJlUmVzb2x2ZURhdGEgPSBfYXN5bmNUb0dlbmVyYXRvcjIoIC8qI19fUFVSRV9fKi9fcmVnZW5lcmF0b3JSdW50aW1lMigpLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTEwKGN1cnJlbnRNYXRjaGVzLCBtYXRjaGVzLCBtYXRjaGVzVG9Mb2FkLCBmZXRjaGVyc1RvTG9hZCwgcmVxdWVzdCkge3ZhciByZXN1bHRzLCBsb2FkZXJSZXN1bHRzLCBmZXRjaGVyUmVzdWx0cztyZXR1cm4gX3JlZ2VuZXJhdG9yUnVudGltZTIoKS53cmFwKGZ1bmN0aW9uIF9jYWxsZWUxMCQoX2NvbnRleHQxMCkge3doaWxlICgxKSBzd2l0Y2ggKF9jb250ZXh0MTAucHJldiA9IF9jb250ZXh0MTAubmV4dCkge2Nhc2UgMDpfY29udGV4dDEwLm5leHQgPSAyO3JldHVybiAoCgoKCiAgICAgICAgICAgICAgICAgICAgICAgIFByb21pc2UuYWxsKFtdLmNvbmNhdChfdG9Db25zdW1hYmxlQXJyYXkyKG1hdGNoZXNUb0xvYWQubWFwKChtYXRjaCkgPT4gY2FsbExvYWRlck9yQWN0aW9uKCJsb2FkZXIiLCByZXF1ZXN0LCBtYXRjaCwgbWF0Y2hlcywgcm91dGVyLmJhc2VuYW1lKSkpLCBfdG9Db25zdW1hYmxlQXJyYXkyKGZldGNoZXJzVG9Mb2FkLm1hcCgoZikgPT4gY2FsbExvYWRlck9yQWN0aW9uKCJsb2FkZXIiLCBjcmVhdGVDbGllbnRTaWRlUmVxdWVzdChpbml0Lmhpc3RvcnksIGYucGF0aCwgcmVxdWVzdC5zaWduYWwpLCBmLm1hdGNoLCBmLm1hdGNoZXMsIHJvdXRlci5iYXNlbmFtZSkpKSkpKTtjYXNlIDI6cmVzdWx0cyA9IF9jb250ZXh0MTAuc2VudDsKICAgICAgICAgICAgICAgICAgICAgIGxvYWRlclJlc3VsdHMgPSByZXN1bHRzLnNsaWNlKDAsIG1hdGNoZXNUb0xvYWQubGVuZ3RoKTsKICAgICAgICAgICAgICAgICAgICAgIGZldGNoZXJSZXN1bHRzID0gcmVzdWx0cy5zbGljZShtYXRjaGVzVG9Mb2FkLmxlbmd0aCk7X2NvbnRleHQxMC5uZXh0ID0gNztyZXR1cm4gKAogICAgICAgICAgICAgICAgICAgICAgICBQcm9taXNlLmFsbChbcmVzb2x2ZURlZmVycmVkUmVzdWx0cyhjdXJyZW50TWF0Y2hlcywgbWF0Y2hlc1RvTG9hZCwgbG9hZGVyUmVzdWx0cywgcmVxdWVzdC5zaWduYWwsIGZhbHNlLCBzdGF0ZS5sb2FkZXJEYXRhKSwgcmVzb2x2ZURlZmVycmVkUmVzdWx0cyhjdXJyZW50TWF0Y2hlcywgZmV0Y2hlcnNUb0xvYWQubWFwKChmKSA9PiBmLm1hdGNoKSwgZmV0Y2hlclJlc3VsdHMsIHJlcXVlc3Quc2lnbmFsLCB0cnVlKV0pKTtjYXNlIDc6cmV0dXJuIF9jb250ZXh0MTAuYWJydXB0KCJyZXR1cm4iLAogICAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICByZXN1bHRzOiByZXN1bHRzLAogICAgICAgICAgICAgICAgICAgICAgICBsb2FkZXJSZXN1bHRzOiBsb2FkZXJSZXN1bHRzLAogICAgICAgICAgICAgICAgICAgICAgICBmZXRjaGVyUmVzdWx0czogZmV0Y2hlclJlc3VsdHMKICAgICAgICAgICAgICAgICAgICAgIH0pO2Nhc2UgODpjYXNlICJlbmQiOnJldHVybiBfY29udGV4dDEwLnN0b3AoKTt9fSwgX2NhbGxlZTEwKTt9KSk7cmV0dXJuIF9jYWxsTG9hZGVyc0FuZE1heWJlUmVzb2x2ZURhdGEuYXBwbHkodGhpcywgYXJndW1lbnRzKTt9CgoKICAgICAgICAgICAgZnVuY3Rpb24gaW50ZXJydXB0QWN0aXZlTG9hZHMoKSB7dmFyIF9jYW5jZWxsZWREZWZlcnJlZFJvdTsKICAgICAgICAgICAgICAvLyBFdmVyeSBpbnRlcnJ1cHRpb24gdHJpZ2dlcnMgYSByZXZhbGlkYXRpb24KICAgICAgICAgICAgICBpc1JldmFsaWRhdGlvblJlcXVpcmVkID0gdHJ1ZTsgLy8gQ2FuY2VsIHBlbmRpbmcgcm91dGUtbGV2ZWwgZGVmZXJyZWRzIGFuZCBtYXJrIGNhbmNlbGxlZCByb3V0ZXMgZm9yCiAgICAgICAgICAgICAgLy8gcmV2YWxpZGF0aW9uCgogICAgICAgICAgICAgIChfY2FuY2VsbGVkRGVmZXJyZWRSb3UgPSBjYW5jZWxsZWREZWZlcnJlZFJvdXRlcykucHVzaC5hcHBseShfY2FuY2VsbGVkRGVmZXJyZWRSb3UsIF90b0NvbnN1bWFibGVBcnJheTIoY2FuY2VsQWN0aXZlRGVmZXJyZWRzKCkpKTsgLy8gQWJvcnQgaW4tZmxpZ2h0IGZldGNoZXIgbG9hZHMKCiAgICAgICAgICAgICAgZmV0Y2hMb2FkTWF0Y2hlcy5mb3JFYWNoKChfLCBrZXkpID0+IHsKICAgICAgICAgICAgICAgIGlmIChmZXRjaENvbnRyb2xsZXJzLmhhcyhrZXkpKSB7CiAgICAgICAgICAgICAgICAgIGNhbmNlbGxlZEZldGNoZXJMb2Fkcy5wdXNoKGtleSk7CiAgICAgICAgICAgICAgICAgIGFib3J0RmV0Y2hlcihrZXkpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CgogICAgICAgICAgICBmdW5jdGlvbiBzZXRGZXRjaGVyRXJyb3Ioa2V5LCByb3V0ZUlkLCBlcnJvcikgewogICAgICAgICAgICAgIHZhciBib3VuZGFyeU1hdGNoID0gZmluZE5lYXJlc3RCb3VuZGFyeShzdGF0ZS5tYXRjaGVzLCByb3V0ZUlkKTsKICAgICAgICAgICAgICBkZWxldGVGZXRjaGVyKGtleSk7CiAgICAgICAgICAgICAgdXBkYXRlU3RhdGUoewogICAgICAgICAgICAgICAgZXJyb3JzOiBfZGVmaW5lUHJvcGVydHkyKHt9LAogICAgICAgICAgICAgICAgYm91bmRhcnlNYXRjaC5yb3V0ZS5pZCwgZXJyb3IpLAoKICAgICAgICAgICAgICAgIGZldGNoZXJzOiBuZXcgTWFwKHN0YXRlLmZldGNoZXJzKQogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CgogICAgICAgICAgICBmdW5jdGlvbiBkZWxldGVGZXRjaGVyKGtleSkgewogICAgICAgICAgICAgIGlmIChmZXRjaENvbnRyb2xsZXJzLmhhcyhrZXkpKSBhYm9ydEZldGNoZXIoa2V5KTsKICAgICAgICAgICAgICBmZXRjaExvYWRNYXRjaGVzLmRlbGV0ZShrZXkpOwogICAgICAgICAgICAgIGZldGNoUmVsb2FkSWRzLmRlbGV0ZShrZXkpOwogICAgICAgICAgICAgIGZldGNoUmVkaXJlY3RJZHMuZGVsZXRlKGtleSk7CiAgICAgICAgICAgICAgc3RhdGUuZmV0Y2hlcnMuZGVsZXRlKGtleSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGZ1bmN0aW9uIGFib3J0RmV0Y2hlcihrZXkpIHsKICAgICAgICAgICAgICB2YXIgY29udHJvbGxlciA9IGZldGNoQ29udHJvbGxlcnMuZ2V0KGtleSk7CiAgICAgICAgICAgICAgcm91dGVyX2ludmFyaWFudChjb250cm9sbGVyLCAiRXhwZWN0ZWQgZmV0Y2ggY29udHJvbGxlcjogIiArIGtleSk7CiAgICAgICAgICAgICAgY29udHJvbGxlci5hYm9ydCgpOwogICAgICAgICAgICAgIGZldGNoQ29udHJvbGxlcnMuZGVsZXRlKGtleSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGZ1bmN0aW9uIG1hcmtGZXRjaGVyc0RvbmUoa2V5cykge3ZhciBfaXRlcmF0b3I1ID0gX2NyZWF0ZUZvck9mSXRlcmF0b3JIZWxwZXIyKAogICAgICAgICAgICAgICAga2V5cyksX3N0ZXA1O3RyeSB7Zm9yIChfaXRlcmF0b3I1LnMoKTsgIShfc3RlcDUgPSBfaXRlcmF0b3I1Lm4oKSkuZG9uZTspIHt2YXIga2V5ID0gX3N0ZXA1LnZhbHVlOwogICAgICAgICAgICAgICAgICB2YXIgZmV0Y2hlciA9IGdldEZldGNoZXIoa2V5KTsKICAgICAgICAgICAgICAgICAgdmFyIGRvbmVGZXRjaGVyID0gewogICAgICAgICAgICAgICAgICAgIHN0YXRlOiAiaWRsZSIsCiAgICAgICAgICAgICAgICAgICAgZGF0YTogZmV0Y2hlci5kYXRhLAogICAgICAgICAgICAgICAgICAgIGZvcm1NZXRob2Q6IHVuZGVmaW5lZCwKICAgICAgICAgICAgICAgICAgICBmb3JtQWN0aW9uOiB1bmRlZmluZWQsCiAgICAgICAgICAgICAgICAgICAgZm9ybUVuY1R5cGU6IHVuZGVmaW5lZCwKICAgICAgICAgICAgICAgICAgICBmb3JtRGF0YTogdW5kZWZpbmVkLAogICAgICAgICAgICAgICAgICAgICIgX2hhc0ZldGNoZXJEb25lQW55dGhpbmcgIjogdHJ1ZQogICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgICBzdGF0ZS5mZXRjaGVycy5zZXQoa2V5LCBkb25lRmV0Y2hlcik7CiAgICAgICAgICAgICAgICB9fSBjYXRjaCAoZXJyKSB7X2l0ZXJhdG9yNS5lKGVycik7fSBmaW5hbGx5IHtfaXRlcmF0b3I1LmYoKTt9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGZ1bmN0aW9uIG1hcmtGZXRjaFJlZGlyZWN0c0RvbmUoKSB7CiAgICAgICAgICAgICAgdmFyIGRvbmVLZXlzID0gW107dmFyIF9pdGVyYXRvcjYgPSBfY3JlYXRlRm9yT2ZJdGVyYXRvckhlbHBlcjIoCgogICAgICAgICAgICAgICAgZmV0Y2hSZWRpcmVjdElkcyksX3N0ZXA2O3RyeSB7Zm9yIChfaXRlcmF0b3I2LnMoKTsgIShfc3RlcDYgPSBfaXRlcmF0b3I2Lm4oKSkuZG9uZTspIHt2YXIga2V5ID0gX3N0ZXA2LnZhbHVlOwogICAgICAgICAgICAgICAgICB2YXIgZmV0Y2hlciA9IHN0YXRlLmZldGNoZXJzLmdldChrZXkpOwogICAgICAgICAgICAgICAgICByb3V0ZXJfaW52YXJpYW50KGZldGNoZXIsICJFeHBlY3RlZCBmZXRjaGVyOiAiICsga2V5KTsKCiAgICAgICAgICAgICAgICAgIGlmIChmZXRjaGVyLnN0YXRlID09PSAibG9hZGluZyIpIHsKICAgICAgICAgICAgICAgICAgICBmZXRjaFJlZGlyZWN0SWRzLmRlbGV0ZShrZXkpOwogICAgICAgICAgICAgICAgICAgIGRvbmVLZXlzLnB1c2goa2V5KTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfX0gY2F0Y2ggKGVycikge19pdGVyYXRvcjYuZShlcnIpO30gZmluYWxseSB7X2l0ZXJhdG9yNi5mKCk7fQoKICAgICAgICAgICAgICBtYXJrRmV0Y2hlcnNEb25lKGRvbmVLZXlzKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgZnVuY3Rpb24gYWJvcnRTdGFsZUZldGNoTG9hZHMobGFuZGVkSWQpIHsKICAgICAgICAgICAgICB2YXIgeWVldGVkS2V5cyA9IFtdO3ZhciBfaXRlcmF0b3I3ID0gX2NyZWF0ZUZvck9mSXRlcmF0b3JIZWxwZXIyKAoKICAgICAgICAgICAgICAgIGZldGNoUmVsb2FkSWRzKSxfc3RlcDc7dHJ5IHtmb3IgKF9pdGVyYXRvcjcucygpOyAhKF9zdGVwNyA9IF9pdGVyYXRvcjcubigpKS5kb25lOykge3ZhciBfc3RlcDckdmFsdWUgPSBfc2xpY2VkVG9BcnJheTIoX3N0ZXA3LnZhbHVlLCAyKSxrZXkgPSBfc3RlcDckdmFsdWVbMF0saWQgPSBfc3RlcDckdmFsdWVbMV07CiAgICAgICAgICAgICAgICAgIGlmIChpZCA8IGxhbmRlZElkKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIGZldGNoZXIgPSBzdGF0ZS5mZXRjaGVycy5nZXQoa2V5KTsKICAgICAgICAgICAgICAgICAgICByb3V0ZXJfaW52YXJpYW50KGZldGNoZXIsICJFeHBlY3RlZCBmZXRjaGVyOiAiICsga2V5KTsKCiAgICAgICAgICAgICAgICAgICAgaWYgKGZldGNoZXIuc3RhdGUgPT09ICJsb2FkaW5nIikgewogICAgICAgICAgICAgICAgICAgICAgYWJvcnRGZXRjaGVyKGtleSk7CiAgICAgICAgICAgICAgICAgICAgICBmZXRjaFJlbG9hZElkcy5kZWxldGUoa2V5KTsKICAgICAgICAgICAgICAgICAgICAgIHllZXRlZEtleXMucHVzaChrZXkpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfX0gY2F0Y2ggKGVycikge19pdGVyYXRvcjcuZShlcnIpO30gZmluYWxseSB7X2l0ZXJhdG9yNy5mKCk7fQoKICAgICAgICAgICAgICBtYXJrRmV0Y2hlcnNEb25lKHllZXRlZEtleXMpOwogICAgICAgICAgICAgIHJldHVybiB5ZWV0ZWRLZXlzLmxlbmd0aCA+IDA7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGZ1bmN0aW9uIGdldEJsb2NrZXIoa2V5LCBmbikgewogICAgICAgICAgICAgIHZhciBibG9ja2VyID0gc3RhdGUuYmxvY2tlcnMuZ2V0KGtleSkgfHwgSURMRV9CTE9DS0VSOwoKICAgICAgICAgICAgICBpZiAoYmxvY2tlckZ1bmN0aW9ucy5nZXQoa2V5KSAhPT0gZm4pIHsKICAgICAgICAgICAgICAgIGJsb2NrZXJGdW5jdGlvbnMuc2V0KGtleSwgZm4pOwoKICAgICAgICAgICAgICAgIGlmIChhY3RpdmVCbG9ja2VyID09IG51bGwpIHsKICAgICAgICAgICAgICAgICAgLy8gVGhpcyBpcyBub3cgdGhlIGFjdGl2ZSBibG9ja2VyCiAgICAgICAgICAgICAgICAgIGFjdGl2ZUJsb2NrZXIgPSBrZXk7CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGtleSAhPT0gYWN0aXZlQmxvY2tlcikgewogICAgICAgICAgICAgICAgICB3YXJuaW5nKGZhbHNlLCAiQSByb3V0ZXIgb25seSBzdXBwb3J0cyBvbmUgYmxvY2tlciBhdCBhIHRpbWUiKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIHJldHVybiBibG9ja2VyOwogICAgICAgICAgICB9CgogICAgICAgICAgICBmdW5jdGlvbiBkZWxldGVCbG9ja2VyKGtleSkgewogICAgICAgICAgICAgIHN0YXRlLmJsb2NrZXJzLmRlbGV0ZShrZXkpOwogICAgICAgICAgICAgIGJsb2NrZXJGdW5jdGlvbnMuZGVsZXRlKGtleSk7CgogICAgICAgICAgICAgIGlmIChhY3RpdmVCbG9ja2VyID09PSBrZXkpIHsKICAgICAgICAgICAgICAgIGFjdGl2ZUJsb2NrZXIgPSBudWxsOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSAvLyBVdGlsaXR5IGZ1bmN0aW9uIHRvIHVwZGF0ZSBibG9ja2VycywgZW5zdXJpbmcgdmFsaWQgc3RhdGUgdHJhbnNpdGlvbnMKCgogICAgICAgICAgICBmdW5jdGlvbiB1cGRhdGVCbG9ja2VyKGtleSwgbmV3QmxvY2tlcikgewogICAgICAgICAgICAgIHZhciBibG9ja2VyID0gc3RhdGUuYmxvY2tlcnMuZ2V0KGtleSkgfHwgSURMRV9CTE9DS0VSOyAvLyBQb29yIG1hbnMgc3RhdGUgbWFjaGluZSA6KQogICAgICAgICAgICAgIC8vIGh0dHBzOi8vbWVybWFpZC5saXZlL2VkaXQjcGFrbzplTnFWa2M5T3d6QU14bDhsOG5uakFZckV0RElPSEVCSWd3dktKVFJlR3kzX2xEcElxTzI3azZhd01HMFhjckxsbno4N253ZG9uRVNvZ0tYWEJ1RTc5cnE3NVhaTzMteUhkczBSSlZ1djcwWXJQbFVyQ0VlMkhmck9SUzNydWJxWmZ1aHRwZzVDOXdrNXRaNFZLY1JVcTg4cTlaOFJTMC00OGNFMWlISmtMMHVnYkh1Rkx1czlMNnNwWnk4blg5TVAyQ05kb21WYXBvc3F1M2ZHYXlUOFQ4LWpKUXdoZXBvX1V0cGdCUWFERVVvbTA0ZFpoQU4xYUpCRGxVS0pCeEUxY2VCMlNtajBNbG4tSUJXNUFGVTJkd1Vpa3R0XzJRYXEyZEJmYUtkRXVwODVVVjdZZC1kS2psbmthYmwyUHZyMERUa1RyZU0KCiAgICAgICAgICAgICAgcm91dGVyX2ludmFyaWFudChibG9ja2VyLnN0YXRlID09PSAidW5ibG9ja2VkIiAmJiBuZXdCbG9ja2VyLnN0YXRlID09PSAiYmxvY2tlZCIgfHwgYmxvY2tlci5zdGF0ZSA9PT0gImJsb2NrZWQiICYmIG5ld0Jsb2NrZXIuc3RhdGUgPT09ICJibG9ja2VkIiB8fCBibG9ja2VyLnN0YXRlID09PSAiYmxvY2tlZCIgJiYgbmV3QmxvY2tlci5zdGF0ZSA9PT0gInByb2NlZWRpbmciIHx8IGJsb2NrZXIuc3RhdGUgPT09ICJibG9ja2VkIiAmJiBuZXdCbG9ja2VyLnN0YXRlID09PSAidW5ibG9ja2VkIiB8fCBibG9ja2VyLnN0YXRlID09PSAicHJvY2VlZGluZyIgJiYgbmV3QmxvY2tlci5zdGF0ZSA9PT0gInVuYmxvY2tlZCIsICJJbnZhbGlkIGJsb2NrZXIgc3RhdGUgdHJhbnNpdGlvbjogIiArIGJsb2NrZXIuc3RhdGUgKyAiIC0+ICIgKyBuZXdCbG9ja2VyLnN0YXRlKTsKICAgICAgICAgICAgICBzdGF0ZS5ibG9ja2Vycy5zZXQoa2V5LCBuZXdCbG9ja2VyKTsKICAgICAgICAgICAgICB1cGRhdGVTdGF0ZSh7CiAgICAgICAgICAgICAgICBibG9ja2VyczogbmV3IE1hcChzdGF0ZS5ibG9ja2VycykKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgZnVuY3Rpb24gc2hvdWxkQmxvY2tOYXZpZ2F0aW9uKF9yZWYyKSB7CiAgICAgICAgICAgICAgdmFyCiAgICAgICAgICAgICAgICBjdXJyZW50TG9jYXRpb24gPQoKCiAgICAgICAgICAgICAgICBfcmVmMi5jdXJyZW50TG9jYXRpb24sbmV4dExvY2F0aW9uID0gX3JlZjIubmV4dExvY2F0aW9uLGhpc3RvcnlBY3Rpb24gPSBfcmVmMi5oaXN0b3J5QWN0aW9uOwoKICAgICAgICAgICAgICBpZiAoYWN0aXZlQmxvY2tlciA9PSBudWxsKSB7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgfSAvLyBXZSBvbmx5IGFsbG93IGEgc2luZ2xlIGJsb2NrZXIgYXQgdGhlIG1vbWVudC4gIFRoaXMgd2lsbCBuZWVkIHRvIGJlCiAgICAgICAgICAgICAgLy8gdXBkYXRlZCBpZiB3ZSBlbmhhbmNlIHRvIHN1cHBvcnQgbXVsdGlwbGUgYmxvY2tlcnMgaW4gdGhlIGZ1dHVyZQoKCiAgICAgICAgICAgICAgdmFyIGJsb2NrZXJGdW5jdGlvbiA9IGJsb2NrZXJGdW5jdGlvbnMuZ2V0KGFjdGl2ZUJsb2NrZXIpOwogICAgICAgICAgICAgIHJvdXRlcl9pbnZhcmlhbnQoYmxvY2tlckZ1bmN0aW9uLCAiQ291bGQgbm90IGZpbmQgYSBmdW5jdGlvbiBmb3IgdGhlIGFjdGl2ZSBibG9ja2VyIik7CiAgICAgICAgICAgICAgdmFyIGJsb2NrZXIgPSBzdGF0ZS5ibG9ja2Vycy5nZXQoYWN0aXZlQmxvY2tlcik7CgogICAgICAgICAgICAgIGlmIChibG9ja2VyICYmIGJsb2NrZXIuc3RhdGUgPT09ICJwcm9jZWVkaW5nIikgewogICAgICAgICAgICAgICAgLy8gSWYgdGhlIGJsb2NrZXIgaXMgY3VycmVudGx5IHByb2NlZWRpbmcsIHdlIGRvbid0IG5lZWQgdG8gcmUtY2hlY2sKICAgICAgICAgICAgICAgIC8vIGl0IGFuZCBjYW4gbGV0IHRoaXMgbmF2aWdhdGlvbiBjb250aW51ZQogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgIH0gLy8gQXQgdGhpcyBwb2ludCwgd2Uga25vdyB3ZSdyZSB1bmJsb2NrZWQvYmxvY2tlZCBzbyB3ZSBuZWVkIHRvIGNoZWNrIHRoZQogICAgICAgICAgICAgIC8vIHVzZXItcHJvdmlkZWQgYmxvY2tlciBmdW5jdGlvbgoKCiAgICAgICAgICAgICAgaWYgKGJsb2NrZXJGdW5jdGlvbih7CiAgICAgICAgICAgICAgICBjdXJyZW50TG9jYXRpb246IGN1cnJlbnRMb2NhdGlvbiwKICAgICAgICAgICAgICAgIG5leHRMb2NhdGlvbjogbmV4dExvY2F0aW9uLAogICAgICAgICAgICAgICAgaGlzdG9yeUFjdGlvbjogaGlzdG9yeUFjdGlvbgogICAgICAgICAgICAgIH0pKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gYWN0aXZlQmxvY2tlcjsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGZ1bmN0aW9uIGNhbmNlbEFjdGl2ZURlZmVycmVkcyhwcmVkaWNhdGUpIHsKICAgICAgICAgICAgICB2YXIgY2FuY2VsbGVkUm91dGVJZHMgPSBbXTsKICAgICAgICAgICAgICBhY3RpdmVEZWZlcnJlZHMuZm9yRWFjaCgoZGZkLCByb3V0ZUlkKSA9PiB7CiAgICAgICAgICAgICAgICBpZiAoIXByZWRpY2F0ZSB8fCBwcmVkaWNhdGUocm91dGVJZCkpIHsKICAgICAgICAgICAgICAgICAgLy8gQ2FuY2VsIHRoZSBkZWZlcnJlZCAtIGJ1dCBkbyBub3QgcmVtb3ZlIGZyb20gYWN0aXZlRGVmZXJyZWRzIGhlcmUgLQogICAgICAgICAgICAgICAgICAvLyB3ZSByZWx5IG9uIHRoZSBzdWJzY3JpYmVycyB0byBkbyB0aGF0IHNvIG91ciB0ZXN0cyBjYW4gYXNzZXJ0IHByb3BlcgogICAgICAgICAgICAgICAgICAvLyBjbGVhbnVwIHZpYSBfaW50ZXJuYWxBY3RpdmVEZWZlcnJlZHMKICAgICAgICAgICAgICAgICAgZGZkLmNhbmNlbCgpOwogICAgICAgICAgICAgICAgICBjYW5jZWxsZWRSb3V0ZUlkcy5wdXNoKHJvdXRlSWQpOwogICAgICAgICAgICAgICAgICBhY3RpdmVEZWZlcnJlZHMuZGVsZXRlKHJvdXRlSWQpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgIHJldHVybiBjYW5jZWxsZWRSb3V0ZUlkczsKICAgICAgICAgICAgfSAvLyBPcHQgaW4gdG8gY2FwdHVyaW5nIGFuZCByZXBvcnRpbmcgc2Nyb2xsIHBvc2l0aW9ucyBkdXJpbmcgbmF2aWdhdGlvbnMsCiAgICAgICAgICAgIC8vIHVzZWQgYnkgdGhlIDxTY3JvbGxSZXN0b3JhdGlvbj4gY29tcG9uZW50CgoKICAgICAgICAgICAgZnVuY3Rpb24gZW5hYmxlU2Nyb2xsUmVzdG9yYXRpb24ocG9zaXRpb25zLCBnZXRQb3NpdGlvbiwgZ2V0S2V5KSB7CiAgICAgICAgICAgICAgc2F2ZWRTY3JvbGxQb3NpdGlvbnMgPSBwb3NpdGlvbnM7CiAgICAgICAgICAgICAgZ2V0U2Nyb2xsUG9zaXRpb24gPSBnZXRQb3NpdGlvbjsKCiAgICAgICAgICAgICAgZ2V0U2Nyb2xsUmVzdG9yYXRpb25LZXkgPSBnZXRLZXkgfHwgKChsb2NhdGlvbikgPT4gbG9jYXRpb24ua2V5KTsgLy8gUGVyZm9ybSBpbml0aWFsIGh5ZHJhdGlvbiBzY3JvbGwgcmVzdG9yYXRpb24sIHNpbmNlIHdlIG1pc3MgdGhlIGJvYXQgb24KICAgICAgICAgICAgICAvLyB0aGUgaW5pdGlhbCB1cGRhdGVTdGF0ZSgpIGJlY2F1c2Ugd2UndmUgbm90IHlldCByZW5kZXJlZCA8U2Nyb2xsUmVzdG9yYXRpb24vPgogICAgICAgICAgICAgIC8vIGFuZCB0aGVyZWZvcmUgaGF2ZSBubyBzYXZlZFNjcm9sbFBvc2l0aW9ucyBhdmFpbGFibGUKCgogICAgICAgICAgICAgIGlmICghaW5pdGlhbFNjcm9sbFJlc3RvcmVkICYmIHN0YXRlLm5hdmlnYXRpb24gPT09IElETEVfTkFWSUdBVElPTikgewogICAgICAgICAgICAgICAgaW5pdGlhbFNjcm9sbFJlc3RvcmVkID0gdHJ1ZTsKICAgICAgICAgICAgICAgIHZhciB5ID0gZ2V0U2F2ZWRTY3JvbGxQb3NpdGlvbihzdGF0ZS5sb2NhdGlvbiwgc3RhdGUubWF0Y2hlcyk7CgogICAgICAgICAgICAgICAgaWYgKHkgIT0gbnVsbCkgewogICAgICAgICAgICAgICAgICB1cGRhdGVTdGF0ZSh7CiAgICAgICAgICAgICAgICAgICAgcmVzdG9yZVNjcm9sbFBvc2l0aW9uOiB5CiAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgcmV0dXJuICgpID0+IHsKICAgICAgICAgICAgICAgIHNhdmVkU2Nyb2xsUG9zaXRpb25zID0gbnVsbDsKICAgICAgICAgICAgICAgIGdldFNjcm9sbFBvc2l0aW9uID0gbnVsbDsKICAgICAgICAgICAgICAgIGdldFNjcm9sbFJlc3RvcmF0aW9uS2V5ID0gbnVsbDsKICAgICAgICAgICAgICB9OwogICAgICAgICAgICB9CgogICAgICAgICAgICBmdW5jdGlvbiBzYXZlU2Nyb2xsUG9zaXRpb24obG9jYXRpb24sIG1hdGNoZXMpIHsKICAgICAgICAgICAgICBpZiAoc2F2ZWRTY3JvbGxQb3NpdGlvbnMgJiYgZ2V0U2Nyb2xsUmVzdG9yYXRpb25LZXkgJiYgZ2V0U2Nyb2xsUG9zaXRpb24pIHsKICAgICAgICAgICAgICAgIHZhciB1c2VyTWF0Y2hlcyA9IG1hdGNoZXMubWFwKChtKSA9PiBjcmVhdGVVc2VNYXRjaGVzTWF0Y2gobSwgc3RhdGUubG9hZGVyRGF0YSkpOwogICAgICAgICAgICAgICAgdmFyIGtleSA9IGdldFNjcm9sbFJlc3RvcmF0aW9uS2V5KGxvY2F0aW9uLCB1c2VyTWF0Y2hlcykgfHwgbG9jYXRpb24ua2V5OwogICAgICAgICAgICAgICAgc2F2ZWRTY3JvbGxQb3NpdGlvbnNba2V5XSA9IGdldFNjcm9sbFBvc2l0aW9uKCk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICBmdW5jdGlvbiBnZXRTYXZlZFNjcm9sbFBvc2l0aW9uKGxvY2F0aW9uLCBtYXRjaGVzKSB7CiAgICAgICAgICAgICAgaWYgKHNhdmVkU2Nyb2xsUG9zaXRpb25zICYmIGdldFNjcm9sbFJlc3RvcmF0aW9uS2V5ICYmIGdldFNjcm9sbFBvc2l0aW9uKSB7CiAgICAgICAgICAgICAgICB2YXIgdXNlck1hdGNoZXMgPSBtYXRjaGVzLm1hcCgobSkgPT4gY3JlYXRlVXNlTWF0Y2hlc01hdGNoKG0sIHN0YXRlLmxvYWRlckRhdGEpKTsKICAgICAgICAgICAgICAgIHZhciBrZXkgPSBnZXRTY3JvbGxSZXN0b3JhdGlvbktleShsb2NhdGlvbiwgdXNlck1hdGNoZXMpIHx8IGxvY2F0aW9uLmtleTsKICAgICAgICAgICAgICAgIHZhciB5ID0gc2F2ZWRTY3JvbGxQb3NpdGlvbnNba2V5XTsKCiAgICAgICAgICAgICAgICBpZiAodHlwZW9mIHkgPT09ICJudW1iZXIiKSB7CiAgICAgICAgICAgICAgICAgIHJldHVybiB5OwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJvdXRlciA9IHsKICAgICAgICAgICAgICBnZXQgYmFzZW5hbWUoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gaW5pdC5iYXNlbmFtZTsKICAgICAgICAgICAgICB9LAoKICAgICAgICAgICAgICBnZXQgc3RhdGUoKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gc3RhdGU7CiAgICAgICAgICAgICAgfSwKCiAgICAgICAgICAgICAgZ2V0IHJvdXRlcygpIHsKICAgICAgICAgICAgICAgIHJldHVybiBkYXRhUm91dGVzOwogICAgICAgICAgICAgIH0sCgogICAgICAgICAgICAgIGluaXRpYWxpemU6IGluaXRpYWxpemUsCiAgICAgICAgICAgICAgc3Vic2NyaWJlOiBzdWJzY3JpYmUsCiAgICAgICAgICAgICAgZW5hYmxlU2Nyb2xsUmVzdG9yYXRpb246IGVuYWJsZVNjcm9sbFJlc3RvcmF0aW9uLAogICAgICAgICAgICAgIG5hdmlnYXRlOiBuYXZpZ2F0ZSwKICAgICAgICAgICAgICBmZXRjaDogZmV0Y2gsCiAgICAgICAgICAgICAgcmV2YWxpZGF0ZTogcmV2YWxpZGF0ZSwKICAgICAgICAgICAgICAvLyBQYXNzdGhyb3VnaCB0byBoaXN0b3J5LWF3YXJlIGNyZWF0ZUhyZWYgdXNlZCBieSB1c2VIcmVmIHNvIHdlIGdldCBwcm9wZXIKICAgICAgICAgICAgICAvLyBoYXNoLWF3YXJlIFVSTHMgaW4gRE9NIHBhdGhzCiAgICAgICAgICAgICAgY3JlYXRlSHJlZjogKHRvKSA9PiBpbml0Lmhpc3RvcnkuY3JlYXRlSHJlZih0byksCiAgICAgICAgICAgICAgZW5jb2RlTG9jYXRpb246ICh0bykgPT4gaW5pdC5oaXN0b3J5LmVuY29kZUxvY2F0aW9uKHRvKSwKICAgICAgICAgICAgICBnZXRGZXRjaGVyOiBnZXRGZXRjaGVyLAogICAgICAgICAgICAgIGRlbGV0ZUZldGNoZXI6IGRlbGV0ZUZldGNoZXIsCiAgICAgICAgICAgICAgZGlzcG9zZTogZGlzcG9zZSwKICAgICAgICAgICAgICBnZXRCbG9ja2VyOiBnZXRCbG9ja2VyLAogICAgICAgICAgICAgIGRlbGV0ZUJsb2NrZXI6IGRlbGV0ZUJsb2NrZXIsCiAgICAgICAgICAgICAgX2ludGVybmFsRmV0Y2hDb250cm9sbGVyczogZmV0Y2hDb250cm9sbGVycywKICAgICAgICAgICAgICBfaW50ZXJuYWxBY3RpdmVEZWZlcnJlZHM6IGFjdGl2ZURlZmVycmVkcwogICAgICAgICAgICB9OwogICAgICAgICAgICByZXR1cm4gcm91dGVyOwogICAgICAgICAgfSAvLyNlbmRyZWdpb24KICAgICAgICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCiAgICAgICAgICAvLyNyZWdpb24gY3JlYXRlU3RhdGljSGFuZGxlcgogICAgICAgICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KCiAgICAgICAgICB2YXIgVU5TQUZFX0RFRkVSUkVEX1NZTUJPTCA9IFN5bWJvbCgiZGVmZXJyZWQiKTsKICAgICAgICAgIGZ1bmN0aW9uIGNyZWF0ZVN0YXRpY0hhbmRsZXIocm91dGVzLCBvcHRzKSB7CiAgICAgICAgICAgIHJvdXRlcl9pbnZhcmlhbnQocm91dGVzLmxlbmd0aCA+IDAsICJZb3UgbXVzdCBwcm92aWRlIGEgbm9uLWVtcHR5IHJvdXRlcyBhcnJheSB0byBjcmVhdGVTdGF0aWNIYW5kbGVyIik7CiAgICAgICAgICAgIHZhciBkYXRhUm91dGVzID0gY29udmVydFJvdXRlc1RvRGF0YVJvdXRlcyhyb3V0ZXMpOwogICAgICAgICAgICB2YXIgYmFzZW5hbWUgPSAob3B0cyA/IG9wdHMuYmFzZW5hbWUgOiBudWxsKSB8fCAiLyI7CiAgICAgICAgICAgIC8qKgogICAgICAgICAgICAgKiBUaGUgcXVlcnkoKSBtZXRob2QgaXMgaW50ZW5kZWQgZm9yIGRvY3VtZW50IHJlcXVlc3RzLCBpbiB3aGljaCB3ZSB3YW50IHRvCiAgICAgICAgICAgICAqIGNhbGwgYW4gb3B0aW9uYWwgYWN0aW9uIGFuZCBwb3RlbnRpYWxseSBtdWx0aXBsZSBsb2FkZXJzIGZvciBhbGwgbmVzdGVkCiAgICAgICAgICAgICAqIHJvdXRlcy4gIEl0IHJldHVybnMgYSBTdGF0aWNIYW5kbGVyQ29udGV4dCBvYmplY3QsIHdoaWNoIGlzIHZlcnkgc2ltaWxhcgogICAgICAgICAgICAgKiB0byB0aGUgcm91dGVyIHN0YXRlIChsb2NhdGlvbiwgbG9hZGVyRGF0YSwgYWN0aW9uRGF0YSwgZXJyb3JzLCBldGMuKSBhbmQKICAgICAgICAgICAgICogYWxzbyBhZGRzIFNTUi1zcGVjaWZpYyBpbmZvcm1hdGlvbiBzdWNoIGFzIHRoZSBzdGF0dXNDb2RlIGFuZCBoZWFkZXJzCiAgICAgICAgICAgICAqIGZyb20gYWN0aW9uL2xvYWRlcnMgUmVzcG9uc2VzLgogICAgICAgICAgICAgKgogICAgICAgICAgICAgKiBJdCBfc2hvdWxkXyBuZXZlciB0aHJvdyBhbmQgc2hvdWxkIHJlcG9ydCBhbGwgZXJyb3JzIHRocm91Z2ggdGhlCiAgICAgICAgICAgICAqIHJldHVybmVkIGNvbnRleHQuZXJyb3JzIG9iamVjdCwgcHJvcGVybHkgYXNzb2NpYXRpbmcgZXJyb3JzIHRvIHRoZWlyIGVycm9yCiAgICAgICAgICAgICAqIGJvdW5kYXJ5LiAgQWRkaXRpb25hbGx5LCBpdCB0cmFja3MgX2RlZXBlc3RSZW5kZXJlZEJvdW5kYXJ5SWQgd2hpY2ggY2FuIGJlCiAgICAgICAgICAgICAqIHVzZWQgdG8gZW11bGF0ZSBSZWFjdCBlcnJvciBib3VuZGFyaWVzIGR1cmluZyBTU3IgYnkgcGVyZm9ybWluZyBhIHNlY29uZAogICAgICAgICAgICAgKiBwYXNzIG9ubHkgZG93biB0byB0aGUgYm91bmRhcnlJZC4KICAgICAgICAgICAgICoKICAgICAgICAgICAgICogVGhlIG9uZSBleGNlcHRpb24gd2hlcmUgd2UgZG8gbm90IHJldHVybiBhIFN0YXRpY0hhbmRsZXJDb250ZXh0IGlzIHdoZW4gYQogICAgICAgICAgICAgKiByZWRpcmVjdCByZXNwb25zZSBpcyByZXR1cm5lZCBvciB0aHJvd24gZnJvbSBhbnkgYWN0aW9uL2xvYWRlci4gIFdlCiAgICAgICAgICAgICAqIHByb3BhZ2F0ZSB0aGF0IG91dCBhbmQgcmV0dXJuIHRoZSByYXcgUmVzcG9uc2Ugc28gdGhlIEhUVFAgc2VydmVyIGNhbgogICAgICAgICAgICAgKiByZXR1cm4gaXQgZGlyZWN0bHkuCiAgICAgICAgICAgICAqL2Z1bmN0aW9uCgogICAgICAgICAgICBxdWVyeShfeDQyLCBfeDQzKSB7cmV0dXJuIF9xdWVyeS5hcHBseSh0aGlzLCBhcmd1bWVudHMpO30KCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgogICAgICAgICAgICAvKioKICAgICAgICAgICAgICogVGhlIHF1ZXJ5Um91dGUoKSBtZXRob2QgaXMgaW50ZW5kZWQgZm9yIHRhcmdldGVkIHJvdXRlIHJlcXVlc3RzLCBlaXRoZXIKICAgICAgICAgICAgICogZm9yIGZldGNoID9fZGF0YSByZXF1ZXN0cyBvciByZXNvdXJjZSByb3V0ZSByZXF1ZXN0cy4gIEluIHRoaXMgY2FzZSwgd2UKICAgICAgICAgICAgICogYXJlIG9ubHkgZXZlciBjYWxsaW5nIGEgc2luZ2xlIGFjdGlvbiBvciBsb2FkZXIsIGFuZCB3ZSBhcmUgcmV0dXJuaW5nIHRoZQogICAgICAgICAgICAgKiByZXR1cm5lZCB2YWx1ZSBkaXJlY3RseS4gIEluIG1vc3QgY2FzZXMsIHRoaXMgd2lsbCBiZSBhIFJlc3BvbnNlIHJldHVybmVkCiAgICAgICAgICAgICAqIGZyb20gdGhlIGFjdGlvbi9sb2FkZXIsIGJ1dCBpdCBtYXkgYmUgYSBwcmltaXRpdmUgb3Igb3RoZXIgdmFsdWUgYXMgd2VsbCAtCiAgICAgICAgICAgICAqIGFuZCBpbiBzdWNoIGNhc2VzIHRoZSBjYWxsaW5nIGNvbnRleHQgc2hvdWxkIGhhbmRsZSB0aGF0IGFjY29yZGluZ2x5LgogICAgICAgICAgICAgKgogICAgICAgICAgICAgKiBXZSBkbyByZXNwZWN0IHRoZSB0aHJvdy9yZXR1cm4gZGlmZmVyZW50aWF0aW9uLCBzbyBpZiBhbiBhY3Rpb24vbG9hZGVyCiAgICAgICAgICAgICAqIHRocm93cywgdGhlbiB0aGlzIG1ldGhvZCB3aWxsIHRocm93IHRoZSB2YWx1ZS4gIFRoaXMgaXMgaW1wb3J0YW50IHNvIHdlCiAgICAgICAgICAgICAqIGNhbiBkbyBwcm9wZXIgYm91bmRhcnkgaWRlbnRpZmljYXRpb24gaW4gUmVtaXggd2hlcmUgYSB0aHJvd24gUmVzcG9uc2UKICAgICAgICAgICAgICogbXVzdCBnbyB0byB0aGUgQ2F0Y2ggQm91bmRhcnkgYnV0IGEgcmV0dXJuZWQgUmVzcG9uc2UgaXMgaGFwcHktcGF0aC4KICAgICAgICAgICAgICoKICAgICAgICAgICAgICogT25lIHRoaW5nIHRvIG5vdGUgaXMgdGhhdCBhbnkgUm91dGVyLWluaXRpYXRlZCBFcnJvcnMgdGhhdCBtYWtlIHNlbnNlCiAgICAgICAgICAgICAqIHRvIGFzc29jaWF0ZSB3aXRoIGEgc3RhdHVzIGNvZGUgd2lsbCBiZSB0aHJvd24gYXMgYW4gRXJyb3JSZXNwb25zZQogICAgICAgICAgICAgKiBpbnN0YW5jZSB3aGljaCBpbmNsdWRlIHRoZSByYXcgRXJyb3IsIHN1Y2ggdGhhdCB0aGUgY2FsbGluZyBjb250ZXh0IGNhbgogICAgICAgICAgICAgKiBzZXJpYWxpemUgdGhlIGVycm9yIGFzIHRoZXkgc2VlIGZpdCB3aGlsZSBpbmNsdWRpbmcgdGhlIHByb3BlciByZXNwb25zZQogICAgICAgICAgICAgKiBjb2RlLiAgRXhhbXBsZXMgaGVyZSBhcmUgNDA0IGFuZCA0MDUgZXJyb3JzIHRoYXQgb2NjdXIgcHJpb3IgdG8gcmVhY2hpbmcKICAgICAgICAgICAgICogYW55IHVzZXItZGVmaW5lZCBsb2FkZXJzLgogICAgICAgICAgICAgKi9mdW5jdGlvbiBfcXVlcnkoKSB7X3F1ZXJ5ID0gX2FzeW5jVG9HZW5lcmF0b3IyKCAvKiNfX1BVUkVfXyovX3JlZ2VuZXJhdG9yUnVudGltZTIoKS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUxMShyZXF1ZXN0LCBfdGVtcDIpIHt2YXIgX3JlZjEzLCByZXF1ZXN0Q29udGV4dCwgdXJsLCBtZXRob2QsIGxvY2F0aW9uLCBtYXRjaGVzLCBlcnJvciwgX2dldFNob3J0Q2lyY3VpdE1hdGNoMywgbWV0aG9kTm90QWxsb3dlZE1hdGNoZXMsIHJvdXRlLCBfZXJyb3IzLCBfZ2V0U2hvcnRDaXJjdWl0TWF0Y2g0LCBub3RGb3VuZE1hdGNoZXMsIF9yb3V0ZTIsIHJlc3VsdDtyZXR1cm4gX3JlZ2VuZXJhdG9yUnVudGltZTIoKS53cmFwKGZ1bmN0aW9uIF9jYWxsZWUxMSQoX2NvbnRleHQxMSkge3doaWxlICgxKSBzd2l0Y2ggKF9jb250ZXh0MTEucHJldiA9IF9jb250ZXh0MTEubmV4dCkge2Nhc2UgMDpfcmVmMTMgPSBfdGVtcDIgPT09IHZvaWQgMCA/IHt9IDogX3RlbXAyLCByZXF1ZXN0Q29udGV4dCA9IF9yZWYxMy5yZXF1ZXN0Q29udGV4dDt1cmwgPSBuZXcgVVJMKHJlcXVlc3QudXJsKTttZXRob2QgPSByZXF1ZXN0Lm1ldGhvZC50b0xvd2VyQ2FzZSgpO2xvY2F0aW9uID0gY3JlYXRlTG9jYXRpb24oIiIsIHJvdXRlcl9jcmVhdGVQYXRoKHVybCksIG51bGwsICJkZWZhdWx0Iik7bWF0Y2hlcyA9IG1hdGNoUm91dGVzKGRhdGFSb3V0ZXMsIGxvY2F0aW9uLCBiYXNlbmFtZSk7IC8vIFNTUiBzdXBwb3J0cyBIRUFEIHJlcXVlc3RzIHdoaWxlIFNQQSBkb2Vzbid0CiAgICAgICAgICAgICAgICAgICAgICBpZiAoISghaXNWYWxpZE1ldGhvZChtZXRob2QpICYmIG1ldGhvZCAhPT0gImhlYWQiKSkge19jb250ZXh0MTEubmV4dCA9IDExO2JyZWFrO31lcnJvciA9IGdldEludGVybmFsUm91dGVyRXJyb3IoNDA1LCB7IG1ldGhvZDogbWV0aG9kIH0pO19nZXRTaG9ydENpcmN1aXRNYXRjaDMgPSBnZXRTaG9ydENpcmN1aXRNYXRjaGVzKGRhdGFSb3V0ZXMpLCBtZXRob2ROb3RBbGxvd2VkTWF0Y2hlcyA9IF9nZXRTaG9ydENpcmN1aXRNYXRjaDMubWF0Y2hlcywgcm91dGUgPSBfZ2V0U2hvcnRDaXJjdWl0TWF0Y2gzLnJvdXRlO3JldHVybiBfY29udGV4dDExLmFicnVwdCgicmV0dXJuIiwgeyBiYXNlbmFtZTogYmFzZW5hbWUsIGxvY2F0aW9uOiBsb2NhdGlvbiwgbWF0Y2hlczogbWV0aG9kTm90QWxsb3dlZE1hdGNoZXMsIGxvYWRlckRhdGE6IHt9LCBhY3Rpb25EYXRhOiBudWxsLCBlcnJvcnM6IF9kZWZpbmVQcm9wZXJ0eTIoe30sIHJvdXRlLmlkLCBlcnJvciksIHN0YXR1c0NvZGU6IGVycm9yLnN0YXR1cywgbG9hZGVySGVhZGVyczoge30sIGFjdGlvbkhlYWRlcnM6IHt9LCBhY3RpdmVEZWZlcnJlZHM6IG51bGwgfSk7Y2FzZSAxMTppZiAobWF0Y2hlcykge19jb250ZXh0MTEubmV4dCA9IDE1O2JyZWFrO31fZXJyb3IzID0gZ2V0SW50ZXJuYWxSb3V0ZXJFcnJvcig0MDQsIHsgcGF0aG5hbWU6IGxvY2F0aW9uLnBhdGhuYW1lIH0pO19nZXRTaG9ydENpcmN1aXRNYXRjaDQgPSBnZXRTaG9ydENpcmN1aXRNYXRjaGVzKGRhdGFSb3V0ZXMpLCBub3RGb3VuZE1hdGNoZXMgPSBfZ2V0U2hvcnRDaXJjdWl0TWF0Y2g0Lm1hdGNoZXMsIF9yb3V0ZTIgPSBfZ2V0U2hvcnRDaXJjdWl0TWF0Y2g0LnJvdXRlO3JldHVybiBfY29udGV4dDExLmFicnVwdCgicmV0dXJuIiwgeyBiYXNlbmFtZTogYmFzZW5hbWUsIGxvY2F0aW9uOiBsb2NhdGlvbiwgbWF0Y2hlczogbm90Rm91bmRNYXRjaGVzLCBsb2FkZXJEYXRhOiB7fSwgYWN0aW9uRGF0YTogbnVsbCwgZXJyb3JzOiBfZGVmaW5lUHJvcGVydHkyKHt9LCBfcm91dGUyLmlkLCBfZXJyb3IzKSwgc3RhdHVzQ29kZTogX2Vycm9yMy5zdGF0dXMsIGxvYWRlckhlYWRlcnM6IHt9LCBhY3Rpb25IZWFkZXJzOiB7fSwgYWN0aXZlRGVmZXJyZWRzOiBudWxsIH0pO2Nhc2UgMTU6X2NvbnRleHQxMS5uZXh0ID0gMTc7cmV0dXJuIHF1ZXJ5SW1wbChyZXF1ZXN0LCBsb2NhdGlvbiwgbWF0Y2hlcywgcmVxdWVzdENvbnRleHQpO2Nhc2UgMTc6cmVzdWx0ID0gX2NvbnRleHQxMS5zZW50O2lmICghaXNSZXNwb25zZShyZXN1bHQpKSB7X2NvbnRleHQxMS5uZXh0ID0gMjA7YnJlYWs7fXJldHVybiBfY29udGV4dDExLmFicnVwdCgicmV0dXJuIiwgcmVzdWx0KTtjYXNlIDIwOnJldHVybiBfY29udGV4dDExLmFicnVwdCgicmV0dXJuIiwgX2V4dGVuZHMoeyBsb2NhdGlvbjogbG9jYXRpb24sIGJhc2VuYW1lOiBiYXNlbmFtZSB9LCByZXN1bHQpKTtjYXNlIDIxOmNhc2UgImVuZCI6cmV0dXJuIF9jb250ZXh0MTEuc3RvcCgpO319LCBfY2FsbGVlMTEpO30pKTtyZXR1cm4gX3F1ZXJ5LmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7fWZ1bmN0aW9uCgogICAgICAgICAgICBxdWVyeVJvdXRlKF94NDQsIF94NDUpIHtyZXR1cm4gX3F1ZXJ5Um91dGUuYXBwbHkodGhpcywgYXJndW1lbnRzKTt9ZnVuY3Rpb24gX3F1ZXJ5Um91dGUoKSB7X3F1ZXJ5Um91dGUgPSBfYXN5bmNUb0dlbmVyYXRvcjIoIC8qI19fUFVSRV9fKi9fcmVnZW5lcmF0b3JSdW50aW1lMigpLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTEyKHJlcXVlc3QsIF90ZW1wMykge3ZhciBfcmVmMTQsIHJvdXRlSWQsIHJlcXVlc3RDb250ZXh0LCB1cmwsIG1ldGhvZCwgbG9jYXRpb24sIG1hdGNoZXMsIG1hdGNoLCByZXN1bHQsIGVycm9yLCBfcmVzdWx0JGFjdGl2ZURlZmVycmUsIGRhdGE7cmV0dXJuIF9yZWdlbmVyYXRvclJ1bnRpbWUyKCkud3JhcChmdW5jdGlvbiBfY2FsbGVlMTIkKF9jb250ZXh0MTIpIHt3aGlsZSAoMSkgc3dpdGNoIChfY29udGV4dDEyLnByZXYgPSBfY29udGV4dDEyLm5leHQpIHtjYXNlIDA6X3JlZjE0ID0KCgoKICAgICAgICAgICAgICAgICAgICAgIF90ZW1wMyA9PT0gdm9pZCAwID8ge30gOiBfdGVtcDMsIHJvdXRlSWQgPSBfcmVmMTQucm91dGVJZCwgcmVxdWVzdENvbnRleHQgPSBfcmVmMTQucmVxdWVzdENvbnRleHQ7CiAgICAgICAgICAgICAgICAgICAgICB1cmwgPSBuZXcgVVJMKHJlcXVlc3QudXJsKTsKICAgICAgICAgICAgICAgICAgICAgIG1ldGhvZCA9IHJlcXVlc3QubWV0aG9kLnRvTG93ZXJDYXNlKCk7CiAgICAgICAgICAgICAgICAgICAgICBsb2NhdGlvbiA9IGNyZWF0ZUxvY2F0aW9uKCIiLCByb3V0ZXJfY3JlYXRlUGF0aCh1cmwpLCBudWxsLCAiZGVmYXVsdCIpOwogICAgICAgICAgICAgICAgICAgICAgbWF0Y2hlcyA9IG1hdGNoUm91dGVzKGRhdGFSb3V0ZXMsIGxvY2F0aW9uLCBiYXNlbmFtZSk7IC8vIFNTUiBzdXBwb3J0cyBIRUFEIHJlcXVlc3RzIHdoaWxlIFNQQSBkb2Vzbid0CiAgICAgICAgICAgICAgICAgICAgICBpZiAoISgKICAgICAgICAgICAgICAgICAgICAgICFpc1ZhbGlkTWV0aG9kKG1ldGhvZCkgJiYgbWV0aG9kICE9PSAiaGVhZCIgJiYgbWV0aG9kICE9PSAib3B0aW9ucyIpKSB7X2NvbnRleHQxMi5uZXh0ID0gOTticmVhazt9dGhyb3cgKAogICAgICAgICAgICAgICAgICAgICAgICBnZXRJbnRlcm5hbFJvdXRlckVycm9yKDQwNSwgewogICAgICAgICAgICAgICAgICAgICAgICAgIG1ldGhvZDogbWV0aG9kCiAgICAgICAgICAgICAgICAgICAgICAgIH0pKTtjYXNlIDk6aWYgKAogICAgICAgICAgICAgICAgICAgICAgbWF0Y2hlcykge19jb250ZXh0MTIubmV4dCA9IDExO2JyZWFrO310aHJvdyAoCiAgICAgICAgICAgICAgICAgICAgICAgIGdldEludGVybmFsUm91dGVyRXJyb3IoNDA0LCB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgcGF0aG5hbWU6IGxvY2F0aW9uLnBhdGhuYW1lCiAgICAgICAgICAgICAgICAgICAgICAgIH0pKTtjYXNlIDExOgoKCiAgICAgICAgICAgICAgICAgICAgICBtYXRjaCA9IHJvdXRlSWQgPyBtYXRjaGVzLmZpbmQoKG0pID0+IG0ucm91dGUuaWQgPT09IHJvdXRlSWQpIDogZ2V0VGFyZ2V0TWF0Y2gobWF0Y2hlcywgbG9jYXRpb24pO2lmICghKAoKICAgICAgICAgICAgICAgICAgICAgIHJvdXRlSWQgJiYgIW1hdGNoKSkge19jb250ZXh0MTIubmV4dCA9IDE2O2JyZWFrO310aHJvdyAoCiAgICAgICAgICAgICAgICAgICAgICAgIGdldEludGVybmFsUm91dGVyRXJyb3IoNDAzLCB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgcGF0aG5hbWU6IGxvY2F0aW9uLnBhdGhuYW1lLAogICAgICAgICAgICAgICAgICAgICAgICAgIHJvdXRlSWQ6IHJvdXRlSWQKICAgICAgICAgICAgICAgICAgICAgICAgfSkpO2Nhc2UgMTY6aWYgKAogICAgICAgICAgICAgICAgICAgICAgbWF0Y2gpIHtfY29udGV4dDEyLm5leHQgPSAxODticmVhazt9dGhyb3cgKAoKICAgICAgICAgICAgICAgICAgICAgICAgZ2V0SW50ZXJuYWxSb3V0ZXJFcnJvcig0MDQsIHsKICAgICAgICAgICAgICAgICAgICAgICAgICBwYXRobmFtZTogbG9jYXRpb24ucGF0aG5hbWUKICAgICAgICAgICAgICAgICAgICAgICAgfSkpO2Nhc2UgMTg6X2NvbnRleHQxMi5uZXh0ID0gMjA7cmV0dXJuICgKCgogICAgICAgICAgICAgICAgICAgICAgICBxdWVyeUltcGwocmVxdWVzdCwgbG9jYXRpb24sIG1hdGNoZXMsIHJlcXVlc3RDb250ZXh0LCBtYXRjaCkpO2Nhc2UgMjA6cmVzdWx0ID0gX2NvbnRleHQxMi5zZW50O2lmICghCgogICAgICAgICAgICAgICAgICAgICAgaXNSZXNwb25zZShyZXN1bHQpKSB7X2NvbnRleHQxMi5uZXh0ID0gMjM7YnJlYWs7fXJldHVybiBfY29udGV4dDEyLmFicnVwdCgicmV0dXJuIiwKICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdCk7Y2FzZSAyMzoKCgogICAgICAgICAgICAgICAgICAgICAgZXJyb3IgPSByZXN1bHQuZXJyb3JzID8gT2JqZWN0LnZhbHVlcyhyZXN1bHQuZXJyb3JzKVswXSA6IHVuZGVmaW5lZDtpZiAoISgKCiAgICAgICAgICAgICAgICAgICAgICBlcnJvciAhPT0gdW5kZWZpbmVkKSkge19jb250ZXh0MTIubmV4dCA9IDI2O2JyZWFrO310aHJvdyAoCgoKCgogICAgICAgICAgICAgICAgICAgICAgICBlcnJvcik7Y2FzZSAyNjppZiAoIQoKCgogICAgICAgICAgICAgICAgICAgICAgcmVzdWx0LmFjdGlvbkRhdGEpIHtfY29udGV4dDEyLm5leHQgPSAyODticmVhazt9cmV0dXJuIF9jb250ZXh0MTIuYWJydXB0KCJyZXR1cm4iLAogICAgICAgICAgICAgICAgICAgICAgT2JqZWN0LnZhbHVlcyhyZXN1bHQuYWN0aW9uRGF0YSlbMF0pO2Nhc2UgMjg6aWYgKCEKCgogICAgICAgICAgICAgICAgICAgICAgcmVzdWx0LmxvYWRlckRhdGEpIHtfY29udGV4dDEyLm5leHQgPSAzMjticmVhazt9CgoKICAgICAgICAgICAgICAgICAgICAgIGRhdGEgPSBPYmplY3QudmFsdWVzKHJlc3VsdC5sb2FkZXJEYXRhKVswXTsKCiAgICAgICAgICAgICAgICAgICAgICBpZiAoKF9yZXN1bHQkYWN0aXZlRGVmZXJyZSA9IHJlc3VsdC5hY3RpdmVEZWZlcnJlZHMpICE9IG51bGwgJiYgX3Jlc3VsdCRhY3RpdmVEZWZlcnJlW21hdGNoLnJvdXRlLmlkXSkgewogICAgICAgICAgICAgICAgICAgICAgICBkYXRhW1VOU0FGRV9ERUZFUlJFRF9TWU1CT0xdID0gcmVzdWx0LmFjdGl2ZURlZmVycmVkc1ttYXRjaC5yb3V0ZS5pZF07CiAgICAgICAgICAgICAgICAgICAgICB9cmV0dXJuIF9jb250ZXh0MTIuYWJydXB0KCJyZXR1cm4iLAoKICAgICAgICAgICAgICAgICAgICAgIGRhdGEpO2Nhc2UgMzI6cmV0dXJuIF9jb250ZXh0MTIuYWJydXB0KCJyZXR1cm4iLAoKCiAgICAgICAgICAgICAgICAgICAgICB1bmRlZmluZWQpO2Nhc2UgMzM6Y2FzZSAiZW5kIjpyZXR1cm4gX2NvbnRleHQxMi5zdG9wKCk7fX0sIF9jYWxsZWUxMik7fSkpO3JldHVybiBfcXVlcnlSb3V0ZS5hcHBseSh0aGlzLCBhcmd1bWVudHMpO31mdW5jdGlvbgoKCiAgICAgICAgICAgIHF1ZXJ5SW1wbChfeDQ2LCBfeDQ3LCBfeDQ4LCBfeDQ5LCBfeDUwKSB7cmV0dXJuIF9xdWVyeUltcGwuYXBwbHkodGhpcywgYXJndW1lbnRzKTt9ZnVuY3Rpb24gX3F1ZXJ5SW1wbCgpIHtfcXVlcnlJbXBsID0gX2FzeW5jVG9HZW5lcmF0b3IyKCAvKiNfX1BVUkVfXyovX3JlZ2VuZXJhdG9yUnVudGltZTIoKS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUxMyhyZXF1ZXN0LCBsb2NhdGlvbiwgbWF0Y2hlcywgcmVxdWVzdENvbnRleHQsIHJvdXRlTWF0Y2gpIHt2YXIgX3Jlc3VsdCwgcmVzdWx0O3JldHVybiBfcmVnZW5lcmF0b3JSdW50aW1lMigpLndyYXAoZnVuY3Rpb24gX2NhbGxlZTEzJChfY29udGV4dDEzKSB7d2hpbGUgKDEpIHN3aXRjaCAoX2NvbnRleHQxMy5wcmV2ID0gX2NvbnRleHQxMy5uZXh0KSB7Y2FzZSAwOgogICAgICAgICAgICAgICAgICAgICAgcm91dGVyX2ludmFyaWFudChyZXF1ZXN0LnNpZ25hbCwgInF1ZXJ5KCkvcXVlcnlSb3V0ZSgpIHJlcXVlc3RzIG11c3QgY29udGFpbiBhbiBBYm9ydENvbnRyb2xsZXIgc2lnbmFsIik7X2NvbnRleHQxMy5wcmV2ID0gMTtpZiAoIQoKCiAgICAgICAgICAgICAgICAgICAgICBpc011dGF0aW9uTWV0aG9kKHJlcXVlc3QubWV0aG9kLnRvTG93ZXJDYXNlKCkpKSB7X2NvbnRleHQxMy5uZXh0ID0gNzticmVhazt9X2NvbnRleHQxMy5uZXh0ID0gNTtyZXR1cm4gKAogICAgICAgICAgICAgICAgICAgICAgICBzdWJtaXQocmVxdWVzdCwgbWF0Y2hlcywgcm91dGVNYXRjaCB8fCBnZXRUYXJnZXRNYXRjaChtYXRjaGVzLCBsb2NhdGlvbiksIHJlcXVlc3RDb250ZXh0LCByb3V0ZU1hdGNoICE9IG51bGwpKTtjYXNlIDU6X3Jlc3VsdCA9IF9jb250ZXh0MTMuc2VudDtyZXR1cm4gX2NvbnRleHQxMy5hYnJ1cHQoInJldHVybiIsCiAgICAgICAgICAgICAgICAgICAgICBfcmVzdWx0KTtjYXNlIDc6X2NvbnRleHQxMy5uZXh0ID0gOTtyZXR1cm4gKAoKCiAgICAgICAgICAgICAgICAgICAgICAgIGxvYWRSb3V0ZURhdGEocmVxdWVzdCwgbWF0Y2hlcywgcmVxdWVzdENvbnRleHQsIHJvdXRlTWF0Y2gpKTtjYXNlIDk6cmVzdWx0ID0gX2NvbnRleHQxMy5zZW50O3JldHVybiBfY29udGV4dDEzLmFicnVwdCgicmV0dXJuIiwKICAgICAgICAgICAgICAgICAgICAgIGlzUmVzcG9uc2UocmVzdWx0KSA/IHJlc3VsdCA6IF9leHRlbmRzKHt9LCByZXN1bHQsIHsKICAgICAgICAgICAgICAgICAgICAgICAgYWN0aW9uRGF0YTogbnVsbCwKICAgICAgICAgICAgICAgICAgICAgICAgYWN0aW9uSGVhZGVyczoge30KICAgICAgICAgICAgICAgICAgICAgIH0pKTtjYXNlIDEzOl9jb250ZXh0MTMucHJldiA9IDEzO19jb250ZXh0MTMudDAgPSBfY29udGV4dDEzWyJjYXRjaCJdKDEpO2lmICghCgoKCgogICAgICAgICAgICAgICAgICAgICAgaXNRdWVyeVJvdXRlUmVzcG9uc2UoX2NvbnRleHQxMy50MCkpIHtfY29udGV4dDEzLm5leHQgPSAxOTticmVhazt9aWYgKCEoCiAgICAgICAgICAgICAgICAgICAgICBfY29udGV4dDEzLnQwLnR5cGUgPT09IFJlc3VsdFR5cGUuZXJyb3IgJiYgIWlzUmVkaXJlY3RSZXNwb25zZShfY29udGV4dDEzLnQwLnJlc3BvbnNlKSkpIHtfY29udGV4dDEzLm5leHQgPSAxODticmVhazt9dGhyb3cgKAogICAgICAgICAgICAgICAgICAgICAgICBfY29udGV4dDEzLnQwLnJlc3BvbnNlKTtjYXNlIDE4OnJldHVybiBfY29udGV4dDEzLmFicnVwdCgicmV0dXJuIiwKCgogICAgICAgICAgICAgICAgICAgICAgX2NvbnRleHQxMy50MC5yZXNwb25zZSk7Y2FzZSAxOTppZiAoIQoKCgoKICAgICAgICAgICAgICAgICAgICAgIGlzUmVkaXJlY3RSZXNwb25zZShfY29udGV4dDEzLnQwKSkge19jb250ZXh0MTMubmV4dCA9IDIxO2JyZWFrO31yZXR1cm4gX2NvbnRleHQxMy5hYnJ1cHQoInJldHVybiIsIF9jb250ZXh0MTMudDApO2Nhc2UgMjE6dGhyb3cgX2NvbnRleHQxMy50MDtjYXNlIDIyOmNhc2UgImVuZCI6cmV0dXJuIF9jb250ZXh0MTMuc3RvcCgpO319LCBfY2FsbGVlMTMsIG51bGwsIFtbMSwgMTNdXSk7fSkpO3JldHVybiBfcXVlcnlJbXBsLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7fWZ1bmN0aW9uCgoKCgoKCgogICAgICAgICAgICBzdWJtaXQoX3g1MSwgX3g1MiwgX3g1MywgX3g1NCwgX3g1NSkge3JldHVybiBfc3VibWl0LmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7fWZ1bmN0aW9uIF9zdWJtaXQoKSB7X3N1Ym1pdCA9IF9hc3luY1RvR2VuZXJhdG9yMiggLyojX19QVVJFX18qL19yZWdlbmVyYXRvclJ1bnRpbWUyKCkubWFyayhmdW5jdGlvbiBfY2FsbGVlMTQocmVxdWVzdCwgbWF0Y2hlcywgYWN0aW9uTWF0Y2gsIHJlcXVlc3RDb250ZXh0LCBpc1JvdXRlUmVxdWVzdCkge3ZhciByZXN1bHQsIGVycm9yLCBtZXRob2QsIF9lcnJvcjQsIGJvdW5kYXJ5TWF0Y2gsIF9jb250ZXh0MTQsIGxvYWRlclJlcXVlc3QsIGNvbnRleHQ7cmV0dXJuIF9yZWdlbmVyYXRvclJ1bnRpbWUyKCkud3JhcChmdW5jdGlvbiBfY2FsbGVlMTQkKF9jb250ZXh0MTUpIHt3aGlsZSAoMSkgc3dpdGNoIChfY29udGV4dDE1LnByZXYgPSBfY29udGV4dDE1Lm5leHQpIHtjYXNlIDA6aWYgKAoKCiAgICAgICAgICAgICAgICAgICAgICBhY3Rpb25NYXRjaC5yb3V0ZS5hY3Rpb24pIHtfY29udGV4dDE1Lm5leHQgPSA3O2JyZWFrO30KICAgICAgICAgICAgICAgICAgICAgIGVycm9yID0gZ2V0SW50ZXJuYWxSb3V0ZXJFcnJvcig0MDUsIHsKICAgICAgICAgICAgICAgICAgICAgICAgbWV0aG9kOiByZXF1ZXN0Lm1ldGhvZCwKICAgICAgICAgICAgICAgICAgICAgICAgcGF0aG5hbWU6IG5ldyBVUkwocmVxdWVzdC51cmwpLnBhdGhuYW1lLAogICAgICAgICAgICAgICAgICAgICAgICByb3V0ZUlkOiBhY3Rpb25NYXRjaC5yb3V0ZS5pZAogICAgICAgICAgICAgICAgICAgICAgfSk7aWYgKCEKCiAgICAgICAgICAgICAgICAgICAgICBpc1JvdXRlUmVxdWVzdCkge19jb250ZXh0MTUubmV4dCA9IDQ7YnJlYWs7fXRocm93ICgKICAgICAgICAgICAgICAgICAgICAgICAgZXJyb3IpO2Nhc2UgNDoKCgogICAgICAgICAgICAgICAgICAgICAgcmVzdWx0ID0gewogICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiBSZXN1bHRUeXBlLmVycm9yLAogICAgICAgICAgICAgICAgICAgICAgICBlcnJvcjogZXJyb3IKICAgICAgICAgICAgICAgICAgICAgIH07X2NvbnRleHQxNS5uZXh0ID0gMTM7YnJlYWs7Y2FzZSA3Ol9jb250ZXh0MTUubmV4dCA9IDk7cmV0dXJuICgKCiAgICAgICAgICAgICAgICAgICAgICAgIGNhbGxMb2FkZXJPckFjdGlvbigiYWN0aW9uIiwgcmVxdWVzdCwgYWN0aW9uTWF0Y2gsIG1hdGNoZXMsIGJhc2VuYW1lLCB0cnVlLCBpc1JvdXRlUmVxdWVzdCwgcmVxdWVzdENvbnRleHQpKTtjYXNlIDk6cmVzdWx0ID0gX2NvbnRleHQxNS5zZW50O2lmICghCgogICAgICAgICAgICAgICAgICAgICAgcmVxdWVzdC5zaWduYWwuYWJvcnRlZCkge19jb250ZXh0MTUubmV4dCA9IDEzO2JyZWFrO30KICAgICAgICAgICAgICAgICAgICAgIG1ldGhvZCA9IGlzUm91dGVSZXF1ZXN0ID8gInF1ZXJ5Um91dGUiIDogInF1ZXJ5Ijt0aHJvdyAoCiAgICAgICAgICAgICAgICAgICAgICAgIG5ldyBFcnJvcihtZXRob2QgKyAiKCkgY2FsbCBhYm9ydGVkIikpO2Nhc2UgMTM6aWYgKCEKCgoKICAgICAgICAgICAgICAgICAgICAgIGlzUmVkaXJlY3RSZXN1bHQocmVzdWx0KSkge19jb250ZXh0MTUubmV4dCA9IDE1O2JyZWFrO310aHJvdyAoCgoKCgogICAgICAgICAgICAgICAgICAgICAgICBuZXcgUmVzcG9uc2UobnVsbCwgewogICAgICAgICAgICAgICAgICAgICAgICAgIHN0YXR1czogcmVzdWx0LnN0YXR1cywKICAgICAgICAgICAgICAgICAgICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBMb2NhdGlvbjogcmVzdWx0LmxvY2F0aW9uCiAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB9KSk7Y2FzZSAxNTppZiAoIQoKCiAgICAgICAgICAgICAgICAgICAgICBpc0RlZmVycmVkUmVzdWx0KHJlc3VsdCkpIHtfY29udGV4dDE1Lm5leHQgPSAyMDticmVhazt9CiAgICAgICAgICAgICAgICAgICAgICBfZXJyb3I0ID0gZ2V0SW50ZXJuYWxSb3V0ZXJFcnJvcig0MDAsIHsKICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogImRlZmVyLWFjdGlvbiIKICAgICAgICAgICAgICAgICAgICAgIH0pO2lmICghCgogICAgICAgICAgICAgICAgICAgICAgaXNSb3V0ZVJlcXVlc3QpIHtfY29udGV4dDE1Lm5leHQgPSAxOTticmVhazt9dGhyb3cgKAogICAgICAgICAgICAgICAgICAgICAgICBfZXJyb3I0KTtjYXNlIDE5OgoKCiAgICAgICAgICAgICAgICAgICAgICByZXN1bHQgPSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6IFJlc3VsdFR5cGUuZXJyb3IsCiAgICAgICAgICAgICAgICAgICAgICAgIGVycm9yOiBfZXJyb3I0CiAgICAgICAgICAgICAgICAgICAgICB9O2Nhc2UgMjA6aWYgKCEKCgogICAgICAgICAgICAgICAgICAgICAgaXNSb3V0ZVJlcXVlc3QpIHtfY29udGV4dDE1Lm5leHQgPSAyNDticmVhazt9aWYgKCEKCgogICAgICAgICAgICAgICAgICAgICAgaXNFcnJvclJlc3VsdChyZXN1bHQpKSB7X2NvbnRleHQxNS5uZXh0ID0gMjM7YnJlYWs7fXRocm93ICgKICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0LmVycm9yKTtjYXNlIDIzOnJldHVybiBfY29udGV4dDE1LmFicnVwdCgicmV0dXJuIiwKCgogICAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgICBtYXRjaGVzOiBbYWN0aW9uTWF0Y2hdLAogICAgICAgICAgICAgICAgICAgICAgICBsb2FkZXJEYXRhOiB7fSwKICAgICAgICAgICAgICAgICAgICAgICAgYWN0aW9uRGF0YTogX2RlZmluZVByb3BlcnR5Mih7fSwKICAgICAgICAgICAgICAgICAgICAgICAgYWN0aW9uTWF0Y2gucm91dGUuaWQsIHJlc3VsdC5kYXRhKSwKCiAgICAgICAgICAgICAgICAgICAgICAgIGVycm9yczogbnVsbCwKICAgICAgICAgICAgICAgICAgICAgICAgLy8gTm90ZTogc3RhdHVzQ29kZSArIGhlYWRlcnMgYXJlIHVudXNlZCBoZXJlIHNpbmNlIHF1ZXJ5Um91dGUgd2lsbAogICAgICAgICAgICAgICAgICAgICAgICAvLyByZXR1cm4gdGhlIHJhdyBSZXNwb25zZSBvciB2YWx1ZQogICAgICAgICAgICAgICAgICAgICAgICBzdGF0dXNDb2RlOiAyMDAsCiAgICAgICAgICAgICAgICAgICAgICAgIGxvYWRlckhlYWRlcnM6IHt9LAogICAgICAgICAgICAgICAgICAgICAgICBhY3Rpb25IZWFkZXJzOiB7fSwKICAgICAgICAgICAgICAgICAgICAgICAgYWN0aXZlRGVmZXJyZWRzOiBudWxsCiAgICAgICAgICAgICAgICAgICAgICB9KTtjYXNlIDI0OmlmICghCgoKICAgICAgICAgICAgICAgICAgICAgIGlzRXJyb3JSZXN1bHQocmVzdWx0KSkge19jb250ZXh0MTUubmV4dCA9IDMwO2JyZWFrO30KICAgICAgICAgICAgICAgICAgICAgIC8vIFN0b3JlIG9mZiB0aGUgcGVuZGluZyBlcnJvciAtIHdlIHVzZSBpdCB0byBkZXRlcm1pbmUgd2hpY2ggbG9hZGVycwogICAgICAgICAgICAgICAgICAgICAgLy8gdG8gY2FsbCBhbmQgd2lsbCBjb21taXQgaXQgd2hlbiB3ZSBjb21wbGV0ZSB0aGUgbmF2aWdhdGlvbgogICAgICAgICAgICAgICAgICAgICAgYm91bmRhcnlNYXRjaCA9IGZpbmROZWFyZXN0Qm91bmRhcnkobWF0Y2hlcywgYWN0aW9uTWF0Y2gucm91dGUuaWQpO19jb250ZXh0MTUubmV4dCA9IDI4O3JldHVybiAoCiAgICAgICAgICAgICAgICAgICAgICAgIGxvYWRSb3V0ZURhdGEocmVxdWVzdCwgbWF0Y2hlcywgcmVxdWVzdENvbnRleHQsIHVuZGVmaW5lZCwgX2RlZmluZVByb3BlcnR5Mih7fSwKICAgICAgICAgICAgICAgICAgICAgICAgYm91bmRhcnlNYXRjaC5yb3V0ZS5pZCwgcmVzdWx0LmVycm9yKSkpO2Nhc2UgMjg6X2NvbnRleHQxNCA9IF9jb250ZXh0MTUuc2VudDtyZXR1cm4gX2NvbnRleHQxNS5hYnJ1cHQoInJldHVybiIsCgoKICAgICAgICAgICAgICAgICAgICAgIF9leHRlbmRzKHt9LCBfY29udGV4dDE0LCB7CiAgICAgICAgICAgICAgICAgICAgICAgIHN0YXR1c0NvZGU6IGlzUm91dGVFcnJvclJlc3BvbnNlKHJlc3VsdC5lcnJvcikgPyByZXN1bHQuZXJyb3Iuc3RhdHVzIDogNTAwLAogICAgICAgICAgICAgICAgICAgICAgICBhY3Rpb25EYXRhOiBudWxsLAogICAgICAgICAgICAgICAgICAgICAgICBhY3Rpb25IZWFkZXJzOiBfZXh0ZW5kcyh7fSwgcmVzdWx0LmhlYWRlcnMgPyBfZGVmaW5lUHJvcGVydHkyKHt9LAogICAgICAgICAgICAgICAgICAgICAgICBhY3Rpb25NYXRjaC5yb3V0ZS5pZCwgcmVzdWx0LmhlYWRlcnMpIDoKICAgICAgICAgICAgICAgICAgICAgICAge30pCiAgICAgICAgICAgICAgICAgICAgICB9KSk7Y2FzZSAzMDoKICAgICAgICAgICAgICAgICAgICAgIC8vIENyZWF0ZSBhIEdFVCByZXF1ZXN0IGZvciB0aGUgbG9hZGVycwoKCiAgICAgICAgICAgICAgICAgICAgICBsb2FkZXJSZXF1ZXN0ID0gbmV3IFJlcXVlc3QocmVxdWVzdC51cmwsIHsKICAgICAgICAgICAgICAgICAgICAgICAgaGVhZGVyczogcmVxdWVzdC5oZWFkZXJzLAogICAgICAgICAgICAgICAgICAgICAgICByZWRpcmVjdDogcmVxdWVzdC5yZWRpcmVjdCwKICAgICAgICAgICAgICAgICAgICAgICAgc2lnbmFsOiByZXF1ZXN0LnNpZ25hbAogICAgICAgICAgICAgICAgICAgICAgfSk7X2NvbnRleHQxNS5uZXh0ID0gMzM7cmV0dXJuICgKICAgICAgICAgICAgICAgICAgICAgICAgbG9hZFJvdXRlRGF0YShsb2FkZXJSZXF1ZXN0LCBtYXRjaGVzLCByZXF1ZXN0Q29udGV4dCkpO2Nhc2UgMzM6Y29udGV4dCA9IF9jb250ZXh0MTUuc2VudDtyZXR1cm4gX2NvbnRleHQxNS5hYnJ1cHQoInJldHVybiIsCiAgICAgICAgICAgICAgICAgICAgICBfZXh0ZW5kcyh7fSwgY29udGV4dCwgcmVzdWx0LnN0YXR1c0NvZGUgPyB7CiAgICAgICAgICAgICAgICAgICAgICAgIHN0YXR1c0NvZGU6IHJlc3VsdC5zdGF0dXNDb2RlCiAgICAgICAgICAgICAgICAgICAgICB9IDoge30sIHsKICAgICAgICAgICAgICAgICAgICAgICAgYWN0aW9uRGF0YTogX2RlZmluZVByb3BlcnR5Mih7fSwKICAgICAgICAgICAgICAgICAgICAgICAgYWN0aW9uTWF0Y2gucm91dGUuaWQsIHJlc3VsdC5kYXRhKSwKCiAgICAgICAgICAgICAgICAgICAgICAgIGFjdGlvbkhlYWRlcnM6IF9leHRlbmRzKHt9LCByZXN1bHQuaGVhZGVycyA/IF9kZWZpbmVQcm9wZXJ0eTIoe30sCiAgICAgICAgICAgICAgICAgICAgICAgIGFjdGlvbk1hdGNoLnJvdXRlLmlkLCByZXN1bHQuaGVhZGVycykgOgogICAgICAgICAgICAgICAgICAgICAgICB7fSkKICAgICAgICAgICAgICAgICAgICAgIH0pKTtjYXNlIDM1OmNhc2UgImVuZCI6cmV0dXJuIF9jb250ZXh0MTUuc3RvcCgpO319LCBfY2FsbGVlMTQpO30pKTtyZXR1cm4gX3N1Ym1pdC5hcHBseSh0aGlzLCBhcmd1bWVudHMpO31mdW5jdGlvbgoKCiAgICAgICAgICAgIGxvYWRSb3V0ZURhdGEoX3g1NiwgX3g1NywgX3g1OCwgX3g1OSwgX3g2MCkge3JldHVybiBfbG9hZFJvdXRlRGF0YS5hcHBseSh0aGlzLCBhcmd1bWVudHMpO31mdW5jdGlvbiBfbG9hZFJvdXRlRGF0YSgpIHtfbG9hZFJvdXRlRGF0YSA9IF9hc3luY1RvR2VuZXJhdG9yMiggLyojX19QVVJFX18qL19yZWdlbmVyYXRvclJ1bnRpbWUyKCkubWFyayhmdW5jdGlvbiBfY2FsbGVlMTUocmVxdWVzdCwgbWF0Y2hlcywgcmVxdWVzdENvbnRleHQsIHJvdXRlTWF0Y2gsIHBlbmRpbmdBY3Rpb25FcnJvcikge3ZhciBpc1JvdXRlUmVxdWVzdCwgcmVxdWVzdE1hdGNoZXMsIG1hdGNoZXNUb0xvYWQsIHJlc3VsdHMsIG1ldGhvZCwgYWN0aXZlRGVmZXJyZWRzLCBjb250ZXh0LCBleGVjdXRlZExvYWRlcnM7cmV0dXJuIF9yZWdlbmVyYXRvclJ1bnRpbWUyKCkud3JhcChmdW5jdGlvbiBfY2FsbGVlMTUkKF9jb250ZXh0MTYpIHt3aGlsZSAoMSkgc3dpdGNoIChfY29udGV4dDE2LnByZXYgPSBfY29udGV4dDE2Lm5leHQpIHtjYXNlIDA6CiAgICAgICAgICAgICAgICAgICAgICBpc1JvdXRlUmVxdWVzdCA9IHJvdXRlTWF0Y2ggIT0gbnVsbDsgLy8gU2hvcnQgY2lyY3VpdCBpZiB3ZSBoYXZlIG5vIGxvYWRlcnMgdG8gcnVuIChxdWVyeVJvdXRlKCkpCiAgICAgICAgICAgICAgICAgICAgICBpZiAoISgKICAgICAgICAgICAgICAgICAgICAgIGlzUm91dGVSZXF1ZXN0ICYmICEocm91dGVNYXRjaCAhPSBudWxsICYmIHJvdXRlTWF0Y2gucm91dGUubG9hZGVyKSkpIHtfY29udGV4dDE2Lm5leHQgPSAzO2JyZWFrO310aHJvdyAoCiAgICAgICAgICAgICAgICAgICAgICAgIGdldEludGVybmFsUm91dGVyRXJyb3IoNDAwLCB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgbWV0aG9kOiByZXF1ZXN0Lm1ldGhvZCwKICAgICAgICAgICAgICAgICAgICAgICAgICBwYXRobmFtZTogbmV3IFVSTChyZXF1ZXN0LnVybCkucGF0aG5hbWUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgcm91dGVJZDogcm91dGVNYXRjaCA9PSBudWxsID8gdm9pZCAwIDogcm91dGVNYXRjaC5yb3V0ZS5pZAogICAgICAgICAgICAgICAgICAgICAgICB9KSk7Y2FzZSAzOgoKCiAgICAgICAgICAgICAgICAgICAgICByZXF1ZXN0TWF0Y2hlcyA9IHJvdXRlTWF0Y2ggPyBbcm91dGVNYXRjaF0gOiBnZXRMb2FkZXJNYXRjaGVzVW50aWxCb3VuZGFyeShtYXRjaGVzLCBPYmplY3Qua2V5cyhwZW5kaW5nQWN0aW9uRXJyb3IgfHwge30pWzBdKTsKICAgICAgICAgICAgICAgICAgICAgIG1hdGNoZXNUb0xvYWQgPSByZXF1ZXN0TWF0Y2hlcy5maWx0ZXIoKG0pID0+IG0ucm91dGUubG9hZGVyKTsgLy8gU2hvcnQgY2lyY3VpdCBpZiB3ZSBoYXZlIG5vIGxvYWRlcnMgdG8gcnVuIChxdWVyeSgpKQogICAgICAgICAgICAgICAgICAgICAgaWYgKCEoCiAgICAgICAgICAgICAgICAgICAgICBtYXRjaGVzVG9Mb2FkLmxlbmd0aCA9PT0gMCkpIHtfY29udGV4dDE2Lm5leHQgPSA3O2JyZWFrO31yZXR1cm4gX2NvbnRleHQxNi5hYnJ1cHQoInJldHVybiIsCiAgICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICAgIG1hdGNoZXM6IG1hdGNoZXMsCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIEFkZCBhIG51bGwgZm9yIGFsbCBtYXRjaGVkIHJvdXRlcyBmb3IgcHJvcGVyIHJldmFsaWRhdGlvbiBvbiB0aGUgY2xpZW50CiAgICAgICAgICAgICAgICAgICAgICAgIGxvYWRlckRhdGE6IG1hdGNoZXMucmVkdWNlKChhY2MsIG0pID0+IE9iamVjdC5hc3NpZ24oYWNjLCBfZGVmaW5lUHJvcGVydHkyKHt9LAogICAgICAgICAgICAgICAgICAgICAgICBtLnJvdXRlLmlkLCBudWxsKSksCiAgICAgICAgICAgICAgICAgICAgICAgIHt9KSwKICAgICAgICAgICAgICAgICAgICAgICAgZXJyb3JzOiBwZW5kaW5nQWN0aW9uRXJyb3IgfHwgbnVsbCwKICAgICAgICAgICAgICAgICAgICAgICAgc3RhdHVzQ29kZTogMjAwLAogICAgICAgICAgICAgICAgICAgICAgICBsb2FkZXJIZWFkZXJzOiB7fSwKICAgICAgICAgICAgICAgICAgICAgICAgYWN0aXZlRGVmZXJyZWRzOiBudWxsCiAgICAgICAgICAgICAgICAgICAgICB9KTtjYXNlIDc6X2NvbnRleHQxNi5uZXh0ID0gOTtyZXR1cm4gKAoKCiAgICAgICAgICAgICAgICAgICAgICAgIFByb21pc2UuYWxsKF90b0NvbnN1bWFibGVBcnJheTIobWF0Y2hlc1RvTG9hZC5tYXAoKG1hdGNoKSA9PiBjYWxsTG9hZGVyT3JBY3Rpb24oImxvYWRlciIsIHJlcXVlc3QsIG1hdGNoLCBtYXRjaGVzLCBiYXNlbmFtZSwgdHJ1ZSwgaXNSb3V0ZVJlcXVlc3QsIHJlcXVlc3RDb250ZXh0KSkpKSk7Y2FzZSA5OnJlc3VsdHMgPSBfY29udGV4dDE2LnNlbnQ7aWYgKCEKCiAgICAgICAgICAgICAgICAgICAgICByZXF1ZXN0LnNpZ25hbC5hYm9ydGVkKSB7X2NvbnRleHQxNi5uZXh0ID0gMTM7YnJlYWs7fQogICAgICAgICAgICAgICAgICAgICAgbWV0aG9kID0gaXNSb3V0ZVJlcXVlc3QgPyAicXVlcnlSb3V0ZSIgOiAicXVlcnkiO3Rocm93ICgKICAgICAgICAgICAgICAgICAgICAgICAgbmV3IEVycm9yKG1ldGhvZCArICIoKSBjYWxsIGFib3J0ZWQiKSk7Y2FzZSAxMzoKICAgICAgICAgICAgICAgICAgICAgIC8vIFByb2Nlc3MgYW5kIGNvbW1pdCBvdXRwdXQgZnJvbSBsb2FkZXJzCgoKICAgICAgICAgICAgICAgICAgICAgIGFjdGl2ZURlZmVycmVkcyA9IG5ldyBNYXAoKTsKICAgICAgICAgICAgICAgICAgICAgIGNvbnRleHQgPSBwcm9jZXNzUm91dGVMb2FkZXJEYXRhKG1hdGNoZXMsIG1hdGNoZXNUb0xvYWQsIHJlc3VsdHMsIHBlbmRpbmdBY3Rpb25FcnJvciwgYWN0aXZlRGVmZXJyZWRzKTsgLy8gQWRkIGEgbnVsbCBmb3IgYW55IG5vbi1sb2FkZXIgbWF0Y2hlcyBmb3IgcHJvcGVyIHJldmFsaWRhdGlvbiBvbiB0aGUgY2xpZW50CgogICAgICAgICAgICAgICAgICAgICAgZXhlY3V0ZWRMb2FkZXJzID0gbmV3IFNldChtYXRjaGVzVG9Mb2FkLm1hcCgobWF0Y2gpID0+IG1hdGNoLnJvdXRlLmlkKSk7CiAgICAgICAgICAgICAgICAgICAgICBtYXRjaGVzLmZvckVhY2goKG1hdGNoKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghZXhlY3V0ZWRMb2FkZXJzLmhhcyhtYXRjaC5yb3V0ZS5pZCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICBjb250ZXh0LmxvYWRlckRhdGFbbWF0Y2gucm91dGUuaWRdID0gbnVsbDsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgfSk7cmV0dXJuIF9jb250ZXh0MTYuYWJydXB0KCJyZXR1cm4iLAogICAgICAgICAgICAgICAgICAgICAgX2V4dGVuZHMoe30sIGNvbnRleHQsIHsKICAgICAgICAgICAgICAgICAgICAgICAgbWF0Y2hlczogbWF0Y2hlcywKICAgICAgICAgICAgICAgICAgICAgICAgYWN0aXZlRGVmZXJyZWRzOiBhY3RpdmVEZWZlcnJlZHMuc2l6ZSA+IDAgPyBPYmplY3QuZnJvbUVudHJpZXMoYWN0aXZlRGVmZXJyZWRzLmVudHJpZXMoKSkgOiBudWxsCiAgICAgICAgICAgICAgICAgICAgICB9KSk7Y2FzZSAxODpjYXNlICJlbmQiOnJldHVybiBfY29udGV4dDE2LnN0b3AoKTt9fSwgX2NhbGxlZTE1KTt9KSk7cmV0dXJuIF9sb2FkUm91dGVEYXRhLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7fQoKCiAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgZGF0YVJvdXRlczogZGF0YVJvdXRlcywKICAgICAgICAgICAgICBxdWVyeTogcXVlcnksCiAgICAgICAgICAgICAgcXVlcnlSb3V0ZTogcXVlcnlSb3V0ZQogICAgICAgICAgICB9OwogICAgICAgICAgfSAvLyNlbmRyZWdpb24KICAgICAgICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCiAgICAgICAgICAvLyNyZWdpb24gSGVscGVycwogICAgICAgICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KCiAgICAgICAgICAvKioKICAgICAgICAgICAqIEdpdmVuIGFuIGV4aXN0aW5nIFN0YXRpY0hhbmRsZXJDb250ZXh0IGFuZCBhbiBlcnJvciB0aHJvd24gYXQgcmVuZGVyIHRpbWUsCiAgICAgICAgICAgKiBwcm92aWRlIGFuIHVwZGF0ZWQgU3RhdGljSGFuZGxlckNvbnRleHQgc3VpdGFibGUgZm9yIGEgc2Vjb25kIFNTUiByZW5kZXIKICAgICAgICAgICAqLwoKICAgICAgICAgIGZ1bmN0aW9uIGdldFN0YXRpY0NvbnRleHRGcm9tRXJyb3Iocm91dGVzLCBjb250ZXh0LCBlcnJvcikgewogICAgICAgICAgICB2YXIgbmV3Q29udGV4dCA9IF9leHRlbmRzKHt9LCBjb250ZXh0LCB7CiAgICAgICAgICAgICAgc3RhdHVzQ29kZTogNTAwLAogICAgICAgICAgICAgIGVycm9yczogX2RlZmluZVByb3BlcnR5Mih7fSwKICAgICAgICAgICAgICBjb250ZXh0Ll9kZWVwZXN0UmVuZGVyZWRCb3VuZGFyeUlkIHx8IHJvdXRlc1swXS5pZCwgZXJyb3IpCgogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIHJldHVybiBuZXdDb250ZXh0OwogICAgICAgICAgfQoKICAgICAgICAgIGZ1bmN0aW9uIGlzU3VibWlzc2lvbk5hdmlnYXRpb24ob3B0cykgewogICAgICAgICAgICByZXR1cm4gb3B0cyAhPSBudWxsICYmICJmb3JtRGF0YSIgaW4gb3B0czsKICAgICAgICAgIH0gLy8gTm9ybWFsaXplIG5hdmlnYXRpb24gb3B0aW9ucyBieSBjb252ZXJ0aW5nIGZvcm1NZXRob2Q9R0VUIGZvcm1EYXRhIG9iamVjdHMgdG8KICAgICAgICAgIC8vIFVSTFNlYXJjaFBhcmFtcyBzbyB0aGV5IGJlaGF2ZSBpZGVudGljYWxseSB0byBsaW5rcyB3aXRoIHF1ZXJ5IHBhcmFtcwoKCiAgICAgICAgICBmdW5jdGlvbiBub3JtYWxpemVOYXZpZ2F0ZU9wdGlvbnModG8sIG9wdHMsIGlzRmV0Y2hlcikgewogICAgICAgICAgICBpZiAoaXNGZXRjaGVyID09PSB2b2lkIDApIHsKICAgICAgICAgICAgICBpc0ZldGNoZXIgPSBmYWxzZTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdmFyIHBhdGggPSB0eXBlb2YgdG8gPT09ICJzdHJpbmciID8gdG8gOiByb3V0ZXJfY3JlYXRlUGF0aCh0byk7IC8vIFJldHVybiBsb2NhdGlvbiB2ZXJiYXRpbSBvbiBub24tc3VibWlzc2lvbiBuYXZpZ2F0aW9ucwoKICAgICAgICAgICAgaWYgKCFvcHRzIHx8ICFpc1N1Ym1pc3Npb25OYXZpZ2F0aW9uKG9wdHMpKSB7CiAgICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgIHBhdGg6IHBhdGgKICAgICAgICAgICAgICB9OwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAob3B0cy5mb3JtTWV0aG9kICYmICFpc1ZhbGlkTWV0aG9kKG9wdHMuZm9ybU1ldGhvZCkpIHsKICAgICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgcGF0aDogcGF0aCwKICAgICAgICAgICAgICAgIGVycm9yOiBnZXRJbnRlcm5hbFJvdXRlckVycm9yKDQwNSwgewogICAgICAgICAgICAgICAgICBtZXRob2Q6IG9wdHMuZm9ybU1ldGhvZAogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICB9OwogICAgICAgICAgICB9IC8vIENyZWF0ZSBhIFN1Ym1pc3Npb24gb24gbm9uLUdFVCBuYXZpZ2F0aW9ucwoKCiAgICAgICAgICAgIHZhciBzdWJtaXNzaW9uOwoKICAgICAgICAgICAgaWYgKG9wdHMuZm9ybURhdGEpIHsKICAgICAgICAgICAgICBzdWJtaXNzaW9uID0gewogICAgICAgICAgICAgICAgZm9ybU1ldGhvZDogb3B0cy5mb3JtTWV0aG9kIHx8ICJnZXQiLAogICAgICAgICAgICAgICAgZm9ybUFjdGlvbjogc3RyaXBIYXNoRnJvbVBhdGgocGF0aCksCiAgICAgICAgICAgICAgICBmb3JtRW5jVHlwZTogb3B0cyAmJiBvcHRzLmZvcm1FbmNUeXBlIHx8ICJhcHBsaWNhdGlvbi94LXd3dy1mb3JtLXVybGVuY29kZWQiLAogICAgICAgICAgICAgICAgZm9ybURhdGE6IG9wdHMuZm9ybURhdGEKICAgICAgICAgICAgICB9OwoKICAgICAgICAgICAgICBpZiAoaXNNdXRhdGlvbk1ldGhvZChzdWJtaXNzaW9uLmZvcm1NZXRob2QpKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgICBwYXRoOiBwYXRoLAogICAgICAgICAgICAgICAgICBzdWJtaXNzaW9uOiBzdWJtaXNzaW9uCiAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSAvLyBGbGF0dGVuIHN1Ym1pc3Npb24gb250byBVUkxTZWFyY2hQYXJhbXMgZm9yIEdFVCBzdWJtaXNzaW9ucwoKCiAgICAgICAgICAgIHZhciBwYXJzZWRQYXRoID0gcGFyc2VQYXRoKHBhdGgpOwogICAgICAgICAgICB2YXIgc2VhcmNoUGFyYW1zID0gY29udmVydEZvcm1EYXRhVG9TZWFyY2hQYXJhbXMob3B0cy5mb3JtRGF0YSk7IC8vIFNpbmNlIGZldGNoZXIgR0VUIHN1Ym1pc3Npb25zIG9ubHkgcnVuIGEgc2luZ2xlIGxvYWRlciAoYXMgb3Bwb3NlZCB0bwogICAgICAgICAgICAvLyBuYXZpZ2F0aW9uIEdFVCBzdWJtaXNzaW9ucyB3aGljaCBydW4gYWxsIGxvYWRlcnMpLCB3ZSBuZWVkIHRvIHByZXNlcnZlCiAgICAgICAgICAgIC8vIGFueSBpbmNvbWluZyA/aW5kZXggcGFyYW1zCgogICAgICAgICAgICBpZiAoaXNGZXRjaGVyICYmIHBhcnNlZFBhdGguc2VhcmNoICYmIGhhc05ha2VkSW5kZXhRdWVyeShwYXJzZWRQYXRoLnNlYXJjaCkpIHsKICAgICAgICAgICAgICBzZWFyY2hQYXJhbXMuYXBwZW5kKCJpbmRleCIsICIiKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcGFyc2VkUGF0aC5zZWFyY2ggPSAiPyIgKyBzZWFyY2hQYXJhbXM7CiAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgcGF0aDogcm91dGVyX2NyZWF0ZVBhdGgocGFyc2VkUGF0aCksCiAgICAgICAgICAgICAgc3VibWlzc2lvbjogc3VibWlzc2lvbgogICAgICAgICAgICB9OwogICAgICAgICAgfSAvLyBGaWx0ZXIgb3V0IGFsbCByb3V0ZXMgYmVsb3cgYW55IGNhdWdodCBlcnJvciBhcyB0aGV5IGFyZW4ndCBnb2luZyB0bwogICAgICAgICAgLy8gcmVuZGVyIHNvIHdlIGRvbid0IG5lZWQgdG8gbG9hZCB0aGVtCgoKICAgICAgICAgIGZ1bmN0aW9uIGdldExvYWRlck1hdGNoZXNVbnRpbEJvdW5kYXJ5KG1hdGNoZXMsIGJvdW5kYXJ5SWQpIHsKICAgICAgICAgICAgdmFyIGJvdW5kYXJ5TWF0Y2hlcyA9IG1hdGNoZXM7CgogICAgICAgICAgICBpZiAoYm91bmRhcnlJZCkgewogICAgICAgICAgICAgIHZhciBpbmRleCA9IG1hdGNoZXMuZmluZEluZGV4KChtKSA9PiBtLnJvdXRlLmlkID09PSBib3VuZGFyeUlkKTsKCiAgICAgICAgICAgICAgaWYgKGluZGV4ID49IDApIHsKICAgICAgICAgICAgICAgIGJvdW5kYXJ5TWF0Y2hlcyA9IG1hdGNoZXMuc2xpY2UoMCwgaW5kZXgpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuIGJvdW5kYXJ5TWF0Y2hlczsKICAgICAgICAgIH0KCiAgICAgICAgICBmdW5jdGlvbiBnZXRNYXRjaGVzVG9Mb2FkKGhpc3RvcnksIHN0YXRlLCBtYXRjaGVzLCBzdWJtaXNzaW9uLCBsb2NhdGlvbiwgaXNSZXZhbGlkYXRpb25SZXF1aXJlZCwgY2FuY2VsbGVkRGVmZXJyZWRSb3V0ZXMsIGNhbmNlbGxlZEZldGNoZXJMb2FkcywgcGVuZGluZ0FjdGlvbkRhdGEsIHBlbmRpbmdFcnJvciwgZmV0Y2hMb2FkTWF0Y2hlcykgewogICAgICAgICAgICB2YXIgYWN0aW9uUmVzdWx0ID0gcGVuZGluZ0Vycm9yID8gT2JqZWN0LnZhbHVlcyhwZW5kaW5nRXJyb3IpWzBdIDogcGVuZGluZ0FjdGlvbkRhdGEgPyBPYmplY3QudmFsdWVzKHBlbmRpbmdBY3Rpb25EYXRhKVswXSA6IHVuZGVmaW5lZDsKICAgICAgICAgICAgdmFyIGN1cnJlbnRVcmwgPSBoaXN0b3J5LmNyZWF0ZVVSTChzdGF0ZS5sb2NhdGlvbik7CiAgICAgICAgICAgIHZhciBuZXh0VXJsID0gaGlzdG9yeS5jcmVhdGVVUkwobG9jYXRpb24pOwogICAgICAgICAgICB2YXIgZGVmYXVsdFNob3VsZFJldmFsaWRhdGUgPSAvLyBGb3JjZWQgcmV2YWxpZGF0aW9uIGR1ZSB0byBzdWJtaXNzaW9uLCB1c2VSZXZhbGlkYXRlLCBvciBYLVJlbWl4LVJldmFsaWRhdGUKICAgICAgICAgICAgaXNSZXZhbGlkYXRpb25SZXF1aXJlZCB8fCAvLyBDbGlja2VkIHRoZSBzYW1lIGxpbmssIHJlc3VibWl0dGVkIGEgR0VUIGZvcm0KICAgICAgICAgICAgY3VycmVudFVybC50b1N0cmluZygpID09PSBuZXh0VXJsLnRvU3RyaW5nKCkgfHwgLy8gU2VhcmNoIHBhcmFtcyBhZmZlY3QgYWxsIGxvYWRlcnMKICAgICAgICAgICAgY3VycmVudFVybC5zZWFyY2ggIT09IG5leHRVcmwuc2VhcmNoOyAvLyBQaWNrIG5hdmlnYXRpb24gbWF0Y2hlcyB0aGF0IGFyZSBuZXQtbmV3IG9yIHF1YWxpZnkgZm9yIHJldmFsaWRhdGlvbgoKICAgICAgICAgICAgdmFyIGJvdW5kYXJ5SWQgPSBwZW5kaW5nRXJyb3IgPyBPYmplY3Qua2V5cyhwZW5kaW5nRXJyb3IpWzBdIDogdW5kZWZpbmVkOwogICAgICAgICAgICB2YXIgYm91bmRhcnlNYXRjaGVzID0gZ2V0TG9hZGVyTWF0Y2hlc1VudGlsQm91bmRhcnkobWF0Y2hlcywgYm91bmRhcnlJZCk7CiAgICAgICAgICAgIHZhciBuYXZpZ2F0aW9uTWF0Y2hlcyA9IGJvdW5kYXJ5TWF0Y2hlcy5maWx0ZXIoKG1hdGNoLCBpbmRleCkgPT4gewogICAgICAgICAgICAgIGlmIChtYXRjaC5yb3V0ZS5sb2FkZXIgPT0gbnVsbCkgewogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICAgIH0gLy8gQWx3YXlzIGNhbGwgdGhlIGxvYWRlciBvbiBuZXcgcm91dGUgaW5zdGFuY2VzIGFuZCBwZW5kaW5nIGRlZmVyIGNhbmNlbGxhdGlvbnMKCgogICAgICAgICAgICAgIGlmIChpc05ld0xvYWRlcihzdGF0ZS5sb2FkZXJEYXRhLCBzdGF0ZS5tYXRjaGVzW2luZGV4XSwgbWF0Y2gpIHx8IGNhbmNlbGxlZERlZmVycmVkUm91dGVzLnNvbWUoKGlkKSA9PiBpZCA9PT0gbWF0Y2gucm91dGUuaWQpKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgICB9IC8vIFRoaXMgaXMgdGhlIGRlZmF1bHQgaW1wbGVtZW50YXRpb24gZm9yIHdoZW4gd2UgcmV2YWxpZGF0ZS4gIElmIHRoZSByb3V0ZQogICAgICAgICAgICAgIC8vIHByb3ZpZGVzIGl0J3Mgb3duIGltcGxlbWVudGF0aW9uLCB0aGVuIHdlIGdpdmUgdGhlbSBmdWxsIGNvbnRyb2wgYnV0CiAgICAgICAgICAgICAgLy8gcHJvdmlkZSB0aGlzIHZhbHVlIHNvIHRoZXkgY2FuIGxldmVyYWdlIGl0IGlmIG5lZWRlZCBhZnRlciB0aGV5IGNoZWNrCiAgICAgICAgICAgICAgLy8gdGhlaXIgb3duIHNwZWNpZmljIHVzZSBjYXNlcwoKCiAgICAgICAgICAgICAgdmFyIGN1cnJlbnRSb3V0ZU1hdGNoID0gc3RhdGUubWF0Y2hlc1tpbmRleF07CiAgICAgICAgICAgICAgdmFyIG5leHRSb3V0ZU1hdGNoID0gbWF0Y2g7CiAgICAgICAgICAgICAgcmV0dXJuIHNob3VsZFJldmFsaWRhdGVMb2FkZXIobWF0Y2gsIF9leHRlbmRzKHsKICAgICAgICAgICAgICAgIGN1cnJlbnRVcmw6IGN1cnJlbnRVcmwsCiAgICAgICAgICAgICAgICBjdXJyZW50UGFyYW1zOiBjdXJyZW50Um91dGVNYXRjaC5wYXJhbXMsCiAgICAgICAgICAgICAgICBuZXh0VXJsOiBuZXh0VXJsLAogICAgICAgICAgICAgICAgbmV4dFBhcmFtczogbmV4dFJvdXRlTWF0Y2gucGFyYW1zCiAgICAgICAgICAgICAgfSwgc3VibWlzc2lvbiwgewogICAgICAgICAgICAgICAgYWN0aW9uUmVzdWx0OiBhY3Rpb25SZXN1bHQsCiAgICAgICAgICAgICAgICBkZWZhdWx0U2hvdWxkUmV2YWxpZGF0ZTogZGVmYXVsdFNob3VsZFJldmFsaWRhdGUgfHwgaXNOZXdSb3V0ZUluc3RhbmNlKGN1cnJlbnRSb3V0ZU1hdGNoLCBuZXh0Um91dGVNYXRjaCkKICAgICAgICAgICAgICB9KSk7CiAgICAgICAgICAgIH0pOyAvLyBQaWNrIGZldGNoZXIubG9hZHMgdGhhdCBuZWVkIHRvIGJlIHJldmFsaWRhdGVkCgogICAgICAgICAgICB2YXIgcmV2YWxpZGF0aW5nRmV0Y2hlcnMgPSBbXTsKICAgICAgICAgICAgZmV0Y2hMb2FkTWF0Y2hlcyAmJiBmZXRjaExvYWRNYXRjaGVzLmZvckVhY2goKGYsIGtleSkgPT4gewogICAgICAgICAgICAgIGlmICghbWF0Y2hlcy5zb21lKChtKSA9PiBtLnJvdXRlLmlkID09PSBmLnJvdXRlSWQpKSB7CiAgICAgICAgICAgICAgICAvLyBUaGlzIGZldGNoZXIgaXMgbm90IGdvaW5nIHRvIGJlIHByZXNlbnQgaW4gdGhlIHN1YnNlcXVlbnQgcmVuZGVyIHNvCiAgICAgICAgICAgICAgICAvLyB0aGVyZSdzIG5vIG5lZWQgdG8gcmV2YWxpZGF0ZSBpdAogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgIH0gZWxzZSBpZiAoY2FuY2VsbGVkRmV0Y2hlckxvYWRzLmluY2x1ZGVzKGtleSkpIHsKICAgICAgICAgICAgICAgIC8vIFRoaXMgZmV0Y2hlciB3YXMgY2FuY2VsbGVkIGZyb20gYSBwcmlvciBhY3Rpb24gc3VibWlzc2lvbiAtIGZvcmNlIHJlbG9hZAogICAgICAgICAgICAgICAgcmV2YWxpZGF0aW5nRmV0Y2hlcnMucHVzaChfZXh0ZW5kcyh7CiAgICAgICAgICAgICAgICAgIGtleToga2V5CiAgICAgICAgICAgICAgICB9LCBmKSk7CiAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIC8vIFJldmFsaWRhdGluZyBmZXRjaGVycyBhcmUgZGVjb3VwbGVkIGZyb20gdGhlIHJvdXRlIG1hdGNoZXMgc2luY2UgdGhleQogICAgICAgICAgICAgICAgLy8gaGl0IGEgc3RhdGljIGhyZWYsIHNvIHRoZXkgX2Fsd2F5c18gY2hlY2sgc2hvdWxkUmV2YWxpZGF0ZSBhbmQgdGhlCiAgICAgICAgICAgICAgICAvLyBkZWZhdWx0IGlzIHN0cmljdGx5IGlmIGEgcmV2YWxpZGF0aW9uIGlzIGV4cGxpY2l0bHkgcmVxdWlyZWQgKGFjdGlvbgogICAgICAgICAgICAgICAgLy8gc3VibWlzc2lvbnMsIHVzZVJldmFsaWRhdG9yLCBYLVJlbWl4LVJldmFsaWRhdGUpLgogICAgICAgICAgICAgICAgdmFyIHNob3VsZFJldmFsaWRhdGUgPSBzaG91bGRSZXZhbGlkYXRlTG9hZGVyKGYubWF0Y2gsIF9leHRlbmRzKHsKICAgICAgICAgICAgICAgICAgY3VycmVudFVybDogY3VycmVudFVybCwKICAgICAgICAgICAgICAgICAgY3VycmVudFBhcmFtczogc3RhdGUubWF0Y2hlc1tzdGF0ZS5tYXRjaGVzLmxlbmd0aCAtIDFdLnBhcmFtcywKICAgICAgICAgICAgICAgICAgbmV4dFVybDogbmV4dFVybCwKICAgICAgICAgICAgICAgICAgbmV4dFBhcmFtczogbWF0Y2hlc1ttYXRjaGVzLmxlbmd0aCAtIDFdLnBhcmFtcwogICAgICAgICAgICAgICAgfSwgc3VibWlzc2lvbiwgewogICAgICAgICAgICAgICAgICBhY3Rpb25SZXN1bHQ6IGFjdGlvblJlc3VsdCwKICAgICAgICAgICAgICAgICAgZGVmYXVsdFNob3VsZFJldmFsaWRhdGU6IGRlZmF1bHRTaG91bGRSZXZhbGlkYXRlCiAgICAgICAgICAgICAgICB9KSk7CgogICAgICAgICAgICAgICAgaWYgKHNob3VsZFJldmFsaWRhdGUpIHsKICAgICAgICAgICAgICAgICAgcmV2YWxpZGF0aW5nRmV0Y2hlcnMucHVzaChfZXh0ZW5kcyh7CiAgICAgICAgICAgICAgICAgICAga2V5OiBrZXkKICAgICAgICAgICAgICAgICAgfSwgZikpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIHJldHVybiBbbmF2aWdhdGlvbk1hdGNoZXMsIHJldmFsaWRhdGluZ0ZldGNoZXJzXTsKICAgICAgICAgIH0KCiAgICAgICAgICBmdW5jdGlvbiBpc05ld0xvYWRlcihjdXJyZW50TG9hZGVyRGF0YSwgY3VycmVudE1hdGNoLCBtYXRjaCkgewogICAgICAgICAgICB2YXIgaXNOZXcgPSAvLyBbYV0gLT4gW2EsIGJdCiAgICAgICAgICAgICFjdXJyZW50TWF0Y2ggfHwgLy8gW2EsIGJdIC0+IFthLCBjXQogICAgICAgICAgICBtYXRjaC5yb3V0ZS5pZCAhPT0gY3VycmVudE1hdGNoLnJvdXRlLmlkOyAvLyBIYW5kbGUgdGhlIGNhc2UgdGhhdCB3ZSBkb24ndCBoYXZlIGRhdGEgZm9yIGEgcmUtdXNlZCByb3V0ZSwgcG90ZW50aWFsbHkKICAgICAgICAgICAgLy8gZnJvbSBhIHByaW9yIGVycm9yIG9yIGZyb20gYSBjYW5jZWxsZWQgcGVuZGluZyBkZWZlcnJlZAoKICAgICAgICAgICAgdmFyIGlzTWlzc2luZ0RhdGEgPSBjdXJyZW50TG9hZGVyRGF0YVttYXRjaC5yb3V0ZS5pZF0gPT09IHVuZGVmaW5lZDsgLy8gQWx3YXlzIGxvYWQgaWYgdGhpcyBpcyBhIG5ldC1uZXcgcm91dGUgb3Igd2UgZG9uJ3QgeWV0IGhhdmUgZGF0YQoKICAgICAgICAgICAgcmV0dXJuIGlzTmV3IHx8IGlzTWlzc2luZ0RhdGE7CiAgICAgICAgICB9CgogICAgICAgICAgZnVuY3Rpb24gaXNOZXdSb3V0ZUluc3RhbmNlKGN1cnJlbnRNYXRjaCwgbWF0Y2gpIHsKICAgICAgICAgICAgdmFyIGN1cnJlbnRQYXRoID0gY3VycmVudE1hdGNoLnJvdXRlLnBhdGg7CiAgICAgICAgICAgIHJldHVybiAoLy8gcGFyYW0gY2hhbmdlIGZvciB0aGlzIG1hdGNoLCAvdXNlcnMvMTIzIC0+IC91c2Vycy80NTYKICAgICAgICAgICAgICBjdXJyZW50TWF0Y2gucGF0aG5hbWUgIT09IG1hdGNoLnBhdGhuYW1lIHx8IC8vIHNwbGF0IHBhcmFtIGNoYW5nZWQsIHdoaWNoIGlzIG5vdCBwcmVzZW50IGluIG1hdGNoLnBhdGgKICAgICAgICAgICAgICAvLyBlLmcuIC9maWxlcy9pbWFnZXMvYXZhdGFyLmpwZyAtPiBmaWxlcy9maW5hbmNlcy54bHMKICAgICAgICAgICAgICBjdXJyZW50UGF0aCAhPSBudWxsICYmIGN1cnJlbnRQYXRoLmVuZHNXaXRoKCIqIikgJiYgY3VycmVudE1hdGNoLnBhcmFtc1siKiJdICE9PSBtYXRjaC5wYXJhbXNbIioiXSk7CgogICAgICAgICAgfQoKICAgICAgICAgIGZ1bmN0aW9uIHNob3VsZFJldmFsaWRhdGVMb2FkZXIobG9hZGVyTWF0Y2gsIGFyZykgewogICAgICAgICAgICBpZiAobG9hZGVyTWF0Y2gucm91dGUuc2hvdWxkUmV2YWxpZGF0ZSkgewogICAgICAgICAgICAgIHZhciByb3V0ZUNob2ljZSA9IGxvYWRlck1hdGNoLnJvdXRlLnNob3VsZFJldmFsaWRhdGUoYXJnKTsKCiAgICAgICAgICAgICAgaWYgKHR5cGVvZiByb3V0ZUNob2ljZSA9PT0gImJvb2xlYW4iKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gcm91dGVDaG9pY2U7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICByZXR1cm4gYXJnLmRlZmF1bHRTaG91bGRSZXZhbGlkYXRlOwogICAgICAgICAgfWZ1bmN0aW9uCgogICAgICAgICAgY2FsbExvYWRlck9yQWN0aW9uKF94NjEsIF94NjIsIF94NjMsIF94NjQsIF94NjUsIF94NjYsIF94NjcsIF94NjgpIHtyZXR1cm4gX2NhbGxMb2FkZXJPckFjdGlvbi5hcHBseSh0aGlzLCBhcmd1bWVudHMpO30KCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCiAgICAgICAgICAvLyBVdGlsaXR5IG1ldGhvZCBmb3IgY3JlYXRpbmcgdGhlIFJlcXVlc3QgaW5zdGFuY2VzIGZvciBsb2FkZXJzL2FjdGlvbnMgZHVyaW5nCiAgICAgICAgICAvLyBjbGllbnQtc2lkZSBuYXZpZ2F0aW9ucyBhbmQgZmV0Y2hlcy4gIER1cmluZyBTU1Igd2Ugd2lsbCBhbHdheXMgaGF2ZSBhCiAgICAgICAgICAvLyBSZXF1ZXN0IGluc3RhbmNlIGZyb20gdGhlIHN0YXRpYyBoYW5kbGVyIChxdWVyeS9xdWVyeVJvdXRlKQogICAgICAgICAgZnVuY3Rpb24gX2NhbGxMb2FkZXJPckFjdGlvbigpIHtfY2FsbExvYWRlck9yQWN0aW9uID0gX2FzeW5jVG9HZW5lcmF0b3IyKCAvKiNfX1BVUkVfXyovX3JlZ2VuZXJhdG9yUnVudGltZTIoKS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUxNih0eXBlLCByZXF1ZXN0LCBtYXRjaCwgbWF0Y2hlcywgYmFzZW5hbWUsIGlzU3RhdGljUmVxdWVzdCwgaXNSb3V0ZVJlcXVlc3QsIHJlcXVlc3RDb250ZXh0KSB7dmFyIHJlc3VsdFR5cGUsIHJlc3VsdCwgcmVqZWN0LCBhYm9ydFByb21pc2UsIG9uUmVqZWN0LCBoYW5kbGVyLCBzdGF0dXMsIGxvY2F0aW9uLCBpc0Fic29sdXRlLCBhY3RpdmVNYXRjaGVzLCByb3V0ZVBhdGhuYW1lcywgcmVzb2x2ZWRMb2NhdGlvbiwgcGF0aCwgY3VycmVudFVybCwgdXJsLCBkYXRhLCBjb250ZW50VHlwZTtyZXR1cm4gX3JlZ2VuZXJhdG9yUnVudGltZTIoKS53cmFwKGZ1bmN0aW9uIF9jYWxsZWUxNiQoX2NvbnRleHQxNykge3doaWxlICgxKSBzd2l0Y2ggKF9jb250ZXh0MTcucHJldiA9IF9jb250ZXh0MTcubmV4dCkge2Nhc2UgMDppZiAoYmFzZW5hbWUgPT09IHZvaWQgMCkge2Jhc2VuYW1lID0gIi8iO31pZiAoaXNTdGF0aWNSZXF1ZXN0ID09PSB2b2lkIDApIHtpc1N0YXRpY1JlcXVlc3QgPSBmYWxzZTt9aWYgKGlzUm91dGVSZXF1ZXN0ID09PSB2b2lkIDApIHtpc1JvdXRlUmVxdWVzdCA9IGZhbHNlO31hYm9ydFByb21pc2UgPSBuZXcgUHJvbWlzZSgoXywgcikgPT4gcmVqZWN0ID0gcik7b25SZWplY3QgPSAoKSA9PiByZWplY3QoKTtyZXF1ZXN0LnNpZ25hbC5hZGRFdmVudExpc3RlbmVyKCJhYm9ydCIsIG9uUmVqZWN0KTtfY29udGV4dDE3LnByZXYgPSA2O2hhbmRsZXIgPSBtYXRjaC5yb3V0ZVt0eXBlXTtyb3V0ZXJfaW52YXJpYW50KGhhbmRsZXIsICJDb3VsZCBub3QgZmluZCB0aGUgIiArIHR5cGUgKyAiIHRvIHJ1biBvbiB0aGUgXCIiICsgbWF0Y2gucm91dGUuaWQgKyAiXCIgcm91dGUiKTtfY29udGV4dDE3Lm5leHQgPSAxMTtyZXR1cm4gUHJvbWlzZS5yYWNlKFtoYW5kbGVyKHsgcmVxdWVzdDogcmVxdWVzdCwgcGFyYW1zOiBtYXRjaC5wYXJhbXMsIGNvbnRleHQ6IHJlcXVlc3RDb250ZXh0IH0pLCBhYm9ydFByb21pc2VdKTtjYXNlIDExOnJlc3VsdCA9IF9jb250ZXh0MTcuc2VudDtyb3V0ZXJfaW52YXJpYW50KHJlc3VsdCAhPT0gdW5kZWZpbmVkLCAiWW91IGRlZmluZWQgIiArICh0eXBlID09PSAiYWN0aW9uIiA/ICJhbiBhY3Rpb24iIDogImEgbG9hZGVyIikgKyAiIGZvciByb3V0ZSAiICsgKCJcIiIgKyBtYXRjaC5yb3V0ZS5pZCArICJcIiBidXQgZGlkbid0IHJldHVybiBhbnl0aGluZyBmcm9tIHlvdXIgYCIgKyB0eXBlICsgImAgIikgKyAiZnVuY3Rpb24uIFBsZWFzZSByZXR1cm4gYSB2YWx1ZSBvciBgbnVsbGAuIik7X2NvbnRleHQxNy5uZXh0ID0gMTk7YnJlYWs7Y2FzZSAxNTpfY29udGV4dDE3LnByZXYgPSAxNTtfY29udGV4dDE3LnQwID0gX2NvbnRleHQxN1siY2F0Y2giXSg2KTtyZXN1bHRUeXBlID0gUmVzdWx0VHlwZS5lcnJvcjtyZXN1bHQgPSBfY29udGV4dDE3LnQwO2Nhc2UgMTk6X2NvbnRleHQxNy5wcmV2ID0gMTk7cmVxdWVzdC5zaWduYWwucmVtb3ZlRXZlbnRMaXN0ZW5lcigiYWJvcnQiLCBvblJlamVjdCk7cmV0dXJuIF9jb250ZXh0MTcuZmluaXNoKDE5KTtjYXNlIDIyOmlmICghaXNSZXNwb25zZShyZXN1bHQpKSB7X2NvbnRleHQxNy5uZXh0ID0gNDg7YnJlYWs7fXN0YXR1cyA9IHJlc3VsdC5zdGF0dXM7IC8vIFByb2Nlc3MgcmVkaXJlY3RzCiAgICAgICAgICAgICAgICAgICAgaWYgKCFyZWRpcmVjdFN0YXR1c0NvZGVzLmhhcyhzdGF0dXMpKSB7X2NvbnRleHQxNy5uZXh0ID0gMzM7YnJlYWs7fWxvY2F0aW9uID0gcmVzdWx0LmhlYWRlcnMuZ2V0KCJMb2NhdGlvbiIpO3JvdXRlcl9pbnZhcmlhbnQobG9jYXRpb24sICJSZWRpcmVjdHMgcmV0dXJuZWQvdGhyb3duIGZyb20gbG9hZGVycy9hY3Rpb25zIG11c3QgaGF2ZSBhIExvY2F0aW9uIGhlYWRlciIpO2lzQWJzb2x1dGUgPSAvXig/OlthLXpdW2EtejAtOSsuLV0qOnxcL1wvKS9pLnRlc3QobG9jYXRpb24pOyAvLyBTdXBwb3J0IHJlbGF0aXZlIHJvdXRpbmcgaW4gaW50ZXJuYWwgcmVkaXJlY3RzCiAgICAgICAgICAgICAgICAgICAgaWYgKCFpc0Fic29sdXRlKSB7YWN0aXZlTWF0Y2hlcyA9IG1hdGNoZXMuc2xpY2UoMCwgbWF0Y2hlcy5pbmRleE9mKG1hdGNoKSArIDEpO3JvdXRlUGF0aG5hbWVzID0gZ2V0UGF0aENvbnRyaWJ1dGluZ01hdGNoZXMoYWN0aXZlTWF0Y2hlcykubWFwKChtYXRjaCkgPT4gbWF0Y2gucGF0aG5hbWVCYXNlKTtyZXNvbHZlZExvY2F0aW9uID0gcmVzb2x2ZVRvKGxvY2F0aW9uLCByb3V0ZVBhdGhuYW1lcywgbmV3IFVSTChyZXF1ZXN0LnVybCkucGF0aG5hbWUpO3JvdXRlcl9pbnZhcmlhbnQocm91dGVyX2NyZWF0ZVBhdGgocmVzb2x2ZWRMb2NhdGlvbiksICJVbmFibGUgdG8gcmVzb2x2ZSByZWRpcmVjdCBsb2NhdGlvbjogIiArIGxvY2F0aW9uKTsgLy8gUHJlcGVuZCB0aGUgYmFzZW5hbWUgdG8gdGhlIHJlZGlyZWN0IGxvY2F0aW9uIGlmIHdlIGhhdmUgb25lCiAgICAgICAgICAgICAgICAgICAgICBpZiAoYmFzZW5hbWUpIHtwYXRoID0gcmVzb2x2ZWRMb2NhdGlvbi5wYXRobmFtZTtyZXNvbHZlZExvY2F0aW9uLnBhdGhuYW1lID0gcGF0aCA9PT0gIi8iID8gYmFzZW5hbWUgOiByb3V0ZXJfam9pblBhdGhzKFtiYXNlbmFtZSwgcGF0aF0pO31sb2NhdGlvbiA9IHJvdXRlcl9jcmVhdGVQYXRoKHJlc29sdmVkTG9jYXRpb24pO30gZWxzZSBpZiAoIWlzU3RhdGljUmVxdWVzdCkgey8vIFN0cmlwIG9mZiB0aGUgcHJvdG9jb2wrb3JpZ2luIGZvciBzYW1lLW9yaWdpbiBhYnNvbHV0ZSByZWRpcmVjdHMuCiAgICAgICAgICAgICAgICAgICAgICAvLyBJZiB0aGlzIGlzIGEgc3RhdGljIHJlcXVlcywgd2UgY2FuIGxldCBpdCBnbyBiYWNrIHRvIHRoZSBicm93c2VyCiAgICAgICAgICAgICAgICAgICAgICAvLyBhcy1pcwogICAgICAgICAgICAgICAgICAgICAgY3VycmVudFVybCA9IG5ldyBVUkwocmVxdWVzdC51cmwpO3VybCA9IGxvY2F0aW9uLnN0YXJ0c1dpdGgoIi8vIikgPyBuZXcgVVJMKGN1cnJlbnRVcmwucHJvdG9jb2wgKyBsb2NhdGlvbikgOiBuZXcgVVJMKGxvY2F0aW9uKTtpZiAodXJsLm9yaWdpbiA9PT0gY3VycmVudFVybC5vcmlnaW4pIHtsb2NhdGlvbiA9IHVybC5wYXRobmFtZSArIHVybC5zZWFyY2ggKyB1cmwuaGFzaDt9fSAvLyBEb24ndCBwcm9jZXNzIHJlZGlyZWN0cyBpbiB0aGUgcm91dGVyIGR1cmluZyBzdGF0aWMgcmVxdWVzdHMgcmVxdWVzdHMuCiAgICAgICAgICAgICAgICAgICAgLy8gSW5zdGVhZCwgdGhyb3cgdGhlIFJlc3BvbnNlIGFuZCBsZXQgdGhlIHNlcnZlciBoYW5kbGUgaXQgd2l0aCBhbiBIVFRQCiAgICAgICAgICAgICAgICAgICAgLy8gcmVkaXJlY3QuICBXZSBhbHNvIHVwZGF0ZSB0aGUgTG9jYXRpb24gaGVhZGVyIGluIHBsYWNlIGluIHRoaXMgZmxvdyBzbwogICAgICAgICAgICAgICAgICAgIC8vIGJhc2VuYW1lIGFuZCByZWxhdGl2ZSByb3V0aW5nIGlzIHRha2VuIGludG8gYWNjb3VudAogICAgICAgICAgICAgICAgICAgIGlmICghaXNTdGF0aWNSZXF1ZXN0KSB7X2NvbnRleHQxNy5uZXh0ID0gMzI7YnJlYWs7fXJlc3VsdC5oZWFkZXJzLnNldCgiTG9jYXRpb24iLCBsb2NhdGlvbik7dGhyb3cgcmVzdWx0O2Nhc2UgMzI6cmV0dXJuIF9jb250ZXh0MTcuYWJydXB0KCJyZXR1cm4iLCB7IHR5cGU6IFJlc3VsdFR5cGUucmVkaXJlY3QsIHN0YXR1czogc3RhdHVzLCBsb2NhdGlvbjogbG9jYXRpb24sIHJldmFsaWRhdGU6IHJlc3VsdC5oZWFkZXJzLmdldCgiWC1SZW1peC1SZXZhbGlkYXRlIikgIT09IG51bGwgfSk7Y2FzZSAzMzppZiAoIWlzUm91dGVSZXF1ZXN0KSB7X2NvbnRleHQxNy5uZXh0ID0gMzU7YnJlYWs7fXRocm93IHsgdHlwZTogcmVzdWx0VHlwZSB8fCBSZXN1bHRUeXBlLmRhdGEsIHJlc3BvbnNlOiByZXN1bHQgfTtjYXNlIDM1OmNvbnRlbnRUeXBlID0gcmVzdWx0LmhlYWRlcnMuZ2V0KCJDb250ZW50LVR5cGUiKTsgLy8gQ2hlY2sgYmV0d2VlbiB3b3JkIGJvdW5kYXJpZXMgaW5zdGVhZCBvZiBzdGFydHNXaXRoKCkgZHVlIHRvIHRoZSBsYXN0CiAgICAgICAgICAgICAgICAgICAgLy8gcGFyYWdyYXBoIG9mIGh0dHBzOi8vaHR0cHdnLm9yZy9zcGVjcy9yZmM5MTEwLmh0bWwjZmllbGQuY29udGVudC10eXBlCiAgICAgICAgICAgICAgICAgICAgaWYgKCEoY29udGVudFR5cGUgJiYgL1xiYXBwbGljYXRpb25cL2pzb25cYi8udGVzdChjb250ZW50VHlwZSkpKSB7X2NvbnRleHQxNy5uZXh0ID0gNDI7YnJlYWs7fV9jb250ZXh0MTcubmV4dCA9IDM5O3JldHVybiByZXN1bHQuanNvbigpO2Nhc2UgMzk6ZGF0YSA9IF9jb250ZXh0MTcuc2VudDtfY29udGV4dDE3Lm5leHQgPSA0NTticmVhaztjYXNlIDQyOl9jb250ZXh0MTcubmV4dCA9IDQ0O3JldHVybiByZXN1bHQudGV4dCgpO2Nhc2UgNDQ6ZGF0YSA9IF9jb250ZXh0MTcuc2VudDtjYXNlIDQ1OmlmICghKHJlc3VsdFR5cGUgPT09IFJlc3VsdFR5cGUuZXJyb3IpKSB7X2NvbnRleHQxNy5uZXh0ID0gNDc7YnJlYWs7fXJldHVybiBfY29udGV4dDE3LmFicnVwdCgicmV0dXJuIiwgeyB0eXBlOiByZXN1bHRUeXBlLCBlcnJvcjogbmV3IHJvdXRlcl9FcnJvclJlc3BvbnNlKHN0YXR1cywgcmVzdWx0LnN0YXR1c1RleHQsIGRhdGEpLCBoZWFkZXJzOiByZXN1bHQuaGVhZGVycyB9KTtjYXNlIDQ3OnJldHVybiBfY29udGV4dDE3LmFicnVwdCgicmV0dXJuIiwgeyB0eXBlOiBSZXN1bHRUeXBlLmRhdGEsIGRhdGE6IGRhdGEsIHN0YXR1c0NvZGU6IHJlc3VsdC5zdGF0dXMsIGhlYWRlcnM6IHJlc3VsdC5oZWFkZXJzIH0pO2Nhc2UgNDg6aWYgKCEocmVzdWx0VHlwZSA9PT0gUmVzdWx0VHlwZS5lcnJvcikpIHtfY29udGV4dDE3Lm5leHQgPSA1MDticmVhazt9cmV0dXJuIF9jb250ZXh0MTcuYWJydXB0KCJyZXR1cm4iLCB7IHR5cGU6IHJlc3VsdFR5cGUsIGVycm9yOiByZXN1bHQgfSk7Y2FzZSA1MDppZiAoIShyZXN1bHQgaW5zdGFuY2VvZiBEZWZlcnJlZERhdGEpKSB7X2NvbnRleHQxNy5uZXh0ID0gNTI7YnJlYWs7fXJldHVybiBfY29udGV4dDE3LmFicnVwdCgicmV0dXJuIiwgeyB0eXBlOiBSZXN1bHRUeXBlLmRlZmVycmVkLCBkZWZlcnJlZERhdGE6IHJlc3VsdCB9KTtjYXNlIDUyOnJldHVybiBfY29udGV4dDE3LmFicnVwdCgicmV0dXJuIiwgeyB0eXBlOiBSZXN1bHRUeXBlLmRhdGEsIGRhdGE6IHJlc3VsdCB9KTtjYXNlIDUzOmNhc2UgImVuZCI6cmV0dXJuIF9jb250ZXh0MTcuc3RvcCgpO319LCBfY2FsbGVlMTYsIG51bGwsIFtbNiwgMTUsIDE5LCAyMl1dKTt9KSk7cmV0dXJuIF9jYWxsTG9hZGVyT3JBY3Rpb24uYXBwbHkodGhpcywgYXJndW1lbnRzKTt9ZnVuY3Rpb24gY3JlYXRlQ2xpZW50U2lkZVJlcXVlc3QoaGlzdG9yeSwgbG9jYXRpb24sIHNpZ25hbCwgc3VibWlzc2lvbikge3ZhciB1cmwgPSBoaXN0b3J5LmNyZWF0ZVVSTChzdHJpcEhhc2hGcm9tUGF0aChsb2NhdGlvbikpLnRvU3RyaW5nKCk7dmFyIGluaXQgPSB7IHNpZ25hbDogc2lnbmFsIH07aWYgKHN1Ym1pc3Npb24gJiYgaXNNdXRhdGlvbk1ldGhvZChzdWJtaXNzaW9uLmZvcm1NZXRob2QpKSB7dmFyIGZvcm1NZXRob2QgPQogICAgICAgICAgICAgICAgc3VibWlzc2lvbi5mb3JtTWV0aG9kLGZvcm1FbmNUeXBlID0gc3VibWlzc2lvbi5mb3JtRW5jVHlwZSxmb3JtRGF0YSA9IHN1Ym1pc3Npb24uZm9ybURhdGE7CiAgICAgICAgICAgICAgaW5pdC5tZXRob2QgPSBmb3JtTWV0aG9kLnRvVXBwZXJDYXNlKCk7CiAgICAgICAgICAgICAgaW5pdC5ib2R5ID0gZm9ybUVuY1R5cGUgPT09ICJhcHBsaWNhdGlvbi94LXd3dy1mb3JtLXVybGVuY29kZWQiID8gY29udmVydEZvcm1EYXRhVG9TZWFyY2hQYXJhbXMoZm9ybURhdGEpIDogZm9ybURhdGE7CiAgICAgICAgICAgIH0gLy8gQ29udGVudC1UeXBlIGlzIGluZmVycmVkIChodHRwczovL2ZldGNoLnNwZWMud2hhdHdnLm9yZy8jZG9tLXJlcXVlc3QpCgoKICAgICAgICAgICAgcmV0dXJuIG5ldyBSZXF1ZXN0KHVybCwgaW5pdCk7CiAgICAgICAgICB9CgogICAgICAgICAgZnVuY3Rpb24gY29udmVydEZvcm1EYXRhVG9TZWFyY2hQYXJhbXMoZm9ybURhdGEpIHsKICAgICAgICAgICAgdmFyIHNlYXJjaFBhcmFtcyA9IG5ldyBVUkxTZWFyY2hQYXJhbXMoKTt2YXIgX2l0ZXJhdG9yOCA9IF9jcmVhdGVGb3JPZkl0ZXJhdG9ySGVscGVyMigKCiAgICAgICAgICAgICAgZm9ybURhdGEuZW50cmllcygpKSxfc3RlcDg7dHJ5IHtmb3IgKF9pdGVyYXRvcjgucygpOyAhKF9zdGVwOCA9IF9pdGVyYXRvcjgubigpKS5kb25lOykge3ZhciBfc3RlcDgkdmFsdWUgPSBfc2xpY2VkVG9BcnJheTIoX3N0ZXA4LnZhbHVlLCAyKSxrZXkgPSBfc3RlcDgkdmFsdWVbMF0sdmFsdWUgPSBfc3RlcDgkdmFsdWVbMV07CiAgICAgICAgICAgICAgICAvLyBodHRwczovL2h0bWwuc3BlYy53aGF0d2cub3JnL211bHRpcGFnZS9mb3JtLWNvbnRyb2wtaW5mcmFzdHJ1Y3R1cmUuaHRtbCNjb252ZXJ0aW5nLWFuLWVudHJ5LWxpc3QtdG8tYS1saXN0LW9mLW5hbWUtdmFsdWUtcGFpcnMKICAgICAgICAgICAgICAgIHNlYXJjaFBhcmFtcy5hcHBlbmQoa2V5LCB2YWx1ZSBpbnN0YW5jZW9mIEZpbGUgPyB2YWx1ZS5uYW1lIDogdmFsdWUpOwogICAgICAgICAgICAgIH19IGNhdGNoIChlcnIpIHtfaXRlcmF0b3I4LmUoZXJyKTt9IGZpbmFsbHkge19pdGVyYXRvcjguZigpO30KCiAgICAgICAgICAgIHJldHVybiBzZWFyY2hQYXJhbXM7CiAgICAgICAgICB9CgogICAgICAgICAgZnVuY3Rpb24gcHJvY2Vzc1JvdXRlTG9hZGVyRGF0YShtYXRjaGVzLCBtYXRjaGVzVG9Mb2FkLCByZXN1bHRzLCBwZW5kaW5nRXJyb3IsIGFjdGl2ZURlZmVycmVkcykgewogICAgICAgICAgICAvLyBGaWxsIGluIGxvYWRlckRhdGEvZXJyb3JzIGZyb20gb3VyIGxvYWRlcnMKICAgICAgICAgICAgdmFyIGxvYWRlckRhdGEgPSB7fTsKICAgICAgICAgICAgdmFyIGVycm9ycyA9IG51bGw7CiAgICAgICAgICAgIHZhciBzdGF0dXNDb2RlOwogICAgICAgICAgICB2YXIgZm91bmRFcnJvciA9IGZhbHNlOwogICAgICAgICAgICB2YXIgbG9hZGVySGVhZGVycyA9IHt9OyAvLyBQcm9jZXNzIGxvYWRlciByZXN1bHRzIGludG8gc3RhdGUubG9hZGVyRGF0YS9zdGF0ZS5lcnJvcnMKCiAgICAgICAgICAgIHJlc3VsdHMuZm9yRWFjaCgocmVzdWx0LCBpbmRleCkgPT4gewogICAgICAgICAgICAgIHZhciBpZCA9IG1hdGNoZXNUb0xvYWRbaW5kZXhdLnJvdXRlLmlkOwogICAgICAgICAgICAgIHJvdXRlcl9pbnZhcmlhbnQoIWlzUmVkaXJlY3RSZXN1bHQocmVzdWx0KSwgIkNhbm5vdCBoYW5kbGUgcmVkaXJlY3QgcmVzdWx0cyBpbiBwcm9jZXNzTG9hZGVyRGF0YSIpOwoKICAgICAgICAgICAgICBpZiAoaXNFcnJvclJlc3VsdChyZXN1bHQpKSB7CiAgICAgICAgICAgICAgICAvLyBMb29rIHVwd2FyZHMgZnJvbSB0aGUgbWF0Y2hlZCByb3V0ZSBmb3IgdGhlIGNsb3Nlc3QgYW5jZXN0b3IKICAgICAgICAgICAgICAgIC8vIGVycm9yIGJvdW5kYXJ5LCBkZWZhdWx0aW5nIHRvIHRoZSByb290IG1hdGNoCiAgICAgICAgICAgICAgICB2YXIgYm91bmRhcnlNYXRjaCA9IGZpbmROZWFyZXN0Qm91bmRhcnkobWF0Y2hlcywgaWQpOwogICAgICAgICAgICAgICAgdmFyIGVycm9yID0gcmVzdWx0LmVycm9yOyAvLyBJZiB3ZSBoYXZlIGEgcGVuZGluZyBhY3Rpb24gZXJyb3IsIHdlIHJlcG9ydCBpdCBhdCB0aGUgaGlnaGVzdC1yb3V0ZQogICAgICAgICAgICAgICAgLy8gdGhhdCB0aHJvd3MgYSBsb2FkZXIgZXJyb3IsIGFuZCB0aGVuIGNsZWFyIGl0IG91dCB0byBpbmRpY2F0ZSB0aGF0CiAgICAgICAgICAgICAgICAvLyBpdCB3YXMgY29uc3VtZWQKCiAgICAgICAgICAgICAgICBpZiAocGVuZGluZ0Vycm9yKSB7CiAgICAgICAgICAgICAgICAgIGVycm9yID0gT2JqZWN0LnZhbHVlcyhwZW5kaW5nRXJyb3IpWzBdOwogICAgICAgICAgICAgICAgICBwZW5kaW5nRXJyb3IgPSB1bmRlZmluZWQ7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgZXJyb3JzID0gZXJyb3JzIHx8IHt9OyAvLyBQcmVmZXIgaGlnaGVyIGVycm9yIHZhbHVlcyBpZiBsb3dlciBlcnJvcnMgYnViYmxlIHRvIHRoZSBzYW1lIGJvdW5kYXJ5CgogICAgICAgICAgICAgICAgaWYgKGVycm9yc1tib3VuZGFyeU1hdGNoLnJvdXRlLmlkXSA9PSBudWxsKSB7CiAgICAgICAgICAgICAgICAgIGVycm9yc1tib3VuZGFyeU1hdGNoLnJvdXRlLmlkXSA9IGVycm9yOwogICAgICAgICAgICAgICAgfSAvLyBDbGVhciBvdXIgYW55IHByaW9yIGxvYWRlckRhdGEgZm9yIHRoZSB0aHJvd2luZyByb3V0ZQoKCiAgICAgICAgICAgICAgICBsb2FkZXJEYXRhW2lkXSA9IHVuZGVmaW5lZDsgLy8gT25jZSB3ZSBmaW5kIG91ciBmaXJzdCAoaGlnaGVzdCkgZXJyb3IsIHdlIHNldCB0aGUgc3RhdHVzIGNvZGUgYW5kCiAgICAgICAgICAgICAgICAvLyBwcmV2ZW50IGRlZXBlciBzdGF0dXMgY29kZXMgZnJvbSBvdmVycmlkaW5nCgogICAgICAgICAgICAgICAgaWYgKCFmb3VuZEVycm9yKSB7CiAgICAgICAgICAgICAgICAgIGZvdW5kRXJyb3IgPSB0cnVlOwogICAgICAgICAgICAgICAgICBzdGF0dXNDb2RlID0gaXNSb3V0ZUVycm9yUmVzcG9uc2UocmVzdWx0LmVycm9yKSA/IHJlc3VsdC5lcnJvci5zdGF0dXMgOiA1MDA7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgaWYgKHJlc3VsdC5oZWFkZXJzKSB7CiAgICAgICAgICAgICAgICAgIGxvYWRlckhlYWRlcnNbaWRdID0gcmVzdWx0LmhlYWRlcnM7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGlmIChpc0RlZmVycmVkUmVzdWx0KHJlc3VsdCkpIHsKICAgICAgICAgICAgICAgICAgYWN0aXZlRGVmZXJyZWRzLnNldChpZCwgcmVzdWx0LmRlZmVycmVkRGF0YSk7CiAgICAgICAgICAgICAgICAgIGxvYWRlckRhdGFbaWRdID0gcmVzdWx0LmRlZmVycmVkRGF0YS5kYXRhOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgbG9hZGVyRGF0YVtpZF0gPSByZXN1bHQuZGF0YTsKICAgICAgICAgICAgICAgIH0gLy8gRXJyb3Igc3RhdHVzIGNvZGVzIGFsd2F5cyBvdmVycmlkZSBzdWNjZXNzIHN0YXR1cyBjb2RlcywgYnV0IGlmIGFsbAogICAgICAgICAgICAgICAgLy8gbG9hZGVycyBhcmUgc3VjY2Vzc2Z1bCB3ZSB0YWtlIHRoZSBkZWVwZXN0IHN0YXR1cyBjb2RlLgoKCiAgICAgICAgICAgICAgICBpZiAocmVzdWx0LnN0YXR1c0NvZGUgIT0gbnVsbCAmJiByZXN1bHQuc3RhdHVzQ29kZSAhPT0gMjAwICYmICFmb3VuZEVycm9yKSB7CiAgICAgICAgICAgICAgICAgIHN0YXR1c0NvZGUgPSByZXN1bHQuc3RhdHVzQ29kZTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBpZiAocmVzdWx0LmhlYWRlcnMpIHsKICAgICAgICAgICAgICAgICAgbG9hZGVySGVhZGVyc1tpZF0gPSByZXN1bHQuaGVhZGVyczsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOyAvLyBJZiB3ZSBkaWRuJ3QgY29uc3VtZSB0aGUgcGVuZGluZyBhY3Rpb24gZXJyb3IgKGkuZS4sIGFsbCBsb2FkZXJzCiAgICAgICAgICAgIC8vIHJlc29sdmVkKSwgdGhlbiBjb25zdW1lIGl0IGhlcmUuICBBbHNvIGNsZWFyIG91dCBhbnkgbG9hZGVyRGF0YSBmb3IgdGhlCiAgICAgICAgICAgIC8vIHRocm93aW5nIHJvdXRlCgogICAgICAgICAgICBpZiAocGVuZGluZ0Vycm9yKSB7CiAgICAgICAgICAgICAgZXJyb3JzID0gcGVuZGluZ0Vycm9yOwogICAgICAgICAgICAgIGxvYWRlckRhdGFbT2JqZWN0LmtleXMocGVuZGluZ0Vycm9yKVswXV0gPSB1bmRlZmluZWQ7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgbG9hZGVyRGF0YTogbG9hZGVyRGF0YSwKICAgICAgICAgICAgICBlcnJvcnM6IGVycm9ycywKICAgICAgICAgICAgICBzdGF0dXNDb2RlOiBzdGF0dXNDb2RlIHx8IDIwMCwKICAgICAgICAgICAgICBsb2FkZXJIZWFkZXJzOiBsb2FkZXJIZWFkZXJzCiAgICAgICAgICAgIH07CiAgICAgICAgICB9CgogICAgICAgICAgZnVuY3Rpb24gcHJvY2Vzc0xvYWRlckRhdGEoc3RhdGUsIG1hdGNoZXMsIG1hdGNoZXNUb0xvYWQsIHJlc3VsdHMsIHBlbmRpbmdFcnJvciwgcmV2YWxpZGF0aW5nRmV0Y2hlcnMsIGZldGNoZXJSZXN1bHRzLCBhY3RpdmVEZWZlcnJlZHMpIHsKICAgICAgICAgICAgdmFyIF9wcm9jZXNzUm91dGVMb2FkZXJEYSA9CgoKICAgICAgICAgICAgICBwcm9jZXNzUm91dGVMb2FkZXJEYXRhKG1hdGNoZXMsIG1hdGNoZXNUb0xvYWQsIHJlc3VsdHMsIHBlbmRpbmdFcnJvciwgYWN0aXZlRGVmZXJyZWRzKSxsb2FkZXJEYXRhID0gX3Byb2Nlc3NSb3V0ZUxvYWRlckRhLmxvYWRlckRhdGEsZXJyb3JzID0gX3Byb2Nlc3NSb3V0ZUxvYWRlckRhLmVycm9yczsgLy8gUHJvY2VzcyByZXN1bHRzIGZyb20gb3VyIHJldmFsaWRhdGluZyBmZXRjaGVycwoKICAgICAgICAgICAgZm9yICh2YXIgaW5kZXggPSAwOyBpbmRleCA8IHJldmFsaWRhdGluZ0ZldGNoZXJzLmxlbmd0aDsgaW5kZXgrKykgewogICAgICAgICAgICAgIHZhciBfcmV2YWxpZGF0aW5nRmV0Y2hlcnMgPQoKCiAgICAgICAgICAgICAgICByZXZhbGlkYXRpbmdGZXRjaGVyc1tpbmRleF0sa2V5ID0gX3JldmFsaWRhdGluZ0ZldGNoZXJzLmtleSxtYXRjaCA9IF9yZXZhbGlkYXRpbmdGZXRjaGVycy5tYXRjaDsKICAgICAgICAgICAgICByb3V0ZXJfaW52YXJpYW50KGZldGNoZXJSZXN1bHRzICE9PSB1bmRlZmluZWQgJiYgZmV0Y2hlclJlc3VsdHNbaW5kZXhdICE9PSB1bmRlZmluZWQsICJEaWQgbm90IGZpbmQgY29ycmVzcG9uZGluZyBmZXRjaGVyIHJlc3VsdCIpOwogICAgICAgICAgICAgIHZhciByZXN1bHQgPSBmZXRjaGVyUmVzdWx0c1tpbmRleF07IC8vIFByb2Nlc3MgZmV0Y2hlciBub24tcmVkaXJlY3QgZXJyb3JzCgogICAgICAgICAgICAgIGlmIChpc0Vycm9yUmVzdWx0KHJlc3VsdCkpIHsKICAgICAgICAgICAgICAgIHZhciBib3VuZGFyeU1hdGNoID0gZmluZE5lYXJlc3RCb3VuZGFyeShzdGF0ZS5tYXRjaGVzLCBtYXRjaC5yb3V0ZS5pZCk7CgogICAgICAgICAgICAgICAgaWYgKCEoZXJyb3JzICYmIGVycm9yc1tib3VuZGFyeU1hdGNoLnJvdXRlLmlkXSkpIHsKICAgICAgICAgICAgICAgICAgZXJyb3JzID0gX2V4dGVuZHMoe30sIGVycm9ycywgX2RlZmluZVByb3BlcnR5Mih7fSwKICAgICAgICAgICAgICAgICAgYm91bmRhcnlNYXRjaC5yb3V0ZS5pZCwgcmVzdWx0LmVycm9yKSk7CgogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHN0YXRlLmZldGNoZXJzLmRlbGV0ZShrZXkpOwogICAgICAgICAgICAgIH0gZWxzZSBpZiAoaXNSZWRpcmVjdFJlc3VsdChyZXN1bHQpKSB7CiAgICAgICAgICAgICAgICAvLyBTaG91bGQgbmV2ZXIgZ2V0IGhlcmUsIHJlZGlyZWN0cyBzaG91bGQgZ2V0IHByb2Nlc3NlZCBhYm92ZSwgYnV0IHdlCiAgICAgICAgICAgICAgICAvLyBrZWVwIHRoaXMgdG8gdHlwZSBuYXJyb3cgdG8gYSBzdWNjZXNzIHJlc3VsdCBpbiB0aGUgZWxzZQogICAgICAgICAgICAgICAgcm91dGVyX2ludmFyaWFudChmYWxzZSwgIlVuaGFuZGxlZCBmZXRjaGVyIHJldmFsaWRhdGlvbiByZWRpcmVjdCIpOwogICAgICAgICAgICAgIH0gZWxzZSBpZiAoaXNEZWZlcnJlZFJlc3VsdChyZXN1bHQpKSB7CiAgICAgICAgICAgICAgICAvLyBTaG91bGQgbmV2ZXIgZ2V0IGhlcmUsIGRlZmVycmVkIGRhdGEgc2hvdWxkIGJlIGF3YWl0ZWQgZm9yIGZldGNoZXJzCiAgICAgICAgICAgICAgICAvLyBpbiByZXNvbHZlRGVmZXJyZWRSZXN1bHRzCiAgICAgICAgICAgICAgICByb3V0ZXJfaW52YXJpYW50KGZhbHNlLCAiVW5oYW5kbGVkIGZldGNoZXIgZGVmZXJyZWQgZGF0YSIpOwogICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICB2YXIgZG9uZUZldGNoZXIgPSB7CiAgICAgICAgICAgICAgICAgIHN0YXRlOiAiaWRsZSIsCiAgICAgICAgICAgICAgICAgIGRhdGE6IHJlc3VsdC5kYXRhLAogICAgICAgICAgICAgICAgICBmb3JtTWV0aG9kOiB1bmRlZmluZWQsCiAgICAgICAgICAgICAgICAgIGZvcm1BY3Rpb246IHVuZGVmaW5lZCwKICAgICAgICAgICAgICAgICAgZm9ybUVuY1R5cGU6IHVuZGVmaW5lZCwKICAgICAgICAgICAgICAgICAgZm9ybURhdGE6IHVuZGVmaW5lZCwKICAgICAgICAgICAgICAgICAgIiBfaGFzRmV0Y2hlckRvbmVBbnl0aGluZyAiOiB0cnVlCiAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgc3RhdGUuZmV0Y2hlcnMuc2V0KGtleSwgZG9uZUZldGNoZXIpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICBsb2FkZXJEYXRhOiBsb2FkZXJEYXRhLAogICAgICAgICAgICAgIGVycm9yczogZXJyb3JzCiAgICAgICAgICAgIH07CiAgICAgICAgICB9CgogICAgICAgICAgZnVuY3Rpb24gbWVyZ2VMb2FkZXJEYXRhKGxvYWRlckRhdGEsIG5ld0xvYWRlckRhdGEsIG1hdGNoZXMsIGVycm9ycykgewogICAgICAgICAgICB2YXIgbWVyZ2VkTG9hZGVyRGF0YSA9IF9leHRlbmRzKHt9LCBuZXdMb2FkZXJEYXRhKTt2YXIgX2l0ZXJhdG9yOSA9IF9jcmVhdGVGb3JPZkl0ZXJhdG9ySGVscGVyMigKCiAgICAgICAgICAgICAgbWF0Y2hlcyksX3N0ZXA5O3RyeSB7Zm9yIChfaXRlcmF0b3I5LnMoKTsgIShfc3RlcDkgPSBfaXRlcmF0b3I5Lm4oKSkuZG9uZTspIHt2YXIgbWF0Y2ggPSBfc3RlcDkudmFsdWU7CiAgICAgICAgICAgICAgICB2YXIgaWQgPSBtYXRjaC5yb3V0ZS5pZDsKCiAgICAgICAgICAgICAgICBpZiAobmV3TG9hZGVyRGF0YS5oYXNPd25Qcm9wZXJ0eShpZCkpIHsKICAgICAgICAgICAgICAgICAgaWYgKG5ld0xvYWRlckRhdGFbaWRdICE9PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgICAgICAgICBtZXJnZWRMb2FkZXJEYXRhW2lkXSA9IG5ld0xvYWRlckRhdGFbaWRdOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGxvYWRlckRhdGFbaWRdICE9PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgICAgICAgbWVyZ2VkTG9hZGVyRGF0YVtpZF0gPSBsb2FkZXJEYXRhW2lkXTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBpZiAoZXJyb3JzICYmIGVycm9ycy5oYXNPd25Qcm9wZXJ0eShpZCkpIHsKICAgICAgICAgICAgICAgICAgLy8gRG9uJ3Qga2VlcCBhbnkgbG9hZGVyIGRhdGEgYmVsb3cgdGhlIGJvdW5kYXJ5CiAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH19IGNhdGNoIChlcnIpIHtfaXRlcmF0b3I5LmUoZXJyKTt9IGZpbmFsbHkge19pdGVyYXRvcjkuZigpO30KCiAgICAgICAgICAgIHJldHVybiBtZXJnZWRMb2FkZXJEYXRhOwogICAgICAgICAgfSAvLyBGaW5kIHRoZSBuZWFyZXN0IGVycm9yIGJvdW5kYXJ5LCBsb29raW5nIHVwd2FyZHMgZnJvbSB0aGUgbGVhZiByb3V0ZSAob3IgdGhlCiAgICAgICAgICAvLyByb3V0ZSBzcGVjaWZpZWQgYnkgcm91dGVJZCkgZm9yIHRoZSBjbG9zZXN0IGFuY2VzdG9yIGVycm9yIGJvdW5kYXJ5LAogICAgICAgICAgLy8gZGVmYXVsdGluZyB0byB0aGUgcm9vdCBtYXRjaAoKCiAgICAgICAgICBmdW5jdGlvbiBmaW5kTmVhcmVzdEJvdW5kYXJ5KG1hdGNoZXMsIHJvdXRlSWQpIHsKICAgICAgICAgICAgdmFyIGVsaWdpYmxlTWF0Y2hlcyA9IHJvdXRlSWQgPyBtYXRjaGVzLnNsaWNlKDAsIG1hdGNoZXMuZmluZEluZGV4KChtKSA9PiBtLnJvdXRlLmlkID09PSByb3V0ZUlkKSArIDEpIDogX3RvQ29uc3VtYWJsZUFycmF5MihtYXRjaGVzKTsKICAgICAgICAgICAgcmV0dXJuIGVsaWdpYmxlTWF0Y2hlcy5yZXZlcnNlKCkuZmluZCgobSkgPT4gbS5yb3V0ZS5oYXNFcnJvckJvdW5kYXJ5ID09PSB0cnVlKSB8fCBtYXRjaGVzWzBdOwogICAgICAgICAgfQoKICAgICAgICAgIGZ1bmN0aW9uIGdldFNob3J0Q2lyY3VpdE1hdGNoZXMocm91dGVzKSB7CiAgICAgICAgICAgIC8vIFByZWZlciBhIHJvb3QgbGF5b3V0IHJvdXRlIGlmIHByZXNlbnQsIG90aGVyd2lzZSBzaGltIGluIGEgcm91dGUgb2JqZWN0CiAgICAgICAgICAgIHZhciByb3V0ZSA9IHJvdXRlcy5maW5kKChyKSA9PiByLmluZGV4IHx8ICFyLnBhdGggfHwgci5wYXRoID09PSAiLyIpIHx8IHsKICAgICAgICAgICAgICBpZDogIl9fc2hpbS1lcnJvci1yb3V0ZV9fIgogICAgICAgICAgICB9OwogICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgIG1hdGNoZXM6IFt7CiAgICAgICAgICAgICAgICBwYXJhbXM6IHt9LAogICAgICAgICAgICAgICAgcGF0aG5hbWU6ICIiLAogICAgICAgICAgICAgICAgcGF0aG5hbWVCYXNlOiAiIiwKICAgICAgICAgICAgICAgIHJvdXRlOiByb3V0ZQogICAgICAgICAgICAgIH1dLAogICAgICAgICAgICAgIHJvdXRlOiByb3V0ZQogICAgICAgICAgICB9OwogICAgICAgICAgfQoKICAgICAgICAgIGZ1bmN0aW9uIGdldEludGVybmFsUm91dGVyRXJyb3Ioc3RhdHVzLCBfdGVtcDQpIHsKICAgICAgICAgICAgdmFyIF9yZWYxNyA9CgoKCgogICAgICAgICAgICAgIF90ZW1wNCA9PT0gdm9pZCAwID8ge30gOiBfdGVtcDQscGF0aG5hbWUgPSBfcmVmMTcucGF0aG5hbWUscm91dGVJZCA9IF9yZWYxNy5yb3V0ZUlkLG1ldGhvZCA9IF9yZWYxNy5tZXRob2QsdHlwZSA9IF9yZWYxNy50eXBlOwogICAgICAgICAgICB2YXIgc3RhdHVzVGV4dCA9ICJVbmtub3duIFNlcnZlciBFcnJvciI7CiAgICAgICAgICAgIHZhciBlcnJvck1lc3NhZ2UgPSAiVW5rbm93biBAcmVtaXgtcnVuL3JvdXRlciBlcnJvciI7CgogICAgICAgICAgICBpZiAoc3RhdHVzID09PSA0MDApIHsKICAgICAgICAgICAgICBzdGF0dXNUZXh0ID0gIkJhZCBSZXF1ZXN0IjsKCiAgICAgICAgICAgICAgaWYgKG1ldGhvZCAmJiBwYXRobmFtZSAmJiByb3V0ZUlkKSB7CiAgICAgICAgICAgICAgICBlcnJvck1lc3NhZ2UgPSAiWW91IG1hZGUgYSAiICsgbWV0aG9kICsgIiByZXF1ZXN0IHRvIFwiIiArIHBhdGhuYW1lICsgIlwiIGJ1dCAiICsgKCJkaWQgbm90IHByb3ZpZGUgYSBgbG9hZGVyYCBmb3Igcm91dGUgXCIiICsgcm91dGVJZCArICJcIiwgIikgKyAic28gdGhlcmUgaXMgbm8gd2F5IHRvIGhhbmRsZSB0aGUgcmVxdWVzdC4iOwogICAgICAgICAgICAgIH0gZWxzZSBpZiAodHlwZSA9PT0gImRlZmVyLWFjdGlvbiIpIHsKICAgICAgICAgICAgICAgIGVycm9yTWVzc2FnZSA9ICJkZWZlcigpIGlzIG5vdCBzdXBwb3J0ZWQgaW4gYWN0aW9ucyI7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2UgaWYgKHN0YXR1cyA9PT0gNDAzKSB7CiAgICAgICAgICAgICAgc3RhdHVzVGV4dCA9ICJGb3JiaWRkZW4iOwogICAgICAgICAgICAgIGVycm9yTWVzc2FnZSA9ICJSb3V0ZSBcIiIgKyByb3V0ZUlkICsgIlwiIGRvZXMgbm90IG1hdGNoIFVSTCBcIiIgKyBwYXRobmFtZSArICJcIiI7CiAgICAgICAgICAgIH0gZWxzZSBpZiAoc3RhdHVzID09PSA0MDQpIHsKICAgICAgICAgICAgICBzdGF0dXNUZXh0ID0gIk5vdCBGb3VuZCI7CiAgICAgICAgICAgICAgZXJyb3JNZXNzYWdlID0gIk5vIHJvdXRlIG1hdGNoZXMgVVJMIFwiIiArIHBhdGhuYW1lICsgIlwiIjsKICAgICAgICAgICAgfSBlbHNlIGlmIChzdGF0dXMgPT09IDQwNSkgewogICAgICAgICAgICAgIHN0YXR1c1RleHQgPSAiTWV0aG9kIE5vdCBBbGxvd2VkIjsKCiAgICAgICAgICAgICAgaWYgKG1ldGhvZCAmJiBwYXRobmFtZSAmJiByb3V0ZUlkKSB7CiAgICAgICAgICAgICAgICBlcnJvck1lc3NhZ2UgPSAiWW91IG1hZGUgYSAiICsgbWV0aG9kLnRvVXBwZXJDYXNlKCkgKyAiIHJlcXVlc3QgdG8gXCIiICsgcGF0aG5hbWUgKyAiXCIgYnV0ICIgKyAoImRpZCBub3QgcHJvdmlkZSBhbiBgYWN0aW9uYCBmb3Igcm91dGUgXCIiICsgcm91dGVJZCArICJcIiwgIikgKyAic28gdGhlcmUgaXMgbm8gd2F5IHRvIGhhbmRsZSB0aGUgcmVxdWVzdC4iOwogICAgICAgICAgICAgIH0gZWxzZSBpZiAobWV0aG9kKSB7CiAgICAgICAgICAgICAgICBlcnJvck1lc3NhZ2UgPSAiSW52YWxpZCByZXF1ZXN0IG1ldGhvZCBcIiIgKyBtZXRob2QudG9VcHBlckNhc2UoKSArICJcIiI7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICByZXR1cm4gbmV3IHJvdXRlcl9FcnJvclJlc3BvbnNlKHN0YXR1cyB8fCA1MDAsIHN0YXR1c1RleHQsIG5ldyBFcnJvcihlcnJvck1lc3NhZ2UpLCB0cnVlKTsKICAgICAgICAgIH0gLy8gRmluZCBhbnkgcmV0dXJuZWQgcmVkaXJlY3QgZXJyb3JzLCBzdGFydGluZyBmcm9tIHRoZSBsb3dlc3QgbWF0Y2gKCgogICAgICAgICAgZnVuY3Rpb24gZmluZFJlZGlyZWN0KHJlc3VsdHMpIHsKICAgICAgICAgICAgZm9yICh2YXIgaSA9IHJlc3VsdHMubGVuZ3RoIC0gMTsgaSA+PSAwOyBpLS0pIHsKICAgICAgICAgICAgICB2YXIgcmVzdWx0ID0gcmVzdWx0c1tpXTsKCiAgICAgICAgICAgICAgaWYgKGlzUmVkaXJlY3RSZXN1bHQocmVzdWx0KSkgewogICAgICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KCiAgICAgICAgICBmdW5jdGlvbiBzdHJpcEhhc2hGcm9tUGF0aChwYXRoKSB7CiAgICAgICAgICAgIHZhciBwYXJzZWRQYXRoID0gdHlwZW9mIHBhdGggPT09ICJzdHJpbmciID8gcGFyc2VQYXRoKHBhdGgpIDogcGF0aDsKICAgICAgICAgICAgcmV0dXJuIHJvdXRlcl9jcmVhdGVQYXRoKF9leHRlbmRzKHt9LCBwYXJzZWRQYXRoLCB7CiAgICAgICAgICAgICAgaGFzaDogIiIKICAgICAgICAgICAgfSkpOwogICAgICAgICAgfQoKICAgICAgICAgIGZ1bmN0aW9uIGlzSGFzaENoYW5nZU9ubHkoYSwgYikgewogICAgICAgICAgICByZXR1cm4gYS5wYXRobmFtZSA9PT0gYi5wYXRobmFtZSAmJiBhLnNlYXJjaCA9PT0gYi5zZWFyY2ggJiYgYS5oYXNoICE9PSBiLmhhc2g7CiAgICAgICAgICB9CgogICAgICAgICAgZnVuY3Rpb24gaXNEZWZlcnJlZFJlc3VsdChyZXN1bHQpIHsKICAgICAgICAgICAgcmV0dXJuIHJlc3VsdC50eXBlID09PSBSZXN1bHRUeXBlLmRlZmVycmVkOwogICAgICAgICAgfQoKICAgICAgICAgIGZ1bmN0aW9uIGlzRXJyb3JSZXN1bHQocmVzdWx0KSB7CiAgICAgICAgICAgIHJldHVybiByZXN1bHQudHlwZSA9PT0gUmVzdWx0VHlwZS5lcnJvcjsKICAgICAgICAgIH0KCiAgICAgICAgICBmdW5jdGlvbiBpc1JlZGlyZWN0UmVzdWx0KHJlc3VsdCkgewogICAgICAgICAgICByZXR1cm4gKHJlc3VsdCAmJiByZXN1bHQudHlwZSkgPT09IFJlc3VsdFR5cGUucmVkaXJlY3Q7CiAgICAgICAgICB9CgogICAgICAgICAgZnVuY3Rpb24gaXNSZXNwb25zZSh2YWx1ZSkgewogICAgICAgICAgICByZXR1cm4gdmFsdWUgIT0gbnVsbCAmJiB0eXBlb2YgdmFsdWUuc3RhdHVzID09PSAibnVtYmVyIiAmJiB0eXBlb2YgdmFsdWUuc3RhdHVzVGV4dCA9PT0gInN0cmluZyIgJiYgdHlwZW9mIHZhbHVlLmhlYWRlcnMgPT09ICJvYmplY3QiICYmIHR5cGVvZiB2YWx1ZS5ib2R5ICE9PSAidW5kZWZpbmVkIjsKICAgICAgICAgIH0KCiAgICAgICAgICBmdW5jdGlvbiBpc1JlZGlyZWN0UmVzcG9uc2UocmVzdWx0KSB7CiAgICAgICAgICAgIGlmICghaXNSZXNwb25zZShyZXN1bHQpKSB7CiAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICB9CgogICAgICAgICAgICB2YXIgc3RhdHVzID0gcmVzdWx0LnN0YXR1czsKICAgICAgICAgICAgdmFyIGxvY2F0aW9uID0gcmVzdWx0LmhlYWRlcnMuZ2V0KCJMb2NhdGlvbiIpOwogICAgICAgICAgICByZXR1cm4gc3RhdHVzID49IDMwMCAmJiBzdGF0dXMgPD0gMzk5ICYmIGxvY2F0aW9uICE9IG51bGw7CiAgICAgICAgICB9CgogICAgICAgICAgZnVuY3Rpb24gaXNRdWVyeVJvdXRlUmVzcG9uc2Uob2JqKSB7CiAgICAgICAgICAgIHJldHVybiBvYmogJiYgaXNSZXNwb25zZShvYmoucmVzcG9uc2UpICYmIChvYmoudHlwZSA9PT0gUmVzdWx0VHlwZS5kYXRhIHx8IFJlc3VsdFR5cGUuZXJyb3IpOwogICAgICAgICAgfQoKICAgICAgICAgIGZ1bmN0aW9uIGlzVmFsaWRNZXRob2QobWV0aG9kKSB7CiAgICAgICAgICAgIHJldHVybiB2YWxpZFJlcXVlc3RNZXRob2RzLmhhcyhtZXRob2QpOwogICAgICAgICAgfQoKICAgICAgICAgIGZ1bmN0aW9uIGlzTXV0YXRpb25NZXRob2QobWV0aG9kKSB7CiAgICAgICAgICAgIHJldHVybiB2YWxpZE11dGF0aW9uTWV0aG9kcy5oYXMobWV0aG9kKTsKICAgICAgICAgIH1mdW5jdGlvbgoKICAgICAgICAgIHJlc29sdmVEZWZlcnJlZFJlc3VsdHMoX3g2OSwgX3g3MCwgX3g3MSwgX3g3MiwgX3g3MywgX3g3NCkge3JldHVybiBfcmVzb2x2ZURlZmVycmVkUmVzdWx0cy5hcHBseSh0aGlzLCBhcmd1bWVudHMpO31mdW5jdGlvbiBfcmVzb2x2ZURlZmVycmVkUmVzdWx0cygpIHtfcmVzb2x2ZURlZmVycmVkUmVzdWx0cyA9IF9hc3luY1RvR2VuZXJhdG9yMiggLyojX19QVVJFX18qL19yZWdlbmVyYXRvclJ1bnRpbWUyKCkubWFyayhmdW5jdGlvbiBfY2FsbGVlMTcoY3VycmVudE1hdGNoZXMsIG1hdGNoZXNUb0xvYWQsIHJlc3VsdHMsIHNpZ25hbCwgaXNGZXRjaGVyLCBjdXJyZW50TG9hZGVyRGF0YSkge3ZhciBfbG9vcDIsIGluZGV4O3JldHVybiBfcmVnZW5lcmF0b3JSdW50aW1lMigpLndyYXAoZnVuY3Rpb24gX2NhbGxlZTE3JChfY29udGV4dDE5KSB7d2hpbGUgKDEpIHN3aXRjaCAoX2NvbnRleHQxOS5wcmV2ID0gX2NvbnRleHQxOS5uZXh0KSB7Y2FzZSAwOl9sb29wMiA9IC8qI19fUFVSRV9fKi9fcmVnZW5lcmF0b3JSdW50aW1lMigpLm1hcmsoZnVuY3Rpb24gX2xvb3AyKGluZGV4KSB7dmFyIHJlc3VsdCwgbWF0Y2gsIGN1cnJlbnRNYXRjaCwgaXNSZXZhbGlkYXRpbmdMb2FkZXI7cmV0dXJuIF9yZWdlbmVyYXRvclJ1bnRpbWUyKCkud3JhcChmdW5jdGlvbiBfbG9vcDIkKF9jb250ZXh0MTgpIHt3aGlsZSAoMSkgc3dpdGNoIChfY29udGV4dDE4LnByZXYgPSBfY29udGV4dDE4Lm5leHQpIHtjYXNlIDA6CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0ID0gcmVzdWx0c1tpbmRleF07CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtYXRjaCA9IG1hdGNoZXNUb0xvYWRbaW5kZXhdOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVudE1hdGNoID0gY3VycmVudE1hdGNoZXMuZmluZCgobSkgPT4gbS5yb3V0ZS5pZCA9PT0gbWF0Y2gucm91dGUuaWQpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaXNSZXZhbGlkYXRpbmdMb2FkZXIgPSBjdXJyZW50TWF0Y2ggIT0gbnVsbCAmJiAhaXNOZXdSb3V0ZUluc3RhbmNlKGN1cnJlbnRNYXRjaCwgbWF0Y2gpICYmIChjdXJyZW50TG9hZGVyRGF0YSAmJiBjdXJyZW50TG9hZGVyRGF0YVttYXRjaC5yb3V0ZS5pZF0pICE9PSB1bmRlZmluZWQ7aWYgKCEoCgogICAgICAgICAgICAgICAgICAgICAgICAgICAgaXNEZWZlcnJlZFJlc3VsdChyZXN1bHQpICYmIChpc0ZldGNoZXIgfHwgaXNSZXZhbGlkYXRpbmdMb2FkZXIpKSkge19jb250ZXh0MTgubmV4dCA9IDc7YnJlYWs7fV9jb250ZXh0MTgubmV4dCA9IDc7cmV0dXJuICgKCgoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZURlZmVycmVkRGF0YShyZXN1bHQsIHNpZ25hbCwgaXNGZXRjaGVyKS50aGVuKChyZXN1bHQpID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocmVzdWx0KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXN1bHRzW2luZGV4XSA9IHJlc3VsdCB8fCByZXN1bHRzW2luZGV4XTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pKTtjYXNlIDc6Y2FzZSAiZW5kIjpyZXR1cm4gX2NvbnRleHQxOC5zdG9wKCk7fX0sIF9sb29wMik7fSk7aW5kZXggPSAwO2Nhc2UgMjppZiAoIShpbmRleCA8IHJlc3VsdHMubGVuZ3RoKSkge19jb250ZXh0MTkubmV4dCA9IDc7YnJlYWs7fXJldHVybiBfY29udGV4dDE5LmRlbGVnYXRlWWllbGQoX2xvb3AyKGluZGV4KSwgInQwIiwgNCk7Y2FzZSA0OmluZGV4Kys7X2NvbnRleHQxOS5uZXh0ID0gMjticmVhaztjYXNlIDc6Y2FzZSAiZW5kIjpyZXR1cm4gX2NvbnRleHQxOS5zdG9wKCk7fX0sIF9jYWxsZWUxNyk7fSkpO3JldHVybiBfcmVzb2x2ZURlZmVycmVkUmVzdWx0cy5hcHBseSh0aGlzLCBhcmd1bWVudHMpO31mdW5jdGlvbgoKCgoKICAgICAgICAgIHJlc29sdmVEZWZlcnJlZERhdGEoX3g3NSwgX3g3NiwgX3g3Nykge3JldHVybiBfcmVzb2x2ZURlZmVycmVkRGF0YS5hcHBseSh0aGlzLCBhcmd1bWVudHMpO31mdW5jdGlvbiBfcmVzb2x2ZURlZmVycmVkRGF0YSgpIHtfcmVzb2x2ZURlZmVycmVkRGF0YSA9IF9hc3luY1RvR2VuZXJhdG9yMiggLyojX19QVVJFX18qL19yZWdlbmVyYXRvclJ1bnRpbWUyKCkubWFyayhmdW5jdGlvbiBfY2FsbGVlMTgocmVzdWx0LCBzaWduYWwsIHVud3JhcCkge3ZhciBhYm9ydGVkO3JldHVybiBfcmVnZW5lcmF0b3JSdW50aW1lMigpLndyYXAoZnVuY3Rpb24gX2NhbGxlZTE4JChfY29udGV4dDIwKSB7d2hpbGUgKDEpIHN3aXRjaCAoX2NvbnRleHQyMC5wcmV2ID0gX2NvbnRleHQyMC5uZXh0KSB7Y2FzZSAwOgogICAgICAgICAgICAgICAgICAgIGlmICh1bndyYXAgPT09IHZvaWQgMCkgewogICAgICAgICAgICAgICAgICAgICAgdW53cmFwID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgICAgfV9jb250ZXh0MjAubmV4dCA9IDM7cmV0dXJuICgKCiAgICAgICAgICAgICAgICAgICAgICByZXN1bHQuZGVmZXJyZWREYXRhLnJlc29sdmVEYXRhKHNpZ25hbCkpO2Nhc2UgMzphYm9ydGVkID0gX2NvbnRleHQyMC5zZW50O2lmICghCgogICAgICAgICAgICAgICAgICAgIGFib3J0ZWQpIHtfY29udGV4dDIwLm5leHQgPSA2O2JyZWFrO31yZXR1cm4gX2NvbnRleHQyMC5hYnJ1cHQoInJldHVybiIpO2Nhc2UgNjppZiAoIQoKCgogICAgICAgICAgICAgICAgICAgIHVud3JhcCkge19jb250ZXh0MjAubmV4dCA9IDE0O2JyZWFrO31fY29udGV4dDIwLnByZXYgPSA3O3JldHVybiBfY29udGV4dDIwLmFicnVwdCgicmV0dXJuIiwKCiAgICAgICAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgICAgICAgdHlwZTogUmVzdWx0VHlwZS5kYXRhLAogICAgICAgICAgICAgICAgICAgICAgZGF0YTogcmVzdWx0LmRlZmVycmVkRGF0YS51bndyYXBwZWREYXRhCiAgICAgICAgICAgICAgICAgICAgfSk7Y2FzZSAxMTpfY29udGV4dDIwLnByZXYgPSAxMTtfY29udGV4dDIwLnQwID0gX2NvbnRleHQyMFsiY2F0Y2giXSg3KTtyZXR1cm4gX2NvbnRleHQyMC5hYnJ1cHQoInJldHVybiIsCgoKICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICB0eXBlOiBSZXN1bHRUeXBlLmVycm9yLAogICAgICAgICAgICAgICAgICAgICAgZXJyb3I6IF9jb250ZXh0MjAudDAKICAgICAgICAgICAgICAgICAgICB9KTtjYXNlIDE0OnJldHVybiBfY29udGV4dDIwLmFicnVwdCgicmV0dXJuIiwKCgoKICAgICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgICB0eXBlOiBSZXN1bHRUeXBlLmRhdGEsCiAgICAgICAgICAgICAgICAgICAgICBkYXRhOiByZXN1bHQuZGVmZXJyZWREYXRhLmRhdGEKICAgICAgICAgICAgICAgICAgICB9KTtjYXNlIDE1OmNhc2UgImVuZCI6cmV0dXJuIF9jb250ZXh0MjAuc3RvcCgpO319LCBfY2FsbGVlMTgsIG51bGwsIFtbNywgMTFdXSk7fSkpO3JldHVybiBfcmVzb2x2ZURlZmVycmVkRGF0YS5hcHBseSh0aGlzLCBhcmd1bWVudHMpO30KCgogICAgICAgICAgZnVuY3Rpb24gaGFzTmFrZWRJbmRleFF1ZXJ5KHNlYXJjaCkgewogICAgICAgICAgICByZXR1cm4gbmV3IFVSTFNlYXJjaFBhcmFtcyhzZWFyY2gpLmdldEFsbCgiaW5kZXgiKS5zb21lKCh2KSA9PiB2ID09PSAiIik7CiAgICAgICAgICB9IC8vIE5vdGU6IFRoaXMgc2hvdWxkIG1hdGNoIHRoZSBmb3JtYXQgZXhwb3J0ZWQgYnkgdXNlTWF0Y2hlcywgc28gaWYgeW91IGNoYW5nZQogICAgICAgICAgLy8gdGhpcyBwbGVhc2UgYWxzbyBjaGFuZ2UgdGhhdCA6KSAgRXZlbnR1YWxseSB3ZSdsbCBEUlkgdGhpcyB1cAoKCiAgICAgICAgICBmdW5jdGlvbiBjcmVhdGVVc2VNYXRjaGVzTWF0Y2gobWF0Y2gsIGxvYWRlckRhdGEpIHsKICAgICAgICAgICAgdmFyCiAgICAgICAgICAgICAgcm91dGUgPQoKCiAgICAgICAgICAgICAgbWF0Y2gucm91dGUscGF0aG5hbWUgPSBtYXRjaC5wYXRobmFtZSxwYXJhbXMgPSBtYXRjaC5wYXJhbXM7CiAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgaWQ6IHJvdXRlLmlkLAogICAgICAgICAgICAgIHBhdGhuYW1lOiBwYXRobmFtZSwKICAgICAgICAgICAgICBwYXJhbXM6IHBhcmFtcywKICAgICAgICAgICAgICBkYXRhOiBsb2FkZXJEYXRhW3JvdXRlLmlkXSwKICAgICAgICAgICAgICBoYW5kbGU6IHJvdXRlLmhhbmRsZQogICAgICAgICAgICB9OwogICAgICAgICAgfQoKICAgICAgICAgIGZ1bmN0aW9uIGdldFRhcmdldE1hdGNoKG1hdGNoZXMsIGxvY2F0aW9uKSB7CiAgICAgICAgICAgIHZhciBzZWFyY2ggPSB0eXBlb2YgbG9jYXRpb24gPT09ICJzdHJpbmciID8gcGFyc2VQYXRoKGxvY2F0aW9uKS5zZWFyY2ggOiBsb2NhdGlvbi5zZWFyY2g7CgogICAgICAgICAgICBpZiAobWF0Y2hlc1ttYXRjaGVzLmxlbmd0aCAtIDFdLnJvdXRlLmluZGV4ICYmIGhhc05ha2VkSW5kZXhRdWVyeShzZWFyY2ggfHwgIiIpKSB7CiAgICAgICAgICAgICAgLy8gUmV0dXJuIHRoZSBsZWFmIGluZGV4IHJvdXRlIHdoZW4gaW5kZXggaXMgcHJlc2VudAogICAgICAgICAgICAgIHJldHVybiBtYXRjaGVzW21hdGNoZXMubGVuZ3RoIC0gMV07CiAgICAgICAgICAgIH0gLy8gT3RoZXJ3aXNlIGdyYWIgdGhlIGRlZXBlc3QgInBhdGggY29udHJpYnV0aW5nIiBtYXRjaCAoaWdub3JpbmcgaW5kZXggYW5kCiAgICAgICAgICAgIC8vIHBhdGhsZXNzIGxheW91dCByb3V0ZXMpCgoKICAgICAgICAgICAgdmFyIHBhdGhNYXRjaGVzID0gZ2V0UGF0aENvbnRyaWJ1dGluZ01hdGNoZXMobWF0Y2hlcyk7CiAgICAgICAgICAgIHJldHVybiBwYXRoTWF0Y2hlc1twYXRoTWF0Y2hlcy5sZW5ndGggLSAxXTsKICAgICAgICAgIH0gLy8jZW5kcmVnaW9uCgoKCgogICAgICAgICAgLy8gRVhURVJOQUwgTU9EVUxFOiAuL25vZGVfbW9kdWxlcy9yZWFjdC9pbmRleC5qcwogICAgICAgICAgdmFyIHJlYWN0ID0gX193ZWJwYWNrX3JlcXVpcmVfXygyOTQpOwogICAgICAgICAgdmFyIHJlYWN0X25hbWVzcGFjZU9iamVjdCA9IC8qI19fUFVSRV9fKi9fX3dlYnBhY2tfcmVxdWlyZV9fLnQocmVhY3QsIDIpOwogICAgICAgICAgOyAvLyBDT05DQVRFTkFURUQgTU9EVUxFOiAuL25vZGVfbW9kdWxlcy9yZWFjdC1yb3V0ZXIvZGlzdC9pbmRleC5qcwogICAgICAgICAgLyoqCiAgICAgICAgICAgKiBSZWFjdCBSb3V0ZXIgdjYuOC4wCiAgICAgICAgICAgKgogICAgICAgICAgICogQ29weXJpZ2h0IChjKSBSZW1peCBTb2Z0d2FyZSBJbmMuCiAgICAgICAgICAgKgogICAgICAgICAgICogVGhpcyBzb3VyY2UgY29kZSBpcyBsaWNlbnNlZCB1bmRlciB0aGUgTUlUIGxpY2Vuc2UgZm91bmQgaW4gdGhlCiAgICAgICAgICAgKiBMSUNFTlNFLm1kIGZpbGUgaW4gdGhlIHJvb3QgZGlyZWN0b3J5IG9mIHRoaXMgc291cmNlIHRyZWUuCiAgICAgICAgICAgKgogICAgICAgICAgICogQGxpY2Vuc2UgTUlUCiAgICAgICAgICAgKi8KCgoKCiAgICAgICAgICBmdW5jdGlvbiBkaXN0X2V4dGVuZHMoKSB7CiAgICAgICAgICAgIGRpc3RfZXh0ZW5kcyA9IE9iamVjdC5hc3NpZ24gPyBPYmplY3QuYXNzaWduLmJpbmQoKSA6IGZ1bmN0aW9uICh0YXJnZXQpIHsKICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMTsgaSA8IGFyZ3VtZW50cy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAgdmFyIHNvdXJjZSA9IGFyZ3VtZW50c1tpXTsKCiAgICAgICAgICAgICAgICBmb3IgKHZhciBrZXkgaW4gc291cmNlKSB7CiAgICAgICAgICAgICAgICAgIGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoc291cmNlLCBrZXkpKSB7CiAgICAgICAgICAgICAgICAgICAgdGFyZ2V0W2tleV0gPSBzb3VyY2Vba2V5XTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgcmV0dXJuIHRhcmdldDsKICAgICAgICAgICAgfTsKICAgICAgICAgICAgcmV0dXJuIGRpc3RfZXh0ZW5kcy5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICAgICAgfQoKICAgICAgICAgIC8qKgogICAgICAgICAgICogQ29weXJpZ2h0IChjKSBGYWNlYm9vaywgSW5jLiBhbmQgaXRzIGFmZmlsaWF0ZXMuCiAgICAgICAgICAgKgogICAgICAgICAgICogVGhpcyBzb3VyY2UgY29kZSBpcyBsaWNlbnNlZCB1bmRlciB0aGUgTUlUIGxpY2Vuc2UgZm91bmQgaW4gdGhlCiAgICAgICAgICAgKiBMSUNFTlNFIGZpbGUgaW4gdGhlIHJvb3QgZGlyZWN0b3J5IG9mIHRoaXMgc291cmNlIHRyZWUuCiAgICAgICAgICAgKi8KICAgICAgICAgIC8qKgogICAgICAgICAgICogaW5saW5lZCBPYmplY3QuaXMgcG9seWZpbGwgdG8gYXZvaWQgcmVxdWlyaW5nIGNvbnN1bWVycyBzaGlwIHRoZWlyIG93bgogICAgICAgICAgICogaHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvZW4tVVMvZG9jcy9XZWIvSmF2YVNjcmlwdC9SZWZlcmVuY2UvR2xvYmFsX09iamVjdHMvT2JqZWN0L2lzCiAgICAgICAgICAgKi8KCiAgICAgICAgICBmdW5jdGlvbiBpc1BvbHlmaWxsKHgsIHkpIHsKICAgICAgICAgICAgcmV0dXJuIHggPT09IHkgJiYgKHggIT09IDAgfHwgMSAvIHggPT09IDEgLyB5KSB8fCB4ICE9PSB4ICYmIHkgIT09IHkgLy8gZXNsaW50LWRpc2FibGUtbGluZSBuby1zZWxmLWNvbXBhcmUKICAgICAgICAgICAgOwogICAgICAgICAgfQoKICAgICAgICAgIHZhciBpcyA9IHR5cGVvZiBPYmplY3QuaXMgPT09ICJmdW5jdGlvbiIgPyBPYmplY3QuaXMgOiBpc1BvbHlmaWxsOyAvLyBJbnRlbnRpb25hbGx5IG5vdCB1c2luZyBuYW1lZCBpbXBvcnRzIGJlY2F1c2UgUm9sbHVwIHVzZXMgZHluYW1pYwogICAgICAgICAgLy8gZGlzcGF0Y2ggZm9yIENvbW1vbkpTIGludGVyb3AgbmFtZWQgaW1wb3J0cy4KCiAgICAgICAgICB2YXIKICAgICAgICAgICAgdXNlU3RhdGUgPQoKCgogICAgICAgICAgICByZWFjdF9uYW1lc3BhY2VPYmplY3QudXNlU3RhdGUsdXNlRWZmZWN0ID0gcmVhY3RfbmFtZXNwYWNlT2JqZWN0LnVzZUVmZmVjdCx1c2VMYXlvdXRFZmZlY3QgPSByZWFjdF9uYW1lc3BhY2VPYmplY3QudXNlTGF5b3V0RWZmZWN0LHVzZURlYnVnVmFsdWUgPSByZWFjdF9uYW1lc3BhY2VPYmplY3QudXNlRGVidWdWYWx1ZTsKICAgICAgICAgIHZhciBkaWRXYXJuT2xkMThBbHBoYSA9IGZhbHNlOwogICAgICAgICAgdmFyIGRpZFdhcm5VbmNhY2hlZEdldFNuYXBzaG90ID0gZmFsc2U7IC8vIERpc2NsYWltZXI6IFRoaXMgc2hpbSBicmVha3MgbWFueSBvZiB0aGUgcnVsZXMgb2YgUmVhY3QsIGFuZCBvbmx5IHdvcmtzCiAgICAgICAgICAvLyBiZWNhdXNlIG9mIGEgdmVyeSBwYXJ0aWN1bGFyIHNldCBvZiBpbXBsZW1lbnRhdGlvbiBkZXRhaWxzIGFuZCBhc3N1bXB0aW9ucwogICAgICAgICAgLy8gLS0gY2hhbmdlIGFueSBvbmUgb2YgdGhlbSBhbmQgaXQgd2lsbCBicmVhay4gVGhlIG1vc3QgaW1wb3J0YW50IGFzc3VtcHRpb24KICAgICAgICAgIC8vIGlzIHRoYXQgdXBkYXRlcyBhcmUgYWx3YXlzIHN5bmNocm9ub3VzLCBiZWNhdXNlIGNvbmN1cnJlbnQgcmVuZGVyaW5nIGlzCiAgICAgICAgICAvLyBvbmx5IGF2YWlsYWJsZSBpbiB2ZXJzaW9ucyBvZiBSZWFjdCB0aGF0IGFsc28gaGF2ZSBhIGJ1aWx0LWluCiAgICAgICAgICAvLyB1c2VTeW5jRXh0ZXJuYWxTdG9yZSBBUEkuIEFuZCB3ZSBvbmx5IHVzZSB0aGlzIHNoaW0gd2hlbiB0aGUgYnVpbHQtaW4gQVBJCiAgICAgICAgICAvLyBkb2VzIG5vdCBleGlzdC4KICAgICAgICAgIC8vCiAgICAgICAgICAvLyBEbyBub3QgYXNzdW1lIHRoYXQgdGhlIGNsZXZlciBoYWNrcyB1c2VkIGJ5IHRoaXMgaG9vayBhbHNvIHdvcmsgaW4gZ2VuZXJhbC4KICAgICAgICAgIC8vIFRoZSBwb2ludCBvZiB0aGlzIHNoaW0gaXMgdG8gcmVwbGFjZSB0aGUgbmVlZCBmb3IgaGFja3MgYnkgb3RoZXIgbGlicmFyaWVzLgoKICAgICAgICAgIGZ1bmN0aW9uIHVzZVN5bmNFeHRlcm5hbFN0b3JlJDIoc3Vic2NyaWJlLCBnZXRTbmFwc2hvdCwgLy8gTm90ZTogVGhlIHNoaW0gZG9lcyBub3QgdXNlIGdldFNlcnZlclNuYXBzaG90LCBiZWNhdXNlIHByZS0xOCB2ZXJzaW9ucyBvZgogICAgICAgICAgLy8gUmVhY3QgZG8gbm90IGV4cG9zZSBhIHdheSB0byBjaGVjayBpZiB3ZSdyZSBoeWRyYXRpbmcuIFNvIHVzZXJzIG9mIHRoZSBzaGltCiAgICAgICAgICAvLyB3aWxsIG5lZWQgdG8gdHJhY2sgdGhhdCB0aGVtc2VsdmVzIGFuZCByZXR1cm4gdGhlIGNvcnJlY3QgdmFsdWUKICAgICAgICAgIC8vIGZyb20gYGdldFNuYXBzaG90YC4KICAgICAgICAgIGdldFNlcnZlclNuYXBzaG90KSB7CiAgICAgICAgICAgIGlmIChmYWxzZSkge30gLy8gUmVhZCB0aGUgY3VycmVudCBzbmFwc2hvdCBmcm9tIHRoZSBzdG9yZSBvbiBldmVyeSByZW5kZXIuIEFnYWluLCB0aGlzCiAgICAgICAgICAgIC8vIGJyZWFrcyB0aGUgcnVsZXMgb2YgUmVhY3QsIGFuZCBvbmx5IHdvcmtzIGhlcmUgYmVjYXVzZSBvZiBzcGVjaWZpYwogICAgICAgICAgICAvLyBpbXBsZW1lbnRhdGlvbiBkZXRhaWxzLCBtb3N0IGltcG9ydGFudGx5IHRoYXQgdXBkYXRlcyBhcmUKICAgICAgICAgICAgLy8gYWx3YXlzIHN5bmNocm9ub3VzLgoKCiAgICAgICAgICAgIHZhciB2YWx1ZSA9IGdldFNuYXBzaG90KCk7CgogICAgICAgICAgICBpZiAoZmFsc2UpIHt9IC8vIEJlY2F1c2UgdXBkYXRlcyBhcmUgc3luY2hyb25vdXMsIHdlIGRvbid0IHF1ZXVlIHRoZW0uIEluc3RlYWQgd2UgZm9yY2UgYQogICAgICAgICAgICAvLyByZS1yZW5kZXIgd2hlbmV2ZXIgdGhlIHN1YnNjcmliZWQgc3RhdGUgY2hhbmdlcyBieSB1cGRhdGluZyBhbiBzb21lCiAgICAgICAgICAgIC8vIGFyYml0cmFyeSB1c2VTdGF0ZSBob29rLiBUaGVuLCBkdXJpbmcgcmVuZGVyLCB3ZSBjYWxsIGdldFNuYXBzaG90IHRvIHJlYWQKICAgICAgICAgICAgLy8gdGhlIGN1cnJlbnQgdmFsdWUuCiAgICAgICAgICAgIC8vCiAgICAgICAgICAgIC8vIEJlY2F1c2Ugd2UgZG9uJ3QgYWN0dWFsbHkgdXNlIHRoZSBzdGF0ZSByZXR1cm5lZCBieSB0aGUgdXNlU3RhdGUgaG9vaywgd2UKICAgICAgICAgICAgLy8gY2FuIHNhdmUgYSBiaXQgb2YgbWVtb3J5IGJ5IHN0b3Jpbmcgb3RoZXIgc3R1ZmYgaW4gdGhhdCBzbG90LgogICAgICAgICAgICAvLwogICAgICAgICAgICAvLyBUbyBpbXBsZW1lbnQgdGhlIGVhcmx5IGJhaWxvdXQsIHdlIG5lZWQgdG8gdHJhY2sgc29tZSB0aGluZ3Mgb24gYSBtdXRhYmxlCiAgICAgICAgICAgIC8vIG9iamVjdC4gVXN1YWxseSwgd2Ugd291bGQgcHV0IHRoYXQgaW4gYSB1c2VSZWYgaG9vaywgYnV0IHdlIGNhbiBzdGFzaCBpdCBpbgogICAgICAgICAgICAvLyBvdXIgdXNlU3RhdGUgaG9vayBpbnN0ZWFkLgogICAgICAgICAgICAvLwogICAgICAgICAgICAvLyBUbyBmb3JjZSBhIHJlLXJlbmRlciwgd2UgY2FsbCBmb3JjZVVwZGF0ZSh7aW5zdH0pLiBUaGF0IHdvcmtzIGJlY2F1c2UgdGhlCiAgICAgICAgICAgIC8vIG5ldyBvYmplY3QgYWx3YXlzIGZhaWxzIGFuIGVxdWFsaXR5IGNoZWNrLgoKCiAgICAgICAgICAgIHZhciBfdXNlU3RhdGUxNyA9CgogICAgICAgICAgICAgIHVzZVN0YXRlKHsKICAgICAgICAgICAgICAgIGluc3Q6IHsKICAgICAgICAgICAgICAgICAgdmFsdWU6IHZhbHVlLAogICAgICAgICAgICAgICAgICBnZXRTbmFwc2hvdDogZ2V0U25hcHNob3QKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9KSxfdXNlU3RhdGUxOCA9IF9zbGljZWRUb0FycmF5MihfdXNlU3RhdGUxNywgMiksaW5zdCA9IF91c2VTdGF0ZTE4WzBdLmluc3QsZm9yY2VVcGRhdGUgPSBfdXNlU3RhdGUxOFsxXTsgLy8gVHJhY2sgdGhlIGxhdGVzdCBnZXRTbmFwc2hvdCBmdW5jdGlvbiB3aXRoIGEgcmVmLiBUaGlzIG5lZWRzIHRvIGJlIHVwZGF0ZWQKICAgICAgICAgICAgLy8gaW4gdGhlIGxheW91dCBwaGFzZSBzbyB3ZSBjYW4gYWNjZXNzIGl0IGR1cmluZyB0aGUgdGVhcmluZyBjaGVjayB0aGF0CiAgICAgICAgICAgIC8vIGhhcHBlbnMgb24gc3Vic2NyaWJlLgoKICAgICAgICAgICAgdXNlTGF5b3V0RWZmZWN0KCgpID0+IHsKICAgICAgICAgICAgICBpbnN0LnZhbHVlID0gdmFsdWU7CiAgICAgICAgICAgICAgaW5zdC5nZXRTbmFwc2hvdCA9IGdldFNuYXBzaG90OyAvLyBXaGVuZXZlciBnZXRTbmFwc2hvdCBvciBzdWJzY3JpYmUgY2hhbmdlcywgd2UgbmVlZCB0byBjaGVjayBpbiB0aGUKICAgICAgICAgICAgICAvLyBjb21taXQgcGhhc2UgaWYgdGhlcmUgd2FzIGFuIGludGVybGVhdmVkIG11dGF0aW9uLiBJbiBjb25jdXJyZW50IG1vZGUKICAgICAgICAgICAgICAvLyB0aGlzIGNhbiBoYXBwZW4gYWxsIHRoZSB0aW1lLCBidXQgZXZlbiBpbiBzeW5jaHJvbm91cyBtb2RlLCBhbiBlYXJsaWVyCiAgICAgICAgICAgICAgLy8gZWZmZWN0IG1heSBoYXZlIG11dGF0ZWQgdGhlIHN0b3JlLgoKICAgICAgICAgICAgICBpZiAoY2hlY2tJZlNuYXBzaG90Q2hhbmdlZChpbnN0KSkgewogICAgICAgICAgICAgICAgLy8gRm9yY2UgYSByZS1yZW5kZXIuCiAgICAgICAgICAgICAgICBmb3JjZVVwZGF0ZSh7CiAgICAgICAgICAgICAgICAgIGluc3Q6IGluc3QKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgIH0gLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIHJlYWN0LWhvb2tzL2V4aGF1c3RpdmUtZGVwcwoKICAgICAgICAgICAgfSwgW3N1YnNjcmliZSwgdmFsdWUsIGdldFNuYXBzaG90XSk7CiAgICAgICAgICAgIHVzZUVmZmVjdCgoKSA9PiB7CiAgICAgICAgICAgICAgLy8gQ2hlY2sgZm9yIGNoYW5nZXMgcmlnaHQgYmVmb3JlIHN1YnNjcmliaW5nLiBTdWJzZXF1ZW50IGNoYW5nZXMgd2lsbCBiZQogICAgICAgICAgICAgIC8vIGRldGVjdGVkIGluIHRoZSBzdWJzY3JpcHRpb24gaGFuZGxlci4KICAgICAgICAgICAgICBpZiAoY2hlY2tJZlNuYXBzaG90Q2hhbmdlZChpbnN0KSkgewogICAgICAgICAgICAgICAgLy8gRm9yY2UgYSByZS1yZW5kZXIuCiAgICAgICAgICAgICAgICBmb3JjZVVwZGF0ZSh7CiAgICAgICAgICAgICAgICAgIGluc3Q6IGluc3QKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgdmFyIGhhbmRsZVN0b3JlQ2hhbmdlID0gKCkgPT4gewogICAgICAgICAgICAgICAgLy8gVE9ETzogQmVjYXVzZSB0aGVyZSBpcyBubyBjcm9zcy1yZW5kZXJlciBBUEkgZm9yIGJhdGNoaW5nIHVwZGF0ZXMsIGl0J3MKICAgICAgICAgICAgICAgIC8vIHVwIHRvIHRoZSBjb25zdW1lciBvZiB0aGlzIGxpYnJhcnkgdG8gd3JhcCB0aGVpciBzdWJzY3JpcHRpb24gZXZlbnQKICAgICAgICAgICAgICAgIC8vIHdpdGggdW5zdGFibGVfYmF0Y2hlZFVwZGF0ZXMuIFNob3VsZCB3ZSB0cnkgdG8gZGV0ZWN0IHdoZW4gdGhpcyBpc24ndAogICAgICAgICAgICAgICAgLy8gdGhlIGNhc2UgYW5kIHByaW50IGEgd2FybmluZyBpbiBkZXZlbG9wbWVudD8KICAgICAgICAgICAgICAgIC8vIFRoZSBzdG9yZSBjaGFuZ2VkLiBDaGVjayBpZiB0aGUgc25hcHNob3QgY2hhbmdlZCBzaW5jZSB0aGUgbGFzdCB0aW1lIHdlCiAgICAgICAgICAgICAgICAvLyByZWFkIGZyb20gdGhlIHN0b3JlLgogICAgICAgICAgICAgICAgaWYgKGNoZWNrSWZTbmFwc2hvdENoYW5nZWQoaW5zdCkpIHsKICAgICAgICAgICAgICAgICAgLy8gRm9yY2UgYSByZS1yZW5kZXIuCiAgICAgICAgICAgICAgICAgIGZvcmNlVXBkYXRlKHsKICAgICAgICAgICAgICAgICAgICBpbnN0OiBpbnN0CiAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH07IC8vIFN1YnNjcmliZSB0byB0aGUgc3RvcmUgYW5kIHJldHVybiBhIGNsZWFuLXVwIGZ1bmN0aW9uLgoKCiAgICAgICAgICAgICAgcmV0dXJuIHN1YnNjcmliZShoYW5kbGVTdG9yZUNoYW5nZSk7IC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSByZWFjdC1ob29rcy9leGhhdXN0aXZlLWRlcHMKICAgICAgICAgICAgfSwgW3N1YnNjcmliZV0pOwogICAgICAgICAgICB1c2VEZWJ1Z1ZhbHVlKHZhbHVlKTsKICAgICAgICAgICAgcmV0dXJuIHZhbHVlOwogICAgICAgICAgfQoKICAgICAgICAgIGZ1bmN0aW9uIGNoZWNrSWZTbmFwc2hvdENoYW5nZWQoaW5zdCkgewogICAgICAgICAgICB2YXIgbGF0ZXN0R2V0U25hcHNob3QgPSBpbnN0LmdldFNuYXBzaG90OwogICAgICAgICAgICB2YXIgcHJldlZhbHVlID0gaW5zdC52YWx1ZTsKCiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgdmFyIG5leHRWYWx1ZSA9IGxhdGVzdEdldFNuYXBzaG90KCk7CiAgICAgICAgICAgICAgcmV0dXJuICFpcyhwcmV2VmFsdWUsIG5leHRWYWx1ZSk7CiAgICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KCiAgICAgICAgICAvKioKICAgICAgICAgICAqIENvcHlyaWdodCAoYykgRmFjZWJvb2ssIEluYy4gYW5kIGl0cyBhZmZpbGlhdGVzLgogICAgICAgICAgICoKICAgICAgICAgICAqIFRoaXMgc291cmNlIGNvZGUgaXMgbGljZW5zZWQgdW5kZXIgdGhlIE1JVCBsaWNlbnNlIGZvdW5kIGluIHRoZQogICAgICAgICAgICogTElDRU5TRSBmaWxlIGluIHRoZSByb290IGRpcmVjdG9yeSBvZiB0aGlzIHNvdXJjZSB0cmVlLgogICAgICAgICAgICoKICAgICAgICAgICAqIEBmbG93CiAgICAgICAgICAgKi8KICAgICAgICAgIGZ1bmN0aW9uIHVzZVN5bmNFeHRlcm5hbFN0b3JlJDEoc3Vic2NyaWJlLCBnZXRTbmFwc2hvdCwgZ2V0U2VydmVyU25hcHNob3QpIHsKICAgICAgICAgICAgLy8gTm90ZTogVGhlIHNoaW0gZG9lcyBub3QgdXNlIGdldFNlcnZlclNuYXBzaG90LCBiZWNhdXNlIHByZS0xOCB2ZXJzaW9ucyBvZgogICAgICAgICAgICAvLyBSZWFjdCBkbyBub3QgZXhwb3NlIGEgd2F5IHRvIGNoZWNrIGlmIHdlJ3JlIGh5ZHJhdGluZy4gU28gdXNlcnMgb2YgdGhlIHNoaW0KICAgICAgICAgICAgLy8gd2lsbCBuZWVkIHRvIHRyYWNrIHRoYXQgdGhlbXNlbHZlcyBhbmQgcmV0dXJuIHRoZSBjb3JyZWN0IHZhbHVlCiAgICAgICAgICAgIC8vIGZyb20gYGdldFNuYXBzaG90YC4KICAgICAgICAgICAgcmV0dXJuIGdldFNuYXBzaG90KCk7CiAgICAgICAgICB9CgogICAgICAgICAgLyoqCiAgICAgICAgICAgKiBJbmxpbmVkIGludG8gdGhlIHJlYWN0LXJvdXRlciByZXBvIHNpbmNlIHVzZS1zeW5jLWV4dGVybmFsLXN0b3JlIGRvZXMgbm90CiAgICAgICAgICAgKiBwcm92aWRlIGEgVU1ELWNvbXBhdGlibGUgcGFja2FnZSwgc28gd2UgbmVlZCB0aGlzIHRvIGJlIGFibGUgdG8gZGlzdHJpYnV0ZQogICAgICAgICAgICogVU1EIHJlYWN0LXJvdXRlciBidW5kbGVzCiAgICAgICAgICAgKi8KICAgICAgICAgIHZhciBjYW5Vc2VET00gPSAhISh0eXBlb2Ygd2luZG93ICE9PSAidW5kZWZpbmVkIiAmJiB0eXBlb2Ygd2luZG93LmRvY3VtZW50ICE9PSAidW5kZWZpbmVkIiAmJiB0eXBlb2Ygd2luZG93LmRvY3VtZW50LmNyZWF0ZUVsZW1lbnQgIT09ICJ1bmRlZmluZWQiKTsKICAgICAgICAgIHZhciBpc1NlcnZlckVudmlyb25tZW50ID0gIWNhblVzZURPTTsKICAgICAgICAgIHZhciBzaGltID0gaXNTZXJ2ZXJFbnZpcm9ubWVudCA/IHVzZVN5bmNFeHRlcm5hbFN0b3JlJDEgOiB1c2VTeW5jRXh0ZXJuYWxTdG9yZSQyOwogICAgICAgICAgdmFyIHVzZVN5bmNFeHRlcm5hbFN0b3JlID0gdHJ1ZSA/ICgobW9kdWxlKSA9PiBtb2R1bGUudXNlU3luY0V4dGVybmFsU3RvcmUpKHJlYWN0X25hbWVzcGFjZU9iamVjdCkgOiBzaGltOwoKICAgICAgICAgIHZhciBEYXRhUm91dGVyQ29udGV4dCA9IC8qI19fUFVSRV9fKi9yZWFjdC5jcmVhdGVDb250ZXh0KG51bGwpOwoKICAgICAgICAgIGlmIChmYWxzZSkge30KCiAgICAgICAgICB2YXIgRGF0YVJvdXRlclN0YXRlQ29udGV4dCA9IC8qI19fUFVSRV9fKi9yZWFjdC5jcmVhdGVDb250ZXh0KG51bGwpOwoKICAgICAgICAgIGlmIChmYWxzZSkge30KCiAgICAgICAgICB2YXIgQXdhaXRDb250ZXh0ID0gLyojX19QVVJFX18qLyAvKiB1bnVzZWQgcHVyZSBleHByZXNzaW9uIG9yIHN1cGVyICovbnVsbCAmJiBSZWFjdC5jcmVhdGVDb250ZXh0KG51bGwpOwoKICAgICAgICAgIGlmIChmYWxzZSkge30KCiAgICAgICAgICB2YXIgTmF2aWdhdGlvbkNvbnRleHQgPSAvKiNfX1BVUkVfXyovcmVhY3QuY3JlYXRlQ29udGV4dChudWxsKTsKCiAgICAgICAgICBpZiAoZmFsc2UpIHt9CgogICAgICAgICAgdmFyIExvY2F0aW9uQ29udGV4dCA9IC8qI19fUFVSRV9fKi9yZWFjdC5jcmVhdGVDb250ZXh0KG51bGwpOwoKICAgICAgICAgIGlmIChmYWxzZSkge30KCiAgICAgICAgICB2YXIgUm91dGVDb250ZXh0ID0gLyojX19QVVJFX18qL3JlYWN0LmNyZWF0ZUNvbnRleHQoewogICAgICAgICAgICBvdXRsZXQ6IG51bGwsCiAgICAgICAgICAgIG1hdGNoZXM6IFtdCiAgICAgICAgICB9KTsKCiAgICAgICAgICBpZiAoZmFsc2UpIHt9CgogICAgICAgICAgdmFyIFJvdXRlRXJyb3JDb250ZXh0ID0gLyojX19QVVJFX18qL3JlYWN0LmNyZWF0ZUNvbnRleHQobnVsbCk7CgogICAgICAgICAgaWYgKGZhbHNlKSB7fQoKICAgICAgICAgIC8qKgogICAgICAgICAgICogUmV0dXJucyB0aGUgZnVsbCBocmVmIGZvciB0aGUgZ2l2ZW4gInRvIiB2YWx1ZS4gVGhpcyBpcyB1c2VmdWwgZm9yIGJ1aWxkaW5nCiAgICAgICAgICAgKiBjdXN0b20gbGlua3MgdGhhdCBhcmUgYWxzbyBhY2Nlc3NpYmxlIGFuZCBwcmVzZXJ2ZSByaWdodC1jbGljayBiZWhhdmlvci4KICAgICAgICAgICAqCiAgICAgICAgICAgKiBAc2VlIGh0dHBzOi8vcmVhY3Ryb3V0ZXIuY29tL2hvb2tzL3VzZS1ocmVmCiAgICAgICAgICAgKi8KCiAgICAgICAgICBmdW5jdGlvbiB1c2VIcmVmKHRvLCBfdGVtcCkgewogICAgICAgICAgICB2YXIgX3JlZjE4ID0KCiAgICAgICAgICAgICAgX3RlbXAgPT09IHZvaWQgMCA/IHt9IDogX3RlbXAscmVsYXRpdmUgPSBfcmVmMTgucmVsYXRpdmU7CiAgICAgICAgICAgICF1c2VJblJvdXRlckNvbnRleHQoKSA/IGZhbHNlID8gMCA6IHJvdXRlcl9pbnZhcmlhbnQoZmFsc2UpIDogdm9pZCAwOwogICAgICAgICAgICB2YXIgX3JlYWN0JHVzZUNvbnRleHQgPQoKCiAgICAgICAgICAgICAgcmVhY3QudXNlQ29udGV4dChOYXZpZ2F0aW9uQ29udGV4dCksYmFzZW5hbWUgPSBfcmVhY3QkdXNlQ29udGV4dC5iYXNlbmFtZSxuYXZpZ2F0b3IgPSBfcmVhY3QkdXNlQ29udGV4dC5uYXZpZ2F0b3I7CiAgICAgICAgICAgIHZhciBfZGlzdF91c2VSZXNvbHZlZFBhdGggPQoKCgogICAgICAgICAgICAgIGRpc3RfdXNlUmVzb2x2ZWRQYXRoKHRvLCB7CiAgICAgICAgICAgICAgICByZWxhdGl2ZTogcmVsYXRpdmUKICAgICAgICAgICAgICB9KSxoYXNoID0gX2Rpc3RfdXNlUmVzb2x2ZWRQYXRoLmhhc2gscGF0aG5hbWUgPSBfZGlzdF91c2VSZXNvbHZlZFBhdGgucGF0aG5hbWUsc2VhcmNoID0gX2Rpc3RfdXNlUmVzb2x2ZWRQYXRoLnNlYXJjaDsKICAgICAgICAgICAgdmFyIGpvaW5lZFBhdGhuYW1lID0gcGF0aG5hbWU7IC8vIElmIHdlJ3JlIG9wZXJhdGluZyB3aXRoaW4gYSBiYXNlbmFtZSwgcHJlcGVuZCBpdCB0byB0aGUgcGF0aG5hbWUgcHJpb3IKICAgICAgICAgICAgLy8gdG8gY3JlYXRpbmcgdGhlIGhyZWYuICBJZiB0aGlzIGlzIGEgcm9vdCBuYXZpZ2F0aW9uLCB0aGVuIGp1c3QgdXNlIHRoZSByYXcKICAgICAgICAgICAgLy8gYmFzZW5hbWUgd2hpY2ggYWxsb3dzIHRoZSBiYXNlbmFtZSB0byBoYXZlIGZ1bGwgY29udHJvbCBvdmVyIHRoZSBwcmVzZW5jZQogICAgICAgICAgICAvLyBvZiBhIHRyYWlsaW5nIHNsYXNoIG9uIHJvb3QgbGlua3MKCiAgICAgICAgICAgIGlmIChiYXNlbmFtZSAhPT0gIi8iKSB7CiAgICAgICAgICAgICAgam9pbmVkUGF0aG5hbWUgPSBwYXRobmFtZSA9PT0gIi8iID8gYmFzZW5hbWUgOiByb3V0ZXJfam9pblBhdGhzKFtiYXNlbmFtZSwgcGF0aG5hbWVdKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuIG5hdmlnYXRvci5jcmVhdGVIcmVmKHsKICAgICAgICAgICAgICBwYXRobmFtZTogam9pbmVkUGF0aG5hbWUsCiAgICAgICAgICAgICAgc2VhcmNoOiBzZWFyY2gsCiAgICAgICAgICAgICAgaGFzaDogaGFzaAogICAgICAgICAgICB9KTsKICAgICAgICAgIH0KICAgICAgICAgIC8qKgogICAgICAgICAgICogUmV0dXJucyB0cnVlIGlmIHRoaXMgY29tcG9uZW50IGlzIGEgZGVzY2VuZGFudCBvZiBhIDxSb3V0ZXI+LgogICAgICAgICAgICoKICAgICAgICAgICAqIEBzZWUgaHR0cHM6Ly9yZWFjdHJvdXRlci5jb20vaG9va3MvdXNlLWluLXJvdXRlci1jb250ZXh0CiAgICAgICAgICAgKi8KCiAgICAgICAgICBmdW5jdGlvbiB1c2VJblJvdXRlckNvbnRleHQoKSB7CiAgICAgICAgICAgIHJldHVybiByZWFjdC51c2VDb250ZXh0KExvY2F0aW9uQ29udGV4dCkgIT0gbnVsbDsKICAgICAgICAgIH0KICAgICAgICAgIC8qKgogICAgICAgICAgICogUmV0dXJucyB0aGUgY3VycmVudCBsb2NhdGlvbiBvYmplY3QsIHdoaWNoIHJlcHJlc2VudHMgdGhlIGN1cnJlbnQgVVJMIGluIHdlYgogICAgICAgICAgICogYnJvd3NlcnMuCiAgICAgICAgICAgKgogICAgICAgICAgICogTm90ZTogSWYgeW91J3JlIHVzaW5nIHRoaXMgaXQgbWF5IG1lYW4geW91J3JlIGRvaW5nIHNvbWUgb2YgeW91ciBvd24KICAgICAgICAgICAqICJyb3V0aW5nIiBpbiB5b3VyIGFwcCwgYW5kIHdlJ2QgbGlrZSB0byBrbm93IHdoYXQgeW91ciB1c2UgY2FzZSBpcy4gV2UgbWF5CiAgICAgICAgICAgKiBiZSBhYmxlIHRvIHByb3ZpZGUgc29tZXRoaW5nIGhpZ2hlci1sZXZlbCB0byBiZXR0ZXIgc3VpdCB5b3VyIG5lZWRzLgogICAgICAgICAgICoKICAgICAgICAgICAqIEBzZWUgaHR0cHM6Ly9yZWFjdHJvdXRlci5jb20vaG9va3MvdXNlLWxvY2F0aW9uCiAgICAgICAgICAgKi8KCiAgICAgICAgICBmdW5jdGlvbiBkaXN0X3VzZUxvY2F0aW9uKCkgewogICAgICAgICAgICAhdXNlSW5Sb3V0ZXJDb250ZXh0KCkgPyBmYWxzZSA/IDAgOiByb3V0ZXJfaW52YXJpYW50KGZhbHNlKSA6IHZvaWQgMDsKICAgICAgICAgICAgcmV0dXJuIHJlYWN0LnVzZUNvbnRleHQoTG9jYXRpb25Db250ZXh0KS5sb2NhdGlvbjsKICAgICAgICAgIH0KICAgICAgICAgIC8qKgogICAgICAgICAgICogUmV0dXJucyB0aGUgY3VycmVudCBuYXZpZ2F0aW9uIGFjdGlvbiB3aGljaCBkZXNjcmliZXMgaG93IHRoZSByb3V0ZXIgY2FtZSB0bwogICAgICAgICAgICogdGhlIGN1cnJlbnQgbG9jYXRpb24sIGVpdGhlciBieSBhIHBvcCwgcHVzaCwgb3IgcmVwbGFjZSBvbiB0aGUgaGlzdG9yeSBzdGFjay4KICAgICAgICAgICAqCiAgICAgICAgICAgKiBAc2VlIGh0dHBzOi8vcmVhY3Ryb3V0ZXIuY29tL2hvb2tzL3VzZS1uYXZpZ2F0aW9uLXR5cGUKICAgICAgICAgICAqLwoKICAgICAgICAgIGZ1bmN0aW9uIHVzZU5hdmlnYXRpb25UeXBlKCkgewogICAgICAgICAgICByZXR1cm4gUmVhY3QudXNlQ29udGV4dChMb2NhdGlvbkNvbnRleHQpLm5hdmlnYXRpb25UeXBlOwogICAgICAgICAgfQogICAgICAgICAgLyoqCiAgICAgICAgICAgKiBSZXR1cm5zIGEgUGF0aE1hdGNoIG9iamVjdCBpZiB0aGUgZ2l2ZW4gcGF0dGVybiBtYXRjaGVzIHRoZSBjdXJyZW50IFVSTC4KICAgICAgICAgICAqIFRoaXMgaXMgdXNlZnVsIGZvciBjb21wb25lbnRzIHRoYXQgbmVlZCB0byBrbm93ICJhY3RpdmUiIHN0YXRlLCBlLmcuCiAgICAgICAgICAgKiA8TmF2TGluaz4uCiAgICAgICAgICAgKgogICAgICAgICAgICogQHNlZSBodHRwczovL3JlYWN0cm91dGVyLmNvbS9ob29rcy91c2UtbWF0Y2gKICAgICAgICAgICAqLwoKICAgICAgICAgIGZ1bmN0aW9uIHVzZU1hdGNoKHBhdHRlcm4pIHsKICAgICAgICAgICAgIXVzZUluUm91dGVyQ29udGV4dCgpID8gZmFsc2UgPyAwIDogaW52YXJpYW50KGZhbHNlKSA6IHZvaWQgMDsKICAgICAgICAgICAgdmFyIF9kaXN0X3VzZUxvY2F0aW9uID0KCiAgICAgICAgICAgICAgZGlzdF91c2VMb2NhdGlvbigpLHBhdGhuYW1lID0gX2Rpc3RfdXNlTG9jYXRpb24ucGF0aG5hbWU7CiAgICAgICAgICAgIHJldHVybiBSZWFjdC51c2VNZW1vKCgpID0+IG1hdGNoUGF0aChwYXR0ZXJuLCBwYXRobmFtZSksIFtwYXRobmFtZSwgcGF0dGVybl0pOwogICAgICAgICAgfQogICAgICAgICAgLyoqCiAgICAgICAgICAgKiBUaGUgaW50ZXJmYWNlIGZvciB0aGUgbmF2aWdhdGUoKSBmdW5jdGlvbiByZXR1cm5lZCBmcm9tIHVzZU5hdmlnYXRlKCkuCiAgICAgICAgICAgKi8KCiAgICAgICAgICAvKioKICAgICAgICAgICAqIFJldHVybnMgYW4gaW1wZXJhdGl2ZSBtZXRob2QgZm9yIGNoYW5naW5nIHRoZSBsb2NhdGlvbi4gVXNlZCBieSA8TGluaz5zLCBidXQKICAgICAgICAgICAqIG1heSBhbHNvIGJlIHVzZWQgYnkgb3RoZXIgZWxlbWVudHMgdG8gY2hhbmdlIHRoZSBsb2NhdGlvbi4KICAgICAgICAgICAqCiAgICAgICAgICAgKiBAc2VlIGh0dHBzOi8vcmVhY3Ryb3V0ZXIuY29tL2hvb2tzL3VzZS1uYXZpZ2F0ZQogICAgICAgICAgICovCiAgICAgICAgICBmdW5jdGlvbiBkaXN0X3VzZU5hdmlnYXRlKCkgewogICAgICAgICAgICAhdXNlSW5Sb3V0ZXJDb250ZXh0KCkgPyBmYWxzZSA/IDAgOiByb3V0ZXJfaW52YXJpYW50KGZhbHNlKSA6IHZvaWQgMDsKICAgICAgICAgICAgdmFyIF9yZWFjdCR1c2VDb250ZXh0MiA9CgoKICAgICAgICAgICAgICByZWFjdC51c2VDb250ZXh0KE5hdmlnYXRpb25Db250ZXh0KSxiYXNlbmFtZSA9IF9yZWFjdCR1c2VDb250ZXh0Mi5iYXNlbmFtZSxuYXZpZ2F0b3IgPSBfcmVhY3QkdXNlQ29udGV4dDIubmF2aWdhdG9yOwogICAgICAgICAgICB2YXIgX3JlYWN0JHVzZUNvbnRleHQzID0KCiAgICAgICAgICAgICAgcmVhY3QudXNlQ29udGV4dChSb3V0ZUNvbnRleHQpLG1hdGNoZXMgPSBfcmVhY3QkdXNlQ29udGV4dDMubWF0Y2hlczsKICAgICAgICAgICAgdmFyIF9kaXN0X3VzZUxvY2F0aW9uMiA9CgogICAgICAgICAgICAgIGRpc3RfdXNlTG9jYXRpb24oKSxsb2NhdGlvblBhdGhuYW1lID0gX2Rpc3RfdXNlTG9jYXRpb24yLnBhdGhuYW1lOwogICAgICAgICAgICB2YXIgcm91dGVQYXRobmFtZXNKc29uID0gSlNPTi5zdHJpbmdpZnkoZ2V0UGF0aENvbnRyaWJ1dGluZ01hdGNoZXMobWF0Y2hlcykubWFwKChtYXRjaCkgPT4gbWF0Y2gucGF0aG5hbWVCYXNlKSk7CiAgICAgICAgICAgIHZhciBhY3RpdmVSZWYgPSByZWFjdC51c2VSZWYoZmFsc2UpOwogICAgICAgICAgICByZWFjdC51c2VFZmZlY3QoKCkgPT4gewogICAgICAgICAgICAgIGFjdGl2ZVJlZi5jdXJyZW50ID0gdHJ1ZTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIHZhciBuYXZpZ2F0ZSA9IHJlYWN0LnVzZUNhbGxiYWNrKGZ1bmN0aW9uICh0bywgb3B0aW9ucykgewogICAgICAgICAgICAgIGlmIChvcHRpb25zID09PSB2b2lkIDApIHsKICAgICAgICAgICAgICAgIG9wdGlvbnMgPSB7fTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIGZhbHNlID8gMCA6IHZvaWQgMDsKICAgICAgICAgICAgICBpZiAoIWFjdGl2ZVJlZi5jdXJyZW50KSByZXR1cm47CgogICAgICAgICAgICAgIGlmICh0eXBlb2YgdG8gPT09ICJudW1iZXIiKSB7CiAgICAgICAgICAgICAgICBuYXZpZ2F0b3IuZ28odG8pOwogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgdmFyIHBhdGggPSByZXNvbHZlVG8odG8sIEpTT04ucGFyc2Uocm91dGVQYXRobmFtZXNKc29uKSwgbG9jYXRpb25QYXRobmFtZSwgb3B0aW9ucy5yZWxhdGl2ZSA9PT0gInBhdGgiKTsgLy8gSWYgd2UncmUgb3BlcmF0aW5nIHdpdGhpbiBhIGJhc2VuYW1lLCBwcmVwZW5kIGl0IHRvIHRoZSBwYXRobmFtZSBwcmlvcgogICAgICAgICAgICAgIC8vIHRvIGhhbmRpbmcgb2ZmIHRvIGhpc3RvcnkuICBJZiB0aGlzIGlzIGEgcm9vdCBuYXZpZ2F0aW9uLCB0aGVuIHdlCiAgICAgICAgICAgICAgLy8gbmF2aWdhdGUgdG8gdGhlIHJhdyBiYXNlbmFtZSB3aGljaCBhbGxvd3MgdGhlIGJhc2VuYW1lIHRvIGhhdmUgZnVsbAogICAgICAgICAgICAgIC8vIGNvbnRyb2wgb3ZlciB0aGUgcHJlc2VuY2Ugb2YgYSB0cmFpbGluZyBzbGFzaCBvbiByb290IGxpbmtzCgogICAgICAgICAgICAgIGlmIChiYXNlbmFtZSAhPT0gIi8iKSB7CiAgICAgICAgICAgICAgICBwYXRoLnBhdGhuYW1lID0gcGF0aC5wYXRobmFtZSA9PT0gIi8iID8gYmFzZW5hbWUgOiByb3V0ZXJfam9pblBhdGhzKFtiYXNlbmFtZSwgcGF0aC5wYXRobmFtZV0pOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgKCEhb3B0aW9ucy5yZXBsYWNlID8gbmF2aWdhdG9yLnJlcGxhY2UgOiBuYXZpZ2F0b3IucHVzaCkocGF0aCwgb3B0aW9ucy5zdGF0ZSwgb3B0aW9ucyk7CiAgICAgICAgICAgIH0sIFtiYXNlbmFtZSwgbmF2aWdhdG9yLCByb3V0ZVBhdGhuYW1lc0pzb24sIGxvY2F0aW9uUGF0aG5hbWVdKTsKICAgICAgICAgICAgcmV0dXJuIG5hdmlnYXRlOwogICAgICAgICAgfQogICAgICAgICAgdmFyIE91dGxldENvbnRleHQgPSAvKiNfX1BVUkVfXyovcmVhY3QuY3JlYXRlQ29udGV4dChudWxsKTsKICAgICAgICAgIC8qKgogICAgICAgICAgICogUmV0dXJucyB0aGUgY29udGV4dCAoaWYgcHJvdmlkZWQpIGZvciB0aGUgY2hpbGQgcm91dGUgYXQgdGhpcyBsZXZlbCBvZiB0aGUgcm91dGUKICAgICAgICAgICAqIGhpZXJhcmNoeS4KICAgICAgICAgICAqIEBzZWUgaHR0cHM6Ly9yZWFjdHJvdXRlci5jb20vaG9va3MvdXNlLW91dGxldC1jb250ZXh0CiAgICAgICAgICAgKi8KCiAgICAgICAgICBmdW5jdGlvbiB1c2VPdXRsZXRDb250ZXh0KCkgewogICAgICAgICAgICByZXR1cm4gUmVhY3QudXNlQ29udGV4dChPdXRsZXRDb250ZXh0KTsKICAgICAgICAgIH0KICAgICAgICAgIC8qKgogICAgICAgICAgICogUmV0dXJucyB0aGUgZWxlbWVudCBmb3IgdGhlIGNoaWxkIHJvdXRlIGF0IHRoaXMgbGV2ZWwgb2YgdGhlIHJvdXRlCiAgICAgICAgICAgKiBoaWVyYXJjaHkuIFVzZWQgaW50ZXJuYWxseSBieSA8T3V0bGV0PiB0byByZW5kZXIgY2hpbGQgcm91dGVzLgogICAgICAgICAgICoKICAgICAgICAgICAqIEBzZWUgaHR0cHM6Ly9yZWFjdHJvdXRlci5jb20vaG9va3MvdXNlLW91dGxldAogICAgICAgICAgICovCgogICAgICAgICAgZnVuY3Rpb24gdXNlT3V0bGV0KGNvbnRleHQpIHsKICAgICAgICAgICAgdmFyIG91dGxldCA9IHJlYWN0LnVzZUNvbnRleHQoUm91dGVDb250ZXh0KS5vdXRsZXQ7CgogICAgICAgICAgICBpZiAob3V0bGV0KSB7CiAgICAgICAgICAgICAgcmV0dXJuIC8qI19fUFVSRV9fKi9yZWFjdC5jcmVhdGVFbGVtZW50KE91dGxldENvbnRleHQuUHJvdmlkZXIsIHsKICAgICAgICAgICAgICAgIHZhbHVlOiBjb250ZXh0CiAgICAgICAgICAgICAgfSwgb3V0bGV0KTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuIG91dGxldDsKICAgICAgICAgIH0KICAgICAgICAgIC8qKgogICAgICAgICAgICogUmV0dXJucyBhbiBvYmplY3Qgb2Yga2V5L3ZhbHVlIHBhaXJzIG9mIHRoZSBkeW5hbWljIHBhcmFtcyBmcm9tIHRoZSBjdXJyZW50CiAgICAgICAgICAgKiBVUkwgdGhhdCB3ZXJlIG1hdGNoZWQgYnkgdGhlIHJvdXRlIHBhdGguCiAgICAgICAgICAgKgogICAgICAgICAgICogQHNlZSBodHRwczovL3JlYWN0cm91dGVyLmNvbS9ob29rcy91c2UtcGFyYW1zCiAgICAgICAgICAgKi8KCiAgICAgICAgICBmdW5jdGlvbiB1c2VQYXJhbXMoKSB7CiAgICAgICAgICAgIHZhciBfUmVhY3QkdXNlQ29udGV4dCA9CgogICAgICAgICAgICAgIFJlYWN0LnVzZUNvbnRleHQoUm91dGVDb250ZXh0KSxtYXRjaGVzID0gX1JlYWN0JHVzZUNvbnRleHQubWF0Y2hlczsKICAgICAgICAgICAgdmFyIHJvdXRlTWF0Y2ggPSBtYXRjaGVzW21hdGNoZXMubGVuZ3RoIC0gMV07CiAgICAgICAgICAgIHJldHVybiByb3V0ZU1hdGNoID8gcm91dGVNYXRjaC5wYXJhbXMgOiB7fTsKICAgICAgICAgIH0KICAgICAgICAgIC8qKgogICAgICAgICAgICogUmVzb2x2ZXMgdGhlIHBhdGhuYW1lIG9mIHRoZSBnaXZlbiBgdG9gIHZhbHVlIGFnYWluc3QgdGhlIGN1cnJlbnQgbG9jYXRpb24uCiAgICAgICAgICAgKgogICAgICAgICAgICogQHNlZSBodHRwczovL3JlYWN0cm91dGVyLmNvbS9ob29rcy91c2UtcmVzb2x2ZWQtcGF0aAogICAgICAgICAgICovCgogICAgICAgICAgZnVuY3Rpb24gZGlzdF91c2VSZXNvbHZlZFBhdGgodG8sIF90ZW1wMikgewogICAgICAgICAgICB2YXIgX3JlZjE5ID0KCiAgICAgICAgICAgICAgX3RlbXAyID09PSB2b2lkIDAgPyB7fSA6IF90ZW1wMixyZWxhdGl2ZSA9IF9yZWYxOS5yZWxhdGl2ZTsKICAgICAgICAgICAgdmFyIF9yZWFjdCR1c2VDb250ZXh0NCA9CgogICAgICAgICAgICAgIHJlYWN0LnVzZUNvbnRleHQoUm91dGVDb250ZXh0KSxtYXRjaGVzID0gX3JlYWN0JHVzZUNvbnRleHQ0Lm1hdGNoZXM7CiAgICAgICAgICAgIHZhciBfZGlzdF91c2VMb2NhdGlvbjMgPQoKICAgICAgICAgICAgICBkaXN0X3VzZUxvY2F0aW9uKCksbG9jYXRpb25QYXRobmFtZSA9IF9kaXN0X3VzZUxvY2F0aW9uMy5wYXRobmFtZTsKICAgICAgICAgICAgdmFyIHJvdXRlUGF0aG5hbWVzSnNvbiA9IEpTT04uc3RyaW5naWZ5KGdldFBhdGhDb250cmlidXRpbmdNYXRjaGVzKG1hdGNoZXMpLm1hcCgobWF0Y2gpID0+IG1hdGNoLnBhdGhuYW1lQmFzZSkpOwogICAgICAgICAgICByZXR1cm4gcmVhY3QudXNlTWVtbygoKSA9PiByZXNvbHZlVG8odG8sIEpTT04ucGFyc2Uocm91dGVQYXRobmFtZXNKc29uKSwgbG9jYXRpb25QYXRobmFtZSwgcmVsYXRpdmUgPT09ICJwYXRoIiksIFt0bywgcm91dGVQYXRobmFtZXNKc29uLCBsb2NhdGlvblBhdGhuYW1lLCByZWxhdGl2ZV0pOwogICAgICAgICAgfQogICAgICAgICAgLyoqCiAgICAgICAgICAgKiBSZXR1cm5zIHRoZSBlbGVtZW50IG9mIHRoZSByb3V0ZSB0aGF0IG1hdGNoZWQgdGhlIGN1cnJlbnQgbG9jYXRpb24sIHByZXBhcmVkCiAgICAgICAgICAgKiB3aXRoIHRoZSBjb3JyZWN0IGNvbnRleHQgdG8gcmVuZGVyIHRoZSByZW1haW5kZXIgb2YgdGhlIHJvdXRlIHRyZWUuIFJvdXRlCiAgICAgICAgICAgKiBlbGVtZW50cyBpbiB0aGUgdHJlZSBtdXN0IHJlbmRlciBhbiA8T3V0bGV0PiB0byByZW5kZXIgdGhlaXIgY2hpbGQgcm91dGUncwogICAgICAgICAgICogZWxlbWVudC4KICAgICAgICAgICAqCiAgICAgICAgICAgKiBAc2VlIGh0dHBzOi8vcmVhY3Ryb3V0ZXIuY29tL2hvb2tzL3VzZS1yb3V0ZXMKICAgICAgICAgICAqLwoKICAgICAgICAgIGZ1bmN0aW9uIHVzZVJvdXRlcyhyb3V0ZXMsIGxvY2F0aW9uQXJnKSB7CiAgICAgICAgICAgICF1c2VJblJvdXRlckNvbnRleHQoKSA/IGZhbHNlID8gMCA6IHJvdXRlcl9pbnZhcmlhbnQoZmFsc2UpIDogdm9pZCAwOwogICAgICAgICAgICB2YXIgX3JlYWN0JHVzZUNvbnRleHQ1ID0KCiAgICAgICAgICAgICAgcmVhY3QudXNlQ29udGV4dChOYXZpZ2F0aW9uQ29udGV4dCksbmF2aWdhdG9yID0gX3JlYWN0JHVzZUNvbnRleHQ1Lm5hdmlnYXRvcjsKICAgICAgICAgICAgdmFyIGRhdGFSb3V0ZXJTdGF0ZUNvbnRleHQgPSByZWFjdC51c2VDb250ZXh0KERhdGFSb3V0ZXJTdGF0ZUNvbnRleHQpOwogICAgICAgICAgICB2YXIgX3JlYWN0JHVzZUNvbnRleHQ2ID0KCiAgICAgICAgICAgICAgcmVhY3QudXNlQ29udGV4dChSb3V0ZUNvbnRleHQpLHBhcmVudE1hdGNoZXMgPSBfcmVhY3QkdXNlQ29udGV4dDYubWF0Y2hlczsKICAgICAgICAgICAgdmFyIHJvdXRlTWF0Y2ggPSBwYXJlbnRNYXRjaGVzW3BhcmVudE1hdGNoZXMubGVuZ3RoIC0gMV07CiAgICAgICAgICAgIHZhciBwYXJlbnRQYXJhbXMgPSByb3V0ZU1hdGNoID8gcm91dGVNYXRjaC5wYXJhbXMgOiB7fTsKICAgICAgICAgICAgdmFyIHBhcmVudFBhdGhuYW1lID0gcm91dGVNYXRjaCA/IHJvdXRlTWF0Y2gucGF0aG5hbWUgOiAiLyI7CiAgICAgICAgICAgIHZhciBwYXJlbnRQYXRobmFtZUJhc2UgPSByb3V0ZU1hdGNoID8gcm91dGVNYXRjaC5wYXRobmFtZUJhc2UgOiAiLyI7CiAgICAgICAgICAgIHZhciBwYXJlbnRSb3V0ZSA9IHJvdXRlTWF0Y2ggJiYgcm91dGVNYXRjaC5yb3V0ZTsKCiAgICAgICAgICAgIGlmIChmYWxzZSkge30KCiAgICAgICAgICAgIHZhciBsb2NhdGlvbkZyb21Db250ZXh0ID0gZGlzdF91c2VMb2NhdGlvbigpOwogICAgICAgICAgICB2YXIgbG9jYXRpb247CgogICAgICAgICAgICBpZiAobG9jYXRpb25BcmcpIHsKICAgICAgICAgICAgICB2YXIgX3BhcnNlZExvY2F0aW9uQXJnJHBhOwoKICAgICAgICAgICAgICB2YXIgcGFyc2VkTG9jYXRpb25BcmcgPSB0eXBlb2YgbG9jYXRpb25BcmcgPT09ICJzdHJpbmciID8gcGFyc2VQYXRoKGxvY2F0aW9uQXJnKSA6IGxvY2F0aW9uQXJnOwogICAgICAgICAgICAgICEocGFyZW50UGF0aG5hbWVCYXNlID09PSAiLyIgfHwgKChfcGFyc2VkTG9jYXRpb25BcmckcGEgPSBwYXJzZWRMb2NhdGlvbkFyZy5wYXRobmFtZSkgPT0gbnVsbCA/IHZvaWQgMCA6IF9wYXJzZWRMb2NhdGlvbkFyZyRwYS5zdGFydHNXaXRoKHBhcmVudFBhdGhuYW1lQmFzZSkpKSA/IGZhbHNlID8gMCA6IHJvdXRlcl9pbnZhcmlhbnQoZmFsc2UpIDogdm9pZCAwOwogICAgICAgICAgICAgIGxvY2F0aW9uID0gcGFyc2VkTG9jYXRpb25Bcmc7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgbG9jYXRpb24gPSBsb2NhdGlvbkZyb21Db250ZXh0OwogICAgICAgICAgICB9CgogICAgICAgICAgICB2YXIgcGF0aG5hbWUgPSBsb2NhdGlvbi5wYXRobmFtZSB8fCAiLyI7CiAgICAgICAgICAgIHZhciByZW1haW5pbmdQYXRobmFtZSA9IHBhcmVudFBhdGhuYW1lQmFzZSA9PT0gIi8iID8gcGF0aG5hbWUgOiBwYXRobmFtZS5zbGljZShwYXJlbnRQYXRobmFtZUJhc2UubGVuZ3RoKSB8fCAiLyI7CiAgICAgICAgICAgIHZhciBtYXRjaGVzID0gbWF0Y2hSb3V0ZXMocm91dGVzLCB7CiAgICAgICAgICAgICAgcGF0aG5hbWU6IHJlbWFpbmluZ1BhdGhuYW1lCiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgaWYgKGZhbHNlKSB7fQoKICAgICAgICAgICAgdmFyIHJlbmRlcmVkTWF0Y2hlcyA9IF9yZW5kZXJNYXRjaGVzKG1hdGNoZXMgJiYgbWF0Y2hlcy5tYXAoKG1hdGNoKSA9PiBPYmplY3QuYXNzaWduKHt9LCBtYXRjaCwgewogICAgICAgICAgICAgIHBhcmFtczogT2JqZWN0LmFzc2lnbih7fSwgcGFyZW50UGFyYW1zLCBtYXRjaC5wYXJhbXMpLAogICAgICAgICAgICAgIHBhdGhuYW1lOiByb3V0ZXJfam9pblBhdGhzKFtwYXJlbnRQYXRobmFtZUJhc2UsIC8vIFJlLWVuY29kZSBwYXRobmFtZXMgdGhhdCB3ZXJlIGRlY29kZWQgaW5zaWRlIG1hdGNoUm91dGVzCiAgICAgICAgICAgICAgbmF2aWdhdG9yLmVuY29kZUxvY2F0aW9uID8gbmF2aWdhdG9yLmVuY29kZUxvY2F0aW9uKG1hdGNoLnBhdGhuYW1lKS5wYXRobmFtZSA6IG1hdGNoLnBhdGhuYW1lXSksCiAgICAgICAgICAgICAgcGF0aG5hbWVCYXNlOiBtYXRjaC5wYXRobmFtZUJhc2UgPT09ICIvIiA/IHBhcmVudFBhdGhuYW1lQmFzZSA6IHJvdXRlcl9qb2luUGF0aHMoW3BhcmVudFBhdGhuYW1lQmFzZSwgLy8gUmUtZW5jb2RlIHBhdGhuYW1lcyB0aGF0IHdlcmUgZGVjb2RlZCBpbnNpZGUgbWF0Y2hSb3V0ZXMKICAgICAgICAgICAgICBuYXZpZ2F0b3IuZW5jb2RlTG9jYXRpb24gPyBuYXZpZ2F0b3IuZW5jb2RlTG9jYXRpb24obWF0Y2gucGF0aG5hbWVCYXNlKS5wYXRobmFtZSA6IG1hdGNoLnBhdGhuYW1lQmFzZV0pCiAgICAgICAgICAgIH0pKSwgcGFyZW50TWF0Y2hlcywgZGF0YVJvdXRlclN0YXRlQ29udGV4dCB8fCB1bmRlZmluZWQpOyAvLyBXaGVuIGEgdXNlciBwYXNzZXMgaW4gYSBgbG9jYXRpb25BcmdgLCB0aGUgYXNzb2NpYXRlZCByb3V0ZXMgbmVlZCB0bwogICAgICAgICAgICAvLyBiZSB3cmFwcGVkIGluIGEgbmV3IGBMb2NhdGlvbkNvbnRleHQuUHJvdmlkZXJgIGluIG9yZGVyIGZvciBgdXNlTG9jYXRpb25gCiAgICAgICAgICAgIC8vIHRvIHVzZSB0aGUgc2NvcGVkIGxvY2F0aW9uIGluc3RlYWQgb2YgdGhlIGdsb2JhbCBsb2NhdGlvbi4KCgogICAgICAgICAgICBpZiAobG9jYXRpb25BcmcgJiYgcmVuZGVyZWRNYXRjaGVzKSB7CiAgICAgICAgICAgICAgcmV0dXJuIC8qI19fUFVSRV9fKi9yZWFjdC5jcmVhdGVFbGVtZW50KExvY2F0aW9uQ29udGV4dC5Qcm92aWRlciwgewogICAgICAgICAgICAgICAgdmFsdWU6IHsKICAgICAgICAgICAgICAgICAgbG9jYXRpb246IGRpc3RfZXh0ZW5kcyh7CiAgICAgICAgICAgICAgICAgICAgcGF0aG5hbWU6ICIvIiwKICAgICAgICAgICAgICAgICAgICBzZWFyY2g6ICIiLAogICAgICAgICAgICAgICAgICAgIGhhc2g6ICIiLAogICAgICAgICAgICAgICAgICAgIHN0YXRlOiBudWxsLAogICAgICAgICAgICAgICAgICAgIGtleTogImRlZmF1bHQiCiAgICAgICAgICAgICAgICAgIH0sIGxvY2F0aW9uKSwKICAgICAgICAgICAgICAgICAgbmF2aWdhdGlvblR5cGU6IEFjdGlvbi5Qb3AKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9LCByZW5kZXJlZE1hdGNoZXMpOwogICAgICAgICAgICB9CgogICAgICAgICAgICByZXR1cm4gcmVuZGVyZWRNYXRjaGVzOwogICAgICAgICAgfQoKICAgICAgICAgIGZ1bmN0aW9uIERlZmF1bHRFcnJvckVsZW1lbnQoKSB7CiAgICAgICAgICAgIHZhciBlcnJvciA9IHVzZVJvdXRlRXJyb3IoKTsKICAgICAgICAgICAgdmFyIG1lc3NhZ2UgPSBpc1JvdXRlRXJyb3JSZXNwb25zZShlcnJvcikgPyBlcnJvci5zdGF0dXMgKyAiICIgKyBlcnJvci5zdGF0dXNUZXh0IDogZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiBKU09OLnN0cmluZ2lmeShlcnJvcik7CiAgICAgICAgICAgIHZhciBzdGFjayA9IGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5zdGFjayA6IG51bGw7CiAgICAgICAgICAgIHZhciBsaWdodGdyZXkgPSAicmdiYSgyMDAsMjAwLDIwMCwgMC41KSI7CiAgICAgICAgICAgIHZhciBwcmVTdHlsZXMgPSB7CiAgICAgICAgICAgICAgcGFkZGluZzogIjAuNXJlbSIsCiAgICAgICAgICAgICAgYmFja2dyb3VuZENvbG9yOiBsaWdodGdyZXkKICAgICAgICAgICAgfTsKICAgICAgICAgICAgdmFyIGNvZGVTdHlsZXMgPSB7CiAgICAgICAgICAgICAgcGFkZGluZzogIjJweCA0cHgiLAogICAgICAgICAgICAgIGJhY2tncm91bmRDb2xvcjogbGlnaHRncmV5CiAgICAgICAgICAgIH07CiAgICAgICAgICAgIHZhciBkZXZJbmZvID0gbnVsbDsKCiAgICAgICAgICAgIGlmIChmYWxzZSkge30KCiAgICAgICAgICAgIHJldHVybiAvKiNfX1BVUkVfXyovcmVhY3QuY3JlYXRlRWxlbWVudChyZWFjdC5GcmFnbWVudCwgbnVsbCwgLyojX19QVVJFX18qL3JlYWN0LmNyZWF0ZUVsZW1lbnQoImgyIiwgbnVsbCwgIlVuZXhwZWN0ZWQgQXBwbGljYXRpb24gRXJyb3IhIiksIC8qI19fUFVSRV9fKi9yZWFjdC5jcmVhdGVFbGVtZW50KCJoMyIsIHsKICAgICAgICAgICAgICBzdHlsZTogewogICAgICAgICAgICAgICAgZm9udFN0eWxlOiAiaXRhbGljIgogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSwgbWVzc2FnZSksIHN0YWNrID8gLyojX19QVVJFX18qL3JlYWN0LmNyZWF0ZUVsZW1lbnQoInByZSIsIHsKICAgICAgICAgICAgICBzdHlsZTogcHJlU3R5bGVzCiAgICAgICAgICAgIH0sIHN0YWNrKSA6IG51bGwsIGRldkluZm8pOwogICAgICAgICAgfXZhcgoKICAgICAgICAgIFJlbmRlckVycm9yQm91bmRhcnkgPSAvKiNfX1BVUkVfXyovZnVuY3Rpb24gKF9yZWFjdCRDb21wb25lbnQpIHtfaW5oZXJpdHMoUmVuZGVyRXJyb3JCb3VuZGFyeSwgX3JlYWN0JENvbXBvbmVudCk7dmFyIF9zdXBlcjIgPSBfY3JlYXRlU3VwZXIoUmVuZGVyRXJyb3JCb3VuZGFyeSk7CiAgICAgICAgICAgIGZ1bmN0aW9uIFJlbmRlckVycm9yQm91bmRhcnkocHJvcHMpIHt2YXIgX3RoaXM7X2NsYXNzQ2FsbENoZWNrMih0aGlzLCBSZW5kZXJFcnJvckJvdW5kYXJ5KTsKICAgICAgICAgICAgICBfdGhpcyA9IF9zdXBlcjIuY2FsbCh0aGlzLCBwcm9wcyk7CiAgICAgICAgICAgICAgX3RoaXMuc3RhdGUgPSB7CiAgICAgICAgICAgICAgICBsb2NhdGlvbjogcHJvcHMubG9jYXRpb24sCiAgICAgICAgICAgICAgICBlcnJvcjogcHJvcHMuZXJyb3IKICAgICAgICAgICAgICB9O3JldHVybiBfdGhpczsKICAgICAgICAgICAgfV9jcmVhdGVDbGFzczIoUmVuZGVyRXJyb3JCb3VuZGFyeSwgW3sga2V5OiAiY29tcG9uZW50RGlkQ2F0Y2giLCB2YWx1ZToKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKICAgICAgICAgICAgICBmdW5jdGlvbiBjb21wb25lbnREaWRDYXRjaChlcnJvciwgZXJyb3JJbmZvKSB7CiAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKCJSZWFjdCBSb3V0ZXIgY2F1Z2h0IHRoZSBmb2xsb3dpbmcgZXJyb3IgZHVyaW5nIHJlbmRlciIsIGVycm9yLCBlcnJvckluZm8pOwogICAgICAgICAgICAgIH0gfSwgeyBrZXk6ICJyZW5kZXIiLCB2YWx1ZToKCiAgICAgICAgICAgICAgZnVuY3Rpb24gcmVuZGVyKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuc3RhdGUuZXJyb3IgPyAvKiNfX1BVUkVfXyovcmVhY3QuY3JlYXRlRWxlbWVudChSb3V0ZUNvbnRleHQuUHJvdmlkZXIsIHsKICAgICAgICAgICAgICAgICAgdmFsdWU6IHRoaXMucHJvcHMucm91dGVDb250ZXh0CiAgICAgICAgICAgICAgICB9LCAvKiNfX1BVUkVfXyovcmVhY3QuY3JlYXRlRWxlbWVudChSb3V0ZUVycm9yQ29udGV4dC5Qcm92aWRlciwgewogICAgICAgICAgICAgICAgICB2YWx1ZTogdGhpcy5zdGF0ZS5lcnJvciwKICAgICAgICAgICAgICAgICAgY2hpbGRyZW46IHRoaXMucHJvcHMuY29tcG9uZW50CiAgICAgICAgICAgICAgICB9KSkgOiB0aGlzLnByb3BzLmNoaWxkcmVuOwogICAgICAgICAgICAgIH0gfV0sIFt7IGtleTogImdldERlcml2ZWRTdGF0ZUZyb21FcnJvciIsIHZhbHVlOiBmdW5jdGlvbiBnZXREZXJpdmVkU3RhdGVGcm9tRXJyb3IoZXJyb3IpIHtyZXR1cm4geyBlcnJvcjogZXJyb3IgfTt9IH0sIHsga2V5OiAiZ2V0RGVyaXZlZFN0YXRlRnJvbVByb3BzIiwgdmFsdWU6IGZ1bmN0aW9uIGdldERlcml2ZWRTdGF0ZUZyb21Qcm9wcyhwcm9wcywgc3RhdGUpIHsvLyBXaGVuIHdlIGdldCBpbnRvIGFuIGVycm9yIHN0YXRlLCB0aGUgdXNlciB3aWxsIGxpa2VseSBjbGljayAiYmFjayIgdG8gdGhlCiAgICAgICAgICAgICAgICAvLyBwcmV2aW91cyBwYWdlIHRoYXQgZGlkbid0IGhhdmUgYW4gZXJyb3IuIEJlY2F1c2UgdGhpcyB3cmFwcyB0aGUgZW50aXJlCiAgICAgICAgICAgICAgICAvLyBhcHBsaWNhdGlvbiwgdGhhdCB3aWxsIGhhdmUgbm8gZWZmZWN0LS10aGUgZXJyb3IgcGFnZSBjb250aW51ZXMgdG8gZGlzcGxheS4KICAgICAgICAgICAgICAgIC8vIFRoaXMgZ2l2ZXMgdXMgYSBtZWNoYW5pc20gdG8gcmVjb3ZlciBmcm9tIHRoZSBlcnJvciB3aGVuIHRoZSBsb2NhdGlvbiBjaGFuZ2VzLgogICAgICAgICAgICAgICAgLy8KICAgICAgICAgICAgICAgIC8vIFdoZXRoZXIgd2UncmUgaW4gYW4gZXJyb3Igc3RhdGUgb3Igbm90LCB3ZSB1cGRhdGUgdGhlIGxvY2F0aW9uIGluIHN0YXRlCiAgICAgICAgICAgICAgICAvLyBzbyB0aGF0IHdoZW4gd2UgYXJlIGluIGFuIGVycm9yIHN0YXRlLCBpdCBnZXRzIHJlc2V0IHdoZW4gYSBuZXcgbG9jYXRpb24KICAgICAgICAgICAgICAgIC8vIGNvbWVzIGluIGFuZCB0aGUgdXNlciByZWNvdmVycyBmcm9tIHRoZSBlcnJvci4KICAgICAgICAgICAgICAgIGlmIChzdGF0ZS5sb2NhdGlvbiAhPT0gcHJvcHMubG9jYXRpb24pIHtyZXR1cm4geyBlcnJvcjogcHJvcHMuZXJyb3IsIGxvY2F0aW9uOiBwcm9wcy5sb2NhdGlvbiB9O30gLy8gSWYgd2UncmUgbm90IGNoYW5naW5nIGxvY2F0aW9ucywgcHJlc2VydmUgdGhlIGxvY2F0aW9uIGJ1dCBzdGlsbCBzdXJmYWNlCiAgICAgICAgICAgICAgICAvLyBhbnkgbmV3IGVycm9ycyB0aGF0IG1heSBjb21lIHRocm91Z2guIFdlIHJldGFpbiB0aGUgZXhpc3RpbmcgZXJyb3IsIHdlIGRvCiAgICAgICAgICAgICAgICAvLyB0aGlzIGJlY2F1c2UgdGhlIGVycm9yIHByb3ZpZGVkIGZyb20gdGhlIGFwcCBzdGF0ZSBtYXkgYmUgY2xlYXJlZCB3aXRob3V0CiAgICAgICAgICAgICAgICAvLyB0aGUgbG9jYXRpb24gY2hhbmdpbmcuCiAgICAgICAgICAgICAgICByZXR1cm4geyBlcnJvcjogcHJvcHMuZXJyb3IgfHwgc3RhdGUuZXJyb3IsIGxvY2F0aW9uOiBzdGF0ZS5sb2NhdGlvbiB9O30gfV0pO3JldHVybiBSZW5kZXJFcnJvckJvdW5kYXJ5O30ocmVhY3QuQ29tcG9uZW50KTtmdW5jdGlvbiBSZW5kZXJlZFJvdXRlKF9yZWYpIHt2YXIgcm91dGVDb250ZXh0ID0gX3JlZi5yb3V0ZUNvbnRleHQsbWF0Y2ggPSBfcmVmLm1hdGNoLGNoaWxkcmVuID0gX3JlZi5jaGlsZHJlbjt2YXIgZGF0YVJvdXRlckNvbnRleHQgPSByZWFjdC51c2VDb250ZXh0KERhdGFSb3V0ZXJDb250ZXh0KTsgLy8gVHJhY2sgaG93IGRlZXAgd2UgZ290IGluIG91ciByZW5kZXIgcGFzcyB0byBlbXVsYXRlIFNTUiBjb21wb25lbnREaWRDYXRjaAogICAgICAgICAgICAvLyBpbiBhIERhdGFTdGF0aWNSb3V0ZXIKICAgICAgICAgICAgaWYgKGRhdGFSb3V0ZXJDb250ZXh0ICYmIGRhdGFSb3V0ZXJDb250ZXh0LnN0YXRpYyAmJiBkYXRhUm91dGVyQ29udGV4dC5zdGF0aWNDb250ZXh0ICYmIG1hdGNoLnJvdXRlLmVycm9yRWxlbWVudCkge2RhdGFSb3V0ZXJDb250ZXh0LnN0YXRpY0NvbnRleHQuX2RlZXBlc3RSZW5kZXJlZEJvdW5kYXJ5SWQgPSBtYXRjaC5yb3V0ZS5pZDsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuIC8qI19fUFVSRV9fKi9yZWFjdC5jcmVhdGVFbGVtZW50KFJvdXRlQ29udGV4dC5Qcm92aWRlciwgewogICAgICAgICAgICAgIHZhbHVlOiByb3V0ZUNvbnRleHQKICAgICAgICAgICAgfSwgY2hpbGRyZW4pOwogICAgICAgICAgfQoKICAgICAgICAgIGZ1bmN0aW9uIF9yZW5kZXJNYXRjaGVzKG1hdGNoZXMsIHBhcmVudE1hdGNoZXMsIGRhdGFSb3V0ZXJTdGF0ZSkgewogICAgICAgICAgICBpZiAocGFyZW50TWF0Y2hlcyA9PT0gdm9pZCAwKSB7CiAgICAgICAgICAgICAgcGFyZW50TWF0Y2hlcyA9IFtdOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAobWF0Y2hlcyA9PSBudWxsKSB7CiAgICAgICAgICAgICAgaWYgKGRhdGFSb3V0ZXJTdGF0ZSAhPSBudWxsICYmIGRhdGFSb3V0ZXJTdGF0ZS5lcnJvcnMpIHsKICAgICAgICAgICAgICAgIC8vIERvbid0IGJhaWwgaWYgd2UgaGF2ZSBkYXRhIHJvdXRlciBlcnJvcnMgc28gd2UgY2FuIHJlbmRlciB0aGVtIGluIHRoZQogICAgICAgICAgICAgICAgLy8gYm91bmRhcnkuICBVc2UgdGhlIHByZS1tYXRjaGVkIChvciBzaGltbWVkKSBtYXRjaGVzCiAgICAgICAgICAgICAgICBtYXRjaGVzID0gZGF0YVJvdXRlclN0YXRlLm1hdGNoZXM7CiAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgdmFyIHJlbmRlcmVkTWF0Y2hlcyA9IG1hdGNoZXM7IC8vIElmIHdlIGhhdmUgZGF0YSBlcnJvcnMsIHRyaW0gbWF0Y2hlcyB0byB0aGUgaGlnaGVzdCBlcnJvciBib3VuZGFyeQoKICAgICAgICAgICAgdmFyIGVycm9ycyA9IGRhdGFSb3V0ZXJTdGF0ZSA9PSBudWxsID8gdm9pZCAwIDogZGF0YVJvdXRlclN0YXRlLmVycm9yczsKCiAgICAgICAgICAgIGlmIChlcnJvcnMgIT0gbnVsbCkgewogICAgICAgICAgICAgIHZhciBlcnJvckluZGV4ID0gcmVuZGVyZWRNYXRjaGVzLmZpbmRJbmRleCgobSkgPT4gbS5yb3V0ZS5pZCAmJiAoZXJyb3JzID09IG51bGwgPyB2b2lkIDAgOiBlcnJvcnNbbS5yb3V0ZS5pZF0pKTsKICAgICAgICAgICAgICAhKGVycm9ySW5kZXggPj0gMCkgPyBmYWxzZSA/IDAgOiByb3V0ZXJfaW52YXJpYW50KGZhbHNlKSA6IHZvaWQgMDsKICAgICAgICAgICAgICByZW5kZXJlZE1hdGNoZXMgPSByZW5kZXJlZE1hdGNoZXMuc2xpY2UoMCwgTWF0aC5taW4ocmVuZGVyZWRNYXRjaGVzLmxlbmd0aCwgZXJyb3JJbmRleCArIDEpKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuIHJlbmRlcmVkTWF0Y2hlcy5yZWR1Y2VSaWdodCgob3V0bGV0LCBtYXRjaCwgaW5kZXgpID0+IHsKICAgICAgICAgICAgICB2YXIgZXJyb3IgPSBtYXRjaC5yb3V0ZS5pZCA/IGVycm9ycyA9PSBudWxsID8gdm9pZCAwIDogZXJyb3JzW21hdGNoLnJvdXRlLmlkXSA6IG51bGw7IC8vIE9ubHkgZGF0YSByb3V0ZXJzIGhhbmRsZSBlcnJvcnMKCiAgICAgICAgICAgICAgdmFyIGVycm9yRWxlbWVudCA9IGRhdGFSb3V0ZXJTdGF0ZSA/IG1hdGNoLnJvdXRlLmVycm9yRWxlbWVudCB8fCAvKiNfX1BVUkVfXyovcmVhY3QuY3JlYXRlRWxlbWVudChEZWZhdWx0RXJyb3JFbGVtZW50LCBudWxsKSA6IG51bGw7CiAgICAgICAgICAgICAgdmFyIG1hdGNoZXMgPSBwYXJlbnRNYXRjaGVzLmNvbmNhdChyZW5kZXJlZE1hdGNoZXMuc2xpY2UoMCwgaW5kZXggKyAxKSk7CgogICAgICAgICAgICAgIHZhciBnZXRDaGlsZHJlbiA9ICgpID0+IC8qI19fUFVSRV9fKi9yZWFjdC5jcmVhdGVFbGVtZW50KFJlbmRlcmVkUm91dGUsIHsKICAgICAgICAgICAgICAgIG1hdGNoOiBtYXRjaCwKICAgICAgICAgICAgICAgIHJvdXRlQ29udGV4dDogewogICAgICAgICAgICAgICAgICBvdXRsZXQ6IG91dGxldCwKICAgICAgICAgICAgICAgICAgbWF0Y2hlczogbWF0Y2hlcwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0sIGVycm9yID8gZXJyb3JFbGVtZW50IDogbWF0Y2gucm91dGUuZWxlbWVudCAhPT0gdW5kZWZpbmVkID8gbWF0Y2gucm91dGUuZWxlbWVudCA6IG91dGxldCk7IC8vIE9ubHkgd3JhcCBpbiBhbiBlcnJvciBib3VuZGFyeSB3aXRoaW4gZGF0YSByb3V0ZXIgdXNhZ2VzIHdoZW4gd2UgaGF2ZSBhbgogICAgICAgICAgICAgIC8vIGVycm9yRWxlbWVudCBvbiB0aGlzIHJvdXRlLiAgT3RoZXJ3aXNlIGxldCBpdCBidWJibGUgdXAgdG8gYW4gYW5jZXN0b3IKICAgICAgICAgICAgICAvLyBlcnJvckVsZW1lbnQKCgogICAgICAgICAgICAgIHJldHVybiBkYXRhUm91dGVyU3RhdGUgJiYgKG1hdGNoLnJvdXRlLmVycm9yRWxlbWVudCB8fCBpbmRleCA9PT0gMCkgPyAvKiNfX1BVUkVfXyovcmVhY3QuY3JlYXRlRWxlbWVudChSZW5kZXJFcnJvckJvdW5kYXJ5LCB7CiAgICAgICAgICAgICAgICBsb2NhdGlvbjogZGF0YVJvdXRlclN0YXRlLmxvY2F0aW9uLAogICAgICAgICAgICAgICAgY29tcG9uZW50OiBlcnJvckVsZW1lbnQsCiAgICAgICAgICAgICAgICBlcnJvcjogZXJyb3IsCiAgICAgICAgICAgICAgICBjaGlsZHJlbjogZ2V0Q2hpbGRyZW4oKSwKICAgICAgICAgICAgICAgIHJvdXRlQ29udGV4dDogewogICAgICAgICAgICAgICAgICBvdXRsZXQ6IG51bGwsCiAgICAgICAgICAgICAgICAgIG1hdGNoZXM6IG1hdGNoZXMKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9KSA6IGdldENoaWxkcmVuKCk7CiAgICAgICAgICAgIH0sIG51bGwpOwogICAgICAgICAgfQogICAgICAgICAgdmFyIERhdGFSb3V0ZXJIb29rOwoKICAgICAgICAgIChmdW5jdGlvbiAoRGF0YVJvdXRlckhvb2spIHsKICAgICAgICAgICAgRGF0YVJvdXRlckhvb2tbIlVzZUJsb2NrZXIiXSA9ICJ1c2VCbG9ja2VyIjsKICAgICAgICAgICAgRGF0YVJvdXRlckhvb2tbIlVzZVJldmFsaWRhdG9yIl0gPSAidXNlUmV2YWxpZGF0b3IiOwogICAgICAgICAgfSkoRGF0YVJvdXRlckhvb2sgfHwgKERhdGFSb3V0ZXJIb29rID0ge30pKTsKCiAgICAgICAgICB2YXIgRGF0YVJvdXRlclN0YXRlSG9vazsKCiAgICAgICAgICAoZnVuY3Rpb24gKERhdGFSb3V0ZXJTdGF0ZUhvb2spIHsKICAgICAgICAgICAgRGF0YVJvdXRlclN0YXRlSG9va1siVXNlTG9hZGVyRGF0YSJdID0gInVzZUxvYWRlckRhdGEiOwogICAgICAgICAgICBEYXRhUm91dGVyU3RhdGVIb29rWyJVc2VBY3Rpb25EYXRhIl0gPSAidXNlQWN0aW9uRGF0YSI7CiAgICAgICAgICAgIERhdGFSb3V0ZXJTdGF0ZUhvb2tbIlVzZVJvdXRlRXJyb3IiXSA9ICJ1c2VSb3V0ZUVycm9yIjsKICAgICAgICAgICAgRGF0YVJvdXRlclN0YXRlSG9va1siVXNlTmF2aWdhdGlvbiJdID0gInVzZU5hdmlnYXRpb24iOwogICAgICAgICAgICBEYXRhUm91dGVyU3RhdGVIb29rWyJVc2VSb3V0ZUxvYWRlckRhdGEiXSA9ICJ1c2VSb3V0ZUxvYWRlckRhdGEiOwogICAgICAgICAgICBEYXRhUm91dGVyU3RhdGVIb29rWyJVc2VNYXRjaGVzIl0gPSAidXNlTWF0Y2hlcyI7CiAgICAgICAgICAgIERhdGFSb3V0ZXJTdGF0ZUhvb2tbIlVzZVJldmFsaWRhdG9yIl0gPSAidXNlUmV2YWxpZGF0b3IiOwogICAgICAgICAgfSkoRGF0YVJvdXRlclN0YXRlSG9vayB8fCAoRGF0YVJvdXRlclN0YXRlSG9vayA9IHt9KSk7CgogICAgICAgICAgZnVuY3Rpb24gZ2V0RGF0YVJvdXRlckNvbnNvbGVFcnJvcihob29rTmFtZSkgewogICAgICAgICAgICByZXR1cm4gaG9va05hbWUgKyAiIG11c3QgYmUgdXNlZCB3aXRoaW4gYSBkYXRhIHJvdXRlci4gIFNlZSBodHRwczovL3JlYWN0cm91dGVyLmNvbS9yb3V0ZXJzL3BpY2tpbmctYS1yb3V0ZXIuIjsKICAgICAgICAgIH0KCiAgICAgICAgICBmdW5jdGlvbiB1c2VEYXRhUm91dGVyQ29udGV4dChob29rTmFtZSkgewogICAgICAgICAgICB2YXIgY3R4ID0gUmVhY3QudXNlQ29udGV4dChEYXRhUm91dGVyQ29udGV4dCk7CiAgICAgICAgICAgICFjdHggPyBmYWxzZSA/IDAgOiBpbnZhcmlhbnQoZmFsc2UpIDogdm9pZCAwOwogICAgICAgICAgICByZXR1cm4gY3R4OwogICAgICAgICAgfQoKICAgICAgICAgIGZ1bmN0aW9uIHVzZURhdGFSb3V0ZXJTdGF0ZShob29rTmFtZSkgewogICAgICAgICAgICB2YXIgc3RhdGUgPSByZWFjdC51c2VDb250ZXh0KERhdGFSb3V0ZXJTdGF0ZUNvbnRleHQpOwogICAgICAgICAgICAhc3RhdGUgPyBmYWxzZSA/IDAgOiByb3V0ZXJfaW52YXJpYW50KGZhbHNlKSA6IHZvaWQgMDsKICAgICAgICAgICAgcmV0dXJuIHN0YXRlOwogICAgICAgICAgfQoKICAgICAgICAgIGZ1bmN0aW9uIHVzZVJvdXRlQ29udGV4dChob29rTmFtZSkgewogICAgICAgICAgICB2YXIgcm91dGUgPSByZWFjdC51c2VDb250ZXh0KFJvdXRlQ29udGV4dCk7CiAgICAgICAgICAgICFyb3V0ZSA/IGZhbHNlID8gMCA6IHJvdXRlcl9pbnZhcmlhbnQoZmFsc2UpIDogdm9pZCAwOwogICAgICAgICAgICByZXR1cm4gcm91dGU7CiAgICAgICAgICB9CgogICAgICAgICAgZnVuY3Rpb24gdXNlQ3VycmVudFJvdXRlSWQoaG9va05hbWUpIHsKICAgICAgICAgICAgdmFyIHJvdXRlID0gdXNlUm91dGVDb250ZXh0KGhvb2tOYW1lKTsKICAgICAgICAgICAgdmFyIHRoaXNSb3V0ZSA9IHJvdXRlLm1hdGNoZXNbcm91dGUubWF0Y2hlcy5sZW5ndGggLSAxXTsKICAgICAgICAgICAgIXRoaXNSb3V0ZS5yb3V0ZS5pZCA/IGZhbHNlID8gMCA6IHJvdXRlcl9pbnZhcmlhbnQoZmFsc2UpIDogdm9pZCAwOwogICAgICAgICAgICByZXR1cm4gdGhpc1JvdXRlLnJvdXRlLmlkOwogICAgICAgICAgfQogICAgICAgICAgLyoqCiAgICAgICAgICAgKiBSZXR1cm5zIHRoZSBjdXJyZW50IG5hdmlnYXRpb24sIGRlZmF1bHRpbmcgdG8gYW4gImlkbGUiIG5hdmlnYXRpb24gd2hlbgogICAgICAgICAgICogbm8gbmF2aWdhdGlvbiBpcyBpbiBwcm9ncmVzcwogICAgICAgICAgICovCgoKICAgICAgICAgIGZ1bmN0aW9uIGRpc3RfdXNlTmF2aWdhdGlvbigpIHsKICAgICAgICAgICAgdmFyIHN0YXRlID0gdXNlRGF0YVJvdXRlclN0YXRlKERhdGFSb3V0ZXJTdGF0ZUhvb2suVXNlTmF2aWdhdGlvbik7CiAgICAgICAgICAgIHJldHVybiBzdGF0ZS5uYXZpZ2F0aW9uOwogICAgICAgICAgfQogICAgICAgICAgLyoqCiAgICAgICAgICAgKiBSZXR1cm5zIGEgcmV2YWxpZGF0ZSBmdW5jdGlvbiBmb3IgbWFudWFsbHkgdHJpZ2dlcmluZyByZXZhbGlkYXRpb24sIGFzIHdlbGwKICAgICAgICAgICAqIGFzIHRoZSBjdXJyZW50IHN0YXRlIG9mIGFueSBtYW51YWwgcmV2YWxpZGF0aW9ucwogICAgICAgICAgICovCgogICAgICAgICAgZnVuY3Rpb24gdXNlUmV2YWxpZGF0b3IoKSB7CiAgICAgICAgICAgIHZhciBkYXRhUm91dGVyQ29udGV4dCA9IHVzZURhdGFSb3V0ZXJDb250ZXh0KERhdGFSb3V0ZXJIb29rLlVzZVJldmFsaWRhdG9yKTsKICAgICAgICAgICAgdmFyIHN0YXRlID0gdXNlRGF0YVJvdXRlclN0YXRlKERhdGFSb3V0ZXJTdGF0ZUhvb2suVXNlUmV2YWxpZGF0b3IpOwogICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgIHJldmFsaWRhdGU6IGRhdGFSb3V0ZXJDb250ZXh0LnJvdXRlci5yZXZhbGlkYXRlLAogICAgICAgICAgICAgIHN0YXRlOiBzdGF0ZS5yZXZhbGlkYXRpb24KICAgICAgICAgICAgfTsKICAgICAgICAgIH0KICAgICAgICAgIC8qKgogICAgICAgICAgICogUmV0dXJucyB0aGUgYWN0aXZlIHJvdXRlIG1hdGNoZXMsIHVzZWZ1bCBmb3IgYWNjZXNzaW5nIGxvYWRlckRhdGEgZm9yCiAgICAgICAgICAgKiBwYXJlbnQvY2hpbGQgcm91dGVzIG9yIHRoZSByb3V0ZSAiaGFuZGxlIiBwcm9wZXJ0eQogICAgICAgICAgICovCgogICAgICAgICAgZnVuY3Rpb24gZGlzdF91c2VNYXRjaGVzKCkgewogICAgICAgICAgICB2YXIgX3VzZURhdGFSb3V0ZXJTdGF0ZSA9CgoKICAgICAgICAgICAgICB1c2VEYXRhUm91dGVyU3RhdGUoRGF0YVJvdXRlclN0YXRlSG9vay5Vc2VNYXRjaGVzKSxtYXRjaGVzID0gX3VzZURhdGFSb3V0ZXJTdGF0ZS5tYXRjaGVzLGxvYWRlckRhdGEgPSBfdXNlRGF0YVJvdXRlclN0YXRlLmxvYWRlckRhdGE7CiAgICAgICAgICAgIHJldHVybiBSZWFjdC51c2VNZW1vKCgpID0+IG1hdGNoZXMubWFwKChtYXRjaCkgPT4gewogICAgICAgICAgICAgIHZhcgogICAgICAgICAgICAgICAgcGF0aG5hbWUgPQoKICAgICAgICAgICAgICAgIG1hdGNoLnBhdGhuYW1lLHBhcmFtcyA9IG1hdGNoLnBhcmFtczsgLy8gTm90ZTogVGhpcyBzdHJ1Y3R1cmUgbWF0Y2hlcyB0aGF0IGNyZWF0ZWQgYnkgY3JlYXRlVXNlTWF0Y2hlc01hdGNoCiAgICAgICAgICAgICAgLy8gaW4gdGhlIEByZW1peC1ydW4vcm91dGVyICwgc28gaWYgeW91IGNoYW5nZSB0aGlzIHBsZWFzZSBhbHNvIGNoYW5nZQogICAgICAgICAgICAgIC8vIHRoYXQgOikgIEV2ZW50dWFsbHkgd2UnbGwgRFJZIHRoaXMgdXAKCiAgICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgIGlkOiBtYXRjaC5yb3V0ZS5pZCwKICAgICAgICAgICAgICAgIHBhdGhuYW1lOiBwYXRobmFtZSwKICAgICAgICAgICAgICAgIHBhcmFtczogcGFyYW1zLAogICAgICAgICAgICAgICAgZGF0YTogbG9hZGVyRGF0YVttYXRjaC5yb3V0ZS5pZF0sCiAgICAgICAgICAgICAgICBoYW5kbGU6IG1hdGNoLnJvdXRlLmhhbmRsZQogICAgICAgICAgICAgIH07CiAgICAgICAgICAgIH0pLCBbbWF0Y2hlcywgbG9hZGVyRGF0YV0pOwogICAgICAgICAgfQogICAgICAgICAgLyoqCiAgICAgICAgICAgKiBSZXR1cm5zIHRoZSBsb2FkZXIgZGF0YSBmb3IgdGhlIG5lYXJlc3QgYW5jZXN0b3IgUm91dGUgbG9hZGVyCiAgICAgICAgICAgKi8KCiAgICAgICAgICBmdW5jdGlvbiB1c2VMb2FkZXJEYXRhKCkgewogICAgICAgICAgICB2YXIgc3RhdGUgPSB1c2VEYXRhUm91dGVyU3RhdGUoRGF0YVJvdXRlclN0YXRlSG9vay5Vc2VMb2FkZXJEYXRhKTsKICAgICAgICAgICAgdmFyIHJvdXRlSWQgPSB1c2VDdXJyZW50Um91dGVJZChEYXRhUm91dGVyU3RhdGVIb29rLlVzZUxvYWRlckRhdGEpOwoKICAgICAgICAgICAgaWYgKHN0YXRlLmVycm9ycyAmJiBzdGF0ZS5lcnJvcnNbcm91dGVJZF0gIT0gbnVsbCkgewogICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoIllvdSBjYW5ub3QgYHVzZUxvYWRlckRhdGFgIGluIGFuIGVycm9yRWxlbWVudCAocm91dGVJZDogIiArIHJvdXRlSWQgKyAiKSIpOwogICAgICAgICAgICAgIHJldHVybiB1bmRlZmluZWQ7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybiBzdGF0ZS5sb2FkZXJEYXRhW3JvdXRlSWRdOwogICAgICAgICAgfQogICAgICAgICAgLyoqCiAgICAgICAgICAgKiBSZXR1cm5zIHRoZSBsb2FkZXJEYXRhIGZvciB0aGUgZ2l2ZW4gcm91dGVJZAogICAgICAgICAgICovCgogICAgICAgICAgZnVuY3Rpb24gdXNlUm91dGVMb2FkZXJEYXRhKHJvdXRlSWQpIHsKICAgICAgICAgICAgdmFyIHN0YXRlID0gdXNlRGF0YVJvdXRlclN0YXRlKERhdGFSb3V0ZXJTdGF0ZUhvb2suVXNlUm91dGVMb2FkZXJEYXRhKTsKICAgICAgICAgICAgcmV0dXJuIHN0YXRlLmxvYWRlckRhdGFbcm91dGVJZF07CiAgICAgICAgICB9CiAgICAgICAgICAvKioKICAgICAgICAgICAqIFJldHVybnMgdGhlIGFjdGlvbiBkYXRhIGZvciB0aGUgbmVhcmVzdCBhbmNlc3RvciBSb3V0ZSBhY3Rpb24KICAgICAgICAgICAqLwoKICAgICAgICAgIGZ1bmN0aW9uIHVzZUFjdGlvbkRhdGEoKSB7CiAgICAgICAgICAgIHZhciBzdGF0ZSA9IHVzZURhdGFSb3V0ZXJTdGF0ZShEYXRhUm91dGVyU3RhdGVIb29rLlVzZUFjdGlvbkRhdGEpOwogICAgICAgICAgICB2YXIgcm91dGUgPSBSZWFjdC51c2VDb250ZXh0KFJvdXRlQ29udGV4dCk7CiAgICAgICAgICAgICFyb3V0ZSA/IGZhbHNlID8gMCA6IGludmFyaWFudChmYWxzZSkgOiB2b2lkIDA7CiAgICAgICAgICAgIHJldHVybiBPYmplY3QudmFsdWVzKChzdGF0ZSA9PSBudWxsID8gdm9pZCAwIDogc3RhdGUuYWN0aW9uRGF0YSkgfHwge30pWzBdOwogICAgICAgICAgfQogICAgICAgICAgLyoqCiAgICAgICAgICAgKiBSZXR1cm5zIHRoZSBuZWFyZXN0IGFuY2VzdG9yIFJvdXRlIGVycm9yLCB3aGljaCBjb3VsZCBiZSBhIGxvYWRlci9hY3Rpb24KICAgICAgICAgICAqIGVycm9yIG9yIGEgcmVuZGVyIGVycm9yLiAgVGhpcyBpcyBpbnRlbmRlZCB0byBiZSBjYWxsZWQgZnJvbSB5b3VyCiAgICAgICAgICAgKiBlcnJvckVsZW1lbnQgdG8gZGlzcGxheSBhIHByb3BlciBlcnJvciBtZXNzYWdlLgogICAgICAgICAgICovCgogICAgICAgICAgZnVuY3Rpb24gdXNlUm91dGVFcnJvcigpIHsKICAgICAgICAgICAgdmFyIF9zdGF0ZSRlcnJvcnM7CgogICAgICAgICAgICB2YXIgZXJyb3IgPSByZWFjdC51c2VDb250ZXh0KFJvdXRlRXJyb3JDb250ZXh0KTsKICAgICAgICAgICAgdmFyIHN0YXRlID0gdXNlRGF0YVJvdXRlclN0YXRlKERhdGFSb3V0ZXJTdGF0ZUhvb2suVXNlUm91dGVFcnJvcik7CiAgICAgICAgICAgIHZhciByb3V0ZUlkID0gdXNlQ3VycmVudFJvdXRlSWQoRGF0YVJvdXRlclN0YXRlSG9vay5Vc2VSb3V0ZUVycm9yKTsgLy8gSWYgdGhpcyB3YXMgYSByZW5kZXIgZXJyb3IsIHdlIHB1dCBpdCBpbiBhIFJvdXRlRXJyb3IgY29udGV4dCBpbnNpZGUKICAgICAgICAgICAgLy8gb2YgUmVuZGVyRXJyb3JCb3VuZGFyeQoKICAgICAgICAgICAgaWYgKGVycm9yKSB7CiAgICAgICAgICAgICAgcmV0dXJuIGVycm9yOwogICAgICAgICAgICB9IC8vIE90aGVyd2lzZSBsb29rIGZvciBlcnJvcnMgZnJvbSBvdXIgZGF0YSByb3V0ZXIgc3RhdGUKCgogICAgICAgICAgICByZXR1cm4gKF9zdGF0ZSRlcnJvcnMgPSBzdGF0ZS5lcnJvcnMpID09IG51bGwgPyB2b2lkIDAgOiBfc3RhdGUkZXJyb3JzW3JvdXRlSWRdOwogICAgICAgICAgfQogICAgICAgICAgLyoqCiAgICAgICAgICAgKiBSZXR1cm5zIHRoZSBoYXBweS1wYXRoIGRhdGEgZnJvbSB0aGUgbmVhcmVzdCBhbmNlc3RvciA8QXdhaXQgLz4gdmFsdWUKICAgICAgICAgICAqLwoKICAgICAgICAgIGZ1bmN0aW9uIHVzZUFzeW5jVmFsdWUoKSB7CiAgICAgICAgICAgIHZhciB2YWx1ZSA9IFJlYWN0LnVzZUNvbnRleHQoQXdhaXRDb250ZXh0KTsKICAgICAgICAgICAgcmV0dXJuIHZhbHVlID09IG51bGwgPyB2b2lkIDAgOiB2YWx1ZS5fZGF0YTsKICAgICAgICAgIH0KICAgICAgICAgIC8qKgogICAgICAgICAgICogUmV0dXJucyB0aGUgZXJyb3IgZnJvbSB0aGUgbmVhcmVzdCBhbmNlc3RvciA8QXdhaXQgLz4gdmFsdWUKICAgICAgICAgICAqLwoKICAgICAgICAgIGZ1bmN0aW9uIHVzZUFzeW5jRXJyb3IoKSB7CiAgICAgICAgICAgIHZhciB2YWx1ZSA9IFJlYWN0LnVzZUNvbnRleHQoQXdhaXRDb250ZXh0KTsKICAgICAgICAgICAgcmV0dXJuIHZhbHVlID09IG51bGwgPyB2b2lkIDAgOiB2YWx1ZS5fZXJyb3I7CiAgICAgICAgICB9IC8vIHVzZUJsb2NrZXIoKSBpcyBhIHNpbmdsZXRvbiBmb3Igbm93IHNpbmNlIHdlIGRvbid0IGhhdmUgYW55IGNvbXBlbGxpbmcgdXNlCiAgICAgICAgICAvLyBjYXNlcyBmb3IgbXVsdGktYmxvY2tlciB5ZXQKCiAgICAgICAgICB2YXIgYmxvY2tlcktleSA9ICJibG9ja2VyLXNpbmdsZXRvbiI7CiAgICAgICAgICAvKioKICAgICAgICAgICAqIEFsbG93IHRoZSBhcHBsaWNhdGlvbiB0byBibG9jayBuYXZpZ2F0aW9ucyB3aXRoaW4gdGhlIFNQQSBhbmQgcHJlc2VudCB0aGUKICAgICAgICAgICAqIHVzZXIgYSBjb25maXJtYXRpb24gZGlhbG9nIHRvIGNvbmZpcm0gdGhlIG5hdmlnYXRpb24uICBNb3N0bHkgdXNlZCB0byBhdm9pZAogICAgICAgICAgICogdXNpbmcgaGFsZi1maWxsZWQgZm9ybSBkYXRhLiAgVGhpcyBkb2VzIG5vdCBoYW5kbGUgaGFyZC1yZWxvYWRzIG9yCiAgICAgICAgICAgKiBjcm9zcy1vcmlnaW4gbmF2aWdhdGlvbnMuCiAgICAgICAgICAgKi8KCiAgICAgICAgICBmdW5jdGlvbiB1c2VCbG9ja2VyKHNob3VsZEJsb2NrKSB7CiAgICAgICAgICAgIHZhciBfdXNlRGF0YVJvdXRlckNvbnRleHQgPQoKICAgICAgICAgICAgICB1c2VEYXRhUm91dGVyQ29udGV4dChEYXRhUm91dGVySG9vay5Vc2VCbG9ja2VyKSxyb3V0ZXIgPSBfdXNlRGF0YVJvdXRlckNvbnRleHQucm91dGVyOwogICAgICAgICAgICB2YXIgYmxvY2tlckZ1bmN0aW9uID0gUmVhY3QudXNlQ2FsbGJhY2soKGFyZ3MpID0+IHsKICAgICAgICAgICAgICByZXR1cm4gdHlwZW9mIHNob3VsZEJsb2NrID09PSAiZnVuY3Rpb24iID8gISFzaG91bGRCbG9jayhhcmdzKSA6ICEhc2hvdWxkQmxvY2s7CiAgICAgICAgICAgIH0sIFtzaG91bGRCbG9ja10pOwogICAgICAgICAgICB2YXIgYmxvY2tlciA9IHJvdXRlci5nZXRCbG9ja2VyKGJsb2NrZXJLZXksIGJsb2NrZXJGdW5jdGlvbik7IC8vIENsZWFudXAgb24gdW5tb3VudAoKICAgICAgICAgICAgUmVhY3QudXNlRWZmZWN0KCgpID0+ICgpID0+IHJvdXRlci5kZWxldGVCbG9ja2VyKGJsb2NrZXJLZXkpLCBbcm91dGVyXSk7CiAgICAgICAgICAgIHJldHVybiBibG9ja2VyOwogICAgICAgICAgfQogICAgICAgICAgdmFyIGFscmVhZHlXYXJuZWQgPSB7fTsKCiAgICAgICAgICBmdW5jdGlvbiB3YXJuaW5nT25jZShrZXksIGNvbmQsIG1lc3NhZ2UpIHsKICAgICAgICAgICAgaWYgKCFjb25kICYmICFhbHJlYWR5V2FybmVkW2tleV0pIHsKICAgICAgICAgICAgICBhbHJlYWR5V2FybmVkW2tleV0gPSB0cnVlOwogICAgICAgICAgICAgIGZhbHNlID8gMCA6IHZvaWQgMDsKICAgICAgICAgICAgfQogICAgICAgICAgfQoKICAgICAgICAgIC8qKgogICAgICAgICAgICogR2l2ZW4gYSBSZW1peCBSb3V0ZXIgaW5zdGFuY2UsIHJlbmRlciB0aGUgYXBwcm9wcmlhdGUgVUkKICAgICAgICAgICAqLwogICAgICAgICAgZnVuY3Rpb24gUm91dGVyUHJvdmlkZXIoX3JlZikgewogICAgICAgICAgICB2YXIKICAgICAgICAgICAgICBmYWxsYmFja0VsZW1lbnQgPQoKICAgICAgICAgICAgICBfcmVmLmZhbGxiYWNrRWxlbWVudCxyb3V0ZXIgPSBfcmVmLnJvdXRlcjsKICAgICAgICAgICAgLy8gU3luYyByb3V0ZXIgc3RhdGUgdG8gb3VyIGNvbXBvbmVudCBzdGF0ZSB0byBmb3JjZSByZS1yZW5kZXJzCiAgICAgICAgICAgIHZhciBzdGF0ZSA9IHVzZVN5bmNFeHRlcm5hbFN0b3JlKHJvdXRlci5zdWJzY3JpYmUsICgpID0+IHJvdXRlci5zdGF0ZSwgLy8gV2UgaGF2ZSB0byBwcm92aWRlIHRoaXMgc28gUmVhY3RAMTggZG9lc24ndCBjb21wbGFpbiBkdXJpbmcgaHlkcmF0aW9uLAogICAgICAgICAgICAvLyBidXQgd2UgcGFzcyBvdXIgc2VyaWFsaXplZCBoeWRyYXRpb24gZGF0YSBpbnRvIHRoZSByb3V0ZXIgc28gc3RhdGUgaGVyZQogICAgICAgICAgICAvLyBpcyBhbHJlYWR5IHN5bmNlZCB3aXRoIHdoYXQgdGhlIHNlcnZlciBzYXcKICAgICAgICAgICAgKCkgPT4gcm91dGVyLnN0YXRlKTsKICAgICAgICAgICAgdmFyIG5hdmlnYXRvciA9IFJlYWN0LnVzZU1lbW8oKCkgPT4gewogICAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICBjcmVhdGVIcmVmOiByb3V0ZXIuY3JlYXRlSHJlZiwKICAgICAgICAgICAgICAgIGVuY29kZUxvY2F0aW9uOiByb3V0ZXIuZW5jb2RlTG9jYXRpb24sCiAgICAgICAgICAgICAgICBnbzogKG4pID0+IHJvdXRlci5uYXZpZ2F0ZShuKSwKICAgICAgICAgICAgICAgIHB1c2g6ICh0bywgc3RhdGUsIG9wdHMpID0+IHJvdXRlci5uYXZpZ2F0ZSh0bywgewogICAgICAgICAgICAgICAgICBzdGF0ZTogc3RhdGUsCiAgICAgICAgICAgICAgICAgIHByZXZlbnRTY3JvbGxSZXNldDogb3B0cyA9PSBudWxsID8gdm9pZCAwIDogb3B0cy5wcmV2ZW50U2Nyb2xsUmVzZXQKICAgICAgICAgICAgICAgIH0pLAogICAgICAgICAgICAgICAgcmVwbGFjZTogKHRvLCBzdGF0ZSwgb3B0cykgPT4gcm91dGVyLm5hdmlnYXRlKHRvLCB7CiAgICAgICAgICAgICAgICAgIHJlcGxhY2U6IHRydWUsCiAgICAgICAgICAgICAgICAgIHN0YXRlOiBzdGF0ZSwKICAgICAgICAgICAgICAgICAgcHJldmVudFNjcm9sbFJlc2V0OiBvcHRzID09IG51bGwgPyB2b2lkIDAgOiBvcHRzLnByZXZlbnRTY3JvbGxSZXNldAogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICB9OwogICAgICAgICAgICB9LCBbcm91dGVyXSk7CiAgICAgICAgICAgIHZhciBiYXNlbmFtZSA9IHJvdXRlci5iYXNlbmFtZSB8fCAiLyI7IC8vIFRoZSBmcmFnbWVudCBhbmQge251bGx9IGhlcmUgYXJlIGltcG9ydGFudCEgIFdlIG5lZWQgdGhlbSB0byBrZWVwIFJlYWN0IDE4J3MKICAgICAgICAgICAgLy8gdXNlSWQgaGFwcHkgd2hlbiB3ZSBhcmUgc2VydmVyLXJlbmRlcmluZyBzaW5jZSB3ZSBtYXkgaGF2ZSBhIDxzY3JpcHQ+IGhlcmUKICAgICAgICAgICAgLy8gY29udGFpbmluZyB0aGUgaHlkcmF0ZWQgc2VydmVyLXNpZGUgc3RhdGljQ29udGV4dCAoZnJvbSBTdGF0aWNSb3V0ZXJQcm92aWRlcikuCiAgICAgICAgICAgIC8vIHVzZUlkIHJlbGllcyBvbiB0aGUgY29tcG9uZW50IHRyZWUgc3RydWN0dXJlIHRvIGdlbmVyYXRlIGRldGVybWluaXN0aWMgaWQncwogICAgICAgICAgICAvLyBzbyB3ZSBuZWVkIHRvIGVuc3VyZSBpdCByZW1haW5zIHRoZSBzYW1lIG9uIHRoZSBjbGllbnQgZXZlbiB0aG91Z2gKICAgICAgICAgICAgLy8gd2UgZG9uJ3QgbmVlZCB0aGUgPHNjcmlwdD4gdGFnCgogICAgICAgICAgICByZXR1cm4gLyojX19QVVJFX18qL1JlYWN0LmNyZWF0ZUVsZW1lbnQoUmVhY3QuRnJhZ21lbnQsIG51bGwsIC8qI19fUFVSRV9fKi9SZWFjdC5jcmVhdGVFbGVtZW50KERhdGFSb3V0ZXJDb250ZXh0LlByb3ZpZGVyLCB7CiAgICAgICAgICAgICAgdmFsdWU6IHsKICAgICAgICAgICAgICAgIHJvdXRlcjogcm91dGVyLAogICAgICAgICAgICAgICAgbmF2aWdhdG9yOiBuYXZpZ2F0b3IsCiAgICAgICAgICAgICAgICBzdGF0aWM6IGZhbHNlLAogICAgICAgICAgICAgICAgLy8gRG8gd2UgbmVlZCB0aGlzPwogICAgICAgICAgICAgICAgYmFzZW5hbWU6IGJhc2VuYW1lCiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LCAvKiNfX1BVUkVfXyovUmVhY3QuY3JlYXRlRWxlbWVudChEYXRhUm91dGVyU3RhdGVDb250ZXh0LlByb3ZpZGVyLCB7CiAgICAgICAgICAgICAgdmFsdWU6IHN0YXRlCiAgICAgICAgICAgIH0sIC8qI19fUFVSRV9fKi9SZWFjdC5jcmVhdGVFbGVtZW50KGRpc3RfUm91dGVyLCB7CiAgICAgICAgICAgICAgYmFzZW5hbWU6IHJvdXRlci5iYXNlbmFtZSwKICAgICAgICAgICAgICBsb2NhdGlvbjogcm91dGVyLnN0YXRlLmxvY2F0aW9uLAogICAgICAgICAgICAgIG5hdmlnYXRpb25UeXBlOiByb3V0ZXIuc3RhdGUuaGlzdG9yeUFjdGlvbiwKICAgICAgICAgICAgICBuYXZpZ2F0b3I6IG5hdmlnYXRvcgogICAgICAgICAgICB9LCByb3V0ZXIuc3RhdGUuaW5pdGlhbGl6ZWQgPyAvKiNfX1BVUkVfXyovUmVhY3QuY3JlYXRlRWxlbWVudChSb3V0ZXMsIG51bGwpIDogZmFsbGJhY2tFbGVtZW50KSkpLCBudWxsKTsKICAgICAgICAgIH0KCiAgICAgICAgICAvKioKICAgICAgICAgICAqIEEgPFJvdXRlcj4gdGhhdCBzdG9yZXMgYWxsIGVudHJpZXMgaW4gbWVtb3J5LgogICAgICAgICAgICoKICAgICAgICAgICAqIEBzZWUgaHR0cHM6Ly9yZWFjdHJvdXRlci5jb20vcm91dGVyLWNvbXBvbmVudHMvbWVtb3J5LXJvdXRlcgogICAgICAgICAgICovCiAgICAgICAgICBmdW5jdGlvbiBNZW1vcnlSb3V0ZXIoX3JlZjIpIHsKICAgICAgICAgICAgdmFyCiAgICAgICAgICAgICAgYmFzZW5hbWUgPQoKCgogICAgICAgICAgICAgIF9yZWYyLmJhc2VuYW1lLGNoaWxkcmVuID0gX3JlZjIuY2hpbGRyZW4saW5pdGlhbEVudHJpZXMgPSBfcmVmMi5pbml0aWFsRW50cmllcyxpbml0aWFsSW5kZXggPSBfcmVmMi5pbml0aWFsSW5kZXg7CiAgICAgICAgICAgIHZhciBoaXN0b3J5UmVmID0gcmVhY3QudXNlUmVmKCk7CgogICAgICAgICAgICBpZiAoaGlzdG9yeVJlZi5jdXJyZW50ID09IG51bGwpIHsKICAgICAgICAgICAgICBoaXN0b3J5UmVmLmN1cnJlbnQgPSByb3V0ZXJfY3JlYXRlTWVtb3J5SGlzdG9yeSh7CiAgICAgICAgICAgICAgICBpbml0aWFsRW50cmllczogaW5pdGlhbEVudHJpZXMsCiAgICAgICAgICAgICAgICBpbml0aWFsSW5kZXg6IGluaXRpYWxJbmRleCwKICAgICAgICAgICAgICAgIHY1Q29tcGF0OiB0cnVlCiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHZhciBoaXN0b3J5ID0gaGlzdG9yeVJlZi5jdXJyZW50OwogICAgICAgICAgICB2YXIgX3JlYWN0JHVzZVN0YXRlID0gcmVhY3QudXNlU3RhdGUoewogICAgICAgICAgICAgICAgYWN0aW9uOiBoaXN0b3J5LmFjdGlvbiwKICAgICAgICAgICAgICAgIGxvY2F0aW9uOiBoaXN0b3J5LmxvY2F0aW9uCiAgICAgICAgICAgICAgfSksX3JlYWN0JHVzZVN0YXRlMiA9IF9zbGljZWRUb0FycmF5MihfcmVhY3QkdXNlU3RhdGUsIDIpLHN0YXRlID0gX3JlYWN0JHVzZVN0YXRlMlswXSxzZXRTdGF0ZSA9IF9yZWFjdCR1c2VTdGF0ZTJbMV07CiAgICAgICAgICAgIHJlYWN0LnVzZUxheW91dEVmZmVjdCgoKSA9PiBoaXN0b3J5Lmxpc3RlbihzZXRTdGF0ZSksIFtoaXN0b3J5XSk7CiAgICAgICAgICAgIHJldHVybiAvKiNfX1BVUkVfXyovcmVhY3QuY3JlYXRlRWxlbWVudChkaXN0X1JvdXRlciwgewogICAgICAgICAgICAgIGJhc2VuYW1lOiBiYXNlbmFtZSwKICAgICAgICAgICAgICBjaGlsZHJlbjogY2hpbGRyZW4sCiAgICAgICAgICAgICAgbG9jYXRpb246IHN0YXRlLmxvY2F0aW9uLAogICAgICAgICAgICAgIG5hdmlnYXRpb25UeXBlOiBzdGF0ZS5hY3Rpb24sCiAgICAgICAgICAgICAgbmF2aWdhdG9yOiBoaXN0b3J5CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfQoKICAgICAgICAgIC8qKgogICAgICAgICAgICogQ2hhbmdlcyB0aGUgY3VycmVudCBsb2NhdGlvbi4KICAgICAgICAgICAqCiAgICAgICAgICAgKiBOb3RlOiBUaGlzIEFQSSBpcyBtb3N0bHkgdXNlZnVsIGluIFJlYWN0LkNvbXBvbmVudCBzdWJjbGFzc2VzIHRoYXQgYXJlIG5vdAogICAgICAgICAgICogYWJsZSB0byB1c2UgaG9va3MuIEluIGZ1bmN0aW9uYWwgY29tcG9uZW50cywgd2UgcmVjb21tZW5kIHlvdSB1c2UgdGhlCiAgICAgICAgICAgKiBgdXNlTmF2aWdhdGVgIGhvb2sgaW5zdGVhZC4KICAgICAgICAgICAqCiAgICAgICAgICAgKiBAc2VlIGh0dHBzOi8vcmVhY3Ryb3V0ZXIuY29tL2NvbXBvbmVudHMvbmF2aWdhdGUKICAgICAgICAgICAqLwogICAgICAgICAgZnVuY3Rpb24gTmF2aWdhdGUoX3JlZjMpIHsKICAgICAgICAgICAgdmFyCiAgICAgICAgICAgICAgdG8gPQoKCgogICAgICAgICAgICAgIF9yZWYzLnRvLHJlcGxhY2UgPSBfcmVmMy5yZXBsYWNlLHN0YXRlID0gX3JlZjMuc3RhdGUscmVsYXRpdmUgPSBfcmVmMy5yZWxhdGl2ZTsKICAgICAgICAgICAgIXVzZUluUm91dGVyQ29udGV4dCgpID8gZmFsc2UgPyAwIDogcm91dGVyX2ludmFyaWFudChmYWxzZSkgOiB2b2lkIDA7CiAgICAgICAgICAgIGZhbHNlID8gMCA6IHZvaWQgMDsKICAgICAgICAgICAgdmFyIGRhdGFSb3V0ZXJTdGF0ZSA9IHJlYWN0LnVzZUNvbnRleHQoRGF0YVJvdXRlclN0YXRlQ29udGV4dCk7CiAgICAgICAgICAgIHZhciBuYXZpZ2F0ZSA9IGRpc3RfdXNlTmF2aWdhdGUoKTsKICAgICAgICAgICAgcmVhY3QudXNlRWZmZWN0KCgpID0+IHsKICAgICAgICAgICAgICAvLyBBdm9pZCBraWNraW5nIG9mZiBtdWx0aXBsZSBuYXZpZ2F0aW9ucyBpZiB3ZSdyZSBpbiB0aGUgbWlkZGxlIG9mIGEKICAgICAgICAgICAgICAvLyBkYXRhLXJvdXRlciBuYXZpZ2F0aW9uLCBzaW5jZSBjb21wb25lbnRzIGdldCByZS1yZW5kZXJlZCB3aGVuIHdlIGVudGVyCiAgICAgICAgICAgICAgLy8gYSBzdWJtaXR0aW5nL2xvYWRpbmcgc3RhdGUKICAgICAgICAgICAgICBpZiAoZGF0YVJvdXRlclN0YXRlICYmIGRhdGFSb3V0ZXJTdGF0ZS5uYXZpZ2F0aW9uLnN0YXRlICE9PSAiaWRsZSIpIHsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIG5hdmlnYXRlKHRvLCB7CiAgICAgICAgICAgICAgICByZXBsYWNlOiByZXBsYWNlLAogICAgICAgICAgICAgICAgc3RhdGU6IHN0YXRlLAogICAgICAgICAgICAgICAgcmVsYXRpdmU6IHJlbGF0aXZlCiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICAgIH0KCiAgICAgICAgICAvKioKICAgICAgICAgICAqIFJlbmRlcnMgdGhlIGNoaWxkIHJvdXRlJ3MgZWxlbWVudCwgaWYgdGhlcmUgaXMgb25lLgogICAgICAgICAgICoKICAgICAgICAgICAqIEBzZWUgaHR0cHM6Ly9yZWFjdHJvdXRlci5jb20vY29tcG9uZW50cy9vdXRsZXQKICAgICAgICAgICAqLwogICAgICAgICAgZnVuY3Rpb24gT3V0bGV0KHByb3BzKSB7CiAgICAgICAgICAgIHJldHVybiB1c2VPdXRsZXQocHJvcHMuY29udGV4dCk7CiAgICAgICAgICB9CgogICAgICAgICAgLyoqCiAgICAgICAgICAgKiBEZWNsYXJlcyBhbiBlbGVtZW50IHRoYXQgc2hvdWxkIGJlIHJlbmRlcmVkIGF0IGEgY2VydGFpbiBVUkwgcGF0aC4KICAgICAgICAgICAqCiAgICAgICAgICAgKiBAc2VlIGh0dHBzOi8vcmVhY3Ryb3V0ZXIuY29tL2NvbXBvbmVudHMvcm91dGUKICAgICAgICAgICAqLwogICAgICAgICAgZnVuY3Rpb24gUm91dGUoX3Byb3BzKSB7CiAgICAgICAgICAgIGZhbHNlID8gMCA6IHJvdXRlcl9pbnZhcmlhbnQoZmFsc2UpOwogICAgICAgICAgfQoKICAgICAgICAgIC8qKgogICAgICAgICAgICogUHJvdmlkZXMgbG9jYXRpb24gY29udGV4dCBmb3IgdGhlIHJlc3Qgb2YgdGhlIGFwcC4KICAgICAgICAgICAqCiAgICAgICAgICAgKiBOb3RlOiBZb3UgdXN1YWxseSB3b24ndCByZW5kZXIgYSA8Um91dGVyPiBkaXJlY3RseS4gSW5zdGVhZCwgeW91J2xsIHJlbmRlciBhCiAgICAgICAgICAgKiByb3V0ZXIgdGhhdCBpcyBtb3JlIHNwZWNpZmljIHRvIHlvdXIgZW52aXJvbm1lbnQgc3VjaCBhcyBhIDxCcm93c2VyUm91dGVyPgogICAgICAgICAgICogaW4gd2ViIGJyb3dzZXJzIG9yIGEgPFN0YXRpY1JvdXRlcj4gZm9yIHNlcnZlciByZW5kZXJpbmcuCiAgICAgICAgICAgKgogICAgICAgICAgICogQHNlZSBodHRwczovL3JlYWN0cm91dGVyLmNvbS9yb3V0ZXItY29tcG9uZW50cy9yb3V0ZXIKICAgICAgICAgICAqLwogICAgICAgICAgZnVuY3Rpb24gZGlzdF9Sb3V0ZXIoX3JlZjQpIHsKICAgICAgICAgICAgdmFyIF9yZWY0JGJhc2VuYW1lID0KCgoKCgoKICAgICAgICAgICAgICBfcmVmNC5iYXNlbmFtZSxiYXNlbmFtZVByb3AgPSBfcmVmNCRiYXNlbmFtZSA9PT0gdm9pZCAwID8gIi8iIDogX3JlZjQkYmFzZW5hbWUsX3JlZjQkY2hpbGRyZW4gPSBfcmVmNC5jaGlsZHJlbixjaGlsZHJlbiA9IF9yZWY0JGNoaWxkcmVuID09PSB2b2lkIDAgPyBudWxsIDogX3JlZjQkY2hpbGRyZW4sbG9jYXRpb25Qcm9wID0gX3JlZjQubG9jYXRpb24sX3JlZjQkbmF2aWdhdGlvblR5cGUgPSBfcmVmNC5uYXZpZ2F0aW9uVHlwZSxuYXZpZ2F0aW9uVHlwZSA9IF9yZWY0JG5hdmlnYXRpb25UeXBlID09PSB2b2lkIDAgPyBBY3Rpb24uUG9wIDogX3JlZjQkbmF2aWdhdGlvblR5cGUsbmF2aWdhdG9yID0gX3JlZjQubmF2aWdhdG9yLF9yZWY0JHN0YXRpYyA9IF9yZWY0LnN0YXRpYyxzdGF0aWNQcm9wID0gX3JlZjQkc3RhdGljID09PSB2b2lkIDAgPyBmYWxzZSA6IF9yZWY0JHN0YXRpYzsKICAgICAgICAgICAgISF1c2VJblJvdXRlckNvbnRleHQoKSA/IGZhbHNlID8gMCA6IHJvdXRlcl9pbnZhcmlhbnQoZmFsc2UpIDogdm9pZCAwOyAvLyBQcmVzZXJ2ZSB0cmFpbGluZyBzbGFzaGVzIG9uIGJhc2VuYW1lLCBzbyB3ZSBjYW4gbGV0IHRoZSB1c2VyIGNvbnRyb2wKICAgICAgICAgICAgLy8gdGhlIGVuZm9yY2VtZW50IG9mIHRyYWlsaW5nIHNsYXNoZXMgdGhyb3VnaG91dCB0aGUgYXBwCgogICAgICAgICAgICB2YXIgYmFzZW5hbWUgPSBiYXNlbmFtZVByb3AucmVwbGFjZSgvXlwvKi8sICIvIik7CiAgICAgICAgICAgIHZhciBuYXZpZ2F0aW9uQ29udGV4dCA9IHJlYWN0LnVzZU1lbW8oKCkgPT4gKHsKICAgICAgICAgICAgICBiYXNlbmFtZTogYmFzZW5hbWUsCiAgICAgICAgICAgICAgbmF2aWdhdG9yOiBuYXZpZ2F0b3IsCiAgICAgICAgICAgICAgc3RhdGljOiBzdGF0aWNQcm9wCiAgICAgICAgICAgIH0pLCBbYmFzZW5hbWUsIG5hdmlnYXRvciwgc3RhdGljUHJvcF0pOwoKICAgICAgICAgICAgaWYgKHR5cGVvZiBsb2NhdGlvblByb3AgPT09ICJzdHJpbmciKSB7CiAgICAgICAgICAgICAgbG9jYXRpb25Qcm9wID0gcGFyc2VQYXRoKGxvY2F0aW9uUHJvcCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHZhciBfbG9jYXRpb25Qcm9wID0KCgoKCgogICAgICAgICAgICAgIGxvY2F0aW9uUHJvcCxfbG9jYXRpb25Qcm9wJHBhdGhuYW0gPSBfbG9jYXRpb25Qcm9wLnBhdGhuYW1lLHBhdGhuYW1lID0gX2xvY2F0aW9uUHJvcCRwYXRobmFtID09PSB2b2lkIDAgPyAiLyIgOiBfbG9jYXRpb25Qcm9wJHBhdGhuYW0sX2xvY2F0aW9uUHJvcCRzZWFyY2ggPSBfbG9jYXRpb25Qcm9wLnNlYXJjaCxzZWFyY2ggPSBfbG9jYXRpb25Qcm9wJHNlYXJjaCA9PT0gdm9pZCAwID8gIiIgOiBfbG9jYXRpb25Qcm9wJHNlYXJjaCxfbG9jYXRpb25Qcm9wJGhhc2ggPSBfbG9jYXRpb25Qcm9wLmhhc2gsaGFzaCA9IF9sb2NhdGlvblByb3AkaGFzaCA9PT0gdm9pZCAwID8gIiIgOiBfbG9jYXRpb25Qcm9wJGhhc2gsX2xvY2F0aW9uUHJvcCRzdGF0ZSA9IF9sb2NhdGlvblByb3Auc3RhdGUsc3RhdGUgPSBfbG9jYXRpb25Qcm9wJHN0YXRlID09PSB2b2lkIDAgPyBudWxsIDogX2xvY2F0aW9uUHJvcCRzdGF0ZSxfbG9jYXRpb25Qcm9wJGtleSA9IF9sb2NhdGlvblByb3Aua2V5LGtleSA9IF9sb2NhdGlvblByb3Aka2V5ID09PSB2b2lkIDAgPyAiZGVmYXVsdCIgOiBfbG9jYXRpb25Qcm9wJGtleTsKICAgICAgICAgICAgdmFyIGxvY2F0aW9uID0gcmVhY3QudXNlTWVtbygoKSA9PiB7CiAgICAgICAgICAgICAgdmFyIHRyYWlsaW5nUGF0aG5hbWUgPSBzdHJpcEJhc2VuYW1lKHBhdGhuYW1lLCBiYXNlbmFtZSk7CgogICAgICAgICAgICAgIGlmICh0cmFpbGluZ1BhdGhuYW1lID09IG51bGwpIHsKICAgICAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgIHBhdGhuYW1lOiB0cmFpbGluZ1BhdGhuYW1lLAogICAgICAgICAgICAgICAgc2VhcmNoOiBzZWFyY2gsCiAgICAgICAgICAgICAgICBoYXNoOiBoYXNoLAogICAgICAgICAgICAgICAgc3RhdGU6IHN0YXRlLAogICAgICAgICAgICAgICAga2V5OiBrZXkKICAgICAgICAgICAgICB9OwogICAgICAgICAgICB9LCBbYmFzZW5hbWUsIHBhdGhuYW1lLCBzZWFyY2gsIGhhc2gsIHN0YXRlLCBrZXldKTsKICAgICAgICAgICAgZmFsc2UgPyAwIDogdm9pZCAwOwoKICAgICAgICAgICAgaWYgKGxvY2F0aW9uID09IG51bGwpIHsKICAgICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuIC8qI19fUFVSRV9fKi9yZWFjdC5jcmVhdGVFbGVtZW50KE5hdmlnYXRpb25Db250ZXh0LlByb3ZpZGVyLCB7CiAgICAgICAgICAgICAgdmFsdWU6IG5hdmlnYXRpb25Db250ZXh0CiAgICAgICAgICAgIH0sIC8qI19fUFVSRV9fKi9yZWFjdC5jcmVhdGVFbGVtZW50KExvY2F0aW9uQ29udGV4dC5Qcm92aWRlciwgewogICAgICAgICAgICAgIGNoaWxkcmVuOiBjaGlsZHJlbiwKICAgICAgICAgICAgICB2YWx1ZTogewogICAgICAgICAgICAgICAgbG9jYXRpb246IGxvY2F0aW9uLAogICAgICAgICAgICAgICAgbmF2aWdhdGlvblR5cGU6IG5hdmlnYXRpb25UeXBlCiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KSk7CiAgICAgICAgICB9CgogICAgICAgICAgLyoqCiAgICAgICAgICAgKiBBIGNvbnRhaW5lciBmb3IgYSBuZXN0ZWQgdHJlZSBvZiA8Um91dGU+IGVsZW1lbnRzIHRoYXQgcmVuZGVycyB0aGUgYnJhbmNoCiAgICAgICAgICAgKiB0aGF0IGJlc3QgbWF0Y2hlcyB0aGUgY3VycmVudCBsb2NhdGlvbi4KICAgICAgICAgICAqCiAgICAgICAgICAgKiBAc2VlIGh0dHBzOi8vcmVhY3Ryb3V0ZXIuY29tL2NvbXBvbmVudHMvcm91dGVzCiAgICAgICAgICAgKi8KICAgICAgICAgIGZ1bmN0aW9uIFJvdXRlcyhfcmVmNSkgewogICAgICAgICAgICB2YXIKICAgICAgICAgICAgICBjaGlsZHJlbiA9CgogICAgICAgICAgICAgIF9yZWY1LmNoaWxkcmVuLGxvY2F0aW9uID0gX3JlZjUubG9jYXRpb247CiAgICAgICAgICAgIHZhciBkYXRhUm91dGVyQ29udGV4dCA9IHJlYWN0LnVzZUNvbnRleHQoRGF0YVJvdXRlckNvbnRleHQpOyAvLyBXaGVuIGluIGEgRGF0YVJvdXRlckNvbnRleHQgX3dpdGhvdXRfIGNoaWxkcmVuLCB3ZSB1c2UgdGhlIHJvdXRlciByb3V0ZXMKICAgICAgICAgICAgLy8gZGlyZWN0bHkuICBJZiB3ZSBoYXZlIGNoaWxkcmVuLCB0aGVuIHdlJ3JlIGluIGEgZGVzY2VuZGFudCB0cmVlIGFuZCB3ZQogICAgICAgICAgICAvLyBuZWVkIHRvIHVzZSBjaGlsZCByb3V0ZXMuCgogICAgICAgICAgICB2YXIgcm91dGVzID0gZGF0YVJvdXRlckNvbnRleHQgJiYgIWNoaWxkcmVuID8gZGF0YVJvdXRlckNvbnRleHQucm91dGVyLnJvdXRlcyA6IGNyZWF0ZVJvdXRlc0Zyb21DaGlsZHJlbihjaGlsZHJlbik7CiAgICAgICAgICAgIHJldHVybiB1c2VSb3V0ZXMocm91dGVzLCBsb2NhdGlvbik7CiAgICAgICAgICB9CgogICAgICAgICAgLyoqCiAgICAgICAgICAgKiBDb21wb25lbnQgdG8gdXNlIGZvciByZW5kZXJpbmcgbGF6aWx5IGxvYWRlZCBkYXRhIGZyb20gcmV0dXJuaW5nIGRlZmVyKCkKICAgICAgICAgICAqIGluIGEgbG9hZGVyIGZ1bmN0aW9uCiAgICAgICAgICAgKi8KICAgICAgICAgIGZ1bmN0aW9uIEF3YWl0KF9yZWY2KSB7CiAgICAgICAgICAgIHZhcgogICAgICAgICAgICAgIGNoaWxkcmVuID0KCgogICAgICAgICAgICAgIF9yZWY2LmNoaWxkcmVuLGVycm9yRWxlbWVudCA9IF9yZWY2LmVycm9yRWxlbWVudCxyZXNvbHZlID0gX3JlZjYucmVzb2x2ZTsKICAgICAgICAgICAgcmV0dXJuIC8qI19fUFVSRV9fKi9SZWFjdC5jcmVhdGVFbGVtZW50KEF3YWl0RXJyb3JCb3VuZGFyeSwgewogICAgICAgICAgICAgIHJlc29sdmU6IHJlc29sdmUsCiAgICAgICAgICAgICAgZXJyb3JFbGVtZW50OiBlcnJvckVsZW1lbnQKICAgICAgICAgICAgfSwgLyojX19QVVJFX18qL1JlYWN0LmNyZWF0ZUVsZW1lbnQoUmVzb2x2ZUF3YWl0LCBudWxsLCBjaGlsZHJlbikpOwogICAgICAgICAgfQogICAgICAgICAgdmFyIEF3YWl0UmVuZGVyU3RhdHVzOwoKICAgICAgICAgIChmdW5jdGlvbiAoQXdhaXRSZW5kZXJTdGF0dXMpIHsKICAgICAgICAgICAgQXdhaXRSZW5kZXJTdGF0dXNbQXdhaXRSZW5kZXJTdGF0dXNbInBlbmRpbmciXSA9IDBdID0gInBlbmRpbmciOwogICAgICAgICAgICBBd2FpdFJlbmRlclN0YXR1c1tBd2FpdFJlbmRlclN0YXR1c1sic3VjY2VzcyJdID0gMV0gPSAic3VjY2VzcyI7CiAgICAgICAgICAgIEF3YWl0UmVuZGVyU3RhdHVzW0F3YWl0UmVuZGVyU3RhdHVzWyJlcnJvciJdID0gMl0gPSAiZXJyb3IiOwogICAgICAgICAgfSkoQXdhaXRSZW5kZXJTdGF0dXMgfHwgKEF3YWl0UmVuZGVyU3RhdHVzID0ge30pKTsKCiAgICAgICAgICB2YXIgbmV2ZXJTZXR0bGVkUHJvbWlzZSA9IG5ldyBQcm9taXNlKCgpID0+IHt9KTt2YXIKCiAgICAgICAgICBBd2FpdEVycm9yQm91bmRhcnkgPSAvKiNfX1BVUkVfXyovZnVuY3Rpb24gKF9yZWFjdCRDb21wb25lbnQyKSB7X2luaGVyaXRzKEF3YWl0RXJyb3JCb3VuZGFyeSwgX3JlYWN0JENvbXBvbmVudDIpO3ZhciBfc3VwZXIzID0gX2NyZWF0ZVN1cGVyKEF3YWl0RXJyb3JCb3VuZGFyeSk7CiAgICAgICAgICAgIGZ1bmN0aW9uIEF3YWl0RXJyb3JCb3VuZGFyeShwcm9wcykge3ZhciBfdGhpczI7X2NsYXNzQ2FsbENoZWNrMih0aGlzLCBBd2FpdEVycm9yQm91bmRhcnkpOwogICAgICAgICAgICAgIF90aGlzMiA9IF9zdXBlcjMuY2FsbCh0aGlzLCBwcm9wcyk7CiAgICAgICAgICAgICAgX3RoaXMyLnN0YXRlID0gewogICAgICAgICAgICAgICAgZXJyb3I6IG51bGwKICAgICAgICAgICAgICB9O3JldHVybiBfdGhpczI7CiAgICAgICAgICAgIH1fY3JlYXRlQ2xhc3MyKEF3YWl0RXJyb3JCb3VuZGFyeSwgW3sga2V5OiAiY29tcG9uZW50RGlkQ2F0Y2giLCB2YWx1ZToKCgoKCgoKCiAgICAgICAgICAgICAgZnVuY3Rpb24gY29tcG9uZW50RGlkQ2F0Y2goZXJyb3IsIGVycm9ySW5mbykgewogICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcigiPEF3YWl0PiBjYXVnaHQgdGhlIGZvbGxvd2luZyBlcnJvciBkdXJpbmcgcmVuZGVyIiwgZXJyb3IsIGVycm9ySW5mbyk7CiAgICAgICAgICAgICAgfSB9LCB7IGtleTogInJlbmRlciIsIHZhbHVlOgoKICAgICAgICAgICAgICBmdW5jdGlvbiByZW5kZXIoKSB7CiAgICAgICAgICAgICAgICB2YXIgX3RoaXMkcHJvcHMgPQoKCgogICAgICAgICAgICAgICAgICB0aGlzLnByb3BzLGNoaWxkcmVuID0gX3RoaXMkcHJvcHMuY2hpbGRyZW4sZXJyb3JFbGVtZW50ID0gX3RoaXMkcHJvcHMuZXJyb3JFbGVtZW50LHJlc29sdmUgPSBfdGhpcyRwcm9wcy5yZXNvbHZlOwogICAgICAgICAgICAgICAgdmFyIHByb21pc2UgPSBudWxsOwogICAgICAgICAgICAgICAgdmFyIHN0YXR1cyA9IEF3YWl0UmVuZGVyU3RhdHVzLnBlbmRpbmc7CgogICAgICAgICAgICAgICAgaWYgKCEocmVzb2x2ZSBpbnN0YW5jZW9mIFByb21pc2UpKSB7CiAgICAgICAgICAgICAgICAgIC8vIERpZG4ndCBnZXQgYSBwcm9taXNlIC0gcHJvdmlkZSBhcyBhIHJlc29sdmVkIHByb21pc2UKICAgICAgICAgICAgICAgICAgc3RhdHVzID0gQXdhaXRSZW5kZXJTdGF0dXMuc3VjY2VzczsKICAgICAgICAgICAgICAgICAgcHJvbWlzZSA9IFByb21pc2UucmVzb2x2ZSgpOwogICAgICAgICAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkocHJvbWlzZSwgIl90cmFja2VkIiwgewogICAgICAgICAgICAgICAgICAgIGdldDogKCkgPT4gdHJ1ZQogICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHByb21pc2UsICJfZGF0YSIsIHsKICAgICAgICAgICAgICAgICAgICBnZXQ6ICgpID0+IHJlc29sdmUKICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHRoaXMuc3RhdGUuZXJyb3IpIHsKICAgICAgICAgICAgICAgICAgLy8gQ2F1Z2h0IGEgcmVuZGVyIGVycm9yLCBwcm92aWRlIGl0IGFzIGEgcmVqZWN0ZWQgcHJvbWlzZQogICAgICAgICAgICAgICAgICBzdGF0dXMgPSBBd2FpdFJlbmRlclN0YXR1cy5lcnJvcjsKICAgICAgICAgICAgICAgICAgdmFyIHJlbmRlckVycm9yID0gdGhpcy5zdGF0ZS5lcnJvcjsKICAgICAgICAgICAgICAgICAgcHJvbWlzZSA9IFByb21pc2UucmVqZWN0KCkuY2F0Y2goKCkgPT4ge30pOyAvLyBBdm9pZCB1bmhhbmRsZWQgcmVqZWN0aW9uIHdhcm5pbmdzCgogICAgICAgICAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkocHJvbWlzZSwgIl90cmFja2VkIiwgewogICAgICAgICAgICAgICAgICAgIGdldDogKCkgPT4gdHJ1ZQogICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHByb21pc2UsICJfZXJyb3IiLCB7CiAgICAgICAgICAgICAgICAgICAgZ2V0OiAoKSA9PiByZW5kZXJFcnJvcgogICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAocmVzb2x2ZS5fdHJhY2tlZCkgewogICAgICAgICAgICAgICAgICAvLyBBbHJlYWR5IHRyYWNrZWQgcHJvbWlzZSAtIGNoZWNrIGNvbnRlbnRzCiAgICAgICAgICAgICAgICAgIHByb21pc2UgPSByZXNvbHZlOwogICAgICAgICAgICAgICAgICBzdGF0dXMgPSBwcm9taXNlLl9lcnJvciAhPT0gdW5kZWZpbmVkID8gQXdhaXRSZW5kZXJTdGF0dXMuZXJyb3IgOiBwcm9taXNlLl9kYXRhICE9PSB1bmRlZmluZWQgPyBBd2FpdFJlbmRlclN0YXR1cy5zdWNjZXNzIDogQXdhaXRSZW5kZXJTdGF0dXMucGVuZGluZzsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgIC8vIFJhdyAodW50cmFja2VkKSBwcm9taXNlIC0gdHJhY2sgaXQKICAgICAgICAgICAgICAgICAgc3RhdHVzID0gQXdhaXRSZW5kZXJTdGF0dXMucGVuZGluZzsKICAgICAgICAgICAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHJlc29sdmUsICJfdHJhY2tlZCIsIHsKICAgICAgICAgICAgICAgICAgICBnZXQ6ICgpID0+IHRydWUKICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgIHByb21pc2UgPSByZXNvbHZlLnRoZW4oKGRhdGEpID0+IE9iamVjdC5kZWZpbmVQcm9wZXJ0eShyZXNvbHZlLCAiX2RhdGEiLCB7CiAgICAgICAgICAgICAgICAgICAgZ2V0OiAoKSA9PiBkYXRhCiAgICAgICAgICAgICAgICAgIH0pLCAoZXJyb3IpID0+IE9iamVjdC5kZWZpbmVQcm9wZXJ0eShyZXNvbHZlLCAiX2Vycm9yIiwgewogICAgICAgICAgICAgICAgICAgIGdldDogKCkgPT4gZXJyb3IKICAgICAgICAgICAgICAgICAgfSkpOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGlmIChzdGF0dXMgPT09IEF3YWl0UmVuZGVyU3RhdHVzLmVycm9yICYmIHByb21pc2UuX2Vycm9yIGluc3RhbmNlb2YgQWJvcnRlZERlZmVycmVkRXJyb3IpIHsKICAgICAgICAgICAgICAgICAgLy8gRnJlZXplIHRoZSBVSSBieSB0aHJvd2luZyBhIG5ldmVyIHJlc29sdmVkIHByb21pc2UKICAgICAgICAgICAgICAgICAgdGhyb3cgbmV2ZXJTZXR0bGVkUHJvbWlzZTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBpZiAoc3RhdHVzID09PSBBd2FpdFJlbmRlclN0YXR1cy5lcnJvciAmJiAhZXJyb3JFbGVtZW50KSB7CiAgICAgICAgICAgICAgICAgIC8vIE5vIGVycm9yRWxlbWVudCwgdGhyb3cgdG8gdGhlIG5lYXJlc3Qgcm91dGUtbGV2ZWwgZXJyb3IgYm91bmRhcnkKICAgICAgICAgICAgICAgICAgdGhyb3cgcHJvbWlzZS5fZXJyb3I7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgaWYgKHN0YXR1cyA9PT0gQXdhaXRSZW5kZXJTdGF0dXMuZXJyb3IpIHsKICAgICAgICAgICAgICAgICAgLy8gUmVuZGVyIHZpYSBvdXIgZXJyb3JFbGVtZW50CiAgICAgICAgICAgICAgICAgIHJldHVybiAvKiNfX1BVUkVfXyovUmVhY3QuY3JlYXRlRWxlbWVudChBd2FpdENvbnRleHQuUHJvdmlkZXIsIHsKICAgICAgICAgICAgICAgICAgICB2YWx1ZTogcHJvbWlzZSwKICAgICAgICAgICAgICAgICAgICBjaGlsZHJlbjogZXJyb3JFbGVtZW50CiAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGlmIChzdGF0dXMgPT09IEF3YWl0UmVuZGVyU3RhdHVzLnN1Y2Nlc3MpIHsKICAgICAgICAgICAgICAgICAgLy8gUmVuZGVyIGNoaWxkcmVuIHdpdGggcmVzb2x2ZWQgdmFsdWUKICAgICAgICAgICAgICAgICAgcmV0dXJuIC8qI19fUFVSRV9fKi9SZWFjdC5jcmVhdGVFbGVtZW50KEF3YWl0Q29udGV4dC5Qcm92aWRlciwgewogICAgICAgICAgICAgICAgICAgIHZhbHVlOiBwcm9taXNlLAogICAgICAgICAgICAgICAgICAgIGNoaWxkcmVuOiBjaGlsZHJlbgogICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0gLy8gVGhyb3cgdG8gdGhlIHN1c3BlbnNlIGJvdW5kYXJ5CgoKICAgICAgICAgICAgICAgIHRocm93IHByb21pc2U7CiAgICAgICAgICAgICAgfSB9XSwgW3sga2V5OiAiZ2V0RGVyaXZlZFN0YXRlRnJvbUVycm9yIiwgdmFsdWU6IGZ1bmN0aW9uIGdldERlcml2ZWRTdGF0ZUZyb21FcnJvcihlcnJvcikge3JldHVybiB7IGVycm9yOiBlcnJvciB9O30gfV0pO3JldHVybiBBd2FpdEVycm9yQm91bmRhcnk7fShyZWFjdC5Db21wb25lbnQpOwoKCiAgICAgICAgICAvKioKICAgICAgICAgICAqIEBwcml2YXRlCiAgICAgICAgICAgKiBJbmRpcmVjdGlvbiB0byBsZXZlcmFnZSB1c2VBc3luY1ZhbHVlIGZvciBhIHJlbmRlci1wcm9wIEFQSSBvbiA8QXdhaXQ+CiAgICAgICAgICAgKi8KCgogICAgICAgICAgZnVuY3Rpb24gUmVzb2x2ZUF3YWl0KF9yZWY3KSB7CiAgICAgICAgICAgIHZhcgogICAgICAgICAgICBjaGlsZHJlbiA9CiAgICAgICAgICAgIF9yZWY3LmNoaWxkcmVuOwogICAgICAgICAgICB2YXIgZGF0YSA9IHVzZUFzeW5jVmFsdWUoKTsKICAgICAgICAgICAgdmFyIHRvUmVuZGVyID0gdHlwZW9mIGNoaWxkcmVuID09PSAiZnVuY3Rpb24iID8gY2hpbGRyZW4oZGF0YSkgOiBjaGlsZHJlbjsKICAgICAgICAgICAgcmV0dXJuIC8qI19fUFVSRV9fKi9SZWFjdC5jcmVhdGVFbGVtZW50KFJlYWN0LkZyYWdtZW50LCBudWxsLCB0b1JlbmRlcik7CiAgICAgICAgICB9IC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KICAgICAgICAgIC8vIFVUSUxTCiAgICAgICAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCgogICAgICAgICAgLyoqCiAgICAgICAgICAgKiBDcmVhdGVzIGEgcm91dGUgY29uZmlnIGZyb20gYSBSZWFjdCAiY2hpbGRyZW4iIG9iamVjdCwgd2hpY2ggaXMgdXN1YWxseQogICAgICAgICAgICogZWl0aGVyIGEgYDxSb3V0ZT5gIGVsZW1lbnQgb3IgYW4gYXJyYXkgb2YgdGhlbS4gVXNlZCBpbnRlcm5hbGx5IGJ5CiAgICAgICAgICAgKiBgPFJvdXRlcz5gIHRvIGNyZWF0ZSBhIHJvdXRlIGNvbmZpZyBmcm9tIGl0cyBjaGlsZHJlbi4KICAgICAgICAgICAqCiAgICAgICAgICAgKiBAc2VlIGh0dHBzOi8vcmVhY3Ryb3V0ZXIuY29tL3V0aWxzL2NyZWF0ZS1yb3V0ZXMtZnJvbS1jaGlsZHJlbgogICAgICAgICAgICovCgoKICAgICAgICAgIGZ1bmN0aW9uIGNyZWF0ZVJvdXRlc0Zyb21DaGlsZHJlbihjaGlsZHJlbiwgcGFyZW50UGF0aCkgewogICAgICAgICAgICBpZiAocGFyZW50UGF0aCA9PT0gdm9pZCAwKSB7CiAgICAgICAgICAgICAgcGFyZW50UGF0aCA9IFtdOwogICAgICAgICAgICB9CgogICAgICAgICAgICB2YXIgcm91dGVzID0gW107CiAgICAgICAgICAgIHJlYWN0LkNoaWxkcmVuLmZvckVhY2goY2hpbGRyZW4sIChlbGVtZW50LCBpbmRleCkgPT4gewogICAgICAgICAgICAgIGlmICghIC8qI19fUFVSRV9fKi9yZWFjdC5pc1ZhbGlkRWxlbWVudChlbGVtZW50KSkgewogICAgICAgICAgICAgICAgLy8gSWdub3JlIG5vbi1lbGVtZW50cy4gVGhpcyBhbGxvd3MgcGVvcGxlIHRvIG1vcmUgZWFzaWx5IGlubGluZQogICAgICAgICAgICAgICAgLy8gY29uZGl0aW9uYWxzIGluIHRoZWlyIHJvdXRlIGNvbmZpZy4KICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIGlmIChlbGVtZW50LnR5cGUgPT09IHJlYWN0LkZyYWdtZW50KSB7CiAgICAgICAgICAgICAgICAvLyBUcmFuc3BhcmVudGx5IHN1cHBvcnQgUmVhY3QuRnJhZ21lbnQgYW5kIGl0cyBjaGlsZHJlbi4KICAgICAgICAgICAgICAgIHJvdXRlcy5wdXNoLmFwcGx5KHJvdXRlcywgY3JlYXRlUm91dGVzRnJvbUNoaWxkcmVuKGVsZW1lbnQucHJvcHMuY2hpbGRyZW4sIHBhcmVudFBhdGgpKTsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICEoZWxlbWVudC50eXBlID09PSBSb3V0ZSkgPyBmYWxzZSA/IDAgOiByb3V0ZXJfaW52YXJpYW50KGZhbHNlKSA6IHZvaWQgMDsKICAgICAgICAgICAgICAhKCFlbGVtZW50LnByb3BzLmluZGV4IHx8ICFlbGVtZW50LnByb3BzLmNoaWxkcmVuKSA/IGZhbHNlID8gMCA6IHJvdXRlcl9pbnZhcmlhbnQoZmFsc2UpIDogdm9pZCAwOwogICAgICAgICAgICAgIHZhciB0cmVlUGF0aCA9IFtdLmNvbmNhdChfdG9Db25zdW1hYmxlQXJyYXkyKHBhcmVudFBhdGgpLCBbaW5kZXhdKTsKICAgICAgICAgICAgICB2YXIgcm91dGUgPSB7CiAgICAgICAgICAgICAgICBpZDogZWxlbWVudC5wcm9wcy5pZCB8fCB0cmVlUGF0aC5qb2luKCItIiksCiAgICAgICAgICAgICAgICBjYXNlU2Vuc2l0aXZlOiBlbGVtZW50LnByb3BzLmNhc2VTZW5zaXRpdmUsCiAgICAgICAgICAgICAgICBlbGVtZW50OiBlbGVtZW50LnByb3BzLmVsZW1lbnQsCiAgICAgICAgICAgICAgICBpbmRleDogZWxlbWVudC5wcm9wcy5pbmRleCwKICAgICAgICAgICAgICAgIHBhdGg6IGVsZW1lbnQucHJvcHMucGF0aCwKICAgICAgICAgICAgICAgIGxvYWRlcjogZWxlbWVudC5wcm9wcy5sb2FkZXIsCiAgICAgICAgICAgICAgICBhY3Rpb246IGVsZW1lbnQucHJvcHMuYWN0aW9uLAogICAgICAgICAgICAgICAgZXJyb3JFbGVtZW50OiBlbGVtZW50LnByb3BzLmVycm9yRWxlbWVudCwKICAgICAgICAgICAgICAgIGhhc0Vycm9yQm91bmRhcnk6IGVsZW1lbnQucHJvcHMuZXJyb3JFbGVtZW50ICE9IG51bGwsCiAgICAgICAgICAgICAgICBzaG91bGRSZXZhbGlkYXRlOiBlbGVtZW50LnByb3BzLnNob3VsZFJldmFsaWRhdGUsCiAgICAgICAgICAgICAgICBoYW5kbGU6IGVsZW1lbnQucHJvcHMuaGFuZGxlCiAgICAgICAgICAgICAgfTsKCiAgICAgICAgICAgICAgaWYgKGVsZW1lbnQucHJvcHMuY2hpbGRyZW4pIHsKICAgICAgICAgICAgICAgIHJvdXRlLmNoaWxkcmVuID0gY3JlYXRlUm91dGVzRnJvbUNoaWxkcmVuKGVsZW1lbnQucHJvcHMuY2hpbGRyZW4sIHRyZWVQYXRoKTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIHJvdXRlcy5wdXNoKHJvdXRlKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIHJldHVybiByb3V0ZXM7CiAgICAgICAgICB9CiAgICAgICAgICAvKioKICAgICAgICAgICAqIFJlbmRlcnMgdGhlIHJlc3VsdCBvZiBgbWF0Y2hSb3V0ZXMoKWAgaW50byBhIFJlYWN0IGVsZW1lbnQuCiAgICAgICAgICAgKi8KCiAgICAgICAgICBmdW5jdGlvbiByZW5kZXJNYXRjaGVzKG1hdGNoZXMpIHsKICAgICAgICAgICAgcmV0dXJuIF9yZW5kZXJNYXRjaGVzKG1hdGNoZXMpOwogICAgICAgICAgfQogICAgICAgICAgLyoqCiAgICAgICAgICAgKiBAcHJpdmF0ZQogICAgICAgICAgICogV2FsayB0aGUgcm91dGUgdHJlZSBhbmQgYWRkIGhhc0Vycm9yQm91bmRhcnkgaWYgaXQncyBub3QgcHJvdmlkZWQsIHNvIHRoYXQKICAgICAgICAgICAqIHVzZXJzIHByb3ZpZGluZyBtYW51YWwgcm91dGUgYXJyYXlzIGNhbiBqdXN0IHNwZWNpZnkgZXJyb3JFbGVtZW50CiAgICAgICAgICAgKi8KCiAgICAgICAgICBmdW5jdGlvbiBlbmhhbmNlTWFudWFsUm91dGVPYmplY3RzKHJvdXRlcykgewogICAgICAgICAgICByZXR1cm4gcm91dGVzLm1hcCgocm91dGUpID0+IHsKICAgICAgICAgICAgICB2YXIgcm91dGVDbG9uZSA9IGRpc3RfZXh0ZW5kcyh7fSwgcm91dGUpOwoKICAgICAgICAgICAgICBpZiAocm91dGVDbG9uZS5oYXNFcnJvckJvdW5kYXJ5ID09IG51bGwpIHsKICAgICAgICAgICAgICAgIHJvdXRlQ2xvbmUuaGFzRXJyb3JCb3VuZGFyeSA9IHJvdXRlQ2xvbmUuZXJyb3JFbGVtZW50ICE9IG51bGw7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBpZiAocm91dGVDbG9uZS5jaGlsZHJlbikgewogICAgICAgICAgICAgICAgcm91dGVDbG9uZS5jaGlsZHJlbiA9IGVuaGFuY2VNYW51YWxSb3V0ZU9iamVjdHMocm91dGVDbG9uZS5jaGlsZHJlbik7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICByZXR1cm4gcm91dGVDbG9uZTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9CgogICAgICAgICAgZnVuY3Rpb24gY3JlYXRlTWVtb3J5Um91dGVyKHJvdXRlcywgb3B0cykgewogICAgICAgICAgICByZXR1cm4gY3JlYXRlUm91dGVyKHsKICAgICAgICAgICAgICBiYXNlbmFtZTogb3B0cyA9PSBudWxsID8gdm9pZCAwIDogb3B0cy5iYXNlbmFtZSwKICAgICAgICAgICAgICBoaXN0b3J5OiBjcmVhdGVNZW1vcnlIaXN0b3J5KHsKICAgICAgICAgICAgICAgIGluaXRpYWxFbnRyaWVzOiBvcHRzID09IG51bGwgPyB2b2lkIDAgOiBvcHRzLmluaXRpYWxFbnRyaWVzLAogICAgICAgICAgICAgICAgaW5pdGlhbEluZGV4OiBvcHRzID09IG51bGwgPyB2b2lkIDAgOiBvcHRzLmluaXRpYWxJbmRleAogICAgICAgICAgICAgIH0pLAogICAgICAgICAgICAgIGh5ZHJhdGlvbkRhdGE6IG9wdHMgPT0gbnVsbCA/IHZvaWQgMCA6IG9wdHMuaHlkcmF0aW9uRGF0YSwKICAgICAgICAgICAgICByb3V0ZXM6IGVuaGFuY2VNYW51YWxSb3V0ZU9iamVjdHMocm91dGVzKQogICAgICAgICAgICB9KS5pbml0aWFsaXplKCk7CiAgICAgICAgICB9IC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KCgoKCiAgICAgICAgICA7IC8vIENPTkNBVEVOQVRFRCBNT0RVTEU6IC4vbm9kZV9tb2R1bGVzL3JlYWN0LXJvdXRlci1kb20vZGlzdC9pbmRleC5qcwogICAgICAgICAgLyoqCiAgICAgICAgICAgKiBSZWFjdCBSb3V0ZXIgRE9NIHY2LjguMAogICAgICAgICAgICoKICAgICAgICAgICAqIENvcHlyaWdodCAoYykgUmVtaXggU29mdHdhcmUgSW5jLgogICAgICAgICAgICoKICAgICAgICAgICAqIFRoaXMgc291cmNlIGNvZGUgaXMgbGljZW5zZWQgdW5kZXIgdGhlIE1JVCBsaWNlbnNlIGZvdW5kIGluIHRoZQogICAgICAgICAgICogTElDRU5TRS5tZCBmaWxlIGluIHRoZSByb290IGRpcmVjdG9yeSBvZiB0aGlzIHNvdXJjZSB0cmVlLgogICAgICAgICAgICoKICAgICAgICAgICAqIEBsaWNlbnNlIE1JVAogICAgICAgICAgICovCgoKCgoKICAgICAgICAgIGZ1bmN0aW9uIHJlYWN0X3JvdXRlcl9kb21fZGlzdF9leHRlbmRzKCkgewogICAgICAgICAgICByZWFjdF9yb3V0ZXJfZG9tX2Rpc3RfZXh0ZW5kcyA9IE9iamVjdC5hc3NpZ24gPyBPYmplY3QuYXNzaWduLmJpbmQoKSA6IGZ1bmN0aW9uICh0YXJnZXQpIHsKICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMTsgaSA8IGFyZ3VtZW50cy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAgdmFyIHNvdXJjZSA9IGFyZ3VtZW50c1tpXTsKCiAgICAgICAgICAgICAgICBmb3IgKHZhciBrZXkgaW4gc291cmNlKSB7CiAgICAgICAgICAgICAgICAgIGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoc291cmNlLCBrZXkpKSB7CiAgICAgICAgICAgICAgICAgICAgdGFyZ2V0W2tleV0gPSBzb3VyY2Vba2V5XTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgcmV0dXJuIHRhcmdldDsKICAgICAgICAgICAgfTsKICAgICAgICAgICAgcmV0dXJuIHJlYWN0X3JvdXRlcl9kb21fZGlzdF9leHRlbmRzLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgICAgICB9CgogICAgICAgICAgZnVuY3Rpb24gX29iamVjdFdpdGhvdXRQcm9wZXJ0aWVzTG9vc2Uoc291cmNlLCBleGNsdWRlZCkgewogICAgICAgICAgICBpZiAoc291cmNlID09IG51bGwpIHJldHVybiB7fTsKICAgICAgICAgICAgdmFyIHRhcmdldCA9IHt9OwogICAgICAgICAgICB2YXIgc291cmNlS2V5cyA9IE9iamVjdC5rZXlzKHNvdXJjZSk7CiAgICAgICAgICAgIHZhciBrZXksIGk7CgogICAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgc291cmNlS2V5cy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgIGtleSA9IHNvdXJjZUtleXNbaV07CiAgICAgICAgICAgICAgaWYgKGV4Y2x1ZGVkLmluZGV4T2Yoa2V5KSA+PSAwKSBjb250aW51ZTsKICAgICAgICAgICAgICB0YXJnZXRba2V5XSA9IHNvdXJjZVtrZXldOwogICAgICAgICAgICB9CgogICAgICAgICAgICByZXR1cm4gdGFyZ2V0OwogICAgICAgICAgfQoKICAgICAgICAgIHZhciBkZWZhdWx0TWV0aG9kID0gImdldCI7CiAgICAgICAgICB2YXIgZGVmYXVsdEVuY1R5cGUgPSAiYXBwbGljYXRpb24veC13d3ctZm9ybS11cmxlbmNvZGVkIjsKICAgICAgICAgIGZ1bmN0aW9uIGlzSHRtbEVsZW1lbnQob2JqZWN0KSB7CiAgICAgICAgICAgIHJldHVybiBvYmplY3QgIT0gbnVsbCAmJiB0eXBlb2Ygb2JqZWN0LnRhZ05hbWUgPT09ICJzdHJpbmciOwogICAgICAgICAgfQogICAgICAgICAgZnVuY3Rpb24gaXNCdXR0b25FbGVtZW50KG9iamVjdCkgewogICAgICAgICAgICByZXR1cm4gaXNIdG1sRWxlbWVudChvYmplY3QpICYmIG9iamVjdC50YWdOYW1lLnRvTG93ZXJDYXNlKCkgPT09ICJidXR0b24iOwogICAgICAgICAgfQogICAgICAgICAgZnVuY3Rpb24gaXNGb3JtRWxlbWVudChvYmplY3QpIHsKICAgICAgICAgICAgcmV0dXJuIGlzSHRtbEVsZW1lbnQob2JqZWN0KSAmJiBvYmplY3QudGFnTmFtZS50b0xvd2VyQ2FzZSgpID09PSAiZm9ybSI7CiAgICAgICAgICB9CiAgICAgICAgICBmdW5jdGlvbiBpc0lucHV0RWxlbWVudChvYmplY3QpIHsKICAgICAgICAgICAgcmV0dXJuIGlzSHRtbEVsZW1lbnQob2JqZWN0KSAmJiBvYmplY3QudGFnTmFtZS50b0xvd2VyQ2FzZSgpID09PSAiaW5wdXQiOwogICAgICAgICAgfQoKICAgICAgICAgIGZ1bmN0aW9uIGlzTW9kaWZpZWRFdmVudChldmVudCkgewogICAgICAgICAgICByZXR1cm4gISEoZXZlbnQubWV0YUtleSB8fCBldmVudC5hbHRLZXkgfHwgZXZlbnQuY3RybEtleSB8fCBldmVudC5zaGlmdEtleSk7CiAgICAgICAgICB9CgogICAgICAgICAgZnVuY3Rpb24gc2hvdWxkUHJvY2Vzc0xpbmtDbGljayhldmVudCwgdGFyZ2V0KSB7CiAgICAgICAgICAgIHJldHVybiBldmVudC5idXR0b24gPT09IDAgJiYgKCAvLyBJZ25vcmUgZXZlcnl0aGluZyBidXQgbGVmdCBjbGlja3MKICAgICAgICAgICAgIXRhcmdldCB8fCB0YXJnZXQgPT09ICJfc2VsZiIpICYmIC8vIExldCBicm93c2VyIGhhbmRsZSAidGFyZ2V0PV9ibGFuayIgZXRjLgogICAgICAgICAgICAhaXNNb2RpZmllZEV2ZW50KGV2ZW50KSAvLyBJZ25vcmUgY2xpY2tzIHdpdGggbW9kaWZpZXIga2V5cwogICAgICAgICAgICA7CiAgICAgICAgICB9CiAgICAgICAgICAvKioKICAgICAgICAgICAqIENyZWF0ZXMgYSBVUkxTZWFyY2hQYXJhbXMgb2JqZWN0IHVzaW5nIHRoZSBnaXZlbiBpbml0aWFsaXplci4KICAgICAgICAgICAqCiAgICAgICAgICAgKiBUaGlzIGlzIGlkZW50aWNhbCB0byBgbmV3IFVSTFNlYXJjaFBhcmFtcyhpbml0KWAgZXhjZXB0IGl0IGFsc28KICAgICAgICAgICAqIHN1cHBvcnRzIGFycmF5cyBhcyB2YWx1ZXMgaW4gdGhlIG9iamVjdCBmb3JtIG9mIHRoZSBpbml0aWFsaXplcgogICAgICAgICAgICogaW5zdGVhZCBvZiBqdXN0IHN0cmluZ3MuIFRoaXMgaXMgY29udmVuaWVudCB3aGVuIHlvdSBuZWVkIG11bHRpcGxlCiAgICAgICAgICAgKiB2YWx1ZXMgZm9yIGEgZ2l2ZW4ga2V5LCBidXQgZG9uJ3Qgd2FudCB0byB1c2UgYW4gYXJyYXkgaW5pdGlhbGl6ZXIuCiAgICAgICAgICAgKgogICAgICAgICAgICogRm9yIGV4YW1wbGUsIGluc3RlYWQgb2Y6CiAgICAgICAgICAgKgogICAgICAgICAgICogICBsZXQgc2VhcmNoUGFyYW1zID0gbmV3IFVSTFNlYXJjaFBhcmFtcyhbCiAgICAgICAgICAgKiAgICAgWydzb3J0JywgJ25hbWUnXSwKICAgICAgICAgICAqICAgICBbJ3NvcnQnLCAncHJpY2UnXQogICAgICAgICAgICogICBdKTsKICAgICAgICAgICAqCiAgICAgICAgICAgKiB5b3UgY2FuIGRvOgogICAgICAgICAgICoKICAgICAgICAgICAqICAgbGV0IHNlYXJjaFBhcmFtcyA9IGNyZWF0ZVNlYXJjaFBhcmFtcyh7CiAgICAgICAgICAgKiAgICAgc29ydDogWyduYW1lJywgJ3ByaWNlJ10KICAgICAgICAgICAqICAgfSk7CiAgICAgICAgICAgKi8KCiAgICAgICAgICBmdW5jdGlvbiBjcmVhdGVTZWFyY2hQYXJhbXMoaW5pdCkgewogICAgICAgICAgICBpZiAoaW5pdCA9PT0gdm9pZCAwKSB7CiAgICAgICAgICAgICAgaW5pdCA9ICIiOwogICAgICAgICAgICB9CgogICAgICAgICAgICByZXR1cm4gbmV3IFVSTFNlYXJjaFBhcmFtcyh0eXBlb2YgaW5pdCA9PT0gInN0cmluZyIgfHwgQXJyYXkuaXNBcnJheShpbml0KSB8fCBpbml0IGluc3RhbmNlb2YgVVJMU2VhcmNoUGFyYW1zID8gaW5pdCA6IE9iamVjdC5rZXlzKGluaXQpLnJlZHVjZSgobWVtbywga2V5KSA9PiB7CiAgICAgICAgICAgICAgdmFyIHZhbHVlID0gaW5pdFtrZXldOwogICAgICAgICAgICAgIHJldHVybiBtZW1vLmNvbmNhdChBcnJheS5pc0FycmF5KHZhbHVlKSA/IHZhbHVlLm1hcCgodikgPT4gW2tleSwgdl0pIDogW1trZXksIHZhbHVlXV0pOwogICAgICAgICAgICB9LCBbXSkpOwogICAgICAgICAgfQogICAgICAgICAgZnVuY3Rpb24gZ2V0U2VhcmNoUGFyYW1zRm9yTG9jYXRpb24obG9jYXRpb25TZWFyY2gsIGRlZmF1bHRTZWFyY2hQYXJhbXMpIHsKICAgICAgICAgICAgdmFyIHNlYXJjaFBhcmFtcyA9IGNyZWF0ZVNlYXJjaFBhcmFtcyhsb2NhdGlvblNlYXJjaCk7CgogICAgICAgICAgICBpZiAoZGVmYXVsdFNlYXJjaFBhcmFtcykge3ZhciBfaXRlcmF0b3IxMCA9IF9jcmVhdGVGb3JPZkl0ZXJhdG9ySGVscGVyMigKICAgICAgICAgICAgICAgIGRlZmF1bHRTZWFyY2hQYXJhbXMua2V5cygpKSxfc3RlcDEwO3RyeSB7dmFyIF9sb29wID0gZnVuY3Rpb24gX2xvb3AoKSB7dmFyIGtleSA9IF9zdGVwMTAudmFsdWU7CiAgICAgICAgICAgICAgICAgIGlmICghc2VhcmNoUGFyYW1zLmhhcyhrZXkpKSB7CiAgICAgICAgICAgICAgICAgICAgZGVmYXVsdFNlYXJjaFBhcmFtcy5nZXRBbGwoa2V5KS5mb3JFYWNoKCh2YWx1ZSkgPT4gewogICAgICAgICAgICAgICAgICAgICAgc2VhcmNoUGFyYW1zLmFwcGVuZChrZXksIHZhbHVlKTsKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfTtmb3IgKF9pdGVyYXRvcjEwLnMoKTsgIShfc3RlcDEwID0gX2l0ZXJhdG9yMTAubigpKS5kb25lOykge19sb29wKCk7fX0gY2F0Y2ggKGVycikge19pdGVyYXRvcjEwLmUoZXJyKTt9IGZpbmFsbHkge19pdGVyYXRvcjEwLmYoKTt9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybiBzZWFyY2hQYXJhbXM7CiAgICAgICAgICB9CiAgICAgICAgICBmdW5jdGlvbiBnZXRGb3JtU3VibWlzc2lvbkluZm8odGFyZ2V0LCBkZWZhdWx0QWN0aW9uLCBvcHRpb25zKSB7CiAgICAgICAgICAgIHZhciBtZXRob2Q7CiAgICAgICAgICAgIHZhciBhY3Rpb247CiAgICAgICAgICAgIHZhciBlbmNUeXBlOwogICAgICAgICAgICB2YXIgZm9ybURhdGE7CgogICAgICAgICAgICBpZiAoaXNGb3JtRWxlbWVudCh0YXJnZXQpKSB7CiAgICAgICAgICAgICAgdmFyIHN1Ym1pc3Npb25UcmlnZ2VyID0gb3B0aW9ucy5zdWJtaXNzaW9uVHJpZ2dlcjsKICAgICAgICAgICAgICBtZXRob2QgPSBvcHRpb25zLm1ldGhvZCB8fCB0YXJnZXQuZ2V0QXR0cmlidXRlKCJtZXRob2QiKSB8fCBkZWZhdWx0TWV0aG9kOwogICAgICAgICAgICAgIGFjdGlvbiA9IG9wdGlvbnMuYWN0aW9uIHx8IHRhcmdldC5nZXRBdHRyaWJ1dGUoImFjdGlvbiIpIHx8IGRlZmF1bHRBY3Rpb247CiAgICAgICAgICAgICAgZW5jVHlwZSA9IG9wdGlvbnMuZW5jVHlwZSB8fCB0YXJnZXQuZ2V0QXR0cmlidXRlKCJlbmN0eXBlIikgfHwgZGVmYXVsdEVuY1R5cGU7CiAgICAgICAgICAgICAgZm9ybURhdGEgPSBuZXcgRm9ybURhdGEodGFyZ2V0KTsKCiAgICAgICAgICAgICAgaWYgKHN1Ym1pc3Npb25UcmlnZ2VyICYmIHN1Ym1pc3Npb25UcmlnZ2VyLm5hbWUpIHsKICAgICAgICAgICAgICAgIGZvcm1EYXRhLmFwcGVuZChzdWJtaXNzaW9uVHJpZ2dlci5uYW1lLCBzdWJtaXNzaW9uVHJpZ2dlci52YWx1ZSk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2UgaWYgKGlzQnV0dG9uRWxlbWVudCh0YXJnZXQpIHx8IGlzSW5wdXRFbGVtZW50KHRhcmdldCkgJiYgKHRhcmdldC50eXBlID09PSAic3VibWl0IiB8fCB0YXJnZXQudHlwZSA9PT0gImltYWdlIikpIHsKICAgICAgICAgICAgICB2YXIgZm9ybSA9IHRhcmdldC5mb3JtOwoKICAgICAgICAgICAgICBpZiAoZm9ybSA9PSBudWxsKSB7CiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIkNhbm5vdCBzdWJtaXQgYSA8YnV0dG9uPiBvciA8aW5wdXQgdHlwZT1cInN1Ym1pdFwiPiB3aXRob3V0IGEgPGZvcm0+Iik7CiAgICAgICAgICAgICAgfSAvLyA8YnV0dG9uPi88aW5wdXQgdHlwZT0ic3VibWl0Ij4gbWF5IG92ZXJyaWRlIGF0dHJpYnV0ZXMgb2YgPGZvcm0+CgoKICAgICAgICAgICAgICBtZXRob2QgPSBvcHRpb25zLm1ldGhvZCB8fCB0YXJnZXQuZ2V0QXR0cmlidXRlKCJmb3JtbWV0aG9kIikgfHwgZm9ybS5nZXRBdHRyaWJ1dGUoIm1ldGhvZCIpIHx8IGRlZmF1bHRNZXRob2Q7CiAgICAgICAgICAgICAgYWN0aW9uID0gb3B0aW9ucy5hY3Rpb24gfHwgdGFyZ2V0LmdldEF0dHJpYnV0ZSgiZm9ybWFjdGlvbiIpIHx8IGZvcm0uZ2V0QXR0cmlidXRlKCJhY3Rpb24iKSB8fCBkZWZhdWx0QWN0aW9uOwogICAgICAgICAgICAgIGVuY1R5cGUgPSBvcHRpb25zLmVuY1R5cGUgfHwgdGFyZ2V0LmdldEF0dHJpYnV0ZSgiZm9ybWVuY3R5cGUiKSB8fCBmb3JtLmdldEF0dHJpYnV0ZSgiZW5jdHlwZSIpIHx8IGRlZmF1bHRFbmNUeXBlOwogICAgICAgICAgICAgIGZvcm1EYXRhID0gbmV3IEZvcm1EYXRhKGZvcm0pOyAvLyBJbmNsdWRlIG5hbWUgKyB2YWx1ZSBmcm9tIGEgPGJ1dHRvbj4sIGFwcGVuZGluZyBpbiBjYXNlIHRoZSBidXR0b24gbmFtZQogICAgICAgICAgICAgIC8vIG1hdGNoZXMgYW4gZXhpc3RpbmcgaW5wdXQgbmFtZQoKICAgICAgICAgICAgICBpZiAodGFyZ2V0Lm5hbWUpIHsKICAgICAgICAgICAgICAgIGZvcm1EYXRhLmFwcGVuZCh0YXJnZXQubmFtZSwgdGFyZ2V0LnZhbHVlKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZWxzZSBpZiAoaXNIdG1sRWxlbWVudCh0YXJnZXQpKSB7CiAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJDYW5ub3Qgc3VibWl0IGVsZW1lbnQgdGhhdCBpcyBub3QgPGZvcm0+LCA8YnV0dG9uPiwgb3IgIiArICI8aW5wdXQgdHlwZT1cInN1Ym1pdHxpbWFnZVwiPiIpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIG1ldGhvZCA9IG9wdGlvbnMubWV0aG9kIHx8IGRlZmF1bHRNZXRob2Q7CiAgICAgICAgICAgICAgYWN0aW9uID0gb3B0aW9ucy5hY3Rpb24gfHwgZGVmYXVsdEFjdGlvbjsKICAgICAgICAgICAgICBlbmNUeXBlID0gb3B0aW9ucy5lbmNUeXBlIHx8IGRlZmF1bHRFbmNUeXBlOwoKICAgICAgICAgICAgICBpZiAodGFyZ2V0IGluc3RhbmNlb2YgRm9ybURhdGEpIHsKICAgICAgICAgICAgICAgIGZvcm1EYXRhID0gdGFyZ2V0OwogICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBmb3JtRGF0YSA9IG5ldyBGb3JtRGF0YSgpOwoKICAgICAgICAgICAgICAgIGlmICh0YXJnZXQgaW5zdGFuY2VvZiBVUkxTZWFyY2hQYXJhbXMpIHt2YXIgX2l0ZXJhdG9yMTEgPSBfY3JlYXRlRm9yT2ZJdGVyYXRvckhlbHBlcjIoCiAgICAgICAgICAgICAgICAgICAgdGFyZ2V0KSxfc3RlcDExO3RyeSB7Zm9yIChfaXRlcmF0b3IxMS5zKCk7ICEoX3N0ZXAxMSA9IF9pdGVyYXRvcjExLm4oKSkuZG9uZTspIHt2YXIgX3N0ZXAxMSR2YWx1ZSA9IF9zbGljZWRUb0FycmF5Mihfc3RlcDExLnZhbHVlLCAyKSxuYW1lID0gX3N0ZXAxMSR2YWx1ZVswXSx2YWx1ZSA9IF9zdGVwMTEkdmFsdWVbMV07CiAgICAgICAgICAgICAgICAgICAgICBmb3JtRGF0YS5hcHBlbmQobmFtZSwgdmFsdWUpOwogICAgICAgICAgICAgICAgICAgIH19IGNhdGNoIChlcnIpIHtfaXRlcmF0b3IxMS5lKGVycik7fSBmaW5hbGx5IHtfaXRlcmF0b3IxMS5mKCk7fQogICAgICAgICAgICAgICAgfSBlbHNlIGlmICh0YXJnZXQgIT0gbnVsbCkgewogICAgICAgICAgICAgICAgICBmb3IgKHZhciBfaTMgPSAwLCBfT2JqZWN0JGtleXMgPSBPYmplY3Qua2V5cyh0YXJnZXQpOyBfaTMgPCBfT2JqZWN0JGtleXMubGVuZ3RoOyBfaTMrKykge3ZhciBfbmFtZSA9IF9PYmplY3Qka2V5c1tfaTNdOwogICAgICAgICAgICAgICAgICAgIGZvcm1EYXRhLmFwcGVuZChfbmFtZSwgdGFyZ2V0W19uYW1lXSk7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHZhciBfd2luZG93JGxvY2F0aW9uMiA9CgoKICAgICAgICAgICAgICB3aW5kb3cubG9jYXRpb24scHJvdG9jb2wgPSBfd2luZG93JGxvY2F0aW9uMi5wcm90b2NvbCxob3N0ID0gX3dpbmRvdyRsb2NhdGlvbjIuaG9zdDsKICAgICAgICAgICAgdmFyIHVybCA9IG5ldyBVUkwoYWN0aW9uLCBwcm90b2NvbCArICIvLyIgKyBob3N0KTsKICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICB1cmw6IHVybCwKICAgICAgICAgICAgICBtZXRob2Q6IG1ldGhvZC50b0xvd2VyQ2FzZSgpLAogICAgICAgICAgICAgIGVuY1R5cGU6IGVuY1R5cGUsCiAgICAgICAgICAgICAgZm9ybURhdGE6IGZvcm1EYXRhCiAgICAgICAgICAgIH07CiAgICAgICAgICB9CgogICAgICAgICAgdmFyIF9leGNsdWRlZCA9IFsib25DbGljayIsICJyZWxhdGl2ZSIsICJyZWxvYWREb2N1bWVudCIsICJyZXBsYWNlIiwgInN0YXRlIiwgInRhcmdldCIsICJ0byIsICJwcmV2ZW50U2Nyb2xsUmVzZXQiXSwKICAgICAgICAgICAgX2V4Y2x1ZGVkMiA9IFsiYXJpYS1jdXJyZW50IiwgImNhc2VTZW5zaXRpdmUiLCAiY2xhc3NOYW1lIiwgImVuZCIsICJzdHlsZSIsICJ0byIsICJjaGlsZHJlbiJdLAogICAgICAgICAgICBfZXhjbHVkZWQzID0gLyogdW51c2VkIHB1cmUgZXhwcmVzc2lvbiBvciBzdXBlciAqL251bGwgJiYgWyJyZWxvYWREb2N1bWVudCIsICJyZXBsYWNlIiwgIm1ldGhvZCIsICJhY3Rpb24iLCAib25TdWJtaXQiLCAiZmV0Y2hlcktleSIsICJyb3V0ZUlkIiwgInJlbGF0aXZlIiwgInByZXZlbnRTY3JvbGxSZXNldCJdOwogICAgICAgICAgLy8jcmVnaW9uIFJvdXRlcnMKICAgICAgICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCgogICAgICAgICAgZnVuY3Rpb24gY3JlYXRlQnJvd3NlclJvdXRlcihyb3V0ZXMsIG9wdHMpIHsKICAgICAgICAgICAgcmV0dXJuIGNyZWF0ZVJvdXRlcih7CiAgICAgICAgICAgICAgYmFzZW5hbWU6IG9wdHMgPT0gbnVsbCA/IHZvaWQgMCA6IG9wdHMuYmFzZW5hbWUsCiAgICAgICAgICAgICAgaGlzdG9yeTogY3JlYXRlQnJvd3Nlckhpc3RvcnkoewogICAgICAgICAgICAgICAgd2luZG93OiBvcHRzID09IG51bGwgPyB2b2lkIDAgOiBvcHRzLndpbmRvdwogICAgICAgICAgICAgIH0pLAogICAgICAgICAgICAgIGh5ZHJhdGlvbkRhdGE6IChvcHRzID09IG51bGwgPyB2b2lkIDAgOiBvcHRzLmh5ZHJhdGlvbkRhdGEpIHx8IHBhcnNlSHlkcmF0aW9uRGF0YSgpLAogICAgICAgICAgICAgIHJvdXRlczogVU5TQUZFX2VuaGFuY2VNYW51YWxSb3V0ZU9iamVjdHMocm91dGVzKQogICAgICAgICAgICB9KS5pbml0aWFsaXplKCk7CiAgICAgICAgICB9CiAgICAgICAgICBmdW5jdGlvbiBjcmVhdGVIYXNoUm91dGVyKHJvdXRlcywgb3B0cykgewogICAgICAgICAgICByZXR1cm4gY3JlYXRlUm91dGVyKHsKICAgICAgICAgICAgICBiYXNlbmFtZTogb3B0cyA9PSBudWxsID8gdm9pZCAwIDogb3B0cy5iYXNlbmFtZSwKICAgICAgICAgICAgICBoaXN0b3J5OiBjcmVhdGVIYXNoSGlzdG9yeSh7CiAgICAgICAgICAgICAgICB3aW5kb3c6IG9wdHMgPT0gbnVsbCA/IHZvaWQgMCA6IG9wdHMud2luZG93CiAgICAgICAgICAgICAgfSksCiAgICAgICAgICAgICAgaHlkcmF0aW9uRGF0YTogKG9wdHMgPT0gbnVsbCA/IHZvaWQgMCA6IG9wdHMuaHlkcmF0aW9uRGF0YSkgfHwgcGFyc2VIeWRyYXRpb25EYXRhKCksCiAgICAgICAgICAgICAgcm91dGVzOiBVTlNBRkVfZW5oYW5jZU1hbnVhbFJvdXRlT2JqZWN0cyhyb3V0ZXMpCiAgICAgICAgICAgIH0pLmluaXRpYWxpemUoKTsKICAgICAgICAgIH0KCiAgICAgICAgICBmdW5jdGlvbiBwYXJzZUh5ZHJhdGlvbkRhdGEoKSB7CiAgICAgICAgICAgIHZhciBfd2luZG93OwoKICAgICAgICAgICAgdmFyIHN0YXRlID0gKF93aW5kb3cgPSB3aW5kb3cpID09IG51bGwgPyB2b2lkIDAgOiBfd2luZG93Ll9fc3RhdGljUm91dGVySHlkcmF0aW9uRGF0YTsKCiAgICAgICAgICAgIGlmIChzdGF0ZSAmJiBzdGF0ZS5lcnJvcnMpIHsKICAgICAgICAgICAgICBzdGF0ZSA9IHJlYWN0X3JvdXRlcl9kb21fZGlzdF9leHRlbmRzKHt9LCBzdGF0ZSwgewogICAgICAgICAgICAgICAgZXJyb3JzOiBkZXNlcmlhbGl6ZUVycm9ycyhzdGF0ZS5lcnJvcnMpCiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybiBzdGF0ZTsKICAgICAgICAgIH0KCiAgICAgICAgICBmdW5jdGlvbiBkZXNlcmlhbGl6ZUVycm9ycyhlcnJvcnMpIHsKICAgICAgICAgICAgaWYgKCFlcnJvcnMpIHJldHVybiBudWxsOwogICAgICAgICAgICB2YXIgZW50cmllcyA9IE9iamVjdC5lbnRyaWVzKGVycm9ycyk7CiAgICAgICAgICAgIHZhciBzZXJpYWxpemVkID0ge307CgogICAgICAgICAgICBmb3IgKHZhciBfaTQgPSAwLCBfZW50cmllcyA9IGVudHJpZXM7IF9pNCA8IF9lbnRyaWVzLmxlbmd0aDsgX2k0KyspIHt2YXIgX2VudHJpZXMkX2kgPSBfc2xpY2VkVG9BcnJheTIoX2VudHJpZXNbX2k0XSwgMiksa2V5ID0gX2VudHJpZXMkX2lbMF0sdmFsID0gX2VudHJpZXMkX2lbMV07CiAgICAgICAgICAgICAgLy8gSGV5IHlvdSEgIElmIHlvdSBjaGFuZ2UgdGhpcywgcGxlYXNlIGNoYW5nZSB0aGUgY29ycmVzcG9uZGluZyBsb2dpYyBpbgogICAgICAgICAgICAgIC8vIHNlcmlhbGl6ZUVycm9ycyBpbiByZWFjdC1yb3V0ZXItZG9tL3NlcnZlci50c3ggOikKICAgICAgICAgICAgICBpZiAodmFsICYmIHZhbC5fX3R5cGUgPT09ICJSb3V0ZUVycm9yUmVzcG9uc2UiKSB7CiAgICAgICAgICAgICAgICBzZXJpYWxpemVkW2tleV0gPSBuZXcgRXJyb3JSZXNwb25zZSh2YWwuc3RhdHVzLCB2YWwuc3RhdHVzVGV4dCwgdmFsLmRhdGEsIHZhbC5pbnRlcm5hbCA9PT0gdHJ1ZSk7CiAgICAgICAgICAgICAgfSBlbHNlIGlmICh2YWwgJiYgdmFsLl9fdHlwZSA9PT0gIkVycm9yIikgewogICAgICAgICAgICAgICAgdmFyIGVycm9yID0gbmV3IEVycm9yKHZhbC5tZXNzYWdlKTsgLy8gV2lwZSBhd2F5IHRoZSBjbGllbnQtc2lkZSBzdGFjayB0cmFjZS4gIE5vdGhpbmcgdG8gZmlsbCBpdCBpbiB3aXRoCiAgICAgICAgICAgICAgICAvLyBiZWNhdXNlIHdlIGRvbid0IHNlcmlhbGl6ZSBTU1Igc3RhY2sgdHJhY2VzIGZvciBzZWN1cml0eSByZWFzb25zCgogICAgICAgICAgICAgICAgZXJyb3Iuc3RhY2sgPSAiIjsKICAgICAgICAgICAgICAgIHNlcmlhbGl6ZWRba2V5XSA9IGVycm9yOwogICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBzZXJpYWxpemVkW2tleV0gPSB2YWw7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICByZXR1cm4gc2VyaWFsaXplZDsKICAgICAgICAgIH0KICAgICAgICAgIC8qKgogICAgICAgICAgICogQSBgPFJvdXRlcj5gIGZvciB1c2UgaW4gd2ViIGJyb3dzZXJzLiBQcm92aWRlcyB0aGUgY2xlYW5lc3QgVVJMcy4KICAgICAgICAgICAqLwoKCiAgICAgICAgICBmdW5jdGlvbiBCcm93c2VyUm91dGVyKF9yZWYpIHsKICAgICAgICAgICAgdmFyCiAgICAgICAgICAgICAgYmFzZW5hbWUgPQoKCiAgICAgICAgICAgICAgX3JlZi5iYXNlbmFtZSxjaGlsZHJlbiA9IF9yZWYuY2hpbGRyZW4sd2luZG93ID0gX3JlZi53aW5kb3c7CiAgICAgICAgICAgIHZhciBoaXN0b3J5UmVmID0gUmVhY3QudXNlUmVmKCk7CgogICAgICAgICAgICBpZiAoaGlzdG9yeVJlZi5jdXJyZW50ID09IG51bGwpIHsKICAgICAgICAgICAgICBoaXN0b3J5UmVmLmN1cnJlbnQgPSBjcmVhdGVCcm93c2VySGlzdG9yeSh7CiAgICAgICAgICAgICAgICB3aW5kb3c6IHdpbmRvdywKICAgICAgICAgICAgICAgIHY1Q29tcGF0OiB0cnVlCiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHZhciBoaXN0b3J5ID0gaGlzdG9yeVJlZi5jdXJyZW50OwogICAgICAgICAgICB2YXIgX1JlYWN0JHVzZVN0YXRlMyA9IFJlYWN0LnVzZVN0YXRlKHsKICAgICAgICAgICAgICAgIGFjdGlvbjogaGlzdG9yeS5hY3Rpb24sCiAgICAgICAgICAgICAgICBsb2NhdGlvbjogaGlzdG9yeS5sb2NhdGlvbgogICAgICAgICAgICAgIH0pLF9SZWFjdCR1c2VTdGF0ZTQgPSBfc2xpY2VkVG9BcnJheTIoX1JlYWN0JHVzZVN0YXRlMywgMiksc3RhdGUgPSBfUmVhY3QkdXNlU3RhdGU0WzBdLHNldFN0YXRlID0gX1JlYWN0JHVzZVN0YXRlNFsxXTsKICAgICAgICAgICAgUmVhY3QudXNlTGF5b3V0RWZmZWN0KCgpID0+IGhpc3RvcnkubGlzdGVuKHNldFN0YXRlKSwgW2hpc3RvcnldKTsKICAgICAgICAgICAgcmV0dXJuIC8qI19fUFVSRV9fKi9SZWFjdC5jcmVhdGVFbGVtZW50KFJvdXRlciwgewogICAgICAgICAgICAgIGJhc2VuYW1lOiBiYXNlbmFtZSwKICAgICAgICAgICAgICBjaGlsZHJlbjogY2hpbGRyZW4sCiAgICAgICAgICAgICAgbG9jYXRpb246IHN0YXRlLmxvY2F0aW9uLAogICAgICAgICAgICAgIG5hdmlnYXRpb25UeXBlOiBzdGF0ZS5hY3Rpb24sCiAgICAgICAgICAgICAgbmF2aWdhdG9yOiBoaXN0b3J5CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfQogICAgICAgICAgLyoqCiAgICAgICAgICAgKiBBIGA8Um91dGVyPmAgZm9yIHVzZSBpbiB3ZWIgYnJvd3NlcnMuIFN0b3JlcyB0aGUgbG9jYXRpb24gaW4gdGhlIGhhc2gKICAgICAgICAgICAqIHBvcnRpb24gb2YgdGhlIFVSTCBzbyBpdCBpcyBub3Qgc2VudCB0byB0aGUgc2VydmVyLgogICAgICAgICAgICovCgogICAgICAgICAgZnVuY3Rpb24gSGFzaFJvdXRlcihfcmVmMikgewogICAgICAgICAgICB2YXIKICAgICAgICAgICAgICBiYXNlbmFtZSA9CgoKICAgICAgICAgICAgICBfcmVmMi5iYXNlbmFtZSxjaGlsZHJlbiA9IF9yZWYyLmNoaWxkcmVuLHdpbmRvdyA9IF9yZWYyLndpbmRvdzsKICAgICAgICAgICAgdmFyIGhpc3RvcnlSZWYgPSBSZWFjdC51c2VSZWYoKTsKCiAgICAgICAgICAgIGlmIChoaXN0b3J5UmVmLmN1cnJlbnQgPT0gbnVsbCkgewogICAgICAgICAgICAgIGhpc3RvcnlSZWYuY3VycmVudCA9IGNyZWF0ZUhhc2hIaXN0b3J5KHsKICAgICAgICAgICAgICAgIHdpbmRvdzogd2luZG93LAogICAgICAgICAgICAgICAgdjVDb21wYXQ6IHRydWUKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdmFyIGhpc3RvcnkgPSBoaXN0b3J5UmVmLmN1cnJlbnQ7CiAgICAgICAgICAgIHZhciBfUmVhY3QkdXNlU3RhdGU1ID0gUmVhY3QudXNlU3RhdGUoewogICAgICAgICAgICAgICAgYWN0aW9uOiBoaXN0b3J5LmFjdGlvbiwKICAgICAgICAgICAgICAgIGxvY2F0aW9uOiBoaXN0b3J5LmxvY2F0aW9uCiAgICAgICAgICAgICAgfSksX1JlYWN0JHVzZVN0YXRlNiA9IF9zbGljZWRUb0FycmF5MihfUmVhY3QkdXNlU3RhdGU1LCAyKSxzdGF0ZSA9IF9SZWFjdCR1c2VTdGF0ZTZbMF0sc2V0U3RhdGUgPSBfUmVhY3QkdXNlU3RhdGU2WzFdOwogICAgICAgICAgICBSZWFjdC51c2VMYXlvdXRFZmZlY3QoKCkgPT4gaGlzdG9yeS5saXN0ZW4oc2V0U3RhdGUpLCBbaGlzdG9yeV0pOwogICAgICAgICAgICByZXR1cm4gLyojX19QVVJFX18qL1JlYWN0LmNyZWF0ZUVsZW1lbnQoUm91dGVyLCB7CiAgICAgICAgICAgICAgYmFzZW5hbWU6IGJhc2VuYW1lLAogICAgICAgICAgICAgIGNoaWxkcmVuOiBjaGlsZHJlbiwKICAgICAgICAgICAgICBsb2NhdGlvbjogc3RhdGUubG9jYXRpb24sCiAgICAgICAgICAgICAgbmF2aWdhdGlvblR5cGU6IHN0YXRlLmFjdGlvbiwKICAgICAgICAgICAgICBuYXZpZ2F0b3I6IGhpc3RvcnkKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9CiAgICAgICAgICAvKioKICAgICAgICAgICAqIEEgYDxSb3V0ZXI+YCB0aGF0IGFjY2VwdHMgYSBwcmUtaW5zdGFudGlhdGVkIGhpc3Rvcnkgb2JqZWN0LiBJdCdzIGltcG9ydGFudAogICAgICAgICAgICogdG8gbm90ZSB0aGF0IHVzaW5nIHlvdXIgb3duIGhpc3Rvcnkgb2JqZWN0IGlzIGhpZ2hseSBkaXNjb3VyYWdlZCBhbmQgbWF5IGFkZAogICAgICAgICAgICogdHdvIHZlcnNpb25zIG9mIHRoZSBoaXN0b3J5IGxpYnJhcnkgdG8geW91ciBidW5kbGVzIHVubGVzcyB5b3UgdXNlIHRoZSBzYW1lCiAgICAgICAgICAgKiB2ZXJzaW9uIG9mIHRoZSBoaXN0b3J5IGxpYnJhcnkgdGhhdCBSZWFjdCBSb3V0ZXIgdXNlcyBpbnRlcm5hbGx5LgogICAgICAgICAgICovCgogICAgICAgICAgZnVuY3Rpb24gSGlzdG9yeVJvdXRlcihfcmVmMykgewogICAgICAgICAgICB2YXIKICAgICAgICAgICAgICBiYXNlbmFtZSA9CgoKICAgICAgICAgICAgICBfcmVmMy5iYXNlbmFtZSxjaGlsZHJlbiA9IF9yZWYzLmNoaWxkcmVuLGhpc3RvcnkgPSBfcmVmMy5oaXN0b3J5OwogICAgICAgICAgICB2YXIgX1JlYWN0JHVzZVN0YXRlNyA9IFJlYWN0LnVzZVN0YXRlKHsKICAgICAgICAgICAgICAgIGFjdGlvbjogaGlzdG9yeS5hY3Rpb24sCiAgICAgICAgICAgICAgICBsb2NhdGlvbjogaGlzdG9yeS5sb2NhdGlvbgogICAgICAgICAgICAgIH0pLF9SZWFjdCR1c2VTdGF0ZTggPSBfc2xpY2VkVG9BcnJheTIoX1JlYWN0JHVzZVN0YXRlNywgMiksc3RhdGUgPSBfUmVhY3QkdXNlU3RhdGU4WzBdLHNldFN0YXRlID0gX1JlYWN0JHVzZVN0YXRlOFsxXTsKICAgICAgICAgICAgUmVhY3QudXNlTGF5b3V0RWZmZWN0KCgpID0+IGhpc3RvcnkubGlzdGVuKHNldFN0YXRlKSwgW2hpc3RvcnldKTsKICAgICAgICAgICAgcmV0dXJuIC8qI19fUFVSRV9fKi9SZWFjdC5jcmVhdGVFbGVtZW50KFJvdXRlciwgewogICAgICAgICAgICAgIGJhc2VuYW1lOiBiYXNlbmFtZSwKICAgICAgICAgICAgICBjaGlsZHJlbjogY2hpbGRyZW4sCiAgICAgICAgICAgICAgbG9jYXRpb246IHN0YXRlLmxvY2F0aW9uLAogICAgICAgICAgICAgIG5hdmlnYXRpb25UeXBlOiBzdGF0ZS5hY3Rpb24sCiAgICAgICAgICAgICAgbmF2aWdhdG9yOiBoaXN0b3J5CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfQoKICAgICAgICAgIGlmIChmYWxzZSkge30KICAgICAgICAgIHZhciBkaXN0X2lzQnJvd3NlciA9IHR5cGVvZiB3aW5kb3cgIT09ICJ1bmRlZmluZWQiICYmIHR5cGVvZiB3aW5kb3cuZG9jdW1lbnQgIT09ICJ1bmRlZmluZWQiICYmIHR5cGVvZiB3aW5kb3cuZG9jdW1lbnQuY3JlYXRlRWxlbWVudCAhPT0gInVuZGVmaW5lZCI7CiAgICAgICAgICAvKioKICAgICAgICAgICAqIFRoZSBwdWJsaWMgQVBJIGZvciByZW5kZXJpbmcgYSBoaXN0b3J5LWF3YXJlIDxhPi4KICAgICAgICAgICAqLwoKICAgICAgICAgIHZhciBMaW5rID0gLyojX19QVVJFX18qL3JlYWN0LmZvcndhcmRSZWYoZnVuY3Rpb24gTGlua1dpdGhSZWYoX3JlZjQsIHJlZikgewogICAgICAgICAgICB2YXIKICAgICAgICAgICAgICBvbkNsaWNrID0KCgoKCgoKCiAgICAgICAgICAgICAgX3JlZjQub25DbGljayxyZWxhdGl2ZSA9IF9yZWY0LnJlbGF0aXZlLHJlbG9hZERvY3VtZW50ID0gX3JlZjQucmVsb2FkRG9jdW1lbnQscmVwbGFjZSA9IF9yZWY0LnJlcGxhY2Usc3RhdGUgPSBfcmVmNC5zdGF0ZSx0YXJnZXQgPSBfcmVmNC50YXJnZXQsdG8gPSBfcmVmNC50byxwcmV2ZW50U2Nyb2xsUmVzZXQgPSBfcmVmNC5wcmV2ZW50U2Nyb2xsUmVzZXQsCiAgICAgICAgICAgICAgcmVzdCA9IF9vYmplY3RXaXRob3V0UHJvcGVydGllc0xvb3NlKF9yZWY0LCBfZXhjbHVkZWQpOwoKICAgICAgICAgICAgLy8gYGxvY2F0aW9uYCBpcyB0aGUgdW5hbHRlcmVkIGhyZWYgd2Ugd2lsbCByZW5kZXIgaW4gdGhlIDxhPiB0YWcgZm9yIGFic29sdXRlIFVSTHMKICAgICAgICAgICAgdmFyIGxvY2F0aW9uID0gdHlwZW9mIHRvID09PSAic3RyaW5nIiA/IHRvIDogcm91dGVyX2NyZWF0ZVBhdGgodG8pOwogICAgICAgICAgICB2YXIgaXNBYnNvbHV0ZSA9IC9eW2EteitdKzpcL1wvL2kudGVzdChsb2NhdGlvbikgfHwgbG9jYXRpb24uc3RhcnRzV2l0aCgiLy8iKTsgLy8gTG9jYXRpb24gdG8gdXNlIGluIHRoZSBjbGljayBoYW5kbGVyCgogICAgICAgICAgICB2YXIgbmF2aWdhdGlvbkxvY2F0aW9uID0gbG9jYXRpb247CiAgICAgICAgICAgIHZhciBpc0V4dGVybmFsID0gZmFsc2U7CgogICAgICAgICAgICBpZiAoZGlzdF9pc0Jyb3dzZXIgJiYgaXNBYnNvbHV0ZSkgewogICAgICAgICAgICAgIHZhciBjdXJyZW50VXJsID0gbmV3IFVSTCh3aW5kb3cubG9jYXRpb24uaHJlZik7CiAgICAgICAgICAgICAgdmFyIHRhcmdldFVybCA9IGxvY2F0aW9uLnN0YXJ0c1dpdGgoIi8vIikgPyBuZXcgVVJMKGN1cnJlbnRVcmwucHJvdG9jb2wgKyBsb2NhdGlvbikgOiBuZXcgVVJMKGxvY2F0aW9uKTsKCiAgICAgICAgICAgICAgaWYgKHRhcmdldFVybC5vcmlnaW4gPT09IGN1cnJlbnRVcmwub3JpZ2luKSB7CiAgICAgICAgICAgICAgICAvLyBTdHJpcCB0aGUgcHJvdG9jb2wvb3JpZ2luIGZvciBzYW1lLW9yaWdpbiBhYnNvbHV0ZSBVUkxzCiAgICAgICAgICAgICAgICBuYXZpZ2F0aW9uTG9jYXRpb24gPSB0YXJnZXRVcmwucGF0aG5hbWUgKyB0YXJnZXRVcmwuc2VhcmNoICsgdGFyZ2V0VXJsLmhhc2g7CiAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGlzRXh0ZXJuYWwgPSB0cnVlOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSAvLyBgaHJlZmAgaXMgd2hhdCB3ZSByZW5kZXIgaW4gdGhlIDxhPiB0YWcgZm9yIHJlbGF0aXZlIFVSTHMKCgogICAgICAgICAgICB2YXIgaHJlZiA9IHVzZUhyZWYobmF2aWdhdGlvbkxvY2F0aW9uLCB7CiAgICAgICAgICAgICAgcmVsYXRpdmU6IHJlbGF0aXZlCiAgICAgICAgICAgIH0pOwogICAgICAgICAgICB2YXIgaW50ZXJuYWxPbkNsaWNrID0gdXNlTGlua0NsaWNrSGFuZGxlcihuYXZpZ2F0aW9uTG9jYXRpb24sIHsKICAgICAgICAgICAgICByZXBsYWNlOiByZXBsYWNlLAogICAgICAgICAgICAgIHN0YXRlOiBzdGF0ZSwKICAgICAgICAgICAgICB0YXJnZXQ6IHRhcmdldCwKICAgICAgICAgICAgICBwcmV2ZW50U2Nyb2xsUmVzZXQ6IHByZXZlbnRTY3JvbGxSZXNldCwKICAgICAgICAgICAgICByZWxhdGl2ZTogcmVsYXRpdmUKICAgICAgICAgICAgfSk7CgogICAgICAgICAgICBmdW5jdGlvbiBoYW5kbGVDbGljayhldmVudCkgewogICAgICAgICAgICAgIGlmIChvbkNsaWNrKSBvbkNsaWNrKGV2ZW50KTsKCiAgICAgICAgICAgICAgaWYgKCFldmVudC5kZWZhdWx0UHJldmVudGVkKSB7CiAgICAgICAgICAgICAgICBpbnRlcm5hbE9uQ2xpY2soZXZlbnQpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuICgKICAgICAgICAgICAgICAvKiNfX1BVUkVfXyovCiAgICAgICAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIGpzeC1hMTF5L2FuY2hvci1oYXMtY29udGVudAogICAgICAgICAgICAgIHJlYWN0LmNyZWF0ZUVsZW1lbnQoImEiLCByZWFjdF9yb3V0ZXJfZG9tX2Rpc3RfZXh0ZW5kcyh7fSwgcmVzdCwgewogICAgICAgICAgICAgICAgaHJlZjogaXNBYnNvbHV0ZSA/IGxvY2F0aW9uIDogaHJlZiwKICAgICAgICAgICAgICAgIG9uQ2xpY2s6IGlzRXh0ZXJuYWwgfHwgcmVsb2FkRG9jdW1lbnQgPyBvbkNsaWNrIDogaGFuZGxlQ2xpY2ssCiAgICAgICAgICAgICAgICByZWY6IHJlZiwKICAgICAgICAgICAgICAgIHRhcmdldDogdGFyZ2V0CiAgICAgICAgICAgICAgfSkpKTsKCiAgICAgICAgICB9KTsKCiAgICAgICAgICBpZiAoZmFsc2UpIHt9CiAgICAgICAgICAvKioKICAgICAgICAgICAqIEEgPExpbms+IHdyYXBwZXIgdGhhdCBrbm93cyBpZiBpdCdzICJhY3RpdmUiIG9yIG5vdC4KICAgICAgICAgICAqLwoKCiAgICAgICAgICB2YXIgTmF2TGluayA9IC8qI19fUFVSRV9fKi9yZWFjdC5mb3J3YXJkUmVmKGZ1bmN0aW9uIE5hdkxpbmtXaXRoUmVmKF9yZWY1LCByZWYpIHsKICAgICAgICAgICAgdmFyIF9yZWY1JGFyaWFDdXJyZW50ID0KCgoKCgoKCiAgICAgICAgICAgICAgX3JlZjVbImFyaWEtY3VycmVudCJdLGFyaWFDdXJyZW50UHJvcCA9IF9yZWY1JGFyaWFDdXJyZW50ID09PSB2b2lkIDAgPyAicGFnZSIgOiBfcmVmNSRhcmlhQ3VycmVudCxfcmVmNSRjYXNlU2Vuc2l0aXZlID0gX3JlZjUuY2FzZVNlbnNpdGl2ZSxjYXNlU2Vuc2l0aXZlID0gX3JlZjUkY2FzZVNlbnNpdGl2ZSA9PT0gdm9pZCAwID8gZmFsc2UgOiBfcmVmNSRjYXNlU2Vuc2l0aXZlLF9yZWY1JGNsYXNzTmFtZSA9IF9yZWY1LmNsYXNzTmFtZSxjbGFzc05hbWVQcm9wID0gX3JlZjUkY2xhc3NOYW1lID09PSB2b2lkIDAgPyAiIiA6IF9yZWY1JGNsYXNzTmFtZSxfcmVmNSRlbmQgPSBfcmVmNS5lbmQsZW5kID0gX3JlZjUkZW5kID09PSB2b2lkIDAgPyBmYWxzZSA6IF9yZWY1JGVuZCxzdHlsZVByb3AgPSBfcmVmNS5zdHlsZSx0byA9IF9yZWY1LnRvLGNoaWxkcmVuID0gX3JlZjUuY2hpbGRyZW4sCiAgICAgICAgICAgICAgcmVzdCA9IF9vYmplY3RXaXRob3V0UHJvcGVydGllc0xvb3NlKF9yZWY1LCBfZXhjbHVkZWQyKTsKCiAgICAgICAgICAgIHZhciBwYXRoID0gZGlzdF91c2VSZXNvbHZlZFBhdGgodG8sIHsKICAgICAgICAgICAgICByZWxhdGl2ZTogcmVzdC5yZWxhdGl2ZQogICAgICAgICAgICB9KTsKICAgICAgICAgICAgdmFyIGxvY2F0aW9uID0gZGlzdF91c2VMb2NhdGlvbigpOwogICAgICAgICAgICB2YXIgcm91dGVyU3RhdGUgPSByZWFjdC51c2VDb250ZXh0KERhdGFSb3V0ZXJTdGF0ZUNvbnRleHQpOwogICAgICAgICAgICB2YXIgX3JlYWN0JHVzZUNvbnRleHQ3ID0KCiAgICAgICAgICAgICAgcmVhY3QudXNlQ29udGV4dChOYXZpZ2F0aW9uQ29udGV4dCksbmF2aWdhdG9yID0gX3JlYWN0JHVzZUNvbnRleHQ3Lm5hdmlnYXRvcjsKICAgICAgICAgICAgdmFyIHRvUGF0aG5hbWUgPSBuYXZpZ2F0b3IuZW5jb2RlTG9jYXRpb24gPyBuYXZpZ2F0b3IuZW5jb2RlTG9jYXRpb24ocGF0aCkucGF0aG5hbWUgOiBwYXRoLnBhdGhuYW1lOwogICAgICAgICAgICB2YXIgbG9jYXRpb25QYXRobmFtZSA9IGxvY2F0aW9uLnBhdGhuYW1lOwogICAgICAgICAgICB2YXIgbmV4dExvY2F0aW9uUGF0aG5hbWUgPSByb3V0ZXJTdGF0ZSAmJiByb3V0ZXJTdGF0ZS5uYXZpZ2F0aW9uICYmIHJvdXRlclN0YXRlLm5hdmlnYXRpb24ubG9jYXRpb24gPyByb3V0ZXJTdGF0ZS5uYXZpZ2F0aW9uLmxvY2F0aW9uLnBhdGhuYW1lIDogbnVsbDsKCiAgICAgICAgICAgIGlmICghY2FzZVNlbnNpdGl2ZSkgewogICAgICAgICAgICAgIGxvY2F0aW9uUGF0aG5hbWUgPSBsb2NhdGlvblBhdGhuYW1lLnRvTG93ZXJDYXNlKCk7CiAgICAgICAgICAgICAgbmV4dExvY2F0aW9uUGF0aG5hbWUgPSBuZXh0TG9jYXRpb25QYXRobmFtZSA/IG5leHRMb2NhdGlvblBhdGhuYW1lLnRvTG93ZXJDYXNlKCkgOiBudWxsOwogICAgICAgICAgICAgIHRvUGF0aG5hbWUgPSB0b1BhdGhuYW1lLnRvTG93ZXJDYXNlKCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHZhciBpc0FjdGl2ZSA9IGxvY2F0aW9uUGF0aG5hbWUgPT09IHRvUGF0aG5hbWUgfHwgIWVuZCAmJiBsb2NhdGlvblBhdGhuYW1lLnN0YXJ0c1dpdGgodG9QYXRobmFtZSkgJiYgbG9jYXRpb25QYXRobmFtZS5jaGFyQXQodG9QYXRobmFtZS5sZW5ndGgpID09PSAiLyI7CiAgICAgICAgICAgIHZhciBpc1BlbmRpbmcgPSBuZXh0TG9jYXRpb25QYXRobmFtZSAhPSBudWxsICYmIChuZXh0TG9jYXRpb25QYXRobmFtZSA9PT0gdG9QYXRobmFtZSB8fCAhZW5kICYmIG5leHRMb2NhdGlvblBhdGhuYW1lLnN0YXJ0c1dpdGgodG9QYXRobmFtZSkgJiYgbmV4dExvY2F0aW9uUGF0aG5hbWUuY2hhckF0KHRvUGF0aG5hbWUubGVuZ3RoKSA9PT0gIi8iKTsKICAgICAgICAgICAgdmFyIGFyaWFDdXJyZW50ID0gaXNBY3RpdmUgPyBhcmlhQ3VycmVudFByb3AgOiB1bmRlZmluZWQ7CiAgICAgICAgICAgIHZhciBjbGFzc05hbWU7CgogICAgICAgICAgICBpZiAodHlwZW9mIGNsYXNzTmFtZVByb3AgPT09ICJmdW5jdGlvbiIpIHsKICAgICAgICAgICAgICBjbGFzc05hbWUgPSBjbGFzc05hbWVQcm9wKHsKICAgICAgICAgICAgICAgIGlzQWN0aXZlOiBpc0FjdGl2ZSwKICAgICAgICAgICAgICAgIGlzUGVuZGluZzogaXNQZW5kaW5nCiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgLy8gSWYgdGhlIGNsYXNzTmFtZSBwcm9wIGlzIG5vdCBhIGZ1bmN0aW9uLCB3ZSB1c2UgYSBkZWZhdWx0IGBhY3RpdmVgCiAgICAgICAgICAgICAgLy8gY2xhc3MgZm9yIDxOYXZMaW5rIC8+cyB0aGF0IGFyZSBhY3RpdmUuIEluIHY1IGBhY3RpdmVgIHdhcyB0aGUgZGVmYXVsdAogICAgICAgICAgICAgIC8vIHZhbHVlIGZvciBgYWN0aXZlQ2xhc3NOYW1lYCwgYnV0IHdlIGFyZSByZW1vdmluZyB0aGF0IEFQSSBhbmQgY2FuIHN0aWxsCiAgICAgICAgICAgICAgLy8gdXNlIHRoZSBvbGQgZGVmYXVsdCBiZWhhdmlvciBmb3IgYSBjbGVhbmVyIHVwZ3JhZGUgcGF0aCBhbmQga2VlcCB0aGUKICAgICAgICAgICAgICAvLyBzaW1wbGUgc3R5bGluZyBydWxlcyB3b3JraW5nIGFzIHRoZXkgY3VycmVudGx5IGRvLgogICAgICAgICAgICAgIGNsYXNzTmFtZSA9IFtjbGFzc05hbWVQcm9wLCBpc0FjdGl2ZSA/ICJhY3RpdmUiIDogbnVsbCwgaXNQZW5kaW5nID8gInBlbmRpbmciIDogbnVsbF0uZmlsdGVyKEJvb2xlYW4pLmpvaW4oIiAiKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdmFyIHN0eWxlID0gdHlwZW9mIHN0eWxlUHJvcCA9PT0gImZ1bmN0aW9uIiA/IHN0eWxlUHJvcCh7CiAgICAgICAgICAgICAgaXNBY3RpdmU6IGlzQWN0aXZlLAogICAgICAgICAgICAgIGlzUGVuZGluZzogaXNQZW5kaW5nCiAgICAgICAgICAgIH0pIDogc3R5bGVQcm9wOwogICAgICAgICAgICByZXR1cm4gLyojX19QVVJFX18qL3JlYWN0LmNyZWF0ZUVsZW1lbnQoTGluaywgcmVhY3Rfcm91dGVyX2RvbV9kaXN0X2V4dGVuZHMoe30sIHJlc3QsIHsKICAgICAgICAgICAgICAiYXJpYS1jdXJyZW50IjogYXJpYUN1cnJlbnQsCiAgICAgICAgICAgICAgY2xhc3NOYW1lOiBjbGFzc05hbWUsCiAgICAgICAgICAgICAgcmVmOiByZWYsCiAgICAgICAgICAgICAgc3R5bGU6IHN0eWxlLAogICAgICAgICAgICAgIHRvOiB0bwogICAgICAgICAgICB9KSwgdHlwZW9mIGNoaWxkcmVuID09PSAiZnVuY3Rpb24iID8gY2hpbGRyZW4oewogICAgICAgICAgICAgIGlzQWN0aXZlOiBpc0FjdGl2ZSwKICAgICAgICAgICAgICBpc1BlbmRpbmc6IGlzUGVuZGluZwogICAgICAgICAgICB9KSA6IGNoaWxkcmVuKTsKICAgICAgICAgIH0pOwoKICAgICAgICAgIGlmIChmYWxzZSkge30KICAgICAgICAgIC8qKgogICAgICAgICAgICogQSBgQHJlbWl4LXJ1bi9yb3V0ZXJgLWF3YXJlIGA8Zm9ybT5gLiBJdCBiZWhhdmVzIGxpa2UgYSBub3JtYWwgZm9ybSBleGNlcHQKICAgICAgICAgICAqIHRoYXQgdGhlIGludGVyYWN0aW9uIHdpdGggdGhlIHNlcnZlciBpcyB3aXRoIGBmZXRjaGAgaW5zdGVhZCBvZiBuZXcgZG9jdW1lbnQKICAgICAgICAgICAqIHJlcXVlc3RzLCBhbGxvd2luZyBjb21wb25lbnRzIHRvIGFkZCBuaWNlciBVWCB0byB0aGUgcGFnZSBhcyB0aGUgZm9ybSBpcwogICAgICAgICAgICogc3VibWl0dGVkIGFuZCByZXR1cm5zIHdpdGggZGF0YS4KICAgICAgICAgICAqLwoKCiAgICAgICAgICB2YXIgRm9ybSA9IC8qI19fUFVSRV9fKi8gLyogdW51c2VkIHB1cmUgZXhwcmVzc2lvbiBvciBzdXBlciAqL251bGwgJiYgUmVhY3QuZm9yd2FyZFJlZigocHJvcHMsIHJlZikgPT4gewogICAgICAgICAgICByZXR1cm4gLyojX19QVVJFX18qL1JlYWN0LmNyZWF0ZUVsZW1lbnQoRm9ybUltcGwsIHJlYWN0X3JvdXRlcl9kb21fZGlzdF9leHRlbmRzKHt9LCBwcm9wcywgewogICAgICAgICAgICAgIHJlZjogcmVmCiAgICAgICAgICAgIH0pKTsKICAgICAgICAgIH0pOwoKICAgICAgICAgIGlmIChmYWxzZSkge30KCiAgICAgICAgICB2YXIgRm9ybUltcGwgPSAvKiNfX1BVUkVfXyovIC8qIHVudXNlZCBwdXJlIGV4cHJlc3Npb24gb3Igc3VwZXIgKi9udWxsICYmIFJlYWN0LmZvcndhcmRSZWYoKF9yZWY2LCBmb3J3YXJkZWRSZWYpID0+IHsKICAgICAgICAgICAgdmFyCiAgICAgICAgICAgICAgcmVsb2FkRG9jdW1lbnQgPQoKCgoKCgoKCiAgICAgICAgICAgICAgX3JlZjYucmVsb2FkRG9jdW1lbnQscmVwbGFjZSA9IF9yZWY2LnJlcGxhY2UsX3JlZjYkbWV0aG9kID0gX3JlZjYubWV0aG9kLG1ldGhvZCA9IF9yZWY2JG1ldGhvZCA9PT0gdm9pZCAwID8gZGVmYXVsdE1ldGhvZCA6IF9yZWY2JG1ldGhvZCxhY3Rpb24gPSBfcmVmNi5hY3Rpb24sb25TdWJtaXQgPSBfcmVmNi5vblN1Ym1pdCxmZXRjaGVyS2V5ID0gX3JlZjYuZmV0Y2hlcktleSxyb3V0ZUlkID0gX3JlZjYucm91dGVJZCxyZWxhdGl2ZSA9IF9yZWY2LnJlbGF0aXZlLHByZXZlbnRTY3JvbGxSZXNldCA9IF9yZWY2LnByZXZlbnRTY3JvbGxSZXNldCwKICAgICAgICAgICAgICBwcm9wcyA9IF9vYmplY3RXaXRob3V0UHJvcGVydGllc0xvb3NlKF9yZWY2LCBfZXhjbHVkZWQzKTsKCiAgICAgICAgICAgIHZhciBzdWJtaXQgPSB1c2VTdWJtaXRJbXBsKGZldGNoZXJLZXksIHJvdXRlSWQpOwogICAgICAgICAgICB2YXIgZm9ybU1ldGhvZCA9IG1ldGhvZC50b0xvd2VyQ2FzZSgpID09PSAiZ2V0IiA/ICJnZXQiIDogInBvc3QiOwogICAgICAgICAgICB2YXIgZm9ybUFjdGlvbiA9IHVzZUZvcm1BY3Rpb24oYWN0aW9uLCB7CiAgICAgICAgICAgICAgcmVsYXRpdmU6IHJlbGF0aXZlCiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgdmFyIHN1Ym1pdEhhbmRsZXIgPSAoZXZlbnQpID0+IHsKICAgICAgICAgICAgICBvblN1Ym1pdCAmJiBvblN1Ym1pdChldmVudCk7CiAgICAgICAgICAgICAgaWYgKGV2ZW50LmRlZmF1bHRQcmV2ZW50ZWQpIHJldHVybjsKICAgICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgICAgICAgIHZhciBzdWJtaXR0ZXIgPSBldmVudC5uYXRpdmVFdmVudC5zdWJtaXR0ZXI7CiAgICAgICAgICAgICAgdmFyIHN1Ym1pdE1ldGhvZCA9IChzdWJtaXR0ZXIgPT0gbnVsbCA/IHZvaWQgMCA6IHN1Ym1pdHRlci5nZXRBdHRyaWJ1dGUoImZvcm1tZXRob2QiKSkgfHwgbWV0aG9kOwogICAgICAgICAgICAgIHN1Ym1pdChzdWJtaXR0ZXIgfHwgZXZlbnQuY3VycmVudFRhcmdldCwgewogICAgICAgICAgICAgICAgbWV0aG9kOiBzdWJtaXRNZXRob2QsCiAgICAgICAgICAgICAgICByZXBsYWNlOiByZXBsYWNlLAogICAgICAgICAgICAgICAgcmVsYXRpdmU6IHJlbGF0aXZlLAogICAgICAgICAgICAgICAgcHJldmVudFNjcm9sbFJlc2V0OiBwcmV2ZW50U2Nyb2xsUmVzZXQKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfTsKCiAgICAgICAgICAgIHJldHVybiAvKiNfX1BVUkVfXyovUmVhY3QuY3JlYXRlRWxlbWVudCgiZm9ybSIsIHJlYWN0X3JvdXRlcl9kb21fZGlzdF9leHRlbmRzKHsKICAgICAgICAgICAgICByZWY6IGZvcndhcmRlZFJlZiwKICAgICAgICAgICAgICBtZXRob2Q6IGZvcm1NZXRob2QsCiAgICAgICAgICAgICAgYWN0aW9uOiBmb3JtQWN0aW9uLAogICAgICAgICAgICAgIG9uU3VibWl0OiByZWxvYWREb2N1bWVudCA/IG9uU3VibWl0IDogc3VibWl0SGFuZGxlcgogICAgICAgICAgICB9LCBwcm9wcykpOwogICAgICAgICAgfSk7CgogICAgICAgICAgaWYgKGZhbHNlKSB7fQogICAgICAgICAgLyoqCiAgICAgICAgICAgKiBUaGlzIGNvbXBvbmVudCB3aWxsIGVtdWxhdGUgdGhlIGJyb3dzZXIncyBzY3JvbGwgcmVzdG9yYXRpb24gb24gbG9jYXRpb24KICAgICAgICAgICAqIGNoYW5nZXMuCiAgICAgICAgICAgKi8KCgogICAgICAgICAgZnVuY3Rpb24gU2Nyb2xsUmVzdG9yYXRpb24oX3JlZjcpIHsKICAgICAgICAgICAgdmFyCiAgICAgICAgICAgICAgZ2V0S2V5ID0KCiAgICAgICAgICAgICAgX3JlZjcuZ2V0S2V5LHN0b3JhZ2VLZXkgPSBfcmVmNy5zdG9yYWdlS2V5OwogICAgICAgICAgICB1c2VTY3JvbGxSZXN0b3JhdGlvbih7CiAgICAgICAgICAgICAgZ2V0S2V5OiBnZXRLZXksCiAgICAgICAgICAgICAgc3RvcmFnZUtleTogc3RvcmFnZUtleQogICAgICAgICAgICB9KTsKICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKGZhbHNlKSB7fSAvLyNlbmRyZWdpb24KICAgICAgICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCiAgICAgICAgICAvLyNyZWdpb24gSG9va3MKICAgICAgICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCgoKICAgICAgICAgIHZhciBkaXN0X0RhdGFSb3V0ZXJIb29rOwoKICAgICAgICAgIChmdW5jdGlvbiAoRGF0YVJvdXRlckhvb2spIHsKICAgICAgICAgICAgRGF0YVJvdXRlckhvb2tbIlVzZVNjcm9sbFJlc3RvcmF0aW9uIl0gPSAidXNlU2Nyb2xsUmVzdG9yYXRpb24iOwogICAgICAgICAgICBEYXRhUm91dGVySG9va1siVXNlU3VibWl0SW1wbCJdID0gInVzZVN1Ym1pdEltcGwiOwogICAgICAgICAgICBEYXRhUm91dGVySG9va1siVXNlRmV0Y2hlciJdID0gInVzZUZldGNoZXIiOwogICAgICAgICAgfSkoZGlzdF9EYXRhUm91dGVySG9vayB8fCAoZGlzdF9EYXRhUm91dGVySG9vayA9IHt9KSk7CgogICAgICAgICAgdmFyIGRpc3RfRGF0YVJvdXRlclN0YXRlSG9vazsKCiAgICAgICAgICAoZnVuY3Rpb24gKERhdGFSb3V0ZXJTdGF0ZUhvb2spIHsKICAgICAgICAgICAgRGF0YVJvdXRlclN0YXRlSG9va1siVXNlRmV0Y2hlcnMiXSA9ICJ1c2VGZXRjaGVycyI7CiAgICAgICAgICAgIERhdGFSb3V0ZXJTdGF0ZUhvb2tbIlVzZVNjcm9sbFJlc3RvcmF0aW9uIl0gPSAidXNlU2Nyb2xsUmVzdG9yYXRpb24iOwogICAgICAgICAgfSkoZGlzdF9EYXRhUm91dGVyU3RhdGVIb29rIHx8IChkaXN0X0RhdGFSb3V0ZXJTdGF0ZUhvb2sgPSB7fSkpOwoKICAgICAgICAgIGZ1bmN0aW9uIGRpc3RfZ2V0RGF0YVJvdXRlckNvbnNvbGVFcnJvcihob29rTmFtZSkgewogICAgICAgICAgICByZXR1cm4gaG9va05hbWUgKyAiIG11c3QgYmUgdXNlZCB3aXRoaW4gYSBkYXRhIHJvdXRlci4gIFNlZSBodHRwczovL3JlYWN0cm91dGVyLmNvbS9yb3V0ZXJzL3BpY2tpbmctYS1yb3V0ZXIuIjsKICAgICAgICAgIH0KCiAgICAgICAgICBmdW5jdGlvbiBkaXN0X3VzZURhdGFSb3V0ZXJDb250ZXh0KGhvb2tOYW1lKSB7CiAgICAgICAgICAgIHZhciBjdHggPSBSZWFjdC51c2VDb250ZXh0KFVOU0FGRV9EYXRhUm91dGVyQ29udGV4dCk7CiAgICAgICAgICAgICFjdHggPyBmYWxzZSA/IDAgOiBpbnZhcmlhbnQoZmFsc2UpIDogdm9pZCAwOwogICAgICAgICAgICByZXR1cm4gY3R4OwogICAgICAgICAgfQoKICAgICAgICAgIGZ1bmN0aW9uIGRpc3RfdXNlRGF0YVJvdXRlclN0YXRlKGhvb2tOYW1lKSB7CiAgICAgICAgICAgIHZhciBzdGF0ZSA9IFJlYWN0LnVzZUNvbnRleHQoVU5TQUZFX0RhdGFSb3V0ZXJTdGF0ZUNvbnRleHQpOwogICAgICAgICAgICAhc3RhdGUgPyBmYWxzZSA/IDAgOiBpbnZhcmlhbnQoZmFsc2UpIDogdm9pZCAwOwogICAgICAgICAgICByZXR1cm4gc3RhdGU7CiAgICAgICAgICB9CiAgICAgICAgICAvKioKICAgICAgICAgICAqIEhhbmRsZXMgdGhlIGNsaWNrIGJlaGF2aW9yIGZvciByb3V0ZXIgYDxMaW5rPmAgY29tcG9uZW50cy4gVGhpcyBpcyB1c2VmdWwgaWYKICAgICAgICAgICAqIHlvdSBuZWVkIHRvIGNyZWF0ZSBjdXN0b20gYDxMaW5rPmAgY29tcG9uZW50cyB3aXRoIHRoZSBzYW1lIGNsaWNrIGJlaGF2aW9yIHdlCiAgICAgICAgICAgKiB1c2UgaW4gb3VyIGV4cG9ydGVkIGA8TGluaz5gLgogICAgICAgICAgICovCgoKICAgICAgICAgIGZ1bmN0aW9uIHVzZUxpbmtDbGlja0hhbmRsZXIodG8sIF90ZW1wKSB7CiAgICAgICAgICAgIHZhciBfcmVmMjAgPQoKCgoKCiAgICAgICAgICAgICAgX3RlbXAgPT09IHZvaWQgMCA/IHt9IDogX3RlbXAsdGFyZ2V0ID0gX3JlZjIwLnRhcmdldCxyZXBsYWNlUHJvcCA9IF9yZWYyMC5yZXBsYWNlLHN0YXRlID0gX3JlZjIwLnN0YXRlLHByZXZlbnRTY3JvbGxSZXNldCA9IF9yZWYyMC5wcmV2ZW50U2Nyb2xsUmVzZXQscmVsYXRpdmUgPSBfcmVmMjAucmVsYXRpdmU7CiAgICAgICAgICAgIHZhciBuYXZpZ2F0ZSA9IGRpc3RfdXNlTmF2aWdhdGUoKTsKICAgICAgICAgICAgdmFyIGxvY2F0aW9uID0gZGlzdF91c2VMb2NhdGlvbigpOwogICAgICAgICAgICB2YXIgcGF0aCA9IGRpc3RfdXNlUmVzb2x2ZWRQYXRoKHRvLCB7CiAgICAgICAgICAgICAgcmVsYXRpdmU6IHJlbGF0aXZlCiAgICAgICAgICAgIH0pOwogICAgICAgICAgICByZXR1cm4gcmVhY3QudXNlQ2FsbGJhY2soKGV2ZW50KSA9PiB7CiAgICAgICAgICAgICAgaWYgKHNob3VsZFByb2Nlc3NMaW5rQ2xpY2soZXZlbnQsIHRhcmdldCkpIHsKICAgICAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7IC8vIElmIHRoZSBVUkwgaGFzbid0IGNoYW5nZWQsIGEgcmVndWxhciA8YT4gd2lsbCBkbyBhIHJlcGxhY2UgaW5zdGVhZCBvZgogICAgICAgICAgICAgICAgLy8gYSBwdXNoLCBzbyBkbyB0aGUgc2FtZSBoZXJlIHVubGVzcyB0aGUgcmVwbGFjZSBwcm9wIGlzIGV4cGxpY2l0bHkgc2V0CgogICAgICAgICAgICAgICAgdmFyIHJlcGxhY2UgPSByZXBsYWNlUHJvcCAhPT0gdW5kZWZpbmVkID8gcmVwbGFjZVByb3AgOiByb3V0ZXJfY3JlYXRlUGF0aChsb2NhdGlvbikgPT09IHJvdXRlcl9jcmVhdGVQYXRoKHBhdGgpOwogICAgICAgICAgICAgICAgbmF2aWdhdGUodG8sIHsKICAgICAgICAgICAgICAgICAgcmVwbGFjZTogcmVwbGFjZSwKICAgICAgICAgICAgICAgICAgc3RhdGU6IHN0YXRlLAogICAgICAgICAgICAgICAgICBwcmV2ZW50U2Nyb2xsUmVzZXQ6IHByZXZlbnRTY3JvbGxSZXNldCwKICAgICAgICAgICAgICAgICAgcmVsYXRpdmU6IHJlbGF0aXZlCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sIFtsb2NhdGlvbiwgbmF2aWdhdGUsIHBhdGgsIHJlcGxhY2VQcm9wLCBzdGF0ZSwgdGFyZ2V0LCB0bywgcHJldmVudFNjcm9sbFJlc2V0LCByZWxhdGl2ZV0pOwogICAgICAgICAgfQogICAgICAgICAgLyoqCiAgICAgICAgICAgKiBBIGNvbnZlbmllbnQgd3JhcHBlciBmb3IgcmVhZGluZyBhbmQgd3JpdGluZyBzZWFyY2ggcGFyYW1ldGVycyB2aWEgdGhlCiAgICAgICAgICAgKiBVUkxTZWFyY2hQYXJhbXMgaW50ZXJmYWNlLgogICAgICAgICAgICovCgogICAgICAgICAgZnVuY3Rpb24gdXNlU2VhcmNoUGFyYW1zKGRlZmF1bHRJbml0KSB7CiAgICAgICAgICAgIGZhbHNlID8gMCA6IHZvaWQgMDsKICAgICAgICAgICAgdmFyIGRlZmF1bHRTZWFyY2hQYXJhbXNSZWYgPSBSZWFjdC51c2VSZWYoY3JlYXRlU2VhcmNoUGFyYW1zKGRlZmF1bHRJbml0KSk7CiAgICAgICAgICAgIHZhciBoYXNTZXRTZWFyY2hQYXJhbXNSZWYgPSBSZWFjdC51c2VSZWYoZmFsc2UpOwogICAgICAgICAgICB2YXIgbG9jYXRpb24gPSB1c2VMb2NhdGlvbigpOwogICAgICAgICAgICB2YXIgc2VhcmNoUGFyYW1zID0gUmVhY3QudXNlTWVtbygoKSA9PiAvLyBPbmx5IG1lcmdlIGluIHRoZSBkZWZhdWx0cyBpZiB3ZSBoYXZlbid0IHlldCBjYWxsZWQgc2V0U2VhcmNoUGFyYW1zLgogICAgICAgICAgICAvLyBPbmNlIHdlIGNhbGwgdGhhdCB3ZSB3YW50IHRob3NlIHRvIHRha2UgcHJlY2VkZW5jZSwgb3RoZXJ3aXNlIHlvdSBjYW4ndAogICAgICAgICAgICAvLyByZW1vdmUgYSBwYXJhbSB3aXRoIHNldFNlYXJjaFBhcmFtcyh7fSkgaWYgaXQgaGFzIGFuIGluaXRpYWwgdmFsdWUKICAgICAgICAgICAgZ2V0U2VhcmNoUGFyYW1zRm9yTG9jYXRpb24obG9jYXRpb24uc2VhcmNoLCBoYXNTZXRTZWFyY2hQYXJhbXNSZWYuY3VycmVudCA/IG51bGwgOiBkZWZhdWx0U2VhcmNoUGFyYW1zUmVmLmN1cnJlbnQpLCBbbG9jYXRpb24uc2VhcmNoXSk7CiAgICAgICAgICAgIHZhciBuYXZpZ2F0ZSA9IHVzZU5hdmlnYXRlKCk7CiAgICAgICAgICAgIHZhciBzZXRTZWFyY2hQYXJhbXMgPSBSZWFjdC51c2VDYWxsYmFjaygobmV4dEluaXQsIG5hdmlnYXRlT3B0aW9ucykgPT4gewogICAgICAgICAgICAgIHZhciBuZXdTZWFyY2hQYXJhbXMgPSBjcmVhdGVTZWFyY2hQYXJhbXModHlwZW9mIG5leHRJbml0ID09PSAiZnVuY3Rpb24iID8gbmV4dEluaXQoc2VhcmNoUGFyYW1zKSA6IG5leHRJbml0KTsKICAgICAgICAgICAgICBoYXNTZXRTZWFyY2hQYXJhbXNSZWYuY3VycmVudCA9IHRydWU7CiAgICAgICAgICAgICAgbmF2aWdhdGUoIj8iICsgbmV3U2VhcmNoUGFyYW1zLCBuYXZpZ2F0ZU9wdGlvbnMpOwogICAgICAgICAgICB9LCBbbmF2aWdhdGUsIHNlYXJjaFBhcmFtc10pOwogICAgICAgICAgICByZXR1cm4gW3NlYXJjaFBhcmFtcywgc2V0U2VhcmNoUGFyYW1zXTsKICAgICAgICAgIH0KICAgICAgICAgIC8qKgogICAgICAgICAgICogUmV0dXJucyBhIGZ1bmN0aW9uIHRoYXQgbWF5IGJlIHVzZWQgdG8gcHJvZ3JhbW1hdGljYWxseSBzdWJtaXQgYSBmb3JtIChvcgogICAgICAgICAgICogc29tZSBhcmJpdHJhcnkgZGF0YSkgdG8gdGhlIHNlcnZlci4KICAgICAgICAgICAqLwoKICAgICAgICAgIGZ1bmN0aW9uIHVzZVN1Ym1pdCgpIHsKICAgICAgICAgICAgcmV0dXJuIHVzZVN1Ym1pdEltcGwoKTsKICAgICAgICAgIH0KCiAgICAgICAgICBmdW5jdGlvbiB1c2VTdWJtaXRJbXBsKGZldGNoZXJLZXksIHJvdXRlSWQpIHsKICAgICAgICAgICAgdmFyIF9kaXN0X3VzZURhdGFSb3V0ZXJDbyA9CgogICAgICAgICAgICAgIGRpc3RfdXNlRGF0YVJvdXRlckNvbnRleHQoZGlzdF9EYXRhUm91dGVySG9vay5Vc2VTdWJtaXRJbXBsKSxyb3V0ZXIgPSBfZGlzdF91c2VEYXRhUm91dGVyQ28ucm91dGVyOwogICAgICAgICAgICB2YXIgZGVmYXVsdEFjdGlvbiA9IHVzZUZvcm1BY3Rpb24oKTsKICAgICAgICAgICAgcmV0dXJuIFJlYWN0LnVzZUNhbGxiYWNrKGZ1bmN0aW9uICh0YXJnZXQsIG9wdGlvbnMpIHsKICAgICAgICAgICAgICBpZiAob3B0aW9ucyA9PT0gdm9pZCAwKSB7CiAgICAgICAgICAgICAgICBvcHRpb25zID0ge307CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBpZiAodHlwZW9mIGRvY3VtZW50ID09PSAidW5kZWZpbmVkIikgewogICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJZb3UgYXJlIGNhbGxpbmcgc3VibWl0IGR1cmluZyB0aGUgc2VydmVyIHJlbmRlci4gIiArICJUcnkgY2FsbGluZyBzdWJtaXQgd2l0aGluIGEgYHVzZUVmZmVjdGAgb3IgY2FsbGJhY2sgaW5zdGVhZC4iKTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIHZhciBfZ2V0Rm9ybVN1Ym1pc3Npb25JbmYgPQoKCgoKICAgICAgICAgICAgICAgIGdldEZvcm1TdWJtaXNzaW9uSW5mbyh0YXJnZXQsIGRlZmF1bHRBY3Rpb24sIG9wdGlvbnMpLG1ldGhvZCA9IF9nZXRGb3JtU3VibWlzc2lvbkluZi5tZXRob2QsZW5jVHlwZSA9IF9nZXRGb3JtU3VibWlzc2lvbkluZi5lbmNUeXBlLGZvcm1EYXRhID0gX2dldEZvcm1TdWJtaXNzaW9uSW5mLmZvcm1EYXRhLHVybCA9IF9nZXRGb3JtU3VibWlzc2lvbkluZi51cmw7CiAgICAgICAgICAgICAgdmFyIGhyZWYgPSB1cmwucGF0aG5hbWUgKyB1cmwuc2VhcmNoOwogICAgICAgICAgICAgIHZhciBvcHRzID0gewogICAgICAgICAgICAgICAgcmVwbGFjZTogb3B0aW9ucy5yZXBsYWNlLAogICAgICAgICAgICAgICAgcHJldmVudFNjcm9sbFJlc2V0OiBvcHRpb25zLnByZXZlbnRTY3JvbGxSZXNldCwKICAgICAgICAgICAgICAgIGZvcm1EYXRhOiBmb3JtRGF0YSwKICAgICAgICAgICAgICAgIGZvcm1NZXRob2Q6IG1ldGhvZCwKICAgICAgICAgICAgICAgIGZvcm1FbmNUeXBlOiBlbmNUeXBlCiAgICAgICAgICAgICAgfTsKCiAgICAgICAgICAgICAgaWYgKGZldGNoZXJLZXkpIHsKICAgICAgICAgICAgICAgICEocm91dGVJZCAhPSBudWxsKSA/IGZhbHNlID8gMCA6IGludmFyaWFudChmYWxzZSkgOiB2b2lkIDA7CiAgICAgICAgICAgICAgICByb3V0ZXIuZmV0Y2goZmV0Y2hlcktleSwgcm91dGVJZCwgaHJlZiwgb3B0cyk7CiAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHJvdXRlci5uYXZpZ2F0ZShocmVmLCBvcHRzKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sIFtkZWZhdWx0QWN0aW9uLCByb3V0ZXIsIGZldGNoZXJLZXksIHJvdXRlSWRdKTsKICAgICAgICAgIH0KCiAgICAgICAgICBmdW5jdGlvbiB1c2VGb3JtQWN0aW9uKGFjdGlvbiwgX3RlbXAyKSB7CiAgICAgICAgICAgIHZhciBfcmVmMjEgPQoKICAgICAgICAgICAgICBfdGVtcDIgPT09IHZvaWQgMCA/IHt9IDogX3RlbXAyLHJlbGF0aXZlID0gX3JlZjIxLnJlbGF0aXZlOwogICAgICAgICAgICB2YXIgX1JlYWN0JHVzZUNvbnRleHQyID0KCiAgICAgICAgICAgICAgUmVhY3QudXNlQ29udGV4dChVTlNBRkVfTmF2aWdhdGlvbkNvbnRleHQpLGJhc2VuYW1lID0gX1JlYWN0JHVzZUNvbnRleHQyLmJhc2VuYW1lOwogICAgICAgICAgICB2YXIgcm91dGVDb250ZXh0ID0gUmVhY3QudXNlQ29udGV4dChVTlNBRkVfUm91dGVDb250ZXh0KTsKICAgICAgICAgICAgIXJvdXRlQ29udGV4dCA/IGZhbHNlID8gMCA6IGludmFyaWFudChmYWxzZSkgOiB2b2lkIDA7CiAgICAgICAgICAgIHZhciBfcm91dGVDb250ZXh0JG1hdGNoZXMgPSByb3V0ZUNvbnRleHQubWF0Y2hlcy5zbGljZSgtMSksX3JvdXRlQ29udGV4dCRtYXRjaGVzMiA9IF9zbGljZWRUb0FycmF5Mihfcm91dGVDb250ZXh0JG1hdGNoZXMsIDEpLG1hdGNoID0gX3JvdXRlQ29udGV4dCRtYXRjaGVzMlswXTsgLy8gU2hhbGxvdyBjbG9uZSBwYXRoIHNvIHdlIGNhbiBtb2RpZnkgaXQgYmVsb3csIG90aGVyd2lzZSB3ZSBtb2RpZnkgdGhlCiAgICAgICAgICAgIC8vIG9iamVjdCByZWZlcmVuY2VkIGJ5IHVzZU1lbW8gaW5zaWRlIHVzZVJlc29sdmVkUGF0aAoKICAgICAgICAgICAgdmFyIHBhdGggPSByZWFjdF9yb3V0ZXJfZG9tX2Rpc3RfZXh0ZW5kcyh7fSwgdXNlUmVzb2x2ZWRQYXRoKGFjdGlvbiA/IGFjdGlvbiA6ICIuIiwgewogICAgICAgICAgICAgIHJlbGF0aXZlOiByZWxhdGl2ZQogICAgICAgICAgICB9KSk7IC8vIFByZXZpb3VzbHkgd2Ugc2V0IHRoZSBkZWZhdWx0IGFjdGlvbiB0byAiLiIuIFRoZSBwcm9ibGVtIHdpdGggdGhpcyBpcyB0aGF0CiAgICAgICAgICAgIC8vIGB1c2VSZXNvbHZlZFBhdGgoIi4iKWAgZXhjbHVkZXMgc2VhcmNoIHBhcmFtcyBhbmQgdGhlIGhhc2ggb2YgdGhlIHJlc29sdmVkCiAgICAgICAgICAgIC8vIFVSTC4gVGhpcyBpcyB0aGUgaW50ZW5kZWQgYmVoYXZpb3Igb2Ygd2hlbiAiLiIgaXMgc3BlY2lmaWNhbGx5IHByb3ZpZGVkIGFzCiAgICAgICAgICAgIC8vIHRoZSBmb3JtIGFjdGlvbiwgYnV0IGluY29uc2lzdGVudCB3LyBicm93c2VycyB3aGVuIHRoZSBhY3Rpb24gaXMgb21pdHRlZC4KICAgICAgICAgICAgLy8gaHR0cHM6Ly9naXRodWIuY29tL3JlbWl4LXJ1bi9yZW1peC9pc3N1ZXMvOTI3CgoKICAgICAgICAgICAgdmFyIGxvY2F0aW9uID0gdXNlTG9jYXRpb24oKTsKCiAgICAgICAgICAgIGlmIChhY3Rpb24gPT0gbnVsbCkgewogICAgICAgICAgICAgIC8vIFNhZmUgdG8gd3JpdGUgdG8gdGhlc2UgZGlyZWN0bHkgaGVyZSBzaW5jZSBpZiBhY3Rpb24gd2FzIHVuZGVmaW5lZCwgd2UKICAgICAgICAgICAgICAvLyB3b3VsZCBoYXZlIGNhbGxlZCB1c2VSZXNvbHZlZFBhdGgoIi4iKSB3aGljaCB3aWxsIG5ldmVyIGluY2x1ZGUgYSBzZWFyY2gKICAgICAgICAgICAgICAvLyBvciBoYXNoCiAgICAgICAgICAgICAgcGF0aC5zZWFyY2ggPSBsb2NhdGlvbi5zZWFyY2g7CiAgICAgICAgICAgICAgcGF0aC5oYXNoID0gbG9jYXRpb24uaGFzaDsgLy8gV2hlbiBncmFiYmluZyBzZWFyY2ggcGFyYW1zIGZyb20gdGhlIFVSTCwgcmVtb3ZlIHRoZSBhdXRvbWF0aWNhbGx5CiAgICAgICAgICAgICAgLy8gaW5zZXJ0ZWQgP2luZGV4IHBhcmFtIHNvIHdlIG1hdGNoIHRoZSB1c2VSZXNvbHZlZFBhdGggc2VhcmNoIGJlaGF2aW9yCiAgICAgICAgICAgICAgLy8gd2hpY2ggd291bGQgbm90IGluY2x1ZGUgP2luZGV4CgogICAgICAgICAgICAgIGlmIChtYXRjaC5yb3V0ZS5pbmRleCkgewogICAgICAgICAgICAgICAgdmFyIHBhcmFtcyA9IG5ldyBVUkxTZWFyY2hQYXJhbXMocGF0aC5zZWFyY2gpOwogICAgICAgICAgICAgICAgcGFyYW1zLmRlbGV0ZSgiaW5kZXgiKTsKICAgICAgICAgICAgICAgIHBhdGguc2VhcmNoID0gcGFyYW1zLnRvU3RyaW5nKCkgPyAiPyIgKyBwYXJhbXMudG9TdHJpbmcoKSA6ICIiOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKCghYWN0aW9uIHx8IGFjdGlvbiA9PT0gIi4iKSAmJiBtYXRjaC5yb3V0ZS5pbmRleCkgewogICAgICAgICAgICAgIHBhdGguc2VhcmNoID0gcGF0aC5zZWFyY2ggPyBwYXRoLnNlYXJjaC5yZXBsYWNlKC9eXD8vLCAiP2luZGV4JiIpIDogIj9pbmRleCI7CiAgICAgICAgICAgIH0gLy8gSWYgd2UncmUgb3BlcmF0aW5nIHdpdGhpbiBhIGJhc2VuYW1lLCBwcmVwZW5kIGl0IHRvIHRoZSBwYXRobmFtZSBwcmlvcgogICAgICAgICAgICAvLyB0byBjcmVhdGluZyB0aGUgZm9ybSBhY3Rpb24uICBJZiB0aGlzIGlzIGEgcm9vdCBuYXZpZ2F0aW9uLCB0aGVuIGp1c3QgdXNlCiAgICAgICAgICAgIC8vIHRoZSByYXcgYmFzZW5hbWUgd2hpY2ggYWxsb3dzIHRoZSBiYXNlbmFtZSB0byBoYXZlIGZ1bGwgY29udHJvbCBvdmVyIHRoZQogICAgICAgICAgICAvLyBwcmVzZW5jZSBvZiBhIHRyYWlsaW5nIHNsYXNoIG9uIHJvb3QgYWN0aW9ucwoKCiAgICAgICAgICAgIGlmIChiYXNlbmFtZSAhPT0gIi8iKSB7CiAgICAgICAgICAgICAgcGF0aC5wYXRobmFtZSA9IHBhdGgucGF0aG5hbWUgPT09ICIvIiA/IGJhc2VuYW1lIDogam9pblBhdGhzKFtiYXNlbmFtZSwgcGF0aC5wYXRobmFtZV0pOwogICAgICAgICAgICB9CgogICAgICAgICAgICByZXR1cm4gY3JlYXRlUGF0aChwYXRoKTsKICAgICAgICAgIH0KCiAgICAgICAgICBmdW5jdGlvbiBjcmVhdGVGZXRjaGVyRm9ybShmZXRjaGVyS2V5LCByb3V0ZUlkKSB7CiAgICAgICAgICAgIHZhciBGZXRjaGVyRm9ybSA9IC8qI19fUFVSRV9fKi9SZWFjdC5mb3J3YXJkUmVmKChwcm9wcywgcmVmKSA9PiB7CiAgICAgICAgICAgICAgcmV0dXJuIC8qI19fUFVSRV9fKi9SZWFjdC5jcmVhdGVFbGVtZW50KEZvcm1JbXBsLCByZWFjdF9yb3V0ZXJfZG9tX2Rpc3RfZXh0ZW5kcyh7fSwgcHJvcHMsIHsKICAgICAgICAgICAgICAgIHJlZjogcmVmLAogICAgICAgICAgICAgICAgZmV0Y2hlcktleTogZmV0Y2hlcktleSwKICAgICAgICAgICAgICAgIHJvdXRlSWQ6IHJvdXRlSWQKICAgICAgICAgICAgICB9KSk7CiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgaWYgKGZhbHNlKSB7fQoKICAgICAgICAgICAgcmV0dXJuIEZldGNoZXJGb3JtOwogICAgICAgICAgfQoKICAgICAgICAgIHZhciBmZXRjaGVySWQgPSAwOwogICAgICAgICAgLyoqCiAgICAgICAgICAgKiBJbnRlcmFjdHMgd2l0aCByb3V0ZSBsb2FkZXJzIGFuZCBhY3Rpb25zIHdpdGhvdXQgY2F1c2luZyBhIG5hdmlnYXRpb24uIEdyZWF0CiAgICAgICAgICAgKiBmb3IgYW55IGludGVyYWN0aW9uIHRoYXQgc3RheXMgb24gdGhlIHNhbWUgcGFnZS4KICAgICAgICAgICAqLwoKICAgICAgICAgIGZ1bmN0aW9uIHVzZUZldGNoZXIoKSB7CiAgICAgICAgICAgIHZhciBfcm91dGUkbWF0Y2hlczsKCiAgICAgICAgICAgIHZhciBfZGlzdF91c2VEYXRhUm91dGVyQ28yID0KCiAgICAgICAgICAgICAgZGlzdF91c2VEYXRhUm91dGVyQ29udGV4dChkaXN0X0RhdGFSb3V0ZXJIb29rLlVzZUZldGNoZXIpLHJvdXRlciA9IF9kaXN0X3VzZURhdGFSb3V0ZXJDbzIucm91dGVyOwogICAgICAgICAgICB2YXIgcm91dGUgPSBSZWFjdC51c2VDb250ZXh0KFVOU0FGRV9Sb3V0ZUNvbnRleHQpOwogICAgICAgICAgICAhcm91dGUgPyBmYWxzZSA/IDAgOiBpbnZhcmlhbnQoZmFsc2UpIDogdm9pZCAwOwogICAgICAgICAgICB2YXIgcm91dGVJZCA9IChfcm91dGUkbWF0Y2hlcyA9IHJvdXRlLm1hdGNoZXNbcm91dGUubWF0Y2hlcy5sZW5ndGggLSAxXSkgPT0gbnVsbCA/IHZvaWQgMCA6IF9yb3V0ZSRtYXRjaGVzLnJvdXRlLmlkOwogICAgICAgICAgICAhKHJvdXRlSWQgIT0gbnVsbCkgPyBmYWxzZSA/IDAgOiBpbnZhcmlhbnQoZmFsc2UpIDogdm9pZCAwOwogICAgICAgICAgICB2YXIgX1JlYWN0JHVzZVN0YXRlOSA9IFJlYWN0LnVzZVN0YXRlKCgpID0+IFN0cmluZygrK2ZldGNoZXJJZCkpLF9SZWFjdCR1c2VTdGF0ZTEwID0gX3NsaWNlZFRvQXJyYXkyKF9SZWFjdCR1c2VTdGF0ZTksIDEpLGZldGNoZXJLZXkgPSBfUmVhY3QkdXNlU3RhdGUxMFswXTsKICAgICAgICAgICAgdmFyIF9SZWFjdCR1c2VTdGF0ZTExID0gUmVhY3QudXNlU3RhdGUoKCkgPT4gewogICAgICAgICAgICAgICAgIXJvdXRlSWQgPyBmYWxzZSA/IDAgOiBpbnZhcmlhbnQoZmFsc2UpIDogdm9pZCAwOwogICAgICAgICAgICAgICAgcmV0dXJuIGNyZWF0ZUZldGNoZXJGb3JtKGZldGNoZXJLZXksIHJvdXRlSWQpOwogICAgICAgICAgICAgIH0pLF9SZWFjdCR1c2VTdGF0ZTEyID0gX3NsaWNlZFRvQXJyYXkyKF9SZWFjdCR1c2VTdGF0ZTExLCAxKSxGb3JtID0gX1JlYWN0JHVzZVN0YXRlMTJbMF07CiAgICAgICAgICAgIHZhciBfUmVhY3QkdXNlU3RhdGUxMyA9IFJlYWN0LnVzZVN0YXRlKCgpID0+IChocmVmKSA9PiB7CiAgICAgICAgICAgICAgICAhcm91dGVyID8gZmFsc2UgPyAwIDogaW52YXJpYW50KGZhbHNlKSA6IHZvaWQgMDsKICAgICAgICAgICAgICAgICFyb3V0ZUlkID8gZmFsc2UgPyAwIDogaW52YXJpYW50KGZhbHNlKSA6IHZvaWQgMDsKICAgICAgICAgICAgICAgIHJvdXRlci5mZXRjaChmZXRjaGVyS2V5LCByb3V0ZUlkLCBocmVmKTsKICAgICAgICAgICAgICB9KSxfUmVhY3QkdXNlU3RhdGUxNCA9IF9zbGljZWRUb0FycmF5MihfUmVhY3QkdXNlU3RhdGUxMywgMSksbG9hZCA9IF9SZWFjdCR1c2VTdGF0ZTE0WzBdOwogICAgICAgICAgICB2YXIgc3VibWl0ID0gdXNlU3VibWl0SW1wbChmZXRjaGVyS2V5LCByb3V0ZUlkKTsKICAgICAgICAgICAgdmFyIGZldGNoZXIgPSByb3V0ZXIuZ2V0RmV0Y2hlcihmZXRjaGVyS2V5KTsKICAgICAgICAgICAgdmFyIGZldGNoZXJXaXRoQ29tcG9uZW50cyA9IFJlYWN0LnVzZU1lbW8oKCkgPT4gcmVhY3Rfcm91dGVyX2RvbV9kaXN0X2V4dGVuZHMoewogICAgICAgICAgICAgIEZvcm06IEZvcm0sCiAgICAgICAgICAgICAgc3VibWl0OiBzdWJtaXQsCiAgICAgICAgICAgICAgbG9hZDogbG9hZAogICAgICAgICAgICB9LCBmZXRjaGVyKSwgW2ZldGNoZXIsIEZvcm0sIHN1Ym1pdCwgbG9hZF0pOwogICAgICAgICAgICBSZWFjdC51c2VFZmZlY3QoKCkgPT4gewogICAgICAgICAgICAgIC8vIElzIHRoaXMgYnVzdGVkIHdoZW4gdGhlIFJlYWN0IHRlYW0gZ2V0cyByZWFsIHdlaXJkIGFuZCBjYWxscyBlZmZlY3RzCiAgICAgICAgICAgICAgLy8gdHdpY2Ugb24gbW91bnQ/ICBXZSByZWFsbHkganVzdCBuZWVkIHRvIGdhcmJhZ2UgY29sbGVjdCBoZXJlIHdoZW4gdGhpcwogICAgICAgICAgICAgIC8vIGZldGNoZXIgaXMgbm8gbG9uZ2VyIGFyb3VuZC4KICAgICAgICAgICAgICByZXR1cm4gKCkgPT4gewogICAgICAgICAgICAgICAgaWYgKCFyb3V0ZXIpIHsKICAgICAgICAgICAgICAgICAgY29uc29sZS53YXJuKCJObyBmZXRjaGVyIGF2YWlsYWJsZSB0byBjbGVhbiB1cCBmcm9tIHVzZUZldGNoZXIoKSIpOwogICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgcm91dGVyLmRlbGV0ZUZldGNoZXIoZmV0Y2hlcktleSk7CiAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgfSwgW3JvdXRlciwgZmV0Y2hlcktleV0pOwogICAgICAgICAgICByZXR1cm4gZmV0Y2hlcldpdGhDb21wb25lbnRzOwogICAgICAgICAgfQogICAgICAgICAgLyoqCiAgICAgICAgICAgKiBQcm92aWRlcyBhbGwgZmV0Y2hlcnMgY3VycmVudGx5IG9uIHRoZSBwYWdlLiBVc2VmdWwgZm9yIGxheW91dHMgYW5kIHBhcmVudAogICAgICAgICAgICogcm91dGVzIHRoYXQgbmVlZCB0byBwcm92aWRlIHBlbmRpbmcvb3B0aW1pc3RpYyBVSSByZWdhcmRpbmcgdGhlIGZldGNoLgogICAgICAgICAgICovCgogICAgICAgICAgZnVuY3Rpb24gdXNlRmV0Y2hlcnMoKSB7CiAgICAgICAgICAgIHZhciBzdGF0ZSA9IGRpc3RfdXNlRGF0YVJvdXRlclN0YXRlKGRpc3RfRGF0YVJvdXRlclN0YXRlSG9vay5Vc2VGZXRjaGVycyk7CiAgICAgICAgICAgIHJldHVybiBfdG9Db25zdW1hYmxlQXJyYXkyKHN0YXRlLmZldGNoZXJzLnZhbHVlcygpKTsKICAgICAgICAgIH0KICAgICAgICAgIHZhciBTQ1JPTExfUkVTVE9SQVRJT05fU1RPUkFHRV9LRVkgPSAicmVhY3Qtcm91dGVyLXNjcm9sbC1wb3NpdGlvbnMiOwogICAgICAgICAgdmFyIHNhdmVkU2Nyb2xsUG9zaXRpb25zID0ge307CiAgICAgICAgICAvKioKICAgICAgICAgICAqIFdoZW4gcmVuZGVyZWQgaW5zaWRlIGEgUm91dGVyUHJvdmlkZXIsIHdpbGwgcmVzdG9yZSBzY3JvbGwgcG9zaXRpb25zIG9uIG5hdmlnYXRpb25zCiAgICAgICAgICAgKi8KCiAgICAgICAgICBmdW5jdGlvbiB1c2VTY3JvbGxSZXN0b3JhdGlvbihfdGVtcDMpIHsKICAgICAgICAgICAgdmFyIF9yZWYyMiA9CgoKICAgICAgICAgICAgICBfdGVtcDMgPT09IHZvaWQgMCA/IHt9IDogX3RlbXAzLGdldEtleSA9IF9yZWYyMi5nZXRLZXksc3RvcmFnZUtleSA9IF9yZWYyMi5zdG9yYWdlS2V5OwogICAgICAgICAgICB2YXIgX2Rpc3RfdXNlRGF0YVJvdXRlckNvMyA9CgogICAgICAgICAgICAgIGRpc3RfdXNlRGF0YVJvdXRlckNvbnRleHQoZGlzdF9EYXRhUm91dGVySG9vay5Vc2VTY3JvbGxSZXN0b3JhdGlvbikscm91dGVyID0gX2Rpc3RfdXNlRGF0YVJvdXRlckNvMy5yb3V0ZXI7CiAgICAgICAgICAgIHZhciBfZGlzdF91c2VEYXRhUm91dGVyU3QgPQoKCiAgICAgICAgICAgICAgZGlzdF91c2VEYXRhUm91dGVyU3RhdGUoZGlzdF9EYXRhUm91dGVyU3RhdGVIb29rLlVzZVNjcm9sbFJlc3RvcmF0aW9uKSxyZXN0b3JlU2Nyb2xsUG9zaXRpb24gPSBfZGlzdF91c2VEYXRhUm91dGVyU3QucmVzdG9yZVNjcm9sbFBvc2l0aW9uLHByZXZlbnRTY3JvbGxSZXNldCA9IF9kaXN0X3VzZURhdGFSb3V0ZXJTdC5wcmV2ZW50U2Nyb2xsUmVzZXQ7CiAgICAgICAgICAgIHZhciBsb2NhdGlvbiA9IHVzZUxvY2F0aW9uKCk7CiAgICAgICAgICAgIHZhciBtYXRjaGVzID0gdXNlTWF0Y2hlcygpOwogICAgICAgICAgICB2YXIgbmF2aWdhdGlvbiA9IHVzZU5hdmlnYXRpb24oKTsgLy8gVHJpZ2dlciBtYW51YWwgc2Nyb2xsIHJlc3RvcmF0aW9uIHdoaWxlIHdlJ3JlIGFjdGl2ZQoKICAgICAgICAgICAgUmVhY3QudXNlRWZmZWN0KCgpID0+IHsKICAgICAgICAgICAgICB3aW5kb3cuaGlzdG9yeS5zY3JvbGxSZXN0b3JhdGlvbiA9ICJtYW51YWwiOwogICAgICAgICAgICAgIHJldHVybiAoKSA9PiB7CiAgICAgICAgICAgICAgICB3aW5kb3cuaGlzdG9yeS5zY3JvbGxSZXN0b3JhdGlvbiA9ICJhdXRvIjsKICAgICAgICAgICAgICB9OwogICAgICAgICAgICB9LCBbXSk7IC8vIFNhdmUgcG9zaXRpb25zIG9uIHBhZ2VoaWRlCgogICAgICAgICAgICB1c2VQYWdlSGlkZShSZWFjdC51c2VDYWxsYmFjaygoKSA9PiB7CiAgICAgICAgICAgICAgaWYgKG5hdmlnYXRpb24uc3RhdGUgPT09ICJpZGxlIikgewogICAgICAgICAgICAgICAgdmFyIGtleSA9IChnZXRLZXkgPyBnZXRLZXkobG9jYXRpb24sIG1hdGNoZXMpIDogbnVsbCkgfHwgbG9jYXRpb24ua2V5OwogICAgICAgICAgICAgICAgc2F2ZWRTY3JvbGxQb3NpdGlvbnNba2V5XSA9IHdpbmRvdy5zY3JvbGxZOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgc2Vzc2lvblN0b3JhZ2Uuc2V0SXRlbShzdG9yYWdlS2V5IHx8IFNDUk9MTF9SRVNUT1JBVElPTl9TVE9SQUdFX0tFWSwgSlNPTi5zdHJpbmdpZnkoc2F2ZWRTY3JvbGxQb3NpdGlvbnMpKTsKICAgICAgICAgICAgICB3aW5kb3cuaGlzdG9yeS5zY3JvbGxSZXN0b3JhdGlvbiA9ICJhdXRvIjsKICAgICAgICAgICAgfSwgW3N0b3JhZ2VLZXksIGdldEtleSwgbmF2aWdhdGlvbi5zdGF0ZSwgbG9jYXRpb24sIG1hdGNoZXNdKSk7IC8vIFJlYWQgaW4gYW55IHNhdmVkIHNjcm9sbCBsb2NhdGlvbnMKCiAgICAgICAgICAgIGlmICh0eXBlb2YgZG9jdW1lbnQgIT09ICJ1bmRlZmluZWQiKSB7CiAgICAgICAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIHJlYWN0LWhvb2tzL3J1bGVzLW9mLWhvb2tzCiAgICAgICAgICAgICAgUmVhY3QudXNlTGF5b3V0RWZmZWN0KCgpID0+IHsKICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgIHZhciBzZXNzaW9uUG9zaXRpb25zID0gc2Vzc2lvblN0b3JhZ2UuZ2V0SXRlbShzdG9yYWdlS2V5IHx8IFNDUk9MTF9SRVNUT1JBVElPTl9TVE9SQUdFX0tFWSk7CgogICAgICAgICAgICAgICAgICBpZiAoc2Vzc2lvblBvc2l0aW9ucykgewogICAgICAgICAgICAgICAgICAgIHNhdmVkU2Nyb2xsUG9zaXRpb25zID0gSlNPTi5wYXJzZShzZXNzaW9uUG9zaXRpb25zKTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgICAgICAgICAgICAvLyBuby1vcCwgdXNlIGRlZmF1bHQgZW1wdHkgb2JqZWN0CiAgICAgICAgICAgICAgICB9fSwgW3N0b3JhZ2VLZXldKTsgLy8gRW5hYmxlIHNjcm9sbCByZXN0b3JhdGlvbiBpbiB0aGUgcm91dGVyCiAgICAgICAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIHJlYWN0LWhvb2tzL3J1bGVzLW9mLWhvb2tzCgogICAgICAgICAgICAgIFJlYWN0LnVzZUxheW91dEVmZmVjdCgoKSA9PiB7CiAgICAgICAgICAgICAgICB2YXIgZGlzYWJsZVNjcm9sbFJlc3RvcmF0aW9uID0gcm91dGVyID09IG51bGwgPyB2b2lkIDAgOiByb3V0ZXIuZW5hYmxlU2Nyb2xsUmVzdG9yYXRpb24oc2F2ZWRTY3JvbGxQb3NpdGlvbnMsICgpID0+IHdpbmRvdy5zY3JvbGxZLCBnZXRLZXkpOwogICAgICAgICAgICAgICAgcmV0dXJuICgpID0+IGRpc2FibGVTY3JvbGxSZXN0b3JhdGlvbiAmJiBkaXNhYmxlU2Nyb2xsUmVzdG9yYXRpb24oKTsKICAgICAgICAgICAgICB9LCBbcm91dGVyLCBnZXRLZXldKTsgLy8gUmVzdG9yZSBzY3JvbGxpbmcgd2hlbiBzdGF0ZS5yZXN0b3JlU2Nyb2xsUG9zaXRpb24gY2hhbmdlcwogICAgICAgICAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSByZWFjdC1ob29rcy9ydWxlcy1vZi1ob29rcwoKICAgICAgICAgICAgICBSZWFjdC51c2VMYXlvdXRFZmZlY3QoKCkgPT4gewogICAgICAgICAgICAgICAgLy8gRXhwbGljaXQgZmFsc2UgbWVhbnMgZG9uJ3QgZG8gYW55dGhpbmcgKHVzZWQgZm9yIHN1Ym1pc3Npb25zKQogICAgICAgICAgICAgICAgaWYgKHJlc3RvcmVTY3JvbGxQb3NpdGlvbiA9PT0gZmFsc2UpIHsKICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgfSAvLyBiZWVuIGhlcmUgYmVmb3JlLCBzY3JvbGwgdG8gaXQKCgogICAgICAgICAgICAgICAgaWYgKHR5cGVvZiByZXN0b3JlU2Nyb2xsUG9zaXRpb24gPT09ICJudW1iZXIiKSB7CiAgICAgICAgICAgICAgICAgIHdpbmRvdy5zY3JvbGxUbygwLCByZXN0b3JlU2Nyb2xsUG9zaXRpb24pOwogICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICB9IC8vIHRyeSB0byBzY3JvbGwgdG8gdGhlIGhhc2gKCgogICAgICAgICAgICAgICAgaWYgKGxvY2F0aW9uLmhhc2gpIHsKICAgICAgICAgICAgICAgICAgdmFyIGVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQobG9jYXRpb24uaGFzaC5zbGljZSgxKSk7CgogICAgICAgICAgICAgICAgICBpZiAoZWwpIHsKICAgICAgICAgICAgICAgICAgICBlbC5zY3JvbGxJbnRvVmlldygpOwogICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSAvLyBEb24ndCByZXNldCBpZiB0aGlzIG5hdmlnYXRpb24gb3B0ZWQgb3V0CgoKICAgICAgICAgICAgICAgIGlmIChwcmV2ZW50U2Nyb2xsUmVzZXQgPT09IHRydWUpIHsKICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgfSAvLyBvdGhlcndpc2UgZ28gdG8gdGhlIHRvcCBvbiBuZXcgbG9jYXRpb25zCgoKICAgICAgICAgICAgICAgIHdpbmRvdy5zY3JvbGxUbygwLCAwKTsKICAgICAgICAgICAgICB9LCBbbG9jYXRpb24sIHJlc3RvcmVTY3JvbGxQb3NpdGlvbiwgcHJldmVudFNjcm9sbFJlc2V0XSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIC8qKgogICAgICAgICAgICogU2V0dXAgYSBjYWxsYmFjayB0byBiZSBmaXJlZCBvbiB0aGUgd2luZG93J3MgYGJlZm9yZXVubG9hZGAgZXZlbnQuIFRoaXMgaXMKICAgICAgICAgICAqIHVzZWZ1bCBmb3Igc2F2aW5nIHNvbWUgZGF0YSB0byBgd2luZG93LmxvY2FsU3RvcmFnZWAganVzdCBiZWZvcmUgdGhlIHBhZ2UKICAgICAgICAgICAqIHJlZnJlc2hlcy4KICAgICAgICAgICAqCiAgICAgICAgICAgKiBOb3RlOiBUaGUgYGNhbGxiYWNrYCBhcmd1bWVudCBzaG91bGQgYmUgYSBmdW5jdGlvbiBjcmVhdGVkIHdpdGgKICAgICAgICAgICAqIGBSZWFjdC51c2VDYWxsYmFjaygpYC4KICAgICAgICAgICAqLwoKCiAgICAgICAgICBmdW5jdGlvbiB1c2VCZWZvcmVVbmxvYWQoY2FsbGJhY2ssIG9wdGlvbnMpIHsKICAgICAgICAgICAgdmFyIF9yZWYyMyA9CgogICAgICAgICAgICAgIG9wdGlvbnMgfHwge30sY2FwdHVyZSA9IF9yZWYyMy5jYXB0dXJlOwogICAgICAgICAgICBSZWFjdC51c2VFZmZlY3QoKCkgPT4gewogICAgICAgICAgICAgIHZhciBvcHRzID0gY2FwdHVyZSAhPSBudWxsID8gewogICAgICAgICAgICAgICAgY2FwdHVyZTogY2FwdHVyZQogICAgICAgICAgICAgIH0gOiB1bmRlZmluZWQ7CiAgICAgICAgICAgICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoImJlZm9yZXVubG9hZCIsIGNhbGxiYWNrLCBvcHRzKTsKICAgICAgICAgICAgICByZXR1cm4gKCkgPT4gewogICAgICAgICAgICAgICAgd2luZG93LnJlbW92ZUV2ZW50TGlzdGVuZXIoImJlZm9yZXVubG9hZCIsIGNhbGxiYWNrLCBvcHRzKTsKICAgICAgICAgICAgICB9OwogICAgICAgICAgICB9LCBbY2FsbGJhY2ssIGNhcHR1cmVdKTsKICAgICAgICAgIH0KICAgICAgICAgIC8qKgogICAgICAgICAgICogU2V0dXAgYSBjYWxsYmFjayB0byBiZSBmaXJlZCBvbiB0aGUgd2luZG93J3MgYHBhZ2VoaWRlYCBldmVudC4gVGhpcyBpcwogICAgICAgICAgICogdXNlZnVsIGZvciBzYXZpbmcgc29tZSBkYXRhIHRvIGB3aW5kb3cubG9jYWxTdG9yYWdlYCBqdXN0IGJlZm9yZSB0aGUgcGFnZQogICAgICAgICAgICogcmVmcmVzaGVzLiAgVGhpcyBldmVudCBpcyBiZXR0ZXIgc3VwcG9ydGVkIHRoYW4gYmVmb3JldW5sb2FkIGFjcm9zcyBicm93c2Vycy4KICAgICAgICAgICAqCiAgICAgICAgICAgKiBOb3RlOiBUaGUgYGNhbGxiYWNrYCBhcmd1bWVudCBzaG91bGQgYmUgYSBmdW5jdGlvbiBjcmVhdGVkIHdpdGgKICAgICAgICAgICAqIGBSZWFjdC51c2VDYWxsYmFjaygpYC4KICAgICAgICAgICAqLwoKICAgICAgICAgIGZ1bmN0aW9uIHVzZVBhZ2VIaWRlKGNhbGxiYWNrLCBvcHRpb25zKSB7CiAgICAgICAgICAgIHZhciBfcmVmMjQgPQoKICAgICAgICAgICAgICBvcHRpb25zIHx8IHt9LGNhcHR1cmUgPSBfcmVmMjQuY2FwdHVyZTsKICAgICAgICAgICAgUmVhY3QudXNlRWZmZWN0KCgpID0+IHsKICAgICAgICAgICAgICB2YXIgb3B0cyA9IGNhcHR1cmUgIT0gbnVsbCA/IHsKICAgICAgICAgICAgICAgIGNhcHR1cmU6IGNhcHR1cmUKICAgICAgICAgICAgICB9IDogdW5kZWZpbmVkOwogICAgICAgICAgICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCJwYWdlaGlkZSIsIGNhbGxiYWNrLCBvcHRzKTsKICAgICAgICAgICAgICByZXR1cm4gKCkgPT4gewogICAgICAgICAgICAgICAgd2luZG93LnJlbW92ZUV2ZW50TGlzdGVuZXIoInBhZ2VoaWRlIiwgY2FsbGJhY2ssIG9wdHMpOwogICAgICAgICAgICAgIH07CiAgICAgICAgICAgIH0sIFtjYWxsYmFjaywgY2FwdHVyZV0pOwogICAgICAgICAgfQogICAgICAgICAgLyoqCiAgICAgICAgICAgKiBXcmFwcGVyIGFyb3VuZCB1c2VCbG9ja2VyIHRvIHNob3cgYSB3aW5kb3cuY29uZmlybSBwcm9tcHQgdG8gdXNlcnMgaW5zdGVhZAogICAgICAgICAgICogb2YgYnVpbGRpbmcgYSBjdXN0b20gVUkgd2l0aCB1c2VCbG9ja2VyLgogICAgICAgICAgICoKICAgICAgICAgICAqIFdhcm5pbmc6IFRoaXMgaGFzICphIGxvdCBvZiByb3VnaCBlZGdlcyogYW5kIGJlaGF2ZXMgdmVyeSBkaWZmZXJlbnRseSAoYW5kCiAgICAgICAgICAgKiB2ZXJ5IGluY29ycmVjdGx5IGluIHNvbWUgY2FzZXMpIGFjcm9zcyBicm93c2VycyBpZiB1c2VyIGNsaWNrIGFkZGl0aW9uCiAgICAgICAgICAgKiBiYWNrL2ZvcndhcmQgbmF2aWdhdGlvbnMgd2hpbGUgdGhlIGNvbmZpcm0gaXMgb3Blbi4gIFVzZSBhdCB5b3VyIG93biByaXNrLgogICAgICAgICAgICovCgoKICAgICAgICAgIGZ1bmN0aW9uIHVzZVByb21wdChfcmVmOCkgewogICAgICAgICAgICB2YXIKICAgICAgICAgICAgICB3aGVuID0KCiAgICAgICAgICAgICAgX3JlZjgud2hlbixtZXNzYWdlID0gX3JlZjgubWVzc2FnZTsKICAgICAgICAgICAgdmFyIGJsb2NrZXIgPSB1bnN0YWJsZV91c2VCbG9ja2VyKHdoZW4pOwogICAgICAgICAgICBSZWFjdC51c2VFZmZlY3QoKCkgPT4gewogICAgICAgICAgICAgIGlmIChibG9ja2VyLnN0YXRlID09PSAiYmxvY2tlZCIgJiYgIXdoZW4pIHsKICAgICAgICAgICAgICAgIGJsb2NrZXIucmVzZXQoKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sIFtibG9ja2VyLCB3aGVuXSk7CiAgICAgICAgICAgIFJlYWN0LnVzZUVmZmVjdCgoKSA9PiB7CiAgICAgICAgICAgICAgaWYgKGJsb2NrZXIuc3RhdGUgPT09ICJibG9ja2VkIikgewogICAgICAgICAgICAgICAgdmFyIHByb2NlZWQgPSB3aW5kb3cuY29uZmlybShtZXNzYWdlKTsKCiAgICAgICAgICAgICAgICBpZiAocHJvY2VlZCkgewogICAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KGJsb2NrZXIucHJvY2VlZCwgMCk7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICBibG9ja2VyLnJlc2V0KCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LCBbYmxvY2tlciwgbWVzc2FnZV0pOwogICAgICAgICAgfQogICAgICAgICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KICAgICAgICAgIC8vI3JlZ2lvbiBVdGlscwogICAgICAgICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KCiAgICAgICAgICBmdW5jdGlvbiBkaXN0X3dhcm5pbmcoY29uZCwgbWVzc2FnZSkgewogICAgICAgICAgICBpZiAoIWNvbmQpIHsKICAgICAgICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tY29uc29sZQogICAgICAgICAgICAgIGlmICh0eXBlb2YgY29uc29sZSAhPT0gInVuZGVmaW5lZCIpIGNvbnNvbGUud2FybihtZXNzYWdlKTsKCiAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIC8vIFdlbGNvbWUgdG8gZGVidWdnaW5nIFJlYWN0IFJvdXRlciEKICAgICAgICAgICAgICAgIC8vCiAgICAgICAgICAgICAgICAvLyBUaGlzIGVycm9yIGlzIHRocm93biBhcyBhIGNvbnZlbmllbmNlIHNvIHlvdSBjYW4gbW9yZSBlYXNpbHkKICAgICAgICAgICAgICAgIC8vIGZpbmQgdGhlIHNvdXJjZSBmb3IgYSB3YXJuaW5nIHRoYXQgYXBwZWFycyBpbiB0aGUgY29uc29sZSBieQogICAgICAgICAgICAgICAgLy8gZW5hYmxpbmcgInBhdXNlIG9uIGV4Y2VwdGlvbnMiIGluIHlvdXIgSmF2YVNjcmlwdCBkZWJ1Z2dlci4KICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihtZXNzYWdlKTsgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG5vLWVtcHR5CiAgICAgICAgICAgICAgfSBjYXRjaCAoZSkge30KICAgICAgICAgICAgfQogICAgICAgICAgfSAvLyNlbmRyZWdpb24KCgoKCiAgICAgICAgICA7IC8vIENPTkNBVEVOQVRFRCBNT0RVTEU6IC4vc3JjL3JlbGF5L2NvbXBvbmVudHMvTGF5b3V0LnRzeAoKCgoKICAgICAgICAgIHZhciBMYXlvdXQgPSBmdW5jdGlvbiBMYXlvdXQoX3JlZikge3ZhciBwYWdlcyA9IF9yZWYucGFnZXM7CiAgICAgICAgICAgIHZhciBvdXRsZXQgPSAvKiNfX1BVUkVfXyovCiAgICAgICAgICAgIHJlYWN0LmNyZWF0ZUVsZW1lbnQocmVhY3QuRnJhZ21lbnQsIG51bGwsIC8qI19fUFVSRV9fKi8KICAgICAgICAgICAgcmVhY3QuY3JlYXRlRWxlbWVudCgiZGl2IiwgeyBpZDogIm5vdGlmaWNhdGlvbnNDb250YWluZXIiIH0pLCAvKiNfX1BVUkVfXyovCiAgICAgICAgICAgIHJlYWN0LmNyZWF0ZUVsZW1lbnQoImRpdiIsIHsgaWQ6ICJyZWxheUNvbnRhaW5lciIgfSwgLyojX19QVVJFX18qLwogICAgICAgICAgICByZWFjdC5jcmVhdGVFbGVtZW50KE91dGxldCwgbnVsbCkpKTsKCgoKCiAgICAgICAgICAgIGlmIChwYWdlcy5sZW5ndGggPD0gMSkgewogICAgICAgICAgICAgIHJldHVybiBvdXRsZXQ7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybiAvKiNfX1BVUkVfXyovKAogICAgICAgICAgICAgIHJlYWN0LmNyZWF0ZUVsZW1lbnQocmVhY3QuRnJhZ21lbnQsIG51bGwsCiAgICAgICAgICAgICAgIiAiLCAvKiNfX1BVUkVfXyovCiAgICAgICAgICAgICAgcmVhY3QuY3JlYXRlRWxlbWVudCgibmF2IiwgbnVsbCwgLyojX19QVVJFX18qLwogICAgICAgICAgICAgIHJlYWN0LmNyZWF0ZUVsZW1lbnQoImRpdiIsIHsgY2xhc3NOYW1lOiAidG9wQmFyIiB9LAogICAgICAgICAgICAgICIgIiwKICAgICAgICAgICAgICBwYWdlcy5tYXAoZnVuY3Rpb24gKHApIHtyZXR1cm4gLyojX19QVVJFX18qLygKICAgICAgICAgICAgICAgICAgcmVhY3QuY3JlYXRlRWxlbWVudCgiZGl2IiwgeyBrZXk6ICIiLmNvbmNhdChwLmZpbGUsICIgIikuY29uY2F0KHAucGFnZSksIGNsYXNzTmFtZTogInRhYkVudHJ5IiB9LCAvKiNfX1BVUkVfXyovCiAgICAgICAgICAgICAgICAgIHJlYWN0LmNyZWF0ZUVsZW1lbnQoTmF2TGluaywgeyB0bzogIi8iICsgcC5maWxlIH0sIHAucGFnZSksICIgIikpO30pKSksCgoKCiAgICAgICAgICAgICAgIiAiLAogICAgICAgICAgICAgIG91dGxldCkpOwoKCiAgICAgICAgICB9OwoKICAgICAgICAgIC8qIGhhcm1vbnkgZGVmYXVsdCBleHBvcnQgKi92YXIgY29tcG9uZW50c19MYXlvdXQgPSBMYXlvdXQ7CiAgICAgICAgICA7IC8vIENPTkNBVEVOQVRFRCBNT0RVTEU6IC4vc3JjL3JlbGF5L2FwaS9BcGlSZXF1ZXN0LnRzeAogICAgICAgICAgZnVuY3Rpb24gX3R5cGVvZihvYmopIHsiQGJhYmVsL2hlbHBlcnMgLSB0eXBlb2YiO3JldHVybiBfdHlwZW9mID0gImZ1bmN0aW9uIiA9PSB0eXBlb2YgU3ltYm9sICYmICJzeW1ib2wiID09IHR5cGVvZiBTeW1ib2wuaXRlcmF0b3IgPyBmdW5jdGlvbiAob2JqKSB7cmV0dXJuIHR5cGVvZiBvYmo7fSA6IGZ1bmN0aW9uIChvYmopIHtyZXR1cm4gb2JqICYmICJmdW5jdGlvbiIgPT0gdHlwZW9mIFN5bWJvbCAmJiBvYmouY29uc3RydWN0b3IgPT09IFN5bWJvbCAmJiBvYmogIT09IFN5bWJvbC5wcm90b3R5cGUgPyAic3ltYm9sIiA6IHR5cGVvZiBvYmo7fSwgX3R5cGVvZihvYmopO31mdW5jdGlvbiBfcmVnZW5lcmF0b3JSdW50aW1lKCkgeyJ1c2Ugc3RyaWN0IjsKICAgICAgICAgICAgLyohIHJlZ2VuZXJhdG9yLXJ1bnRpbWUgLS0gQ29weXJpZ2h0IChjKSAyMDE0LXByZXNlbnQsIEZhY2Vib29rLCBJbmMuIC0tIGxpY2Vuc2UgKE1JVCk6IGh0dHBzOi8vZ2l0aHViLmNvbS9mYWNlYm9vay9yZWdlbmVyYXRvci9ibG9iL21haW4vTElDRU5TRSAqL19yZWdlbmVyYXRvclJ1bnRpbWUgPSBmdW5jdGlvbiBfcmVnZW5lcmF0b3JSdW50aW1lKCkge3JldHVybiBleHBvcnRzO307dmFyIGV4cG9ydHMgPSB7fSxPcCA9IE9iamVjdC5wcm90b3R5cGUsaGFzT3duID0gT3AuaGFzT3duUHJvcGVydHksZGVmaW5lUHJvcGVydHkgPSBPYmplY3QuZGVmaW5lUHJvcGVydHkgfHwgZnVuY3Rpb24gKG9iaiwga2V5LCBkZXNjKSB7b2JqW2tleV0gPSBkZXNjLnZhbHVlO30sJFN5bWJvbCA9ICJmdW5jdGlvbiIgPT0gdHlwZW9mIFN5bWJvbCA/IFN5bWJvbCA6IHt9LGl0ZXJhdG9yU3ltYm9sID0gJFN5bWJvbC5pdGVyYXRvciB8fCAiQEBpdGVyYXRvciIsYXN5bmNJdGVyYXRvclN5bWJvbCA9ICRTeW1ib2wuYXN5bmNJdGVyYXRvciB8fCAiQEBhc3luY0l0ZXJhdG9yIix0b1N0cmluZ1RhZ1N5bWJvbCA9ICRTeW1ib2wudG9TdHJpbmdUYWcgfHwgIkBAdG9TdHJpbmdUYWciO2Z1bmN0aW9uIGRlZmluZShvYmosIGtleSwgdmFsdWUpIHtyZXR1cm4gT2JqZWN0LmRlZmluZVByb3BlcnR5KG9iaiwga2V5LCB7IHZhbHVlOiB2YWx1ZSwgZW51bWVyYWJsZTogITAsIGNvbmZpZ3VyYWJsZTogITAsIHdyaXRhYmxlOiAhMCB9KSwgb2JqW2tleV07fXRyeSB7ZGVmaW5lKHt9LCAiIik7fSBjYXRjaCAoZXJyKSB7ZGVmaW5lID0gZnVuY3Rpb24gZGVmaW5lKG9iaiwga2V5LCB2YWx1ZSkge3JldHVybiBvYmpba2V5XSA9IHZhbHVlO307fWZ1bmN0aW9uIHdyYXAoaW5uZXJGbiwgb3V0ZXJGbiwgc2VsZiwgdHJ5TG9jc0xpc3QpIHt2YXIgcHJvdG9HZW5lcmF0b3IgPSBvdXRlckZuICYmIG91dGVyRm4ucHJvdG90eXBlIGluc3RhbmNlb2YgR2VuZXJhdG9yID8gb3V0ZXJGbiA6IEdlbmVyYXRvcixnZW5lcmF0b3IgPSBPYmplY3QuY3JlYXRlKHByb3RvR2VuZXJhdG9yLnByb3RvdHlwZSksY29udGV4dCA9IG5ldyBDb250ZXh0KHRyeUxvY3NMaXN0IHx8IFtdKTtyZXR1cm4gZGVmaW5lUHJvcGVydHkoZ2VuZXJhdG9yLCAiX2ludm9rZSIsIHsgdmFsdWU6IG1ha2VJbnZva2VNZXRob2QoaW5uZXJGbiwgc2VsZiwgY29udGV4dCkgfSksIGdlbmVyYXRvcjt9ZnVuY3Rpb24gdHJ5Q2F0Y2goZm4sIG9iaiwgYXJnKSB7dHJ5IHtyZXR1cm4geyB0eXBlOiAibm9ybWFsIiwgYXJnOiBmbi5jYWxsKG9iaiwgYXJnKSB9O30gY2F0Y2ggKGVycikge3JldHVybiB7IHR5cGU6ICJ0aHJvdyIsIGFyZzogZXJyIH07fX1leHBvcnRzLndyYXAgPSB3cmFwO3ZhciBDb250aW51ZVNlbnRpbmVsID0ge307ZnVuY3Rpb24gR2VuZXJhdG9yKCkge31mdW5jdGlvbiBHZW5lcmF0b3JGdW5jdGlvbigpIHt9ZnVuY3Rpb24gR2VuZXJhdG9yRnVuY3Rpb25Qcm90b3R5cGUoKSB7fXZhciBJdGVyYXRvclByb3RvdHlwZSA9IHt9O2RlZmluZShJdGVyYXRvclByb3RvdHlwZSwgaXRlcmF0b3JTeW1ib2wsIGZ1bmN0aW9uICgpIHtyZXR1cm4gdGhpczt9KTt2YXIgZ2V0UHJvdG8gPSBPYmplY3QuZ2V0UHJvdG90eXBlT2YsTmF0aXZlSXRlcmF0b3JQcm90b3R5cGUgPSBnZXRQcm90byAmJiBnZXRQcm90byhnZXRQcm90byh2YWx1ZXMoW10pKSk7TmF0aXZlSXRlcmF0b3JQcm90b3R5cGUgJiYgTmF0aXZlSXRlcmF0b3JQcm90b3R5cGUgIT09IE9wICYmIGhhc093bi5jYWxsKE5hdGl2ZUl0ZXJhdG9yUHJvdG90eXBlLCBpdGVyYXRvclN5bWJvbCkgJiYgKEl0ZXJhdG9yUHJvdG90eXBlID0gTmF0aXZlSXRlcmF0b3JQcm90b3R5cGUpO3ZhciBHcCA9IEdlbmVyYXRvckZ1bmN0aW9uUHJvdG90eXBlLnByb3RvdHlwZSA9IEdlbmVyYXRvci5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKEl0ZXJhdG9yUHJvdG90eXBlKTtmdW5jdGlvbiBkZWZpbmVJdGVyYXRvck1ldGhvZHMocHJvdG90eXBlKSB7WyJuZXh0IiwgInRocm93IiwgInJldHVybiJdLmZvckVhY2goZnVuY3Rpb24gKG1ldGhvZCkge2RlZmluZShwcm90b3R5cGUsIG1ldGhvZCwgZnVuY3Rpb24gKGFyZykge3JldHVybiB0aGlzLl9pbnZva2UobWV0aG9kLCBhcmcpO30pO30pO31mdW5jdGlvbiBBc3luY0l0ZXJhdG9yKGdlbmVyYXRvciwgUHJvbWlzZUltcGwpIHtmdW5jdGlvbiBpbnZva2UobWV0aG9kLCBhcmcsIHJlc29sdmUsIHJlamVjdCkge3ZhciByZWNvcmQgPSB0cnlDYXRjaChnZW5lcmF0b3JbbWV0aG9kXSwgZ2VuZXJhdG9yLCBhcmcpO2lmICgidGhyb3ciICE9PSByZWNvcmQudHlwZSkge3ZhciByZXN1bHQgPSByZWNvcmQuYXJnLHZhbHVlID0gcmVzdWx0LnZhbHVlO3JldHVybiB2YWx1ZSAmJiAib2JqZWN0IiA9PSBfdHlwZW9mKHZhbHVlKSAmJiBoYXNPd24uY2FsbCh2YWx1ZSwgIl9fYXdhaXQiKSA/IFByb21pc2VJbXBsLnJlc29sdmUodmFsdWUuX19hd2FpdCkudGhlbihmdW5jdGlvbiAodmFsdWUpIHtpbnZva2UoIm5leHQiLCB2YWx1ZSwgcmVzb2x2ZSwgcmVqZWN0KTt9LCBmdW5jdGlvbiAoZXJyKSB7aW52b2tlKCJ0aHJvdyIsIGVyciwgcmVzb2x2ZSwgcmVqZWN0KTt9KSA6IFByb21pc2VJbXBsLnJlc29sdmUodmFsdWUpLnRoZW4oZnVuY3Rpb24gKHVud3JhcHBlZCkge3Jlc3VsdC52YWx1ZSA9IHVud3JhcHBlZCwgcmVzb2x2ZShyZXN1bHQpO30sIGZ1bmN0aW9uIChlcnJvcikge3JldHVybiBpbnZva2UoInRocm93IiwgZXJyb3IsIHJlc29sdmUsIHJlamVjdCk7fSk7fXJlamVjdChyZWNvcmQuYXJnKTt9dmFyIHByZXZpb3VzUHJvbWlzZTtkZWZpbmVQcm9wZXJ0eSh0aGlzLCAiX2ludm9rZSIsIHsgdmFsdWU6IGZ1bmN0aW9uIHZhbHVlKG1ldGhvZCwgYXJnKSB7ZnVuY3Rpb24gY2FsbEludm9rZVdpdGhNZXRob2RBbmRBcmcoKSB7cmV0dXJuIG5ldyBQcm9taXNlSW1wbChmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7aW52b2tlKG1ldGhvZCwgYXJnLCByZXNvbHZlLCByZWplY3QpO30pO31yZXR1cm4gcHJldmlvdXNQcm9taXNlID0gcHJldmlvdXNQcm9taXNlID8gcHJldmlvdXNQcm9taXNlLnRoZW4oY2FsbEludm9rZVdpdGhNZXRob2RBbmRBcmcsIGNhbGxJbnZva2VXaXRoTWV0aG9kQW5kQXJnKSA6IGNhbGxJbnZva2VXaXRoTWV0aG9kQW5kQXJnKCk7fSB9KTt9ZnVuY3Rpb24gbWFrZUludm9rZU1ldGhvZChpbm5lckZuLCBzZWxmLCBjb250ZXh0KSB7dmFyIHN0YXRlID0gInN1c3BlbmRlZFN0YXJ0IjtyZXR1cm4gZnVuY3Rpb24gKG1ldGhvZCwgYXJnKSB7aWYgKCJleGVjdXRpbmciID09PSBzdGF0ZSkgdGhyb3cgbmV3IEVycm9yKCJHZW5lcmF0b3IgaXMgYWxyZWFkeSBydW5uaW5nIik7aWYgKCJjb21wbGV0ZWQiID09PSBzdGF0ZSkge2lmICgidGhyb3ciID09PSBtZXRob2QpIHRocm93IGFyZztyZXR1cm4gZG9uZVJlc3VsdCgpO31mb3IgKGNvbnRleHQubWV0aG9kID0gbWV0aG9kLCBjb250ZXh0LmFyZyA9IGFyZzs7KSB7dmFyIGRlbGVnYXRlID0gY29udGV4dC5kZWxlZ2F0ZTtpZiAoZGVsZWdhdGUpIHt2YXIgZGVsZWdhdGVSZXN1bHQgPSBtYXliZUludm9rZURlbGVnYXRlKGRlbGVnYXRlLCBjb250ZXh0KTtpZiAoZGVsZWdhdGVSZXN1bHQpIHtpZiAoZGVsZWdhdGVSZXN1bHQgPT09IENvbnRpbnVlU2VudGluZWwpIGNvbnRpbnVlO3JldHVybiBkZWxlZ2F0ZVJlc3VsdDt9fWlmICgibmV4dCIgPT09IGNvbnRleHQubWV0aG9kKSBjb250ZXh0LnNlbnQgPSBjb250ZXh0Ll9zZW50ID0gY29udGV4dC5hcmc7ZWxzZSBpZiAoInRocm93IiA9PT0gY29udGV4dC5tZXRob2QpIHtpZiAoInN1c3BlbmRlZFN0YXJ0IiA9PT0gc3RhdGUpIHRocm93IHN0YXRlID0gImNvbXBsZXRlZCIsIGNvbnRleHQuYXJnO2NvbnRleHQuZGlzcGF0Y2hFeGNlcHRpb24oY29udGV4dC5hcmcpO30gZWxzZSAicmV0dXJuIiA9PT0gY29udGV4dC5tZXRob2QgJiYgY29udGV4dC5hYnJ1cHQoInJldHVybiIsIGNvbnRleHQuYXJnKTtzdGF0ZSA9ICJleGVjdXRpbmciO3ZhciByZWNvcmQgPSB0cnlDYXRjaChpbm5lckZuLCBzZWxmLCBjb250ZXh0KTtpZiAoIm5vcm1hbCIgPT09IHJlY29yZC50eXBlKSB7aWYgKHN0YXRlID0gY29udGV4dC5kb25lID8gImNvbXBsZXRlZCIgOiAic3VzcGVuZGVkWWllbGQiLCByZWNvcmQuYXJnID09PSBDb250aW51ZVNlbnRpbmVsKSBjb250aW51ZTtyZXR1cm4geyB2YWx1ZTogcmVjb3JkLmFyZywgZG9uZTogY29udGV4dC5kb25lIH07fSJ0aHJvdyIgPT09IHJlY29yZC50eXBlICYmIChzdGF0ZSA9ICJjb21wbGV0ZWQiLCBjb250ZXh0Lm1ldGhvZCA9ICJ0aHJvdyIsIGNvbnRleHQuYXJnID0gcmVjb3JkLmFyZyk7fX07fWZ1bmN0aW9uIG1heWJlSW52b2tlRGVsZWdhdGUoZGVsZWdhdGUsIGNvbnRleHQpIHt2YXIgbWV0aG9kTmFtZSA9IGNvbnRleHQubWV0aG9kLG1ldGhvZCA9IGRlbGVnYXRlLml0ZXJhdG9yW21ldGhvZE5hbWVdO2lmICh1bmRlZmluZWQgPT09IG1ldGhvZCkgcmV0dXJuIGNvbnRleHQuZGVsZWdhdGUgPSBudWxsLCAidGhyb3ciID09PSBtZXRob2ROYW1lICYmIGRlbGVnYXRlLml0ZXJhdG9yWyJyZXR1cm4iXSAmJiAoY29udGV4dC5tZXRob2QgPSAicmV0dXJuIiwgY29udGV4dC5hcmcgPSB1bmRlZmluZWQsIG1heWJlSW52b2tlRGVsZWdhdGUoZGVsZWdhdGUsIGNvbnRleHQpLCAidGhyb3ciID09PSBjb250ZXh0Lm1ldGhvZCkgfHwgInJldHVybiIgIT09IG1ldGhvZE5hbWUgJiYgKGNvbnRleHQubWV0aG9kID0gInRocm93IiwgY29udGV4dC5hcmcgPSBuZXcgVHlwZUVycm9yKCJUaGUgaXRlcmF0b3IgZG9lcyBub3QgcHJvdmlkZSBhICciICsgbWV0aG9kTmFtZSArICInIG1ldGhvZCIpKSwgQ29udGludWVTZW50aW5lbDt2YXIgcmVjb3JkID0gdHJ5Q2F0Y2gobWV0aG9kLCBkZWxlZ2F0ZS5pdGVyYXRvciwgY29udGV4dC5hcmcpO2lmICgidGhyb3ciID09PSByZWNvcmQudHlwZSkgcmV0dXJuIGNvbnRleHQubWV0aG9kID0gInRocm93IiwgY29udGV4dC5hcmcgPSByZWNvcmQuYXJnLCBjb250ZXh0LmRlbGVnYXRlID0gbnVsbCwgQ29udGludWVTZW50aW5lbDt2YXIgaW5mbyA9IHJlY29yZC5hcmc7cmV0dXJuIGluZm8gPyBpbmZvLmRvbmUgPyAoY29udGV4dFtkZWxlZ2F0ZS5yZXN1bHROYW1lXSA9IGluZm8udmFsdWUsIGNvbnRleHQubmV4dCA9IGRlbGVnYXRlLm5leHRMb2MsICJyZXR1cm4iICE9PSBjb250ZXh0Lm1ldGhvZCAmJiAoY29udGV4dC5tZXRob2QgPSAibmV4dCIsIGNvbnRleHQuYXJnID0gdW5kZWZpbmVkKSwgY29udGV4dC5kZWxlZ2F0ZSA9IG51bGwsIENvbnRpbnVlU2VudGluZWwpIDogaW5mbyA6IChjb250ZXh0Lm1ldGhvZCA9ICJ0aHJvdyIsIGNvbnRleHQuYXJnID0gbmV3IFR5cGVFcnJvcigiaXRlcmF0b3IgcmVzdWx0IGlzIG5vdCBhbiBvYmplY3QiKSwgY29udGV4dC5kZWxlZ2F0ZSA9IG51bGwsIENvbnRpbnVlU2VudGluZWwpO31mdW5jdGlvbiBwdXNoVHJ5RW50cnkobG9jcykge3ZhciBlbnRyeSA9IHsgdHJ5TG9jOiBsb2NzWzBdIH07MSBpbiBsb2NzICYmIChlbnRyeS5jYXRjaExvYyA9IGxvY3NbMV0pLCAyIGluIGxvY3MgJiYgKGVudHJ5LmZpbmFsbHlMb2MgPSBsb2NzWzJdLCBlbnRyeS5hZnRlckxvYyA9IGxvY3NbM10pLCB0aGlzLnRyeUVudHJpZXMucHVzaChlbnRyeSk7fWZ1bmN0aW9uIHJlc2V0VHJ5RW50cnkoZW50cnkpIHt2YXIgcmVjb3JkID0gZW50cnkuY29tcGxldGlvbiB8fCB7fTtyZWNvcmQudHlwZSA9ICJub3JtYWwiLCBkZWxldGUgcmVjb3JkLmFyZywgZW50cnkuY29tcGxldGlvbiA9IHJlY29yZDt9ZnVuY3Rpb24gQ29udGV4dCh0cnlMb2NzTGlzdCkge3RoaXMudHJ5RW50cmllcyA9IFt7IHRyeUxvYzogInJvb3QiIH1dLCB0cnlMb2NzTGlzdC5mb3JFYWNoKHB1c2hUcnlFbnRyeSwgdGhpcyksIHRoaXMucmVzZXQoITApO31mdW5jdGlvbiB2YWx1ZXMoaXRlcmFibGUpIHtpZiAoaXRlcmFibGUpIHt2YXIgaXRlcmF0b3JNZXRob2QgPSBpdGVyYWJsZVtpdGVyYXRvclN5bWJvbF07aWYgKGl0ZXJhdG9yTWV0aG9kKSByZXR1cm4gaXRlcmF0b3JNZXRob2QuY2FsbChpdGVyYWJsZSk7aWYgKCJmdW5jdGlvbiIgPT0gdHlwZW9mIGl0ZXJhYmxlLm5leHQpIHJldHVybiBpdGVyYWJsZTtpZiAoIWlzTmFOKGl0ZXJhYmxlLmxlbmd0aCkpIHt2YXIgaSA9IC0xLG5leHQgPSBmdW5jdGlvbiBuZXh0KCkge2ZvciAoOyArK2kgPCBpdGVyYWJsZS5sZW5ndGg7KSBpZiAoaGFzT3duLmNhbGwoaXRlcmFibGUsIGkpKSByZXR1cm4gbmV4dC52YWx1ZSA9IGl0ZXJhYmxlW2ldLCBuZXh0LmRvbmUgPSAhMSwgbmV4dDtyZXR1cm4gbmV4dC52YWx1ZSA9IHVuZGVmaW5lZCwgbmV4dC5kb25lID0gITAsIG5leHQ7fTtyZXR1cm4gbmV4dC5uZXh0ID0gbmV4dDt9fXJldHVybiB7IG5leHQ6IGRvbmVSZXN1bHQgfTt9ZnVuY3Rpb24gZG9uZVJlc3VsdCgpIHtyZXR1cm4geyB2YWx1ZTogdW5kZWZpbmVkLCBkb25lOiAhMCB9O31yZXR1cm4gR2VuZXJhdG9yRnVuY3Rpb24ucHJvdG90eXBlID0gR2VuZXJhdG9yRnVuY3Rpb25Qcm90b3R5cGUsIGRlZmluZVByb3BlcnR5KEdwLCAiY29uc3RydWN0b3IiLCB7IHZhbHVlOiBHZW5lcmF0b3JGdW5jdGlvblByb3RvdHlwZSwgY29uZmlndXJhYmxlOiAhMCB9KSwgZGVmaW5lUHJvcGVydHkoR2VuZXJhdG9yRnVuY3Rpb25Qcm90b3R5cGUsICJjb25zdHJ1Y3RvciIsIHsgdmFsdWU6IEdlbmVyYXRvckZ1bmN0aW9uLCBjb25maWd1cmFibGU6ICEwIH0pLCBHZW5lcmF0b3JGdW5jdGlvbi5kaXNwbGF5TmFtZSA9IGRlZmluZShHZW5lcmF0b3JGdW5jdGlvblByb3RvdHlwZSwgdG9TdHJpbmdUYWdTeW1ib2wsICJHZW5lcmF0b3JGdW5jdGlvbiIpLCBleHBvcnRzLmlzR2VuZXJhdG9yRnVuY3Rpb24gPSBmdW5jdGlvbiAoZ2VuRnVuKSB7dmFyIGN0b3IgPSAiZnVuY3Rpb24iID09IHR5cGVvZiBnZW5GdW4gJiYgZ2VuRnVuLmNvbnN0cnVjdG9yO3JldHVybiAhIWN0b3IgJiYgKGN0b3IgPT09IEdlbmVyYXRvckZ1bmN0aW9uIHx8ICJHZW5lcmF0b3JGdW5jdGlvbiIgPT09IChjdG9yLmRpc3BsYXlOYW1lIHx8IGN0b3IubmFtZSkpO30sIGV4cG9ydHMubWFyayA9IGZ1bmN0aW9uIChnZW5GdW4pIHtyZXR1cm4gT2JqZWN0LnNldFByb3RvdHlwZU9mID8gT2JqZWN0LnNldFByb3RvdHlwZU9mKGdlbkZ1biwgR2VuZXJhdG9yRnVuY3Rpb25Qcm90b3R5cGUpIDogKGdlbkZ1bi5fX3Byb3RvX18gPSBHZW5lcmF0b3JGdW5jdGlvblByb3RvdHlwZSwgZGVmaW5lKGdlbkZ1biwgdG9TdHJpbmdUYWdTeW1ib2wsICJHZW5lcmF0b3JGdW5jdGlvbiIpKSwgZ2VuRnVuLnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoR3ApLCBnZW5GdW47fSwgZXhwb3J0cy5hd3JhcCA9IGZ1bmN0aW9uIChhcmcpIHtyZXR1cm4geyBfX2F3YWl0OiBhcmcgfTt9LCBkZWZpbmVJdGVyYXRvck1ldGhvZHMoQXN5bmNJdGVyYXRvci5wcm90b3R5cGUpLCBkZWZpbmUoQXN5bmNJdGVyYXRvci5wcm90b3R5cGUsIGFzeW5jSXRlcmF0b3JTeW1ib2wsIGZ1bmN0aW9uICgpIHtyZXR1cm4gdGhpczt9KSwgZXhwb3J0cy5Bc3luY0l0ZXJhdG9yID0gQXN5bmNJdGVyYXRvciwgZXhwb3J0cy5hc3luYyA9IGZ1bmN0aW9uIChpbm5lckZuLCBvdXRlckZuLCBzZWxmLCB0cnlMb2NzTGlzdCwgUHJvbWlzZUltcGwpIHt2b2lkIDAgPT09IFByb21pc2VJbXBsICYmIChQcm9taXNlSW1wbCA9IFByb21pc2UpO3ZhciBpdGVyID0gbmV3IEFzeW5jSXRlcmF0b3Iod3JhcChpbm5lckZuLCBvdXRlckZuLCBzZWxmLCB0cnlMb2NzTGlzdCksIFByb21pc2VJbXBsKTtyZXR1cm4gZXhwb3J0cy5pc0dlbmVyYXRvckZ1bmN0aW9uKG91dGVyRm4pID8gaXRlciA6IGl0ZXIubmV4dCgpLnRoZW4oZnVuY3Rpb24gKHJlc3VsdCkge3JldHVybiByZXN1bHQuZG9uZSA/IHJlc3VsdC52YWx1ZSA6IGl0ZXIubmV4dCgpO30pO30sIGRlZmluZUl0ZXJhdG9yTWV0aG9kcyhHcCksIGRlZmluZShHcCwgdG9TdHJpbmdUYWdTeW1ib2wsICJHZW5lcmF0b3IiKSwgZGVmaW5lKEdwLCBpdGVyYXRvclN5bWJvbCwgZnVuY3Rpb24gKCkge3JldHVybiB0aGlzO30pLCBkZWZpbmUoR3AsICJ0b1N0cmluZyIsIGZ1bmN0aW9uICgpIHtyZXR1cm4gIltvYmplY3QgR2VuZXJhdG9yXSI7fSksIGV4cG9ydHMua2V5cyA9IGZ1bmN0aW9uICh2YWwpIHt2YXIgb2JqZWN0ID0gT2JqZWN0KHZhbCksa2V5cyA9IFtdO2ZvciAodmFyIGtleSBpbiBvYmplY3QpIGtleXMucHVzaChrZXkpO3JldHVybiBrZXlzLnJldmVyc2UoKSwgZnVuY3Rpb24gbmV4dCgpIHtmb3IgKDsga2V5cy5sZW5ndGg7KSB7dmFyIGtleSA9IGtleXMucG9wKCk7aWYgKGtleSBpbiBvYmplY3QpIHJldHVybiBuZXh0LnZhbHVlID0ga2V5LCBuZXh0LmRvbmUgPSAhMSwgbmV4dDt9cmV0dXJuIG5leHQuZG9uZSA9ICEwLCBuZXh0O307fSwgZXhwb3J0cy52YWx1ZXMgPSB2YWx1ZXMsIENvbnRleHQucHJvdG90eXBlID0geyBjb25zdHJ1Y3RvcjogQ29udGV4dCwgcmVzZXQ6IGZ1bmN0aW9uIHJlc2V0KHNraXBUZW1wUmVzZXQpIHtpZiAodGhpcy5wcmV2ID0gMCwgdGhpcy5uZXh0ID0gMCwgdGhpcy5zZW50ID0gdGhpcy5fc2VudCA9IHVuZGVmaW5lZCwgdGhpcy5kb25lID0gITEsIHRoaXMuZGVsZWdhdGUgPSBudWxsLCB0aGlzLm1ldGhvZCA9ICJuZXh0IiwgdGhpcy5hcmcgPSB1bmRlZmluZWQsIHRoaXMudHJ5RW50cmllcy5mb3JFYWNoKHJlc2V0VHJ5RW50cnkpLCAhc2tpcFRlbXBSZXNldCkgZm9yICh2YXIgbmFtZSBpbiB0aGlzKSAidCIgPT09IG5hbWUuY2hhckF0KDApICYmIGhhc093bi5jYWxsKHRoaXMsIG5hbWUpICYmICFpc05hTigrbmFtZS5zbGljZSgxKSkgJiYgKHRoaXNbbmFtZV0gPSB1bmRlZmluZWQpO30sIHN0b3A6IGZ1bmN0aW9uIHN0b3AoKSB7dGhpcy5kb25lID0gITA7dmFyIHJvb3RSZWNvcmQgPSB0aGlzLnRyeUVudHJpZXNbMF0uY29tcGxldGlvbjtpZiAoInRocm93IiA9PT0gcm9vdFJlY29yZC50eXBlKSB0aHJvdyByb290UmVjb3JkLmFyZztyZXR1cm4gdGhpcy5ydmFsO30sIGRpc3BhdGNoRXhjZXB0aW9uOiBmdW5jdGlvbiBkaXNwYXRjaEV4Y2VwdGlvbihleGNlcHRpb24pIHtpZiAodGhpcy5kb25lKSB0aHJvdyBleGNlcHRpb247dmFyIGNvbnRleHQgPSB0aGlzO2Z1bmN0aW9uIGhhbmRsZShsb2MsIGNhdWdodCkge3JldHVybiByZWNvcmQudHlwZSA9ICJ0aHJvdyIsIHJlY29yZC5hcmcgPSBleGNlcHRpb24sIGNvbnRleHQubmV4dCA9IGxvYywgY2F1Z2h0ICYmIChjb250ZXh0Lm1ldGhvZCA9ICJuZXh0IiwgY29udGV4dC5hcmcgPSB1bmRlZmluZWQpLCAhIWNhdWdodDt9Zm9yICh2YXIgaSA9IHRoaXMudHJ5RW50cmllcy5sZW5ndGggLSAxOyBpID49IDA7IC0taSkge3ZhciBlbnRyeSA9IHRoaXMudHJ5RW50cmllc1tpXSxyZWNvcmQgPSBlbnRyeS5jb21wbGV0aW9uO2lmICgicm9vdCIgPT09IGVudHJ5LnRyeUxvYykgcmV0dXJuIGhhbmRsZSgiZW5kIik7aWYgKGVudHJ5LnRyeUxvYyA8PSB0aGlzLnByZXYpIHt2YXIgaGFzQ2F0Y2ggPSBoYXNPd24uY2FsbChlbnRyeSwgImNhdGNoTG9jIiksaGFzRmluYWxseSA9IGhhc093bi5jYWxsKGVudHJ5LCAiZmluYWxseUxvYyIpO2lmIChoYXNDYXRjaCAmJiBoYXNGaW5hbGx5KSB7aWYgKHRoaXMucHJldiA8IGVudHJ5LmNhdGNoTG9jKSByZXR1cm4gaGFuZGxlKGVudHJ5LmNhdGNoTG9jLCAhMCk7aWYgKHRoaXMucHJldiA8IGVudHJ5LmZpbmFsbHlMb2MpIHJldHVybiBoYW5kbGUoZW50cnkuZmluYWxseUxvYyk7fSBlbHNlIGlmIChoYXNDYXRjaCkge2lmICh0aGlzLnByZXYgPCBlbnRyeS5jYXRjaExvYykgcmV0dXJuIGhhbmRsZShlbnRyeS5jYXRjaExvYywgITApO30gZWxzZSB7aWYgKCFoYXNGaW5hbGx5KSB0aHJvdyBuZXcgRXJyb3IoInRyeSBzdGF0ZW1lbnQgd2l0aG91dCBjYXRjaCBvciBmaW5hbGx5Iik7aWYgKHRoaXMucHJldiA8IGVudHJ5LmZpbmFsbHlMb2MpIHJldHVybiBoYW5kbGUoZW50cnkuZmluYWxseUxvYyk7fX19fSwgYWJydXB0OiBmdW5jdGlvbiBhYnJ1cHQodHlwZSwgYXJnKSB7Zm9yICh2YXIgaSA9IHRoaXMudHJ5RW50cmllcy5sZW5ndGggLSAxOyBpID49IDA7IC0taSkge3ZhciBlbnRyeSA9IHRoaXMudHJ5RW50cmllc1tpXTtpZiAoZW50cnkudHJ5TG9jIDw9IHRoaXMucHJldiAmJiBoYXNPd24uY2FsbChlbnRyeSwgImZpbmFsbHlMb2MiKSAmJiB0aGlzLnByZXYgPCBlbnRyeS5maW5hbGx5TG9jKSB7dmFyIGZpbmFsbHlFbnRyeSA9IGVudHJ5O2JyZWFrO319ZmluYWxseUVudHJ5ICYmICgiYnJlYWsiID09PSB0eXBlIHx8ICJjb250aW51ZSIgPT09IHR5cGUpICYmIGZpbmFsbHlFbnRyeS50cnlMb2MgPD0gYXJnICYmIGFyZyA8PSBmaW5hbGx5RW50cnkuZmluYWxseUxvYyAmJiAoZmluYWxseUVudHJ5ID0gbnVsbCk7dmFyIHJlY29yZCA9IGZpbmFsbHlFbnRyeSA/IGZpbmFsbHlFbnRyeS5jb21wbGV0aW9uIDoge307cmV0dXJuIHJlY29yZC50eXBlID0gdHlwZSwgcmVjb3JkLmFyZyA9IGFyZywgZmluYWxseUVudHJ5ID8gKHRoaXMubWV0aG9kID0gIm5leHQiLCB0aGlzLm5leHQgPSBmaW5hbGx5RW50cnkuZmluYWxseUxvYywgQ29udGludWVTZW50aW5lbCkgOiB0aGlzLmNvbXBsZXRlKHJlY29yZCk7fSwgY29tcGxldGU6IGZ1bmN0aW9uIGNvbXBsZXRlKHJlY29yZCwgYWZ0ZXJMb2MpIHtpZiAoInRocm93IiA9PT0gcmVjb3JkLnR5cGUpIHRocm93IHJlY29yZC5hcmc7cmV0dXJuICJicmVhayIgPT09IHJlY29yZC50eXBlIHx8ICJjb250aW51ZSIgPT09IHJlY29yZC50eXBlID8gdGhpcy5uZXh0ID0gcmVjb3JkLmFyZyA6ICJyZXR1cm4iID09PSByZWNvcmQudHlwZSA/ICh0aGlzLnJ2YWwgPSB0aGlzLmFyZyA9IHJlY29yZC5hcmcsIHRoaXMubWV0aG9kID0gInJldHVybiIsIHRoaXMubmV4dCA9ICJlbmQiKSA6ICJub3JtYWwiID09PSByZWNvcmQudHlwZSAmJiBhZnRlckxvYyAmJiAodGhpcy5uZXh0ID0gYWZ0ZXJMb2MpLCBDb250aW51ZVNlbnRpbmVsO30sIGZpbmlzaDogZnVuY3Rpb24gZmluaXNoKGZpbmFsbHlMb2MpIHtmb3IgKHZhciBpID0gdGhpcy50cnlFbnRyaWVzLmxlbmd0aCAtIDE7IGkgPj0gMDsgLS1pKSB7dmFyIGVudHJ5ID0gdGhpcy50cnlFbnRyaWVzW2ldO2lmIChlbnRyeS5maW5hbGx5TG9jID09PSBmaW5hbGx5TG9jKSByZXR1cm4gdGhpcy5jb21wbGV0ZShlbnRyeS5jb21wbGV0aW9uLCBlbnRyeS5hZnRlckxvYyksIHJlc2V0VHJ5RW50cnkoZW50cnkpLCBDb250aW51ZVNlbnRpbmVsO319LCAiY2F0Y2giOiBmdW5jdGlvbiBfY2F0Y2godHJ5TG9jKSB7Zm9yICh2YXIgaSA9IHRoaXMudHJ5RW50cmllcy5sZW5ndGggLSAxOyBpID49IDA7IC0taSkge3ZhciBlbnRyeSA9IHRoaXMudHJ5RW50cmllc1tpXTtpZiAoZW50cnkudHJ5TG9jID09PSB0cnlMb2MpIHt2YXIgcmVjb3JkID0gZW50cnkuY29tcGxldGlvbjtpZiAoInRocm93IiA9PT0gcmVjb3JkLnR5cGUpIHt2YXIgdGhyb3duID0gcmVjb3JkLmFyZztyZXNldFRyeUVudHJ5KGVudHJ5KTt9cmV0dXJuIHRocm93bjt9fXRocm93IG5ldyBFcnJvcigiaWxsZWdhbCBjYXRjaCBhdHRlbXB0Iik7fSwgZGVsZWdhdGVZaWVsZDogZnVuY3Rpb24gZGVsZWdhdGVZaWVsZChpdGVyYWJsZSwgcmVzdWx0TmFtZSwgbmV4dExvYykge3JldHVybiB0aGlzLmRlbGVnYXRlID0geyBpdGVyYXRvcjogdmFsdWVzKGl0ZXJhYmxlKSwgcmVzdWx0TmFtZTogcmVzdWx0TmFtZSwgbmV4dExvYzogbmV4dExvYyB9LCAibmV4dCIgPT09IHRoaXMubWV0aG9kICYmICh0aGlzLmFyZyA9IHVuZGVmaW5lZCksIENvbnRpbnVlU2VudGluZWw7fSB9LCBleHBvcnRzO31mdW5jdGlvbiBhc3luY0dlbmVyYXRvclN0ZXAoZ2VuLCByZXNvbHZlLCByZWplY3QsIF9uZXh0LCBfdGhyb3csIGtleSwgYXJnKSB7dHJ5IHt2YXIgaW5mbyA9IGdlbltrZXldKGFyZyk7dmFyIHZhbHVlID0gaW5mby52YWx1ZTt9IGNhdGNoIChlcnJvcikge3JlamVjdChlcnJvcik7cmV0dXJuO31pZiAoaW5mby5kb25lKSB7cmVzb2x2ZSh2YWx1ZSk7fSBlbHNlIHtQcm9taXNlLnJlc29sdmUodmFsdWUpLnRoZW4oX25leHQsIF90aHJvdyk7fX1mdW5jdGlvbiBfYXN5bmNUb0dlbmVyYXRvcihmbikge3JldHVybiBmdW5jdGlvbiAoKSB7dmFyIHNlbGYgPSB0aGlzLGFyZ3MgPSBhcmd1bWVudHM7cmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHt2YXIgZ2VuID0gZm4uYXBwbHkoc2VsZiwgYXJncyk7ZnVuY3Rpb24gX25leHQodmFsdWUpIHthc3luY0dlbmVyYXRvclN0ZXAoZ2VuLCByZXNvbHZlLCByZWplY3QsIF9uZXh0LCBfdGhyb3csICJuZXh0IiwgdmFsdWUpO31mdW5jdGlvbiBfdGhyb3coZXJyKSB7YXN5bmNHZW5lcmF0b3JTdGVwKGdlbiwgcmVzb2x2ZSwgcmVqZWN0LCBfbmV4dCwgX3Rocm93LCAidGhyb3ciLCBlcnIpO31fbmV4dCh1bmRlZmluZWQpO30pO307fQogICAgICAgICAgZnVuY3Rpb24gYWRkTm90aWZpY2F0aW9uKG5vdGlmaWNhdGlvbikgewogICAgICAgICAgICB2YXIgZWxlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2Iik7CiAgICAgICAgICAgIGVsZS5jbGFzc05hbWUgPSAibm90aWZpY2F0aW9uIjsKICAgICAgICAgICAgZWxlLmFkZEV2ZW50TGlzdGVuZXIoImFuaW1hdGlvbmVuZCIsIGZ1bmN0aW9uICgpIHtyZXR1cm4gZWxlLnJlbW92ZSgpO30pOwogICAgICAgICAgICBlbGUuaW5uZXJUZXh0ID0gbm90aWZpY2F0aW9uOwoKICAgICAgICAgICAgdmFyIGNvbnRhaW5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJub3RpZmljYXRpb25zQ29udGFpbmVyIik7CgogICAgICAgICAgICBpZiAoIWNvbnRhaW5lcikgewogICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgY29udGFpbmVyLmFwcGVuZENoaWxkKGVsZSk7CiAgICAgICAgICB9CgogICAgICAgICAgZnVuY3Rpb24gc2F2ZVNldHRpbmdzKAogICAgICAgICAgcHJvcGVydGllcykKICAgICAgICAgIHsKICAgICAgICAgICAgcmV0dXJuIHNldFByb3BlcnRpZXMoCiAgICAgICAgICAgIHByb3BlcnRpZXMuCiAgICAgICAgICAgIGZpbHRlcihmdW5jdGlvbiAocCkgewogICAgICAgICAgICAgIGlmIChwLnByZXZpb3VzVmFsdWUgPT09IHAudmFsdWUpIHsKICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIHAucHJldmlvdXNWYWx1ZSA9IHAudmFsdWU7CiAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgIH0pLgogICAgICAgICAgICBtYXAoZnVuY3Rpb24gKHByb3ApIHtyZXR1cm4gW3Byb3AucHJlZmVyZW5jZSwgcHJvcC52YWx1ZS50cmltKCldO30pKTsKCiAgICAgICAgICB9CgogICAgICAgICAgZnVuY3Rpb24gc2V0UHJvcGVydGllcygKICAgICAgICAgIHByb3BlcnRpZXMpCiAgICAgICAgICB7CiAgICAgICAgICAgIHJldHVybiBydW5SZWxheSgic2V0UHJvcGVydGllcyIsIEpTT04uc3RyaW5naWZ5KHByb3BlcnRpZXMpKS50aGVuKGZ1bmN0aW9uICh2YWwpIHtyZXR1cm4gKAogICAgICAgICAgICAgICAgSlNPTi5wYXJzZSh2YWwpKTt9KTsKCiAgICAgICAgICB9ZnVuY3Rpb24KCiAgICAgICAgICBydW5SZWxheShfeCwgX3gyKSB7cmV0dXJuIF9ydW5SZWxheS5hcHBseSh0aGlzLCBhcmd1bWVudHMpO31mdW5jdGlvbiBfcnVuUmVsYXkoKSB7X3J1blJlbGF5ID0gX2FzeW5jVG9HZW5lcmF0b3IoIC8qI19fUFVSRV9fKi9fcmVnZW5lcmF0b3JSdW50aW1lKCkubWFyayhmdW5jdGlvbiBfY2FsbGVlKGZvcm1OYW1lLCBwYXJhbSkge3JldHVybiBfcmVnZW5lcmF0b3JSdW50aW1lKCkud3JhcChmdW5jdGlvbiBfY2FsbGVlJChfY29udGV4dCkge3doaWxlICgxKSBzd2l0Y2ggKF9jb250ZXh0LnByZXYgPSBfY29udGV4dC5uZXh0KSB7Y2FzZSAwOnJldHVybiBfY29udGV4dC5hYnJ1cHQoInJldHVybiIsCiAgICAgICAgICAgICAgICAgICAgbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUpIHsKICAgICAgICAgICAgICAgICAgICAgIHZhciB4aHIgPSBuZXcgWE1MSHR0cFJlcXVlc3QoKTsKICAgICAgICAgICAgICAgICAgICAgIHhoci5yZXNwb25zZVR5cGUgPSAidGV4dCI7CiAgICAgICAgICAgICAgICAgICAgICB4aHIub3BlbigiUE9TVCIsIGRvY3VtZW50LmxvY2F0aW9uLmhyZWYsIHRydWUpOwogICAgICAgICAgICAgICAgICAgICAgeGhyLnNldFJlcXVlc3RIZWFkZXIoIkNvbnRlbnQtVHlwZSIsICJhcHBsaWNhdGlvbi94LXd3dy1mb3JtLXVybGVuY29kZWQiKTsKICAgICAgICAgICAgICAgICAgICAgIHhoci5zZW5kKGZvcm1OYW1lICsgIj0iICsgZW5jb2RlVVJJQ29tcG9uZW50KHBhcmFtKSk7CiAgICAgICAgICAgICAgICAgICAgICB4aHIub25yZWFkeXN0YXRlY2hhbmdlID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAoeGhyLnJlYWR5U3RhdGUgIT0gNCB8fCB4aHIuc3RhdHVzICE9IDIwMCkgewogICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZSh4aHIucmVzcG9uc2VUZXh0KTsKICAgICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgICAgfSkpO2Nhc2UgMTpjYXNlICJlbmQiOnJldHVybiBfY29udGV4dC5zdG9wKCk7fX0sIF9jYWxsZWUpO30pKTtyZXR1cm4gX3J1blJlbGF5LmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7fQogICAgICAgICAgOyAvLyBDT05DQVRFTkFURUQgTU9EVUxFOiAuL3NyYy9yZWxheS9hcGkvU2V0dGluZ1ZhbGlkYXRvci50c3gKICAgICAgICAgIGZ1bmN0aW9uIFNldHRpbmdWYWxpZGF0b3JfdHlwZW9mKG9iaikgeyJAYmFiZWwvaGVscGVycyAtIHR5cGVvZiI7cmV0dXJuIFNldHRpbmdWYWxpZGF0b3JfdHlwZW9mID0gImZ1bmN0aW9uIiA9PSB0eXBlb2YgU3ltYm9sICYmICJzeW1ib2wiID09IHR5cGVvZiBTeW1ib2wuaXRlcmF0b3IgPyBmdW5jdGlvbiAob2JqKSB7cmV0dXJuIHR5cGVvZiBvYmo7fSA6IGZ1bmN0aW9uIChvYmopIHtyZXR1cm4gb2JqICYmICJmdW5jdGlvbiIgPT0gdHlwZW9mIFN5bWJvbCAmJiBvYmouY29uc3RydWN0b3IgPT09IFN5bWJvbCAmJiBvYmogIT09IFN5bWJvbC5wcm90b3R5cGUgPyAic3ltYm9sIiA6IHR5cGVvZiBvYmo7fSwgU2V0dGluZ1ZhbGlkYXRvcl90eXBlb2Yob2JqKTt9ZnVuY3Rpb24gX3NsaWNlZFRvQXJyYXkoYXJyLCBpKSB7cmV0dXJuIF9hcnJheVdpdGhIb2xlcyhhcnIpIHx8IF9pdGVyYWJsZVRvQXJyYXlMaW1pdChhcnIsIGkpIHx8IF91bnN1cHBvcnRlZEl0ZXJhYmxlVG9BcnJheShhcnIsIGkpIHx8IF9ub25JdGVyYWJsZVJlc3QoKTt9ZnVuY3Rpb24gX25vbkl0ZXJhYmxlUmVzdCgpIHt0aHJvdyBuZXcgVHlwZUVycm9yKCJJbnZhbGlkIGF0dGVtcHQgdG8gZGVzdHJ1Y3R1cmUgbm9uLWl0ZXJhYmxlIGluc3RhbmNlLlxuSW4gb3JkZXIgdG8gYmUgaXRlcmFibGUsIG5vbi1hcnJheSBvYmplY3RzIG11c3QgaGF2ZSBhIFtTeW1ib2wuaXRlcmF0b3JdKCkgbWV0aG9kLiIpO31mdW5jdGlvbiBfaXRlcmFibGVUb0FycmF5TGltaXQoYXJyLCBpKSB7dmFyIF9pID0gbnVsbCA9PSBhcnIgPyBudWxsIDogInVuZGVmaW5lZCIgIT0gdHlwZW9mIFN5bWJvbCAmJiBhcnJbU3ltYm9sLml0ZXJhdG9yXSB8fCBhcnJbIkBAaXRlcmF0b3IiXTtpZiAobnVsbCAhPSBfaSkge3ZhciBfcyxfZSxfeCxfcixfYXJyID0gW10sX24gPSAhMCxfZCA9ICExO3RyeSB7aWYgKF94ID0gKF9pID0gX2kuY2FsbChhcnIpKS5uZXh0LCAwID09PSBpKSB7aWYgKE9iamVjdChfaSkgIT09IF9pKSByZXR1cm47X24gPSAhMTt9IGVsc2UgZm9yICg7ICEoX24gPSAoX3MgPSBfeC5jYWxsKF9pKSkuZG9uZSkgJiYgKF9hcnIucHVzaChfcy52YWx1ZSksIF9hcnIubGVuZ3RoICE9PSBpKTsgX24gPSAhMCk7fSBjYXRjaCAoZXJyKSB7X2QgPSAhMCwgX2UgPSBlcnI7fSBmaW5hbGx5IHt0cnkge2lmICghX24gJiYgbnVsbCAhPSBfaVsicmV0dXJuIl0gJiYgKF9yID0gX2lbInJldHVybiJdKCksIE9iamVjdChfcikgIT09IF9yKSkgcmV0dXJuO30gZmluYWxseSB7aWYgKF9kKSB0aHJvdyBfZTt9fXJldHVybiBfYXJyO319ZnVuY3Rpb24gX2FycmF5V2l0aEhvbGVzKGFycikge2lmIChBcnJheS5pc0FycmF5KGFycikpIHJldHVybiBhcnI7fWZ1bmN0aW9uIF9jcmVhdGVGb3JPZkl0ZXJhdG9ySGVscGVyKG8sIGFsbG93QXJyYXlMaWtlKSB7dmFyIGl0ID0gdHlwZW9mIFN5bWJvbCAhPT0gInVuZGVmaW5lZCIgJiYgb1tTeW1ib2wuaXRlcmF0b3JdIHx8IG9bIkBAaXRlcmF0b3IiXTtpZiAoIWl0KSB7aWYgKEFycmF5LmlzQXJyYXkobykgfHwgKGl0ID0gX3Vuc3VwcG9ydGVkSXRlcmFibGVUb0FycmF5KG8pKSB8fCBhbGxvd0FycmF5TGlrZSAmJiBvICYmIHR5cGVvZiBvLmxlbmd0aCA9PT0gIm51bWJlciIpIHtpZiAoaXQpIG8gPSBpdDt2YXIgaSA9IDA7dmFyIEYgPSBmdW5jdGlvbiBGKCkge307cmV0dXJuIHsgczogRiwgbjogZnVuY3Rpb24gbigpIHtpZiAoaSA+PSBvLmxlbmd0aCkgcmV0dXJuIHsgZG9uZTogdHJ1ZSB9O3JldHVybiB7IGRvbmU6IGZhbHNlLCB2YWx1ZTogb1tpKytdIH07fSwgZTogZnVuY3Rpb24gZShfZTIpIHt0aHJvdyBfZTI7fSwgZjogRiB9O310aHJvdyBuZXcgVHlwZUVycm9yKCJJbnZhbGlkIGF0dGVtcHQgdG8gaXRlcmF0ZSBub24taXRlcmFibGUgaW5zdGFuY2UuXG5JbiBvcmRlciB0byBiZSBpdGVyYWJsZSwgbm9uLWFycmF5IG9iamVjdHMgbXVzdCBoYXZlIGEgW1N5bWJvbC5pdGVyYXRvcl0oKSBtZXRob2QuIik7fXZhciBub3JtYWxDb21wbGV0aW9uID0gdHJ1ZSxkaWRFcnIgPSBmYWxzZSxlcnI7cmV0dXJuIHsgczogZnVuY3Rpb24gcygpIHtpdCA9IGl0LmNhbGwobyk7fSwgbjogZnVuY3Rpb24gbigpIHt2YXIgc3RlcCA9IGl0Lm5leHQoKTtub3JtYWxDb21wbGV0aW9uID0gc3RlcC5kb25lO3JldHVybiBzdGVwO30sIGU6IGZ1bmN0aW9uIGUoX2UzKSB7ZGlkRXJyID0gdHJ1ZTtlcnIgPSBfZTM7fSwgZjogZnVuY3Rpb24gZigpIHt0cnkge2lmICghbm9ybWFsQ29tcGxldGlvbiAmJiBpdFsicmV0dXJuIl0gIT0gbnVsbCkgaXRbInJldHVybiJdKCk7fSBmaW5hbGx5IHtpZiAoZGlkRXJyKSB0aHJvdyBlcnI7fX0gfTt9ZnVuY3Rpb24gX3Vuc3VwcG9ydGVkSXRlcmFibGVUb0FycmF5KG8sIG1pbkxlbikge2lmICghbykgcmV0dXJuO2lmICh0eXBlb2YgbyA9PT0gInN0cmluZyIpIHJldHVybiBfYXJyYXlMaWtlVG9BcnJheShvLCBtaW5MZW4pO3ZhciBuID0gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKG8pLnNsaWNlKDgsIC0xKTtpZiAobiA9PT0gIk9iamVjdCIgJiYgby5jb25zdHJ1Y3RvcikgbiA9IG8uY29uc3RydWN0b3IubmFtZTtpZiAobiA9PT0gIk1hcCIgfHwgbiA9PT0gIlNldCIpIHJldHVybiBBcnJheS5mcm9tKG8pO2lmIChuID09PSAiQXJndW1lbnRzIiB8fCAvXig/OlVpfEkpbnQoPzo4fDE2fDMyKSg/OkNsYW1wZWQpP0FycmF5JC8udGVzdChuKSkgcmV0dXJuIF9hcnJheUxpa2VUb0FycmF5KG8sIG1pbkxlbik7fWZ1bmN0aW9uIF9hcnJheUxpa2VUb0FycmF5KGFyciwgbGVuKSB7aWYgKGxlbiA9PSBudWxsIHx8IGxlbiA+IGFyci5sZW5ndGgpIGxlbiA9IGFyci5sZW5ndGg7Zm9yICh2YXIgaSA9IDAsIGFycjIgPSBuZXcgQXJyYXkobGVuKTsgaSA8IGxlbjsgaSsrKSBhcnIyW2ldID0gYXJyW2ldO3JldHVybiBhcnIyO31mdW5jdGlvbiBfY2xhc3NDYWxsQ2hlY2soaW5zdGFuY2UsIENvbnN0cnVjdG9yKSB7aWYgKCEoaW5zdGFuY2UgaW5zdGFuY2VvZiBDb25zdHJ1Y3RvcikpIHt0aHJvdyBuZXcgVHlwZUVycm9yKCJDYW5ub3QgY2FsbCBhIGNsYXNzIGFzIGEgZnVuY3Rpb24iKTt9fWZ1bmN0aW9uIF9kZWZpbmVQcm9wZXJ0aWVzKHRhcmdldCwgcHJvcHMpIHtmb3IgKHZhciBpID0gMDsgaSA8IHByb3BzLmxlbmd0aDsgaSsrKSB7dmFyIGRlc2NyaXB0b3IgPSBwcm9wc1tpXTtkZXNjcmlwdG9yLmVudW1lcmFibGUgPSBkZXNjcmlwdG9yLmVudW1lcmFibGUgfHwgZmFsc2U7ZGVzY3JpcHRvci5jb25maWd1cmFibGUgPSB0cnVlO2lmICgidmFsdWUiIGluIGRlc2NyaXB0b3IpIGRlc2NyaXB0b3Iud3JpdGFibGUgPSB0cnVlO09iamVjdC5kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIF90b1Byb3BlcnR5S2V5KGRlc2NyaXB0b3Iua2V5KSwgZGVzY3JpcHRvcik7fX1mdW5jdGlvbiBfY3JlYXRlQ2xhc3MoQ29uc3RydWN0b3IsIHByb3RvUHJvcHMsIHN0YXRpY1Byb3BzKSB7aWYgKHByb3RvUHJvcHMpIF9kZWZpbmVQcm9wZXJ0aWVzKENvbnN0cnVjdG9yLnByb3RvdHlwZSwgcHJvdG9Qcm9wcyk7aWYgKHN0YXRpY1Byb3BzKSBfZGVmaW5lUHJvcGVydGllcyhDb25zdHJ1Y3Rvciwgc3RhdGljUHJvcHMpO09iamVjdC5kZWZpbmVQcm9wZXJ0eShDb25zdHJ1Y3RvciwgInByb3RvdHlwZSIsIHsgd3JpdGFibGU6IGZhbHNlIH0pO3JldHVybiBDb25zdHJ1Y3Rvcjt9ZnVuY3Rpb24gX2RlZmluZVByb3BlcnR5KG9iaiwga2V5LCB2YWx1ZSkge2tleSA9IF90b1Byb3BlcnR5S2V5KGtleSk7aWYgKGtleSBpbiBvYmopIHtPYmplY3QuZGVmaW5lUHJvcGVydHkob2JqLCBrZXksIHsgdmFsdWU6IHZhbHVlLCBlbnVtZXJhYmxlOiB0cnVlLCBjb25maWd1cmFibGU6IHRydWUsIHdyaXRhYmxlOiB0cnVlIH0pO30gZWxzZSB7b2JqW2tleV0gPSB2YWx1ZTt9cmV0dXJuIG9iajt9ZnVuY3Rpb24gX3RvUHJvcGVydHlLZXkoYXJnKSB7dmFyIGtleSA9IF90b1ByaW1pdGl2ZShhcmcsICJzdHJpbmciKTtyZXR1cm4gU2V0dGluZ1ZhbGlkYXRvcl90eXBlb2Yoa2V5KSA9PT0gInN5bWJvbCIgPyBrZXkgOiBTdHJpbmcoa2V5KTt9ZnVuY3Rpb24gX3RvUHJpbWl0aXZlKGlucHV0LCBoaW50KSB7aWYgKFNldHRpbmdWYWxpZGF0b3JfdHlwZW9mKGlucHV0KSAhPT0gIm9iamVjdCIgfHwgaW5wdXQgPT09IG51bGwpIHJldHVybiBpbnB1dDt2YXIgcHJpbSA9IGlucHV0W1N5bWJvbC50b1ByaW1pdGl2ZV07aWYgKHByaW0gIT09IHVuZGVmaW5lZCkge3ZhciByZXMgPSBwcmltLmNhbGwoaW5wdXQsIGhpbnQgfHwgImRlZmF1bHQiKTtpZiAoU2V0dGluZ1ZhbGlkYXRvcl90eXBlb2YocmVzKSAhPT0gIm9iamVjdCIpIHJldHVybiByZXM7dGhyb3cgbmV3IFR5cGVFcnJvcigiQEB0b1ByaW1pdGl2ZSBtdXN0IHJldHVybiBhIHByaW1pdGl2ZSB2YWx1ZS4iKTt9cmV0dXJuIChoaW50ID09PSAic3RyaW5nIiA/IFN0cmluZyA6IE51bWJlcikoaW5wdXQpO312YXIKCgogICAgICAgICAgU2V0dGluZ1ZhbGlkYXRvciA9IC8qI19fUFVSRV9fKi9mdW5jdGlvbiAoKSB7ZnVuY3Rpb24gU2V0dGluZ1ZhbGlkYXRvcigpIHtfY2xhc3NDYWxsQ2hlY2sodGhpcywgU2V0dGluZ1ZhbGlkYXRvcik7X2RlZmluZVByb3BlcnR5KHRoaXMsICJzZXR0aW5ncyIsCiAgICAgICAgICAgICAgW10pO19kZWZpbmVQcm9wZXJ0eSh0aGlzLCAib2JqZWN0IiwKICAgICAgICAgICAgICB7fSk7fV9jcmVhdGVDbGFzcyhTZXR0aW5nVmFsaWRhdG9yLCBbeyBrZXk6ICJhZGRTZXR0aW5nIiwgdmFsdWU6CgogICAgICAgICAgICAgIGZ1bmN0aW9uIGFkZFNldHRpbmcoc2V0dGluZywgc2V0U3RhdGUpIHsKICAgICAgICAgICAgICAgIHRoaXMuc2V0dGluZ3MucHVzaChbc2V0dGluZywgc2V0U3RhdGVdKTsKICAgICAgICAgICAgICB9IH0sIHsga2V5OiAidXBkYXRlU2V0dGluZyIsIHZhbHVlOgoKICAgICAgICAgICAgICBmdW5jdGlvbiB1cGRhdGVTZXR0aW5nKHNldHRpbmcpIHsKICAgICAgICAgICAgICAgIHRoaXMub2JqZWN0W3NldHRpbmcucHJlZmVyZW5jZV0gPSBzZXR0aW5nLnZhbHVlOwogICAgICAgICAgICAgICAgdGhpcy5kb1ZhbGlkYXRlcygpOwogICAgICAgICAgICAgIH0gfSwgeyBrZXk6ICJ1cGRhdGVPYmplY3QiLCB2YWx1ZToKCiAgICAgICAgICAgICAgZnVuY3Rpb24gdXBkYXRlT2JqZWN0KCkge3ZhciBfaXRlcmF0b3IgPSBfY3JlYXRlRm9yT2ZJdGVyYXRvckhlbHBlcigKICAgICAgICAgICAgICAgICAgdGhpcy5zZXR0aW5ncyksX3N0ZXA7dHJ5IHtmb3IgKF9pdGVyYXRvci5zKCk7ICEoX3N0ZXAgPSBfaXRlcmF0b3IubigpKS5kb25lOykge3ZhciBfc3RlcCR2YWx1ZSA9IF9zbGljZWRUb0FycmF5KF9zdGVwLnZhbHVlLCAxKSxzZXR0aW5nID0gX3N0ZXAkdmFsdWVbMF07CiAgICAgICAgICAgICAgICAgICAgdGhpcy5vYmplY3Rbc2V0dGluZy5wcmVmZXJlbmNlXSA9IHNldHRpbmcudmFsdWU7CiAgICAgICAgICAgICAgICAgIH19IGNhdGNoIChlcnIpIHtfaXRlcmF0b3IuZShlcnIpO30gZmluYWxseSB7X2l0ZXJhdG9yLmYoKTt9CiAgICAgICAgICAgICAgfSB9LCB7IGtleTogImRvVmFsaWRhdGVzIiwgdmFsdWU6CgogICAgICAgICAgICAgIGZ1bmN0aW9uIGRvVmFsaWRhdGVzKCkge3ZhciBfaXRlcmF0b3IyID0gX2NyZWF0ZUZvck9mSXRlcmF0b3JIZWxwZXIoCiAgICAgICAgICAgICAgICAgIHRoaXMuc2V0dGluZ3MpLF9zdGVwMjt0cnkge2ZvciAoX2l0ZXJhdG9yMi5zKCk7ICEoX3N0ZXAyID0gX2l0ZXJhdG9yMi5uKCkpLmRvbmU7KSB7dmFyIF9zdGVwMiR2YWx1ZSA9IF9zbGljZWRUb0FycmF5KF9zdGVwMi52YWx1ZSwgMiksc2V0dGluZyA9IF9zdGVwMiR2YWx1ZVswXSxzZXRWYWxpZCA9IF9zdGVwMiR2YWx1ZVsxXTsKICAgICAgICAgICAgICAgICAgICBzZXRWYWxpZCh0aGlzLmlzVmFsaWQoc2V0dGluZykpOwogICAgICAgICAgICAgICAgICB9fSBjYXRjaCAoZXJyKSB7X2l0ZXJhdG9yMi5lKGVycik7fSBmaW5hbGx5IHtfaXRlcmF0b3IyLmYoKTt9CiAgICAgICAgICAgICAgfSB9LCB7IGtleTogImlzVmFsaWQiLCB2YWx1ZToKCiAgICAgICAgICAgICAgZnVuY3Rpb24gaXNWYWxpZChzZXR0aW5nKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gKAogICAgICAgICAgICAgICAgICBzZXR0aW5nLnZhbGlkYXRlID09IG51bGwgfHwgc2V0dGluZy52YWxpZGF0ZShzZXR0aW5nLnZhbHVlLCB0aGlzLm9iamVjdCkpOwoKICAgICAgICAgICAgICB9IH1dKTtyZXR1cm4gU2V0dGluZ1ZhbGlkYXRvcjt9KCk7CgoKICAgICAgICAgIC8qIGhhcm1vbnkgZGVmYXVsdCBleHBvcnQgKi92YXIgYXBpX1NldHRpbmdWYWxpZGF0b3IgPSBTZXR0aW5nVmFsaWRhdG9yOwogICAgICAgICAgOyAvLyBDT05DQVRFTkFURUQgTU9EVUxFOiAuL3NyYy9yZWxheS9jb21wb25lbnRzL0ludGVycnVwdC50c3gKCgoKCiAgICAgICAgICBmdW5jdGlvbiBJbnRlcnJ1cHQoX3JlZikge3ZhciBidXR0b24gPSBfcmVmLmJ1dHRvbjsKICAgICAgICAgICAgcmV0dXJuIC8qI19fUFVSRV9fKi8oCiAgICAgICAgICAgICAgcmVhY3QuY3JlYXRlRWxlbWVudCgiaW5wdXQiLCB7CiAgICAgICAgICAgICAgICBjbGFzc05hbWU6ICJpbnRlcnJ1cHQiLAogICAgICAgICAgICAgICAgdHlwZTogInN1Ym1pdCIsCiAgICAgICAgICAgICAgICB2YWx1ZTogYnV0dG9uLm5hbWUsCiAgICAgICAgICAgICAgICAiZGF0YS1uYW1lIjogYnV0dG9uLm5hbWUsCiAgICAgICAgICAgICAgICBvbkNsaWNrOiBmdW5jdGlvbiBvbkNsaWNrKCkgewogICAgICAgICAgICAgICAgICBzZXRQcm9wZXJ0aWVzKAogICAgICAgICAgICAgICAgICBidXR0b24uYWN0aW9ucy5tYXAoZnVuY3Rpb24gKF9yZWYyKSB7dmFyIHByZWZlcmVuY2UgPSBfcmVmMi5wcmVmZXJlbmNlLHZhbHVlID0gX3JlZjIudmFsdWU7cmV0dXJuIFtwcmVmZXJlbmNlLCB2YWx1ZV07fSkpLgogICAgICAgICAgICAgICAgICB0aGVuKGZ1bmN0aW9uICgpIHtyZXR1cm4gYWRkTm90aWZpY2F0aW9uKGJ1dHRvbi5ub3RpZmljYXRpb24gfHwgIkludGVycnVwdGVkISIpO30pOwogICAgICAgICAgICAgICAgfSB9KSk7CgoKICAgICAgICAgIH0KCiAgICAgICAgICAvKiBoYXJtb255IGRlZmF1bHQgZXhwb3J0ICovdmFyIGNvbXBvbmVudHNfSW50ZXJydXB0ID0gSW50ZXJydXB0OwogICAgICAgICAgOyAvLyBDT05DQVRFTkFURUQgTU9EVUxFOiAuL3NyYy9yZWxheS90eXBlcy9UeXBlcy50c3gKCgogICAgICAgICAgdmFyIFJlbGF5Q29tcG9uZW50VHlwZTsoZnVuY3Rpb24gKFJlbGF5Q29tcG9uZW50VHlwZSkge1JlbGF5Q29tcG9uZW50VHlwZVsiQk9PTEVBTiJdID0gImJvb2xlYW4iO1JlbGF5Q29tcG9uZW50VHlwZVsiRFJPUERPV04iXSA9ICJkcm9wZG93biI7UmVsYXlDb21wb25lbnRUeXBlWyJTVFJJTkciXSA9ICJzdHJpbmciO1JlbGF5Q29tcG9uZW50VHlwZVsiSFRNTCJdID0gImh0bWwiO1JlbGF5Q29tcG9uZW50VHlwZVsiSU5URVJSVVBUIl0gPSAiaW50ZXJydXB0IjtSZWxheUNvbXBvbmVudFR5cGVbIlRBR1MiXSA9ICJ0YWdzIjt9KShSZWxheUNvbXBvbmVudFR5cGUgfHwgKFJlbGF5Q29tcG9uZW50VHlwZSA9IHt9KSk7CiAgICAgICAgICA7IC8vIENPTkNBVEVOQVRFRCBNT0RVTEU6IC4vc3JjL3JlbGF5L2NvbXBvbmVudHMvc2V0dGluZ3MvQm9vbGVhbklucHV0LnRzeAogICAgICAgICAgZnVuY3Rpb24gQm9vbGVhbklucHV0X3NsaWNlZFRvQXJyYXkoYXJyLCBpKSB7cmV0dXJuIEJvb2xlYW5JbnB1dF9hcnJheVdpdGhIb2xlcyhhcnIpIHx8IEJvb2xlYW5JbnB1dF9pdGVyYWJsZVRvQXJyYXlMaW1pdChhcnIsIGkpIHx8IEJvb2xlYW5JbnB1dF91bnN1cHBvcnRlZEl0ZXJhYmxlVG9BcnJheShhcnIsIGkpIHx8IEJvb2xlYW5JbnB1dF9ub25JdGVyYWJsZVJlc3QoKTt9ZnVuY3Rpb24gQm9vbGVhbklucHV0X25vbkl0ZXJhYmxlUmVzdCgpIHt0aHJvdyBuZXcgVHlwZUVycm9yKCJJbnZhbGlkIGF0dGVtcHQgdG8gZGVzdHJ1Y3R1cmUgbm9uLWl0ZXJhYmxlIGluc3RhbmNlLlxuSW4gb3JkZXIgdG8gYmUgaXRlcmFibGUsIG5vbi1hcnJheSBvYmplY3RzIG11c3QgaGF2ZSBhIFtTeW1ib2wuaXRlcmF0b3JdKCkgbWV0aG9kLiIpO31mdW5jdGlvbiBCb29sZWFuSW5wdXRfdW5zdXBwb3J0ZWRJdGVyYWJsZVRvQXJyYXkobywgbWluTGVuKSB7aWYgKCFvKSByZXR1cm47aWYgKHR5cGVvZiBvID09PSAic3RyaW5nIikgcmV0dXJuIEJvb2xlYW5JbnB1dF9hcnJheUxpa2VUb0FycmF5KG8sIG1pbkxlbik7dmFyIG4gPSBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwobykuc2xpY2UoOCwgLTEpO2lmIChuID09PSAiT2JqZWN0IiAmJiBvLmNvbnN0cnVjdG9yKSBuID0gby5jb25zdHJ1Y3Rvci5uYW1lO2lmIChuID09PSAiTWFwIiB8fCBuID09PSAiU2V0IikgcmV0dXJuIEFycmF5LmZyb20obyk7aWYgKG4gPT09ICJBcmd1bWVudHMiIHx8IC9eKD86VWl8SSludCg/Ojh8MTZ8MzIpKD86Q2xhbXBlZCk/QXJyYXkkLy50ZXN0KG4pKSByZXR1cm4gQm9vbGVhbklucHV0X2FycmF5TGlrZVRvQXJyYXkobywgbWluTGVuKTt9ZnVuY3Rpb24gQm9vbGVhbklucHV0X2FycmF5TGlrZVRvQXJyYXkoYXJyLCBsZW4pIHtpZiAobGVuID09IG51bGwgfHwgbGVuID4gYXJyLmxlbmd0aCkgbGVuID0gYXJyLmxlbmd0aDtmb3IgKHZhciBpID0gMCwgYXJyMiA9IG5ldyBBcnJheShsZW4pOyBpIDwgbGVuOyBpKyspIGFycjJbaV0gPSBhcnJbaV07cmV0dXJuIGFycjI7fWZ1bmN0aW9uIEJvb2xlYW5JbnB1dF9pdGVyYWJsZVRvQXJyYXlMaW1pdChhcnIsIGkpIHt2YXIgX2kgPSBudWxsID09IGFyciA/IG51bGwgOiAidW5kZWZpbmVkIiAhPSB0eXBlb2YgU3ltYm9sICYmIGFycltTeW1ib2wuaXRlcmF0b3JdIHx8IGFyclsiQEBpdGVyYXRvciJdO2lmIChudWxsICE9IF9pKSB7dmFyIF9zLF9lLF94LF9yLF9hcnIgPSBbXSxfbiA9ICEwLF9kID0gITE7dHJ5IHtpZiAoX3ggPSAoX2kgPSBfaS5jYWxsKGFycikpLm5leHQsIDAgPT09IGkpIHtpZiAoT2JqZWN0KF9pKSAhPT0gX2kpIHJldHVybjtfbiA9ICExO30gZWxzZSBmb3IgKDsgIShfbiA9IChfcyA9IF94LmNhbGwoX2kpKS5kb25lKSAmJiAoX2Fyci5wdXNoKF9zLnZhbHVlKSwgX2Fyci5sZW5ndGggIT09IGkpOyBfbiA9ICEwKTt9IGNhdGNoIChlcnIpIHtfZCA9ICEwLCBfZSA9IGVycjt9IGZpbmFsbHkge3RyeSB7aWYgKCFfbiAmJiBudWxsICE9IF9pWyJyZXR1cm4iXSAmJiAoX3IgPSBfaVsicmV0dXJuIl0oKSwgT2JqZWN0KF9yKSAhPT0gX3IpKSByZXR1cm47fSBmaW5hbGx5IHtpZiAoX2QpIHRocm93IF9lO319cmV0dXJuIF9hcnI7fX1mdW5jdGlvbiBCb29sZWFuSW5wdXRfYXJyYXlXaXRoSG9sZXMoYXJyKSB7aWYgKEFycmF5LmlzQXJyYXkoYXJyKSkgcmV0dXJuIGFycjt9CgoKCiAgICAgICAgICBmdW5jdGlvbiBCb29sZWFuSW5wdXQoX3JlZikge3ZhciBidXR0b24gPSBfcmVmLmJ1dHRvbjsKICAgICAgICAgICAgdmFyIF91c2VTdGF0ZSA9ICgwLCByZWFjdC51c2VTdGF0ZSkoYnV0dG9uLnZhbHVlID09PSAidHJ1ZSIpLF91c2VTdGF0ZTIgPSBCb29sZWFuSW5wdXRfc2xpY2VkVG9BcnJheShfdXNlU3RhdGUsIDIpLHZhbHVlID0gX3VzZVN0YXRlMlswXSxzZXRWYWx1ZSA9IF91c2VTdGF0ZTJbMV07CgogICAgICAgICAgICByZXR1cm4gLyojX19QVVJFX18qLygKICAgICAgICAgICAgICByZWFjdC5jcmVhdGVFbGVtZW50KCJsYWJlbCIsIHsgY2xhc3NOYW1lOiAiY2hlY2tjb250YWluZXIiIH0sIC8qI19fUFVSRV9fKi8KICAgICAgICAgICAgICByZWFjdC5jcmVhdGVFbGVtZW50KCJpbnB1dCIsIHsgdHlwZTogImhpZGRlbiIsIG5hbWU6IGJ1dHRvbi5uYW1lLCB2YWx1ZTogYnV0dG9uLnZhbHVlIH0pLCAvKiNfX1BVUkVfXyovCiAgICAgICAgICAgICAgcmVhY3QuY3JlYXRlRWxlbWVudCgiZGl2IiwgewogICAgICAgICAgICAgICAgY2xhc3NOYW1lOiAidG9nZ2xlLXRyYWNrIiwKICAgICAgICAgICAgICAgIG9uQ2xpY2s6IGZ1bmN0aW9uIG9uQ2xpY2soKSB7CiAgICAgICAgICAgICAgICAgIHNldFZhbHVlKCF2YWx1ZSk7CiAgICAgICAgICAgICAgICAgIGJ1dHRvbi5zZXRWYWx1ZSgoIXZhbHVlKS50b1N0cmluZygpKTsKICAgICAgICAgICAgICAgIH0gfSwgLyojX19QVVJFX18qLwoKICAgICAgICAgICAgICByZWFjdC5jcmVhdGVFbGVtZW50KCJzcGFuIiwgeyBjbGFzc05hbWU6ICJ0b2dnbGUtaW5kaWNhdG9yIiB9LCAvKiNfX1BVUkVfXyovCiAgICAgICAgICAgICAgcmVhY3QuY3JlYXRlRWxlbWVudCgic3BhbiIsIHsgY2xhc3NOYW1lOiAiY2hlY2tNYXJrIiB9LCAvKiNfX1BVUkVfXyovCiAgICAgICAgICAgICAgcmVhY3QuY3JlYXRlRWxlbWVudCgic3ZnIiwgewogICAgICAgICAgICAgICAgdmlld0JveDogIjAgMCAyNCAyNCIsCiAgICAgICAgICAgICAgICBpZDogImdocS1zdmctY2hlY2siLAogICAgICAgICAgICAgICAgcm9sZTogInByZXNlbnRhdGlvbiIsCiAgICAgICAgICAgICAgICAiYXJpYS1oaWRkZW4iOiAidHJ1ZSIgfSwgLyojX19QVVJFX18qLwoKICAgICAgICAgICAgICByZWFjdC5jcmVhdGVFbGVtZW50KCJwYXRoIiwgeyBkOiAiTTkuODYgMThhMSAxIDAgMDEtLjczLS4zMmwtNC44Ni01LjE3YTEuMDAxIDEuMDAxIDAgMDExLjQ2LTEuMzdsNC4xMiA0LjM5IDguNDEtOS4yYTEgMSAwIDExMS40OCAxLjM0bC05LjE0IDEwYTEgMSAwIDAxLS43My4zM2gtLjAxeiIgfSkpKSkpKSk7CgoKCgoKCiAgICAgICAgICB9CgogICAgICAgICAgLyoKICAgICAgICAgIDxkaXYKICAgICAgICAgICAgY2xhc3M9ImNoZWNrbWFyayIKICAgICAgICAgICAgb25DbGljaz17KCkgPT4gewogICAgICAgICAgICAgIHNldFZhbHVlKCF2YWx1ZSk7CiAgICAgICAgICAgIH19CiAgICAgICAgICAvPgogICAgICAgICAgICovCiAgICAgICAgICAvKiBoYXJtb255IGRlZmF1bHQgZXhwb3J0ICovdmFyIHNldHRpbmdzX0Jvb2xlYW5JbnB1dCA9IEJvb2xlYW5JbnB1dDsKICAgICAgICAgIDsgLy8gQ09OQ0FURU5BVEVEIE1PRFVMRTogLi9zcmMvcmVsYXkvY29tcG9uZW50cy9zZXR0aW5ncy9Ecm9wZG93bklucHV0LnRzeAoKCgogICAgICAgICAgZnVuY3Rpb24gRHJvcGRvd25JbnB1dChfcmVmKSB7dmFyIGJ1dHRvbiA9IF9yZWYuYnV0dG9uOwogICAgICAgICAgICByZXR1cm4gLyojX19QVVJFX18qLygKICAgICAgICAgICAgICByZWFjdC5jcmVhdGVFbGVtZW50KCJzZWxlY3QiLCB7CiAgICAgICAgICAgICAgICBjbGFzc05hbWU6ICJkcm9wZG93bmNvbnRhaW5lciIsCiAgICAgICAgICAgICAgICBuYW1lOiBidXR0b24ubmFtZSwKICAgICAgICAgICAgICAgIGRlZmF1bHRWYWx1ZTogYnV0dG9uLnZhbHVlLAogICAgICAgICAgICAgICAgb25DaGFuZ2U6IGZ1bmN0aW9uIG9uQ2hhbmdlKGUpIHtyZXR1cm4gYnV0dG9uLnNldFZhbHVlKGUudGFyZ2V0LnZhbHVlKTt9IH0sCgogICAgICAgICAgICAgIGJ1dHRvbi5kcm9wZG93bi5tYXAoZnVuY3Rpb24gKG9wdGlvbiwgaW5kZXgpIHsKICAgICAgICAgICAgICAgIHJldHVybiAvKiNfX1BVUkVfXyovKAogICAgICAgICAgICAgICAgICByZWFjdC5jcmVhdGVFbGVtZW50KCJvcHRpb24iLCB7IGtleTogaW5kZXgsIHZhbHVlOiBvcHRpb24udmFsdWUgfSwKICAgICAgICAgICAgICAgICAgb3B0aW9uLmRpc3BsYXkgfHwgb3B0aW9uLnZhbHVlKSk7CgoKICAgICAgICAgICAgICB9KSkpOwoKCiAgICAgICAgICB9CgogICAgICAgICAgLyogaGFybW9ueSBkZWZhdWx0IGV4cG9ydCAqL3ZhciBzZXR0aW5nc19Ecm9wZG93bklucHV0ID0gRHJvcGRvd25JbnB1dDsKICAgICAgICAgIDsgLy8gQ09OQ0FURU5BVEVEIE1PRFVMRTogLi9zcmMvcmVsYXkvY29tcG9uZW50cy9zZXR0aW5ncy9TdHJpbmdJbnB1dC50c3gKCgoKICAgICAgICAgIGZ1bmN0aW9uIFN0cmluZ0lucHV0KF9yZWYpIHt2YXIgYnV0dG9uID0gX3JlZi5idXR0b247CiAgICAgICAgICAgIHJldHVybiAvKiNfX1BVUkVfXyovKAogICAgICAgICAgICAgIHJlYWN0LmNyZWF0ZUVsZW1lbnQoImlucHV0IiwgewogICAgICAgICAgICAgICAgY2xhc3NOYW1lOiAic3RyaW5nY29udGFpbmVyIiwKICAgICAgICAgICAgICAgIG5hbWU6IGJ1dHRvbi5uYW1lLAogICAgICAgICAgICAgICAgZGVmYXVsdFZhbHVlOiBidXR0b24udmFsdWUsCiAgICAgICAgICAgICAgICBwbGFjZWhvbGRlcjogYnV0dG9uLnBsYWNlaG9sZGVyVGV4dCA/IGJ1dHRvbi5wbGFjZWhvbGRlclRleHQgOiAiIiwKICAgICAgICAgICAgICAgIG9uQ2hhbmdlOiBmdW5jdGlvbiBvbkNoYW5nZShlKSB7cmV0dXJuIGJ1dHRvbi5zZXRWYWx1ZShlLnRhcmdldC52YWx1ZSk7fSB9KSk7CgoKICAgICAgICAgIH0KCiAgICAgICAgICAvKiBoYXJtb255IGRlZmF1bHQgZXhwb3J0ICovdmFyIHNldHRpbmdzX1N0cmluZ0lucHV0ID0gU3RyaW5nSW5wdXQ7CiAgICAgICAgICA7IC8vIENPTkNBVEVOQVRFRCBNT0RVTEU6IC4vc3JjL3JlbGF5L2NvbXBvbmVudHMvc2V0dGluZ3MvVGFnc0lucHV0LnRzeAogICAgICAgICAgZnVuY3Rpb24gX3RvQ29uc3VtYWJsZUFycmF5KGFycikge3JldHVybiBfYXJyYXlXaXRob3V0SG9sZXMoYXJyKSB8fCBfaXRlcmFibGVUb0FycmF5KGFycikgfHwgVGFnc0lucHV0X3Vuc3VwcG9ydGVkSXRlcmFibGVUb0FycmF5KGFycikgfHwgX25vbkl0ZXJhYmxlU3ByZWFkKCk7fWZ1bmN0aW9uIF9ub25JdGVyYWJsZVNwcmVhZCgpIHt0aHJvdyBuZXcgVHlwZUVycm9yKCJJbnZhbGlkIGF0dGVtcHQgdG8gc3ByZWFkIG5vbi1pdGVyYWJsZSBpbnN0YW5jZS5cbkluIG9yZGVyIHRvIGJlIGl0ZXJhYmxlLCBub24tYXJyYXkgb2JqZWN0cyBtdXN0IGhhdmUgYSBbU3ltYm9sLml0ZXJhdG9yXSgpIG1ldGhvZC4iKTt9ZnVuY3Rpb24gX2l0ZXJhYmxlVG9BcnJheShpdGVyKSB7aWYgKHR5cGVvZiBTeW1ib2wgIT09ICJ1bmRlZmluZWQiICYmIGl0ZXJbU3ltYm9sLml0ZXJhdG9yXSAhPSBudWxsIHx8IGl0ZXJbIkBAaXRlcmF0b3IiXSAhPSBudWxsKSByZXR1cm4gQXJyYXkuZnJvbShpdGVyKTt9ZnVuY3Rpb24gX2FycmF5V2l0aG91dEhvbGVzKGFycikge2lmIChBcnJheS5pc0FycmF5KGFycikpIHJldHVybiBUYWdzSW5wdXRfYXJyYXlMaWtlVG9BcnJheShhcnIpO31mdW5jdGlvbiBUYWdzSW5wdXRfc2xpY2VkVG9BcnJheShhcnIsIGkpIHtyZXR1cm4gVGFnc0lucHV0X2FycmF5V2l0aEhvbGVzKGFycikgfHwgVGFnc0lucHV0X2l0ZXJhYmxlVG9BcnJheUxpbWl0KGFyciwgaSkgfHwgVGFnc0lucHV0X3Vuc3VwcG9ydGVkSXRlcmFibGVUb0FycmF5KGFyciwgaSkgfHwgVGFnc0lucHV0X25vbkl0ZXJhYmxlUmVzdCgpO31mdW5jdGlvbiBUYWdzSW5wdXRfbm9uSXRlcmFibGVSZXN0KCkge3Rocm93IG5ldyBUeXBlRXJyb3IoIkludmFsaWQgYXR0ZW1wdCB0byBkZXN0cnVjdHVyZSBub24taXRlcmFibGUgaW5zdGFuY2UuXG5JbiBvcmRlciB0byBiZSBpdGVyYWJsZSwgbm9uLWFycmF5IG9iamVjdHMgbXVzdCBoYXZlIGEgW1N5bWJvbC5pdGVyYXRvcl0oKSBtZXRob2QuIik7fWZ1bmN0aW9uIFRhZ3NJbnB1dF91bnN1cHBvcnRlZEl0ZXJhYmxlVG9BcnJheShvLCBtaW5MZW4pIHtpZiAoIW8pIHJldHVybjtpZiAodHlwZW9mIG8gPT09ICJzdHJpbmciKSByZXR1cm4gVGFnc0lucHV0X2FycmF5TGlrZVRvQXJyYXkobywgbWluTGVuKTt2YXIgbiA9IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChvKS5zbGljZSg4LCAtMSk7aWYgKG4gPT09ICJPYmplY3QiICYmIG8uY29uc3RydWN0b3IpIG4gPSBvLmNvbnN0cnVjdG9yLm5hbWU7aWYgKG4gPT09ICJNYXAiIHx8IG4gPT09ICJTZXQiKSByZXR1cm4gQXJyYXkuZnJvbShvKTtpZiAobiA9PT0gIkFyZ3VtZW50cyIgfHwgL14oPzpVaXxJKW50KD86OHwxNnwzMikoPzpDbGFtcGVkKT9BcnJheSQvLnRlc3QobikpIHJldHVybiBUYWdzSW5wdXRfYXJyYXlMaWtlVG9BcnJheShvLCBtaW5MZW4pO31mdW5jdGlvbiBUYWdzSW5wdXRfYXJyYXlMaWtlVG9BcnJheShhcnIsIGxlbikge2lmIChsZW4gPT0gbnVsbCB8fCBsZW4gPiBhcnIubGVuZ3RoKSBsZW4gPSBhcnIubGVuZ3RoO2ZvciAodmFyIGkgPSAwLCBhcnIyID0gbmV3IEFycmF5KGxlbik7IGkgPCBsZW47IGkrKykgYXJyMltpXSA9IGFycltpXTtyZXR1cm4gYXJyMjt9ZnVuY3Rpb24gVGFnc0lucHV0X2l0ZXJhYmxlVG9BcnJheUxpbWl0KGFyciwgaSkge3ZhciBfaSA9IG51bGwgPT0gYXJyID8gbnVsbCA6ICJ1bmRlZmluZWQiICE9IHR5cGVvZiBTeW1ib2wgJiYgYXJyW1N5bWJvbC5pdGVyYXRvcl0gfHwgYXJyWyJAQGl0ZXJhdG9yIl07aWYgKG51bGwgIT0gX2kpIHt2YXIgX3MsX2UsX3gsX3IsX2FyciA9IFtdLF9uID0gITAsX2QgPSAhMTt0cnkge2lmIChfeCA9IChfaSA9IF9pLmNhbGwoYXJyKSkubmV4dCwgMCA9PT0gaSkge2lmIChPYmplY3QoX2kpICE9PSBfaSkgcmV0dXJuO19uID0gITE7fSBlbHNlIGZvciAoOyAhKF9uID0gKF9zID0gX3guY2FsbChfaSkpLmRvbmUpICYmIChfYXJyLnB1c2goX3MudmFsdWUpLCBfYXJyLmxlbmd0aCAhPT0gaSk7IF9uID0gITApO30gY2F0Y2ggKGVycikge19kID0gITAsIF9lID0gZXJyO30gZmluYWxseSB7dHJ5IHtpZiAoIV9uICYmIG51bGwgIT0gX2lbInJldHVybiJdICYmIChfciA9IF9pWyJyZXR1cm4iXSgpLCBPYmplY3QoX3IpICE9PSBfcikpIHJldHVybjt9IGZpbmFsbHkge2lmIChfZCkgdGhyb3cgX2U7fX1yZXR1cm4gX2Fycjt9fWZ1bmN0aW9uIFRhZ3NJbnB1dF9hcnJheVdpdGhIb2xlcyhhcnIpIHtpZiAoQXJyYXkuaXNBcnJheShhcnIpKSByZXR1cm4gYXJyO30KCgogICAgICAgICAgdmFyIENsb3NlSWNvbiA9IGZ1bmN0aW9uIENsb3NlSWNvbigpIHsKICAgICAgICAgICAgcmV0dXJuIC8qI19fUFVSRV9fKi8oCiAgICAgICAgICAgICAgcmVhY3QuY3JlYXRlRWxlbWVudCgic3ZnIiwgeyBoZWlnaHQ6ICIyMCIsIHdpZHRoOiAiMjAiLCB2aWV3Qm94OiAiMCAwIDIwIDIwIiB9LCAvKiNfX1BVUkVfXyovCiAgICAgICAgICAgICAgcmVhY3QuY3JlYXRlRWxlbWVudCgicGF0aCIsIHsgZDogIk0xNC4zNDggMTQuODQ5Yy0wLjQ2OSAwLjQ2OS0xLjIyOSAwLjQ2OS0xLjY5NyAwbC0yLjY1MS0zLjAzMC0yLjY1MSAzLjAyOWMtMC40NjkgMC40NjktMS4yMjkgMC40NjktMS42OTcgMC0wLjQ2OS0wLjQ2OS0wLjQ2OS0xLjIyOSAwLTEuNjk3bDIuNzU4LTMuMTUtMi43NTktMy4xNTJjLTAuNDY5LTAuNDY5LTAuNDY5LTEuMjI4IDAtMS42OTdzMS4yMjgtMC40NjkgMS42OTcgMGwyLjY1MiAzLjAzMSAyLjY1MS0zLjAzMWMwLjQ2OS0wLjQ2OSAxLjIyOC0wLjQ2OSAxLjY5NyAwczAuNDY5IDEuMjI5IDAgMS42OTdsLTIuNzU4IDMuMTUyIDIuNzU4IDMuMTVjMC40NjkgMC40NjkgMC40NjkgMS4yMjkgMCAxLjY5OHoiIH0pKSk7CgoKICAgICAgICAgIH07CgogICAgICAgICAgdmFyIG1hcFZhbHVlc1RvRGlzcGxheSA9IGZ1bmN0aW9uIG1hcFZhbHVlc1RvRGlzcGxheShidXR0b24sIHZhbHVlcykgewogICAgICAgICAgICB2YXIgdGFncyA9IFtdOwoKICAgICAgICAgICAgdmFsdWVzLmZvckVhY2goZnVuY3Rpb24gKHYpIHsKICAgICAgICAgICAgICBpZiAoYnV0dG9uLmRyb3Bkb3duID09IG51bGwpIHsKICAgICAgICAgICAgICAgIHRhZ3MucHVzaCh7IGRpc3BsYXk6IHYsIHZhbHVlOiB2IH0pOwogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgdmFyIGRyb3AgPSBidXR0b24uZHJvcGRvd24uZmluZCgKICAgICAgICAgICAgICBmdW5jdGlvbiAoZCkge3JldHVybiBkLnZhbHVlLnRvTG93ZXJDYXNlKCkgPT0gdi50b0xvd2VyQ2FzZSgpO30pOwoKCiAgICAgICAgICAgICAgaWYgKGRyb3AgPT0gbnVsbCkgewogICAgICAgICAgICAgICAgdGFncy5wdXNoKHsgZGlzcGxheTogdiwgdmFsdWU6IHYgfSk7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICB0YWdzLnB1c2goZHJvcCk7CiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgcmV0dXJuIHRhZ3M7CiAgICAgICAgICB9OwoKICAgICAgICAgIHZhciBUYWdzSW5wdXQgPSBmdW5jdGlvbiBUYWdzSW5wdXQoX3JlZikge3ZhciBidXR0b24gPSBfcmVmLmJ1dHRvbjsKICAgICAgICAgICAgdmFyIF9SZWFjdCR1c2VTdGF0ZSA9IHJlYWN0LnVzZVN0YXRlKAogICAgICAgICAgICAgIG1hcFZhbHVlc1RvRGlzcGxheSgKICAgICAgICAgICAgICBidXR0b24sCiAgICAgICAgICAgICAgYnV0dG9uLnZhbHVlLnNwbGl0KGJ1dHRvbi50YWdzU2VwZXJhdG9yKS5maWx0ZXIoZnVuY3Rpb24gKHMpIHtyZXR1cm4gcy5sZW5ndGggPiAwO30pKSksX1JlYWN0JHVzZVN0YXRlMiA9IFRhZ3NJbnB1dF9zbGljZWRUb0FycmF5KF9SZWFjdCR1c2VTdGF0ZSwgMiksdGFncyA9IF9SZWFjdCR1c2VTdGF0ZTJbMF0sc2V0VGFncyA9IF9SZWFjdCR1c2VTdGF0ZTJbMV07CgoKCiAgICAgICAgICAgIHZhciBhZGRUYWcgPSBmdW5jdGlvbiBhZGRUYWcodGFnKSB7CiAgICAgICAgICAgICAgc2V0U2VhcmNoVmFsdWUoIiIpOwogICAgICAgICAgICAgIHNldFRhZ3MoW10uY29uY2F0KF90b0NvbnN1bWFibGVBcnJheSh0YWdzKSwgW3RhZ10pKTsKCiAgICAgICAgICAgICAgdmFyIHZhbHMgPSBidXR0b24udmFsdWUuCiAgICAgICAgICAgICAgc3BsaXQoYnV0dG9uLnRhZ3NTZXBlcmF0b3IpLgogICAgICAgICAgICAgIGZpbHRlcihmdW5jdGlvbiAocykge3JldHVybiBzLmxlbmd0aCA+IDA7fSk7CiAgICAgICAgICAgICAgdmFscy5wdXNoKHRhZy52YWx1ZSk7CgogICAgICAgICAgICAgIGJ1dHRvbi5zZXRWYWx1ZSh2YWxzLmpvaW4oYnV0dG9uLnRhZ3NTZXBlcmF0b3IpKTsKICAgICAgICAgICAgfTsKCiAgICAgICAgICAgIC8vIEFkZCBvciByZW1vdmUgdGFncyBieSB1c2luZyB0aGUga2V5CiAgICAgICAgICAgIHZhciBoYW5kbGVUYWdzID0gZnVuY3Rpb24gaGFuZGxlVGFncyhldmVudCkgewogICAgICAgICAgICAgIGlmIChldmVudC5rZXkgPT09ICJFbnRlciIgJiYgZXZlbnQuY3VycmVudFRhcmdldC52YWx1ZSAhPT0gIiIpIHsKICAgICAgICAgICAgICAgIHZhciBkcm9wZG93blZhbHVlID0KICAgICAgICAgICAgICAgIGJ1dHRvbi5kcm9wZG93biAhPSBudWxsID8KICAgICAgICAgICAgICAgIGJ1dHRvbi5kcm9wZG93bi5maW5kKAogICAgICAgICAgICAgICAgZnVuY3Rpb24gKGQpIHtyZXR1cm4gKAogICAgICAgICAgICAgICAgICAgIGQuZGlzcGxheS50b0xvd2VyQ2FzZSgpID09CiAgICAgICAgICAgICAgICAgICAgZXZlbnQuY3VycmVudFRhcmdldC52YWx1ZS50b0xvd2VyQ2FzZSgpKTt9KSA6CgogICAgICAgICAgICAgICAgbnVsbDsKCiAgICAgICAgICAgICAgICBpZiAoYnV0dG9uLmRyb3Bkb3duICE9IG51bGwgJiYgZHJvcGRvd25WYWx1ZSA9PSBudWxsKSB7CiAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICB2YXIgdmFsID0KICAgICAgICAgICAgICAgIGRyb3Bkb3duVmFsdWUgIT0gbnVsbCA/IGRyb3Bkb3duVmFsdWUudmFsdWUgOiBldmVudC5jdXJyZW50VGFyZ2V0LnZhbHVlOwoKICAgICAgICAgICAgICAgIGlmICghYnV0dG9uLmFsbG93RHVwbGljYXRlVGFncykgewogICAgICAgICAgICAgICAgICBpZiAoCiAgICAgICAgICAgICAgICAgIGJ1dHRvbi52YWx1ZS4KICAgICAgICAgICAgICAgICAgc3BsaXQoYnV0dG9uLnRhZ3NTZXBlcmF0b3IpLgogICAgICAgICAgICAgICAgICBmaW5kKGZ1bmN0aW9uIChkKSB7cmV0dXJuIGQudG9Mb3dlckNhc2UoKSA9PSB2YWwudG9Mb3dlckNhc2UoKTt9KSAhPSBudWxsKQogICAgICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgYWRkVGFnKAogICAgICAgICAgICAgICAgZHJvcGRvd25WYWx1ZSAhPSBudWxsID8gZHJvcGRvd25WYWx1ZSA6IHsgZGlzcGxheTogdmFsLCB2YWx1ZTogdmFsIH0pOwoKICAgICAgICAgICAgICB9IGVsc2UgaWYgKAogICAgICAgICAgICAgIGV2ZW50LmtleSA9PT0gIkJhY2tzcGFjZSIgJiYKICAgICAgICAgICAgICB0YWdzLmxlbmd0aCAmJgogICAgICAgICAgICAgIGV2ZW50LmN1cnJlbnRUYXJnZXQudmFsdWUubGVuZ3RoID09IDAgJiYKICAgICAgICAgICAgICAhY2FudFJlbW92ZVRhZ3MpCiAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgc2V0U2VhcmNoVmFsdWUodGFnc1t0YWdzLmxlbmd0aCAtIDFdLmRpc3BsYXkpOwoKICAgICAgICAgICAgICAgIHZhciB0YWdzQ29weSA9IF90b0NvbnN1bWFibGVBcnJheSh0YWdzKTsKICAgICAgICAgICAgICAgIHRhZ3NDb3B5LnBvcCgpOwogICAgICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTsKICAgICAgICAgICAgICAgIHNldFRhZ3ModGFnc0NvcHkpOwoKICAgICAgICAgICAgICAgIHZhciB2YWxzID0gYnV0dG9uLnZhbHVlLgogICAgICAgICAgICAgICAgc3BsaXQoYnV0dG9uLnRhZ3NTZXBlcmF0b3IpLgogICAgICAgICAgICAgICAgZmlsdGVyKGZ1bmN0aW9uIChzKSB7cmV0dXJuIHMubGVuZ3RoID4gMDt9KTsKICAgICAgICAgICAgICAgIHZhbHMucG9wKCk7CiAgICAgICAgICAgICAgICBidXR0b24uc2V0VmFsdWUodmFscy5qb2luKGJ1dHRvbi50YWdzU2VwZXJhdG9yKSk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9OwoKICAgICAgICAgICAgLy9SZW1vdmUgdGFncyBieSBjbGlja2luZyB0aGUgY3Jvc3Mgc2lnbgogICAgICAgICAgICB2YXIgcmVtb3ZlVGFncyA9IGZ1bmN0aW9uIHJlbW92ZVRhZ3MoaW5kZXgpIHsKICAgICAgICAgICAgICBzZXRMYXN0SW5zZXJ0ZWQoLTEpOwogICAgICAgICAgICAgIHNldFRhZ3MoX3RvQ29uc3VtYWJsZUFycmF5KHRhZ3MuZmlsdGVyKGZ1bmN0aW9uICh0YWcsIGluZCkge3JldHVybiBpbmQgIT09IGluZGV4O30pKSk7CgogICAgICAgICAgICAgIHZhciB2YWxzID0gYnV0dG9uLnZhbHVlLgogICAgICAgICAgICAgIHNwbGl0KGJ1dHRvbi50YWdzU2VwZXJhdG9yKS4KICAgICAgICAgICAgICBmaWx0ZXIoZnVuY3Rpb24gKHMpIHtyZXR1cm4gcy5sZW5ndGggPiAwO30pLgogICAgICAgICAgICAgIGZpbHRlcihmdW5jdGlvbiAodiwgaW5kKSB7cmV0dXJuIGluZCAhPT0gaW5kZXg7fSk7CgogICAgICAgICAgICAgIGJ1dHRvbi5zZXRWYWx1ZSh2YWxzLmpvaW4oYnV0dG9uLnRhZ3NTZXBlcmF0b3IpKTsKICAgICAgICAgICAgfTsKCiAgICAgICAgICAgIHZhciBfdXNlU3RhdGUgPSAoMCwgcmVhY3QudXNlU3RhdGUpKGZhbHNlKSxfdXNlU3RhdGUyID0gVGFnc0lucHV0X3NsaWNlZFRvQXJyYXkoX3VzZVN0YXRlLCAyKSxzaG93TWVudSA9IF91c2VTdGF0ZTJbMF0sc2V0U2hvd01lbnUgPSBfdXNlU3RhdGUyWzFdOwogICAgICAgICAgICB2YXIgX3VzZVN0YXRlMyA9ICgwLCByZWFjdC51c2VTdGF0ZSkoIiIpLF91c2VTdGF0ZTQgPSBUYWdzSW5wdXRfc2xpY2VkVG9BcnJheShfdXNlU3RhdGUzLCAyKSxzZWFyY2hWYWx1ZSA9IF91c2VTdGF0ZTRbMF0sc2V0U2VhcmNoVmFsdWUgPSBfdXNlU3RhdGU0WzFdOwogICAgICAgICAgICB2YXIgc2VhcmNoUmVmID0gLyojX19QVVJFX18qL3JlYWN0LmNyZWF0ZVJlZigpOwogICAgICAgICAgICB2YXIgc2VhcmNoQ29udGFpbmVyUmVmID0gLyojX19QVVJFX18qL3JlYWN0LmNyZWF0ZVJlZigpOwogICAgICAgICAgICB2YXIgaW5wdXRSZWYgPSAvKiNfX1BVUkVfXyovcmVhY3QuY3JlYXRlUmVmKCk7CiAgICAgICAgICAgIHZhciBfdXNlU3RhdGU1ID0gKDAsIHJlYWN0LnVzZVN0YXRlKSgtMSksX3VzZVN0YXRlNiA9IFRhZ3NJbnB1dF9zbGljZWRUb0FycmF5KF91c2VTdGF0ZTUsIDIpLGluc2VydEluZGV4QXQgPSBfdXNlU3RhdGU2WzBdLHNldEluc2VydEluZGV4QXQgPSBfdXNlU3RhdGU2WzFdOwogICAgICAgICAgICB2YXIgX3VzZVN0YXRlNyA9ICgwLCByZWFjdC51c2VTdGF0ZSkoLTEpLF91c2VTdGF0ZTggPSBUYWdzSW5wdXRfc2xpY2VkVG9BcnJheShfdXNlU3RhdGU3LCAyKSxkcmFnZ2VkSXRlbSA9IF91c2VTdGF0ZThbMF0sc2V0RHJhZ2dlZEl0ZW0gPSBfdXNlU3RhdGU4WzFdOwogICAgICAgICAgICB2YXIgX3VzZVN0YXRlOSA9ICgwLCByZWFjdC51c2VTdGF0ZSkoLTEpLF91c2VTdGF0ZTEwID0gVGFnc0lucHV0X3NsaWNlZFRvQXJyYXkoX3VzZVN0YXRlOSwgMiksbGFzdEluc2VydGVkID0gX3VzZVN0YXRlMTBbMF0sc2V0TGFzdEluc2VydGVkID0gX3VzZVN0YXRlMTBbMV07CiAgICAgICAgICAgIHZhciBfdXNlU3RhdGUxMSA9ICgwLCByZWFjdC51c2VTdGF0ZSkoMCksX3VzZVN0YXRlMTIgPSBUYWdzSW5wdXRfc2xpY2VkVG9BcnJheShfdXNlU3RhdGUxMSwgMiksZHJhZ2dlZFdpZHRoID0gX3VzZVN0YXRlMTJbMF0sc2V0RHJhZ2dlZFdpZHRoID0gX3VzZVN0YXRlMTJbMV07CiAgICAgICAgICAgIHZhciBfdXNlU3RhdGUxMyA9ICgwLCByZWFjdC51c2VTdGF0ZSkoMCksX3VzZVN0YXRlMTQgPSBUYWdzSW5wdXRfc2xpY2VkVG9BcnJheShfdXNlU3RhdGUxMywgMiksZHJhZ2dlZEhlaWdodCA9IF91c2VTdGF0ZTE0WzBdLHNldERyYWdnZWRIZWlnaHQgPSBfdXNlU3RhdGUxNFsxXTsKICAgICAgICAgICAgdmFyIF91c2VTdGF0ZTE1ID0gKDAsIHJlYWN0LnVzZVN0YXRlKSgKICAgICAgICAgICAgICBidXR0b24ubWluVGFncyAhPSBudWxsICYmIHBhcnNlSW50KGJ1dHRvbi5taW5UYWdzKSA+PSB0YWdzLmxlbmd0aCksX3VzZVN0YXRlMTYgPSBUYWdzSW5wdXRfc2xpY2VkVG9BcnJheShfdXNlU3RhdGUxNSwgMiksY2FudFJlbW92ZVRhZ3MgPSBfdXNlU3RhdGUxNlswXSxzZXRDYW50UmVtb3ZlVGFncyA9IF91c2VTdGF0ZTE2WzFdOwoKCiAgICAgICAgICAgICgwLCByZWFjdC51c2VFZmZlY3QpKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICBpZiAoc2hvd01lbnUgJiYgc2VhcmNoUmVmLmN1cnJlbnQpIHsKICAgICAgICAgICAgICAgIHNlYXJjaFJlZi5jdXJyZW50LmZvY3VzKCk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LCBbc2hvd01lbnVdKTsKCiAgICAgICAgICAgICgwLCByZWFjdC51c2VFZmZlY3QpKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICBzZXRDYW50UmVtb3ZlVGFncygKICAgICAgICAgICAgICBidXR0b24ubWluVGFncyAhPSBudWxsICYmIHBhcnNlSW50KGJ1dHRvbi5taW5UYWdzKSA+PSB0YWdzLmxlbmd0aCk7CgogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIHZhciBvbkFkZFRhZyA9IGZ1bmN0aW9uIG9uQWRkVGFnKG9wdGlvbikgewogICAgICAgICAgICAgIGlmICgKICAgICAgICAgICAgICAhYnV0dG9uLmFsbG93RHVwbGljYXRlVGFncyAmJgogICAgICAgICAgICAgIHRhZ3MuZmluZChmdW5jdGlvbiAodCkgewogICAgICAgICAgICAgICAgdC52YWx1ZSA9PSBvcHRpb24udmFsdWU7CiAgICAgICAgICAgICAgfSkpCiAgICAgICAgICAgICAgewogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgYWRkVGFnKG9wdGlvbik7CgogICAgICAgICAgICAgIGlmIChzZWFyY2hSZWYuY3VycmVudCAhPSBkb2N1bWVudC5hY3RpdmVFbGVtZW50KSB7CiAgICAgICAgICAgICAgICBzZXRTaG93TWVudShmYWxzZSk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9OwoKICAgICAgICAgICAgdmFyIG9uU2VhcmNoID0gZnVuY3Rpb24gb25TZWFyY2goZSkgewogICAgICAgICAgICAgIHNldFNlYXJjaFZhbHVlKGUudGFyZ2V0LnZhbHVlKTsKICAgICAgICAgICAgfTsKCiAgICAgICAgICAgIHZhciBnZXRPcHRpb25zID0gZnVuY3Rpb24gZ2V0T3B0aW9ucygpIHsKICAgICAgICAgICAgICB2YXIgb3B0cyA9IGJ1dHRvbi5hbGxvd0R1cGxpY2F0ZVRhZ3MgPwogICAgICAgICAgICAgIGJ1dHRvbi5kcm9wZG93biA6CiAgICAgICAgICAgICAgYnV0dG9uLmRyb3Bkb3duLmZpbHRlcihmdW5jdGlvbiAoZCkge3JldHVybiAhdGFncy5pbmNsdWRlcyhkKTt9KTsKCiAgICAgICAgICAgICAgaWYgKCFzZWFyY2hWYWx1ZSkgewogICAgICAgICAgICAgICAgcmV0dXJuIG9wdHM7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICByZXR1cm4gb3B0cy5maWx0ZXIoCiAgICAgICAgICAgICAgZnVuY3Rpb24gKG9wdGlvbikge3JldHVybiAoCiAgICAgICAgICAgICAgICAgIG9wdGlvbi5kaXNwbGF5LnRvTG93ZXJDYXNlKCkuaW5kZXhPZihzZWFyY2hWYWx1ZS50b0xvd2VyQ2FzZSgpKSA+PSAwKTt9KTsKCiAgICAgICAgICAgIH07CgogICAgICAgICAgICB2YXIgZHJvcGRvd25Gb2N1c0hhbmRsZXIgPSBmdW5jdGlvbiBkcm9wZG93bkZvY3VzSGFuZGxlcigpIHsKICAgICAgICAgICAgICBpZiAoc2VhcmNoQ29udGFpbmVyUmVmLmN1cnJlbnQgPT0gbnVsbCkgewogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgaWYgKCEoZG9jdW1lbnQuYWN0aXZlRWxlbWVudCBpbnN0YW5jZW9mIE5vZGUpKSB7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBpZiAoc2VhcmNoQ29udGFpbmVyUmVmLmN1cnJlbnQuY29udGFpbnMoZG9jdW1lbnQuYWN0aXZlRWxlbWVudCkpIHsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIHNldFNob3dNZW51KGZhbHNlKTsKICAgICAgICAgICAgfTsKCiAgICAgICAgICAgICgwLCByZWFjdC51c2VFZmZlY3QpKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigiY2xpY2siLCBmdW5jdGlvbiAoKSB7cmV0dXJuIGRyb3Bkb3duRm9jdXNIYW5kbGVyKCk7fSk7CgogICAgICAgICAgICAgIHJldHVybiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICB3aW5kb3cucmVtb3ZlRXZlbnRMaXN0ZW5lcigiY2xpY2siLCBmdW5jdGlvbiAoKSB7cmV0dXJuIGRyb3Bkb3duRm9jdXNIYW5kbGVyKCk7fSk7CiAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgfSk7CgogICAgICAgICAgICB2YXIgdXBkYXRlSW5kZXhJbnNlcnQgPSBmdW5jdGlvbiB1cGRhdGVJbmRleEluc2VydChlKSB7dmFyIF90YWckZ2V0QXR0cmlidXRlOwogICAgICAgICAgICAgIGlmIChpbnB1dFJlZi5jdXJyZW50ID09IG51bGwpIHsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIHZhciB0YWcgPSBlLmN1cnJlbnRUYXJnZXQ7CiAgICAgICAgICAgICAgdmFyIHRhZ0lkID0gKygoX3RhZyRnZXRBdHRyaWJ1dGUgPSB0YWcuZ2V0QXR0cmlidXRlKCJkYXRhLWtleSIpKSAhPT0gbnVsbCAmJiBfdGFnJGdldEF0dHJpYnV0ZSAhPT0gdm9pZCAwID8gX3RhZyRnZXRBdHRyaWJ1dGUgOiAtMTApOwoKICAgICAgICAgICAgICB2YXIgYiA9CiAgICAgICAgICAgICAgdGFnLnF1ZXJ5U2VsZWN0b3IoIi5zZXR0aW5nVGFnU2luZ2xlIikuCiAgICAgICAgICAgICAgZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7CiAgICAgICAgICAgICAgdmFyIG9mZnNldCA9IGUuY2xpZW50WCAtIChiLmxlZnQgKyBiLndpZHRoIC8gMik7CgogICAgICAgICAgICAgIGlmIChvZmZzZXQgPj0gMCkgewogICAgICAgICAgICAgICAgdGFnSWQrKzsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIHNldEluc2VydEluZGV4QXQodGFnSWQpOwogICAgICAgICAgICB9OwoKICAgICAgICAgICAgdmFyIGRyYWdFbmQgPSBmdW5jdGlvbiBkcmFnRW5kKCkgewogICAgICAgICAgICAgIGlmIChkcmFnZ2VkSXRlbSA9PSAtMSkgewogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgaWYgKGluc2VydEluZGV4QXQgLSAxICE9IGRyYWdnZWRJdGVtICYmIGluc2VydEluZGV4QXQgIT0gZHJhZ2dlZEl0ZW0pIHsKICAgICAgICAgICAgICAgIHZhciBuZXdJbmRleCA9IGluc2VydEluZGV4QXQ7CiAgICAgICAgICAgICAgICB2YXIgbmV3VGFncyA9IF90b0NvbnN1bWFibGVBcnJheSh0YWdzKTsKICAgICAgICAgICAgICAgIG5ld1RhZ3Muc3BsaWNlKGRyYWdnZWRJdGVtLCAxKTsKICAgICAgICAgICAgICAgIG5ld1RhZ3Muc3BsaWNlKAogICAgICAgICAgICAgICAgbmV3SW5kZXggLSAoZHJhZ2dlZEl0ZW0gPCBuZXdJbmRleCA/IDEgOiAwKSwKICAgICAgICAgICAgICAgIDAsCiAgICAgICAgICAgICAgICB0YWdzW2RyYWdnZWRJdGVtXSk7CgoKICAgICAgICAgICAgICAgIHNldFRhZ3MobmV3VGFncyk7CiAgICAgICAgICAgICAgICBzZXRMYXN0SW5zZXJ0ZWQobmV3SW5kZXggLSAoZHJhZ2dlZEl0ZW0gPCBuZXdJbmRleCA/IDEgOiAwKSk7CiAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHNldExhc3RJbnNlcnRlZCgtMSk7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBzZXREcmFnZ2VkSXRlbSgtMSk7CiAgICAgICAgICAgICAgc2V0SW5zZXJ0SW5kZXhBdCgtMSk7CiAgICAgICAgICAgIH07CgogICAgICAgICAgICB2YXIgc3RyaW5nVG9Db2xvdXIgPSBmdW5jdGlvbiBzdHJpbmdUb0NvbG91cihzdHIpIHsKICAgICAgICAgICAgICB2YXIgaGFzaCA9IDA7CgogICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgc3RyLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAgICBoYXNoID0gc3RyLmNoYXJDb2RlQXQoaSkgKyAoKGhhc2ggPDwgNSkgLSBoYXNoKTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIHZhciBjb2xvdXIgPSAiIyI7CgogICAgICAgICAgICAgIGZvciAodmFyIF9pMiA9IDA7IF9pMiA8IDM7IF9pMisrKSB7CiAgICAgICAgICAgICAgICB2YXIgdmFsdWUgPSBoYXNoID4+IF9pMiAqIDggJiAweGZmOwogICAgICAgICAgICAgICAgY29sb3VyICs9ICgiMDAiICsgdmFsdWUudG9TdHJpbmcoMTYpKS5zdWJzdHIoLTIpOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgcmV0dXJuIGNvbG91cjsKICAgICAgICAgICAgfTsKCiAgICAgICAgICAgIHJldHVybiAvKiNfX1BVUkVfXyovKAogICAgICAgICAgICAgIHJlYWN0LmNyZWF0ZUVsZW1lbnQoImRpdiIsIHsgY2xhc3NOYW1lOiAic2V0dGluZ1RhZyIsIHJlZjogaW5wdXRSZWYgfSwKICAgICAgICAgICAgICB0YWdzLm1hcChmdW5jdGlvbiAodGFnLCBpbmRleCkge3JldHVybiAvKiNfX1BVUkVfXyovKAogICAgICAgICAgICAgICAgICByZWFjdC5jcmVhdGVFbGVtZW50KHJlYWN0LkZyYWdtZW50LCB7IGtleTogIiIuY29uY2F0KHRhZy5kaXNwbGF5LCAiICIpLmNvbmNhdCh0YWcudmFsdWUsICIgIikuY29uY2F0KGluZGV4KSB9LAogICAgICAgICAgICAgICAgICBkcmFnZ2VkSXRlbSA+PSAwICYmCiAgICAgICAgICAgICAgICAgIGluZGV4ID09IDAgJiYKICAgICAgICAgICAgICAgICAgaW5kZXggPT0gaW5zZXJ0SW5kZXhBdCAmJgogICAgICAgICAgICAgICAgICBpbnNlcnRJbmRleEF0ICE9IGRyYWdnZWRJdGVtICYmCiAgICAgICAgICAgICAgICAgIGRyYWdnZWRJdGVtICE9IGluc2VydEluZGV4QXQgLSAxID8gLyojX19QVVJFX18qLwogICAgICAgICAgICAgICAgICByZWFjdC5jcmVhdGVFbGVtZW50KCJkaXYiLCB7CiAgICAgICAgICAgICAgICAgICAgY2xhc3NOYW1lOiAiaGludFRhZ0Ryb3AiLAogICAgICAgICAgICAgICAgICAgIG9uRHJhZ092ZXI6IGZ1bmN0aW9uIG9uRHJhZ092ZXIoZSkgewogICAgICAgICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgc3R5bGU6IHsKICAgICAgICAgICAgICAgICAgICAgIHdpZHRoOiBkcmFnZ2VkV2lkdGggKyAicHgiLAogICAgICAgICAgICAgICAgICAgICAgaGVpZ2h0OiBkcmFnZ2VkSGVpZ2h0ICsgInB4IgogICAgICAgICAgICAgICAgICAgIH0gfSkgOiAvKiNfX1BVUkVfXyovCgoKICAgICAgICAgICAgICAgICAgcmVhY3QuY3JlYXRlRWxlbWVudChyZWFjdC5GcmFnbWVudCwgbnVsbCksCgogICAgICAgICAgICAgICAgICBkcmFnZ2VkSXRlbSA9PSBpbmRleCA/IC8qI19fUFVSRV9fKi8KICAgICAgICAgICAgICAgICAgcmVhY3QuY3JlYXRlRWxlbWVudCgiZGl2IiwgewogICAgICAgICAgICAgICAgICAgIGNsYXNzTmFtZTogImhpbnRUYWdEcm9wIGhpbnRUYWdEcm9wT3JpZ2luYWwiLAogICAgICAgICAgICAgICAgICAgIG9uRHJhZ092ZXI6IGZ1bmN0aW9uIG9uRHJhZ092ZXIoZSkgewogICAgICAgICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgc3R5bGU6IHsKICAgICAgICAgICAgICAgICAgICAgIHdpZHRoOiBkcmFnZ2VkV2lkdGggKyAicHgiLAogICAgICAgICAgICAgICAgICAgICAgaGVpZ2h0OiBkcmFnZ2VkSGVpZ2h0ICsgInB4IiwKICAgICAgICAgICAgICAgICAgICAgIGRpc3BsYXk6CiAgICAgICAgICAgICAgICAgICAgICBpbnNlcnRJbmRleEF0ID09IGluZGV4IHx8IGluc2VydEluZGV4QXQgLSAxID09IGluZGV4ID8KICAgICAgICAgICAgICAgICAgICAgICJpbmxpbmUiIDoKICAgICAgICAgICAgICAgICAgICAgICJub25lIgogICAgICAgICAgICAgICAgICAgIH0gfSkgOiAvKiNfX1BVUkVfXyovCgoKICAgICAgICAgICAgICAgICAgcmVhY3QuY3JlYXRlRWxlbWVudChyZWFjdC5GcmFnbWVudCwgbnVsbCksIC8qI19fUFVSRV9fKi8KCiAgICAgICAgICAgICAgICAgIHJlYWN0LmNyZWF0ZUVsZW1lbnQoImRpdiIsIHsKICAgICAgICAgICAgICAgICAgICBkcmFnZ2FibGU6IHRydWUsCiAgICAgICAgICAgICAgICAgICAgb25EcmFnU3RhcnQ6IGZ1bmN0aW9uIG9uRHJhZ1N0YXJ0KGUpIHsKICAgICAgICAgICAgICAgICAgICAgIHZhciBpbmQgPSBpbmRleDsKICAgICAgICAgICAgICAgICAgICAgIHZhciB3aWQgPSBlLmN1cnJlbnRUYXJnZXQuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCkud2lkdGggLSAxMDsKICAgICAgICAgICAgICAgICAgICAgIHZhciBoZWlnaHQgPSBlLmN1cnJlbnRUYXJnZXQuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCkuaGVpZ2h0IC0gMjsKCiAgICAgICAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICAgICAgc2V0SW5zZXJ0SW5kZXhBdChpbmQpOwogICAgICAgICAgICAgICAgICAgICAgICBzZXREcmFnZ2VkSXRlbShpbmQpOwogICAgICAgICAgICAgICAgICAgICAgICBzZXREcmFnZ2VkV2lkdGgod2lkKTsKICAgICAgICAgICAgICAgICAgICAgICAgc2V0RHJhZ2dlZEhlaWdodChoZWlnaHQpOwogICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBvbkRyYWdFbmQ6IGZ1bmN0aW9uIG9uRHJhZ0VuZCgpIHsKICAgICAgICAgICAgICAgICAgICAgIGRyYWdFbmQoKTsKICAgICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICAgIG9uRHJhZ092ZXI6IGZ1bmN0aW9uIG9uRHJhZ092ZXIoZSkgewogICAgICAgICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpOwoKICAgICAgICAgICAgICAgICAgICAgIHVwZGF0ZUluZGV4SW5zZXJ0KGUpOwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgImRhdGEta2V5IjogaW5kZXgsCiAgICAgICAgICAgICAgICAgICAgY2xhc3NOYW1lOiAidGFnQ29udGFpbmVyIiArIChkcmFnZ2VkSXRlbSA9PSBpbmRleCA/ICIgaGlkZGVuIiA6ICIiKSB9LCAvKiNfX1BVUkVfXyovCgogICAgICAgICAgICAgICAgICByZWFjdC5jcmVhdGVFbGVtZW50KCJkaXYiLCB7CiAgICAgICAgICAgICAgICAgICAgY2xhc3NOYW1lOgogICAgICAgICAgICAgICAgICAgICJzZXR0aW5nVGFnU2luZ2xlIiArICgKICAgICAgICAgICAgICAgICAgICBpbmRleCA9PSBkcmFnZ2VkSXRlbSA/ICIgZHJhZ2dlZEl0ZW0iIDogIiIpICsgKAogICAgICAgICAgICAgICAgICAgIGxhc3RJbnNlcnRlZCA9PSBpbmRleCA/ICIgcmVhcnJhbmdlZFRhZyIgOiAiIikgKyAoCiAgICAgICAgICAgICAgICAgICAgY2FudFJlbW92ZVRhZ3MgPyAiIiA6ICIgc2V0dGluZ1RhZ1NpbmdsZUNsb3NlVmlzaWJsZSIpLAoKICAgICAgICAgICAgICAgICAgICBzdHlsZTogewogICAgICAgICAgICAgICAgICAgICAgYmFja2dyb3VuZENvbG9yOiAiIi5jb25jYXQoc3RyaW5nVG9Db2xvdXIoIiIuY29uY2F0KAogICAgICAgICAgICAgICAgICAgICAgdGFnLmRpc3BsYXksICIgIikuY29uY2F0KHRhZy52YWx1ZSkpLCAiMjIiKQoKICAgICAgICAgICAgICAgICAgICB9IH0sIC8qI19fUFVSRV9fKi8KCiAgICAgICAgICAgICAgICAgIHJlYWN0LmNyZWF0ZUVsZW1lbnQoInNwYW4iLCBudWxsLCB0YWcuZGlzcGxheSksIC8qI19fUFVSRV9fKi8KICAgICAgICAgICAgICAgICAgcmVhY3QuY3JlYXRlRWxlbWVudCgiZGl2IiwgewogICAgICAgICAgICAgICAgICAgIGNsYXNzTmFtZToKICAgICAgICAgICAgICAgICAgICAic2V0dGluZ1RhZ0Nsb3NlIiArIChjYW50UmVtb3ZlVGFncyA/ICIgaGlkZGVuIiA6ICIiKSwKCiAgICAgICAgICAgICAgICAgICAgb25DbGljazogZnVuY3Rpb24gb25DbGljaygpIHtyZXR1cm4gcmVtb3ZlVGFncyhpbmRleCk7fSB9LCAvKiNfX1BVUkVfXyovCgogICAgICAgICAgICAgICAgICByZWFjdC5jcmVhdGVFbGVtZW50KENsb3NlSWNvbiwgbnVsbCkpKSksCgoKCiAgICAgICAgICAgICAgICAgIGRyYWdnZWRJdGVtID49IDAgJiYKICAgICAgICAgICAgICAgICAgaW5kZXggKyAxID09IGluc2VydEluZGV4QXQgJiYKICAgICAgICAgICAgICAgICAgZHJhZ2dlZEl0ZW0gKyAxICE9IGluc2VydEluZGV4QXQgJiYKICAgICAgICAgICAgICAgICAgZHJhZ2dlZEl0ZW0gIT0gaW5zZXJ0SW5kZXhBdCA/IC8qI19fUFVSRV9fKi8KICAgICAgICAgICAgICAgICAgcmVhY3QuY3JlYXRlRWxlbWVudCgiZGl2IiwgewogICAgICAgICAgICAgICAgICAgIGNsYXNzTmFtZTogInRhZ0NvbnRhaW5lciBoaW50VGFnRHJvcCIsCiAgICAgICAgICAgICAgICAgICAgb25EcmFnT3ZlcjogZnVuY3Rpb24gb25EcmFnT3ZlcihlKSB7CiAgICAgICAgICAgICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBzdHlsZTogewogICAgICAgICAgICAgICAgICAgICAgd2lkdGg6IGRyYWdnZWRXaWR0aCArICJweCIsCiAgICAgICAgICAgICAgICAgICAgICBoZWlnaHQ6IGRyYWdnZWRIZWlnaHQgKyAicHgiCiAgICAgICAgICAgICAgICAgICAgfSB9KSA6IC8qI19fUFVSRV9fKi8KCgogICAgICAgICAgICAgICAgICByZWFjdC5jcmVhdGVFbGVtZW50KHJlYWN0LkZyYWdtZW50LCBudWxsKSkpO30pLCAvKiNfX1BVUkVfXyovCgoKCiAgICAgICAgICAgICAgcmVhY3QuY3JlYXRlRWxlbWVudCgiZGl2IiwgewogICAgICAgICAgICAgICAgcmVmOiBzZWFyY2hDb250YWluZXJSZWYsCiAgICAgICAgICAgICAgICBjbGFzc05hbWU6CiAgICAgICAgICAgICAgICAidGFnQ29udGFpbmVyIHNldHRpbmdUYWdJbnB1dCIgKyAoCiAgICAgICAgICAgICAgICBidXR0b24ubWF4VGFncyAmJiB0YWdzLmxlbmd0aCA+PSBwYXJzZUludChidXR0b24ubWF4VGFncykgPwogICAgICAgICAgICAgICAgIiBoaWRkZW4iIDoKICAgICAgICAgICAgICAgICIiKSB9LCAvKiNfX1BVUkVfXyovCgoKICAgICAgICAgICAgICByZWFjdC5jcmVhdGVFbGVtZW50KCJkaXYiLCBudWxsLCAvKiNfX1BVUkVfXyovCiAgICAgICAgICAgICAgcmVhY3QuY3JlYXRlRWxlbWVudCgiaW5wdXQiLCB7CiAgICAgICAgICAgICAgICB0eXBlOiAidGV4dCIsCiAgICAgICAgICAgICAgICBvbkNoYW5nZTogb25TZWFyY2gsCiAgICAgICAgICAgICAgICBwbGFjZWhvbGRlcjogYnV0dG9uLnBsYWNlaG9sZGVyVGV4dCA/IGJ1dHRvbi5wbGFjZWhvbGRlclRleHQgOiAiIiwKICAgICAgICAgICAgICAgIHZhbHVlOiBzZWFyY2hWYWx1ZSwKICAgICAgICAgICAgICAgIHJlZjogc2VhcmNoUmVmLAogICAgICAgICAgICAgICAgb25Gb2N1czogZnVuY3Rpb24gb25Gb2N1cygpIHtyZXR1cm4gc2V0U2hvd01lbnUodHJ1ZSk7fSwKICAgICAgICAgICAgICAgIG9uS2V5RG93bjogZnVuY3Rpb24gb25LZXlEb3duKGV2ZW50KSB7cmV0dXJuIGhhbmRsZVRhZ3MoZXZlbnQpO30sCiAgICAgICAgICAgICAgICBzaXplOiAxMCB9KSksCgoKCiAgICAgICAgICAgICAgYnV0dG9uLmRyb3Bkb3duID09IG51bGwgPyAvKiNfX1BVUkVfXyovCiAgICAgICAgICAgICAgcmVhY3QuY3JlYXRlRWxlbWVudChyZWFjdC5GcmFnbWVudCwgbnVsbCkgOiAvKiNfX1BVUkVfXyovCgogICAgICAgICAgICAgIHJlYWN0LmNyZWF0ZUVsZW1lbnQocmVhY3QuRnJhZ21lbnQsIG51bGwsCiAgICAgICAgICAgICAgc2hvd01lbnUgJiYgZ2V0T3B0aW9ucygpLmxlbmd0aCA+IDAgJiYgLyojX19QVVJFX18qLwogICAgICAgICAgICAgIHJlYWN0LmNyZWF0ZUVsZW1lbnQoImRpdiIsIHsgY2xhc3NOYW1lOiAiZHJvcGRvd25NZW51IiB9LAogICAgICAgICAgICAgIGdldE9wdGlvbnMoKS5tYXAoZnVuY3Rpb24gKG9wdGlvbiwgaW5kZXgpIHtyZXR1cm4gLyojX19QVVJFX18qLygKICAgICAgICAgICAgICAgICAgcmVhY3QuY3JlYXRlRWxlbWVudCgiZGl2IiwgewogICAgICAgICAgICAgICAgICAgIGtleTogaW5kZXgsCiAgICAgICAgICAgICAgICAgICAgb25DbGljazogZnVuY3Rpb24gb25DbGljaygpIHtyZXR1cm4gb25BZGRUYWcob3B0aW9uKTt9LAogICAgICAgICAgICAgICAgICAgIGNsYXNzTmFtZTogImRyb3Bkb3duSXRlbSIgfSwKCiAgICAgICAgICAgICAgICAgIG9wdGlvbi5kaXNwbGF5KSk7fSkpKSkpKTsKCgoKCgoKCgoKICAgICAgICAgIH07CgogICAgICAgICAgLyogaGFybW9ueSBkZWZhdWx0IGV4cG9ydCAqL3ZhciBzZXR0aW5nc19UYWdzSW5wdXQgPSBUYWdzSW5wdXQ7CiAgICAgICAgICA7IC8vIENPTkNBVEVOQVRFRCBNT0RVTEU6IC4vc3JjL3JlbGF5L2NvbXBvbmVudHMvc2V0dGluZ3MvU2V0dGluZy50c3gKICAgICAgICAgIGZ1bmN0aW9uIFNldHRpbmdfc2xpY2VkVG9BcnJheShhcnIsIGkpIHtyZXR1cm4gU2V0dGluZ19hcnJheVdpdGhIb2xlcyhhcnIpIHx8IFNldHRpbmdfaXRlcmFibGVUb0FycmF5TGltaXQoYXJyLCBpKSB8fCBTZXR0aW5nX3Vuc3VwcG9ydGVkSXRlcmFibGVUb0FycmF5KGFyciwgaSkgfHwgU2V0dGluZ19ub25JdGVyYWJsZVJlc3QoKTt9ZnVuY3Rpb24gU2V0dGluZ19ub25JdGVyYWJsZVJlc3QoKSB7dGhyb3cgbmV3IFR5cGVFcnJvcigiSW52YWxpZCBhdHRlbXB0IHRvIGRlc3RydWN0dXJlIG5vbi1pdGVyYWJsZSBpbnN0YW5jZS5cbkluIG9yZGVyIHRvIGJlIGl0ZXJhYmxlLCBub24tYXJyYXkgb2JqZWN0cyBtdXN0IGhhdmUgYSBbU3ltYm9sLml0ZXJhdG9yXSgpIG1ldGhvZC4iKTt9ZnVuY3Rpb24gU2V0dGluZ191bnN1cHBvcnRlZEl0ZXJhYmxlVG9BcnJheShvLCBtaW5MZW4pIHtpZiAoIW8pIHJldHVybjtpZiAodHlwZW9mIG8gPT09ICJzdHJpbmciKSByZXR1cm4gU2V0dGluZ19hcnJheUxpa2VUb0FycmF5KG8sIG1pbkxlbik7dmFyIG4gPSBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwobykuc2xpY2UoOCwgLTEpO2lmIChuID09PSAiT2JqZWN0IiAmJiBvLmNvbnN0cnVjdG9yKSBuID0gby5jb25zdHJ1Y3Rvci5uYW1lO2lmIChuID09PSAiTWFwIiB8fCBuID09PSAiU2V0IikgcmV0dXJuIEFycmF5LmZyb20obyk7aWYgKG4gPT09ICJBcmd1bWVudHMiIHx8IC9eKD86VWl8SSludCg/Ojh8MTZ8MzIpKD86Q2xhbXBlZCk/QXJyYXkkLy50ZXN0KG4pKSByZXR1cm4gU2V0dGluZ19hcnJheUxpa2VUb0FycmF5KG8sIG1pbkxlbik7fWZ1bmN0aW9uIFNldHRpbmdfYXJyYXlMaWtlVG9BcnJheShhcnIsIGxlbikge2lmIChsZW4gPT0gbnVsbCB8fCBsZW4gPiBhcnIubGVuZ3RoKSBsZW4gPSBhcnIubGVuZ3RoO2ZvciAodmFyIGkgPSAwLCBhcnIyID0gbmV3IEFycmF5KGxlbik7IGkgPCBsZW47IGkrKykgYXJyMltpXSA9IGFycltpXTtyZXR1cm4gYXJyMjt9ZnVuY3Rpb24gU2V0dGluZ19pdGVyYWJsZVRvQXJyYXlMaW1pdChhcnIsIGkpIHt2YXIgX2kgPSBudWxsID09IGFyciA/IG51bGwgOiAidW5kZWZpbmVkIiAhPSB0eXBlb2YgU3ltYm9sICYmIGFycltTeW1ib2wuaXRlcmF0b3JdIHx8IGFyclsiQEBpdGVyYXRvciJdO2lmIChudWxsICE9IF9pKSB7dmFyIF9zLF9lLF94LF9yLF9hcnIgPSBbXSxfbiA9ICEwLF9kID0gITE7dHJ5IHtpZiAoX3ggPSAoX2kgPSBfaS5jYWxsKGFycikpLm5leHQsIDAgPT09IGkpIHtpZiAoT2JqZWN0KF9pKSAhPT0gX2kpIHJldHVybjtfbiA9ICExO30gZWxzZSBmb3IgKDsgIShfbiA9IChfcyA9IF94LmNhbGwoX2kpKS5kb25lKSAmJiAoX2Fyci5wdXNoKF9zLnZhbHVlKSwgX2Fyci5sZW5ndGggIT09IGkpOyBfbiA9ICEwKTt9IGNhdGNoIChlcnIpIHtfZCA9ICEwLCBfZSA9IGVycjt9IGZpbmFsbHkge3RyeSB7aWYgKCFfbiAmJiBudWxsICE9IF9pWyJyZXR1cm4iXSAmJiAoX3IgPSBfaVsicmV0dXJuIl0oKSwgT2JqZWN0KF9yKSAhPT0gX3IpKSByZXR1cm47fSBmaW5hbGx5IHtpZiAoX2QpIHRocm93IF9lO319cmV0dXJuIF9hcnI7fX1mdW5jdGlvbiBTZXR0aW5nX2FycmF5V2l0aEhvbGVzKGFycikge2lmIChBcnJheS5pc0FycmF5KGFycikpIHJldHVybiBhcnI7fQoKCgoKCgoKICAgICAgICAgIGZ1bmN0aW9uIFNldHRpbmcoX3JlZikKCgoKCgogICAgICAgICAge3ZhciBidXR0b24gPSBfcmVmLmJ1dHRvbix2YWxpZGF0b3IgPSBfcmVmLnZhbGlkYXRvcjsKICAgICAgICAgICAgdmFyIF91c2VTdGF0ZSA9ICgwLCByZWFjdC51c2VTdGF0ZSkodmFsaWRhdG9yLmlzVmFsaWQoYnV0dG9uKSksX3VzZVN0YXRlMiA9IFNldHRpbmdfc2xpY2VkVG9BcnJheShfdXNlU3RhdGUsIDIpLHZhbGlkID0gX3VzZVN0YXRlMlswXSxzZXRWYWxpZCA9IF91c2VTdGF0ZTJbMV07CgogICAgICAgICAgICBidXR0b24uc2V0VmFsdWUgPSBmdW5jdGlvbiAodmFsKSB7CiAgICAgICAgICAgICAgYnV0dG9uLnZhbHVlID0gdmFsOwogICAgICAgICAgICAgIHZhbGlkYXRvci51cGRhdGVTZXR0aW5nKGJ1dHRvbik7CiAgICAgICAgICAgIH07CgogICAgICAgICAgICB2YWxpZGF0b3IuYWRkU2V0dGluZyhidXR0b24sIHNldFZhbGlkKTsKCiAgICAgICAgICAgIHJldHVybiAvKiNfX1BVUkVfXyovKAogICAgICAgICAgICAgIHJlYWN0LmNyZWF0ZUVsZW1lbnQoInRyIiwgeyBjbGFzc05hbWU6ICJ1c2VyUHJlZmVyZW5jZSIsICJkYXRhLW5hbWUiOiBidXR0b24ubmFtZSB9LCAvKiNfX1BVUkVfXyovCiAgICAgICAgICAgICAgcmVhY3QuY3JlYXRlRWxlbWVudCgidGQiLCB7IGNsYXNzTmFtZTogInNldHRpbmciIH0sCiAgICAgICAgICAgICAgYnV0dG9uLm5hbWUsIC8qI19fUFVSRV9fKi8KICAgICAgICAgICAgICByZWFjdC5jcmVhdGVFbGVtZW50KCJkaXYiLCB7IGNsYXNzTmFtZTogInNldHRpbmdOYW1lSG92ZXIiIH0sIGJ1dHRvbi5wcmVmZXJlbmNlKSksIC8qI19fUFVSRV9fKi8KCiAgICAgICAgICAgICAgcmVhY3QuY3JlYXRlRWxlbWVudCgidGQiLCB7IGNsYXNzTmFtZTogdmFsaWQgPyAic2V0dGluZ0lucHV0IiA6ICJzZXR0aW5nSW5wdXQgaW52YWxpZC1zZXR0aW5nIiB9LAogICAgICAgICAgICAgIGJ1dHRvbi50eXBlID09PSBSZWxheUNvbXBvbmVudFR5cGUuQk9PTEVBTiA/IC8qI19fUFVSRV9fKi8KICAgICAgICAgICAgICByZWFjdC5jcmVhdGVFbGVtZW50KHNldHRpbmdzX0Jvb2xlYW5JbnB1dCwgeyBidXR0b246IGJ1dHRvbiB9KSA6CiAgICAgICAgICAgICAgYnV0dG9uLnR5cGUgPT09IFJlbGF5Q29tcG9uZW50VHlwZS5EUk9QRE9XTiA/IC8qI19fUFVSRV9fKi8KICAgICAgICAgICAgICByZWFjdC5jcmVhdGVFbGVtZW50KHNldHRpbmdzX0Ryb3Bkb3duSW5wdXQsIHsgYnV0dG9uOiBidXR0b24gfSkgOgogICAgICAgICAgICAgIGJ1dHRvbi50eXBlID09IFJlbGF5Q29tcG9uZW50VHlwZS5UQUdTID8gLyojX19QVVJFX18qLwogICAgICAgICAgICAgIHJlYWN0LmNyZWF0ZUVsZW1lbnQoc2V0dGluZ3NfVGFnc0lucHV0LCB7IGJ1dHRvbjogYnV0dG9uIH0pIDogLyojX19QVVJFX18qLwoKICAgICAgICAgICAgICByZWFjdC5jcmVhdGVFbGVtZW50KHNldHRpbmdzX1N0cmluZ0lucHV0LCB7IGJ1dHRvbjogYnV0dG9uIH0pLAoKICAgICAgICAgICAgICBidXR0b24uaW52YWxpZFJlYXNvbiAhPSBudWxsID8gLyojX19QVVJFX18qLwogICAgICAgICAgICAgIHJlYWN0LmNyZWF0ZUVsZW1lbnQoImRpdiIsIHsgY2xhc3NOYW1lOiAiaW52YWxpZC1yZWFzb24iLCBoaWRkZW46IHZhbGlkIH0sIC8qI19fUFVSRV9fKi8KICAgICAgICAgICAgICByZWFjdC5jcmVhdGVFbGVtZW50KCJzbWFsbCIsIG51bGwsIGJ1dHRvbi5pbnZhbGlkUmVhc29uKSkgOiAvKiNfX1BVUkVfXyovCgoKICAgICAgICAgICAgICByZWFjdC5jcmVhdGVFbGVtZW50KHJlYWN0LkZyYWdtZW50LCBudWxsKSwgLyojX19QVVJFX18qLwoKCiAgICAgICAgICAgICAgcmVhY3QuY3JlYXRlRWxlbWVudCgiZGl2IiwgeyBjbGFzc05hbWU6ICJob3ZlckJveCIgfSwgLyojX19QVVJFX18qLwogICAgICAgICAgICAgIHJlYWN0LmNyZWF0ZUVsZW1lbnQoInNtYWxsIiwgeyBjbGFzc05hbWU6ICJzZXR0aW5nRGVmYXVsdEhvdmVyIiB9LAogICAgICAgICAgICAgIGJ1dHRvblsiZGVmYXVsdCJdICE9IG51bGwgPwogICAgICAgICAgICAgICJEZWZhdWx0OiAiICsgKAogICAgICAgICAgICAgIGJ1dHRvblsiZGVmYXVsdCJdID09ICIiID8gIjxFbXB0eT4iIDogYnV0dG9uWyJkZWZhdWx0Il0pIDoKICAgICAgICAgICAgICAiRGVmYXVsdCBub3Qgc2V0IikpKSwgLyojX19QVVJFX18qLwoKCgogICAgICAgICAgICAgIHJlYWN0LmNyZWF0ZUVsZW1lbnQoInRkIiwgbnVsbCwgYnV0dG9uLmRlc2NyaXB0aW9uKSkpOwoKCiAgICAgICAgICB9CgogICAgICAgICAgLyogaGFybW9ueSBkZWZhdWx0IGV4cG9ydCAqL3ZhciBzZXR0aW5nc19TZXR0aW5nID0gU2V0dGluZzsKICAgICAgICAgIDsgLy8gQ09OQ0FURU5BVEVEIE1PRFVMRTogLi9zcmMvcmVsYXkvcm91dGVzL1JlbGF5UGFnZS50c3gKICAgICAgICAgIGZ1bmN0aW9uIFJlbGF5UGFnZV9jcmVhdGVGb3JPZkl0ZXJhdG9ySGVscGVyKG8sIGFsbG93QXJyYXlMaWtlKSB7dmFyIGl0ID0gdHlwZW9mIFN5bWJvbCAhPT0gInVuZGVmaW5lZCIgJiYgb1tTeW1ib2wuaXRlcmF0b3JdIHx8IG9bIkBAaXRlcmF0b3IiXTtpZiAoIWl0KSB7aWYgKEFycmF5LmlzQXJyYXkobykgfHwgKGl0ID0gUmVsYXlQYWdlX3Vuc3VwcG9ydGVkSXRlcmFibGVUb0FycmF5KG8pKSB8fCBhbGxvd0FycmF5TGlrZSAmJiBvICYmIHR5cGVvZiBvLmxlbmd0aCA9PT0gIm51bWJlciIpIHtpZiAoaXQpIG8gPSBpdDt2YXIgaSA9IDA7dmFyIEYgPSBmdW5jdGlvbiBGKCkge307cmV0dXJuIHsgczogRiwgbjogZnVuY3Rpb24gbigpIHtpZiAoaSA+PSBvLmxlbmd0aCkgcmV0dXJuIHsgZG9uZTogdHJ1ZSB9O3JldHVybiB7IGRvbmU6IGZhbHNlLCB2YWx1ZTogb1tpKytdIH07fSwgZTogZnVuY3Rpb24gZShfZSkge3Rocm93IF9lO30sIGY6IEYgfTt9dGhyb3cgbmV3IFR5cGVFcnJvcigiSW52YWxpZCBhdHRlbXB0IHRvIGl0ZXJhdGUgbm9uLWl0ZXJhYmxlIGluc3RhbmNlLlxuSW4gb3JkZXIgdG8gYmUgaXRlcmFibGUsIG5vbi1hcnJheSBvYmplY3RzIG11c3QgaGF2ZSBhIFtTeW1ib2wuaXRlcmF0b3JdKCkgbWV0aG9kLiIpO312YXIgbm9ybWFsQ29tcGxldGlvbiA9IHRydWUsZGlkRXJyID0gZmFsc2UsZXJyO3JldHVybiB7IHM6IGZ1bmN0aW9uIHMoKSB7aXQgPSBpdC5jYWxsKG8pO30sIG46IGZ1bmN0aW9uIG4oKSB7dmFyIHN0ZXAgPSBpdC5uZXh0KCk7bm9ybWFsQ29tcGxldGlvbiA9IHN0ZXAuZG9uZTtyZXR1cm4gc3RlcDt9LCBlOiBmdW5jdGlvbiBlKF9lMikge2RpZEVyciA9IHRydWU7ZXJyID0gX2UyO30sIGY6IGZ1bmN0aW9uIGYoKSB7dHJ5IHtpZiAoIW5vcm1hbENvbXBsZXRpb24gJiYgaXRbInJldHVybiJdICE9IG51bGwpIGl0WyJyZXR1cm4iXSgpO30gZmluYWxseSB7aWYgKGRpZEVycikgdGhyb3cgZXJyO319IH07fWZ1bmN0aW9uIFJlbGF5UGFnZV91bnN1cHBvcnRlZEl0ZXJhYmxlVG9BcnJheShvLCBtaW5MZW4pIHtpZiAoIW8pIHJldHVybjtpZiAodHlwZW9mIG8gPT09ICJzdHJpbmciKSByZXR1cm4gUmVsYXlQYWdlX2FycmF5TGlrZVRvQXJyYXkobywgbWluTGVuKTt2YXIgbiA9IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChvKS5zbGljZSg4LCAtMSk7aWYgKG4gPT09ICJPYmplY3QiICYmIG8uY29uc3RydWN0b3IpIG4gPSBvLmNvbnN0cnVjdG9yLm5hbWU7aWYgKG4gPT09ICJNYXAiIHx8IG4gPT09ICJTZXQiKSByZXR1cm4gQXJyYXkuZnJvbShvKTtpZiAobiA9PT0gIkFyZ3VtZW50cyIgfHwgL14oPzpVaXxJKW50KD86OHwxNnwzMikoPzpDbGFtcGVkKT9BcnJheSQvLnRlc3QobikpIHJldHVybiBSZWxheVBhZ2VfYXJyYXlMaWtlVG9BcnJheShvLCBtaW5MZW4pO31mdW5jdGlvbiBSZWxheVBhZ2VfYXJyYXlMaWtlVG9BcnJheShhcnIsIGxlbikge2lmIChsZW4gPT0gbnVsbCB8fCBsZW4gPiBhcnIubGVuZ3RoKSBsZW4gPSBhcnIubGVuZ3RoO2ZvciAodmFyIGkgPSAwLCBhcnIyID0gbmV3IEFycmF5KGxlbik7IGkgPCBsZW47IGkrKykgYXJyMltpXSA9IGFycltpXTtyZXR1cm4gYXJyMjt9CgoKCgoKCiAgICAgICAgICBmdW5jdGlvbiBSZWxheVBhZ2UoX3JlZikKCgoKICAgICAgICAgIHt2YXIgY29tcG9uZW50cyA9IF9yZWYuY29tcG9uZW50czsKICAgICAgICAgICAgdmFyIGdyb3VwcyA9IFtdOwogICAgICAgICAgICB2YXIgY3VycmVudEdyb3VwID0gbnVsbDt2YXIgX2l0ZXJhdG9yID0gUmVsYXlQYWdlX2NyZWF0ZUZvck9mSXRlcmF0b3JIZWxwZXIoCgogICAgICAgICAgICAgIGNvbXBvbmVudHMpLF9zdGVwO3RyeSB7Zm9yIChfaXRlcmF0b3IucygpOyAhKF9zdGVwID0gX2l0ZXJhdG9yLm4oKSkuZG9uZTspIHt2YXIgY29tcG9uZW50ID0gX3N0ZXAudmFsdWU7CiAgICAgICAgICAgICAgICBpZiAoCiAgICAgICAgICAgICAgICBjb21wb25lbnQudHlwZSA9PSBSZWxheUNvbXBvbmVudFR5cGUuSFRNTCB8fAogICAgICAgICAgICAgICAgY29tcG9uZW50LnR5cGUgPT0gUmVsYXlDb21wb25lbnRUeXBlLklOVEVSUlVQVCkKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgZ3JvdXBzLnB1c2goY29tcG9uZW50KTsKICAgICAgICAgICAgICAgICAgY3VycmVudEdyb3VwID0gbnVsbDsKICAgICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgaWYgKGN1cnJlbnRHcm91cCA9PSBudWxsKSB7CiAgICAgICAgICAgICAgICAgIGN1cnJlbnRHcm91cCA9IFtdOwogICAgICAgICAgICAgICAgICBncm91cHMucHVzaChjdXJyZW50R3JvdXApOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGN1cnJlbnRHcm91cC5wdXNoKGNvbXBvbmVudCk7CiAgICAgICAgICAgICAgfX0gY2F0Y2ggKGVycikge19pdGVyYXRvci5lKGVycik7fSBmaW5hbGx5IHtfaXRlcmF0b3IuZigpO30KCiAgICAgICAgICAgIHZhciBlbGVtZW50cyA9IFtdOwogICAgICAgICAgICB2YXIgdmFsaWRhdG9yID0gbmV3IGFwaV9TZXR0aW5nVmFsaWRhdG9yKCk7CgogICAgICAgICAgICBncm91cHMuZm9yRWFjaChmdW5jdGlvbiAoY29tcG9uZW50cywgaW5kZXgpIHsKICAgICAgICAgICAgICBpZiAoY29tcG9uZW50cy50eXBlID09IFJlbGF5Q29tcG9uZW50VHlwZS5IVE1MKSB7CiAgICAgICAgICAgICAgICB2YXIgaHRtbCA9IGNvbXBvbmVudHM7CgogICAgICAgICAgICAgICAgaWYgKGh0bWwuZGF0YSA9PSBudWxsKSB7CiAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBlbGVtZW50cy5wdXNoKCAvKiNfX1BVUkVfXyovCiAgICAgICAgICAgICAgICByZWFjdC5jcmVhdGVFbGVtZW50KCJkaXYiLCB7CiAgICAgICAgICAgICAgICAgIGtleTogIkhUTUwgIi5jb25jYXQoaW5kZXgpLAogICAgICAgICAgICAgICAgICBkYW5nZXJvdXNseVNldElubmVySFRNTDogewogICAgICAgICAgICAgICAgICAgIF9faHRtbDogY29tcG9uZW50cy5kYXRhCiAgICAgICAgICAgICAgICAgIH0gfSkpOwoKCiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBpZiAoY29tcG9uZW50cy50eXBlID09IFJlbGF5Q29tcG9uZW50VHlwZS5JTlRFUlJVUFQpIHsKICAgICAgICAgICAgICAgIGVsZW1lbnRzLnB1c2goIC8qI19fUFVSRV9fKi8KICAgICAgICAgICAgICAgIHJlYWN0LmNyZWF0ZUVsZW1lbnQoY29tcG9uZW50c19JbnRlcnJ1cHQsIHsKICAgICAgICAgICAgICAgICAga2V5OiAiSW50ZXJydXB0ICIuY29uY2F0KGluZGV4KSwKICAgICAgICAgICAgICAgICAgYnV0dG9uOiBjb21wb25lbnRzIH0pKTsKCgogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgdmFyIGJ1dHRvbnMgPSBjb21wb25lbnRzOwoKICAgICAgICAgICAgICBlbGVtZW50cy5wdXNoKCAvKiNfX1BVUkVfXyovCiAgICAgICAgICAgICAgcmVhY3QuY3JlYXRlRWxlbWVudCgidGFibGUiLCB7IGtleTogIlRhYmxlICIuY29uY2F0KGluZGV4KSwgY2xhc3NOYW1lOiAicmVsYXlUYWJsZSIgfSwgLyojX19QVVJFX18qLwogICAgICAgICAgICAgIHJlYWN0LmNyZWF0ZUVsZW1lbnQoInRib2R5IiwgbnVsbCwKICAgICAgICAgICAgICBidXR0b25zLm1hcChmdW5jdGlvbiAoc2V0dGluZywgaW5kZXgpIHtyZXR1cm4gLyojX19QVVJFX18qLygKICAgICAgICAgICAgICAgICAgcmVhY3QuY3JlYXRlRWxlbWVudChzZXR0aW5nc19TZXR0aW5nLCB7CiAgICAgICAgICAgICAgICAgICAga2V5OiAiU2V0dGluZyAiLmNvbmNhdChzZXR0aW5nLm5hbWUsICIgIikuY29uY2F0KHNldHRpbmcucHJlZmVyZW5jZSwgIiAiKS5jb25jYXQoaW5kZXgpLAogICAgICAgICAgICAgICAgICAgIGJ1dHRvbjogc2V0dGluZywKICAgICAgICAgICAgICAgICAgICB2YWxpZGF0b3I6IHZhbGlkYXRvciB9KSk7fSkpKSk7CgoKCgoKICAgICAgICAgICAgfSk7CgogICAgICAgICAgICB2YWxpZGF0b3IudXBkYXRlT2JqZWN0KCk7CgogICAgICAgICAgICAvLyBJZiB3ZSBoYXZlIG5vIHNldHRpbmdzIGluIHdoaWNoIHdlJ2Qgc2F2ZSBzdHVmZiwgZG9uJ3QgYm90aGVyIHJlbmRlcmluZyBzYXZlIGJ1dHRvbgogICAgICAgICAgICBpZiAoCiAgICAgICAgICAgIGNvbXBvbmVudHMuZmluZChmdW5jdGlvbiAoYykge3JldHVybiBjLnByZWZlcmVuY2UgIT0gbnVsbDt9KSA9PSBudWxsKQogICAgICAgICAgICB7CiAgICAgICAgICAgICAgcmV0dXJuIC8qI19fUFVSRV9fKi9yZWFjdC5jcmVhdGVFbGVtZW50KHJlYWN0LkZyYWdtZW50LCBudWxsLCBlbGVtZW50cyk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybiAvKiNfX1BVUkVfXyovKAogICAgICAgICAgICAgIHJlYWN0LmNyZWF0ZUVsZW1lbnQocmVhY3QuRnJhZ21lbnQsIG51bGwsCiAgICAgICAgICAgICAgIiAiLAogICAgICAgICAgICAgIGVsZW1lbnRzLCAiICIsIC8qI19fUFVSRV9fKi9yZWFjdC5jcmVhdGVFbGVtZW50KCJiciIsIG51bGwpLCAvKiNfX1BVUkVfXyovCiAgICAgICAgICAgICAgcmVhY3QuY3JlYXRlRWxlbWVudCgiaW5wdXQiLCB7CiAgICAgICAgICAgICAgICBjbGFzc05hbWU6ICJzYXZlIiwKICAgICAgICAgICAgICAgIG9uQ2xpY2s6IGZ1bmN0aW9uIG9uQ2xpY2soKSB7cmV0dXJuICgKICAgICAgICAgICAgICAgICAgICBzYXZlU2V0dGluZ3MoCiAgICAgICAgICAgICAgICAgICAgY29tcG9uZW50cy5maWx0ZXIoCiAgICAgICAgICAgICAgICAgICAgZnVuY3Rpb24gKGIpIHtyZXR1cm4gYi5wcmVmZXJlbmNlICE9IG51bGw7fSkpLgoKICAgICAgICAgICAgICAgICAgICB0aGVuKGZ1bmN0aW9uIChub3RpZnMpIHt2YXIgX2l0ZXJhdG9yMiA9IFJlbGF5UGFnZV9jcmVhdGVGb3JPZkl0ZXJhdG9ySGVscGVyKAogICAgICAgICAgICAgICAgICAgICAgICBub3RpZnMpLF9zdGVwMjt0cnkge2ZvciAoX2l0ZXJhdG9yMi5zKCk7ICEoX3N0ZXAyID0gX2l0ZXJhdG9yMi5uKCkpLmRvbmU7KSB7dmFyIG5vdGlmID0gX3N0ZXAyLnZhbHVlOwogICAgICAgICAgICAgICAgICAgICAgICAgIGFkZE5vdGlmaWNhdGlvbihub3RpZik7CiAgICAgICAgICAgICAgICAgICAgICAgIH19IGNhdGNoIChlcnIpIHtfaXRlcmF0b3IyLmUoZXJyKTt9IGZpbmFsbHkge19pdGVyYXRvcjIuZigpO30KICAgICAgICAgICAgICAgICAgICB9KSk7fSwKCiAgICAgICAgICAgICAgICB0eXBlOiAic3VibWl0IiwKICAgICAgICAgICAgICAgIHZhbHVlOiAiU2F2ZSBDaGFuZ2VzIiB9KSkpOwoKCgogICAgICAgICAgfQoKICAgICAgICAgIC8qIGhhcm1vbnkgZGVmYXVsdCBleHBvcnQgKi92YXIgcm91dGVzX1JlbGF5UGFnZSA9IFJlbGF5UGFnZTsKICAgICAgICAgIDsgLy8gQ09OQ0FURU5BVEVEIE1PRFVMRTogLi9zcmMvcmVsYXkvQXBwLnRzeAoKCgoKCgogICAgICAgICAgZnVuY3Rpb24gQXBwKF9yZWYpIHt2YXIgcGFnZXMgPSBfcmVmLnBhZ2VzOwogICAgICAgICAgICByZXR1cm4gLyojX19QVVJFX18qLygKICAgICAgICAgICAgICByZWFjdC5jcmVhdGVFbGVtZW50KE1lbW9yeVJvdXRlciwgbnVsbCwKICAgICAgICAgICAgICAiICIsIC8qI19fUFVSRV9fKi8KICAgICAgICAgICAgICByZWFjdC5jcmVhdGVFbGVtZW50KFJvdXRlcywgbnVsbCwKICAgICAgICAgICAgICAiICIsIC8qI19fUFVSRV9fKi8KICAgICAgICAgICAgICByZWFjdC5jcmVhdGVFbGVtZW50KFJvdXRlLCB7IGVsZW1lbnQ6IC8qI19fUFVSRV9fKi9yZWFjdC5jcmVhdGVFbGVtZW50KGNvbXBvbmVudHNfTGF5b3V0LCB7IHBhZ2VzOiBwYWdlcyB9KSB9LAogICAgICAgICAgICAgICIgIiwgLyojX19QVVJFX18qLwogICAgICAgICAgICAgIHJlYWN0LmNyZWF0ZUVsZW1lbnQoUm91dGUsIHsKICAgICAgICAgICAgICAgIHBhdGg6ICIvIiwKICAgICAgICAgICAgICAgIGVsZW1lbnQ6IC8qI19fUFVSRV9fKi9yZWFjdC5jcmVhdGVFbGVtZW50KE5hdmlnYXRlLCB7IHRvOiAiLyIgKyBwYWdlc1swXS5maWxlLCByZXBsYWNlOiB0cnVlIH0pIH0pLAogICAgICAgICAgICAgICIgIiwKICAgICAgICAgICAgICBwYWdlcy5tYXAoZnVuY3Rpb24gKHApIHsKICAgICAgICAgICAgICAgIHJldHVybiAvKiNfX1BVUkVfXyovKAogICAgICAgICAgICAgICAgICByZWFjdC5jcmVhdGVFbGVtZW50KFJvdXRlLCB7CiAgICAgICAgICAgICAgICAgICAga2V5OiAiIi5jb25jYXQocC5maWxlLCAiICIpLmNvbmNhdChwLnBhZ2UpLAogICAgICAgICAgICAgICAgICAgIHBhdGg6ICIvIiArIHAuZmlsZSwKICAgICAgICAgICAgICAgICAgICBlbGVtZW50OiAvKiNfX1BVUkVfXyovcmVhY3QuY3JlYXRlRWxlbWVudChyb3V0ZXNfUmVsYXlQYWdlLCB7IGNvbXBvbmVudHM6IHAuY29tcG9uZW50cyB9KSB9KSk7CgoKICAgICAgICAgICAgICB9KSwgIiAiKSwKICAgICAgICAgICAgICAiICIpLAogICAgICAgICAgICAgICIgIikpOwoKCiAgICAgICAgICB9CgogICAgICAgICAgLyogaGFybW9ueSBkZWZhdWx0IGV4cG9ydCAqL3ZhciByZWxheV9BcHAgPSBBcHA7CgogICAgICAgICAgLyoqKi99LAoKICAgICAgICAvKioqLzQ0ODoKICAgICAgICAvKioqLyhfX3VudXNlZF93ZWJwYWNrX21vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgPT4gewoKICAgICAgICAgIC8qKgogICAgICAgICAgICogQGxpY2Vuc2UgUmVhY3QKICAgICAgICAgICAqIHJlYWN0LWRvbS5wcm9kdWN0aW9uLm1pbi5qcwogICAgICAgICAgICoKICAgICAgICAgICAqIENvcHlyaWdodCAoYykgRmFjZWJvb2ssIEluYy4gYW5kIGl0cyBhZmZpbGlhdGVzLgogICAgICAgICAgICoKICAgICAgICAgICAqIFRoaXMgc291cmNlIGNvZGUgaXMgbGljZW5zZWQgdW5kZXIgdGhlIE1JVCBsaWNlbnNlIGZvdW5kIGluIHRoZQogICAgICAgICAgICogTElDRU5TRSBmaWxlIGluIHRoZSByb290IGRpcmVjdG9yeSBvZiB0aGlzIHNvdXJjZSB0cmVlLgogICAgICAgICAgICovCiAgICAgICAgICAvKgogICAgICAgICAgIE1vZGVybml6ciAzLjAuMHByZSAoQ3VzdG9tIEJ1aWxkKSB8IE1JVAogICAgICAgICAgKi8KICAgICAgICAgIHZhciBhYSA9IF9fd2VicGFja19yZXF1aXJlX18oMjk0KSxjYSA9IF9fd2VicGFja19yZXF1aXJlX18oODQwKTtmdW5jdGlvbiBwKGEpIHtmb3IgKHZhciBiID0gImh0dHBzOi8vcmVhY3Rqcy5vcmcvZG9jcy9lcnJvci1kZWNvZGVyLmh0bWw/aW52YXJpYW50PSIgKyBhLCBjID0gMTsgYyA8IGFyZ3VtZW50cy5sZW5ndGg7IGMrKykgYiArPSAiJmFyZ3NbXT0iICsgZW5jb2RlVVJJQ29tcG9uZW50KGFyZ3VtZW50c1tjXSk7cmV0dXJuICJNaW5pZmllZCBSZWFjdCBlcnJvciAjIiArIGEgKyAiOyB2aXNpdCAiICsgYiArICIgZm9yIHRoZSBmdWxsIG1lc3NhZ2Ugb3IgdXNlIHRoZSBub24tbWluaWZpZWQgZGV2IGVudmlyb25tZW50IGZvciBmdWxsIGVycm9ycyBhbmQgYWRkaXRpb25hbCBoZWxwZnVsIHdhcm5pbmdzLiI7fXZhciBkYSA9IG5ldyBTZXQoKSxlYSA9IHt9O2Z1bmN0aW9uIGZhKGEsIGIpIHtoYShhLCBiKTtoYShhICsgIkNhcHR1cmUiLCBiKTt9CiAgICAgICAgICBmdW5jdGlvbiBoYShhLCBiKSB7ZWFbYV0gPSBiO2ZvciAoYSA9IDA7IGEgPCBiLmxlbmd0aDsgYSsrKSBkYS5hZGQoYlthXSk7fQogICAgICAgICAgdmFyIGlhID0gISgidW5kZWZpbmVkIiA9PT0gdHlwZW9mIHdpbmRvdyB8fCAidW5kZWZpbmVkIiA9PT0gdHlwZW9mIHdpbmRvdy5kb2N1bWVudCB8fCAidW5kZWZpbmVkIiA9PT0gdHlwZW9mIHdpbmRvdy5kb2N1bWVudC5jcmVhdGVFbGVtZW50KSxqYSA9IE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHksa2EgPSAvXls6QS1aX2Etelx1MDBDMC1cdTAwRDZcdTAwRDgtXHUwMEY2XHUwMEY4LVx1MDJGRlx1MDM3MC1cdTAzN0RcdTAzN0YtXHUxRkZGXHUyMDBDLVx1MjAwRFx1MjA3MC1cdTIxOEZcdTJDMDAtXHUyRkVGXHUzMDAxLVx1RDdGRlx1RjkwMC1cdUZEQ0ZcdUZERjAtXHVGRkZEXVs6QS1aX2Etelx1MDBDMC1cdTAwRDZcdTAwRDgtXHUwMEY2XHUwMEY4LVx1MDJGRlx1MDM3MC1cdTAzN0RcdTAzN0YtXHUxRkZGXHUyMDBDLVx1MjAwRFx1MjA3MC1cdTIxOEZcdTJDMDAtXHUyRkVGXHUzMDAxLVx1RDdGRlx1RjkwMC1cdUZEQ0ZcdUZERjAtXHVGRkZEXC0uMC05XHUwMEI3XHUwMzAwLVx1MDM2Rlx1MjAzRi1cdTIwNDBdKiQvLGxhID0KICAgICAgICAgICAge30sbWEgPSB7fTtmdW5jdGlvbiBvYShhKSB7aWYgKGphLmNhbGwobWEsIGEpKSByZXR1cm4gITA7aWYgKGphLmNhbGwobGEsIGEpKSByZXR1cm4gITE7aWYgKGthLnRlc3QoYSkpIHJldHVybiBtYVthXSA9ICEwO2xhW2FdID0gITA7cmV0dXJuICExO31mdW5jdGlvbiBwYShhLCBiLCBjLCBkKSB7aWYgKG51bGwgIT09IGMgJiYgMCA9PT0gYy50eXBlKSByZXR1cm4gITE7c3dpdGNoICh0eXBlb2YgYikge2Nhc2UgImZ1bmN0aW9uIjpjYXNlICJzeW1ib2wiOnJldHVybiAhMDtjYXNlICJib29sZWFuIjppZiAoZCkgcmV0dXJuICExO2lmIChudWxsICE9PSBjKSByZXR1cm4gIWMuYWNjZXB0c0Jvb2xlYW5zO2EgPSBhLnRvTG93ZXJDYXNlKCkuc2xpY2UoMCwgNSk7cmV0dXJuICJkYXRhLSIgIT09IGEgJiYgImFyaWEtIiAhPT0gYTtkZWZhdWx0OnJldHVybiAhMTt9fQogICAgICAgICAgZnVuY3Rpb24gcWEoYSwgYiwgYywgZCkge2lmIChudWxsID09PSBiIHx8ICJ1bmRlZmluZWQiID09PSB0eXBlb2YgYiB8fCBwYShhLCBiLCBjLCBkKSkgcmV0dXJuICEwO2lmIChkKSByZXR1cm4gITE7aWYgKG51bGwgIT09IGMpIHN3aXRjaCAoYy50eXBlKSB7Y2FzZSAzOnJldHVybiAhYjtjYXNlIDQ6cmV0dXJuICExID09PSBiO2Nhc2UgNTpyZXR1cm4gaXNOYU4oYik7Y2FzZSA2OnJldHVybiBpc05hTihiKSB8fCAxID4gYjt9cmV0dXJuICExO31mdW5jdGlvbiB2KGEsIGIsIGMsIGQsIGUsIGYsIGcpIHt0aGlzLmFjY2VwdHNCb29sZWFucyA9IDIgPT09IGIgfHwgMyA9PT0gYiB8fCA0ID09PSBiO3RoaXMuYXR0cmlidXRlTmFtZSA9IGQ7dGhpcy5hdHRyaWJ1dGVOYW1lc3BhY2UgPSBlO3RoaXMubXVzdFVzZVByb3BlcnR5ID0gYzt0aGlzLnByb3BlcnR5TmFtZSA9IGE7dGhpcy50eXBlID0gYjt0aGlzLnNhbml0aXplVVJMID0gZjt0aGlzLnJlbW92ZUVtcHR5U3RyaW5nID0gZzt9dmFyIHogPSB7fTsKICAgICAgICAgICJjaGlsZHJlbiBkYW5nZXJvdXNseVNldElubmVySFRNTCBkZWZhdWx0VmFsdWUgZGVmYXVsdENoZWNrZWQgaW5uZXJIVE1MIHN1cHByZXNzQ29udGVudEVkaXRhYmxlV2FybmluZyBzdXBwcmVzc0h5ZHJhdGlvbldhcm5pbmcgc3R5bGUiLnNwbGl0KCIgIikuZm9yRWFjaChmdW5jdGlvbiAoYSkge3pbYV0gPSBuZXcgdihhLCAwLCAhMSwgYSwgbnVsbCwgITEsICExKTt9KTtbWyJhY2NlcHRDaGFyc2V0IiwgImFjY2VwdC1jaGFyc2V0Il0sIFsiY2xhc3NOYW1lIiwgImNsYXNzIl0sIFsiaHRtbEZvciIsICJmb3IiXSwgWyJodHRwRXF1aXYiLCAiaHR0cC1lcXVpdiJdXS5mb3JFYWNoKGZ1bmN0aW9uIChhKSB7dmFyIGIgPSBhWzBdO3pbYl0gPSBuZXcgdihiLCAxLCAhMSwgYVsxXSwgbnVsbCwgITEsICExKTt9KTtbImNvbnRlbnRFZGl0YWJsZSIsICJkcmFnZ2FibGUiLCAic3BlbGxDaGVjayIsICJ2YWx1ZSJdLmZvckVhY2goZnVuY3Rpb24gKGEpIHt6W2FdID0gbmV3IHYoYSwgMiwgITEsIGEudG9Mb3dlckNhc2UoKSwgbnVsbCwgITEsICExKTt9KTsKICAgICAgICAgIFsiYXV0b1JldmVyc2UiLCAiZXh0ZXJuYWxSZXNvdXJjZXNSZXF1aXJlZCIsICJmb2N1c2FibGUiLCAicHJlc2VydmVBbHBoYSJdLmZvckVhY2goZnVuY3Rpb24gKGEpIHt6W2FdID0gbmV3IHYoYSwgMiwgITEsIGEsIG51bGwsICExLCAhMSk7fSk7ImFsbG93RnVsbFNjcmVlbiBhc3luYyBhdXRvRm9jdXMgYXV0b1BsYXkgY29udHJvbHMgZGVmYXVsdCBkZWZlciBkaXNhYmxlZCBkaXNhYmxlUGljdHVyZUluUGljdHVyZSBkaXNhYmxlUmVtb3RlUGxheWJhY2sgZm9ybU5vVmFsaWRhdGUgaGlkZGVuIGxvb3Agbm9Nb2R1bGUgbm9WYWxpZGF0ZSBvcGVuIHBsYXlzSW5saW5lIHJlYWRPbmx5IHJlcXVpcmVkIHJldmVyc2VkIHNjb3BlZCBzZWFtbGVzcyBpdGVtU2NvcGUiLnNwbGl0KCIgIikuZm9yRWFjaChmdW5jdGlvbiAoYSkge3pbYV0gPSBuZXcgdihhLCAzLCAhMSwgYS50b0xvd2VyQ2FzZSgpLCBudWxsLCAhMSwgITEpO30pOwogICAgICAgICAgWyJjaGVja2VkIiwgIm11bHRpcGxlIiwgIm11dGVkIiwgInNlbGVjdGVkIl0uZm9yRWFjaChmdW5jdGlvbiAoYSkge3pbYV0gPSBuZXcgdihhLCAzLCAhMCwgYSwgbnVsbCwgITEsICExKTt9KTtbImNhcHR1cmUiLCAiZG93bmxvYWQiXS5mb3JFYWNoKGZ1bmN0aW9uIChhKSB7elthXSA9IG5ldyB2KGEsIDQsICExLCBhLCBudWxsLCAhMSwgITEpO30pO1siY29scyIsICJyb3dzIiwgInNpemUiLCAic3BhbiJdLmZvckVhY2goZnVuY3Rpb24gKGEpIHt6W2FdID0gbmV3IHYoYSwgNiwgITEsIGEsIG51bGwsICExLCAhMSk7fSk7WyJyb3dTcGFuIiwgInN0YXJ0Il0uZm9yRWFjaChmdW5jdGlvbiAoYSkge3pbYV0gPSBuZXcgdihhLCA1LCAhMSwgYS50b0xvd2VyQ2FzZSgpLCBudWxsLCAhMSwgITEpO30pO3ZhciByYSA9IC9bXC06XShbYS16XSkvZztmdW5jdGlvbiBzYShhKSB7cmV0dXJuIGFbMV0udG9VcHBlckNhc2UoKTt9CiAgICAgICAgICAiYWNjZW50LWhlaWdodCBhbGlnbm1lbnQtYmFzZWxpbmUgYXJhYmljLWZvcm0gYmFzZWxpbmUtc2hpZnQgY2FwLWhlaWdodCBjbGlwLXBhdGggY2xpcC1ydWxlIGNvbG9yLWludGVycG9sYXRpb24gY29sb3ItaW50ZXJwb2xhdGlvbi1maWx0ZXJzIGNvbG9yLXByb2ZpbGUgY29sb3ItcmVuZGVyaW5nIGRvbWluYW50LWJhc2VsaW5lIGVuYWJsZS1iYWNrZ3JvdW5kIGZpbGwtb3BhY2l0eSBmaWxsLXJ1bGUgZmxvb2QtY29sb3IgZmxvb2Qtb3BhY2l0eSBmb250LWZhbWlseSBmb250LXNpemUgZm9udC1zaXplLWFkanVzdCBmb250LXN0cmV0Y2ggZm9udC1zdHlsZSBmb250LXZhcmlhbnQgZm9udC13ZWlnaHQgZ2x5cGgtbmFtZSBnbHlwaC1vcmllbnRhdGlvbi1ob3Jpem9udGFsIGdseXBoLW9yaWVudGF0aW9uLXZlcnRpY2FsIGhvcml6LWFkdi14IGhvcml6LW9yaWdpbi14IGltYWdlLXJlbmRlcmluZyBsZXR0ZXItc3BhY2luZyBsaWdodGluZy1jb2xvciBtYXJrZXItZW5kIG1hcmtlci1taWQgbWFya2VyLXN0YXJ0IG92ZXJsaW5lLXBvc2l0aW9uIG92ZXJsaW5lLXRoaWNrbmVzcyBwYWludC1vcmRlciBwYW5vc2UtMSBwb2ludGVyLWV2ZW50cyByZW5kZXJpbmctaW50ZW50IHNoYXBlLXJlbmRlcmluZyBzdG9wLWNvbG9yIHN0b3Atb3BhY2l0eSBzdHJpa2V0aHJvdWdoLXBvc2l0aW9uIHN0cmlrZXRocm91Z2gtdGhpY2tuZXNzIHN0cm9rZS1kYXNoYXJyYXkgc3Ryb2tlLWRhc2hvZmZzZXQgc3Ryb2tlLWxpbmVjYXAgc3Ryb2tlLWxpbmVqb2luIHN0cm9rZS1taXRlcmxpbWl0IHN0cm9rZS1vcGFjaXR5IHN0cm9rZS13aWR0aCB0ZXh0LWFuY2hvciB0ZXh0LWRlY29yYXRpb24gdGV4dC1yZW5kZXJpbmcgdW5kZXJsaW5lLXBvc2l0aW9uIHVuZGVybGluZS10aGlja25lc3MgdW5pY29kZS1iaWRpIHVuaWNvZGUtcmFuZ2UgdW5pdHMtcGVyLWVtIHYtYWxwaGFiZXRpYyB2LWhhbmdpbmcgdi1pZGVvZ3JhcGhpYyB2LW1hdGhlbWF0aWNhbCB2ZWN0b3ItZWZmZWN0IHZlcnQtYWR2LXkgdmVydC1vcmlnaW4teCB2ZXJ0LW9yaWdpbi15IHdvcmQtc3BhY2luZyB3cml0aW5nLW1vZGUgeG1sbnM6eGxpbmsgeC1oZWlnaHQiLnNwbGl0KCIgIikuZm9yRWFjaChmdW5jdGlvbiAoYSkge3ZhciBiID0gYS5yZXBsYWNlKHJhLAogICAgICAgICAgICBzYSk7eltiXSA9IG5ldyB2KGIsIDEsICExLCBhLCBudWxsLCAhMSwgITEpO30pOyJ4bGluazphY3R1YXRlIHhsaW5rOmFyY3JvbGUgeGxpbms6cm9sZSB4bGluazpzaG93IHhsaW5rOnRpdGxlIHhsaW5rOnR5cGUiLnNwbGl0KCIgIikuZm9yRWFjaChmdW5jdGlvbiAoYSkge3ZhciBiID0gYS5yZXBsYWNlKHJhLCBzYSk7eltiXSA9IG5ldyB2KGIsIDEsICExLCBhLCAiaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIsICExLCAhMSk7fSk7WyJ4bWw6YmFzZSIsICJ4bWw6bGFuZyIsICJ4bWw6c3BhY2UiXS5mb3JFYWNoKGZ1bmN0aW9uIChhKSB7dmFyIGIgPSBhLnJlcGxhY2UocmEsIHNhKTt6W2JdID0gbmV3IHYoYiwgMSwgITEsIGEsICJodHRwOi8vd3d3LnczLm9yZy9YTUwvMTk5OC9uYW1lc3BhY2UiLCAhMSwgITEpO30pO1sidGFiSW5kZXgiLCAiY3Jvc3NPcmlnaW4iXS5mb3JFYWNoKGZ1bmN0aW9uIChhKSB7elthXSA9IG5ldyB2KGEsIDEsICExLCBhLnRvTG93ZXJDYXNlKCksIG51bGwsICExLCAhMSk7fSk7CiAgICAgICAgICB6LnhsaW5rSHJlZiA9IG5ldyB2KCJ4bGlua0hyZWYiLCAxLCAhMSwgInhsaW5rOmhyZWYiLCAiaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIsICEwLCAhMSk7WyJzcmMiLCAiaHJlZiIsICJhY3Rpb24iLCAiZm9ybUFjdGlvbiJdLmZvckVhY2goZnVuY3Rpb24gKGEpIHt6W2FdID0gbmV3IHYoYSwgMSwgITEsIGEudG9Mb3dlckNhc2UoKSwgbnVsbCwgITAsICEwKTt9KTsKICAgICAgICAgIGZ1bmN0aW9uIHRhKGEsIGIsIGMsIGQpIHt2YXIgZSA9IHouaGFzT3duUHJvcGVydHkoYikgPyB6W2JdIDogbnVsbDtpZiAobnVsbCAhPT0gZSA/IDAgIT09IGUudHlwZSA6IGQgfHwgISgyIDwgYi5sZW5ndGgpIHx8ICJvIiAhPT0gYlswXSAmJiAiTyIgIT09IGJbMF0gfHwgIm4iICE9PSBiWzFdICYmICJOIiAhPT0gYlsxXSkgcWEoYiwgYywgZSwgZCkgJiYgKGMgPSBudWxsKSwgZCB8fCBudWxsID09PSBlID8gb2EoYikgJiYgKG51bGwgPT09IGMgPyBhLnJlbW92ZUF0dHJpYnV0ZShiKSA6IGEuc2V0QXR0cmlidXRlKGIsICIiICsgYykpIDogZS5tdXN0VXNlUHJvcGVydHkgPyBhW2UucHJvcGVydHlOYW1lXSA9IG51bGwgPT09IGMgPyAzID09PSBlLnR5cGUgPyAhMSA6ICIiIDogYyA6IChiID0gZS5hdHRyaWJ1dGVOYW1lLCBkID0gZS5hdHRyaWJ1dGVOYW1lc3BhY2UsIG51bGwgPT09IGMgPyBhLnJlbW92ZUF0dHJpYnV0ZShiKSA6IChlID0gZS50eXBlLCBjID0gMyA9PT0gZSB8fCA0ID09PSBlICYmICEwID09PSBjID8gIiIgOiAiIiArIGMsIGQgPyBhLnNldEF0dHJpYnV0ZU5TKGQsIGIsIGMpIDogYS5zZXRBdHRyaWJ1dGUoYiwgYykpKTt9CiAgICAgICAgICB2YXIgdWEgPSBhYS5fX1NFQ1JFVF9JTlRFUk5BTFNfRE9fTk9UX1VTRV9PUl9ZT1VfV0lMTF9CRV9GSVJFRCx2YSA9IFN5bWJvbC5mb3IoInJlYWN0LmVsZW1lbnQiKSx3YSA9IFN5bWJvbC5mb3IoInJlYWN0LnBvcnRhbCIpLHlhID0gU3ltYm9sLmZvcigicmVhY3QuZnJhZ21lbnQiKSx6YSA9IFN5bWJvbC5mb3IoInJlYWN0LnN0cmljdF9tb2RlIiksQWEgPSBTeW1ib2wuZm9yKCJyZWFjdC5wcm9maWxlciIpLEJhID0gU3ltYm9sLmZvcigicmVhY3QucHJvdmlkZXIiKSxDYSA9IFN5bWJvbC5mb3IoInJlYWN0LmNvbnRleHQiKSxEYSA9IFN5bWJvbC5mb3IoInJlYWN0LmZvcndhcmRfcmVmIiksRWEgPSBTeW1ib2wuZm9yKCJyZWFjdC5zdXNwZW5zZSIpLEZhID0gU3ltYm9sLmZvcigicmVhY3Quc3VzcGVuc2VfbGlzdCIpLEdhID0gU3ltYm9sLmZvcigicmVhY3QubWVtbyIpLEhhID0gU3ltYm9sLmZvcigicmVhY3QubGF6eSIpO1N5bWJvbC5mb3IoInJlYWN0LnNjb3BlIik7U3ltYm9sLmZvcigicmVhY3QuZGVidWdfdHJhY2VfbW9kZSIpOwogICAgICAgICAgdmFyIElhID0gU3ltYm9sLmZvcigicmVhY3Qub2Zmc2NyZWVuIik7U3ltYm9sLmZvcigicmVhY3QubGVnYWN5X2hpZGRlbiIpO1N5bWJvbC5mb3IoInJlYWN0LmNhY2hlIik7U3ltYm9sLmZvcigicmVhY3QudHJhY2luZ19tYXJrZXIiKTt2YXIgSmEgPSBTeW1ib2wuaXRlcmF0b3I7ZnVuY3Rpb24gS2EoYSkge2lmIChudWxsID09PSBhIHx8ICJvYmplY3QiICE9PSB0eXBlb2YgYSkgcmV0dXJuIG51bGw7YSA9IEphICYmIGFbSmFdIHx8IGFbIkBAaXRlcmF0b3IiXTtyZXR1cm4gImZ1bmN0aW9uIiA9PT0gdHlwZW9mIGEgPyBhIDogbnVsbDt9dmFyIEEgPSBPYmplY3QuYXNzaWduLExhO2Z1bmN0aW9uIE1hKGEpIHtpZiAodm9pZCAwID09PSBMYSkgdHJ5IHt0aHJvdyBFcnJvcigpO30gY2F0Y2ggKGMpIHt2YXIgYiA9IGMuc3RhY2sudHJpbSgpLm1hdGNoKC9cbiggKihhdCApPykvKTtMYSA9IGIgJiYgYlsxXSB8fCAiIjt9cmV0dXJuICJcbiIgKyBMYSArIGE7fXZhciBOYSA9ICExOwogICAgICAgICAgZnVuY3Rpb24gT2EoYSwgYikge2lmICghYSB8fCBOYSkgcmV0dXJuICIiO05hID0gITA7dmFyIGMgPSBFcnJvci5wcmVwYXJlU3RhY2tUcmFjZTtFcnJvci5wcmVwYXJlU3RhY2tUcmFjZSA9IHZvaWQgMDt0cnkge2lmIChiKSB7aWYgKGIgPSBmdW5jdGlvbiBiKCkge3Rocm93IEVycm9yKCk7fSwgT2JqZWN0LmRlZmluZVByb3BlcnR5KGIucHJvdG90eXBlLCAicHJvcHMiLCB7IHNldDogZnVuY3Rpb24gc2V0KCkge3Rocm93IEVycm9yKCk7fSB9KSwgIm9iamVjdCIgPT09IHR5cGVvZiBSZWZsZWN0ICYmIFJlZmxlY3QuY29uc3RydWN0KSB7dHJ5IHtSZWZsZWN0LmNvbnN0cnVjdChiLCBbXSk7fSBjYXRjaCAobCkge3ZhciBkID0gbDt9UmVmbGVjdC5jb25zdHJ1Y3QoYSwgW10sIGIpO30gZWxzZSB7dHJ5IHtiLmNhbGwoKTt9IGNhdGNoIChsKSB7ZCA9IGw7fWEuY2FsbChiLnByb3RvdHlwZSk7fX0gZWxzZSB7dHJ5IHt0aHJvdyBFcnJvcigpO30gY2F0Y2ggKGwpIHtkID0gbDt9YSgpO319IGNhdGNoIChsKSB7aWYgKGwgJiYgZCAmJiAic3RyaW5nIiA9PT0gdHlwZW9mIGwuc3RhY2spIHtmb3IgKHZhciBlID0gbC5zdGFjay5zcGxpdCgiXG4iKSwKICAgICAgICAgICAgICAgICAgZiA9IGQuc3RhY2suc3BsaXQoIlxuIiksIGcgPSBlLmxlbmd0aCAtIDEsIGggPSBmLmxlbmd0aCAtIDE7IDEgPD0gZyAmJiAwIDw9IGggJiYgZVtnXSAhPT0gZltoXTspIGgtLTtmb3IgKDsgMSA8PSBnICYmIDAgPD0gaDsgZy0tLCBoLS0pIGlmIChlW2ddICE9PSBmW2hdKSB7aWYgKDEgIT09IGcgfHwgMSAhPT0gaCkge2RvIGlmIChnLS0sIGgtLSwgMCA+IGggfHwgZVtnXSAhPT0gZltoXSkge3ZhciBrID0gIlxuIiArIGVbZ10ucmVwbGFjZSgiIGF0IG5ldyAiLCAiIGF0ICIpO2EuZGlzcGxheU5hbWUgJiYgay5pbmNsdWRlcygiPGFub255bW91cz4iKSAmJiAoayA9IGsucmVwbGFjZSgiPGFub255bW91cz4iLCBhLmRpc3BsYXlOYW1lKSk7cmV0dXJuIGs7fSB3aGlsZSAoMSA8PSBnICYmIDAgPD0gaCk7fWJyZWFrO319fSBmaW5hbGx5IHtOYSA9ICExLCBFcnJvci5wcmVwYXJlU3RhY2tUcmFjZSA9IGM7fXJldHVybiAoYSA9IGEgPyBhLmRpc3BsYXlOYW1lIHx8IGEubmFtZSA6ICIiKSA/IE1hKGEpIDogIiI7fQogICAgICAgICAgZnVuY3Rpb24gUGEoYSkge3N3aXRjaCAoYS50YWcpIHtjYXNlIDU6cmV0dXJuIE1hKGEudHlwZSk7Y2FzZSAxNjpyZXR1cm4gTWEoIkxhenkiKTtjYXNlIDEzOnJldHVybiBNYSgiU3VzcGVuc2UiKTtjYXNlIDE5OnJldHVybiBNYSgiU3VzcGVuc2VMaXN0Iik7Y2FzZSAwOmNhc2UgMjpjYXNlIDE1OnJldHVybiBhID0gT2EoYS50eXBlLCAhMSksIGE7Y2FzZSAxMTpyZXR1cm4gYSA9IE9hKGEudHlwZS5yZW5kZXIsICExKSwgYTtjYXNlIDE6cmV0dXJuIGEgPSBPYShhLnR5cGUsICEwKSwgYTtkZWZhdWx0OnJldHVybiAiIjt9fQogICAgICAgICAgZnVuY3Rpb24gUWEoYSkge2lmIChudWxsID09IGEpIHJldHVybiBudWxsO2lmICgiZnVuY3Rpb24iID09PSB0eXBlb2YgYSkgcmV0dXJuIGEuZGlzcGxheU5hbWUgfHwgYS5uYW1lIHx8IG51bGw7aWYgKCJzdHJpbmciID09PSB0eXBlb2YgYSkgcmV0dXJuIGE7c3dpdGNoIChhKSB7Y2FzZSB5YTpyZXR1cm4gIkZyYWdtZW50IjtjYXNlIHdhOnJldHVybiAiUG9ydGFsIjtjYXNlIEFhOnJldHVybiAiUHJvZmlsZXIiO2Nhc2UgemE6cmV0dXJuICJTdHJpY3RNb2RlIjtjYXNlIEVhOnJldHVybiAiU3VzcGVuc2UiO2Nhc2UgRmE6cmV0dXJuICJTdXNwZW5zZUxpc3QiO31pZiAoIm9iamVjdCIgPT09IHR5cGVvZiBhKSBzd2l0Y2ggKGEuJCR0eXBlb2YpIHtjYXNlIENhOnJldHVybiAoYS5kaXNwbGF5TmFtZSB8fCAiQ29udGV4dCIpICsgIi5Db25zdW1lciI7Y2FzZSBCYTpyZXR1cm4gKGEuX2NvbnRleHQuZGlzcGxheU5hbWUgfHwgIkNvbnRleHQiKSArICIuUHJvdmlkZXIiO2Nhc2UgRGE6dmFyIGIgPSBhLnJlbmRlcjthID0gYS5kaXNwbGF5TmFtZTthIHx8IChhID0gYi5kaXNwbGF5TmFtZSB8fAogICAgICAgICAgICAgICAgYi5uYW1lIHx8ICIiLCBhID0gIiIgIT09IGEgPyAiRm9yd2FyZFJlZigiICsgYSArICIpIiA6ICJGb3J3YXJkUmVmIik7cmV0dXJuIGE7Y2FzZSBHYTpyZXR1cm4gYiA9IGEuZGlzcGxheU5hbWUgfHwgbnVsbCwgbnVsbCAhPT0gYiA/IGIgOiBRYShhLnR5cGUpIHx8ICJNZW1vIjtjYXNlIEhhOmIgPSBhLl9wYXlsb2FkO2EgPSBhLl9pbml0O3RyeSB7cmV0dXJuIFFhKGEoYikpO30gY2F0Y2ggKGMpIHt9fXJldHVybiBudWxsO30KICAgICAgICAgIGZ1bmN0aW9uIFJhKGEpIHt2YXIgYiA9IGEudHlwZTtzd2l0Y2ggKGEudGFnKSB7Y2FzZSAyNDpyZXR1cm4gIkNhY2hlIjtjYXNlIDk6cmV0dXJuIChiLmRpc3BsYXlOYW1lIHx8ICJDb250ZXh0IikgKyAiLkNvbnN1bWVyIjtjYXNlIDEwOnJldHVybiAoYi5fY29udGV4dC5kaXNwbGF5TmFtZSB8fCAiQ29udGV4dCIpICsgIi5Qcm92aWRlciI7Y2FzZSAxODpyZXR1cm4gIkRlaHlkcmF0ZWRGcmFnbWVudCI7Y2FzZSAxMTpyZXR1cm4gYSA9IGIucmVuZGVyLCBhID0gYS5kaXNwbGF5TmFtZSB8fCBhLm5hbWUgfHwgIiIsIGIuZGlzcGxheU5hbWUgfHwgKCIiICE9PSBhID8gIkZvcndhcmRSZWYoIiArIGEgKyAiKSIgOiAiRm9yd2FyZFJlZiIpO2Nhc2UgNzpyZXR1cm4gIkZyYWdtZW50IjtjYXNlIDU6cmV0dXJuIGI7Y2FzZSA0OnJldHVybiAiUG9ydGFsIjtjYXNlIDM6cmV0dXJuICJSb290IjtjYXNlIDY6cmV0dXJuICJUZXh0IjtjYXNlIDE2OnJldHVybiBRYShiKTtjYXNlIDg6cmV0dXJuIGIgPT09IHphID8gIlN0cmljdE1vZGUiIDogIk1vZGUiO2Nhc2UgMjI6cmV0dXJuICJPZmZzY3JlZW4iOwogICAgICAgICAgICAgIGNhc2UgMTI6cmV0dXJuICJQcm9maWxlciI7Y2FzZSAyMTpyZXR1cm4gIlNjb3BlIjtjYXNlIDEzOnJldHVybiAiU3VzcGVuc2UiO2Nhc2UgMTk6cmV0dXJuICJTdXNwZW5zZUxpc3QiO2Nhc2UgMjU6cmV0dXJuICJUcmFjaW5nTWFya2VyIjtjYXNlIDE6Y2FzZSAwOmNhc2UgMTc6Y2FzZSAyOmNhc2UgMTQ6Y2FzZSAxNTppZiAoImZ1bmN0aW9uIiA9PT0gdHlwZW9mIGIpIHJldHVybiBiLmRpc3BsYXlOYW1lIHx8IGIubmFtZSB8fCBudWxsO2lmICgic3RyaW5nIiA9PT0gdHlwZW9mIGIpIHJldHVybiBiO31yZXR1cm4gbnVsbDt9ZnVuY3Rpb24gU2EoYSkge3N3aXRjaCAodHlwZW9mIGEpIHtjYXNlICJib29sZWFuIjpjYXNlICJudW1iZXIiOmNhc2UgInN0cmluZyI6Y2FzZSAidW5kZWZpbmVkIjpyZXR1cm4gYTtjYXNlICJvYmplY3QiOnJldHVybiBhO2RlZmF1bHQ6cmV0dXJuICIiO319CiAgICAgICAgICBmdW5jdGlvbiBUYShhKSB7dmFyIGIgPSBhLnR5cGU7cmV0dXJuIChhID0gYS5ub2RlTmFtZSkgJiYgImlucHV0IiA9PT0gYS50b0xvd2VyQ2FzZSgpICYmICgiY2hlY2tib3giID09PSBiIHx8ICJyYWRpbyIgPT09IGIpO30KICAgICAgICAgIGZ1bmN0aW9uIFVhKGEpIHt2YXIgYiA9IFRhKGEpID8gImNoZWNrZWQiIDogInZhbHVlIixjID0gT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihhLmNvbnN0cnVjdG9yLnByb3RvdHlwZSwgYiksZCA9ICIiICsgYVtiXTtpZiAoIWEuaGFzT3duUHJvcGVydHkoYikgJiYgInVuZGVmaW5lZCIgIT09IHR5cGVvZiBjICYmICJmdW5jdGlvbiIgPT09IHR5cGVvZiBjLmdldCAmJiAiZnVuY3Rpb24iID09PSB0eXBlb2YgYy5zZXQpIHt2YXIgZSA9IGMuZ2V0LGYgPSBjLnNldDtPYmplY3QuZGVmaW5lUHJvcGVydHkoYSwgYiwgeyBjb25maWd1cmFibGU6ICEwLCBnZXQ6IGZ1bmN0aW9uIGdldCgpIHtyZXR1cm4gZS5jYWxsKHRoaXMpO30sIHNldDogZnVuY3Rpb24gc2V0KGEpIHtkID0gIiIgKyBhO2YuY2FsbCh0aGlzLCBhKTt9IH0pO09iamVjdC5kZWZpbmVQcm9wZXJ0eShhLCBiLCB7IGVudW1lcmFibGU6IGMuZW51bWVyYWJsZSB9KTtyZXR1cm4geyBnZXRWYWx1ZTogZnVuY3Rpb24gZ2V0VmFsdWUoKSB7cmV0dXJuIGQ7fSwgc2V0VmFsdWU6IGZ1bmN0aW9uIHNldFZhbHVlKGEpIHtkID0gIiIgKyBhO30sIHN0b3BUcmFja2luZzogZnVuY3Rpb24gc3RvcFRyYWNraW5nKCkge2EuX3ZhbHVlVHJhY2tlciA9CiAgICAgICAgICAgICAgICAgIG51bGw7ZGVsZXRlIGFbYl07fSB9O319ZnVuY3Rpb24gVmEoYSkge2EuX3ZhbHVlVHJhY2tlciB8fCAoYS5fdmFsdWVUcmFja2VyID0gVWEoYSkpO31mdW5jdGlvbiBXYShhKSB7aWYgKCFhKSByZXR1cm4gITE7dmFyIGIgPSBhLl92YWx1ZVRyYWNrZXI7aWYgKCFiKSByZXR1cm4gITA7dmFyIGMgPSBiLmdldFZhbHVlKCk7dmFyIGQgPSAiIjthICYmIChkID0gVGEoYSkgPyBhLmNoZWNrZWQgPyAidHJ1ZSIgOiAiZmFsc2UiIDogYS52YWx1ZSk7YSA9IGQ7cmV0dXJuIGEgIT09IGMgPyAoYi5zZXRWYWx1ZShhKSwgITApIDogITE7fWZ1bmN0aW9uIFhhKGEpIHthID0gYSB8fCAoInVuZGVmaW5lZCIgIT09IHR5cGVvZiBkb2N1bWVudCA/IGRvY3VtZW50IDogdm9pZCAwKTtpZiAoInVuZGVmaW5lZCIgPT09IHR5cGVvZiBhKSByZXR1cm4gbnVsbDt0cnkge3JldHVybiBhLmFjdGl2ZUVsZW1lbnQgfHwgYS5ib2R5O30gY2F0Y2ggKGIpIHtyZXR1cm4gYS5ib2R5O319CiAgICAgICAgICBmdW5jdGlvbiBZYShhLCBiKSB7dmFyIGMgPSBiLmNoZWNrZWQ7cmV0dXJuIEEoe30sIGIsIHsgZGVmYXVsdENoZWNrZWQ6IHZvaWQgMCwgZGVmYXVsdFZhbHVlOiB2b2lkIDAsIHZhbHVlOiB2b2lkIDAsIGNoZWNrZWQ6IG51bGwgIT0gYyA/IGMgOiBhLl93cmFwcGVyU3RhdGUuaW5pdGlhbENoZWNrZWQgfSk7fWZ1bmN0aW9uIFphKGEsIGIpIHt2YXIgYyA9IG51bGwgPT0gYi5kZWZhdWx0VmFsdWUgPyAiIiA6IGIuZGVmYXVsdFZhbHVlLGQgPSBudWxsICE9IGIuY2hlY2tlZCA/IGIuY2hlY2tlZCA6IGIuZGVmYXVsdENoZWNrZWQ7YyA9IFNhKG51bGwgIT0gYi52YWx1ZSA/IGIudmFsdWUgOiBjKTthLl93cmFwcGVyU3RhdGUgPSB7IGluaXRpYWxDaGVja2VkOiBkLCBpbml0aWFsVmFsdWU6IGMsIGNvbnRyb2xsZWQ6ICJjaGVja2JveCIgPT09IGIudHlwZSB8fCAicmFkaW8iID09PSBiLnR5cGUgPyBudWxsICE9IGIuY2hlY2tlZCA6IG51bGwgIT0gYi52YWx1ZSB9O31mdW5jdGlvbiBhYihhLCBiKSB7YiA9IGIuY2hlY2tlZDtudWxsICE9IGIgJiYgdGEoYSwgImNoZWNrZWQiLCBiLCAhMSk7fQogICAgICAgICAgZnVuY3Rpb24gYmIoYSwgYikge2FiKGEsIGIpO3ZhciBjID0gU2EoYi52YWx1ZSksZCA9IGIudHlwZTtpZiAobnVsbCAhPSBjKSB7aWYgKCJudW1iZXIiID09PSBkKSB7aWYgKDAgPT09IGMgJiYgIiIgPT09IGEudmFsdWUgfHwgYS52YWx1ZSAhPSBjKSBhLnZhbHVlID0gIiIgKyBjO30gZWxzZSBhLnZhbHVlICE9PSAiIiArIGMgJiYgKGEudmFsdWUgPSAiIiArIGMpO30gZWxzZSBpZiAoInN1Ym1pdCIgPT09IGQgfHwgInJlc2V0IiA9PT0gZCkge2EucmVtb3ZlQXR0cmlidXRlKCJ2YWx1ZSIpO3JldHVybjt9Yi5oYXNPd25Qcm9wZXJ0eSgidmFsdWUiKSA/IGNiKGEsIGIudHlwZSwgYykgOiBiLmhhc093blByb3BlcnR5KCJkZWZhdWx0VmFsdWUiKSAmJiBjYihhLCBiLnR5cGUsIFNhKGIuZGVmYXVsdFZhbHVlKSk7bnVsbCA9PSBiLmNoZWNrZWQgJiYgbnVsbCAhPSBiLmRlZmF1bHRDaGVja2VkICYmIChhLmRlZmF1bHRDaGVja2VkID0gISFiLmRlZmF1bHRDaGVja2VkKTt9CiAgICAgICAgICBmdW5jdGlvbiBkYihhLCBiLCBjKSB7aWYgKGIuaGFzT3duUHJvcGVydHkoInZhbHVlIikgfHwgYi5oYXNPd25Qcm9wZXJ0eSgiZGVmYXVsdFZhbHVlIikpIHt2YXIgZCA9IGIudHlwZTtpZiAoISgic3VibWl0IiAhPT0gZCAmJiAicmVzZXQiICE9PSBkIHx8IHZvaWQgMCAhPT0gYi52YWx1ZSAmJiBudWxsICE9PSBiLnZhbHVlKSkgcmV0dXJuO2IgPSAiIiArIGEuX3dyYXBwZXJTdGF0ZS5pbml0aWFsVmFsdWU7YyB8fCBiID09PSBhLnZhbHVlIHx8IChhLnZhbHVlID0gYik7YS5kZWZhdWx0VmFsdWUgPSBiO31jID0gYS5uYW1lOyIiICE9PSBjICYmIChhLm5hbWUgPSAiIik7YS5kZWZhdWx0Q2hlY2tlZCA9ICEhYS5fd3JhcHBlclN0YXRlLmluaXRpYWxDaGVja2VkOyIiICE9PSBjICYmIChhLm5hbWUgPSBjKTt9CiAgICAgICAgICBmdW5jdGlvbiBjYihhLCBiLCBjKSB7aWYgKCJudW1iZXIiICE9PSBiIHx8IFhhKGEub3duZXJEb2N1bWVudCkgIT09IGEpIG51bGwgPT0gYyA/IGEuZGVmYXVsdFZhbHVlID0gIiIgKyBhLl93cmFwcGVyU3RhdGUuaW5pdGlhbFZhbHVlIDogYS5kZWZhdWx0VmFsdWUgIT09ICIiICsgYyAmJiAoYS5kZWZhdWx0VmFsdWUgPSAiIiArIGMpO312YXIgZWIgPSBBcnJheS5pc0FycmF5OwogICAgICAgICAgZnVuY3Rpb24gZmIoYSwgYiwgYywgZCkge2EgPSBhLm9wdGlvbnM7aWYgKGIpIHtiID0ge307Zm9yICh2YXIgZSA9IDA7IGUgPCBjLmxlbmd0aDsgZSsrKSBiWyIkIiArIGNbZV1dID0gITA7Zm9yIChjID0gMDsgYyA8IGEubGVuZ3RoOyBjKyspIGUgPSBiLmhhc093blByb3BlcnR5KCIkIiArIGFbY10udmFsdWUpLCBhW2NdLnNlbGVjdGVkICE9PSBlICYmIChhW2NdLnNlbGVjdGVkID0gZSksIGUgJiYgZCAmJiAoYVtjXS5kZWZhdWx0U2VsZWN0ZWQgPSAhMCk7fSBlbHNlIHtjID0gIiIgKyBTYShjKTtiID0gbnVsbDtmb3IgKGUgPSAwOyBlIDwgYS5sZW5ndGg7IGUrKykge2lmIChhW2VdLnZhbHVlID09PSBjKSB7YVtlXS5zZWxlY3RlZCA9ICEwO2QgJiYgKGFbZV0uZGVmYXVsdFNlbGVjdGVkID0gITApO3JldHVybjt9bnVsbCAhPT0gYiB8fCBhW2VdLmRpc2FibGVkIHx8IChiID0gYVtlXSk7fW51bGwgIT09IGIgJiYgKGIuc2VsZWN0ZWQgPSAhMCk7fX0KICAgICAgICAgIGZ1bmN0aW9uIGdiKGEsIGIpIHtpZiAobnVsbCAhPSBiLmRhbmdlcm91c2x5U2V0SW5uZXJIVE1MKSB0aHJvdyBFcnJvcihwKDkxKSk7cmV0dXJuIEEoe30sIGIsIHsgdmFsdWU6IHZvaWQgMCwgZGVmYXVsdFZhbHVlOiB2b2lkIDAsIGNoaWxkcmVuOiAiIiArIGEuX3dyYXBwZXJTdGF0ZS5pbml0aWFsVmFsdWUgfSk7fWZ1bmN0aW9uIGhiKGEsIGIpIHt2YXIgYyA9IGIudmFsdWU7aWYgKG51bGwgPT0gYykge2MgPSBiLmNoaWxkcmVuO2IgPSBiLmRlZmF1bHRWYWx1ZTtpZiAobnVsbCAhPSBjKSB7aWYgKG51bGwgIT0gYikgdGhyb3cgRXJyb3IocCg5MikpO2lmIChlYihjKSkge2lmICgxIDwgYy5sZW5ndGgpIHRocm93IEVycm9yKHAoOTMpKTtjID0gY1swXTt9YiA9IGM7fW51bGwgPT0gYiAmJiAoYiA9ICIiKTtjID0gYjt9YS5fd3JhcHBlclN0YXRlID0geyBpbml0aWFsVmFsdWU6IFNhKGMpIH07fQogICAgICAgICAgZnVuY3Rpb24gaWIoYSwgYikge3ZhciBjID0gU2EoYi52YWx1ZSksZCA9IFNhKGIuZGVmYXVsdFZhbHVlKTtudWxsICE9IGMgJiYgKGMgPSAiIiArIGMsIGMgIT09IGEudmFsdWUgJiYgKGEudmFsdWUgPSBjKSwgbnVsbCA9PSBiLmRlZmF1bHRWYWx1ZSAmJiBhLmRlZmF1bHRWYWx1ZSAhPT0gYyAmJiAoYS5kZWZhdWx0VmFsdWUgPSBjKSk7bnVsbCAhPSBkICYmIChhLmRlZmF1bHRWYWx1ZSA9ICIiICsgZCk7fWZ1bmN0aW9uIGpiKGEpIHt2YXIgYiA9IGEudGV4dENvbnRlbnQ7YiA9PT0gYS5fd3JhcHBlclN0YXRlLmluaXRpYWxWYWx1ZSAmJiAiIiAhPT0gYiAmJiBudWxsICE9PSBiICYmIChhLnZhbHVlID0gYik7fWZ1bmN0aW9uIGtiKGEpIHtzd2l0Y2ggKGEpIHtjYXNlICJzdmciOnJldHVybiAiaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciO2Nhc2UgIm1hdGgiOnJldHVybiAiaHR0cDovL3d3dy53My5vcmcvMTk5OC9NYXRoL01hdGhNTCI7ZGVmYXVsdDpyZXR1cm4gImh0dHA6Ly93d3cudzMub3JnLzE5OTkveGh0bWwiO319CiAgICAgICAgICBmdW5jdGlvbiBsYihhLCBiKSB7cmV0dXJuIG51bGwgPT0gYSB8fCAiaHR0cDovL3d3dy53My5vcmcvMTk5OS94aHRtbCIgPT09IGEgPyBrYihiKSA6ICJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgPT09IGEgJiYgImZvcmVpZ25PYmplY3QiID09PSBiID8gImh0dHA6Ly93d3cudzMub3JnLzE5OTkveGh0bWwiIDogYTt9CiAgICAgICAgICB2YXIgbWIsbmIgPSBmdW5jdGlvbiAoYSkge3JldHVybiAidW5kZWZpbmVkIiAhPT0gdHlwZW9mIE1TQXBwICYmIE1TQXBwLmV4ZWNVbnNhZmVMb2NhbEZ1bmN0aW9uID8gZnVuY3Rpb24gKGIsIGMsIGQsIGUpIHtNU0FwcC5leGVjVW5zYWZlTG9jYWxGdW5jdGlvbihmdW5jdGlvbiAoKSB7cmV0dXJuIGEoYiwgYywgZCwgZSk7fSk7fSA6IGE7fShmdW5jdGlvbiAoYSwgYikge2lmICgiaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciICE9PSBhLm5hbWVzcGFjZVVSSSB8fCAiaW5uZXJIVE1MIiBpbiBhKSBhLmlubmVySFRNTCA9IGI7ZWxzZSB7bWIgPSBtYiB8fCBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKTttYi5pbm5lckhUTUwgPSAiPHN2Zz4iICsgYi52YWx1ZU9mKCkudG9TdHJpbmcoKSArICI8L3N2Zz4iO2ZvciAoYiA9IG1iLmZpcnN0Q2hpbGQ7IGEuZmlyc3RDaGlsZDspIGEucmVtb3ZlQ2hpbGQoYS5maXJzdENoaWxkKTtmb3IgKDsgYi5maXJzdENoaWxkOykgYS5hcHBlbmRDaGlsZChiLmZpcnN0Q2hpbGQpO319KTsKICAgICAgICAgIGZ1bmN0aW9uIG9iKGEsIGIpIHtpZiAoYikge3ZhciBjID0gYS5maXJzdENoaWxkO2lmIChjICYmIGMgPT09IGEubGFzdENoaWxkICYmIDMgPT09IGMubm9kZVR5cGUpIHtjLm5vZGVWYWx1ZSA9IGI7cmV0dXJuO319YS50ZXh0Q29udGVudCA9IGI7fQogICAgICAgICAgdmFyIHBiID0geyBhbmltYXRpb25JdGVyYXRpb25Db3VudDogITAsIGFzcGVjdFJhdGlvOiAhMCwgYm9yZGVySW1hZ2VPdXRzZXQ6ICEwLCBib3JkZXJJbWFnZVNsaWNlOiAhMCwgYm9yZGVySW1hZ2VXaWR0aDogITAsIGJveEZsZXg6ICEwLCBib3hGbGV4R3JvdXA6ICEwLCBib3hPcmRpbmFsR3JvdXA6ICEwLCBjb2x1bW5Db3VudDogITAsIGNvbHVtbnM6ICEwLCBmbGV4OiAhMCwgZmxleEdyb3c6ICEwLCBmbGV4UG9zaXRpdmU6ICEwLCBmbGV4U2hyaW5rOiAhMCwgZmxleE5lZ2F0aXZlOiAhMCwgZmxleE9yZGVyOiAhMCwgZ3JpZEFyZWE6ICEwLCBncmlkUm93OiAhMCwgZ3JpZFJvd0VuZDogITAsIGdyaWRSb3dTcGFuOiAhMCwgZ3JpZFJvd1N0YXJ0OiAhMCwgZ3JpZENvbHVtbjogITAsIGdyaWRDb2x1bW5FbmQ6ICEwLCBncmlkQ29sdW1uU3BhbjogITAsIGdyaWRDb2x1bW5TdGFydDogITAsIGZvbnRXZWlnaHQ6ICEwLCBsaW5lQ2xhbXA6ICEwLCBsaW5lSGVpZ2h0OiAhMCwgb3BhY2l0eTogITAsIG9yZGVyOiAhMCwgb3JwaGFuczogITAsIHRhYlNpemU6ICEwLCB3aWRvd3M6ICEwLCB6SW5kZXg6ICEwLAogICAgICAgICAgICAgIHpvb206ICEwLCBmaWxsT3BhY2l0eTogITAsIGZsb29kT3BhY2l0eTogITAsIHN0b3BPcGFjaXR5OiAhMCwgc3Ryb2tlRGFzaGFycmF5OiAhMCwgc3Ryb2tlRGFzaG9mZnNldDogITAsIHN0cm9rZU1pdGVybGltaXQ6ICEwLCBzdHJva2VPcGFjaXR5OiAhMCwgc3Ryb2tlV2lkdGg6ICEwIH0scWIgPSBbIldlYmtpdCIsICJtcyIsICJNb3oiLCAiTyJdO09iamVjdC5rZXlzKHBiKS5mb3JFYWNoKGZ1bmN0aW9uIChhKSB7cWIuZm9yRWFjaChmdW5jdGlvbiAoYikge2IgPSBiICsgYS5jaGFyQXQoMCkudG9VcHBlckNhc2UoKSArIGEuc3Vic3RyaW5nKDEpO3BiW2JdID0gcGJbYV07fSk7fSk7ZnVuY3Rpb24gcmIoYSwgYiwgYykge3JldHVybiBudWxsID09IGIgfHwgImJvb2xlYW4iID09PSB0eXBlb2YgYiB8fCAiIiA9PT0gYiA/ICIiIDogYyB8fCAibnVtYmVyIiAhPT0gdHlwZW9mIGIgfHwgMCA9PT0gYiB8fCBwYi5oYXNPd25Qcm9wZXJ0eShhKSAmJiBwYlthXSA/ICgiIiArIGIpLnRyaW0oKSA6IGIgKyAicHgiO30KICAgICAgICAgIGZ1bmN0aW9uIHNiKGEsIGIpIHthID0gYS5zdHlsZTtmb3IgKHZhciBjIGluIGIpIGlmIChiLmhhc093blByb3BlcnR5KGMpKSB7dmFyIGQgPSAwID09PSBjLmluZGV4T2YoIi0tIiksZSA9IHJiKGMsIGJbY10sIGQpOyJmbG9hdCIgPT09IGMgJiYgKGMgPSAiY3NzRmxvYXQiKTtkID8gYS5zZXRQcm9wZXJ0eShjLCBlKSA6IGFbY10gPSBlO319dmFyIHRiID0gQSh7IG1lbnVpdGVtOiAhMCB9LCB7IGFyZWE6ICEwLCBiYXNlOiAhMCwgYnI6ICEwLCBjb2w6ICEwLCBlbWJlZDogITAsIGhyOiAhMCwgaW1nOiAhMCwgaW5wdXQ6ICEwLCBrZXlnZW46ICEwLCBsaW5rOiAhMCwgbWV0YTogITAsIHBhcmFtOiAhMCwgc291cmNlOiAhMCwgdHJhY2s6ICEwLCB3YnI6ICEwIH0pOwogICAgICAgICAgZnVuY3Rpb24gdWIoYSwgYikge2lmIChiKSB7aWYgKHRiW2FdICYmIChudWxsICE9IGIuY2hpbGRyZW4gfHwgbnVsbCAhPSBiLmRhbmdlcm91c2x5U2V0SW5uZXJIVE1MKSkgdGhyb3cgRXJyb3IocCgxMzcsIGEpKTtpZiAobnVsbCAhPSBiLmRhbmdlcm91c2x5U2V0SW5uZXJIVE1MKSB7aWYgKG51bGwgIT0gYi5jaGlsZHJlbikgdGhyb3cgRXJyb3IocCg2MCkpO2lmICgib2JqZWN0IiAhPT0gdHlwZW9mIGIuZGFuZ2Vyb3VzbHlTZXRJbm5lckhUTUwgfHwgISgiX19odG1sIiBpbiBiLmRhbmdlcm91c2x5U2V0SW5uZXJIVE1MKSkgdGhyb3cgRXJyb3IocCg2MSkpO31pZiAobnVsbCAhPSBiLnN0eWxlICYmICJvYmplY3QiICE9PSB0eXBlb2YgYi5zdHlsZSkgdGhyb3cgRXJyb3IocCg2MikpO319CiAgICAgICAgICBmdW5jdGlvbiB2YihhLCBiKSB7aWYgKC0xID09PSBhLmluZGV4T2YoIi0iKSkgcmV0dXJuICJzdHJpbmciID09PSB0eXBlb2YgYi5pcztzd2l0Y2ggKGEpIHtjYXNlICJhbm5vdGF0aW9uLXhtbCI6Y2FzZSAiY29sb3ItcHJvZmlsZSI6Y2FzZSAiZm9udC1mYWNlIjpjYXNlICJmb250LWZhY2Utc3JjIjpjYXNlICJmb250LWZhY2UtdXJpIjpjYXNlICJmb250LWZhY2UtZm9ybWF0IjpjYXNlICJmb250LWZhY2UtbmFtZSI6Y2FzZSAibWlzc2luZy1nbHlwaCI6cmV0dXJuICExO2RlZmF1bHQ6cmV0dXJuICEwO319dmFyIHdiID0gbnVsbDtmdW5jdGlvbiB4YihhKSB7YSA9IGEudGFyZ2V0IHx8IGEuc3JjRWxlbWVudCB8fCB3aW5kb3c7YS5jb3JyZXNwb25kaW5nVXNlRWxlbWVudCAmJiAoYSA9IGEuY29ycmVzcG9uZGluZ1VzZUVsZW1lbnQpO3JldHVybiAzID09PSBhLm5vZGVUeXBlID8gYS5wYXJlbnROb2RlIDogYTt9dmFyIHliID0gbnVsbCx6YiA9IG51bGwsQWIgPSBudWxsOwogICAgICAgICAgZnVuY3Rpb24gQmIoYSkge2lmIChhID0gQ2IoYSkpIHtpZiAoImZ1bmN0aW9uIiAhPT0gdHlwZW9mIHliKSB0aHJvdyBFcnJvcihwKDI4MCkpO3ZhciBiID0gYS5zdGF0ZU5vZGU7YiAmJiAoYiA9IERiKGIpLCB5YihhLnN0YXRlTm9kZSwgYS50eXBlLCBiKSk7fX1mdW5jdGlvbiBFYihhKSB7emIgPyBBYiA/IEFiLnB1c2goYSkgOiBBYiA9IFthXSA6IHpiID0gYTt9ZnVuY3Rpb24gRmIoKSB7aWYgKHpiKSB7dmFyIGEgPSB6YixiID0gQWI7QWIgPSB6YiA9IG51bGw7QmIoYSk7aWYgKGIpIGZvciAoYSA9IDA7IGEgPCBiLmxlbmd0aDsgYSsrKSBCYihiW2FdKTt9fWZ1bmN0aW9uIEdiKGEsIGIpIHtyZXR1cm4gYShiKTt9ZnVuY3Rpb24gSGIoKSB7fXZhciBJYiA9ICExO2Z1bmN0aW9uIEpiKGEsIGIsIGMpIHtpZiAoSWIpIHJldHVybiBhKGIsIGMpO0liID0gITA7dHJ5IHtyZXR1cm4gR2IoYSwgYiwgYyk7fSBmaW5hbGx5IHtpZiAoSWIgPSAhMSwgbnVsbCAhPT0gemIgfHwgbnVsbCAhPT0gQWIpIEhiKCksIEZiKCk7fX0KICAgICAgICAgIGZ1bmN0aW9uIEtiKGEsIGIpIHt2YXIgYyA9IGEuc3RhdGVOb2RlO2lmIChudWxsID09PSBjKSByZXR1cm4gbnVsbDt2YXIgZCA9IERiKGMpO2lmIChudWxsID09PSBkKSByZXR1cm4gbnVsbDtjID0gZFtiXTthOiBzd2l0Y2ggKGIpIHtjYXNlICJvbkNsaWNrIjpjYXNlICJvbkNsaWNrQ2FwdHVyZSI6Y2FzZSAib25Eb3VibGVDbGljayI6Y2FzZSAib25Eb3VibGVDbGlja0NhcHR1cmUiOmNhc2UgIm9uTW91c2VEb3duIjpjYXNlICJvbk1vdXNlRG93bkNhcHR1cmUiOmNhc2UgIm9uTW91c2VNb3ZlIjpjYXNlICJvbk1vdXNlTW92ZUNhcHR1cmUiOmNhc2UgIm9uTW91c2VVcCI6Y2FzZSAib25Nb3VzZVVwQ2FwdHVyZSI6Y2FzZSAib25Nb3VzZUVudGVyIjooZCA9ICFkLmRpc2FibGVkKSB8fCAoYSA9IGEudHlwZSwgZCA9ICEoImJ1dHRvbiIgPT09IGEgfHwgImlucHV0IiA9PT0gYSB8fCAic2VsZWN0IiA9PT0gYSB8fCAidGV4dGFyZWEiID09PSBhKSk7YSA9ICFkO2JyZWFrIGE7ZGVmYXVsdDphID0gITE7fWlmIChhKSByZXR1cm4gbnVsbDtpZiAoYyAmJiAiZnVuY3Rpb24iICE9PQogICAgICAgICAgICB0eXBlb2YgYykgdGhyb3cgRXJyb3IocCgyMzEsIGIsIHR5cGVvZiBjKSk7cmV0dXJuIGM7fXZhciBMYiA9ICExO2lmIChpYSkgdHJ5IHt2YXIgTWIgPSB7fTtPYmplY3QuZGVmaW5lUHJvcGVydHkoTWIsICJwYXNzaXZlIiwgeyBnZXQ6IGZ1bmN0aW9uIGdldCgpIHtMYiA9ICEwO30gfSk7d2luZG93LmFkZEV2ZW50TGlzdGVuZXIoInRlc3QiLCBNYiwgTWIpO3dpbmRvdy5yZW1vdmVFdmVudExpc3RlbmVyKCJ0ZXN0IiwgTWIsIE1iKTt9IGNhdGNoIChhKSB7TGIgPSAhMTt9ZnVuY3Rpb24gTmIoYSwgYiwgYywgZCwgZSwgZiwgZywgaCwgaykge3ZhciBsID0gQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYXJndW1lbnRzLCAzKTt0cnkge2IuYXBwbHkoYywgbCk7fSBjYXRjaCAobSkge3RoaXMub25FcnJvcihtKTt9fXZhciBPYiA9ICExLFBiID0gbnVsbCxRYiA9ICExLFJiID0gbnVsbCxTYiA9IHsgb25FcnJvcjogZnVuY3Rpb24gb25FcnJvcihhKSB7T2IgPSAhMDtQYiA9IGE7fSB9O2Z1bmN0aW9uIFRiKGEsIGIsIGMsIGQsIGUsIGYsIGcsIGgsIGspIHtPYiA9ICExO1BiID0gbnVsbDtOYi5hcHBseShTYiwgYXJndW1lbnRzKTt9CiAgICAgICAgICBmdW5jdGlvbiBVYihhLCBiLCBjLCBkLCBlLCBmLCBnLCBoLCBrKSB7VGIuYXBwbHkodGhpcywgYXJndW1lbnRzKTtpZiAoT2IpIHtpZiAoT2IpIHt2YXIgbCA9IFBiO09iID0gITE7UGIgPSBudWxsO30gZWxzZSB0aHJvdyBFcnJvcihwKDE5OCkpO1FiIHx8IChRYiA9ICEwLCBSYiA9IGwpO319ZnVuY3Rpb24gVmIoYSkge3ZhciBiID0gYSxjID0gYTtpZiAoYS5hbHRlcm5hdGUpIGZvciAoOyBiLnJldHVybjspIGIgPSBiLnJldHVybjtlbHNlIHthID0gYjtkbyBiID0gYSwgMCAhPT0gKGIuZmxhZ3MgJiA0MDk4KSAmJiAoYyA9IGIucmV0dXJuKSwgYSA9IGIucmV0dXJuOyB3aGlsZSAoYSk7fXJldHVybiAzID09PSBiLnRhZyA/IGMgOiBudWxsO31mdW5jdGlvbiBXYihhKSB7aWYgKDEzID09PSBhLnRhZykge3ZhciBiID0gYS5tZW1vaXplZFN0YXRlO251bGwgPT09IGIgJiYgKGEgPSBhLmFsdGVybmF0ZSwgbnVsbCAhPT0gYSAmJiAoYiA9IGEubWVtb2l6ZWRTdGF0ZSkpO2lmIChudWxsICE9PSBiKSByZXR1cm4gYi5kZWh5ZHJhdGVkO31yZXR1cm4gbnVsbDt9ZnVuY3Rpb24gWGIoYSkge2lmIChWYihhKSAhPT0gYSkgdGhyb3cgRXJyb3IocCgxODgpKTt9CiAgICAgICAgICBmdW5jdGlvbiBZYihhKSB7dmFyIGIgPSBhLmFsdGVybmF0ZTtpZiAoIWIpIHtiID0gVmIoYSk7aWYgKG51bGwgPT09IGIpIHRocm93IEVycm9yKHAoMTg4KSk7cmV0dXJuIGIgIT09IGEgPyBudWxsIDogYTt9Zm9yICh2YXIgYyA9IGEsIGQgPSBiOzspIHt2YXIgZSA9IGMucmV0dXJuO2lmIChudWxsID09PSBlKSBicmVhazt2YXIgZiA9IGUuYWx0ZXJuYXRlO2lmIChudWxsID09PSBmKSB7ZCA9IGUucmV0dXJuO2lmIChudWxsICE9PSBkKSB7YyA9IGQ7Y29udGludWU7fWJyZWFrO31pZiAoZS5jaGlsZCA9PT0gZi5jaGlsZCkge2ZvciAoZiA9IGUuY2hpbGQ7IGY7KSB7aWYgKGYgPT09IGMpIHJldHVybiBYYihlKSwgYTtpZiAoZiA9PT0gZCkgcmV0dXJuIFhiKGUpLCBiO2YgPSBmLnNpYmxpbmc7fXRocm93IEVycm9yKHAoMTg4KSk7fWlmIChjLnJldHVybiAhPT0gZC5yZXR1cm4pIGMgPSBlLCBkID0gZjtlbHNlIHtmb3IgKHZhciBnID0gITEsIGggPSBlLmNoaWxkOyBoOykge2lmIChoID09PSBjKSB7ZyA9ICEwO2MgPSBlO2QgPSBmO2JyZWFrO31pZiAoaCA9PT0gZCkge2cgPSAhMDtkID0gZTtjID0gZjticmVhazt9aCA9IGguc2libGluZzt9aWYgKCFnKSB7Zm9yIChoID0gZi5jaGlsZDsgaDspIHtpZiAoaCA9PT0KICAgICAgICAgICAgICAgICAgICBjKSB7ZyA9ICEwO2MgPSBmO2QgPSBlO2JyZWFrO31pZiAoaCA9PT0gZCkge2cgPSAhMDtkID0gZjtjID0gZTticmVhazt9aCA9IGguc2libGluZzt9aWYgKCFnKSB0aHJvdyBFcnJvcihwKDE4OSkpO319aWYgKGMuYWx0ZXJuYXRlICE9PSBkKSB0aHJvdyBFcnJvcihwKDE5MCkpO31pZiAoMyAhPT0gYy50YWcpIHRocm93IEVycm9yKHAoMTg4KSk7cmV0dXJuIGMuc3RhdGVOb2RlLmN1cnJlbnQgPT09IGMgPyBhIDogYjt9ZnVuY3Rpb24gWmIoYSkge2EgPSBZYihhKTtyZXR1cm4gbnVsbCAhPT0gYSA/ICRiKGEpIDogbnVsbDt9ZnVuY3Rpb24gJGIoYSkge2lmICg1ID09PSBhLnRhZyB8fCA2ID09PSBhLnRhZykgcmV0dXJuIGE7Zm9yIChhID0gYS5jaGlsZDsgbnVsbCAhPT0gYTspIHt2YXIgYiA9ICRiKGEpO2lmIChudWxsICE9PSBiKSByZXR1cm4gYjthID0gYS5zaWJsaW5nO31yZXR1cm4gbnVsbDt9CiAgICAgICAgICB2YXIgYWMgPSBjYS51bnN0YWJsZV9zY2hlZHVsZUNhbGxiYWNrLGJjID0gY2EudW5zdGFibGVfY2FuY2VsQ2FsbGJhY2ssY2MgPSBjYS51bnN0YWJsZV9zaG91bGRZaWVsZCxkYyA9IGNhLnVuc3RhYmxlX3JlcXVlc3RQYWludCxCID0gY2EudW5zdGFibGVfbm93LGVjID0gY2EudW5zdGFibGVfZ2V0Q3VycmVudFByaW9yaXR5TGV2ZWwsZmMgPSBjYS51bnN0YWJsZV9JbW1lZGlhdGVQcmlvcml0eSxnYyA9IGNhLnVuc3RhYmxlX1VzZXJCbG9ja2luZ1ByaW9yaXR5LGhjID0gY2EudW5zdGFibGVfTm9ybWFsUHJpb3JpdHksaWMgPSBjYS51bnN0YWJsZV9Mb3dQcmlvcml0eSxqYyA9IGNhLnVuc3RhYmxlX0lkbGVQcmlvcml0eSxrYyA9IG51bGwsbGMgPSBudWxsO2Z1bmN0aW9uIG1jKGEpIHtpZiAobGMgJiYgImZ1bmN0aW9uIiA9PT0gdHlwZW9mIGxjLm9uQ29tbWl0RmliZXJSb290KSB0cnkge2xjLm9uQ29tbWl0RmliZXJSb290KGtjLCBhLCB2b2lkIDAsIDEyOCA9PT0gKGEuY3VycmVudC5mbGFncyAmIDEyOCkpO30gY2F0Y2ggKGIpIHt9fQogICAgICAgICAgdmFyIG9jID0gTWF0aC5jbHozMiA/IE1hdGguY2x6MzIgOiBuYyxwYyA9IE1hdGgubG9nLHFjID0gTWF0aC5MTjI7ZnVuY3Rpb24gbmMoYSkge2EgPj4+PSAwO3JldHVybiAwID09PSBhID8gMzIgOiAzMSAtIChwYyhhKSAvIHFjIHwgMCkgfCAwO312YXIgcmMgPSA2NCxzYyA9IDQxOTQzMDQ7CiAgICAgICAgICBmdW5jdGlvbiB0YyhhKSB7c3dpdGNoIChhICYgLWEpIHtjYXNlIDE6cmV0dXJuIDE7Y2FzZSAyOnJldHVybiAyO2Nhc2UgNDpyZXR1cm4gNDtjYXNlIDg6cmV0dXJuIDg7Y2FzZSAxNjpyZXR1cm4gMTY7Y2FzZSAzMjpyZXR1cm4gMzI7Y2FzZSA2NDpjYXNlIDEyODpjYXNlIDI1NjpjYXNlIDUxMjpjYXNlIDEwMjQ6Y2FzZSAyMDQ4OmNhc2UgNDA5NjpjYXNlIDgxOTI6Y2FzZSAxNjM4NDpjYXNlIDMyNzY4OmNhc2UgNjU1MzY6Y2FzZSAxMzEwNzI6Y2FzZSAyNjIxNDQ6Y2FzZSA1MjQyODg6Y2FzZSAxMDQ4NTc2OmNhc2UgMjA5NzE1MjpyZXR1cm4gYSAmIDQxOTQyNDA7Y2FzZSA0MTk0MzA0OmNhc2UgODM4ODYwODpjYXNlIDE2Nzc3MjE2OmNhc2UgMzM1NTQ0MzI6Y2FzZSA2NzEwODg2NDpyZXR1cm4gYSAmIDEzMDAyMzQyNDtjYXNlIDEzNDIxNzcyODpyZXR1cm4gMTM0MjE3NzI4O2Nhc2UgMjY4NDM1NDU2OnJldHVybiAyNjg0MzU0NTY7Y2FzZSA1MzY4NzA5MTI6cmV0dXJuIDUzNjg3MDkxMjtjYXNlIDEwNzM3NDE4MjQ6cmV0dXJuIDEwNzM3NDE4MjQ7CiAgICAgICAgICAgICAgZGVmYXVsdDpyZXR1cm4gYTt9fWZ1bmN0aW9uIHVjKGEsIGIpIHt2YXIgYyA9IGEucGVuZGluZ0xhbmVzO2lmICgwID09PSBjKSByZXR1cm4gMDt2YXIgZCA9IDAsZSA9IGEuc3VzcGVuZGVkTGFuZXMsZiA9IGEucGluZ2VkTGFuZXMsZyA9IGMgJiAyNjg0MzU0NTU7aWYgKDAgIT09IGcpIHt2YXIgaCA9IGcgJiB+ZTswICE9PSBoID8gZCA9IHRjKGgpIDogKGYgJj0gZywgMCAhPT0gZiAmJiAoZCA9IHRjKGYpKSk7fSBlbHNlIGcgPSBjICYgfmUsIDAgIT09IGcgPyBkID0gdGMoZykgOiAwICE9PSBmICYmIChkID0gdGMoZikpO2lmICgwID09PSBkKSByZXR1cm4gMDtpZiAoMCAhPT0gYiAmJiBiICE9PSBkICYmIDAgPT09IChiICYgZSkgJiYgKGUgPSBkICYgLWQsIGYgPSBiICYgLWIsIGUgPj0gZiB8fCAxNiA9PT0gZSAmJiAwICE9PSAoZiAmIDQxOTQyNDApKSkgcmV0dXJuIGI7MCAhPT0gKGQgJiA0KSAmJiAoZCB8PSBjICYgMTYpO2IgPSBhLmVudGFuZ2xlZExhbmVzO2lmICgwICE9PSBiKSBmb3IgKGEgPSBhLmVudGFuZ2xlbWVudHMsIGIgJj0gZDsgMCA8IGI7KSBjID0gMzEgLSBvYyhiKSwgZSA9IDEgPDwgYywgZCB8PSBhW2NdLCBiICY9IH5lO3JldHVybiBkO30KICAgICAgICAgIGZ1bmN0aW9uIHZjKGEsIGIpIHtzd2l0Y2ggKGEpIHtjYXNlIDE6Y2FzZSAyOmNhc2UgNDpyZXR1cm4gYiArIDI1MDtjYXNlIDg6Y2FzZSAxNjpjYXNlIDMyOmNhc2UgNjQ6Y2FzZSAxMjg6Y2FzZSAyNTY6Y2FzZSA1MTI6Y2FzZSAxMDI0OmNhc2UgMjA0ODpjYXNlIDQwOTY6Y2FzZSA4MTkyOmNhc2UgMTYzODQ6Y2FzZSAzMjc2ODpjYXNlIDY1NTM2OmNhc2UgMTMxMDcyOmNhc2UgMjYyMTQ0OmNhc2UgNTI0Mjg4OmNhc2UgMTA0ODU3NjpjYXNlIDIwOTcxNTI6cmV0dXJuIGIgKyA1RTM7Y2FzZSA0MTk0MzA0OmNhc2UgODM4ODYwODpjYXNlIDE2Nzc3MjE2OmNhc2UgMzM1NTQ0MzI6Y2FzZSA2NzEwODg2NDpyZXR1cm4gLTE7Y2FzZSAxMzQyMTc3Mjg6Y2FzZSAyNjg0MzU0NTY6Y2FzZSA1MzY4NzA5MTI6Y2FzZSAxMDczNzQxODI0OnJldHVybiAtMTtkZWZhdWx0OnJldHVybiAtMTt9fQogICAgICAgICAgZnVuY3Rpb24gd2MoYSwgYikge2ZvciAodmFyIGMgPSBhLnN1c3BlbmRlZExhbmVzLCBkID0gYS5waW5nZWRMYW5lcywgZSA9IGEuZXhwaXJhdGlvblRpbWVzLCBmID0gYS5wZW5kaW5nTGFuZXM7IDAgPCBmOykge3ZhciBnID0gMzEgLSBvYyhmKSxoID0gMSA8PCBnLGsgPSBlW2ddO2lmICgtMSA9PT0gaykge2lmICgwID09PSAoaCAmIGMpIHx8IDAgIT09IChoICYgZCkpIGVbZ10gPSB2YyhoLCBiKTt9IGVsc2UgayA8PSBiICYmIChhLmV4cGlyZWRMYW5lcyB8PSBoKTtmICY9IH5oO319ZnVuY3Rpb24geGMoYSkge2EgPSBhLnBlbmRpbmdMYW5lcyAmIC0xMDczNzQxODI1O3JldHVybiAwICE9PSBhID8gYSA6IGEgJiAxMDczNzQxODI0ID8gMTA3Mzc0MTgyNCA6IDA7fWZ1bmN0aW9uIHljKCkge3ZhciBhID0gcmM7cmMgPDw9IDE7MCA9PT0gKHJjICYgNDE5NDI0MCkgJiYgKHJjID0gNjQpO3JldHVybiBhO31mdW5jdGlvbiB6YyhhKSB7Zm9yICh2YXIgYiA9IFtdLCBjID0gMDsgMzEgPiBjOyBjKyspIGIucHVzaChhKTtyZXR1cm4gYjt9CiAgICAgICAgICBmdW5jdGlvbiBBYyhhLCBiLCBjKSB7YS5wZW5kaW5nTGFuZXMgfD0gYjs1MzY4NzA5MTIgIT09IGIgJiYgKGEuc3VzcGVuZGVkTGFuZXMgPSAwLCBhLnBpbmdlZExhbmVzID0gMCk7YSA9IGEuZXZlbnRUaW1lcztiID0gMzEgLSBvYyhiKTthW2JdID0gYzt9ZnVuY3Rpb24gQmMoYSwgYikge3ZhciBjID0gYS5wZW5kaW5nTGFuZXMgJiB+YjthLnBlbmRpbmdMYW5lcyA9IGI7YS5zdXNwZW5kZWRMYW5lcyA9IDA7YS5waW5nZWRMYW5lcyA9IDA7YS5leHBpcmVkTGFuZXMgJj0gYjthLm11dGFibGVSZWFkTGFuZXMgJj0gYjthLmVudGFuZ2xlZExhbmVzICY9IGI7YiA9IGEuZW50YW5nbGVtZW50czt2YXIgZCA9IGEuZXZlbnRUaW1lcztmb3IgKGEgPSBhLmV4cGlyYXRpb25UaW1lczsgMCA8IGM7KSB7dmFyIGUgPSAzMSAtIG9jKGMpLGYgPSAxIDw8IGU7YltlXSA9IDA7ZFtlXSA9IC0xO2FbZV0gPSAtMTtjICY9IH5mO319CiAgICAgICAgICBmdW5jdGlvbiBDYyhhLCBiKSB7dmFyIGMgPSBhLmVudGFuZ2xlZExhbmVzIHw9IGI7Zm9yIChhID0gYS5lbnRhbmdsZW1lbnRzOyBjOykge3ZhciBkID0gMzEgLSBvYyhjKSxlID0gMSA8PCBkO2UgJiBiIHwgYVtkXSAmIGIgJiYgKGFbZF0gfD0gYik7YyAmPSB+ZTt9fXZhciBDID0gMDtmdW5jdGlvbiBEYyhhKSB7YSAmPSAtYTtyZXR1cm4gMSA8IGEgPyA0IDwgYSA/IDAgIT09IChhICYgMjY4NDM1NDU1KSA/IDE2IDogNTM2ODcwOTEyIDogNCA6IDE7fXZhciBFYyxGYyxHYyxIYyxJYyxKYyA9ICExLEtjID0gW10sTGMgPSBudWxsLE1jID0gbnVsbCxOYyA9IG51bGwsT2MgPSBuZXcgTWFwKCksUGMgPSBuZXcgTWFwKCksUWMgPSBbXSxSYyA9ICJtb3VzZWRvd24gbW91c2V1cCB0b3VjaGNhbmNlbCB0b3VjaGVuZCB0b3VjaHN0YXJ0IGF1eGNsaWNrIGRibGNsaWNrIHBvaW50ZXJjYW5jZWwgcG9pbnRlcmRvd24gcG9pbnRlcnVwIGRyYWdlbmQgZHJhZ3N0YXJ0IGRyb3AgY29tcG9zaXRpb25lbmQgY29tcG9zaXRpb25zdGFydCBrZXlkb3duIGtleXByZXNzIGtleXVwIGlucHV0IHRleHRJbnB1dCBjb3B5IGN1dCBwYXN0ZSBjbGljayBjaGFuZ2UgY29udGV4dG1lbnUgcmVzZXQgc3VibWl0Ii5zcGxpdCgiICIpOwogICAgICAgICAgZnVuY3Rpb24gU2MoYSwgYikge3N3aXRjaCAoYSkge2Nhc2UgImZvY3VzaW4iOmNhc2UgImZvY3Vzb3V0IjpMYyA9IG51bGw7YnJlYWs7Y2FzZSAiZHJhZ2VudGVyIjpjYXNlICJkcmFnbGVhdmUiOk1jID0gbnVsbDticmVhaztjYXNlICJtb3VzZW92ZXIiOmNhc2UgIm1vdXNlb3V0IjpOYyA9IG51bGw7YnJlYWs7Y2FzZSAicG9pbnRlcm92ZXIiOmNhc2UgInBvaW50ZXJvdXQiOk9jLmRlbGV0ZShiLnBvaW50ZXJJZCk7YnJlYWs7Y2FzZSAiZ290cG9pbnRlcmNhcHR1cmUiOmNhc2UgImxvc3Rwb2ludGVyY2FwdHVyZSI6UGMuZGVsZXRlKGIucG9pbnRlcklkKTt9fQogICAgICAgICAgZnVuY3Rpb24gVGMoYSwgYiwgYywgZCwgZSwgZikge2lmIChudWxsID09PSBhIHx8IGEubmF0aXZlRXZlbnQgIT09IGYpIHJldHVybiBhID0geyBibG9ja2VkT246IGIsIGRvbUV2ZW50TmFtZTogYywgZXZlbnRTeXN0ZW1GbGFnczogZCwgbmF0aXZlRXZlbnQ6IGYsIHRhcmdldENvbnRhaW5lcnM6IFtlXSB9LCBudWxsICE9PSBiICYmIChiID0gQ2IoYiksIG51bGwgIT09IGIgJiYgRmMoYikpLCBhO2EuZXZlbnRTeXN0ZW1GbGFncyB8PSBkO2IgPSBhLnRhcmdldENvbnRhaW5lcnM7bnVsbCAhPT0gZSAmJiAtMSA9PT0gYi5pbmRleE9mKGUpICYmIGIucHVzaChlKTtyZXR1cm4gYTt9CiAgICAgICAgICBmdW5jdGlvbiBVYyhhLCBiLCBjLCBkLCBlKSB7c3dpdGNoIChiKSB7Y2FzZSAiZm9jdXNpbiI6cmV0dXJuIExjID0gVGMoTGMsIGEsIGIsIGMsIGQsIGUpLCAhMDtjYXNlICJkcmFnZW50ZXIiOnJldHVybiBNYyA9IFRjKE1jLCBhLCBiLCBjLCBkLCBlKSwgITA7Y2FzZSAibW91c2VvdmVyIjpyZXR1cm4gTmMgPSBUYyhOYywgYSwgYiwgYywgZCwgZSksICEwO2Nhc2UgInBvaW50ZXJvdmVyIjp2YXIgZiA9IGUucG9pbnRlcklkO09jLnNldChmLCBUYyhPYy5nZXQoZikgfHwgbnVsbCwgYSwgYiwgYywgZCwgZSkpO3JldHVybiAhMDtjYXNlICJnb3Rwb2ludGVyY2FwdHVyZSI6cmV0dXJuIGYgPSBlLnBvaW50ZXJJZCwgUGMuc2V0KGYsIFRjKFBjLmdldChmKSB8fCBudWxsLCBhLCBiLCBjLCBkLCBlKSksICEwO31yZXR1cm4gITE7fQogICAgICAgICAgZnVuY3Rpb24gVmMoYSkge3ZhciBiID0gV2MoYS50YXJnZXQpO2lmIChudWxsICE9PSBiKSB7dmFyIGMgPSBWYihiKTtpZiAobnVsbCAhPT0gYykgaWYgKGIgPSBjLnRhZywgMTMgPT09IGIpIHtpZiAoYiA9IFdiKGMpLCBudWxsICE9PSBiKSB7YS5ibG9ja2VkT24gPSBiO0ljKGEucHJpb3JpdHksIGZ1bmN0aW9uICgpIHtHYyhjKTt9KTtyZXR1cm47fX0gZWxzZSBpZiAoMyA9PT0gYiAmJiBjLnN0YXRlTm9kZS5jdXJyZW50Lm1lbW9pemVkU3RhdGUuaXNEZWh5ZHJhdGVkKSB7YS5ibG9ja2VkT24gPSAzID09PSBjLnRhZyA/IGMuc3RhdGVOb2RlLmNvbnRhaW5lckluZm8gOiBudWxsO3JldHVybjt9fWEuYmxvY2tlZE9uID0gbnVsbDt9CiAgICAgICAgICBmdW5jdGlvbiBYYyhhKSB7aWYgKG51bGwgIT09IGEuYmxvY2tlZE9uKSByZXR1cm4gITE7Zm9yICh2YXIgYiA9IGEudGFyZ2V0Q29udGFpbmVyczsgMCA8IGIubGVuZ3RoOykge3ZhciBjID0gWWMoYS5kb21FdmVudE5hbWUsIGEuZXZlbnRTeXN0ZW1GbGFncywgYlswXSwgYS5uYXRpdmVFdmVudCk7aWYgKG51bGwgPT09IGMpIHtjID0gYS5uYXRpdmVFdmVudDt2YXIgZCA9IG5ldyBjLmNvbnN0cnVjdG9yKGMudHlwZSwgYyk7d2IgPSBkO2MudGFyZ2V0LmRpc3BhdGNoRXZlbnQoZCk7d2IgPSBudWxsO30gZWxzZSByZXR1cm4gYiA9IENiKGMpLCBudWxsICE9PSBiICYmIEZjKGIpLCBhLmJsb2NrZWRPbiA9IGMsICExO2Iuc2hpZnQoKTt9cmV0dXJuICEwO31mdW5jdGlvbiBaYyhhLCBiLCBjKSB7WGMoYSkgJiYgYy5kZWxldGUoYik7fWZ1bmN0aW9uICRjKCkge0pjID0gITE7bnVsbCAhPT0gTGMgJiYgWGMoTGMpICYmIChMYyA9IG51bGwpO251bGwgIT09IE1jICYmIFhjKE1jKSAmJiAoTWMgPSBudWxsKTtudWxsICE9PSBOYyAmJiBYYyhOYykgJiYgKE5jID0gbnVsbCk7T2MuZm9yRWFjaChaYyk7UGMuZm9yRWFjaChaYyk7fQogICAgICAgICAgZnVuY3Rpb24gYWQoYSwgYikge2EuYmxvY2tlZE9uID09PSBiICYmIChhLmJsb2NrZWRPbiA9IG51bGwsIEpjIHx8IChKYyA9ICEwLCBjYS51bnN0YWJsZV9zY2hlZHVsZUNhbGxiYWNrKGNhLnVuc3RhYmxlX05vcm1hbFByaW9yaXR5LCAkYykpKTt9CiAgICAgICAgICBmdW5jdGlvbiBiZChhKSB7ZnVuY3Rpb24gYihiKSB7cmV0dXJuIGFkKGIsIGEpO31pZiAoMCA8IEtjLmxlbmd0aCkge2FkKEtjWzBdLCBhKTtmb3IgKHZhciBjID0gMTsgYyA8IEtjLmxlbmd0aDsgYysrKSB7dmFyIGQgPSBLY1tjXTtkLmJsb2NrZWRPbiA9PT0gYSAmJiAoZC5ibG9ja2VkT24gPSBudWxsKTt9fW51bGwgIT09IExjICYmIGFkKExjLCBhKTtudWxsICE9PSBNYyAmJiBhZChNYywgYSk7bnVsbCAhPT0gTmMgJiYgYWQoTmMsIGEpO09jLmZvckVhY2goYik7UGMuZm9yRWFjaChiKTtmb3IgKGMgPSAwOyBjIDwgUWMubGVuZ3RoOyBjKyspIGQgPSBRY1tjXSwgZC5ibG9ja2VkT24gPT09IGEgJiYgKGQuYmxvY2tlZE9uID0gbnVsbCk7Zm9yICg7IDAgPCBRYy5sZW5ndGggJiYgKGMgPSBRY1swXSwgbnVsbCA9PT0gYy5ibG9ja2VkT24pOykgVmMoYyksIG51bGwgPT09IGMuYmxvY2tlZE9uICYmIFFjLnNoaWZ0KCk7fXZhciBjZCA9IHVhLlJlYWN0Q3VycmVudEJhdGNoQ29uZmlnLGRkID0gITA7CiAgICAgICAgICBmdW5jdGlvbiBlZChhLCBiLCBjLCBkKSB7dmFyIGUgPSBDLGYgPSBjZC50cmFuc2l0aW9uO2NkLnRyYW5zaXRpb24gPSBudWxsO3RyeSB7QyA9IDEsIGZkKGEsIGIsIGMsIGQpO30gZmluYWxseSB7QyA9IGUsIGNkLnRyYW5zaXRpb24gPSBmO319ZnVuY3Rpb24gZ2QoYSwgYiwgYywgZCkge3ZhciBlID0gQyxmID0gY2QudHJhbnNpdGlvbjtjZC50cmFuc2l0aW9uID0gbnVsbDt0cnkge0MgPSA0LCBmZChhLCBiLCBjLCBkKTt9IGZpbmFsbHkge0MgPSBlLCBjZC50cmFuc2l0aW9uID0gZjt9fQogICAgICAgICAgZnVuY3Rpb24gZmQoYSwgYiwgYywgZCkge2lmIChkZCkge3ZhciBlID0gWWMoYSwgYiwgYywgZCk7aWYgKG51bGwgPT09IGUpIGhkKGEsIGIsIGQsIGlkLCBjKSwgU2MoYSwgZCk7ZWxzZSBpZiAoVWMoZSwgYSwgYiwgYywgZCkpIGQuc3RvcFByb3BhZ2F0aW9uKCk7ZWxzZSBpZiAoU2MoYSwgZCksIGIgJiA0ICYmIC0xIDwgUmMuaW5kZXhPZihhKSkge2ZvciAoOyBudWxsICE9PSBlOykge3ZhciBmID0gQ2IoZSk7bnVsbCAhPT0gZiAmJiBFYyhmKTtmID0gWWMoYSwgYiwgYywgZCk7bnVsbCA9PT0gZiAmJiBoZChhLCBiLCBkLCBpZCwgYyk7aWYgKGYgPT09IGUpIGJyZWFrO2UgPSBmO31udWxsICE9PSBlICYmIGQuc3RvcFByb3BhZ2F0aW9uKCk7fSBlbHNlIGhkKGEsIGIsIGQsIG51bGwsIGMpO319dmFyIGlkID0gbnVsbDsKICAgICAgICAgIGZ1bmN0aW9uIFljKGEsIGIsIGMsIGQpIHtpZCA9IG51bGw7YSA9IHhiKGQpO2EgPSBXYyhhKTtpZiAobnVsbCAhPT0gYSkgaWYgKGIgPSBWYihhKSwgbnVsbCA9PT0gYikgYSA9IG51bGw7ZWxzZSBpZiAoYyA9IGIudGFnLCAxMyA9PT0gYykge2EgPSBXYihiKTtpZiAobnVsbCAhPT0gYSkgcmV0dXJuIGE7YSA9IG51bGw7fSBlbHNlIGlmICgzID09PSBjKSB7aWYgKGIuc3RhdGVOb2RlLmN1cnJlbnQubWVtb2l6ZWRTdGF0ZS5pc0RlaHlkcmF0ZWQpIHJldHVybiAzID09PSBiLnRhZyA/IGIuc3RhdGVOb2RlLmNvbnRhaW5lckluZm8gOiBudWxsO2EgPSBudWxsO30gZWxzZSBiICE9PSBhICYmIChhID0gbnVsbCk7aWQgPSBhO3JldHVybiBudWxsO30KICAgICAgICAgIGZ1bmN0aW9uIGpkKGEpIHtzd2l0Y2ggKGEpIHtjYXNlICJjYW5jZWwiOmNhc2UgImNsaWNrIjpjYXNlICJjbG9zZSI6Y2FzZSAiY29udGV4dG1lbnUiOmNhc2UgImNvcHkiOmNhc2UgImN1dCI6Y2FzZSAiYXV4Y2xpY2siOmNhc2UgImRibGNsaWNrIjpjYXNlICJkcmFnZW5kIjpjYXNlICJkcmFnc3RhcnQiOmNhc2UgImRyb3AiOmNhc2UgImZvY3VzaW4iOmNhc2UgImZvY3Vzb3V0IjpjYXNlICJpbnB1dCI6Y2FzZSAiaW52YWxpZCI6Y2FzZSAia2V5ZG93biI6Y2FzZSAia2V5cHJlc3MiOmNhc2UgImtleXVwIjpjYXNlICJtb3VzZWRvd24iOmNhc2UgIm1vdXNldXAiOmNhc2UgInBhc3RlIjpjYXNlICJwYXVzZSI6Y2FzZSAicGxheSI6Y2FzZSAicG9pbnRlcmNhbmNlbCI6Y2FzZSAicG9pbnRlcmRvd24iOmNhc2UgInBvaW50ZXJ1cCI6Y2FzZSAicmF0ZWNoYW5nZSI6Y2FzZSAicmVzZXQiOmNhc2UgInJlc2l6ZSI6Y2FzZSAic2Vla2VkIjpjYXNlICJzdWJtaXQiOmNhc2UgInRvdWNoY2FuY2VsIjpjYXNlICJ0b3VjaGVuZCI6Y2FzZSAidG91Y2hzdGFydCI6Y2FzZSAidm9sdW1lY2hhbmdlIjpjYXNlICJjaGFuZ2UiOmNhc2UgInNlbGVjdGlvbmNoYW5nZSI6Y2FzZSAidGV4dElucHV0IjpjYXNlICJjb21wb3NpdGlvbnN0YXJ0IjpjYXNlICJjb21wb3NpdGlvbmVuZCI6Y2FzZSAiY29tcG9zaXRpb251cGRhdGUiOmNhc2UgImJlZm9yZWJsdXIiOmNhc2UgImFmdGVyYmx1ciI6Y2FzZSAiYmVmb3JlaW5wdXQiOmNhc2UgImJsdXIiOmNhc2UgImZ1bGxzY3JlZW5jaGFuZ2UiOmNhc2UgImZvY3VzIjpjYXNlICJoYXNoY2hhbmdlIjpjYXNlICJwb3BzdGF0ZSI6Y2FzZSAic2VsZWN0IjpjYXNlICJzZWxlY3RzdGFydCI6cmV0dXJuIDE7Y2FzZSAiZHJhZyI6Y2FzZSAiZHJhZ2VudGVyIjpjYXNlICJkcmFnZXhpdCI6Y2FzZSAiZHJhZ2xlYXZlIjpjYXNlICJkcmFnb3ZlciI6Y2FzZSAibW91c2Vtb3ZlIjpjYXNlICJtb3VzZW91dCI6Y2FzZSAibW91c2VvdmVyIjpjYXNlICJwb2ludGVybW92ZSI6Y2FzZSAicG9pbnRlcm91dCI6Y2FzZSAicG9pbnRlcm92ZXIiOmNhc2UgInNjcm9sbCI6Y2FzZSAidG9nZ2xlIjpjYXNlICJ0b3VjaG1vdmUiOmNhc2UgIndoZWVsIjpjYXNlICJtb3VzZWVudGVyIjpjYXNlICJtb3VzZWxlYXZlIjpjYXNlICJwb2ludGVyZW50ZXIiOmNhc2UgInBvaW50ZXJsZWF2ZSI6cmV0dXJuIDQ7CiAgICAgICAgICAgICAgY2FzZSAibWVzc2FnZSI6c3dpdGNoIChlYygpKSB7Y2FzZSBmYzpyZXR1cm4gMTtjYXNlIGdjOnJldHVybiA0O2Nhc2UgaGM6Y2FzZSBpYzpyZXR1cm4gMTY7Y2FzZSBqYzpyZXR1cm4gNTM2ODcwOTEyO2RlZmF1bHQ6cmV0dXJuIDE2O31kZWZhdWx0OnJldHVybiAxNjt9fXZhciBrZCA9IG51bGwsbGQgPSBudWxsLG1kID0gbnVsbDtmdW5jdGlvbiBuZCgpIHtpZiAobWQpIHJldHVybiBtZDt2YXIgYSxiID0gbGQsYyA9IGIubGVuZ3RoLGQsZSA9ICJ2YWx1ZSIgaW4ga2QgPyBrZC52YWx1ZSA6IGtkLnRleHRDb250ZW50LGYgPSBlLmxlbmd0aDtmb3IgKGEgPSAwOyBhIDwgYyAmJiBiW2FdID09PSBlW2FdOyBhKyspO3ZhciBnID0gYyAtIGE7Zm9yIChkID0gMTsgZCA8PSBnICYmIGJbYyAtIGRdID09PSBlW2YgLSBkXTsgZCsrKTtyZXR1cm4gbWQgPSBlLnNsaWNlKGEsIDEgPCBkID8gMSAtIGQgOiB2b2lkIDApO30KICAgICAgICAgIGZ1bmN0aW9uIG9kKGEpIHt2YXIgYiA9IGEua2V5Q29kZTsiY2hhckNvZGUiIGluIGEgPyAoYSA9IGEuY2hhckNvZGUsIDAgPT09IGEgJiYgMTMgPT09IGIgJiYgKGEgPSAxMykpIDogYSA9IGI7MTAgPT09IGEgJiYgKGEgPSAxMyk7cmV0dXJuIDMyIDw9IGEgfHwgMTMgPT09IGEgPyBhIDogMDt9ZnVuY3Rpb24gcGQoKSB7cmV0dXJuICEwO31mdW5jdGlvbiBxZCgpIHtyZXR1cm4gITE7fQogICAgICAgICAgZnVuY3Rpb24gcmQoYSkge2Z1bmN0aW9uIGIoYiwgZCwgZSwgZiwgZykge3RoaXMuX3JlYWN0TmFtZSA9IGI7dGhpcy5fdGFyZ2V0SW5zdCA9IGU7dGhpcy50eXBlID0gZDt0aGlzLm5hdGl2ZUV2ZW50ID0gZjt0aGlzLnRhcmdldCA9IGc7dGhpcy5jdXJyZW50VGFyZ2V0ID0gbnVsbDtmb3IgKHZhciBjIGluIGEpIGEuaGFzT3duUHJvcGVydHkoYykgJiYgKGIgPSBhW2NdLCB0aGlzW2NdID0gYiA/IGIoZikgOiBmW2NdKTt0aGlzLmlzRGVmYXVsdFByZXZlbnRlZCA9IChudWxsICE9IGYuZGVmYXVsdFByZXZlbnRlZCA/IGYuZGVmYXVsdFByZXZlbnRlZCA6ICExID09PSBmLnJldHVyblZhbHVlKSA/IHBkIDogcWQ7dGhpcy5pc1Byb3BhZ2F0aW9uU3RvcHBlZCA9IHFkO3JldHVybiB0aGlzO31BKGIucHJvdG90eXBlLCB7IHByZXZlbnREZWZhdWx0OiBmdW5jdGlvbiBwcmV2ZW50RGVmYXVsdCgpIHt0aGlzLmRlZmF1bHRQcmV2ZW50ZWQgPSAhMDt2YXIgYSA9IHRoaXMubmF0aXZlRXZlbnQ7YSAmJiAoYS5wcmV2ZW50RGVmYXVsdCA/IGEucHJldmVudERlZmF1bHQoKSA6ICJ1bmtub3duIiAhPT0gdHlwZW9mIGEucmV0dXJuVmFsdWUgJiYgKAogICAgICAgICAgICAgICAgYS5yZXR1cm5WYWx1ZSA9ICExKSwgdGhpcy5pc0RlZmF1bHRQcmV2ZW50ZWQgPSBwZCk7fSwgc3RvcFByb3BhZ2F0aW9uOiBmdW5jdGlvbiBzdG9wUHJvcGFnYXRpb24oKSB7dmFyIGEgPSB0aGlzLm5hdGl2ZUV2ZW50O2EgJiYgKGEuc3RvcFByb3BhZ2F0aW9uID8gYS5zdG9wUHJvcGFnYXRpb24oKSA6ICJ1bmtub3duIiAhPT0gdHlwZW9mIGEuY2FuY2VsQnViYmxlICYmIChhLmNhbmNlbEJ1YmJsZSA9ICEwKSwgdGhpcy5pc1Byb3BhZ2F0aW9uU3RvcHBlZCA9IHBkKTt9LCBwZXJzaXN0OiBmdW5jdGlvbiBwZXJzaXN0KCkge30sIGlzUGVyc2lzdGVudDogcGQgfSk7cmV0dXJuIGI7fQogICAgICAgICAgdmFyIHNkID0geyBldmVudFBoYXNlOiAwLCBidWJibGVzOiAwLCBjYW5jZWxhYmxlOiAwLCB0aW1lU3RhbXA6IGZ1bmN0aW9uIHRpbWVTdGFtcChhKSB7cmV0dXJuIGEudGltZVN0YW1wIHx8IERhdGUubm93KCk7fSwgZGVmYXVsdFByZXZlbnRlZDogMCwgaXNUcnVzdGVkOiAwIH0sdGQgPSByZChzZCksdWQgPSBBKHt9LCBzZCwgeyB2aWV3OiAwLCBkZXRhaWw6IDAgfSksdmQgPSByZCh1ZCksd2QseGQseWQsQWQgPSBBKHt9LCB1ZCwgeyBzY3JlZW5YOiAwLCBzY3JlZW5ZOiAwLCBjbGllbnRYOiAwLCBjbGllbnRZOiAwLCBwYWdlWDogMCwgcGFnZVk6IDAsIGN0cmxLZXk6IDAsIHNoaWZ0S2V5OiAwLCBhbHRLZXk6IDAsIG1ldGFLZXk6IDAsIGdldE1vZGlmaWVyU3RhdGU6IHpkLCBidXR0b246IDAsIGJ1dHRvbnM6IDAsIHJlbGF0ZWRUYXJnZXQ6IGZ1bmN0aW9uIHJlbGF0ZWRUYXJnZXQoYSkge3JldHVybiB2b2lkIDAgPT09IGEucmVsYXRlZFRhcmdldCA/IGEuZnJvbUVsZW1lbnQgPT09IGEuc3JjRWxlbWVudCA/IGEudG9FbGVtZW50IDogYS5mcm9tRWxlbWVudCA6IGEucmVsYXRlZFRhcmdldDt9LCBtb3ZlbWVudFg6IGZ1bmN0aW9uIG1vdmVtZW50WChhKSB7aWYgKCJtb3ZlbWVudFgiIGluCiAgICAgICAgICAgICAgICBhKSByZXR1cm4gYS5tb3ZlbWVudFg7YSAhPT0geWQgJiYgKHlkICYmICJtb3VzZW1vdmUiID09PSBhLnR5cGUgPyAod2QgPSBhLnNjcmVlblggLSB5ZC5zY3JlZW5YLCB4ZCA9IGEuc2NyZWVuWSAtIHlkLnNjcmVlblkpIDogeGQgPSB3ZCA9IDAsIHlkID0gYSk7cmV0dXJuIHdkO30sIG1vdmVtZW50WTogZnVuY3Rpb24gbW92ZW1lbnRZKGEpIHtyZXR1cm4gIm1vdmVtZW50WSIgaW4gYSA/IGEubW92ZW1lbnRZIDogeGQ7fSB9KSxCZCA9IHJkKEFkKSxDZCA9IEEoe30sIEFkLCB7IGRhdGFUcmFuc2ZlcjogMCB9KSxEZCA9IHJkKENkKSxFZCA9IEEoe30sIHVkLCB7IHJlbGF0ZWRUYXJnZXQ6IDAgfSksRmQgPSByZChFZCksR2QgPSBBKHt9LCBzZCwgeyBhbmltYXRpb25OYW1lOiAwLCBlbGFwc2VkVGltZTogMCwgcHNldWRvRWxlbWVudDogMCB9KSxIZCA9IHJkKEdkKSxJZCA9IEEoe30sIHNkLCB7IGNsaXBib2FyZERhdGE6IGZ1bmN0aW9uIGNsaXBib2FyZERhdGEoYSkge3JldHVybiAiY2xpcGJvYXJkRGF0YSIgaW4gYSA/IGEuY2xpcGJvYXJkRGF0YSA6IHdpbmRvdy5jbGlwYm9hcmREYXRhO30gfSksSmQgPSByZChJZCksS2QgPSBBKHt9LCBzZCwgeyBkYXRhOiAwIH0pLExkID0gcmQoS2QpLE1kID0geyBFc2M6ICJFc2NhcGUiLAogICAgICAgICAgICAgIFNwYWNlYmFyOiAiICIsIExlZnQ6ICJBcnJvd0xlZnQiLCBVcDogIkFycm93VXAiLCBSaWdodDogIkFycm93UmlnaHQiLCBEb3duOiAiQXJyb3dEb3duIiwgRGVsOiAiRGVsZXRlIiwgV2luOiAiT1MiLCBNZW51OiAiQ29udGV4dE1lbnUiLCBBcHBzOiAiQ29udGV4dE1lbnUiLCBTY3JvbGw6ICJTY3JvbGxMb2NrIiwgTW96UHJpbnRhYmxlS2V5OiAiVW5pZGVudGlmaWVkIiB9LE5kID0geyA4OiAiQmFja3NwYWNlIiwgOTogIlRhYiIsIDEyOiAiQ2xlYXIiLCAxMzogIkVudGVyIiwgMTY6ICJTaGlmdCIsIDE3OiAiQ29udHJvbCIsIDE4OiAiQWx0IiwgMTk6ICJQYXVzZSIsIDIwOiAiQ2Fwc0xvY2siLCAyNzogIkVzY2FwZSIsIDMyOiAiICIsIDMzOiAiUGFnZVVwIiwgMzQ6ICJQYWdlRG93biIsIDM1OiAiRW5kIiwgMzY6ICJIb21lIiwgMzc6ICJBcnJvd0xlZnQiLCAzODogIkFycm93VXAiLCAzOTogIkFycm93UmlnaHQiLCA0MDogIkFycm93RG93biIsIDQ1OiAiSW5zZXJ0IiwgNDY6ICJEZWxldGUiLCAxMTI6ICJGMSIsIDExMzogIkYyIiwgMTE0OiAiRjMiLCAxMTU6ICJGNCIsIDExNjogIkY1IiwgMTE3OiAiRjYiLCAxMTg6ICJGNyIsCiAgICAgICAgICAgICAgMTE5OiAiRjgiLCAxMjA6ICJGOSIsIDEyMTogIkYxMCIsIDEyMjogIkYxMSIsIDEyMzogIkYxMiIsIDE0NDogIk51bUxvY2siLCAxNDU6ICJTY3JvbGxMb2NrIiwgMjI0OiAiTWV0YSIgfSxPZCA9IHsgQWx0OiAiYWx0S2V5IiwgQ29udHJvbDogImN0cmxLZXkiLCBNZXRhOiAibWV0YUtleSIsIFNoaWZ0OiAic2hpZnRLZXkiIH07ZnVuY3Rpb24gUGQoYSkge3ZhciBiID0gdGhpcy5uYXRpdmVFdmVudDtyZXR1cm4gYi5nZXRNb2RpZmllclN0YXRlID8gYi5nZXRNb2RpZmllclN0YXRlKGEpIDogKGEgPSBPZFthXSkgPyAhIWJbYV0gOiAhMTt9ZnVuY3Rpb24gemQoKSB7cmV0dXJuIFBkO30KICAgICAgICAgIHZhciBRZCA9IEEoe30sIHVkLCB7IGtleTogZnVuY3Rpb24ga2V5KGEpIHtpZiAoYS5rZXkpIHt2YXIgYiA9IE1kW2Eua2V5XSB8fCBhLmtleTtpZiAoIlVuaWRlbnRpZmllZCIgIT09IGIpIHJldHVybiBiO31yZXR1cm4gImtleXByZXNzIiA9PT0gYS50eXBlID8gKGEgPSBvZChhKSwgMTMgPT09IGEgPyAiRW50ZXIiIDogU3RyaW5nLmZyb21DaGFyQ29kZShhKSkgOiAia2V5ZG93biIgPT09IGEudHlwZSB8fCAia2V5dXAiID09PSBhLnR5cGUgPyBOZFthLmtleUNvZGVdIHx8ICJVbmlkZW50aWZpZWQiIDogIiI7fSwgY29kZTogMCwgbG9jYXRpb246IDAsIGN0cmxLZXk6IDAsIHNoaWZ0S2V5OiAwLCBhbHRLZXk6IDAsIG1ldGFLZXk6IDAsIHJlcGVhdDogMCwgbG9jYWxlOiAwLCBnZXRNb2RpZmllclN0YXRlOiB6ZCwgY2hhckNvZGU6IGZ1bmN0aW9uIGNoYXJDb2RlKGEpIHtyZXR1cm4gImtleXByZXNzIiA9PT0gYS50eXBlID8gb2QoYSkgOiAwO30sIGtleUNvZGU6IGZ1bmN0aW9uIGtleUNvZGUoYSkge3JldHVybiAia2V5ZG93biIgPT09IGEudHlwZSB8fCAia2V5dXAiID09PSBhLnR5cGUgPyBhLmtleUNvZGUgOiAwO30sIHdoaWNoOiBmdW5jdGlvbiB3aGljaChhKSB7cmV0dXJuICJrZXlwcmVzcyIgPT09CiAgICAgICAgICAgICAgICBhLnR5cGUgPyBvZChhKSA6ICJrZXlkb3duIiA9PT0gYS50eXBlIHx8ICJrZXl1cCIgPT09IGEudHlwZSA/IGEua2V5Q29kZSA6IDA7fSB9KSxSZCA9IHJkKFFkKSxTZCA9IEEoe30sIEFkLCB7IHBvaW50ZXJJZDogMCwgd2lkdGg6IDAsIGhlaWdodDogMCwgcHJlc3N1cmU6IDAsIHRhbmdlbnRpYWxQcmVzc3VyZTogMCwgdGlsdFg6IDAsIHRpbHRZOiAwLCB0d2lzdDogMCwgcG9pbnRlclR5cGU6IDAsIGlzUHJpbWFyeTogMCB9KSxUZCA9IHJkKFNkKSxVZCA9IEEoe30sIHVkLCB7IHRvdWNoZXM6IDAsIHRhcmdldFRvdWNoZXM6IDAsIGNoYW5nZWRUb3VjaGVzOiAwLCBhbHRLZXk6IDAsIG1ldGFLZXk6IDAsIGN0cmxLZXk6IDAsIHNoaWZ0S2V5OiAwLCBnZXRNb2RpZmllclN0YXRlOiB6ZCB9KSxWZCA9IHJkKFVkKSxXZCA9IEEoe30sIHNkLCB7IHByb3BlcnR5TmFtZTogMCwgZWxhcHNlZFRpbWU6IDAsIHBzZXVkb0VsZW1lbnQ6IDAgfSksWGQgPSByZChXZCksWWQgPSBBKHt9LCBBZCwgeyBkZWx0YVg6IGZ1bmN0aW9uIGRlbHRhWChhKSB7cmV0dXJuICJkZWx0YVgiIGluIGEgPyBhLmRlbHRhWCA6ICJ3aGVlbERlbHRhWCIgaW4gYSA/IC1hLndoZWVsRGVsdGFYIDogMDt9LAogICAgICAgICAgICAgIGRlbHRhWTogZnVuY3Rpb24gZGVsdGFZKGEpIHtyZXR1cm4gImRlbHRhWSIgaW4gYSA/IGEuZGVsdGFZIDogIndoZWVsRGVsdGFZIiBpbiBhID8gLWEud2hlZWxEZWx0YVkgOiAid2hlZWxEZWx0YSIgaW4gYSA/IC1hLndoZWVsRGVsdGEgOiAwO30sIGRlbHRhWjogMCwgZGVsdGFNb2RlOiAwIH0pLFpkID0gcmQoWWQpLCRkID0gWzksIDEzLCAyNywgMzJdLGFlID0gaWEgJiYgIkNvbXBvc2l0aW9uRXZlbnQiIGluIHdpbmRvdyxiZSA9IG51bGw7aWEgJiYgImRvY3VtZW50TW9kZSIgaW4gZG9jdW1lbnQgJiYgKGJlID0gZG9jdW1lbnQuZG9jdW1lbnRNb2RlKTt2YXIgY2UgPSBpYSAmJiAiVGV4dEV2ZW50IiBpbiB3aW5kb3cgJiYgIWJlLGRlID0gaWEgJiYgKCFhZSB8fCBiZSAmJiA4IDwgYmUgJiYgMTEgPj0gYmUpLGVlID0gU3RyaW5nLmZyb21DaGFyQ29kZSgzMiksZmUgPSAhMTsKICAgICAgICAgIGZ1bmN0aW9uIGdlKGEsIGIpIHtzd2l0Y2ggKGEpIHtjYXNlICJrZXl1cCI6cmV0dXJuIC0xICE9PSAkZC5pbmRleE9mKGIua2V5Q29kZSk7Y2FzZSAia2V5ZG93biI6cmV0dXJuIDIyOSAhPT0gYi5rZXlDb2RlO2Nhc2UgImtleXByZXNzIjpjYXNlICJtb3VzZWRvd24iOmNhc2UgImZvY3Vzb3V0IjpyZXR1cm4gITA7ZGVmYXVsdDpyZXR1cm4gITE7fX1mdW5jdGlvbiBoZShhKSB7YSA9IGEuZGV0YWlsO3JldHVybiAib2JqZWN0IiA9PT0gdHlwZW9mIGEgJiYgImRhdGEiIGluIGEgPyBhLmRhdGEgOiBudWxsO312YXIgaWUgPSAhMTtmdW5jdGlvbiBqZShhLCBiKSB7c3dpdGNoIChhKSB7Y2FzZSAiY29tcG9zaXRpb25lbmQiOnJldHVybiBoZShiKTtjYXNlICJrZXlwcmVzcyI6aWYgKDMyICE9PSBiLndoaWNoKSByZXR1cm4gbnVsbDtmZSA9ICEwO3JldHVybiBlZTtjYXNlICJ0ZXh0SW5wdXQiOnJldHVybiBhID0gYi5kYXRhLCBhID09PSBlZSAmJiBmZSA/IG51bGwgOiBhO2RlZmF1bHQ6cmV0dXJuIG51bGw7fX0KICAgICAgICAgIGZ1bmN0aW9uIGtlKGEsIGIpIHtpZiAoaWUpIHJldHVybiAiY29tcG9zaXRpb25lbmQiID09PSBhIHx8ICFhZSAmJiBnZShhLCBiKSA/IChhID0gbmQoKSwgbWQgPSBsZCA9IGtkID0gbnVsbCwgaWUgPSAhMSwgYSkgOiBudWxsO3N3aXRjaCAoYSkge2Nhc2UgInBhc3RlIjpyZXR1cm4gbnVsbDtjYXNlICJrZXlwcmVzcyI6aWYgKCEoYi5jdHJsS2V5IHx8IGIuYWx0S2V5IHx8IGIubWV0YUtleSkgfHwgYi5jdHJsS2V5ICYmIGIuYWx0S2V5KSB7aWYgKGIuY2hhciAmJiAxIDwgYi5jaGFyLmxlbmd0aCkgcmV0dXJuIGIuY2hhcjtpZiAoYi53aGljaCkgcmV0dXJuIFN0cmluZy5mcm9tQ2hhckNvZGUoYi53aGljaCk7fXJldHVybiBudWxsO2Nhc2UgImNvbXBvc2l0aW9uZW5kIjpyZXR1cm4gZGUgJiYgImtvIiAhPT0gYi5sb2NhbGUgPyBudWxsIDogYi5kYXRhO2RlZmF1bHQ6cmV0dXJuIG51bGw7fX0KICAgICAgICAgIHZhciBsZSA9IHsgY29sb3I6ICEwLCBkYXRlOiAhMCwgZGF0ZXRpbWU6ICEwLCAiZGF0ZXRpbWUtbG9jYWwiOiAhMCwgZW1haWw6ICEwLCBtb250aDogITAsIG51bWJlcjogITAsIHBhc3N3b3JkOiAhMCwgcmFuZ2U6ICEwLCBzZWFyY2g6ICEwLCB0ZWw6ICEwLCB0ZXh0OiAhMCwgdGltZTogITAsIHVybDogITAsIHdlZWs6ICEwIH07ZnVuY3Rpb24gbWUoYSkge3ZhciBiID0gYSAmJiBhLm5vZGVOYW1lICYmIGEubm9kZU5hbWUudG9Mb3dlckNhc2UoKTtyZXR1cm4gImlucHV0IiA9PT0gYiA/ICEhbGVbYS50eXBlXSA6ICJ0ZXh0YXJlYSIgPT09IGIgPyAhMCA6ICExO31mdW5jdGlvbiBuZShhLCBiLCBjLCBkKSB7RWIoZCk7YiA9IG9lKGIsICJvbkNoYW5nZSIpOzAgPCBiLmxlbmd0aCAmJiAoYyA9IG5ldyB0ZCgib25DaGFuZ2UiLCAiY2hhbmdlIiwgbnVsbCwgYywgZCksIGEucHVzaCh7IGV2ZW50OiBjLCBsaXN0ZW5lcnM6IGIgfSkpO312YXIgcGUgPSBudWxsLHFlID0gbnVsbDtmdW5jdGlvbiByZShhKSB7c2UoYSwgMCk7fWZ1bmN0aW9uIHRlKGEpIHt2YXIgYiA9IHVlKGEpO2lmIChXYShiKSkgcmV0dXJuIGE7fQogICAgICAgICAgZnVuY3Rpb24gdmUoYSwgYikge2lmICgiY2hhbmdlIiA9PT0gYSkgcmV0dXJuIGI7fXZhciB3ZSA9ICExO2lmIChpYSkge3ZhciB4ZTtpZiAoaWEpIHt2YXIgeWUgPSAoIm9uaW5wdXQiIGluIGRvY3VtZW50KTtpZiAoIXllKSB7dmFyIHplID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2Iik7emUuc2V0QXR0cmlidXRlKCJvbmlucHV0IiwgInJldHVybjsiKTt5ZSA9ICJmdW5jdGlvbiIgPT09IHR5cGVvZiB6ZS5vbmlucHV0O314ZSA9IHllO30gZWxzZSB4ZSA9ICExO3dlID0geGUgJiYgKCFkb2N1bWVudC5kb2N1bWVudE1vZGUgfHwgOSA8IGRvY3VtZW50LmRvY3VtZW50TW9kZSk7fWZ1bmN0aW9uIEFlKCkge3BlICYmIChwZS5kZXRhY2hFdmVudCgib25wcm9wZXJ0eWNoYW5nZSIsIEJlKSwgcWUgPSBwZSA9IG51bGwpO31mdW5jdGlvbiBCZShhKSB7aWYgKCJ2YWx1ZSIgPT09IGEucHJvcGVydHlOYW1lICYmIHRlKHFlKSkge3ZhciBiID0gW107bmUoYiwgcWUsIGEsIHhiKGEpKTtKYihyZSwgYik7fX0KICAgICAgICAgIGZ1bmN0aW9uIENlKGEsIGIsIGMpIHsiZm9jdXNpbiIgPT09IGEgPyAoQWUoKSwgcGUgPSBiLCBxZSA9IGMsIHBlLmF0dGFjaEV2ZW50KCJvbnByb3BlcnR5Y2hhbmdlIiwgQmUpKSA6ICJmb2N1c291dCIgPT09IGEgJiYgQWUoKTt9ZnVuY3Rpb24gRGUoYSkge2lmICgic2VsZWN0aW9uY2hhbmdlIiA9PT0gYSB8fCAia2V5dXAiID09PSBhIHx8ICJrZXlkb3duIiA9PT0gYSkgcmV0dXJuIHRlKHFlKTt9ZnVuY3Rpb24gRWUoYSwgYikge2lmICgiY2xpY2siID09PSBhKSByZXR1cm4gdGUoYik7fWZ1bmN0aW9uIEZlKGEsIGIpIHtpZiAoImlucHV0IiA9PT0gYSB8fCAiY2hhbmdlIiA9PT0gYSkgcmV0dXJuIHRlKGIpO31mdW5jdGlvbiBHZShhLCBiKSB7cmV0dXJuIGEgPT09IGIgJiYgKDAgIT09IGEgfHwgMSAvIGEgPT09IDEgLyBiKSB8fCBhICE9PSBhICYmIGIgIT09IGI7fXZhciBIZSA9ICJmdW5jdGlvbiIgPT09IHR5cGVvZiBPYmplY3QuaXMgPyBPYmplY3QuaXMgOiBHZTsKICAgICAgICAgIGZ1bmN0aW9uIEllKGEsIGIpIHtpZiAoSGUoYSwgYikpIHJldHVybiAhMDtpZiAoIm9iamVjdCIgIT09IHR5cGVvZiBhIHx8IG51bGwgPT09IGEgfHwgIm9iamVjdCIgIT09IHR5cGVvZiBiIHx8IG51bGwgPT09IGIpIHJldHVybiAhMTt2YXIgYyA9IE9iamVjdC5rZXlzKGEpLGQgPSBPYmplY3Qua2V5cyhiKTtpZiAoYy5sZW5ndGggIT09IGQubGVuZ3RoKSByZXR1cm4gITE7Zm9yIChkID0gMDsgZCA8IGMubGVuZ3RoOyBkKyspIHt2YXIgZSA9IGNbZF07aWYgKCFqYS5jYWxsKGIsIGUpIHx8ICFIZShhW2VdLCBiW2VdKSkgcmV0dXJuICExO31yZXR1cm4gITA7fWZ1bmN0aW9uIEplKGEpIHtmb3IgKDsgYSAmJiBhLmZpcnN0Q2hpbGQ7KSBhID0gYS5maXJzdENoaWxkO3JldHVybiBhO30KICAgICAgICAgIGZ1bmN0aW9uIEtlKGEsIGIpIHt2YXIgYyA9IEplKGEpO2EgPSAwO2ZvciAodmFyIGQ7IGM7KSB7aWYgKDMgPT09IGMubm9kZVR5cGUpIHtkID0gYSArIGMudGV4dENvbnRlbnQubGVuZ3RoO2lmIChhIDw9IGIgJiYgZCA+PSBiKSByZXR1cm4geyBub2RlOiBjLCBvZmZzZXQ6IGIgLSBhIH07YSA9IGQ7fWE6IHtmb3IgKDsgYzspIHtpZiAoYy5uZXh0U2libGluZykge2MgPSBjLm5leHRTaWJsaW5nO2JyZWFrIGE7fWMgPSBjLnBhcmVudE5vZGU7fWMgPSB2b2lkIDA7fWMgPSBKZShjKTt9fWZ1bmN0aW9uIExlKGEsIGIpIHtyZXR1cm4gYSAmJiBiID8gYSA9PT0gYiA/ICEwIDogYSAmJiAzID09PSBhLm5vZGVUeXBlID8gITEgOiBiICYmIDMgPT09IGIubm9kZVR5cGUgPyBMZShhLCBiLnBhcmVudE5vZGUpIDogImNvbnRhaW5zIiBpbiBhID8gYS5jb250YWlucyhiKSA6IGEuY29tcGFyZURvY3VtZW50UG9zaXRpb24gPyAhIShhLmNvbXBhcmVEb2N1bWVudFBvc2l0aW9uKGIpICYgMTYpIDogITEgOiAhMTt9CiAgICAgICAgICBmdW5jdGlvbiBNZSgpIHtmb3IgKHZhciBhID0gd2luZG93LCBiID0gWGEoKTsgYiBpbnN0YW5jZW9mIGEuSFRNTElGcmFtZUVsZW1lbnQ7KSB7dHJ5IHt2YXIgYyA9ICJzdHJpbmciID09PSB0eXBlb2YgYi5jb250ZW50V2luZG93LmxvY2F0aW9uLmhyZWY7fSBjYXRjaCAoZCkge2MgPSAhMTt9aWYgKGMpIGEgPSBiLmNvbnRlbnRXaW5kb3c7ZWxzZSBicmVhaztiID0gWGEoYS5kb2N1bWVudCk7fXJldHVybiBiO31mdW5jdGlvbiBOZShhKSB7dmFyIGIgPSBhICYmIGEubm9kZU5hbWUgJiYgYS5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpO3JldHVybiBiICYmICgiaW5wdXQiID09PSBiICYmICgidGV4dCIgPT09IGEudHlwZSB8fCAic2VhcmNoIiA9PT0gYS50eXBlIHx8ICJ0ZWwiID09PSBhLnR5cGUgfHwgInVybCIgPT09IGEudHlwZSB8fCAicGFzc3dvcmQiID09PSBhLnR5cGUpIHx8ICJ0ZXh0YXJlYSIgPT09IGIgfHwgInRydWUiID09PSBhLmNvbnRlbnRFZGl0YWJsZSk7fQogICAgICAgICAgZnVuY3Rpb24gT2UoYSkge3ZhciBiID0gTWUoKSxjID0gYS5mb2N1c2VkRWxlbSxkID0gYS5zZWxlY3Rpb25SYW5nZTtpZiAoYiAhPT0gYyAmJiBjICYmIGMub3duZXJEb2N1bWVudCAmJiBMZShjLm93bmVyRG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LCBjKSkge2lmIChudWxsICE9PSBkICYmIE5lKGMpKSBpZiAoYiA9IGQuc3RhcnQsIGEgPSBkLmVuZCwgdm9pZCAwID09PSBhICYmIChhID0gYiksICJzZWxlY3Rpb25TdGFydCIgaW4gYykgYy5zZWxlY3Rpb25TdGFydCA9IGIsIGMuc2VsZWN0aW9uRW5kID0gTWF0aC5taW4oYSwgYy52YWx1ZS5sZW5ndGgpO2Vsc2UgaWYgKGEgPSAoYiA9IGMub3duZXJEb2N1bWVudCB8fCBkb2N1bWVudCkgJiYgYi5kZWZhdWx0VmlldyB8fCB3aW5kb3csIGEuZ2V0U2VsZWN0aW9uKSB7YSA9IGEuZ2V0U2VsZWN0aW9uKCk7dmFyIGUgPSBjLnRleHRDb250ZW50Lmxlbmd0aCxmID0gTWF0aC5taW4oZC5zdGFydCwgZSk7ZCA9IHZvaWQgMCA9PT0gZC5lbmQgPyBmIDogTWF0aC5taW4oZC5lbmQsIGUpOyFhLmV4dGVuZCAmJiBmID4gZCAmJiAoZSA9IGQsIGQgPSBmLCBmID0gZSk7ZSA9IEtlKGMsIGYpO3ZhciBnID0gS2UoYywKICAgICAgICAgICAgICAgIGQpO2UgJiYgZyAmJiAoMSAhPT0gYS5yYW5nZUNvdW50IHx8IGEuYW5jaG9yTm9kZSAhPT0gZS5ub2RlIHx8IGEuYW5jaG9yT2Zmc2V0ICE9PSBlLm9mZnNldCB8fCBhLmZvY3VzTm9kZSAhPT0gZy5ub2RlIHx8IGEuZm9jdXNPZmZzZXQgIT09IGcub2Zmc2V0KSAmJiAoYiA9IGIuY3JlYXRlUmFuZ2UoKSwgYi5zZXRTdGFydChlLm5vZGUsIGUub2Zmc2V0KSwgYS5yZW1vdmVBbGxSYW5nZXMoKSwgZiA+IGQgPyAoYS5hZGRSYW5nZShiKSwgYS5leHRlbmQoZy5ub2RlLCBnLm9mZnNldCkpIDogKGIuc2V0RW5kKGcubm9kZSwgZy5vZmZzZXQpLCBhLmFkZFJhbmdlKGIpKSk7fWIgPSBbXTtmb3IgKGEgPSBjOyBhID0gYS5wYXJlbnROb2RlOykgMSA9PT0gYS5ub2RlVHlwZSAmJiBiLnB1c2goeyBlbGVtZW50OiBhLCBsZWZ0OiBhLnNjcm9sbExlZnQsIHRvcDogYS5zY3JvbGxUb3AgfSk7ImZ1bmN0aW9uIiA9PT0gdHlwZW9mIGMuZm9jdXMgJiYgYy5mb2N1cygpO2ZvciAoYyA9IDA7IGMgPCBiLmxlbmd0aDsgYysrKSBhID0gYltjXSwgYS5lbGVtZW50LnNjcm9sbExlZnQgPSBhLmxlZnQsIGEuZWxlbWVudC5zY3JvbGxUb3AgPSBhLnRvcDt9fQogICAgICAgICAgdmFyIFBlID0gaWEgJiYgImRvY3VtZW50TW9kZSIgaW4gZG9jdW1lbnQgJiYgMTEgPj0gZG9jdW1lbnQuZG9jdW1lbnRNb2RlLFFlID0gbnVsbCxSZSA9IG51bGwsU2UgPSBudWxsLFRlID0gITE7CiAgICAgICAgICBmdW5jdGlvbiBVZShhLCBiLCBjKSB7dmFyIGQgPSBjLndpbmRvdyA9PT0gYyA/IGMuZG9jdW1lbnQgOiA5ID09PSBjLm5vZGVUeXBlID8gYyA6IGMub3duZXJEb2N1bWVudDtUZSB8fCBudWxsID09IFFlIHx8IFFlICE9PSBYYShkKSB8fCAoZCA9IFFlLCAic2VsZWN0aW9uU3RhcnQiIGluIGQgJiYgTmUoZCkgPyBkID0geyBzdGFydDogZC5zZWxlY3Rpb25TdGFydCwgZW5kOiBkLnNlbGVjdGlvbkVuZCB9IDogKGQgPSAoZC5vd25lckRvY3VtZW50ICYmIGQub3duZXJEb2N1bWVudC5kZWZhdWx0VmlldyB8fCB3aW5kb3cpLmdldFNlbGVjdGlvbigpLCBkID0geyBhbmNob3JOb2RlOiBkLmFuY2hvck5vZGUsIGFuY2hvck9mZnNldDogZC5hbmNob3JPZmZzZXQsIGZvY3VzTm9kZTogZC5mb2N1c05vZGUsIGZvY3VzT2Zmc2V0OiBkLmZvY3VzT2Zmc2V0IH0pLCBTZSAmJiBJZShTZSwgZCkgfHwgKFNlID0gZCwgZCA9IG9lKFJlLCAib25TZWxlY3QiKSwgMCA8IGQubGVuZ3RoICYmIChiID0gbmV3IHRkKCJvblNlbGVjdCIsICJzZWxlY3QiLCBudWxsLCBiLCBjKSwgYS5wdXNoKHsgZXZlbnQ6IGIsIGxpc3RlbmVyczogZCB9KSwgYi50YXJnZXQgPSBRZSkpKTt9CiAgICAgICAgICBmdW5jdGlvbiBWZShhLCBiKSB7dmFyIGMgPSB7fTtjW2EudG9Mb3dlckNhc2UoKV0gPSBiLnRvTG93ZXJDYXNlKCk7Y1siV2Via2l0IiArIGFdID0gIndlYmtpdCIgKyBiO2NbIk1veiIgKyBhXSA9ICJtb3oiICsgYjtyZXR1cm4gYzt9dmFyIFdlID0geyBhbmltYXRpb25lbmQ6IFZlKCJBbmltYXRpb24iLCAiQW5pbWF0aW9uRW5kIiksIGFuaW1hdGlvbml0ZXJhdGlvbjogVmUoIkFuaW1hdGlvbiIsICJBbmltYXRpb25JdGVyYXRpb24iKSwgYW5pbWF0aW9uc3RhcnQ6IFZlKCJBbmltYXRpb24iLCAiQW5pbWF0aW9uU3RhcnQiKSwgdHJhbnNpdGlvbmVuZDogVmUoIlRyYW5zaXRpb24iLCAiVHJhbnNpdGlvbkVuZCIpIH0sWGUgPSB7fSxZZSA9IHt9OwogICAgICAgICAgaWEgJiYgKFllID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2Iikuc3R5bGUsICJBbmltYXRpb25FdmVudCIgaW4gd2luZG93IHx8IChkZWxldGUgV2UuYW5pbWF0aW9uZW5kLmFuaW1hdGlvbiwgZGVsZXRlIFdlLmFuaW1hdGlvbml0ZXJhdGlvbi5hbmltYXRpb24sIGRlbGV0ZSBXZS5hbmltYXRpb25zdGFydC5hbmltYXRpb24pLCAiVHJhbnNpdGlvbkV2ZW50IiBpbiB3aW5kb3cgfHwgZGVsZXRlIFdlLnRyYW5zaXRpb25lbmQudHJhbnNpdGlvbik7ZnVuY3Rpb24gWmUoYSkge2lmIChYZVthXSkgcmV0dXJuIFhlW2FdO2lmICghV2VbYV0pIHJldHVybiBhO3ZhciBiID0gV2VbYV0sYztmb3IgKGMgaW4gYikgaWYgKGIuaGFzT3duUHJvcGVydHkoYykgJiYgYyBpbiBZZSkgcmV0dXJuIFhlW2FdID0gYltjXTtyZXR1cm4gYTt9dmFyICRlID0gWmUoImFuaW1hdGlvbmVuZCIpLGFmID0gWmUoImFuaW1hdGlvbml0ZXJhdGlvbiIpLGJmID0gWmUoImFuaW1hdGlvbnN0YXJ0IiksY2YgPSBaZSgidHJhbnNpdGlvbmVuZCIpLGRmID0gbmV3IE1hcCgpLGVmID0gImFib3J0IGF1eENsaWNrIGNhbmNlbCBjYW5QbGF5IGNhblBsYXlUaHJvdWdoIGNsaWNrIGNsb3NlIGNvbnRleHRNZW51IGNvcHkgY3V0IGRyYWcgZHJhZ0VuZCBkcmFnRW50ZXIgZHJhZ0V4aXQgZHJhZ0xlYXZlIGRyYWdPdmVyIGRyYWdTdGFydCBkcm9wIGR1cmF0aW9uQ2hhbmdlIGVtcHRpZWQgZW5jcnlwdGVkIGVuZGVkIGVycm9yIGdvdFBvaW50ZXJDYXB0dXJlIGlucHV0IGludmFsaWQga2V5RG93biBrZXlQcmVzcyBrZXlVcCBsb2FkIGxvYWRlZERhdGEgbG9hZGVkTWV0YWRhdGEgbG9hZFN0YXJ0IGxvc3RQb2ludGVyQ2FwdHVyZSBtb3VzZURvd24gbW91c2VNb3ZlIG1vdXNlT3V0IG1vdXNlT3ZlciBtb3VzZVVwIHBhc3RlIHBhdXNlIHBsYXkgcGxheWluZyBwb2ludGVyQ2FuY2VsIHBvaW50ZXJEb3duIHBvaW50ZXJNb3ZlIHBvaW50ZXJPdXQgcG9pbnRlck92ZXIgcG9pbnRlclVwIHByb2dyZXNzIHJhdGVDaGFuZ2UgcmVzZXQgcmVzaXplIHNlZWtlZCBzZWVraW5nIHN0YWxsZWQgc3VibWl0IHN1c3BlbmQgdGltZVVwZGF0ZSB0b3VjaENhbmNlbCB0b3VjaEVuZCB0b3VjaFN0YXJ0IHZvbHVtZUNoYW5nZSBzY3JvbGwgdG9nZ2xlIHRvdWNoTW92ZSB3YWl0aW5nIHdoZWVsIi5zcGxpdCgiICIpOwogICAgICAgICAgZnVuY3Rpb24gZmYoYSwgYikge2RmLnNldChhLCBiKTtmYShiLCBbYV0pO31mb3IgKHZhciBnZiA9IDA7IGdmIDwgZWYubGVuZ3RoOyBnZisrKSB7dmFyIGhmID0gZWZbZ2ZdLGpmID0gaGYudG9Mb3dlckNhc2UoKSxrZiA9IGhmWzBdLnRvVXBwZXJDYXNlKCkgKyBoZi5zbGljZSgxKTtmZihqZiwgIm9uIiArIGtmKTt9ZmYoJGUsICJvbkFuaW1hdGlvbkVuZCIpO2ZmKGFmLCAib25BbmltYXRpb25JdGVyYXRpb24iKTtmZihiZiwgIm9uQW5pbWF0aW9uU3RhcnQiKTtmZigiZGJsY2xpY2siLCAib25Eb3VibGVDbGljayIpO2ZmKCJmb2N1c2luIiwgIm9uRm9jdXMiKTtmZigiZm9jdXNvdXQiLCAib25CbHVyIik7ZmYoY2YsICJvblRyYW5zaXRpb25FbmQiKTtoYSgib25Nb3VzZUVudGVyIiwgWyJtb3VzZW91dCIsICJtb3VzZW92ZXIiXSk7aGEoIm9uTW91c2VMZWF2ZSIsIFsibW91c2VvdXQiLCAibW91c2VvdmVyIl0pO2hhKCJvblBvaW50ZXJFbnRlciIsIFsicG9pbnRlcm91dCIsICJwb2ludGVyb3ZlciJdKTsKICAgICAgICAgIGhhKCJvblBvaW50ZXJMZWF2ZSIsIFsicG9pbnRlcm91dCIsICJwb2ludGVyb3ZlciJdKTtmYSgib25DaGFuZ2UiLCAiY2hhbmdlIGNsaWNrIGZvY3VzaW4gZm9jdXNvdXQgaW5wdXQga2V5ZG93biBrZXl1cCBzZWxlY3Rpb25jaGFuZ2UiLnNwbGl0KCIgIikpO2ZhKCJvblNlbGVjdCIsICJmb2N1c291dCBjb250ZXh0bWVudSBkcmFnZW5kIGZvY3VzaW4ga2V5ZG93biBrZXl1cCBtb3VzZWRvd24gbW91c2V1cCBzZWxlY3Rpb25jaGFuZ2UiLnNwbGl0KCIgIikpO2ZhKCJvbkJlZm9yZUlucHV0IiwgWyJjb21wb3NpdGlvbmVuZCIsICJrZXlwcmVzcyIsICJ0ZXh0SW5wdXQiLCAicGFzdGUiXSk7ZmEoIm9uQ29tcG9zaXRpb25FbmQiLCAiY29tcG9zaXRpb25lbmQgZm9jdXNvdXQga2V5ZG93biBrZXlwcmVzcyBrZXl1cCBtb3VzZWRvd24iLnNwbGl0KCIgIikpO2ZhKCJvbkNvbXBvc2l0aW9uU3RhcnQiLCAiY29tcG9zaXRpb25zdGFydCBmb2N1c291dCBrZXlkb3duIGtleXByZXNzIGtleXVwIG1vdXNlZG93biIuc3BsaXQoIiAiKSk7CiAgICAgICAgICBmYSgib25Db21wb3NpdGlvblVwZGF0ZSIsICJjb21wb3NpdGlvbnVwZGF0ZSBmb2N1c291dCBrZXlkb3duIGtleXByZXNzIGtleXVwIG1vdXNlZG93biIuc3BsaXQoIiAiKSk7dmFyIGxmID0gImFib3J0IGNhbnBsYXkgY2FucGxheXRocm91Z2ggZHVyYXRpb25jaGFuZ2UgZW1wdGllZCBlbmNyeXB0ZWQgZW5kZWQgZXJyb3IgbG9hZGVkZGF0YSBsb2FkZWRtZXRhZGF0YSBsb2Fkc3RhcnQgcGF1c2UgcGxheSBwbGF5aW5nIHByb2dyZXNzIHJhdGVjaGFuZ2UgcmVzaXplIHNlZWtlZCBzZWVraW5nIHN0YWxsZWQgc3VzcGVuZCB0aW1ldXBkYXRlIHZvbHVtZWNoYW5nZSB3YWl0aW5nIi5zcGxpdCgiICIpLG1mID0gbmV3IFNldCgiY2FuY2VsIGNsb3NlIGludmFsaWQgbG9hZCBzY3JvbGwgdG9nZ2xlIi5zcGxpdCgiICIpLmNvbmNhdChsZikpOwogICAgICAgICAgZnVuY3Rpb24gbmYoYSwgYiwgYykge3ZhciBkID0gYS50eXBlIHx8ICJ1bmtub3duLWV2ZW50IjthLmN1cnJlbnRUYXJnZXQgPSBjO1ViKGQsIGIsIHZvaWQgMCwgYSk7YS5jdXJyZW50VGFyZ2V0ID0gbnVsbDt9CiAgICAgICAgICBmdW5jdGlvbiBzZShhLCBiKSB7YiA9IDAgIT09IChiICYgNCk7Zm9yICh2YXIgYyA9IDA7IGMgPCBhLmxlbmd0aDsgYysrKSB7dmFyIGQgPSBhW2NdLGUgPSBkLmV2ZW50O2QgPSBkLmxpc3RlbmVyczthOiB7dmFyIGYgPSB2b2lkIDA7aWYgKGIpIGZvciAodmFyIGcgPSBkLmxlbmd0aCAtIDE7IDAgPD0gZzsgZy0tKSB7dmFyIGggPSBkW2ddLGsgPSBoLmluc3RhbmNlLGwgPSBoLmN1cnJlbnRUYXJnZXQ7aCA9IGgubGlzdGVuZXI7aWYgKGsgIT09IGYgJiYgZS5pc1Byb3BhZ2F0aW9uU3RvcHBlZCgpKSBicmVhayBhO25mKGUsIGgsIGwpO2YgPSBrO30gZWxzZSBmb3IgKGcgPSAwOyBnIDwgZC5sZW5ndGg7IGcrKykge2ggPSBkW2ddO2sgPSBoLmluc3RhbmNlO2wgPSBoLmN1cnJlbnRUYXJnZXQ7aCA9IGgubGlzdGVuZXI7aWYgKGsgIT09IGYgJiYgZS5pc1Byb3BhZ2F0aW9uU3RvcHBlZCgpKSBicmVhayBhO25mKGUsIGgsIGwpO2YgPSBrO319fWlmIChRYikgdGhyb3cgYSA9IFJiLCBRYiA9ICExLCBSYiA9IG51bGwsIGE7fQogICAgICAgICAgZnVuY3Rpb24gRChhLCBiKSB7dmFyIGMgPSBiW29mXTt2b2lkIDAgPT09IGMgJiYgKGMgPSBiW29mXSA9IG5ldyBTZXQoKSk7dmFyIGQgPSBhICsgIl9fYnViYmxlIjtjLmhhcyhkKSB8fCAocGYoYiwgYSwgMiwgITEpLCBjLmFkZChkKSk7fWZ1bmN0aW9uIHFmKGEsIGIsIGMpIHt2YXIgZCA9IDA7YiAmJiAoZCB8PSA0KTtwZihjLCBhLCBkLCBiKTt9dmFyIHJmID0gIl9yZWFjdExpc3RlbmluZyIgKyBNYXRoLnJhbmRvbSgpLnRvU3RyaW5nKDM2KS5zbGljZSgyKTtmdW5jdGlvbiBzZihhKSB7aWYgKCFhW3JmXSkge2FbcmZdID0gITA7ZGEuZm9yRWFjaChmdW5jdGlvbiAoYikgeyJzZWxlY3Rpb25jaGFuZ2UiICE9PSBiICYmIChtZi5oYXMoYikgfHwgcWYoYiwgITEsIGEpLCBxZihiLCAhMCwgYSkpO30pO3ZhciBiID0gOSA9PT0gYS5ub2RlVHlwZSA/IGEgOiBhLm93bmVyRG9jdW1lbnQ7bnVsbCA9PT0gYiB8fCBiW3JmXSB8fCAoYltyZl0gPSAhMCwgcWYoInNlbGVjdGlvbmNoYW5nZSIsICExLCBiKSk7fX0KICAgICAgICAgIGZ1bmN0aW9uIHBmKGEsIGIsIGMsIGQpIHtzd2l0Y2ggKGpkKGIpKSB7Y2FzZSAxOnZhciBlID0gZWQ7YnJlYWs7Y2FzZSA0OmUgPSBnZDticmVhaztkZWZhdWx0OmUgPSBmZDt9YyA9IGUuYmluZChudWxsLCBiLCBjLCBhKTtlID0gdm9pZCAwOyFMYiB8fCAidG91Y2hzdGFydCIgIT09IGIgJiYgInRvdWNobW92ZSIgIT09IGIgJiYgIndoZWVsIiAhPT0gYiB8fCAoZSA9ICEwKTtkID8gdm9pZCAwICE9PSBlID8gYS5hZGRFdmVudExpc3RlbmVyKGIsIGMsIHsgY2FwdHVyZTogITAsIHBhc3NpdmU6IGUgfSkgOiBhLmFkZEV2ZW50TGlzdGVuZXIoYiwgYywgITApIDogdm9pZCAwICE9PSBlID8gYS5hZGRFdmVudExpc3RlbmVyKGIsIGMsIHsgcGFzc2l2ZTogZSB9KSA6IGEuYWRkRXZlbnRMaXN0ZW5lcihiLCBjLCAhMSk7fQogICAgICAgICAgZnVuY3Rpb24gaGQoYSwgYiwgYywgZCwgZSkge3ZhciBmID0gZDtpZiAoMCA9PT0gKGIgJiAxKSAmJiAwID09PSAoYiAmIDIpICYmIG51bGwgIT09IGQpIGE6IGZvciAoOzspIHtpZiAobnVsbCA9PT0gZCkgcmV0dXJuO3ZhciBnID0gZC50YWc7aWYgKDMgPT09IGcgfHwgNCA9PT0gZykge3ZhciBoID0gZC5zdGF0ZU5vZGUuY29udGFpbmVySW5mbztpZiAoaCA9PT0gZSB8fCA4ID09PSBoLm5vZGVUeXBlICYmIGgucGFyZW50Tm9kZSA9PT0gZSkgYnJlYWs7aWYgKDQgPT09IGcpIGZvciAoZyA9IGQucmV0dXJuOyBudWxsICE9PSBnOykge3ZhciBrID0gZy50YWc7aWYgKDMgPT09IGsgfHwgNCA9PT0gaykgaWYgKGsgPSBnLnN0YXRlTm9kZS5jb250YWluZXJJbmZvLCBrID09PSBlIHx8IDggPT09IGsubm9kZVR5cGUgJiYgay5wYXJlbnROb2RlID09PSBlKSByZXR1cm47ZyA9IGcucmV0dXJuO31mb3IgKDsgbnVsbCAhPT0gaDspIHtnID0gV2MoaCk7aWYgKG51bGwgPT09IGcpIHJldHVybjtrID0gZy50YWc7aWYgKDUgPT09IGsgfHwgNiA9PT0gaykge2QgPSBmID0gZztjb250aW51ZSBhO31oID0gaC5wYXJlbnROb2RlO319ZCA9IGQucmV0dXJuO31KYihmdW5jdGlvbiAoKSB7dmFyIGQgPSBmLGUgPSB4YihjKSxnID0gW107CiAgICAgICAgICAgICAgYToge3ZhciBoID0gZGYuZ2V0KGEpO2lmICh2b2lkIDAgIT09IGgpIHt2YXIgayA9IHRkLG4gPSBhO3N3aXRjaCAoYSkge2Nhc2UgImtleXByZXNzIjppZiAoMCA9PT0gb2QoYykpIGJyZWFrIGE7Y2FzZSAia2V5ZG93biI6Y2FzZSAia2V5dXAiOmsgPSBSZDticmVhaztjYXNlICJmb2N1c2luIjpuID0gImZvY3VzIjtrID0gRmQ7YnJlYWs7Y2FzZSAiZm9jdXNvdXQiOm4gPSAiYmx1ciI7ayA9IEZkO2JyZWFrO2Nhc2UgImJlZm9yZWJsdXIiOmNhc2UgImFmdGVyYmx1ciI6ayA9IEZkO2JyZWFrO2Nhc2UgImNsaWNrIjppZiAoMiA9PT0gYy5idXR0b24pIGJyZWFrIGE7Y2FzZSAiYXV4Y2xpY2siOmNhc2UgImRibGNsaWNrIjpjYXNlICJtb3VzZWRvd24iOmNhc2UgIm1vdXNlbW92ZSI6Y2FzZSAibW91c2V1cCI6Y2FzZSAibW91c2VvdXQiOmNhc2UgIm1vdXNlb3ZlciI6Y2FzZSAiY29udGV4dG1lbnUiOmsgPSBCZDticmVhaztjYXNlICJkcmFnIjpjYXNlICJkcmFnZW5kIjpjYXNlICJkcmFnZW50ZXIiOmNhc2UgImRyYWdleGl0IjpjYXNlICJkcmFnbGVhdmUiOmNhc2UgImRyYWdvdmVyIjpjYXNlICJkcmFnc3RhcnQiOmNhc2UgImRyb3AiOmsgPQogICAgICAgICAgICAgICAgICAgICAgRGQ7YnJlYWs7Y2FzZSAidG91Y2hjYW5jZWwiOmNhc2UgInRvdWNoZW5kIjpjYXNlICJ0b3VjaG1vdmUiOmNhc2UgInRvdWNoc3RhcnQiOmsgPSBWZDticmVhaztjYXNlICRlOmNhc2UgYWY6Y2FzZSBiZjprID0gSGQ7YnJlYWs7Y2FzZSBjZjprID0gWGQ7YnJlYWs7Y2FzZSAic2Nyb2xsIjprID0gdmQ7YnJlYWs7Y2FzZSAid2hlZWwiOmsgPSBaZDticmVhaztjYXNlICJjb3B5IjpjYXNlICJjdXQiOmNhc2UgInBhc3RlIjprID0gSmQ7YnJlYWs7Y2FzZSAiZ290cG9pbnRlcmNhcHR1cmUiOmNhc2UgImxvc3Rwb2ludGVyY2FwdHVyZSI6Y2FzZSAicG9pbnRlcmNhbmNlbCI6Y2FzZSAicG9pbnRlcmRvd24iOmNhc2UgInBvaW50ZXJtb3ZlIjpjYXNlICJwb2ludGVyb3V0IjpjYXNlICJwb2ludGVyb3ZlciI6Y2FzZSAicG9pbnRlcnVwIjprID0gVGQ7fXZhciB0ID0gMCAhPT0gKGIgJiA0KSxKID0gIXQgJiYgInNjcm9sbCIgPT09IGEseCA9IHQgPyBudWxsICE9PSBoID8gaCArICJDYXB0dXJlIiA6IG51bGwgOiBoO3QgPSBbXTtmb3IgKHZhciB3ID0gZCwgdTsgbnVsbCAhPT0KICAgICAgICAgICAgICAgICAgdzspIHt1ID0gdzt2YXIgRiA9IHUuc3RhdGVOb2RlOzUgPT09IHUudGFnICYmIG51bGwgIT09IEYgJiYgKHUgPSBGLCBudWxsICE9PSB4ICYmIChGID0gS2IodywgeCksIG51bGwgIT0gRiAmJiB0LnB1c2godGYodywgRiwgdSkpKSk7aWYgKEopIGJyZWFrO3cgPSB3LnJldHVybjt9MCA8IHQubGVuZ3RoICYmIChoID0gbmV3IGsoaCwgbiwgbnVsbCwgYywgZSksIGcucHVzaCh7IGV2ZW50OiBoLCBsaXN0ZW5lcnM6IHQgfSkpO319aWYgKDAgPT09IChiICYgNykpIHthOiB7aCA9ICJtb3VzZW92ZXIiID09PSBhIHx8ICJwb2ludGVyb3ZlciIgPT09IGE7ayA9ICJtb3VzZW91dCIgPT09IGEgfHwgInBvaW50ZXJvdXQiID09PSBhO2lmIChoICYmIGMgIT09IHdiICYmIChuID0gYy5yZWxhdGVkVGFyZ2V0IHx8IGMuZnJvbUVsZW1lbnQpICYmIChXYyhuKSB8fCBuW3VmXSkpIGJyZWFrIGE7aWYgKGsgfHwgaCkge2ggPSBlLndpbmRvdyA9PT0gZSA/IGUgOiAoaCA9IGUub3duZXJEb2N1bWVudCkgPyBoLmRlZmF1bHRWaWV3IHx8IGgucGFyZW50V2luZG93IDogd2luZG93O2lmIChrKSB7aWYgKG4gPSBjLnJlbGF0ZWRUYXJnZXQgfHwgYy50b0VsZW1lbnQsIGsgPSBkLCBuID0gbiA/IFdjKG4pIDogbnVsbCwgbnVsbCAhPT0KICAgICAgICAgICAgICAgICAgICAgIG4gJiYgKEogPSBWYihuKSwgbiAhPT0gSiB8fCA1ICE9PSBuLnRhZyAmJiA2ICE9PSBuLnRhZykpIG4gPSBudWxsO30gZWxzZSBrID0gbnVsbCwgbiA9IGQ7aWYgKGsgIT09IG4pIHt0ID0gQmQ7RiA9ICJvbk1vdXNlTGVhdmUiO3ggPSAib25Nb3VzZUVudGVyIjt3ID0gIm1vdXNlIjtpZiAoInBvaW50ZXJvdXQiID09PSBhIHx8ICJwb2ludGVyb3ZlciIgPT09IGEpIHQgPSBUZCwgRiA9ICJvblBvaW50ZXJMZWF2ZSIsIHggPSAib25Qb2ludGVyRW50ZXIiLCB3ID0gInBvaW50ZXIiO0ogPSBudWxsID09IGsgPyBoIDogdWUoayk7dSA9IG51bGwgPT0gbiA/IGggOiB1ZShuKTtoID0gbmV3IHQoRiwgdyArICJsZWF2ZSIsIGssIGMsIGUpO2gudGFyZ2V0ID0gSjtoLnJlbGF0ZWRUYXJnZXQgPSB1O0YgPSBudWxsO1djKGUpID09PSBkICYmICh0ID0gbmV3IHQoeCwgdyArICJlbnRlciIsIG4sIGMsIGUpLCB0LnRhcmdldCA9IHUsIHQucmVsYXRlZFRhcmdldCA9IEosIEYgPSB0KTtKID0gRjtpZiAoayAmJiBuKSBiOiB7dCA9IGs7eCA9IG47dyA9IDA7Zm9yICh1ID0gdDsgdTsgdSA9IHZmKHUpKSB3Kys7dSA9IDA7Zm9yIChGID0geDsgRjsgRiA9IHZmKEYpKSB1Kys7Zm9yICg7IDAgPCB3IC0gdTspIHQgPSB2Zih0KSwgdy0tO2ZvciAoOyAwIDwgdSAtIHc7KSB4ID0KICAgICAgICAgICAgICAgICAgICAgICAgdmYoeCksIHUtLTtmb3IgKDsgdy0tOykge2lmICh0ID09PSB4IHx8IG51bGwgIT09IHggJiYgdCA9PT0geC5hbHRlcm5hdGUpIGJyZWFrIGI7dCA9IHZmKHQpO3ggPSB2Zih4KTt9dCA9IG51bGw7fSBlbHNlIHQgPSBudWxsO251bGwgIT09IGsgJiYgd2YoZywgaCwgaywgdCwgITEpO251bGwgIT09IG4gJiYgbnVsbCAhPT0gSiAmJiB3ZihnLCBKLCBuLCB0LCAhMCk7fX19YToge2ggPSBkID8gdWUoZCkgOiB3aW5kb3c7ayA9IGgubm9kZU5hbWUgJiYgaC5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpO2lmICgic2VsZWN0IiA9PT0gayB8fCAiaW5wdXQiID09PSBrICYmICJmaWxlIiA9PT0gaC50eXBlKSB2YXIgbmEgPSB2ZTtlbHNlIGlmIChtZShoKSkge2lmICh3ZSkgbmEgPSBGZTtlbHNlIHtuYSA9IERlO3ZhciB4YSA9IENlO319IGVsc2UgKGsgPSBoLm5vZGVOYW1lKSAmJiAiaW5wdXQiID09PSBrLnRvTG93ZXJDYXNlKCkgJiYgKCJjaGVja2JveCIgPT09IGgudHlwZSB8fCAicmFkaW8iID09PSBoLnR5cGUpICYmIChuYSA9IEVlKTtpZiAobmEgJiYgKG5hID0gbmEoYSwgZCkpKSB7bmUoZywgbmEsIGMsIGUpO2JyZWFrIGE7fXhhICYmIHhhKGEsIGgsIGQpOyJmb2N1c291dCIgPT09IGEgJiYgKHhhID0gaC5fd3JhcHBlclN0YXRlKSAmJgogICAgICAgICAgICAgICAgICB4YS5jb250cm9sbGVkICYmICJudW1iZXIiID09PSBoLnR5cGUgJiYgY2IoaCwgIm51bWJlciIsIGgudmFsdWUpO314YSA9IGQgPyB1ZShkKSA6IHdpbmRvdztzd2l0Y2ggKGEpIHtjYXNlICJmb2N1c2luIjppZiAobWUoeGEpIHx8ICJ0cnVlIiA9PT0geGEuY29udGVudEVkaXRhYmxlKSBRZSA9IHhhLCBSZSA9IGQsIFNlID0gbnVsbDticmVhaztjYXNlICJmb2N1c291dCI6U2UgPSBSZSA9IFFlID0gbnVsbDticmVhaztjYXNlICJtb3VzZWRvd24iOlRlID0gITA7YnJlYWs7Y2FzZSAiY29udGV4dG1lbnUiOmNhc2UgIm1vdXNldXAiOmNhc2UgImRyYWdlbmQiOlRlID0gITE7VWUoZywgYywgZSk7YnJlYWs7Y2FzZSAic2VsZWN0aW9uY2hhbmdlIjppZiAoUGUpIGJyZWFrO2Nhc2UgImtleWRvd24iOmNhc2UgImtleXVwIjpVZShnLCBjLCBlKTt9dmFyICRhO2lmIChhZSkgYjoge3N3aXRjaCAoYSkge2Nhc2UgImNvbXBvc2l0aW9uc3RhcnQiOnZhciBiYSA9ICJvbkNvbXBvc2l0aW9uU3RhcnQiO2JyZWFrIGI7Y2FzZSAiY29tcG9zaXRpb25lbmQiOmJhID0gIm9uQ29tcG9zaXRpb25FbmQiOwogICAgICAgICAgICAgICAgICAgICAgYnJlYWsgYjtjYXNlICJjb21wb3NpdGlvbnVwZGF0ZSI6YmEgPSAib25Db21wb3NpdGlvblVwZGF0ZSI7YnJlYWsgYjt9YmEgPSB2b2lkIDA7fSBlbHNlIGllID8gZ2UoYSwgYykgJiYgKGJhID0gIm9uQ29tcG9zaXRpb25FbmQiKSA6ICJrZXlkb3duIiA9PT0gYSAmJiAyMjkgPT09IGMua2V5Q29kZSAmJiAoYmEgPSAib25Db21wb3NpdGlvblN0YXJ0Iik7YmEgJiYgKGRlICYmICJrbyIgIT09IGMubG9jYWxlICYmIChpZSB8fCAib25Db21wb3NpdGlvblN0YXJ0IiAhPT0gYmEgPyAib25Db21wb3NpdGlvbkVuZCIgPT09IGJhICYmIGllICYmICgkYSA9IG5kKCkpIDogKGtkID0gZSwgbGQgPSAidmFsdWUiIGluIGtkID8ga2QudmFsdWUgOiBrZC50ZXh0Q29udGVudCwgaWUgPSAhMCkpLCB4YSA9IG9lKGQsIGJhKSwgMCA8IHhhLmxlbmd0aCAmJiAoYmEgPSBuZXcgTGQoYmEsIGEsIG51bGwsIGMsIGUpLCBnLnB1c2goeyBldmVudDogYmEsIGxpc3RlbmVyczogeGEgfSksICRhID8gYmEuZGF0YSA9ICRhIDogKCRhID0gaGUoYyksIG51bGwgIT09ICRhICYmIChiYS5kYXRhID0gJGEpKSkpO2lmICgkYSA9IGNlID8gamUoYSwgYykgOiBrZShhLCBjKSkgZCA9IG9lKGQsICJvbkJlZm9yZUlucHV0IiksCiAgICAgICAgICAgICAgICAwIDwgZC5sZW5ndGggJiYgKGUgPSBuZXcgTGQoIm9uQmVmb3JlSW5wdXQiLCAiYmVmb3JlaW5wdXQiLCBudWxsLCBjLCBlKSwgZy5wdXNoKHsgZXZlbnQ6IGUsIGxpc3RlbmVyczogZCB9KSwgZS5kYXRhID0gJGEpO31zZShnLCBiKTt9KTt9ZnVuY3Rpb24gdGYoYSwgYiwgYykge3JldHVybiB7IGluc3RhbmNlOiBhLCBsaXN0ZW5lcjogYiwgY3VycmVudFRhcmdldDogYyB9O31mdW5jdGlvbiBvZShhLCBiKSB7Zm9yICh2YXIgYyA9IGIgKyAiQ2FwdHVyZSIsIGQgPSBbXTsgbnVsbCAhPT0gYTspIHt2YXIgZSA9IGEsZiA9IGUuc3RhdGVOb2RlOzUgPT09IGUudGFnICYmIG51bGwgIT09IGYgJiYgKGUgPSBmLCBmID0gS2IoYSwgYyksIG51bGwgIT0gZiAmJiBkLnVuc2hpZnQodGYoYSwgZiwgZSkpLCBmID0gS2IoYSwgYiksIG51bGwgIT0gZiAmJiBkLnB1c2godGYoYSwgZiwgZSkpKTthID0gYS5yZXR1cm47fXJldHVybiBkO31mdW5jdGlvbiB2ZihhKSB7aWYgKG51bGwgPT09IGEpIHJldHVybiBudWxsO2RvIGEgPSBhLnJldHVybjsgd2hpbGUgKGEgJiYgNSAhPT0gYS50YWcpO3JldHVybiBhID8gYSA6IG51bGw7fQogICAgICAgICAgZnVuY3Rpb24gd2YoYSwgYiwgYywgZCwgZSkge2ZvciAodmFyIGYgPSBiLl9yZWFjdE5hbWUsIGcgPSBbXTsgbnVsbCAhPT0gYyAmJiBjICE9PSBkOykge3ZhciBoID0gYyxrID0gaC5hbHRlcm5hdGUsbCA9IGguc3RhdGVOb2RlO2lmIChudWxsICE9PSBrICYmIGsgPT09IGQpIGJyZWFrOzUgPT09IGgudGFnICYmIG51bGwgIT09IGwgJiYgKGggPSBsLCBlID8gKGsgPSBLYihjLCBmKSwgbnVsbCAhPSBrICYmIGcudW5zaGlmdCh0ZihjLCBrLCBoKSkpIDogZSB8fCAoayA9IEtiKGMsIGYpLCBudWxsICE9IGsgJiYgZy5wdXNoKHRmKGMsIGssIGgpKSkpO2MgPSBjLnJldHVybjt9MCAhPT0gZy5sZW5ndGggJiYgYS5wdXNoKHsgZXZlbnQ6IGIsIGxpc3RlbmVyczogZyB9KTt9dmFyIHhmID0gL1xyXG4/L2cseWYgPSAvXHUwMDAwfFx1RkZGRC9nO2Z1bmN0aW9uIHpmKGEpIHtyZXR1cm4gKCJzdHJpbmciID09PSB0eXBlb2YgYSA/IGEgOiAiIiArIGEpLnJlcGxhY2UoeGYsICJcbiIpLnJlcGxhY2UoeWYsICIiKTt9ZnVuY3Rpb24gQWYoYSwgYiwgYykge2IgPSB6ZihiKTtpZiAoemYoYSkgIT09IGIgJiYgYykgdGhyb3cgRXJyb3IocCg0MjUpKTt9ZnVuY3Rpb24gQmYoKSB7fQogICAgICAgICAgdmFyIENmID0gbnVsbCxEZiA9IG51bGw7ZnVuY3Rpb24gRWYoYSwgYikge3JldHVybiAidGV4dGFyZWEiID09PSBhIHx8ICJub3NjcmlwdCIgPT09IGEgfHwgInN0cmluZyIgPT09IHR5cGVvZiBiLmNoaWxkcmVuIHx8ICJudW1iZXIiID09PSB0eXBlb2YgYi5jaGlsZHJlbiB8fCAib2JqZWN0IiA9PT0gdHlwZW9mIGIuZGFuZ2Vyb3VzbHlTZXRJbm5lckhUTUwgJiYgbnVsbCAhPT0gYi5kYW5nZXJvdXNseVNldElubmVySFRNTCAmJiBudWxsICE9IGIuZGFuZ2Vyb3VzbHlTZXRJbm5lckhUTUwuX19odG1sO30KICAgICAgICAgIHZhciBGZiA9ICJmdW5jdGlvbiIgPT09IHR5cGVvZiBzZXRUaW1lb3V0ID8gc2V0VGltZW91dCA6IHZvaWQgMCxHZiA9ICJmdW5jdGlvbiIgPT09IHR5cGVvZiBjbGVhclRpbWVvdXQgPyBjbGVhclRpbWVvdXQgOiB2b2lkIDAsSGYgPSAiZnVuY3Rpb24iID09PSB0eXBlb2YgUHJvbWlzZSA/IFByb21pc2UgOiB2b2lkIDAsSmYgPSAiZnVuY3Rpb24iID09PSB0eXBlb2YgcXVldWVNaWNyb3Rhc2sgPyBxdWV1ZU1pY3JvdGFzayA6ICJ1bmRlZmluZWQiICE9PSB0eXBlb2YgSGYgPyBmdW5jdGlvbiAoYSkge3JldHVybiBIZi5yZXNvbHZlKG51bGwpLnRoZW4oYSkuY2F0Y2goSWYpO30gOiBGZjtmdW5jdGlvbiBJZihhKSB7c2V0VGltZW91dChmdW5jdGlvbiAoKSB7dGhyb3cgYTt9KTt9CiAgICAgICAgICBmdW5jdGlvbiBLZihhLCBiKSB7dmFyIGMgPSBiLGQgPSAwO2RvIHt2YXIgZSA9IGMubmV4dFNpYmxpbmc7YS5yZW1vdmVDaGlsZChjKTtpZiAoZSAmJiA4ID09PSBlLm5vZGVUeXBlKSBpZiAoYyA9IGUuZGF0YSwgIi8kIiA9PT0gYykge2lmICgwID09PSBkKSB7YS5yZW1vdmVDaGlsZChlKTtiZChiKTtyZXR1cm47fWQtLTt9IGVsc2UgIiQiICE9PSBjICYmICIkPyIgIT09IGMgJiYgIiQhIiAhPT0gYyB8fCBkKys7YyA9IGU7fSB3aGlsZSAoYyk7YmQoYik7fWZ1bmN0aW9uIExmKGEpIHtmb3IgKDsgbnVsbCAhPSBhOyBhID0gYS5uZXh0U2libGluZykge3ZhciBiID0gYS5ub2RlVHlwZTtpZiAoMSA9PT0gYiB8fCAzID09PSBiKSBicmVhaztpZiAoOCA9PT0gYikge2IgPSBhLmRhdGE7aWYgKCIkIiA9PT0gYiB8fCAiJCEiID09PSBiIHx8ICIkPyIgPT09IGIpIGJyZWFrO2lmICgiLyQiID09PSBiKSByZXR1cm4gbnVsbDt9fXJldHVybiBhO30KICAgICAgICAgIGZ1bmN0aW9uIE1mKGEpIHthID0gYS5wcmV2aW91c1NpYmxpbmc7Zm9yICh2YXIgYiA9IDA7IGE7KSB7aWYgKDggPT09IGEubm9kZVR5cGUpIHt2YXIgYyA9IGEuZGF0YTtpZiAoIiQiID09PSBjIHx8ICIkISIgPT09IGMgfHwgIiQ/IiA9PT0gYykge2lmICgwID09PSBiKSByZXR1cm4gYTtiLS07fSBlbHNlICIvJCIgPT09IGMgJiYgYisrO31hID0gYS5wcmV2aW91c1NpYmxpbmc7fXJldHVybiBudWxsO312YXIgTmYgPSBNYXRoLnJhbmRvbSgpLnRvU3RyaW5nKDM2KS5zbGljZSgyKSxPZiA9ICJfX3JlYWN0RmliZXIkIiArIE5mLFBmID0gIl9fcmVhY3RQcm9wcyQiICsgTmYsdWYgPSAiX19yZWFjdENvbnRhaW5lciQiICsgTmYsb2YgPSAiX19yZWFjdEV2ZW50cyQiICsgTmYsUWYgPSAiX19yZWFjdExpc3RlbmVycyQiICsgTmYsUmYgPSAiX19yZWFjdEhhbmRsZXMkIiArIE5mOwogICAgICAgICAgZnVuY3Rpb24gV2MoYSkge3ZhciBiID0gYVtPZl07aWYgKGIpIHJldHVybiBiO2ZvciAodmFyIGMgPSBhLnBhcmVudE5vZGU7IGM7KSB7aWYgKGIgPSBjW3VmXSB8fCBjW09mXSkge2MgPSBiLmFsdGVybmF0ZTtpZiAobnVsbCAhPT0gYi5jaGlsZCB8fCBudWxsICE9PSBjICYmIG51bGwgIT09IGMuY2hpbGQpIGZvciAoYSA9IE1mKGEpOyBudWxsICE9PSBhOykge2lmIChjID0gYVtPZl0pIHJldHVybiBjO2EgPSBNZihhKTt9cmV0dXJuIGI7fWEgPSBjO2MgPSBhLnBhcmVudE5vZGU7fXJldHVybiBudWxsO31mdW5jdGlvbiBDYihhKSB7YSA9IGFbT2ZdIHx8IGFbdWZdO3JldHVybiAhYSB8fCA1ICE9PSBhLnRhZyAmJiA2ICE9PSBhLnRhZyAmJiAxMyAhPT0gYS50YWcgJiYgMyAhPT0gYS50YWcgPyBudWxsIDogYTt9ZnVuY3Rpb24gdWUoYSkge2lmICg1ID09PSBhLnRhZyB8fCA2ID09PSBhLnRhZykgcmV0dXJuIGEuc3RhdGVOb2RlO3Rocm93IEVycm9yKHAoMzMpKTt9ZnVuY3Rpb24gRGIoYSkge3JldHVybiBhW1BmXSB8fCBudWxsO312YXIgU2YgPSBbXSxUZiA9IC0xO2Z1bmN0aW9uIFVmKGEpIHtyZXR1cm4geyBjdXJyZW50OiBhIH07fQogICAgICAgICAgZnVuY3Rpb24gRShhKSB7MCA+IFRmIHx8IChhLmN1cnJlbnQgPSBTZltUZl0sIFNmW1RmXSA9IG51bGwsIFRmLS0pO31mdW5jdGlvbiBHKGEsIGIpIHtUZisrO1NmW1RmXSA9IGEuY3VycmVudDthLmN1cnJlbnQgPSBiO312YXIgVmYgPSB7fSxIID0gVWYoVmYpLFdmID0gVWYoITEpLFhmID0gVmY7ZnVuY3Rpb24gWWYoYSwgYikge3ZhciBjID0gYS50eXBlLmNvbnRleHRUeXBlcztpZiAoIWMpIHJldHVybiBWZjt2YXIgZCA9IGEuc3RhdGVOb2RlO2lmIChkICYmIGQuX19yZWFjdEludGVybmFsTWVtb2l6ZWRVbm1hc2tlZENoaWxkQ29udGV4dCA9PT0gYikgcmV0dXJuIGQuX19yZWFjdEludGVybmFsTWVtb2l6ZWRNYXNrZWRDaGlsZENvbnRleHQ7dmFyIGUgPSB7fSxmO2ZvciAoZiBpbiBjKSBlW2ZdID0gYltmXTtkICYmIChhID0gYS5zdGF0ZU5vZGUsIGEuX19yZWFjdEludGVybmFsTWVtb2l6ZWRVbm1hc2tlZENoaWxkQ29udGV4dCA9IGIsIGEuX19yZWFjdEludGVybmFsTWVtb2l6ZWRNYXNrZWRDaGlsZENvbnRleHQgPSBlKTtyZXR1cm4gZTt9CiAgICAgICAgICBmdW5jdGlvbiBaZihhKSB7YSA9IGEuY2hpbGRDb250ZXh0VHlwZXM7cmV0dXJuIG51bGwgIT09IGEgJiYgdm9pZCAwICE9PSBhO31mdW5jdGlvbiAkZigpIHtFKFdmKTtFKEgpO31mdW5jdGlvbiBhZyhhLCBiLCBjKSB7aWYgKEguY3VycmVudCAhPT0gVmYpIHRocm93IEVycm9yKHAoMTY4KSk7RyhILCBiKTtHKFdmLCBjKTt9ZnVuY3Rpb24gYmcoYSwgYiwgYykge3ZhciBkID0gYS5zdGF0ZU5vZGU7YiA9IGIuY2hpbGRDb250ZXh0VHlwZXM7aWYgKCJmdW5jdGlvbiIgIT09IHR5cGVvZiBkLmdldENoaWxkQ29udGV4dCkgcmV0dXJuIGM7ZCA9IGQuZ2V0Q2hpbGRDb250ZXh0KCk7Zm9yICh2YXIgZSBpbiBkKSBpZiAoIShlIGluIGIpKSB0aHJvdyBFcnJvcihwKDEwOCwgUmEoYSkgfHwgIlVua25vd24iLCBlKSk7cmV0dXJuIEEoe30sIGMsIGQpO30KICAgICAgICAgIGZ1bmN0aW9uIGNnKGEpIHthID0gKGEgPSBhLnN0YXRlTm9kZSkgJiYgYS5fX3JlYWN0SW50ZXJuYWxNZW1vaXplZE1lcmdlZENoaWxkQ29udGV4dCB8fCBWZjtYZiA9IEguY3VycmVudDtHKEgsIGEpO0coV2YsIFdmLmN1cnJlbnQpO3JldHVybiAhMDt9ZnVuY3Rpb24gZGcoYSwgYiwgYykge3ZhciBkID0gYS5zdGF0ZU5vZGU7aWYgKCFkKSB0aHJvdyBFcnJvcihwKDE2OSkpO2MgPyAoYSA9IGJnKGEsIGIsIFhmKSwgZC5fX3JlYWN0SW50ZXJuYWxNZW1vaXplZE1lcmdlZENoaWxkQ29udGV4dCA9IGEsIEUoV2YpLCBFKEgpLCBHKEgsIGEpKSA6IEUoV2YpO0coV2YsIGMpO312YXIgZWcgPSBudWxsLGZnID0gITEsZ2cgPSAhMTtmdW5jdGlvbiBoZyhhKSB7bnVsbCA9PT0gZWcgPyBlZyA9IFthXSA6IGVnLnB1c2goYSk7fWZ1bmN0aW9uIGlnKGEpIHtmZyA9ICEwO2hnKGEpO30KICAgICAgICAgIGZ1bmN0aW9uIGpnKCkge2lmICghZ2cgJiYgbnVsbCAhPT0gZWcpIHtnZyA9ICEwO3ZhciBhID0gMCxiID0gQzt0cnkge3ZhciBjID0gZWc7Zm9yIChDID0gMTsgYSA8IGMubGVuZ3RoOyBhKyspIHt2YXIgZCA9IGNbYV07ZG8gZCA9IGQoITApOyB3aGlsZSAobnVsbCAhPT0gZCk7fWVnID0gbnVsbDtmZyA9ICExO30gY2F0Y2ggKGUpIHt0aHJvdyBudWxsICE9PSBlZyAmJiAoZWcgPSBlZy5zbGljZShhICsgMSkpLCBhYyhmYywgamcpLCBlO30gZmluYWxseSB7QyA9IGIsIGdnID0gITE7fX1yZXR1cm4gbnVsbDt9dmFyIGtnID0gW10sbGcgPSAwLG1nID0gbnVsbCxuZyA9IDAsb2cgPSBbXSxwZyA9IDAscWcgPSBudWxsLHJnID0gMSxzZyA9ICIiO2Z1bmN0aW9uIHRnKGEsIGIpIHtrZ1tsZysrXSA9IG5nO2tnW2xnKytdID0gbWc7bWcgPSBhO25nID0gYjt9CiAgICAgICAgICBmdW5jdGlvbiB1ZyhhLCBiLCBjKSB7b2dbcGcrK10gPSByZztvZ1twZysrXSA9IHNnO29nW3BnKytdID0gcWc7cWcgPSBhO3ZhciBkID0gcmc7YSA9IHNnO3ZhciBlID0gMzIgLSBvYyhkKSAtIDE7ZCAmPSB+KDEgPDwgZSk7YyArPSAxO3ZhciBmID0gMzIgLSBvYyhiKSArIGU7aWYgKDMwIDwgZikge3ZhciBnID0gZSAtIGUgJSA1O2YgPSAoZCAmICgxIDw8IGcpIC0gMSkudG9TdHJpbmcoMzIpO2QgPj49IGc7ZSAtPSBnO3JnID0gMSA8PCAzMiAtIG9jKGIpICsgZSB8IGMgPDwgZSB8IGQ7c2cgPSBmICsgYTt9IGVsc2UgcmcgPSAxIDw8IGYgfCBjIDw8IGUgfCBkLCBzZyA9IGE7fWZ1bmN0aW9uIHZnKGEpIHtudWxsICE9PSBhLnJldHVybiAmJiAodGcoYSwgMSksIHVnKGEsIDEsIDApKTt9ZnVuY3Rpb24gd2coYSkge2ZvciAoOyBhID09PSBtZzspIG1nID0ga2dbLS1sZ10sIGtnW2xnXSA9IG51bGwsIG5nID0ga2dbLS1sZ10sIGtnW2xnXSA9IG51bGw7Zm9yICg7IGEgPT09IHFnOykgcWcgPSBvZ1stLXBnXSwgb2dbcGddID0gbnVsbCwgc2cgPSBvZ1stLXBnXSwgb2dbcGddID0gbnVsbCwgcmcgPSBvZ1stLXBnXSwgb2dbcGddID0gbnVsbDt9dmFyIHhnID0gbnVsbCx5ZyA9IG51bGwsSSA9ICExLHpnID0gbnVsbDsKICAgICAgICAgIGZ1bmN0aW9uIEFnKGEsIGIpIHt2YXIgYyA9IEJnKDUsIG51bGwsIG51bGwsIDApO2MuZWxlbWVudFR5cGUgPSAiREVMRVRFRCI7Yy5zdGF0ZU5vZGUgPSBiO2MucmV0dXJuID0gYTtiID0gYS5kZWxldGlvbnM7bnVsbCA9PT0gYiA/IChhLmRlbGV0aW9ucyA9IFtjXSwgYS5mbGFncyB8PSAxNikgOiBiLnB1c2goYyk7fQogICAgICAgICAgZnVuY3Rpb24gQ2coYSwgYikge3N3aXRjaCAoYS50YWcpIHtjYXNlIDU6dmFyIGMgPSBhLnR5cGU7YiA9IDEgIT09IGIubm9kZVR5cGUgfHwgYy50b0xvd2VyQ2FzZSgpICE9PSBiLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCkgPyBudWxsIDogYjtyZXR1cm4gbnVsbCAhPT0gYiA/IChhLnN0YXRlTm9kZSA9IGIsIHhnID0gYSwgeWcgPSBMZihiLmZpcnN0Q2hpbGQpLCAhMCkgOiAhMTtjYXNlIDY6cmV0dXJuIGIgPSAiIiA9PT0gYS5wZW5kaW5nUHJvcHMgfHwgMyAhPT0gYi5ub2RlVHlwZSA/IG51bGwgOiBiLCBudWxsICE9PSBiID8gKGEuc3RhdGVOb2RlID0gYiwgeGcgPSBhLCB5ZyA9IG51bGwsICEwKSA6ICExO2Nhc2UgMTM6cmV0dXJuIGIgPSA4ICE9PSBiLm5vZGVUeXBlID8gbnVsbCA6IGIsIG51bGwgIT09IGIgPyAoYyA9IG51bGwgIT09IHFnID8geyBpZDogcmcsIG92ZXJmbG93OiBzZyB9IDogbnVsbCwgYS5tZW1vaXplZFN0YXRlID0geyBkZWh5ZHJhdGVkOiBiLCB0cmVlQ29udGV4dDogYywgcmV0cnlMYW5lOiAxMDczNzQxODI0IH0sIGMgPSBCZygxOCwgbnVsbCwgbnVsbCwgMCksIGMuc3RhdGVOb2RlID0gYiwgYy5yZXR1cm4gPSBhLCBhLmNoaWxkID0gYywgeGcgPSBhLCB5ZyA9CiAgICAgICAgICAgICAgICBudWxsLCAhMCkgOiAhMTtkZWZhdWx0OnJldHVybiAhMTt9fWZ1bmN0aW9uIERnKGEpIHtyZXR1cm4gMCAhPT0gKGEubW9kZSAmIDEpICYmIDAgPT09IChhLmZsYWdzICYgMTI4KTt9ZnVuY3Rpb24gRWcoYSkge2lmIChJKSB7dmFyIGIgPSB5ZztpZiAoYikge3ZhciBjID0gYjtpZiAoIUNnKGEsIGIpKSB7aWYgKERnKGEpKSB0aHJvdyBFcnJvcihwKDQxOCkpO2IgPSBMZihjLm5leHRTaWJsaW5nKTt2YXIgZCA9IHhnO2IgJiYgQ2coYSwgYikgPyBBZyhkLCBjKSA6IChhLmZsYWdzID0gYS5mbGFncyAmIC00MDk3IHwgMiwgSSA9ICExLCB4ZyA9IGEpO319IGVsc2Uge2lmIChEZyhhKSkgdGhyb3cgRXJyb3IocCg0MTgpKTthLmZsYWdzID0gYS5mbGFncyAmIC00MDk3IHwgMjtJID0gITE7eGcgPSBhO319fWZ1bmN0aW9uIEZnKGEpIHtmb3IgKGEgPSBhLnJldHVybjsgbnVsbCAhPT0gYSAmJiA1ICE9PSBhLnRhZyAmJiAzICE9PSBhLnRhZyAmJiAxMyAhPT0gYS50YWc7KSBhID0gYS5yZXR1cm47eGcgPSBhO30KICAgICAgICAgIGZ1bmN0aW9uIEdnKGEpIHtpZiAoYSAhPT0geGcpIHJldHVybiAhMTtpZiAoIUkpIHJldHVybiBGZyhhKSwgSSA9ICEwLCAhMTt2YXIgYjsoYiA9IDMgIT09IGEudGFnKSAmJiAhKGIgPSA1ICE9PSBhLnRhZykgJiYgKGIgPSBhLnR5cGUsIGIgPSAiaGVhZCIgIT09IGIgJiYgImJvZHkiICE9PSBiICYmICFFZihhLnR5cGUsIGEubWVtb2l6ZWRQcm9wcykpO2lmIChiICYmIChiID0geWcpKSB7aWYgKERnKGEpKSB0aHJvdyBIZygpLCBFcnJvcihwKDQxOCkpO2ZvciAoOyBiOykgQWcoYSwgYiksIGIgPSBMZihiLm5leHRTaWJsaW5nKTt9RmcoYSk7aWYgKDEzID09PSBhLnRhZykge2EgPSBhLm1lbW9pemVkU3RhdGU7YSA9IG51bGwgIT09IGEgPyBhLmRlaHlkcmF0ZWQgOiBudWxsO2lmICghYSkgdGhyb3cgRXJyb3IocCgzMTcpKTthOiB7YSA9IGEubmV4dFNpYmxpbmc7Zm9yIChiID0gMDsgYTspIHtpZiAoOCA9PT0gYS5ub2RlVHlwZSkge3ZhciBjID0gYS5kYXRhO2lmICgiLyQiID09PSBjKSB7aWYgKDAgPT09IGIpIHt5ZyA9IExmKGEubmV4dFNpYmxpbmcpO2JyZWFrIGE7fWItLTt9IGVsc2UgIiQiICE9PSBjICYmICIkISIgIT09IGMgJiYgIiQ/IiAhPT0gYyB8fCBiKys7fWEgPSBhLm5leHRTaWJsaW5nO315ZyA9CiAgICAgICAgICAgICAgICBudWxsO319IGVsc2UgeWcgPSB4ZyA/IExmKGEuc3RhdGVOb2RlLm5leHRTaWJsaW5nKSA6IG51bGw7cmV0dXJuICEwO31mdW5jdGlvbiBIZygpIHtmb3IgKHZhciBhID0geWc7IGE7KSBhID0gTGYoYS5uZXh0U2libGluZyk7fWZ1bmN0aW9uIElnKCkge3lnID0geGcgPSBudWxsO0kgPSAhMTt9ZnVuY3Rpb24gSmcoYSkge251bGwgPT09IHpnID8gemcgPSBbYV0gOiB6Zy5wdXNoKGEpO312YXIgS2cgPSB1YS5SZWFjdEN1cnJlbnRCYXRjaENvbmZpZztmdW5jdGlvbiBMZyhhLCBiKSB7aWYgKGEgJiYgYS5kZWZhdWx0UHJvcHMpIHtiID0gQSh7fSwgYik7YSA9IGEuZGVmYXVsdFByb3BzO2ZvciAodmFyIGMgaW4gYSkgdm9pZCAwID09PSBiW2NdICYmIChiW2NdID0gYVtjXSk7cmV0dXJuIGI7fXJldHVybiBiO312YXIgTWcgPSBVZihudWxsKSxOZyA9IG51bGwsT2cgPSBudWxsLFBnID0gbnVsbDtmdW5jdGlvbiBRZygpIHtQZyA9IE9nID0gTmcgPSBudWxsO31mdW5jdGlvbiBSZyhhKSB7dmFyIGIgPSBNZy5jdXJyZW50O0UoTWcpO2EuX2N1cnJlbnRWYWx1ZSA9IGI7fQogICAgICAgICAgZnVuY3Rpb24gU2coYSwgYiwgYykge2ZvciAoOyBudWxsICE9PSBhOykge3ZhciBkID0gYS5hbHRlcm5hdGU7KGEuY2hpbGRMYW5lcyAmIGIpICE9PSBiID8gKGEuY2hpbGRMYW5lcyB8PSBiLCBudWxsICE9PSBkICYmIChkLmNoaWxkTGFuZXMgfD0gYikpIDogbnVsbCAhPT0gZCAmJiAoZC5jaGlsZExhbmVzICYgYikgIT09IGIgJiYgKGQuY2hpbGRMYW5lcyB8PSBiKTtpZiAoYSA9PT0gYykgYnJlYWs7YSA9IGEucmV0dXJuO319ZnVuY3Rpb24gVGcoYSwgYikge05nID0gYTtQZyA9IE9nID0gbnVsbDthID0gYS5kZXBlbmRlbmNpZXM7bnVsbCAhPT0gYSAmJiBudWxsICE9PSBhLmZpcnN0Q29udGV4dCAmJiAoMCAhPT0gKGEubGFuZXMgJiBiKSAmJiAoVWcgPSAhMCksIGEuZmlyc3RDb250ZXh0ID0gbnVsbCk7fQogICAgICAgICAgZnVuY3Rpb24gVmcoYSkge3ZhciBiID0gYS5fY3VycmVudFZhbHVlO2lmIChQZyAhPT0gYSkgaWYgKGEgPSB7IGNvbnRleHQ6IGEsIG1lbW9pemVkVmFsdWU6IGIsIG5leHQ6IG51bGwgfSwgbnVsbCA9PT0gT2cpIHtpZiAobnVsbCA9PT0gTmcpIHRocm93IEVycm9yKHAoMzA4KSk7T2cgPSBhO05nLmRlcGVuZGVuY2llcyA9IHsgbGFuZXM6IDAsIGZpcnN0Q29udGV4dDogYSB9O30gZWxzZSBPZyA9IE9nLm5leHQgPSBhO3JldHVybiBiO312YXIgV2cgPSBudWxsO2Z1bmN0aW9uIFhnKGEpIHtudWxsID09PSBXZyA/IFdnID0gW2FdIDogV2cucHVzaChhKTt9ZnVuY3Rpb24gWWcoYSwgYiwgYywgZCkge3ZhciBlID0gYi5pbnRlcmxlYXZlZDtudWxsID09PSBlID8gKGMubmV4dCA9IGMsIFhnKGIpKSA6IChjLm5leHQgPSBlLm5leHQsIGUubmV4dCA9IGMpO2IuaW50ZXJsZWF2ZWQgPSBjO3JldHVybiBaZyhhLCBkKTt9CiAgICAgICAgICBmdW5jdGlvbiBaZyhhLCBiKSB7YS5sYW5lcyB8PSBiO3ZhciBjID0gYS5hbHRlcm5hdGU7bnVsbCAhPT0gYyAmJiAoYy5sYW5lcyB8PSBiKTtjID0gYTtmb3IgKGEgPSBhLnJldHVybjsgbnVsbCAhPT0gYTspIGEuY2hpbGRMYW5lcyB8PSBiLCBjID0gYS5hbHRlcm5hdGUsIG51bGwgIT09IGMgJiYgKGMuY2hpbGRMYW5lcyB8PSBiKSwgYyA9IGEsIGEgPSBhLnJldHVybjtyZXR1cm4gMyA9PT0gYy50YWcgPyBjLnN0YXRlTm9kZSA6IG51bGw7fXZhciAkZyA9ICExO2Z1bmN0aW9uIGFoKGEpIHthLnVwZGF0ZVF1ZXVlID0geyBiYXNlU3RhdGU6IGEubWVtb2l6ZWRTdGF0ZSwgZmlyc3RCYXNlVXBkYXRlOiBudWxsLCBsYXN0QmFzZVVwZGF0ZTogbnVsbCwgc2hhcmVkOiB7IHBlbmRpbmc6IG51bGwsIGludGVybGVhdmVkOiBudWxsLCBsYW5lczogMCB9LCBlZmZlY3RzOiBudWxsIH07fQogICAgICAgICAgZnVuY3Rpb24gYmgoYSwgYikge2EgPSBhLnVwZGF0ZVF1ZXVlO2IudXBkYXRlUXVldWUgPT09IGEgJiYgKGIudXBkYXRlUXVldWUgPSB7IGJhc2VTdGF0ZTogYS5iYXNlU3RhdGUsIGZpcnN0QmFzZVVwZGF0ZTogYS5maXJzdEJhc2VVcGRhdGUsIGxhc3RCYXNlVXBkYXRlOiBhLmxhc3RCYXNlVXBkYXRlLCBzaGFyZWQ6IGEuc2hhcmVkLCBlZmZlY3RzOiBhLmVmZmVjdHMgfSk7fWZ1bmN0aW9uIGNoKGEsIGIpIHtyZXR1cm4geyBldmVudFRpbWU6IGEsIGxhbmU6IGIsIHRhZzogMCwgcGF5bG9hZDogbnVsbCwgY2FsbGJhY2s6IG51bGwsIG5leHQ6IG51bGwgfTt9CiAgICAgICAgICBmdW5jdGlvbiBkaChhLCBiLCBjKSB7dmFyIGQgPSBhLnVwZGF0ZVF1ZXVlO2lmIChudWxsID09PSBkKSByZXR1cm4gbnVsbDtkID0gZC5zaGFyZWQ7aWYgKDAgIT09IChLICYgMikpIHt2YXIgZSA9IGQucGVuZGluZztudWxsID09PSBlID8gYi5uZXh0ID0gYiA6IChiLm5leHQgPSBlLm5leHQsIGUubmV4dCA9IGIpO2QucGVuZGluZyA9IGI7cmV0dXJuIFpnKGEsIGMpO31lID0gZC5pbnRlcmxlYXZlZDtudWxsID09PSBlID8gKGIubmV4dCA9IGIsIFhnKGQpKSA6IChiLm5leHQgPSBlLm5leHQsIGUubmV4dCA9IGIpO2QuaW50ZXJsZWF2ZWQgPSBiO3JldHVybiBaZyhhLCBjKTt9ZnVuY3Rpb24gZWgoYSwgYiwgYykge2IgPSBiLnVwZGF0ZVF1ZXVlO2lmIChudWxsICE9PSBiICYmIChiID0gYi5zaGFyZWQsIDAgIT09IChjICYgNDE5NDI0MCkpKSB7dmFyIGQgPSBiLmxhbmVzO2QgJj0gYS5wZW5kaW5nTGFuZXM7YyB8PSBkO2IubGFuZXMgPSBjO0NjKGEsIGMpO319CiAgICAgICAgICBmdW5jdGlvbiBmaChhLCBiKSB7dmFyIGMgPSBhLnVwZGF0ZVF1ZXVlLGQgPSBhLmFsdGVybmF0ZTtpZiAobnVsbCAhPT0gZCAmJiAoZCA9IGQudXBkYXRlUXVldWUsIGMgPT09IGQpKSB7dmFyIGUgPSBudWxsLGYgPSBudWxsO2MgPSBjLmZpcnN0QmFzZVVwZGF0ZTtpZiAobnVsbCAhPT0gYykge2RvIHt2YXIgZyA9IHsgZXZlbnRUaW1lOiBjLmV2ZW50VGltZSwgbGFuZTogYy5sYW5lLCB0YWc6IGMudGFnLCBwYXlsb2FkOiBjLnBheWxvYWQsIGNhbGxiYWNrOiBjLmNhbGxiYWNrLCBuZXh0OiBudWxsIH07bnVsbCA9PT0gZiA/IGUgPSBmID0gZyA6IGYgPSBmLm5leHQgPSBnO2MgPSBjLm5leHQ7fSB3aGlsZSAobnVsbCAhPT0gYyk7bnVsbCA9PT0gZiA/IGUgPSBmID0gYiA6IGYgPSBmLm5leHQgPSBiO30gZWxzZSBlID0gZiA9IGI7YyA9IHsgYmFzZVN0YXRlOiBkLmJhc2VTdGF0ZSwgZmlyc3RCYXNlVXBkYXRlOiBlLCBsYXN0QmFzZVVwZGF0ZTogZiwgc2hhcmVkOiBkLnNoYXJlZCwgZWZmZWN0czogZC5lZmZlY3RzIH07YS51cGRhdGVRdWV1ZSA9IGM7cmV0dXJuO31hID0gYy5sYXN0QmFzZVVwZGF0ZTtudWxsID09PSBhID8gYy5maXJzdEJhc2VVcGRhdGUgPSBiIDogYS5uZXh0ID0KICAgICAgICAgICAgYjtjLmxhc3RCYXNlVXBkYXRlID0gYjt9CiAgICAgICAgICBmdW5jdGlvbiBnaChhLCBiLCBjLCBkKSB7dmFyIGUgPSBhLnVwZGF0ZVF1ZXVlOyRnID0gITE7dmFyIGYgPSBlLmZpcnN0QmFzZVVwZGF0ZSxnID0gZS5sYXN0QmFzZVVwZGF0ZSxoID0gZS5zaGFyZWQucGVuZGluZztpZiAobnVsbCAhPT0gaCkge2Uuc2hhcmVkLnBlbmRpbmcgPSBudWxsO3ZhciBrID0gaCxsID0gay5uZXh0O2submV4dCA9IG51bGw7bnVsbCA9PT0gZyA/IGYgPSBsIDogZy5uZXh0ID0gbDtnID0gazt2YXIgbSA9IGEuYWx0ZXJuYXRlO251bGwgIT09IG0gJiYgKG0gPSBtLnVwZGF0ZVF1ZXVlLCBoID0gbS5sYXN0QmFzZVVwZGF0ZSwgaCAhPT0gZyAmJiAobnVsbCA9PT0gaCA/IG0uZmlyc3RCYXNlVXBkYXRlID0gbCA6IGgubmV4dCA9IGwsIG0ubGFzdEJhc2VVcGRhdGUgPSBrKSk7fWlmIChudWxsICE9PSBmKSB7dmFyIHEgPSBlLmJhc2VTdGF0ZTtnID0gMDttID0gbCA9IGsgPSBudWxsO2ggPSBmO2RvIHt2YXIgciA9IGgubGFuZSx5ID0gaC5ldmVudFRpbWU7aWYgKChkICYgcikgPT09IHIpIHtudWxsICE9PSBtICYmIChtID0gbS5uZXh0ID0geyBldmVudFRpbWU6IHksIGxhbmU6IDAsIHRhZzogaC50YWcsIHBheWxvYWQ6IGgucGF5bG9hZCwgY2FsbGJhY2s6IGguY2FsbGJhY2ssCiAgICAgICAgICAgICAgICAgICAgbmV4dDogbnVsbCB9KTthOiB7dmFyIG4gPSBhLHQgPSBoO3IgPSBiO3kgPSBjO3N3aXRjaCAodC50YWcpIHtjYXNlIDE6biA9IHQucGF5bG9hZDtpZiAoImZ1bmN0aW9uIiA9PT0gdHlwZW9mIG4pIHtxID0gbi5jYWxsKHksIHEsIHIpO2JyZWFrIGE7fXEgPSBuO2JyZWFrIGE7Y2FzZSAzOm4uZmxhZ3MgPSBuLmZsYWdzICYgLTY1NTM3IHwgMTI4O2Nhc2UgMDpuID0gdC5wYXlsb2FkO3IgPSAiZnVuY3Rpb24iID09PSB0eXBlb2YgbiA/IG4uY2FsbCh5LCBxLCByKSA6IG47aWYgKG51bGwgPT09IHIgfHwgdm9pZCAwID09PSByKSBicmVhayBhO3EgPSBBKHt9LCBxLCByKTticmVhayBhO2Nhc2UgMjokZyA9ICEwO319bnVsbCAhPT0gaC5jYWxsYmFjayAmJiAwICE9PSBoLmxhbmUgJiYgKGEuZmxhZ3MgfD0gNjQsIHIgPSBlLmVmZmVjdHMsIG51bGwgPT09IHIgPyBlLmVmZmVjdHMgPSBbaF0gOiByLnB1c2goaCkpO30gZWxzZSB5ID0geyBldmVudFRpbWU6IHksIGxhbmU6IHIsIHRhZzogaC50YWcsIHBheWxvYWQ6IGgucGF5bG9hZCwgY2FsbGJhY2s6IGguY2FsbGJhY2ssIG5leHQ6IG51bGwgfSwgbnVsbCA9PT0gbSA/IChsID0gbSA9IHksIGsgPSBxKSA6IG0gPSBtLm5leHQgPSB5LCBnIHw9IHI7CiAgICAgICAgICAgICAgICBoID0gaC5uZXh0O2lmIChudWxsID09PSBoKSBpZiAoaCA9IGUuc2hhcmVkLnBlbmRpbmcsIG51bGwgPT09IGgpIGJyZWFrO2Vsc2UgciA9IGgsIGggPSByLm5leHQsIHIubmV4dCA9IG51bGwsIGUubGFzdEJhc2VVcGRhdGUgPSByLCBlLnNoYXJlZC5wZW5kaW5nID0gbnVsbDt9IHdoaWxlICgxKTtudWxsID09PSBtICYmIChrID0gcSk7ZS5iYXNlU3RhdGUgPSBrO2UuZmlyc3RCYXNlVXBkYXRlID0gbDtlLmxhc3RCYXNlVXBkYXRlID0gbTtiID0gZS5zaGFyZWQuaW50ZXJsZWF2ZWQ7aWYgKG51bGwgIT09IGIpIHtlID0gYjtkbyBnIHw9IGUubGFuZSwgZSA9IGUubmV4dDsgd2hpbGUgKGUgIT09IGIpO30gZWxzZSBudWxsID09PSBmICYmIChlLnNoYXJlZC5sYW5lcyA9IDApO2hoIHw9IGc7YS5sYW5lcyA9IGc7YS5tZW1vaXplZFN0YXRlID0gcTt9fQogICAgICAgICAgZnVuY3Rpb24gaWgoYSwgYiwgYykge2EgPSBiLmVmZmVjdHM7Yi5lZmZlY3RzID0gbnVsbDtpZiAobnVsbCAhPT0gYSkgZm9yIChiID0gMDsgYiA8IGEubGVuZ3RoOyBiKyspIHt2YXIgZCA9IGFbYl0sZSA9IGQuY2FsbGJhY2s7aWYgKG51bGwgIT09IGUpIHtkLmNhbGxiYWNrID0gbnVsbDtkID0gYztpZiAoImZ1bmN0aW9uIiAhPT0gdHlwZW9mIGUpIHRocm93IEVycm9yKHAoMTkxLCBlKSk7ZS5jYWxsKGQpO319fXZhciBqaCA9IG5ldyBhYS5Db21wb25lbnQoKS5yZWZzO2Z1bmN0aW9uIGtoKGEsIGIsIGMsIGQpIHtiID0gYS5tZW1vaXplZFN0YXRlO2MgPSBjKGQsIGIpO2MgPSBudWxsID09PSBjIHx8IHZvaWQgMCA9PT0gYyA/IGIgOiBBKHt9LCBiLCBjKTthLm1lbW9pemVkU3RhdGUgPSBjOzAgPT09IGEubGFuZXMgJiYgKGEudXBkYXRlUXVldWUuYmFzZVN0YXRlID0gYyk7fQogICAgICAgICAgdmFyIG5oID0geyBpc01vdW50ZWQ6IGZ1bmN0aW9uIGlzTW91bnRlZChhKSB7cmV0dXJuIChhID0gYS5fcmVhY3RJbnRlcm5hbHMpID8gVmIoYSkgPT09IGEgOiAhMTt9LCBlbnF1ZXVlU2V0U3RhdGU6IGZ1bmN0aW9uIGVucXVldWVTZXRTdGF0ZShhLCBiLCBjKSB7YSA9IGEuX3JlYWN0SW50ZXJuYWxzO3ZhciBkID0gTCgpLGUgPSBsaChhKSxmID0gY2goZCwgZSk7Zi5wYXlsb2FkID0gYjt2b2lkIDAgIT09IGMgJiYgbnVsbCAhPT0gYyAmJiAoZi5jYWxsYmFjayA9IGMpO2IgPSBkaChhLCBmLCBlKTtudWxsICE9PSBiICYmIChtaChiLCBhLCBlLCBkKSwgZWgoYiwgYSwgZSkpO30sIGVucXVldWVSZXBsYWNlU3RhdGU6IGZ1bmN0aW9uIGVucXVldWVSZXBsYWNlU3RhdGUoYSwgYiwgYykge2EgPSBhLl9yZWFjdEludGVybmFsczt2YXIgZCA9IEwoKSxlID0gbGgoYSksZiA9IGNoKGQsIGUpO2YudGFnID0gMTtmLnBheWxvYWQgPSBiO3ZvaWQgMCAhPT0gYyAmJiBudWxsICE9PSBjICYmIChmLmNhbGxiYWNrID0gYyk7YiA9IGRoKGEsIGYsIGUpO251bGwgIT09IGIgJiYgKG1oKGIsIGEsIGUsIGQpLCBlaChiLCBhLCBlKSk7fSwgZW5xdWV1ZUZvcmNlVXBkYXRlOiBmdW5jdGlvbiBlbnF1ZXVlRm9yY2VVcGRhdGUoYSwgYikge2EgPSBhLl9yZWFjdEludGVybmFsczt2YXIgYyA9IEwoKSxkID0KICAgICAgICAgICAgICAgIGxoKGEpLGUgPSBjaChjLCBkKTtlLnRhZyA9IDI7dm9pZCAwICE9PSBiICYmIG51bGwgIT09IGIgJiYgKGUuY2FsbGJhY2sgPSBiKTtiID0gZGgoYSwgZSwgZCk7bnVsbCAhPT0gYiAmJiAobWgoYiwgYSwgZCwgYyksIGVoKGIsIGEsIGQpKTt9IH07ZnVuY3Rpb24gb2goYSwgYiwgYywgZCwgZSwgZiwgZykge2EgPSBhLnN0YXRlTm9kZTtyZXR1cm4gImZ1bmN0aW9uIiA9PT0gdHlwZW9mIGEuc2hvdWxkQ29tcG9uZW50VXBkYXRlID8gYS5zaG91bGRDb21wb25lbnRVcGRhdGUoZCwgZiwgZykgOiBiLnByb3RvdHlwZSAmJiBiLnByb3RvdHlwZS5pc1B1cmVSZWFjdENvbXBvbmVudCA/ICFJZShjLCBkKSB8fCAhSWUoZSwgZikgOiAhMDt9CiAgICAgICAgICBmdW5jdGlvbiBwaChhLCBiLCBjKSB7dmFyIGQgPSAhMSxlID0gVmY7dmFyIGYgPSBiLmNvbnRleHRUeXBlOyJvYmplY3QiID09PSB0eXBlb2YgZiAmJiBudWxsICE9PSBmID8gZiA9IFZnKGYpIDogKGUgPSBaZihiKSA/IFhmIDogSC5jdXJyZW50LCBkID0gYi5jb250ZXh0VHlwZXMsIGYgPSAoZCA9IG51bGwgIT09IGQgJiYgdm9pZCAwICE9PSBkKSA/IFlmKGEsIGUpIDogVmYpO2IgPSBuZXcgYihjLCBmKTthLm1lbW9pemVkU3RhdGUgPSBudWxsICE9PSBiLnN0YXRlICYmIHZvaWQgMCAhPT0gYi5zdGF0ZSA/IGIuc3RhdGUgOiBudWxsO2IudXBkYXRlciA9IG5oO2Euc3RhdGVOb2RlID0gYjtiLl9yZWFjdEludGVybmFscyA9IGE7ZCAmJiAoYSA9IGEuc3RhdGVOb2RlLCBhLl9fcmVhY3RJbnRlcm5hbE1lbW9pemVkVW5tYXNrZWRDaGlsZENvbnRleHQgPSBlLCBhLl9fcmVhY3RJbnRlcm5hbE1lbW9pemVkTWFza2VkQ2hpbGRDb250ZXh0ID0gZik7cmV0dXJuIGI7fQogICAgICAgICAgZnVuY3Rpb24gcWgoYSwgYiwgYywgZCkge2EgPSBiLnN0YXRlOyJmdW5jdGlvbiIgPT09IHR5cGVvZiBiLmNvbXBvbmVudFdpbGxSZWNlaXZlUHJvcHMgJiYgYi5jb21wb25lbnRXaWxsUmVjZWl2ZVByb3BzKGMsIGQpOyJmdW5jdGlvbiIgPT09IHR5cGVvZiBiLlVOU0FGRV9jb21wb25lbnRXaWxsUmVjZWl2ZVByb3BzICYmIGIuVU5TQUZFX2NvbXBvbmVudFdpbGxSZWNlaXZlUHJvcHMoYywgZCk7Yi5zdGF0ZSAhPT0gYSAmJiBuaC5lbnF1ZXVlUmVwbGFjZVN0YXRlKGIsIGIuc3RhdGUsIG51bGwpO30KICAgICAgICAgIGZ1bmN0aW9uIHJoKGEsIGIsIGMsIGQpIHt2YXIgZSA9IGEuc3RhdGVOb2RlO2UucHJvcHMgPSBjO2Uuc3RhdGUgPSBhLm1lbW9pemVkU3RhdGU7ZS5yZWZzID0gamg7YWgoYSk7dmFyIGYgPSBiLmNvbnRleHRUeXBlOyJvYmplY3QiID09PSB0eXBlb2YgZiAmJiBudWxsICE9PSBmID8gZS5jb250ZXh0ID0gVmcoZikgOiAoZiA9IFpmKGIpID8gWGYgOiBILmN1cnJlbnQsIGUuY29udGV4dCA9IFlmKGEsIGYpKTtlLnN0YXRlID0gYS5tZW1vaXplZFN0YXRlO2YgPSBiLmdldERlcml2ZWRTdGF0ZUZyb21Qcm9wczsiZnVuY3Rpb24iID09PSB0eXBlb2YgZiAmJiAoa2goYSwgYiwgZiwgYyksIGUuc3RhdGUgPSBhLm1lbW9pemVkU3RhdGUpOyJmdW5jdGlvbiIgPT09IHR5cGVvZiBiLmdldERlcml2ZWRTdGF0ZUZyb21Qcm9wcyB8fCAiZnVuY3Rpb24iID09PSB0eXBlb2YgZS5nZXRTbmFwc2hvdEJlZm9yZVVwZGF0ZSB8fCAiZnVuY3Rpb24iICE9PSB0eXBlb2YgZS5VTlNBRkVfY29tcG9uZW50V2lsbE1vdW50ICYmICJmdW5jdGlvbiIgIT09IHR5cGVvZiBlLmNvbXBvbmVudFdpbGxNb3VudCB8fCAoYiA9IGUuc3RhdGUsCiAgICAgICAgICAgICJmdW5jdGlvbiIgPT09IHR5cGVvZiBlLmNvbXBvbmVudFdpbGxNb3VudCAmJiBlLmNvbXBvbmVudFdpbGxNb3VudCgpLCAiZnVuY3Rpb24iID09PSB0eXBlb2YgZS5VTlNBRkVfY29tcG9uZW50V2lsbE1vdW50ICYmIGUuVU5TQUZFX2NvbXBvbmVudFdpbGxNb3VudCgpLCBiICE9PSBlLnN0YXRlICYmIG5oLmVucXVldWVSZXBsYWNlU3RhdGUoZSwgZS5zdGF0ZSwgbnVsbCksIGdoKGEsIGMsIGUsIGQpLCBlLnN0YXRlID0gYS5tZW1vaXplZFN0YXRlKTsiZnVuY3Rpb24iID09PSB0eXBlb2YgZS5jb21wb25lbnREaWRNb3VudCAmJiAoYS5mbGFncyB8PSA0MTk0MzA4KTt9CiAgICAgICAgICBmdW5jdGlvbiBzaChhLCBiLCBjKSB7YSA9IGMucmVmO2lmIChudWxsICE9PSBhICYmICJmdW5jdGlvbiIgIT09IHR5cGVvZiBhICYmICJvYmplY3QiICE9PSB0eXBlb2YgYSkge2lmIChjLl9vd25lcikge2MgPSBjLl9vd25lcjtpZiAoYykge2lmICgxICE9PSBjLnRhZykgdGhyb3cgRXJyb3IocCgzMDkpKTt2YXIgZCA9IGMuc3RhdGVOb2RlO31pZiAoIWQpIHRocm93IEVycm9yKHAoMTQ3LCBhKSk7dmFyIGUgPSBkLGYgPSAiIiArIGE7aWYgKG51bGwgIT09IGIgJiYgbnVsbCAhPT0gYi5yZWYgJiYgImZ1bmN0aW9uIiA9PT0gdHlwZW9mIGIucmVmICYmIGIucmVmLl9zdHJpbmdSZWYgPT09IGYpIHJldHVybiBiLnJlZjtiID0gZnVuY3Rpb24gYihhKSB7dmFyIGIgPSBlLnJlZnM7YiA9PT0gamggJiYgKGIgPSBlLnJlZnMgPSB7fSk7bnVsbCA9PT0gYSA/IGRlbGV0ZSBiW2ZdIDogYltmXSA9IGE7fTtiLl9zdHJpbmdSZWYgPSBmO3JldHVybiBiO31pZiAoInN0cmluZyIgIT09IHR5cGVvZiBhKSB0aHJvdyBFcnJvcihwKDI4NCkpO2lmICghYy5fb3duZXIpIHRocm93IEVycm9yKHAoMjkwLCBhKSk7fXJldHVybiBhO30KICAgICAgICAgIGZ1bmN0aW9uIHRoKGEsIGIpIHthID0gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKGIpO3Rocm93IEVycm9yKHAoMzEsICJbb2JqZWN0IE9iamVjdF0iID09PSBhID8gIm9iamVjdCB3aXRoIGtleXMgeyIgKyBPYmplY3Qua2V5cyhiKS5qb2luKCIsICIpICsgIn0iIDogYSkpO31mdW5jdGlvbiB1aChhKSB7dmFyIGIgPSBhLl9pbml0O3JldHVybiBiKGEuX3BheWxvYWQpO30KICAgICAgICAgIGZ1bmN0aW9uIHZoKGEpIHtmdW5jdGlvbiBiKGIsIGMpIHtpZiAoYSkge3ZhciBkID0gYi5kZWxldGlvbnM7bnVsbCA9PT0gZCA/IChiLmRlbGV0aW9ucyA9IFtjXSwgYi5mbGFncyB8PSAxNikgOiBkLnB1c2goYyk7fX1mdW5jdGlvbiBjKGMsIGQpIHtpZiAoIWEpIHJldHVybiBudWxsO2ZvciAoOyBudWxsICE9PSBkOykgYihjLCBkKSwgZCA9IGQuc2libGluZztyZXR1cm4gbnVsbDt9ZnVuY3Rpb24gZChhLCBiKSB7Zm9yIChhID0gbmV3IE1hcCgpOyBudWxsICE9PSBiOykgbnVsbCAhPT0gYi5rZXkgPyBhLnNldChiLmtleSwgYikgOiBhLnNldChiLmluZGV4LCBiKSwgYiA9IGIuc2libGluZztyZXR1cm4gYTt9ZnVuY3Rpb24gZShhLCBiKSB7YSA9IHdoKGEsIGIpO2EuaW5kZXggPSAwO2Euc2libGluZyA9IG51bGw7cmV0dXJuIGE7fWZ1bmN0aW9uIGYoYiwgYywgZCkge2IuaW5kZXggPSBkO2lmICghYSkgcmV0dXJuIGIuZmxhZ3MgfD0gMTA0ODU3NiwgYztkID0gYi5hbHRlcm5hdGU7aWYgKG51bGwgIT09IGQpIHJldHVybiBkID0gZC5pbmRleCwgZCA8IGMgPyAoYi5mbGFncyB8PSAyLCBjKSA6IGQ7Yi5mbGFncyB8PSAyO3JldHVybiBjO31mdW5jdGlvbiBnKGIpIHthICYmCiAgICAgICAgICAgICAgbnVsbCA9PT0gYi5hbHRlcm5hdGUgJiYgKGIuZmxhZ3MgfD0gMik7cmV0dXJuIGI7fWZ1bmN0aW9uIGgoYSwgYiwgYywgZCkge2lmIChudWxsID09PSBiIHx8IDYgIT09IGIudGFnKSByZXR1cm4gYiA9IHhoKGMsIGEubW9kZSwgZCksIGIucmV0dXJuID0gYSwgYjtiID0gZShiLCBjKTtiLnJldHVybiA9IGE7cmV0dXJuIGI7fWZ1bmN0aW9uIGsoYSwgYiwgYywgZCkge3ZhciBmID0gYy50eXBlO2lmIChmID09PSB5YSkgcmV0dXJuIG0oYSwgYiwgYy5wcm9wcy5jaGlsZHJlbiwgZCwgYy5rZXkpO2lmIChudWxsICE9PSBiICYmIChiLmVsZW1lbnRUeXBlID09PSBmIHx8ICJvYmplY3QiID09PSB0eXBlb2YgZiAmJiBudWxsICE9PSBmICYmIGYuJCR0eXBlb2YgPT09IEhhICYmIHVoKGYpID09PSBiLnR5cGUpKSByZXR1cm4gZCA9IGUoYiwgYy5wcm9wcyksIGQucmVmID0gc2goYSwgYiwgYyksIGQucmV0dXJuID0gYSwgZDtkID0geWgoYy50eXBlLCBjLmtleSwgYy5wcm9wcywgbnVsbCwgYS5tb2RlLCBkKTtkLnJlZiA9IHNoKGEsIGIsIGMpO2QucmV0dXJuID0gYTtyZXR1cm4gZDt9ZnVuY3Rpb24gbChhLCBiLCBjLCBkKSB7aWYgKG51bGwgPT09IGIgfHwgNCAhPT0gYi50YWcgfHwKICAgICAgICAgICAgICBiLnN0YXRlTm9kZS5jb250YWluZXJJbmZvICE9PSBjLmNvbnRhaW5lckluZm8gfHwgYi5zdGF0ZU5vZGUuaW1wbGVtZW50YXRpb24gIT09IGMuaW1wbGVtZW50YXRpb24pIHJldHVybiBiID0gemgoYywgYS5tb2RlLCBkKSwgYi5yZXR1cm4gPSBhLCBiO2IgPSBlKGIsIGMuY2hpbGRyZW4gfHwgW10pO2IucmV0dXJuID0gYTtyZXR1cm4gYjt9ZnVuY3Rpb24gbShhLCBiLCBjLCBkLCBmKSB7aWYgKG51bGwgPT09IGIgfHwgNyAhPT0gYi50YWcpIHJldHVybiBiID0gQWgoYywgYS5tb2RlLCBkLCBmKSwgYi5yZXR1cm4gPSBhLCBiO2IgPSBlKGIsIGMpO2IucmV0dXJuID0gYTtyZXR1cm4gYjt9ZnVuY3Rpb24gcShhLCBiLCBjKSB7aWYgKCJzdHJpbmciID09PSB0eXBlb2YgYiAmJiAiIiAhPT0gYiB8fCAibnVtYmVyIiA9PT0gdHlwZW9mIGIpIHJldHVybiBiID0geGgoIiIgKyBiLCBhLm1vZGUsIGMpLCBiLnJldHVybiA9IGEsIGI7aWYgKCJvYmplY3QiID09PSB0eXBlb2YgYiAmJiBudWxsICE9PSBiKSB7c3dpdGNoIChiLiQkdHlwZW9mKSB7Y2FzZSB2YTpyZXR1cm4gYyA9IHloKGIudHlwZSwgYi5rZXksIGIucHJvcHMsIG51bGwsIGEubW9kZSwgYyksCiAgICAgICAgICAgICAgICAgICAgYy5yZWYgPSBzaChhLCBudWxsLCBiKSwgYy5yZXR1cm4gPSBhLCBjO2Nhc2Ugd2E6cmV0dXJuIGIgPSB6aChiLCBhLm1vZGUsIGMpLCBiLnJldHVybiA9IGEsIGI7Y2FzZSBIYTp2YXIgZCA9IGIuX2luaXQ7cmV0dXJuIHEoYSwgZChiLl9wYXlsb2FkKSwgYyk7fWlmIChlYihiKSB8fCBLYShiKSkgcmV0dXJuIGIgPSBBaChiLCBhLm1vZGUsIGMsIG51bGwpLCBiLnJldHVybiA9IGEsIGI7dGgoYSwgYik7fXJldHVybiBudWxsO31mdW5jdGlvbiByKGEsIGIsIGMsIGQpIHt2YXIgZSA9IG51bGwgIT09IGIgPyBiLmtleSA6IG51bGw7aWYgKCJzdHJpbmciID09PSB0eXBlb2YgYyAmJiAiIiAhPT0gYyB8fCAibnVtYmVyIiA9PT0gdHlwZW9mIGMpIHJldHVybiBudWxsICE9PSBlID8gbnVsbCA6IGgoYSwgYiwgIiIgKyBjLCBkKTtpZiAoIm9iamVjdCIgPT09IHR5cGVvZiBjICYmIG51bGwgIT09IGMpIHtzd2l0Y2ggKGMuJCR0eXBlb2YpIHtjYXNlIHZhOnJldHVybiBjLmtleSA9PT0gZSA/IGsoYSwgYiwgYywgZCkgOiBudWxsO2Nhc2Ugd2E6cmV0dXJuIGMua2V5ID09PSBlID8gbChhLCBiLCBjLCBkKSA6IG51bGw7Y2FzZSBIYTpyZXR1cm4gZSA9IGMuX2luaXQsIHIoYSwKICAgICAgICAgICAgICAgICAgICBiLCBlKGMuX3BheWxvYWQpLCBkKTt9aWYgKGViKGMpIHx8IEthKGMpKSByZXR1cm4gbnVsbCAhPT0gZSA/IG51bGwgOiBtKGEsIGIsIGMsIGQsIG51bGwpO3RoKGEsIGMpO31yZXR1cm4gbnVsbDt9ZnVuY3Rpb24geShhLCBiLCBjLCBkLCBlKSB7aWYgKCJzdHJpbmciID09PSB0eXBlb2YgZCAmJiAiIiAhPT0gZCB8fCAibnVtYmVyIiA9PT0gdHlwZW9mIGQpIHJldHVybiBhID0gYS5nZXQoYykgfHwgbnVsbCwgaChiLCBhLCAiIiArIGQsIGUpO2lmICgib2JqZWN0IiA9PT0gdHlwZW9mIGQgJiYgbnVsbCAhPT0gZCkge3N3aXRjaCAoZC4kJHR5cGVvZikge2Nhc2UgdmE6cmV0dXJuIGEgPSBhLmdldChudWxsID09PSBkLmtleSA/IGMgOiBkLmtleSkgfHwgbnVsbCwgayhiLCBhLCBkLCBlKTtjYXNlIHdhOnJldHVybiBhID0gYS5nZXQobnVsbCA9PT0gZC5rZXkgPyBjIDogZC5rZXkpIHx8IG51bGwsIGwoYiwgYSwgZCwgZSk7Y2FzZSBIYTp2YXIgZiA9IGQuX2luaXQ7cmV0dXJuIHkoYSwgYiwgYywgZihkLl9wYXlsb2FkKSwgZSk7fWlmIChlYihkKSB8fCBLYShkKSkgcmV0dXJuIGEgPSBhLmdldChjKSB8fCBudWxsLCBtKGIsIGEsIGQsIGUsIG51bGwpO3RoKGIsIGQpO31yZXR1cm4gbnVsbDt9CiAgICAgICAgICAgIGZ1bmN0aW9uIG4oZSwgZywgaCwgaykge2ZvciAodmFyIGwgPSBudWxsLCBtID0gbnVsbCwgdSA9IGcsIHcgPSBnID0gMCwgeCA9IG51bGw7IG51bGwgIT09IHUgJiYgdyA8IGgubGVuZ3RoOyB3KyspIHt1LmluZGV4ID4gdyA/ICh4ID0gdSwgdSA9IG51bGwpIDogeCA9IHUuc2libGluZzt2YXIgbiA9IHIoZSwgdSwgaFt3XSwgayk7aWYgKG51bGwgPT09IG4pIHtudWxsID09PSB1ICYmICh1ID0geCk7YnJlYWs7fWEgJiYgdSAmJiBudWxsID09PSBuLmFsdGVybmF0ZSAmJiBiKGUsIHUpO2cgPSBmKG4sIGcsIHcpO251bGwgPT09IG0gPyBsID0gbiA6IG0uc2libGluZyA9IG47bSA9IG47dSA9IHg7fWlmICh3ID09PSBoLmxlbmd0aCkgcmV0dXJuIGMoZSwgdSksIEkgJiYgdGcoZSwgdyksIGw7aWYgKG51bGwgPT09IHUpIHtmb3IgKDsgdyA8IGgubGVuZ3RoOyB3KyspIHUgPSBxKGUsIGhbd10sIGspLCBudWxsICE9PSB1ICYmIChnID0gZih1LCBnLCB3KSwgbnVsbCA9PT0gbSA/IGwgPSB1IDogbS5zaWJsaW5nID0gdSwgbSA9IHUpO0kgJiYgdGcoZSwgdyk7cmV0dXJuIGw7fWZvciAodSA9IGQoZSwgdSk7IHcgPCBoLmxlbmd0aDsgdysrKSB4ID0geSh1LCBlLCB3LCBoW3ddLCBrKSwgbnVsbCAhPT0geCAmJiAoYSAmJiBudWxsICE9PSB4LmFsdGVybmF0ZSAmJiB1LmRlbGV0ZShudWxsID09PQogICAgICAgICAgICAgIHgua2V5ID8gdyA6IHgua2V5KSwgZyA9IGYoeCwgZywgdyksIG51bGwgPT09IG0gPyBsID0geCA6IG0uc2libGluZyA9IHgsIG0gPSB4KTthICYmIHUuZm9yRWFjaChmdW5jdGlvbiAoYSkge3JldHVybiBiKGUsIGEpO30pO0kgJiYgdGcoZSwgdyk7cmV0dXJuIGw7fWZ1bmN0aW9uIHQoZSwgZywgaCwgaykge3ZhciBsID0gS2EoaCk7aWYgKCJmdW5jdGlvbiIgIT09IHR5cGVvZiBsKSB0aHJvdyBFcnJvcihwKDE1MCkpO2ggPSBsLmNhbGwoaCk7aWYgKG51bGwgPT0gaCkgdGhyb3cgRXJyb3IocCgxNTEpKTtmb3IgKHZhciB1ID0gbCA9IG51bGwsIG0gPSBnLCB3ID0gZyA9IDAsIHggPSBudWxsLCBuID0gaC5uZXh0KCk7IG51bGwgIT09IG0gJiYgIW4uZG9uZTsgdysrLCBuID0gaC5uZXh0KCkpIHttLmluZGV4ID4gdyA/ICh4ID0gbSwgbSA9IG51bGwpIDogeCA9IG0uc2libGluZzt2YXIgdCA9IHIoZSwgbSwgbi52YWx1ZSwgayk7aWYgKG51bGwgPT09IHQpIHtudWxsID09PSBtICYmIChtID0geCk7YnJlYWs7fWEgJiYgbSAmJiBudWxsID09PSB0LmFsdGVybmF0ZSAmJiBiKGUsIG0pO2cgPSBmKHQsIGcsIHcpO251bGwgPT09IHUgPyBsID0gdCA6IHUuc2libGluZyA9IHQ7dSA9IHQ7bSA9IHg7fWlmIChuLmRvbmUpIHJldHVybiBjKGUsCiAgICAgICAgICAgICAgbSksIEkgJiYgdGcoZSwgdyksIGw7aWYgKG51bGwgPT09IG0pIHtmb3IgKDsgIW4uZG9uZTsgdysrLCBuID0gaC5uZXh0KCkpIG4gPSBxKGUsIG4udmFsdWUsIGspLCBudWxsICE9PSBuICYmIChnID0gZihuLCBnLCB3KSwgbnVsbCA9PT0gdSA/IGwgPSBuIDogdS5zaWJsaW5nID0gbiwgdSA9IG4pO0kgJiYgdGcoZSwgdyk7cmV0dXJuIGw7fWZvciAobSA9IGQoZSwgbSk7ICFuLmRvbmU7IHcrKywgbiA9IGgubmV4dCgpKSBuID0geShtLCBlLCB3LCBuLnZhbHVlLCBrKSwgbnVsbCAhPT0gbiAmJiAoYSAmJiBudWxsICE9PSBuLmFsdGVybmF0ZSAmJiBtLmRlbGV0ZShudWxsID09PSBuLmtleSA/IHcgOiBuLmtleSksIGcgPSBmKG4sIGcsIHcpLCBudWxsID09PSB1ID8gbCA9IG4gOiB1LnNpYmxpbmcgPSBuLCB1ID0gbik7YSAmJiBtLmZvckVhY2goZnVuY3Rpb24gKGEpIHtyZXR1cm4gYihlLCBhKTt9KTtJICYmIHRnKGUsIHcpO3JldHVybiBsO31mdW5jdGlvbiBKKGEsIGQsIGYsIGgpIHsib2JqZWN0IiA9PT0gdHlwZW9mIGYgJiYgbnVsbCAhPT0gZiAmJiBmLnR5cGUgPT09IHlhICYmIG51bGwgPT09IGYua2V5ICYmIChmID0gZi5wcm9wcy5jaGlsZHJlbik7aWYgKCJvYmplY3QiID09PSB0eXBlb2YgZiAmJiBudWxsICE9PSBmKSB7c3dpdGNoIChmLiQkdHlwZW9mKSB7Y2FzZSB2YTphOiB7Zm9yICh2YXIgayA9CiAgICAgICAgICAgICAgICAgICAgICAgIGYua2V5LCBsID0gZDsgbnVsbCAhPT0gbDspIHtpZiAobC5rZXkgPT09IGspIHtrID0gZi50eXBlO2lmIChrID09PSB5YSkge2lmICg3ID09PSBsLnRhZykge2MoYSwgbC5zaWJsaW5nKTtkID0gZShsLCBmLnByb3BzLmNoaWxkcmVuKTtkLnJldHVybiA9IGE7YSA9IGQ7YnJlYWsgYTt9fSBlbHNlIGlmIChsLmVsZW1lbnRUeXBlID09PSBrIHx8ICJvYmplY3QiID09PSB0eXBlb2YgayAmJiBudWxsICE9PSBrICYmIGsuJCR0eXBlb2YgPT09IEhhICYmIHVoKGspID09PSBsLnR5cGUpIHtjKGEsIGwuc2libGluZyk7ZCA9IGUobCwgZi5wcm9wcyk7ZC5yZWYgPSBzaChhLCBsLCBmKTtkLnJldHVybiA9IGE7YSA9IGQ7YnJlYWsgYTt9YyhhLCBsKTticmVhazt9IGVsc2UgYihhLCBsKTtsID0gbC5zaWJsaW5nO31mLnR5cGUgPT09IHlhID8gKGQgPSBBaChmLnByb3BzLmNoaWxkcmVuLCBhLm1vZGUsIGgsIGYua2V5KSwgZC5yZXR1cm4gPSBhLCBhID0gZCkgOiAoaCA9IHloKGYudHlwZSwgZi5rZXksIGYucHJvcHMsIG51bGwsIGEubW9kZSwgaCksIGgucmVmID0gc2goYSwgZCwgZiksIGgucmV0dXJuID0gYSwgYSA9IGgpO31yZXR1cm4gZyhhKTtjYXNlIHdhOmE6IHtmb3IgKGwgPSBmLmtleTsgbnVsbCAhPT0KICAgICAgICAgICAgICAgICAgICAgIGQ7KSB7aWYgKGQua2V5ID09PSBsKSB7aWYgKDQgPT09IGQudGFnICYmIGQuc3RhdGVOb2RlLmNvbnRhaW5lckluZm8gPT09IGYuY29udGFpbmVySW5mbyAmJiBkLnN0YXRlTm9kZS5pbXBsZW1lbnRhdGlvbiA9PT0gZi5pbXBsZW1lbnRhdGlvbikge2MoYSwgZC5zaWJsaW5nKTtkID0gZShkLCBmLmNoaWxkcmVuIHx8IFtdKTtkLnJldHVybiA9IGE7YSA9IGQ7YnJlYWsgYTt9IGVsc2Uge2MoYSwgZCk7YnJlYWs7fX0gZWxzZSBiKGEsIGQpO2QgPSBkLnNpYmxpbmc7fWQgPSB6aChmLCBhLm1vZGUsIGgpO2QucmV0dXJuID0gYTthID0gZDt9cmV0dXJuIGcoYSk7Y2FzZSBIYTpyZXR1cm4gbCA9IGYuX2luaXQsIEooYSwgZCwgbChmLl9wYXlsb2FkKSwgaCk7fWlmIChlYihmKSkgcmV0dXJuIG4oYSwgZCwgZiwgaCk7aWYgKEthKGYpKSByZXR1cm4gdChhLCBkLCBmLCBoKTt0aChhLCBmKTt9cmV0dXJuICJzdHJpbmciID09PSB0eXBlb2YgZiAmJiAiIiAhPT0gZiB8fCAibnVtYmVyIiA9PT0gdHlwZW9mIGYgPyAoZiA9ICIiICsgZiwgbnVsbCAhPT0gZCAmJiA2ID09PSBkLnRhZyA/IChjKGEsIGQuc2libGluZyksIGQgPSBlKGQsIGYpLCBkLnJldHVybiA9IGEsIGEgPSBkKSA6ICgKICAgICAgICAgICAgICBjKGEsIGQpLCBkID0geGgoZiwgYS5tb2RlLCBoKSwgZC5yZXR1cm4gPSBhLCBhID0gZCksIGcoYSkpIDogYyhhLCBkKTt9cmV0dXJuIEo7fXZhciBCaCA9IHZoKCEwKSxDaCA9IHZoKCExKSxEaCA9IHt9LEVoID0gVWYoRGgpLEZoID0gVWYoRGgpLEdoID0gVWYoRGgpO2Z1bmN0aW9uIEhoKGEpIHtpZiAoYSA9PT0gRGgpIHRocm93IEVycm9yKHAoMTc0KSk7cmV0dXJuIGE7fWZ1bmN0aW9uIEloKGEsIGIpIHtHKEdoLCBiKTtHKEZoLCBhKTtHKEVoLCBEaCk7YSA9IGIubm9kZVR5cGU7c3dpdGNoIChhKSB7Y2FzZSA5OmNhc2UgMTE6YiA9IChiID0gYi5kb2N1bWVudEVsZW1lbnQpID8gYi5uYW1lc3BhY2VVUkkgOiBsYihudWxsLCAiIik7YnJlYWs7ZGVmYXVsdDphID0gOCA9PT0gYSA/IGIucGFyZW50Tm9kZSA6IGIsIGIgPSBhLm5hbWVzcGFjZVVSSSB8fCBudWxsLCBhID0gYS50YWdOYW1lLCBiID0gbGIoYiwgYSk7fUUoRWgpO0coRWgsIGIpO31mdW5jdGlvbiBKaCgpIHtFKEVoKTtFKEZoKTtFKEdoKTt9CiAgICAgICAgICBmdW5jdGlvbiBLaChhKSB7SGgoR2guY3VycmVudCk7dmFyIGIgPSBIaChFaC5jdXJyZW50KTt2YXIgYyA9IGxiKGIsIGEudHlwZSk7YiAhPT0gYyAmJiAoRyhGaCwgYSksIEcoRWgsIGMpKTt9ZnVuY3Rpb24gTGgoYSkge0ZoLmN1cnJlbnQgPT09IGEgJiYgKEUoRWgpLCBFKEZoKSk7fXZhciBNID0gVWYoMCk7CiAgICAgICAgICBmdW5jdGlvbiBNaChhKSB7Zm9yICh2YXIgYiA9IGE7IG51bGwgIT09IGI7KSB7aWYgKDEzID09PSBiLnRhZykge3ZhciBjID0gYi5tZW1vaXplZFN0YXRlO2lmIChudWxsICE9PSBjICYmIChjID0gYy5kZWh5ZHJhdGVkLCBudWxsID09PSBjIHx8ICIkPyIgPT09IGMuZGF0YSB8fCAiJCEiID09PSBjLmRhdGEpKSByZXR1cm4gYjt9IGVsc2UgaWYgKDE5ID09PSBiLnRhZyAmJiB2b2lkIDAgIT09IGIubWVtb2l6ZWRQcm9wcy5yZXZlYWxPcmRlcikge2lmICgwICE9PSAoYi5mbGFncyAmIDEyOCkpIHJldHVybiBiO30gZWxzZSBpZiAobnVsbCAhPT0gYi5jaGlsZCkge2IuY2hpbGQucmV0dXJuID0gYjtiID0gYi5jaGlsZDtjb250aW51ZTt9aWYgKGIgPT09IGEpIGJyZWFrO2ZvciAoOyBudWxsID09PSBiLnNpYmxpbmc7KSB7aWYgKG51bGwgPT09IGIucmV0dXJuIHx8IGIucmV0dXJuID09PSBhKSByZXR1cm4gbnVsbDtiID0gYi5yZXR1cm47fWIuc2libGluZy5yZXR1cm4gPSBiLnJldHVybjtiID0gYi5zaWJsaW5nO31yZXR1cm4gbnVsbDt9dmFyIE5oID0gW107CiAgICAgICAgICBmdW5jdGlvbiBPaCgpIHtmb3IgKHZhciBhID0gMDsgYSA8IE5oLmxlbmd0aDsgYSsrKSBOaFthXS5fd29ya0luUHJvZ3Jlc3NWZXJzaW9uUHJpbWFyeSA9IG51bGw7TmgubGVuZ3RoID0gMDt9dmFyIFBoID0gdWEuUmVhY3RDdXJyZW50RGlzcGF0Y2hlcixRaCA9IHVhLlJlYWN0Q3VycmVudEJhdGNoQ29uZmlnLFJoID0gMCxOID0gbnVsbCxPID0gbnVsbCxQID0gbnVsbCxTaCA9ICExLFRoID0gITEsVWggPSAwLFZoID0gMDtmdW5jdGlvbiBRKCkge3Rocm93IEVycm9yKHAoMzIxKSk7fWZ1bmN0aW9uIFdoKGEsIGIpIHtpZiAobnVsbCA9PT0gYikgcmV0dXJuICExO2ZvciAodmFyIGMgPSAwOyBjIDwgYi5sZW5ndGggJiYgYyA8IGEubGVuZ3RoOyBjKyspIGlmICghSGUoYVtjXSwgYltjXSkpIHJldHVybiAhMTtyZXR1cm4gITA7fQogICAgICAgICAgZnVuY3Rpb24gWGgoYSwgYiwgYywgZCwgZSwgZikge1JoID0gZjtOID0gYjtiLm1lbW9pemVkU3RhdGUgPSBudWxsO2IudXBkYXRlUXVldWUgPSBudWxsO2IubGFuZXMgPSAwO1BoLmN1cnJlbnQgPSBudWxsID09PSBhIHx8IG51bGwgPT09IGEubWVtb2l6ZWRTdGF0ZSA/IFloIDogWmg7YSA9IGMoZCwgZSk7aWYgKFRoKSB7ZiA9IDA7ZG8ge1RoID0gITE7VWggPSAwO2lmICgyNSA8PSBmKSB0aHJvdyBFcnJvcihwKDMwMSkpO2YgKz0gMTtQID0gTyA9IG51bGw7Yi51cGRhdGVRdWV1ZSA9IG51bGw7UGguY3VycmVudCA9ICRoO2EgPSBjKGQsIGUpO30gd2hpbGUgKFRoKTt9UGguY3VycmVudCA9IGFpO2IgPSBudWxsICE9PSBPICYmIG51bGwgIT09IE8ubmV4dDtSaCA9IDA7UCA9IE8gPSBOID0gbnVsbDtTaCA9ICExO2lmIChiKSB0aHJvdyBFcnJvcihwKDMwMCkpO3JldHVybiBhO31mdW5jdGlvbiBiaSgpIHt2YXIgYSA9IDAgIT09IFVoO1VoID0gMDtyZXR1cm4gYTt9CiAgICAgICAgICBmdW5jdGlvbiBjaSgpIHt2YXIgYSA9IHsgbWVtb2l6ZWRTdGF0ZTogbnVsbCwgYmFzZVN0YXRlOiBudWxsLCBiYXNlUXVldWU6IG51bGwsIHF1ZXVlOiBudWxsLCBuZXh0OiBudWxsIH07bnVsbCA9PT0gUCA/IE4ubWVtb2l6ZWRTdGF0ZSA9IFAgPSBhIDogUCA9IFAubmV4dCA9IGE7cmV0dXJuIFA7fWZ1bmN0aW9uIGRpKCkge2lmIChudWxsID09PSBPKSB7dmFyIGEgPSBOLmFsdGVybmF0ZTthID0gbnVsbCAhPT0gYSA/IGEubWVtb2l6ZWRTdGF0ZSA6IG51bGw7fSBlbHNlIGEgPSBPLm5leHQ7dmFyIGIgPSBudWxsID09PSBQID8gTi5tZW1vaXplZFN0YXRlIDogUC5uZXh0O2lmIChudWxsICE9PSBiKSBQID0gYiwgTyA9IGE7ZWxzZSB7aWYgKG51bGwgPT09IGEpIHRocm93IEVycm9yKHAoMzEwKSk7TyA9IGE7YSA9IHsgbWVtb2l6ZWRTdGF0ZTogTy5tZW1vaXplZFN0YXRlLCBiYXNlU3RhdGU6IE8uYmFzZVN0YXRlLCBiYXNlUXVldWU6IE8uYmFzZVF1ZXVlLCBxdWV1ZTogTy5xdWV1ZSwgbmV4dDogbnVsbCB9O251bGwgPT09IFAgPyBOLm1lbW9pemVkU3RhdGUgPSBQID0gYSA6IFAgPSBQLm5leHQgPSBhO31yZXR1cm4gUDt9CiAgICAgICAgICBmdW5jdGlvbiBlaShhLCBiKSB7cmV0dXJuICJmdW5jdGlvbiIgPT09IHR5cGVvZiBiID8gYihhKSA6IGI7fQogICAgICAgICAgZnVuY3Rpb24gZmkoYSkge3ZhciBiID0gZGkoKSxjID0gYi5xdWV1ZTtpZiAobnVsbCA9PT0gYykgdGhyb3cgRXJyb3IocCgzMTEpKTtjLmxhc3RSZW5kZXJlZFJlZHVjZXIgPSBhO3ZhciBkID0gTyxlID0gZC5iYXNlUXVldWUsZiA9IGMucGVuZGluZztpZiAobnVsbCAhPT0gZikge2lmIChudWxsICE9PSBlKSB7dmFyIGcgPSBlLm5leHQ7ZS5uZXh0ID0gZi5uZXh0O2YubmV4dCA9IGc7fWQuYmFzZVF1ZXVlID0gZSA9IGY7Yy5wZW5kaW5nID0gbnVsbDt9aWYgKG51bGwgIT09IGUpIHtmID0gZS5uZXh0O2QgPSBkLmJhc2VTdGF0ZTt2YXIgaCA9IGcgPSBudWxsLGsgPSBudWxsLGwgPSBmO2RvIHt2YXIgbSA9IGwubGFuZTtpZiAoKFJoICYgbSkgPT09IG0pIG51bGwgIT09IGsgJiYgKGsgPSBrLm5leHQgPSB7IGxhbmU6IDAsIGFjdGlvbjogbC5hY3Rpb24sIGhhc0VhZ2VyU3RhdGU6IGwuaGFzRWFnZXJTdGF0ZSwgZWFnZXJTdGF0ZTogbC5lYWdlclN0YXRlLCBuZXh0OiBudWxsIH0pLCBkID0gbC5oYXNFYWdlclN0YXRlID8gbC5lYWdlclN0YXRlIDogYShkLCBsLmFjdGlvbik7ZWxzZSB7dmFyIHEgPSB7IGxhbmU6IG0sIGFjdGlvbjogbC5hY3Rpb24sIGhhc0VhZ2VyU3RhdGU6IGwuaGFzRWFnZXJTdGF0ZSwKICAgICAgICAgICAgICAgICAgICBlYWdlclN0YXRlOiBsLmVhZ2VyU3RhdGUsIG5leHQ6IG51bGwgfTtudWxsID09PSBrID8gKGggPSBrID0gcSwgZyA9IGQpIDogayA9IGsubmV4dCA9IHE7Ti5sYW5lcyB8PSBtO2hoIHw9IG07fWwgPSBsLm5leHQ7fSB3aGlsZSAobnVsbCAhPT0gbCAmJiBsICE9PSBmKTtudWxsID09PSBrID8gZyA9IGQgOiBrLm5leHQgPSBoO0hlKGQsIGIubWVtb2l6ZWRTdGF0ZSkgfHwgKFVnID0gITApO2IubWVtb2l6ZWRTdGF0ZSA9IGQ7Yi5iYXNlU3RhdGUgPSBnO2IuYmFzZVF1ZXVlID0gaztjLmxhc3RSZW5kZXJlZFN0YXRlID0gZDt9YSA9IGMuaW50ZXJsZWF2ZWQ7aWYgKG51bGwgIT09IGEpIHtlID0gYTtkbyBmID0gZS5sYW5lLCBOLmxhbmVzIHw9IGYsIGhoIHw9IGYsIGUgPSBlLm5leHQ7IHdoaWxlIChlICE9PSBhKTt9IGVsc2UgbnVsbCA9PT0gZSAmJiAoYy5sYW5lcyA9IDApO3JldHVybiBbYi5tZW1vaXplZFN0YXRlLCBjLmRpc3BhdGNoXTt9CiAgICAgICAgICBmdW5jdGlvbiBnaShhKSB7dmFyIGIgPSBkaSgpLGMgPSBiLnF1ZXVlO2lmIChudWxsID09PSBjKSB0aHJvdyBFcnJvcihwKDMxMSkpO2MubGFzdFJlbmRlcmVkUmVkdWNlciA9IGE7dmFyIGQgPSBjLmRpc3BhdGNoLGUgPSBjLnBlbmRpbmcsZiA9IGIubWVtb2l6ZWRTdGF0ZTtpZiAobnVsbCAhPT0gZSkge2MucGVuZGluZyA9IG51bGw7dmFyIGcgPSBlID0gZS5uZXh0O2RvIGYgPSBhKGYsIGcuYWN0aW9uKSwgZyA9IGcubmV4dDsgd2hpbGUgKGcgIT09IGUpO0hlKGYsIGIubWVtb2l6ZWRTdGF0ZSkgfHwgKFVnID0gITApO2IubWVtb2l6ZWRTdGF0ZSA9IGY7bnVsbCA9PT0gYi5iYXNlUXVldWUgJiYgKGIuYmFzZVN0YXRlID0gZik7Yy5sYXN0UmVuZGVyZWRTdGF0ZSA9IGY7fXJldHVybiBbZiwgZF07fWZ1bmN0aW9uIGhpKCkge30KICAgICAgICAgIGZ1bmN0aW9uIGlpKGEsIGIpIHt2YXIgYyA9IE4sZCA9IGRpKCksZSA9IGIoKSxmID0gIUhlKGQubWVtb2l6ZWRTdGF0ZSwgZSk7ZiAmJiAoZC5tZW1vaXplZFN0YXRlID0gZSwgVWcgPSAhMCk7ZCA9IGQucXVldWU7amkoa2kuYmluZChudWxsLCBjLCBkLCBhKSwgW2FdKTtpZiAoZC5nZXRTbmFwc2hvdCAhPT0gYiB8fCBmIHx8IG51bGwgIT09IFAgJiYgUC5tZW1vaXplZFN0YXRlLnRhZyAmIDEpIHtjLmZsYWdzIHw9IDIwNDg7bGkoOSwgbWkuYmluZChudWxsLCBjLCBkLCBlLCBiKSwgdm9pZCAwLCBudWxsKTtpZiAobnVsbCA9PT0gUikgdGhyb3cgRXJyb3IocCgzNDkpKTswICE9PSAoUmggJiAzMCkgfHwgbmkoYywgYiwgZSk7fXJldHVybiBlO31mdW5jdGlvbiBuaShhLCBiLCBjKSB7YS5mbGFncyB8PSAxNjM4NDthID0geyBnZXRTbmFwc2hvdDogYiwgdmFsdWU6IGMgfTtiID0gTi51cGRhdGVRdWV1ZTtudWxsID09PSBiID8gKGIgPSB7IGxhc3RFZmZlY3Q6IG51bGwsIHN0b3JlczogbnVsbCB9LCBOLnVwZGF0ZVF1ZXVlID0gYiwgYi5zdG9yZXMgPSBbYV0pIDogKGMgPSBiLnN0b3JlcywgbnVsbCA9PT0gYyA/IGIuc3RvcmVzID0gW2FdIDogYy5wdXNoKGEpKTt9CiAgICAgICAgICBmdW5jdGlvbiBtaShhLCBiLCBjLCBkKSB7Yi52YWx1ZSA9IGM7Yi5nZXRTbmFwc2hvdCA9IGQ7b2koYikgJiYgcGkoYSk7fWZ1bmN0aW9uIGtpKGEsIGIsIGMpIHtyZXR1cm4gYyhmdW5jdGlvbiAoKSB7b2koYikgJiYgcGkoYSk7fSk7fWZ1bmN0aW9uIG9pKGEpIHt2YXIgYiA9IGEuZ2V0U25hcHNob3Q7YSA9IGEudmFsdWU7dHJ5IHt2YXIgYyA9IGIoKTtyZXR1cm4gIUhlKGEsIGMpO30gY2F0Y2ggKGQpIHtyZXR1cm4gITA7fX1mdW5jdGlvbiBwaShhKSB7dmFyIGIgPSBaZyhhLCAxKTtudWxsICE9PSBiICYmIG1oKGIsIGEsIDEsIC0xKTt9CiAgICAgICAgICBmdW5jdGlvbiBxaShhKSB7dmFyIGIgPSBjaSgpOyJmdW5jdGlvbiIgPT09IHR5cGVvZiBhICYmIChhID0gYSgpKTtiLm1lbW9pemVkU3RhdGUgPSBiLmJhc2VTdGF0ZSA9IGE7YSA9IHsgcGVuZGluZzogbnVsbCwgaW50ZXJsZWF2ZWQ6IG51bGwsIGxhbmVzOiAwLCBkaXNwYXRjaDogbnVsbCwgbGFzdFJlbmRlcmVkUmVkdWNlcjogZWksIGxhc3RSZW5kZXJlZFN0YXRlOiBhIH07Yi5xdWV1ZSA9IGE7YSA9IGEuZGlzcGF0Y2ggPSByaS5iaW5kKG51bGwsIE4sIGEpO3JldHVybiBbYi5tZW1vaXplZFN0YXRlLCBhXTt9CiAgICAgICAgICBmdW5jdGlvbiBsaShhLCBiLCBjLCBkKSB7YSA9IHsgdGFnOiBhLCBjcmVhdGU6IGIsIGRlc3Ryb3k6IGMsIGRlcHM6IGQsIG5leHQ6IG51bGwgfTtiID0gTi51cGRhdGVRdWV1ZTtudWxsID09PSBiID8gKGIgPSB7IGxhc3RFZmZlY3Q6IG51bGwsIHN0b3JlczogbnVsbCB9LCBOLnVwZGF0ZVF1ZXVlID0gYiwgYi5sYXN0RWZmZWN0ID0gYS5uZXh0ID0gYSkgOiAoYyA9IGIubGFzdEVmZmVjdCwgbnVsbCA9PT0gYyA/IGIubGFzdEVmZmVjdCA9IGEubmV4dCA9IGEgOiAoZCA9IGMubmV4dCwgYy5uZXh0ID0gYSwgYS5uZXh0ID0gZCwgYi5sYXN0RWZmZWN0ID0gYSkpO3JldHVybiBhO31mdW5jdGlvbiBzaSgpIHtyZXR1cm4gZGkoKS5tZW1vaXplZFN0YXRlO31mdW5jdGlvbiB0aShhLCBiLCBjLCBkKSB7dmFyIGUgPSBjaSgpO04uZmxhZ3MgfD0gYTtlLm1lbW9pemVkU3RhdGUgPSBsaSgxIHwgYiwgYywgdm9pZCAwLCB2b2lkIDAgPT09IGQgPyBudWxsIDogZCk7fQogICAgICAgICAgZnVuY3Rpb24gdWkoYSwgYiwgYywgZCkge3ZhciBlID0gZGkoKTtkID0gdm9pZCAwID09PSBkID8gbnVsbCA6IGQ7dmFyIGYgPSB2b2lkIDA7aWYgKG51bGwgIT09IE8pIHt2YXIgZyA9IE8ubWVtb2l6ZWRTdGF0ZTtmID0gZy5kZXN0cm95O2lmIChudWxsICE9PSBkICYmIFdoKGQsIGcuZGVwcykpIHtlLm1lbW9pemVkU3RhdGUgPSBsaShiLCBjLCBmLCBkKTtyZXR1cm47fX1OLmZsYWdzIHw9IGE7ZS5tZW1vaXplZFN0YXRlID0gbGkoMSB8IGIsIGMsIGYsIGQpO31mdW5jdGlvbiB2aShhLCBiKSB7cmV0dXJuIHRpKDgzOTA2NTYsIDgsIGEsIGIpO31mdW5jdGlvbiBqaShhLCBiKSB7cmV0dXJuIHVpKDIwNDgsIDgsIGEsIGIpO31mdW5jdGlvbiB3aShhLCBiKSB7cmV0dXJuIHVpKDQsIDIsIGEsIGIpO31mdW5jdGlvbiB4aShhLCBiKSB7cmV0dXJuIHVpKDQsIDQsIGEsIGIpO30KICAgICAgICAgIGZ1bmN0aW9uIHlpKGEsIGIpIHtpZiAoImZ1bmN0aW9uIiA9PT0gdHlwZW9mIGIpIHJldHVybiBhID0gYSgpLCBiKGEpLCBmdW5jdGlvbiAoKSB7YihudWxsKTt9O2lmIChudWxsICE9PSBiICYmIHZvaWQgMCAhPT0gYikgcmV0dXJuIGEgPSBhKCksIGIuY3VycmVudCA9IGEsIGZ1bmN0aW9uICgpIHtiLmN1cnJlbnQgPSBudWxsO307fWZ1bmN0aW9uIHppKGEsIGIsIGMpIHtjID0gbnVsbCAhPT0gYyAmJiB2b2lkIDAgIT09IGMgPyBjLmNvbmNhdChbYV0pIDogbnVsbDtyZXR1cm4gdWkoNCwgNCwgeWkuYmluZChudWxsLCBiLCBhKSwgYyk7fWZ1bmN0aW9uIEFpKCkge31mdW5jdGlvbiBCaShhLCBiKSB7dmFyIGMgPSBkaSgpO2IgPSB2b2lkIDAgPT09IGIgPyBudWxsIDogYjt2YXIgZCA9IGMubWVtb2l6ZWRTdGF0ZTtpZiAobnVsbCAhPT0gZCAmJiBudWxsICE9PSBiICYmIFdoKGIsIGRbMV0pKSByZXR1cm4gZFswXTtjLm1lbW9pemVkU3RhdGUgPSBbYSwgYl07cmV0dXJuIGE7fQogICAgICAgICAgZnVuY3Rpb24gQ2koYSwgYikge3ZhciBjID0gZGkoKTtiID0gdm9pZCAwID09PSBiID8gbnVsbCA6IGI7dmFyIGQgPSBjLm1lbW9pemVkU3RhdGU7aWYgKG51bGwgIT09IGQgJiYgbnVsbCAhPT0gYiAmJiBXaChiLCBkWzFdKSkgcmV0dXJuIGRbMF07YSA9IGEoKTtjLm1lbW9pemVkU3RhdGUgPSBbYSwgYl07cmV0dXJuIGE7fWZ1bmN0aW9uIERpKGEsIGIsIGMpIHtpZiAoMCA9PT0gKFJoICYgMjEpKSByZXR1cm4gYS5iYXNlU3RhdGUgJiYgKGEuYmFzZVN0YXRlID0gITEsIFVnID0gITApLCBhLm1lbW9pemVkU3RhdGUgPSBjO0hlKGMsIGIpIHx8IChjID0geWMoKSwgTi5sYW5lcyB8PSBjLCBoaCB8PSBjLCBhLmJhc2VTdGF0ZSA9ICEwKTtyZXR1cm4gYjt9ZnVuY3Rpb24gRWkoYSwgYikge3ZhciBjID0gQztDID0gMCAhPT0gYyAmJiA0ID4gYyA/IGMgOiA0O2EoITApO3ZhciBkID0gUWgudHJhbnNpdGlvbjtRaC50cmFuc2l0aW9uID0ge307dHJ5IHthKCExKSwgYigpO30gZmluYWxseSB7QyA9IGMsIFFoLnRyYW5zaXRpb24gPSBkO319ZnVuY3Rpb24gRmkoKSB7cmV0dXJuIGRpKCkubWVtb2l6ZWRTdGF0ZTt9CiAgICAgICAgICBmdW5jdGlvbiBHaShhLCBiLCBjKSB7dmFyIGQgPSBsaChhKTtjID0geyBsYW5lOiBkLCBhY3Rpb246IGMsIGhhc0VhZ2VyU3RhdGU6ICExLCBlYWdlclN0YXRlOiBudWxsLCBuZXh0OiBudWxsIH07aWYgKEhpKGEpKSBJaShiLCBjKTtlbHNlIGlmIChjID0gWWcoYSwgYiwgYywgZCksIG51bGwgIT09IGMpIHt2YXIgZSA9IEwoKTttaChjLCBhLCBkLCBlKTtKaShjLCBiLCBkKTt9fQogICAgICAgICAgZnVuY3Rpb24gcmkoYSwgYiwgYykge3ZhciBkID0gbGgoYSksZSA9IHsgbGFuZTogZCwgYWN0aW9uOiBjLCBoYXNFYWdlclN0YXRlOiAhMSwgZWFnZXJTdGF0ZTogbnVsbCwgbmV4dDogbnVsbCB9O2lmIChIaShhKSkgSWkoYiwgZSk7ZWxzZSB7dmFyIGYgPSBhLmFsdGVybmF0ZTtpZiAoMCA9PT0gYS5sYW5lcyAmJiAobnVsbCA9PT0gZiB8fCAwID09PSBmLmxhbmVzKSAmJiAoZiA9IGIubGFzdFJlbmRlcmVkUmVkdWNlciwgbnVsbCAhPT0gZikpIHRyeSB7dmFyIGcgPSBiLmxhc3RSZW5kZXJlZFN0YXRlLGggPSBmKGcsIGMpO2UuaGFzRWFnZXJTdGF0ZSA9ICEwO2UuZWFnZXJTdGF0ZSA9IGg7aWYgKEhlKGgsIGcpKSB7dmFyIGsgPSBiLmludGVybGVhdmVkO251bGwgPT09IGsgPyAoZS5uZXh0ID0gZSwgWGcoYikpIDogKGUubmV4dCA9IGsubmV4dCwgay5uZXh0ID0gZSk7Yi5pbnRlcmxlYXZlZCA9IGU7cmV0dXJuO319IGNhdGNoIChsKSB7fSBmaW5hbGx5IHt9YyA9IFlnKGEsIGIsIGUsIGQpO251bGwgIT09IGMgJiYgKGUgPSBMKCksIG1oKGMsIGEsIGQsIGUpLCBKaShjLCBiLCBkKSk7fX0KICAgICAgICAgIGZ1bmN0aW9uIEhpKGEpIHt2YXIgYiA9IGEuYWx0ZXJuYXRlO3JldHVybiBhID09PSBOIHx8IG51bGwgIT09IGIgJiYgYiA9PT0gTjt9ZnVuY3Rpb24gSWkoYSwgYikge1RoID0gU2ggPSAhMDt2YXIgYyA9IGEucGVuZGluZztudWxsID09PSBjID8gYi5uZXh0ID0gYiA6IChiLm5leHQgPSBjLm5leHQsIGMubmV4dCA9IGIpO2EucGVuZGluZyA9IGI7fWZ1bmN0aW9uIEppKGEsIGIsIGMpIHtpZiAoMCAhPT0gKGMgJiA0MTk0MjQwKSkge3ZhciBkID0gYi5sYW5lcztkICY9IGEucGVuZGluZ0xhbmVzO2MgfD0gZDtiLmxhbmVzID0gYztDYyhhLCBjKTt9fQogICAgICAgICAgdmFyIGFpID0geyByZWFkQ29udGV4dDogVmcsIHVzZUNhbGxiYWNrOiBRLCB1c2VDb250ZXh0OiBRLCB1c2VFZmZlY3Q6IFEsIHVzZUltcGVyYXRpdmVIYW5kbGU6IFEsIHVzZUluc2VydGlvbkVmZmVjdDogUSwgdXNlTGF5b3V0RWZmZWN0OiBRLCB1c2VNZW1vOiBRLCB1c2VSZWR1Y2VyOiBRLCB1c2VSZWY6IFEsIHVzZVN0YXRlOiBRLCB1c2VEZWJ1Z1ZhbHVlOiBRLCB1c2VEZWZlcnJlZFZhbHVlOiBRLCB1c2VUcmFuc2l0aW9uOiBRLCB1c2VNdXRhYmxlU291cmNlOiBRLCB1c2VTeW5jRXh0ZXJuYWxTdG9yZTogUSwgdXNlSWQ6IFEsIHVuc3RhYmxlX2lzTmV3UmVjb25jaWxlcjogITEgfSxZaCA9IHsgcmVhZENvbnRleHQ6IFZnLCB1c2VDYWxsYmFjazogZnVuY3Rpb24gdXNlQ2FsbGJhY2soYSwgYikge2NpKCkubWVtb2l6ZWRTdGF0ZSA9IFthLCB2b2lkIDAgPT09IGIgPyBudWxsIDogYl07cmV0dXJuIGE7fSwgdXNlQ29udGV4dDogVmcsIHVzZUVmZmVjdDogdmksIHVzZUltcGVyYXRpdmVIYW5kbGU6IGZ1bmN0aW9uIHVzZUltcGVyYXRpdmVIYW5kbGUoYSwgYiwgYykge2MgPSBudWxsICE9PSBjICYmIHZvaWQgMCAhPT0gYyA/IGMuY29uY2F0KFthXSkgOiBudWxsO3JldHVybiB0aSg0MTk0MzA4LAogICAgICAgICAgICAgICAgNCwgeWkuYmluZChudWxsLCBiLCBhKSwgYyk7fSwgdXNlTGF5b3V0RWZmZWN0OiBmdW5jdGlvbiB1c2VMYXlvdXRFZmZlY3QoYSwgYikge3JldHVybiB0aSg0MTk0MzA4LCA0LCBhLCBiKTt9LCB1c2VJbnNlcnRpb25FZmZlY3Q6IGZ1bmN0aW9uIHVzZUluc2VydGlvbkVmZmVjdChhLCBiKSB7cmV0dXJuIHRpKDQsIDIsIGEsIGIpO30sIHVzZU1lbW86IGZ1bmN0aW9uIHVzZU1lbW8oYSwgYikge3ZhciBjID0gY2koKTtiID0gdm9pZCAwID09PSBiID8gbnVsbCA6IGI7YSA9IGEoKTtjLm1lbW9pemVkU3RhdGUgPSBbYSwgYl07cmV0dXJuIGE7fSwgdXNlUmVkdWNlcjogZnVuY3Rpb24gdXNlUmVkdWNlcihhLCBiLCBjKSB7dmFyIGQgPSBjaSgpO2IgPSB2b2lkIDAgIT09IGMgPyBjKGIpIDogYjtkLm1lbW9pemVkU3RhdGUgPSBkLmJhc2VTdGF0ZSA9IGI7YSA9IHsgcGVuZGluZzogbnVsbCwgaW50ZXJsZWF2ZWQ6IG51bGwsIGxhbmVzOiAwLCBkaXNwYXRjaDogbnVsbCwgbGFzdFJlbmRlcmVkUmVkdWNlcjogYSwgbGFzdFJlbmRlcmVkU3RhdGU6IGIgfTtkLnF1ZXVlID0gYTthID0gYS5kaXNwYXRjaCA9IEdpLmJpbmQobnVsbCwgTiwgYSk7cmV0dXJuIFtkLm1lbW9pemVkU3RhdGUsIGFdO30sIHVzZVJlZjogZnVuY3Rpb24gdXNlUmVmKGEpIHt2YXIgYiA9CiAgICAgICAgICAgICAgICBjaSgpO2EgPSB7IGN1cnJlbnQ6IGEgfTtyZXR1cm4gYi5tZW1vaXplZFN0YXRlID0gYTt9LCB1c2VTdGF0ZTogcWksIHVzZURlYnVnVmFsdWU6IEFpLCB1c2VEZWZlcnJlZFZhbHVlOiBmdW5jdGlvbiB1c2VEZWZlcnJlZFZhbHVlKGEpIHtyZXR1cm4gY2koKS5tZW1vaXplZFN0YXRlID0gYTt9LCB1c2VUcmFuc2l0aW9uOiBmdW5jdGlvbiB1c2VUcmFuc2l0aW9uKCkge3ZhciBhID0gcWkoITEpLGIgPSBhWzBdO2EgPSBFaS5iaW5kKG51bGwsIGFbMV0pO2NpKCkubWVtb2l6ZWRTdGF0ZSA9IGE7cmV0dXJuIFtiLCBhXTt9LCB1c2VNdXRhYmxlU291cmNlOiBmdW5jdGlvbiB1c2VNdXRhYmxlU291cmNlKCkge30sIHVzZVN5bmNFeHRlcm5hbFN0b3JlOiBmdW5jdGlvbiB1c2VTeW5jRXh0ZXJuYWxTdG9yZShhLCBiLCBjKSB7dmFyIGQgPSBOLGUgPSBjaSgpO2lmIChJKSB7aWYgKHZvaWQgMCA9PT0gYykgdGhyb3cgRXJyb3IocCg0MDcpKTtjID0gYygpO30gZWxzZSB7YyA9IGIoKTtpZiAobnVsbCA9PT0gUikgdGhyb3cgRXJyb3IocCgzNDkpKTswICE9PSAoUmggJiAzMCkgfHwgbmkoZCwgYiwgYyk7fWUubWVtb2l6ZWRTdGF0ZSA9IGM7dmFyIGYgPSB7IHZhbHVlOiBjLCBnZXRTbmFwc2hvdDogYiB9O2UucXVldWUgPSBmO3ZpKGtpLmJpbmQobnVsbCwgZCwKICAgICAgICAgICAgICAgIGYsIGEpLCBbYV0pO2QuZmxhZ3MgfD0gMjA0ODtsaSg5LCBtaS5iaW5kKG51bGwsIGQsIGYsIGMsIGIpLCB2b2lkIDAsIG51bGwpO3JldHVybiBjO30sIHVzZUlkOiBmdW5jdGlvbiB1c2VJZCgpIHt2YXIgYSA9IGNpKCksYiA9IFIuaWRlbnRpZmllclByZWZpeDtpZiAoSSkge3ZhciBjID0gc2c7dmFyIGQgPSByZztjID0gKGQgJiB+KDEgPDwgMzIgLSBvYyhkKSAtIDEpKS50b1N0cmluZygzMikgKyBjO2IgPSAiOiIgKyBiICsgIlIiICsgYztjID0gVWgrKzswIDwgYyAmJiAoYiArPSAiSCIgKyBjLnRvU3RyaW5nKDMyKSk7YiArPSAiOiI7fSBlbHNlIGMgPSBWaCsrLCBiID0gIjoiICsgYiArICJyIiArIGMudG9TdHJpbmcoMzIpICsgIjoiO3JldHVybiBhLm1lbW9pemVkU3RhdGUgPSBiO30sIHVuc3RhYmxlX2lzTmV3UmVjb25jaWxlcjogITEgfSxaaCA9IHsgcmVhZENvbnRleHQ6IFZnLCB1c2VDYWxsYmFjazogQmksIHVzZUNvbnRleHQ6IFZnLCB1c2VFZmZlY3Q6IGppLCB1c2VJbXBlcmF0aXZlSGFuZGxlOiB6aSwgdXNlSW5zZXJ0aW9uRWZmZWN0OiB3aSwgdXNlTGF5b3V0RWZmZWN0OiB4aSwgdXNlTWVtbzogQ2ksIHVzZVJlZHVjZXI6IGZpLCB1c2VSZWY6IHNpLCB1c2VTdGF0ZTogZnVuY3Rpb24gdXNlU3RhdGUoKSB7cmV0dXJuIGZpKGVpKTt9LAogICAgICAgICAgICAgIHVzZURlYnVnVmFsdWU6IEFpLCB1c2VEZWZlcnJlZFZhbHVlOiBmdW5jdGlvbiB1c2VEZWZlcnJlZFZhbHVlKGEpIHt2YXIgYiA9IGRpKCk7cmV0dXJuIERpKGIsIE8ubWVtb2l6ZWRTdGF0ZSwgYSk7fSwgdXNlVHJhbnNpdGlvbjogZnVuY3Rpb24gdXNlVHJhbnNpdGlvbigpIHt2YXIgYSA9IGZpKGVpKVswXSxiID0gZGkoKS5tZW1vaXplZFN0YXRlO3JldHVybiBbYSwgYl07fSwgdXNlTXV0YWJsZVNvdXJjZTogaGksIHVzZVN5bmNFeHRlcm5hbFN0b3JlOiBpaSwgdXNlSWQ6IEZpLCB1bnN0YWJsZV9pc05ld1JlY29uY2lsZXI6ICExIH0sJGggPSB7IHJlYWRDb250ZXh0OiBWZywgdXNlQ2FsbGJhY2s6IEJpLCB1c2VDb250ZXh0OiBWZywgdXNlRWZmZWN0OiBqaSwgdXNlSW1wZXJhdGl2ZUhhbmRsZTogemksIHVzZUluc2VydGlvbkVmZmVjdDogd2ksIHVzZUxheW91dEVmZmVjdDogeGksIHVzZU1lbW86IENpLCB1c2VSZWR1Y2VyOiBnaSwgdXNlUmVmOiBzaSwgdXNlU3RhdGU6IGZ1bmN0aW9uIHVzZVN0YXRlKCkge3JldHVybiBnaShlaSk7fSwgdXNlRGVidWdWYWx1ZTogQWksIHVzZURlZmVycmVkVmFsdWU6IGZ1bmN0aW9uIHVzZURlZmVycmVkVmFsdWUoYSkge3ZhciBiID0gZGkoKTtyZXR1cm4gbnVsbCA9PT0KICAgICAgICAgICAgICAgIE8gPyBiLm1lbW9pemVkU3RhdGUgPSBhIDogRGkoYiwgTy5tZW1vaXplZFN0YXRlLCBhKTt9LCB1c2VUcmFuc2l0aW9uOiBmdW5jdGlvbiB1c2VUcmFuc2l0aW9uKCkge3ZhciBhID0gZ2koZWkpWzBdLGIgPSBkaSgpLm1lbW9pemVkU3RhdGU7cmV0dXJuIFthLCBiXTt9LCB1c2VNdXRhYmxlU291cmNlOiBoaSwgdXNlU3luY0V4dGVybmFsU3RvcmU6IGlpLCB1c2VJZDogRmksIHVuc3RhYmxlX2lzTmV3UmVjb25jaWxlcjogITEgfTtmdW5jdGlvbiBLaShhLCBiKSB7dHJ5IHt2YXIgYyA9ICIiLGQgPSBiO2RvIGMgKz0gUGEoZCksIGQgPSBkLnJldHVybjsgd2hpbGUgKGQpO3ZhciBlID0gYzt9IGNhdGNoIChmKSB7ZSA9ICJcbkVycm9yIGdlbmVyYXRpbmcgc3RhY2s6ICIgKyBmLm1lc3NhZ2UgKyAiXG4iICsgZi5zdGFjazt9cmV0dXJuIHsgdmFsdWU6IGEsIHNvdXJjZTogYiwgc3RhY2s6IGUsIGRpZ2VzdDogbnVsbCB9O31mdW5jdGlvbiBMaShhLCBiLCBjKSB7cmV0dXJuIHsgdmFsdWU6IGEsIHNvdXJjZTogbnVsbCwgc3RhY2s6IG51bGwgIT0gYyA/IGMgOiBudWxsLCBkaWdlc3Q6IG51bGwgIT0gYiA/IGIgOiBudWxsIH07fQogICAgICAgICAgZnVuY3Rpb24gTWkoYSwgYikge3RyeSB7Y29uc29sZS5lcnJvcihiLnZhbHVlKTt9IGNhdGNoIChjKSB7c2V0VGltZW91dChmdW5jdGlvbiAoKSB7dGhyb3cgYzt9KTt9fXZhciBOaSA9ICJmdW5jdGlvbiIgPT09IHR5cGVvZiBXZWFrTWFwID8gV2Vha01hcCA6IE1hcDtmdW5jdGlvbiBPaShhLCBiLCBjKSB7YyA9IGNoKC0xLCBjKTtjLnRhZyA9IDM7Yy5wYXlsb2FkID0geyBlbGVtZW50OiBudWxsIH07dmFyIGQgPSBiLnZhbHVlO2MuY2FsbGJhY2sgPSBmdW5jdGlvbiAoKSB7UGkgfHwgKFBpID0gITAsIFFpID0gZCk7TWkoYSwgYik7fTtyZXR1cm4gYzt9CiAgICAgICAgICBmdW5jdGlvbiBSaShhLCBiLCBjKSB7YyA9IGNoKC0xLCBjKTtjLnRhZyA9IDM7dmFyIGQgPSBhLnR5cGUuZ2V0RGVyaXZlZFN0YXRlRnJvbUVycm9yO2lmICgiZnVuY3Rpb24iID09PSB0eXBlb2YgZCkge3ZhciBlID0gYi52YWx1ZTtjLnBheWxvYWQgPSBmdW5jdGlvbiAoKSB7cmV0dXJuIGQoZSk7fTtjLmNhbGxiYWNrID0gZnVuY3Rpb24gKCkge01pKGEsIGIpO307fXZhciBmID0gYS5zdGF0ZU5vZGU7bnVsbCAhPT0gZiAmJiAiZnVuY3Rpb24iID09PSB0eXBlb2YgZi5jb21wb25lbnREaWRDYXRjaCAmJiAoYy5jYWxsYmFjayA9IGZ1bmN0aW9uICgpIHtNaShhLCBiKTsiZnVuY3Rpb24iICE9PSB0eXBlb2YgZCAmJiAobnVsbCA9PT0gU2kgPyBTaSA9IG5ldyBTZXQoW3RoaXNdKSA6IFNpLmFkZCh0aGlzKSk7dmFyIGMgPSBiLnN0YWNrO3RoaXMuY29tcG9uZW50RGlkQ2F0Y2goYi52YWx1ZSwgeyBjb21wb25lbnRTdGFjazogbnVsbCAhPT0gYyA/IGMgOiAiIiB9KTt9KTtyZXR1cm4gYzt9CiAgICAgICAgICBmdW5jdGlvbiBUaShhLCBiLCBjKSB7dmFyIGQgPSBhLnBpbmdDYWNoZTtpZiAobnVsbCA9PT0gZCkge2QgPSBhLnBpbmdDYWNoZSA9IG5ldyBOaSgpO3ZhciBlID0gbmV3IFNldCgpO2Quc2V0KGIsIGUpO30gZWxzZSBlID0gZC5nZXQoYiksIHZvaWQgMCA9PT0gZSAmJiAoZSA9IG5ldyBTZXQoKSwgZC5zZXQoYiwgZSkpO2UuaGFzKGMpIHx8IChlLmFkZChjKSwgYSA9IFVpLmJpbmQobnVsbCwgYSwgYiwgYyksIGIudGhlbihhLCBhKSk7fWZ1bmN0aW9uIFZpKGEpIHtkbyB7dmFyIGI7aWYgKGIgPSAxMyA9PT0gYS50YWcpIGIgPSBhLm1lbW9pemVkU3RhdGUsIGIgPSBudWxsICE9PSBiID8gbnVsbCAhPT0gYi5kZWh5ZHJhdGVkID8gITAgOiAhMSA6ICEwO2lmIChiKSByZXR1cm4gYTthID0gYS5yZXR1cm47fSB3aGlsZSAobnVsbCAhPT0gYSk7cmV0dXJuIG51bGw7fQogICAgICAgICAgZnVuY3Rpb24gV2koYSwgYiwgYywgZCwgZSkge2lmICgwID09PSAoYS5tb2RlICYgMSkpIHJldHVybiBhID09PSBiID8gYS5mbGFncyB8PSA2NTUzNiA6IChhLmZsYWdzIHw9IDEyOCwgYy5mbGFncyB8PSAxMzEwNzIsIGMuZmxhZ3MgJj0gLTUyODA1LCAxID09PSBjLnRhZyAmJiAobnVsbCA9PT0gYy5hbHRlcm5hdGUgPyBjLnRhZyA9IDE3IDogKGIgPSBjaCgtMSwgMSksIGIudGFnID0gMiwgZGgoYywgYiwgMSkpKSwgYy5sYW5lcyB8PSAxKSwgYTthLmZsYWdzIHw9IDY1NTM2O2EubGFuZXMgPSBlO3JldHVybiBhO312YXIgWGkgPSB1YS5SZWFjdEN1cnJlbnRPd25lcixVZyA9ICExO2Z1bmN0aW9uIFlpKGEsIGIsIGMsIGQpIHtiLmNoaWxkID0gbnVsbCA9PT0gYSA/IENoKGIsIG51bGwsIGMsIGQpIDogQmgoYiwgYS5jaGlsZCwgYywgZCk7fQogICAgICAgICAgZnVuY3Rpb24gWmkoYSwgYiwgYywgZCwgZSkge2MgPSBjLnJlbmRlcjt2YXIgZiA9IGIucmVmO1RnKGIsIGUpO2QgPSBYaChhLCBiLCBjLCBkLCBmLCBlKTtjID0gYmkoKTtpZiAobnVsbCAhPT0gYSAmJiAhVWcpIHJldHVybiBiLnVwZGF0ZVF1ZXVlID0gYS51cGRhdGVRdWV1ZSwgYi5mbGFncyAmPSAtMjA1MywgYS5sYW5lcyAmPSB+ZSwgJGkoYSwgYiwgZSk7SSAmJiBjICYmIHZnKGIpO2IuZmxhZ3MgfD0gMTtZaShhLCBiLCBkLCBlKTtyZXR1cm4gYi5jaGlsZDt9CiAgICAgICAgICBmdW5jdGlvbiBhaihhLCBiLCBjLCBkLCBlKSB7aWYgKG51bGwgPT09IGEpIHt2YXIgZiA9IGMudHlwZTtpZiAoImZ1bmN0aW9uIiA9PT0gdHlwZW9mIGYgJiYgIWJqKGYpICYmIHZvaWQgMCA9PT0gZi5kZWZhdWx0UHJvcHMgJiYgbnVsbCA9PT0gYy5jb21wYXJlICYmIHZvaWQgMCA9PT0gYy5kZWZhdWx0UHJvcHMpIHJldHVybiBiLnRhZyA9IDE1LCBiLnR5cGUgPSBmLCBjaihhLCBiLCBmLCBkLCBlKTthID0geWgoYy50eXBlLCBudWxsLCBkLCBiLCBiLm1vZGUsIGUpO2EucmVmID0gYi5yZWY7YS5yZXR1cm4gPSBiO3JldHVybiBiLmNoaWxkID0gYTt9ZiA9IGEuY2hpbGQ7aWYgKDAgPT09IChhLmxhbmVzICYgZSkpIHt2YXIgZyA9IGYubWVtb2l6ZWRQcm9wcztjID0gYy5jb21wYXJlO2MgPSBudWxsICE9PSBjID8gYyA6IEllO2lmIChjKGcsIGQpICYmIGEucmVmID09PSBiLnJlZikgcmV0dXJuICRpKGEsIGIsIGUpO31iLmZsYWdzIHw9IDE7YSA9IHdoKGYsIGQpO2EucmVmID0gYi5yZWY7YS5yZXR1cm4gPSBiO3JldHVybiBiLmNoaWxkID0gYTt9CiAgICAgICAgICBmdW5jdGlvbiBjaihhLCBiLCBjLCBkLCBlKSB7aWYgKG51bGwgIT09IGEpIHt2YXIgZiA9IGEubWVtb2l6ZWRQcm9wcztpZiAoSWUoZiwgZCkgJiYgYS5yZWYgPT09IGIucmVmKSBpZiAoVWcgPSAhMSwgYi5wZW5kaW5nUHJvcHMgPSBkID0gZiwgMCAhPT0gKGEubGFuZXMgJiBlKSkgMCAhPT0gKGEuZmxhZ3MgJiAxMzEwNzIpICYmIChVZyA9ICEwKTtlbHNlIHJldHVybiBiLmxhbmVzID0gYS5sYW5lcywgJGkoYSwgYiwgZSk7fXJldHVybiBkaihhLCBiLCBjLCBkLCBlKTt9CiAgICAgICAgICBmdW5jdGlvbiBlaihhLCBiLCBjKSB7dmFyIGQgPSBiLnBlbmRpbmdQcm9wcyxlID0gZC5jaGlsZHJlbixmID0gbnVsbCAhPT0gYSA/IGEubWVtb2l6ZWRTdGF0ZSA6IG51bGw7aWYgKCJoaWRkZW4iID09PSBkLm1vZGUpIHtpZiAoMCA9PT0gKGIubW9kZSAmIDEpKSBiLm1lbW9pemVkU3RhdGUgPSB7IGJhc2VMYW5lczogMCwgY2FjaGVQb29sOiBudWxsLCB0cmFuc2l0aW9uczogbnVsbCB9LCBHKGZqLCBnaiksIGdqIHw9IGM7ZWxzZSB7aWYgKDAgPT09IChjICYgMTA3Mzc0MTgyNCkpIHJldHVybiBhID0gbnVsbCAhPT0gZiA/IGYuYmFzZUxhbmVzIHwgYyA6IGMsIGIubGFuZXMgPSBiLmNoaWxkTGFuZXMgPSAxMDczNzQxODI0LCBiLm1lbW9pemVkU3RhdGUgPSB7IGJhc2VMYW5lczogYSwgY2FjaGVQb29sOiBudWxsLCB0cmFuc2l0aW9uczogbnVsbCB9LCBiLnVwZGF0ZVF1ZXVlID0gbnVsbCwgRyhmaiwgZ2opLCBnaiB8PSBhLCBudWxsO2IubWVtb2l6ZWRTdGF0ZSA9IHsgYmFzZUxhbmVzOiAwLCBjYWNoZVBvb2w6IG51bGwsIHRyYW5zaXRpb25zOiBudWxsIH07ZCA9IG51bGwgIT09IGYgPyBmLmJhc2VMYW5lcyA6IGM7RyhmaiwgZ2opO2dqIHw9IGQ7fX0gZWxzZSBudWxsICE9PQogICAgICAgICAgICBmID8gKGQgPSBmLmJhc2VMYW5lcyB8IGMsIGIubWVtb2l6ZWRTdGF0ZSA9IG51bGwpIDogZCA9IGMsIEcoZmosIGdqKSwgZ2ogfD0gZDtZaShhLCBiLCBlLCBjKTtyZXR1cm4gYi5jaGlsZDt9ZnVuY3Rpb24gaGooYSwgYikge3ZhciBjID0gYi5yZWY7aWYgKG51bGwgPT09IGEgJiYgbnVsbCAhPT0gYyB8fCBudWxsICE9PSBhICYmIGEucmVmICE9PSBjKSBiLmZsYWdzIHw9IDUxMiwgYi5mbGFncyB8PSAyMDk3MTUyO31mdW5jdGlvbiBkaihhLCBiLCBjLCBkLCBlKSB7dmFyIGYgPSBaZihjKSA/IFhmIDogSC5jdXJyZW50O2YgPSBZZihiLCBmKTtUZyhiLCBlKTtjID0gWGgoYSwgYiwgYywgZCwgZiwgZSk7ZCA9IGJpKCk7aWYgKG51bGwgIT09IGEgJiYgIVVnKSByZXR1cm4gYi51cGRhdGVRdWV1ZSA9IGEudXBkYXRlUXVldWUsIGIuZmxhZ3MgJj0gLTIwNTMsIGEubGFuZXMgJj0gfmUsICRpKGEsIGIsIGUpO0kgJiYgZCAmJiB2ZyhiKTtiLmZsYWdzIHw9IDE7WWkoYSwgYiwgYywgZSk7cmV0dXJuIGIuY2hpbGQ7fQogICAgICAgICAgZnVuY3Rpb24gaWooYSwgYiwgYywgZCwgZSkge2lmIChaZihjKSkge3ZhciBmID0gITA7Y2coYik7fSBlbHNlIGYgPSAhMTtUZyhiLCBlKTtpZiAobnVsbCA9PT0gYi5zdGF0ZU5vZGUpIGpqKGEsIGIpLCBwaChiLCBjLCBkKSwgcmgoYiwgYywgZCwgZSksIGQgPSAhMDtlbHNlIGlmIChudWxsID09PSBhKSB7dmFyIGcgPSBiLnN0YXRlTm9kZSxoID0gYi5tZW1vaXplZFByb3BzO2cucHJvcHMgPSBoO3ZhciBrID0gZy5jb250ZXh0LGwgPSBjLmNvbnRleHRUeXBlOyJvYmplY3QiID09PSB0eXBlb2YgbCAmJiBudWxsICE9PSBsID8gbCA9IFZnKGwpIDogKGwgPSBaZihjKSA/IFhmIDogSC5jdXJyZW50LCBsID0gWWYoYiwgbCkpO3ZhciBtID0gYy5nZXREZXJpdmVkU3RhdGVGcm9tUHJvcHMscSA9ICJmdW5jdGlvbiIgPT09IHR5cGVvZiBtIHx8ICJmdW5jdGlvbiIgPT09IHR5cGVvZiBnLmdldFNuYXBzaG90QmVmb3JlVXBkYXRlO3EgfHwgImZ1bmN0aW9uIiAhPT0gdHlwZW9mIGcuVU5TQUZFX2NvbXBvbmVudFdpbGxSZWNlaXZlUHJvcHMgJiYgImZ1bmN0aW9uIiAhPT0gdHlwZW9mIGcuY29tcG9uZW50V2lsbFJlY2VpdmVQcm9wcyB8fAogICAgICAgICAgICAgIChoICE9PSBkIHx8IGsgIT09IGwpICYmIHFoKGIsIGcsIGQsIGwpOyRnID0gITE7dmFyIHIgPSBiLm1lbW9pemVkU3RhdGU7Zy5zdGF0ZSA9IHI7Z2goYiwgZCwgZywgZSk7ayA9IGIubWVtb2l6ZWRTdGF0ZTtoICE9PSBkIHx8IHIgIT09IGsgfHwgV2YuY3VycmVudCB8fCAkZyA/ICgiZnVuY3Rpb24iID09PSB0eXBlb2YgbSAmJiAoa2goYiwgYywgbSwgZCksIGsgPSBiLm1lbW9pemVkU3RhdGUpLCAoaCA9ICRnIHx8IG9oKGIsIGMsIGgsIGQsIHIsIGssIGwpKSA/IChxIHx8ICJmdW5jdGlvbiIgIT09IHR5cGVvZiBnLlVOU0FGRV9jb21wb25lbnRXaWxsTW91bnQgJiYgImZ1bmN0aW9uIiAhPT0gdHlwZW9mIGcuY29tcG9uZW50V2lsbE1vdW50IHx8ICgiZnVuY3Rpb24iID09PSB0eXBlb2YgZy5jb21wb25lbnRXaWxsTW91bnQgJiYgZy5jb21wb25lbnRXaWxsTW91bnQoKSwgImZ1bmN0aW9uIiA9PT0gdHlwZW9mIGcuVU5TQUZFX2NvbXBvbmVudFdpbGxNb3VudCAmJiBnLlVOU0FGRV9jb21wb25lbnRXaWxsTW91bnQoKSksICJmdW5jdGlvbiIgPT09IHR5cGVvZiBnLmNvbXBvbmVudERpZE1vdW50ICYmIChiLmZsYWdzIHw9IDQxOTQzMDgpKSA6ICgKICAgICAgICAgICAgICAiZnVuY3Rpb24iID09PSB0eXBlb2YgZy5jb21wb25lbnREaWRNb3VudCAmJiAoYi5mbGFncyB8PSA0MTk0MzA4KSwgYi5tZW1vaXplZFByb3BzID0gZCwgYi5tZW1vaXplZFN0YXRlID0gayksIGcucHJvcHMgPSBkLCBnLnN0YXRlID0gaywgZy5jb250ZXh0ID0gbCwgZCA9IGgpIDogKCJmdW5jdGlvbiIgPT09IHR5cGVvZiBnLmNvbXBvbmVudERpZE1vdW50ICYmIChiLmZsYWdzIHw9IDQxOTQzMDgpLCBkID0gITEpO30gZWxzZSB7ZyA9IGIuc3RhdGVOb2RlO2JoKGEsIGIpO2ggPSBiLm1lbW9pemVkUHJvcHM7bCA9IGIudHlwZSA9PT0gYi5lbGVtZW50VHlwZSA/IGggOiBMZyhiLnR5cGUsIGgpO2cucHJvcHMgPSBsO3EgPSBiLnBlbmRpbmdQcm9wcztyID0gZy5jb250ZXh0O2sgPSBjLmNvbnRleHRUeXBlOyJvYmplY3QiID09PSB0eXBlb2YgayAmJiBudWxsICE9PSBrID8gayA9IFZnKGspIDogKGsgPSBaZihjKSA/IFhmIDogSC5jdXJyZW50LCBrID0gWWYoYiwgaykpO3ZhciB5ID0gYy5nZXREZXJpdmVkU3RhdGVGcm9tUHJvcHM7KG0gPSAiZnVuY3Rpb24iID09PSB0eXBlb2YgeSB8fCAiZnVuY3Rpb24iID09PSB0eXBlb2YgZy5nZXRTbmFwc2hvdEJlZm9yZVVwZGF0ZSkgfHwKICAgICAgICAgICAgICAiZnVuY3Rpb24iICE9PSB0eXBlb2YgZy5VTlNBRkVfY29tcG9uZW50V2lsbFJlY2VpdmVQcm9wcyAmJiAiZnVuY3Rpb24iICE9PSB0eXBlb2YgZy5jb21wb25lbnRXaWxsUmVjZWl2ZVByb3BzIHx8IChoICE9PSBxIHx8IHIgIT09IGspICYmIHFoKGIsIGcsIGQsIGspOyRnID0gITE7ciA9IGIubWVtb2l6ZWRTdGF0ZTtnLnN0YXRlID0gcjtnaChiLCBkLCBnLCBlKTt2YXIgbiA9IGIubWVtb2l6ZWRTdGF0ZTtoICE9PSBxIHx8IHIgIT09IG4gfHwgV2YuY3VycmVudCB8fCAkZyA/ICgiZnVuY3Rpb24iID09PSB0eXBlb2YgeSAmJiAoa2goYiwgYywgeSwgZCksIG4gPSBiLm1lbW9pemVkU3RhdGUpLCAobCA9ICRnIHx8IG9oKGIsIGMsIGwsIGQsIHIsIG4sIGspIHx8ICExKSA/IChtIHx8ICJmdW5jdGlvbiIgIT09IHR5cGVvZiBnLlVOU0FGRV9jb21wb25lbnRXaWxsVXBkYXRlICYmICJmdW5jdGlvbiIgIT09IHR5cGVvZiBnLmNvbXBvbmVudFdpbGxVcGRhdGUgfHwgKCJmdW5jdGlvbiIgPT09IHR5cGVvZiBnLmNvbXBvbmVudFdpbGxVcGRhdGUgJiYgZy5jb21wb25lbnRXaWxsVXBkYXRlKGQsIG4sIGspLCAiZnVuY3Rpb24iID09PSB0eXBlb2YgZy5VTlNBRkVfY29tcG9uZW50V2lsbFVwZGF0ZSAmJgogICAgICAgICAgICAgIGcuVU5TQUZFX2NvbXBvbmVudFdpbGxVcGRhdGUoZCwgbiwgaykpLCAiZnVuY3Rpb24iID09PSB0eXBlb2YgZy5jb21wb25lbnREaWRVcGRhdGUgJiYgKGIuZmxhZ3MgfD0gNCksICJmdW5jdGlvbiIgPT09IHR5cGVvZiBnLmdldFNuYXBzaG90QmVmb3JlVXBkYXRlICYmIChiLmZsYWdzIHw9IDEwMjQpKSA6ICgiZnVuY3Rpb24iICE9PSB0eXBlb2YgZy5jb21wb25lbnREaWRVcGRhdGUgfHwgaCA9PT0gYS5tZW1vaXplZFByb3BzICYmIHIgPT09IGEubWVtb2l6ZWRTdGF0ZSB8fCAoYi5mbGFncyB8PSA0KSwgImZ1bmN0aW9uIiAhPT0gdHlwZW9mIGcuZ2V0U25hcHNob3RCZWZvcmVVcGRhdGUgfHwgaCA9PT0gYS5tZW1vaXplZFByb3BzICYmIHIgPT09IGEubWVtb2l6ZWRTdGF0ZSB8fCAoYi5mbGFncyB8PSAxMDI0KSwgYi5tZW1vaXplZFByb3BzID0gZCwgYi5tZW1vaXplZFN0YXRlID0gbiksIGcucHJvcHMgPSBkLCBnLnN0YXRlID0gbiwgZy5jb250ZXh0ID0gaywgZCA9IGwpIDogKCJmdW5jdGlvbiIgIT09IHR5cGVvZiBnLmNvbXBvbmVudERpZFVwZGF0ZSB8fCBoID09PSBhLm1lbW9pemVkUHJvcHMgJiYgciA9PT0KICAgICAgICAgICAgICBhLm1lbW9pemVkU3RhdGUgfHwgKGIuZmxhZ3MgfD0gNCksICJmdW5jdGlvbiIgIT09IHR5cGVvZiBnLmdldFNuYXBzaG90QmVmb3JlVXBkYXRlIHx8IGggPT09IGEubWVtb2l6ZWRQcm9wcyAmJiByID09PSBhLm1lbW9pemVkU3RhdGUgfHwgKGIuZmxhZ3MgfD0gMTAyNCksIGQgPSAhMSk7fXJldHVybiBraihhLCBiLCBjLCBkLCBmLCBlKTt9CiAgICAgICAgICBmdW5jdGlvbiBraihhLCBiLCBjLCBkLCBlLCBmKSB7aGooYSwgYik7dmFyIGcgPSAwICE9PSAoYi5mbGFncyAmIDEyOCk7aWYgKCFkICYmICFnKSByZXR1cm4gZSAmJiBkZyhiLCBjLCAhMSksICRpKGEsIGIsIGYpO2QgPSBiLnN0YXRlTm9kZTtYaS5jdXJyZW50ID0gYjt2YXIgaCA9IGcgJiYgImZ1bmN0aW9uIiAhPT0gdHlwZW9mIGMuZ2V0RGVyaXZlZFN0YXRlRnJvbUVycm9yID8gbnVsbCA6IGQucmVuZGVyKCk7Yi5mbGFncyB8PSAxO251bGwgIT09IGEgJiYgZyA/IChiLmNoaWxkID0gQmgoYiwgYS5jaGlsZCwgbnVsbCwgZiksIGIuY2hpbGQgPSBCaChiLCBudWxsLCBoLCBmKSkgOiBZaShhLCBiLCBoLCBmKTtiLm1lbW9pemVkU3RhdGUgPSBkLnN0YXRlO2UgJiYgZGcoYiwgYywgITApO3JldHVybiBiLmNoaWxkO31mdW5jdGlvbiBsaihhKSB7dmFyIGIgPSBhLnN0YXRlTm9kZTtiLnBlbmRpbmdDb250ZXh0ID8gYWcoYSwgYi5wZW5kaW5nQ29udGV4dCwgYi5wZW5kaW5nQ29udGV4dCAhPT0gYi5jb250ZXh0KSA6IGIuY29udGV4dCAmJiBhZyhhLCBiLmNvbnRleHQsICExKTtJaChhLCBiLmNvbnRhaW5lckluZm8pO30KICAgICAgICAgIGZ1bmN0aW9uIG1qKGEsIGIsIGMsIGQsIGUpIHtJZygpO0pnKGUpO2IuZmxhZ3MgfD0gMjU2O1lpKGEsIGIsIGMsIGQpO3JldHVybiBiLmNoaWxkO312YXIgbmogPSB7IGRlaHlkcmF0ZWQ6IG51bGwsIHRyZWVDb250ZXh0OiBudWxsLCByZXRyeUxhbmU6IDAgfTtmdW5jdGlvbiBvaihhKSB7cmV0dXJuIHsgYmFzZUxhbmVzOiBhLCBjYWNoZVBvb2w6IG51bGwsIHRyYW5zaXRpb25zOiBudWxsIH07fQogICAgICAgICAgZnVuY3Rpb24gcGooYSwgYiwgYykge3ZhciBkID0gYi5wZW5kaW5nUHJvcHMsZSA9IE0uY3VycmVudCxmID0gITEsZyA9IDAgIT09IChiLmZsYWdzICYgMTI4KSxoOyhoID0gZykgfHwgKGggPSBudWxsICE9PSBhICYmIG51bGwgPT09IGEubWVtb2l6ZWRTdGF0ZSA/ICExIDogMCAhPT0gKGUgJiAyKSk7aWYgKGgpIGYgPSAhMCwgYi5mbGFncyAmPSAtMTI5O2Vsc2UgaWYgKG51bGwgPT09IGEgfHwgbnVsbCAhPT0gYS5tZW1vaXplZFN0YXRlKSBlIHw9IDE7RyhNLCBlICYgMSk7aWYgKG51bGwgPT09IGEpIHtFZyhiKTthID0gYi5tZW1vaXplZFN0YXRlO2lmIChudWxsICE9PSBhICYmIChhID0gYS5kZWh5ZHJhdGVkLCBudWxsICE9PSBhKSkgcmV0dXJuIDAgPT09IChiLm1vZGUgJiAxKSA/IGIubGFuZXMgPSAxIDogIiQhIiA9PT0gYS5kYXRhID8gYi5sYW5lcyA9IDggOiBiLmxhbmVzID0gMTA3Mzc0MTgyNCwgbnVsbDtnID0gZC5jaGlsZHJlbjthID0gZC5mYWxsYmFjaztyZXR1cm4gZiA/IChkID0gYi5tb2RlLCBmID0gYi5jaGlsZCwgZyA9IHsgbW9kZTogImhpZGRlbiIsIGNoaWxkcmVuOiBnIH0sIDAgPT09IChkICYgMSkgJiYgbnVsbCAhPT0gZiA/IChmLmNoaWxkTGFuZXMgPSAwLCBmLnBlbmRpbmdQcm9wcyA9CiAgICAgICAgICAgICAgZykgOiBmID0gcWooZywgZCwgMCwgbnVsbCksIGEgPSBBaChhLCBkLCBjLCBudWxsKSwgZi5yZXR1cm4gPSBiLCBhLnJldHVybiA9IGIsIGYuc2libGluZyA9IGEsIGIuY2hpbGQgPSBmLCBiLmNoaWxkLm1lbW9pemVkU3RhdGUgPSBvaihjKSwgYi5tZW1vaXplZFN0YXRlID0gbmosIGEpIDogcmooYiwgZyk7fWUgPSBhLm1lbW9pemVkU3RhdGU7aWYgKG51bGwgIT09IGUgJiYgKGggPSBlLmRlaHlkcmF0ZWQsIG51bGwgIT09IGgpKSByZXR1cm4gc2ooYSwgYiwgZywgZCwgaCwgZSwgYyk7aWYgKGYpIHtmID0gZC5mYWxsYmFjaztnID0gYi5tb2RlO2UgPSBhLmNoaWxkO2ggPSBlLnNpYmxpbmc7dmFyIGsgPSB7IG1vZGU6ICJoaWRkZW4iLCBjaGlsZHJlbjogZC5jaGlsZHJlbiB9OzAgPT09IChnICYgMSkgJiYgYi5jaGlsZCAhPT0gZSA/IChkID0gYi5jaGlsZCwgZC5jaGlsZExhbmVzID0gMCwgZC5wZW5kaW5nUHJvcHMgPSBrLCBiLmRlbGV0aW9ucyA9IG51bGwpIDogKGQgPSB3aChlLCBrKSwgZC5zdWJ0cmVlRmxhZ3MgPSBlLnN1YnRyZWVGbGFncyAmIDE0NjgwMDY0KTtudWxsICE9PSBoID8gZiA9IHdoKGgsIGYpIDogKGYgPSBBaChmLCBnLCBjLCBudWxsKSwgZi5mbGFncyB8PSAyKTtmLnJldHVybiA9CiAgICAgICAgICAgICAgYjtkLnJldHVybiA9IGI7ZC5zaWJsaW5nID0gZjtiLmNoaWxkID0gZDtkID0gZjtmID0gYi5jaGlsZDtnID0gYS5jaGlsZC5tZW1vaXplZFN0YXRlO2cgPSBudWxsID09PSBnID8gb2ooYykgOiB7IGJhc2VMYW5lczogZy5iYXNlTGFuZXMgfCBjLCBjYWNoZVBvb2w6IG51bGwsIHRyYW5zaXRpb25zOiBnLnRyYW5zaXRpb25zIH07Zi5tZW1vaXplZFN0YXRlID0gZztmLmNoaWxkTGFuZXMgPSBhLmNoaWxkTGFuZXMgJiB+YztiLm1lbW9pemVkU3RhdGUgPSBuajtyZXR1cm4gZDt9ZiA9IGEuY2hpbGQ7YSA9IGYuc2libGluZztkID0gd2goZiwgeyBtb2RlOiAidmlzaWJsZSIsIGNoaWxkcmVuOiBkLmNoaWxkcmVuIH0pOzAgPT09IChiLm1vZGUgJiAxKSAmJiAoZC5sYW5lcyA9IGMpO2QucmV0dXJuID0gYjtkLnNpYmxpbmcgPSBudWxsO251bGwgIT09IGEgJiYgKGMgPSBiLmRlbGV0aW9ucywgbnVsbCA9PT0gYyA/IChiLmRlbGV0aW9ucyA9IFthXSwgYi5mbGFncyB8PSAxNikgOiBjLnB1c2goYSkpO2IuY2hpbGQgPSBkO2IubWVtb2l6ZWRTdGF0ZSA9IG51bGw7cmV0dXJuIGQ7fQogICAgICAgICAgZnVuY3Rpb24gcmooYSwgYikge2IgPSBxaih7IG1vZGU6ICJ2aXNpYmxlIiwgY2hpbGRyZW46IGIgfSwgYS5tb2RlLCAwLCBudWxsKTtiLnJldHVybiA9IGE7cmV0dXJuIGEuY2hpbGQgPSBiO31mdW5jdGlvbiB0aihhLCBiLCBjLCBkKSB7bnVsbCAhPT0gZCAmJiBKZyhkKTtCaChiLCBhLmNoaWxkLCBudWxsLCBjKTthID0gcmooYiwgYi5wZW5kaW5nUHJvcHMuY2hpbGRyZW4pO2EuZmxhZ3MgfD0gMjtiLm1lbW9pemVkU3RhdGUgPSBudWxsO3JldHVybiBhO30KICAgICAgICAgIGZ1bmN0aW9uIHNqKGEsIGIsIGMsIGQsIGUsIGYsIGcpIHtpZiAoYykge2lmIChiLmZsYWdzICYgMjU2KSByZXR1cm4gYi5mbGFncyAmPSAtMjU3LCBkID0gTGkoRXJyb3IocCg0MjIpKSksIHRqKGEsIGIsIGcsIGQpO2lmIChudWxsICE9PSBiLm1lbW9pemVkU3RhdGUpIHJldHVybiBiLmNoaWxkID0gYS5jaGlsZCwgYi5mbGFncyB8PSAxMjgsIG51bGw7ZiA9IGQuZmFsbGJhY2s7ZSA9IGIubW9kZTtkID0gcWooeyBtb2RlOiAidmlzaWJsZSIsIGNoaWxkcmVuOiBkLmNoaWxkcmVuIH0sIGUsIDAsIG51bGwpO2YgPSBBaChmLCBlLCBnLCBudWxsKTtmLmZsYWdzIHw9IDI7ZC5yZXR1cm4gPSBiO2YucmV0dXJuID0gYjtkLnNpYmxpbmcgPSBmO2IuY2hpbGQgPSBkOzAgIT09IChiLm1vZGUgJiAxKSAmJiBCaChiLCBhLmNoaWxkLCBudWxsLCBnKTtiLmNoaWxkLm1lbW9pemVkU3RhdGUgPSBvaihnKTtiLm1lbW9pemVkU3RhdGUgPSBuajtyZXR1cm4gZjt9aWYgKDAgPT09IChiLm1vZGUgJiAxKSkgcmV0dXJuIHRqKGEsIGIsIGcsIG51bGwpO2lmICgiJCEiID09PSBlLmRhdGEpIHtkID0gZS5uZXh0U2libGluZyAmJiBlLm5leHRTaWJsaW5nLmRhdGFzZXQ7CiAgICAgICAgICAgICAgaWYgKGQpIHZhciBoID0gZC5kZ3N0O2QgPSBoO2YgPSBFcnJvcihwKDQxOSkpO2QgPSBMaShmLCBkLCB2b2lkIDApO3JldHVybiB0aihhLCBiLCBnLCBkKTt9aCA9IDAgIT09IChnICYgYS5jaGlsZExhbmVzKTtpZiAoVWcgfHwgaCkge2QgPSBSO2lmIChudWxsICE9PSBkKSB7c3dpdGNoIChnICYgLWcpIHtjYXNlIDQ6ZSA9IDI7YnJlYWs7Y2FzZSAxNjplID0gODticmVhaztjYXNlIDY0OmNhc2UgMTI4OmNhc2UgMjU2OmNhc2UgNTEyOmNhc2UgMTAyNDpjYXNlIDIwNDg6Y2FzZSA0MDk2OmNhc2UgODE5MjpjYXNlIDE2Mzg0OmNhc2UgMzI3Njg6Y2FzZSA2NTUzNjpjYXNlIDEzMTA3MjpjYXNlIDI2MjE0NDpjYXNlIDUyNDI4ODpjYXNlIDEwNDg1NzY6Y2FzZSAyMDk3MTUyOmNhc2UgNDE5NDMwNDpjYXNlIDgzODg2MDg6Y2FzZSAxNjc3NzIxNjpjYXNlIDMzNTU0NDMyOmNhc2UgNjcxMDg4NjQ6ZSA9IDMyO2JyZWFrO2Nhc2UgNTM2ODcwOTEyOmUgPSAyNjg0MzU0NTY7YnJlYWs7ZGVmYXVsdDplID0gMDt9ZSA9IDAgIT09IChlICYgKGQuc3VzcGVuZGVkTGFuZXMgfCBnKSkgPyAwIDogZTsKICAgICAgICAgICAgICAgIDAgIT09IGUgJiYgZSAhPT0gZi5yZXRyeUxhbmUgJiYgKGYucmV0cnlMYW5lID0gZSwgWmcoYSwgZSksIG1oKGQsIGEsIGUsIC0xKSk7fXVqKCk7ZCA9IExpKEVycm9yKHAoNDIxKSkpO3JldHVybiB0aihhLCBiLCBnLCBkKTt9aWYgKCIkPyIgPT09IGUuZGF0YSkgcmV0dXJuIGIuZmxhZ3MgfD0gMTI4LCBiLmNoaWxkID0gYS5jaGlsZCwgYiA9IHZqLmJpbmQobnVsbCwgYSksIGUuX3JlYWN0UmV0cnkgPSBiLCBudWxsO2EgPSBmLnRyZWVDb250ZXh0O3lnID0gTGYoZS5uZXh0U2libGluZyk7eGcgPSBiO0kgPSAhMDt6ZyA9IG51bGw7bnVsbCAhPT0gYSAmJiAob2dbcGcrK10gPSByZywgb2dbcGcrK10gPSBzZywgb2dbcGcrK10gPSBxZywgcmcgPSBhLmlkLCBzZyA9IGEub3ZlcmZsb3csIHFnID0gYik7YiA9IHJqKGIsIGQuY2hpbGRyZW4pO2IuZmxhZ3MgfD0gNDA5NjtyZXR1cm4gYjt9ZnVuY3Rpb24gd2ooYSwgYiwgYykge2EubGFuZXMgfD0gYjt2YXIgZCA9IGEuYWx0ZXJuYXRlO251bGwgIT09IGQgJiYgKGQubGFuZXMgfD0gYik7U2coYS5yZXR1cm4sIGIsIGMpO30KICAgICAgICAgIGZ1bmN0aW9uIHhqKGEsIGIsIGMsIGQsIGUpIHt2YXIgZiA9IGEubWVtb2l6ZWRTdGF0ZTtudWxsID09PSBmID8gYS5tZW1vaXplZFN0YXRlID0geyBpc0JhY2t3YXJkczogYiwgcmVuZGVyaW5nOiBudWxsLCByZW5kZXJpbmdTdGFydFRpbWU6IDAsIGxhc3Q6IGQsIHRhaWw6IGMsIHRhaWxNb2RlOiBlIH0gOiAoZi5pc0JhY2t3YXJkcyA9IGIsIGYucmVuZGVyaW5nID0gbnVsbCwgZi5yZW5kZXJpbmdTdGFydFRpbWUgPSAwLCBmLmxhc3QgPSBkLCBmLnRhaWwgPSBjLCBmLnRhaWxNb2RlID0gZSk7fQogICAgICAgICAgZnVuY3Rpb24geWooYSwgYiwgYykge3ZhciBkID0gYi5wZW5kaW5nUHJvcHMsZSA9IGQucmV2ZWFsT3JkZXIsZiA9IGQudGFpbDtZaShhLCBiLCBkLmNoaWxkcmVuLCBjKTtkID0gTS5jdXJyZW50O2lmICgwICE9PSAoZCAmIDIpKSBkID0gZCAmIDEgfCAyLCBiLmZsYWdzIHw9IDEyODtlbHNlIHtpZiAobnVsbCAhPT0gYSAmJiAwICE9PSAoYS5mbGFncyAmIDEyOCkpIGE6IGZvciAoYSA9IGIuY2hpbGQ7IG51bGwgIT09IGE7KSB7aWYgKDEzID09PSBhLnRhZykgbnVsbCAhPT0gYS5tZW1vaXplZFN0YXRlICYmIHdqKGEsIGMsIGIpO2Vsc2UgaWYgKDE5ID09PSBhLnRhZykgd2ooYSwgYywgYik7ZWxzZSBpZiAobnVsbCAhPT0gYS5jaGlsZCkge2EuY2hpbGQucmV0dXJuID0gYTthID0gYS5jaGlsZDtjb250aW51ZTt9aWYgKGEgPT09IGIpIGJyZWFrIGE7Zm9yICg7IG51bGwgPT09IGEuc2libGluZzspIHtpZiAobnVsbCA9PT0gYS5yZXR1cm4gfHwgYS5yZXR1cm4gPT09IGIpIGJyZWFrIGE7YSA9IGEucmV0dXJuO31hLnNpYmxpbmcucmV0dXJuID0gYS5yZXR1cm47YSA9IGEuc2libGluZzt9ZCAmPSAxO31HKE0sIGQpO2lmICgwID09PSAoYi5tb2RlICYgMSkpIGIubWVtb2l6ZWRTdGF0ZSA9CiAgICAgICAgICAgIG51bGw7ZWxzZSBzd2l0Y2ggKGUpIHtjYXNlICJmb3J3YXJkcyI6YyA9IGIuY2hpbGQ7Zm9yIChlID0gbnVsbDsgbnVsbCAhPT0gYzspIGEgPSBjLmFsdGVybmF0ZSwgbnVsbCAhPT0gYSAmJiBudWxsID09PSBNaChhKSAmJiAoZSA9IGMpLCBjID0gYy5zaWJsaW5nO2MgPSBlO251bGwgPT09IGMgPyAoZSA9IGIuY2hpbGQsIGIuY2hpbGQgPSBudWxsKSA6IChlID0gYy5zaWJsaW5nLCBjLnNpYmxpbmcgPSBudWxsKTt4aihiLCAhMSwgZSwgYywgZik7YnJlYWs7Y2FzZSAiYmFja3dhcmRzIjpjID0gbnVsbDtlID0gYi5jaGlsZDtmb3IgKGIuY2hpbGQgPSBudWxsOyBudWxsICE9PSBlOykge2EgPSBlLmFsdGVybmF0ZTtpZiAobnVsbCAhPT0gYSAmJiBudWxsID09PSBNaChhKSkge2IuY2hpbGQgPSBlO2JyZWFrO31hID0gZS5zaWJsaW5nO2Uuc2libGluZyA9IGM7YyA9IGU7ZSA9IGE7fXhqKGIsICEwLCBjLCBudWxsLCBmKTticmVhaztjYXNlICJ0b2dldGhlciI6eGooYiwgITEsIG51bGwsIG51bGwsIHZvaWQgMCk7YnJlYWs7ZGVmYXVsdDpiLm1lbW9pemVkU3RhdGUgPSBudWxsO31yZXR1cm4gYi5jaGlsZDt9CiAgICAgICAgICBmdW5jdGlvbiBqaihhLCBiKSB7MCA9PT0gKGIubW9kZSAmIDEpICYmIG51bGwgIT09IGEgJiYgKGEuYWx0ZXJuYXRlID0gbnVsbCwgYi5hbHRlcm5hdGUgPSBudWxsLCBiLmZsYWdzIHw9IDIpO31mdW5jdGlvbiAkaShhLCBiLCBjKSB7bnVsbCAhPT0gYSAmJiAoYi5kZXBlbmRlbmNpZXMgPSBhLmRlcGVuZGVuY2llcyk7aGggfD0gYi5sYW5lcztpZiAoMCA9PT0gKGMgJiBiLmNoaWxkTGFuZXMpKSByZXR1cm4gbnVsbDtpZiAobnVsbCAhPT0gYSAmJiBiLmNoaWxkICE9PSBhLmNoaWxkKSB0aHJvdyBFcnJvcihwKDE1MykpO2lmIChudWxsICE9PSBiLmNoaWxkKSB7YSA9IGIuY2hpbGQ7YyA9IHdoKGEsIGEucGVuZGluZ1Byb3BzKTtiLmNoaWxkID0gYztmb3IgKGMucmV0dXJuID0gYjsgbnVsbCAhPT0gYS5zaWJsaW5nOykgYSA9IGEuc2libGluZywgYyA9IGMuc2libGluZyA9IHdoKGEsIGEucGVuZGluZ1Byb3BzKSwgYy5yZXR1cm4gPSBiO2Muc2libGluZyA9IG51bGw7fXJldHVybiBiLmNoaWxkO30KICAgICAgICAgIGZ1bmN0aW9uIHpqKGEsIGIsIGMpIHtzd2l0Y2ggKGIudGFnKSB7Y2FzZSAzOmxqKGIpO0lnKCk7YnJlYWs7Y2FzZSA1OktoKGIpO2JyZWFrO2Nhc2UgMTpaZihiLnR5cGUpICYmIGNnKGIpO2JyZWFrO2Nhc2UgNDpJaChiLCBiLnN0YXRlTm9kZS5jb250YWluZXJJbmZvKTticmVhaztjYXNlIDEwOnZhciBkID0gYi50eXBlLl9jb250ZXh0LGUgPSBiLm1lbW9pemVkUHJvcHMudmFsdWU7RyhNZywgZC5fY3VycmVudFZhbHVlKTtkLl9jdXJyZW50VmFsdWUgPSBlO2JyZWFrO2Nhc2UgMTM6ZCA9IGIubWVtb2l6ZWRTdGF0ZTtpZiAobnVsbCAhPT0gZCkge2lmIChudWxsICE9PSBkLmRlaHlkcmF0ZWQpIHJldHVybiBHKE0sIE0uY3VycmVudCAmIDEpLCBiLmZsYWdzIHw9IDEyOCwgbnVsbDtpZiAoMCAhPT0gKGMgJiBiLmNoaWxkLmNoaWxkTGFuZXMpKSByZXR1cm4gcGooYSwgYiwgYyk7RyhNLCBNLmN1cnJlbnQgJiAxKTthID0gJGkoYSwgYiwgYyk7cmV0dXJuIG51bGwgIT09IGEgPyBhLnNpYmxpbmcgOiBudWxsO31HKE0sIE0uY3VycmVudCAmIDEpO2JyZWFrO2Nhc2UgMTk6ZCA9IDAgIT09IChjICYKICAgICAgICAgICAgICAgIGIuY2hpbGRMYW5lcyk7aWYgKDAgIT09IChhLmZsYWdzICYgMTI4KSkge2lmIChkKSByZXR1cm4geWooYSwgYiwgYyk7Yi5mbGFncyB8PSAxMjg7fWUgPSBiLm1lbW9pemVkU3RhdGU7bnVsbCAhPT0gZSAmJiAoZS5yZW5kZXJpbmcgPSBudWxsLCBlLnRhaWwgPSBudWxsLCBlLmxhc3RFZmZlY3QgPSBudWxsKTtHKE0sIE0uY3VycmVudCk7aWYgKGQpIGJyZWFrO2Vsc2UgcmV0dXJuIG51bGw7Y2FzZSAyMjpjYXNlIDIzOnJldHVybiBiLmxhbmVzID0gMCwgZWooYSwgYiwgYyk7fXJldHVybiAkaShhLCBiLCBjKTt9dmFyIEFqLCBCaiwgQ2osIERqOwogICAgICAgICAgQWogPSBmdW5jdGlvbiBBaihhLCBiKSB7Zm9yICh2YXIgYyA9IGIuY2hpbGQ7IG51bGwgIT09IGM7KSB7aWYgKDUgPT09IGMudGFnIHx8IDYgPT09IGMudGFnKSBhLmFwcGVuZENoaWxkKGMuc3RhdGVOb2RlKTtlbHNlIGlmICg0ICE9PSBjLnRhZyAmJiBudWxsICE9PSBjLmNoaWxkKSB7Yy5jaGlsZC5yZXR1cm4gPSBjO2MgPSBjLmNoaWxkO2NvbnRpbnVlO31pZiAoYyA9PT0gYikgYnJlYWs7Zm9yICg7IG51bGwgPT09IGMuc2libGluZzspIHtpZiAobnVsbCA9PT0gYy5yZXR1cm4gfHwgYy5yZXR1cm4gPT09IGIpIHJldHVybjtjID0gYy5yZXR1cm47fWMuc2libGluZy5yZXR1cm4gPSBjLnJldHVybjtjID0gYy5zaWJsaW5nO319O0JqID0gZnVuY3Rpb24gQmooKSB7fTsKICAgICAgICAgIENqID0gZnVuY3Rpb24gQ2ooYSwgYiwgYywgZCkge3ZhciBlID0gYS5tZW1vaXplZFByb3BzO2lmIChlICE9PSBkKSB7YSA9IGIuc3RhdGVOb2RlO0hoKEVoLmN1cnJlbnQpO3ZhciBmID0gbnVsbDtzd2l0Y2ggKGMpIHtjYXNlICJpbnB1dCI6ZSA9IFlhKGEsIGUpO2QgPSBZYShhLCBkKTtmID0gW107YnJlYWs7Y2FzZSAic2VsZWN0IjplID0gQSh7fSwgZSwgeyB2YWx1ZTogdm9pZCAwIH0pO2QgPSBBKHt9LCBkLCB7IHZhbHVlOiB2b2lkIDAgfSk7ZiA9IFtdO2JyZWFrO2Nhc2UgInRleHRhcmVhIjplID0gZ2IoYSwgZSk7ZCA9IGdiKGEsIGQpO2YgPSBbXTticmVhaztkZWZhdWx0OiJmdW5jdGlvbiIgIT09IHR5cGVvZiBlLm9uQ2xpY2sgJiYgImZ1bmN0aW9uIiA9PT0gdHlwZW9mIGQub25DbGljayAmJiAoYS5vbmNsaWNrID0gQmYpO311YihjLCBkKTt2YXIgZztjID0gbnVsbDtmb3IgKGwgaW4gZSkgaWYgKCFkLmhhc093blByb3BlcnR5KGwpICYmIGUuaGFzT3duUHJvcGVydHkobCkgJiYgbnVsbCAhPSBlW2xdKSBpZiAoInN0eWxlIiA9PT0gbCkge3ZhciBoID0gZVtsXTtmb3IgKGcgaW4gaCkgaC5oYXNPd25Qcm9wZXJ0eShnKSAmJiAoCiAgICAgICAgICAgICAgICBjIHx8IChjID0ge30pLCBjW2ddID0gIiIpO30gZWxzZSAiZGFuZ2Vyb3VzbHlTZXRJbm5lckhUTUwiICE9PSBsICYmICJjaGlsZHJlbiIgIT09IGwgJiYgInN1cHByZXNzQ29udGVudEVkaXRhYmxlV2FybmluZyIgIT09IGwgJiYgInN1cHByZXNzSHlkcmF0aW9uV2FybmluZyIgIT09IGwgJiYgImF1dG9Gb2N1cyIgIT09IGwgJiYgKGVhLmhhc093blByb3BlcnR5KGwpID8gZiB8fCAoZiA9IFtdKSA6IChmID0gZiB8fCBbXSkucHVzaChsLCBudWxsKSk7Zm9yIChsIGluIGQpIHt2YXIgayA9IGRbbF07aCA9IG51bGwgIT0gZSA/IGVbbF0gOiB2b2lkIDA7aWYgKGQuaGFzT3duUHJvcGVydHkobCkgJiYgayAhPT0gaCAmJiAobnVsbCAhPSBrIHx8IG51bGwgIT0gaCkpIGlmICgic3R5bGUiID09PSBsKSB7aWYgKGgpIHtmb3IgKGcgaW4gaCkgIWguaGFzT3duUHJvcGVydHkoZykgfHwgayAmJiBrLmhhc093blByb3BlcnR5KGcpIHx8IChjIHx8IChjID0ge30pLCBjW2ddID0gIiIpO2ZvciAoZyBpbiBrKSBrLmhhc093blByb3BlcnR5KGcpICYmIGhbZ10gIT09IGtbZ10gJiYgKGMgfHwgKGMgPSB7fSksIGNbZ10gPSBrW2ddKTt9IGVsc2UgYyB8fCAoZiB8fCAoZiA9IFtdKSwgZi5wdXNoKGwsCiAgICAgICAgICAgICAgICAgIGMpKSwgYyA9IGs7fSBlbHNlICJkYW5nZXJvdXNseVNldElubmVySFRNTCIgPT09IGwgPyAoayA9IGsgPyBrLl9faHRtbCA6IHZvaWQgMCwgaCA9IGggPyBoLl9faHRtbCA6IHZvaWQgMCwgbnVsbCAhPSBrICYmIGggIT09IGsgJiYgKGYgPSBmIHx8IFtdKS5wdXNoKGwsIGspKSA6ICJjaGlsZHJlbiIgPT09IGwgPyAic3RyaW5nIiAhPT0gdHlwZW9mIGsgJiYgIm51bWJlciIgIT09IHR5cGVvZiBrIHx8IChmID0gZiB8fCBbXSkucHVzaChsLCAiIiArIGspIDogInN1cHByZXNzQ29udGVudEVkaXRhYmxlV2FybmluZyIgIT09IGwgJiYgInN1cHByZXNzSHlkcmF0aW9uV2FybmluZyIgIT09IGwgJiYgKGVhLmhhc093blByb3BlcnR5KGwpID8gKG51bGwgIT0gayAmJiAib25TY3JvbGwiID09PSBsICYmIEQoInNjcm9sbCIsIGEpLCBmIHx8IGggPT09IGsgfHwgKGYgPSBbXSkpIDogKGYgPSBmIHx8IFtdKS5wdXNoKGwsIGspKTt9YyAmJiAoZiA9IGYgfHwgW10pLnB1c2goInN0eWxlIiwgYyk7dmFyIGwgPSBmO2lmIChiLnVwZGF0ZVF1ZXVlID0gbCkgYi5mbGFncyB8PSA0O319O0RqID0gZnVuY3Rpb24gRGooYSwgYiwgYywgZCkge2MgIT09IGQgJiYgKGIuZmxhZ3MgfD0gNCk7fTsKICAgICAgICAgIGZ1bmN0aW9uIEVqKGEsIGIpIHtpZiAoIUkpIHN3aXRjaCAoYS50YWlsTW9kZSkge2Nhc2UgImhpZGRlbiI6YiA9IGEudGFpbDtmb3IgKHZhciBjID0gbnVsbDsgbnVsbCAhPT0gYjspIG51bGwgIT09IGIuYWx0ZXJuYXRlICYmIChjID0gYiksIGIgPSBiLnNpYmxpbmc7bnVsbCA9PT0gYyA/IGEudGFpbCA9IG51bGwgOiBjLnNpYmxpbmcgPSBudWxsO2JyZWFrO2Nhc2UgImNvbGxhcHNlZCI6YyA9IGEudGFpbDtmb3IgKHZhciBkID0gbnVsbDsgbnVsbCAhPT0gYzspIG51bGwgIT09IGMuYWx0ZXJuYXRlICYmIChkID0gYyksIGMgPSBjLnNpYmxpbmc7bnVsbCA9PT0gZCA/IGIgfHwgbnVsbCA9PT0gYS50YWlsID8gYS50YWlsID0gbnVsbCA6IGEudGFpbC5zaWJsaW5nID0gbnVsbCA6IGQuc2libGluZyA9IG51bGw7fX0KICAgICAgICAgIGZ1bmN0aW9uIFMoYSkge3ZhciBiID0gbnVsbCAhPT0gYS5hbHRlcm5hdGUgJiYgYS5hbHRlcm5hdGUuY2hpbGQgPT09IGEuY2hpbGQsYyA9IDAsZCA9IDA7aWYgKGIpIGZvciAodmFyIGUgPSBhLmNoaWxkOyBudWxsICE9PSBlOykgYyB8PSBlLmxhbmVzIHwgZS5jaGlsZExhbmVzLCBkIHw9IGUuc3VidHJlZUZsYWdzICYgMTQ2ODAwNjQsIGQgfD0gZS5mbGFncyAmIDE0NjgwMDY0LCBlLnJldHVybiA9IGEsIGUgPSBlLnNpYmxpbmc7ZWxzZSBmb3IgKGUgPSBhLmNoaWxkOyBudWxsICE9PSBlOykgYyB8PSBlLmxhbmVzIHwgZS5jaGlsZExhbmVzLCBkIHw9IGUuc3VidHJlZUZsYWdzLCBkIHw9IGUuZmxhZ3MsIGUucmV0dXJuID0gYSwgZSA9IGUuc2libGluZzthLnN1YnRyZWVGbGFncyB8PSBkO2EuY2hpbGRMYW5lcyA9IGM7cmV0dXJuIGI7fQogICAgICAgICAgZnVuY3Rpb24gRmooYSwgYiwgYykge3ZhciBkID0gYi5wZW5kaW5nUHJvcHM7d2coYik7c3dpdGNoIChiLnRhZykge2Nhc2UgMjpjYXNlIDE2OmNhc2UgMTU6Y2FzZSAwOmNhc2UgMTE6Y2FzZSA3OmNhc2UgODpjYXNlIDEyOmNhc2UgOTpjYXNlIDE0OnJldHVybiBTKGIpLCBudWxsO2Nhc2UgMTpyZXR1cm4gWmYoYi50eXBlKSAmJiAkZigpLCBTKGIpLCBudWxsO2Nhc2UgMzpkID0gYi5zdGF0ZU5vZGU7SmgoKTtFKFdmKTtFKEgpO09oKCk7ZC5wZW5kaW5nQ29udGV4dCAmJiAoZC5jb250ZXh0ID0gZC5wZW5kaW5nQ29udGV4dCwgZC5wZW5kaW5nQ29udGV4dCA9IG51bGwpO2lmIChudWxsID09PSBhIHx8IG51bGwgPT09IGEuY2hpbGQpIEdnKGIpID8gYi5mbGFncyB8PSA0IDogbnVsbCA9PT0gYSB8fCBhLm1lbW9pemVkU3RhdGUuaXNEZWh5ZHJhdGVkICYmIDAgPT09IChiLmZsYWdzICYgMjU2KSB8fCAoYi5mbGFncyB8PSAxMDI0LCBudWxsICE9PSB6ZyAmJiAoR2ooemcpLCB6ZyA9IG51bGwpKTtCaihhLCBiKTtTKGIpO3JldHVybiBudWxsO2Nhc2UgNTpMaChiKTt2YXIgZSA9IEhoKEdoLmN1cnJlbnQpOwogICAgICAgICAgICAgICAgYyA9IGIudHlwZTtpZiAobnVsbCAhPT0gYSAmJiBudWxsICE9IGIuc3RhdGVOb2RlKSBDaihhLCBiLCBjLCBkLCBlKSwgYS5yZWYgIT09IGIucmVmICYmIChiLmZsYWdzIHw9IDUxMiwgYi5mbGFncyB8PSAyMDk3MTUyKTtlbHNlIHtpZiAoIWQpIHtpZiAobnVsbCA9PT0gYi5zdGF0ZU5vZGUpIHRocm93IEVycm9yKHAoMTY2KSk7UyhiKTtyZXR1cm4gbnVsbDt9YSA9IEhoKEVoLmN1cnJlbnQpO2lmIChHZyhiKSkge2QgPSBiLnN0YXRlTm9kZTtjID0gYi50eXBlO3ZhciBmID0gYi5tZW1vaXplZFByb3BzO2RbT2ZdID0gYjtkW1BmXSA9IGY7YSA9IDAgIT09IChiLm1vZGUgJiAxKTtzd2l0Y2ggKGMpIHtjYXNlICJkaWFsb2ciOkQoImNhbmNlbCIsIGQpO0QoImNsb3NlIiwgZCk7YnJlYWs7Y2FzZSAiaWZyYW1lIjpjYXNlICJvYmplY3QiOmNhc2UgImVtYmVkIjpEKCJsb2FkIiwgZCk7YnJlYWs7Y2FzZSAidmlkZW8iOmNhc2UgImF1ZGlvIjpmb3IgKGUgPSAwOyBlIDwgbGYubGVuZ3RoOyBlKyspIEQobGZbZV0sIGQpO2JyZWFrO2Nhc2UgInNvdXJjZSI6RCgiZXJyb3IiLCBkKTticmVhaztjYXNlICJpbWciOmNhc2UgImltYWdlIjpjYXNlICJsaW5rIjpEKCJlcnJvciIsCiAgICAgICAgICAgICAgICAgICAgICAgIGQpO0QoImxvYWQiLCBkKTticmVhaztjYXNlICJkZXRhaWxzIjpEKCJ0b2dnbGUiLCBkKTticmVhaztjYXNlICJpbnB1dCI6WmEoZCwgZik7RCgiaW52YWxpZCIsIGQpO2JyZWFrO2Nhc2UgInNlbGVjdCI6ZC5fd3JhcHBlclN0YXRlID0geyB3YXNNdWx0aXBsZTogISFmLm11bHRpcGxlIH07RCgiaW52YWxpZCIsIGQpO2JyZWFrO2Nhc2UgInRleHRhcmVhIjpoYihkLCBmKSwgRCgiaW52YWxpZCIsIGQpO311YihjLCBmKTtlID0gbnVsbDtmb3IgKHZhciBnIGluIGYpIGlmIChmLmhhc093blByb3BlcnR5KGcpKSB7dmFyIGggPSBmW2ddOyJjaGlsZHJlbiIgPT09IGcgPyAic3RyaW5nIiA9PT0gdHlwZW9mIGggPyBkLnRleHRDb250ZW50ICE9PSBoICYmICghMCAhPT0gZi5zdXBwcmVzc0h5ZHJhdGlvbldhcm5pbmcgJiYgQWYoZC50ZXh0Q29udGVudCwgaCwgYSksIGUgPSBbImNoaWxkcmVuIiwgaF0pIDogIm51bWJlciIgPT09IHR5cGVvZiBoICYmIGQudGV4dENvbnRlbnQgIT09ICIiICsgaCAmJiAoITAgIT09IGYuc3VwcHJlc3NIeWRyYXRpb25XYXJuaW5nICYmIEFmKGQudGV4dENvbnRlbnQsCiAgICAgICAgICAgICAgICAgICAgICBoLCBhKSwgZSA9IFsiY2hpbGRyZW4iLCAiIiArIGhdKSA6IGVhLmhhc093blByb3BlcnR5KGcpICYmIG51bGwgIT0gaCAmJiAib25TY3JvbGwiID09PSBnICYmIEQoInNjcm9sbCIsIGQpO31zd2l0Y2ggKGMpIHtjYXNlICJpbnB1dCI6VmEoZCk7ZGIoZCwgZiwgITApO2JyZWFrO2Nhc2UgInRleHRhcmVhIjpWYShkKTtqYihkKTticmVhaztjYXNlICJzZWxlY3QiOmNhc2UgIm9wdGlvbiI6YnJlYWs7ZGVmYXVsdDoiZnVuY3Rpb24iID09PSB0eXBlb2YgZi5vbkNsaWNrICYmIChkLm9uY2xpY2sgPSBCZik7fWQgPSBlO2IudXBkYXRlUXVldWUgPSBkO251bGwgIT09IGQgJiYgKGIuZmxhZ3MgfD0gNCk7fSBlbHNlIHtnID0gOSA9PT0gZS5ub2RlVHlwZSA/IGUgOiBlLm93bmVyRG9jdW1lbnQ7Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGh0bWwiID09PSBhICYmIChhID0ga2IoYykpOyJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hodG1sIiA9PT0gYSA/ICJzY3JpcHQiID09PSBjID8gKGEgPSBnLmNyZWF0ZUVsZW1lbnQoImRpdiIpLCBhLmlubmVySFRNTCA9ICI8c2NyaXB0Plx4M2Mvc2NyaXB0PiIsIGEgPSBhLnJlbW92ZUNoaWxkKGEuZmlyc3RDaGlsZCkpIDoKICAgICAgICAgICAgICAgICAgICAic3RyaW5nIiA9PT0gdHlwZW9mIGQuaXMgPyBhID0gZy5jcmVhdGVFbGVtZW50KGMsIHsgaXM6IGQuaXMgfSkgOiAoYSA9IGcuY3JlYXRlRWxlbWVudChjKSwgInNlbGVjdCIgPT09IGMgJiYgKGcgPSBhLCBkLm11bHRpcGxlID8gZy5tdWx0aXBsZSA9ICEwIDogZC5zaXplICYmIChnLnNpemUgPSBkLnNpemUpKSkgOiBhID0gZy5jcmVhdGVFbGVtZW50TlMoYSwgYyk7YVtPZl0gPSBiO2FbUGZdID0gZDtBaihhLCBiLCAhMSwgITEpO2Iuc3RhdGVOb2RlID0gYTthOiB7ZyA9IHZiKGMsIGQpO3N3aXRjaCAoYykge2Nhc2UgImRpYWxvZyI6RCgiY2FuY2VsIiwgYSk7RCgiY2xvc2UiLCBhKTtlID0gZDticmVhaztjYXNlICJpZnJhbWUiOmNhc2UgIm9iamVjdCI6Y2FzZSAiZW1iZWQiOkQoImxvYWQiLCBhKTtlID0gZDticmVhaztjYXNlICJ2aWRlbyI6Y2FzZSAiYXVkaW8iOmZvciAoZSA9IDA7IGUgPCBsZi5sZW5ndGg7IGUrKykgRChsZltlXSwgYSk7ZSA9IGQ7YnJlYWs7Y2FzZSAic291cmNlIjpEKCJlcnJvciIsIGEpO2UgPSBkO2JyZWFrO2Nhc2UgImltZyI6Y2FzZSAiaW1hZ2UiOmNhc2UgImxpbmsiOkQoImVycm9yIiwKICAgICAgICAgICAgICAgICAgICAgICAgICBhKTtEKCJsb2FkIiwgYSk7ZSA9IGQ7YnJlYWs7Y2FzZSAiZGV0YWlscyI6RCgidG9nZ2xlIiwgYSk7ZSA9IGQ7YnJlYWs7Y2FzZSAiaW5wdXQiOlphKGEsIGQpO2UgPSBZYShhLCBkKTtEKCJpbnZhbGlkIiwgYSk7YnJlYWs7Y2FzZSAib3B0aW9uIjplID0gZDticmVhaztjYXNlICJzZWxlY3QiOmEuX3dyYXBwZXJTdGF0ZSA9IHsgd2FzTXVsdGlwbGU6ICEhZC5tdWx0aXBsZSB9O2UgPSBBKHt9LCBkLCB7IHZhbHVlOiB2b2lkIDAgfSk7RCgiaW52YWxpZCIsIGEpO2JyZWFrO2Nhc2UgInRleHRhcmVhIjpoYihhLCBkKTtlID0gZ2IoYSwgZCk7RCgiaW52YWxpZCIsIGEpO2JyZWFrO2RlZmF1bHQ6ZSA9IGQ7fXViKGMsIGUpO2ggPSBlO2ZvciAoZiBpbiBoKSBpZiAoaC5oYXNPd25Qcm9wZXJ0eShmKSkge3ZhciBrID0gaFtmXTsic3R5bGUiID09PSBmID8gc2IoYSwgaykgOiAiZGFuZ2Vyb3VzbHlTZXRJbm5lckhUTUwiID09PSBmID8gKGsgPSBrID8gay5fX2h0bWwgOiB2b2lkIDAsIG51bGwgIT0gayAmJiBuYihhLCBrKSkgOiAiY2hpbGRyZW4iID09PSBmID8gInN0cmluZyIgPT09IHR5cGVvZiBrID8gKCJ0ZXh0YXJlYSIgIT09CiAgICAgICAgICAgICAgICAgICAgICAgIGMgfHwgIiIgIT09IGspICYmIG9iKGEsIGspIDogIm51bWJlciIgPT09IHR5cGVvZiBrICYmIG9iKGEsICIiICsgaykgOiAic3VwcHJlc3NDb250ZW50RWRpdGFibGVXYXJuaW5nIiAhPT0gZiAmJiAic3VwcHJlc3NIeWRyYXRpb25XYXJuaW5nIiAhPT0gZiAmJiAiYXV0b0ZvY3VzIiAhPT0gZiAmJiAoZWEuaGFzT3duUHJvcGVydHkoZikgPyBudWxsICE9IGsgJiYgIm9uU2Nyb2xsIiA9PT0gZiAmJiBEKCJzY3JvbGwiLCBhKSA6IG51bGwgIT0gayAmJiB0YShhLCBmLCBrLCBnKSk7fXN3aXRjaCAoYykge2Nhc2UgImlucHV0IjpWYShhKTtkYihhLCBkLCAhMSk7YnJlYWs7Y2FzZSAidGV4dGFyZWEiOlZhKGEpO2piKGEpO2JyZWFrO2Nhc2UgIm9wdGlvbiI6bnVsbCAhPSBkLnZhbHVlICYmIGEuc2V0QXR0cmlidXRlKCJ2YWx1ZSIsICIiICsgU2EoZC52YWx1ZSkpO2JyZWFrO2Nhc2UgInNlbGVjdCI6YS5tdWx0aXBsZSA9ICEhZC5tdWx0aXBsZTtmID0gZC52YWx1ZTtudWxsICE9IGYgPyBmYihhLCAhIWQubXVsdGlwbGUsIGYsICExKSA6IG51bGwgIT0gZC5kZWZhdWx0VmFsdWUgJiYgZmIoYSwgISFkLm11bHRpcGxlLCBkLmRlZmF1bHRWYWx1ZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAhMCk7YnJlYWs7ZGVmYXVsdDoiZnVuY3Rpb24iID09PSB0eXBlb2YgZS5vbkNsaWNrICYmIChhLm9uY2xpY2sgPSBCZik7fXN3aXRjaCAoYykge2Nhc2UgImJ1dHRvbiI6Y2FzZSAiaW5wdXQiOmNhc2UgInNlbGVjdCI6Y2FzZSAidGV4dGFyZWEiOmQgPSAhIWQuYXV0b0ZvY3VzO2JyZWFrIGE7Y2FzZSAiaW1nIjpkID0gITA7YnJlYWsgYTtkZWZhdWx0OmQgPSAhMTt9fWQgJiYgKGIuZmxhZ3MgfD0gNCk7fW51bGwgIT09IGIucmVmICYmIChiLmZsYWdzIHw9IDUxMiwgYi5mbGFncyB8PSAyMDk3MTUyKTt9UyhiKTtyZXR1cm4gbnVsbDtjYXNlIDY6aWYgKGEgJiYgbnVsbCAhPSBiLnN0YXRlTm9kZSkgRGooYSwgYiwgYS5tZW1vaXplZFByb3BzLCBkKTtlbHNlIHtpZiAoInN0cmluZyIgIT09IHR5cGVvZiBkICYmIG51bGwgPT09IGIuc3RhdGVOb2RlKSB0aHJvdyBFcnJvcihwKDE2NikpO2MgPSBIaChHaC5jdXJyZW50KTtIaChFaC5jdXJyZW50KTtpZiAoR2coYikpIHtkID0gYi5zdGF0ZU5vZGU7YyA9IGIubWVtb2l6ZWRQcm9wcztkW09mXSA9IGI7aWYgKGYgPSBkLm5vZGVWYWx1ZSAhPT0gYykgaWYgKGEgPQogICAgICAgICAgICAgICAgICAgIHhnLCBudWxsICE9PSBhKSBzd2l0Y2ggKGEudGFnKSB7Y2FzZSAzOkFmKGQubm9kZVZhbHVlLCBjLCAwICE9PSAoYS5tb2RlICYgMSkpO2JyZWFrO2Nhc2UgNTohMCAhPT0gYS5tZW1vaXplZFByb3BzLnN1cHByZXNzSHlkcmF0aW9uV2FybmluZyAmJiBBZihkLm5vZGVWYWx1ZSwgYywgMCAhPT0gKGEubW9kZSAmIDEpKTt9ZiAmJiAoYi5mbGFncyB8PSA0KTt9IGVsc2UgZCA9ICg5ID09PSBjLm5vZGVUeXBlID8gYyA6IGMub3duZXJEb2N1bWVudCkuY3JlYXRlVGV4dE5vZGUoZCksIGRbT2ZdID0gYiwgYi5zdGF0ZU5vZGUgPSBkO31TKGIpO3JldHVybiBudWxsO2Nhc2UgMTM6RShNKTtkID0gYi5tZW1vaXplZFN0YXRlO2lmIChudWxsID09PSBhIHx8IG51bGwgIT09IGEubWVtb2l6ZWRTdGF0ZSAmJiBudWxsICE9PSBhLm1lbW9pemVkU3RhdGUuZGVoeWRyYXRlZCkge2lmIChJICYmIG51bGwgIT09IHlnICYmIDAgIT09IChiLm1vZGUgJiAxKSAmJiAwID09PSAoYi5mbGFncyAmIDEyOCkpIEhnKCksIElnKCksIGIuZmxhZ3MgfD0gOTg1NjAsIGYgPSAhMTtlbHNlIGlmIChmID0gR2coYiksIG51bGwgIT09IGQgJiYgbnVsbCAhPT0gZC5kZWh5ZHJhdGVkKSB7aWYgKG51bGwgPT09CiAgICAgICAgICAgICAgICAgICAgYSkge2lmICghZikgdGhyb3cgRXJyb3IocCgzMTgpKTtmID0gYi5tZW1vaXplZFN0YXRlO2YgPSBudWxsICE9PSBmID8gZi5kZWh5ZHJhdGVkIDogbnVsbDtpZiAoIWYpIHRocm93IEVycm9yKHAoMzE3KSk7ZltPZl0gPSBiO30gZWxzZSBJZygpLCAwID09PSAoYi5mbGFncyAmIDEyOCkgJiYgKGIubWVtb2l6ZWRTdGF0ZSA9IG51bGwpLCBiLmZsYWdzIHw9IDQ7UyhiKTtmID0gITE7fSBlbHNlIG51bGwgIT09IHpnICYmIChHaih6ZyksIHpnID0gbnVsbCksIGYgPSAhMDtpZiAoIWYpIHJldHVybiBiLmZsYWdzICYgNjU1MzYgPyBiIDogbnVsbDt9aWYgKDAgIT09IChiLmZsYWdzICYgMTI4KSkgcmV0dXJuIGIubGFuZXMgPSBjLCBiO2QgPSBudWxsICE9PSBkO2QgIT09IChudWxsICE9PSBhICYmIG51bGwgIT09IGEubWVtb2l6ZWRTdGF0ZSkgJiYgZCAmJiAoYi5jaGlsZC5mbGFncyB8PSA4MTkyLCAwICE9PSAoYi5tb2RlICYgMSkgJiYgKG51bGwgPT09IGEgfHwgMCAhPT0gKE0uY3VycmVudCAmIDEpID8gMCA9PT0gVCAmJiAoVCA9IDMpIDogdWooKSkpO251bGwgIT09IGIudXBkYXRlUXVldWUgJiYgKGIuZmxhZ3MgfD0gNCk7UyhiKTtyZXR1cm4gbnVsbDtjYXNlIDQ6cmV0dXJuIEpoKCksCiAgICAgICAgICAgICAgICBCaihhLCBiKSwgbnVsbCA9PT0gYSAmJiBzZihiLnN0YXRlTm9kZS5jb250YWluZXJJbmZvKSwgUyhiKSwgbnVsbDtjYXNlIDEwOnJldHVybiBSZyhiLnR5cGUuX2NvbnRleHQpLCBTKGIpLCBudWxsO2Nhc2UgMTc6cmV0dXJuIFpmKGIudHlwZSkgJiYgJGYoKSwgUyhiKSwgbnVsbDtjYXNlIDE5OkUoTSk7ZiA9IGIubWVtb2l6ZWRTdGF0ZTtpZiAobnVsbCA9PT0gZikgcmV0dXJuIFMoYiksIG51bGw7ZCA9IDAgIT09IChiLmZsYWdzICYgMTI4KTtnID0gZi5yZW5kZXJpbmc7aWYgKG51bGwgPT09IGcpIHtpZiAoZCkgRWooZiwgITEpO2Vsc2Uge2lmICgwICE9PSBUIHx8IG51bGwgIT09IGEgJiYgMCAhPT0gKGEuZmxhZ3MgJiAxMjgpKSBmb3IgKGEgPSBiLmNoaWxkOyBudWxsICE9PSBhOykge2cgPSBNaChhKTtpZiAobnVsbCAhPT0gZykge2IuZmxhZ3MgfD0gMTI4O0VqKGYsICExKTtkID0gZy51cGRhdGVRdWV1ZTtudWxsICE9PSBkICYmIChiLnVwZGF0ZVF1ZXVlID0gZCwgYi5mbGFncyB8PSA0KTtiLnN1YnRyZWVGbGFncyA9IDA7ZCA9IGM7Zm9yIChjID0gYi5jaGlsZDsgbnVsbCAhPT0gYzspIGYgPSBjLCBhID0gZCwgZi5mbGFncyAmPSAxNDY4MDA2NiwKICAgICAgICAgICAgICAgICAgICAgICAgZyA9IGYuYWx0ZXJuYXRlLCBudWxsID09PSBnID8gKGYuY2hpbGRMYW5lcyA9IDAsIGYubGFuZXMgPSBhLCBmLmNoaWxkID0gbnVsbCwgZi5zdWJ0cmVlRmxhZ3MgPSAwLCBmLm1lbW9pemVkUHJvcHMgPSBudWxsLCBmLm1lbW9pemVkU3RhdGUgPSBudWxsLCBmLnVwZGF0ZVF1ZXVlID0gbnVsbCwgZi5kZXBlbmRlbmNpZXMgPSBudWxsLCBmLnN0YXRlTm9kZSA9IG51bGwpIDogKGYuY2hpbGRMYW5lcyA9IGcuY2hpbGRMYW5lcywgZi5sYW5lcyA9IGcubGFuZXMsIGYuY2hpbGQgPSBnLmNoaWxkLCBmLnN1YnRyZWVGbGFncyA9IDAsIGYuZGVsZXRpb25zID0gbnVsbCwgZi5tZW1vaXplZFByb3BzID0gZy5tZW1vaXplZFByb3BzLCBmLm1lbW9pemVkU3RhdGUgPSBnLm1lbW9pemVkU3RhdGUsIGYudXBkYXRlUXVldWUgPSBnLnVwZGF0ZVF1ZXVlLCBmLnR5cGUgPSBnLnR5cGUsIGEgPSBnLmRlcGVuZGVuY2llcywgZi5kZXBlbmRlbmNpZXMgPSBudWxsID09PSBhID8gbnVsbCA6IHsgbGFuZXM6IGEubGFuZXMsIGZpcnN0Q29udGV4dDogYS5maXJzdENvbnRleHQgfSksIGMgPSBjLnNpYmxpbmc7RyhNLCBNLmN1cnJlbnQgJiAxIHwgMik7cmV0dXJuIGIuY2hpbGQ7fWEgPQogICAgICAgICAgICAgICAgICAgICAgYS5zaWJsaW5nO31udWxsICE9PSBmLnRhaWwgJiYgQigpID4gSGogJiYgKGIuZmxhZ3MgfD0gMTI4LCBkID0gITAsIEVqKGYsICExKSwgYi5sYW5lcyA9IDQxOTQzMDQpO319IGVsc2Uge2lmICghZCkgaWYgKGEgPSBNaChnKSwgbnVsbCAhPT0gYSkge2lmIChiLmZsYWdzIHw9IDEyOCwgZCA9ICEwLCBjID0gYS51cGRhdGVRdWV1ZSwgbnVsbCAhPT0gYyAmJiAoYi51cGRhdGVRdWV1ZSA9IGMsIGIuZmxhZ3MgfD0gNCksIEVqKGYsICEwKSwgbnVsbCA9PT0gZi50YWlsICYmICJoaWRkZW4iID09PSBmLnRhaWxNb2RlICYmICFnLmFsdGVybmF0ZSAmJiAhSSkgcmV0dXJuIFMoYiksIG51bGw7fSBlbHNlIDIgKiBCKCkgLSBmLnJlbmRlcmluZ1N0YXJ0VGltZSA+IEhqICYmIDEwNzM3NDE4MjQgIT09IGMgJiYgKGIuZmxhZ3MgfD0gMTI4LCBkID0gITAsIEVqKGYsICExKSwgYi5sYW5lcyA9IDQxOTQzMDQpO2YuaXNCYWNrd2FyZHMgPyAoZy5zaWJsaW5nID0gYi5jaGlsZCwgYi5jaGlsZCA9IGcpIDogKGMgPSBmLmxhc3QsIG51bGwgIT09IGMgPyBjLnNpYmxpbmcgPSBnIDogYi5jaGlsZCA9IGcsIGYubGFzdCA9IGcpO31pZiAobnVsbCAhPT0gZi50YWlsKSByZXR1cm4gYiA9IGYudGFpbCwgZi5yZW5kZXJpbmcgPQogICAgICAgICAgICAgICAgYiwgZi50YWlsID0gYi5zaWJsaW5nLCBmLnJlbmRlcmluZ1N0YXJ0VGltZSA9IEIoKSwgYi5zaWJsaW5nID0gbnVsbCwgYyA9IE0uY3VycmVudCwgRyhNLCBkID8gYyAmIDEgfCAyIDogYyAmIDEpLCBiO1MoYik7cmV0dXJuIG51bGw7Y2FzZSAyMjpjYXNlIDIzOnJldHVybiBJaigpLCBkID0gbnVsbCAhPT0gYi5tZW1vaXplZFN0YXRlLCBudWxsICE9PSBhICYmIG51bGwgIT09IGEubWVtb2l6ZWRTdGF0ZSAhPT0gZCAmJiAoYi5mbGFncyB8PSA4MTkyKSwgZCAmJiAwICE9PSAoYi5tb2RlICYgMSkgPyAwICE9PSAoZ2ogJiAxMDczNzQxODI0KSAmJiAoUyhiKSwgYi5zdWJ0cmVlRmxhZ3MgJiA2ICYmIChiLmZsYWdzIHw9IDgxOTIpKSA6IFMoYiksIG51bGw7Y2FzZSAyNDpyZXR1cm4gbnVsbDtjYXNlIDI1OnJldHVybiBudWxsO310aHJvdyBFcnJvcihwKDE1NiwgYi50YWcpKTt9CiAgICAgICAgICBmdW5jdGlvbiBKaihhLCBiKSB7d2coYik7c3dpdGNoIChiLnRhZykge2Nhc2UgMTpyZXR1cm4gWmYoYi50eXBlKSAmJiAkZigpLCBhID0gYi5mbGFncywgYSAmIDY1NTM2ID8gKGIuZmxhZ3MgPSBhICYgLTY1NTM3IHwgMTI4LCBiKSA6IG51bGw7Y2FzZSAzOnJldHVybiBKaCgpLCBFKFdmKSwgRShIKSwgT2goKSwgYSA9IGIuZmxhZ3MsIDAgIT09IChhICYgNjU1MzYpICYmIDAgPT09IChhICYgMTI4KSA/IChiLmZsYWdzID0gYSAmIC02NTUzNyB8IDEyOCwgYikgOiBudWxsO2Nhc2UgNTpyZXR1cm4gTGgoYiksIG51bGw7Y2FzZSAxMzpFKE0pO2EgPSBiLm1lbW9pemVkU3RhdGU7aWYgKG51bGwgIT09IGEgJiYgbnVsbCAhPT0gYS5kZWh5ZHJhdGVkKSB7aWYgKG51bGwgPT09IGIuYWx0ZXJuYXRlKSB0aHJvdyBFcnJvcihwKDM0MCkpO0lnKCk7fWEgPSBiLmZsYWdzO3JldHVybiBhICYgNjU1MzYgPyAoYi5mbGFncyA9IGEgJiAtNjU1MzcgfCAxMjgsIGIpIDogbnVsbDtjYXNlIDE5OnJldHVybiBFKE0pLCBudWxsO2Nhc2UgNDpyZXR1cm4gSmgoKSwgbnVsbDtjYXNlIDEwOnJldHVybiBSZyhiLnR5cGUuX2NvbnRleHQpLCBudWxsO2Nhc2UgMjI6Y2FzZSAyMzpyZXR1cm4gSWooKSwKICAgICAgICAgICAgICAgIG51bGw7Y2FzZSAyNDpyZXR1cm4gbnVsbDtkZWZhdWx0OnJldHVybiBudWxsO319dmFyIEtqID0gITEsVSA9ICExLExqID0gImZ1bmN0aW9uIiA9PT0gdHlwZW9mIFdlYWtTZXQgPyBXZWFrU2V0IDogU2V0LFYgPSBudWxsO2Z1bmN0aW9uIE1qKGEsIGIpIHt2YXIgYyA9IGEucmVmO2lmIChudWxsICE9PSBjKSBpZiAoImZ1bmN0aW9uIiA9PT0gdHlwZW9mIGMpIHRyeSB7YyhudWxsKTt9IGNhdGNoIChkKSB7VyhhLCBiLCBkKTt9IGVsc2UgYy5jdXJyZW50ID0gbnVsbDt9ZnVuY3Rpb24gTmooYSwgYiwgYykge3RyeSB7YygpO30gY2F0Y2ggKGQpIHtXKGEsIGIsIGQpO319dmFyIE9qID0gITE7CiAgICAgICAgICBmdW5jdGlvbiBQaihhLCBiKSB7Q2YgPSBkZDthID0gTWUoKTtpZiAoTmUoYSkpIHtpZiAoInNlbGVjdGlvblN0YXJ0IiBpbiBhKSB2YXIgYyA9IHsgc3RhcnQ6IGEuc2VsZWN0aW9uU3RhcnQsIGVuZDogYS5zZWxlY3Rpb25FbmQgfTtlbHNlIGE6IHtjID0gKGMgPSBhLm93bmVyRG9jdW1lbnQpICYmIGMuZGVmYXVsdFZpZXcgfHwgd2luZG93O3ZhciBkID0gYy5nZXRTZWxlY3Rpb24gJiYgYy5nZXRTZWxlY3Rpb24oKTtpZiAoZCAmJiAwICE9PSBkLnJhbmdlQ291bnQpIHtjID0gZC5hbmNob3JOb2RlO3ZhciBlID0gZC5hbmNob3JPZmZzZXQsZiA9IGQuZm9jdXNOb2RlO2QgPSBkLmZvY3VzT2Zmc2V0O3RyeSB7Yy5ub2RlVHlwZSwgZi5ub2RlVHlwZTt9IGNhdGNoIChGKSB7YyA9IG51bGw7YnJlYWsgYTt9dmFyIGcgPSAwLGggPSAtMSxrID0gLTEsbCA9IDAsbSA9IDAscSA9IGEsciA9IG51bGw7YjogZm9yICg7Oykge2ZvciAodmFyIHk7Oykge3EgIT09IGMgfHwgMCAhPT0gZSAmJiAzICE9PSBxLm5vZGVUeXBlIHx8IChoID0gZyArIGUpO3EgIT09IGYgfHwgMCAhPT0gZCAmJiAzICE9PSBxLm5vZGVUeXBlIHx8IChrID0gZyArIGQpOzMgPT09IHEubm9kZVR5cGUgJiYgKGcgKz0KICAgICAgICAgICAgICAgICAgICAgIHEubm9kZVZhbHVlLmxlbmd0aCk7aWYgKG51bGwgPT09ICh5ID0gcS5maXJzdENoaWxkKSkgYnJlYWs7ciA9IHE7cSA9IHk7fWZvciAoOzspIHtpZiAocSA9PT0gYSkgYnJlYWsgYjtyID09PSBjICYmICsrbCA9PT0gZSAmJiAoaCA9IGcpO3IgPT09IGYgJiYgKyttID09PSBkICYmIChrID0gZyk7aWYgKG51bGwgIT09ICh5ID0gcS5uZXh0U2libGluZykpIGJyZWFrO3EgPSByO3IgPSBxLnBhcmVudE5vZGU7fXEgPSB5O31jID0gLTEgPT09IGggfHwgLTEgPT09IGsgPyBudWxsIDogeyBzdGFydDogaCwgZW5kOiBrIH07fSBlbHNlIGMgPSBudWxsO31jID0gYyB8fCB7IHN0YXJ0OiAwLCBlbmQ6IDAgfTt9IGVsc2UgYyA9IG51bGw7RGYgPSB7IGZvY3VzZWRFbGVtOiBhLCBzZWxlY3Rpb25SYW5nZTogYyB9O2RkID0gITE7Zm9yIChWID0gYjsgbnVsbCAhPT0gVjspIGlmIChiID0gViwgYSA9IGIuY2hpbGQsIDAgIT09IChiLnN1YnRyZWVGbGFncyAmIDEwMjgpICYmIG51bGwgIT09IGEpIGEucmV0dXJuID0gYiwgViA9IGE7ZWxzZSBmb3IgKDsgbnVsbCAhPT0gVjspIHtiID0gVjt0cnkge3ZhciBuID0gYi5hbHRlcm5hdGU7aWYgKDAgIT09IChiLmZsYWdzICYgMTAyNCkpIHN3aXRjaCAoYi50YWcpIHtjYXNlIDA6Y2FzZSAxMTpjYXNlIDE1OmJyZWFrOwogICAgICAgICAgICAgICAgICBjYXNlIDE6aWYgKG51bGwgIT09IG4pIHt2YXIgdCA9IG4ubWVtb2l6ZWRQcm9wcyxKID0gbi5tZW1vaXplZFN0YXRlLHggPSBiLnN0YXRlTm9kZSx3ID0geC5nZXRTbmFwc2hvdEJlZm9yZVVwZGF0ZShiLmVsZW1lbnRUeXBlID09PSBiLnR5cGUgPyB0IDogTGcoYi50eXBlLCB0KSwgSik7eC5fX3JlYWN0SW50ZXJuYWxTbmFwc2hvdEJlZm9yZVVwZGF0ZSA9IHc7fWJyZWFrO2Nhc2UgMzp2YXIgdSA9IGIuc3RhdGVOb2RlLmNvbnRhaW5lckluZm87MSA9PT0gdS5ub2RlVHlwZSA/IHUudGV4dENvbnRlbnQgPSAiIiA6IDkgPT09IHUubm9kZVR5cGUgJiYgdS5kb2N1bWVudEVsZW1lbnQgJiYgdS5yZW1vdmVDaGlsZCh1LmRvY3VtZW50RWxlbWVudCk7YnJlYWs7Y2FzZSA1OmNhc2UgNjpjYXNlIDQ6Y2FzZSAxNzpicmVhaztkZWZhdWx0OnRocm93IEVycm9yKHAoMTYzKSk7fX0gY2F0Y2ggKEYpIHtXKGIsIGIucmV0dXJuLCBGKTt9YSA9IGIuc2libGluZztpZiAobnVsbCAhPT0gYSkge2EucmV0dXJuID0gYi5yZXR1cm47ViA9IGE7YnJlYWs7fVYgPSBiLnJldHVybjt9biA9IE9qO09qID0gITE7cmV0dXJuIG47fQogICAgICAgICAgZnVuY3Rpb24gUWooYSwgYiwgYykge3ZhciBkID0gYi51cGRhdGVRdWV1ZTtkID0gbnVsbCAhPT0gZCA/IGQubGFzdEVmZmVjdCA6IG51bGw7aWYgKG51bGwgIT09IGQpIHt2YXIgZSA9IGQgPSBkLm5leHQ7ZG8ge2lmICgoZS50YWcgJiBhKSA9PT0gYSkge3ZhciBmID0gZS5kZXN0cm95O2UuZGVzdHJveSA9IHZvaWQgMDt2b2lkIDAgIT09IGYgJiYgTmooYiwgYywgZik7fWUgPSBlLm5leHQ7fSB3aGlsZSAoZSAhPT0gZCk7fX1mdW5jdGlvbiBSaihhLCBiKSB7YiA9IGIudXBkYXRlUXVldWU7YiA9IG51bGwgIT09IGIgPyBiLmxhc3RFZmZlY3QgOiBudWxsO2lmIChudWxsICE9PSBiKSB7dmFyIGMgPSBiID0gYi5uZXh0O2RvIHtpZiAoKGMudGFnICYgYSkgPT09IGEpIHt2YXIgZCA9IGMuY3JlYXRlO2MuZGVzdHJveSA9IGQoKTt9YyA9IGMubmV4dDt9IHdoaWxlIChjICE9PSBiKTt9fWZ1bmN0aW9uIFNqKGEpIHt2YXIgYiA9IGEucmVmO2lmIChudWxsICE9PSBiKSB7dmFyIGMgPSBhLnN0YXRlTm9kZTtzd2l0Y2ggKGEudGFnKSB7Y2FzZSA1OmEgPSBjO2JyZWFrO2RlZmF1bHQ6YSA9IGM7fSJmdW5jdGlvbiIgPT09IHR5cGVvZiBiID8gYihhKSA6IGIuY3VycmVudCA9IGE7fX0KICAgICAgICAgIGZ1bmN0aW9uIFRqKGEpIHt2YXIgYiA9IGEuYWx0ZXJuYXRlO251bGwgIT09IGIgJiYgKGEuYWx0ZXJuYXRlID0gbnVsbCwgVGooYikpO2EuY2hpbGQgPSBudWxsO2EuZGVsZXRpb25zID0gbnVsbDthLnNpYmxpbmcgPSBudWxsOzUgPT09IGEudGFnICYmIChiID0gYS5zdGF0ZU5vZGUsIG51bGwgIT09IGIgJiYgKGRlbGV0ZSBiW09mXSwgZGVsZXRlIGJbUGZdLCBkZWxldGUgYltvZl0sIGRlbGV0ZSBiW1FmXSwgZGVsZXRlIGJbUmZdKSk7YS5zdGF0ZU5vZGUgPSBudWxsO2EucmV0dXJuID0gbnVsbDthLmRlcGVuZGVuY2llcyA9IG51bGw7YS5tZW1vaXplZFByb3BzID0gbnVsbDthLm1lbW9pemVkU3RhdGUgPSBudWxsO2EucGVuZGluZ1Byb3BzID0gbnVsbDthLnN0YXRlTm9kZSA9IG51bGw7YS51cGRhdGVRdWV1ZSA9IG51bGw7fWZ1bmN0aW9uIFVqKGEpIHtyZXR1cm4gNSA9PT0gYS50YWcgfHwgMyA9PT0gYS50YWcgfHwgNCA9PT0gYS50YWc7fQogICAgICAgICAgZnVuY3Rpb24gVmooYSkge2E6IGZvciAoOzspIHtmb3IgKDsgbnVsbCA9PT0gYS5zaWJsaW5nOykge2lmIChudWxsID09PSBhLnJldHVybiB8fCBVaihhLnJldHVybikpIHJldHVybiBudWxsO2EgPSBhLnJldHVybjt9YS5zaWJsaW5nLnJldHVybiA9IGEucmV0dXJuO2ZvciAoYSA9IGEuc2libGluZzsgNSAhPT0gYS50YWcgJiYgNiAhPT0gYS50YWcgJiYgMTggIT09IGEudGFnOykge2lmIChhLmZsYWdzICYgMikgY29udGludWUgYTtpZiAobnVsbCA9PT0gYS5jaGlsZCB8fCA0ID09PSBhLnRhZykgY29udGludWUgYTtlbHNlIGEuY2hpbGQucmV0dXJuID0gYSwgYSA9IGEuY2hpbGQ7fWlmICghKGEuZmxhZ3MgJiAyKSkgcmV0dXJuIGEuc3RhdGVOb2RlO319CiAgICAgICAgICBmdW5jdGlvbiBXaihhLCBiLCBjKSB7dmFyIGQgPSBhLnRhZztpZiAoNSA9PT0gZCB8fCA2ID09PSBkKSBhID0gYS5zdGF0ZU5vZGUsIGIgPyA4ID09PSBjLm5vZGVUeXBlID8gYy5wYXJlbnROb2RlLmluc2VydEJlZm9yZShhLCBiKSA6IGMuaW5zZXJ0QmVmb3JlKGEsIGIpIDogKDggPT09IGMubm9kZVR5cGUgPyAoYiA9IGMucGFyZW50Tm9kZSwgYi5pbnNlcnRCZWZvcmUoYSwgYykpIDogKGIgPSBjLCBiLmFwcGVuZENoaWxkKGEpKSwgYyA9IGMuX3JlYWN0Um9vdENvbnRhaW5lciwgbnVsbCAhPT0gYyAmJiB2b2lkIDAgIT09IGMgfHwgbnVsbCAhPT0gYi5vbmNsaWNrIHx8IChiLm9uY2xpY2sgPSBCZikpO2Vsc2UgaWYgKDQgIT09IGQgJiYgKGEgPSBhLmNoaWxkLCBudWxsICE9PSBhKSkgZm9yIChXaihhLCBiLCBjKSwgYSA9IGEuc2libGluZzsgbnVsbCAhPT0gYTspIFdqKGEsIGIsIGMpLCBhID0gYS5zaWJsaW5nO30KICAgICAgICAgIGZ1bmN0aW9uIFhqKGEsIGIsIGMpIHt2YXIgZCA9IGEudGFnO2lmICg1ID09PSBkIHx8IDYgPT09IGQpIGEgPSBhLnN0YXRlTm9kZSwgYiA/IGMuaW5zZXJ0QmVmb3JlKGEsIGIpIDogYy5hcHBlbmRDaGlsZChhKTtlbHNlIGlmICg0ICE9PSBkICYmIChhID0gYS5jaGlsZCwgbnVsbCAhPT0gYSkpIGZvciAoWGooYSwgYiwgYyksIGEgPSBhLnNpYmxpbmc7IG51bGwgIT09IGE7KSBYaihhLCBiLCBjKSwgYSA9IGEuc2libGluZzt9dmFyIFggPSBudWxsLFlqID0gITE7ZnVuY3Rpb24gWmooYSwgYiwgYykge2ZvciAoYyA9IGMuY2hpbGQ7IG51bGwgIT09IGM7KSBhayhhLCBiLCBjKSwgYyA9IGMuc2libGluZzt9CiAgICAgICAgICBmdW5jdGlvbiBhayhhLCBiLCBjKSB7aWYgKGxjICYmICJmdW5jdGlvbiIgPT09IHR5cGVvZiBsYy5vbkNvbW1pdEZpYmVyVW5tb3VudCkgdHJ5IHtsYy5vbkNvbW1pdEZpYmVyVW5tb3VudChrYywgYyk7fSBjYXRjaCAoaCkge31zd2l0Y2ggKGMudGFnKSB7Y2FzZSA1OlUgfHwgTWooYywgYik7Y2FzZSA2OnZhciBkID0gWCxlID0gWWo7WCA9IG51bGw7WmooYSwgYiwgYyk7WCA9IGQ7WWogPSBlO251bGwgIT09IFggJiYgKFlqID8gKGEgPSBYLCBjID0gYy5zdGF0ZU5vZGUsIDggPT09IGEubm9kZVR5cGUgPyBhLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQoYykgOiBhLnJlbW92ZUNoaWxkKGMpKSA6IFgucmVtb3ZlQ2hpbGQoYy5zdGF0ZU5vZGUpKTticmVhaztjYXNlIDE4Om51bGwgIT09IFggJiYgKFlqID8gKGEgPSBYLCBjID0gYy5zdGF0ZU5vZGUsIDggPT09IGEubm9kZVR5cGUgPyBLZihhLnBhcmVudE5vZGUsIGMpIDogMSA9PT0gYS5ub2RlVHlwZSAmJiBLZihhLCBjKSwgYmQoYSkpIDogS2YoWCwgYy5zdGF0ZU5vZGUpKTticmVhaztjYXNlIDQ6ZCA9IFg7ZSA9IFlqO1ggPSBjLnN0YXRlTm9kZS5jb250YWluZXJJbmZvO1lqID0gITA7CiAgICAgICAgICAgICAgICBaaihhLCBiLCBjKTtYID0gZDtZaiA9IGU7YnJlYWs7Y2FzZSAwOmNhc2UgMTE6Y2FzZSAxNDpjYXNlIDE1OmlmICghVSAmJiAoZCA9IGMudXBkYXRlUXVldWUsIG51bGwgIT09IGQgJiYgKGQgPSBkLmxhc3RFZmZlY3QsIG51bGwgIT09IGQpKSkge2UgPSBkID0gZC5uZXh0O2RvIHt2YXIgZiA9IGUsZyA9IGYuZGVzdHJveTtmID0gZi50YWc7dm9pZCAwICE9PSBnICYmICgwICE9PSAoZiAmIDIpID8gTmooYywgYiwgZykgOiAwICE9PSAoZiAmIDQpICYmIE5qKGMsIGIsIGcpKTtlID0gZS5uZXh0O30gd2hpbGUgKGUgIT09IGQpO31aaihhLCBiLCBjKTticmVhaztjYXNlIDE6aWYgKCFVICYmIChNaihjLCBiKSwgZCA9IGMuc3RhdGVOb2RlLCAiZnVuY3Rpb24iID09PSB0eXBlb2YgZC5jb21wb25lbnRXaWxsVW5tb3VudCkpIHRyeSB7ZC5wcm9wcyA9IGMubWVtb2l6ZWRQcm9wcywgZC5zdGF0ZSA9IGMubWVtb2l6ZWRTdGF0ZSwgZC5jb21wb25lbnRXaWxsVW5tb3VudCgpO30gY2F0Y2ggKGgpIHtXKGMsIGIsIGgpO31aaihhLCBiLCBjKTticmVhaztjYXNlIDIxOlpqKGEsIGIsIGMpO2JyZWFrO2Nhc2UgMjI6Yy5tb2RlICYgMSA/IChVID0gKGQgPSBVKSB8fCBudWxsICE9PQogICAgICAgICAgICAgICAgYy5tZW1vaXplZFN0YXRlLCBaaihhLCBiLCBjKSwgVSA9IGQpIDogWmooYSwgYiwgYyk7YnJlYWs7ZGVmYXVsdDpaaihhLCBiLCBjKTt9fWZ1bmN0aW9uIGJrKGEpIHt2YXIgYiA9IGEudXBkYXRlUXVldWU7aWYgKG51bGwgIT09IGIpIHthLnVwZGF0ZVF1ZXVlID0gbnVsbDt2YXIgYyA9IGEuc3RhdGVOb2RlO251bGwgPT09IGMgJiYgKGMgPSBhLnN0YXRlTm9kZSA9IG5ldyBMaigpKTtiLmZvckVhY2goZnVuY3Rpb24gKGIpIHt2YXIgZCA9IGNrLmJpbmQobnVsbCwgYSwgYik7Yy5oYXMoYikgfHwgKGMuYWRkKGIpLCBiLnRoZW4oZCwgZCkpO30pO319CiAgICAgICAgICBmdW5jdGlvbiBkayhhLCBiKSB7dmFyIGMgPSBiLmRlbGV0aW9ucztpZiAobnVsbCAhPT0gYykgZm9yICh2YXIgZCA9IDA7IGQgPCBjLmxlbmd0aDsgZCsrKSB7dmFyIGUgPSBjW2RdO3RyeSB7dmFyIGYgPSBhLGcgPSBiLGggPSBnO2E6IGZvciAoOyBudWxsICE9PSBoOykge3N3aXRjaCAoaC50YWcpIHtjYXNlIDU6WCA9IGguc3RhdGVOb2RlO1lqID0gITE7YnJlYWsgYTtjYXNlIDM6WCA9IGguc3RhdGVOb2RlLmNvbnRhaW5lckluZm87WWogPSAhMDticmVhayBhO2Nhc2UgNDpYID0gaC5zdGF0ZU5vZGUuY29udGFpbmVySW5mbztZaiA9ICEwO2JyZWFrIGE7fWggPSBoLnJldHVybjt9aWYgKG51bGwgPT09IFgpIHRocm93IEVycm9yKHAoMTYwKSk7YWsoZiwgZywgZSk7WCA9IG51bGw7WWogPSAhMTt2YXIgayA9IGUuYWx0ZXJuYXRlO251bGwgIT09IGsgJiYgKGsucmV0dXJuID0gbnVsbCk7ZS5yZXR1cm4gPSBudWxsO30gY2F0Y2ggKGwpIHtXKGUsIGIsIGwpO319aWYgKGIuc3VidHJlZUZsYWdzICYgMTI4NTQpIGZvciAoYiA9IGIuY2hpbGQ7IG51bGwgIT09IGI7KSBlayhiLCBhKSwgYiA9IGIuc2libGluZzt9CiAgICAgICAgICBmdW5jdGlvbiBlayhhLCBiKSB7dmFyIGMgPSBhLmFsdGVybmF0ZSxkID0gYS5mbGFncztzd2l0Y2ggKGEudGFnKSB7Y2FzZSAwOmNhc2UgMTE6Y2FzZSAxNDpjYXNlIDE1OmRrKGIsIGEpO2ZrKGEpO2lmIChkICYgNCkge3RyeSB7UWooMywgYSwgYS5yZXR1cm4pLCBSaigzLCBhKTt9IGNhdGNoICh0KSB7VyhhLCBhLnJldHVybiwgdCk7fXRyeSB7UWooNSwgYSwgYS5yZXR1cm4pO30gY2F0Y2ggKHQpIHtXKGEsIGEucmV0dXJuLCB0KTt9fWJyZWFrO2Nhc2UgMTpkayhiLCBhKTtmayhhKTtkICYgNTEyICYmIG51bGwgIT09IGMgJiYgTWooYywgYy5yZXR1cm4pO2JyZWFrO2Nhc2UgNTpkayhiLCBhKTtmayhhKTtkICYgNTEyICYmIG51bGwgIT09IGMgJiYgTWooYywgYy5yZXR1cm4pO2lmIChhLmZsYWdzICYgMzIpIHt2YXIgZSA9IGEuc3RhdGVOb2RlO3RyeSB7b2IoZSwgIiIpO30gY2F0Y2ggKHQpIHtXKGEsIGEucmV0dXJuLCB0KTt9fWlmIChkICYgNCAmJiAoZSA9IGEuc3RhdGVOb2RlLCBudWxsICE9IGUpKSB7dmFyIGYgPSBhLm1lbW9pemVkUHJvcHMsZyA9IG51bGwgIT09IGMgPyBjLm1lbW9pemVkUHJvcHMgOiBmLGggPSBhLnR5cGUsayA9IGEudXBkYXRlUXVldWU7CiAgICAgICAgICAgICAgICAgIGEudXBkYXRlUXVldWUgPSBudWxsO2lmIChudWxsICE9PSBrKSB0cnkgeyJpbnB1dCIgPT09IGggJiYgInJhZGlvIiA9PT0gZi50eXBlICYmIG51bGwgIT0gZi5uYW1lICYmIGFiKGUsIGYpO3ZiKGgsIGcpO3ZhciBsID0gdmIoaCwgZik7Zm9yIChnID0gMDsgZyA8IGsubGVuZ3RoOyBnICs9IDIpIHt2YXIgbSA9IGtbZ10scSA9IGtbZyArIDFdOyJzdHlsZSIgPT09IG0gPyBzYihlLCBxKSA6ICJkYW5nZXJvdXNseVNldElubmVySFRNTCIgPT09IG0gPyBuYihlLCBxKSA6ICJjaGlsZHJlbiIgPT09IG0gPyBvYihlLCBxKSA6IHRhKGUsIG0sIHEsIGwpO31zd2l0Y2ggKGgpIHtjYXNlICJpbnB1dCI6YmIoZSwgZik7YnJlYWs7Y2FzZSAidGV4dGFyZWEiOmliKGUsIGYpO2JyZWFrO2Nhc2UgInNlbGVjdCI6dmFyIHIgPSBlLl93cmFwcGVyU3RhdGUud2FzTXVsdGlwbGU7ZS5fd3JhcHBlclN0YXRlLndhc011bHRpcGxlID0gISFmLm11bHRpcGxlO3ZhciB5ID0gZi52YWx1ZTtudWxsICE9IHkgPyBmYihlLCAhIWYubXVsdGlwbGUsIHksICExKSA6IHIgIT09ICEhZi5tdWx0aXBsZSAmJiAobnVsbCAhPSBmLmRlZmF1bHRWYWx1ZSA/IGZiKGUsICEhZi5tdWx0aXBsZSwKICAgICAgICAgICAgICAgICAgICAgICAgZi5kZWZhdWx0VmFsdWUsICEwKSA6IGZiKGUsICEhZi5tdWx0aXBsZSwgZi5tdWx0aXBsZSA/IFtdIDogIiIsICExKSk7fWVbUGZdID0gZjt9IGNhdGNoICh0KSB7VyhhLCBhLnJldHVybiwgdCk7fX1icmVhaztjYXNlIDY6ZGsoYiwgYSk7ZmsoYSk7aWYgKGQgJiA0KSB7aWYgKG51bGwgPT09IGEuc3RhdGVOb2RlKSB0aHJvdyBFcnJvcihwKDE2MikpO2UgPSBhLnN0YXRlTm9kZTtmID0gYS5tZW1vaXplZFByb3BzO3RyeSB7ZS5ub2RlVmFsdWUgPSBmO30gY2F0Y2ggKHQpIHtXKGEsIGEucmV0dXJuLCB0KTt9fWJyZWFrO2Nhc2UgMzpkayhiLCBhKTtmayhhKTtpZiAoZCAmIDQgJiYgbnVsbCAhPT0gYyAmJiBjLm1lbW9pemVkU3RhdGUuaXNEZWh5ZHJhdGVkKSB0cnkge2JkKGIuY29udGFpbmVySW5mbyk7fSBjYXRjaCAodCkge1coYSwgYS5yZXR1cm4sIHQpO31icmVhaztjYXNlIDQ6ZGsoYiwgYSk7ZmsoYSk7YnJlYWs7Y2FzZSAxMzpkayhiLCBhKTtmayhhKTtlID0gYS5jaGlsZDtlLmZsYWdzICYgODE5MiAmJiAoZiA9IG51bGwgIT09IGUubWVtb2l6ZWRTdGF0ZSwgZS5zdGF0ZU5vZGUuaXNIaWRkZW4gPSBmLCAhZiB8fAogICAgICAgICAgICAgICAgbnVsbCAhPT0gZS5hbHRlcm5hdGUgJiYgbnVsbCAhPT0gZS5hbHRlcm5hdGUubWVtb2l6ZWRTdGF0ZSB8fCAoZ2sgPSBCKCkpKTtkICYgNCAmJiBiayhhKTticmVhaztjYXNlIDIyOm0gPSBudWxsICE9PSBjICYmIG51bGwgIT09IGMubWVtb2l6ZWRTdGF0ZTthLm1vZGUgJiAxID8gKFUgPSAobCA9IFUpIHx8IG0sIGRrKGIsIGEpLCBVID0gbCkgOiBkayhiLCBhKTtmayhhKTtpZiAoZCAmIDgxOTIpIHtsID0gbnVsbCAhPT0gYS5tZW1vaXplZFN0YXRlO2lmICgoYS5zdGF0ZU5vZGUuaXNIaWRkZW4gPSBsKSAmJiAhbSAmJiAwICE9PSAoYS5tb2RlICYgMSkpIGZvciAoViA9IGEsIG0gPSBhLmNoaWxkOyBudWxsICE9PSBtOykge2ZvciAocSA9IFYgPSBtOyBudWxsICE9PSBWOykge3IgPSBWO3kgPSByLmNoaWxkO3N3aXRjaCAoci50YWcpIHtjYXNlIDA6Y2FzZSAxMTpjYXNlIDE0OmNhc2UgMTU6UWooNCwgciwgci5yZXR1cm4pO2JyZWFrO2Nhc2UgMTpNaihyLCByLnJldHVybik7dmFyIG4gPSByLnN0YXRlTm9kZTtpZiAoImZ1bmN0aW9uIiA9PT0gdHlwZW9mIG4uY29tcG9uZW50V2lsbFVubW91bnQpIHtkID0gcjtjID0gci5yZXR1cm47dHJ5IHtiID0gZCwgbi5wcm9wcyA9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGIubWVtb2l6ZWRQcm9wcywgbi5zdGF0ZSA9IGIubWVtb2l6ZWRTdGF0ZSwgbi5jb21wb25lbnRXaWxsVW5tb3VudCgpO30gY2F0Y2ggKHQpIHtXKGQsIGMsIHQpO319YnJlYWs7Y2FzZSA1Ok1qKHIsIHIucmV0dXJuKTticmVhaztjYXNlIDIyOmlmIChudWxsICE9PSByLm1lbW9pemVkU3RhdGUpIHtoayhxKTtjb250aW51ZTt9fW51bGwgIT09IHkgPyAoeS5yZXR1cm4gPSByLCBWID0geSkgOiBoayhxKTt9bSA9IG0uc2libGluZzt9YTogZm9yIChtID0gbnVsbCwgcSA9IGE7Oykge2lmICg1ID09PSBxLnRhZykge2lmIChudWxsID09PSBtKSB7bSA9IHE7dHJ5IHtlID0gcS5zdGF0ZU5vZGUsIGwgPyAoZiA9IGUuc3R5bGUsICJmdW5jdGlvbiIgPT09IHR5cGVvZiBmLnNldFByb3BlcnR5ID8gZi5zZXRQcm9wZXJ0eSgiZGlzcGxheSIsICJub25lIiwgImltcG9ydGFudCIpIDogZi5kaXNwbGF5ID0gIm5vbmUiKSA6IChoID0gcS5zdGF0ZU5vZGUsIGsgPSBxLm1lbW9pemVkUHJvcHMuc3R5bGUsIGcgPSB2b2lkIDAgIT09IGsgJiYgbnVsbCAhPT0gayAmJiBrLmhhc093blByb3BlcnR5KCJkaXNwbGF5IikgPyBrLmRpc3BsYXkgOiBudWxsLCBoLnN0eWxlLmRpc3BsYXkgPQogICAgICAgICAgICAgICAgICAgICAgICAgIHJiKCJkaXNwbGF5IiwgZykpO30gY2F0Y2ggKHQpIHtXKGEsIGEucmV0dXJuLCB0KTt9fX0gZWxzZSBpZiAoNiA9PT0gcS50YWcpIHtpZiAobnVsbCA9PT0gbSkgdHJ5IHtxLnN0YXRlTm9kZS5ub2RlVmFsdWUgPSBsID8gIiIgOiBxLm1lbW9pemVkUHJvcHM7fSBjYXRjaCAodCkge1coYSwgYS5yZXR1cm4sIHQpO319IGVsc2UgaWYgKCgyMiAhPT0gcS50YWcgJiYgMjMgIT09IHEudGFnIHx8IG51bGwgPT09IHEubWVtb2l6ZWRTdGF0ZSB8fCBxID09PSBhKSAmJiBudWxsICE9PSBxLmNoaWxkKSB7cS5jaGlsZC5yZXR1cm4gPSBxO3EgPSBxLmNoaWxkO2NvbnRpbnVlO31pZiAocSA9PT0gYSkgYnJlYWsgYTtmb3IgKDsgbnVsbCA9PT0gcS5zaWJsaW5nOykge2lmIChudWxsID09PSBxLnJldHVybiB8fCBxLnJldHVybiA9PT0gYSkgYnJlYWsgYTttID09PSBxICYmIChtID0gbnVsbCk7cSA9IHEucmV0dXJuO31tID09PSBxICYmIChtID0gbnVsbCk7cS5zaWJsaW5nLnJldHVybiA9IHEucmV0dXJuO3EgPSBxLnNpYmxpbmc7fX1icmVhaztjYXNlIDE5OmRrKGIsIGEpO2ZrKGEpO2QgJiA0ICYmIGJrKGEpO2JyZWFrO2Nhc2UgMjE6YnJlYWs7ZGVmYXVsdDpkayhiLAogICAgICAgICAgICAgICAgYSksIGZrKGEpO319ZnVuY3Rpb24gZmsoYSkge3ZhciBiID0gYS5mbGFncztpZiAoYiAmIDIpIHt0cnkge2E6IHtmb3IgKHZhciBjID0gYS5yZXR1cm47IG51bGwgIT09IGM7KSB7aWYgKFVqKGMpKSB7dmFyIGQgPSBjO2JyZWFrIGE7fWMgPSBjLnJldHVybjt9dGhyb3cgRXJyb3IocCgxNjApKTt9c3dpdGNoIChkLnRhZykge2Nhc2UgNTp2YXIgZSA9IGQuc3RhdGVOb2RlO2QuZmxhZ3MgJiAzMiAmJiAob2IoZSwgIiIpLCBkLmZsYWdzICY9IC0zMyk7dmFyIGYgPSBWaihhKTtYaihhLCBmLCBlKTticmVhaztjYXNlIDM6Y2FzZSA0OnZhciBnID0gZC5zdGF0ZU5vZGUuY29udGFpbmVySW5mbyxoID0gVmooYSk7V2ooYSwgaCwgZyk7YnJlYWs7ZGVmYXVsdDp0aHJvdyBFcnJvcihwKDE2MSkpO319IGNhdGNoIChrKSB7VyhhLCBhLnJldHVybiwgayk7fWEuZmxhZ3MgJj0gLTM7fWIgJiA0MDk2ICYmIChhLmZsYWdzICY9IC00MDk3KTt9ZnVuY3Rpb24gaWsoYSwgYiwgYykge1YgPSBhO2prKGEsIGIsIGMpO30KICAgICAgICAgIGZ1bmN0aW9uIGprKGEsIGIsIGMpIHtmb3IgKHZhciBkID0gMCAhPT0gKGEubW9kZSAmIDEpOyBudWxsICE9PSBWOykge3ZhciBlID0gVixmID0gZS5jaGlsZDtpZiAoMjIgPT09IGUudGFnICYmIGQpIHt2YXIgZyA9IG51bGwgIT09IGUubWVtb2l6ZWRTdGF0ZSB8fCBLajtpZiAoIWcpIHt2YXIgaCA9IGUuYWx0ZXJuYXRlLGsgPSBudWxsICE9PSBoICYmIG51bGwgIT09IGgubWVtb2l6ZWRTdGF0ZSB8fCBVO2ggPSBLajt2YXIgbCA9IFU7S2ogPSBnO2lmICgoVSA9IGspICYmICFsKSBmb3IgKFYgPSBlOyBudWxsICE9PSBWOykgZyA9IFYsIGsgPSBnLmNoaWxkLCAyMiA9PT0gZy50YWcgJiYgbnVsbCAhPT0gZy5tZW1vaXplZFN0YXRlID8ga2soZSkgOiBudWxsICE9PSBrID8gKGsucmV0dXJuID0gZywgViA9IGspIDoga2soZSk7Zm9yICg7IG51bGwgIT09IGY7KSBWID0gZiwgamsoZiwgYiwgYyksIGYgPSBmLnNpYmxpbmc7ViA9IGU7S2ogPSBoO1UgPSBsO31sayhhLCBiLCBjKTt9IGVsc2UgMCAhPT0gKGUuc3VidHJlZUZsYWdzICYgODc3MikgJiYgbnVsbCAhPT0gZiA/IChmLnJldHVybiA9IGUsIFYgPSBmKSA6IGxrKGEsIGIsIGMpO319CiAgICAgICAgICBmdW5jdGlvbiBsayhhKSB7Zm9yICg7IG51bGwgIT09IFY7KSB7dmFyIGIgPSBWO2lmICgwICE9PSAoYi5mbGFncyAmIDg3NzIpKSB7dmFyIGMgPSBiLmFsdGVybmF0ZTt0cnkge2lmICgwICE9PSAoYi5mbGFncyAmIDg3NzIpKSBzd2l0Y2ggKGIudGFnKSB7Y2FzZSAwOmNhc2UgMTE6Y2FzZSAxNTpVIHx8IFJqKDUsIGIpO2JyZWFrO2Nhc2UgMTp2YXIgZCA9IGIuc3RhdGVOb2RlO2lmIChiLmZsYWdzICYgNCAmJiAhVSkgaWYgKG51bGwgPT09IGMpIGQuY29tcG9uZW50RGlkTW91bnQoKTtlbHNlIHt2YXIgZSA9IGIuZWxlbWVudFR5cGUgPT09IGIudHlwZSA/IGMubWVtb2l6ZWRQcm9wcyA6IExnKGIudHlwZSwgYy5tZW1vaXplZFByb3BzKTtkLmNvbXBvbmVudERpZFVwZGF0ZShlLCBjLm1lbW9pemVkU3RhdGUsIGQuX19yZWFjdEludGVybmFsU25hcHNob3RCZWZvcmVVcGRhdGUpO312YXIgZiA9IGIudXBkYXRlUXVldWU7bnVsbCAhPT0gZiAmJiBpaChiLCBmLCBkKTticmVhaztjYXNlIDM6dmFyIGcgPSBiLnVwZGF0ZVF1ZXVlO2lmIChudWxsICE9PSBnKSB7YyA9IG51bGw7aWYgKG51bGwgIT09IGIuY2hpbGQpIHN3aXRjaCAoYi5jaGlsZC50YWcpIHtjYXNlIDU6YyA9CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBiLmNoaWxkLnN0YXRlTm9kZTticmVhaztjYXNlIDE6YyA9IGIuY2hpbGQuc3RhdGVOb2RlO31paChiLCBnLCBjKTt9YnJlYWs7Y2FzZSA1OnZhciBoID0gYi5zdGF0ZU5vZGU7aWYgKG51bGwgPT09IGMgJiYgYi5mbGFncyAmIDQpIHtjID0gaDt2YXIgayA9IGIubWVtb2l6ZWRQcm9wcztzd2l0Y2ggKGIudHlwZSkge2Nhc2UgImJ1dHRvbiI6Y2FzZSAiaW5wdXQiOmNhc2UgInNlbGVjdCI6Y2FzZSAidGV4dGFyZWEiOmsuYXV0b0ZvY3VzICYmIGMuZm9jdXMoKTticmVhaztjYXNlICJpbWciOmsuc3JjICYmIChjLnNyYyA9IGsuc3JjKTt9fWJyZWFrO2Nhc2UgNjpicmVhaztjYXNlIDQ6YnJlYWs7Y2FzZSAxMjpicmVhaztjYXNlIDEzOmlmIChudWxsID09PSBiLm1lbW9pemVkU3RhdGUpIHt2YXIgbCA9IGIuYWx0ZXJuYXRlO2lmIChudWxsICE9PSBsKSB7dmFyIG0gPSBsLm1lbW9pemVkU3RhdGU7aWYgKG51bGwgIT09IG0pIHt2YXIgcSA9IG0uZGVoeWRyYXRlZDtudWxsICE9PSBxICYmIGJkKHEpO319fWJyZWFrO2Nhc2UgMTk6Y2FzZSAxNzpjYXNlIDIxOmNhc2UgMjI6Y2FzZSAyMzpjYXNlIDI1OmJyZWFrOwogICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6dGhyb3cgRXJyb3IocCgxNjMpKTt9VSB8fCBiLmZsYWdzICYgNTEyICYmIFNqKGIpO30gY2F0Y2ggKHIpIHtXKGIsIGIucmV0dXJuLCByKTt9fWlmIChiID09PSBhKSB7ViA9IG51bGw7YnJlYWs7fWMgPSBiLnNpYmxpbmc7aWYgKG51bGwgIT09IGMpIHtjLnJldHVybiA9IGIucmV0dXJuO1YgPSBjO2JyZWFrO31WID0gYi5yZXR1cm47fX1mdW5jdGlvbiBoayhhKSB7Zm9yICg7IG51bGwgIT09IFY7KSB7dmFyIGIgPSBWO2lmIChiID09PSBhKSB7ViA9IG51bGw7YnJlYWs7fXZhciBjID0gYi5zaWJsaW5nO2lmIChudWxsICE9PSBjKSB7Yy5yZXR1cm4gPSBiLnJldHVybjtWID0gYzticmVhazt9ViA9IGIucmV0dXJuO319CiAgICAgICAgICBmdW5jdGlvbiBrayhhKSB7Zm9yICg7IG51bGwgIT09IFY7KSB7dmFyIGIgPSBWO3RyeSB7c3dpdGNoIChiLnRhZykge2Nhc2UgMDpjYXNlIDExOmNhc2UgMTU6dmFyIGMgPSBiLnJldHVybjt0cnkge1JqKDQsIGIpO30gY2F0Y2ggKGspIHtXKGIsIGMsIGspO31icmVhaztjYXNlIDE6dmFyIGQgPSBiLnN0YXRlTm9kZTtpZiAoImZ1bmN0aW9uIiA9PT0gdHlwZW9mIGQuY29tcG9uZW50RGlkTW91bnQpIHt2YXIgZSA9IGIucmV0dXJuO3RyeSB7ZC5jb21wb25lbnREaWRNb3VudCgpO30gY2F0Y2ggKGspIHtXKGIsIGUsIGspO319dmFyIGYgPSBiLnJldHVybjt0cnkge1NqKGIpO30gY2F0Y2ggKGspIHtXKGIsIGYsIGspO31icmVhaztjYXNlIDU6dmFyIGcgPSBiLnJldHVybjt0cnkge1NqKGIpO30gY2F0Y2ggKGspIHtXKGIsIGcsIGspO319fSBjYXRjaCAoaykge1coYiwgYi5yZXR1cm4sIGspO31pZiAoYiA9PT0gYSkge1YgPSBudWxsO2JyZWFrO312YXIgaCA9IGIuc2libGluZztpZiAobnVsbCAhPT0gaCkge2gucmV0dXJuID0gYi5yZXR1cm47ViA9IGg7YnJlYWs7fVYgPSBiLnJldHVybjt9fQogICAgICAgICAgdmFyIG1rID0gTWF0aC5jZWlsLG5rID0gdWEuUmVhY3RDdXJyZW50RGlzcGF0Y2hlcixvayA9IHVhLlJlYWN0Q3VycmVudE93bmVyLHBrID0gdWEuUmVhY3RDdXJyZW50QmF0Y2hDb25maWcsSyA9IDAsUiA9IG51bGwsWSA9IG51bGwsWiA9IDAsZ2ogPSAwLGZqID0gVWYoMCksVCA9IDAscWsgPSBudWxsLGhoID0gMCxyayA9IDAsc2sgPSAwLHRrID0gbnVsbCx1ayA9IG51bGwsZ2sgPSAwLEhqID0gSW5maW5pdHksdmsgPSBudWxsLFBpID0gITEsUWkgPSBudWxsLFNpID0gbnVsbCx3ayA9ICExLHhrID0gbnVsbCx5ayA9IDAsemsgPSAwLEFrID0gbnVsbCxCayA9IC0xLENrID0gMDtmdW5jdGlvbiBMKCkge3JldHVybiAwICE9PSAoSyAmIDYpID8gQigpIDogLTEgIT09IEJrID8gQmsgOiBCayA9IEIoKTt9CiAgICAgICAgICBmdW5jdGlvbiBsaChhKSB7aWYgKDAgPT09IChhLm1vZGUgJiAxKSkgcmV0dXJuIDE7aWYgKDAgIT09IChLICYgMikgJiYgMCAhPT0gWikgcmV0dXJuIFogJiAtWjtpZiAobnVsbCAhPT0gS2cudHJhbnNpdGlvbikgcmV0dXJuIDAgPT09IENrICYmIChDayA9IHljKCkpLCBDazthID0gQztpZiAoMCAhPT0gYSkgcmV0dXJuIGE7YSA9IHdpbmRvdy5ldmVudDthID0gdm9pZCAwID09PSBhID8gMTYgOiBqZChhLnR5cGUpO3JldHVybiBhO31mdW5jdGlvbiBtaChhLCBiLCBjLCBkKSB7aWYgKDUwIDwgemspIHRocm93IHprID0gMCwgQWsgPSBudWxsLCBFcnJvcihwKDE4NSkpO0FjKGEsIGMsIGQpO2lmICgwID09PSAoSyAmIDIpIHx8IGEgIT09IFIpIGEgPT09IFIgJiYgKDAgPT09IChLICYgMikgJiYgKHJrIHw9IGMpLCA0ID09PSBUICYmIERrKGEsIFopKSwgRWsoYSwgZCksIDEgPT09IGMgJiYgMCA9PT0gSyAmJiAwID09PSAoYi5tb2RlICYgMSkgJiYgKEhqID0gQigpICsgNTAwLCBmZyAmJiBqZygpKTt9CiAgICAgICAgICBmdW5jdGlvbiBFayhhLCBiKSB7dmFyIGMgPSBhLmNhbGxiYWNrTm9kZTt3YyhhLCBiKTt2YXIgZCA9IHVjKGEsIGEgPT09IFIgPyBaIDogMCk7aWYgKDAgPT09IGQpIG51bGwgIT09IGMgJiYgYmMoYyksIGEuY2FsbGJhY2tOb2RlID0gbnVsbCwgYS5jYWxsYmFja1ByaW9yaXR5ID0gMDtlbHNlIGlmIChiID0gZCAmIC1kLCBhLmNhbGxiYWNrUHJpb3JpdHkgIT09IGIpIHtudWxsICE9IGMgJiYgYmMoYyk7aWYgKDEgPT09IGIpIDAgPT09IGEudGFnID8gaWcoRmsuYmluZChudWxsLCBhKSkgOiBoZyhGay5iaW5kKG51bGwsIGEpKSwgSmYoZnVuY3Rpb24gKCkgezAgPT09IChLICYgNikgJiYgamcoKTt9KSwgYyA9IG51bGw7ZWxzZSB7c3dpdGNoIChEYyhkKSkge2Nhc2UgMTpjID0gZmM7YnJlYWs7Y2FzZSA0OmMgPSBnYzticmVhaztjYXNlIDE2OmMgPSBoYzticmVhaztjYXNlIDUzNjg3MDkxMjpjID0gamM7YnJlYWs7ZGVmYXVsdDpjID0gaGM7fWMgPSBHayhjLCBIay5iaW5kKG51bGwsIGEpKTt9YS5jYWxsYmFja1ByaW9yaXR5ID0gYjthLmNhbGxiYWNrTm9kZSA9IGM7fX0KICAgICAgICAgIGZ1bmN0aW9uIEhrKGEsIGIpIHtCayA9IC0xO0NrID0gMDtpZiAoMCAhPT0gKEsgJiA2KSkgdGhyb3cgRXJyb3IocCgzMjcpKTt2YXIgYyA9IGEuY2FsbGJhY2tOb2RlO2lmIChJaygpICYmIGEuY2FsbGJhY2tOb2RlICE9PSBjKSByZXR1cm4gbnVsbDt2YXIgZCA9IHVjKGEsIGEgPT09IFIgPyBaIDogMCk7aWYgKDAgPT09IGQpIHJldHVybiBudWxsO2lmICgwICE9PSAoZCAmIDMwKSB8fCAwICE9PSAoZCAmIGEuZXhwaXJlZExhbmVzKSB8fCBiKSBiID0gSmsoYSwgZCk7ZWxzZSB7YiA9IGQ7dmFyIGUgPSBLO0sgfD0gMjt2YXIgZiA9IEtrKCk7aWYgKFIgIT09IGEgfHwgWiAhPT0gYikgdmsgPSBudWxsLCBIaiA9IEIoKSArIDUwMCwgTGsoYSwgYik7ZG8gdHJ5IHtNaygpO2JyZWFrO30gY2F0Y2ggKGgpIHtOayhhLCBoKTt9IHdoaWxlICgxKTtRZygpO25rLmN1cnJlbnQgPSBmO0sgPSBlO251bGwgIT09IFkgPyBiID0gMCA6IChSID0gbnVsbCwgWiA9IDAsIGIgPSBUKTt9aWYgKDAgIT09IGIpIHsyID09PSBiICYmIChlID0geGMoYSksIDAgIT09IGUgJiYgKGQgPSBlLCBiID0gT2soYSwgZSkpKTtpZiAoMSA9PT0gYikgdGhyb3cgYyA9IHFrLCBMayhhLCAwKSwgRGsoYSwgZCksIEVrKGEsIEIoKSksIGM7aWYgKDYgPT09IGIpIERrKGEsIGQpO2Vsc2UKICAgICAgICAgICAgICB7ZSA9IGEuY3VycmVudC5hbHRlcm5hdGU7aWYgKDAgPT09IChkICYgMzApICYmICFQayhlKSAmJiAoYiA9IEprKGEsIGQpLCAyID09PSBiICYmIChmID0geGMoYSksIDAgIT09IGYgJiYgKGQgPSBmLCBiID0gT2soYSwgZikpKSwgMSA9PT0gYikpIHRocm93IGMgPSBxaywgTGsoYSwgMCksIERrKGEsIGQpLCBFayhhLCBCKCkpLCBjO2EuZmluaXNoZWRXb3JrID0gZTthLmZpbmlzaGVkTGFuZXMgPSBkO3N3aXRjaCAoYikge2Nhc2UgMDpjYXNlIDE6dGhyb3cgRXJyb3IocCgzNDUpKTtjYXNlIDI6UWsoYSwgdWssIHZrKTticmVhaztjYXNlIDM6RGsoYSwgZCk7aWYgKChkICYgMTMwMDIzNDI0KSA9PT0gZCAmJiAoYiA9IGdrICsgNTAwIC0gQigpLCAxMCA8IGIpKSB7aWYgKDAgIT09IHVjKGEsIDApKSBicmVhaztlID0gYS5zdXNwZW5kZWRMYW5lcztpZiAoKGUgJiBkKSAhPT0gZCkge0woKTthLnBpbmdlZExhbmVzIHw9IGEuc3VzcGVuZGVkTGFuZXMgJiBlO2JyZWFrO31hLnRpbWVvdXRIYW5kbGUgPSBGZihRay5iaW5kKG51bGwsIGEsIHVrLCB2ayksIGIpO2JyZWFrO31RayhhLCB1aywgdmspO2JyZWFrO2Nhc2UgNDpEayhhLCBkKTtpZiAoKGQgJiA0MTk0MjQwKSA9PT0KICAgICAgICAgICAgICAgICAgICBkKSBicmVhaztiID0gYS5ldmVudFRpbWVzO2ZvciAoZSA9IC0xOyAwIDwgZDspIHt2YXIgZyA9IDMxIC0gb2MoZCk7ZiA9IDEgPDwgZztnID0gYltnXTtnID4gZSAmJiAoZSA9IGcpO2QgJj0gfmY7fWQgPSBlO2QgPSBCKCkgLSBkO2QgPSAoMTIwID4gZCA/IDEyMCA6IDQ4MCA+IGQgPyA0ODAgOiAxMDgwID4gZCA/IDEwODAgOiAxOTIwID4gZCA/IDE5MjAgOiAzRTMgPiBkID8gM0UzIDogNDMyMCA+IGQgPyA0MzIwIDogMTk2MCAqIG1rKGQgLyAxOTYwKSkgLSBkO2lmICgxMCA8IGQpIHthLnRpbWVvdXRIYW5kbGUgPSBGZihRay5iaW5kKG51bGwsIGEsIHVrLCB2ayksIGQpO2JyZWFrO31RayhhLCB1aywgdmspO2JyZWFrO2Nhc2UgNTpRayhhLCB1aywgdmspO2JyZWFrO2RlZmF1bHQ6dGhyb3cgRXJyb3IocCgzMjkpKTt9fX1FayhhLCBCKCkpO3JldHVybiBhLmNhbGxiYWNrTm9kZSA9PT0gYyA/IEhrLmJpbmQobnVsbCwgYSkgOiBudWxsO30KICAgICAgICAgIGZ1bmN0aW9uIE9rKGEsIGIpIHt2YXIgYyA9IHRrO2EuY3VycmVudC5tZW1vaXplZFN0YXRlLmlzRGVoeWRyYXRlZCAmJiAoTGsoYSwgYikuZmxhZ3MgfD0gMjU2KTthID0gSmsoYSwgYik7MiAhPT0gYSAmJiAoYiA9IHVrLCB1ayA9IGMsIG51bGwgIT09IGIgJiYgR2ooYikpO3JldHVybiBhO31mdW5jdGlvbiBHaihhKSB7bnVsbCA9PT0gdWsgPyB1ayA9IGEgOiB1ay5wdXNoLmFwcGx5KHVrLCBhKTt9CiAgICAgICAgICBmdW5jdGlvbiBQayhhKSB7Zm9yICh2YXIgYiA9IGE7Oykge2lmIChiLmZsYWdzICYgMTYzODQpIHt2YXIgYyA9IGIudXBkYXRlUXVldWU7aWYgKG51bGwgIT09IGMgJiYgKGMgPSBjLnN0b3JlcywgbnVsbCAhPT0gYykpIGZvciAodmFyIGQgPSAwOyBkIDwgYy5sZW5ndGg7IGQrKykge3ZhciBlID0gY1tkXSxmID0gZS5nZXRTbmFwc2hvdDtlID0gZS52YWx1ZTt0cnkge2lmICghSGUoZigpLCBlKSkgcmV0dXJuICExO30gY2F0Y2ggKGcpIHtyZXR1cm4gITE7fX19YyA9IGIuY2hpbGQ7aWYgKGIuc3VidHJlZUZsYWdzICYgMTYzODQgJiYgbnVsbCAhPT0gYykgYy5yZXR1cm4gPSBiLCBiID0gYztlbHNlIHtpZiAoYiA9PT0gYSkgYnJlYWs7Zm9yICg7IG51bGwgPT09IGIuc2libGluZzspIHtpZiAobnVsbCA9PT0gYi5yZXR1cm4gfHwgYi5yZXR1cm4gPT09IGEpIHJldHVybiAhMDtiID0gYi5yZXR1cm47fWIuc2libGluZy5yZXR1cm4gPSBiLnJldHVybjtiID0gYi5zaWJsaW5nO319cmV0dXJuICEwO30KICAgICAgICAgIGZ1bmN0aW9uIERrKGEsIGIpIHtiICY9IH5zaztiICY9IH5yazthLnN1c3BlbmRlZExhbmVzIHw9IGI7YS5waW5nZWRMYW5lcyAmPSB+Yjtmb3IgKGEgPSBhLmV4cGlyYXRpb25UaW1lczsgMCA8IGI7KSB7dmFyIGMgPSAzMSAtIG9jKGIpLGQgPSAxIDw8IGM7YVtjXSA9IC0xO2IgJj0gfmQ7fX1mdW5jdGlvbiBGayhhKSB7aWYgKDAgIT09IChLICYgNikpIHRocm93IEVycm9yKHAoMzI3KSk7SWsoKTt2YXIgYiA9IHVjKGEsIDApO2lmICgwID09PSAoYiAmIDEpKSByZXR1cm4gRWsoYSwgQigpKSwgbnVsbDt2YXIgYyA9IEprKGEsIGIpO2lmICgwICE9PSBhLnRhZyAmJiAyID09PSBjKSB7dmFyIGQgPSB4YyhhKTswICE9PSBkICYmIChiID0gZCwgYyA9IE9rKGEsIGQpKTt9aWYgKDEgPT09IGMpIHRocm93IGMgPSBxaywgTGsoYSwgMCksIERrKGEsIGIpLCBFayhhLCBCKCkpLCBjO2lmICg2ID09PSBjKSB0aHJvdyBFcnJvcihwKDM0NSkpO2EuZmluaXNoZWRXb3JrID0gYS5jdXJyZW50LmFsdGVybmF0ZTthLmZpbmlzaGVkTGFuZXMgPSBiO1FrKGEsIHVrLCB2ayk7RWsoYSwgQigpKTtyZXR1cm4gbnVsbDt9CiAgICAgICAgICBmdW5jdGlvbiBSayhhLCBiKSB7dmFyIGMgPSBLO0sgfD0gMTt0cnkge3JldHVybiBhKGIpO30gZmluYWxseSB7SyA9IGMsIDAgPT09IEsgJiYgKEhqID0gQigpICsgNTAwLCBmZyAmJiBqZygpKTt9fWZ1bmN0aW9uIFNrKGEpIHtudWxsICE9PSB4ayAmJiAwID09PSB4ay50YWcgJiYgMCA9PT0gKEsgJiA2KSAmJiBJaygpO3ZhciBiID0gSztLIHw9IDE7dmFyIGMgPSBway50cmFuc2l0aW9uLGQgPSBDO3RyeSB7aWYgKHBrLnRyYW5zaXRpb24gPSBudWxsLCBDID0gMSwgYSkgcmV0dXJuIGEoKTt9IGZpbmFsbHkge0MgPSBkLCBway50cmFuc2l0aW9uID0gYywgSyA9IGIsIDAgPT09IChLICYgNikgJiYgamcoKTt9fWZ1bmN0aW9uIElqKCkge2dqID0gZmouY3VycmVudDtFKGZqKTt9CiAgICAgICAgICBmdW5jdGlvbiBMayhhLCBiKSB7YS5maW5pc2hlZFdvcmsgPSBudWxsO2EuZmluaXNoZWRMYW5lcyA9IDA7dmFyIGMgPSBhLnRpbWVvdXRIYW5kbGU7LTEgIT09IGMgJiYgKGEudGltZW91dEhhbmRsZSA9IC0xLCBHZihjKSk7aWYgKG51bGwgIT09IFkpIGZvciAoYyA9IFkucmV0dXJuOyBudWxsICE9PSBjOykge3ZhciBkID0gYzt3ZyhkKTtzd2l0Y2ggKGQudGFnKSB7Y2FzZSAxOmQgPSBkLnR5cGUuY2hpbGRDb250ZXh0VHlwZXM7bnVsbCAhPT0gZCAmJiB2b2lkIDAgIT09IGQgJiYgJGYoKTticmVhaztjYXNlIDM6SmgoKTtFKFdmKTtFKEgpO09oKCk7YnJlYWs7Y2FzZSA1OkxoKGQpO2JyZWFrO2Nhc2UgNDpKaCgpO2JyZWFrO2Nhc2UgMTM6RShNKTticmVhaztjYXNlIDE5OkUoTSk7YnJlYWs7Y2FzZSAxMDpSZyhkLnR5cGUuX2NvbnRleHQpO2JyZWFrO2Nhc2UgMjI6Y2FzZSAyMzpJaigpO31jID0gYy5yZXR1cm47fVIgPSBhO1kgPSBhID0gd2goYS5jdXJyZW50LCBudWxsKTtaID0gZ2ogPSBiO1QgPSAwO3FrID0gbnVsbDtzayA9IHJrID0gaGggPSAwO3VrID0gdGsgPSBudWxsO2lmIChudWxsICE9PSBXZykge2ZvciAoYiA9CiAgICAgICAgICAgICAgMDsgYiA8IFdnLmxlbmd0aDsgYisrKSBpZiAoYyA9IFdnW2JdLCBkID0gYy5pbnRlcmxlYXZlZCwgbnVsbCAhPT0gZCkge2MuaW50ZXJsZWF2ZWQgPSBudWxsO3ZhciBlID0gZC5uZXh0LGYgPSBjLnBlbmRpbmc7aWYgKG51bGwgIT09IGYpIHt2YXIgZyA9IGYubmV4dDtmLm5leHQgPSBlO2QubmV4dCA9IGc7fWMucGVuZGluZyA9IGQ7fVdnID0gbnVsbDt9cmV0dXJuIGE7fQogICAgICAgICAgZnVuY3Rpb24gTmsoYSwgYikge2RvIHt2YXIgYyA9IFk7dHJ5IHtRZygpO1BoLmN1cnJlbnQgPSBhaTtpZiAoU2gpIHtmb3IgKHZhciBkID0gTi5tZW1vaXplZFN0YXRlOyBudWxsICE9PSBkOykge3ZhciBlID0gZC5xdWV1ZTtudWxsICE9PSBlICYmIChlLnBlbmRpbmcgPSBudWxsKTtkID0gZC5uZXh0O31TaCA9ICExO31SaCA9IDA7UCA9IE8gPSBOID0gbnVsbDtUaCA9ICExO1VoID0gMDtvay5jdXJyZW50ID0gbnVsbDtpZiAobnVsbCA9PT0gYyB8fCBudWxsID09PSBjLnJldHVybikge1QgPSAxO3FrID0gYjtZID0gbnVsbDticmVhazt9YToge3ZhciBmID0gYSxnID0gYy5yZXR1cm4saCA9IGMsayA9IGI7YiA9IFo7aC5mbGFncyB8PSAzMjc2ODtpZiAobnVsbCAhPT0gayAmJiAib2JqZWN0IiA9PT0gdHlwZW9mIGsgJiYgImZ1bmN0aW9uIiA9PT0gdHlwZW9mIGsudGhlbikge3ZhciBsID0gayxtID0gaCxxID0gbS50YWc7aWYgKDAgPT09IChtLm1vZGUgJiAxKSAmJiAoMCA9PT0gcSB8fCAxMSA9PT0gcSB8fCAxNSA9PT0gcSkpIHt2YXIgciA9IG0uYWx0ZXJuYXRlO3IgPyAobS51cGRhdGVRdWV1ZSA9IHIudXBkYXRlUXVldWUsIG0ubWVtb2l6ZWRTdGF0ZSA9IHIubWVtb2l6ZWRTdGF0ZSwKICAgICAgICAgICAgICAgICAgICAgIG0ubGFuZXMgPSByLmxhbmVzKSA6IChtLnVwZGF0ZVF1ZXVlID0gbnVsbCwgbS5tZW1vaXplZFN0YXRlID0gbnVsbCk7fXZhciB5ID0gVmkoZyk7aWYgKG51bGwgIT09IHkpIHt5LmZsYWdzICY9IC0yNTc7V2koeSwgZywgaCwgZiwgYik7eS5tb2RlICYgMSAmJiBUaShmLCBsLCBiKTtiID0geTtrID0gbDt2YXIgbiA9IGIudXBkYXRlUXVldWU7aWYgKG51bGwgPT09IG4pIHt2YXIgdCA9IG5ldyBTZXQoKTt0LmFkZChrKTtiLnVwZGF0ZVF1ZXVlID0gdDt9IGVsc2Ugbi5hZGQoayk7YnJlYWsgYTt9IGVsc2Uge2lmICgwID09PSAoYiAmIDEpKSB7VGkoZiwgbCwgYik7dWooKTticmVhayBhO31rID0gRXJyb3IocCg0MjYpKTt9fSBlbHNlIGlmIChJICYmIGgubW9kZSAmIDEpIHt2YXIgSiA9IFZpKGcpO2lmIChudWxsICE9PSBKKSB7MCA9PT0gKEouZmxhZ3MgJiA2NTUzNikgJiYgKEouZmxhZ3MgfD0gMjU2KTtXaShKLCBnLCBoLCBmLCBiKTtKZyhLaShrLCBoKSk7YnJlYWsgYTt9fWYgPSBrID0gS2koaywgaCk7NCAhPT0gVCAmJiAoVCA9IDIpO251bGwgPT09IHRrID8gdGsgPSBbZl0gOiB0ay5wdXNoKGYpO2YgPSBnO2RvIHtzd2l0Y2ggKGYudGFnKSB7Y2FzZSAzOmYuZmxhZ3MgfD0gNjU1MzY7CiAgICAgICAgICAgICAgICAgICAgICAgIGIgJj0gLWI7Zi5sYW5lcyB8PSBiO3ZhciB4ID0gT2koZiwgaywgYik7ZmgoZiwgeCk7YnJlYWsgYTtjYXNlIDE6aCA9IGs7dmFyIHcgPSBmLnR5cGUsdSA9IGYuc3RhdGVOb2RlO2lmICgwID09PSAoZi5mbGFncyAmIDEyOCkgJiYgKCJmdW5jdGlvbiIgPT09IHR5cGVvZiB3LmdldERlcml2ZWRTdGF0ZUZyb21FcnJvciB8fCBudWxsICE9PSB1ICYmICJmdW5jdGlvbiIgPT09IHR5cGVvZiB1LmNvbXBvbmVudERpZENhdGNoICYmIChudWxsID09PSBTaSB8fCAhU2kuaGFzKHUpKSkpIHtmLmZsYWdzIHw9IDY1NTM2O2IgJj0gLWI7Zi5sYW5lcyB8PSBiO3ZhciBGID0gUmkoZiwgaCwgYik7ZmgoZiwgRik7YnJlYWsgYTt9fWYgPSBmLnJldHVybjt9IHdoaWxlIChudWxsICE9PSBmKTt9VGsoYyk7fSBjYXRjaCAobmEpIHtiID0gbmE7WSA9PT0gYyAmJiBudWxsICE9PSBjICYmIChZID0gYyA9IGMucmV0dXJuKTtjb250aW51ZTt9YnJlYWs7fSB3aGlsZSAoMSk7fWZ1bmN0aW9uIEtrKCkge3ZhciBhID0gbmsuY3VycmVudDtuay5jdXJyZW50ID0gYWk7cmV0dXJuIG51bGwgPT09IGEgPyBhaSA6IGE7fQogICAgICAgICAgZnVuY3Rpb24gdWooKSB7aWYgKDAgPT09IFQgfHwgMyA9PT0gVCB8fCAyID09PSBUKSBUID0gNDtudWxsID09PSBSIHx8IDAgPT09IChoaCAmIDI2ODQzNTQ1NSkgJiYgMCA9PT0gKHJrICYgMjY4NDM1NDU1KSB8fCBEayhSLCBaKTt9ZnVuY3Rpb24gSmsoYSwgYikge3ZhciBjID0gSztLIHw9IDI7dmFyIGQgPSBLaygpO2lmIChSICE9PSBhIHx8IFogIT09IGIpIHZrID0gbnVsbCwgTGsoYSwgYik7ZG8gdHJ5IHtVaygpO2JyZWFrO30gY2F0Y2ggKGUpIHtOayhhLCBlKTt9IHdoaWxlICgxKTtRZygpO0sgPSBjO25rLmN1cnJlbnQgPSBkO2lmIChudWxsICE9PSBZKSB0aHJvdyBFcnJvcihwKDI2MSkpO1IgPSBudWxsO1ogPSAwO3JldHVybiBUO31mdW5jdGlvbiBVaygpIHtmb3IgKDsgbnVsbCAhPT0gWTspIFZrKFkpO31mdW5jdGlvbiBNaygpIHtmb3IgKDsgbnVsbCAhPT0gWSAmJiAhY2MoKTspIFZrKFkpO31mdW5jdGlvbiBWayhhKSB7dmFyIGIgPSBXayhhLmFsdGVybmF0ZSwgYSwgZ2opO2EubWVtb2l6ZWRQcm9wcyA9IGEucGVuZGluZ1Byb3BzO251bGwgPT09IGIgPyBUayhhKSA6IFkgPSBiO29rLmN1cnJlbnQgPSBudWxsO30KICAgICAgICAgIGZ1bmN0aW9uIFRrKGEpIHt2YXIgYiA9IGE7ZG8ge3ZhciBjID0gYi5hbHRlcm5hdGU7YSA9IGIucmV0dXJuO2lmICgwID09PSAoYi5mbGFncyAmIDMyNzY4KSkge2lmIChjID0gRmooYywgYiwgZ2opLCBudWxsICE9PSBjKSB7WSA9IGM7cmV0dXJuO319IGVsc2Uge2MgPSBKaihjLCBiKTtpZiAobnVsbCAhPT0gYykge2MuZmxhZ3MgJj0gMzI3Njc7WSA9IGM7cmV0dXJuO31pZiAobnVsbCAhPT0gYSkgYS5mbGFncyB8PSAzMjc2OCwgYS5zdWJ0cmVlRmxhZ3MgPSAwLCBhLmRlbGV0aW9ucyA9IG51bGw7ZWxzZSB7VCA9IDY7WSA9IG51bGw7cmV0dXJuO319YiA9IGIuc2libGluZztpZiAobnVsbCAhPT0gYikge1kgPSBiO3JldHVybjt9WSA9IGIgPSBhO30gd2hpbGUgKG51bGwgIT09IGIpOzAgPT09IFQgJiYgKFQgPSA1KTt9ZnVuY3Rpb24gUWsoYSwgYiwgYykge3ZhciBkID0gQyxlID0gcGsudHJhbnNpdGlvbjt0cnkge3BrLnRyYW5zaXRpb24gPSBudWxsLCBDID0gMSwgWGsoYSwgYiwgYywgZCk7fSBmaW5hbGx5IHtway50cmFuc2l0aW9uID0gZSwgQyA9IGQ7fXJldHVybiBudWxsO30KICAgICAgICAgIGZ1bmN0aW9uIFhrKGEsIGIsIGMsIGQpIHtkbyBJaygpOyB3aGlsZSAobnVsbCAhPT0geGspO2lmICgwICE9PSAoSyAmIDYpKSB0aHJvdyBFcnJvcihwKDMyNykpO2MgPSBhLmZpbmlzaGVkV29yazt2YXIgZSA9IGEuZmluaXNoZWRMYW5lcztpZiAobnVsbCA9PT0gYykgcmV0dXJuIG51bGw7YS5maW5pc2hlZFdvcmsgPSBudWxsO2EuZmluaXNoZWRMYW5lcyA9IDA7aWYgKGMgPT09IGEuY3VycmVudCkgdGhyb3cgRXJyb3IocCgxNzcpKTthLmNhbGxiYWNrTm9kZSA9IG51bGw7YS5jYWxsYmFja1ByaW9yaXR5ID0gMDt2YXIgZiA9IGMubGFuZXMgfCBjLmNoaWxkTGFuZXM7QmMoYSwgZik7YSA9PT0gUiAmJiAoWSA9IFIgPSBudWxsLCBaID0gMCk7MCA9PT0gKGMuc3VidHJlZUZsYWdzICYgMjA2NCkgJiYgMCA9PT0gKGMuZmxhZ3MgJiAyMDY0KSB8fCB3ayB8fCAod2sgPSAhMCwgR2soaGMsIGZ1bmN0aW9uICgpIHtJaygpO3JldHVybiBudWxsO30pKTtmID0gMCAhPT0gKGMuZmxhZ3MgJiAxNTk5MCk7aWYgKDAgIT09IChjLnN1YnRyZWVGbGFncyAmIDE1OTkwKSB8fCBmKSB7ZiA9IHBrLnRyYW5zaXRpb247cGsudHJhbnNpdGlvbiA9IG51bGw7CiAgICAgICAgICAgICAgdmFyIGcgPSBDO0MgPSAxO3ZhciBoID0gSztLIHw9IDQ7b2suY3VycmVudCA9IG51bGw7UGooYSwgYyk7ZWsoYywgYSk7T2UoRGYpO2RkID0gISFDZjtEZiA9IENmID0gbnVsbDthLmN1cnJlbnQgPSBjO2lrKGMsIGEsIGUpO2RjKCk7SyA9IGg7QyA9IGc7cGsudHJhbnNpdGlvbiA9IGY7fSBlbHNlIGEuY3VycmVudCA9IGM7d2sgJiYgKHdrID0gITEsIHhrID0gYSwgeWsgPSBlKTtmID0gYS5wZW5kaW5nTGFuZXM7MCA9PT0gZiAmJiAoU2kgPSBudWxsKTttYyhjLnN0YXRlTm9kZSwgZCk7RWsoYSwgQigpKTtpZiAobnVsbCAhPT0gYikgZm9yIChkID0gYS5vblJlY292ZXJhYmxlRXJyb3IsIGMgPSAwOyBjIDwgYi5sZW5ndGg7IGMrKykgZSA9IGJbY10sIGQoZS52YWx1ZSwgeyBjb21wb25lbnRTdGFjazogZS5zdGFjaywgZGlnZXN0OiBlLmRpZ2VzdCB9KTtpZiAoUGkpIHRocm93IFBpID0gITEsIGEgPSBRaSwgUWkgPSBudWxsLCBhOzAgIT09ICh5ayAmIDEpICYmIDAgIT09IGEudGFnICYmIElrKCk7ZiA9IGEucGVuZGluZ0xhbmVzOzAgIT09IChmICYgMSkgPyBhID09PSBBayA/IHprKysgOiAoemsgPSAwLCBBayA9IGEpIDogemsgPSAwO2pnKCk7cmV0dXJuIG51bGw7fQogICAgICAgICAgZnVuY3Rpb24gSWsoKSB7aWYgKG51bGwgIT09IHhrKSB7dmFyIGEgPSBEYyh5ayksYiA9IHBrLnRyYW5zaXRpb24sYyA9IEM7dHJ5IHtway50cmFuc2l0aW9uID0gbnVsbDtDID0gMTYgPiBhID8gMTYgOiBhO2lmIChudWxsID09PSB4aykgdmFyIGQgPSAhMTtlbHNlIHthID0geGs7eGsgPSBudWxsO3lrID0gMDtpZiAoMCAhPT0gKEsgJiA2KSkgdGhyb3cgRXJyb3IocCgzMzEpKTt2YXIgZSA9IEs7SyB8PSA0O2ZvciAoViA9IGEuY3VycmVudDsgbnVsbCAhPT0gVjspIHt2YXIgZiA9IFYsZyA9IGYuY2hpbGQ7aWYgKDAgIT09IChWLmZsYWdzICYgMTYpKSB7dmFyIGggPSBmLmRlbGV0aW9ucztpZiAobnVsbCAhPT0gaCkge2ZvciAodmFyIGsgPSAwOyBrIDwgaC5sZW5ndGg7IGsrKykge3ZhciBsID0gaFtrXTtmb3IgKFYgPSBsOyBudWxsICE9PSBWOykge3ZhciBtID0gVjtzd2l0Y2ggKG0udGFnKSB7Y2FzZSAwOmNhc2UgMTE6Y2FzZSAxNTpRaig4LCBtLCBmKTt9dmFyIHEgPSBtLmNoaWxkO2lmIChudWxsICE9PSBxKSBxLnJldHVybiA9IG0sIFYgPSBxO2Vsc2UgZm9yICg7IG51bGwgIT09IFY7KSB7bSA9IFY7dmFyIHIgPSBtLnNpYmxpbmcseSA9IG0ucmV0dXJuO1RqKG0pO2lmIChtID09PQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsKSB7ViA9IG51bGw7YnJlYWs7fWlmIChudWxsICE9PSByKSB7ci5yZXR1cm4gPSB5O1YgPSByO2JyZWFrO31WID0geTt9fX12YXIgbiA9IGYuYWx0ZXJuYXRlO2lmIChudWxsICE9PSBuKSB7dmFyIHQgPSBuLmNoaWxkO2lmIChudWxsICE9PSB0KSB7bi5jaGlsZCA9IG51bGw7ZG8ge3ZhciBKID0gdC5zaWJsaW5nO3Quc2libGluZyA9IG51bGw7dCA9IEo7fSB3aGlsZSAobnVsbCAhPT0gdCk7fX1WID0gZjt9fWlmICgwICE9PSAoZi5zdWJ0cmVlRmxhZ3MgJiAyMDY0KSAmJiBudWxsICE9PSBnKSBnLnJldHVybiA9IGYsIFYgPSBnO2Vsc2UgYjogZm9yICg7IG51bGwgIT09IFY7KSB7ZiA9IFY7aWYgKDAgIT09IChmLmZsYWdzICYgMjA0OCkpIHN3aXRjaCAoZi50YWcpIHtjYXNlIDA6Y2FzZSAxMTpjYXNlIDE1OlFqKDksIGYsIGYucmV0dXJuKTt9dmFyIHggPSBmLnNpYmxpbmc7aWYgKG51bGwgIT09IHgpIHt4LnJldHVybiA9IGYucmV0dXJuO1YgPSB4O2JyZWFrIGI7fVYgPSBmLnJldHVybjt9fXZhciB3ID0gYS5jdXJyZW50O2ZvciAoViA9IHc7IG51bGwgIT09IFY7KSB7ZyA9IFY7dmFyIHUgPSBnLmNoaWxkO2lmICgwICE9PSAoZy5zdWJ0cmVlRmxhZ3MgJiAyMDY0KSAmJiBudWxsICE9PQogICAgICAgICAgICAgICAgICAgIHUpIHUucmV0dXJuID0gZywgViA9IHU7ZWxzZSBiOiBmb3IgKGcgPSB3OyBudWxsICE9PSBWOykge2ggPSBWO2lmICgwICE9PSAoaC5mbGFncyAmIDIwNDgpKSB0cnkge3N3aXRjaCAoaC50YWcpIHtjYXNlIDA6Y2FzZSAxMTpjYXNlIDE1OlJqKDksIGgpO319IGNhdGNoIChuYSkge1coaCwgaC5yZXR1cm4sIG5hKTt9aWYgKGggPT09IGcpIHtWID0gbnVsbDticmVhayBiO312YXIgRiA9IGguc2libGluZztpZiAobnVsbCAhPT0gRikge0YucmV0dXJuID0gaC5yZXR1cm47ViA9IEY7YnJlYWsgYjt9ViA9IGgucmV0dXJuO319SyA9IGU7amcoKTtpZiAobGMgJiYgImZ1bmN0aW9uIiA9PT0gdHlwZW9mIGxjLm9uUG9zdENvbW1pdEZpYmVyUm9vdCkgdHJ5IHtsYy5vblBvc3RDb21taXRGaWJlclJvb3Qoa2MsIGEpO30gY2F0Y2ggKG5hKSB7fWQgPSAhMDt9cmV0dXJuIGQ7fSBmaW5hbGx5IHtDID0gYywgcGsudHJhbnNpdGlvbiA9IGI7fX1yZXR1cm4gITE7fWZ1bmN0aW9uIFlrKGEsIGIsIGMpIHtiID0gS2koYywgYik7YiA9IE9pKGEsIGIsIDEpO2EgPSBkaChhLCBiLCAxKTtiID0gTCgpO251bGwgIT09IGEgJiYgKEFjKGEsIDEsIGIpLCBFayhhLCBiKSk7fQogICAgICAgICAgZnVuY3Rpb24gVyhhLCBiLCBjKSB7aWYgKDMgPT09IGEudGFnKSBZayhhLCBhLCBjKTtlbHNlIGZvciAoOyBudWxsICE9PSBiOykge2lmICgzID09PSBiLnRhZykge1lrKGIsIGEsIGMpO2JyZWFrO30gZWxzZSBpZiAoMSA9PT0gYi50YWcpIHt2YXIgZCA9IGIuc3RhdGVOb2RlO2lmICgiZnVuY3Rpb24iID09PSB0eXBlb2YgYi50eXBlLmdldERlcml2ZWRTdGF0ZUZyb21FcnJvciB8fCAiZnVuY3Rpb24iID09PSB0eXBlb2YgZC5jb21wb25lbnREaWRDYXRjaCAmJiAobnVsbCA9PT0gU2kgfHwgIVNpLmhhcyhkKSkpIHthID0gS2koYywgYSk7YSA9IFJpKGIsIGEsIDEpO2IgPSBkaChiLCBhLCAxKTthID0gTCgpO251bGwgIT09IGIgJiYgKEFjKGIsIDEsIGEpLCBFayhiLCBhKSk7YnJlYWs7fX1iID0gYi5yZXR1cm47fX0KICAgICAgICAgIGZ1bmN0aW9uIFVpKGEsIGIsIGMpIHt2YXIgZCA9IGEucGluZ0NhY2hlO251bGwgIT09IGQgJiYgZC5kZWxldGUoYik7YiA9IEwoKTthLnBpbmdlZExhbmVzIHw9IGEuc3VzcGVuZGVkTGFuZXMgJiBjO1IgPT09IGEgJiYgKFogJiBjKSA9PT0gYyAmJiAoNCA9PT0gVCB8fCAzID09PSBUICYmIChaICYgMTMwMDIzNDI0KSA9PT0gWiAmJiA1MDAgPiBCKCkgLSBnayA/IExrKGEsIDApIDogc2sgfD0gYyk7RWsoYSwgYik7fWZ1bmN0aW9uIFprKGEsIGIpIHswID09PSBiICYmICgwID09PSAoYS5tb2RlICYgMSkgPyBiID0gMSA6IChiID0gc2MsIHNjIDw8PSAxLCAwID09PSAoc2MgJiAxMzAwMjM0MjQpICYmIChzYyA9IDQxOTQzMDQpKSk7dmFyIGMgPSBMKCk7YSA9IFpnKGEsIGIpO251bGwgIT09IGEgJiYgKEFjKGEsIGIsIGMpLCBFayhhLCBjKSk7fWZ1bmN0aW9uIHZqKGEpIHt2YXIgYiA9IGEubWVtb2l6ZWRTdGF0ZSxjID0gMDtudWxsICE9PSBiICYmIChjID0gYi5yZXRyeUxhbmUpO1prKGEsIGMpO30KICAgICAgICAgIGZ1bmN0aW9uIGNrKGEsIGIpIHt2YXIgYyA9IDA7c3dpdGNoIChhLnRhZykge2Nhc2UgMTM6dmFyIGQgPSBhLnN0YXRlTm9kZTt2YXIgZSA9IGEubWVtb2l6ZWRTdGF0ZTtudWxsICE9PSBlICYmIChjID0gZS5yZXRyeUxhbmUpO2JyZWFrO2Nhc2UgMTk6ZCA9IGEuc3RhdGVOb2RlO2JyZWFrO2RlZmF1bHQ6dGhyb3cgRXJyb3IocCgzMTQpKTt9bnVsbCAhPT0gZCAmJiBkLmRlbGV0ZShiKTtaayhhLCBjKTt9dmFyIFdrOwogICAgICAgICAgV2sgPSBmdW5jdGlvbiBXayhhLCBiLCBjKSB7aWYgKG51bGwgIT09IGEpIHtpZiAoYS5tZW1vaXplZFByb3BzICE9PSBiLnBlbmRpbmdQcm9wcyB8fCBXZi5jdXJyZW50KSBVZyA9ICEwO2Vsc2Uge2lmICgwID09PSAoYS5sYW5lcyAmIGMpICYmIDAgPT09IChiLmZsYWdzICYgMTI4KSkgcmV0dXJuIFVnID0gITEsIHpqKGEsIGIsIGMpO1VnID0gMCAhPT0gKGEuZmxhZ3MgJiAxMzEwNzIpID8gITAgOiAhMTt9fSBlbHNlIFVnID0gITEsIEkgJiYgMCAhPT0gKGIuZmxhZ3MgJiAxMDQ4NTc2KSAmJiB1ZyhiLCBuZywgYi5pbmRleCk7Yi5sYW5lcyA9IDA7c3dpdGNoIChiLnRhZykge2Nhc2UgMjp2YXIgZCA9IGIudHlwZTtqaihhLCBiKTthID0gYi5wZW5kaW5nUHJvcHM7dmFyIGUgPSBZZihiLCBILmN1cnJlbnQpO1RnKGIsIGMpO2UgPSBYaChudWxsLCBiLCBkLCBhLCBlLCBjKTt2YXIgZiA9IGJpKCk7Yi5mbGFncyB8PSAxOyJvYmplY3QiID09PSB0eXBlb2YgZSAmJiBudWxsICE9PSBlICYmICJmdW5jdGlvbiIgPT09IHR5cGVvZiBlLnJlbmRlciAmJiB2b2lkIDAgPT09IGUuJCR0eXBlb2YgPyAoYi50YWcgPSAxLCBiLm1lbW9pemVkU3RhdGUgPSBudWxsLCBiLnVwZGF0ZVF1ZXVlID0KICAgICAgICAgICAgICAgIG51bGwsIFpmKGQpID8gKGYgPSAhMCwgY2coYikpIDogZiA9ICExLCBiLm1lbW9pemVkU3RhdGUgPSBudWxsICE9PSBlLnN0YXRlICYmIHZvaWQgMCAhPT0gZS5zdGF0ZSA/IGUuc3RhdGUgOiBudWxsLCBhaChiKSwgZS51cGRhdGVyID0gbmgsIGIuc3RhdGVOb2RlID0gZSwgZS5fcmVhY3RJbnRlcm5hbHMgPSBiLCByaChiLCBkLCBhLCBjKSwgYiA9IGtqKG51bGwsIGIsIGQsICEwLCBmLCBjKSkgOiAoYi50YWcgPSAwLCBJICYmIGYgJiYgdmcoYiksIFlpKG51bGwsIGIsIGUsIGMpLCBiID0gYi5jaGlsZCk7cmV0dXJuIGI7Y2FzZSAxNjpkID0gYi5lbGVtZW50VHlwZTthOiB7amooYSwgYik7YSA9IGIucGVuZGluZ1Byb3BzO2UgPSBkLl9pbml0O2QgPSBlKGQuX3BheWxvYWQpO2IudHlwZSA9IGQ7ZSA9IGIudGFnID0gJGsoZCk7YSA9IExnKGQsIGEpO3N3aXRjaCAoZSkge2Nhc2UgMDpiID0gZGoobnVsbCwgYiwgZCwgYSwgYyk7YnJlYWsgYTtjYXNlIDE6YiA9IGlqKG51bGwsIGIsIGQsIGEsIGMpO2JyZWFrIGE7Y2FzZSAxMTpiID0gWmkobnVsbCwgYiwgZCwgYSwgYyk7YnJlYWsgYTtjYXNlIDE0OmIgPSBhaihudWxsLCBiLCBkLCBMZyhkLnR5cGUsIGEpLCBjKTticmVhayBhO310aHJvdyBFcnJvcihwKDMwNiwKICAgICAgICAgICAgICAgICAgZCwgIiIpKTt9cmV0dXJuIGI7Y2FzZSAwOnJldHVybiBkID0gYi50eXBlLCBlID0gYi5wZW5kaW5nUHJvcHMsIGUgPSBiLmVsZW1lbnRUeXBlID09PSBkID8gZSA6IExnKGQsIGUpLCBkaihhLCBiLCBkLCBlLCBjKTtjYXNlIDE6cmV0dXJuIGQgPSBiLnR5cGUsIGUgPSBiLnBlbmRpbmdQcm9wcywgZSA9IGIuZWxlbWVudFR5cGUgPT09IGQgPyBlIDogTGcoZCwgZSksIGlqKGEsIGIsIGQsIGUsIGMpO2Nhc2UgMzphOiB7bGooYik7aWYgKG51bGwgPT09IGEpIHRocm93IEVycm9yKHAoMzg3KSk7ZCA9IGIucGVuZGluZ1Byb3BzO2YgPSBiLm1lbW9pemVkU3RhdGU7ZSA9IGYuZWxlbWVudDtiaChhLCBiKTtnaChiLCBkLCBudWxsLCBjKTt2YXIgZyA9IGIubWVtb2l6ZWRTdGF0ZTtkID0gZy5lbGVtZW50O2lmIChmLmlzRGVoeWRyYXRlZCkge2lmIChmID0geyBlbGVtZW50OiBkLCBpc0RlaHlkcmF0ZWQ6ICExLCBjYWNoZTogZy5jYWNoZSwgcGVuZGluZ1N1c3BlbnNlQm91bmRhcmllczogZy5wZW5kaW5nU3VzcGVuc2VCb3VuZGFyaWVzLCB0cmFuc2l0aW9uczogZy50cmFuc2l0aW9ucyB9LCBiLnVwZGF0ZVF1ZXVlLmJhc2VTdGF0ZSA9CiAgICAgICAgICAgICAgICAgICAgZiwgYi5tZW1vaXplZFN0YXRlID0gZiwgYi5mbGFncyAmIDI1Nikge2UgPSBLaShFcnJvcihwKDQyMykpLCBiKTtiID0gbWooYSwgYiwgZCwgYywgZSk7YnJlYWsgYTt9IGVsc2UgaWYgKGQgIT09IGUpIHtlID0gS2koRXJyb3IocCg0MjQpKSwgYik7YiA9IG1qKGEsIGIsIGQsIGMsIGUpO2JyZWFrIGE7fSBlbHNlIGZvciAoeWcgPSBMZihiLnN0YXRlTm9kZS5jb250YWluZXJJbmZvLmZpcnN0Q2hpbGQpLCB4ZyA9IGIsIEkgPSAhMCwgemcgPSBudWxsLCBjID0gQ2goYiwgbnVsbCwgZCwgYyksIGIuY2hpbGQgPSBjOyBjOykgYy5mbGFncyA9IGMuZmxhZ3MgJiAtMyB8IDQwOTYsIGMgPSBjLnNpYmxpbmc7fSBlbHNlIHtJZygpO2lmIChkID09PSBlKSB7YiA9ICRpKGEsIGIsIGMpO2JyZWFrIGE7fVlpKGEsIGIsIGQsIGMpO31iID0gYi5jaGlsZDt9cmV0dXJuIGI7Y2FzZSA1OnJldHVybiBLaChiKSwgbnVsbCA9PT0gYSAmJiBFZyhiKSwgZCA9IGIudHlwZSwgZSA9IGIucGVuZGluZ1Byb3BzLCBmID0gbnVsbCAhPT0gYSA/IGEubWVtb2l6ZWRQcm9wcyA6IG51bGwsIGcgPSBlLmNoaWxkcmVuLCBFZihkLCBlKSA/IGcgPSBudWxsIDogbnVsbCAhPT0gZiAmJiBFZihkLCBmKSAmJiAoYi5mbGFncyB8PSAzMiksCiAgICAgICAgICAgICAgICBoaihhLCBiKSwgWWkoYSwgYiwgZywgYyksIGIuY2hpbGQ7Y2FzZSA2OnJldHVybiBudWxsID09PSBhICYmIEVnKGIpLCBudWxsO2Nhc2UgMTM6cmV0dXJuIHBqKGEsIGIsIGMpO2Nhc2UgNDpyZXR1cm4gSWgoYiwgYi5zdGF0ZU5vZGUuY29udGFpbmVySW5mbyksIGQgPSBiLnBlbmRpbmdQcm9wcywgbnVsbCA9PT0gYSA/IGIuY2hpbGQgPSBCaChiLCBudWxsLCBkLCBjKSA6IFlpKGEsIGIsIGQsIGMpLCBiLmNoaWxkO2Nhc2UgMTE6cmV0dXJuIGQgPSBiLnR5cGUsIGUgPSBiLnBlbmRpbmdQcm9wcywgZSA9IGIuZWxlbWVudFR5cGUgPT09IGQgPyBlIDogTGcoZCwgZSksIFppKGEsIGIsIGQsIGUsIGMpO2Nhc2UgNzpyZXR1cm4gWWkoYSwgYiwgYi5wZW5kaW5nUHJvcHMsIGMpLCBiLmNoaWxkO2Nhc2UgODpyZXR1cm4gWWkoYSwgYiwgYi5wZW5kaW5nUHJvcHMuY2hpbGRyZW4sIGMpLCBiLmNoaWxkO2Nhc2UgMTI6cmV0dXJuIFlpKGEsIGIsIGIucGVuZGluZ1Byb3BzLmNoaWxkcmVuLCBjKSwgYi5jaGlsZDtjYXNlIDEwOmE6IHtkID0gYi50eXBlLl9jb250ZXh0O2UgPSBiLnBlbmRpbmdQcm9wcztmID0gYi5tZW1vaXplZFByb3BzOwogICAgICAgICAgICAgICAgICBnID0gZS52YWx1ZTtHKE1nLCBkLl9jdXJyZW50VmFsdWUpO2QuX2N1cnJlbnRWYWx1ZSA9IGc7aWYgKG51bGwgIT09IGYpIGlmIChIZShmLnZhbHVlLCBnKSkge2lmIChmLmNoaWxkcmVuID09PSBlLmNoaWxkcmVuICYmICFXZi5jdXJyZW50KSB7YiA9ICRpKGEsIGIsIGMpO2JyZWFrIGE7fX0gZWxzZSBmb3IgKGYgPSBiLmNoaWxkLCBudWxsICE9PSBmICYmIChmLnJldHVybiA9IGIpOyBudWxsICE9PSBmOykge3ZhciBoID0gZi5kZXBlbmRlbmNpZXM7aWYgKG51bGwgIT09IGgpIHtnID0gZi5jaGlsZDtmb3IgKHZhciBrID0gaC5maXJzdENvbnRleHQ7IG51bGwgIT09IGs7KSB7aWYgKGsuY29udGV4dCA9PT0gZCkge2lmICgxID09PSBmLnRhZykge2sgPSBjaCgtMSwgYyAmIC1jKTtrLnRhZyA9IDI7dmFyIGwgPSBmLnVwZGF0ZVF1ZXVlO2lmIChudWxsICE9PSBsKSB7bCA9IGwuc2hhcmVkO3ZhciBtID0gbC5wZW5kaW5nO251bGwgPT09IG0gPyBrLm5leHQgPSBrIDogKGsubmV4dCA9IG0ubmV4dCwgbS5uZXh0ID0gayk7bC5wZW5kaW5nID0gazt9fWYubGFuZXMgfD0gYztrID0gZi5hbHRlcm5hdGU7bnVsbCAhPT0gayAmJiAoay5sYW5lcyB8PSBjKTtTZyhmLnJldHVybiwKICAgICAgICAgICAgICAgICAgICAgICAgICBjLCBiKTtoLmxhbmVzIHw9IGM7YnJlYWs7fWsgPSBrLm5leHQ7fX0gZWxzZSBpZiAoMTAgPT09IGYudGFnKSBnID0gZi50eXBlID09PSBiLnR5cGUgPyBudWxsIDogZi5jaGlsZDtlbHNlIGlmICgxOCA9PT0gZi50YWcpIHtnID0gZi5yZXR1cm47aWYgKG51bGwgPT09IGcpIHRocm93IEVycm9yKHAoMzQxKSk7Zy5sYW5lcyB8PSBjO2ggPSBnLmFsdGVybmF0ZTtudWxsICE9PSBoICYmIChoLmxhbmVzIHw9IGMpO1NnKGcsIGMsIGIpO2cgPSBmLnNpYmxpbmc7fSBlbHNlIGcgPSBmLmNoaWxkO2lmIChudWxsICE9PSBnKSBnLnJldHVybiA9IGY7ZWxzZSBmb3IgKGcgPSBmOyBudWxsICE9PSBnOykge2lmIChnID09PSBiKSB7ZyA9IG51bGw7YnJlYWs7fWYgPSBnLnNpYmxpbmc7aWYgKG51bGwgIT09IGYpIHtmLnJldHVybiA9IGcucmV0dXJuO2cgPSBmO2JyZWFrO31nID0gZy5yZXR1cm47fWYgPSBnO31ZaShhLCBiLCBlLmNoaWxkcmVuLCBjKTtiID0gYi5jaGlsZDt9cmV0dXJuIGI7Y2FzZSA5OnJldHVybiBlID0gYi50eXBlLCBkID0gYi5wZW5kaW5nUHJvcHMuY2hpbGRyZW4sIFRnKGIsIGMpLCBlID0gVmcoZSksIGQgPSBkKGUpLCBiLmZsYWdzIHw9IDEsIFlpKGEsIGIsIGQsIGMpLAogICAgICAgICAgICAgICAgYi5jaGlsZDtjYXNlIDE0OnJldHVybiBkID0gYi50eXBlLCBlID0gTGcoZCwgYi5wZW5kaW5nUHJvcHMpLCBlID0gTGcoZC50eXBlLCBlKSwgYWooYSwgYiwgZCwgZSwgYyk7Y2FzZSAxNTpyZXR1cm4gY2ooYSwgYiwgYi50eXBlLCBiLnBlbmRpbmdQcm9wcywgYyk7Y2FzZSAxNzpyZXR1cm4gZCA9IGIudHlwZSwgZSA9IGIucGVuZGluZ1Byb3BzLCBlID0gYi5lbGVtZW50VHlwZSA9PT0gZCA/IGUgOiBMZyhkLCBlKSwgamooYSwgYiksIGIudGFnID0gMSwgWmYoZCkgPyAoYSA9ICEwLCBjZyhiKSkgOiBhID0gITEsIFRnKGIsIGMpLCBwaChiLCBkLCBlKSwgcmgoYiwgZCwgZSwgYyksIGtqKG51bGwsIGIsIGQsICEwLCBhLCBjKTtjYXNlIDE5OnJldHVybiB5aihhLCBiLCBjKTtjYXNlIDIyOnJldHVybiBlaihhLCBiLCBjKTt9dGhyb3cgRXJyb3IocCgxNTYsIGIudGFnKSk7fTtmdW5jdGlvbiBHayhhLCBiKSB7cmV0dXJuIGFjKGEsIGIpO30KICAgICAgICAgIGZ1bmN0aW9uIGFsKGEsIGIsIGMsIGQpIHt0aGlzLnRhZyA9IGE7dGhpcy5rZXkgPSBjO3RoaXMuc2libGluZyA9IHRoaXMuY2hpbGQgPSB0aGlzLnJldHVybiA9IHRoaXMuc3RhdGVOb2RlID0gdGhpcy50eXBlID0gdGhpcy5lbGVtZW50VHlwZSA9IG51bGw7dGhpcy5pbmRleCA9IDA7dGhpcy5yZWYgPSBudWxsO3RoaXMucGVuZGluZ1Byb3BzID0gYjt0aGlzLmRlcGVuZGVuY2llcyA9IHRoaXMubWVtb2l6ZWRTdGF0ZSA9IHRoaXMudXBkYXRlUXVldWUgPSB0aGlzLm1lbW9pemVkUHJvcHMgPSBudWxsO3RoaXMubW9kZSA9IGQ7dGhpcy5zdWJ0cmVlRmxhZ3MgPSB0aGlzLmZsYWdzID0gMDt0aGlzLmRlbGV0aW9ucyA9IG51bGw7dGhpcy5jaGlsZExhbmVzID0gdGhpcy5sYW5lcyA9IDA7dGhpcy5hbHRlcm5hdGUgPSBudWxsO31mdW5jdGlvbiBCZyhhLCBiLCBjLCBkKSB7cmV0dXJuIG5ldyBhbChhLCBiLCBjLCBkKTt9ZnVuY3Rpb24gYmooYSkge2EgPSBhLnByb3RvdHlwZTtyZXR1cm4gISghYSB8fCAhYS5pc1JlYWN0Q29tcG9uZW50KTt9CiAgICAgICAgICBmdW5jdGlvbiAkayhhKSB7aWYgKCJmdW5jdGlvbiIgPT09IHR5cGVvZiBhKSByZXR1cm4gYmooYSkgPyAxIDogMDtpZiAodm9pZCAwICE9PSBhICYmIG51bGwgIT09IGEpIHthID0gYS4kJHR5cGVvZjtpZiAoYSA9PT0gRGEpIHJldHVybiAxMTtpZiAoYSA9PT0gR2EpIHJldHVybiAxNDt9cmV0dXJuIDI7fQogICAgICAgICAgZnVuY3Rpb24gd2goYSwgYikge3ZhciBjID0gYS5hbHRlcm5hdGU7bnVsbCA9PT0gYyA/IChjID0gQmcoYS50YWcsIGIsIGEua2V5LCBhLm1vZGUpLCBjLmVsZW1lbnRUeXBlID0gYS5lbGVtZW50VHlwZSwgYy50eXBlID0gYS50eXBlLCBjLnN0YXRlTm9kZSA9IGEuc3RhdGVOb2RlLCBjLmFsdGVybmF0ZSA9IGEsIGEuYWx0ZXJuYXRlID0gYykgOiAoYy5wZW5kaW5nUHJvcHMgPSBiLCBjLnR5cGUgPSBhLnR5cGUsIGMuZmxhZ3MgPSAwLCBjLnN1YnRyZWVGbGFncyA9IDAsIGMuZGVsZXRpb25zID0gbnVsbCk7Yy5mbGFncyA9IGEuZmxhZ3MgJiAxNDY4MDA2NDtjLmNoaWxkTGFuZXMgPSBhLmNoaWxkTGFuZXM7Yy5sYW5lcyA9IGEubGFuZXM7Yy5jaGlsZCA9IGEuY2hpbGQ7Yy5tZW1vaXplZFByb3BzID0gYS5tZW1vaXplZFByb3BzO2MubWVtb2l6ZWRTdGF0ZSA9IGEubWVtb2l6ZWRTdGF0ZTtjLnVwZGF0ZVF1ZXVlID0gYS51cGRhdGVRdWV1ZTtiID0gYS5kZXBlbmRlbmNpZXM7Yy5kZXBlbmRlbmNpZXMgPSBudWxsID09PSBiID8gbnVsbCA6IHsgbGFuZXM6IGIubGFuZXMsIGZpcnN0Q29udGV4dDogYi5maXJzdENvbnRleHQgfTsKICAgICAgICAgICAgYy5zaWJsaW5nID0gYS5zaWJsaW5nO2MuaW5kZXggPSBhLmluZGV4O2MucmVmID0gYS5yZWY7cmV0dXJuIGM7fQogICAgICAgICAgZnVuY3Rpb24geWgoYSwgYiwgYywgZCwgZSwgZikge3ZhciBnID0gMjtkID0gYTtpZiAoImZ1bmN0aW9uIiA9PT0gdHlwZW9mIGEpIGJqKGEpICYmIChnID0gMSk7ZWxzZSBpZiAoInN0cmluZyIgPT09IHR5cGVvZiBhKSBnID0gNTtlbHNlIGE6IHN3aXRjaCAoYSkge2Nhc2UgeWE6cmV0dXJuIEFoKGMuY2hpbGRyZW4sIGUsIGYsIGIpO2Nhc2UgemE6ZyA9IDg7ZSB8PSA4O2JyZWFrO2Nhc2UgQWE6cmV0dXJuIGEgPSBCZygxMiwgYywgYiwgZSB8IDIpLCBhLmVsZW1lbnRUeXBlID0gQWEsIGEubGFuZXMgPSBmLCBhO2Nhc2UgRWE6cmV0dXJuIGEgPSBCZygxMywgYywgYiwgZSksIGEuZWxlbWVudFR5cGUgPSBFYSwgYS5sYW5lcyA9IGYsIGE7Y2FzZSBGYTpyZXR1cm4gYSA9IEJnKDE5LCBjLCBiLCBlKSwgYS5lbGVtZW50VHlwZSA9IEZhLCBhLmxhbmVzID0gZiwgYTtjYXNlIElhOnJldHVybiBxaihjLCBlLCBmLCBiKTtkZWZhdWx0OmlmICgib2JqZWN0IiA9PT0gdHlwZW9mIGEgJiYgbnVsbCAhPT0gYSkgc3dpdGNoIChhLiQkdHlwZW9mKSB7Y2FzZSBCYTpnID0gMTA7YnJlYWsgYTtjYXNlIENhOmcgPSA5O2JyZWFrIGE7Y2FzZSBEYTpnID0gMTE7CiAgICAgICAgICAgICAgICAgICAgYnJlYWsgYTtjYXNlIEdhOmcgPSAxNDticmVhayBhO2Nhc2UgSGE6ZyA9IDE2O2QgPSBudWxsO2JyZWFrIGE7fXRocm93IEVycm9yKHAoMTMwLCBudWxsID09IGEgPyBhIDogdHlwZW9mIGEsICIiKSk7fWIgPSBCZyhnLCBjLCBiLCBlKTtiLmVsZW1lbnRUeXBlID0gYTtiLnR5cGUgPSBkO2IubGFuZXMgPSBmO3JldHVybiBiO31mdW5jdGlvbiBBaChhLCBiLCBjLCBkKSB7YSA9IEJnKDcsIGEsIGQsIGIpO2EubGFuZXMgPSBjO3JldHVybiBhO31mdW5jdGlvbiBxaihhLCBiLCBjLCBkKSB7YSA9IEJnKDIyLCBhLCBkLCBiKTthLmVsZW1lbnRUeXBlID0gSWE7YS5sYW5lcyA9IGM7YS5zdGF0ZU5vZGUgPSB7IGlzSGlkZGVuOiAhMSB9O3JldHVybiBhO31mdW5jdGlvbiB4aChhLCBiLCBjKSB7YSA9IEJnKDYsIGEsIG51bGwsIGIpO2EubGFuZXMgPSBjO3JldHVybiBhO30KICAgICAgICAgIGZ1bmN0aW9uIHpoKGEsIGIsIGMpIHtiID0gQmcoNCwgbnVsbCAhPT0gYS5jaGlsZHJlbiA/IGEuY2hpbGRyZW4gOiBbXSwgYS5rZXksIGIpO2IubGFuZXMgPSBjO2Iuc3RhdGVOb2RlID0geyBjb250YWluZXJJbmZvOiBhLmNvbnRhaW5lckluZm8sIHBlbmRpbmdDaGlsZHJlbjogbnVsbCwgaW1wbGVtZW50YXRpb246IGEuaW1wbGVtZW50YXRpb24gfTtyZXR1cm4gYjt9CiAgICAgICAgICBmdW5jdGlvbiBibChhLCBiLCBjLCBkLCBlKSB7dGhpcy50YWcgPSBiO3RoaXMuY29udGFpbmVySW5mbyA9IGE7dGhpcy5maW5pc2hlZFdvcmsgPSB0aGlzLnBpbmdDYWNoZSA9IHRoaXMuY3VycmVudCA9IHRoaXMucGVuZGluZ0NoaWxkcmVuID0gbnVsbDt0aGlzLnRpbWVvdXRIYW5kbGUgPSAtMTt0aGlzLmNhbGxiYWNrTm9kZSA9IHRoaXMucGVuZGluZ0NvbnRleHQgPSB0aGlzLmNvbnRleHQgPSBudWxsO3RoaXMuY2FsbGJhY2tQcmlvcml0eSA9IDA7dGhpcy5ldmVudFRpbWVzID0gemMoMCk7dGhpcy5leHBpcmF0aW9uVGltZXMgPSB6YygtMSk7dGhpcy5lbnRhbmdsZWRMYW5lcyA9IHRoaXMuZmluaXNoZWRMYW5lcyA9IHRoaXMubXV0YWJsZVJlYWRMYW5lcyA9IHRoaXMuZXhwaXJlZExhbmVzID0gdGhpcy5waW5nZWRMYW5lcyA9IHRoaXMuc3VzcGVuZGVkTGFuZXMgPSB0aGlzLnBlbmRpbmdMYW5lcyA9IDA7dGhpcy5lbnRhbmdsZW1lbnRzID0gemMoMCk7dGhpcy5pZGVudGlmaWVyUHJlZml4ID0gZDt0aGlzLm9uUmVjb3ZlcmFibGVFcnJvciA9IGU7dGhpcy5tdXRhYmxlU291cmNlRWFnZXJIeWRyYXRpb25EYXRhID0KICAgICAgICAgICAgbnVsbDt9ZnVuY3Rpb24gY2woYSwgYiwgYywgZCwgZSwgZiwgZywgaCwgaykge2EgPSBuZXcgYmwoYSwgYiwgYywgaCwgayk7MSA9PT0gYiA/IChiID0gMSwgITAgPT09IGYgJiYgKGIgfD0gOCkpIDogYiA9IDA7ZiA9IEJnKDMsIG51bGwsIG51bGwsIGIpO2EuY3VycmVudCA9IGY7Zi5zdGF0ZU5vZGUgPSBhO2YubWVtb2l6ZWRTdGF0ZSA9IHsgZWxlbWVudDogZCwgaXNEZWh5ZHJhdGVkOiBjLCBjYWNoZTogbnVsbCwgdHJhbnNpdGlvbnM6IG51bGwsIHBlbmRpbmdTdXNwZW5zZUJvdW5kYXJpZXM6IG51bGwgfTthaChmKTtyZXR1cm4gYTt9ZnVuY3Rpb24gZGwoYSwgYiwgYykge3ZhciBkID0gMyA8IGFyZ3VtZW50cy5sZW5ndGggJiYgdm9pZCAwICE9PSBhcmd1bWVudHNbM10gPyBhcmd1bWVudHNbM10gOiBudWxsO3JldHVybiB7ICQkdHlwZW9mOiB3YSwga2V5OiBudWxsID09IGQgPyBudWxsIDogIiIgKyBkLCBjaGlsZHJlbjogYSwgY29udGFpbmVySW5mbzogYiwgaW1wbGVtZW50YXRpb246IGMgfTt9CiAgICAgICAgICBmdW5jdGlvbiBlbChhKSB7aWYgKCFhKSByZXR1cm4gVmY7YSA9IGEuX3JlYWN0SW50ZXJuYWxzO2E6IHtpZiAoVmIoYSkgIT09IGEgfHwgMSAhPT0gYS50YWcpIHRocm93IEVycm9yKHAoMTcwKSk7dmFyIGIgPSBhO2RvIHtzd2l0Y2ggKGIudGFnKSB7Y2FzZSAzOmIgPSBiLnN0YXRlTm9kZS5jb250ZXh0O2JyZWFrIGE7Y2FzZSAxOmlmIChaZihiLnR5cGUpKSB7YiA9IGIuc3RhdGVOb2RlLl9fcmVhY3RJbnRlcm5hbE1lbW9pemVkTWVyZ2VkQ2hpbGRDb250ZXh0O2JyZWFrIGE7fX1iID0gYi5yZXR1cm47fSB3aGlsZSAobnVsbCAhPT0gYik7dGhyb3cgRXJyb3IocCgxNzEpKTt9aWYgKDEgPT09IGEudGFnKSB7dmFyIGMgPSBhLnR5cGU7aWYgKFpmKGMpKSByZXR1cm4gYmcoYSwgYywgYik7fXJldHVybiBiO30KICAgICAgICAgIGZ1bmN0aW9uIGZsKGEsIGIsIGMsIGQsIGUsIGYsIGcsIGgsIGspIHthID0gY2woYywgZCwgITAsIGEsIGUsIGYsIGcsIGgsIGspO2EuY29udGV4dCA9IGVsKG51bGwpO2MgPSBhLmN1cnJlbnQ7ZCA9IEwoKTtlID0gbGgoYyk7ZiA9IGNoKGQsIGUpO2YuY2FsbGJhY2sgPSB2b2lkIDAgIT09IGIgJiYgbnVsbCAhPT0gYiA/IGIgOiBudWxsO2RoKGMsIGYsIGUpO2EuY3VycmVudC5sYW5lcyA9IGU7QWMoYSwgZSwgZCk7RWsoYSwgZCk7cmV0dXJuIGE7fWZ1bmN0aW9uIGdsKGEsIGIsIGMsIGQpIHt2YXIgZSA9IGIuY3VycmVudCxmID0gTCgpLGcgPSBsaChlKTtjID0gZWwoYyk7bnVsbCA9PT0gYi5jb250ZXh0ID8gYi5jb250ZXh0ID0gYyA6IGIucGVuZGluZ0NvbnRleHQgPSBjO2IgPSBjaChmLCBnKTtiLnBheWxvYWQgPSB7IGVsZW1lbnQ6IGEgfTtkID0gdm9pZCAwID09PSBkID8gbnVsbCA6IGQ7bnVsbCAhPT0gZCAmJiAoYi5jYWxsYmFjayA9IGQpO2EgPSBkaChlLCBiLCBnKTtudWxsICE9PSBhICYmIChtaChhLCBlLCBnLCBmKSwgZWgoYSwgZSwgZykpO3JldHVybiBnO30KICAgICAgICAgIGZ1bmN0aW9uIGhsKGEpIHthID0gYS5jdXJyZW50O2lmICghYS5jaGlsZCkgcmV0dXJuIG51bGw7c3dpdGNoIChhLmNoaWxkLnRhZykge2Nhc2UgNTpyZXR1cm4gYS5jaGlsZC5zdGF0ZU5vZGU7ZGVmYXVsdDpyZXR1cm4gYS5jaGlsZC5zdGF0ZU5vZGU7fX1mdW5jdGlvbiBpbChhLCBiKSB7YSA9IGEubWVtb2l6ZWRTdGF0ZTtpZiAobnVsbCAhPT0gYSAmJiBudWxsICE9PSBhLmRlaHlkcmF0ZWQpIHt2YXIgYyA9IGEucmV0cnlMYW5lO2EucmV0cnlMYW5lID0gMCAhPT0gYyAmJiBjIDwgYiA/IGMgOiBiO319ZnVuY3Rpb24gamwoYSwgYikge2lsKGEsIGIpOyhhID0gYS5hbHRlcm5hdGUpICYmIGlsKGEsIGIpO31mdW5jdGlvbiBrbCgpIHtyZXR1cm4gbnVsbDt9dmFyIGxsID0gImZ1bmN0aW9uIiA9PT0gdHlwZW9mIHJlcG9ydEVycm9yID8gcmVwb3J0RXJyb3IgOiBmdW5jdGlvbiAoYSkge2NvbnNvbGUuZXJyb3IoYSk7fTtmdW5jdGlvbiBtbChhKSB7dGhpcy5faW50ZXJuYWxSb290ID0gYTt9CiAgICAgICAgICBubC5wcm90b3R5cGUucmVuZGVyID0gbWwucHJvdG90eXBlLnJlbmRlciA9IGZ1bmN0aW9uIChhKSB7dmFyIGIgPSB0aGlzLl9pbnRlcm5hbFJvb3Q7aWYgKG51bGwgPT09IGIpIHRocm93IEVycm9yKHAoNDA5KSk7Z2woYSwgYiwgbnVsbCwgbnVsbCk7fTtubC5wcm90b3R5cGUudW5tb3VudCA9IG1sLnByb3RvdHlwZS51bm1vdW50ID0gZnVuY3Rpb24gKCkge3ZhciBhID0gdGhpcy5faW50ZXJuYWxSb290O2lmIChudWxsICE9PSBhKSB7dGhpcy5faW50ZXJuYWxSb290ID0gbnVsbDt2YXIgYiA9IGEuY29udGFpbmVySW5mbztTayhmdW5jdGlvbiAoKSB7Z2wobnVsbCwgYSwgbnVsbCwgbnVsbCk7fSk7Ylt1Zl0gPSBudWxsO319O2Z1bmN0aW9uIG5sKGEpIHt0aGlzLl9pbnRlcm5hbFJvb3QgPSBhO30KICAgICAgICAgIG5sLnByb3RvdHlwZS51bnN0YWJsZV9zY2hlZHVsZUh5ZHJhdGlvbiA9IGZ1bmN0aW9uIChhKSB7aWYgKGEpIHt2YXIgYiA9IEhjKCk7YSA9IHsgYmxvY2tlZE9uOiBudWxsLCB0YXJnZXQ6IGEsIHByaW9yaXR5OiBiIH07Zm9yICh2YXIgYyA9IDA7IGMgPCBRYy5sZW5ndGggJiYgMCAhPT0gYiAmJiBiIDwgUWNbY10ucHJpb3JpdHk7IGMrKyk7UWMuc3BsaWNlKGMsIDAsIGEpOzAgPT09IGMgJiYgVmMoYSk7fX07ZnVuY3Rpb24gb2woYSkge3JldHVybiAhKCFhIHx8IDEgIT09IGEubm9kZVR5cGUgJiYgOSAhPT0gYS5ub2RlVHlwZSAmJiAxMSAhPT0gYS5ub2RlVHlwZSk7fWZ1bmN0aW9uIHBsKGEpIHtyZXR1cm4gISghYSB8fCAxICE9PSBhLm5vZGVUeXBlICYmIDkgIT09IGEubm9kZVR5cGUgJiYgMTEgIT09IGEubm9kZVR5cGUgJiYgKDggIT09IGEubm9kZVR5cGUgfHwgIiByZWFjdC1tb3VudC1wb2ludC11bnN0YWJsZSAiICE9PSBhLm5vZGVWYWx1ZSkpO31mdW5jdGlvbiBxbCgpIHt9CiAgICAgICAgICBmdW5jdGlvbiBybChhLCBiLCBjLCBkLCBlKSB7aWYgKGUpIHtpZiAoImZ1bmN0aW9uIiA9PT0gdHlwZW9mIGQpIHt2YXIgZiA9IGQ7ZCA9IGZ1bmN0aW9uIGQoKSB7dmFyIGEgPSBobChnKTtmLmNhbGwoYSk7fTt9dmFyIGcgPSBmbChiLCBkLCBhLCAwLCBudWxsLCAhMSwgITEsICIiLCBxbCk7YS5fcmVhY3RSb290Q29udGFpbmVyID0gZzthW3VmXSA9IGcuY3VycmVudDtzZig4ID09PSBhLm5vZGVUeXBlID8gYS5wYXJlbnROb2RlIDogYSk7U2soKTtyZXR1cm4gZzt9Zm9yICg7IGUgPSBhLmxhc3RDaGlsZDspIGEucmVtb3ZlQ2hpbGQoZSk7aWYgKCJmdW5jdGlvbiIgPT09IHR5cGVvZiBkKSB7dmFyIGggPSBkO2QgPSBmdW5jdGlvbiBkKCkge3ZhciBhID0gaGwoayk7aC5jYWxsKGEpO307fXZhciBrID0gY2woYSwgMCwgITEsIG51bGwsIG51bGwsICExLCAhMSwgIiIsIHFsKTthLl9yZWFjdFJvb3RDb250YWluZXIgPSBrO2FbdWZdID0gay5jdXJyZW50O3NmKDggPT09IGEubm9kZVR5cGUgPyBhLnBhcmVudE5vZGUgOiBhKTtTayhmdW5jdGlvbiAoKSB7Z2woYiwgaywgYywgZCk7fSk7cmV0dXJuIGs7fQogICAgICAgICAgZnVuY3Rpb24gc2woYSwgYiwgYywgZCwgZSkge3ZhciBmID0gYy5fcmVhY3RSb290Q29udGFpbmVyO2lmIChmKSB7dmFyIGcgPSBmO2lmICgiZnVuY3Rpb24iID09PSB0eXBlb2YgZSkge3ZhciBoID0gZTtlID0gZnVuY3Rpb24gZSgpIHt2YXIgYSA9IGhsKGcpO2guY2FsbChhKTt9O31nbChiLCBnLCBhLCBlKTt9IGVsc2UgZyA9IHJsKGMsIGIsIGEsIGUsIGQpO3JldHVybiBobChnKTt9RWMgPSBmdW5jdGlvbiBFYyhhKSB7c3dpdGNoIChhLnRhZykge2Nhc2UgMzp2YXIgYiA9IGEuc3RhdGVOb2RlO2lmIChiLmN1cnJlbnQubWVtb2l6ZWRTdGF0ZS5pc0RlaHlkcmF0ZWQpIHt2YXIgYyA9IHRjKGIucGVuZGluZ0xhbmVzKTswICE9PSBjICYmIChDYyhiLCBjIHwgMSksIEVrKGIsIEIoKSksIDAgPT09IChLICYgNikgJiYgKEhqID0gQigpICsgNTAwLCBqZygpKSk7fWJyZWFrO2Nhc2UgMTM6U2soZnVuY3Rpb24gKCkge3ZhciBiID0gWmcoYSwgMSk7aWYgKG51bGwgIT09IGIpIHt2YXIgYyA9IEwoKTttaChiLCBhLCAxLCBjKTt9fSksIGpsKGEsIDEpO319OwogICAgICAgICAgRmMgPSBmdW5jdGlvbiBGYyhhKSB7aWYgKDEzID09PSBhLnRhZykge3ZhciBiID0gWmcoYSwgMTM0MjE3NzI4KTtpZiAobnVsbCAhPT0gYikge3ZhciBjID0gTCgpO21oKGIsIGEsIDEzNDIxNzcyOCwgYyk7fWpsKGEsIDEzNDIxNzcyOCk7fX07R2MgPSBmdW5jdGlvbiBHYyhhKSB7aWYgKDEzID09PSBhLnRhZykge3ZhciBiID0gbGgoYSksYyA9IFpnKGEsIGIpO2lmIChudWxsICE9PSBjKSB7dmFyIGQgPSBMKCk7bWgoYywgYSwgYiwgZCk7fWpsKGEsIGIpO319O0hjID0gZnVuY3Rpb24gSGMoKSB7cmV0dXJuIEM7fTtJYyA9IGZ1bmN0aW9uIEljKGEsIGIpIHt2YXIgYyA9IEM7dHJ5IHtyZXR1cm4gQyA9IGEsIGIoKTt9IGZpbmFsbHkge0MgPSBjO319OwogICAgICAgICAgeWIgPSBmdW5jdGlvbiB5YihhLCBiLCBjKSB7c3dpdGNoIChiKSB7Y2FzZSAiaW5wdXQiOmJiKGEsIGMpO2IgPSBjLm5hbWU7aWYgKCJyYWRpbyIgPT09IGMudHlwZSAmJiBudWxsICE9IGIpIHtmb3IgKGMgPSBhOyBjLnBhcmVudE5vZGU7KSBjID0gYy5wYXJlbnROb2RlO2MgPSBjLnF1ZXJ5U2VsZWN0b3JBbGwoImlucHV0W25hbWU9IiArIEpTT04uc3RyaW5naWZ5KCIiICsgYikgKyAnXVt0eXBlPSJyYWRpbyJdJyk7Zm9yIChiID0gMDsgYiA8IGMubGVuZ3RoOyBiKyspIHt2YXIgZCA9IGNbYl07aWYgKGQgIT09IGEgJiYgZC5mb3JtID09PSBhLmZvcm0pIHt2YXIgZSA9IERiKGQpO2lmICghZSkgdGhyb3cgRXJyb3IocCg5MCkpO1dhKGQpO2JiKGQsIGUpO319fWJyZWFrO2Nhc2UgInRleHRhcmVhIjppYihhLCBjKTticmVhaztjYXNlICJzZWxlY3QiOmIgPSBjLnZhbHVlLCBudWxsICE9IGIgJiYgZmIoYSwgISFjLm11bHRpcGxlLCBiLCAhMSk7fX07R2IgPSBSaztIYiA9IFNrOwogICAgICAgICAgdmFyIHRsID0geyB1c2luZ0NsaWVudEVudHJ5UG9pbnQ6ICExLCBFdmVudHM6IFtDYiwgdWUsIERiLCBFYiwgRmIsIFJrXSB9LHVsID0geyBmaW5kRmliZXJCeUhvc3RJbnN0YW5jZTogV2MsIGJ1bmRsZVR5cGU6IDAsIHZlcnNpb246ICIxOC4yLjAiLCByZW5kZXJlclBhY2thZ2VOYW1lOiAicmVhY3QtZG9tIiB9OwogICAgICAgICAgdmFyIHZsID0geyBidW5kbGVUeXBlOiB1bC5idW5kbGVUeXBlLCB2ZXJzaW9uOiB1bC52ZXJzaW9uLCByZW5kZXJlclBhY2thZ2VOYW1lOiB1bC5yZW5kZXJlclBhY2thZ2VOYW1lLCByZW5kZXJlckNvbmZpZzogdWwucmVuZGVyZXJDb25maWcsIG92ZXJyaWRlSG9va1N0YXRlOiBudWxsLCBvdmVycmlkZUhvb2tTdGF0ZURlbGV0ZVBhdGg6IG51bGwsIG92ZXJyaWRlSG9va1N0YXRlUmVuYW1lUGF0aDogbnVsbCwgb3ZlcnJpZGVQcm9wczogbnVsbCwgb3ZlcnJpZGVQcm9wc0RlbGV0ZVBhdGg6IG51bGwsIG92ZXJyaWRlUHJvcHNSZW5hbWVQYXRoOiBudWxsLCBzZXRFcnJvckhhbmRsZXI6IG51bGwsIHNldFN1c3BlbnNlSGFuZGxlcjogbnVsbCwgc2NoZWR1bGVVcGRhdGU6IG51bGwsIGN1cnJlbnREaXNwYXRjaGVyUmVmOiB1YS5SZWFjdEN1cnJlbnREaXNwYXRjaGVyLCBmaW5kSG9zdEluc3RhbmNlQnlGaWJlcjogZnVuY3Rpb24gZmluZEhvc3RJbnN0YW5jZUJ5RmliZXIoYSkge2EgPSBaYihhKTtyZXR1cm4gbnVsbCA9PT0gYSA/IG51bGwgOiBhLnN0YXRlTm9kZTt9LCBmaW5kRmliZXJCeUhvc3RJbnN0YW5jZTogdWwuZmluZEZpYmVyQnlIb3N0SW5zdGFuY2UgfHwKICAgICAgICAgICAga2wsIGZpbmRIb3N0SW5zdGFuY2VzRm9yUmVmcmVzaDogbnVsbCwgc2NoZWR1bGVSZWZyZXNoOiBudWxsLCBzY2hlZHVsZVJvb3Q6IG51bGwsIHNldFJlZnJlc2hIYW5kbGVyOiBudWxsLCBnZXRDdXJyZW50RmliZXI6IG51bGwsIHJlY29uY2lsZXJWZXJzaW9uOiAiMTguMi4wLW5leHQtOWUzYjc3MmI4LTIwMjIwNjA4IiB9O2lmICgidW5kZWZpbmVkIiAhPT0gdHlwZW9mIF9fUkVBQ1RfREVWVE9PTFNfR0xPQkFMX0hPT0tfXykge3ZhciB3bCA9IF9fUkVBQ1RfREVWVE9PTFNfR0xPQkFMX0hPT0tfXztpZiAoIXdsLmlzRGlzYWJsZWQgJiYgd2wuc3VwcG9ydHNGaWJlcikgdHJ5IHtrYyA9IHdsLmluamVjdCh2bCksIGxjID0gd2w7fSBjYXRjaCAoYSkge319ZXhwb3J0cy5fX1NFQ1JFVF9JTlRFUk5BTFNfRE9fTk9UX1VTRV9PUl9ZT1VfV0lMTF9CRV9GSVJFRCA9IHRsOwogICAgICAgICAgZXhwb3J0cy5jcmVhdGVQb3J0YWwgPSBmdW5jdGlvbiAoYSwgYikge3ZhciBjID0gMiA8IGFyZ3VtZW50cy5sZW5ndGggJiYgdm9pZCAwICE9PSBhcmd1bWVudHNbMl0gPyBhcmd1bWVudHNbMl0gOiBudWxsO2lmICghb2woYikpIHRocm93IEVycm9yKHAoMjAwKSk7cmV0dXJuIGRsKGEsIGIsIG51bGwsIGMpO307ZXhwb3J0cy5jcmVhdGVSb290ID0gZnVuY3Rpb24gKGEsIGIpIHtpZiAoIW9sKGEpKSB0aHJvdyBFcnJvcihwKDI5OSkpO3ZhciBjID0gITEsZCA9ICIiLGUgPSBsbDtudWxsICE9PSBiICYmIHZvaWQgMCAhPT0gYiAmJiAoITAgPT09IGIudW5zdGFibGVfc3RyaWN0TW9kZSAmJiAoYyA9ICEwKSwgdm9pZCAwICE9PSBiLmlkZW50aWZpZXJQcmVmaXggJiYgKGQgPSBiLmlkZW50aWZpZXJQcmVmaXgpLCB2b2lkIDAgIT09IGIub25SZWNvdmVyYWJsZUVycm9yICYmIChlID0gYi5vblJlY292ZXJhYmxlRXJyb3IpKTtiID0gY2woYSwgMSwgITEsIG51bGwsIG51bGwsIGMsICExLCBkLCBlKTthW3VmXSA9IGIuY3VycmVudDtzZig4ID09PSBhLm5vZGVUeXBlID8gYS5wYXJlbnROb2RlIDogYSk7cmV0dXJuIG5ldyBtbChiKTt9OwogICAgICAgICAgZXhwb3J0cy5maW5kRE9NTm9kZSA9IGZ1bmN0aW9uIChhKSB7aWYgKG51bGwgPT0gYSkgcmV0dXJuIG51bGw7aWYgKDEgPT09IGEubm9kZVR5cGUpIHJldHVybiBhO3ZhciBiID0gYS5fcmVhY3RJbnRlcm5hbHM7aWYgKHZvaWQgMCA9PT0gYikge2lmICgiZnVuY3Rpb24iID09PSB0eXBlb2YgYS5yZW5kZXIpIHRocm93IEVycm9yKHAoMTg4KSk7YSA9IE9iamVjdC5rZXlzKGEpLmpvaW4oIiwiKTt0aHJvdyBFcnJvcihwKDI2OCwgYSkpO31hID0gWmIoYik7YSA9IG51bGwgPT09IGEgPyBudWxsIDogYS5zdGF0ZU5vZGU7cmV0dXJuIGE7fTtleHBvcnRzLmZsdXNoU3luYyA9IGZ1bmN0aW9uIChhKSB7cmV0dXJuIFNrKGEpO307ZXhwb3J0cy5oeWRyYXRlID0gZnVuY3Rpb24gKGEsIGIsIGMpIHtpZiAoIXBsKGIpKSB0aHJvdyBFcnJvcihwKDIwMCkpO3JldHVybiBzbChudWxsLCBhLCBiLCAhMCwgYyk7fTsKICAgICAgICAgIGV4cG9ydHMuaHlkcmF0ZVJvb3QgPSBmdW5jdGlvbiAoYSwgYiwgYykge2lmICghb2woYSkpIHRocm93IEVycm9yKHAoNDA1KSk7dmFyIGQgPSBudWxsICE9IGMgJiYgYy5oeWRyYXRlZFNvdXJjZXMgfHwgbnVsbCxlID0gITEsZiA9ICIiLGcgPSBsbDtudWxsICE9PSBjICYmIHZvaWQgMCAhPT0gYyAmJiAoITAgPT09IGMudW5zdGFibGVfc3RyaWN0TW9kZSAmJiAoZSA9ICEwKSwgdm9pZCAwICE9PSBjLmlkZW50aWZpZXJQcmVmaXggJiYgKGYgPSBjLmlkZW50aWZpZXJQcmVmaXgpLCB2b2lkIDAgIT09IGMub25SZWNvdmVyYWJsZUVycm9yICYmIChnID0gYy5vblJlY292ZXJhYmxlRXJyb3IpKTtiID0gZmwoYiwgbnVsbCwgYSwgMSwgbnVsbCAhPSBjID8gYyA6IG51bGwsIGUsICExLCBmLCBnKTthW3VmXSA9IGIuY3VycmVudDtzZihhKTtpZiAoZCkgZm9yIChhID0gMDsgYSA8IGQubGVuZ3RoOyBhKyspIGMgPSBkW2FdLCBlID0gYy5fZ2V0VmVyc2lvbiwgZSA9IGUoYy5fc291cmNlKSwgbnVsbCA9PSBiLm11dGFibGVTb3VyY2VFYWdlckh5ZHJhdGlvbkRhdGEgPyBiLm11dGFibGVTb3VyY2VFYWdlckh5ZHJhdGlvbkRhdGEgPSBbYywgZV0gOiBiLm11dGFibGVTb3VyY2VFYWdlckh5ZHJhdGlvbkRhdGEucHVzaChjLAogICAgICAgICAgICBlKTtyZXR1cm4gbmV3IG5sKGIpO307ZXhwb3J0cy5yZW5kZXIgPSBmdW5jdGlvbiAoYSwgYiwgYykge2lmICghcGwoYikpIHRocm93IEVycm9yKHAoMjAwKSk7cmV0dXJuIHNsKG51bGwsIGEsIGIsICExLCBjKTt9O2V4cG9ydHMudW5tb3VudENvbXBvbmVudEF0Tm9kZSA9IGZ1bmN0aW9uIChhKSB7aWYgKCFwbChhKSkgdGhyb3cgRXJyb3IocCg0MCkpO3JldHVybiBhLl9yZWFjdFJvb3RDb250YWluZXIgPyAoU2soZnVuY3Rpb24gKCkge3NsKG51bGwsIG51bGwsIGEsICExLCBmdW5jdGlvbiAoKSB7YS5fcmVhY3RSb290Q29udGFpbmVyID0gbnVsbDthW3VmXSA9IG51bGw7fSk7fSksICEwKSA6ICExO307ZXhwb3J0cy51bnN0YWJsZV9iYXRjaGVkVXBkYXRlcyA9IFJrOwogICAgICAgICAgZXhwb3J0cy51bnN0YWJsZV9yZW5kZXJTdWJ0cmVlSW50b0NvbnRhaW5lciA9IGZ1bmN0aW9uIChhLCBiLCBjLCBkKSB7aWYgKCFwbChjKSkgdGhyb3cgRXJyb3IocCgyMDApKTtpZiAobnVsbCA9PSBhIHx8IHZvaWQgMCA9PT0gYS5fcmVhY3RJbnRlcm5hbHMpIHRocm93IEVycm9yKHAoMzgpKTtyZXR1cm4gc2woYSwgYiwgYywgITEsIGQpO307ZXhwb3J0cy52ZXJzaW9uID0gIjE4LjIuMC1uZXh0LTllM2I3NzJiOC0yMDIyMDYwOCI7CgoKICAgICAgICAgIC8qKiovfSwKCiAgICAgICAgLyoqKi83NDU6CiAgICAgICAgLyoqKi8oX191bnVzZWRfd2VicGFja19tb2R1bGUsIGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pID0+IHsKCiAgICAgICAgICB2YXIgX193ZWJwYWNrX3VudXNlZF9leHBvcnRfXzsKCgogICAgICAgICAgdmFyIG0gPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDkzNSk7CiAgICAgICAgICBpZiAodHJ1ZSkgewogICAgICAgICAgICBleHBvcnRzLnMgPSBtLmNyZWF0ZVJvb3Q7CiAgICAgICAgICAgIF9fd2VicGFja191bnVzZWRfZXhwb3J0X18gPSBtLmh5ZHJhdGVSb290OwogICAgICAgICAgfSBlbHNlIHt2YXIgaTt9CgoKICAgICAgICAgIC8qKiovfSwKCiAgICAgICAgLyoqKi85MzU6CiAgICAgICAgLyoqKi8obW9kdWxlLCBfX3VudXNlZF93ZWJwYWNrX2V4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pID0+IHsKCgoKICAgICAgICAgIGZ1bmN0aW9uIGNoZWNrRENFKCkgewogICAgICAgICAgICAvKiBnbG9iYWwgX19SRUFDVF9ERVZUT09MU19HTE9CQUxfSE9PS19fICovCiAgICAgICAgICAgIGlmICgKICAgICAgICAgICAgdHlwZW9mIF9fUkVBQ1RfREVWVE9PTFNfR0xPQkFMX0hPT0tfXyA9PT0gJ3VuZGVmaW5lZCcgfHwKICAgICAgICAgICAgdHlwZW9mIF9fUkVBQ1RfREVWVE9PTFNfR0xPQkFMX0hPT0tfXy5jaGVja0RDRSAhPT0gJ2Z1bmN0aW9uJykKICAgICAgICAgICAgewogICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoZmFsc2UpIHt9CiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgLy8gVmVyaWZ5IHRoYXQgdGhlIGNvZGUgYWJvdmUgaGFzIGJlZW4gZGVhZCBjb2RlIGVsaW1pbmF0ZWQgKERDRSdkKS4KICAgICAgICAgICAgICBfX1JFQUNUX0RFVlRPT0xTX0dMT0JBTF9IT09LX18uY2hlY2tEQ0UoY2hlY2tEQ0UpOwogICAgICAgICAgICB9IGNhdGNoIChlcnIpIHsKICAgICAgICAgICAgICAvLyBEZXZUb29scyBzaG91bGRuJ3QgY3Jhc2ggUmVhY3QsIG5vIG1hdHRlciB3aGF0LgogICAgICAgICAgICAgIC8vIFdlIHNob3VsZCBzdGlsbCByZXBvcnQgaW4gY2FzZSB3ZSBicmVhayB0aGlzIGNvZGUuCiAgICAgICAgICAgICAgY29uc29sZS5lcnJvcihlcnIpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKHRydWUpIHsKICAgICAgICAgICAgLy8gRENFIGNoZWNrIHNob3VsZCBoYXBwZW4gYmVmb3JlIFJlYWN0RE9NIGJ1bmRsZSBleGVjdXRlcyBzbyB0aGF0CiAgICAgICAgICAgIC8vIERldlRvb2xzIGNhbiByZXBvcnQgYmFkIG1pbmlmaWNhdGlvbiBkdXJpbmcgaW5qZWN0aW9uLgogICAgICAgICAgICBjaGVja0RDRSgpOwogICAgICAgICAgICBtb2R1bGUuZXhwb3J0cyA9IF9fd2VicGFja19yZXF1aXJlX18oNDQ4KTsKICAgICAgICAgIH0gZWxzZSB7fQoKCiAgICAgICAgICAvKioqL30sCgogICAgICAgIC8qKiovNDA4OgogICAgICAgIC8qKiovKF9fdW51c2VkX3dlYnBhY2tfbW9kdWxlLCBleHBvcnRzKSA9PiB7CgogICAgICAgICAgLyoqCiAgICAgICAgICAgKiBAbGljZW5zZSBSZWFjdAogICAgICAgICAgICogcmVhY3QucHJvZHVjdGlvbi5taW4uanMKICAgICAgICAgICAqCiAgICAgICAgICAgKiBDb3B5cmlnaHQgKGMpIEZhY2Vib29rLCBJbmMuIGFuZCBpdHMgYWZmaWxpYXRlcy4KICAgICAgICAgICAqCiAgICAgICAgICAgKiBUaGlzIHNvdXJjZSBjb2RlIGlzIGxpY2Vuc2VkIHVuZGVyIHRoZSBNSVQgbGljZW5zZSBmb3VuZCBpbiB0aGUKICAgICAgICAgICAqIExJQ0VOU0UgZmlsZSBpbiB0aGUgcm9vdCBkaXJlY3Rvcnkgb2YgdGhpcyBzb3VyY2UgdHJlZS4KICAgICAgICAgICAqLwogICAgICAgICAgdmFyIGwgPSBTeW1ib2wuZm9yKCJyZWFjdC5lbGVtZW50IiksbiA9IFN5bWJvbC5mb3IoInJlYWN0LnBvcnRhbCIpLHAgPSBTeW1ib2wuZm9yKCJyZWFjdC5mcmFnbWVudCIpLHEgPSBTeW1ib2wuZm9yKCJyZWFjdC5zdHJpY3RfbW9kZSIpLHIgPSBTeW1ib2wuZm9yKCJyZWFjdC5wcm9maWxlciIpLHQgPSBTeW1ib2wuZm9yKCJyZWFjdC5wcm92aWRlciIpLHUgPSBTeW1ib2wuZm9yKCJyZWFjdC5jb250ZXh0IiksdiA9IFN5bWJvbC5mb3IoInJlYWN0LmZvcndhcmRfcmVmIiksdyA9IFN5bWJvbC5mb3IoInJlYWN0LnN1c3BlbnNlIikseCA9IFN5bWJvbC5mb3IoInJlYWN0Lm1lbW8iKSx5ID0gU3ltYm9sLmZvcigicmVhY3QubGF6eSIpLHogPSBTeW1ib2wuaXRlcmF0b3I7ZnVuY3Rpb24gQShhKSB7aWYgKG51bGwgPT09IGEgfHwgIm9iamVjdCIgIT09IHR5cGVvZiBhKSByZXR1cm4gbnVsbDthID0geiAmJiBhW3pdIHx8IGFbIkBAaXRlcmF0b3IiXTtyZXR1cm4gImZ1bmN0aW9uIiA9PT0gdHlwZW9mIGEgPyBhIDogbnVsbDt9CiAgICAgICAgICB2YXIgQiA9IHsgaXNNb3VudGVkOiBmdW5jdGlvbiBpc01vdW50ZWQoKSB7cmV0dXJuICExO30sIGVucXVldWVGb3JjZVVwZGF0ZTogZnVuY3Rpb24gZW5xdWV1ZUZvcmNlVXBkYXRlKCkge30sIGVucXVldWVSZXBsYWNlU3RhdGU6IGZ1bmN0aW9uIGVucXVldWVSZXBsYWNlU3RhdGUoKSB7fSwgZW5xdWV1ZVNldFN0YXRlOiBmdW5jdGlvbiBlbnF1ZXVlU2V0U3RhdGUoKSB7fSB9LEMgPSBPYmplY3QuYXNzaWduLEQgPSB7fTtmdW5jdGlvbiBFKGEsIGIsIGUpIHt0aGlzLnByb3BzID0gYTt0aGlzLmNvbnRleHQgPSBiO3RoaXMucmVmcyA9IEQ7dGhpcy51cGRhdGVyID0gZSB8fCBCO31FLnByb3RvdHlwZS5pc1JlYWN0Q29tcG9uZW50ID0ge307CiAgICAgICAgICBFLnByb3RvdHlwZS5zZXRTdGF0ZSA9IGZ1bmN0aW9uIChhLCBiKSB7aWYgKCJvYmplY3QiICE9PSB0eXBlb2YgYSAmJiAiZnVuY3Rpb24iICE9PSB0eXBlb2YgYSAmJiBudWxsICE9IGEpIHRocm93IEVycm9yKCJzZXRTdGF0ZSguLi4pOiB0YWtlcyBhbiBvYmplY3Qgb2Ygc3RhdGUgdmFyaWFibGVzIHRvIHVwZGF0ZSBvciBhIGZ1bmN0aW9uIHdoaWNoIHJldHVybnMgYW4gb2JqZWN0IG9mIHN0YXRlIHZhcmlhYmxlcy4iKTt0aGlzLnVwZGF0ZXIuZW5xdWV1ZVNldFN0YXRlKHRoaXMsIGEsIGIsICJzZXRTdGF0ZSIpO307RS5wcm90b3R5cGUuZm9yY2VVcGRhdGUgPSBmdW5jdGlvbiAoYSkge3RoaXMudXBkYXRlci5lbnF1ZXVlRm9yY2VVcGRhdGUodGhpcywgYSwgImZvcmNlVXBkYXRlIik7fTtmdW5jdGlvbiBGKCkge31GLnByb3RvdHlwZSA9IEUucHJvdG90eXBlO2Z1bmN0aW9uIEcoYSwgYiwgZSkge3RoaXMucHJvcHMgPSBhO3RoaXMuY29udGV4dCA9IGI7dGhpcy5yZWZzID0gRDt0aGlzLnVwZGF0ZXIgPSBlIHx8IEI7fXZhciBIID0gRy5wcm90b3R5cGUgPSBuZXcgRigpOwogICAgICAgICAgSC5jb25zdHJ1Y3RvciA9IEc7QyhILCBFLnByb3RvdHlwZSk7SC5pc1B1cmVSZWFjdENvbXBvbmVudCA9ICEwO3ZhciBJID0gQXJyYXkuaXNBcnJheSxKID0gT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eSxLID0geyBjdXJyZW50OiBudWxsIH0sTCA9IHsga2V5OiAhMCwgcmVmOiAhMCwgX19zZWxmOiAhMCwgX19zb3VyY2U6ICEwIH07CiAgICAgICAgICBmdW5jdGlvbiBNKGEsIGIsIGUpIHt2YXIgZCxjID0ge30sayA9IG51bGwsaCA9IG51bGw7aWYgKG51bGwgIT0gYikgZm9yIChkIGluIHZvaWQgMCAhPT0gYi5yZWYgJiYgKGggPSBiLnJlZiksIHZvaWQgMCAhPT0gYi5rZXkgJiYgKGsgPSAiIiArIGIua2V5KSwgYikgSi5jYWxsKGIsIGQpICYmICFMLmhhc093blByb3BlcnR5KGQpICYmIChjW2RdID0gYltkXSk7dmFyIGcgPSBhcmd1bWVudHMubGVuZ3RoIC0gMjtpZiAoMSA9PT0gZykgYy5jaGlsZHJlbiA9IGU7ZWxzZSBpZiAoMSA8IGcpIHtmb3IgKHZhciBmID0gQXJyYXkoZyksIG0gPSAwOyBtIDwgZzsgbSsrKSBmW21dID0gYXJndW1lbnRzW20gKyAyXTtjLmNoaWxkcmVuID0gZjt9aWYgKGEgJiYgYS5kZWZhdWx0UHJvcHMpIGZvciAoZCBpbiBnID0gYS5kZWZhdWx0UHJvcHMsIGcpIHZvaWQgMCA9PT0gY1tkXSAmJiAoY1tkXSA9IGdbZF0pO3JldHVybiB7ICQkdHlwZW9mOiBsLCB0eXBlOiBhLCBrZXk6IGssIHJlZjogaCwgcHJvcHM6IGMsIF9vd25lcjogSy5jdXJyZW50IH07fQogICAgICAgICAgZnVuY3Rpb24gTihhLCBiKSB7cmV0dXJuIHsgJCR0eXBlb2Y6IGwsIHR5cGU6IGEudHlwZSwga2V5OiBiLCByZWY6IGEucmVmLCBwcm9wczogYS5wcm9wcywgX293bmVyOiBhLl9vd25lciB9O31mdW5jdGlvbiBPKGEpIHtyZXR1cm4gIm9iamVjdCIgPT09IHR5cGVvZiBhICYmIG51bGwgIT09IGEgJiYgYS4kJHR5cGVvZiA9PT0gbDt9ZnVuY3Rpb24gZXNjYXBlKGEpIHt2YXIgYiA9IHsgIj0iOiAiPTAiLCAiOiI6ICI9MiIgfTtyZXR1cm4gIiQiICsgYS5yZXBsYWNlKC9bPTpdL2csIGZ1bmN0aW9uIChhKSB7cmV0dXJuIGJbYV07fSk7fXZhciBQID0gL1wvKy9nO2Z1bmN0aW9uIFEoYSwgYikge3JldHVybiAib2JqZWN0IiA9PT0gdHlwZW9mIGEgJiYgbnVsbCAhPT0gYSAmJiBudWxsICE9IGEua2V5ID8gZXNjYXBlKCIiICsgYS5rZXkpIDogYi50b1N0cmluZygzNik7fQogICAgICAgICAgZnVuY3Rpb24gUihhLCBiLCBlLCBkLCBjKSB7dmFyIGsgPSB0eXBlb2YgYTtpZiAoInVuZGVmaW5lZCIgPT09IGsgfHwgImJvb2xlYW4iID09PSBrKSBhID0gbnVsbDt2YXIgaCA9ICExO2lmIChudWxsID09PSBhKSBoID0gITA7ZWxzZSBzd2l0Y2ggKGspIHtjYXNlICJzdHJpbmciOmNhc2UgIm51bWJlciI6aCA9ICEwO2JyZWFrO2Nhc2UgIm9iamVjdCI6c3dpdGNoIChhLiQkdHlwZW9mKSB7Y2FzZSBsOmNhc2UgbjpoID0gITA7fX1pZiAoaCkgcmV0dXJuIGggPSBhLCBjID0gYyhoKSwgYSA9ICIiID09PSBkID8gIi4iICsgUShoLCAwKSA6IGQsIEkoYykgPyAoZSA9ICIiLCBudWxsICE9IGEgJiYgKGUgPSBhLnJlcGxhY2UoUCwgIiQmLyIpICsgIi8iKSwgUihjLCBiLCBlLCAiIiwgZnVuY3Rpb24gKGEpIHtyZXR1cm4gYTt9KSkgOiBudWxsICE9IGMgJiYgKE8oYykgJiYgKGMgPSBOKGMsIGUgKyAoIWMua2V5IHx8IGggJiYgaC5rZXkgPT09IGMua2V5ID8gIiIgOiAoIiIgKyBjLmtleSkucmVwbGFjZShQLCAiJCYvIikgKyAiLyIpICsgYSkpLCBiLnB1c2goYykpLCAxO2ggPSAwO2QgPSAiIiA9PT0gZCA/ICIuIiA6IGQgKyAiOiI7aWYgKEkoYSkpIGZvciAodmFyIGcgPSAwOyBnIDwgYS5sZW5ndGg7IGcrKykge2sgPQogICAgICAgICAgICAgIGFbZ107dmFyIGYgPSBkICsgUShrLCBnKTtoICs9IFIoaywgYiwgZSwgZiwgYyk7fSBlbHNlIGlmIChmID0gQShhKSwgImZ1bmN0aW9uIiA9PT0gdHlwZW9mIGYpIGZvciAoYSA9IGYuY2FsbChhKSwgZyA9IDA7ICEoayA9IGEubmV4dCgpKS5kb25lOykgayA9IGsudmFsdWUsIGYgPSBkICsgUShrLCBnKyspLCBoICs9IFIoaywgYiwgZSwgZiwgYyk7ZWxzZSBpZiAoIm9iamVjdCIgPT09IGspIHRocm93IGIgPSBTdHJpbmcoYSksIEVycm9yKCJPYmplY3RzIGFyZSBub3QgdmFsaWQgYXMgYSBSZWFjdCBjaGlsZCAoZm91bmQ6ICIgKyAoIltvYmplY3QgT2JqZWN0XSIgPT09IGIgPyAib2JqZWN0IHdpdGgga2V5cyB7IiArIE9iamVjdC5rZXlzKGEpLmpvaW4oIiwgIikgKyAifSIgOiBiKSArICIpLiBJZiB5b3UgbWVhbnQgdG8gcmVuZGVyIGEgY29sbGVjdGlvbiBvZiBjaGlsZHJlbiwgdXNlIGFuIGFycmF5IGluc3RlYWQuIik7cmV0dXJuIGg7fQogICAgICAgICAgZnVuY3Rpb24gUyhhLCBiLCBlKSB7aWYgKG51bGwgPT0gYSkgcmV0dXJuIGE7dmFyIGQgPSBbXSxjID0gMDtSKGEsIGQsICIiLCAiIiwgZnVuY3Rpb24gKGEpIHtyZXR1cm4gYi5jYWxsKGUsIGEsIGMrKyk7fSk7cmV0dXJuIGQ7fWZ1bmN0aW9uIFQoYSkge2lmICgtMSA9PT0gYS5fc3RhdHVzKSB7dmFyIGIgPSBhLl9yZXN1bHQ7YiA9IGIoKTtiLnRoZW4oZnVuY3Rpb24gKGIpIHtpZiAoMCA9PT0gYS5fc3RhdHVzIHx8IC0xID09PSBhLl9zdGF0dXMpIGEuX3N0YXR1cyA9IDEsIGEuX3Jlc3VsdCA9IGI7fSwgZnVuY3Rpb24gKGIpIHtpZiAoMCA9PT0gYS5fc3RhdHVzIHx8IC0xID09PSBhLl9zdGF0dXMpIGEuX3N0YXR1cyA9IDIsIGEuX3Jlc3VsdCA9IGI7fSk7LTEgPT09IGEuX3N0YXR1cyAmJiAoYS5fc3RhdHVzID0gMCwgYS5fcmVzdWx0ID0gYik7fWlmICgxID09PSBhLl9zdGF0dXMpIHJldHVybiBhLl9yZXN1bHQuZGVmYXVsdDt0aHJvdyBhLl9yZXN1bHQ7fQogICAgICAgICAgdmFyIFUgPSB7IGN1cnJlbnQ6IG51bGwgfSxWID0geyB0cmFuc2l0aW9uOiBudWxsIH0sVyA9IHsgUmVhY3RDdXJyZW50RGlzcGF0Y2hlcjogVSwgUmVhY3RDdXJyZW50QmF0Y2hDb25maWc6IFYsIFJlYWN0Q3VycmVudE93bmVyOiBLIH07ZXhwb3J0cy5DaGlsZHJlbiA9IHsgbWFwOiBTLCBmb3JFYWNoOiBmdW5jdGlvbiBmb3JFYWNoKGEsIGIsIGUpIHtTKGEsIGZ1bmN0aW9uICgpIHtiLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7fSwgZSk7fSwgY291bnQ6IGZ1bmN0aW9uIGNvdW50KGEpIHt2YXIgYiA9IDA7UyhhLCBmdW5jdGlvbiAoKSB7YisrO30pO3JldHVybiBiO30sIHRvQXJyYXk6IGZ1bmN0aW9uIHRvQXJyYXkoYSkge3JldHVybiBTKGEsIGZ1bmN0aW9uIChhKSB7cmV0dXJuIGE7fSkgfHwgW107fSwgb25seTogZnVuY3Rpb24gb25seShhKSB7aWYgKCFPKGEpKSB0aHJvdyBFcnJvcigiUmVhY3QuQ2hpbGRyZW4ub25seSBleHBlY3RlZCB0byByZWNlaXZlIGEgc2luZ2xlIFJlYWN0IGVsZW1lbnQgY2hpbGQuIik7cmV0dXJuIGE7fSB9O2V4cG9ydHMuQ29tcG9uZW50ID0gRTtleHBvcnRzLkZyYWdtZW50ID0gcDsKICAgICAgICAgIGV4cG9ydHMuUHJvZmlsZXIgPSByO2V4cG9ydHMuUHVyZUNvbXBvbmVudCA9IEc7ZXhwb3J0cy5TdHJpY3RNb2RlID0gcTtleHBvcnRzLlN1c3BlbnNlID0gdztleHBvcnRzLl9fU0VDUkVUX0lOVEVSTkFMU19ET19OT1RfVVNFX09SX1lPVV9XSUxMX0JFX0ZJUkVEID0gVzsKICAgICAgICAgIGV4cG9ydHMuY2xvbmVFbGVtZW50ID0gZnVuY3Rpb24gKGEsIGIsIGUpIHtpZiAobnVsbCA9PT0gYSB8fCB2b2lkIDAgPT09IGEpIHRocm93IEVycm9yKCJSZWFjdC5jbG9uZUVsZW1lbnQoLi4uKTogVGhlIGFyZ3VtZW50IG11c3QgYmUgYSBSZWFjdCBlbGVtZW50LCBidXQgeW91IHBhc3NlZCAiICsgYSArICIuIik7dmFyIGQgPSBDKHt9LCBhLnByb3BzKSxjID0gYS5rZXksayA9IGEucmVmLGggPSBhLl9vd25lcjtpZiAobnVsbCAhPSBiKSB7dm9pZCAwICE9PSBiLnJlZiAmJiAoayA9IGIucmVmLCBoID0gSy5jdXJyZW50KTt2b2lkIDAgIT09IGIua2V5ICYmIChjID0gIiIgKyBiLmtleSk7aWYgKGEudHlwZSAmJiBhLnR5cGUuZGVmYXVsdFByb3BzKSB2YXIgZyA9IGEudHlwZS5kZWZhdWx0UHJvcHM7Zm9yIChmIGluIGIpIEouY2FsbChiLCBmKSAmJiAhTC5oYXNPd25Qcm9wZXJ0eShmKSAmJiAoZFtmXSA9IHZvaWQgMCA9PT0gYltmXSAmJiB2b2lkIDAgIT09IGcgPyBnW2ZdIDogYltmXSk7fXZhciBmID0gYXJndW1lbnRzLmxlbmd0aCAtIDI7aWYgKDEgPT09IGYpIGQuY2hpbGRyZW4gPSBlO2Vsc2UgaWYgKDEgPCBmKSB7ZyA9IEFycmF5KGYpOwogICAgICAgICAgICAgIGZvciAodmFyIG0gPSAwOyBtIDwgZjsgbSsrKSBnW21dID0gYXJndW1lbnRzW20gKyAyXTtkLmNoaWxkcmVuID0gZzt9cmV0dXJuIHsgJCR0eXBlb2Y6IGwsIHR5cGU6IGEudHlwZSwga2V5OiBjLCByZWY6IGssIHByb3BzOiBkLCBfb3duZXI6IGggfTt9O2V4cG9ydHMuY3JlYXRlQ29udGV4dCA9IGZ1bmN0aW9uIChhKSB7YSA9IHsgJCR0eXBlb2Y6IHUsIF9jdXJyZW50VmFsdWU6IGEsIF9jdXJyZW50VmFsdWUyOiBhLCBfdGhyZWFkQ291bnQ6IDAsIFByb3ZpZGVyOiBudWxsLCBDb25zdW1lcjogbnVsbCwgX2RlZmF1bHRWYWx1ZTogbnVsbCwgX2dsb2JhbE5hbWU6IG51bGwgfTthLlByb3ZpZGVyID0geyAkJHR5cGVvZjogdCwgX2NvbnRleHQ6IGEgfTtyZXR1cm4gYS5Db25zdW1lciA9IGE7fTtleHBvcnRzLmNyZWF0ZUVsZW1lbnQgPSBNO2V4cG9ydHMuY3JlYXRlRmFjdG9yeSA9IGZ1bmN0aW9uIChhKSB7dmFyIGIgPSBNLmJpbmQobnVsbCwgYSk7Yi50eXBlID0gYTtyZXR1cm4gYjt9O2V4cG9ydHMuY3JlYXRlUmVmID0gZnVuY3Rpb24gKCkge3JldHVybiB7IGN1cnJlbnQ6IG51bGwgfTt9OwogICAgICAgICAgZXhwb3J0cy5mb3J3YXJkUmVmID0gZnVuY3Rpb24gKGEpIHtyZXR1cm4geyAkJHR5cGVvZjogdiwgcmVuZGVyOiBhIH07fTtleHBvcnRzLmlzVmFsaWRFbGVtZW50ID0gTztleHBvcnRzLmxhenkgPSBmdW5jdGlvbiAoYSkge3JldHVybiB7ICQkdHlwZW9mOiB5LCBfcGF5bG9hZDogeyBfc3RhdHVzOiAtMSwgX3Jlc3VsdDogYSB9LCBfaW5pdDogVCB9O307ZXhwb3J0cy5tZW1vID0gZnVuY3Rpb24gKGEsIGIpIHtyZXR1cm4geyAkJHR5cGVvZjogeCwgdHlwZTogYSwgY29tcGFyZTogdm9pZCAwID09PSBiID8gbnVsbCA6IGIgfTt9O2V4cG9ydHMuc3RhcnRUcmFuc2l0aW9uID0gZnVuY3Rpb24gKGEpIHt2YXIgYiA9IFYudHJhbnNpdGlvbjtWLnRyYW5zaXRpb24gPSB7fTt0cnkge2EoKTt9IGZpbmFsbHkge1YudHJhbnNpdGlvbiA9IGI7fX07ZXhwb3J0cy51bnN0YWJsZV9hY3QgPSBmdW5jdGlvbiAoKSB7dGhyb3cgRXJyb3IoImFjdCguLi4pIGlzIG5vdCBzdXBwb3J0ZWQgaW4gcHJvZHVjdGlvbiBidWlsZHMgb2YgUmVhY3QuIik7fTsKICAgICAgICAgIGV4cG9ydHMudXNlQ2FsbGJhY2sgPSBmdW5jdGlvbiAoYSwgYikge3JldHVybiBVLmN1cnJlbnQudXNlQ2FsbGJhY2soYSwgYik7fTtleHBvcnRzLnVzZUNvbnRleHQgPSBmdW5jdGlvbiAoYSkge3JldHVybiBVLmN1cnJlbnQudXNlQ29udGV4dChhKTt9O2V4cG9ydHMudXNlRGVidWdWYWx1ZSA9IGZ1bmN0aW9uICgpIHt9O2V4cG9ydHMudXNlRGVmZXJyZWRWYWx1ZSA9IGZ1bmN0aW9uIChhKSB7cmV0dXJuIFUuY3VycmVudC51c2VEZWZlcnJlZFZhbHVlKGEpO307ZXhwb3J0cy51c2VFZmZlY3QgPSBmdW5jdGlvbiAoYSwgYikge3JldHVybiBVLmN1cnJlbnQudXNlRWZmZWN0KGEsIGIpO307ZXhwb3J0cy51c2VJZCA9IGZ1bmN0aW9uICgpIHtyZXR1cm4gVS5jdXJyZW50LnVzZUlkKCk7fTtleHBvcnRzLnVzZUltcGVyYXRpdmVIYW5kbGUgPSBmdW5jdGlvbiAoYSwgYiwgZSkge3JldHVybiBVLmN1cnJlbnQudXNlSW1wZXJhdGl2ZUhhbmRsZShhLCBiLCBlKTt9OwogICAgICAgICAgZXhwb3J0cy51c2VJbnNlcnRpb25FZmZlY3QgPSBmdW5jdGlvbiAoYSwgYikge3JldHVybiBVLmN1cnJlbnQudXNlSW5zZXJ0aW9uRWZmZWN0KGEsIGIpO307ZXhwb3J0cy51c2VMYXlvdXRFZmZlY3QgPSBmdW5jdGlvbiAoYSwgYikge3JldHVybiBVLmN1cnJlbnQudXNlTGF5b3V0RWZmZWN0KGEsIGIpO307ZXhwb3J0cy51c2VNZW1vID0gZnVuY3Rpb24gKGEsIGIpIHtyZXR1cm4gVS5jdXJyZW50LnVzZU1lbW8oYSwgYik7fTtleHBvcnRzLnVzZVJlZHVjZXIgPSBmdW5jdGlvbiAoYSwgYiwgZSkge3JldHVybiBVLmN1cnJlbnQudXNlUmVkdWNlcihhLCBiLCBlKTt9O2V4cG9ydHMudXNlUmVmID0gZnVuY3Rpb24gKGEpIHtyZXR1cm4gVS5jdXJyZW50LnVzZVJlZihhKTt9O2V4cG9ydHMudXNlU3RhdGUgPSBmdW5jdGlvbiAoYSkge3JldHVybiBVLmN1cnJlbnQudXNlU3RhdGUoYSk7fTtleHBvcnRzLnVzZVN5bmNFeHRlcm5hbFN0b3JlID0gZnVuY3Rpb24gKGEsIGIsIGUpIHtyZXR1cm4gVS5jdXJyZW50LnVzZVN5bmNFeHRlcm5hbFN0b3JlKGEsIGIsIGUpO307CiAgICAgICAgICBleHBvcnRzLnVzZVRyYW5zaXRpb24gPSBmdW5jdGlvbiAoKSB7cmV0dXJuIFUuY3VycmVudC51c2VUcmFuc2l0aW9uKCk7fTtleHBvcnRzLnZlcnNpb24gPSAiMTguMi4wIjsKCgogICAgICAgICAgLyoqKi99LAoKICAgICAgICAvKioqLzI5NDoKICAgICAgICAvKioqLyhtb2R1bGUsIF9fdW51c2VkX3dlYnBhY2tfZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykgPT4gewoKCgogICAgICAgICAgaWYgKHRydWUpIHsKICAgICAgICAgICAgbW9kdWxlLmV4cG9ydHMgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDQwOCk7CiAgICAgICAgICB9IGVsc2Uge30KCgogICAgICAgICAgLyoqKi99LAoKICAgICAgICAvKioqLzUzOgogICAgICAgIC8qKiovKF9fdW51c2VkX3dlYnBhY2tfbW9kdWxlLCBleHBvcnRzKSA9PiB7CgogICAgICAgICAgLyoqCiAgICAgICAgICAgKiBAbGljZW5zZSBSZWFjdAogICAgICAgICAgICogc2NoZWR1bGVyLnByb2R1Y3Rpb24ubWluLmpzCiAgICAgICAgICAgKgogICAgICAgICAgICogQ29weXJpZ2h0IChjKSBGYWNlYm9vaywgSW5jLiBhbmQgaXRzIGFmZmlsaWF0ZXMuCiAgICAgICAgICAgKgogICAgICAgICAgICogVGhpcyBzb3VyY2UgY29kZSBpcyBsaWNlbnNlZCB1bmRlciB0aGUgTUlUIGxpY2Vuc2UgZm91bmQgaW4gdGhlCiAgICAgICAgICAgKiBMSUNFTlNFIGZpbGUgaW4gdGhlIHJvb3QgZGlyZWN0b3J5IG9mIHRoaXMgc291cmNlIHRyZWUuCiAgICAgICAgICAgKi8KICAgICAgICAgIGZ1bmN0aW9uIGYoYSwgYikge3ZhciBjID0gYS5sZW5ndGg7YS5wdXNoKGIpO2E6IGZvciAoOyAwIDwgYzspIHt2YXIgZCA9IGMgLSAxID4+PiAxLGUgPSBhW2RdO2lmICgwIDwgZyhlLCBiKSkgYVtkXSA9IGIsIGFbY10gPSBlLCBjID0gZDtlbHNlIGJyZWFrIGE7fX1mdW5jdGlvbiBoKGEpIHtyZXR1cm4gMCA9PT0gYS5sZW5ndGggPyBudWxsIDogYVswXTt9ZnVuY3Rpb24gayhhKSB7aWYgKDAgPT09IGEubGVuZ3RoKSByZXR1cm4gbnVsbDt2YXIgYiA9IGFbMF0sYyA9IGEucG9wKCk7aWYgKGMgIT09IGIpIHthWzBdID0gYzthOiBmb3IgKHZhciBkID0gMCwgZSA9IGEubGVuZ3RoLCB3ID0gZSA+Pj4gMTsgZCA8IHc7KSB7dmFyIG0gPSAyICogKGQgKyAxKSAtIDEsQyA9IGFbbV0sbiA9IG0gKyAxLHggPSBhW25dO2lmICgwID4gZyhDLCBjKSkgbiA8IGUgJiYgMCA+IGcoeCwgQykgPyAoYVtkXSA9IHgsIGFbbl0gPSBjLCBkID0gbikgOiAoYVtkXSA9IEMsIGFbbV0gPSBjLCBkID0gbSk7ZWxzZSBpZiAobiA8IGUgJiYgMCA+IGcoeCwgYykpIGFbZF0gPSB4LCBhW25dID0gYywgZCA9IG47ZWxzZSBicmVhayBhO319cmV0dXJuIGI7fQogICAgICAgICAgZnVuY3Rpb24gZyhhLCBiKSB7dmFyIGMgPSBhLnNvcnRJbmRleCAtIGIuc29ydEluZGV4O3JldHVybiAwICE9PSBjID8gYyA6IGEuaWQgLSBiLmlkO31pZiAoIm9iamVjdCIgPT09IHR5cGVvZiBwZXJmb3JtYW5jZSAmJiAiZnVuY3Rpb24iID09PSB0eXBlb2YgcGVyZm9ybWFuY2Uubm93KSB7dmFyIGwgPSBwZXJmb3JtYW5jZTtleHBvcnRzLnVuc3RhYmxlX25vdyA9IGZ1bmN0aW9uICgpIHtyZXR1cm4gbC5ub3coKTt9O30gZWxzZSB7dmFyIHAgPSBEYXRlLHEgPSBwLm5vdygpO2V4cG9ydHMudW5zdGFibGVfbm93ID0gZnVuY3Rpb24gKCkge3JldHVybiBwLm5vdygpIC0gcTt9O312YXIgciA9IFtdLHQgPSBbXSx1ID0gMSx2ID0gbnVsbCx5ID0gMyx6ID0gITEsQSA9ICExLEIgPSAhMSxEID0gImZ1bmN0aW9uIiA9PT0gdHlwZW9mIHNldFRpbWVvdXQgPyBzZXRUaW1lb3V0IDogbnVsbCxFID0gImZ1bmN0aW9uIiA9PT0gdHlwZW9mIGNsZWFyVGltZW91dCA/IGNsZWFyVGltZW91dCA6IG51bGwsRiA9ICJ1bmRlZmluZWQiICE9PSB0eXBlb2Ygc2V0SW1tZWRpYXRlID8gc2V0SW1tZWRpYXRlIDogbnVsbDsKICAgICAgICAgICJ1bmRlZmluZWQiICE9PSB0eXBlb2YgbmF2aWdhdG9yICYmIHZvaWQgMCAhPT0gbmF2aWdhdG9yLnNjaGVkdWxpbmcgJiYgdm9pZCAwICE9PSBuYXZpZ2F0b3Iuc2NoZWR1bGluZy5pc0lucHV0UGVuZGluZyAmJiBuYXZpZ2F0b3Iuc2NoZWR1bGluZy5pc0lucHV0UGVuZGluZy5iaW5kKG5hdmlnYXRvci5zY2hlZHVsaW5nKTtmdW5jdGlvbiBHKGEpIHtmb3IgKHZhciBiID0gaCh0KTsgbnVsbCAhPT0gYjspIHtpZiAobnVsbCA9PT0gYi5jYWxsYmFjaykgayh0KTtlbHNlIGlmIChiLnN0YXJ0VGltZSA8PSBhKSBrKHQpLCBiLnNvcnRJbmRleCA9IGIuZXhwaXJhdGlvblRpbWUsIGYociwgYik7ZWxzZSBicmVhaztiID0gaCh0KTt9fWZ1bmN0aW9uIEgoYSkge0IgPSAhMTtHKGEpO2lmICghQSkgaWYgKG51bGwgIT09IGgocikpIEEgPSAhMCwgSShKKTtlbHNlIHt2YXIgYiA9IGgodCk7bnVsbCAhPT0gYiAmJiBLKEgsIGIuc3RhcnRUaW1lIC0gYSk7fX0KICAgICAgICAgIGZ1bmN0aW9uIEooYSwgYikge0EgPSAhMTtCICYmIChCID0gITEsIEUoTCksIEwgPSAtMSk7eiA9ICEwO3ZhciBjID0geTt0cnkge0coYik7Zm9yICh2ID0gaChyKTsgbnVsbCAhPT0gdiAmJiAoISh2LmV4cGlyYXRpb25UaW1lID4gYikgfHwgYSAmJiAhTSgpKTspIHt2YXIgZCA9IHYuY2FsbGJhY2s7aWYgKCJmdW5jdGlvbiIgPT09IHR5cGVvZiBkKSB7di5jYWxsYmFjayA9IG51bGw7eSA9IHYucHJpb3JpdHlMZXZlbDt2YXIgZSA9IGQodi5leHBpcmF0aW9uVGltZSA8PSBiKTtiID0gZXhwb3J0cy51bnN0YWJsZV9ub3coKTsiZnVuY3Rpb24iID09PSB0eXBlb2YgZSA/IHYuY2FsbGJhY2sgPSBlIDogdiA9PT0gaChyKSAmJiBrKHIpO0coYik7fSBlbHNlIGsocik7diA9IGgocik7fWlmIChudWxsICE9PSB2KSB2YXIgdyA9ICEwO2Vsc2Uge3ZhciBtID0gaCh0KTtudWxsICE9PSBtICYmIEsoSCwgbS5zdGFydFRpbWUgLSBiKTt3ID0gITE7fXJldHVybiB3O30gZmluYWxseSB7diA9IG51bGwsIHkgPSBjLCB6ID0gITE7fX12YXIgTiA9ICExLE8gPSBudWxsLEwgPSAtMSxQID0gNSxRID0gLTE7CiAgICAgICAgICBmdW5jdGlvbiBNKCkge3JldHVybiBleHBvcnRzLnVuc3RhYmxlX25vdygpIC0gUSA8IFAgPyAhMSA6ICEwO31mdW5jdGlvbiBSKCkge2lmIChudWxsICE9PSBPKSB7dmFyIGEgPSBleHBvcnRzLnVuc3RhYmxlX25vdygpO1EgPSBhO3ZhciBiID0gITA7dHJ5IHtiID0gTyghMCwgYSk7fSBmaW5hbGx5IHtiID8gUygpIDogKE4gPSAhMSwgTyA9IG51bGwpO319IGVsc2UgTiA9ICExO312YXIgUztpZiAoImZ1bmN0aW9uIiA9PT0gdHlwZW9mIEYpIFMgPSBmdW5jdGlvbiBTKCkge0YoUik7fTtlbHNlIGlmICgidW5kZWZpbmVkIiAhPT0gdHlwZW9mIE1lc3NhZ2VDaGFubmVsKSB7dmFyIFQgPSBuZXcgTWVzc2FnZUNoYW5uZWwoKSxVID0gVC5wb3J0MjtULnBvcnQxLm9ubWVzc2FnZSA9IFI7UyA9IGZ1bmN0aW9uIFMoKSB7VS5wb3N0TWVzc2FnZShudWxsKTt9O30gZWxzZSBTID0gZnVuY3Rpb24gUygpIHtEKFIsIDApO307ZnVuY3Rpb24gSShhKSB7TyA9IGE7TiB8fCAoTiA9ICEwLCBTKCkpO31mdW5jdGlvbiBLKGEsIGIpIHtMID0gRChmdW5jdGlvbiAoKSB7YShleHBvcnRzLnVuc3RhYmxlX25vdygpKTt9LCBiKTt9CiAgICAgICAgICBleHBvcnRzLnVuc3RhYmxlX0lkbGVQcmlvcml0eSA9IDU7ZXhwb3J0cy51bnN0YWJsZV9JbW1lZGlhdGVQcmlvcml0eSA9IDE7ZXhwb3J0cy51bnN0YWJsZV9Mb3dQcmlvcml0eSA9IDQ7ZXhwb3J0cy51bnN0YWJsZV9Ob3JtYWxQcmlvcml0eSA9IDM7ZXhwb3J0cy51bnN0YWJsZV9Qcm9maWxpbmcgPSBudWxsO2V4cG9ydHMudW5zdGFibGVfVXNlckJsb2NraW5nUHJpb3JpdHkgPSAyO2V4cG9ydHMudW5zdGFibGVfY2FuY2VsQ2FsbGJhY2sgPSBmdW5jdGlvbiAoYSkge2EuY2FsbGJhY2sgPSBudWxsO307ZXhwb3J0cy51bnN0YWJsZV9jb250aW51ZUV4ZWN1dGlvbiA9IGZ1bmN0aW9uICgpIHtBIHx8IHogfHwgKEEgPSAhMCwgSShKKSk7fTsKICAgICAgICAgIGV4cG9ydHMudW5zdGFibGVfZm9yY2VGcmFtZVJhdGUgPSBmdW5jdGlvbiAoYSkgezAgPiBhIHx8IDEyNSA8IGEgPyBjb25zb2xlLmVycm9yKCJmb3JjZUZyYW1lUmF0ZSB0YWtlcyBhIHBvc2l0aXZlIGludCBiZXR3ZWVuIDAgYW5kIDEyNSwgZm9yY2luZyBmcmFtZSByYXRlcyBoaWdoZXIgdGhhbiAxMjUgZnBzIGlzIG5vdCBzdXBwb3J0ZWQiKSA6IFAgPSAwIDwgYSA/IE1hdGguZmxvb3IoMUUzIC8gYSkgOiA1O307ZXhwb3J0cy51bnN0YWJsZV9nZXRDdXJyZW50UHJpb3JpdHlMZXZlbCA9IGZ1bmN0aW9uICgpIHtyZXR1cm4geTt9O2V4cG9ydHMudW5zdGFibGVfZ2V0Rmlyc3RDYWxsYmFja05vZGUgPSBmdW5jdGlvbiAoKSB7cmV0dXJuIGgocik7fTtleHBvcnRzLnVuc3RhYmxlX25leHQgPSBmdW5jdGlvbiAoYSkge3N3aXRjaCAoeSkge2Nhc2UgMTpjYXNlIDI6Y2FzZSAzOnZhciBiID0gMzticmVhaztkZWZhdWx0OmIgPSB5O312YXIgYyA9IHk7eSA9IGI7dHJ5IHtyZXR1cm4gYSgpO30gZmluYWxseSB7eSA9IGM7fX07ZXhwb3J0cy51bnN0YWJsZV9wYXVzZUV4ZWN1dGlvbiA9IGZ1bmN0aW9uICgpIHt9OwogICAgICAgICAgZXhwb3J0cy51bnN0YWJsZV9yZXF1ZXN0UGFpbnQgPSBmdW5jdGlvbiAoKSB7fTtleHBvcnRzLnVuc3RhYmxlX3J1bldpdGhQcmlvcml0eSA9IGZ1bmN0aW9uIChhLCBiKSB7c3dpdGNoIChhKSB7Y2FzZSAxOmNhc2UgMjpjYXNlIDM6Y2FzZSA0OmNhc2UgNTpicmVhaztkZWZhdWx0OmEgPSAzO312YXIgYyA9IHk7eSA9IGE7dHJ5IHtyZXR1cm4gYigpO30gZmluYWxseSB7eSA9IGM7fX07CiAgICAgICAgICBleHBvcnRzLnVuc3RhYmxlX3NjaGVkdWxlQ2FsbGJhY2sgPSBmdW5jdGlvbiAoYSwgYiwgYykge3ZhciBkID0gZXhwb3J0cy51bnN0YWJsZV9ub3coKTsib2JqZWN0IiA9PT0gdHlwZW9mIGMgJiYgbnVsbCAhPT0gYyA/IChjID0gYy5kZWxheSwgYyA9ICJudW1iZXIiID09PSB0eXBlb2YgYyAmJiAwIDwgYyA/IGQgKyBjIDogZCkgOiBjID0gZDtzd2l0Y2ggKGEpIHtjYXNlIDE6dmFyIGUgPSAtMTticmVhaztjYXNlIDI6ZSA9IDI1MDticmVhaztjYXNlIDU6ZSA9IDEwNzM3NDE4MjM7YnJlYWs7Y2FzZSA0OmUgPSAxRTQ7YnJlYWs7ZGVmYXVsdDplID0gNUUzO31lID0gYyArIGU7YSA9IHsgaWQ6IHUrKywgY2FsbGJhY2s6IGIsIHByaW9yaXR5TGV2ZWw6IGEsIHN0YXJ0VGltZTogYywgZXhwaXJhdGlvblRpbWU6IGUsIHNvcnRJbmRleDogLTEgfTtjID4gZCA/IChhLnNvcnRJbmRleCA9IGMsIGYodCwgYSksIG51bGwgPT09IGgocikgJiYgYSA9PT0gaCh0KSAmJiAoQiA/IChFKEwpLCBMID0gLTEpIDogQiA9ICEwLCBLKEgsIGMgLSBkKSkpIDogKGEuc29ydEluZGV4ID0gZSwgZihyLCBhKSwgQSB8fCB6IHx8IChBID0gITAsIEkoSikpKTtyZXR1cm4gYTt9OwogICAgICAgICAgZXhwb3J0cy51bnN0YWJsZV9zaG91bGRZaWVsZCA9IE07ZXhwb3J0cy51bnN0YWJsZV93cmFwQ2FsbGJhY2sgPSBmdW5jdGlvbiAoYSkge3ZhciBiID0geTtyZXR1cm4gZnVuY3Rpb24gKCkge3ZhciBjID0geTt5ID0gYjt0cnkge3JldHVybiBhLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7fSBmaW5hbGx5IHt5ID0gYzt9fTt9OwoKCiAgICAgICAgICAvKioqL30sCgogICAgICAgIC8qKiovODQwOgogICAgICAgIC8qKiovKG1vZHVsZSwgX191bnVzZWRfd2VicGFja19leHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKSA9PiB7CgoKCiAgICAgICAgICBpZiAodHJ1ZSkgewogICAgICAgICAgICBtb2R1bGUuZXhwb3J0cyA9IF9fd2VicGFja19yZXF1aXJlX18oNTMpOwogICAgICAgICAgfSBlbHNlIHt9CgoKICAgICAgICAgIC8qKiovfQoKICAgICAgICAvKioqKioqLyB9OwogICAgICAvKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqLwogICAgICAvKioqKioqLyAvLyBUaGUgbW9kdWxlIGNhY2hlCiAgICAgIC8qKioqKiovdmFyIF9fd2VicGFja19tb2R1bGVfY2FjaGVfXyA9IHt9OwogICAgICAvKioqKioqLwogICAgICAvKioqKioqLyAvLyBUaGUgcmVxdWlyZSBmdW5jdGlvbgogICAgICAvKioqKioqL2Z1bmN0aW9uIF9fd2VicGFja19yZXF1aXJlX18obW9kdWxlSWQpIHsKICAgICAgICAvKioqKioqLyAvLyBDaGVjayBpZiBtb2R1bGUgaXMgaW4gY2FjaGUKICAgICAgICAvKioqKioqL3ZhciBjYWNoZWRNb2R1bGUgPSBfX3dlYnBhY2tfbW9kdWxlX2NhY2hlX19bbW9kdWxlSWRdOwogICAgICAgIC8qKioqKiovaWYgKGNhY2hlZE1vZHVsZSAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAvKioqKioqL3JldHVybiBjYWNoZWRNb2R1bGUuZXhwb3J0czsKICAgICAgICAgIC8qKioqKiovfQogICAgICAgIC8qKioqKiovIC8vIENyZWF0ZSBhIG5ldyBtb2R1bGUgKGFuZCBwdXQgaXQgaW50byB0aGUgY2FjaGUpCiAgICAgICAgLyoqKioqKi92YXIgbW9kdWxlID0gX193ZWJwYWNrX21vZHVsZV9jYWNoZV9fW21vZHVsZUlkXSA9IHsKICAgICAgICAgIC8qKioqKiovIC8vIG5vIG1vZHVsZS5pZCBuZWVkZWQKICAgICAgICAgIC8qKioqKiovIC8vIG5vIG1vZHVsZS5sb2FkZWQgbmVlZGVkCiAgICAgICAgICAvKioqKioqL2V4cG9ydHM6IHt9CiAgICAgICAgICAvKioqKioqLyB9OwogICAgICAgIC8qKioqKiovCiAgICAgICAgLyoqKioqKi8gLy8gRXhlY3V0ZSB0aGUgbW9kdWxlIGZ1bmN0aW9uCiAgICAgICAgLyoqKioqKi9fX3dlYnBhY2tfbW9kdWxlc19fW21vZHVsZUlkXShtb2R1bGUsIG1vZHVsZS5leHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKTsKICAgICAgICAvKioqKioqLwogICAgICAgIC8qKioqKiovIC8vIFJldHVybiB0aGUgZXhwb3J0cyBvZiB0aGUgbW9kdWxlCiAgICAgICAgLyoqKioqKi9yZXR1cm4gbW9kdWxlLmV4cG9ydHM7CiAgICAgICAgLyoqKioqKi99CiAgICAgIC8qKioqKiovCiAgICAgIC8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovCiAgICAgIC8qKioqKiovIC8qIHdlYnBhY2svcnVudGltZS9jcmVhdGUgZmFrZSBuYW1lc3BhY2Ugb2JqZWN0ICovCiAgICAgIC8qKioqKiovKCgpID0+IHsKICAgICAgICAvKioqKioqL3ZhciBnZXRQcm90byA9IE9iamVjdC5nZXRQcm90b3R5cGVPZiA/IChvYmopID0+IE9iamVjdC5nZXRQcm90b3R5cGVPZihvYmopIDogKG9iaikgPT4gb2JqLl9fcHJvdG9fXzsKICAgICAgICAvKioqKioqL3ZhciBsZWFmUHJvdG90eXBlczsKICAgICAgICAvKioqKioqLyAvLyBjcmVhdGUgYSBmYWtlIG5hbWVzcGFjZSBvYmplY3QKICAgICAgICAvKioqKioqLyAvLyBtb2RlICYgMTogdmFsdWUgaXMgYSBtb2R1bGUgaWQsIHJlcXVpcmUgaXQKICAgICAgICAvKioqKioqLyAvLyBtb2RlICYgMjogbWVyZ2UgYWxsIHByb3BlcnRpZXMgb2YgdmFsdWUgaW50byB0aGUgbnMKICAgICAgICAvKioqKioqLyAvLyBtb2RlICYgNDogcmV0dXJuIHZhbHVlIHdoZW4gYWxyZWFkeSBucyBvYmplY3QKICAgICAgICAvKioqKioqLyAvLyBtb2RlICYgMTY6IHJldHVybiB2YWx1ZSB3aGVuIGl0J3MgUHJvbWlzZS1saWtlCiAgICAgICAgLyoqKioqKi8gLy8gbW9kZSAmIDh8MTogYmVoYXZlIGxpa2UgcmVxdWlyZQogICAgICAgIC8qKioqKiovX193ZWJwYWNrX3JlcXVpcmVfXy50ID0gZnVuY3Rpb24gKHZhbHVlLCBtb2RlKSB7CiAgICAgICAgICAvKioqKioqL2lmIChtb2RlICYgMSkgdmFsdWUgPSB0aGlzKHZhbHVlKTsKICAgICAgICAgIC8qKioqKiovaWYgKG1vZGUgJiA4KSByZXR1cm4gdmFsdWU7CiAgICAgICAgICAvKioqKioqL2lmICh0eXBlb2YgdmFsdWUgPT09ICdvYmplY3QnICYmIHZhbHVlKSB7CiAgICAgICAgICAgIC8qKioqKiovaWYgKG1vZGUgJiA0ICYmIHZhbHVlLl9fZXNNb2R1bGUpIHJldHVybiB2YWx1ZTsKICAgICAgICAgICAgLyoqKioqKi9pZiAobW9kZSAmIDE2ICYmIHR5cGVvZiB2YWx1ZS50aGVuID09PSAnZnVuY3Rpb24nKSByZXR1cm4gdmFsdWU7CiAgICAgICAgICAgIC8qKioqKiovfQogICAgICAgICAgLyoqKioqKi92YXIgbnMgPSBPYmplY3QuY3JlYXRlKG51bGwpOwogICAgICAgICAgLyoqKioqKi9fX3dlYnBhY2tfcmVxdWlyZV9fLnIobnMpOwogICAgICAgICAgLyoqKioqKi92YXIgZGVmID0ge307CiAgICAgICAgICAvKioqKioqL2xlYWZQcm90b3R5cGVzID0gbGVhZlByb3RvdHlwZXMgfHwgW251bGwsIGdldFByb3RvKHt9KSwgZ2V0UHJvdG8oW10pLCBnZXRQcm90byhnZXRQcm90byldOwogICAgICAgICAgLyoqKioqKi9mb3IgKHZhciBjdXJyZW50ID0gbW9kZSAmIDIgJiYgdmFsdWU7IHR5cGVvZiBjdXJyZW50ID09ICdvYmplY3QnICYmICF+bGVhZlByb3RvdHlwZXMuaW5kZXhPZihjdXJyZW50KTsgY3VycmVudCA9IGdldFByb3RvKGN1cnJlbnQpKSB7CiAgICAgICAgICAgIC8qKioqKiovT2JqZWN0LmdldE93blByb3BlcnR5TmFtZXMoY3VycmVudCkuZm9yRWFjaCgoa2V5KSA9PiBkZWZba2V5XSA9ICgpID0+IHZhbHVlW2tleV0pOwogICAgICAgICAgICAvKioqKioqL30KICAgICAgICAgIC8qKioqKiovZGVmWydkZWZhdWx0J10gPSAoKSA9PiB2YWx1ZTsKICAgICAgICAgIC8qKioqKiovX193ZWJwYWNrX3JlcXVpcmVfXy5kKG5zLCBkZWYpOwogICAgICAgICAgLyoqKioqKi9yZXR1cm4gbnM7CiAgICAgICAgICAvKioqKioqL307CiAgICAgICAgLyoqKioqKi99KSgpOwogICAgICAvKioqKioqLwogICAgICAvKioqKioqLyAvKiB3ZWJwYWNrL3J1bnRpbWUvZGVmaW5lIHByb3BlcnR5IGdldHRlcnMgKi8KICAgICAgLyoqKioqKi8oKCkgPT4gewogICAgICAgIC8qKioqKiovIC8vIGRlZmluZSBnZXR0ZXIgZnVuY3Rpb25zIGZvciBoYXJtb255IGV4cG9ydHMKICAgICAgICAvKioqKioqL19fd2VicGFja19yZXF1aXJlX18uZCA9IChleHBvcnRzLCBkZWZpbml0aW9uKSA9PiB7CiAgICAgICAgICAvKioqKioqL2ZvciAodmFyIGtleSBpbiBkZWZpbml0aW9uKSB7CiAgICAgICAgICAgIC8qKioqKiovaWYgKF9fd2VicGFja19yZXF1aXJlX18ubyhkZWZpbml0aW9uLCBrZXkpICYmICFfX3dlYnBhY2tfcmVxdWlyZV9fLm8oZXhwb3J0cywga2V5KSkgewogICAgICAgICAgICAgIC8qKioqKiovT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIGtleSwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGRlZmluaXRpb25ba2V5XSB9KTsKICAgICAgICAgICAgICAvKioqKioqL30KICAgICAgICAgICAgLyoqKioqKi99CiAgICAgICAgICAvKioqKioqL307CiAgICAgICAgLyoqKioqKi99KSgpOwogICAgICAvKioqKioqLwogICAgICAvKioqKioqLyAvKiB3ZWJwYWNrL3J1bnRpbWUvaGFzT3duUHJvcGVydHkgc2hvcnRoYW5kICovCiAgICAgIC8qKioqKiovKCgpID0+IHsKICAgICAgICAvKioqKioqL19fd2VicGFja19yZXF1aXJlX18ubyA9IChvYmosIHByb3ApID0+IE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChvYmosIHByb3ApOwogICAgICAgIC8qKioqKiovfSkoKTsKICAgICAgLyoqKioqKi8KICAgICAgLyoqKioqKi8gLyogd2VicGFjay9ydW50aW1lL21ha2UgbmFtZXNwYWNlIG9iamVjdCAqLwogICAgICAvKioqKioqLygoKSA9PiB7CiAgICAgICAgLyoqKioqKi8gLy8gZGVmaW5lIF9fZXNNb2R1bGUgb24gZXhwb3J0cwogICAgICAgIC8qKioqKiovX193ZWJwYWNrX3JlcXVpcmVfXy5yID0gKGV4cG9ydHMpID0+IHsKICAgICAgICAgIC8qKioqKiovaWYgKHR5cGVvZiBTeW1ib2wgIT09ICd1bmRlZmluZWQnICYmIFN5bWJvbC50b1N0cmluZ1RhZykgewogICAgICAgICAgICAvKioqKioqL09iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBTeW1ib2wudG9TdHJpbmdUYWcsIHsgdmFsdWU6ICdNb2R1bGUnIH0pOwogICAgICAgICAgICAvKioqKioqL30KICAgICAgICAgIC8qKioqKiovT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICdfX2VzTW9kdWxlJywgeyB2YWx1ZTogdHJ1ZSB9KTsKICAgICAgICAgIC8qKioqKiovfTsKICAgICAgICAvKioqKioqL30pKCk7CiAgICAgIC8qKioqKiovCiAgICAgIC8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovCiAgICAgIHZhciBfX3dlYnBhY2tfZXhwb3J0c19fID0ge307CiAgICAgIC8vIFRoaXMgZW50cnkgbmVlZCB0byBiZSB3cmFwcGVkIGluIGFuIElJRkUgYmVjYXVzZSBpdCBuZWVkIHRvIGJlIGlzb2xhdGVkIGFnYWluc3Qgb3RoZXIgbW9kdWxlcyBpbiB0aGUgY2h1bmsuCiAgICAgICgoKSA9PiB7CiAgICAgICAgX193ZWJwYWNrX3JlcXVpcmVfXy5yKF9fd2VicGFja19leHBvcnRzX18pOwogICAgICAgIC8qIGhhcm1vbnkgaW1wb3J0ICovdmFyIF9BcHBfX1dFQlBBQ0tfSU1QT1JURURfTU9EVUxFXzBfXyA9IF9fd2VicGFja19yZXF1aXJlX18oODg3KTsKICAgICAgICAvKiBoYXJtb255IGltcG9ydCAqL3ZhciByZWFjdF9kb21fY2xpZW50X19XRUJQQUNLX0lNUE9SVEVEX01PRFVMRV8xX18gPSBfX3dlYnBhY2tfcmVxdWlyZV9fKDc0NSk7CiAgICAgICAgLyogaGFybW9ueSBpbXBvcnQgKi92YXIgcmVhY3RfX1dFQlBBQ0tfSU1QT1JURURfTU9EVUxFXzJfXyA9IF9fd2VicGFja19yZXF1aXJlX18oMjk0KTsKICAgICAgICBmdW5jdGlvbiBfY3JlYXRlRm9yT2ZJdGVyYXRvckhlbHBlcihvLCBhbGxvd0FycmF5TGlrZSkge3ZhciBpdCA9IHR5cGVvZiBTeW1ib2wgIT09ICJ1bmRlZmluZWQiICYmIG9bU3ltYm9sLml0ZXJhdG9yXSB8fCBvWyJAQGl0ZXJhdG9yIl07aWYgKCFpdCkge2lmIChBcnJheS5pc0FycmF5KG8pIHx8IChpdCA9IF91bnN1cHBvcnRlZEl0ZXJhYmxlVG9BcnJheShvKSkgfHwgYWxsb3dBcnJheUxpa2UgJiYgbyAmJiB0eXBlb2Ygby5sZW5ndGggPT09ICJudW1iZXIiKSB7aWYgKGl0KSBvID0gaXQ7dmFyIGkgPSAwO3ZhciBGID0gZnVuY3Rpb24gRigpIHt9O3JldHVybiB7IHM6IEYsIG46IGZ1bmN0aW9uIG4oKSB7aWYgKGkgPj0gby5sZW5ndGgpIHJldHVybiB7IGRvbmU6IHRydWUgfTtyZXR1cm4geyBkb25lOiBmYWxzZSwgdmFsdWU6IG9baSsrXSB9O30sIGU6IGZ1bmN0aW9uIGUoX2UpIHt0aHJvdyBfZTt9LCBmOiBGIH07fXRocm93IG5ldyBUeXBlRXJyb3IoIkludmFsaWQgYXR0ZW1wdCB0byBpdGVyYXRlIG5vbi1pdGVyYWJsZSBpbnN0YW5jZS5cbkluIG9yZGVyIHRvIGJlIGl0ZXJhYmxlLCBub24tYXJyYXkgb2JqZWN0cyBtdXN0IGhhdmUgYSBbU3ltYm9sLml0ZXJhdG9yXSgpIG1ldGhvZC4iKTt9dmFyIG5vcm1hbENvbXBsZXRpb24gPSB0cnVlLGRpZEVyciA9IGZhbHNlLGVycjtyZXR1cm4geyBzOiBmdW5jdGlvbiBzKCkge2l0ID0gaXQuY2FsbChvKTt9LCBuOiBmdW5jdGlvbiBuKCkge3ZhciBzdGVwID0gaXQubmV4dCgpO25vcm1hbENvbXBsZXRpb24gPSBzdGVwLmRvbmU7cmV0dXJuIHN0ZXA7fSwgZTogZnVuY3Rpb24gZShfZTIpIHtkaWRFcnIgPSB0cnVlO2VyciA9IF9lMjt9LCBmOiBmdW5jdGlvbiBmKCkge3RyeSB7aWYgKCFub3JtYWxDb21wbGV0aW9uICYmIGl0WyJyZXR1cm4iXSAhPSBudWxsKSBpdFsicmV0dXJuIl0oKTt9IGZpbmFsbHkge2lmIChkaWRFcnIpIHRocm93IGVycjt9fSB9O31mdW5jdGlvbiBfdW5zdXBwb3J0ZWRJdGVyYWJsZVRvQXJyYXkobywgbWluTGVuKSB7aWYgKCFvKSByZXR1cm47aWYgKHR5cGVvZiBvID09PSAic3RyaW5nIikgcmV0dXJuIF9hcnJheUxpa2VUb0FycmF5KG8sIG1pbkxlbik7dmFyIG4gPSBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwobykuc2xpY2UoOCwgLTEpO2lmIChuID09PSAiT2JqZWN0IiAmJiBvLmNvbnN0cnVjdG9yKSBuID0gby5jb25zdHJ1Y3Rvci5uYW1lO2lmIChuID09PSAiTWFwIiB8fCBuID09PSAiU2V0IikgcmV0dXJuIEFycmF5LmZyb20obyk7aWYgKG4gPT09ICJBcmd1bWVudHMiIHx8IC9eKD86VWl8SSludCg/Ojh8MTZ8MzIpKD86Q2xhbXBlZCk/QXJyYXkkLy50ZXN0KG4pKSByZXR1cm4gX2FycmF5TGlrZVRvQXJyYXkobywgbWluTGVuKTt9ZnVuY3Rpb24gX2FycmF5TGlrZVRvQXJyYXkoYXJyLCBsZW4pIHtpZiAobGVuID09IG51bGwgfHwgbGVuID4gYXJyLmxlbmd0aCkgbGVuID0gYXJyLmxlbmd0aDtmb3IgKHZhciBpID0gMCwgYXJyMiA9IG5ldyBBcnJheShsZW4pOyBpIDwgbGVuOyBpKyspIGFycjJbaV0gPSBhcnJbaV07cmV0dXJuIGFycjI7fQoKCgoKCiAgICAgICAgZ2V0RGF0YShmdW5jdGlvbiAocGFnZXMpIHt2YXIgX2l0ZXJhdG9yID0gX2NyZWF0ZUZvck9mSXRlcmF0b3JIZWxwZXIoCiAgICAgICAgICAgIHBhZ2VzKSxfc3RlcDt0cnkge2ZvciAoX2l0ZXJhdG9yLnMoKTsgIShfc3RlcCA9IF9pdGVyYXRvci5uKCkpLmRvbmU7KSB7dmFyIHBhZ2UgPSBfc3RlcC52YWx1ZTsKICAgICAgICAgICAgICBmb3IgKHZhciBfaSA9IDAsIF9hcnIgPSBwYWdlLmNvbXBvbmVudHM7IF9pIDwgX2Fyci5sZW5ndGg7IF9pKyspIHt2YXIgY29tcG9uZW50ID0gX2FycltfaV07CiAgICAgICAgICAgICAgICBjb21wb25lbnQucHJldmlvdXNWYWx1ZSA9IGNvbXBvbmVudC52YWx1ZTsKCiAgICAgICAgICAgICAgICBpZiAoY29tcG9uZW50LnZhbGlkYXRlICE9IG51bGwpIHsKICAgICAgICAgICAgICAgICAgY29tcG9uZW50LnZhbGlkYXRlID0gZXZhbChjb21wb25lbnQudmFsaWRhdGUpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfX0gY2F0Y2ggKGVycikge19pdGVyYXRvci5lKGVycik7fSBmaW5hbGx5IHtfaXRlcmF0b3IuZigpO30KCiAgICAgICAgICB2YXIgY29udGFpbmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInJvb3QiKTsKICAgICAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tbm9uLW51bGwtYXNzZXJ0aW9uCiAgICAgICAgICB2YXIgcm9vdCA9ICgwLCByZWFjdF9kb21fY2xpZW50X19XRUJQQUNLX0lNUE9SVEVEX01PRFVMRV8xX18gLyogLmNyZWF0ZVJvb3QgKi8ucykoY29udGFpbmVyKTsKICAgICAgICAgIHJvb3QucmVuZGVyKCAvKiNfX1BVUkVfXyovcmVhY3RfX1dFQlBBQ0tfSU1QT1JURURfTU9EVUxFXzJfXy5jcmVhdGVFbGVtZW50KF9BcHBfX1dFQlBBQ0tfSU1QT1JURURfTU9EVUxFXzBfXyAvKiBbImRlZmF1bHQiXSAqLy5aLCB7IHBhZ2VzOiBwYWdlcyB9KSk7CiAgICAgICAgfSk7CiAgICAgIH0pKCk7CgogICAgICAvKioqKioqL3JldHVybiBfX3dlYnBhY2tfZXhwb3J0c19fOwogICAgICAvKioqKioqL30pKCkpOwoKfSk7";

/***/ }),

/***/ 171:
/***/ ((module) => {

module.exports = "#relayContainer{margin:1rem;font-family:Arial,Helvetica,sans-serif}#notificationsContainer{pointer-events:none;position:fixed;top:5%;left:70%;transform:translateX(-50%);z-index:999}img{display:block;margin:auto}input.stringcontainer{background-color:#fff;border-radius:5px;border:1px solid #121943;height:24px;margin:auto;display:flex;padding-left:5px}input.interrupt{width:100%;border-color:darkred;background-color:#f1948a;color:darkred;margin:10px 0px;cursor:pointer}input.interrupt:hover{background-color:#f5867a}input.interrupt:active{background-color:#f77163}input.save,input.interrupt{margin:auto;display:block;font-size:x-large;padding:5px 25px;border-radius:10px}.notification{border:3px solid #00529b;background-color:#bde5f8;width:fit-content;margin-right:auto;margin-left:auto;border-radius:40px;color:#00529b;padding:7px 60px;animation:2s fadeOut 5s 1 forwards;cursor:default;pointer-events:auto}@keyframes fadeOut{0%{opacity:1}99%{height:100%}100%{opacity:0;height:0}}td{padding:.5rem}.toggle{align-items:center;border-radius:100px;display:flex;font-weight:700;margin-bottom:16px}.toggle:last-of-type{margin:0}.toggle__input{clip:rect(0 0 0 0);clip-path:inset(50%);height:1px;overflow:hidden;position:absolute;white-space:nowrap;width:1px}.toggle__input:not([disabled]):active+.toggle-track,.toggle__input:not([disabled]):focus+.toggle-track{border:1px solid rgba(0,0,0,0);box-shadow:0px 0px 0px 2px #121943}.toggle__input:disabled+.toggle-track{cursor:not-allowed;opacity:.7}.toggle-track{background:#fff;border:1px solid #5a72b5;border-radius:100px;cursor:pointer;display:flex;height:30px;margin-left:5%;position:relative;width:60px}.toggle-indicator{align-items:center;background:#121943;border-radius:24px;bottom:2px;display:flex;height:24px;justify-content:center;left:2px;outline:solid 2px rgba(0,0,0,0);position:absolute;transition:.4s;width:24px}.checkMark{fill:#fff;height:20px;width:20px;opacity:0;transition:opacity .4s ease-in-out}.dropdowncontainer{padding:8px 16px;border:1px solid rgba(0,0,0,0);border-color:#000}input[value=true]+.toggle-track .toggle-indicator{background:#121943;transform:translateX(30px)}input[value=true]+.toggle-track .toggle-indicator .checkMark{opacity:1;transition:opacity .4s ease-in-out}@media screen and (-ms-high-contrast: active){.toggle-track{border-radius:0;background-color:red}}.topBar{display:flex}.tabEntry{margin-right:10px;border-radius:10px;background-color:#333}.relayTable{padding-bottom:10px}.tabEntry a{display:block;color:#fff;text-align:center;padding:6px;text-decoration:none}.tabEntry a[aria-current=page]{background-color:#00529b;border-radius:10px}.tabEntry a:hover[aria-current=page]{background-color:#002c53;border-radius:10px}.tabEntry a:hover{background-color:#111;border-radius:10px}.setting{position:relative}.setting .settingNameHover{visibility:hidden;background-color:#cacaca;color:#000;text-align:center;border-radius:6px;border-color:#000;position:absolute;z-index:1}.setting:hover .settingNameHover{visibility:visible;padding:5px;margin-left:15px}.hoverBox{position:relative;white-space:nowrap}.settingInput .settingDefaultHover{visibility:hidden;color:#666;position:absolute;z-index:1;left:50%;transform:translateX(-50%)}.settingInput:hover .settingDefaultHover{visibility:visible}.invalid-setting input,.invalid-setting select,.invalid-setting .toggle-track{background:pink !important}.invalid-reason{text-align:center}.invalid-reason small{padding:0px 5px;border-radius:10px;color:red}.settingTag{display:flex;flex-wrap:wrap;overflow:hidden;color:#000;margin:5px}input{outline:none}.settingTagClose{cursor:pointer;position:absolute;right:0px;top:0px}.settingTagSingle{display:inline-flex;border:1.5px solid #764abc;padding-top:2px;padding-left:5px;padding-right:5px;border-radius:5px;white-space:nowrap;color:#764abc;margin-right:5px;margin-bottom:5px;cursor:grab;position:relative}.settingTagSingleCloseVisible{padding-right:20px}.dropdownMenu{position:absolute;transform:translateY(1.5em);border:1px solid #353535;overflow-y:auto;overflow-x:clip;overflow-wrap:break-word;max-height:250px;background-color:#fff;z-index:99;user-select:none}.dropdownItem{padding:3px;cursor:pointer;padding-left:.2em}.dropdownMenu>div+div{border-top:1px solid #d6d6d6}.dropdownItem:hover{background-color:rgba(159,195,248,.4392156863)}.userPreference td:first-child{width:15%}.userPreference td:nth-child(2){width:20%}.hintTagDrop{width:40px;min-height:100%;height:20px;background-image:linear-gradient(rgb(162, 162, 162), transparent);border-radius:5px;padding:0px 0px 0px 5px;margin-right:5px;margin-bottom:2px}.hintTagDropOriginal{background-image:linear-gradient(rgb(176, 94, 168), transparent)}.tagContainer{display:flex;flex-wrap:wrap;overflow:hidden;height:2em;max-height:2em}.draggedItem{opacity:40%}.hidden{display:none}.rearrangedTag{animation:fadeIn 1s}@keyframes fadeIn{from{opacity:.2}to{opacity:1}}\n";

/***/ }),

/***/ 530:
/***/ ((module) => {

module.exports = require("kolmafia");

/***/ })

/******/ 	});
/************************************************************************/
/******/ 	// The module cache
/******/ 	var __webpack_module_cache__ = {};
/******/ 	
/******/ 	// The require function
/******/ 	function __webpack_require__(moduleId) {
/******/ 		// Check if module is in cache
/******/ 		var cachedModule = __webpack_module_cache__[moduleId];
/******/ 		if (cachedModule !== undefined) {
/******/ 			return cachedModule.exports;
/******/ 		}
/******/ 		// Create a new module (and put it into the cache)
/******/ 		var module = __webpack_module_cache__[moduleId] = {
/******/ 			// no module.id needed
/******/ 			// no module.loaded needed
/******/ 			exports: {}
/******/ 		};
/******/ 	
/******/ 		// Execute the module function
/******/ 		__webpack_modules__[moduleId](module, module.exports, __webpack_require__);
/******/ 	
/******/ 		// Return the exports of the module
/******/ 		return module.exports;
/******/ 	}
/******/ 	
/************************************************************************/
/******/ 	/* webpack/runtime/compat get default export */
/******/ 	(() => {
/******/ 		// getDefaultExport function for compatibility with non-harmony modules
/******/ 		__webpack_require__.n = (module) => {
/******/ 			var getter = module && module.__esModule ?
/******/ 				() => (module['default']) :
/******/ 				() => (module);
/******/ 			__webpack_require__.d(getter, { a: getter });
/******/ 			return getter;
/******/ 		};
/******/ 	})();
/******/ 	
/******/ 	/* webpack/runtime/define property getters */
/******/ 	(() => {
/******/ 		// define getter functions for harmony exports
/******/ 		__webpack_require__.d = (exports, definition) => {
/******/ 			for(var key in definition) {
/******/ 				if(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {
/******/ 					Object.defineProperty(exports, key, { enumerable: true, get: definition[key] });
/******/ 				}
/******/ 			}
/******/ 		};
/******/ 	})();
/******/ 	
/******/ 	/* webpack/runtime/hasOwnProperty shorthand */
/******/ 	(() => {
/******/ 		__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))
/******/ 	})();
/******/ 	
/******/ 	/* webpack/runtime/make namespace object */
/******/ 	(() => {
/******/ 		// define __esModule on exports
/******/ 		__webpack_require__.r = (exports) => {
/******/ 			if(typeof Symbol !== 'undefined' && Symbol.toStringTag) {
/******/ 				Object.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });
/******/ 			}
/******/ 			Object.defineProperty(exports, '__esModule', { value: true });
/******/ 		};
/******/ 	})();
/******/ 	
/************************************************************************/
var __webpack_exports__ = {};
// This entry need to be wrapped in an IIFE because it need to be isolated against other modules in the chunk.
(() => {
__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "main": () => (/* binding */ main)
/* harmony export */ });
/* harmony import */ var kolmafia__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(530);
/* harmony import */ var kolmafia__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(kolmafia__WEBPACK_IMPORTED_MODULE_0__);
/* harmony import */ var _RelayUtils__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(616);
function _createForOfIteratorHelper(o, allowArrayLike) {var it = typeof Symbol !== "undefined" && o[Symbol.iterator] || o["@@iterator"];if (!it) {if (Array.isArray(o) || (it = _unsupportedIterableToArray(o)) || allowArrayLike && o && typeof o.length === "number") {if (it) o = it;var i = 0;var F = function F() {};return { s: F, n: function n() {if (i >= o.length) return { done: true };return { done: false, value: o[i++] };}, e: function e(_e) {throw _e;}, f: F };}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");}var normalCompletion = true,didErr = false,err;return { s: function s() {it = it.call(o);}, n: function n() {var step = it.next();normalCompletion = step.done;return step;}, e: function e(_e2) {didErr = true;err = _e2;}, f: function f() {try {if (!normalCompletion && it.return != null) it.return();} finally {if (didErr) throw err;}} };}function _unsupportedIterableToArray(o, minLen) {if (!o) return;if (typeof o === "string") return _arrayLikeToArray(o, minLen);var n = Object.prototype.toString.call(o).slice(8, -1);if (n === "Object" && o.constructor) n = o.constructor.name;if (n === "Map" || n === "Set") return Array.from(o);if (n === "Arguments" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen);}function _arrayLikeToArray(arr, len) {if (len == null || len > arr.length) len = arr.length;for (var i = 0, arr2 = new Array(len); i < len; i++) arr2[i] = arr[i];return arr2;}



function main() {for (var _len = arguments.length, pagesToLoad = new Array(_len), _key = 0; _key < _len; _key++) {pagesToLoad[_key] = arguments[_key];}
  if ((0,_RelayUtils__WEBPACK_IMPORTED_MODULE_1__/* .handleApiRequest */ .SU)()) {
    return;
  }

  if (pagesToLoad.length == 0) {
    // Find any 'page' or 'pages' parameters
    pagesToLoad = ((0,kolmafia__WEBPACK_IMPORTED_MODULE_0__.formFields)()["page"] || (0,kolmafia__WEBPACK_IMPORTED_MODULE_0__.formFields)()["pages"] || "").
    split(",").
    filter((s) => s.length > 0);
  }

  var pages = [];
  var extraHtml;

  if (pagesToLoad.length > 0) {
    var cssFile;var _iterator = _createForOfIteratorHelper(
      pagesToLoad),_step;try {for (_iterator.s(); !(_step = _iterator.n()).done;) {var pageName = _step.value;
        try {var _extraHtml$css;
          var page = null;

          // If the parameter is a string, then try to load from file
          if (typeof pageName == "string") {
            cssFile = (0,_RelayUtils__WEBPACK_IMPORTED_MODULE_1__/* .parseCssFromFile */ .$p)(pageName);
            page = (0,_RelayUtils__WEBPACK_IMPORTED_MODULE_1__/* .parsePageFromFile */ .jU)(pageName);
          } else {
            page = pageName;
          }

          if (page == null) {
            continue;
          }

          // Assume at this point it must be a RelayPage
          pages.push(page);

          if (cssFile == null) {
            continue;
          }

          if (extraHtml == null) {
            extraHtml = { cssFiles: [] };
          }

          extraHtml.css = ((_extraHtml$css = extraHtml.css) !== null && _extraHtml$css !== void 0 ? _extraHtml$css : "") + cssFile;
        } catch (e) {
          (0,kolmafia__WEBPACK_IMPORTED_MODULE_0__.write)(
          "<h2>An error occured while trying to load " + (
          typeof pageName == "string" ?
          (0,_RelayUtils__WEBPACK_IMPORTED_MODULE_1__/* .getPagePath */ .mn)(pageName) + ", is your json properly formatted?" :
          "a relay page") +
          "</h2>");


          if (e) {
            (0,kolmafia__WEBPACK_IMPORTED_MODULE_0__.write)("<br>");
            (0,kolmafia__WEBPACK_IMPORTED_MODULE_0__.write)(e);

            if (e.stack) {
              for (var _i = 0, _arr = e.stack.split("\n"); _i < _arr.length; _i++) {var s = _arr[_i];
                while (s.match(/\t|\r/)) {
                  s = s.replace(/\t|\r/, "");
                }

                (0,kolmafia__WEBPACK_IMPORTED_MODULE_0__.write)("<br>");
                (0,kolmafia__WEBPACK_IMPORTED_MODULE_0__.write)(s);
              }
            }
          }
          return;
        }
      }} catch (err) {_iterator.e(err);} finally {_iterator.f();}
  }

  if (pages.length == 0) {
    (0,kolmafia__WEBPACK_IMPORTED_MODULE_0__.write)(
    "<h3>The relay script could not find any pages to load, either invalid/missing pages were provided or nothing was.</h3>");

    return;
  }

  (0,kolmafia__WEBPACK_IMPORTED_MODULE_0__.write)((0,_RelayUtils__WEBPACK_IMPORTED_MODULE_1__/* .generateHTML */ .ar)(pages, extraHtml));
}
})();

var __webpack_export_target__ = exports;
for(var i in __webpack_exports__) __webpack_export_target__[i] = __webpack_exports__[i];
if(__webpack_exports__.__esModule) Object.defineProperty(__webpack_export_target__, "__esModule", { value: true });
/******/ })()
;